Design of CMOS 
Operational 
Amplifiers
Rasoul Dehghani

Design of CMOS Operational AmpliÔ¨Å ers

For a complete listing of titles in the 
Artech House Microwave Library,
turn to the back of this book.

Design of CMOS Operational AmpliÔ¨Å ers
Rasoul Dehghani

Library of Congress Cataloging-in-Publication Data
A catalog record for this book is available from the U.S. Library of Congress.
British Library Cataloguing in Publication Data
A catalogue record for this book is available from the British Library.
Cover design by Adam Renvoize
ISBN 13: 978-1-60807-153-1
¬© 2013 ARTECH HOUSE
685 Canton Street
Norwood, MA 02062
All rights reserved. Printed and bound in the United States of America. No part of this book 
may be reproduced or utilized in any form or by any means, electronic or mechanical, including 
photocopying, recording, or by any information storage and retrieval system, without permission 
in writing from the publisher.
 All terms mentioned in this book that are known to be trademarks or service marks have been 
appropriately capitalized. Artech House cannot attest to the accuracy of this information. Use of 
a term in this book should not be regarded as affecting the validity of any trademark or service 
mark.
10 9 8 7 6 5 4 3 2 1

Contents 
v 
Chapter 1 Basic Specifications of Op Amps 
1
1.1 Op Amp Parameters 
1
1.2 Conclusion 
13
Chapter 2 CMOS Technology and Physics 
15
2.1 Basic Processes in MOS Transistor Fabrication 
15
2.2 Principles of MOS Transistor Functioning 
17
2.2.1 MOS Transistor Operating in Saturation Region 
17
2.2.2 MOS Transistor Operating in Subthreshold Regime 
21
2.3 Small-Signal Model of MOS Device 
21
2.3.1 Gate to Substrate Capacitance 
24
2.3.2 Gate to Source/Drain Capacitance 
26
2.3.3 Source/Drain to Bulk Capacitance 
27
2.4 Conclusion 
31
Chapter 3 CMOS Differential Amplifiers 
33
3.1 Source-Coupled Differential Pair Characteristic 
33
3.2 CMOS Differential Amplifier with Active Load 
36
3.2.1 Large-Signal Characteristic of CMOS  
Differential Amplifier 
36
3.2.2 Offset Voltage of CMOS Differential Amplifier 
38
3.3 Common-Mode Behavior of CMOS Differential Amplifier 
42
3.4 CMOS Differential Amplifier Frequency Response 
43
3.5 Noise Calculations in CMOS Differential Amplifier 
47
3.6 Conclusion 
53
Chapter 4 CMOS Single-Ended Output Op Amps 
55
4.1 CMOS Two-Stage Op Amp 
55
4.1.1 Offset Voltage 
56
4.1.2 Two-Stage Op Amp Frequency Response 
59
4.1.3 CMOS Two-Stage Op Amp Design Procedure 
65
Design Example 
69
4.1.4 PSRR of CMOS Two-Stage Op Amp 
72
4.2 Telescopic Cascode Op Amp 
83
4.3 Folded-Cascode Op Amp 
86
Design Example 
87
4.4 Current Mirror Op Amp 
90
Design Example 
94
4.5 Rail-to-Rail Input Op Amp 
96
4.6 Conclusion 
105

vi 
Contents 
 
 
 
Chapter 5 CMOS Fully Differential Op Amps 
107
5.1 Advantages of Fully Differential Op Amps 
107
5.2 Common-Mode Feedback Concept 
109
5.3 Common-Mode Feedback Circuits 
111
5.3.1 Common-Mode Feedback Circuit with Resistive  
Sensing 
112
5.3.2 Differential Difference Common-Mode Feedback  
Circuit 
114
5.3.3 Common-Mode Feedback Circuit Using MOS  
Devices Operating in the Triode Region 
118
5.3.4 Switched-Capacitor Common-Mode Feedback Circuit 119
5.4 Fully Differential CMOS Op Amp Architectures 
123
5.4.1 Fully Differential Two-Stage Op Amp 
123
5.4.2 Fully Differential Current Mirror Op Amp 
127
5.4.3 Fully Differential Folded-Cascode Op Amp 
129
Design Example 
130
5.5 Conclusion 
134
Chapter 6 CMOS Output Stages 
135
6.1 Class A and Class B Output Stages 
135
6.1.1 Source-Follower as an Output Stage 
135
6.1.2 Class B Power Amplifier 
139
6.2 Drain-Coupled Complementary Transistors as Output Stage 142
6.3 Low-Voltage Class AB Buffer 
149
6.4 Class AB Output Stage Using a Translinear Loop 
153
6.5 Case Study 
159
Design Example 
163
6.6 Conclusion 
166
Chapter 7 CMOS Reference Generators 
167
7.1 CMOS Voltage Reference Generators 
167
7.1.1 Bandgap Voltage Reference Generator 
168
Design Example 
170
7.1.2 Low-Voltage Bandgap Reference Generator 
173
Design Example 
174
7.1.3 CMOS Voltage Reference Generator without Resistors 176
7.2 CMOS Current Reference Generators 
180
7.2.1 Gm-Constant Circuit 
182
7.2.2 Fully Integrated Precision CMOS Current Reference 
186
7.2.3 CMOS Current Reference without Resistors 
188
Design Example 
191
7.3 Conclusion 
193 
Index 
    195

 
1 
Chapter 1 
Basic Specifications of Op Amps 
An operational amplifier is one of the most important building blocks in many 
analog systems. For instance, in an integrated analog filter such as a switched-
capacitor or a Gm-C filter, the op amp is an integral part of the circuit. Data 
converters including both analog-to-digital and digital-to-analog converters are 
other categories in which the op amp plays a fundamental role to achieve the 
desirable performance. In voltage and current reference generators an op amp has 
remarkable influence on the operation of these circuits. In the enumerated 
instances many parameters of the system are extensively dependent on the 
specifications of the op amps used in that system. It should be noted that the 
criteria applied to the design of an op amp employed in such systems are usually 
different from those used for designing a general-purpose op amp that is to be 
available as a stand-alone component in discrete circuitries. In general, the 
behavior of an op amp is described by many different parameters in which some of 
them might be more important than others in a particular analog system. In this 
chapter we introduce the main op amp parameters that have significant impact on 
the behavior of an analog system where an op amp has been exploited. 
1.1 Op Amp Parameters 
DC gain: Ideally the value of this parameter is considered infinity but in reality, 
due to the limited intrinsic voltage gain of each device used in the op amp circuit, 
the entire gain of an op amp has a finite value in the typical range of  to  
(40 dB-100 dB). Exploiting an op amp in a linear amplifier involves putting the op 
amp in a negative-feedback loop. In this situation a high dc gain of the op amp 
could be essential. In the following we demonstrate the reason for such an 
assertion. Supposing that the open-loop gain of the feedback is quite high, we can 
calculate the closed-loop gain of the circuit based on the values of the feedback 
network components independent of the op amp parameters. As an example 
consider the inverting feedback amplifier shown in Figure 1.1. Denoting the  
low-frequency voltage gain of the op amp as , we can calculate the exact  

2 
Basic Specifications of Op Amps 
 
 
closed-loop voltage gain as 

 	



 	


(1.1) 

Where     is the feedback factor. If it is assumed that   , 
(1.1) can be approximated as     . In an ideal case, for 
  , the amplifier gain is completely independent of the op amp gain and 
equals . In practice, for a particular feedback gain error, we need to increase 
the op amp gain above a certain level. For example, ideal feedback gain of 
 	  

	2 with an error less than 0.1% is achievable provided that 
 

  or if we have    . Thus, in order to achieve more accurate 
feedback gain the dc gain of the op amp needs to be quite high. 
 
Limited linearity range. For a certain level of the input and output signal 
variations, the internal devices of op amp operate in the linear part of their 
characteristics. At input, the devices remain in their active operation region when 
the variation range of the input common-mode voltage is limited to a particular 
range known as input common-mode range (ICMR) [1]. This parameter depends 
on the op amp structure and the type and biasing conditions of the input devices. 
The linear operation range for a differential input signal in an open-loop state is 
much more limited. Of course when an op amp is used in a negative-feedback 
loop, the linearity behavior is significantly improved by the feedback mechanism. 
An amplified signal at the output of an op amp can also swing in the limited range 
at the most between two supply rails, although its precise level depends on the 
particular structure utilized as the output stage.  
 
Common-mode rejection ratio. One of the most outstanding advantages of an op 
amp is its capability to amplify the difference of two input signals without output 
being affected significantly by the changes in the input common-mode level. This 
property results in immunity against any common-mode undesirable signal that 
 
Figure  1.1 Inverting feedback amplifier. 
‚àí
+
vi
vo
C1
C2

 
1.1 Op Amp Parameters 
3 
might appear at the inputs of the op amp. The parameter of common-mode 
rejection ratio (CMRR) is used to quantify this performance [2]. The definition of 
this parameter is a little bit different for the two types of op amp. In a fully 
differential op amp in which both input and output signals are differential, the 
differential-mode and common-mode components of the output voltage are 
expressed as a linear combination of the corresponding input voltages as follows 
 

!"# 	 $#!%$  ##!%#
(1.2a) 
 

!"$ 	 $$!%$  #$!%#
(1.2b) 
 
where ## and $$ are differential-mode and common-mode voltage gains, 
respectively. $# and #$ exhibit the contribution of the common-mode and 
differential-mode of the input; that is, !%$ and !%# in their corresponding 
components in the output voltage, respectively. In an ideal differential op amp 
with a fully symmetrical structure, we have $# 	 #$ 	  but in reality, due to 
the device mismatches in the path of each input to two other outputs, this is not the 
case. In this situation, CMRR is defined as the ratio of the differential voltage 
gain## to the common-mode to differential-mode voltage gain $# as 
 
 
& ''() 	 *
++
,+* 
(1.3) 
 
where & ''() denotes the fully differential CMRR. To measure the & ''(), 
we might exploit the circuit illustrated in Figure 1.2. The fully differential op amp 
is configured as a unity voltage gain amplifier in a negative-feedback loop. The 
internal common-feedback circuit and the external negative-feedback cause the 
output common-mode voltage and also the dc level of each output to be kept on 
the common-mode reference voltage denoted by -$.. Representing the voltages at 
the inverting and noninverting inputs of the op amp as !/ and !, respectively, we 
can easily find these voltages as follows 
 

!/ 	

 !"
  -$.  -$0
(1.4a) 


! 	

 !"
/  -$.  -$0
(1.4b) 
 
From the above relations, the input differential-mode and common-mode voltages 
are obtained 
 
 
!%# 	 !  !/ 	 

 !"#
(1.5a) 
 

!%$ 	

 !  !/ 	

 !"$  -$.  -$0
(1.5b) 

4 
Basic Specifications of Op Amps 
 
 
 
By substituting (1.5a) and (1.5b) into (1.2a) and simplifying the result, we get 
 
 
!"# 	
1,+
2
1++
2
!"$  -$.  -$0 
(1.6) 
 
Now when the input voltage of -$0 is changed by 3-$0, the terms of !"$ and -$. 
have no variation and thus we have 3!"$ 	 3-$. 	 . That gives 
 
 
3!"# 	
1,+
2

1++
2
3-$0
(1.7) 
 
Since ##  , we have 
 
 
34+
34,5 
,+
++ 	

67 889:
(1.8) 
 
It should be emphasized that the gain of $# is not zero only when the 
mismatches in the op amp circuit are considered. As a result, we have to perform 
an ac analysis for several Monte Carlo simulation runs and obtain the 
corresponding voltage gain of 3!"# 3-$0

 for each run. Since the amount of the 
mismatch changes in each run, we get various voltage gains whose mean value can 
be used to calculate the typical & ''(). As an example, in a fully differential op 
amp, 100 runs of Monte Carlo analysis give 3!"# 3-$0

	 ;<=>? as the mean 
value of the data with a standard deviation of @ 	 A=>? and thus for this op amp 
 
Figure  1.2 Test circuit used to measure the CMRR for a fully differential op amp. 
+
-
+
-
Vcr
-
-
+
+
R
R
R
R
Vcm
vod
vo
+
vo
-

 
1.1 Op Amp Parameters 
5 
the typical value of the CMRR becomes ;<=>?. The worst-case value could 
reach B>? in the range of C@.  
In an op amp with single-ended output the output voltage is represented by 
 
 
!" 	 #0!%#  $0!%$
(1.9) 
 
where #0 and $0 are differential-mode and common-mode voltage gains, 
respectively. Here CMRR is defined as 
 
 
& ''DE 	 *
+5
,5*
 (1.10) 
 
where & ''DE indicates the CMRR of a single-ended output op amp. As it will 
be shown in the next chapters, in a fully differential op amp a high CMRR is 
achievable by implementing a fully symmetrical circuit to minimize$#. In a 
single-ended one, even when the op amp has a perfect symmetry in an ideal 
condition, the CMRR would be limited by the output resistance of the tail current 
source used in the differential pair. One method to measure the CMRR for a 
single-ended output op amp is shown in Figure 1.3 [3]. In this circuit we have 
! 	 -$0 and !/ 	 !"  -$0. Since !%# 	 !  !/ and !%$ 	 !  !/  
 , by 
substituting these relationships into (1.9), we can write the output voltage as 
 
 
!" 	 #0!"  $0 F-$0 


 G  
 (1.11) 
 
Rearranging (1.11), we obtain the transfer function as 
 
 


4,5 	
,5
+5/1,5
2
 
(1.12) 
 
Noting that #0  H $0, we see that the inverse of the obtained gain in (1.12) 
approximately gives the & ''DE. 
 
Offset voltage. The device mismatches in the input stage have the most 
 
Figure  1.3 Measurement of the CMRR parameter for a single-ended output op amp. 
‚àí
+
+‚àí
+‚àí
Vcm
vo
Vcm

6 
Basic Specifications of Op Amps 
 
 
contribution in this parameter. It is interesting that the nonzero common-mode 
voltage gain of an op amp also contributes to the input offset voltage [4]. To see 
that, from (1.9) for !%# 	 , we have !" 	 $0!%$. This means the op amp output 
voltage varies in response to the input common-mode voltage variation in spite of 
the fact that the differential mode of the input voltage has no variation. In this 
situation, the op amp can be thought of as an ideal op amp in a sense that it just 
reacts to the differential mode of the input voltage and the effect of the input 
common-mode changes is attributed to an equivalent differential input voltage 
with the value of -%HIJ 	 !"#0 or -%HIJ 	 $0!%$ #0

. Therefore in an op amp 
with nonzero common-mode voltage gain, the voltage of -%HIJ 	 -%$& '' is 
added to the input-referred offset voltage. The main parameters of an op amp that 
affect the offset voltage will be discussed in more detail in the next chapters. 
Figure 1.4 represents two circuits to measure the offset voltage of single-ended 
and fully differential op amps. Both op amps are configured as a voltage follower 
without any external input. The left-side circuits depict the real op amps including 
mismatches with finite CMRR.  
All nonideal effects that create the offset voltage such as mismatches and 
nonzero common-mode voltage gains of $0 and $# have been modeled by a dc 
voltage source denoted by -"K that is placed in series with the input of an ideal op 
amp. Hence, the output voltage relationships for two types in an ideal case are 
!" 	 #0!%# and !"# 	 ##!%#. Summing voltages around the loop from the 
output to the input yields !%# 	 -"K  !" for the single-ended op amp and 
!%# 	 -"K  !"# for the other one. Substituting these relationships into the 
corresponding equations of the output voltages gives us the offset voltages as 
 
Figure  1.4 Test circuits for (a) single-ended (b) fully differential op amp offset voltage. 
‚àí
+
vo
‚àí
+
vo
+‚àí
Vos
(a)
‚àí
+
+
-
+
-
vod
‚àí
+
+
-
+
-
vod
+‚àí
+
-
vid
Vos
+
vid
-
(b)
Real includes mismatches
Real includes mismatches
Ideal
Ideal

 
1.1 Op Amp Parameters 
7 
!"HDE 	 -"K#0   #0

 and !"H() 	 -"K##   ##

 for single-ended and 
fully differential types, respectively. Since #0H ##  , the output voltages of 
both circuits nearly represent the offset voltage. It should be pointed out that 
similar to the method used for measuring CMRR of a fully differential op amp, the 
op amp offset voltage can be obtained by running several Monte Carlo analyses on 
the circuits of Figure 1.4 and taking the standard value of the data as the op amp 
offset voltage. In the absence of systematic errors the mean value of the offset 
voltage is almost zero. 
 
Frequency bandwidth. The open-loop voltage gain of an op amp begins to drop 
as frequency increases. This happens because of internal parasitic capacitances in 
the op amp circuit. The bandwidth parameter is important because by dropping the 
op amp voltage gain, the closed-loop gain would not be independent of the op amp 
parameter anymore. In fact, the frequency bandwidth expresses how fast an op 
amp can follow the time variations in the input signal. It is obvious that to amplify 
fast signals we need to employ an op amp with adequate large bandwidth in such a 
way that it can provide enough loop gain at maximum operating frequency. The 
speed performance of an op amp is usually measured by the unity gain bandwidth 
parameter denoted by LM, as illustrated in Figure 1.5. As its name suggests, LM is a 
frequency at which the magnitude of the gain reaches unity. When an op amp is 
used as a voltage follower in a negative-feedback loop, it might suffer from the 
instability problem at frequencies near LM. Thus the op amp should be properly 
designed to have an acceptable amount of stability in the frequency domain [5]. 
 
Slew rate. This parameter is used to express the time speed limitation of an op 
 
Figure  1.5 Op amp voltage gain versus frequency. 
œâp1
œâp2
œâu
Av(jœâ)
Av0
0
œâ

8 
Basic Specifications of Op Amps 
 
 
amp output. When an op amp is placed in a negative-feedback loop and a rather 
large-signal is applied to its input, the output cannot follow the rapid changes in 
the input signal. This is another speed limitation in op amps that is raised in 
conjunction with the large-signal behavior of op amps. Indeed, unity gain 
bandwidth indicates the limitation of an op amp to follow the fast input signals 
with very small amplitude while slew rate is considered an index of op amp large-
signal time response [6]. In some applications such as pipeline analog-to-digital 
converters, both parameters play a key role in determining the maximum 
achievable speed for the converter [7]. The response of a voltage follower to a step 
voltage applied as input is plotted in Figure 1.6(b). As it can be seen, the output 
time response consists of two parts. The first part is the time duration that the 
output voltage changes from its initial value to approach its final level. This part is 
associated with the limited op amp slew rate. The second part starts when the 
difference between input and output voltages is small. Now the small-signal 
frequency response of the op amp determines how long it takes to reach its steady 
state. This time, known as settling time, is illustrated in Figure 1.6(b). 
 
Noise. A complementary metal oxide semiconductor (CMOS) op amp is made of 
several numbers of n-type MOS (NMOS) and p-type MOS (PMOS) transistors. 
Channel thermal noise and flicker noise are two main noise sources in each MOS 
device [8]. The total noise generated by each device is represented by two 
generally correlated noise voltage and noise current generators at the input of an 
op amp. Flicker noise has a higher level of energy at low frequencies while 
thermal noise has a flat spectrum in the frequency domain. The variation of the 
spectral density of the input-referred noise voltage including both flicker and 
thermal noises is plotted in Figure 1.7. In this plot the thermal noise and flicker 
 
Figure  1.6 (a) Voltage follower, and (b) time response of voltage follower to input step voltage. 
‚àí
+
(a)
vi(t)
V
0
0
t
t
V
tsettle
tslew
vo(t)
vi(t)
vo(t)
(b)
Input step voltage
Output response

 
1.1 Op Amp Parameters 
9 
noise asymptotes intersect each other at a frequency called the flicker noise corner 
frequency that is denoted by $. In submicron CMOS technology, due to some 
physical effects such as the hot electron effect, the level of the thermal noise in the 
MOS device increases. According to Figure 1.7, the part of the frequency band 
that is less than $ is mostly influenced by the flicker noise. At the frequencies 
near zero there is no noticeable difference between the input offset voltage and the 
flicker noise at the input. 
 
Power supply rejection ratio. The amount of supply noise or any other 
disturbances on the supply rail that can find its way to the op amp output depends 
on this parameter [9]. Mathematically the power supply rejection ratio (PSRR) in 
an op amp is defined as 
 
 
NO'' 	 P
+
QP
(1.13) 
 
where # is the differential voltage gain of the op amp and R is the voltage gain 
from each supply to the op amp output. Supposing the op amp as a linear circuit, 
we express its output voltage as a linear combination of the differential input 
voltage and the noise voltage on the supply 
 
 
!" 	 #!%#  R!R
(1.14) 
 
In (1.14) the first term is the desirable signal component and the second one 
indicates the amount of supply noise at the output. Indeed, PSRR represents the 
ratio of the desired signal to the supply noise at the op amp output. Since op amps 
have two supply rails, two parameters of NO'' and NO''/ are usually defined 
 
Figure  1.7 Spectral of input-referred noise voltage. 
0
 Vn
2
f
fc
4kTReq
 Kf
f
f

10 
Basic Specifications of Op Amps 
 
 
in which the corresponding voltage gain from positive and negative supply is 
denoted by R
 and R
/, respectively. In an integrated analog mixed-mode circuit 
where different analog and digital blocks are fabricated on the same chip, special 
attention should be paid to the PSRR parameter of op amps used in the circuit 
[10]. For example, if the PSRR of an op amp is not good enough, any existent 
noise on the supply rail such as digital noise created by the system clock can reach 
the op amp output and amplified by the next stages can easily corrupt the quality 
of the ultimate output signal. In addition, the behavior of PSRR at higher 
frequencies is also important. In fact, the magnitude of this parameter at high 
frequencies determines the amount of high-frequency supply noise that impacts on 
the op amp output signal. In practice, PSRR can be measured by employing the 
circuit shown in Figure 1.8. Assuming a finite differential voltage gain of # for 
op amp and denoting the voltage gain from supply to the output by R, we can 
write 
 
 
!" 	 R!R  #!"
 (1.15) 
 
Rearranging (1.15), we have 
 
 
!" 	
Q
+ !R
(1.16) 
 
Since #  , we can obtain the PSRR as 
 
 
NO'' 	

Q


 (1.17) 
 
The circuit in the path from positive supply to the output is generally different 
from the other path from negative supply to the output; thus, two different PSRR 
parameters are usually defined for two op amp supply rails. 
 
Figure  1.8 Circuit used to measure PSRR. 
‚àí
+
+
-
vp
vo
+
-
vo
Ad

 
1.1 Op Amp Parameters 
11 
PSRR in a fully differential op amp has a similar relationship given in (1.13) 
in which # is replaced with ##. It should be pointed out that if the circuit of the 
fully differential op amp has perfect symmetry in an ideal case, the noise of supply 
appears equally on both outputs and as a result there is no differential output 
voltage. In reality, device mismatches in the op amp circuit reveal their 
contributions as nonzero differential output voltage. Thus the mismatch is 
responsible for nonzero PSRR in fully differential op amps. This means that to 
measure PSRR we have to follow the procedure that was given to measure 
& ''(). We can use the circuit of Figure 1.2 in which an ac voltage source is 
placed in series with the supply while just common-mode voltage reference -$. is 
applied to the input. Repeating the given method for CMRR calculation, we obtain 
 
 
3!"# 	
Q
1++
2
3!R
 (1.18)
 
Equation (1.18) represents the change in the differential output owing to the 
variation in the supply voltage. The parameter R denotes the voltage gain from 
supply to the output. Since ##  , from (1.18), PSRR is given by 
 
 
NO'' 	
++
Q 	

3S+
3SQ
 
 (1.19) 
 
By performing Monte Carlo analysis we can obtain the voltage gain from supply 
to the differential output in different runs. Such simulation on the previous 
example 
given 
for 
CMRR 
calculation 
produces 
the 
result 
of 
3!"# 3!R 	 

AT>? as the mean value of data that based on (1.19) gives 
NO'' 	 A<T>?while its standard deviation is @ 	 ;>?. This result reveals 
that in the op amp of our example, the supply noise compared to the input 
common-mode voltage variation is more effectively passed to the op amp output 
in the presence of mismatches. 

12 
Basic Specifications of Op Amps 
 
 
Table  1.1 
Some Main Parameters of a Typical CMOS Op Amp 
Parameter 
Name 
Parameter 
Symbol 
Relationship 
Value in 
Ideal 
Case 
Typical Value 
in a Real Op Amp 
Unit 
DC voltage 
gain 
4  
Depends on structure 
Infinity 
40-120 
dB 
Input 
common-
mode range 
ICMR 
-%$H0UV  -%$H0UV  
-))  
=  W& ' 
-))    
(e.g., in a simple 
NMOS input op 
amp) 
V 
Common-
mode 
rejection 
ratio 
CMRR 
Fully differential 
*
++
,+* 
Infinity 
> 80 
dB 
Single-ended output 
op amp *
+5
,5* 
Offset 
voltage 
-"K 
Depends on 
mismatches in 
threshold voltage 
and sizing 
Zero 
< 5  
mV 
Unity gain 
bandwidth 
LM 
In most single-stage 
op amps X0H%Y Z

 
Infinity 
< 100 
MHz 
Slew rate 
SR 
Usually as W Z

 
Infinity 
 =  
[ \]

 
Power 
supply 
rejection 
ratio 
PSRR 
P
+5
Q P  
Infinity 
> 80 
dB 
Input-
referred 
noise 
voltage 
-Y 
Channel thermal 
noise and flicker 
noise referred to the 
input 
Zero 
^_ `ab; 
^`ab  
c[ d`a

 

 
1.2 Conclusion 
13 
 
 
 
1.2 Conclusion 
In this chapter, several important dc and ac parameters of op amps were 
introduced and some methods were presented that can be used to measure these 
parameters. The discussed parameters are associated with both single-ended output 
and fully differential op amps. We have summarized some main parameters of a 
typical CMOS op amp that were briefly discussed in this chapter as illustrated in 
Table 1.1. It is worth keeping in mind that the exact relationship for each 
parameter in this table depends extensively on the particular structure used in the 
op amp circuit that will be the subject of the next chapters. The given numerical 
data for some parameters indicate typical values that are usually observed in 
currently designed CMOS op amps. 
References 
[1] Huijsing, J., Operational Amplifiers: Theory and Design, Second Ed, Springer, 2011. 
[2] Baker, R. J., CMOS: Circuit Design, Layout, and Simulation, Third Ed, John Wiley & Sons, 
2010. 
[3] Allen, P. E., Holberg, D. R., CMOS Analog Circuit Design, Second Ed, Oxford University Press, 
2002. 
[4] Mancini, R., Carter, B., Op Amps for Everyone, Third Ed, Elsevier Inc., 2009. 
[5] Ivanov, V., Filanovsky, M., Operational Amplifier Speed and Accuracy Improvement: Analog 
Circuit Design with Structural Methodology, Kluwer, 2004. 
[6] Baher, H., Signal Processing and Integrated Circuits, John Wiley & Sons, 2012. 
[7] Plassche, R., V., D., CMOS Integrated Analog-to-Digital and Digital-to-Analog, Second Ed, 
Boston, Kluwer Academic Publisher, 2003. 
[8] Bhattacharyya, A. B., Compact MOSFET Models for VLSI Design, John Wiley & Sons, 2009. 
[9] Shepherd, P. R., Integrated Circuit Design, Fabrication and Test, McGraw-Hill, 1996. 
[10] Gejji, V. P., Analog and Mixed Mode VLSI Design, PHI Learning Private Limited, New Delhi, 
2011. 
 
 

 
 
 
 
 

 
 
 
15 
Chapter 2 
CMOS Technology and Physics 
A part of the limitation in the performance of a CMOS circuit is related to how it 
is implemented. Therefore a comprehensive perception of the CMOS circuit 
fabrication and the required steps to get the final desirable circuit can significantly 
aid in achieving a successful design. Furthermore, the advanced semiconductor 
industry necessitates a close and tight collaboration between circuit designers and 
process engineers, who need to understand their languages in order to exchange 
information about possible technological capabilities and also existent constraints 
in the fabrication process. In this chapter, we briefly describe the main sequence of 
steps that are followed in the fabrication of an MOS transistor. Next, we introduce 
the electric current equation for this kind of transistor and based on the physical 
operation we present a complete small-signal model of the device. In the given 
analysis we will refer to some physical effects such as short-channel behavior, and 
subthreshold operation region and their impact on the circuit design. Interested 
readers are referred to the references at the end of the chapter for deeper 
discussions. 
2.1 Basic Processes in MOS Transistor Fabrication 
In an n-well process in which all PMOS transistors are to be put inside the n-wells, 
the first step is to create an n-well inside the substrate of a p-type. The ion 
implantation technique is usually used to create an n-well region. The next step is 
to create isolation areas between adjacent transistors by growing a thick oxide 
layer under which an extra ion implantation called channel-stop is done to increase 
the effective threshold voltage of this area. After applying some trimming on the 
threshold voltage of the active area, the gate pattern is defined and then the 
source/drain junctions and also p-substrate and n-well contacts are formed by two 
individual ion implantations for two NMOS and PMOS devices. After 
source/drain ion implantation, a thermal process needs to be done and thereby the 
damaged lattice structure is fixed. This process is known as annealing. Because of 
the thermal process in the annealing, the impurity atoms in these areas penetrate 

16 
CMOS Technology and Physics 
 
 
underneath the gate electrode due to lateral diffusion. The overlapped part of the 
gate with the extended part of the source/drain regions creates an overlap parasitic 
capacitance between the source/drain and gate terminals. These capacitances, 
especially one that is formed between the gate and drain, can affect significantly 
the frequency response of the circuits particularly in analog designs. Figure 2.1 
summarizes the main steps mentioned above to fabricate two types of MOS 
devices. The subject of CMOS technology and the fabrication process can be 
found in [1-5] in much more detail. 
 
 
Figure  2.1 Main steps of MOS device fabrication. 
 
 
Creation of n-well
 in p-substrate
n-well
n-well
p-substrate
sio2
sio2
p-substrate
Channel-stop and threshold
adjust implant and 
growth of field oxide
n-well
sio2
p-substrate
Deposition of polysilicon gate
of NMOS and PMOS devices 
n-well
sio2
Field Oxide
p-substrate
Channel-Stop
Implantation of source, drain, and  
n-well contacts using two 
individual masks in two steps for 
NMOS and PMOS devices
n+
n+
n+
p+
p+
Channel-Stop
Field Oxide
Field Oxide
Channel-Stop
Gate Oxide
Gate Oxide
Gate Oxide
Gate Oxide
S/D of NMOS
S/D of PMOS
n-well ohmic
contact
(1)
(2)
(3)
(4)

 
2.2 Principles of MOS Transistor Functioning 
17 
 
 
2.2 Principles of MOS Transistor Functioning 
Shown in Figure 2.2 is the cross-section view of an NMOS transistor. When a 
positive voltage is applied to the gate, since the majority carries of the substrate 
are the holes, they are repelled toward the bulk and as a result, a charge space of 
the negative ions leaves behind at the surface. In device physics this operating area 
of the device is known as the depletion mode. By increasing the gate voltage in the 
positive direction the proper condition is provided for the majority carriers in the 
source region to be injected into the substrate. More positive gate voltage causes 
growth of electrons and at the same time reduction of the number of holes. This 
ultimately leads to inverting the type of the semiconductor from p-type to n-type at 
the surface. For a certain level of the gate-source voltage, the density of electrons 
in the created inversion layer would be that of the substrate holes. In this situation 
the transistor operates at the edge of a state called strong inversion. The 
corresponding gate-source voltage that puts the device at the edge of the strong 
inversion condition is known as the threshold voltage and is denoted by -e. For 
  -fD  -e, the electrons concentration of the inversion layer is less than that of 
the substrate holes and the transistor is in a state called weak inversion. This 
operating area is known as the subthreshold region. In the following sections we 
deal with the MOS functioning in these two operating areas. 
2.2.1 MOS Transistor Operating in Saturation Region 
In the presence of the conductive layer in a strong inversion state, an applied 
voltage between the drain and source creates an electric field along the channel 
and makes the current flow from the source to the drain. By utilizing Ohm‚Äôs law 
and writing the channel conductivity in terms of inversion charge g%Y
, it is shown 
that [6] for a long-channel device the drain current equation in the triode region 
can be approximated by a quadratic relationship that is a function of the gate-
 
 
Figure  2.2 Cross section of an NMOS device. 
n+
n+
FOX
p_substrate
FOX
S
D
G
inversion layer

18 
CMOS Technology and Physics 
 
 
source and drain-source voltages. 

W) 	 hY"V
i
Z j-fD  -e-)D 
4:k
2
 l
(2.1)
 
where hY is the electron mobility in the inversion layer, "V 	 m"V n"V

 is the gate 
oxide capacitance per unit area with m"V as the oxide permittivity and n"V as the 
gate oxide thickness, and o and p are the transistor channel width and length, 
respectively. At a given -fD  -e, increasing the drain-source voltage causes the 
density of the free electrons of the inversion layer at the drain side to decrease, and 
ultimately for -f) 	 -e the electron charges at drain almost disappear such that 
the device is put at the edge of the saturation region. The certain value of the 
drain-source voltage at which the device is at the edge of saturation will be 
 

-)DHKUq 	 -fD  -e
(2.2) 
 
For -)D  -)DHKUq, the depletion region of the drain-bulk junction extends toward 
the source. The excess voltage of -)D  -)DHKUq extends across the depletion region 
of the drain to the bulk junction and the voltage drop across the inversion layer is 
kept on -)DHKUq. This situation is very similar to the behavior of a bipolar junction 
transistor (BJT) operating in an active forward region in which the major part of 
the collector to emitter voltage drops across the reverse-biased collector-base 
junction and a small part of the total voltage drops across the forward-biased base-
emitter junction. To make clear the operation of the MOS device in saturation, the 
drain-bulk junction and the inversion layer can be modeled by the series 
connection of a reverse-biased diode indicating the drain-bulk junction and a 
resistor representing the inversion layer resistance, as illustrated in Figure 2.3. 
For a given constant -fD, -)DHKUq 	 -fD  -e is constant and thus the drain 
current is fixed. In practice, by increasing the drain-source voltage, the voltage of 
 
Figure  2.3 MOS operation in a saturation region. 
n+
n+
FOX
p_substrate
FOX
S
D
G
VGS=cte
VDS 
VDS,sat
+
-
VDS-VDS,sat
+
-
VDS
+
-
D
S
ID
Rch
‚àÜL
L
Leff

 
2.2 Principles of MOS Transistor Functioning 
19 
 
-)D  -)DHKUq across the drain to bulk junction increases, which results in 
extending the depletion area toward the source region. This causes the effective 
length of the inversion layer to decrease, and as a result, the inversion layer 
resistance slightly reduces. This effect leads to gradually increase the drain 
current, which is known as channel length modulation. This phenomenon shows 
itself as a small positive slope on the MOS output characteristic, as depicted in 
Figure 2.4.  
The drain current equation including the channel length modulation effect is a 
quadratic equation in which channel length is replaced by an effective length as 
 

W) 	

 hY"V
i
Zrss -fD  -e
 (2.3) 
 
where pI  p  3p with 3p as the depletion region width of the one-sided drain 
junction [7] 
 

3p  t
uv
Jwvxy -)D  -)DHKUq
(2.4)
 
The slope of the curve shown in Figure 2.4 in saturation is denoted by X#K and can 
be calculated by taking the derivation of (2.3) in terms of implicit variable -)D 
 

X#K 	
z{:
z4:k 	
z{:
zZrss
zZrss
z4:k
(2.5)
 
Using (2.3) and (2.4) and after some simple manipulations on (2.5), we have 
X#K 	 |W) where the parameter | defined as 
 
Figure  2.4 MOS characteristic in saturation with channel length modulation effect. 
slope=gds
VDS
VDS,sat
VGS=cte
ID
0

20 
CMOS Technology and Physics 
 
 

|}#K ~ pIt-)D  -)DHKUq‚Ä¢
‚Ç¨

(2.6) 
 
where }#K  ‚Ä¢ mK ‚Äö∆íKM‚Äû

. Supposing 3p ‚Ä¶ p, (2.6) can be approximated as 
 

| ‚Ä†
‚Ä°+v
Zt4:k/4:kHvÀÜ‚Ä∞


 F
‚Ä°+v
Z G


(2.7) 
 
The parameter X#K is the dynamic conductance between drain and source terminals 
of an MOS device and plays an important role in all MOS amplifiers. In fact, for a 
given MOS transconductance, the maximum achievable voltage gain is determined 
by this parameter. In a CMOS current source, high output resistance is achievable 
if the exploited MOS devices have minimum possible |. For a particular drain 
current, a practical way to minimize | is to use the maximum possible channel 
length for MOS devices and also to increase the drain-source biasing voltage 
based on (2.7). It is interesting that PMOS transistors at the same channel length 
and drain biasing conditions have usually less X#K in comparison to their NMOS 
counterparts. This is because PMOS devices are fabricated inside the n-well and 
doping concentration of the n-well is usually greater than the impurity density in 
the p_substrate of NMOS devices. Consequently at the same condition in terms of 
channel length and biasing condition, }#K is smaller for the PMOS device. As an 
example, in a 0.25-\≈† CMOS technology the impurity concentration in the 
p_substrate is ∆íKM‚Äû 	 <C ‚Äπ ≈í‚Ä¢≈†/≈Ω and the doping density in n-well is 
∆í‚Ä¢ I‚Ä¢‚Ä¢	 T= ‚Äπ ≈í‚Ä¢≈†/≈Ω, and as a result, factor ‚Äò#K of the NMOS device is 
about < times of its corresponding factor in a PMOS device that leads to the 
same increase in the parameter of | in the NMOS transistor. 
Any potential difference between the source and bulk in an MOS device 
increases the effective threshold voltage of the device according to the following 
relationship [8] 
 

-e 	 -e  ‚Äô‚Äú‚Ä¢ ‚Äù‚Ä¢  -D‚Ä¢  ‚Ä¢ ‚Äù‚Ä¢‚Äì
 (2.8) 
 
where -D‚Ä¢ is the potential difference of the source and substrate and -e is the 
threshold voltage with -D‚Ä¢ 	 . The parameters ‚Äô and ‚Äù‚Ä¢ are defined as 
 

‚Äô 
‚Ä¢uvJwvxy
6‚Äî

(2.9) 


‚Äù‚Ä¢ 
Àúe
J ‚Ñ¢c
wvxy
Y 
(2.10)
 
where ‚Äù‚Ä¢ is the Fermi potential with respect to the midgap in the substrate, 

 
2.3 Small-Signal Model of MOS Device 
21 
 
 
‚Äò 	 CA ‚Äπ /≈Ω≈°‚Ä∫≈ì is the effective threshold voltage, and ‚Ä¢% is the carrier 
concentration in an intrinsic silicon and equals = ‚Äπ ‚Ä¢≈†/≈Ω at C≈æ≈ì. The 
parameter ‚Äô depends on the technology parameters. For example, in a 0.18-≈† 
CMOS technology with n"V 	 Tc≈† and∆íKM‚Äû 	 C; ‚Äπ ≈í‚Ä¢≈†/≈Ω (2.9) gives 
‚Äô 	 TCd[. In this technology the zero-bias threshold voltage is equal to 
-e 	 T=[ and based on (2.10) we have ‚Äù‚Ä¢ 	 TT[. If there is a potential 
difference of -D‚Ä¢ 	 =[ between source and bulk, with ‚Äô 	 TCd[, the effective 
threshold voltage due to body effect changes to -e 	 ==[ according to (2.8). 
2.2.2 MOS Transistor Operating in Subthreshold Regime 
For   -fD  -e, an MOS device works in weak inversion with the low density 
of free carriers inside the inversion layer under the gate. In this situation, by 
applying a drain-source voltage we will have a current with different nature. Here 
the main cause of current flow is the diffusion effect that occurs due to 
nonuniform distribution of the free carriers inside the inversion layer. In device 
physics contexts [8], it is proven that the drain current follows an exponential 
relationship similar to BJTs as 


W) 	 W F
i
Z G ≈∏
 ¬°k¬¢ ¬£
¬§ ‚Ä∞¬• 
 (2.11) 
 
where W is the reverse saturation current and for an NMOS device is given by 
 

W 	

 hY-q¬¶
 t
uvJwvxy
¬ß¬®
¬©  ≈∏/¬™ :k
¬´¬£ ¬¨
 (2.12)
 
In (2.11) o and p are the transistor channel width and length, respectively. - is 
equal to   #IR "V

 with #IR as the depletion capacitance per unit area and -q¬¶ 
is the thermal voltage. 
2.3 Small-Signal Model of MOS Device 
In the preceding drain current equations, the drain current generally changes as a 
function of the voltages of the drain, substrate, and gate with respect to the source 
(i.e., !)D, !fD, and !D‚Ä¢). 
 

¬Æ) 	 !)DH !fDH !D‚Ä¢
 (2.13)
 
In (2.13) the instantaneous total value of each voltage has been indicated by 
lowercase letters with uppercase subscripts. Supposing the amplitude of the ac 

22 
CMOS Technology and Physics 
 
 
components is small enough in comparison to the bias values, we can write the 
variation of the drain current as a linear combination of the voltage variations 
 
 
3¬Æ) 	
z%:
z
¬°k*
4¬°k
3!fD 
z%:
z
:k*
4:k
3!)D 
z%:
z
k¬®*
4k¬®
3!D‚Ä¢
 (2.14) 
 
The bias quantities are shown by capital letters for both voltage notations and their 
subscripts. All derivatives are calculated at the bias points. The first and last terms 
in (2.14) indicate the influence of gate-source and substrate-source voltage 
variations on the drain current and thus are modeled by two different voltage-
controlled current sources. The second term represents the channel length 
modulation that is modeled as a resistor across the drain-source in the equivalent 
small-signal circuit. Denoting the ac component of each voltage by lowercase 
letters for voltage name and its subscript, the drain current variation around its 
quiescent value can be written in terms of ac components of the gate-source, drain-
source, and bulk-source voltages as  
 
 
¬Æ# 	 X0!¬ØK  X#K!#K  X0‚Äû!K‚Äû 
(2.15) 
 
If the strong inversion state is held and the transistor operates in saturation region, 
using (2.3) we can obtain the transconductance relationship in terms of the 
transistor parameters as 
 
 
X0HKUq 
z%:
z
¬°k*
4¬°k
	 ‚Ä¢ ¬∞W)
 (2.16) 
 
where ¬∞  hY"V o pI

. When the transistor works in the subthreshold we 
should use (2.11) to calculate X0. 
 
 
X0HKM‚Äû 
z%:
z
¬°k*
4¬°k
	
{:
¬±4‚Ä∞¬•
 (2.17)
 
As it is evident from (2.17) the transconductance of the MOS transistor when it 
works in the subthreshold region is independent of its dimensions and controlled 
only by the drain bias current. On the other hand, when the transistor operates in 
saturation, for a certain drain bias current, based on (2.16) by raising the transistor 
aspect ratio (W/L), it is possible to have larger transconductance. In such a 
condition there is an upper limit at which the transistor still continues to operate in 
saturation. At a fixed drain current level of W), when the quantity of Wo p
  in 
(2.11) becomes greater than W), -fD becomes less than -e and thus transistor enters 
the subthreshold region in which the transconductance does not increase anymore 
by raising the transistor sizing. We can get a rough estimation of the onset of 
entering the subthreshold regime by equating the MOS transconductance 

 
2.3 Small-Signal Model of MOS Device 
23 
 
corresponding to two regions to arrive at the following relationship 
 
 
{:
F¬≤
¬≥ G
	  h"V--q¬¶
 (2.18)
 
where o p
  is the transistor size for that (2.16) and (2.17) are equal. Equation 
(2.18) gives a rough criterion to find the correct MOS operating area in terms of 
the given process parameters. At a certain dc drain current, when we have 
o p
   o p
 , an MOS device enters the subthreshold region that is 
equivalent to the transition from the strong inversion to the weak inversion state. 
In reality, this transition does not happen sharply but the transistor passes through 
a moderate inversion state. Bearing this point in mind, the ratio of W)o p
  
should be by far less than  h"V--q¬¶ in order to be sure that the transistor 
works in the subthreshold region. At the same drain current level if a PMOS 
transistor is supposed to operate in the subthreshold region it needs to have a 
larger aspect ratio by the factor of hYhR, compared to its NMOS counterpart. 
This means that in the similar condition from current and sizing standpoints, 
NMOS devices usually enter the subthreshold prior to PMOS transistors. The 
condition given by (2.18) is independent of the drain current or transistor sizing 
and just depends on the technology parameters. For instance, consider a 0.25-≈† 
CMOS technology in which for an NMOS device we have hY 	 C= ‚Ä¢≈† ¬¥ ]

, 
"V 	 <T ‚Äπ /≈í ¬µ ‚Ä¢≈†

, and -  T. By substituting the given data into (2.18), 
we can see if the left-side term (i.e., the normalized drain current to the device 
aspect ratio) is adequately less than <\¬∂, the NMOS will enter the subthreshold 
region. As a numerical example, an NMOS transistor with the drain current of 
\¬∂ and aspect ratio of o p

	  operates in the subthreshold regime. 
The drain-source dynamic conductance X#K is given by X#K 	 |W) and X0‚Äû 
that shows the effect of source-bulk voltage variation on the drain current can be 
determined by substituting (2.8) in (2.3) and differentiating the drain current with 
respect to the source-bulk voltage around the bias point. 
 
 
X0‚Äû 
z%:
z
k¬®*
4k¬®
	
z%:
z4¬£
z4¬£
z
k¬®
 (2.19)
 
From 
(2.3), 
we 
have 
¬∑¬Æ) ¬∑-e 	 X0

 
and 
from 
(2.8) 
we 
get 
¬∑-e ¬∑!D‚Ä¢ 	 ‚Äô  ‚Ä¢-D‚Ä¢   ‚Äù‚Ä¢


 and thus  
 
 
X0‚Äû 	 
¬∏¬Ø5
‚Ä¢4k¬®¬ß¬®
 (2.20)
 
The negative sign in (2.20) indicates the drain current drops for the nonzero source 
to bulk potential. This is because the effective threshold voltage rises due to the 
body effect. 

24 
CMOS Technology and Physics 
 
 
Based on the obtained parameters for an MOS transistor, the low-frequency 
small-signal equivalent circuit for such device is obtained as shown in Figure 2.5. 
The derived small-signal circuit is valid at low-frequency. For adequate high 
frequencies, we need to consider the effect of internal MOS capacitances. 
Generally there are five main capacitances that should be inserted inside the circuit 
of Figure 2.5. Three out of five of these capacitances are the capacitances that are 
formed between gate and three other terminals (i.e., drain, source, and bulk) and 
the latter two are associated with the junction capacitance of the drain and source 
area with the substrate. In the following section, we will deal with each 
capacitance and study its behavior in different operation areas of the MOS 
transistor. 
2.3.1 Gate to Substrate Capacitance 
In the NMOS structure illustrated in Figure 2.6, the gate voltage drops across the 
oxide and the surface of the semiconductor. In MOS physics contexts it is shown 
 
Figure  2.5 Low-frequency small-signal MOS device equivalent circuit. 
 
Figure  2.6 NMOS device structure. 
gmvgs
|gmb|vsb
gds
D
G
S
B
+
-
vsb 
+
-
vgs
id
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
S
G
D
p_substrate
L1
wd
n+
n+
Lov

 
2.3 Small-Signal Model of MOS Device 
25 
 
that the created electric charge at the surface, denoted by gD, changes with the 
surface potential ‚ÄùK, as depicted in Figure 2.7 [8]. The gate to substrate 
capacitance consists of the series connection of the gate oxide capacitance and the 
semiconductor capacitance at the surface of the silicon. For ‚ÄùD   corresponding 
to negative gate-source voltage, the transistor operates in accumulation mode in 
which the surface charge is an exponential function of the surface potential ‚ÄùD and 
thus the semiconductor capacitance K$ 	 ¬∑¬πgD¬π ¬∑‚ÄùK

 is much greater than the 
gate oxide capacitance. This results in the total capacitance between the gate, and 
the substrate almost becomes ¬Ø‚Äû  op"V in which p is the channel length 
without the overlap length ofp"
, as indicated in Figure 2.6. 
For   -fD  -e, the surface potential varies between   ‚ÄùD   ‚Äù‚Ä¢ and 
the depletion negative ion charges underneath the gate form the main part of gD. In 
this situation, ¬Ø‚Äû is the series combination of "V and #IR 	 mK o#

 with o# as 
the depth of the depletion layer under the gate, as shown in Figure 2.6. When -fD 
goes up before it reaches -e, o# increases and thus #IR decreases, which results 
in lowering ¬Ø‚Äû. For -fD  -e, in the event that the transistor works in the triode 
region, an inversion layer of free electrons extends from the source to drain at the 
surface to form a capacitor in which one electrode is the gate and the other one 
consists of the n-type regions including source, drain, and inversion layer. As 
discussed later, this capacitance is split up equally between the source and drain 
that forms a part of the gate to the source/drain capacitance. In the triode region, 
¬Ø‚Äû is a very small capacitance that is only related to a part of the gate polysilicon 
that overlays on the field oxide. When the transistor works in saturation there is a 
 
Figure  2.7 Electric charge vs. surface potential in an NMOS device. 
0
œàs
|Qs|
-0.4 -0.2
0.2
0.4 0.6 0.8
Depletion
Accumulation
Weak Inv
strong Inv
2œàB
Electric Charge
Surface Potential

26 
CMOS Technology and Physics 
 
 
depletion area near the drain junction so that it creates a partial depletion 
capacitance at the surface of the semiconductor at the drain side, as depicted in 
Figure 2.8. Hence, the total ¬Ø‚Äû capacitance in saturation will be 
 
 
¬Ø‚Äû 	

≈Ω op
6‚Äî6+rQ4+y
6‚Äî6+rQ4+y
 (2.21)
 
where #IR-#‚Äû is the drain-side depletion capacitance at the reverse voltage -#‚Äû. 
In (2.21) the coefficient of 1/3 appears because in saturation it can be proven that 
the total charge under the gate is given by [8] 
 
 
g$¬¶ 	

≈Ω op"V-fD  -e
 (2.22)
 
Comparing (2.22) with the same relationship for the charge in the triode region 
(i.e., g$¬¶ 	 op"V-fD  -e) we can deduce that the effective channel length 
containing the inversion charge is two-thirds of the total length and one-third 
forms the depletion area near the drain junction; thus, one-third of #IR becomes a 
series connected with one-third of the gate oxide capacitance forming (2.21). 
2.3.2 Gate to Source/Drain Capacitance 
Here we introduce the gate to the source/drain capacitance of an NMOS device in 
different operation areas. When the transistor is off there is no free carriers under 
the gate and the only significant capacitance between the gate and source/drain is 
due to the overlap between the gate electrode and the source/drain diffusion area. 
The overlap is made because of lateral diffusion of the source/drain region in the 
annealing phase of the fabrication process. From Figure 2.6 the overlap gate to 
source/drain capacitance is given by 
 
 
Figure  2.8 NMOS device structure in saturation. 
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
S
G
D
p_substrate
n+
n+
-
-
-
-
-
-
-
-
-
-
-
- -
-
-
-
-
-
-- -
--
-
- - -
-
-
-
-
-
-
depletion area
inversion layer

 
2.3 Small-Signal Model of MOS Device 
27 
 
 
fD 	 p"
o"V
 (2.23) 

where p"
 is the overlap length that depends on the used technology. In fact the 
quantity p"
"V  fD"
 is determined by the technology and because of the 
symmetrical structure of the MOS device, it is almost the same for both the source 
and drain areas. In practice, the thickness of the polysilicon gate is much greater 
than that of both the gate oxide thickness and overlap length so that the fringing 
capacitance due to the fringing field lines is remarkable. This shows that the value 
of the gate to the source/drain overlap capacitance should be larger than that given 
in (2.23). When the transistor works in the triode, as discussed earlier, there is a 
common capacitance between the gate and three of the same n-type areas of 
source, drain, and inversion layer. This capacitance is divided equally between the 
source and drain regions with the value of =op"V. Thus the total gate-source 
and gate-drain capacitance in the triode region will be 
 
 
¬ØK 	 ¬Ø# 	 o"V

 p  p"

 (2.24)
 
The gate-source capacitance in the saturation region can be derived by 
differentiating (2.22) versus -fD and adding the fixed gate overlap capacitance 
fD to it 
 
 
¬ØK 	 o"V

≈Ω p  p"

 (2.25)
 
The gate overlap of the drain is the only capacitance between the drain and gate in 
the saturation region so that we have ¬Ø# 	 o"Vp"
. Although ¬Ø# is small in 
saturation, in a common-source amplifier its effect on the circuit frequency 
response is significant because of the Miller effect [7]. 
2.3.3 Source/Drain to Bulk Capacitance 
The capacitance between the source/drain and bulk depends on the operating 
region of the device. For -fD  -e, the device is off and thus this capacitance is 
actually the junction capacitance of the source/drain regions with the MOS body. 
In this case the junction capacitance itself consists of two components. One is 
related to the bottom part of the junction and the other is the sidewall junction 
capacitance. 
 
 
K#‚Äû 	 D)¬∫  ND)¬∫K‚Ä¢ 
 (2.26)
 
D) 	 opD) is the source (drain) area with pD) as the source (drain) region 
physical length, ND) 	  o  pD) is the periphery of the source (drain), 
¬∫ 	 mK ¬ª#

 is the capacitance per unit area at the bottom of the source (drain) area 

28 
CMOS Technology and Physics 
 
 
and ¬∫K‚Ä¢  is the capacitance per unit length of the junction sidewalls. 
¬ª# 	 t mK ‚Äö∆íKM‚Äû-‚Äû%  -D)‚Ä¢

 is the depletion width of the source (drain) to 
the bulk junction and -‚Äû% is the built-in potential of the junction. For -fD  -e 
when the NMOS device works in the triode region, as mentioned earlier, an 
inversion layer consisting of free electron carriers connects two ‚Ä¢ source and 
drain regions together. In this situation, the capacitance of the depletion region 
under the gate as a parallel capacitance will be added to the junction capacitances 
given by (2.26). Figure 2.9 helps to make clear the contribution of the channel 
depletion capacitance. The depletion capacitance op# with # 	 mK o#

 is 
equally split up between drain and source junction capacitances and thus the total 
K#‚Äû is given by 
 
 
K#‚Äû 	 D)¬∫  ND)
¬º
¬∫K‚Ä¢ 

 op#
 (2.27)
 
o# 	 t mK ‚Äö∆íKM‚Äû ‚Äù‚Ä¢  -D)‚Ä¢

 is the width of the depletion region under the 
gate for -)D  . Supposing -‚Äû%   ‚Äù‚Ä¢, we can conclude ¬ª#  o# and thus we 
have ¬∫  #. In (2.27) the source (drain) periphery has been modified as 
ND)

	 o   pD) in which one side of the source (drain) area adjacent to the 
inversion layer is omitted from the perimeter calculation because the source 
(drain) diffusion area and inversion layer are the same type at this area and there is 
no PN junction at that place. For -fD  -e and if the device works in the 
saturation region, two-thirds of the depletion capacitance is added to the source 
junction capacitance such that the total source to bulk capacitance will be 
 
 
K‚Äû 	 D¬∫  ND
¬º¬∫K‚Ä¢ 

≈Ω op#
 (2.28)
 
 
Figure  2.9 Capacitance of source/drain to bulk junction and channel depletion capacitance. 
n+
n+
D
G
S
p_substrate
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
--
inv. layer Cd
Cj
Cjsw
-
-
-
-
-
-
-
-
-
-
-
-
--
--
-
-
- -
-
-
-
--
--
--
-
-
-
-
-
- -
--
-
-
-
-
-
- -
LS
LD
Wd
-
- -
-
-
-
--
--
--
-
-
-
-
-
- - -
-
- -
-
- -
depletion
layer

 
2.3 Small-Signal Model of MOS Device 
29 
 
At the drain side, we have only the drain junction capacitance according to the 
relationship given by (2.26) in which ¬∫ and ¬∫K‚Ä¢  should be calculated at the drain-
to-bulk bias voltage. The main capacitances formed between the gate and three 
other terminals in an MOS device (i.e.,¬Ø‚Äû, ¬ØK, and ¬Ø#) in different operating 
regions of the device are plotted in Figure 2.10. The small-signal model of an 
MOS device including the main device parasitic capacitances is illustrated in 
Figure 2.11. This model is usually used to analyze MOS circuits in high 
frequencies. 
One important high-frequency parameter that indicates the merit of a 
transistor for high-frequency applications is known as transition frequency, which 
is denoted by Le and defined as a frequency at which the current gain of the 
device becomes unity. In order to find the Le for an MOS device, we obtain its 
current gain when the transistor is used in a common-source configuration, as 
depicted in Figure 2.12. Summing all currents at the drain node, we get 
 
 
Figure  2.10 Plot of main MOS capacitances in different operating regions. 
 
Figure  2.11 High-frequency small-signal model of an MOS device. 
off
saturation
triode
Cgb
Cgs
0.5WL1Cox
0.67WL1Cox
WL1Cox
Cgd
VT
VT+VDS,sat
VGS
Capacitance
 Voltage
0
+
-
Csb
vsb
gmvgs
|gmb|vsb
gds
Cgd
Cgs
+
vgs
-
Cgb
G
B
S
D
Cdb

30 
CMOS Technology and Physics 
 
 
 
¬Æ# 	 X0  ¬Ω¬Ø#!
 (2.29) 
 
Since ¬Æ¬Ø 	 ¬Ω¬Ø! with¬Ø  ¬Ø‚Äû  ¬ØK  ¬Ø#, the current gain defined as 
¬æ  ¬Æ# ¬Æ¬Ø
  is obtained 
 
 
¬æ 	
¬Ø5/K6¬ø+
K6¬ø

 (2.30) 
 
In the frequency domain, Le is defined as a frequency at which the magnitude of 
the current gain is equal to unity (¬π¬æ√ÄLe¬π 	 ). Thus from (2.30) we have 
 
 
Le 	
¬Ø5
6¬ø

√Å/¬©
√Ç¬ø+
√Ç¬ø ¬¨
2
 (2.31) 
 
In practice ¬Ø# ‚Ä¶ ¬Ø and ¬Ø  ¬ØK so we can arrive at a simple relationship of 
Le 	 X0 ¬ØK

. Assuming the square law is held for the device, we substitute the 
values of X0 and ¬ØK into the Le relationship to obtain Le for an NMOS transistor 
as follows 
 
 
Le 
≈Ω√É√Ñ

4¬°k/4¬£
Z2

(2.32) 
 
As it is obvious from (2.32) by scaling down the technology dimensions, the 
transistor transition frequency increases as a quadratic function of the device 
channel length. For a particular technology the bias condition also affects Le 
through the overdrive voltage of the device. Based on (2.32), for the same biasing 
condition in a given CMOS technology, NMOS transistors have better frequency 
response in comparison to their PMOS counterpart. This is because of the higher 
electron mobility in NMOS transistors. 
 
Figure  2.12 Circuit used to calculate MOS transition frequency. 
VDS
+-
-
iD
ig
vG
gmv
Cgb
Cgs
+
-
v
Cgd
id

 
2.4 Conclusion 
31
 
 
 
 
2.4 Conclusion 
Familiarity with the basic fabrication process of MOS transistors can significantly 
help to give more practical insight about circuit design in CMOS technology. In 
this chapter, we first briefly introduced the fundamental steps involved in the 
fabrication of two NMOS and PMOS transistors. Then the MOS drain current 
relationships and some physical aspects of the device were briefly discussed. 
Different operation regions of an MOS device including triode, saturation and 
subthreshold, and their corresponding drain current relationships were introduced. 
Since the nature of the formation drain current in saturation and subthreshold 
region is totally different with completely distinct current equations, we derived a 
relation that can be used as an index to distinguish the correct operating region of 
the device. This greatly helps the designer to employ true relationships to calculate 
the device parameters. Based on concepts of device physics and the given 
relations, the small-signal equivalent circuit for both NMOS and PMOS transistors 
in low and high frequencies were developed.  
 
References 
[1] Franssila, S., Introduction to Microfabrication, John Wiley & Sons, 2010. 
[2] May, G. S., and Spanos, C. J., Fundamentals of Semiconductor Manufacturing and Process 
Control, John Wiley & Sons, 2006. 
[3] El-Kareh, B., Fundamentals of Semiconductor Processing Technology, Kluwer Academic 
Publishers, 1995. 
[4] Bagad, V. S., Fundamentals of CMOS VLSI, Technical Publications, Pune, India, 2009. 
[5] Chang, C. Y., and Sze, S. M., ULSI Technology, McGraw-Hill, 1996. 
[6] Muller, R. S., and Kamins, T. I., with Chan, M., Device Electronics for Integrated Circuits, Third 
Edition, John Wiley & Sons, 2003.  
[7] Gray, P. R., Hurst, P. J., Lewis, S. H. and Meyer, R. G., Analysis and Design of Analog 
Integrated Circuits, Fourth Edition, John Wiley & Sons, Inc., 2001. 
[8] Sze, S. M., Ng, K. K., Physics of Semiconductor Devices, Third Edition, Hoboken, New Jersey, 
John Wiley & Sons, Inc., 2007. 

 
 
 
 
 

 
 
 
33 
Chapter 3 
CMOS Differential Amplifiers 
As its name suggests, in a differential amplifier the output signal generally is the 
amplified version of the difference of two inputs of the amplifier. Because of the 
exclusive properties of this type of amplifier, it is considered as one of the most 
important building blocks in many analog circuits. In this chapter, we first analyze 
a source-coupled circuit as a differential voltage-to-current converter and then deal 
with the CMOS differential amplifier in which a current mirror circuit is employed 
as an active load for the source-coupled pair. This amplifier is regarded as an 
integral part at the input of most single-ended output operational amplifiers so that 
many properties of an op amp depend on the parameters of this block. We study 
the large-signal characteristics of this amplifier in detail. Offset voltage, frequency 
response, and noise behavior of the amplifier are the subjects for the rest of this 
chapter. 
3.1 Source-Coupled Differential Pair Characteristic 
In the differential pair shown in Figure 3.1, it is assumed that M1 and M2 are 
exactly the same and both operate in saturation. Furthermore, the channel length 
modulation effect is ignored and it is presumed that the drain current of each 
 
Figure  3.1 Differential pair amplifier. 
iD1
iD2
I0
+
-
vi
M1
M2

34 
CMOS Differential Amplifiers 
 
device follows a quadratic relationship. Thus the gate-source voltage of M1 and 
M2 can be written as 
 
!fDH 	 -e  t
%:√ÖH2
√Ü 
(3.1) 
 
where ¬∞ 	 hY"Vo p
 H. hY is the free electrons mobility, "V is the gate 
capacitance per unit area, and o and p are the channel width and length of M1 
and M2, respectively. Since !% 	 !fD  !fD, from (3.1) we have 
 
 
‚Ä¢¬Æ)  ‚Ä¢¬Æ) 	 t
√Ü
 !%
 (3.2) 
 
Summing drain currents at the common node of sources gives ¬Æ)  ¬Æ) 	 W, 
which yields 
 
 
‚Äú‚Ä¢¬Æ)  ‚Ä¢¬Æ)‚Äì
   ‚Ä¢¬Æ)‚Ä¢¬Æ) 	 W
 (3.3) 
 
Substituting (3.2) into (3.3), we get  
 
 
 ‚Ä¢¬Æ)‚Ä¢¬Æ) 	 W 
√Ü
 !%

 (3.4) 
 
Since ‚Äú‚Ä¢¬Æ)  ‚Ä¢¬Æ)‚Äì
 	 W   ‚Ä¢¬Æ)‚Ä¢¬Æ) , from (3.4) we obtain 
 
 
‚Ä¢¬Æ)  ‚Ä¢¬Æ)	t W 
√Ü
 !%

 (3.5) 
 
The multiplication of (3.5) by (3.2) gives the differential current ¬Æ"Mq in terms of 
the differential input voltage 
 
 
¬Æ"Mq 	 ¬Æ)  ¬Æ) 	 ‚Ä¢¬∞W!%t 
√Ü

2
√á{ 
 (3.6) 
 
Thus the drain current of each MOS transistor is obtained as  
 
 
¬Æ) 	
{
  ‚Ä¢¬∞Wt 
√Ü

2
√á{



 (3.7) 
 
 
¬Æ) 	
{
  ‚Ä¢¬∞Wt 
√Ü

2
√á{



(3.8) 
 
The plot of each drain current of the differential pair is illustrated in Figure 3.2. 

 
3.1 Source-Coupled Differential Pair Characteristic 
35 
 
 
 
We see that for ‚Ä¢ W ¬∞

 !%  ‚Ä¢ W ¬∞
  both transistors conduct and when !% 
goes beyond this range one of the two transistors, M1 or M2, turns off and the 
entire tail current W is steered toward the other transistor. The large-signal 
characteristic of the differential output current in terms of the differential input 
variation based on (3.6) is plotted in Figure 3.3. As it can be seen, ¬Æ"Mq is an odd 
function of !%. This means that for a large sinusoidal input voltage, the differential 
output current contains only odd harmonics of the input signal frequency. Taking 
the derivative of (3.6) versus !%, we can find the incremental transconductance of 
the differential pair versus the differential input voltage 
 
 
√à0!% 	
z%x‚Ä∞
z
 	 ‚Ä¢¬∞W
/
√âS
2
2√ä
√Å/
√âS
2
√ã√ä
 t
{
√Ü  !%  t
{
√Ü  
(3.9) 
 
It is clear that the differential pair transconductance generally changes as an even 
 
Figure  3.2 Differential pair drain currents versus differential input voltage. 
 
Figure  3.3 Differential output current versus differential input voltage. 
0.5I0
I0
vi
0
iD1
iD2
2I0
Œ≤
-
2I0
Œ≤
+I0
vi
0
2I0
Œ≤
-
iout
2I0
Œ≤
-I0

36 
CMOS Differential Amplifiers 
 
function of the input signal and its small-signal value for !% ‚Ä¶ ‚Ä¢ W ¬∞
  becomes 
‚Ä¢¬∞W.
3.2 CMOS Differential Amplifier with Active Load 
A single-ended output differential amplifier can be implemented by putting a 
PMOS current mirror on top of the circuit of Figure 3.1 as illustrated in Figure 3.4 
[1]. In this circuit, (M1, M2) and also (M3, M4) are mutually identical with each 
other and thus the tail current W is equally divided between M1 (M3) and M2 
(M4) in the absence of differential input voltage. In this situation because of the 
circuit symmetry, the dc voltage level at the drain of M1 and M2 is the same and 
equals to 
 
-"#$ 	 -))  √å-eR√å  t
{
√ÜQ
 (3.10) 
 
where ¬∞R 	 hR"Vo p
 ≈ΩH√á. hR is the hole carriers mobility and o p
 ≈ΩH√á is the 
M3 and M4 aspect ratio. 
3.2.1 Large-Signal Characteristic of CMOS Differential Amplifier 
When an ac differential input voltage is superimposed on the bias common mode 
voltage the drain current in M1 and M2 will change around its static value of W  
in the opposite direction.  
In the differential amplifier shown in Figure 3.5 for variation of !% in the 
 
Figure  3.4 Single-ended output differential amplifier in dc state. 

 
3.2 CMOS Differential Amplifier with Active Load 
37 
 
 
range of ‚Ä¢ W ¬∞

 !%  ‚Ä¢ W ¬∞
 , the drain current of M1 and M2 is 
determined based on (3.7) and (3.8). When !% rises, due to the positive voltage 
gain of the amplifier, the output voltage with a steep positive slope goes up and 
M4 quickly approaches the triode region where the voltage gain starts dropping. 
This occurs for a rather low positive change in !%. After M4 enters the triode 
region, with more increase in !%, the output voltage !" continues to rise with a 
lower rate. At the same time the tail current steers toward M1 and the current of 
M2 and M4 approaches zero. 
When differential input voltage reaches ‚Ä¢ W ¬∞
 , the entire tail current flows 
through M1 and thus M2 turns off. At this point, M4 is in triode with zero drain 
current, which means the drain-source voltage of M4 is zero and thus the output 
voltage is fixed on [√ç√ç. When input voltage changes in the negative direction, the 
output voltage rapidly drops again due to the differential amplifier voltage gain 
and this time M2 goes to the triode region. As long as the tail transistor operates in 
saturation, M5 acts as a current source, and M3 with a diode connection structure 
always remains in saturation. On the other hand, if the source-to-drain voltage of 
M4 is more than -D)HKUq, it will operate in saturation and the current mirror 
consisting of M3 and M4 forces M1 and M2 to have the same current even though 
M2 is in triode and therefore the drain currents of M1 and M2 remain on W . For 
large negative differential input voltage the tail transistor ultimately enters the 
triode region where the tail current starts decreasing with the input. As a result, the 
 
Figure  3.5 Differential amplifier with differential input. 
Vcm
+
-
M1
M2
M3
M4
vo
VDD
+
-
+
-
+vi/2
-vi/2
VB
M5
I0

38 
CMOS Differential Amplifiers 
 
drain currents of M1 and M2 also decrease in parallel with each other. The drain 
currents of M1 and M2 versus the differential input voltage variation are plotted in 
Figure 3.6. The large-signal characteristic of the CMOS differential amplifier with 
a current mirror load is depicted in Figure 3.7.  
3.2.2 Offset Voltage of CMOS Differential Amplifier 
In a single-ended output differential pair that has perfect symmetry when two 
inputs are the same, the output voltage places on -))  -Df≈Ω, as illustrated in 
Figure 3.7. In practice, due to different mismatches in the circuit, the output dc 
voltage has a different value from the ideal case. In this situation we have to apply 
a differential voltage to the input in order to put the output back on -))  -Df≈Ω. In 
such a case the applied differential input voltage is called the input-referred dc 
offset voltage [2]. In the circuit of Figure 3.8 we can write 
 
 
-√éD 	 -fD  -fD
 (3.11) 
 
To obtain an analytic relationship for -√éD, first we define average and 
difference quantities for the circuit parameters as below 
 
Figure  3.6 Variations of differential amplifier drain currents versus input. 
 
Figure  3.7 Large-signal characteristic of differential amplifier. 
vi
0
2I0
Œ≤
0.5I0
I0
iD1
iD2
vo
vi
VDD-VSG3
VDD
0
2I0
Œ≤
High Gain
Area

 
3.2 CMOS Differential Amplifier with Active Load 
39 
 
 
 
-eY 
4¬£√Ñ√Ö4¬£√Ñ2


 (3.12) 
 
 
3-eY  -eY  -eY
 (3.13) 
 
 
W) 
{:√Ö{:2


 (3.14) 
 
 
3W)  W)  W)
 (3.15) 
 
 
¬∞Y 
√Ü√Ñ√Ö√Ü√Ñ2


 (3.16) 
 
 
3¬∞Y  ¬∞Y  ¬∞Y
 (3.17) 
 
Since -fDH 	 -eYH  t W)H ¬∞YH

, by substituting the above expressions into 
(3.11), we have 
 
-√éD 	 3-eY  t
{:
√Ü√Ñ √è√Å
3√ä:
2√ä:
3√â√Ñ
2√â√Ñ
 √Å
/3√ä:
2√ä:
/3√â√Ñ
2√â√Ñ
√ê
(3.18) 
 
After some manipulations on (3.18) and neglecting higher-order terms, we get 
 
 
-√éD 	 3-eY 

 t
{:
√Ü√Ñ F
3{:
{: 
3√Ü√Ñ
√Ü√Ñ G
(3.19) 
 
In the current mirror active load we have -Df≈Ω 	 -Df√á  -DfR and thus  
 
 
W)≈Ω 	 W) 	
√ÜQ√ë
 ‚Äú-DfR  √å-eR≈Ω√å‚Äì

 (3.20) 
 
Figure  3.8 Differential amplifier with input offset voltage. 
I0
M1
M2
M3
M4
Vo
VDD
+‚àí
ID1
ID2
VOS

40 
CMOS Differential Amplifiers 
 
 
W)√á 	 W) 	
√ÜQ√ã
 ‚Äú-DfR  √å-eR√á√å‚Äì

 (3.21) 
 
Again we define average and difference quantities for the current mirror circuit 
parameters as follows: 
 
 
√å-eR√å 
√å4¬£Q√ë√å√å4¬£Q√ã√å


 (3.22) 
 
 
3-eR  √å-eR≈Ω√å  √å-eR√á√å
 (3.23) 
 
 
¬∞R 
√ÜQ√ë√ÜQ√ã


 (3.24) 
 
 
3¬∞R  ¬∞R≈Ω  ¬∞R√á
 (3.25) 
 
By substituting the above quantities into (3.20) and (3.21) and neglecting higher-
order terms, we can obtain the approximate expressions for the drain currents of 
M3 and M4 as 
 
 
W)≈Ω ‚Ä† W) ¬© 
3√ÜQ
√ÜQ 
34¬£Q
4k¬°Q/√å4¬£Q√å¬¨
 (3.26) 
 
 
W)√á ‚Ä† W) ¬© 
3√ÜQ
√ÜQ 
34¬£Q
4k¬°Q/√å4¬£Q√å¬¨
 (3.27) 
 
with 3W) 	 W)≈Ω  W)√á, from (3.26) and (3.27), we can obtain 3W)W) 
 
 
3{:
{: 	
3√ÜQ
√ÜQ 
34¬£Q
4k¬°Q/√å4¬£Q√å
 (3.28) 
 
Now we substitute (3.28) into (3.19) and use -DfR  √å-eR√å 	 ‚Ä¢ W) ¬∞R

 to reach 
 
 
-√éD 	 3-eY 

 t
{:
√Ü√Ñ ¬©
3√ÜQ
√ÜQ 
3√Ü√Ñ
√Ü√Ñ ¬¨  t
√ÜQ
√Ü√Ñ 3-eR
 (3.29) 
 
where ¬∞YHR 	 hYHR"Vo p
 YHR. Mismatch in the size of two pairs of NMOS and 
PMOS devices and also mismatch due to the difference in the gate oxide thickness 
of devices represents itself as a mismatch in "V; all of them have been 
summarized in two terms 3¬∞R ¬∞R

 and 3¬∞Y ¬∞Y

 in (3.29). It is obvious from (3.29) 
that any threshold voltage mismatch in the input transistors M1 and M2 directly 
appears in the input-referred dc offset voltage. This fact proves how significant it 
is to have symmetrical devices at the input. In a careful design in order to achieve 
maximum symmetry for M1 and M2 in the layout design, each transistor is split 

 
3.2 CMOS Differential Amplifier with Active Load 
41 
 
 
into two identical parts and diagonally connected together, as illustrated in Figure 
3.9. This technique is called common centroid, which makes M1 and M2 immune 
from cross-chip gradients in the oxide thickness and doping and provides the best 
matching performance for the circuit [3-5]. The price paid for that is to impose 
more complexity on doing the layout. The common centroid technique helps to 
evenly distribute the threshold voltage mismatches between two transistors that 
leads to nearly zero average for 3-e. The absolute statistical variation of threshold 
voltage is determined by the gate area as 
 
 
@4¬£ 	
 ¬£
diZ
 (3.30) 
 
where 4e is the threshold proportionality factor and depends on the technology 
used. It is shown that it has a roughly linear relationship with the gate oxide 
thickness [6]. From (3.30), minimum random variation in threshold voltage is 
achievable by taking the maximum possible value for the MOS gate area. As 
discussed later, choosing a large gate area helps to reduce the effect of the flicker 
noise as well. From (3.29) it can be seen that any mismatch error in the parameters 
of ¬∞Y and ¬∞R appears in the offset voltage by a weighting factor of the overdrive 
voltage of the input transistors. Thus in a low-offset design we need to minimize 
the input MOS device overdrive voltage. On the other hand, a small overdrive 
voltage for input MOS devices results in a lower linear operating range of the 
differential pair. This is a contradictory situation in a design that simultaneously 
requires a low offset voltage and high linear operating range. Another interesting 
point that can be deduced from (3.29) is that 3-eR as the mismatch of the load 
transistors appears in the input offset voltage by a weighting factor of ‚Ä¢¬∞R ¬∞Y

. So 
minimizing this ratio can also help to reduce the total offset voltage. Moreover, as 
will be shown later, a small ¬∞R ¬∞Y

 reduces the input-referred noise due to M3 and 
M4. Every measure taken to reduce 3-eY in doing the layout for the input device 
is applicable to 3-eR in the load transistors as well.  
 
Figure  3.9 Common-centroid technique for better matching performance. 
M1a
M2a
M1b
M2b

42 
CMOS Differential Amplifiers 
 
3.3 Common-Mode Behavior of CMOS Differential Amplifier 
What has made a differential amplifier an important building block in analog 
systems is its capability to amplify the differential changes at its input in the 
presence of a large common-mode voltage. In an ideal differential amplifier we 
expect that the amplifier output just changes in response to the differential part of 
its input and any change in the input common mode does not impact on the output 
voltage. This capability can provide a good immunity for the circuit against the 
existing common mode noise and as a result raise the circuit performance, 
especially in a noisy environment. In practice, the output of a differential amplifier 
consists of the amplified voltage of both differential and common-mode parts of 
the input 
 
!" 	 #0!%#  $0!%$
(3.31) 
 
 
where #0 and $0 express the amount of contribution of differential and 
common-mode components at the output, respectively. In a good differential 
amplifier the common-mode voltage gain of $0 is normally much less than the 
differential voltage gain of #0. In order to quantify the performance of a 
differential amplifier in rejecting the input common mode variations, a parameter 
called common-mode rejection ratio (CMRR) is defined as 
 
 
& ''  *
+5
,5*
(3.32) 
 
To see what parameters of the amplifier can considerably affect $0, we replace 
the small-signal equivalent circuit for the amplifier of Figure 3.5, as illustrated in 
Figure 3.10. In this circuit only the common-mode component of the input has 
been considered and both body effect and ac output resistance of M1 and M2 are 
neglected. 'q is the equivalent output resistance of the tail current source. 
Summing voltages around the loop containing the input voltage 3-%$, gate-source 
voltage of M1 or M2 and potential across 'q, we obtain 
 
 
3-%$ 	 !  X0  X0'q!
 (3.33) 
 
Summing currents at the output node, we have 
 
 
X0≈Ω!≈Ω  X0! 

.√ã 	 
 (3.34) 

Noting that !≈Ω 	 √í"≈Ω √ì X0≈ΩX0! and using (3.33) and (3.34), we can 
obtain the common-mode gain as 

 
3.4 CMOS Differential Amplifier Frequency Response 
43 
 
 
 
$0 	


34, 	
¬Ø5√Ö/¬Ø52.√ë/¬ø52
¬ø5√ë
√î¬Ø5√Ö¬Ø528‚Ä∞√ïF.√ë
√Ö
¬ø5√ëG √í"√á
 (3.35) 
 
Assuming √í"≈Ω  X0≈Ω and√í"≈Ω ‚Ä† √í"√á, we can approximate (3.35) as  
 
 
$0 	
¬Ø5√Ö/¬Ø52.√ë/¬ø52
¬ø5√ë
¬Ø5√Ö¬Ø528‚Ä∞ 
 (3.36) 
 
From (3.36) we see the mismatch between M1 and M2 (X0 √ñ X0) and the finite 
output resistance of the tail current source 'q are two main reasons that cause the 
differential amplifier to have a nonzero common-mode voltage gain. In order to 
improve the CMRR parameter the matching between the input transistors is 
important. In addition, the circuit used to implement the tail current source should 
provide enough large output resistance (high'q). 
3.4 CMOS Differential Amplifier Frequency Response 
The study of the behavior of both differential and common-mode voltage gains 
(#0 and $0) of a differential amplifier in the frequency domain is important. 
Indeed, the first shows how fast the amplifier is able to follow the rapid changes in 
the input differential signal and the second provides a figure of merit for the 
 
Figure  3.10 Small-signal equivalent circuit of differential amplifier for calculating common-mode
voltage gain. 
+
-
v
‚àÜVic
Rt
gm1v
gm2v
ro3||(1/gm3)
+
-
v3
+
-
vo
ro4
gm4v3
‚àÜVic

44 
CMOS Differential Amplifiers 
 
amplifier about its capability to attenuate high-frequency disturbance signals that 
appear at the input as common-mode noise. To simplify the frequency analysis we 
consider only two main internal capacitances of the circuit that form two largest 
time constants at their corresponding nodes. Figure 3.11 shows a differential 
amplifier where  represents the gate capacitance of the current mirror load and 
‚Ä¢ is the total capacitance including the load capacitance at the output node. 
The equivalent resistance seen at node A is rather small (X0≈Ω) but its 
parasitic capacitance  that mainly consists of the gate-source capacitance of M3 
and M4 could be considerable in such a way that its corresponding time constant is 
noticeable. The high resistance at the output and the equivalent capacitance at this 
node create the dominant time constant of the circuit at this node. The high-
frequency small-signal equivalent circuit of Figure 3.11 is depicted in Figure 3.12 
in which we have ignored the body effect in M1 and M2 and also neglected the 
output resistance of the tail current. It is also assumed that two pairs of (M1, M2) 
and (M3, M4) are mutually symmetrical. The transconductance and output 
resistance for NMOS devices are denoted by X0w and √í"w, respectively, and those 
of PMOS devices by X0√ó and √í"√ó. Before writing the required equations to obtain 
the circuit transfer function, first we replace the indicated lower-part of the circuit 
with its Thevenin equivalent circuit. This can be done by replacing the two 
voltage-controlled current sources by their Thevenin equivalent circuits as 
illustrated in Figure 3.13. The equivalent Thevenin voltage and resistance are 
-q 	 X0w√í"w-  - 	 X0w√í"w-% and 'q 	  √í"w, respectively. By replacing the 
lower-part circuit in Figure 3.12 with the Thevenin equivalent circuit, we get a 
simplified form of the small-signal equivalent circuit shown in Figure 3.14 where 
√ò 	 X0√ó  ¬Ω and √ò‚Ä¢ 	 √í"√ó  √í"√ó‚Ä¢¬Ω are the impedances obtained 
 
Figure  3.11 Differential amplifier with two main capacitances impacting on frequency response. 
M1
M2
M3
M4
Vo
VDD
+
-
I0
CA
CB
vi
A
B

 
3.4 CMOS Differential Amplifier Frequency Response 
45 
 
 
from the parallel combination of  with X0√ó and that of ‚Ä¢ with √í"√ó, 
respectively. Summing voltages around the loop in Figure 3.14, we obtain 
 
 
√ò  √ò‚Ä¢  'qW  X0√ó√ò‚Ä¢-≈Ω  -q 	 
 (3.37)
 
Substitution of -≈Ω 	 √òW in (3.37) gives 
 
 
W 	 
4‚Ä∞
√ô1√ô¬®8‚Ä∞¬Ø5√ö√ô1√ô¬®
(3.38) 
 
Since -" 	 √ò‚Ä¢  X0√ó√òW and -q 	 X0w√í"w-%, we can obtain the circuit 
 
Figure  3.12 High-frequency small-signal equivalent circuit for differential amplifier. 
 
Figure  3.13 Circuit for obtaining Thevenin equivalent circuit. 
+
-
vi
gmNv1
roP||(1/gmP)
+
-
v3
+
-
vo
roP
gmPv3
roN
+
-
v2
+
-
v1
A
B
CA
CB
Thevenin 
Equivalent
gmNv2
roN
+‚àí
+‚àí
roN
roN
gmNroNv1
gmNroNv2
A
B
+
-
Vt
Rt

46 
CMOS Differential Amplifiers 
 
voltage gain in the s-domain as follows: 
4¬Ω 	 -"
-%
	 
 
¬Ø5√õ .√õ .√ö¬Ø5√öK61
.√õ .√ö616¬®K2√î61.√ö.√õ .√ö¬Ø5√ö.√õ 6¬®√ïK¬Ø5√ö.√õ .√ö 
(3.39)
 
Assuming the transfer function has two real poles, we can write the general form 
of this function as 
 
4¬Ω 	 4
 v
√ú√ù
¬©
v
√úQ√Ö¬¨¬©
v
√úQ2¬¨
 (3.40) 
where 
 
4 
¬Ø5√õ ¬Ø5√ö.√õ .√ö
¬Ø5√ö.√õ .√ö
 (3.41)
 
 
L√û 
¬Ø5√ö
61 
 (3.42) 
 
Supposing LR is the dominant pole of the circuit (LR ‚Ä¶ LR), from (3.39) and 
(3.40) we can determine the approximate value of LR as 
 
 
LR 
¬Ø5√ö.√õ .√ö
61.√ö.√õ .√ö¬Ø5√ö.√õ 6¬®
CTC
 
and 
 
 
LR 

.√õ √ì.√ö6¬® 
¬Ø5√ö.√õ
.√õ 61

 (3.44) 
 
In practice  X0√ó√í"w  √í"√ó   and (3.41) can be simplified as 4 
X0w√í"w √ì √í"√ó. In (3.43) the second term in the denominator is much greater than 
 
Figure  3.14 Simplified small-signal equivalent circuit. 
+‚àí
+‚àí
gmPZBv3
Vt
Rt
ZA
ZB
-
+
v3
vo
I

 
3.5 Noise Calculations in CMOS Differential Amplifier 
47 
 
 
the first one and thus the dominant pole can be approximated by 
 
 
LR 

.√õ √ì.√ö6¬®
(3.45) 
 
The first term in (3.44) is much less than the second one and also  X0√ó√í"w  , 
so that we can approximate the second pole as 
 
 
LR 
¬Ø5√ö
61 
(3.46) 
 
The nondominant pole is created by the current mirror circuit, hence known as the 
mirror pole. The magnitude of this pole is half of the left-hand-side zero in the s-
plane. The gain magnitude ¬π4√ÄL¬π and phase √ü4√ÄL are plotted versus 
frequency in Figure 3.15 
3.5 Noise Calculations in CMOS Differential Amplifier 
A noisy differential amplifier can be viewed as a noiseless two-port network in 
which all internal noise generators are modeled as two generally correlated voltage 
and current noise sources at the input, as illustrated in Figure 3.16. In a CMOS 
 
Figure  3.15 Gain magnitude and phase versus frequency for CMOS differential amplifier. 
œâp1
œâp2
œâz
|AV(jœâ)|
AV0
AV(jœâ)
œâ
œâ
0
-45o
-90o

48 
CMOS Differential Amplifiers 
 
differential amplifier for low-frequency operation, the input impedance is typically 
much greater than the source resistance 'D and thus -YH√†
√°√°√°√° is the dominant noise 
source. To calculate -YH√†

√°√°√°√° for a differential amplifier, we first introduce the main 
noise sources in an MOS device. In an MOS transistor the channel thermal noise 
current and the flicker noise voltage are considered as the two main sources of 
noise. When a transistor operates in saturation there is an inversion layer under the 
gate with a limited resistance. This resistor like any other resistor generates some 
thermal noise current whose mean-square is given by 
 
 
WY√¢ 	 T‚Äò√£√à3
 (3.47) 
 
where ‚Äò is Boltzmann‚Äôs constant with the value of CA ‚Äπ /≈Ω≈°‚Ä∫≈ì, √£ is 
temperature in ‚Ä∫≈ì, √à 	 ' is the conductance, and 3 is the bandwidth on which 
noise is calculated. The inversion layer conductance in a long-channel NMOS 
device that operates in saturation can be shown to be [7] 
 
 
X#K 	

≈Ω hY"V
i
Z -fD  -e
(3.48)
 
In (3.48) hY"Vo p
 -fD  -e is the channel conductance when an MOS 
device operates in triode with a zero drain-source voltage that is usually denoted 
by X#K. On the other side, this term is similar to the relationship for the 
transconductance of a long-channel MOS transistor working in saturation so it can 
also be represented by X0. For short-channel devices, some physical phenomena 
such as hot electron effects occur that affect the effective channel resistance. 
Therefore, the general relationship for the mean-square of the channel thermal 
noise current is expressed as 
 

WY√¢ 	 T‚Äò√£‚ÄôX03
CT;
 
where ‚Äô is a factor inserted to consider the short-channel effects with a value of 
2/3 for a long-channel condition and higher value in short-channel situations. It 
should be pointed out that in short-channel condition MOS transconductance has 
more complex relationship and X#K cannot be simply replaced by X0 In a more 
accurate relationship X0 in (3.49) is replaced by X0¬æ in which ¬æ is defined as 
Figure  3.16  Amplifier noise viewed as equivalent input voltage and current noise sources. 
RS
+
-
vs
Noisy
Differential
Amplifier
RS
+
-
vs
+
-
V2
n,i
I2
n,i
Noiseless
Differential
Amplifier

 
3.5 Noise Calculations in CMOS Differential Amplifier 
49 
 
 
¬æ  X0X#K with the value of less than unity [8-9]. 
The channel noise current can be added in parallel with the voltage-controlled 
current source in the small-signal equivalent circuit of an MOS device, as depicted 
in Figure 3.17. In this circuit, we have 
 
 
¬Æ 	 X0!¬ØK  WY 	 X0!¬ØK 
{√Ñ
¬Ø5
(3.50) 
 
By defining !¬ØK
¬º  !¬ØK  !Y where !Y  WYX0, the noisy MOS device acts like a 
noiseless device with the noise voltage !Y added to its ac gate-source voltage. 
Another important noise source in an MOS device is flicker noise. The origin 
of this type of noise in MOS devices is attributed to the lattice defects at the 
interface of the silicon and gate oxide at the surface of the device. Dangling bands 
and stress due to the different sizes of the silicon atoms and silicon dioxide 
molecules at the interface of the silicon and gate oxide are the main reasons to 
create energy states inside the silicon bandgap at the surface. These states act as 
traps to randomly capture and release the channel carriers in such a way that 
causes some fluctuation in the device threshold voltage. The time constant of the 
capture and release process is in the range of a few tenths to several milliseconds 
and thus the corresponding flicker noise has the most energy at low frequencies. 
The mean-square of the flicker noise voltage is given by 
 
 
-Y 	
‚Ä°
iZ6‚Äî
3
 
(3.51) 
 
where } is the flicker noise coefficient that depends on the technology and the 
type of the device. Channel thermal noise and flicker noise voltages are generally 
uncorrelated and thus the total input-referred noise voltage represented at the gate 
of an MOS device is given by 
 
 
Figure  3.17 MOS device small-signal equivalent circuit including channel thermal noise current. 
+
vgs
-
gmvgs
In
ro
G
S
D
i

50 
CMOS Differential Amplifiers 
 
 
-YH√†
√°√°√°√° 	 F
√áÀúe¬∏
¬Ø5 
‚Ä°
iZ6‚Äî

G 3
3.52) 

Now by adding an equivalent noise voltage source in (3.52) at the gate of each 
transistor in a differential amplifier, we can calculate the effect of each noise at the 
amplifier output and then by dividing the result by the low-frequency gain of the 
amplifier reaching the equivalent input-referred noise voltage. Assuming that 
transistor noises are uncorrelated, we calculate the total input-referred noise 
voltage by adding the mean-square values of all transistor noises referred to the 
amplifier input. The CMOS differential amplifier including all equivalent noise 
voltages at the gates of transistors is shown in Figure 3.18. 
Utilizing (3.52), we can write the noise contribution of each device at its gate 
as 
 
 
-Y√§

√°√°√°√° 	 ¬©
√áÀúe¬∏
¬Ø5√• 
‚Ä°√•
i√•Z√•6‚Äî

¬¨ 3√Ä 	 H HCHTH=
(3.53) 
 
Denoting the total input-referred noise voltage by -YH√†Y

√°√°√°√°√°, from Figure 3.18 we see 
that -Y

√°√°√°√° and -Y

√°√°√°√° associated with the noise contribution of M1 and M2 directly 
appear in -YH√†Y

√°√°√°√°√°√°. In order to calculate the noise contribution of M3 while only 
considering -Y≈Ω

√°√°√°√° and setting other noise voltages to zero, we multiply -Y≈Ω

√°√°√°√° by X0≈Ω
  
to obtain the equivalent noise current at the drain of M3 and then replace the 
small-signal equivalent circuit of Figure 3.18 as illustrated in Figure 3.19, in which 
 √í"w represents the drain-source series resistance of M1 and M2 while it is 
assumed that √í"  √¶. Summing currents at node A, we have 
 
 
¬Æ  X0√ó!≈Ω 	 WY≈Ω
 (3.54) 
 
where WY≈Ω 	 X0≈Ω-Y≈Ω. We can also write 
 
 
-Y"≈Ω 	 √í"√ó¬Æ  X0√ó!≈Ω
 (3.55) 
 
 
!≈Ω 	  √í"w¬Æ  -Y"≈Ω
 (3.56) 
 
The solution of above equations gives 
 
 
-Y"≈Ω 	
.√ö/¬Ø5√ö.√õ .√ö
¬Ø5√ö.√õ .√ö WY≈Ω
 (3.57) 
 
In practice, X0√ó√í"w  √í"√ó   and  X0√ó√í"w√í"√ó  √í"√ó and thus (3.57) can be 
approximated as 
 
 
-Y"≈Ω  '"MqWY≈Ω
(3.58) 

 
3.5 Noise Calculations in CMOS Differential Amplifier 
51 
 
 
 
where '"Mq  √í"w √ì √í"√ó. In the same way, we can obtain the noise contribution of 
M4 at the output 
 
-Y"√á 	
.√ö¬Ø5√ö.√õ .√ö
¬Ø5√ö.√õ .√ö WY√á
 (3.59) 
 
Applying the same approximations used for -Y"≈Ω, we reach the same result (i.e., 
-Y"√á  '"MqWY√á). Since M3 and M4 can be considered identical, WY≈Ω 	 WY√á and 
their mean-square is given by 
 
 
WY≈Ω

√°√°√°√° 	 WY√á

√°√°√°√° 	 FT‚Äò√£‚ÄôX0√ó  X0√ó

‚Ä°Q
i√öZ√ö6‚Äî

G 3 
(3.60) 
 
 
Figure  3.18 CMOS differential amplifier with noise contribution of all devices. 
 
Figure  3.19 Small-signal equivalent circuit for calculation of M3 noise contribution. 
M1
M2
M3
M4
VDD
M5
v2
n5
v2
n1
v2
n2
v2
n3
v2
n4
v2
no
In3
1/gmP
roP
gmPv3
2roN
Vn,o3
+
-
v3
i
A

52 
CMOS Differential Amplifiers 
 
where o√ó and p√ó are the channel width and length of PMOS load transistors (M3, 
M4). The noise contribution of M3 and M4 in the total input-referred noise of -YH√†Y

√°√°√°√°√° 
is obtained by dividing -Y"≈ΩH√á by the amplifier low-frequency gain, X0w'"Mq. 
Using (3.60), we have 
 
 
-YH√†Y

≈ΩH√á
√°√°√°√°√°√°√°√° 	
4√Ñ√ëH√ã
2
√°√°√°√°√°√°√°√°√°
¬Ø5√õ 8x‚Ä∞2 	 √ß
√áÀúe¬∏¬Ø5√ö
¬Ø5√õ
2

‚Ä°Q
i√öZ√ö6‚Äî

 F
¬Ø5√ö
¬Ø5√õG

√® 3
 (3.61) 
 
Based on (3.61) a large transconductance value for the input transistors M1 and 
M2 can help to reduce the contribution of the thermal noise component of the load 
transistor at the input. To reduce the contribution of the load flicker noise 
contribution, first it needs to choose the largest possible gate area for M3 and M4 
and then for a particular value of X0w, we need to minimize the load transistors 
transconductance X0√ó. As discussed earlier, these measures also aid the designer 
in reducing the effects of the load transistor mismatches on the input-referred 
offset voltage. The noise current of the tail transistor flows through both M1 and 
M2 as a common-mode current. As a result the amount of variation at the drain of 
M1 and M2 due to this current is the same. Noting this point, to calculate the noise 
effect of the tail transistor on the output noise, we first obtain the small-signal 
voltage gain from the gate of M5 to the drain of M1. In Figure 3.18 the equivalent 
resistance seen at the drain of M5 is  X0w and thus -Y appears at its drain as 
(X0-Y X0w). This voltage is amplified by the common-gate stage 
consisting of M1 and M3 as its diode-connected load with the gain of 
(X0wX0√ó). The total voltage gain from the gate of M5 to the drain of M3 and 
correspondingly to the output node of the differential amplifier will be 
(X0 X0√ó). The output noise due to the noise of M5 is obtained as 
 
 
-Y"

√°√°√°√°√°√° 	

√á F
¬Ø5√©
¬Ø5√õG

-Y

√°√°√°√°
 (3.62) 
 
Dividing (3.62) by the square of the differential amplifier voltage gain, we can 
obtain the noise contribution of the tail transistor in the total input-referred noise. 
It should be noted that the coefficient of -Y

√°√°√°√° in (3.62) is usually small. As a result, 
when -Y"

√°√°√°√°√°√° is divided by the square of the differential amplifier voltage gain, the 
input-referred noise owing to M5 will be negligible in comparison to that of the 
other four transistors and the total input-referred noise of the CMOS differential 
amplifier can be approximated as 
 
 
-YH√†Y

√°√°√°√°√°   -YH

√°√°√°√°√°√°   -Y≈ΩH√á

√°√°√°√°√°√° F
¬Ø5√ö
¬Ø5√õG


 (3.63) 

For X0√ó X0w

 ‚Ä¶ , from (3.63) we notice that M1 and M2 have the most 
contribution to the input-referred noise. This noise can be minimized by increasing 

 
3.6 Conclusion 
53 
 
 
both the gate area and transconductance of the input transistors M1 and M2. 
3.6 Conclusion
In this chapter the large-signal and small-signal behaviors of an MOS differential 
pair with a current mirror as its active load were studied. In the structure of an op 
amp, a differential amplifier usually appears as the first stage. This causes several 
important op amp parameters such as input offset voltage, common-mode rejection 
ratio, and input-referred noise mainly affected by this stage. As a result an accurate 
examination of the parameters of an MOS differential amplifier can help to design 
a more realistic CMOS op amp. The input-referred offset voltage was defined and 
some proper techniques to reduce this error voltage presented. The frequency 
response of the amplifier was calculated and finally the noise behavior and 
corresponding relationships in such an amplifier were briefly discussed. 
References 
[1] Jaeger, R. C., Blalock, T. N., Microelectronic Circuit Design, McGraw-Hill, 2007, Ch. 15. 
[2] Witte, F., Makinwa, K., and Huijsing, J., Dynamic Offset Compensated CMOS Amplifiers, 
Springer, 2009. 
[3] Baker, R. J., CMOS: Circuit Design, Layout, and Simulation, Third Ed, John Wiley & Sons, 
2010, Ch. 5. 
[4] Hastings, R. A., The Art of Analog Layout, Second Ed., Pearson Prentice Hall, 2006. 
[5] Graeb, H. E., Analog Layout Synthesis: A Survey of Topological Approaches, Springer, 2010. 
[6] Pelgrom, M. J. M., Duinmaiger, A. C. J., and Welbers, A. P. G., ‚ÄúMatching Properties of MOS 
Transistors,‚Äù IEEE J. Solid-State Circuits, Vol. SC-24, Oct. 1989, pp. 1433-1439. 
[7]  Tsividis, Y., Operation and Modeling of the MOS Transistor, Second Ed, Boston: McGraw-Hill, 
1999. 
[8] Ziel, A. V. D., Noise in Solid State Devices and Circuits, John Wiley & Sons, Inc., 1986. 
[9] Shaeffer, D. K., and Lee, T. H., ‚ÄúA 1.5V, 1.5GHz CMOS Low Noise Amplifier,‚Äù IEEE J. Solid-
State Circuits, Vol. 32, No. 5, May 1997, pp. 745-759.  
 
 
 

 
 
 
 

 
 
 
55 
Chapter 4 
CMOS Single-Ended Output Op Amps 
In Chapter 1, we introduced the main general parameters of an operational 
amplifier. An op amp normally consists of several building blocks among which a 
differential pair usually is the first stage in different architectures. In fact, the input 
differential voltage is converted to its equivalent current by the differential pair. 
Then, the produced current will flow through a high-impedance element realized 
usually by an active device to convert back the current to a voltage with larger 
amplitude. The method used to convert back the generated current to a single-
ended output voltage defines different architectures for the single-ended output op 
amps category. In this chapter, we deal with the analysis and design of several op 
amps of these types, including two-stage, telescopic cascode and a particular 
configuration of it known as folded-cascode, and current mirror structure. Some op 
amp parameters that were introduced in Chapter 1 are examined for each type. 
Because of the importance of the rail-to-rail input op amp in low-voltage 
applications, the chapter ends by introducing different techniques employed to 
implement this kind of op amp. 
4.1 CMOS Two-Stage Op Amp 
In a two-stage op amp, as its name suggests, the circuit consists of two cascaded 
stages. The first stage is a differential pair with a current mirror active load and the 
second stage is a common-source amplifier again with an active load to provide 
adequate voltage gain. A simple CMOS two-stage op amp with NMOS transistors 
as the input devices is shown in Figure 4.1.  
In the circuit of Figure 4.1, M5 acts as the tail current source of the 
differential pair and M7 is the active load of the common-source amplifier in the 
second stage. As discussed earlier, because of full symmetry between (M1, M2) 
and (M3, M4) the dc voltage at the drain of M2 (M4) is equal to the voltage at the 
drain of M1 (M3). Diode-connected M3 sets a specific dc voltage at the drain of 
M3 that is lower than -)) by one gate-source voltage of M3. The gate-source and 
drain-source voltages of M3 and M4 are identical and all equal to the gate-source 

56 
CMOS Single-Ended Output Op Amp 
 
voltage of M6. In an ideal case, we expect that the gate-source voltage of M6 can 
keep both M6 and M7 in the saturation region in such a way that the dc level of 
the output voltage is set at an appropriate level between the ground and [√ç√ç. In 
reality, if the sizing of M6 and M7 are not chosen properly in conjunction with the 
sizing of the differential pair devices, we encounter a special offset voltage that is 
called systematic offset voltage. In the next section, we discuss this offset voltage. 
4.1.1 Offset Voltage 
Systematic Offset Voltage: In the quiescent condition without any ac input signal, 
we expect both M6 and M7 to operate in saturation. In an ideal case, this condition 
occurs if the gate-source voltage of M6 that is equal to that of M3 and M4 can 
provide an appropriate quiescent output voltage for equal drain currents of M6 and 
M7. In practice, this condition may not occur and the output voltage goes toward 
one of the ground or [√ç√ç, taking either M6 or M7 to the triode region. Let us take 
-Df√™ as the gate-source voltage of M6 for which the latter happens and -Df√™
√´  as the 
ideal M6 gate-source voltage that keeps both M6 and M7 in saturation. By placing 
a dc voltage source -$0 at the output node that takes a value in the middle of 
ground and [√ç√ç, as shown in Figure 4.2, we can force both M6 and M7 to remain 
in saturation for the gate-source voltage of -Df√™ but now the drain current of two 
transistors is no longer the same. In order to make currents identical, we have to 
change the gate-source voltage of M6 from -Df√™ to -Df√™
√´ . The systematic offset 
voltage is defined as the difference between these two mentioned gate-source 
voltages of M6 when divided by the voltage gain of the differential pair and 
referred to the op amp input: 
 
Figure  4.1 Two-stage CMOS op amp. 
VDD
I0
+
-
vi
vo
M1
M2
M3
M4
M5
M6
M7
M0
I0

 
4.1 CMOS Two-Stage Op Amp 
57 
 
 
 
-"KHK√¨K 	
4k¬°√≠/4k¬°√≠
√Æ
+√Ö

 (4.1)
 
where # is the voltage gain of the differential pair. To eliminate this offset, the 
size of M6 and M7 should be chosen such that in the presence of the voltage 
source of -$0 at the output node, while keeping both devices in the saturation 
region, no current flows through the source -$0 that is equivalent to having 
W)√™ 	 W)≈í. On the other side, from -Df≈Ω 	 -Df√á 	 -Df√™ and under the assumption 
that the drain current of all MOS devices have a square-law dependence on the 
gate-source voltage, we can write 
 
 
√å-eR≈Ω√å  t
{:√ë
√Ü√ë 	 √å-eR√™√å  t
{:√≠
√Ü√≠  
 (4.2) 
 
where 
 
¬∞≈ΩH√™ 	 hR"V F
i
Z G
≈ΩH√™
 (4.3) 
 
Assuming √å-eR≈Ω√å 	 √å-eR√™√å and neglecting channel-length modulation effect, since 
W)√™ 	 W)≈í, we can get ¬∞≈Ω ¬∞√™

	 W)≈Ω W)≈í

. Because of equal gate-source voltage of 
M5 and M7, a similar relationship can be written for these devices (i.e., we have 
¬∞ ¬∞≈í

	 W) W)≈í

). In the quiescent condition, the tail current W is equally divided 
between M3 and M4 such that W)≈Ω 	 W)√á 	 W . From two given ratios, the 
following relationship is obtained 
 
 
F¬≤
¬≥ G√ë
F¬≤
¬≥ G√≠
	


F¬≤
¬≥ G√©
F¬≤
¬≥ G√Ø
 
 (4.4) 
 
If we do not neglect the channel length modulation effect, the drain current 
 
Figure  4.2 Systematic offset voltage explanation circuit. 
VDD
VGS6
+
-
M6
M7
+
-
Vcm
ID7
ID6 ID6-ID7

58 
CMOS Single-Ended Output Op Amp 
 
equation for NMOS and PMOS devices should be modified as 
 
 
W)YHR 	
√Ü√ÑHQ
 ‚Äú-fDYHR  -eYHR‚Äì
‚Äú  |YHR-)DYHR‚Äì  
(4.5) 
 
Following the same procedure and considering the channel length modulation, we 
can obtain 
 
 
√∞√Ñ4:k√Ø
√∞√Ñ4:k√© 	


F¬≤
¬≥ G√≠F¬≤
¬≥ G√©
F¬≤
¬≥ G√ëF¬≤
¬≥ G√Ø
√∞Q4k:√≠
√∞Q4k:√ë 
 (4.6) 
 
where |Y and|R are the short-channel parameters. -)D 	 -$0H%  -fDH with 
-$0H% as the input common-mode voltage. Furthermore, we have 
 

-D)≈Ω 	 -))  -Df≈Ω
 (4.7) 
and 
 
-D)√™ 	 -))  -"
(4.8)
 
If it is assumed that |YH |R ‚Ä¶ , by using (4.4) and substituting (4.7) and (4.8) into 
(4.6) and neglecting higher-order terms, we can obtain the quiescent output 
voltage as 
 
 
-" 
√∞Q
√∞√Ñ√∞Q -))  -Df≈Ω 
√∞√Ñ
√∞√Ñ√∞Q -$0H%  -fDH 
 (4.9) 
 
In (4.9) the values of -Df≈Ω and -fDH depend on the tail current and for a certain 
tail current they are fixed. In this condition, the dc output voltage approximately 
changes with the input common-mode voltage according to the (4.9). 
 
Random Offset Voltage: As discussed for the differential pair, this kind of offset is 
related to any mismatch among different devices used in the circuit. Since any 
offset voltage created by the second stage is reduced by the voltage gain of the 
first stage while referring to the input, we can say that the most significant 
contribution in the input-referred offset voltage in a two-stage op amp is given rise 
to by the first stage differential pair. As such, any measure taken to reduce the 
offset voltage of the first stage results in lowering the entire offset voltage. Some 
offset reduction techniques for the differential pair were discussed in the previous 
chapter. For instance, perfect matching in the layout of two pairs of (M1, M2) and 
(M3, M4) and taking a large enough geometry for them were some measures that 
help to get a low random offset voltage at the input. In the layout phase, if each 
transistor is to be split into several smaller unit cells, particularly when the 
transistor size is large, all unit cells should be distributed in a manner that any 
error due to probable oxide thickness or substrate doping gradient is distributed 

 
4.1 CMOS Two-Stage Op Amp 
59 
 
 
evenly among all unit cells. The mentioned steps can result in a random offset 
voltage with a nearly zero mean value, otherwise the input offset voltage would 
have a nonzero mean value that is added to the systematic offset voltage. 
4.1.2 Two-Stage Op Amp Frequency Response 
The output nodes of the differential pair and the common-source amplifier in the 
second stage are two high-impedance nodes in the circuit of Figure 4.1. The gate-
source capacitance of M6 and the op amp load capacitance are the two most 
significant capacitances seen at these nodes. Denoting these capacitances by 
and , respectively, we substitute the small-signal equivalent circuit of the 
two-stage op amp as illustrated in Figure 4.3. ' and ' designate the parallel 
combination of the drain-source dynamic resistance of two pairs of (M2, M4) and 
(M6, M7) in the first and second stage, respectively, and ¬Ø#√™ is the overlap drain-
gate capacitance of M6. Summing currents at the node A and at the output node, 
we have 
 
 
X0-%  F¬Ω 

8√ÖG -U  ¬Ω¬Ø#√™-U  -" 	  
 (4.10) 
 
 
X0√™-U  F¬Ω 

82G -"  ¬Ω¬Ø#√™-"  -U 	  
(4.11) 
 
Solving two equations, we can obtain the voltage gain transfer function as 
 
 
4¬Ω 	
¬Ø5√Ö¬Ø5√≠8√Ö82¬©/
v√Ç¬ø+√≠
¬ø5√≠ ¬¨
√±8√Ö‚Äú6¬ø+√≠6√Ö‚Äì82‚Äú6¬ø+√≠62‚Äì¬Ø5√≠8√Ö826¬ø+√≠√≤K8√Ö82‚Äú6√Ö626√Ö6¬ø+√≠626¬ø+√≠‚ÄìK2   
(4.12) 
 
As it can be seen from (4.12), the circuit displays a right half-plane zero and two 
poles in the left half-plane in the s-domain. Supposing both poles are real, we can 
represent (4.12) as a general form 
 
 
Figure  4.3 High-frequency small-signal equivalent circuit of two-stage op amp. 
+
-
Vi
gm1Vi
R1
C1
Cgd6
gm6Va
R2
C2
Vo
+
-
Va
A

60 
CMOS Single-Ended Output Op Amp 
 
 
4¬Ω 	 4
/ v
√ú√ù
¬©
√Ö
√úQ√Ö √Ö
√úQ2¬¨K
√Ö
√úQ√Ö√úQ2K2 
 (4.13) 
 
where 4  X0X0√™'' is the op amp dc voltage gain, L√û  X0√™ ¬Ø#√™

 is the 
zero on the right half-plane, and LR and LR are two real left half-plane poles. If 
LR is assumed as the dominant pole of the circuit (i.e., LR ‚Ä¶ LR), comparing 
(4.12) with (4.13), we can approximate two poles as follows: 
 
 
LR 

8√Ö‚Äú6¬ø+√≠6√Ö‚Äì82‚Äú6¬ø+√≠62‚Äì¬Ø5√≠8√Ö826¬ø+√≠ 
 (4.14) 
 
 
LR 
¬Ø5√≠6¬ø+√≠
6√Ö626¬ø+√≠6√Ö62 
 (4.15) 
 
The denominator of (4.14) is the summation of three different time constants, 
among which the last term is a dominant one. The dominant time constant is the 
multiplication of ' by an equivalent capacitance of IJ 	 X0√™'¬Ø#√™. Although 
¬Ø#√™ is small, its effective value has increased by the factor of the second stage 
voltage gain. This is known as the Miller effect [1]. 
 
Frequency Compensation: The two-stage op amp as it has been represented in 
Figure 4.1 usually suffers from instability in the frequency domain when it is used 
within a negative-feedback loop. This fact can be explained by taking a more 
precise look at the poles and zero locations. The capacitance  mostly consists of 
the load capacitance and thus its value is usually much greater than  and ¬Ø#√™ in 
(4.15). Therefore the second pole can be approximated by 
 
 
LR 
¬Ø5√≠
62
6¬ø+√≠
6√Ö6¬ø+√≠ 
 (4.16) 
 
Since  includes the gate-source capacitance of M6, we have   ¬Ø#√™ and 
therefore LR could not be very far from LR. On the other side, the zero is usually 
much farther away from the two poles on the right half-plane. The magnitude and 
phase plot of the op amp frequency response in this situation is shown in Figure 
4.4. As it can be seen from Figure 4.4, at the unity gain frequency of LM, the phase 
is close to A‚Ä∫, which shows a nearly zero phase margin! Before proceeding to 
provide a solution for the instability problem, we first obtain the relationship for 
LM in terms of circuit parameters. With this end in view, a simplified schematic of 
the circuit of Figure 4.1 is depicted in Figure 4.5. The dependent current 
sourceX0!% models the output of the first stage and block X0√™ represents the 
second stage amplifier. In the circuit of Figure 4.5, the output voltage in the 
s-domain can be written as 

 
4.1 CMOS Two-Stage Op Amp 
61 
 
 

-" 	
¬Ø5√Ö4
K6¬ø+√≠
 (4.17) 
 
Equation (4.17) describes the behavior of the circuit in the frequency range of 
LR  L  LR, which is very similar to an integrator behavior. Frequency LM is 
defined as a frequency at which the magnitude of the voltage gain is unity. From 
this equation we obtain LM 	 X0 ¬Ø#√™

. The capacitance ¬Ø#√™ is too small and 
thus LM appears at high frequency usually after the second pole location. That is 
exactly the reason why the phase margin drops dramatically. It is interesting that 
 
Figure  4.4 Gain and phase versus frequency for an uncompensated two-stage op amp. 
 
Figure  4.5 Schematic of op amp used to calculate u. 
|AV(jœâ)|
œâp1
œâp2
œâz
AV0 
œâ
AV(jœâ)
œâ
0
-180
-90
œâu
Cgd6
C2
gm1Vi
gm6
Vo

62 
CMOS Single-Ended Output Op Amp 
 
when ¬Ø#√™ increases, both LR and LM decrease and at the same time LR 
increases, all of which help to increase the phase margin and make the op amp 
frequency response more stable. In practice, this condition can be realized by 
adding an appropriate capacitance in parallel with ¬Ø#√™ across the drain-gate of 
M6. The process of adding shunt capacitance to improve phase margin is known 
as frequency compensation. The compensation capacitance is chosen such that LM 
occurs before LR. Since the phase margin is defined as the distance of the phase 
at LM to the angle of A¬∞, from (4.13) we have 
 
 
N& 	 A‚Ä∫  √≥√¥c/ ¬©
√µx
√µQ√Ö¬¨  n√∂‚Ä¢/ ¬©
√µx
√µQ2¬¨  n√∂‚Ä¢/ F
√µx
√µ√ùG 
(4.18) 
 
In practice since LM  LR, we have √≥√¥c/LM LR

  ;¬∞ and thus the phase 
margin will be 
 
 
N& 	 ;‚Ä∫  n√∂‚Ä¢/ ¬©
√µx
√µQ2¬¨  n√∂‚Ä¢/ F
√µx
√µ√ùG 
 (4.19) 
 
The ratio of LM L√û

 in (4.19) is independent of the compensation capacitance and 
it is equal to X0 X0√™

. This term adds a negative phase to the phase margin that is 
because the zero location is on the right half-plane. The added compensation 
capacitance denoted by $ is usually much greater than ¬Ø#√™ and therefore 
¬Ø#√™  6 is approximately equal to $. Assuming $  , from (4.16) by 
replacing ¬Ø#√™ with $, we can approximate the second pole as X0√™ 

. 
According to (4.19), for a particular $, increasing the load capacitance moves the 
second pole toward lower frequencies and increases the negative phase 
contribution of the second pole. To achieve an appropriate phase margin we need 
to move LR and L√û adequately far away from LM. If it is supposed that  
L√û √∑ LM, the contribution of the zero in the phase margin will be less than 
=B‚Ä∫. In this condition, a minimum phase margin of <‚Ä∫, for example, is 
attainable provided that LR √∑   LM that is equivalent to have $ √∑   . 
Satisfying the condition of L√û √∑ LM, is equivalent to have X0√™ √∑ X0 that 
requires to take quite a large value for X0√™ and, in turn, dictates to employ a large 
device with a high current for M6. The better method to reduce or even eliminate 
the effect of the right half-plane zero without having to increase X0√™ is to move 
the zero into the infinity to entirely cancel its effect or move it to the left half-
plane to add a positive phase in the phase margin relationship. This can be 
accomplished by adding a series resistance with the compensation capacitor. The 
op amp schematic including the added RC series compensation circuit and its 
small-signal equivalent circuit is shown in Figure 4.6. Summation of currents at 
nodes A and B in the circuit of Figure 4.6(b) gives 

 
4.1 CMOS Two-Stage Op Amp 
63 
 
 
 
X0-%  F

8√Ö  ¬ΩG -U 
4ÀÜ/4
8, √Ö
v√Ç,
	  
 (4.20) 
 
 
4/4ÀÜ
8, √Ö
v√Ç,
 X0√™-U  F

82  ¬ΩG -" 	  
 (4.21) 
 
Omitting -U between the two equations above, we can calculate the transfer 
function of op amp as 
 
4¬Ω 	 4
K6,F8,/
√Ö
¬ø5√≠G
‚ÄûK$K2#K√ë  
 (4.22) 
 
where 4  X0X0√™'' is the low-frequency voltage gain and coefficients √∏H √πH 
and √∫ in the denominator are defined as 
 
 
√∏ 	 '  $  '  $  X0√™''$  '$$ 
 (4.23a) 
 
 
√π 	 ''  $  $  '$$'  ' 
 (4.23b) 
 
 
√∫ 	 '''$$
 (4.23c) 

From (4.22) it is obvious that for '$ 	  X0√™

 the zero will be eliminated in the 
 
Figure  4.6 (a) Two-stage op amp including compensation circuit. (b) Op amp small-signal equivalent 
circuit. 
VDD
+
-
vi
vo
M1
M2
M3
M4
M5
M6
M7
Cc
Rc
Vb
Vi
gm1Vi
R1
C1
Cc
gm6Va
R2
+
-
Va
A
C2
Vo
(a)
Rc
B
(b)
+
-

64 
CMOS Single-Ended Output Op Amp 
 
transfer function or equivalently the zero is moved into infinity and thus we have 
no phase contribution due to the zero in the phase response of the op amp. For 
'$   X0√™

 the zero moved into the left half-plane. Supposing that all three poles 
of the transfer function are real, we can represent (4.22) as 
 
 
4¬Ω 	 4
 v
√ù√Ö
F √Ö
Q√Ö √Ö
Q2 √Ö
Q√ëGKF
√Ö
Q√ÖQ2
√Ö
Q√ÖQ√ë
√Ö
Q2Q√ëGK2F
√Ö
Q√ÖQ2Q√ëGK√ë 
 (4.24) 
 
Assuming poles √ª and √ª≈Ω are widely separated with respect to √ª and also 
√ª≈Ω  √ª, by equating the corresponding coefficients in (4.22) and (4.24), the 
dominant pole √ª is nearly given by √ª   √∏
  and the second and third poles are 
almost equal to √ª  √∏ √π
  and √ª≈Ω  √π √∫
 , respectively. In practice, we have 
H $   and 'H '  '$ and thus by neglecting the small terms based on 
these approximations, we can easily obtain poles and zero relationships in terms of 
the circuit components as √ª   X0√™''$

,√ª  X0√™ 

, √ª≈Ω   '$

, 
and √º 	  $'$   X0√™



. As it can be seen, adding the series resistance of 
'$ does not create much change in the position of two first poles with respect to 
the previous circuit. The role of '$ is to move the zero into the left half-plane and 
adding an extra far away third pole. As mentioned earlier, one way for 
compensation is that we take '$ 	 X0√™ to entirely eliminate the existing zero. 
Another and usually better procedure is that we choose '$ such that it moves the 
zero into the left half-plane and put it exactly on the second pole in order to have 
one zero-pole cancellation. Figure 4.7 shows the op amp poles and zero locations 
in the s-plane in this condition. The required compensation resistance to meet this 
condition is obtained by setting √º 	 √ª, which gives 
 
 
'$ 	

¬Ø5√≠ F 
62
6,G
(4.25)
 
In reality, in addition to √ª≈Ω, the circuit has another high-order pole due to the 
current mirror active load of the differential pair that is called the mirror pole. As 
 
Figure  4.7 Cancellation of second pole by zero. 
jœâ
œÉ
s-plane
Xp1
Xp2
z1
Xp3

 
4.1 CMOS Two-Stage Op Amp 
65 
 
 
discussed before, this pole is equal to X0≈ΩH√á  ¬ØK≈ΩH√á

 and since ¬ØK≈ΩH√á is usually 
much smaller than $, for '$ close to  X0≈ΩH√á

, the mirror pole is larger than √ª≈Ω. In 
the condition that one pole-zero cancellation has happened, these two poles should 
be far enough from LM in order to achieve a proper phase margin. By substituting 
(4.25) into √ª≈Ω 	  '$

 and assuming √ª≈Ω  LM, we can determine a certain 
minimum compensation capacitance to meet our desirable phase margin. 
 
 
$ 
¬Ø5√Ö6√Ö
¬Ø5√≠ ¬©  t 
√á62
6√Ö
¬Ø5√≠
¬Ø5√Ö¬¨ 
 (4.26) 
4.1.3 CMOS Two-Stage Op Amp Design Procedure 
In this section, we intend to present a procedure to design a CMOS two-stage op 
amp based on the given specifications in a particular CMOS process. In 
accordance with the given process in which our op amp is to be designed, some 
design parameters are usually dictated by the process. Some of most important of 
these parameters are the device threshold voltage, minimum permissible channel 
length, mobility of carriers, gate oxide capacitance, and subthreshold parameter of 
- for MOS devices working in the subthreshold region. In the design of a CMOS 
circuit on paper, we usually make our lives easier by using simplified models for 
devices. We are doing this in order to be able to put through our design. In fact, 
designing on paper gives us an initial evaluation of the behavior of the targeted 
circuit. Performing circuit simulations by employing very intricate advanced 
models such as BSIM [2] helps the designer to direct the design toward his/her 
goal. Of course, the designer needs to have comprehensive information about the 
different physical limitations raised in the modern deep submicron CMOS process. 
Phenomena such as short-channel effects, carrier mobility constraints due to high 
longitudinal and transverse electric fields, and operating in a subthreshold region 
are some critical points that should be taken into account in the design phase. 
These pieces of information help the designer understand how to change MOS 
device sizes in order to move the results obtained from simulations toward those 
obtained from paper calculations. As it will be followed by a numerical design 
example, here we assume the op amp parameters, including unity gain frequency 
LM, slew rate O', load capacitance Z, dc voltage gain 4, and phase margin N& , 
are given as our design goals and we plan to design a two-stage op amp to meet 
these specifications. We now enumerate the different steps required in the design 
of such an op amp. 
 
Compensation Capacitance Determination: Our ultimate strategy is to cancel the 
second pole by moving the right half-plane zero onto this pole. In this situation, 
the first nondominant pole becomes √ª≈Ω 	 '$ where '$ is determined by 
(4.25) such that we have 

66 
CMOS Single-Ended Output Op Amp 
 
 
√ª≈Ω 	
6,
626,
¬Ø5√≠
6√Ö 
(4.27) 
 
As mentioned earlier, the main part of  consists of the external load capacitance 
and here we can almost take   Z. Selecting a small value for $ is an 
advantage in terms of saving in the required chip area to implement this capacitor 
as an on-chip component but a small $ relative to the load capacitance moves √ª≈Ω 
to lower frequencies and thus reduces the phase margin. Therefore there is a trade-
off between the chip area and the phase margin. As a starting point, we choose 
$ 	 TZ. As discussed later, this selection is considered as an initial value for 
$ and we have not yet utilized (4.27) to ascertain optimum compensation 
capacitance. 
 
Calculating X0 and X0√™: Knowing just the value of $ does not help us to 
calculate other parameters because X0√™ and  are unknown and both depend on 
the sizing and biasing of M6. Hence, at present, we assume the series 
compensation resistance '$ is chosen in such a way that the zero of the circuit has 
been moved into infinity. By keeping this point in mind, we have LR 	 X0√™ Z

 
as the second pole. Now based on the required phase margin and unity gain 
bandwidth, it is possible to calculate LR and thereby X0√™ will be achievable. By 
moving the right half-plane zero to infinity, and assuming LR ‚Ä¶ LR, the phase 
margin is obtained from N& 	 ;¬∞  √≥√¥c/‚ÄúLMLR‚Äì. For example, if we need a 
phase margin greater than <¬∞, it is enough to have LR √∑ dCLM. Since 
LR 	 X0√™ Z

, by knowing LR and based on the given Z, X0√™ is obtained. 
Based on the chosen value for $H X0 is achievable from LM 	 X0 $

. After 
determination of X0 and X0√™ according to the above discussion, at the end we 
can increase '$to place the zero on LR, which causes one-pair pole-zero 
cancellation. By eliminating LR, the first nondominant pole will now be √ª≈Ω given 
in (4.27). This makes the phase margin larger than that of the considered design 
goal. Therefore we can reduce $ as far as the phase margin reaches the given 
value. At this stage, reduction of $ gives us an extra bonus: the widening of LM 
without needing to increase X0. 
 
Tail Bias Current: The differential pair tail transistor current in the first stage is 
specified based on the op amp slew rate. Slew rate is calculated from O' 	 W$ 
with W as the current of the tail transistor and thus W 	 $ ‚Äπ O'. Again, reducing 
$ in the previous step can help to increase the slew rate. Here there is an 
important point regarding the value of W as the bias current of the differential pair. 
It is quite possible that in a special design we need a wide bandwidth while having 
a very large slew rate is not important to us. In this case if we take a rather small 
value for the slew rate, the calculated bias current becomes small. On the other 
hand, we need to have a large transconductance X0 to achieve the desirable 

 
4.1 CMOS Two-Stage Op Amp 
67 
 
 
bandwidth. Supposing that the square law is held for differential pair input 
transistors, to get the required transconductance at a certain bias current, we have 
to take a large aspect ratio for our MOS devices. However, as discussed in Chapter 
2, this condition causes device operation area changes to the subthreshold region 
with a completely different current equation and thus a different relationship for 
the transconductance. In fact, in this region we have X0 	 W  --q¬¶

. As it is 
obvious, increasing the device sizing has no effect on X0, we first need to obtain 
the least bias current that is able to provide required X0 in subthreshold region 
and if this current is greater than that obtained from the slew rate data, we have to 
choose the larger one as the bias current. Another issue with regard to 
transconductance calculation is that using the square law to calculate 
transconductance just gives a rough estimation of the value of transconductance. 
This is because of the short-channel effect in new submicron MOS devices. 
Taking into account the constraining effects of the short-channel and thin gate 
oxide of the device on the mobility of free carriers, we should modify the drain-
current equation as [3] 
 
 
W) 	

 h"V
i
Z
4¬°k/4¬£2
¬©√Ω
√æ
¬≥ vÀÜ‚Ä∞¬¨4¬°k/4¬£ 
 (4.28) 
 
where h is the carrier mobility at low electric fields. Parameter  represents the 
mobility degradation due to the high vertical electric field and increases as the gate 
oxide thickness drops. -KUq designates the velocity saturation of carriers. The 
incremental transconductance is obtained by taking the derivative of (4.28) versus 
-fD 
 
X0HK$ 	
z{:
z4¬°k 	 h"V
i
Z -fD  -e¬æ 	 ¬æX0HZ6 
 (4.29) 
 
where X0HK$ and X0HZ6 denote the MOS transconductance in short and long-
channel states, respectively, and¬æ is defined as 
 
 
¬æ 	
√Ö
2¬©√Ω
√æ
¬≥ vÀÜ‚Ä∞¬¨4¬°k/4¬£
√ß¬©√Ω
√æ
¬≥ vÀÜ‚Ä∞¬¨4¬°k/4¬£√®
2 
 (4.30) 
 
Equation (4.30) indicates that ¬æ always is less than unity and drops by decreasing 
the channel length and gate oxide thickness in an MOS device. On paper 
calculations, we usually use simply a square law relationship to calculate X0 that 
in fact gives X0HZ6 in (4.29). The actual transconductance is less than that 
calculated on paper. Thus we take the goal transconductance a few percent more in 
order to compensate this error. 
 
First Stage Transistor Sizing: When the transconductance and drain current of M1 

68 
CMOS Single-Ended Output Op Amp 
 
and M2 is determined, we can easily obtain the input transistor aspect ratios from 
transconductance relationshipX0H 	 ‚Ä¢hY"Vo p
 HW. The channel lengths of 
M1 and M2 are determined based on the minimum required voltage gain of the 
differential pair. As discussed in Chapter 3, the voltage gain of a differential pair is 
given by 
 
 
4 	
¬Ø5√ÖH2
¬Ø2¬Ø√ã
TC
 
where X" 	 |YW  and X"√á 	 |RW  are the small-signal output conductances 
of M2 and M4. By substituting the transconductance relationship into (4.31), we 
get the first-stage voltage gain as 
 
 
4 	
‚Ä¢√É√Ñ6‚Äîi Z
 √ÖH2
‚Äú√∞√Ñ√∞Q‚Äì‚Ä¢{
   
 (4.32) 
 
For a certain bias current, using a longer channel length for M2 and M4 leads to 
smaller |Y and |R and thus higher voltage gain.  
The size of M3 and M4 are calculated by assuming a reasonable value for the 
overdrive voltage of these devices. The upper limit for the input common-mode 
voltage of the differential pair is -%$H0UV 	 -))  -Df≈ΩH√á  -eY that is nearly equal 
to -))  -"#H≈ΩH√á with -"#H≈ΩH√á as the M3 and M4 overdrive voltage. A small -"#H≈ΩH√á 
helps to have high -%$H0UV, but at a certain bias current, low overdrive voltage 
necessitates using PMOS devices with large aspect ratios that may cause the 
designer to be faced with some constraints on other op amp parameters. First, low 
overdrive voltage corresponds to high transconductance of M3 and M4, which 
gives rise to more channel thermal noise contribution of these transistors in the 
total  input-referred noise. Moreover, a large aspect ratio of M3 and M4 magnifies 
the mismatch threshold voltage of the devices in the input-referred offset voltage, 
as indicated in Chapter 3. Another issue with a large PMOS load of the first stage 
is associated with the op amp frequency response. Since the gate-source 
capacitance of M3 and M4 determines the mirror pole location, using large sizes 
for M3 and M4 increases this capacitance and thus lowers the mirror pole that 
leads to degrade the phase margin. The aspect ratio of the tail transistor M5 is also 
calculated based on choosing a proper overdrive voltage for this device. Here the 
low overdrive of M5 helps to decrease the lower limit of the input common-mode 
voltage of the differential pair according to -%$H0%Y 	 -fDH  -"#H. Knowing the 
aspect ratio of M5, we assume a reasonable value for the M5 channel length and 
then obtain its channel width. As discussed later, using a long-channel length for 
M5 can help to improve the low-frequency CMRR of the op amp. Of course, in 
order to keep the aspect ratio of M5 unchanged, we have to increase the transistor 
width in direct proportion to the channel length. With a wide tail transistor, the 
parasitic capacitance seen at the common-source node of M1 and M2 also 

 
4.1 CMOS Two-Stage Op Amp 
69 
 
 
increases due to the M5 drain to the substrate capacitance. This capacitance 
degrades the CMRR at high frequencies, as will be shown later.  
The dimension of M6 and M7 are specified with regard to the systematic 
offset voltage. As proved at the beginning of this chapter, by satisfying the 
following relationship this offset can be eliminated: 
 
 
F¬≤
¬≥ G√≠
F¬≤
¬≥ G√ë
	  
F¬≤
¬≥ G√Ø
F¬≤
¬≥ G√©
 
 (4.33) 
 
To take care of matching issues associated with the layout, it is best to use the 
same lengths for M5 and M7. The large channel length of M6 and M7 again helps 
to increase the output resistance of the common-source stage that makes the 
voltage gain of this stage larger. Of course the designer should watch out for the 
effects of sizing on the stage frequency response.  
 
Design Example 
 
We plan to design a CMOS two-stage op amp in a 0.25-≈† CMOS technology. 
The given parameters by the process are -eY 	 √å-eR√å 	 =-, hY"V 	
  =\¬∂[,hR"V 	 =\¬∂[, and the subthreshold factor - 	   #IR "V

	
T. The required op amp specifications are: 
 
 
Dc voltage gain: 4 √∑ = ( or greater thanBT>?) 
 
Unity gain bandwidth: M √∑ =_ `a 
 
Phase margin: N& √∑ <¬∞ 
 
Slew rate: O' √∑ [\] 
 
Load capacitance: Z 	 =¬µ. 
 
The design procedure begins by choosing $ 	 TZ 	  ¬µ. Assuming the 
zero has been moved to infinity, forN& √∑ <¬∞, we have LR 	 X0√™ Z

√∑ dCLM. 
With the given data, we need to have X0√™ √∑  B ≈†¬∂[. From LM √∑ X0$, we 
obtain X0 √∑ < A\¬∂[. Based on the given slew rate, from O' √∑ W$, the tail 
current should be greater than  \¬∂. The minimum required aspect ratio of the 
input transistors is determined from X0 	 ¬æ‚Ä¢hY"Vo p
 HW √∑ < A\¬∂[. 
Supposing that ¬æ  ;, we obtain the aspect ratio of the input transistors as 
o p
 H √∑ A. Such large sizing with low level of drain current for these 
transistors causes these devices to work in subthreshold. As discussed in Chapter 
2, the transconductance in such an operating area is independent of the device 
sizing and given by X0 	 W) --q¬¶

. For X0 	 < A\¬∂[, W) should be 
greater than  C\¬∂. In order to make sure that input transistors work in saturation, 
their drain currents should be larger than  C\¬∂. By choosing W) 	 C\¬∂, 

70 
CMOS Single-Ended Output Op Amp 
 
recalculation of transconductance gives o p
 H √∑ C<. We choose o p
 H 	
T. Assuming p 	 p 	 \≈†, to have enough voltage gain for the first stage we 
will have o 	 o 	 T\≈†. Referring to what was discussed about the M3 and 
M4 overdrive voltage, a reasonable value for this parameter can be -"#≈ΩH√á   [ 
and therefore o p
 H √∑ C. We choose o p
 ≈ΩH√á 	 T with p≈Ω 	 p√á 	 =\≈† 
and thus o≈Ω 	 o√á 	  \≈†. Here we take the length of PMOS devices less than 
that of NMOS. It is justified by knowing that |R is usually less than |Y and by 
taking a lower channel length for PMOS at the same bias conditions, we can make 
the output resistance of two NMOS and PMOS transistors close together which, in 
turn, leads to maximum voltage gain for the first stage. Small sizing of M3 and M4 
helps to improve the frequency response by moving the mirror pole to higher 
frequencies, as mentioned earlier. By taking the overdrive voltage of the tail 
transistor M5 less than=[, we will obtaino p
   T with p 	 \≈† and 
o 	 T\≈†. Assuming the square law is held for all transistors, we can write the 
transconductance of M3 and M6 as X0≈Ω 	 hR"Vo p
 ≈Ω-Df≈Ω  √å-eR√å and 
X0√™ 	 hR"Vo p
 √™-Df√™  √å-eR√å, respectively. On the other side, we have 
-Df≈Ω 	 -Df√™, and thus we can write X0√™ X0≈Ω

	 o p
 √™ o p
 ≈Ω

.X0≈Ω 	
¬æ‚Ä¢hR"Vo p
 ≈ΩW 	 C≈†¬∂[ 
and 
X0√™ 	  B ≈†¬∂[ 
and 
thus 
o p
 √™ o p
 ≈Ω

	 AA. By rounding this ratio to 9 and from (4.33), we have 
o p
 √™ 	 C< and o p
 ≈í 	 A. For p√™ 	 =\≈† and p≈í 	 \≈†, we get 
o√™ 	 o≈í 	 A\≈†. From circuit simulation, we obtain the transconductance of 
M1,2 and M6 as X0H 	 =≈†¬∂[, X0√™ 	  ;<≈†¬∂[, and dc voltage gain as 
4 	 B;;>? Now we choose the compensation resistance '$ such that the zero 
and the second pole, LR, cancel each other out. To this end, we calculate the 
resistance from '$ 	  X0√™

  Z $

 	 A≈ì. Repeating simulation 
while adding '$, we obtain N& 	 B<<¬∞ and LM 	   ‚Äπ CT;_ `a. Phase margin 
is more than our desirable value but the bandwidth does not meet our requirement. 
As said before, here we have enough room to lessen the phase margin by lowering 
$ that simultaneously leads to increase LM 	 X0$. Modifying the 
compensation components as $
√´ 	 ¬µ and '$ 	  X0√™

‚Äú  Z $
√´

‚Äì 	  ≈ì, 
we get N& 	 <¬∞ and LM 	   ‚Äπ <A_ `a which both satisfy the required 
specifications. 
Now the reader may raise the question of how we can realize the 
compensation resistor. In a CMOS mixed-mode technology, several different types 
of on-chip resistors are available. The main problem with this kind of resistor is its 
extensive variations with process. From (4.25) we see that the term X0√™'$ 
depends on the ratio of two capacitances that it could be quite stable versus 
process. By implementing '$ with an MOS device that works in the triode region 
it is possible to provide this condition [4]. The schematic of the two-stage op amp 
in which the compensation resistor has been replaced by MOS devices is shown in 
Figure 4.8. In this circuit we can write 
 

 
4.1 CMOS Two-Stage Op Amp 
71 
 
 
 
-Df√™ 	 √å-eR√å  √Å
{:√≠
√ÉQ6‚ÄîF¬≤
¬≥ G√≠
  
(4.34) 
 
 
-Df 	 √å-eR√å  √Å
{:√Ö
√ÉQ6‚ÄîF¬≤
¬≥ G√Ö
 
 (4.35) 
 
If the current density in M6 and M10 are equal (i.e., we set W)√™ o p
 √™

	
W) o p
 

), from (4.34) and (4.35) we have -Df√™ 	 -Df. Summation of the 
gate-source voltages around the loop consisting of M6, M9, M10, and M11 gives 
-Df√™  -Df 	 -Df  -Df and therefore we have -Df 	 -Df. The diode-
connected M11 always works in saturation while M9 operating in triode with zero 
drain current and thus its drain-source voltage is also zero. The equivalent 
resistance of M9 is  
 
 
'"Y 	

√ÉQ6‚ÄîF¬≤
¬≥ G
‚Äú4k¬°/√å4¬£Q√å‚Äì
(4.36) 
 
On the other hand, the overdrive voltage of M11 is given by 
 
 
-Df  √å-eR√å 	 t
{:√Ö√Ö
√ÉQ6‚Äîi Z
 √Ö√Ö 	 -Df  √å-eR√å 
 (4.37) 
 
From (4.36) and (4.37), we have 
 
Figure  4.8 MOS devices used for frequency compensation. 
VDD
+
-
vi
vo
M1
M2
M3
M4
M5
M6
M7
Cc
M8
M9
M10
M11
Ib
M12

72 
CMOS Single-Ended Output Op Amp 
 
 
'"Y 	
F¬≤
¬≥ G√Ö√Ö
F¬≤
¬≥ G

¬Ø5√Ö√Ö 
 (4.38) 
 
If '"Y is used as the compensation resistor, from (4.38) it can be seen that 
X0'"Y depends on the size ratio of M11 and M9 with the minimum sensitivity 
to the process variations. By replacing '$ in (4.25) with (4.38), we have 
 
 
¬Ø5√≠
¬Ø5√Ö√Ö
F¬≤
¬≥ G√Ö√Ö
F¬≤
¬≥ G
	  
6¬≥
6, 
 (4.39) 
 
Where  is approximated by Z. The transconductance ratio in (4.39) can be 
written as 
 
 
¬Ø5√≠
¬Ø5√Ö√Ö 	 √Å
F¬≤
¬≥ G√≠
F¬≤
¬≥ G√Ö√Ö
t
{:√≠
{:√Ö√Ö 
 (4.40) 
 
Since the current density in M6 and M10 are equal and also W) 	 W), from 
(4.39) and (4.40) the size of M9 is obtained as 
 
 
F
i
Z G
 	
6,
6¬≥6, F
i
Z G
√™ √Å
F¬≤
¬≥ G√Ö√Ö
F¬≤
¬≥ G√Ö
 
 (4.41) 
 
The aspect ratio of M11 is not critical and here we take o p
  	  to save 
the chip area. Now to complete our design example, we determine the dimensions 
of the devices used to realize the resistor '$. The amount of bias current in a two-
series diode-connected M10 and M11 is optional. From W)√™ o p
 √™

	
W) o p
 

, and by choosing W) 	 B=\¬∂,p√™ 	 p 	 p 	 p 	 =\≈†, 
we can obtain o 	 W) W)√™

o√™ 	 =\≈† and from (4.41) we have o 	
B=\≈†. Simulation with these data gives N& 	 < ¬∞ and LM 	   ‚Äπ <AA_ `a. 
By applying a fine adjustment on the size of M9 through changing its width 
toB\≈†, we reach rather better results of N& 	 <A¬∞ and LM 	   ‚Äπ B<_ `a 
while the total power dissipation isA;≈† . 
4.1.4 PSRR of CMOS Two-Stage Op Amp 
This parameter indicates how much an op amp is able to attenuate any disturbance 
signal on its way from each supply to the op amp output. To obtain the 
relationship of the positive PSRR we put an ac source voltage at this supply and 
then replace the op amp circuit with its small-signal equivalent circuit and 
calculate the circuit transfer function. Figure 4.9 shows the op amp circuit in the ac 

 
4.1 CMOS Two-Stage Op Amp 
73 
 
 
condition before replacing devices by their small-signal equivalent circuits and 
also the small-signal equivalent circuit of the differential pair under the 
simplifying assumption that the output resistance of the tail transistor is infinity. 
By inspection of the small-signal circuit of the differential pair shown in 
Figure 4.9, we get the Thevenin equivalent voltage as -q¬¶ 	 -R and the Thevenin 
equivalent resistance as 
 
 

8‚Ä∞¬• 	 X"√á 
¬Ø5√ë¬Ø5√ã
¬Ø5√ë.√ÖH2 
 (4.42) 
 
with X0≈Ω 	 X0√á and assuming X0≈Ω√í"H  , we obtain 'q¬¶  √í" √ì √í"√á  '. 
Now we replace the entire small-signal model for the circuit of Figure 4.9 as 
illustrated in Figure 4.10. Summing currents at nodes A and B, we have 
 
 
41/4Q
8√Ö
 ¬Ω$-  -" 	  
 (4.43) 
 
 
¬Ω$-"  -  X"≈í-"  X0√™‚Äú-  -R‚Äì  X"√™‚Äú-"  -R‚Äì 	  
 (4.44) 
 
From (4.43) and (4.44), we can calculate the circuit transfer function as 
 
Figure  4.9 Op amp in ac condition with small-signal equivalent of its differential pair. 
M1
M2
M3
M4
M6
M7
Thevenin
equivalent
Vp
Vp
1/gm3
2ro1,2
ro4
gm4V
-
+
V
Thevenin
equivalent
Cc
Vo

74 
CMOS Single-Ended Output Op Amp 
 
 
√ó¬Ω 	
¬Ø5√≠¬Ø√≠F √Ö
√ÖK6,G √Ö
√ÖK6,/¬Ø5√≠
K6,¬Ø√≠¬Ø√ØF √Ö
√ÖK6,G/K6,K6,/¬Ø5√≠ 
 (4.45) 
 
By denoting X"√™  X"≈í  ' and noting that X"√™ ‚Ä¶ X0√™, we can simplify (4.45) 
as 
 
√ó¬Ω 	 X"√™'
K6,F8√Ö √Ö
¬ø√≠¬ø5√≠√Ö
¬ø√≠ G
K6,8√Ö82¬Ø5√≠8√Ö82 
 (4.46) 
 
In (4.46), the last term inside the parenthesis in the nominator is much greater than 
the two first terms. The same statement is true for the denominator as well. Thus, 
we can obtain the approximate value of the single pole-zero pair of the transfer 
function as LR   X0√™''$

 and L√û  X"√™ X0√™'$

. 
We have L√û LR 	 X"≈í X"√™  X"≈í  


 which means the zero takes place 
before the pole as depicted in the gain and phase frequency response of the 
transfer function in Figure 4.11. 
 
Figure  4.10 Simplified small-signal model for op amp PSRR calculation. 
 
Figure  4.11 Gain and phase versus frequency for positive supply to output transfer function. 
Vp
R1
Cc
gm6V
ro6
Vp
ro7
+
-
V
Vo
A
B
|AP(jœâ)| (dB)
œâz
AP0 
œâ
AP(jœâ)
œâ
0
œâp
œâp2
0

 
4.1 CMOS Two-Stage Op Amp 
75 
 
 
The PSRR is defined as the ratio of the differential voltage gain of the op amp 
and the voltage gain from supply to the op amp output 
 
 
NO'' 	  	
X *
+¬∫√µ
√ö¬∫√µ* 	   ‚Ñ¢¬π#√ÄL¬π    	
X¬π√ó√ÄL¬π (4.47) 
 
If the op amp frequency response #√ÄL is approximated as a single-pole 
transfer function, the magnitude of the PSRR+ frequency response can be 
represented as illustrated in Figure 4.12. As can be seen from Figure 4.12, the 
magnitude of PSRR at low frequencies (less than L√û) is even greater than the op 
amp dc voltage gain but at the frequency of L√û that is less than the op amp open-
loop bandwidth, PSRR starts dropping. This fact indicates that the performance of 
the op amp to prevent the supply noise from penetrating to the output degrades at 
frequency higher than L√û. This behavior is regarded as the main drawback of the 
two-stage op amp with this particular architecture.  
Before dealing with the circuits that can solve this issue, we first obtain the 
corresponding PSRR for the negative supply in order to compare its behavior with 
its positive supply counterpart. As explained in Chapter 1, the transfer function of 
a voltage follower implemented by an op amp from any supply to the output 
defines the PSRR associated with that particular supply. Hence, we utilize the 
circuit shown in Figure 4.13 to calculate the PSRR of negative supply. In Figure 
4.13 we have -" 	 #-"  √ó
/-K and since #  , we can write -K -"  #√ó

 
that gives the approximate value of the PSRR for negative supply. In Figure 4.14 
the small-signal equivalent circuit of the voltage follower is shown in which two 
main capacitances at the outputs of two-stages, compensation capacitance of $, 
and the gate-drain overlap capacitance of M7 are taken into account. Summation 
of currents at nodes A and B results in 
 
 
√à  ¬Ω  ¬Ω$-  X0  ¬Ω$-" 	  
(4.48) 
 
Figure  4.12 PSRR+ frequency response of a two-stage op amp. 
œâp
œâz
PSRR+
œâ
Ad
20log|
|
AP
20log|
|
-
PSRR0

76 
CMOS Single-Ended Output Op Amp 
 
 
‚ÄúX"√™  X"≈í  ¬Ω  ¬Ω$  ¬Ω¬Ø#≈í‚Äì-"Mq  X0√™  ¬Ω$- 
	 ‚ÄúX"≈í  ¬Ω¬Ø#≈í‚Äì-K  
 
 (4.49) 
 
where √à  ', √à  X"√™  X"≈í with X"√™  √í"√™, and X"≈í  √í
≈í. Solving 
(4.48) and (4.49), we can derive the PSRR of the negative supply as 
 
 
NO''/ 	
4v
4 	
UK2‚ÄûKf√Öf2¬Ø5√Ö¬Ø5√≠
‚ÄúK6¬ø+√Ø¬Ø√Ø‚Äì√îK6√Ö6,f√Ö√ï 
 (4.50) 
 
where 
√∂  $  $    ¬Ø#≈í  $¬Ø#≈í 
and 
√∏  √à‚Äú$   
¬Ø#≈í‚Äì  √à$    X0√™  X0$. 
From (4.50), the dominant pole of PSRR- is LR 	 √à  $, which is 
larger to that of PSRR+. This proves that the performance of the op amp shown in 
Figure 4.1 to prevent the high-frequency noise on the negative supply voltage from 
degrading the op amp output signal is better with respect to its positive supply 
counterpart. For a two-stage op amp with complementary structure in which the 
input transistors of the differential pair are PMOS, PSRR+ has a better high-
frequency characteristic. 
 
Figure  4.13 Configuration used to calculate PSRRR of the negative supply. 
 
Figure  4.14 Small-signal equivalent circuit of a voltage follower. 
‚àí
+
Vo
Ad
Vs
gm1Vo
R1
C1
Cc
gm6V1
+
-
V1
ro6
C2
+
Vo
-
ro7
Cgd7
ro5
Vs
A
B

 
4.1 CMOS Two-Stage Op Amp 
77 
 
 
Improvement of the PSRR+ Frequency Response: The reason for imperfect 
performance of the PSSR+ frequency response in the op amp shown in Figure 4.1 
is the existence of a low impedance path between the positive supply and output. 
This path is created by the fixed gate-source voltage of M6 and the compensation 
capacitor$ in this path. By adding a common gate stage between the gate and 
drain of M6, as shown in Figure 4.15, we can remove the low-impedance path. 
Prior to showing how the common gate stage realized by transistor M8 can 
improve the PSRR+, we first derive the voltage gain of the modified circuit in 
order to have a comparison between the main parameters such as dc voltage gain 
and the dominant pole location of the new circuit and the previous one. The small-
signal equivalent circuit and its modified version with the applied transformation 
source theorem on X0- is shown in Figure 4.16, where '  √í" √ì √í"√á √ì √í"R, 
with √í"R as the output resistance of the upper current source ofW. ' is the same as 
in Figure 4.6, and √í"Y is the output resistance of the lower current source of W, and 
since √í"Y  X0 we can take √í"Y √ì X0  X0. 
Summing currents at the input and output nodes, we can write 
 
 
X0-%  √à  ¬Ω- 	 X0- 
 (4.51) 
  
 
√à  ¬Ω-"  X0√™-  X0- 	  
 (4.52) 
 
As before, we denote √à 	 ', √à 	 '. The voltage - across the resistance 
of √í"Y √ì X0 is nearly equal to ¬Ω$-" X0  ¬Ω$

. Solving the above 
equations, we can obtain the voltage gain in s-domain as 
 
 
Figure  4.15 Modified two-stage op amp for PSSR+ improvement. 
VDD
+
-
vi
vo
M1
M2
M3
M4
M5
M6
M7
I0
Vb
Vbias
M8
I1
I1
Vb
Cc

78 
CMOS Single-Ended Output Op Amp 
 
4¬Ω 	
4
4√Ö 	
¬Ø5√Ö¬Ø5√≠
f√Öf2
 √Ç,
¬ø5K
F√Ç√Ö
¬°√Ö√Ç2
¬°2 √Ç,
¬ø5¬ø5√≠√Ç,
¬°√Ö¬°2 √Ç,
¬°2GKF√Ç√Ö√Ç2
¬°√Ö¬°2 √Ç,√Ç2
¬ø5¬°2 √Ç,√Ç√Ö
¬ø5¬°√Ö√Ç,√Ç√Ö
¬°√Ö¬°2GK2 √Ç√Ö√Ç2√Ç,
¬°√Ö¬°2¬ø5K√ë 
(4.53) 
 
First we consider a case that all three poles are real; in this situation the 
general form of the transfer function can be written as 
 
 
4¬Ω 	 4
 v
√ù√Ö
F v
Q√ÖGF v
Q2GF v
Q√ëG 
 (4.54a) 
or 
 
4¬Ω 	 4
 v
√ù√Ö
F √Ö
Q√Ö √Ö
Q2 √Ö
Q√ëGKF
√Ö
Q√ÖQ2
√Ö
Q√ÖQ√ë
√Ö
Q2Q√ëGK2
v√ë
Q√ÖQ2Q√ë
 
 (4.54b) 
 
where 4  X0X0√™ √à√à

 and √º 	 X0 $

. Because of √í"R loading on the 
first stage output, here ' is a little bit smaller than that of previous circuit and 
thus the dc voltage gain somewhat less than that of our initial circuit. If it is 
assumed that √ª ‚Ä¶ √ªH √ª≈Ω, we have  
 
 
√ª 

√Ç√Ö
¬°√Ö√Ç2
¬°2 √Ç,
¬ø5¬ø5√≠√Ç,
¬°√Ö¬°2 √Ç,
¬°2
 
 (4.55) 
 
Since the term of X0√™$ √à√à

 in the denominator of (4.55) is the largest term, 
the approximate value of the dominant pole becomes √à√à X0√™$

. This proves 
 
Figure  4.16 Small-signal equivalent circuit of a modified two-stage op amp. 
C2
+
Vo
-
gm1Vi
R1
C1
Cc
gm6V1
+
-
V1
R2
gm8V2
-
+
V2
ron
C2
+
Vo
-
gm1Vi
R1
C1
Cc
gm6V1
+
-
V1
R2
gm8V2
-
+
V2
ron||1/gm8

 
4.1 CMOS Two-Stage Op Amp 
79 
 
 
that the location of the dominant pole is almost the same as that of our initial 
circuit before adding M8. If we can also assume √ª√ª ‚Ä¶ √ª√ª≈ΩH √ª√ª≈Ω, from (4.53) 
and (4.54), we have  
 
 

R√ÖR2 
6√Ö62
f√Öf2 
6,62
¬Ø5f2 
6,6√Ö
¬Ø5f√Ö 
6,6√Ö
f√Öf2 
 (4.56) 
 
In practice, H $   and X0  √àH √à and as a result, the right side of (4.56) 
can be approximated by   $ √à√à

. Using (4.55) and (4.56), we can get 
the relationship for the second pole as 
 
 
√ª 
¬Ø5√≠
62
6,
6√ÖF√Ç,
√Ç2G 
 (4.57) 
 
It is interesting to note that under the condition that $ 

   $ 

, the 
condition that is usually met, according to (4.57) the second pole of the modified 
circuit is larger than that of our initial circuit. By equating the coefficient of the 
cubic term in the denominator of (4.53) to its corresponding term in (4.54) and 
using the approximate value of (4.57), we can obtain the third real pole as 
 
 
√ª≈Ω 
¬Ø5
6v 
T=A
 
where K  $$   is the series connection of  and $. Since K  $, 
we have √ª≈Ω  √º. The locations of poles and zero in the modified two-stage op 
amp is shown in Figure 4.17. Now we consider another possibility in which the 
modified circuit has one real pole and two conjugate poles. In this situation, the 
general form of the circuit transfer function can be represented by 
 
 
4¬Ω 	 4
 v
√ù√Ö
F v
Q√ÖG~
v
√ú v2
√ú2‚Ä¢

T=;
 
Figure  4.17 Poles and zero positions of the modified op amp. 
jœâ
œÉ
s-plane
Xp1
Xp2
z1
Xp3

80 
CMOS Single-Ended Output Op Amp 
 
where L and g are the natural frequency and quality factor of the circuit, 
respectively. The zero √º has not changed. By expanding the denominator of 
(4.59) and equating corresponding coefficients in (4.53) and (4.59) and applying 
the same approximations used in previous case, we will have 
 
 

R√Ö 

√µ 
¬Ø5√≠6,
f√Öf2  
 (4.60) 
 
 

R√Ö√µ 

√µ2 
6√Ö626,
f√Öf2
 
 (4.61) 
 
 

R√Ö√µ2 	
6√Ö626,
f√Öf2¬Ø5 
 (4.62) 
 
If √ª is assumed as the dominant pole, we have Lg  √ª and L
  √ªLg and 
thus from the above equations we can determine the relationship for √ªH L, and g 
as follows: 
 
√ª 	

¬Ø5√≠8√Ö826,
(4.63)
 
 
L 	 t
¬Ø5√≠¬Ø5
6√Ö62   
(4.64) 
 
 
g 	
6,
6,62 √Å
¬ø5√≠
√Ç√Ö
¬ø5
√Ç2
 
 (4.65) 
 
Equations (4.64) and (4.65) show that increasing X0 helps to shift L to higher 
frequencies and simultaneously decrease the quality factor g, which both help to 
improve the op amp stability According to (4.65), decreasing $ can also lessen g, 
but because this leads to increase LM 	 X0$, it causes LM to approach L and 
as a result, the phase margin degrades. It should be pointed out that in the modified 
circuit there is no need for an extra resistance to move the right half-plane zero 
into the left. In fact, M8 in addition to improving the PSRR+ as shown next, M8 
creates a left half-plane zero with a value of X0$. The price that has been paid 
for the gained advantages are slight reduction of the dc voltage gain due to the 
loading of the current source of W on the output of the first stage, increased input-
referred noise generated by the added active devices including current sources and 
M8, and more power dissipation. 
 
PSRR+ Calculation in the Presence of the Common Gate Stage: Now we are ready 
to obtain the frequency response of the PSRR+ for the circuit of Figure 4.15. We 
put an ac voltage source at the positive supply and use the Thevenin equivalent 
circuit of the first stage based on our previous discussion associated with Figure 

 
4.1 CMOS Two-Stage Op Amp 
81 
 
 
4.9. The equivalent circuit in the ac condition is illustrated in Figure 4.18. 
Summation currents at nodes A, B, and C gives 
 
 
√à  X"-  X"  X0- 	 √à-√ó 
 (4.66) 
 
 
-X"-  X"  X0  X"Y  ¬Ω$-  ¬Ω$-" 	  
 (4.67) 
 
 
X0√™-  ¬Ω$-  √à  ¬Ω$-" 	 X0√™  X"√™-√ó 
 (4.68) 
 
Neglecting X"√™ and X" against X0√™ and X0 in (4.66), (4.67), and (4.68), we have 
 
√ó
¬Ω 	 -"
-√ó
	 
¬Ø¬Ø√Ñ¬Ø5√≠F¬°√Ö¬ø5√≠
¬ø5√≠¬ø√Ñ6,KG
f√Öf2¬Ø√Ñ¬Ø5f2¬Ø√Ñ¬ØK6,f√Öf2f2¬Øf√Ö¬Ø√Ñ¬Ø√Ñ¬Øf√Ö¬Ø5¬Ø5¬Ø5√≠  
 (4.69) 
 
Since X0√™H X0  √àH √àH X√éYH X", we can obtain the approximate value of single 
zero and pole of √ó
¬Ω as L√û  X"Y$ and LR  √à√à X0√™$

. In practice, 
X"Y  √à√à X0√™

, which means the zero takes place after the pole. By considering 
the op amp voltage gain frequency response as a single-pole transfer function and 
using (4.47), we can obtain PSRR+. The magnitude of all three frequency 
responses (i.e., #√ÄL, √ó
√ÄL, and PSRR+) is plotted in Figure 4.19. This plot 
shows the modified circuit is able to attenuate the noise on the positive supply up 
to higher frequencies in comparison to our initial circuit. 
 
Op Amp Slew Rate in the Presence of the Common Gate Stage: When the op amp 
is used as a voltage follower and a relatively large step voltage is applied to its 
input, the slew rate limitation indicates itself by steering the entire tail current of 
the differential pair to one side and cutting off the other side of the pair. If the 
circuit of Figure 4.15 is used as a voltage follower and we apply a positive step 
voltage as its input, in a large-signal condition the total current of the tail 
 
Figure  4.18 Small-signal circuit for modified op amp PSRR calculation. 
+
-
V1
Cc
ron
ro7
ro6
gm8V2
gm6V1
R1
VP
+
-
V2
ro8
A
B
C
VP
+
-
Vo

82 
CMOS Single-Ended Output Op Amp 
 
transistor, W, steered toward M2 and M1 is turned off. The internal circuit of the 
voltage follower under the stated condition is represented in Figure 4.20. In this 
circuit, the charging current of $ (i.e., W) is equal to W  W  W. In order to 
keep M8 on, we need to have W  W. In the falling edge of the input voltage step, 
the direction of the current W is reversed and a current W/ in the opposite direction 
of W discharges $, which is equal to W  W  W. In order to have an output 
voltage with the same positive and negative slopes we need to have W 	 W/ that is 
equivalent to having W 	 W  W, which results in having a slew rate of W$. An 
op amp with a large slew rate requirement needs to use high tail current and the 
condition of W 	 W  W forces the designer to employ high current for the bias 
current sources. This situation not only increases the total power dissipation of the 
circuit, but also decreases the effective resistance seen at the output of the first 
stage, and in turn reduces the dc voltage gain of the op amp. 
 
Figure  4.19 PSRR+ frequency response of a modified two-stage op amp. 
 
Figure  4.20 Modified op amp circuit in large-signal conditions. 
œâp
œâz
PSRR+
œâ
Ad
20log|
|
AP
20log|
|
-
PSRR0
Vbias
M2
I0
I1
I2
Vb
M7
M6
VDD
I0
M8
Vo
I+
ID8
Cc
Vi

 
4.2 Telescopic Cascode Op Amp 
83 
 
 
 
4.2 Telescopic Cascode Op Amp 
In a two-stage op amp the entire voltage gain is the product of the voltage gain of 
two cascaded stages that can be a large number. This is one of the main 
advantages of this architecture, particularly in submicron CMOS technology in 
which providing a high voltage gain through a single stage is difficult. This is 
because of rather low drain-source resistance of MOS devices due to the short-
channel effects. A telescopic cascode op amp, in fact, is a differential pair whose 
active load is a wide swing current mirror rather than a simple one and the 
converted differential current at the drains of the differential pair is injected to the 
load through a current buffer implemented by a common gate stage. A telescopic 
op amp with NMOS input devices is shown in Figure 4.21. 
In the absence of an ac signal, similar to a normal differential pair the dc 
voltage at the output is the same as that of the drain of M3-M5 and is equal to 
-))  -Df≈íH. The low-frequency voltage gain is determined by the total equivalent 
resistance seen at the output node that consists of a parallel combination of the 
resistances of two lower NMOS and upper PMOS cascode structures. By denoting 
'"Mq  X0√á√í"√á√í" √ì X0√™√í"√™√í", the small-signal voltage gain of the cascode 
op amp becomes X0'"Mq. The drain-source resistance of each MOS device 
depends on its bias drain current as √í"% 	  |%W)%

 for ¬Æ 	  HTH<HA. Assuming the 
drain current of M1 and M2 following the square law, we can write X0H 	
‚Ä¢hY"Vo p
 HW and thus the dc voltage gain relationship can be written as 
 
Figure  4.21 Telescopic op amp. 
VDD
M1
M2
M3
M4
M5
M6
M7
M8
CL
Vo
+
-
Vi
I0
Vbp
Vbn

84 
CMOS Single-Ended Output Op Amp 
 
 
4 	
√á‚Ä¢√É√Ñ6‚Äîi Z
 √ÖH2
√è
√Ñ2
t√æ√Ñ√Ç‚Äî¬≤ ¬≥
 √ëH√ã

Q2
t√æQ√Ç‚Äî¬≤ ¬≥
 √©H√≠
√ê{
 
 (4.70) 
 
where |Y  | 	 |√á and |R  |√™ 	 | denote the parameter of | for NMOS and 
PMOS devices. Equation (4.70) indicates that for a particular tail current W, the 
only way to increase the dc voltage gain is to decrease |Y and |R by taking a long 
channel length for M2, M4, M6, and M8 and also choosing a large aspect ratio for 
input devices M1 and M2 and cascode transistors M4 and M6. 
 
The Frequency Response: The largest resistance is seen at the output node where 
there is the load capacitance so that the dominant pole of the circuit is made by 
this node. The second pole is generally associated with the mirror pole created at 
the gate of M7-M8 with a value of X0≈íH ¬ØK≈íH. This pole is usually widely 
separated from the dominant pole such that the unity gain frequency normally 
occurs before the second pole. The magnitude and phase frequency response of the 
op amp is plotted in Figure 4.22. The dominant pole is LR 	  '"MqZ

 and the 
unity gain bandwidth is given by LM 	 X0 Z

. This shows that when the load 
capacitance increases, LR and LM decrease while the second pole LR is kept 
unchanged. As a result, increasing Z helps to improve the op amp stability, which 
is the opposite of what happens in a two-stage op amp where increasing the load 
capacitance degrades the phase margin. Of course, the price that we have to pay 
for this advantage in telescopic structure is the reduction of bandwidth for a larger 
Z.
 
Figure  4.22 Gain and phase versus frequency for a telescopic op amp. 
|AV(jœâ)|
œâp1
œâp2
AV0 
œâ
AV(jœâ)
œâ
0
-180
-90
œâu

 
4.2 Telescopic Cascode Op Amp 
85 
 
 
 
Now we proceed to introduce a major drawback of the telescopic structure. 
Let us use this op amp as a voltage follower as depicted in Figure 4.23. The 
maximum allowable level of the output voltage swing is limited by entering M2 
into the triode region, which happens when the output voltage goes beyond the 
voltage of node A by one threshold voltage. Noting that the voltage at node A is 
-‚ÄûY  -fD√á, this is equivalent to have -"  -‚ÄûY  -fD√á  -e. On the other side, 
when the output voltage goes down, its swing is limited by entering M4 into the 
triode region. Thus the lower limit of the output voltage will be -‚ÄûY  -e√á. As a 
result, the allowable variation range of the output voltage is determined by 
-‚ÄûY  -e√á  -"  -‚ÄûY  -fD√á  -e or equivalently we have -"H0UV 	 -e 
-fD√á  -e√á 	 -e  -"#√á. This proves that the maximum output swing of our 
voltage follower is less than one threshold voltage independent of the value of the 
supply voltage. This is considered as a major drawback of telescopic structure, 
particularly in low-voltage design where providing large output voltage swing is 
significant. The previously mentioned imperfection regarding telescopic cascode 
can be treated by applying some modifications on the circuit structure that brings 
up the folded-cascode structure as the subject of the next section. 
 
Figure  4.23 Telescopic op amp used as a voltage follower. 
VDD
M1
M2
M3
M4
M5
M6
M7
M8
Vo
+
-
Vi
I0
Vbp
Vbn
A

86 
CMOS Single-Ended Output Op Amp 
 
4.3 Folded-Cascode Op Amp 
In a usual telescopic cascode the same type of transistors used in cascode 
structures are stacked in the differential pair. In a folded-cascode structure the type 
of the transistors used as common gate stage is different from those used in the 
differential pair.  
The PMOS transistors M6 and M7 in the circuit of Figure 4.24 act as cascode 
transistors. The PMOS current sources M4 and M5 provide the bias currents of the 
differential pair and the cascode transistors. If this circuit is used as a voltage 
follower, the maximum swing of the output is limited by entering M7 into triode, 
which is -"H0UV 	 -‚ÄûR  √å-eR√å where -‚ÄûR 	 -))  -"#√á  -Df√™ with -"#√á as the 
M4 overdrive voltage. Since -Df√™ 	 √å-eR√å  -"#√™, supposing -√é#√á  -"#√™ and 
denoting it by -"#R, we have -"MqH0UV 	 -))   -"#R. Similarly, we can easily 
indicate that the lower limit of the output voltage swing is -"H0%Y 	  -"#Y where 
-"#Y is defined as the equal overdrive voltage for M8 and M10. However, in a 
voltage follower configuration implemented by such an op amp, prior to reaching 
this minimum level, the lower output voltage swing will be limited by the input 
differential pair because the tail transistor M3 approaches the triode region.  
Now we obtain the low-frequency voltage gain of the folded-cascode op amp. 
In differential mode, the sources of M1 and M2 are virtually grounded and we can 
replace the small-signal equivalent circuit, as shown in Figure 4.25. ' denotes the 
output resistance of the cascode stage consisting of M9 and M11 that is equal to 
' 	 √í"    X0√í"√í", and ¬Æ represents the ac current entering the diode-
connected configuration of M8 and M10 and equals the partial component of the 
input current X0-%  that is divided between two parallel resistances of √í" √ì √í"√á 
and ' 	 √í"√™   X0

  X0√™√í"√™  X0√™. Since √í" √ì √í"√á  X0√™, 
 
Figure  4.24 Folded-cascode op amp. 
VDD
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
Vb
+
-
Vi
Vo
Vbp1
Vbp2
Vbn
A
B

 
4.3 Folded-Cascode Op Amp 
87 
 
 
almost the entire current of X0!%  flows through ' and ¬Æ  X0!% . 
Summation currents at nodes B and the output node give the following equations 
 
 

v¬ø√Ø
8  X"≈í‚Äú!K¬Ø≈í  !"‚Äì  X0≈í!K¬Ø≈í 	
¬Ø5√Ö
 !% 
 (4.71) 
 
 
¬Æ 


8  X"≈í‚Äú!"  !K¬Ø≈í‚Äì 	 X0≈í!K¬Ø≈í 
(4.72) 
 
where '  √í" √ì √í". From (4.71) and (4.72), the small-signal low-frequency 
voltage gain is obtained: 
 
 

 	



 	 X0
8√Ø8
8√Ø8 F 
.√Ø
8√ØG
(4.73)
 
'≈í designates the equivalent resistance seen at the drain of M7 with the value of 
'≈í 	 √í"≈í    X0≈í√í"≈í'. By defining '"Mq  '≈í''≈í  ' and noting that 
X0≈í√í"≈í  , we rewrite (4.73) as 
 	 ¬æX0'"Mq with ¬æ   ‚Äú  X0≈í√í"≈í‚Äì

. 
The coefficient ¬æ is less than one but it is very close to unity. As it is clear, the 
folded-cascode structure has the same voltage gain relationship as the telescopic. 
Moreover, in terms of frequency response, both structures have the same behavior. 
The higher-order poles are formed at node A (or B) and at the gate of M10-M11 as 
the mirror pole with approximate values of L  X0√™ ¬ØK√™

 andL0%.. 
X0‚Äú¬ØK  ¬ØK‚Äì, respectively. 
 
Design Example 
 
In this section we intend to design a folded-cascode op amp with exactly the same 
specifications given for the two-stage one. Here for the sake of simple reference, 
we repeat these specifications.  
The technology parameters are -eY 	 √å-eR√å 	 =[,hY"V 	   =\¬∂[, 
hR"V 	 =\¬∂[, and subthreshold factor - 	   #IR "V

	 T. The 
required op amp specifications are 
 
Figure  4.25 Differential-mode half-circuit small-signal equivalent circuit. 
ro6
ro1||ro4
gm1vi/2
gm6vsg6
A
+
-
vsg6
1/gm10
i10
gm1vi/2
ro2||ro5
+
-
vsg7
ro7
gm7vsg7
R9
i10
B
RA
vo

88 
CMOS Single-Ended Output Op Amp 
 
 
Dc voltage gain: 4 √∑ = (or √∑ BT>?) 
 
Unity gain bandwidth: M √∑ =_ `a 
 
Phase margin: N& √∑ <‚Ä∫ 
 
Slew rate: O' √∑ C[\] 
 
Load capacitance: Z 	 =¬µ. 
 
The design procedure begins by determining the required tail current from the 
given value for the slew rate. In a folded-cascode structure, the slew rate is 
calculated from O' 	 WZ. As a result, we should take W √∑ =\¬∂ that gives 
W) 	 W) 	 B=\¬∂. From the given bandwidth the minimum required 
transconductance of the input devices is obtained from LM 	 X0 Z

, which for 
LM 	   ‚Äπ =_ `a gives X0 	 <≈†¬∂[. The schematic of the op amp 
including bias circuitry is depicted in Figure 4.26. 
Here we have used PMOS devices as the input transistors of the differential 
pair. In an n-well CMOS technology, PMOS devices are implemented within the 
n-well and it is possible to tie the body and source terminals together for each 
PMOS device that has been placed in a separate n-well. This possibility can help 
us to avoid the body effect. Moreover, from the noise standpoints, as discussed 
previously, the flicker noise of PMOS transistors is less than that of NMOS at least 
by one order of magnitude which in turn helps to reduce the input refereed noise. 
Because the mobility of carriers in PMOS transistors is less than that of carriers in 
NMOS devices, to get the equal transconductance at the same bias current, we 
have to choose the PMOS aspect ratio larger to the extent that it compensates for 
 
Figure  4.26 Design example of a folded-cascode op amp with PMOS input devices. 
M1 
M2 
M3 
M4 
M5 
M6 
M7 
M8 
M9 
M10 
M11 
M12 
M13 
M14 
M15 
M16 
M17 
M18 
CL
VDD
Vbp
Vbn
+
-
vi
vo
Ib
I4
I5
I0

 
4.3 Folded-Cascode Op Amp 
89 
 
 
its smaller carrier mobility. This larger size, as an extra bonus, helps to reduce the 
input noise and offset voltage as well. Of course, large devices with rather small 
drain current may put PMOS devices in the subthreshold region. If that occurs, we 
no longer can reach the required transconductance by increasing the aspect ratio 
for a fixed drain current. As a result, the drain current of M1 and M2 is raised to 
;\¬∂ to make sure the required transconductance is achievable. A low-level drain 
current makes it easier to get the required voltage gain by increasing the drain-
source resistance of transistors but because sizing is rather large, devices work 
somewhere between saturation and moderate inversion, which causes deviation of 
the transconductance relationship from the ideal quadratic form. This issue may be 
considered 
by 
taking 
¬æ  B 
With 
this 
value 
for 
¬æ, 
from
X0H 	 ¬æ‚Ä¢hR"Vo p
 HW √∑ <≈†¬∂[ we need to meet the inequality 
o p
 H  =A. By taking o p
 H 	 < and in order to avoid dropping the 
dc gain due to short-channel effects in M1 and M2, we choose pH 	 T\≈† and 
thusoH 	  T\≈†. The current sources implemented by M4 and M5 should 
provide the drain current of M1 and M2 and also the current of cascode transistors 
M6 to M8. In a large-signal condition when the tail current is steered toward M1 
or M2, the tail current plus the cascode bias current flow through M4 or M5 and 
therefore the current of M4 or M5 should be larger than the tail current in order to 
avoid turning off the cascode devices in this condition. Thus the amount of current 
in M4 and M5 is chosen somewhat more than the tail current. Here we take 
W√á 	 W 	  W 	  <\¬∂ The size of the rest of the main transistors including 
M4 to M11 are all calculated by allocating proper overdrive voltages to them. To 
get reasonable aspect ratio for devices and enough output voltage swing, an 
overdrive voltage of approximately≈†[ is allocated to M6, M7, and about 
 ≈†[ is chosen for M4 and M5 and M8 to M11. The reason that we choose a 
smaller overdrive voltage for NMOS devices is that when this architecture is used 
as a voltage follower, the lower limit of the output voltage swing is determined by 
the sum of the overdrive voltage of the output NMOS transistors (i.e., M5 and M7) 
that is !"H0%Y 	 -"#  -"#≈í, but the output swing from above, prior to reaching 
-))  -"#  -"#, is limited by M1 and M3 in the input stage. This means that 
allocating large sizes to M8 to M11 just degrades the stability by lowering the 
mirror pole location without influencing the effective output swing. M4 (M5) 
carries the largest current and thus its overdrive voltage is chosen about ≈†[ to 
get reasonable aspect ratio. Based on the given process data and with these 
overdrive voltages, the aspect ratio of o p
  	   is obtained for M6 to M11 
and o p
 √áH 	 < for M4 and M5. In order to have adequate large output 
resistance to achieve the required dc voltage gain, the channel length of 
p 	 =\≈† is selected for M6 to M11. Therefore the aspect ratio of M6 to M11 
will be obtained as <\≈† =\≈†

. The loading effect of the drain-source 
resistance of M4 and M5 leads to decrease the voltage gain. Since these devices 
carry relatively large currents, it is necessary to minimize the parameter of 

90 
CMOS Single-Ended Output Op Amp 
 
| 	 }#K ‚Äúp‚Ä¢-)D  -)DHKUq‚Äì

 to gain the maximum resistance (√í" 	 |W))). With 
this aim in view, we increase the drain-source voltage, -)D√á 	 -)D 	 -‚ÄûY 
-fD√™H≈í, by raising -‚ÄûY and select a channel length of p√á 	 p 	 \≈†, as well. The 
transistors (M15, M16) and (M17, M18) are used to provide the bias voltages -‚ÄûY 
and -‚ÄûR, respectively. The bias current source W‚Äû 	 A\¬∂ with the aid of M12, 
M13, and M14 supplies the current of the tail transistor M3 and transistors M4 and 
M5. The results obtained from the circuit simulation are 4 	 BTC>?, 
LM 	   ‚Äπ = _ `a, N& 	 B;‚Ä∫, and a power dissipation of C≈† . Output 
slew rate on the positive slope is O' 	  ;= [ \]

 and on the negative slope is 
O'/ 	 C=B[\]. Although these results indicate the performance superiority of a 
two-stage op amp over the folded-cascode architecture in terms of the voltage 
gain, bandwidth, and power consumption but the PSRR frequency response of a 
folded-cascode is much better than that of a normal two-stage one. More 
importantly, the process of frequency compensation here is very simple. Actually 
the load capacitance itself plays the role of the compensation capacitance and there 
is no need for an extra component as a compensation capacitor. 
4.4 Current Mirror Op Amp 
A basic schematic of a current mirror op amp is shown in Figure 4.27. In the 
presence of the ac input signal the total current of M1 (M3) and M2 (M4) can be 
written as 
 
 
¬Æ) 	 ¬Æ)≈Ω 	 W 
¬Ø5√ÖH2



 (4.74) 
 
 
¬Æ) 	 ¬Æ)√á 	 W 
¬Ø5√ÖH2



(4.75) 
 
These currents are amplified by two current mirror pairs of M4-M6 and M7-M8 
and appear at the drain of M6 and M8: 
 
 
¬Æ)√™ 	 }W  }
¬Ø5√ÖH2



 (4.76) 
 
 
¬Æ) 	 }W  }
¬Ø5√ÖH2



 (4.77) 
 
The difference of the two currents above flows through the equivalent output 
resistance seen at the output node (i.e., '"Mq  X"√™  X". The output 
voltage becomes -" 	 '"Mq¬Æ)√™  ¬Æ) and thus the low-frequency small-signal 
voltage gain is given by 
 

 	



 	
‚Ä°¬Ø5√ÖH2
¬Ø√≠¬Ø 
 (4.78) 

 
4.4 Current Mirror Op Amp 
91 
 
 
Since X"√™ 	 |RW)√™ and X" 	 |YW) with W)√™ 	 W) 	 }W and assuming the 
square law is held for the drain current of M1 and M2 such that we can 
writeX0H 	 ‚Ä¢ hY"Vo p
 HW)H, from (4.78) we have 
 
 

 	
t√É√Ñ6‚ÄîF¬≤
¬≥ G√ÖH2
‚Äú√∞√Ñ√∞Q‚Äì‚Ä¢{  
 (4.79) 
 
It is interesting to note that the dc voltage gain is independent of the K factor in the 
current mirrors. Thus, for a certain bias current W, the only way to increase the 
voltage gain is to choose a long-channel length for M6 and M8 and increase the 
aspect ratio of the input devices, M1 and M2, provided that these devices remain 
in strong inversion. As discussed earlier, by increasing the transistor aspect ratio, 
at a certain drain current, an MOS device ultimately reaches a point at which the 
following inequality is held: 
 
 
{:√ÖH2
F¬≤
¬≥ G√ÖH2
  hY"V--q¬¶ 
 (4.80) 
 
When the left-side term in (4.80) is adequately less than the right-side term, 
transistors work in the weak inversion area with a new relationship for the 
transconductance, X0H 	 W)H--q¬¶. In this condition the dc voltage gain is 
specified as 
 

 	

‚Äú√∞√Ñ√∞Q‚Äì¬±4‚Ä∞¬•
(4.81) 
 
Figure  4.27 Schematic of a CMOS current mirror op amp. 
VDD
2I0
1:K
1:1
1:K
+
-
M1
M2
M3
M4
M5
M6
M7
M8
CL
vi
vo

92 
CMOS Single-Ended Output Op Amp 
 
In the subthreshold region, corresponding to a weak inversion state, the voltage 
gain can be increased just by selecting a large channel length for the output 
devices M6 and M8.  
 
Frequency Response: The highest resistance is seen at the output node. Thus, we 
expect the dominant pole of the circuit to be formed by this resistance and the load 
capacitance at the output. The second pole is normally related to the gate of M3-
M5 or M4-M6 with the value of X0√á √á

 where √á is the total capacitance seen at 
the common gate of M4 and M6 and it is equal to √á 	 }  ¬ØK√á. Since 
X0√á 	 ‚Ä¢ hR"Vo p
 √áW and ¬ØK√á 	  C
 op√á"V, the second pole can be 
written as 
 
 
LR 	
≈Ω


ÀúZ√ã
√ë
2 t
√ÉQ{
i√ã6‚Äî 
 (4.82) 
 
If the second pole places after the unity gain bandwidth frequency, the voltage 
gain frequency response of the current mirror op amp will be similar to what is 
plotted in Figure 4.22 for a folded-cascode op amp. Here we have 
LR 	 LM 
with 
 	 }X0'"Mq and LR 	  '"MqZ

, which gives LM 	 }X0Z. 
Although the current mirror gain of } has no effect on the dc voltage gain, but for 
the same amount of X0 and Z in current mirror and folded-cascode structures, 
the bandwidth is expanded by the factor of } in the current mirror op amp. In 
other words, at certain load capacitance in a current mirror op amp, it is possible to 
achieve the same bandwidth as the folded-cascode structure by choosing a lower 
input transconductance that alleviates the design of the input differential pair. The 
slew rate in a large-signal case, when the tail current entirely conducted by one of 
two branches of the differential pair, the amplified copy of the tail current (i.e., 
 }W) charges or discharges the load capacitor and thus the slew rate is given by 
O' 	  }WZ. Here again, current gain factor of } helps to improve the slew 
rate. Now the question may be raised that based on what criterion is the value of } 
determined. The answer to this question is found in conjunction with the op amp 
frequency response stability. From (4.82) and based on the bandwidth relationship 
of LM 	 }X0Z, we notice that increasing } simultaneously raises the 
bandwidth and lowers the second pole, and thus lessens the phase margin 
according to N& 	 ;  √≥√¥c/‚ÄúLM LR

‚Äì. For example, to have a phase margin of 
<‚Ä∫ we need to have LR √∑ dCLM or equivalently the following inequality should 
be satisfied: 
 
 
¬Ø5√ã
‚Ä°6¬øv√ã √∑ dC
‚Ä°¬Ø5√Ö
6¬≥ 
(4.83) 
 
By substituting transconductance relationships into (4.83), we have 

 
4.4 Current Mirror Op Amp 
93 
 
 
 
} 	 }  }  √Å
√ÉQF¬≤
¬≥ G√ã
≈Ω√É√ÑF¬≤
¬≥ G√Ö
6¬≥
6¬øv√ã  √£ 
 (4.84) 
 
The plot of Figure 4.28 illustrates the maximum allowable value of } that can 
meet our minimum acceptable phase margin in which √£ denotes the fixed right-
side term in (4.84). In practice, based on the typical values for the circuit 
parameters, the range of C  }  = is appropriate to achieve the required phase 
margin. The main drawback of the structure in Figure 4.27 is that it cannot provide 
enough dc voltage gain. This imperfection can be treated by employing cascode 
configuration, as shown in Figure 4.29. Similar to the simple structure, the dc 
voltage gain is obtained as  
 
 

 	



 	
‚Ä°¬Ø5√ÖH2
fQf√Ñ 
 (4.85) 
 
where √à"R  X"X" X0

 and √à"Y  X"X"√á X0

. Assuming the same 
transconductance for the cascode devices, M10 and M12, and denoting it as X0$ 
with the square law condition being held, we have 
 
 
X0$ 	 }thR"VW F
i
Z G
≈ΩH√á 
 (4.86) 
 
Now by substituting the output conductance of each device with X" 	 |W) and 
using (4.86), we can rewrite (4.85) as 
 
 

 	
√á6‚Äît√É√Ñ√ÉQF¬≤
¬≥ G√ÖH2F¬≤
¬≥ G√ëH√ã
{‚Äú√∞√Ñ2√∞Q2‚Äì
 
 (4.87) 
 
Here again the current gain factor } has no effect on the dc voltage gain and the 
possible measures that can be taken to increase the voltage gain are to use long 
 
Figure  4.28  Plot to determine the upper limit of the current mirror gain factor. 
T0
K
Kmax
K/(K+1)
f(k)

94 
CMOS Single-Ended Output Op Amp 
 
channel length for output devices including M8, M10, M12, and M14, to increase 
the aspect ratio of M1 to M4, of course as long as they operate in the saturation 
region, and finally, if possible, to lower the bias current W, although the value of W 
is usually set in advance based on the given specification for the op amp slew rate. 
 
Design Example 
 
Now we proceed to design our op amp with the previously given parameters and 
in the same technology, but this time we employ the current mirror structure. In 
both previous design examples, in order to provide the required transconductance 
of the input devices we had to take a larger tail current that led to obtaining higher 
slew rate. In general, this can be regarded as a benefit from a design point of view. 
Here we choose a slew rate of T[\] from scratch. To achieve the required 
BT-dB voltage gain, we use the cascode structure shown in Figure 4.29.  
First, by choosing } 	 T from the given slew rate, we obtain the tail transistor 
current. The relationship of O' 	 }W Z

, for Z 	 =¬µ and O' 	 T[\], gives 
W 	 =\¬∂. Then, based on the required bandwidth we calculate the input device‚Äôs 
transconductance from X0H 	 LMZ} that gives X0H 	 C;C\¬∂[. By being 
specified X0H and the bias current, we can calculate the input device aspect 
ratios. Using a quadratic relationship for the drain current, we obtain the aspect 
 
Figure  4.29 Current mirror op amp with a cascode structure. 
I0
1:K
1:1
1:K
+
-
M1
M2
M3
M4
CL
vi
vo
VDD
Vbn
Vbp
M5
M6
M7
M8
M9
M10
M11
M12
M13
M14

 
4.4 Current Mirror Op Amp 
95 
 
 
ratio from X0H √∑ ¬æ‚Ä¢hY"Vo p
 HW with ¬æ 	 A, we should have 
o p
 H √∑  T. We choose o p
 H 	 C in order to ensure that our required 
transconductance is reached. At this stage, we can allocate the minimum feature 
size of the technology to channel length but taking pH 	 =\≈† leads to larger 
gate area, which helps to reduce the flicker noise and input-referred offset voltage. 
By this channel length the input transistors widths become oH 	 =\≈†. Sizing 
of the output transistors M8, M10, M12, and M14 are calculated based on the 
desirable output voltage swing. We have !"H0UV 	 -))   -"#R with -"#R as the 
overdrive voltage of the PMOS devices. For !"H0UV √∑  [, we need to have 
-"#R   [. Since the drain current density W)o p
  is the same for all MOS 
devices from M3 to M14, the overdrive voltages of all PMOS devices are equal to 
each other. The same statement is true for all NMOS devices. Thus we can also 
apply the condition of -"#R   [ for M3 to M6. The inequality -"#≈Ω   [ 
gives o p
 ≈Ω √∑  =, which can also be used for M4, M5, M6, M7, and M8. By 
settingo p
 ≈Ω/ 	 C, the overdrive voltage of about A[ is obtained. An 
overdrive voltage of =[ for M11 and M12 leads to aspect ratio of 
o p
 H≈Ω 	  . To somewhat minimize parameters |Y and |R and in order to 
take into account the matching issues in the layout of current mirror circuitries, 
here we set the length of all PMOS transistors on =\≈†. As discussed in Chapter 
2, the parameter |R in PMOS devices, at the same bias and channel length 
condition, is slightly smaller than |Y. On the other hand, the maximum voltage 
gain is achievable if the equivalent output resistances of the PMOS and NMOS 
devices are equal to each other. By allocating larger channel length to NMOS 
transistors, it is possible to have |Y  |R. For the same drain current, this results in 
having equal output resistance in PMOS and NMOS devices and thus maximum 
voltage gain. In this design,  =\≈† is chosen for the channel length of all NMOS 
devices. With the given length for PMOS and NMOS transistors, their widths 
become=\≈† for all transistors from M3 to M8 and M11 and M13. The sizing of 
M8, M10, M12, and M14 are larger by the factor of } in two upper and lower 
current mirror circuits. After adding proper bias circuitries, simulation results 
show the designed op amp has more thanA>? voltage gain with the phase 
margin of<T‚Ä∫ but its bandwidth is less than TA_ `aThis is because of some extra 
parasitic capacitances of the devices at the output that increase the effective load 
capacitance. There are two ways to increase the bandwidth. One way is to raise the 
input transconductance X0H The second way is to increase the current mirror 
gain of } by a little bit. The latter is more feasible because the phase margin is 
more than our requirement and there is still enough room to make LM and LR 
closer together. The complete designed circuit including the bias circuitries with 
all sizes is shown in Figure 4.30. Summarized specifications of the designed 
current mirror op amp are: 

96 
CMOS Single-Ended Output Op Amp 
 
 
‚Ä¢ 
Dc voltage gain: 4 	 A<>? 
‚Ä¢ 
Unity gain bandwidth: M 	 =;_ `a 
‚Ä¢ 
Phase margin: N& 	 <T‚Ä∫ 
‚Ä¢ 
Slew rate: O' 	 T; [ \]

H O'/ 	 C<A [ \]

 
‚Ä¢ 
Power dissipation: N# 	 =C≈† 
‚Ä¢ 
Power Supply Rejection Ratio: 
‚Ä¢ 
NO'' 	 ;BT>?H /≈Ω#‚Ä¢ 	 T=≈ì`a 
‚Ä¢ 
NO''/ 	 A= >?H /≈Ω#‚Ä¢ 	 TB≈ì`a 
4.5 Rail-to-Rail Input Op Amp 
In a voltage follower implemented by a single-ended output op amp, three voltages 
at the inverting and noninverting inputs and at the output are all approximately 
equal to each other. This means that the input common-mode voltage that is 
defined as the average of the voltages at two inputs is the same as the input or 
output signals. Hence if we intend to have a single-ended output op amp where the 
output voltage can swing close to two supply rails, the input common-mode range 
(ICMR) also needs to be able to have the same swing without any remarkable 
change in the main op amp specifications such as voltage gain, bandwidth, and 
phase margin.  
Thus far, in all op amp architectures that we have studied, the input stage 
consists of an NMOS or PMOS differential pair in which the input common-mode 
voltage is limited at a level quite below the positive supply or above the ground 
level depending on the type of the differential pair used. In an NMOS differential 
 
Figure  4.30 Schematic of the designed current mirror op amp. 
1:K
1:1
1:K
+
-
M1
M2
M3
M4
CL=5 pF
vi
vo
VDD=2.5 V
Vbn
Vbp
M5
M6
M7
M8
M9
M10
M11
M12
M13
M14
M15
M16
M17
M18
M19
M20
M21
M22
M23
M24
15/0.5
15/0.5
15/0.5
65/0.5
15/1.25
65/1.25
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
0.5/1
1/0.5
10 ¬µA
25/0.5

 
4.5 Rail-to-Rail Input Op Amp 
97 
 
 
pair, the input common-mode voltage can change close to [√ç√ç but it is limited to 
-%$H0%Y 	 -fDY  -"#H{ from below, where -fDY is the gate-source voltage of the 
NMOS input devices. In fact, when-%$ goes below -%$H0%Y the tail current source 
transistor enters the triode region, and in consequence, the tail current starts 
dropping. As a result, the input stage transconductance begins to fall. The opposite 
occurs in the case of a PMOS differential pair where the input common-mode 
voltage can go down around the ground level, but from above it is restricted to 
-%$H0UV 	 -))  -DfR  -"#H{, with -DfR as the dc gate-source voltage of the 
PMOS input devices. A pictorial representation of the matter is illustrated for two 
different types of differential pairs in Figure 4.31.  
Since the input transconductance has a direct impact on voltage gain and 
bandwidth, we need to keep the input transconductance constant in spite of 
variation in -%$. From Figure 4.31, the first idea that may come to mind is to use 
the parallel combination of two PMOS and NMOS differential pairs. Figure 3.32 
represents the schematic of the related circuit and its corresponding 
transconductances. As it is obvious, the downside of the circuit is that its total 
 
Figure  4.31 ICMR of NMOS and PMOS differential pairs with their corresponding transconductance
variation versus . 
VGSn
Vod,I0
ICMR
M1
M2
+
-
vi
I0
VDD
Vic
gmn
VDD
VGSn+Vod,I0
VTn
VSGp
Vod,I0
ICMR
+
-
vi
I0
VDD
M1
M2
Vic
gmp
VDD
VDD-VSGp-Vod,I0
0
0
VDD-|VTp|

98 
CMOS Single-Ended Output Op Amp 
 
transconductance has a bump in the middle zone of -%$ where both pairs are on and 
as a result, the total transconductance is nearly twofold if it is supposed that two 
differential pairs have the same transconductance in the midrange of -%$.  
This variation in transconductance shows its effect on voltage gain, 
bandwidth, and phase margin, and it is quite possible that causes instability. We 
need to find a way to keep the total transconductance constant when input 
common-mode voltage changes between 0 and [√ç√ç. If the condition of square law 
is held for all MOS devices, the transconductance of two NMOS and PMOS 
differential pairs are X0Y 	 ‚Ä¢hY"Vo p
 YW‚Ä¢w and X0R 	 ‚Ä¢hR"Vo p
 RW‚Ä¢√ó, 
respectively, where o p
 Y and o p
 R are the associated aspect ratios of two 
pairs. Assuming hY"Vo p
 Y  hR"Vo p
 R  ¬∞, we have X0q 	 ‚Ä¢¬∞‚Äú‚Ä¢W‚Ä¢w 
‚Ä¢W‚Ä¢√ó‚Äì In order to have a constant total transconductance, the term inside the 
parenthesis inX0q should be kept constant. A translinear loop can provide this 
condition.  
A translinear loop is a closed-loop consisting of translinear components. Any 
electronic device whose transconductance is a linear function of its current or 
voltage is known as a translinear element. For example, a bipolar transistor with an 
exponential 
relationship 
is 
a 
current 
translinear 
device 
because 
its 
transconductance is a linear function of the collector current (X0 	 W6 -q¬¶

). An 
MOS device with quadratic relationship for the drain current acts as a voltage 
translinear device in which the transconductance is a linear function of the gate-
source voltage X0 	 ¬∞-fD  -e. Now consider the given circuit in Figure 4.33. 
The gate-source voltages of M1 to M4 form a translinear loop. Summation of 
voltages around the loop results in 
 
 
-fD  -fD 	 -fD≈Ω  -fD√á
TAA
 
Figure  4.32  Schematic of combined NMOS and PMOS differential pairs with their corresponding
transconductance variation versus Vic. 

 
4.5 Rail-to-Rail Input Op Amp 
99 
 
 
 
Since for each device we have 
 
 
-fD% 	 -e%  √Å
{:
√É√Ñ6‚ÄîF¬≤
¬≥ G
¬Æ 	 H HCHT 
 (4.89) 
 
Assuming all transistors are identical, by substituting the corresponding drain 
current for each device from (4.88) and (4.89), we have ‚Ä¢W‚Ä¢w  ‚Ä¢W‚Ä¢√ó= ‚Ä¢W. A 
practical circuit that works based on this concept is shown in Figure 4.34 [5]. (Ma, 
Mb) and (Mc, Md) are two parallel PMOS and NMOS differential pairs with MP 
and MN as their tail transistors whose currents are controlled by the rest of the 
circuit. The currents W≈Ω andW√á are adequately less than currents W,W‚Ä¢w, and W‚Ä¢√ó. As 
well, all PMOS devices including M1, M2, M3, M4, M5, and MP are identical. 
Transistors MP, M3, M4, and M5 form a translinear loop with the following 
relationship among their gate-source voltages: 
 
 
-Df√ö  -Df≈Ω 	 -Df√á  -Df
T;
 
In the circuit of Figure 4.34 two identical devices, M2 and M3 have the same drain 
current and thus we have -Df≈Ω 	 -Df 	 -Df. On the other side, for M1 we can 
write 
 
-Df≈Ω 	 -Df 	 √å-eR√å  √Å
{¬®√õ {√ë
√ÉQ6‚ÄîF¬≤
¬≥ G√Ö
 
 (4.91) 
 
By substituting each gate-source voltage into (4.90) by its value given in (4.89) 
 
Figure  4.33 MOS translinear loop. 

100 
CMOS Single-Ended Output Op Amp 
 
and (4.91), and taking into account the associated drain current of each device, 
after simplification, we obtain 
 
 
‚Ä¢W‚Ä¢√ó  ‚Ä¢W‚Ä¢w  W≈Ω 	 ‚Ä¢W  W√á  ‚Ä¢W√á 
 (4.92) 
 
Since W≈Ω ‚Ä¶ W‚Ä¢w and W√á ‚Ä¶ W, we can approximate (4.92) as ‚Ä¢W‚Ä¢√ó  ‚Ä¢W‚Ä¢w  dW. The 
derived relationship can be qualitatively justified as follows. When the input 
common-mode voltage is too small, the differential pair M6, M7 is almost off and 
thus M1 carries the small current of W≈Ω. The current mirror M1-M2 makes a copy 
of W≈Ω into M2 and M3. The gate-source voltage of M3 is small because of its low 
drain current. As a consequence, since the right side of (4.90) is fixed, and a 
decrease in -Df≈Ω should be compensated for by increasing -Df√ö, which in turn, 
raises the tail currentW‚Ä¢√ó. When the input common-mode voltage is close to [√ç√ç, 
the differential pair (Ma, Mb) is almost off but (M6, M7) is on and the bias current 
W‚Ä¢w flows through M1-M2 and then flows into M3 and establishes its gate-source 
voltage -Df≈Ω. From (4.90), we see that a noticeable voltage places across the gate-
source of MP, but because its drain current is too small, MP goes to the triode 
region with the following relationship: 
 
 
W)√ö 	 hR"V F
i
Z G
√ó √ß‚Äú-f√ö  √å-eR√å‚Äì-D)√ö 
4k:√ö
2
 √® 
 (4.93) 
 
From (4.93), with W)√ö  , we have -D)√ö   and -Df√ö  √å-eR√å  -D)√ö  


√å-eR√å. This analysis proves that in spite of the drain current of MP being too small, 
this device does not operate in the subthreshold region, a working area in which 
 
Figure  4.34 A constant-gm circuit that works based on the translinear loop concept. 
VDD
M1
M2
M3
M4
M5
M6
M7
M8
MN
MP
I
I4
I3
+
-
vi
+
-
vi
+
-
vi
IBP
IBN
IBN
Vbias
Ma
Mb
Mc
Md

 
4.5 Rail-to-Rail Input Op Amp 
101 
 
 
-Df√ö  √å-eR√å and the drain current equation is completely different. Now by 
substituting -Df√ö  √å-eR√å in (4.90) and repeating the same procedure that was done 
to reach (4.92), we will get 
 
 
‚Ä¢W‚Ä¢w  W≈Ω 	 ‚Ä¢W  W√á  ‚Ä¢W√á
 (4.94) 
 
The existence of the current source W≈Ω in the circuit is important. In fact, for a 
too-small input common-mode voltage the pair of (M6, M7) is approximately off 
and W≈Ω is the only remarkable current that causes M1 to remain in the saturation 
region. Otherwise for very low level drain current of M1, this device and also M2 
and M3 would operate in the subthreshold region. In this situation, due to the 
exponential relationship for the M3 drain current, the loop consisting of MP, M3, 
M4, and M5 no longer acts as a conventional translinear loop.  
Figure 4.35 indicates another circuit that works based on the translinear loop 
concept to realize a constant-gm input stage [6]. Here the translinear loop consists 
of transistors M1, M2, M3, and M4. A detailed analysis of the circuit is left as an 
exercise to the interested reader.  
Another method to attain a constant-gm input stage is to utilize the quadratic 
relationship of the MOS drain current. The transconductance of an MOS device 
with such a relationship changes as a square root function of the drain current. If it 
is supposed that the transconductances of two differential pairs are the same at the 
midrange of the input common mode voltage, the total input transconductance will 
be two times the transconductance of each single pair. Now in two low and high 
extremes of the input common-mode voltage variations between 0 and -)), one of 
two differential pair turns off and it is just enough to increase the tail current of the 
conducting differential pair fourfold. This causes a single turned-on differential 
pair that provides the same total transconductance that would be produced in the 
midrange of the input common-mode voltage by both pairs. Different constant-gm 
 
Figure  4.35 Another example of a circuit that works based on the translinear loop concept. 

102 
CMOS Single-Ended Output Op Amp 
 
circuits have been introduced in the literature that all work based on the above- 
mentioned principle [7-8]. The circuit shown in Figure 4.36 is another example 
that uses this method to provide a constant transconductance against the variation 
of the input common-mode voltage.  
In this circuit, when the input common-mode voltage is close to zero, two 
NMOS differential pairs (M1, M2) and (M12, M13) turn off, and in consequence, 
M5, M10, and M11 also turn off. On the other hand, both PMOS differential pairs 
(M3, M4) and (M6, M7) turn on, and as a result, current W‚Ä¢√ó flows through (M6, 
M7), which turns M8 and M9 on. But M5 is off and thus M9 goes to the triode 
with nearly zero drain current and voltage. This ensures that the current mirror 
M15-M16 is off. The current mirror M8-M14 transfers the current W‚Ä¢√ó to the 
second current mirror created by M17-M18 that adds three times of W‚Ä¢√ó to the tail 
of the PMOS input differential pair. At the other extreme of the input common-
mode voltage close to the positive supply, two PMOS differential pairs (M1, M2) 
and (M6, M7) are off. This time M8, M9, and M14 are off and M10 goes to the 
triode region with nearly zero drain-source voltage, which makes current mirror 
M17-M18 off. In this situation, the current mirror M11-M15 transfers W‚Ä¢w to the 
current mirror of M15-M16 with the gain of three that adds CW‚Ä¢w to the tail current 
of the NMOS differential pair (M3, M4). When input common-mode voltage 
varies somewhere at the middle of zero and[√ç√ç, all differential pairs of both types 
conduct. Assuming W‚Ä¢√ó 	 W‚Ä¢w, we can see the current flowing through two 
transistors pairs of (M5, M9) and (M10, M14) are approximately the same, and 
therefore both current mirrors M15-M16 and M17-M18 are nearly off and cannot 
add noticeable current to the tail current of the input differential pairs. In this 
condition, the aggregated transconductance of the NMOS and PMOS differential 
pair contribute in total transconductance. In low-power designs, MOS devices 
usually work in the subthreshold region where transconductance is directly 
 
Figure  4.36 Newly introduced constant-gm input stage. 

 
4.5 Rail-to-Rail Input Op Amp 
103 
 
 
proportional to the drain current (X0HKM‚Äû 	 W) --q¬¶

). In this case, obtaining a 
constant transconductance is feasible by keeping the sum of the drain bias current 
of the two differential pairs constant [9]. The circuit realization of this condition is 
normally more convenient in comparison to the situation where MOS devices 
work in strong inversion with the square law relationship. 
 
Current Combiner Circuit: We now proceed to study the circuit used for 
combining the drain currents of the input stage to reach a single-ended output 
voltage. Figure 4.37 represents one circuit that can be used for this purpose where 
for the sake of clarity, the circuit used for keeping the input transconductance 
constant has not been shown. 
Summing currents at the drain of M5 and M6 and at the source of M9 and 
M10, we obtain the following equations: 
 
 
¬Æ 	 ¬Æ)≈Ω  ¬Æ
 (4.95) 
 
 
¬Æ 	 ¬Æ)√á  ¬Æ≈Ω
 (4.96) 
 
 
¬Æ  ¬Æ) 	 W
 (4.97) 
 
 
¬Æ  ¬Æ) 	 W
 (4.98) 
 
 
Figure  4.37 Schematic of a current combiner. 
vi1
vi2
M1
M2
M3
M4
IS
IS
I0
I0
M5
M6
M7
M8
M9
M10
VBN
VBP
iD1
VDD
i1
i3
iD3
iD4
Vo
iD2
i2
i
i

104 
CMOS Single-Ended Output Op Amp 
 
From the above equations, we can get the output current as 
 
 
¬Æ"Mq 	 ¬Æ≈Ω  ¬Æ 	 ¬Æ)  ¬Æ)  ¬Æ)≈Ω  ¬Æ)√á 
 (4.99) 
 
where ¬Æ)  ¬Æ) is the differential output current of the PMOS differential pair that 
is equal to X0R!%  !%. Similarly, we have ¬Æ)≈Ω  ¬Æ)√á 	 X0Y!%  !% for the 
NMOS pair. The ac output current ¬Æ"Mq flows through the equivalent resistance 
seen at the common drain of M8 and M10 (i.e., '"Mq). By denoting !% 	 !%  !%H 
the output voltage becomes !" 	 ‚ÄúX0Y  X0R‚Äì'"Mq!% with '"Mq 	 '"w √ì '"√ó in 
which '"√ó  X0√í"√í"√™ √ì √í"√á and '"w  X0√í"√í" √ì √í". √í"represents the 
output resistance of the current sourceW. 
It should be pointed out that the bias voltages -‚Ä¢w and -‚Ä¢√ó need to be 
carefully chosen such that all input transistors, M1 to M4, always remain in 
saturation at the extremes of the input common-mode voltage, -%$. For instance 
when -%$ varies around the zero, the pair of (M1, M2) is the only conducting pair, 
and thus the maximum drain voltage of M1 and M2 should not be beyond one 
threshold voltage of √å-eR√å in order to keep these devices in saturation. This means 
that we should have -‚Ä¢w  -fD  √å-eR√å. Likewise, at the other extreme (i.e., for 
-%$ 	 -))), we need to meet the condition of -‚Ä¢√ó  -))  -Df≈í  -eY≈Ω to keep 
M3 and M4 in saturation. Another important point with regard to the dc condition 
is related to the value of W. As discussed earlier, for -%$  , the X0 control circuit 
increases the tail current of the PMOS pair from WK to TWK to have a constant X0 in 
the input stage. In this case, we have W) 	 W) 	  WK and W 	 W   WK where W is 
the dc current of the cascode transistors (i.e., M7 to M10). In order to keep turning 
on these devices we need to have W   or equivalently W   WK. In the midrange, 
when we have -%$-)) , W) 	 W) 	 WK  and W 	 W  WK . Now we have to 
meet W  WK  and finally at the extreme of -%$-)), W)≈Ω 	 W)√á 	  WK and W 	 W. 
One measure that can be taken to make sure that the cascode devices always 
remain on for -%$ variation between to -)), is that we use a fixed value of 2WK for 
W. In this condition, W changes from zero to  WK when -%$ changes from  to -)) 
This causes a significant variation of the small-signal parameters of the cascode 
devices that can affect the dc voltage gain and also changes the location of the 
second pole, in turn, impacts on the amplifier stability. To achieve a constantW in 
spite of the variation of -%$, first we set W 	 WK. Then for -%$, we add a current 
of  WK to W by paralleling a  WK current source to W. In the midrange, for -%$-))
 , we need to add current of WK  to W 	 WK and finally, when -%$-)), there is no 
need to add any current to our initial current W 	 WK. All these actions can be done 
by using the same control circuit that is used to change the tail currents of two 
differential pairs in the input stage. 

 
4.6 Conclusion 
105 
 
4.6 Conclusion 
The subject of this chapter was about the design of single-ended output op amps. 
Some most popular architectures of this category usually employed in an analog 
system were introduced. Each structure has its own advantages and drawbacks. 
Choosing a particular type of op amp totally depends on the application and 
required specifications for that particular application. For example, when design is 
to be done in a deep submicron technology, achieving a large voltage gain is not a 
simple task. In this case the two-stage op amp perhaps is the first candidate. But 
from a frequency stability point of view, a designer may get into trouble when 
he/she uses such architecture with a large load capacitance. The behavior of a 
current mirror op amp is well-defined and its design procedure is straightforward 
though it cannot provide enough voltage gain. Of course this shortcoming of 
current mirror structure is compensable to some extent by using cascode 
configuration. Among different studied architectures the folded-cascode structure 
can meet most expected specifications while also being appropriate for low-
voltage applications. This chapter also dealt with the rail-to-rail input op amps and 
introduced several methods to achieve this goal. In the method presented the input 
stage is designed such that the total transconductance of the input devices of the op 
amp have minimum variation when the input common-mode voltage changes 
between two supply rails. 
References 
[1] Gray, P. R., Hurst, P. J., Lewis, S. H., and Meyer, R. G., Analysis and Design of Analog 
Integrated Circuits, Fourth Edition, John Wiley & Sons, Inc., 2001. 
[2] Liu, W., MOSFET Models for SPICE Simulation Including BSIM3v3 and BSIM4, John Wiley & 
Sons, Inc., 2001. 
[3] Tsividis, Y., Operation and Modeling of the MOS Transistor, Second Ed, Boston: McGraw-Hill, 
1999. 
[4] Allen, P. E., Holberg, D. R., CMOS Analog Circuit Design, Second Ed, Oxford University Press, 
2002. 
[5] Nagaraj, K. ‚ÄúConstant Transconductance CMOS Amplifier Input Stage with Rail-to-Rail 
Common Mode Voltage Range,‚Äù IEEE Trans. Circuits Syst. II, Vol. 47, No. 12, 2000, pp. 1560‚Äì
1564. 
[6] Botma, J. H., et al., ‚ÄúA Low-Voltage CMOS Op Amp with a Rail-to-Rail Constant-Gm Input 
Stage and a Class-AB Rail-to-Rail Output Stage,‚Äù Proc. of the IEEE Int. Symp. on Circuits and 
Systems, 1993, pp. 1314-1317. 
[7] Hogervorst, R., et al., ‚ÄúA Compact Power-Efficient 3 V CMOS Rail-to-Rail Input/Output 

106 
CMOS Single-Ended Output Op Amp 
 
Operational Amplifier for VLSI Cell Libraries,‚Äù IEEE J. Solid-State Circuits, Vol. 29, No. 12, 
1994, pp. 1505-1513. 
[8] Moldovan, L., and Li, H. H., ‚ÄúA Rail-to-Rail, Constant Gain, Buffered Op Amp for Real Time 
Video Applications,‚Äù IEEE J. Solid-State Circuits, Vol. 32, No. 2, 1997, pp. 169-176. 
[9] Peeters, E., Steyaert, M., Sansen, W., ‚ÄúA Fully Differential 1.5V Low-Power CMOS Operational 
Amplifier with a Rail-to-Rail Current-Regulated Constant-gm Input Stage,‚Äù Proceedings of the 
IEEE Custom Integrated Circuits Conference, 5-8 May 1997, pp. 75-78.  
 
 

 
 
107 
Chapter 5 
CMOS Fully Differential Op Amps 
The name of the single-ended output op amp evidently states its unique property of 
having a single output voltage or current. This is against another important 
category of operational amplifiers that states that both input and output signals 
appear as differential voltage or current. As the design criteria in the 
implementation of an op amp to be used within an analog-integrated circuit is 
significantly different from those of traditional stand-alone op amps, critical 
specifications such as the amount of PSRR and CMRR need to be considered in 
such applications. For example, in an integrated mixed-mode circuit such as 
analog filters or data converters, op amps and other digital sections coexist on a 
common chip [1]. This causes any noise from digital parts to go through the 
common substrate into the analog blocks. This issue highlights the unquestionable 
importance of high CMRR and PSRR which have critical roles in alleviating these 
issues. Using differential output signals instead of a single counterpart, we can 
significantly keep such circuits immune against common-mode noises or 
interferences. In this chapter, first we outline the remarkable advantages of fully 
differential op amps (FD op amps) compared to their single-ended alternative. 
Next, we deal with the common-mode feedback circuit as an indispensable 
building block in FD op amps and introduce some subtle issues with regard to this 
block. At the end, we briefly study different structures in this category.  
5.1 Advantages of Fully Differential Op Amps 
In this section, some predominant benefits of differential output amplifiers are 
briefly introduced to demonstrate the reasons behind the widespread application of 
this amplifier in analog integrated circuits. 
 
High Immunity against Common-Mode Noises and Interference Signals: Since the 
differential output voltage is the amplification of the difference of two input 
voltages, any unwanted interference signal that appears as a common-mode signal 

108 
CMOS Fully Differential Op Amps 
 
on both inputs would disappear at the output in an ideal case [2]. This issue is 
critical particularly in an analog mixed-mode circuit where it is quite possible that 
some unwanted digital signals such as clock voltage reaches the op amp inputs 
through different ways like capacitive coupling, shared substrate, or common 
power supply rail.  
 
Increased Output Swing: In a differential output op amp, since two outputs change 
in the opposite directions in reference to the ground node of the circuit, thus the 
difference of them will be twofold in comparison to that of its single-ended output 
counterpart. Improved output swing leads to increase of the dynamic range, a 
critical point in low-voltage designs. Moreover, this feature helps to improve the 
signal-to-noise ratio of the circuit. 
 
Elimination of Even Harmonics: In a large-signal condition, the general 
relationship between the difference of inputs and outputs can be represented as 
!"# 	 !%#. Supposing the amplifier has a full symmetric structure, by 
interchanging two inputs, we will have the same output with opposite polarity. 
This means that the input-output relationship is an odd function of the input 
difference voltage !%# and thus only odd terms will appear in the Taylor series 
expansion of !"# in terms of !%# 
 
 
!"# 	 √∂!%#  √∂≈Ω!%#
≈Ω  √∂!%#
   
 (5.1) 
 
For a sinusoidal input voltage, substituting !%# 	 -0√π
¬ΩLn into (5.1) and using 
trigonometric formulas to simplify the relationship, we obtain 
 
 
!"# 	 √π
¬ΩLn  ≈Ω√π
¬ΩCLn  √π
¬Ω=Ln   
(5.2) 
 
This reveals that in an ideal FD circuit only odd harmonics are generated due to 
the circuit nonlinearity. The property of an odd characteristic also shows that to 
invert the polarity of a differential signal there is no need for an extra amplifier 
and it is enough to interchange the order of two differential input signals. 
 
Omission of the Systematic Offset Voltage: In a differential output amplifier, a 
common-mode feedback circuit should be used to fix the output voltage to a 
desirable level. This action eliminates any concern about dc output level deviation. 
 
Removal of the Mirror Pole: Since no current mirror active load is employed in 
the structure of a differential output amplifier, we have no mirror pole similar to 
what happens in a single-ended output op amp. 
In contrast to all the above mentioned advantages of differential output op 
amps, we can enumerate two main downsides. First, when an FD op amp is used 
as an amplifier in a negative-feedback loop, the required number of elements in 

 
5.2 Common-Mode Feedback Concept 
109 
 
 
the feedback network becomes twofold. For instance, in a switched-capacitor 
amplifier implemented by such an op amp we need four capacitors instead of two. 
This can occupy a considerable area of the chip in an integrated analog circuit. The 
second challenge with an FD op amp is its mandatory requirement of an extra 
circuit called common-mode feedback circuitry (CMFB). The function of the 
CMFB circuit is to keep the dc output voltage on an appropriate level in order for 
output devices to operate in the saturation region. 
5.2 Common-Mode Feedback Concept 
When a single-ended output op amp is used within a negative-feedback loop, the 
feedback helps to stabilize the common-mode (CM) output level. Consider the 
circuit shown in Figure 5.1 and let the output voltage be changed by 3-". This 
variation through the feedback path appears at the inverting input as 3-/ 	
√î' '  '

√ï3-", is multiplied by the op amp voltage gain, and returns to the 
output as 3-"
¬º 	 #3-/ 	 #√î' '  '

√ï3-". Since #  , it is obvious 
that any change in the dc output voltage is compensated by a strong negative-
feedback mechanism. Now consider the same condition for an FD amplifier shown 
in Figure 5.2. Generally, the variation of the CM output voltage (3-"$  !"$) can 
be written as !"$ 	 #$!%#  $$!%$ with #$ and $$ as the differential to CM 
and CM voltage gains, respectively, and 3-%$  !%$. For the case of !%# 	  as 
illustrated in Figure 5.2, when the output CM voltage changes by 3-"$, the 
corresponding 
variation 
in 
the 
input 
CM 
voltage 
becomes 
3-%$ 	 √î' '  '

√ï3-". This time the voltage 3-%$ is multiplied by $$ and 
causes the output voltage change by 3-"$
¬º 	 $$√î' '  '

√ï3-"$. Since $$ 
is a small quantity, the negative-feedback loop cannot compensate for the changes 
in -"$. Hence it is completely possible that the output CM voltage changes 
uncontrollably toward one of two supply rails. This proves that unlike a single-
 
Figure  5.1 Single-ended output op amp within a negative-feedback loop. 
‚àí
+
Vo
R1
R2
Vref
Ad

110 
CMOS Fully Differential Op Amps 
 
ended op amp, in a differential op amp we need an additional circuit to maintain 
the output dc voltage on a certain level that ensures output devices operate in the 
saturation region [3]. Figure 5.3 shows the CMFB block in association with an FD 
op amp. The signal !K at the CMFB output exhibits the control signal used to 
adjust the op amp output dc voltage to a desirable level. The variation of the 
differential and CM voltages of the op amp in the presence of the CMFB block can 
be represented by 
 
 
!"# 	 ##!%#  $#!%$  K#!K 
 (5.3) 
 
 
!"$ 	 #$!%#  $$!%$  K$!K 
 (5.4) 
 
K# and K$ show the amount of contribution of the control signal !K in the 
differential and CM output voltages, respectively. On the other side, the voltage !K 
itself depends on these voltages through the CMFB circuit according to the 
following relationship: 
 
 
!K 	 #K!"#  $K!"$
(5.5) 
 
Figure  5.2 Differential output op amp within a negative-feedback loop. 
 
Figure  5.3 Op amp with a CMFB network. 
Vod
R1
R2
Vref
Ad
R1
R2
‚àÜVoc
‚àÜVoc
+
-
-
-
+
+
-
-
+
+
Vic
Vic
Voc
Voc
+
vid
-
vod
-
+
vs
Common-mode
feedback

 
5.3 Common-Mode Feedback Circuits 
111 
 
 
where #K is the voltage gain of the CMFB for the differential output voltage and 
$K is the corresponding gain for the output CM voltage. The role of the CMFB 
block is to detect the output CM voltage variation and produce the control signal 
of !K to adjust the output CM level. Hence we expect to have #K ‚Ä¶ $K or 
!K  $K!"$. In the quiescent condition when !%# 	 , from (5.4) the output CM 
variation is given by 
 
 
!"$ 	 $$!%$  K$!K
=<
 
In reality, the voltage gain of K$ in the CMFB circuit is much greater than the op 
amp CM voltage gain of $$ and thus !"$  K$!K. As a result, from (5.5) and 
(5.6) the open-loop gain for the loop consisting of the CMFB block and op amp 
becomes approximately 67 Z 	 K$$K. The behavior of the CMFB in relation to 
the op amp can be depicted in a system level representation as shown in  
Figure 5.4. From Figure 5.4 we can express the output CM voltage in terms of the 
desirable CM level as 
 
 
-$0H"Mq 	
√Ç ¬≥
√Ç ¬≥ -$0H.I
=B
 
For 67 Z   we have -$0H"Mq  -$0H.I. The stability issue is the most important 
matter in the design of the CMFB circuit. This requires that the pole and zero 
locations in the transfer functions of $K and K$ are such that the system open-
loop gain has adequate phase margin in the frequency domain. K$ is the voltage 
gain from the CMFB circuit output to the op amp output thus its transfer function 
is determined by a part of the op amp circuit that exists in this path. The gain of 
$K depends on the structure used to implement the CMFB circuit. It should be 
pointed out that we need to take actions to achieve the required stability for the 
CMFB circuit while it should not degrade largely the main op amp parameters 
such as dc voltage gain, bandwidth, and stability. 
5.3 Common-Mode Feedback Circuits 
A CMFB block usually consists of two main parts, as illustrated in Figure 5.5. The 
first part is a CM detector circuit that is connected directly to the op amp output 
 
Figure  5.4 System representation of a CMFB control loop. 
+
-
Acs
Asc
Vcm,out
Vcm,ref

112 
CMOS Fully Differential Op Amps 
 
and provides a current or voltage signal proportional to the op amp output CM 
voltage. The second part is a comparator that compares the signal provided by the 
first block with a reference CM level and produces a control signal as a voltage or 
current that is applied to an appropriate point of the op amp to move the op amp 
output CM voltage toward the desirable level. There are different architectures to 
realize the CMFB circuit while each of them has its own advantages and 
disadvantages. Employing a particular circuit for CMFB depends to a large extent 
on the particular op amp structure. 
5.3.1 Common-Mode Feedback Circuit with Resistive Sensing 
The simplest way to get the op amp output CM voltage is to place two resistors 
with equal resistances at the op amp output, as shown in Figure 5.6 [4]. Although 
the circuit is simple, its main drawback is its loading effect on the op amp output, 
which extensively lowers the dc voltage gain. The loading effect can be mitigated 
to some extent by using large resistances. But large on-chip resistors occupy a 
significant area of the chip and add considerable parasitic capacitances at the 
 
Figure  5.5 CMFB circuit details in an FD op amp. 
 
Figure  5.6 CMFB circuit with resistive detector. 
-
-
+
+
vs
Common-mode
vo
+
vo
-
vi
+
vi
-
detector
Vcm,out
Vcm,ref
+
-
vo
+
vo
-
R
R
‚àí
+
Vcm,ref
Vcm,out
+
- -
+

 
5.3 Common-Mode Feedback Circuits 
113 
 
 
output that in turn limit the op amp frequency response. As shown in Figure 5.7, 
by employing source-follower stages at each op amp output, we can solve the 
loading problem.  
Since the CM voltage produced in this case is lower than the op amp output 
CM by one gate-source drop voltage, we need to use the same source-follower for 
the reference CM voltage, as depicted in Figure 5.7. In the absence of the parallel 
capacitors, the resistors ' and the input parasitic capacitance of the comparator 
form a low-pass circuit in which the op amp output CM voltage is considered as its 
input signal, as illustrated Figure 5.8. The capacitance K is the input parasitic 
capacitance of the comparator. The transfer function of the low-pass circuit 
becomes 
 
4√Ö
4, 	

86vK
 (5.8) 
 
The created pole of LR 	  'K

 adds a negative phase shift in the transfer 
function of $K¬Ω that results in degrading the loop stability. By placing a proper 
parallel capacitor across the resistor', we can create a zero to cancel the 
mentioned pole. The main drawback of the resistive CMFB circuit with buffer is 
 
Figure  5.7 Resistive CMFB circuit with source-follower. 
vo
+
vo
-
R
R
‚àí
+
Vcm,ref
Vcm,out-VGS
+
-
VDD
VDD
VDD
vs
C
C
I0
I0
I0
M1
M2
M3
Vcm,ref-VGS
+
-

114 
CMOS Fully Differential Op Amps 
 
that its performance is limited by the op amp differential output swing. This occurs 
because when each op amp output voltage becomes less than -fD  -"# with -"# 
as the bias current source overdrive voltage in the buffer circuit, the source-
follower stage fails to follow the op amp output and thus the CM level produced is 
no longer acceptable. 
5.3.2 Differential Difference Common-Mode Feedback Circuit 
It is possible to use two identical NMOS or PMOS differential pairs at the output 
of an FD op amp in order to detect the op amp output CM level. The circuit of 
Figure 5.9 shows a PMOS sample of such a circuit. M1 to M4 are exactly the same 
and M6 with the diode-connected configuration is also identical to M5 in order to 
have the same drain voltages for M1 to M4. In a quiescent condition for !"# 	  if 
-"$ 	 -$., M1 to M4 have equal currents of W  
 . In this circuit both the 
differential and CM level of the op amp output affect the drain currents of M1 to 
M4. If the change in the drain current due to the output differential and CM 
voltages are denoted by 3¬Æ#0 and 3¬Æ$0, respectively, the drain currents of M3 and 
M4 can be written as 
 
 
¬Æ)≈Ω 	
{
  3¬Æ$0  3¬Æ#0
=;
 
 
¬Æ)√á 	
{
  3¬Æ$0  3¬Æ#0
=
 
From (5.9) and (5.10), the drain current of M5 becomes ¬Æ) 	 ¬Æ)≈Ω  ¬Æ)√á 	 W 
 3¬Æ$0. This means that ¬Æ) depends only on the changes of the output CM voltage. 
To control the output CM level in an FD op amp we can use the M5 current to 
adjust the tail current of the op amp through a current mirror circuit. We can write 
(5.9) and (5.10) as long as both differential pairs of M1-M3 and M2-M4 remain 
 
Figure  5.8 Low-pass circuit formed in a CMFB block. 
R
R
Cs
Voc
Voc
Vo1

 
5.3 Common-Mode Feedback Circuits 
115 
 
 
turned on at the maximum level of the differential output voltage of the op amp. 
This condition is satisfied when !"#H0UV  d -"
 in which -"
 	 ‚Ä¢W ¬∞/√á

 is the 
overdrive voltage of M1 to M4 with ¬∞/√á 	 hR"Vo p
 /√á. Therefore we need 
to use a large enough -"
 by increasing the tail current and decreasing the device‚Äôs 
aspect ratios to cover the variation range of the differential output voltage.  
Now we proceed to obtain the low-frequency voltage gain of $K for this 
circuit. Variation in the drain current of M3 and M4 due to any difference between 
reference CM level -$. and the output CM voltage -"$ is given by 
 
 
3¬Æ)≈Ω 	

 X0H≈Ω-"$  -$.
=
 
 
3¬Æ)√á 	

 X0H√á-"$  -$.
= 
 
Since X0H≈Ω 	 X0H√á  X0, the variation of the drain current of M5 becomes 
3¬Æ) 	 3¬Æ)≈Ω  3¬Æ)√á 	 X0-"$  -$., which creates an ac voltage !K 	
X0 X0

-"$  -$. across the diode-connected M5. This gives 
 
 
$K 	

v
4,/4, 	
¬Ø5
¬Ø5√© 
 (5.13) 
 
To limit the power consumption of the CMFB circuit, the tail current W cannot be 
too large and consequently the required overdrive voltage for M1 to M4 is 
achievable by taking small aspect ratios for these devices. All these measures lead 
to a small transconductance X0. On the other hand, there is a restriction imposed 
 
Figure  5.9 PMOS differential difference CMFB circuit. 
VDD
I0
VDD
I0
Vcr
vo
+
vo
-
M1
M2
M3
M4
vs
M5
M6

116 
CMOS Fully Differential Op Amps 
 
on X0 that does not allow us to arbitrarily make X0 too small. This constraint is 
forced in conjunction with the CMFB frequency response. Denoting total 
capacitance seen at the gate of M5 including the M5 gate-source capacitance and 
total capacitance associated with the CMFB control input of the op amp, by  the 
dominant pole in the voltage gain transfer function $K would be X0 

. 
Although according to (5.13), decreasing X0 helps to increase the dc voltage gain 
of $K, it simultaneously lowers the dominant pole and as a result degrades the 
stability of the CMFB loop. A modified differential difference CMFB circuit to 
achieve higher $K is shown in Figure 5.10. Similarly, we can write the drain 
currents of different devices as 
 
 
¬Æ) 	
{
  3¬Æ$0  3¬Æ#0
=T√¥
 
 
¬Æ) 	
{
  3¬Æ$0  3¬Æ#0
=T
 
 
¬Æ)≈Ω 	
{
  3¬Æ$0  3¬Æ#0
=T‚Ä¢
 
 
¬Æ)√á 	
{
  3¬Æ$0  3¬Æ#0
=T>
 
From the equations above we have ¬Æ) 	 ¬Æ)√™ 	 W   3¬Æ$0, ¬Æ)≈Ω  ¬Æ)√á 	 W 
 3¬Æ$0, and therefore ¬ÆK 	 ¬Æ)≈Ω  ¬Æ)√á  ¬Æ) 	 T3¬Æ$0. The output resistance seen at 
the 
drain 
of 
M5 
is 
'"Mq 	 √í" √ì √í"≈Ω √ì √í"√á. 
Moreover, 
we 
have 
3¬Æ$0 	   
 X0/√á-"$  -$. that gives the dc voltage gain of the CM detector 
circuit as 
 
 
Figure  5.10 High-gain PMOS differential difference CMFB circuit. 
VDD
I0
VDD
I0
Vcr
vo
+
vo
-
M1
M2
M3
M4
vs
M5
M6
is
1:1
iD3+iD4
iD5

 
5.3 Common-Mode Feedback Circuits 
117 
 
 
 
$K 	

v
4,/4, 	  X0/√á'"Mq 
 (5.15) 
 
As can be seen the voltage gain is significantly improved but the major issue is the 
small pole created at the drain of M5 that drastically degrades the stability of the 
CMFB loop. It is possible to improve stability by adding an ' compensation 
network, as shown in Figure 5.11. Denoting the parasitic capacitance at the drain 
of M5 due to the input control of the op amp by K, we obtain the equivalent 
impedance at the M5 drain as 
 
 
√ò¬Ω 	
8,6,K
√î8x‚Ä∞6,6v8,6,√ïK8x‚Ä∞8,6,6vK2 
 (5.16) 
 
Supposing √ò¬Ω has two real poles; we represent (5.16) as a general form of a 
second-order transfer function 
 
 
√ò¬Ω 	 '"Mq
 v
√ù√Ö
F v
Q√ÖGF v
Q2G 
 (5.17) 
 
We can cancel out one pole-zero pair by setting √ª 	 √º. In this situation, the only 
remaining pole is √ª 	  'K

 with '  '$ √ì '"Mq. In practice '$ ‚Ä¶ '"Mq and 
thus the pole is moved to a higher frequency that leads to improving the CMFB 
 
Figure  5.11 Differential difference CMFB circuit with compensation network. 
VDD
I0
VDD
I0
Vcr
vo
+
M1
M2
M3
M4
M5
M6
1:1
vo
-
Rc
Cc
vs

118 
CMOS Fully Differential Op Amps 
 
loop stability. 
5.3.3 Common-Mode Feedback Circuit Using MOS Devices Operating in the 
Triode Region 
Figure 5.12 indicates another circuit that can be used to detect and adjust the 
output CM voltage [5]. Transistors M11 to M21 form the CMFB circuitry. Series 
transistors M11 and M12 form a cascode current source with a fixed current 
denoted by W. The dc bias current of M9 and M10 in the op amp circuit is 
controlled by the current mirror of M13-(M9, M10) in which the current of M13 is 
composed of two components of W and WK. The devices in two exactly identical 
pairs of M14-M15 and M18-M19 operate in the triode region and act as a resistor. 
The pair of M14-M15 implements a fixed resistance controlled by the reference 
voltage. As long as the op amp output voltages keep M18 and M19 in the triode 
region, this pair acts as a resistor whose equivalent resistance depends on the 
output CM level and the differential component has no effect on its resistance. To 
show this matter we write the current equation of two devices in the triode region 
as 
 
¬Æ) 	 ¬∞ F!"
  -eY 

:k
 G !)D 
(5.18a) 
 
 
¬Æ) 	 ¬∞ F!"
/  -eY 

:k
 G !)D 
 (5.18b) 
 
Where ¬∞  hY"Vo p
 H. The drain current of M20 and M21 is the 
summation of these currents: 
 
 
¬Æ) 	  ¬∞ F


¬¢

 -eY 

:k
 G !)D 
 (5.19) 
Figure  5.12 Differential op amp with CMFB circuit using MOS devices in the triode region. 
VDD
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
M13
M14
M15
Vref
Vref
vo
+
vo
-
M16
M17
M18 M19
M20
M21
Vbias
Vbp
Vbn2
Vbn1
vi
+
vo
+
vo
-
vi
-
I0
CMFB
Differential Op Amp
Is
I1
1:1

 
5.3 Common-Mode Feedback Circuits 
119 
 
 
 
As it is obvious the total current depends only on the output CM voltage 
!"$ 	 !"
  !"
/  
 . Similarly we can write the total current relationship for M14-
M15 as 
 
¬Æ)√™ 	  ¬∞ F-.I  -eY 

:k
 G !)D 
 (5.20) 
 
From (5.19) and (5.20) it is possible to derive the equivalent resistances of two 
pairs as 
 
'"YH$0 	

:2
S:k


√Ü
,/4¬£√Ñ 
 (5.21a) 
 
 
'"YH.I 	

:√Ö√≠
S:k


√Ü‚Äú4rs/4¬£√Ñ‚Äì 
 (5.21b) 
 
where the second-order term is ignored for a small !)D. In the case of !"$ 	 -.I, 
series resistances in the sources of M16 and M20 are the same. This leads to 
having equal currents in M16 and M20 and therefore we get WK 	 . If !"$ is less 
than -.I, we have '"YH$0  '"YH.I and thus WK 	 ¬Æ)√™  ¬Æ)  . In this 
situation the total drain current of M13 becomes W  WK, which by injection of a 
larger current through the current mirror of M13-(M9, M10) into the op amp 
output nodes, raises the output CM voltage. For !"$  -.I, the opposite process 
causes WK to become negative and lower the output CM level. It should be pointed 
out that this analysis is valid provided that M14-M15 and M18-M19 remain in the 
triode region for the maximum possible swing of the op amp differential output 
voltage. This condition actually imposes a limitation on the op amp output swing. 
If the differential output voltage is denoted by !"#, the minimum level of each 
output should be greater than one MOS threshold voltage in order to keep the 
device turned on (i.e., we need to satisfy !"H0%Y
/
	 -"$  ‚Äú!"#H0UV  
 ‚Äì  -eY or 
!"#H0UV   -"$  -eY with !"#H0UV  !"H0UV

 !"H0%Y
/
). On the other hand, we 
also need to keep the devices in the triode region that require !"H0%Y
/
 -eY 
-)DH. 
Noting 
that 
-)DH 	 -‚Äû%UK  -fD, we have -"$  ‚Äú!"#H0UV  
 ‚Äì  -eY  -‚Äû%UK  -fD. 
These result in !"#H0UV   -"$  -eY  -‚Äû%UK  -fD, which imposes another 
upper limit on the differential output voltage. As the relationships show, two 
imposed limits are approximately the same. 
5.3.4 Switched-Capacitor Common-Mode Feedback Circuit 
All previously analyzed CMFB circuits except for the resistive divider type 
suffered from the imposed constraint on the op amp differential output voltage 
swing, although the resistive divider type did also have its own problems. In this 

120 
CMOS Fully Differential Op Amps 
 
part, another type of CMFB circuit is studied that does not impose serious 
limitation on the differential output swing while its loading effect on the op amp 
output could be ignored by providing the required conditions as discussed later. 
This circuit is realized only by capacitors and clock-controlled switches. The 
switched-capacitor (SC) CMFB circuits are particularly appropriate for the 
category of switched-capacitor circuits such as SC filters or amplifiers in which 
other parts of the system are using controlled switches and thus the required clock 
signal is already accessible. The general scheme of an SC CMFB circuit is 
illustrated in Figure 5.13.  
The switches are controlled by two nonoverlapping clocks called   and  . 
The half-circuit equivalent of the circuit in the common-mode state is shown in 
Figure 5.14.  
 
Figure  5.13 Switched-capacitor CMFB circuit. 
 
Figure  5.14 Common-mode half-circuit equivalent of differential op amp with switched-capacitor
CMFB circuit. 
vo
+
vo
-
vs
Cf
Cf
Cs
Cs
œÜ2
œÜ2
œÜ2
œÜ1
œÜ1
œÜ1
VB
Vcr
+
+
-
-
vi
-
vi
+
Asc
Cf
Cs
Vcr
VB
œÜ1
œÜ1
œÜ2
œÜ2
Voc
s1
s2
s4
s3

 
5.3 Common-Mode Feedback Circuits 
121 
 
 
At the phase of  , switches O and O are closed and the capacitor K charges 
to -  -$.  -‚Ä¢. At the end of  , O and O are open and then O≈Ω and O√á are 
closed when   is active. If n 	  is considered at the leading edge of the first 
pulse on  , according to the charge conservation law, the total electric charge 
before and after change in the switches‚Äô states is kept unchanged (i.e., 
g/ 	 g). Assuming the initial voltage across  at n 	 / is zero, we can 
write K- 	 ‚ÄúD  ‚Äì- with - as the voltage across the parallel combination of 
K and  for n  . As a result, the voltage of  in the first clock cycle changes 
from zero to - 	 ‚ÄúK ‚ÄúK  ‚Äì

‚Äì-. In the second cycle, during two consecutive 
phases of   and  , the same process is repeated but this time the initial voltage 
of  is - and therefore the  voltage changes to 
 
 
3-6s 	
6v
6v6s -  - 
 (5.22) 
 
The voltage across  at the end of the second cycle becomes - 	 -  3-6s. In a 
similar fashion, it is possible to calculate the voltage of  at the cycle of ‚Ä¢   
in terms of its voltage at the previous cycle as follows: 
 
 
-Y 	 -Y  -  -Y
6v
6v6s 
 (5.23) 
 
Denoting !Y  -Y  -, from (5.23), after simplifying, we reach the following 
recursive equation: 
 
 
!Y 	
6s
6v6s !Y
(5.24)
 
The general solution of such an equation is as !Y 	 }"Y with }   ‚ÄúK  ‚Äì

. 
The parameter ¬æ is obtained by substituting the general solution into (5.24) that 
gives ¬æ 	  and as a result !Y 	 }Y. The coefficient  is an arbitrary constant 
that is determined by using the given initial condition. Since ! 	 -  - and it is 
assumed - 	 , we have ! 	  	 - and thus the complete solution becomes 
-Y 	 -  }Y for ‚Ä¢  . Since }  , the voltage across  approaches - as ‚Ä¢ 
tends to infinity. The circuit parameter } determines how fast -Y approaches its 
final value. Clearly, the smaller } is chosen, the less time the circuit spends in a 
transient state. That condition is met when  is chosen adequately smaller than 
K. In steady state the voltage of  is approximately equal to - and consequently 
the charge on K during two consecutive phases of   and   does not noticeably 
change. In   the charge on K is K-$.  -‚Ä¢ and in  K is placed in parallel 
with  with a charge of D-"$  -K, as illustrated in Figure 5.15. Equating these 
charges together, we obtain the CM level control signal of -K as 

122 
CMOS Fully Differential Op Amps 
 
 
 
-K 	 -‚Ä¢  -"$  -$.
(5.25)
 
Equation (5.25) shows that the actions of output CM detection and comparison 
with reference both are simultaneously carried out with the unity voltage gain for 
$K. When -"$ is greater than -$. the control voltage -K is larger than the bias 
voltage-‚Ä¢. The control voltage given by (5.25) can be exploited in an NMOS 
differential pair to lower the output CM level by increasing the tail transistor 
current. In the case of -"$  -$., we have -K  -‚Ä¢, which by decreasing the tail 
current the opposite action occurs. In practice, the switches used in the circuit of 
Figure 5.14 are implemented by MOS transistors that operate between the two 
regions of cutoff or triode depending on whether the switch is off or on. When the 
MOS switch is on an inversion layer of free charges is formed in the channel under 
the gate. When the switch turns off the channel charge is distributed between the 
regions of source and drain. For example, in Figure 5.14 when switches O and O 
turn off, a part of their channel charge denoted by 3g transfers to K so that the 
actual charge on K in   becomes K-"$  -K  3g, and in the steady state, the 
CM control voltage -K becomes 
 
 
-K 	 -"$  -$.  -‚Ä¢ 
3
6v 
 (5.26) 
 
From (5.26) we see that the actual output CM voltage in the steady state will have 
an error by amount of 3g K

. By choosing small sizes for switches and rather 
large capacitance K we can reduce the effect of the channel charge sharing error.  
In relation to the loading effect of switched-capacitor CMFB circuit there is 
an important point that the designer should pay special attention to. The sampling 
capacitor K and two switches controlled by   and   act as an equivalent resistor 
with the resistance of  $‚Ä¢ÀúK

 with $‚Ä¢Àú as the clock signal frequency that 
controls the switches. For large clock frequency the equivalent resistance is small 
 
Figure  5.15 Common-mode half-circuit equivalent of differential op amp in the steady state. 
Cs
Cf
Vs
Voc
Asc
+
-

 
5.4 Fully Differential CMOS Op Amp Architectures 
123
 
 
 
 
and it can extensively load the op amp output which causes a significant drop in 
the voltage gain. For example, for $‚Ä¢Àú 	 _ `a and K 	 ¬µ an equivalent 
resistance of ≈ì is added at the output. Such resistance is regarded as a small 
load in a high-gain op amp and can drastically degrade the dc voltage gain. 
Moreover, the effective capacitance of the CMFB network is added to the load 
capacitance that in turn limits the bandwidth and slew rate of the op amp [6]. 
5.4 Fully Differential CMOS Op Amp Architectures 
In this section, several architectures of differential op amps are briefly studied. 
Many different op amp parameters previously discussed for the single-ended op 
amp are equally applicable for the differential op amps. Therefore we deal with 
only some key points that are associated with the CMFB circuit when included in 
a particular structure. 
5.4.1 Fully Differential Two-Stage Op Amp 
The essential difference between an FD two-stage op amp with a single-ended one 
is that in a differential op amp the current mirror load in the first stage is replaced 
by two normal current sources. In order to provide a differential output, we have to 
use two identical common-source stages as the second stage. The circuit of an FD 
two-stage op amp is shown in Figure 5.16, in which a part of the tail transistor 
current is controlled by the CM control signal -K to adjust the output CM level. 
An important question about this architecture is how the CMFB circuit should 
be used to adjust the CM output level. Generally there are two strategies to employ 
Figure  5.16 Schematic of an FD two-stage op amp. 
CL
Rc
Cc
Vbp
CL
Rc
Cc
VDD
IB
M0
M1
M2
M3
M4
M5a
M6
M7
M8
M9
Vs
M5b
vo
+
vo
-
vi
+
vi
-

124 
CMOS Fully Differential Op Amps 
 
CMFB circuit in a two-stage op amp. The first one is to use two independent 
CMFB circuits for each stage [7], and the second one is to detect the CM level of 
the second stage output and apply the control signal to the first stage by employing 
a single CMFB circuit. Although the second method requires less components and 
looks more convenient, there is a subtle point with this method that should be 
considered in order to avoid instability when the op amp is used in an external 
negative-feedback loop [8]. In the following, we proceed to this matter. 
The CM voltage gain of a two-stage fully differential op amp in the absence 
of the CMFB circuit is the product of the CM voltage gain of the differential pair 
and the voltage gain of the common-source stage. The differential pair has an 
adequately small CM voltage gain due to the high output resistance of its tail 
current source but the voltage gain of the second stage could be noticeable. 
Denoting the CM voltage gain of an op amp without CMFB circuit by $0, we 
have $0 	 $0
 with $0 as the differential pair CM gain and 
 as the 
common-source voltage gain. When CMFB is added to the op amp, any change in 
the output CM voltage is sensed and through a negative-feedback mechanism this 
change is compensated. Thus the CM voltage gain of an op amp in the presence of 
CMFB circuit is too small. This matter is more obvious by representing the system 
level behavior of this mechanism, as depicted in Figure 5.17. From Figure 5.17 the 
closed-loop CM voltage gain of the op amp is given by 
 
 
$0 	
4,
4, 	
,5
e√Ñ‚Ä∞ 
 (5.27) 
 
where √£%Yq 	 $KK$ is the open-loop gain of the CMFB circuit. As long as the 
condition of √£%Yq   is satisfied, $0 is too small and any change in -%$ cannot 
appreciably affect the op amp output CM level. Now consider our two-stage FD 
op amp with its single CMFB network is exploited in a negative external feedback 
loop. To study the behavior of the op amp against the input CM variation here, we 
only consider the circuit in the common-mode condition with no differential 
signal. Figure 5.18 shows the circuit and its half-circuit equivalent in this 
condition. $0 is the op amp CM voltage gain in the presence of CMFB circuit 
 
Figure  5.17 System level representation of a CMFB mechanism. 
Acm0
Tint
+
-
Voc
Vic

 
5.4 Fully Differential CMOS Op Amp Architectures 
125 
 
 
that is normally small but its sign is positive and thus the external feedback for the 
CM voltage -%$ acts as a positive feedback. In such a situation, in order to make 
sure that no instability occurs we need to have an open-loop gain that is less than 
unity. For the half-circuit represented in Figure 5.18 we obtain 
 
 
-"$ 	 F 
82
8√ÖG -%$ 
82
8√Ö -.I 
 (5.28) 
 
The open-loop gain is √£IVq 	 $0 with  	 ' '  '

. In a normal condition 
the internal CMFB circuit keeps $0 adequately small and there is no concern 
about the loop instability. This condition is met provided that the CMFB loop has 
a large open-loop gain according to (5.27). For the case of the circuit of Figure 
5.16, the CMFB loop gain becomes √£%Yq  X0‚Äû√í"≈Ω
$K in which $K is the 
voltage gain of the CM sense amplifier. If for any reason the op amp input CM 
voltage -%$ drops below -fD  -"#, the tail transistor M5 enters the triode region 
that causes a simultaneous drop in X0‚Äû and increase in $0, which both lead to 
raising the $0. If $0 increases to the extent that the external loop gain of √£IVq 
becomes greater than unity, the stability condition is violated and the CMFB 
circuit will not be able to keep the output CM voltage on a desirable level. This 
matter can be explained more clearly by drawing the graph of (5.28) as the load 
line and the transfer function of the op amp output CM voltage versus its input CM 
voltage together, as illustrated in Figure 5.19. The nearly flat part of the curve is 
associated with the case that the CMFB circuit has enough large loop-gain to keep 
the output CM voltage constant, which corresponds to a too-small$0. As the plot 
shows when the factor of }  ' '

 changes in the range of   }  }#, the 
load line has three individual intersection points with the characteristic curve that 
is equivalent to having three different operating points, among which only point  
is acceptable. At point  the output CM voltage is zero and point $ is an unstable 
equilibrium point that the circuit cannot remain permanently at that point, and with 
Figure  5.18 Two-stage FD op amp inside an external negative-feedback loop. 
Vref
R1
R1
R2
R2
-
+
+
-
Vic
Voc
Acm
R1
R2
Acm
Vref
Voc
Vic
Half-circuit

126 
CMOS Fully Differential Op Amps 
 
the smallest disturbance it moves quickly toward one of the two other points. For 
example, if the op amp is to be used as a voltage follower with the unity voltage 
gain, an application that is quite popular in sample and hold circuits, the parameter 
} is zero, which leads to three different operating points. 
It should be pointed out that this condition happens provided that the external 
feedback resistances (i.e., ' and ') are much greater than the op amp output 
resistance. This is because (5.18) is derived based on this condition. It is 
interesting that the above mentioned condition is usually met in switched-capacitor 
circuits where capacitors are used in the feedback network. The instability 
problem can be solved by changing the injection point of the control CM signal -K. 
Instead of controlling the tail transistor current, it is possible to control the load 
current sources M3-M4, as seen in Figure 5.16. The partial section of the whole 
circuit associated with the new CM control circuitry is shown in Figure 5.20.  
 
Figure  5.19 CM input-output characteristic of an op amp with a load line. 
 
Figure  5.20 Partial modified CMFB circuit to solve the instability problem. 
Vref
Vref
Voc
Vic
K=0
K
R2
R1
K*
K1>K*
-K1Vref
-K*Vref
0
C
A
B
‚àí
+
Vic
Vbn
Voc
M8
M3
VDD
M5
M9
M1
Voc
Vcr
Vs
Acs

 
5.4 Fully Differential CMOS Op Amp Architectures 
127 
 
 
Now assume the same condition occurs and -%$ drops below -fD  -√é#, 
which causes the tail transistor M5 to enter the triode region. Again X0‚Äû drops 
but this time the gain of K$ is provided by the common-source stage amplifier 
consisting of M3 and the cascode load of M1 and M5. Here M3 operates in the 
saturation region and its gain is not appreciably dropped, as is the case for M5. In 
fact, in this situation we can keep $0 small for -%$ near to zero, as is obvious 
from the graph shown in Figure 5.21. In this condition, even for the worst case that 
happens when } 	 , the circuit has only one stable operating point and there is 
no concern about the instability issue caused by external feedback. 
As mentioned at the beginning of this chapter, except for the CMFB circuit 
design, all discussions about the design of a single-ended op amp are mostly 
applicable for differential op amps. For instance, the frequency response of the 
two-stage op amp given in Figure 5.16 can be calculated by employing its 
equivalent half-circuit model shown in Figure 5.22. The circuit is exactly the same 
as the single-ended two-stage op amp that was studied in detail in Chapter 4 and 
thus here we ignore further discussion about this subject. 
5.4.2 Fully Differential Current Mirror Op Amp 
The schematic of a simple differential current mirror op amp is illustrated in 
Figure 5.23. It is clear that this structure is very similar to the corresponding 
single-ended one in which one stage is added to provide two differential outputs. 
The frequency response analysis of this circuit follows all points that were 
mentioned with regard to the single-ended current mirror op amp in Chapter 4. As 
in the case of single-ended, the higher dc voltage gain is achievable by using a 
cascode structure. The reader may wonder if an FD current mirror op amp needs a 
CMFB circuit or not. 
 
Figure  5.21 Modified CM input-output characteristic of an op amp. 
Vref
Vref
Voc
Vic
K=0
K
R2
R1
-KVref
0
K>0

128 
CMOS Fully Differential Op Amps 
 
There is an interesting point about the CMFB network requirement for such 
an architecture. Remember that in a simple differential pair with current mirror 
load the dc level of the floating drain is identical with that of the drain of the 
diode-connected device. Here we encounter the same configuration for two current 
mirrors of M7-M8 and M9-M10. Consequently at the absence of CMFB circuit we 
expect the output CM voltage to be equal to the same gate-source voltage of M7 
and M9. This means that in the current mirror architecture, unlike other 
differential op amps, the level of the output CM is well-defined, even when there 
 
Figure  5.22 Half-circuit ac model of an FD two-stage op amp. (a) Transistor level schematic and (b)
small-signal equivalent circuit. 
 
Figure  5.23 Schematic of an FD current mirror op amp 
vi/2
vod/2
C2
C1
R1
R2
M1
M8
Rc
Cc
small signal
equivalent
+
-
vi/2
C1
R1
Rc
Cc
C2
R2
gm1vi/2
gm8vgs8
+
-
vgs8
vod/2
R1=ro1||ro3
R2=ro8||ro9
(a)
(b)
VDD
2I0
1:1
1:K
+
-
M1
M2
M3
M4
M5
M7
M8
CL
vid
M6
CL
K:1
K:1
1:K
1:1
vo
+
vo
-
M9
M10
M11
M12

 
5.4 Fully Differential CMOS Op Amp Architectures 
129 
 
 
is no CMFB block. But in many applications we may need to have a certain output 
dc voltage that is different from a gate-source voltage drop as in this circuit. In 
such conditions we have to exploit an appropriate CMFB network to keep the 
output CM level of the current mirror op amp output on our desirable reference 
level. Because of a large similarity between a single-ended and differential op amp 
with the current mirror structure, we avoid giving more explanation about the 
circuit of Figure 5.23 and just introduce another circuit that can act as a differential 
current mirror op amp as depicted in Figure 5.24 [9]. In fact, this op amp is 
comprised of two identical single-ended current mirror op amps that together 
provide the differential output voltage. From a performance point of view we can 
say that this architecture exhibits nearly the same performance as with the 
previous one. However, from the frequency response point of view, in the same 
conditions in terms of devices aspect ratios the location of the second pole in the 
latter is a little farther and as a result the phase margin is better. The reason for that 
is behind the capacitance seen at the drain of M1 and M2. While this capacitance, 
shown in Figure 5.23 is }   ¬ØK≈Ω, for the latter it is }  ¬ØK≈ΩU. The reader 
can readily obtain the differential voltage gain of this op amp as 
 
 
#0 	

+

+ 	
‚Ä°¬Ø5√ÖH2
¬Ø√©¬Ø 
 (5.29) 
 
Where !"#  !"
  !"
/, !%#  !%
  !%
/, X"  X"U 	 X"‚Äû and, X"  X"U 	
X"‚Äû. It is recommended that the interested reader perform all analyses such as 
frequency response and slew rate calculation for both given differential current 
mirror op amps by pursuing the procedure described in Chapter 4. 
5.4.3 Fully Differential Folded-Cascode Op Amp 
As discussed in Chapter 4, in fact folded-cascode architecture is a variant of the 
telescopic cascode in which the output swing limitation has been eliminated and 
 
Figure  5.24 Another structure for a differential current mirror op amp. 
K:1
1:1
K:1
2I0
vi
+
vi
-
M1a
M2a
M3a
M4a
M5a
M6a
M7a
M8a
2I0
M1b
M2b
vi
+
M7b
M8b
VDD
vo
+
vo
-
M3b
M4b
M6b
M5b
1:K
1:1
1:K

130 
CMOS Fully Differential Op Amps 
 
thus it is suitable for low-voltage applications. Figure 5.25 shows the schematic of 
an FD folded-cascode op amp. When this circuit is compared with its single-ended 
counterpart we notice that the only difference between the two architectures is that 
the wide swing current mirror is replaced by a simple current source. Here again 
all analyses presented in Chapter 4 for the single-ended folded-cascode op amp are 
applicable for the FD one. Therefore we can use all given relationships in Chapter 
4 to design the differential type. It should be pointed out that employing a proper 
CMFB circuit to stabilize the output CM voltage in this structure is also 
indispensable. 
 
Design Example 
 
Since the FD folded-cascode has the most application in low-voltage design, we 
put forth a design procedure for such an architecture, which is shown in  
Figure 5.25. On the other hand, many differential op amps are usually used in 
switched-capacitor circuits or in a mixed-mode system where a digital clock signal 
is naturally accessible. For this reason we choose the switched-capacitor method to 
realize the CMFB circuit in order to utilize all its benefits. This time we intend to 
design our op amp in a 0.18-\≈† CMOS technology where its main parameters are 
-eY 	 √å-eR√å 	 T=[, 
hY"V 	   =\¬∂[, 
hR"V 	 =\¬∂[, 
and 
the 
subthreshold factor equals - 	   #IR "V

	 T. The required op amp 
specifications are: 
 
 
Figure  5.25  FD folded-cascode op amp. 

 
5.4 Fully Differential CMOS Op Amp Architectures 
131 
 
 
 
Dc voltage gain: 4 % = (BT-dB) 
 
Unity gain bandwidth: M √∑ =_ `a 
 
Phase margin: N& √∑ <‚Ä∫ 
 
Slew rate: O' √∑ T[\] 
 
Load capacitance: Z 	 C¬µ 
 
First we determine the value of the tail transistor current from the given slew 
rate. As the slew rate is calculated from O' 	 WqU%‚Ä¢ Z

 we need to have WqU%‚Ä¢	
W)≈Ω 	  \¬∂ and thus W) 	 W) 	 <\¬∂. From the given bandwidth, the 
minimum required transconductance of the input devices is obtained. Since 
LM 	 X0 Z

, with LM 	   ‚Äπ =_ `a, we get X0 	 ;T ≈†¬∂ [
 . From 
X0H 	 ¬æ‚Ä¢hY"Vo p
 HW)≈Ω √∑ ;T≈†¬∂[ with ¬æ  A, we reach the 
inequality o p
 H  =. In practice, different output parasitic capacitances 
including the capacitances of the CMFB circuit are added to the load capacitance 
and thus reduce the effective bandwidth. Moreover, the given dc voltage gain with 
a limited input transconductance is achievable if we have a large output resistance 
by using long-channel devices in the cascode stage. This of course leads to a large 
gate area for these devices and as a result affects the frequency response. By 
taking o p
 H 	  we obtain a larger X0H to help to alleviate some of these 
issues. The channel length is chosen as pH 	 \≈† to minimize the short-channel 
effect that gives oH 	 \≈†. Since transistors M4 and M5 act as current 
sources that provide the drain current of M1, M2, M6, and M8, we take W)√á 	
W) 	 W)≈Ω 	  \¬∂. Allocating equal bias currents for the differential pair of 
(M1, M2) and the cascode transistors M6 and M7 the bias current of the cascode 
devices also becomes W)√™/ 	 <\¬∂. The sizes of M6 to M11 are calculated 
based on choosing an appropriate value for the overdrive voltage of each device. 
To get a reasonable aspect ratio for devices and attain enough output voltage 
swing, an identical overdrive voltage of about≈†[ is allocated to all NMOS 
devices from M8 to M11 and less than  ≈†[ is allocated to M6 and M7. Based 
on the given data for the process and with these overdrive voltages, the aspect ratio 
of o p
  	 = is obtained for M8 to M11. In order to have adequate large output 
resistance to achieve the required dc voltage gain, the channel length of p 	 \≈† 
is selected for M8 to M11. Consequently the size of M8 to M11 will be 
=\≈† \≈†

. The loading effect of the drain-source resistance of M4 and M5 
leads to decrease the voltage gain. Since these devices carry relatively large 
currents, it is necessary to minimize the parameter of | 	 }#K ‚Äúp‚Ä¢-)D  -)DHKUq‚Äì

 
to attain the maximum resistance (√í" 	 |W))). The drain-source voltage can be 
increased by lowering the dc bias voltage of -‚ÄûR, while selecting a channel length 
of p√á 	 p 	 =\≈† helps to increase the output resistances of the devices as 
well. The bias current W‚Ä¢ 	  \¬∂ supplies the current of the tail transistor M3. 
In the design of the CMFB circuit, some points should also be taken into 
account. The sampling capacitance K is determined based on a trade-off among 

132 
CMOS Fully Differential Op Amps 
 
several parameters including speed, accuracy, and loading effect. As discussed 
earlier, a large K helps to reduce the charge sharing error due to the switches, and 
if it is chosen adequately larger than  it can also decrease the transient time of 
CMFB circuit to reach its steady state through lessening the factor }. But at a 
certain clock frequency a large K reduces the equivalent resistance of the CMFB 
circuit seen at the op amp output, which lowers the dc voltage gain. To minimize 
the 
error 
of 
charge 
sharing, 
we 
allocate 
a 
small 
size 
of 
o p
 K‚Ä¢ 	 = \≈† A\≈†

 to the switches employed in the CMFB circuit and 
take  	  =¬µ and K 	   	 =¬µ, which gives } 	  C
 . It should be 
pointed out that the usual ac simulation in SPICE here cannot be used to obtain the 
ac parameters such as dc voltage gain, bandwidth, or phase margin of the op amp. 
This is because there is an SC CMFB circuit whose switches are controlled by the 
clock signal in the time domain. Hence we have to use periodic steady state (pss) 
analysis in SpectreRF [10] to get these parameters. The whole designed circuit 
(including the bias circuitries and all device sizes) is shown in Figure 5.26.  
Performing this simulation on the circuit using the BSIM4 model for all MOS 
devices, we obtain 4 	 BT>?, LM 	   ‚Äπ T;A_ `a, N& 	 BB‚Ä∫, and power 
dissipation of =T≈† . 
As we know in single-ended op amps, slew rate simulation is performed by 
placing the op amp within a voltage follower configuration and applying a 
relatively large step voltage as input. For FD op amps we cannot use such a 
configuration. As a result we use a feedback amplifier with a voltage gain of one, 
as shown in Figure 5.27. Very large parallel resistors are used across all capacitors 
to provide the required dc path to avoid any simulation error. In reality the 
combination of switches and capacitors realizes such a dc path when the op amp is 
used in a real switched-capacitor circuit. The output slew rate on both the positive 
and negative slope is O' 	 C=[\]. The reason for the difference between our 
design goal and the obtained result is associated with other parasitic capacitances 
except for the load capacitance from the output devices and CMFB circuit, which 
are added to the load capacitance. If reaching the given spec for slew rate is 
important to us, we can increase the tail current of the differential pair. Of course 
this action causes a reduction in the dc voltage gain that can be compensated by 
increasing the channel lengths of the devices that have contributed to the voltage 
gain. 
 

 
5.4 Fully Differential CMOS Op Amp Architectures 
133 
 
 
 
Figure  5.27 Unity gain differential amplifier used to simulate op amp slew rate. 
Figure  5.26 Complete designed FD folded-cascode op amp. 
+
+
-
-
vi
+
vi
-
vo
+
vo
-
c1
c2
c1
c2
100 M‚Ñ¶
100 M‚Ñ¶
100 M‚Ñ¶
100 M‚Ñ¶
0.5 pF
0.5 pF
0.5 pF
0.5 pF
VDD=1.8V
IB=12 ¬µŒë
vo
+
vo
-
vi
+
vi
-
M0
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
œÜ2
œÜ1
Cs
Cs
Cf
Cf
Vcr
clk
M12
M13
M14
M15
M16
M17
M18
M19
M20
M21
M22
M23
100/1
200/1.5
50/1
50/1
50/0.5
20/1.5
20/1.5
10/1
10/1
1/0.5
1/1
10/1
100/1
0.5 pF
0.5 pF
0.25 pF
0.25 pF
0.5/0.18
M24
M25
1/5
1/5

134 
CMOS Fully Differential Op Amps 
 
5.5 Conclusion 
In this chapter, we studied a fully differential op amp, which is one of the most 
important building block in mixed-mode integrated circuits. The CMFB as a key 
network that is a dispensable part of any FD op amp was first introduced from the 
systematic point of view and then its stability issue was discussed in detail. 
Different types of CMFB circuits that normally are used in FD op amps were 
studied and advantages and disadvantages of each type were described. At the end, 
one design example was given in which we dealt with a folded-cascode FD op 
amp. A switched-capacitor network was selected as the CMFB circuit of our op 
amp and some practical design points in conjunction with the employed switched-
capacitor CFMB circuit were pointed out. 
References 
[1] Spinelli, E. M., Garcia, P. A., and Guaraglia, D. O., ‚ÄúA Dual-Mode Conditioning Circuit for 
Differential Analog-to-Digital Converters,‚Äù IEEE Trans. Instrumentation and Measurement, Vol. 
59, Jan. 2010, pp. 195-199. 
[2] Huijsing J., Operational Amplifiers: Theory and Design, Springer, May 25, 2011. 
[3] Baker R. J., CMOS: Circuit Design, Layout, and Simulation, Third Ed, John Wiley & Sons, 2010. 
[4] Razavi B., Design of Analog CMOS Integrated Circuits, McGraw-Hill, 2001. 
[5] Pasch, T., Kleine, U., and Klinke, R., ‚ÄúA Low-voltage Differential Op Amp With Novel Common 
Mode Feedback,‚Äù IEEE ICECS 1998, Vol. 2, 1998, pp. 345-348. 
[6] Garduno D. H. and Martinez J. S., ‚ÄúContinuous-Time Common-Mode Feedback for High-Speed 
Switched-Capacitor Networks,‚Äù IEEE J. Solid-State Circuits, Vol. 40, No. 8, August 2005, pp. 
1610-1617. 
[7] Rabii S. and Wooly B. A., ‚ÄúA 1.8-V Digital-Audio Sigma‚ÄìDelta Modulator in 0.8-h& CMOS,‚Äù 
IEEE J. Solid-State Circuits, Vol. 32, No. 6, June 1997, pp. 783-796. 
[8] Tauro, A., et al., ‚ÄúCommon Mode Stability in Fully Differential Voltage Feedback CMOS 
Amplifiers,‚Äù IEEE ICECS 2003, Vol. 1, 2003, pp. 288-291. 
[9] Johns D. A. and Martin K., Analog Integrated Circuit Design, New York: Wiley, 1997. 
[10] Telichevesky R., Kundert K. S. and White J. K., ‚ÄúEfficient Steady-State Analysis Based on 
Matrix-Free Krylov-Subspace Methods,‚Äù Proceedings of the 32nd Design Automation 
Conference, June 1995. 

 
 
 
135 
Chapter 6 
CMOS Output Stages 
The output stage is the last part of an op amp, which is employed to provide the 
required driving current for a heavy resistive or capacitive load. It is important that 
this stage does not impose any noticeable distortion in the output signal or 
remarkable drop in the total voltage gain. The frequency response of the stage 
should not also impose any limitation on the main amplifier bandwidth. Two other 
important parameters in the design of an output stage are power efficiency and 
maximum possible output voltage swing. In this chapter, different structures 
usually used as the output stage of an op amp are discussed. 
6.1 Class A and Class B Output Stages 
As we know, in a class A amplifier, in the absence of an ac input signal, the 
transistor operates in its active region and the ac signal is superimposed on the bias 
point. In an amplifier working in class B, in an ideal case, the transistor is biased 
exactly at the edge of conduction such that applying an ac signal causes the 
transistor to turn on [1]. A class A power amplifier has the best performance in 
terms of linearity, but its power efficiency is generally smaller than a class B 
amplifier. In this section some different structures in class A and class B 
amplifiers are briefly introduced. 
6.1.1 Source-Follower as an Output Stage 
Since the output resistance of a source-follower stage is usually low it can be used 
at the output as a simple driver. For the circuit shown in Figure 6.1 we have 
 
 
!" 	 !%  !fD
(6.1)
 
 
!fD 	 -e  t
%:
√Ü√Ö  
 (6.2) 

136 
CMOS Output Stages 
 
where ¬∞  hY"Vo p
  with hY as an electron mobility, "V as the gate-oxide 
capacitance per unit area, and o p
  as the M1 aspect ratio. The effective 
threshold voltage -e in (6.2) itself is given by 
 
 
-e 	 -e  ‚Äô‚Ä¢ ‚Äù‚Ä¢  !"  -D‚Ä¢  ‚Ä¢ ‚Äù‚Ä¢ 
 (6.3) 
 
where -e is the zero-bias MOS threshold voltage, ‚Äô is the body effect factor, ‚Äù‚Ä¢ 
is the Fermi potential, and -D‚Ä¢ is the source-to-body potential. The drain current is 
given by 
 
 
¬Æ) 	 W 


8¬≥
(6.4)
 
Using the above equations, we can get the relationship between input and output 
as 
 
! 	 !%  -e  ‚Äô‚Äú‚Ä¢ ‚Äù‚Ä¢  !"  -D‚Ä¢  ‚Ä¢ ‚Äù‚Ä¢‚Äì  √Å
¬©{S
¬≥¬¨
√Ü√Ö
 
 (6.5) 
 
According to (6.5), this stage shows a nonlinear behavior that results in generating 
higher harmonics at the output for a pure sinusoidal input voltage. If the dc level 
of the input voltage is the same as the dc gate-source voltage of M1, in static 
condition for !% 	 , the dc level of the output voltage becomes zero as well. In 
this condition the small-signal voltage gain can be calculated by taking the 
derivation of (6.5) with respect to !% at !% 	 . 
 
Figure  6.1 Source-follower output stage. 
VDD
vi
iD
vo
RL
I0
M1
-VSS

 
6.1 Class A and Class B Output Stages 
137 
 
 
 
√∂
 	
#

#
*
'

'
	  
¬∏
‚Ä¢¬ß¬®4k¬®

#

#
*
'

'

2
√â√Ö¬≥
√Å2¬©√äS
¬≥
¬¨
√â√Ö
#

#
*
'

'
 
 (6.6) 
 
After some manipulation on (6.6), the voltage gain is obtained as 
 
 
√∂
 	
¬Ø58¬≥
¬Ø5√å¬ø5y√å¬≥
 
 (6.7) 
 
In (6.7), X0 is the MOSFET‚Äôs transconductance and ¬πX0‚Äû¬π expresses the body 
effect. As discussed in Chapter 2, X0‚Äû is given by 
 
 
X0‚Äû 	 
¬∏¬Ø5
‚Ä¢¬ß¬®4k¬®
 (6.8)
 
To find the output voltage swings, the ideal current source is replaced with the 
current mirror circuit, as illustrated in Figure 6.2. The lower limit of the output 
swing depends on the values of W and 'Z so that if we have 'ZW  [, the swing 
is limited when M2 enters the triode region; otherwise, M1 turns off earlier and as 
a result the output voltage is clipped at 'ZW. If the maximum input voltage is 
less than [√ç√ç, M1 always remains in saturation and the upper limit of the output 
voltage is much less than [√ç√ç Based on this discussion, the output-input large-
signal characteristic of the source-follower stage can be obtained as plotted in 
Figure 6.3. Evidently, a large swing toward the negative rail for a low-resistance 
load (small 'Z) entails a large amount of dc bias current W, which leads to 
increasing the power dissipation and gives low-power efficiency. In the source-
 
Figure  6.2 Source-follower with current mirror bias circuit. 
VDD
-VSS
Iref
vi
vo
RL
I0
M1
M2
M3

138 
CMOS Output Stages 
 
follower stage the output swing is usually quite less than the supply voltage. To 
increase the swing, we can use a common-source stage as shown in Figure 6.4. 
The maximum output voltage swing downward (upward) is limited when M1 (M2) 
enters the triode region. When the output voltage goes up eventually M1 turns off 
and if M2 remains in saturation the peak of the current is delivered to the load that 
equals the drain current of M2. In the negative cycle of the input voltage the 
current sunk from the load is 
 
 
¬ÆZ
/ 	 ¬Æ)  W 	
√Ü√Ö
 ‚Äú!%  -DD  -e‚Äì
  W 
 (6.9) 
 
As long as M1 remains in saturation, ¬ÆZ
/ increases with !%, as stated by (6.9) until 
 
Figure  6.3 Output-input large-signal characteristic of a source-follower stage. 
 
Figure  6.4 Common-source output stage. 
VDD+VT1
VDD
VDD-Vod1
VGS1
-RLI0
vi
vo
VT1-RLI0
-VSS
-VSS+Vod2
-VSS+Vod2+VGS1
M2: Triode Region
M1: Triode Region
M1: Off
0
VDD
-VSS
vi
vo
RL
VB
M1
M2
I0

 
6.1 Class A and Class B Output Stages 
139 
 
 
M1 is placed at the edge of the triode region where the maximum of ¬ÆZ
/ is obtained 
from 
 
¬ÆZ0UV
/
	
4kk/4S√Ö
8¬≥

 (6.10)
 
where -"
 is the overdrive voltage of M1. For small 'Z, ¬ÆZ0UV
/
 could be greater 
than the bias current of W and thus the output voltage swing is not symmetric in 
two directions. The power efficiency is defined as the ratio of the consumed power 
in the load to the average power drawn from the supply [2] 
 
 
( 	
√Ö
28¬≥%¬≥
2
4::{
 (6.11) 
 
Assuming maximum load current is limited to W and M2 is at the edge of the 
triode for this level of current, we can achieve the maximum possible power 
efficiency for a class A power amplifier as  
 
 
() *+	

√á
4::/4S2
4::
 
 (6.12) 
 
where-"
 is the M2 overdrive voltage. For-))  -"
, we have() *+ ,  =- . 
Having a fixed and independent quiescent current with respect to the process, 
supply voltage, and temperature variations (PVT), high-output swings and good 
linearity are the main advantages of a common-source class A power amplifier but 
low-power efficiency and unsymmetrical swings are its disadvantages. 
6.1.2 Class B Power Amplifier 
By using two complementary PMOS and NMOS transistors as two source-
follower stages, it is possible to implement an output stage with the capability of a 
driving high-output current and high-power efficiency. In the circuit shown in 
Figure 6.5, owing to the threshold voltage of M1 and M2 when the input voltage 
 
Figure  6.5 A simple Class B CMOS output stage. 
VDD
-VSS
RL
vi
vo
M1
M2

140 
CMOS Output Stages 
 
changes in the range of . √å-e√ó√å  !%  -eY, both transistors are off and as a result 
there is no voltage at the output. Thus a distortion known as cross-over distortion 
appears at the output. The diode-connected transistors M4 and M5 shown in 
Figure 6.6 put M1 and M2 at the edge of the conduction state that leads to 
reduction of this kind of distortion [3]. 
In Figure 6.6 suppose M1 and M2 are the same; in a static condition when 
!% 	  we have 
 
!fD√á  !Df 	 !fD  !Df 
 (6.13) 
 
In a no-signal condition, the bias currents of M3 to M6 are all W and for the same 
drain current in M1 and M2 (¬Æ) , ¬Æ)), using (6.13), we have 
 
 
-eY  t
{
√Ü√ã √å-e√ó√å  t
{
√Ü√© 	 -eY  t
%:√Ö
√Ü√Ö  √å-e√ó√å  t
%:2
√Ü2  
 (6.14) 
 
where ¬∞% 	 hYHR"Vo p
 % for¬Æ 	 H HTH=. In (6.14) we have ¬Æ) , ¬Æ)  W) 
and thus the quiescent current in M1 and M2 can be calculated as 
 
 
W) 	 W /
√Ö
‚Ä¢√â√ã
 √Ö
‚Ä¢√â√©
√Ö
‚Ä¢√â√Ö
 √Ö
‚Ä¢√â2
0

 
 (6.15) 
 
Equation (6.15) proves that the quiescent current of the output transistors only 
 
Figure  6.6 Class B output stage with elimination of cross-over distortion. 
VB
vi
RL
VDD
-VSS
M1
M2
M3
M4
M5
M6
vo
I0

 
6.1 Class A and Class B Output Stages 
141 
 
 
depends on the sizing of M1, M2, M4, and M5 and it is almost independent of 
process, temperature, and voltage. 
In the negative cycle of the input voltage of !%, the drain voltage of M6 
increases, which makes M1 more conductive and simultaneously decreases the 
conduction of M2, so M1 provides the required drive current to the load. In this 
condition the output voltage swing reaches the upper limit when M3 enters the 
triode region 
 
 
!"

0 	 -))  -"#≈Ω  !fD√Ö 
 (6.16) 
 
Writing !fD in terms of the load current and noting that the load current itself is a 
function of the output voltage, we can derive !"

0 as 
 
 
!"

0 	 - 

‚Ä¢√Ü√Ö8¬≥4√Ö 
 (6.17) 
where 
 
-  -))  -"#≈Ω  -eY
 (6.18)
 
Figure 6.7 shows the variation of !"

0versus the load resistance when it changes 
from zero to infinity. In practice, for large 'Z it is possible that !"

0becomes 
greater than -. Under this condition the drain current of M1 is too small and 
therefore M1 operates in the subthreshold region with !fD  -eY. 
With the provided dc bias voltage at the gates of the output transistors in 
Figure 6.6, this stage indeed works as a class AB power amplifier in which the 
cross-over distortion is minimized and at the same time the circuit holds a 
minimum stable quiescent current. The supply current for a sinusoidal input 
voltage is shown in Figure 6.8. This current can be exploited to derive the power 
efficiency of the amplifier. For[√ç√ç 	 [ the average power drawn from the 
supply is 
 
 
NK 	
4::{√ö
1
 
 (6.19) 
 
Figure  6.7 Maximum output voltage swing vs. load resistance. 
V1
vom
+
RL
0

142 
CMOS Output Stages 
 
And power efficiency in terms of the peak of the load current W√ó will be 
 
 
( 	
1
√á
8¬≥{√ö
4::
 (6.20)
 
In an ideal case for 'ZW√ó 	 -)) the maximum efficiency is  T
 . Of course in this 
circuit the output peak voltage is -, which is quite less than [√ç√ç and this is 
considered as the main drawback of this structure. 
6.2 Drain-Coupled Complementary Transistors as Output Stage 
The deficiency of the previous circuit in the output voltage swing can be 
compensated by using two PMOS and NMOS transistors in a common-source 
configuration, as illustrated in Figure 6.9. The dc voltage sources -‚Ä¢ are used to 
put both transistors at the edge of conduction. In the positive half-cycle of the ac 
input voltage, M1 is more conductive while the amount of conduction in M2 
reduces so that the output voltage goes down and M1 sinks the load current. In the 
negative half-cycle of the input, the role of M1 and M2 are interchanged and M2 
 
Figure  6.8 Supply current waveform of a class B output stage. 
 
Figure  6.9 Complementary common-source configuration as an output stage. 
isup
t
IP
isup
+
isup
-
0
T/2
3T/2
T
VDD
-VSS
RL
vo
vi
+
+
-
-
VB
VB
M1
M2

 
6.2 Drain-Coupled Complementary Transistors as Output Stage 
143 
 
sources the current to the load while M1 approaches the cutoff region. The upper 
(lower) level of the output voltage swing is limited when M2 (M1) enters the 
triode region. Denoting the maximum output voltage that places M2 at the edge of 
the triode region by !"0
 , we see M1 is off in this condition and the entire load 
current is provided by the drain current of M2. For !" 	 !"0
 , M2 places at the 
edge of the triode region and thus we can write 
 
 
!D)HKUq 	 t
%:2
√Ü2 	 -))  !"0
  
 (6.21) 
 
Since ¬Æ) 	 !"0

'Z

, using (6.21) we can obtain !"0
  as follows 
 
 
!"0
 	 -)) 

‚Ä¢√Ü28¬≥4:: 
 (6.22) 
 
Similarly !"0
/  as the maximum output swing in the negative half-cycle of the 
output voltage is given by 
 
 
!"0
/ 	 -)) 

‚Ä¢√Ü√Ö8¬≥4:: 
 (6.23) 
 
A symmetrical output swing is achievable provided that two PMOS and NMOS 
output devices are identical. This condition is satisfied by choosing proper sizing 
for M1 and M2 in such a way that we have 
 
 
F
i
Z G
 	
√É√Ñ
√ÉQ F
i
Z G

(6.24) 
 
It is apparent from (6.22) or (6.23) that the maximum output swing increases for 
large 'Z and also higher ¬∞ 	 h"Vo p
  for M1 or M2. Generally the load 
current in the circuit of Figure 6.9 is the difference of the M1 and M2 drain 
currents 
 
¬ÆZ 	 ¬Æ)  ¬Æ)
(6.25)
 
If it is supposed that M1 and M2 are exactly identical, the drain current 
relationships for these devices become 
 
 
¬Æ) 	
√Ü
 !%  -‚Ä¢  -KK  -e 
 (6.26) 
 
 
¬Æ) 	
√Ü
 -##  -‚Ä¢  -e  !% 
 (6.27) 
 
where it is assumed that ¬∞ 	 ¬∞  ¬∞. Hence the load current when both M1 and 
M2 are on and operate in the saturation region is given by 

144 
CMOS Output Stages 
 
 
 
¬ÆZ 	  ¬∞-))  -‚Ä¢  -e!% 
 (6.28) 
 
When M1 or M2 turns off, the load current is equal to the drain current of the 
other conducting device. If there is no ac signal at the input, the output quiescent 
current W) is obtained by setting !% 	  in (6.26) or (6.27) 
 
 
W) 	
√Ü
 -))  -‚Ä¢  -e 
 (6.29) 
 
Figure 6.10 depicts the load current and the M1 and M2 drain currents versus the 
input voltage !%. The capability to source or sink a lot of current to or from a 
heavy load and having a symmetrical rail-to-rail output swing are the remarkable 
advantages of this structure but its main drawback is that its quiescent current 
depends drastically on process, voltage, and temperature. This issue can be 
quantified by using (6.29) to express the relative variation of the quiescent current 
with respect to -))H -e, and -‚Ä¢ as 
 
 
2{:
{: 	 
2344
4√Ö

24¬®
4√Ö  
 (6.30) 
 
If we expect to drive heavy loads such as small 'Z or large load capacitance by 
this circuit, the channel aspect ratio of the output transistors should be taken 
adequately large. On the other hand, in order to have a small quiescent current 
according to (6.29), we need to minimize -  -))  -‚Ä¢  -e. This results in two 
consequences. First, it reduces the linear operation range of the circuit, as can be 
 
Figure  6.10 Load current variation in terms of ac input signal. 
-V1
+V1
IDQ
0
VDD/RL
-VDD/RL
iD1
iD2
io=iD2-iD1
vi
V1=VDD-VB-VT
io, iD1, iD2

 
6.2 Drain-Coupled Complementary Transistors as Output Stage 
145 
 
 
seen from Figure 6.10. Second, it increases the sensitivity of the quiescent current 
to PVT variations based on (6.30). As an example, in a typical condition, for 
-)) 	  =[H -e 	 =[H -‚Ä¢ 	 ;[, and ¬∞ 	 T ≈†¬∂ [

, the quiescent current 
becomes about  \¬∂. Now suppose at high temperature in the fast corner of the 
process, -e changes to C=[ and supply voltage also increases by 4% ([). This 
causes W) increases to  T=\¬∂! So in spite of the remarkable advantages of this 
circuit we need to have a class AB output stage with the symmetrical and rail-to-
rail output voltage swing and also stable quiescent current with respect to PVT 
variations. Figure 6.11 shows one such circuit. 
It is assumed that the circuit is symmetrical about axis AA' so that the pairs of 
M1-M2, M3-M4, M5-M9, and M6-M10 are mutually identical with each other. In 
static condition for !% 	 , summing the gate-source voltages in the loop 
consisting of M5, M6, M3, and M2 gives 
 
 
-fD  -Df√™  -Df≈Ω  -fD 	  
 (6.31) 
 
Using the corresponding relationships of the gate-source voltages for an MOS 
device whose drain current follows the square law, from (6.31) we get 
 
 
Figure  6.11 A CMOS class AB output stage with stable quiescent current. 
VDD
-VSS
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
I0
I0
RL
vo
vi
A‚Äô
A
I1
I2

146 
CMOS Output Stages 
 
 
-eY  t
{
√Ü√©  *-eR*  t
{
√Ü√≠ 	 *-eR*  t
{√Ö
√Ü√ë  -eY  t
{√Ö
√Ü2 
 (6.32) 
 
From (6.32) the static current W is obtained 
 
 
W 	 W /
√Ö
‚Ä¢√â√©
 √Ö
‚Ä¢√â√≠
√Ö
‚Ä¢√â2
 √Ö
‚Ä¢√â√ë
0

 
 (6.33) 
 
There is another equation exactly similar to (6.31) for M1, M4, M9, and M10 that 
can be written and solved to getW as follows 
 
 
W 	 W /
√Ö
‚Ä¢√â

√Ö
‚Ä¢√â√Ö
√Ö
‚Ä¢√â√Ö
 √Ö
‚Ä¢√â√ã
0

 
 (6.34) 
 
The quiescent current of the output transistors M11 and M12 are copies of W and 
W, which are produced by the current mirrors M7-M11 and M8-M12, respectively. 
 
 
W) 	
F¬≤
¬≥ G√Ö√Ö
F¬≤
¬≥ G√Ø
W
(6.35)
 
 
W) 	
F¬≤
¬≥ G√Ö2
F¬≤
¬≥ G
W
(6.36)
 
In the static condition, if no dc current flows through the load for !% 	  we have 
!" 	 . Because of the circuit symmetry, we have W 	W so the output voltage in 
dc state becomes zero if we have W) 	 W). From (6.35) and (6.36), this 
condition is equivalent to meet the following relationship: 
 
 
F¬≤
¬≥ G√Ö√Ö
F¬≤
¬≥ G√Ø
	
F¬≤
¬≥ G√Ö2
F¬≤
¬≥ G
 
 (6.37) 
 
In the circuit of Figure 6.11 due to the fixed bias current W, the gate-source 
voltages of M5 and M6 are constant. Thus by going up the input voltage !%, the 
effective voltage across two series gate to source of M2 and M3 decreases and that 
of M1 and M4 increases, and as a result the drain current of M2, M3, and M7 
decreases while the corresponding current in M1, M4, and M8 increases. These 
changes are reflected to the output stage through the current mirrors M7-M11 and 
M8-M12. Consequently it will sink the current from the load more than what M11 
sources current to the load, and thus the output voltage goes down. We now obtain 

 
6.2 Drain-Coupled Complementary Transistors as Output Stage 
147 
 
 
the analytic relationship for the currents ¬Æ and ¬Æ in the presence of the input !%. 
For the partially drawn circuit shown in Figure 6.12, we can write 
 
 
!% 	 !fD  !Df√á  -‚Ä¢
 (6.38)
 
where -‚Ä¢ is defined as: -‚Ä¢  -eY  ‚Ä¢ W ¬∞

 *-eR*  ‚Ä¢ W ¬∞

. Equation 
(6.38) can be rewritten as follows: 
 
 
!% 	 -eY  t
%2
√Ü√Ö  *-eR*  t
%2
√Ü√ã  -eY  t
{
√Ü  *-eR*  t
{
√Ü√Ö 
(6.39) 
 
By solving (6.39) we get a relationship for ¬Æ in terms of !% 
 
 
¬Æ 	
√Ü
 !%  -5!%  - 
 (6.40) 
 
where ¬∞  ¬∞¬∞√á ‚Äú‚Ä¢¬∞  ‚Ä¢¬∞√á‚Äì


 and -  ‚Ä¢ W‚Äú ‚Ä¢¬∞

  ‚Ä¢¬∞

‚Äì. Similarly, 
a part of the main circuit used to derive ¬Æ is shown in Figure 6.13. Here -f≈Ω is the 
applied voltage to the gate of M3 and defined as -f≈Ω 	 !%  -fD  -Df√™. For 
this circuit we have 
 
 
!fD  !Df≈Ω  !%  ‚Äú-fD  -Df√™‚Äì 	  
 (6.41) 
 
Similar to (6.39), we have 
 
 
-eY  t
%√Ö
√Ü2  *-eR*  t
%√Ö
√Ü√ë  !%  -eY  t
{
√Ü√©  *-eR*  t
{
√Ü√≠ 	  (6.42) 
 
Figure  6.12 A part of the circuit of Figure 6.11 used to derive 6. 
VDD
-VSS
M1
M4
M8
vi
VB
i2

148 
CMOS Output Stages 
 
And finally from (6.42) we get ¬Æ 
 
 
¬Æ 	
√Ü7
 -8  !%5!% -
¬º 
 (6.43) 
 
where ¬∞8  ¬∞¬∞≈Ω ‚Äú‚Ä¢¬∞  ‚Ä¢¬∞≈Ω‚Äì


 and -8  ‚Ä¢ W‚Äú ‚Ä¢¬∞

  ‚Ä¢¬∞√™

‚Äì. Because 
of the circuit symmetry, we have - 	 -
¬º and ¬∞ 	 ¬∞8. Figure 6.14 illustrates 
changes of ¬Æ and ¬Æ versus !%.  
For the size ratio of ‚Äò in the current mirror circuits implemented by M7-M11 
and M8-M12, the ac load current will be 
 
 
¬ÆZ 	 ‚Äò¬Æ  ¬Æ
<TT
 
Figure  6.13 A part of the circuit of Figure 6.11 to derive 9. 
 
Figure  6.14 i1 and i2 variation versus vi. 
VDD
-VSS
M2
M3
M7
VG3
i1
-V1
 +V1
i2
i1
i1 i2
,
vi
I1=I2= Œ≤
2 V1
2

 
6.3 Low-Voltage Class AB Buffer 
149 
 
Substituting (6.40) and (6.43) into (6.44), we get 
 
 
¬ÆZ 	  ¬∞‚Äò-!%
 (6.45) 
 
By applying !% to the gate of M2 (M9) and connecting the gate of M5 (M1) to 
ground, the output current will be in phase with the input. If the circuit has a single 
positive supply with -DD 	 , the gate of M2 (M9) and M5 (M1) should be tied to 
an appropriate positive bias voltage. This voltage needs to be high enough in order 
to keep M3 and M4 in saturation in the worst case when MOS transistor threshold 
voltage is on the highest value, which happens in the slow-slow process corner and 
at minimum operation temperature. Using a little bit of modification in the circuit 
of Figure 6.11, this circuit can be changed to a fully differential class AB 
amplifier, as shown in Figure 6.15. 
6.3 Low-Voltage Class AB Buffer 
In the circuit of Figure 6.11 we had two voltage drops across the gate-source of 
M6 (M7) and M9 (M8) plus two overdrive voltages of M1 (M2) and M4 (M3) 
between two rails. As a result, the minimum total supply voltage of the circuit 
needs to satisfy the following inequality 
 
 
-))  ¬π-DD¬π √∑ -eY  *-eR*  T-"
 
 (6.46) 
 
 
Figure  6.15 A fully differential class AB amplifier. 
VDD
-VSS
M1
M2
M3
M4
I0
I0
vo
-
vi
+
I1
I2
M8
vo
+
vi
-
M10
M12
M14
M16
M5
M6
M7
M9
M11
M13
M15

150 
CMOS Output Stages 
 
where -"
 is the overdrive voltage for each MOS device. Therefore the circuit of 
Figure 6.11 is not appropriate for low-voltage applications. In this section, we will 
analyze an adopted low-voltage buffer [4] that is shown in Figure 6.16. 
In a static condition when !% 	 , the input differential pair tail current is 
divided equally between Ma and Mb and we have -Df$ 	 -K)$ 	 -Df# 	 -D)#, 
therefore all MOS transistors including Mc, Md, M1, M3, and M5 have the same 
gate-source voltage and thus identical drain current density 
 
 
{:√Ö
F¬≤
¬≥ G√Ö
	
{:√ë
F¬≤
¬≥ G√ë
	
{:√©
F¬≤
¬≥ G√©
	
{
F¬≤
¬≥ G+
 
 (6.47) 
 
Supposing o p
  	 o p
 ≈Ω 	 o p
 #, we have 
 
 
W)≈Ω 	 W) 	 W) 	 W
(6.48) 
and 
 
W)√á 	   ¬æW) 	   ¬æW
(6.49) 
So 
 
W 	 W)√á  W)≈Ω 	 ¬æW
(6.50)
 
On the other hand, we have 
 
 
W) 	   ¬æW)≈Ω 	   ¬æW
(6.51)
 
For o p
 √™ 	o p
  and since -fD√™ 	 -fD we also have 
 
 
W)√™ 	 W) 	 W
 (6.52)
 
So we can get W 
 
Figure  6.16 A low-voltage class AB power amplifier. 
+
-
vi
Vbp
Vbn
1:m
1:m
I1
I2
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
vo
RL
VDD
-VSS
2I0
iD1
iD3
iD5
1:(1+Œ±)
1:(1+Œ±)
Ma
Mb
Mc
Md

 
6.3 Low-Voltage Class AB Buffer 
151 
 
 
 
 
W 	 W)  W)√™ 	 ¬æW
 (6.53) 
 
The quiescent current in M11 and M12 is obtained from W and W through two 
current mirrors M8-M11 and M10-M12 
 
 
W) 	 W) 	 ¬æ&W  W
 (6.54)
 
Equation (6.54) shows that the quiescent current in the output transistors depends 
only on transistor sizing ratio and the fixed dc bias current and consequently its 
sensitivity to PVT is minimized. In [4] the low sensitivity of the quiescent current 
is attributed to the behavior of the diode-connected transistors M7-M8 and M9-
M10 as an adaptive dynamic load. Based on the description given in [4] at low-
level ac input signal corresponding to static conditions, the dynamic resistance of 
the diode-connected circuit is low and thus the voltage gain of the preamplifier 
consisting of M3-M6 is low and any voltage change due to the process or supply 
variation has less impact on the current of the output stage transistors. To more 
closely see the dynamic behavior of the circuit, we examine one of these diode-
connected circuits, which is shown in Figure 6.17. The I_V characteristic of this 
circuit is plotted in Figure 6.18. In the circuit of Figure 6.17 for !  -eY, M1 is off 
and ¬Æ 	  when ! becomes greater than the threshold voltage of M1; M1 and M2 
turn on and initially both operate in saturation so that with the assumption that 
both transistors are identical, we can write 
 
 
¬Æ) 	 ¬Æ)  
√Ü
 F-‚ÄûY  -)D  -eYG

	
√Ü
 ‚Äú!  -eY‚Äì
 
 (6.55) 
 
And thus we have 
 
 
-)D 	 -‚ÄûY  !
 (6.56) 
 
 
Figure  6.17 Diode-connected configuration as a dynamic load. 
M1
M2
Vbn
i
+
-
v

152 
CMOS Output Stages 
 
But by rising !, -)D decreases and eventually M1 enters the triode region while 
M2 stays in saturation. Therefore, by equating the drain currents of M1 and M2 
when M1 is in the triode region, we get 
 
 
√Ü
 F-‚ÄûY  -)D  -eYG

	 ¬∞√î‚Äú!  -eY‚Äì-)D 
4:k√Ö
2
 √ï  
 (6.57) 
 
Neglecting the term -)D
  
  for a small -)D at the right-hand side, we can obtain 
the relationship between ¬Æand ! as follows 
 
 
¬Æ 	
√Ü
 √ß‚Äú-‚ÄûY  -eY‚Äì 
‚Äú4y√Ñ/4¬£√Ñ‚Äì2

/4¬£√Ñ4y√Ñ√®

 
 (6.58) 
 
As can be seen from Figure 6.18, the equivalent dynamic conductance of the 
circuit corresponding to the slope of this curve, decreases by increasing the 
amplitude of the voltage !. 
The minimum supply voltage limitation in this architecture can be lowered up 
to one gate-source voltage plus one overdrive voltage. In fact the lower limit for 
the supply voltage is determined by the input differential pair rather than the class 
AB output stage. In the presence of the ac input signal, when !% goes up, the drain 
current of Ma (¬Æ)U) increases and through the current mirror Mc-M3, M5 causes 
the drain current of M3 and M5 to increase. On the other hand, by going up, the 
drain voltage of Mb the drain current of M1 reduces, which results in reducing the 
drain currents of M4 and M6 through the current mirror M2-M4, M6. All these 
changes increase W and decrease W and finally the current that is sunk from the 
load increases with !%. Similarly we can show when the input goes down, W 
increases and W decreases, which leads to an increase in the current delivered to 
the load. Since both output and input common-mode voltages are the same, when
 
Figure  6.18 I_V characteristic of the circuit of Figure 6.17. 
VTn
v
i
Œ≤
2
(Vbn-VTn)2

 
6.4 Class AB Output Stage Using a Translinear Loop 
153 
 
the circuit is used as a voltage follower, the minimum level of the output swing is 
limited by the input stage rather than M12 at the output. The lower limit of the 
common-mode voltage for the input differential pair in Figure 6.16 is given by 
 
 
-%$0%Y 	 -KK  -)DHKUqHqU%‚Ä¢ -fDH 	 !"0%Y 
 (6.59) 
 
The maximum output level, especially for a heavy load, is usually determined by 
the overdrive voltage of M11 
 
 
!D)HKUq 	 t
%¬≥5ÀÜ‚Äî
√Ü√Ö√Ö
	 -##  !"0UV 
 (6.60) 
 
where ¬ÆZ0UV is the maximum load current in which M11 is placed at the edge of 
the triode region. Since !"0UV 	 'Z¬ÆZ0UV, we get a quadratic equation versus 
¬ÆZ0UV 
 
'Z¬ÆZ0UV

  F

√Ü√Ö√Ö  'Z-##G ¬ÆZ0UV  -##
 	  
 (6.61) 
 
By solving (6.61) we can find ¬ÆZ0UV, thereby obtaining the maximum output 
swing from !"0UV 	 'Z¬ÆZ0UV 
6.4 Class AB Output Stage Using a Translinear Loop 
There is another low-voltage architecture for a class AB power amplifier that we 
will analyze in this section. The circuit indicated in Figure 6.19 has been reported 
in [5]. In this circuit W%Y is the ac input current that is provided by the first stage. 
M6 and M7 create a floating current source in which the current is determined by 
two translinear loops consisting of PMOS transistors M1, M2, M5, and M6 and 
NMOS transistors M3, M4, M7, and M8 [6]. For the PMOS translinear loop we 
can write 
 
 
-Df  -Df 	 -Df  -Df√™ 
 (6.62) 
 
Presuming the same channel length for M1, M2, M5, and M6 and also if the drain 
current density in M1 and M5 are equal (i.e., for W) o

	 W) o

), we have 
-Df 	 -Df and thus from (6.62) -Df 	 -Df√™ we get W) o

	 W)√™ o√™

 As a 
result, since W) 	 W, the drain current of M6 is given by 
 
 
W)√™ 	
i√≠
i2 W
 (6.63) 
 
In a similar way, in the NMOS translinear loop we reach the same relationship for 

154 
CMOS Output Stages 
 
the drain current of M7: 
 
 
W)≈í 	
i√Ø
i√ë W
 (6.64) 
 
For o√™ 	 =o and o≈í 	 =o≈Ω, M6 and M7 will have the same bias current of 
=W and therefore the total bias current in M5 and M8 is W. There are another 
two complementary translinear loops at the output that are used to determine the 
quiescent current of the output transistors (M13 and M14). This loop consists of 
M1, M2, M10, and M13 with the following relationship among gate-source 
voltages of these transistors: 
 
 
-Df  -Df 	 -Df  -Df≈Ω 
 (6.65) 
 
Assuming M5 with M9, M6 with M10, M7 with M11, and M8 with M12 have the 
same sizing, we can follow a similar method that is used to calculate the dc bias 
current of the floating current source to reach the quiescent current in M13 and 
M14: 
 
W)≈Ω 	
i√Ö√ë
i√ÖH2 W
 (6.66) 
 
The quiescent current of M13 can be easily adjusted as a multiple or fraction of W 
with minimum sensitivity to PVT. The quiescent current of M14 at the output is 
determined through the second translinear loop consisting of M3, M4, M11, and 
M14. The procedure to reach this current is exactly the same as for M13. The 
 
Figure  6.19 Class AB output stage with a translinear loop. 
RL
vo
VDD
-VSS
I0
I0
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
M13
M14
Iin

 
6.4 Class AB Output Stage Using a Translinear Loop 
155 
 
 
result is 
 
W)√á 	
i√Ö√ã
i√ëH√ã W
 (6.67) 
 
In static condition (!% 	 ) we desire to have !" 	  so the dc currents in M13 and 
M14 need to be equal, and thus from (6.66) and (6.67) we obtain 
 
 
i√Ö√ë
i√ÖH2 	
i√Ö√ã
i√ëH√ã
 (6.68) 
 
Considering the circuit in Figure 6.20, an injection of W%Y to the source of M10 
increases the M10 gate-source voltage by !R, which results in a change in ¬Æ) as 
 
 
¬Æ) 	 X0!R
 (6.69) 
 
The sum of the drain currents of M10 and M11 is a fixed current of W, so when the 
ac current W%Y is injected into the source of M10, to keep the total current constant, 
M10 and M11 drain currents have to be changed in the opposite direction. As a 
result, the drain current M11 reduces by :√ç 	 :√ç, which means !fDis 
lowered by an amount of !Y and consequently the drain current of M11 is 
changed by 
 
 
¬Æ) 	 X0!Y
 (6.70) 
 
Since the gate voltage of M11 is fixed, its source terminal voltage goes up by !Y. 
 
Figure  6.20 Preamplifier before the output stage transistors. 
Iin
Vbp
Vbn
M10
M11
VDD
I0
I0
-VSS
iD11
iD10

156 
CMOS Output Stages 
 
Nothing that ;¬Æ) 	 ;¬Æ) and from (6.69) and (6.70) by assuming 
X0 ‚Ä† X0, we will have !R ‚Ä† !Y. This means when an ac current is 
injected into the source of M10, the source node voltages of both M10 and M11 
will change by the same amount. In other words, there is a constant voltage 
between two nodes, or equivalently, sources of M10 and M11 in a dynamic state 
are shorted together. Therefore the total dynamic resistance seen from these nodes 
in the circuit of Figure 6.19 becomes 
 
 
'KH 	 √í" √ì √í"
(6.71) 
 
Since 'KH is a large resistance, a minimum ac current injected into the source of 
M10 will cause quite a large voltage change at this node or at the gate of the 
output transistors M13 and M14. Now we obtain an analytical relationship for ¬Æ)≈Ω 
in the presence of an ac input signal. We said that M1, M2, M10, and M13 form a 
translinear loop described by (6.65) in which the left side has a fixed value given 
by 
 
 
-Df  -Df 	  ¬©*-eR*  t
{
√Ü√ÖH2¬¨ 
 (6.72) 
 
Now let the ac current W%Y be drawn from the source of M10, which reduces the 
voltage of this node by √í" √ì √í"W%Y. Since its gate voltage is fixed, it results in 
lessening !Df in such a way that for !Df  ¬π-eR¬π, M10 operates in the 
subthreshold region where the drain current relationship is given by 
 
 
¬Æ) 	 WD≈∏
Sk¬°√Ö¬¢* ¬£Q*
¬§ ‚Ä∞¬•
 
 (6.73) 
 
In which -    #IR "V

 with #IR and "V as the MOS depletion and gate 
oxide capacitances, respectively, -q¬¶ 	 ‚Äò√£ ‚Äö
  is the thermal voltage, and WD is the 
reverse saturation current of M10. Using (6.65), (6.72), and (6.73), we find 
 
 
 *-eR*  t
{
√Ü√ÖH2 	  *-eR*+--q¬¶ ‚Ñ¢c F
%:√Ö
{k G  t
%:√Ö√ë
√Ü√Ö√ë  
(6.74) 
 
From (6.74), ¬Æ)≈Ω can be found as 
 
 
¬Æ)≈Ω 	
√Ü√Ö√ë
 √ß t
{
√Ü√ÖH2  --q¬¶ ‚Ñ¢c F
%:√Ö
{k G√® 
 (6.75) 
 
Equation (6.75) indicates when ¬Æ) decreases ¬Æ)≈Ω increases, and theoretically 

 
6.4 Class AB Output Stage Using a Translinear Loop 
157 
 
 
when ¬Æ) approaches zero, ¬Æ)≈Ω goes to infinity! In practice, by rising ¬Æ)≈Ω, M13 
eventually exits the saturation region and operates in the triode region and 
therefore the maximum output current in M13 will be limited. As can be seen in 
Figure 6.21 when M13 is at the edge of the triode, we can write: 
 
 
!D)≈Ω 	 !D)KUq 	 t
%:√Ö√ëH5ÀÜ‚Äî
√Ü√Ö√ë
	 -##  'Z¬Æ)≈ΩH0UV 
 (6.76) 
 
Solving (6.76), we can obtain ¬Æ)≈ΩH0UV, from which the maximum positive output 
voltage swing !"

0UV 	 'Z¬Æ)≈ΩH0UV is found as 
 
 
!"

0UV 	 -## 

√Ü√Ö√ë8¬≥   ‚Ä¢   ¬∞≈Ω'Z-## 
 (6.77) 
 
For ¬Æ)≈ΩH0UV, the drain current of M10 is nearly zero so that we can say almost all 
the current of M9 flows through M11 (or W) ‚Ä† W). We use this result to get the 
drain current of M14 for ¬Æ)≈ΩH0UV. As mentioned before, M3, M4, M11, and M14 
form a translinear loop with the following relationship: 
 
 
-fD≈Ω  -fD√á 	 -fD  -fD√á 
 (6.78) 
 
The left side of (6.78) is equal to  -eY  ‚Ä¢ W ¬∞≈ΩH√á

, which is fixed, and for 
¬Æ) ‚Ä† W (when W) ‚Ä† , using (6.78), we can get the drain current of M14: 
 
 
Figure  6.21 Output stage configuration at the positive peak output swing. 
iD13,max
M13
VDD
RL
vo

158 
CMOS Output Stages 
 
 
 ¬©-eY  t
{
√Ü√ëH√ã¬¨ 	  -eY  t
{
√Ü√Ö√Ö  t
%:√Ö√ã
√Ü√Ö√ã   
 (6.79) 
After some simplifications and for o p
  	 =o p
 ≈ΩH√á, the drain current of 
M14 for ¬Æ)≈ΩH0UV is obtained as 
 
 
¬Æ)√á 	  
F¬≤
¬≥ G√Ö√ã
F¬≤
¬≥ G√ëH√ã
‚Äúd  ‚Äì
W 
 (6.80) 
 
In a similar way when the ac current W%Y flows in the opposite direction, (i.e., it is 
injected into the source of M10), due to the high resistance seen at this node, the 
voltage greatly increases and !Df rises while !fD reduces, which leads M11 to 
eventually go to the subthreshold and ¬Æ) approaches W. In fact the roles of M10 
and M11 and also those of M13 and M14 are equally interchanged. We can follow 
the same procedure, this time from (6.78), when M11 operates in the subthreshold, 
we find 
 
 
-eY≈Ω  -eY  t
{
√Ü√ëH√ã 	 -eY  <-q¬¶ ‚Ñ¢c F
%:√Ö√Ö
{k G  -eY  t
%:√Ö√ã
√Ü√Ö√ã   
(4.81) 
 
In practice, because of the body effect in M3 and M11, their threshold voltages are 
different from zero-bias condition (-eY). Assuming -eY≈Ω ‚Ä† -eY, the drain 
current of M14 will be 
 
 
¬Æ)√á 	
√Ü√Ö√ã
 √ß t
{
√Ü√ëH√ã  --q¬¶ ‚Ñ¢c F
%:√Ö√Ö
{k G√® 
 (6.82) 
 
As W%Y goes up, W) reduces and ¬Æ)√á increases until M14 reaches at the edge of 
the triode region. Figure 6.22 shows the output stage when M14 is on and M13 is
off:
 
 
Figure  6.22 Output stage configuration at the negative peak output voltage. 
-VSS
RL
vo
M14
iD14,max

 
6.5 Case Study 
159 
 
 
 
!)D√á 	 !)DKUq 	 t
%:√Ö√ãH5ÀÜ‚Äî
√Ü√Ö√ã
	 -KK  'Z¬Æ)√áH0UV 
 (6.83) 
 
The maximum output voltage swing in the negative direction becomes 
 
 
!"
/
0UV 	 -KK 

√Ü√Ö√ã8¬≥   ‚Ä¢   ¬∞√á'Z 
 (6.84) 
 
By the same reasoning used to reach ¬Æ)√á in (6.80), we can get ¬Æ)≈Ω as 
 
 
¬Æ)≈Ω 	  
F¬≤
¬≥ G√Ö√ë
F¬≤
¬≥ G
√ÖH2
‚Äúd  ‚Äì
W 
 (6.85) 
 
Figure 6.23 depicts the output transistor currents (i.e., ¬Æ)≈Ω and ¬Æ)√á) as a function 
of W%Y in a typical design.  
6.5 Case Study 
In this section we study an op amp with a class AB output stage in which the 
quiescent current of the output devices is determined by a translinear loop. The 
schematic of the circuit is depicted in Figure 6.24. The circuit is a two-stage op 
amp in which a folded-cascode structure has been used as the first stage and a 
CMOS common-source amplifier acts as its second stage. The capacitors $ are 
used to compensate the op amp frequency response. As discussed in the previous 
section, a translinear loop controls the quiescent current of the CMOS amplifier 
Q
I
13
Di
14
Di
)
( A
Iin ¬µ
)
(mA
iout
 
Figure  6.23 Output transistor currents versus input ac current. 

160 
CMOS Output Stages 
 
independent of PVT. The floating current source between two wide swing diode-
connected configurations is implemented in the same way as the two transistors 
M11 and M12. This current source holds a constant current while the variation of 
the voltage across its transistors is negligible and thus acts as an ac shorted circuit. 
Under this assumption, the small-signal equivalent circuit is obtained as illustrated 
in Figure 6.25. Summing different currents flowing to the output node and also 
three other nodes of 1, 2, and 3 in this circuit, we get the following equations: 
 
 
=X0!%  √à  X0√™  X"√™  ¬Ω$!  X"√™!  ¬Ω$!" 	   
(6.86) 
 
X"√™  X0√™!  X"√™  X"  ¬Ω!  X0  X"!≈Ω 	 =X0!% 
(6.87) 
 
 
X"!  X"  X"≈Ω  X0  ¬Ω$!≈Ω  ¬Ω$!" 	  
(6.88) 
 
 
¬Ω$!  X0q!  ¬Ω$!≈Ω  √î√à  ¬Ω   $√ï!" 	  
 (6.89) 
 
where √à  X"  X"√á,√à  X"≈í  X", and X0q  X0≈í  X0. In order to 
reach the op amp transfer function we have to solve the equations above. Of 
course such a solution is too complex and would not give much perceptible 
information for design. As a result, we need to ignore some small parameters such 
as output conductance of the transistors to achieve a simple transfer function. It is 
evident that the obtained solution under these conditions just gives a rough 
estimation of the circuit behavior but it can help to an extent to find some main 
 
Figure  6.24 Op amp with a translinear loop class AB output stage. 
vo
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
M13
M14
M15
M16
M17
M18
I0
I0
I0
nI0
IQ=mI0
CL
VDD
+
-
vi
I0
0.5I0
0.5I0
Cc
Cc

 
6.5 Case Study 
161 
 
 
circuit parameters that affect important op amp specifications. Assuming the same 
transconductance for the cascode transistors as X0√™ 	 X0  X0$ and neglecting 
the output conductance of all devices, we can obtain the approximate op amp 
voltage gain as 
 
 
4¬Ω 
¬Ø5√Ö
K6,

√Ç,
2¬ø5,K/
√Ç√Ö√Ç,
2¬ø5‚Ä∞¬ø5,K2
√Ç√Ö√Ç22√Ç,
2√Ç,¬ø5‚Ä∞
K
√Ç√Ö√Ç2
2¬ø5‚Ä∞¬ø5,K2 
 (6.90) 
 
The applied approximation cause the first dominant pole that was too small now to 
move to zero and thus the dc voltage gain tends to infinity, but the second-order 
term in (6.90) nevertheless gives meaningful information about the position of 
some other nondominant poles and also zero locations in the s-plane. Comparing 
the 
second-order 
term 
in 
(6.90) 
with 
the 
general 
form 
of 
  √∂¬Ω  √∏¬Ω √î  ¬Ω Lg

  ¬Ω L


√ï

, we notice that the circuit has two real 
zeros and two generally complex poles if g  =H a condition that is usually 
satisfied in such an architecture [7]. Putting the numerator and denominator of 
(6.90) equal to zero, we get the zeros and the values of natural frequency L and 
quality factor g of the circuit as 
 
 
L√ûH 	
¬Ø5‚Ä∞
6√Ö = > √Å 
¬ø5,
√Ç,
¬ø5‚Ä∞
√Ç√Ö
? 
 (6.91) 
 
 
L 	 t
¬Ø5‚Ä∞¬Ø5,
6√Ö62

 (6.92) 
 
 
g 	
6,
626, √Å
¬ø5‚Ä∞
√Ç√Ö
2¬ø5,
√Ç2
   
 (6.93) 
 
One zero places on the left-half plane with the approximate value of 
Figure  6.25 Small-signal equivalent circuit of a two-stage class AB op amp. 
0.5gm1vi
0.5gm1vi
R1
gm6v1
ro6
gm11v3
ro11
c1
Cc
ro13
gm6v2
R2
c2
vo
+
-
v1
+
-
v2
+
-
v3
1
2
3
Cc

162 
CMOS Output Stages 
 
L√û   X0$ $

 and the other one is much far away on the right-half plane with 
the approximate value of L√û  X0q 

  X0$ $

. The pole and zero locations 
including the dominant pole are shown in Figure 6.26. For the design of an op amp 
with adequate bandwidth, the natural frequency L should be large enough that 
according to (6.92) it entails both fractions X0q 

 and X0$ 

 are adequately 
large. If the ratio of these fractions is made large it results in increasing the quality 
factor, which causes peaking in the frequency domain. This effect can drastically 
deteriorate the op amp phase margin. Of course for a certain extent of load 
capacitance , it is possible to lower the coefficient of the radical sign in (6.93) 
by taking small compensation capacitance $ compared to . In addition, a small 
$ also helps to improve the bandwidth though it decreases the phase margin as 
well so that the reduction of $ is possible as long as the minimum required phase 
margin is provided. As is evident from (6.92), a large X0q 

 allows for a large 
L that is required to make sure there is adequate stability in a wide bandwidth  
op amp. As discussed in the previous section, the quiescent currents of the output 
devices are determined by a translinear loop as 
 
 
W)≈íH 	
F¬≤
¬≥ G
√Ö√Ø
F¬≤
¬≥ G
√Ö√©H√Ö√≠
W 
 (6.94a) 
 
 
W)H 	
F¬≤
¬≥ G√Ö
F¬≤
¬≥ G√Ö√ëH√Ö√ã
W 
 (6.94b) 
 
It is interesting to note that we cannot increase X0q 

 by increasing the output 
 
Figure  6.26 Pole-zero locations of a two-stage op amp. 
0
œâ0
œâ0
- 2Q
œâp1
jœâ
œÉ
s-plane
œâz1
œâz2

 
6.5 Case Study 
163 
 
 
transistor aspect ratios or equivalently increasing the channel width for a particular 
channel length. This is because the capacitance mainly consists of the gate 
capacitances of the output transistors, which increase by raising the transistors‚Äô 
sizing. Assuming both output devices are identical with o 	 Co≈í 
(for hY  ChR), we have 
 
 
¬Ø5‚Ä∞
6√Ö 	
≈Ωt√É√Ñ6‚ÄîF¬≤
¬≥ G√Ö√Ø{:√Ö√ØH
√ái√Ö√ØZ√Ö√Ø6‚Äî
 
 (6.95) 
 
Substituting (6.94a) into (6.95) and taking the same channel length of p for all 
devices, we have 
 
¬Ø5‚Ä∞
6√Ö 	
≈Ω
√á
t 2√æ√Ñ√ä
¬≤√Ö√©H√Ö√≠
Z‚Ä¢6‚Äî  
 (6.96) 
 
From (6.96) we notice that for a certain channel length the only way to obtain a 
high X0q 

 is to increase the current density of the diode-connected MOS 
devices, including M15-M16 and M13-M14 in the translinear loops for NMOS 
and PMOS types, respectively. A high aspect ratio for the output devices is 
important to provide enough current drive capability in the heavy load condition. 
 
Design Example 
 
We plan to design an op amp in a 0.25-\≈†CMOS technology with the structure 
shown in Figure 6.24. In our design we need to have at least =_ `a of bandwidth 
and a <‚Ä∫ phase margin. Since an op amp consists of two cascaded stages 
including a folded-cascode and a CMOS amplifier, it is predictable that its dc 
voltage gain will be noticeably high. Our op amp will be able to drive a parallel 
capacitive and resistive load of Z 	  ¬µ and 'Z 	 , respectively, while 
the maximum output voltage swing is !"HRR 	 =[. For'Z 	 , with this 
peak of output voltage the output transistors should be able to provide a current 
peak of ¬Æ)H0UV 	 B=≈†¬∂ and thus their sizes are determined based on this current 
level. In order to achieve a reasonable aspect ratio for these devices, we choose 
!)DHKUq  B[Of course, it does not mean that the output of the op amp when 
used as a voltage follower cannot follow the input voltage variations less 
thanB[. This is because when one output device enters the triode region, owing 
to the large voltage gain provided by the first stage, the total open-loop gain still 
remains rather high and thus the negative feedback is able to minimize the 
distortion level. 
From 
!)DHKUq 	 ‚Ä¢ ¬Æ)H0UV ¬∞Y

 B[ and for hY"V 	
  = \¬∂ [

, we obtaino p
 Y  C< from which the size of o p
 Y 	 B is 
chosen. According to (6.96), choosing the minimum channel length helps to 
achieve the required X0q 

 with minimum power dissipation but there is another 
important issue that needs to be considered. In order for the translinear loop to 

164 
CMOS Output Stages 
 
work properly, it is required that all MOS devices in the loop operate in saturation 
with the square law relationship for their drain currents. Holding the square law to 
some extent can be met by taking the channel length a little bit more than the 
minimum permissible device channel length that is forced by the technology. Here 
we choose pY 	 C=\≈† and thus the width of the NMOS output device becomes 
oY 	 <\≈†. If the quiescent current of the output devices is made too small it is 
quite possible that they will operate in the subthreshold region due to their large 
aspect ratio. The ratio of W) o p
 Y

 for an NMOS device should be made 
adequately larger than the term of  hY"V--q¬¶ in order to make sure that the 
device remains in saturation. The value of this term in the given technology is 
about<\¬∂ and thus for o p
 Y 	 B the static drain current needs to be 
sufficiently greater than B ‚Äπ <\¬∂ 	  \¬∂. A static drain current of 
W) 	  T\¬∂ can meet this requirement quite well. This quiescent current is 
about 3% of the full load current. By choosing the current of W 	  \¬∂ for the 
bias current of the diode-connected devices, the sizing of the output devices should 
be greater than that of these diode-connected devices by the factor of & 	   in 
order to achieve W) 	  T\¬∂. All these measures result in achieving a rather 
large value for X0q 

 and thus the required X0$ 

 for a particular L would be 
small. This means that X0$ can be made rather small with a low bias current in the 
cascode transistors that aids in saving the power consumption and increases the 
output resistances that in turn help to increase the dc voltage gain of the folded-
cascode stage. The transconductance of the differential pair in the first stage is 
obtained based on the required bandwidth from LM 	 X0  $

. The schematic 
of the designed circuit including the bias circuit and all device sizing in microns is 
shown in Figure 6.27 
The results obtained from simulation in the presence of the load capacitance 
Z 	  ¬µ and without the load resistor give the dc voltage gain of 4 	 A=>?, 
the bandwidth of $o 	 = T_ `a, and the phase margin of N& 	 <‚Ä∫. The total 
 
Figure  6.27 A designed two-stage class AB op amp. 
vo
CL
VDD=2.5V
+
-
vi
I0
Cc
Cc
0.5I0
0.5I0
Ib
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
M13
M14
M15
M16
M17
M18
M19
M20
M21
M22
M23
RL
M24
M25
M26
M27
M28
M29
M30
M31
4 ¬µA
5/1
5/1
5/1
3/1
5/1
5/1
0.5/1.5
60/0.35
60/0.35
20/0.5
15/0.35
15/0.35
15/0.35
15/0.35
15/0.35
15/0.35
7.5/0.35
7.5/0.35
180/0.35
60/0.35
0.6 pF
0.6 pF
5/0.35
5/0.35
25/1
25/1
2.5/0.35
2.5/0.35
5/0.35
5/0.35
15/0.35
15/0.35
20 pF
100 ‚Ñ¶
C=1 ¬µF

 
6.5 Case Study 
165 
 
 
static power dissipation is =≈† . Then the op amp is used as a voltage 
follower with a parallel resistance of 'Z 	  across Z, as shown in Figure 
6.28. A sinusoidal input voltage with the peak value of -R 	 B=[, -#$ 	 [, and 
%Y 	 _ `ais applied to the circuit. The input and output waveforms and the 
currents of two output MOS devices are depicted in Figure 6.29. The total 
harmonic distortion (THD) of the output voltage is about CC-  and the power 
efficiency at full load is T- . 
 
Figure  6.29 (a) Input and output waveforms. (b) Currents of output devices. 
 
Figure  6.28 Voltage-follower test circuit. 
0
0.5
1
1.5
2
2.5
3
3.5
4
‚àí1
0
1
2
Time (us)
Voltage (V)
 
 
input voltage
output voltage
0
0.5
1
1.5
2
2.5
3
3.5
4
0
2
4
6
8
Time (us)
Current (mA)
 
 
iD30
iD31
‚àí
+
RL
100 ‚Ñ¶
CL
20 pF
Vp=0.75V
Vdc=1 V
fin=1 MHz
C=1 ¬µF
vo

166  
CMOS Output Stages 
 
 
6.6 Conclusion 
In this chapter, some topics in conjunction with CMOS output stages have been 
studied. Several of the most common structures normally employed as output 
stages were introduced. Such circuits should be able to provide high levels of 
current and voltage across the load and thus linearity and power efficiency are two 
significant parameters that should be taken into account in the design of such 
circuits. This entails choosing large enough sizes for the devices used in these 
stages to properly drive the heavy loads. In a class AB power amplifier utilized as 
an output stage, it is important that the quiescent current of the stage is accurately 
controlled and made fixed against process, voltage, and temperature variations. 
Several architectures of class AB amplifiers in terms of quiescent current stability 
and also the capability to work in low-voltage designs were studied and at the end 
one design example was presented and analyzed in detail. 
References 
[1] Salivahanan, S., Linear Integrated Circuits, McGraw-Hill, 2008.  
[2] Tasic, A., Serdijn W. A., Setti G., Circuits and Systems for Future Generations of Wireless 
Communications, Springer, 2009. 
[3] Gray, P. R., Hurst, P. J., Lewis, S. H., and Meyer, R. G., Analysis and Design of Analog 
Integrated Circuits, Fourth Edition, John Wiley & Sons, Inc., 2001. 
[4] You F., et al., ‚ÄúLow-Voltage Class AB Buffers with Quiescent Current Control,‚Äù IEEE Journal of 
Solid State Circuits, Vol. 33, No. 6, 1998, pp. 915-920. 
[5] Hogervorst, R., et al., ‚ÄúA Compact Power-Efficient 3 V CMOS Rail-to-Rail Input/Output 
Operational Amplifier for VLSI Cell Libraries,‚Äù IEEE J. Solid-State Circuits, Vol. 29, No. 12, 
1994, pp. 1505-1513. 
[6] Seevinck, E., Vittoz, E. A., du Plessi, M., Joubert, T. H., and Beetge, W., ‚ÄúCMOS Translinear 
Circuits for Minimum Supply Voltage,‚Äù IEEE Trans. Circuits Syst. II, Vol. 47, No. 12, 2000, pp. 
1560‚Äì1564. 
[7] Ribner, D. B., and Copeland, M. A., ‚ÄúDesign Techniques for Cascoded CMOS Op amps with 
Improved PSRR and Common-Mode Input Range,‚Äù IEEE J. Solid-State Circuits, Vol. 19, No. 6, 
1984, pp. 919-925. 

 
 
167 
Chapter 7 
CMOS Reference Generators 
Voltage and current reference generators are integral parts in most analog circuits. 
They should have minimum sensitivity to PVTs. For instance, in analog amplifiers 
a single master current source usually provides the current for biasing of devices. 
Furthermore, there are many different current sources that operate as active loads 
in amplifiers whose currents are supplied by this single master current reference 
generator. This master current is supposed to be nearly independent of PVTs. Data 
converter is another category in which a fixed voltage or current as a reference 
signal is demanded. In radio frequency applications some sensitive blocks like 
voltage-controlled oscillator, should sometimes be supplied by a separate 
reference voltage to alleviate the effect of power supply noise on their 
performance. 
In this chapter, several special architectures of CMOS voltage and current 
reference circuits are analyzed. Some of these circuits are different from typical 
circuits in terms of low operating voltage or capability to be implemented as a 
fully integrated circuit without using resistors in a submicron CMOS technology. 
7.1 CMOS Voltage Reference Generators 
The voltage reference generator is actually a circuit with dc voltage output. In the 
design of this circuit we attempt to keep the output voltage stable against the 
variation in different parameters such as supply voltage and temperature. In the 
design of an integrated reference voltage another important issue is to have an 
output voltage independent of process parameters. One of the most popular 
methods to establish such a voltage is based on using bandgap voltage. We will 
study this technique along with the practical CMOS circuits to realize this type of 
voltage. 

168 
CMOS Reference Generators 
 
 
7.1.1 Bandgap Voltage Reference Generator 
The basic building block in any reference circuit is the bandgap reference circuit 
whose principal theory is well studied in different relevant documents [1-3]. The 
main idea behind a bandgap circuit is to combine two voltages with opposite 
temperature coefficients (TCs). By proper weighting it is possible to get a near-
zero TC output voltage. The comparison between MOS and bipolar junction 
transistor (BJT) devices in semiconductor technology shows that some BJT 
parameters like -q¬¶ (thermal voltage) and base-emitter junction voltage (-‚Ä¢E are 
much more insensitive to process variations. In a bandgap circuit two voltage 
components with opposite TCs are produced by using BJTs in order to minimize 
the effect of process changes. A typical bandgap circuit that is usually used in 
most designs is shown in Figure 7.1. 
Assuming an exponential relationship between the collector current and the 
base emitter voltage and supposing M1, M2, and M4 have the same size, we can 
easily prove that the reference output voltage is obtained from 
 
 
-.I 	 -E‚Ä¢≈Ω 
82
8√Ö ‚Ñ¢c‚Ä¢ -q¬¶
(7.1) 
 
In practice, due to the offset voltage of the operational amplifier, -.I is given by 
 
 
-.I 	 -E‚Ä¢≈Ω 
82
8√Ö √î‚Ñ¢c‚Ä¢ -q¬¶  -"K√ï
 (7.2) 
 
 
Figure  7.1 Typical bandgap voltage reference circuit. 
VDD
Ibias
Vref
A
nA
nA
+
-
M1
M2
M3
M4
Q1
Q2
Q3
R1
R2

 
7.1 CMOS Voltage Reference Generators 
169 
 
 
The op amp input offset voltage might be comparable to the term of ‚Ñ¢c‚Ä¢ -q¬¶. It 
thus would be quite possible that the op amp offset voltage and its drift with 
temperature directly affects the reference output voltage. To lessen the effect of 
offset voltage the first term inside the square brackets in (7.2) needs to be made 
large with respect to -"K. Figure 7.2 shows a circuit that realizes this idea by 
increasing the mentioned term by a factor of two. In Figure 7.2 the op amp offset 
voltage is modeled by the series source voltage of -"K. Equating the voltages of the 
op amp inputs, we have 
 
 
-"K  -E‚Ä¢  -E‚Ä¢ 	 'W  -E‚Ä¢√á  -E‚Ä¢≈Ω
 (7.3) 
 
Supposing that the same current flows through M1 to M4, we can obtain the 
output voltage as 
 
-"Mq 	  -E‚Ä¢"Y  F 
82
8√ÖG √î -q¬¶ ‚Ñ¢c‚Ä¢  -"K√ï
(7.4) 
 
where it is assumed that -E‚Ä¢ 	 -E‚Ä¢  -E‚Ä¢"Y. All BJTs in the circuit are vertical 
PNP transistors whose current gains ¬∞ are normally low. In the absence of 
transistors M5 to M8 and Q5, the emitter current of Q1 (Q3) is the sum of the 
drain current of M3 (M4) and the base current of Q2 (Q4), which is different from 
that of Q2 (Q4) so that the base-emitter junction voltages in Q1 and Q2 (Q3 and 
 
Figure  7.2 Modified bandgap voltage reference to reduce the op amp offset voltage effect. 
VDD
Vout
I
nA
A
A
nA
+
-
+‚àí
M1
M2
M3
M4
M5
M6
M7
M8
Q1
Q2
Q3
Q4
VOS
R1
R2
Q5

170 
CMOS Reference Generators 
 
 
Q4) would not be exactly the same. To eliminate this error the devices M5 to M8 
and Q5 are added to the circuit. Let Q5 have the same ¬∞ as other BJTs. As a result, 
its terminal base current will be equal to that of Q2 and Q4. This current by the 
current mirrors M6-M7 and M6-M8 is taken out from the emitters of Q1 and Q3. 
The amount of the drawn currents from the emitters of Q1 and Q3 is equal to what 
is added to them by the base currents of Q2 and Q4 so that the assumption of 
having equal emitter-base junction voltages for Q1 and Q2 (Q3 and Q4) should be 
accurate. 
 
Design Example 
 
A bandgap voltage reference is to be designed in a 0.25-m CMOS technology. 
The adopted architecture is shown in Figure 7.3.  
First of all we should choose an appropriate value for ‚Ä¢ that is defined as the 
emitter area‚Äôs ratio of Q1 and Q2. The larger the ‚Ä¢ is chosen, the lesser sensitivity 
to the op amp offset voltage is achievable. This is because the term of -q¬¶ ‚Ñ¢c‚Ä¢ in 
(7.2) becomes greater than -"K. To compromise the occupied chip area and for the 
sake of simple and symmetrical layout for BJTs we choose ‚Ä¢ 	 T. By equating the 
derivative of (7.1) with respect to temperature to zero, we can obtain the ratio of 
'' 
 
z4rs
ze
	
z4@¬®√ë
ze

Àú
J
82
8√Ö ‚Ñ¢c‚Ä¢ 	 
(7.5) 
 
where ‚Äò is the Boltzmann‚Äôs constant and ‚Äö is the electron charge with 
‚Äò ‚Äö

	 A< ≈†[A. Here ' '

 is surmised to be independent of T that is true 
if both resistors have the same temperature coefficients. This statement can be 
proved by setting the derivative of ' '

 with respect to √£ to zero 
 
Figure  7.3 A designed bandgap voltage reference. 
+
-
a
b
Vref
R1
R2
VDD=2.5V
M1
M2
M3
M4
Q1
Q2
Q3
A
nA
nA
Ms1
Ms2
Ms3
Ms4
Ms5
Ms6
10/1
10/1
10/1
5/1
10/0.25
5/0.25
5/0.25
1/5
5/0.5
5/0.5
n=4
A=5X5
Ibias

 
7.1 CMOS Voltage Reference Generators 
171 
 
 
 
z
ze F
82
8√ÖG 	
82
8√Ö F

82
z82
ze 

8√Ö
z8√Ö
ze G 	 
(7.6) 
 
To meet the above condition the designer should choose the same type of resistors 
for R1 and R2 from his/her technology file. Typical value for ¬∑-E‚Ä¢≈Ω ¬∑√£

 is about 
B ≈†[A. This figure is obtained by a simple dc sweep simulation over 
temperature for a BJT with shorted collector-base terminals whose collector 
current is supplied by a dc current source. Solving (7.5) with the mentioned 
quantities we get ' '

	 TT. Resistance R1 can be derived based on the 
chosen current for M2 (or Q2). For example, if we choose W) 	 \¬∂ we have  
' 	 -q¬¶‚Ñ¢c‚Ä¢ W)

	 C<≈ì and thus ' 	 =A≈ì. As it is clear from  
Figure 7.3, the op amp bias current is provided by the bandgap circuit itself. This 
makes the role of a startup circuit more crucial because at the beginning the bias 
current is insufficient to run the op amp with adequate voltage gain. Transistors 
Ms1 to Ms6 form the startup circuit. At start time if the current of the main core of 
the bandgap (i.e., the drain current of M1 or M2) is low, the voltage of the node 
marked as <a> is low and then Ms1 is off, and Ms3 as a simple resistor provides 
the bias current for the current mirror Ms2-Ms4. This current through the second 
current mirror Ms5-Ms6 supplies the initial required op amp bias current. After the 
circuit starts the voltage of node <a> rises, which turns on Ms1 and causes Ms1 to 
enter the triode region that turns Ms2 off, and thus the startup circuit is disabled. 
An important point that needs to be considered in checking the performance of the 
startup circuit is that it should be tested by performing a transient analysis by 
applying a step voltage with a relatively long rise time as the power supply 
voltage. This point is important because most of the time a designer is enticed 
when he or she thinks that the startup circuit functions properly by performing a dc 
sweep simulation over the supply voltage and gets an acceptable response while it 
is not the case. Even transient simulation with a fast rise time step for supply 
voltage is not a reliable test method for checking the performance of the startup 
circuit, because in this condition small parasitic capacitances in the circuit can 
establish a path to inject the needed current to start the circuit while for long rise 
time it would not be able to do this. In Figure 7.3 the gate capacitance of all PMOS 
devices at the output of the op amp appear as the load capacitance of the op amp. 
This capacitance should be considered in selecting the appropriate op amp 
architecture. For instance a two-stage op amp can provide a rather large dc voltage 
gain but the op amp stability can be degraded depending on the size of the PMOS 
transistors M1 to M4. For example, when the capacitance seen at the op amp 
output is increased, its second pole is reduced and as a result the op amp stability 
degrades. In certain circumstances it may even causes instability in the bandgap 
circuit. Here the folded-cascode architecture with a PMOS input differential pair 
can be a good candidate, because more load capacitance at the output of such an 
op amp helps to make it more stable. In addition, PMOS devices have one order of 
magnitude less input-referred flicker noise voltage compared to their NMOS 
counterparts. The schematic of the op amp and the sizing of its transistors are 

172 
CMOS Reference Generators 
 
 
depicted in Figure 7.4. 
Circuit simulation using polysilicon resistors from the technology shows that 
the output voltage will have minimum variation with respect to temperature if the 
resistances R1 and R2 are modified a little bit. With a resistance ratio of  
' '

 < we have ' 	  <<≈ì and ' 	 T TB≈ì. Figure 7.5 shows the 
plot of the reference voltage versus temperature. From this plot the temperature 
coefficient of the circuit is given by 
 
 
√£( 	

4rs
4rs5ÀÜ‚Äî/4rs5√Ñ
e5ÀÜ‚Äî/e5√Ñ
	 B< ‚Äπ /√™A 
 (7.7) 
 
Thus the temperature coefficient of the designed bandgap voltage reference is 
B<≈†A while -.I 	  ==[. 
 
Figure  7.4 A designed folded-cascode op amp. 
 
Figure  7.5 Bandgap reference voltage versus temperature. 
vi
+
vi
-
M1
M2
10/0.25
M3
M4
M5
M6
M7
M8
M9
M10
M11
Mb1
Mb2
Mb3
Mb4
Mb5
Mb6
Mb7
Mb8
Mb9
VDD=2.5V
10/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
5/0.5
10/1
10/1
20/1
20/1
vo
IPTAT
5/0.5
5/0.5
10/0.25
1/1
2/1
1.58 mV
1.254V
Vref
T(oC)
+125
-40

 
7.1 CMOS Voltage Reference Generators 
173 
 
 
7.1.2 Low-Voltage Bandgap Reference Generator 
In the bandgap voltage circuit studied in the previous section for 
-.I 	 -‚Ä¢E  }-q¬¶, the K value for which the temperature coefficient of -.I 
becomes zero generates a reference voltage around 1.25V. On the other hand, in 
low-voltage application we usually need to have a stable reference voltage against 
process, temperature, and supply with the value of usually below one volt. One 
method to get such a stable voltage is to use a conventional bandgap reference 
voltage with the output of 1.25V and then use a simple resistive divider to lower 
this voltage to the desirable level. This action has two drawbacks. First, we 
generally require a buffer at the output of the divider, and secondly and more 
importantly, we would require a main supply voltage greater than 1.25V to 
generate such voltage. This is not appropriate and sometimes not feasible in a low-
voltage circuit. One solution is that before adding two voltages with opposite 
temperature coefficients, we first convert each voltage to its equivalent current and 
then add two currents with proper coefficients. At the end the resultant current is 
sent to a proper resistor to convert it to the desired output voltage. One sample 
circuit that carries out this job is shown in Figure 7.6 [4]. In this circuit the inputs 
of the op amp are normally low and using a PMOS differential pair at the op amp 
input is preferable. In this circuit we can write 
 
 
-U 	 -‚Äû 	 -E‚Ä¢
 (7.8) 
 
Figure  7.6 Low-voltage bandgap reference voltage. 
Ibias
Vref
A
nA
Va
Vb
+
VEB1
-
+
VEB2
-
I1
+
-
I2
I
R1a
R1b
R1a
R1b
M1
M2
M3
M4
VDD
R3
R2
Q1
Q2

174 
CMOS Reference Generators 
 
 
 
W 	
4y
8√ÖÀÜ8√Öy
(7.9) 
 
 
W 	
4y/4@¬®2
82

 (7.10) 
 
By defining 'U  '‚Äû  ' and using (7.8), since -E‚Ä¢  -E‚Ä¢ 	 -q¬¶‚Ñ¢c‚Ä¢ we 
have 
 
 
W 	 W  W 	
4@¬®√Ö
8√Ö 
4‚Ä∞¬•BCY
82
 
 (7.11) 
 
 
-.I 	 '≈ΩW 	
8√ë
8√Ö -E‚Ä¢  -q¬¶
8√ë
82 ‚Ñ¢cc 
 (7.12) 
 
It is clear from (7.12) that the reference output voltage -.I consists of two terms 
with opposite temperature coefficients. It is possible to achieve our desirable 
output voltage with near-zero variation with temperature by appropriate selection 
of '≈Ω '

 and '≈Ω '

‚Ñ¢c‚Ä¢. The supply voltage of this circuit can be as low as 
-E‚Ä¢  -)DHKUqH provided that the op amp can operate correctly at this level of 
supply voltage. 
 
Design Example 
 
In this section we intend to design a bandgap voltage reference of -.I 	 =[ in a 
0.25-m CMOS technology. First, by a simple simulation we determine the 
temperature coefficient of BJTs as described previously. Then, by setting the 
derivative of -.I in (7.12) with respect to temperature to zero, we obtain the 
following relationship that can be used to calculate the resistance ratio of ' '

 
 
 
8√ë
82
z4@¬®√Ö
ze

8√ë
82 ‚Ñ¢c‚Ä¢ Àú
J 	  
 (7.13) 
 
Assuming ¬∑-E‚Ä¢ ¬∑√£

	 B=≈†[DE, from (7.13) we get ' '

	 <A. W is 
chosen based on compromise between power consumption and occupied chip area 
by the resistors. Here for ‚Ä¢ 	 T, by choosing W 	 \¬∂ we have ' 	 =C≈ì  
and ' 	 C<≈ì. By substituting these values into (7.12) for -.I 	 =[ 
resistance '≈Ω 	  ;≈ì obtained. R1, R2, and R3 are realized by the polysilicon 
in the given process with the sheet resistance of A]F In order to reduce the 
width tolerance effect in resistors, minimum width of all resistances is chosen 
at\≈†. Figure 7.7 shows the output voltage over the temperature range from 
 A to  =A for the supply voltage of -)) 	  [. 
From this curve we can obtain the circuit temperature coefficient as  
√£( 	 =T≈†A. By increasing the BJT emitter areas the emitter-base voltage 
for a specific collector current is lowered, which makes it possible for the circuit to 

 
7.1 CMOS Voltage Reference Generators 
175 
 
 
work with a lower supply voltage.  
The same result can be attained by reducing the current level and using higher 
resistance without needing to increase the BJT areas. A folded-cascode 
architecture with PMOS input transistors has been used for the op amp in this 
circuit. It is a good idea to use a cascode structure instead of M1 to M4 to make 
the output less sensitive to the supply voltage variations. In the circuit of Figure 
7.6 if the input offset voltage of the op amp, -√éD, is considered it can be shown 
that an extra term of √î'≈Ω '

  'U '‚Äû

  '≈Ω '‚Äû

√ï-√éD is added to -.I 
in (7.12). For 'U 	 CB≈ì and '‚Äû 	 =;≈ì and other given values this adds 
 T-√éD to -.I. Since -.I is small this shows that the amount of op amp offset 
voltage here is critical. As an example, an offset voltage of ≈†[ adds a random 
voltage with the average of  T≈†[ to -.I 	 =≈†[ that causes large random 
variations in the reference voltage. Moreover, it causes the output reference 
voltage to follow the offset voltage variation with temperature. As a result in a 
low-voltage bandgap circuit when the op amp offset voltage is noticeable, the 
output reference voltage is neither stable against the process variations nor 
insensitive with respect to the temperature variations. This happens even though 
we have used BJTs for stability against process and added two currents with 
equally opposite temperature coefficients to get a low TC. It is interesting that just 
the op amp offset voltage is responsible for this deficiency. Therefore the op amp 
employed in this circuit should be carefully designed in terms of minimum 
possible input-referred offset voltage. For example, the gate area of the input 
transistors should be made adequately large and paid special attention to do a full 
symmetrical layout for the input devices of the op amp by using the common 
centroid techniques as discussed in detail in Chapter 3. 
 
Figure  7.7 Low-voltage bandgap reference voltage variation versus temperature. 
Vref
T(oC)
+125
-20
499.7 mV
499.55 mV
0.39 mV
27
499.65 mV

176 
CMOS Reference Generators 
 
 
7.1.3 CMOS Voltage Reference Generator without Resistors 
Resistors are used in all previously studied bandgap circuits. The role of the 
resistor is to convert the emitter-base voltage -‚Ä¢E and PTAT voltage }-q¬¶ to 
current. The currents after being added together flow through another resistor to 
produce the reference output voltage. In all relationships for such circuits, the 
resistance appears as a ratio of two resistances, and as long as this ratio is kept 
unchanged with respect to temperature and voltage variations, the absolute 
variation of resistance has no significant effect on the reference output voltage. 
The nonsilicide polysilicon type resistor is the most popular resistor that is usually 
used when we have access to a mixed-mode CMOS technology. Under certain 
circumstances a designer may have to work with a digital CMOS process without 
access to such a resistor. In this condition a bandgap structure that does not require 
any resistors can be more applicable. One example of this type of bandgap circuit 
is depicted in Figure 7.8 [5]. Diodes D1 and D2 are implemented by tying the 
drain, source, and gate of a PMOS transistor together to form the anode with its 
substrate terminal used as cathode, as shown in Figure 7.9. Two differential pairs 
of M1-M2 and M3-M4 have an unbalanced sizing by a factor of B. We will return 
to the reason for that unbalanced sizing later but now we assume the two pairs are 
balanced, and based on this assumption we write the drain current of M4 (M6) as 
 
 
W)√á 	
{
  ‚Ä¢¬∞W t 
√Ü34:2
√á{
34:
 	 W)√™ 
 (7.14) 
 
Figure  7.8 Bandgap reference without a resistor. 
I0
GI0
ID
10ID
+
-
VD1
+
-
VD2
D1
D2
AW/L
ABW/L
W/L
BW/L
Vout
1  :  G
VDD
M1
M2
M3
M4
M5
M6

 
7.1 CMOS Voltage Reference Generators 
177 
 
 
where ¬∞ 	 hR"V o p
  and 3-)  -)  -). The M1 drain current is provided 
by M4 through the current mirror M5-M6 with the current gain of G 
 
 
W) 	 √à W)√™ 	
f{
  √à‚Ä¢¬∞W t 
√Ü34:2
√á{
34:
  
 (7.15) 
 
If -%#  -"Mq  -) designates the difference in voltage at the input of the M1-M2 
differential pair, W) is given by 
 
 
W) 	
f{
  t
√Ü
 √àW t 
√Ü4+
2
√áf{
4+
  
 (7.16) 
 
Since W) 	 W), from (7.15) and (7.16) we have -%# 	 d√à 3-) and therefore the 
output voltage becomes 
 
 
-"Mq 	 -)  d√à 3-) 
 (7.17) 
 
Equation (7.17) is similar to (7.1) in which the coefficient of the proportional to 
absolute temperature (PTAT) voltage is realized by two gain factors of G and A.  
Now we deal with the reason for using unbalanced differential pairs in Figure 
7.8. Equation (7.17) proves that this circuit acts like a conventional bandgap 
circuit with the output voltage of about  [ for a near-zero temperature 
coefficient so that assuming -) 	 <[, the difference in voltage at the input of 
differential pair M1-M2 is about<[. In order for both M1 and M2 to conduct 
with this level of input difference voltage, they need to have a high effective 
voltage -Df  √å-eR√å. By using unbalanced input transistors in the differential pair 
of M1-M2 and also M3-M4, an intentional offset voltage is created at their inputs. 
Thus the required effective voltage is reduced by the amount of the added offset 
voltage. To clarify the matter, we now calculate the added offset voltage owing to 
the unbalancing. For the unbalanced differential pair shown in Figure 7.10, since 

Figure  7.9 PMOS transistor used to realize a diode. 
n-well
n+
P+
P+
A
A
K
K
P-substrate

178 
CMOS Reference Generators 
 
 
-Df 	 -Df, we can write 
 
 
{:√Ö
F¬≤
¬≥ G√Ö
	
{:2
F¬≤
¬≥ G2

 (7.18) 
 
Because W)  W) 	 Wq, we will have 
 
 
W) 	
‚Ä¢
‚Ä¢ Wq
 (7.19) 
 
 
W) 	

‚Ä¢ Wq
 (7.20) 
 
In Figure 7.10 in order to balance the drain currents we have to apply an offset 
voltage of -√éD to the input. In the circuit of Figure 7.11, for -%# 	 -√éD we have 
W) 	 W) 	 Wq  
  and thus 
 
 
-√éD 	 -Df  -Df
(7.21) 
 
If it is assumed that the square law relationship is held for the M1 and M2 drain 
currents, from (7.21) the equivalent input offset voltage -√éD is given by 
 
 
-√éD 	 t
{‚Ä∞
√Ü2  

d‚Ä¢
 (7.22) 
 
Thus when the size of one transistor in a differential pair is B time of the other 
one, it is equivalent to having an ideal differential pair (balanced) with an offset 
voltage source series with its input. In the circuit of Figure 7.12 the offset voltage 
-√éD is subtracted from the applied input differential voltage. 
 
Figure  7.10 Unbalanced PMOS differential pair. 
M1
M2
It
W/L
BW/L
VDD
Vcm
iD2
iD1

 
7.1 CMOS Voltage Reference Generators 
179 
 
 
Illustrated in Figure 7.13 is the complete circuit of the bandgap voltage 
reference without resistor including the startup circuit. For this circuit we have 
√à 	 < and  	 $ 	 T. The bias current of D2 is mainly provided by the current 
mirror M8-M12. By choosing a large aspect ratio and low current level for diode-
connected M11, its gate-source voltage can be approximated by its threshold 
voltage. For the loop consisting of D1, D2, M7, and M11, we have 
 
 
-fD≈í  -) 	 -fD  -)
 (7.23) 
 
 
Figure  7.11 Unbalanced PMOS differential pair with balancing input offset voltage. 
 
Figure  7.12 Unbalanced PMOS differential pair and its symmetric equivalent with input offset voltage. 
M1
M2
It
W/L
BW/L
VDD
iD2
iD1
+
- Vcm
+ VSG1
-
+
VSG2
-
+
- VOS
It
W/L
BW/L
VDD
It
W/L
W/L
VDD
+
-
VOS
M1
M1
M2
M2

180 
CMOS Reference Generators 
 
 
 
W)≈í 	
√Ü√Ø
 3-)
 (7.24) 
 
where 3-)  -)  -). The tail currents of two differential pairs M1-M2 and 
M3-M4 are provided through W)≈í by using the current mirrors of M8-M9 and  
M8-M13. Ms1 to Ms5 constitute the startup circuit. At the beginning the source 
voltage of Ms5 is low so it conducts and by injecting current to the gate of M7 and 
M11 raises the voltage of this node. When these transistors conduct, W)≈í flows 
through the diode-connected M8 and thus current flows to the diode-connected 
M11 through the current mirror M8-M10. The current of M10 raises the gate 
voltage of M11, which causes Ms5 to ultimately turn off in stable condition. When 
Ms5 is off the startup circuit is isolated from the rest of the circuit. 
7.2 CMOS Current Reference Generators 
Current reference is employed in many different analog blocks such as amplifiers 
and data converters. In analog circuits we usually need a reference current 
generator known as a master bias current from which all required dc currents are 
made by using different current mirrors. This section deals with the circuits that 
 
Figure  7.13 Complete CMOS bandgap voltage reference without resistor. 
+
-
+
-
D1
Vout
VDD
VGS7
+
-
VGS11
+
-
VD1
VD2
ID7
M1
M2
M3
M4
M5
M6
M7
M8
M9
M10
M11
M12
M13
Ms1
Ms2
Ms3
Ms4
Ms5
D2

 
7.2 CMOS Current Reference Generators 
181 
 
are commonly used to realize such a master current source.  
In a simple current mirror circuit from a predefined current reference and by 
adjusting the size ratio, one copy of this current is duplicated in another transistor, 
as exhibited in Figure 7.14. 
If M1 and M2 are identical we have W  W.I. Now there is one important 
question: From scratch, how we can provide the reference current W.I from which 
other currents are to be produced? The first way that may come to mind is to place 
a PMOS current mirror circuit on top of the NMOS current mirror, as depicted in 
Figure 7.15. 
In this circuit, if the channel length modulation effect in the MOS transistors 
is ignored we would have only one equation, W 	 W, and therefore we have an 
unlimited number of solutions including zero for the circuit. Indeed, two NMOS 
and PMOS current mirrors form a closed-loop feedback. When the transistor 
channel modulation effect is considered, it can be shown that this feedback is a 
positive one at the beginning. To prove this statement we calculate the circuit 
open-loop gain with the aid of Figure 7.16. Although both NMOS and PMOS 
current mirrors are assumed to have the size ratio of unity but considering the 
channel modulation effect yields different current gains ¬æY and ¬æR as follows: 
 
Figure  7.14 Simple current mirror circuit. 
 
Figure  7.15 Twin-loop current mirror circuit. 
I1=Iref
I2
VGS1
-
+
VGS2
-
+
M1
M2
I2
I1
VDD
1   :   1
1   :   1
M1
M2
M3
M4

182 
CMOS Reference Generators 
 
 
 
¬æY 	
{x‚Ä∞
{2 	
√∞√Ñ4:k2
√∞√Ñ4:k√Ö  
(7.25) 
 
 
¬æR 	
{2
{√Ñ 	
√∞Q4k:√ë
√∞Q4k:√ã  
(7.26) 
 
where -D)≈Ω 	 -##  -fD, -Df√á 	 -D)√á, and -fD 	 -)D. At the beginning, 
because of low-level currents in the circuit the gate-source voltages for both 
PMOS and NMOS transistors are small and -)D  -)D, -D)≈Ω  -D)√á, and 
therefore both ¬æY and ¬æR are greater than one. Consequently, the loop gain 
Z 	 ¬æY¬æR is greater than unity. The positive-feedback loop raises the loop initial 
current in a regenerative manner. By increasing the drain currents the gate-source 
voltages increase, which results in dropping of the drain-source voltages in both 
NMOS and PMOS devices. By reducing NMOS and PMOS drain-source voltages 
¬æY and ¬æR are decreased and therefore Z is reduced. When the loop gain Z 
approaches unity, the loop reaches its steady state with a certain limited current. In 
practice the drain current changes as a function of all terminal voltages, and 
particularly for a short-channel case exact prediction of this current is simply not 
possible. However, it is apparent that transistors with a larger size and also a 
higher supply voltage cause the circuit to reach its steady state at higher current 
level. 
7.2.1 Gm-Constant Circuit 
As proved in the previous section for a twin-loop current mirror circuit, the current 
level at which a circuit reaches its steady state is not accurately predictable. 
Adding a series resistance in the source of one of the PMOS or NMOS current 
mirrors can reduce the loop gain to a value less than unity and solve the 
 
Figure  7.16 Open-loop current mirror circuits. 
I2
VDD
Iout
Iin
Œ±p : 1
1  :  Œ±n
M1
M2
M3
M4

 
7.2 CMOS Current Reference Generators 
183 
 
 
uncertainty in the current level caused by the instability problem. In Figure 7.17 a 
series resistor is added to the NMOS current mirror. In this circuit we can write 
 
 
-fD 	 -fD  'W
(7.27) 
 
Assuming the square law relationship is held for the M1 and M2 drain currents, 
from (7.27) we have 
 
 
-e  t
{√Ö
√Ü√Ö 	 -e  t
{2
√Ü2  'W 
(7.28) 
 
Supposing -e  -e, we obtain 
 
 
W 	
√Ü√Ö
 ¬©'W  t
{2
√Ü2¬¨

 
 (7.29) 
 
The PMOS current mirror M3-M4 forces W and W to be equal so that the circuit 
equilibrium point will be the intersection of the curve of W 	 W given by 
(7.29) and the bisector of the first quadrant of the WGW Cartesian coordinate 
system, as plotted in Figure 7.18. The circuit has two different stable points, one of 
which is placed on the origin. Obviously this is an undesirable point for the circuit 
to be placed. To avoid such a condition the circuit needs a startup circuit that helps 
to transfer the circuit to the second desirable stable point with the current of W. By 
 
Figure  7.17 Added series resistor in a twin-loop current mirror circuit. 
I2
I1
VDD
1   :   1
+
VGS1
-
+
VGS2
-
R
M1
M2
M3
M4

184 
CMOS Reference Generators 
 
 
substituting W 	 W 	 W into (7.29), the circuit current is given by 
 
 
W 	

√Ü√Ö82 F 

d‚Ä°G 
 (7.30) 
 
where }  o p
  o p
 

 and ¬∞ 	 hY"Vo p
 . The current W is 
independent of the threshold voltage and the main process parameter that affects W 
is the gate oxide thickness. The current W changes with temperature because 
carrier mobility in ¬∞ is dependent on temperature as √£/. The supply voltage 
affects W if the channel length modulation for the transistors is taken into account. 
In practice, the threshold voltage of M2 is greater than that of M1 due to the body 
effect in an n-well process. This can cause an extra error. To eliminate this error 
the source degenerative resistor can be added to the source of the PMOS current 
mirror, as depicted in Figure 7.19. 
 
Figure  7.18 Equilibrium points of a twin-loop current mirror with a series resistor. 
 
 
Figure  7.19 Twin-loop current mirror with a source degenerative resistor in a PMOS current mirror. 
0
I0
I0
I2=I1
I2
I1
I1=f(I2)
I0
VDD
1   :   1
R
+
VSG3
-
+
VSG4
-
M1
M2
M3
M4

 
7.2 CMOS Current Reference Generators 
185 
 
 
Another option is to use the circuit of Figure 7.20. By simple analysis we can 
prove that the same relationship is applied for W. Now let an MOS transistor be 
biased by the current generated from this kind of current reference. In the 
relationship of X0 	 ‚Ä¢ ¬∞W, by replacing W with (7.30) we obtain 
 
 
X0 	

8  

d‚Ä°
(7.31) 
 
Here X0 is nearly independent of biasing current or process parameters, hence this 
kind of current reference is also known as a gm-constant circuit. When body effect 
is taken into account (| √ñ ) supply variation can change the reference current 
through the limited drain-source resistance of M3. One approach to reduce this 
effect is to choose M3 and M4 with a long channel length to lower |. Another way 
is to use an op amp to force M3 and M4 to have equal drain-source voltages, as 
 
Figure  7.20 Another structure for the current reference-eliminating body effect. 
 
Figure  7.21 Gm-constant circuit using an op amp. 
I2
I1
VDD
1   :   1
+
VGS1
-
+
VGS2
-
R
M1
M2
M3
M4
I0
VDD
R
+
-
M1
M2
M3
M4

186 
CMOS Reference Generators 
 
 
illustrated in Figure 7.21. This circuit consists of two different positive- and 
negative-feedback loops. The op amp and the common-source stage amplifier 
formed by M2 and M4 constitute the negative-feedback loop and the other one 
similarly formed through M1 and M3 except that the open loop voltage gain of the 
latter is much lower than that of the first one. Therefore the negative feedback is 
stronger and it guarantees the stable operation of the circuit. The gm-constant 
circuit has two main drawbacks. First, its current depends on temperature because 
of the presence of the carrier mobility parameter h, which changes with 
temperature as h√£ 	 h√£ √£

/. Second, it depends inversely on the square 
of resistance. Thus the current of W can change greatly in a given process due to 
the large absolute variation of resistance in that process.  
7.2.2 Fully Integrated Precision CMOS Current Reference 
In a gm-constant circuit the current has a positive temperature coefficient due to 
the term ofh that appears in the denominator of (7.30). One idea to make a 
current nearly independent of temperature is to combine two currents with 
opposite temperature coefficients in such a way that the total current is almost 
independent of temperature. The main idea can be described with the aid of a new 
circuit shown in Figure 7.22 [6].  
In this circuit the op amp forces the drain-source voltage of M1 to be equal to 
-.. The reference voltage of -. is produced by a bandgap voltage generator whose 
temperature coefficient is deliberately made positive. Supposing -. is less than the 
saturation voltage of M1, we put M1 in the triode region with the following drain 
current 
 
 
Figure  7.22 Architecture of a new current reference. 
-
+
Vr
2  :  1
1  :  1
Iout
VDD
M1
M2
M3
M4
M5
M6

 
7.2 CMOS Current Reference Generators 
187 
 
 
 
W) 	 ¬∞ j-fD  -e-. 
42
 l 
 (7.32) 
 
The diode-connected M2 works in saturation and we can write 
 
 
W) 	
√Ü2
 -fD  -e
(7.33) 
 
From (7.32) and (7.33) and noting that -fD 	 -fD, the relationship between W) 
and W) can be derived as follows: 
 
 
W) 	 ¬∞ √ß¬©t
{:2
√Ü2 -. 
42
 ¬¨√® 
 (7.34) 
 
The PMOS current mirror M4-M5 forces the drain current of M1 and M2 to be 
equal. In this situation the circuit equilibrium point can be found by the 
intersection of the corresponding curve of (7.34) and the bisector of the Cartesian 
coordinate system, as plotted in Figure 7.23. As can be seen, the circuit has two 
different stable points in which only the one with the larger current level is 
considered as a suitable operating point. Substituting W) 	 W) 	 W into (7.34) 
yields the following equation: 
 
 
W  F
√Ü√Ö
√Ü2  G ¬∞-.
W  F
√Ü√Ö42
 G

	  
 (7.35) 
 
Solutions of (7.35) give the current W. If we have ¬∞ 	 ¬∞, the first quadrant 
bisector will be tangent to the curve in Figure 7.23 and thus two operating points 
become coincident and the current will be W 	 ¬∞  

-.
. In this case for 
 
Figure  7.23 Equilibrium points of a new current reference. 
0
ID2
ID1
ID1=f(ID2)
ID1=ID2

188 
CMOS Reference Generators 
 
 
¬∞ 	 hY"Vo p
  the ratio of W o p
 

 becomes   

hY"V-.
. As was 
proved in Chapter 2, a rough estimation that shows an MOS transistor works in the 
subthreshold region is that the ratio of W) o p
 

 is less than  hY"V--q¬¶, thus 
for -.   --q¬¶, M1 and M2 work in the subthreshold and none of the above 
relationships are applicable, a condition that is quite possible to occur because of 
the small value of -.. But for ¬∞ √ñ ¬∞ we can shift the circuit to our desirable 
operating point with the aid of an appropriate startup circuit. At the new operating 
point with a higher current level, all aforementioned equations are valid. As an 
example, for ¬∞ 	  ¬∞, (7.35) gives two solutions: 
 
 
W 	 C >  d 
√Ü√Ö42
 
 (7.36) 
 
In which the bigger solution guarantees the validity of the derived equations. In 
order to have an output current with approximately zero temperature coefficient, 
we set  W
 ¬∑W ¬∑√£

 	  for the term with a plus sign in (7.36), which results in 
 
 

4
z4
ze 	 

√Ü√Ö
z√Ü√Ö
ze 
 (7.37) 
 
Using h√£ 	 h√£ √£

/ in ¬∞ 	 hY"Vo p
  by manipulating (7.37), we 
can obtain the desired relative variation of -. with respect to temperature as 
 
 

4
z4
ze 	 
≈í
e 
 (7.38) 
 
where √£ 	 C‚Ä∫≈ì. Therefore, the temperature coefficient of -. should be around 
 = ‚Äπ /≈Ω‚Ä∫≈ì. This means that in order to have a reference current with a near-
zero temperature coefficient it is enough to use a low-voltage bandgap voltage 
with a positive temperature coefficient of  = ‚Äπ /≈Ω‚Ä∫≈ì. Note that -. is a 
bandgap voltage and there is no resistance parameter in (7.36). We see that the 
only process parameter that can mainly affect W is the gate oxide thicknessn"V, 
which appears in ¬∞ 	 hYo p
 "V with "V 	 m"V n"V

. Thus it can be 
claimed that this circuit has minimum variations with process in addition to a near-
zero temperature coefficient. 
7.2.3 CMOS Current Reference without Resistors 
There is another current reference architecture that is very similar to the gm-
constant circuit. But in this circuit, instead of a resistor an MOS transistor working 
in the triode region has been used. The circuit is shown in Figure 7.24 [7]. By 
choosing a large aspect ratio for M1 and M2 and taking a low-level drain current 
for them, these transistors would work in the subthreshold region. Therefore, their 
gate-source voltages can be written as 

 
7.2 CMOS Current Reference Generators 
189 
 
 
 
 
-fD 	 -eY  --q¬¶	‚Ä¢ H
{√Ö
{vF¬≤
¬≥ G√Ö
I 
 (7.39) 
 
-fD 	 -eY  --q¬¶	‚Ä¢ H
{√Ö
{vF¬≤
¬≥ G2
I 
 (7.40) 
 
We can also write 
 
 
-fD 	 -fD  -)D
 (7.41) 
 
Using (7.39), (7.40), and (7.41), and surmising -eY  -eY, we obtain 
 
 
-)D 	 --q¬¶‚Ñ¢c‚Ä¢
 (7.42) 
 
Equation (7.42) shows that the M5 drain-source voltage is a small voltage and 
therefore this transistor operates in the triode region with the following relation for 
its drain current: 
 
 
W 	 ¬∞ F-fD  -eY 
4:k√©
 G -)D 
 (7.43) 
 
Diode-connected M6 works in saturation with W 	   
 ¬∞√™-fD√™  -eY. Since 
-fD 	 -fD√™, we can replace the term of -fD  -eY in (7.43) with ‚Ä¢ W ¬∞√™

, which 
 
Figure  7.24 CMOS current reference without a resistor. 
I2
VDD
1  :  m
1  :  1
1  :  1
n : 1
I1
I1
M1
M2
M3
M4
M5
M6
M7

190 
CMOS Reference Generators 
 
 
yields 
 
 
W 	 ¬∞ ¬©t
{2
√Ü√≠ 
¬±4‚Ä∞¬• BCY

¬¨ --q¬¶‚Ñ¢c‚Ä¢ 
 (7.44) 
 
The current mirror M3-M7 forces W to be equal to W, thus the circuit operating 
point will be the intersection of the curve represented by (7.44) and the straight 
line of W 	 W. By definitions W 	 W  W and !  --q¬¶‚Ñ¢c‚Ä¢ and noting that 
¬∞ 	 &¬∞√™, the equation from which the current W can be calculated will be  
 
 
W   &  ¬∞!W 

√á ¬∞
!√á 	 
 (7.45) 
 
Two solutions of (7.45) are given by 
 
 
W 	
0/>‚Ä¢02/0

¬∞--q¬¶‚Ñ¢c‚Ä¢ 
 (7.46) 
 
In (7.46) the current of W depends on temperature because of the presence of ¬∞ 
and -q¬¶. For h√£ 	 h√£ √£

/ we can conclude from (7.46) that W J √£. In 
this architecture our current reference mainly depends on the gate oxide thickness 
like the previous one but its variation with temperature is not negligible. The 
circuit has two stable equilibrium points A and B that are the same as shown in 
Figure 7.23. If the circuit places in point A the current level at this point is too 
small and therefore it needs to be transferred to the other stable point B. This can 
be carried out by adding an appropriate startup circuit. Assume the circuit of 
Figure 7.24 initially operates in the operating point of A. The startup circuit should 
act in such a way that it can temporarily increase the drain current of M1. When 
this current increases the M6 current also increases through the current mirror 
M3-M7, which causes the gate-source voltage of M6 and M5 to rise. This 
increases the drain current of M5 and M1. By repeating the above mechanism, 
which acts as a positive feedback, the operating point of the circuit quickly moves 
toward point B. Figure 7.25 shows the increase path in W and W that is initiated by 
the startup circuit and continues through the positive-feedback mechanism.  
 
Figure  7.25 Transfer path from point A to point B by a startup circuit. 
0
I1=I2
I1
I2
I1=f(I2)
A
B

 
7.2 CMOS Current Reference Generators 
191 
 
 
In an n-well process the body effect causes M1 and M2 to have different 
threshold voltages. This difference adds an error term of 3-eY  -eY  -eY to 
(7.42). Since this term changes with process and temperature the reference current 
will have more variation in comparison to what is predicted by (7.46). To solve 
this issue the circuit can be replaced by its dual circuit, as depicted in Figure 7.26. 
The substrate terminal of M2 is tied to its source. This eliminates the body effect 
in M2. 
 
Design Example 
 
In this example a current reference circuit is to be designed with W 	 \¬∂ in a 
0.25-m CMOS technology. The chosen structure is based on the architecture of 
Figure 7.26. In order to make sure that M1 and M2 work in the subthreshold, their 
aspect ratio should satisfy the following inequality: 
 
 
{:
F¬≤
¬≥ G√Ö
  hR"V--q¬¶ 
 (7.47) 
 
For W) 	 \¬∂, in the given process, with h√ó"V 	 = \¬∂ [

, -  T and from 
(7.47) we should have o p
   B=. In practice an MOS transistor passes 
through the moderate inversion before entering the subthreshold region that is 
equivalent to the weak inversion under the gate. Taking into account the moderate 
inversion region and in order to be sure that the transistors work in the 
subthreshold in all process corners, it needs to make the ratio much more than 
what the inequality of (7.47) predicts. Here we choose o p
  	 <. For ‚Ä¢ 	   
we have o p
  	  . In this circuit the difference between the drain-source 
voltage of M1 and that of M2, as well as the difference between the drain-source 
voltage of M4 and M3 and that of M7 is large. Thus the nonzero value of | in 
these transistors significantly affects their current levels. In order to minimize the 
short-channel effects the channel lengths of M1 and M2 are chosen pH 	 =\≈† 
that yields o 	 C\≈† ando 	 <\≈†. From (7.46) for W 	 \¬∂ and  
& 	  , the size of M5 can be obtained aso p
  	 ; . We choose p 	 =h& 
 
Figure  7.26 Current reference circuit without a body effect error. 

192 
CMOS Reference Generators 
 
 
and o 	 =\≈†. So the size of M6 becomes p√™ 	 =\≈† ando√™ 	  =\≈†. M3, 
M4, and M7 are current mirrors with the size ratio of one. To save chip area and 
minimize the channel modulation effect,o≈ΩH√áH≈í 	 p≈ΩH√áH≈í 	 =\≈† are selected. Data 
obtained from the simulations in the different process corners at √£ 	  =A are 
summarized in Table 7.1. 
The most change in W is related to the transition from the typical-typical (TT) 
to the fast-fast (FF) corner with =-  variation. In the given process the 
maximum relative variation from TT to FF or slow-slow (SS) due to the gate oxide 
thickness variation is about 5.<- . More variation with respect to what is predicted 
in the theory is due to the large difference drain-source voltage of M1 and M2 
despite the fact that we have used the long-channel MOS transistors. 
By adding an op amp to the circuit as depicted in Figure 7.27, it is possible to 
have nearly the same drain-source voltage for M1 and M2 and also for M4 and 
M3, M7. In such circumstances, using transistors with even shorter channel 
lengths gives better results in terms of variation in different process corners. With 
a channel length of =\≈† for all transistors and with the same aspect ratio, the 
transistor areas are decreased by the amount of two orders of magnitude. Of 
Table  7.1 
Output Reference Current in Different Process Corners 
Process Corner 
Slow-Slow 
Typical-Typical 
Fast-Fast 
Slow-Fast 
Fast-Slow 
W\¬∂ 
(Figure 7.26, 
p 	 =\≈†) 
1.021 
1.117 
1.234 
1.142 
1.094 
W\¬∂ 
(Figure 7.27, 
p 	 =\≈†) 
1.030 
1.089 
1.150 
1.115 
1.063 
 
Figure  7.27 Improved current reference circuit. 
VDD
m : 1
1  :  n
M1
M2
M4
M3
M5
M6
M7
+
-

 
7.3 Conclusion 
193 
 
 
course, the op amp itself occupies some area of the chip. Simulation results in the 
presence of the op amp are also included in Table 7.1. In this case, maximum 
variation from a typical to a fast corner is =<- , which is exactly consistent with 
the process gate oxide thickness variation. 
7.3 Conclusion 
In this chapter different structures of bandgap voltage reference generators were 
introduced. These included conventional bandgap, fully CMOS, and low-voltage 
bandgap circuits. In the low-voltage bandgap reference voltage generator, it was 
observed that the op amp offset voltage could degrade remarkably the performance 
of the circuit, so the design of an op amp with adequately low offset voltage is 
essential in this situation. 
We also examined different architectures of current reference circuits. As a 
matter of fact, the current reference circuit is extensively used in different analog 
circuits as a bias current or active load and thus designing a current reference 
circuit with the most stability against PVT is very important. As well, some fully 
integrated current reference circuits in CMOS technology were analyzed. In 
several given design examples some practical points were presented, which will 
aid the designer in achieving a realistic design. As we noticed, the op amp as an 
integral part of all these circuits plays a key role in meeting the desired 
performance. 
References 
[1] Allen, P. E., and Holberg, D. R., CMOS Analog Circuit Design, Second Edition, Oxford 
University Press, 2002. 
[2] Razavi, B., Design of Analog CMOS Integrated Circuits, McGraw-Hill, 2001. 
[3] Gray, P. R., Hurst, P. J., Lewis, S. H, and Meyer, R. G., Analysis and Design of Analog 
Integrated Circuits, Fourth Edition, John Wiley & Sons, Inc., 2001. 
[4] Banba, H., et al., ‚ÄúA CMOS Bandgap Reference Circuit with Sub-1-V Operation,‚Äù IEEE J. Solid-
State Circuits, Vol. 34, pp. 670-674, May 1999. 
[5] Buck, A. E., McDonald, C. L., Lewis, S. H., and Viswanathan, T. R., ‚ÄúA CMOS Bandgap 
Reference without Resistors,‚Äù IEEE J. Solid-State Circuits, Vol. 37, pp. 81-83, Jan. 2002. 
[6] Dehghani, R., and Atarodi S. M., ‚ÄúA New Low-Voltage Precision CMOS Current Reference with 
No External Components,‚Äù IEEE Trans. on Circuits and Systems‚ÄîII, Vol. 50, Dec. 2003. 
[7] Oguey, H. J., and Aebischer, D., ‚ÄúCMOS Current Reference without Resistance,‚Äù IEEE J. Solid-
State Circuits, Vol. 32, pp. 1132-1135, July 1997. 
 
 

 
 
 
 
 
 

 
 
 
195 
Index 
Active load 
common-source amplifier, 55 
issues in two-stage op amp, 68 
single-ended output differential 
amplifier, 36 
Adaptive dynamic load, 151 
Annealing, 15 
Bandgap reference circuit, 168 
instability, 171 
Bandgap voltage reference 
design example, 170 
BJT, 18, 168, 171, 174, 175 
Body effect 
coefficient, 20 
effective threshold voltage, 20 
transconductance, 23 
zero-bias threshold voltage, 20 
BSIM model, 65 
Channel length modulation 
effective channel length, 19 
meaning, 19 
Channel-stop, 15 
Charge space, 17 
Class A 
power efficiency, 139 
Class B 
power efficiency, 142 
CMFB 
differential difference, 114 
modified differential difference, 116 
MOS devices in the triode region, 118 
resistive sensing, 112 
resistive sensing with source-
follower, 113 
switched-capacitor, 120 
control voltage, 122 
loading effect, 122 
system level representation, 111 
CMOS bandgap voltage reference 
low-voltage, 173 
design example, 174 
without resistors, 176 
CMOS circuit fabrication, 15 
CMOS current reference 
near-zero temperature coefficient, 188 
subthreshold region, 188 
without resistor, 188 
design example, 191 
CMOS differential amplifier 
dominant pole, 47 
drain currents, 38 
flicker noise reduction, 41 
frequency response, 43 
input-referred offset voltage, 38 
mismatches, 38 
gate oxide thickness, 40 
threshold voltage, 40, 41 
total input-referred noise, 52 
CMOS, deep submicron, 65 
CMRR 
CMOS differential amplifier, 42 
definition, 3 
equivalent offset voltage, 6 
fully differential op amp, 3 
single-ended op amp, 5 
Common centroid technique, 41, 175 
Common gate stage, 77, 83, 86 
Common-mode feedback. See CMFB 
Common-mode rejection ratio. See 
CMRR 
Common-mode to differential-mode 
voltage gain, 3 
Common-mode voltage gain, 3, 5, 6, 42, 
43 
Common-source amplifier, 27, 55, 59, 
159 
Common-source stage, 69, 123, 124, 
127, 138, 186 

196 
Index 
 
Compensation capacitance, 62, 65, 66, 
75, 90, 162 
Compensation resistor, 64, 66, 70 
Constant-gm input stage 
based on square-law, 101 
based on subthreshold region, 103 
based on translinear loop, 101 
current combiner circuit, 103 
Cross-over distortion, 140, 141 
Current gain, 169 
Current mirror 
current gain, 181 
loop gain, 182 
positive feedback, 181 
Current mirror gain, 92, 93, 95 
Current mirror op amp 
cascode configuration, 93 
design example, 94 
frequency response, 92 
dominant pole, 92 
phase margin, 92 
second pole, 92 
low-frequency small-signal voltage 
gain 
saturation, 91 
subthreshold, 91 
slew rate, 92 
Current reference generator, 1, 167 
Data converters 
analog-to-digital, 1 
digital-to-analog, 1 
Depletion mode, 17 
Differential pair 
unbalanced, 176, 177 
Drain current 
short channel effect, 67 
Drain-source dynamic resistance, 20 
Equilibrium point, 125, 183, 187, 190 
Even function, 36 
Even harmonics, 108 
FD op amp 
current mirror 
CMFB, 128 
low-frequency voltage gain, 129 
design example, 130 
folded-cascode 
architecture, 130, 133 
two-stage 
CMFB, 123 
instability, 125 
Fermi potential, 20, 136 
Filter 
Gm-c, 1 
switched-capacitor, 1 
Flicker noise corner, 9 
Floating current source, 153, 154, 160 
Folded-cascode op amp, 86 
as voltage follower, 86 
design example, 87 
low-frequency voltage gain, 87 
small-signal equivalent circuit, 87 
Frequency compensation, 62, 71 
folded-cascode op amp, 90 
two-stage op amp, 60 
Fully differential op amp 
advantages, 107 
Fully integrated circuit, 167 
Gate overlap length, 27 
Gm-constant circuit, 185 
supply variation, 185 
with op amp, 185 
Input common-mode range, 2, 96 
Integrated mixed-mode circuit, 107 
Ion implantation, 15 
Isolation areas, 15 
Low-voltage design, 85, 108, 130, 166 
Master bias current, 180 
Mirror pole 
differential pair, 47 
folded-cascode, 87 
omission in FD amplifier, 108 
telescopic cascode, 84 
Moderate inversion, 23, 89, 191 
Modified two-stage op amp, 78, 79, 82 
conjugate poles, 79 
Monte Carlo simulation, 4 
MOS capacitances 
fringing, 27 
gate to source/drain, 26 
gate to substrate, 24 
overlap gate to source/drain, 26 
source/drain to bulk, 27 
MOS channel charge, 26 
MOS fabrication 
n-well, 15 
steps, 16 

 
Index 
197
 
 
 
 
 
MOS inversion states 
strong inversion, 17 
weak inversion, 17 
MOS operating regions 
saturation, 18 
subthreshold, 21 
triode, 17 
MOS small-signal equivalent circuit 
high frequency, 29 
MOS surface charge, 25 
MOS Transconductance 
saturation relationship, 22 
short channel effect, 67 
subthreshold relationship, 22 
MOS transition frequency 
definition, 30 
relationship, 30 
Natural frequency, 80, 161, 162 
Near-zero temperature coefficient, 177, 
188 
Noise 
channel thermal noise current, 48, 49 
flicker noise coefficient, 49 
flicker noise voltage, 48, 49, 171 
MOS input-referred noise voltage, 49 
op amp, 8 
Nonoverlapping clocks, 120 
Nonsilicide polysilicon resistor, 176 
Odd function, 35, 108 
Odd harmonics, 35, 108 
Offset voltage 
bandgap, 168, 175 
CMOS differential amplifier, 38 
relationship, 40 
fully differential op amp, 6 
measurement, 6 
single-ended op amp, 6 
threshold voltage mismatches, 41 
two-stage op amp 
random, 58 
systematic, 56 
unbalanced differential pair, 177 
On-chip component, 66 
Op amp 
bandwidth, 7 
Dc gain, 1 
linearity range, 2 
noise, 8 
offset voltage, 5 
PSRR, 9 
slew rate, 8 
with class AB output stage 
design example, 163 
Output stage 
class A power amplifier, 135, 139 
class AB 
case study, 159 
low voltage, 149 
op amp design example, 163 
stable quiescent current, 145 
translinear loop, 153 
class B power amplifier, 139 
quiescent current, 140 
drain-coupled complementary 
transistors, vi, 142 
source-follower, 114, 135, 137, 138, 
139 
nonlinear behavior, 136 
output voltage swing, 137 
Oxide thickness cross-chip gradients, 41 
Periodic steady state, 132 
Pipeline analog-to-digital converters, 8 
Polysilicon resistors, 172 
Positive-feedback loop, 182 
Power supply rejection ratio. See PSRR 
PSRR 
definition, 9 
fully differential op amp, 11 
measurement, 10 
modified two-stage op amp 
frequency response, 80 
two-stage op amp, 72 
improvement, 77 
positive supply frequency response, 
75 
small-signal equivalent circuit, 73 
Quality factor, 80, 161, 162 
Rail-to-Rail input op amp, 96 
current combiner, 103 
input transconductance, 98 
translinear loop, 99, 101 
Resistive divider, 119, 173 
Right half-plane zero, 59, 62, 65, 66, 80 
Sheet resistance, 174 
Slew rate 
modified two-stage op amp, 81 

198 
Index 
 
Source/drain overlap parasitic 
capacitance, 16 
Source-coupled differential pair 
drain currents, 34 
large-signal transconductance, 35 
SpectreRF, 132 
Stable points, 183, 187 
Startup circuit 
bandgap voltage reference, 171 
bandgap voltage reference without 
resistor, 180 
CMOS current reference, 188 
test method, 171 
Subthreshold 
criterion, 23 
relationship, 21 
reverse saturation current, 21 
Subthreshold factor, 69, 87, 130 
Surface potential, 25 
Symmetrical devices, 40 
Symmetrical layout, 170, 175 
Systematic offset voltage elimination, 57 
TC 
bandgap 
resistors, 170 
base-emitter junction, 171 
Telescopic cascode op amp, 83 
frequency response, 84 
low-frequency voltage gain, 84 
output voltage swing, 85 
Thermal voltage, 21, 156, 168 
Threshold voltage 
definition, 17 
mismatch 
absolute statistical variation, 41 
gate area, 41 
threshold proportionality factor, 41 
Total harmonic distortion, 165 
Translinear element, 98 
Translinear loop 
class AB, 153 
definition, 98 
Twin-loop 
current mirror, 182, 183, 184 
instability, 7, 60, 126, 183 
Two-stage op amp 
compensation resistor realization, 70 
dc voltage gain, 60 
design example, 69 
design procedure, 65 
frequency compensation, 60 
low-frequency voltage gain, 63 
phase margin, 62 
positive supply transfer function, 74 
random offset voltage, 58 
slew rate, 66 
small-signal equivalent circuit, 59 
systematic offset voltage, 56 
voltage gain transfer function, 59 
Unity gain bandwidth 
definition, 7 
two-stage op amp, 60 
Vertical PNP transistor, 169 
Voltage reference generator, 167, 193 
Voltage-controlled oscillator, 167 
Voltage-to-current converter, 33 
Zero-pole cancellation, 64 
 

