
de Gruyter Studies in Mathematics 27
Editors: Carlos Kenig Â· Andrew Ranicki Â· Michael RÃ¶ckner

de Gruyter Studies in Mathematics
1 Riemannian Geometry, 2nd rev. ed., Wilhelm P. A. Klingenberg
2 Semimartingales, Michel MeÂ´tivier
3 Holomorphic Functions of Several Variables, Ludger Kaup and Burchard Kaup
4 Spaces of Measures, Corneliu Constantinescu
5 Knots, 2nd rev. and ext. ed., Gerhard Burde and Heiner Zieschang
6 Ergodic Theorems, Ulrich Krengel
7 Mathematical Theory of Statistics, Helmut Strasser
8 Transformation Groups, Tammo tom Dieck
9 Gibbs Measures and Phase Transitions, Hans-Otto Georgii
10 Analyticity in Infinite Dimensional Spaces, Michel HerveÂ´
11 Elementary Geometry in Hyperbolic Space, Werner Fenchel
12 Transcendental Numbers, Andrei B. Shidlovskii
13 Ordinary Differential Equations, Herbert Amann
14 Dirichlet Forms and Analysis on Wiener Space, Nicolas Bouleau and
Francis Hirsch
15 Nevanlinna Theory and Complex Differential Equations, Ilpo Laine
16 Rational Iteration, Norbert Steinmetz
17 Korovkin-type Approximation Theory and its Applications, Francesco Altomare
and Michele Campiti
18 Quantum Invariants of Knots and 3-Manifolds, Vladimir G. Turaev
19 Dirichlet Forms and Symmetric Markov Processes, Masatoshi Fukushima,
Yoichi Oshima and Masayoshi Takeda
20 Harmonic Analysis of Probability Measures on Hypergroups, Walter R. Bloom
and Herbert Heyer
21 Potential Theory on Infinite-Dimensional Abelian Groups, Alexander Bendikov
22 Methods of Noncommutative Analysis, Vladimir E. Nazaikinskii,
Victor E. Shatalov and Boris Yu. Sternin
23 Probability Theory, Heinz Bauer
24 Variational Methods for Potential Operator Equations, Jan Chabrowski
25 The Structure of Compact Groups, Karl H. Hofmann and Sidney A. Morris
26 Measure and Integration Theory, Heinz Bauer
27 Stochastic Finance, 2nd rev. and ext. ed., Hans FÃ¶llmer and Alexander Schied
28 PainleveÂ´ Differential Equations in the Complex Plane, Valerii I. Gromak, Ilpo
Laine and Shun Shimomura
29 Discontinuous Groups of Isometries in the Hyperbolic Plane, Werner Fenchel
and Jakob Nielsen
30 The Reidemeister Torsion of 3-Manifolds, Liviu I. Nicolaescu
31 Elliptic Curves, Susanne Schmitt and Horst G. Zimmer

Hans FÃ¶llmer Â· Alexander Schied
Stochastic Finance
An Introduction in Discrete Time
Second Revised and Extended Edition
Walter de Gruyter
Berlin Â· New York
â‰¥

Authors
Hans FÃ¶llmer
Institut fÃ¼r Mathematik
Humboldt UniversitÃ¤t zu Berlin
Unter den Linden 6
10099 Berlin
Germany
Alexander Schied
Institut fÃ¼r Mathematik, MA 74
Technische UniversitÃ¤t Berlin
StraÃŸe des 17. Juni 136
10623 Berlin
Germany
Series Editors
Carlos E. Kenig
Department of Mathematics
University of Chicago
5734 University Ave
Chicago, IL 60637
USA
Andrew Ranicki
School of Mathematics
University of Edinburgh
Mayfield Road
Edinburgh EH9 3JZ
Great Britain
Michael RÃ¶ckner
FakultÃ¤t fÃ¼r Mathematik
UniversitÃ¤t Bielefeld
UniversitÃ¤tsstraÃŸe 25
33615 Bielefeld
Germany
Mathematics Subject Classification 2000: Primary: 60-01, 91-01, 91-02; secondary: 46N10, 60E15,
60G40, 60G42, 91B08, 91B16, 91B28, 91B30, 91B50, 91B52, 91B70
Keywords: Martingales, arbitrage, contingent claims, options, hedging, preferences, optimization, equi-
librium, value at risk, risk measures
E
P Printed on acid-free paper which falls within the guidelines of the ANSI
to ensure permanence and durability.
Library of Congress  Cataloging-in-Publication Data
FÃ¶llmer, Hans.
Stochastic finance : an introduction in discrete time / by Hans FÃ¶ll-
mer, Alexander Schied. 2nd rev. and extended ed.
p.
cm.  (De Gruyter studies in mathematics ; 27)
Includes bibliographical references and index.
ISBN 3-11-018346-3 (Cloth : alk. paper)
1. Finance  Statistical methods.
2. Stochastic analysis.
3. Prob-
abilities.
I. Schied, Alexander.
II. Title.
III. Series.
HG176.5.F65
2004
3321.011519232dc22
004021608
ISBN 3-11-018346-3
Bibliographic information published by Die Deutsche Bibliothek
Die Deutsche Bibliothek lists this publication in the Deutsche Nationalbibliografie;
detailed bibliographic data is available in the Internet at http://dnb.ddb.de.
 Copyright 2004 by Walter de Gruyter GmbH & Co. KG, 10785 Berlin, Germany.
All rights reserved, including those of translation into foreign languages. No part of this book may be
reproduced in any form or by any means, electronic or mechanical, including photocopy, recording, or
any information storage and retrieval system, without permission in writing from the publisher.
Printed in Germany.
Cover design: Rudolf HÃ¼bler, Berlin.
Typeset using the authorsâ€™ TEX files: I. Zimmermann, Freiburg.
Printing and binding: Hubert & Co. GmbH & Co. KG, GÃ¶ttingen.

Preface to the second edition
Since the publication of the ï¬rst edition we have used it as the basis for several courses.
These include courses for a whole semester on Mathematical Finance in Berlin and
also short courses on special topics such as risk measures given at the Institut Henri
PoincarÃ© in Paris, at the Department of Operations Research at Cornell University, at
theAcademia Sinica in Taipei, and at the 8th Symposium on Probability and Stochastic
Processes in Puebla. In the process we have made a large number of minor corrections,
we have discovered many opportunities for simpliï¬cation and clariï¬cation, and we
have also learned more about several topics. As a result, major parts of this book
have been improved or even entirely rewritten. Among them are those on robust
representations of risk measures, arbitrage-free pricing of contingent claims, exotic
derivatives in the CRR model, convergence to Blackâ€“Scholes prices, and stability
under pasting with its connections to dynamically consistent coherent risk measures.
In addition, this second edition contains several new sections, including a systematic
discussion of law-invariant risk measures, of concave distortions, and of the relations
between risk measures and Choquet integration.
It is a pleasure to express our thanks to all students and colleagues whose comments
have helped us to prepare this second edition, in particular to Dirk Becherer, Hans
BÃ¼hler, Rose-Anne Dana, Ulrich Horst, Mesrop Janunts, Christoph KÃ¼hn, Maren
Liese, Harald Luschgy, Holger Pint, Philip Protter, Lothar Rogge, Stephan Sturm,
Stefan Weber, Wiebke WittmÃ¼ÃŸ, and Ching-Tang Wu. Special thanks are due to Peter
Bank and toYuliya Mishura and Georgiy Shevchenko, our translators for the Russian
edition. Finally, we thank Irene Zimmermann and Manfred Karbe of de GruyterVerlag
for urging us to write a second edition and for their efï¬cient support.
Berlin, September 2004
Hans FÃ¶llmer
Alexander Schied


Preface to the ï¬rst edition
This book is an introduction to probabilistic methods in Finance. It is intended for
graduate students in mathematics, and it may also be useful for mathematicians in
academia and in the ï¬nancial industry. Our focus is on stochastic models in discrete
time. This limitation has two immediate beneï¬ts. First, the probabilistic machinery
is simpler, and we can discuss right away some of the key problems in the theory
of pricing and hedging of ï¬nancial derivatives. Second, the paradigm of a complete
ï¬nancial market, where all derivatives admit a perfect hedge, becomes the exception
rather than the rule. Thus, the discrete-time setting provides a shortcut to some of the
more recent literature on incomplete ï¬nancial market models.
As a textbook for mathematicians, it is an introduction at an intermediate level,
with special emphasis on martingale methods. Since it does not use the continuous-
time methods of ItÃ´ calculus, it needs less preparation than more advanced texts such
as [73], [74], [82], [129], [188]. On the other hand, it is technically more demanding
than textbooks such as [160]: We work on general probability spaces, and so the text
captures the interplay between probability theory and functional analysis which has
been crucial for some of the recent advances in mathematical ï¬nance.
The book is based on our notes for ï¬rst courses in Mathematical Finance which
both of us are teaching in Berlin at Humboldt University and at Technical University.
These courses are designed for students in mathematics with some background in
probability. Sometimes, they are given in parallel to a systematic course on stochastic
processes. At other times, martingale methods in discrete time are developed in the
course, as they are in this book. Usually the course is followed by a second course on
Mathematical Finance in continuous time. There it turns out to be useful that students
are already familiar with some of the key ideas of Mathematical Finance.
The core of this book is the dynamic arbitrage theory in the ï¬rst chapters of Part II.
When teaching a course, we found it useful to explain some of the main arguments
in the more transparent one-period model before using them in the dynamical setting.
So one approach would be to start immediately in the multi-period framework of
Chapter 5, and to go back to selected sections of Part I as the need arises. As an
alternative, one could ï¬rst focus on the one-period model, and then move on to Part II.
We include in Chapter 2 a brief introduction to the mathematical theory of expected
utility, even though this is a classical topic, and there is no shortage of excellent
expositions; see, for instance, [138] which happens to be our favorite. We have three
reasons for including this chapter. Our focus in this book is on incompleteness, and
incompleteness involves, in one form or another, preferences in the face of risk and
uncertainty. We feel that mathematicians working in this area should be aware, at
least to some extent, of the long line of thought which leads from Daniel Bernoulli via
von Neumannâ€“Morgenstern and Savage to some more recent developments which are
motivated by shortcomings of the classical paradigm. This is our ï¬rst reason. Second,

viii
Preface to the ï¬rst edition
the analysis of risk measures has emerged as a major topic in mathematical ï¬nance,
and this is closely related to a robust version of the Savage theory. Third, but not least,
our experience is that this part of the course was found particularly enjoyable, both by
the students and by ourselves.
We acknowledge our debt and express our thanks to all colleagues who have
contributed, directly or indirectly, through their publications and through informal
discussions, to our understanding of the topics discussed in this book. Ideas and
methods developed by Freddy Delbaen, Darrell Dufï¬e, Nicole El Karoui, David Heath,
Yuri Kabanov, Ioannis Karatzas, Dimitri Kramkov, David Kreps, Stanley Pliska, Chris
Rogers, Steve Ross, Walter Schachermayer, Martin Schweizer, Dieter Sondermann
and Christophe Stricker play a key role in our exposition. We are obliged to many
others; for instance the textbooks [54], [73], [74], [116], and [143] were a great help
when we started to teach courses on the subject.
We are grateful to all those who read parts of the manuscript and made useful
suggestions, in particular to Dirk Becherer, Ulrich Horst, Steffen KrÃ¼ger, Irina Penner,
and to Alexander Giese who designed some of the ï¬gures. Special thanks are due to
Peter Bank for a large number of constructive comments. We also express our thanks to
Erhan Ã‡inlar, Adam Monahan, and Philip Protter for improving some of the language,
and to the Department of Operations Research and Financial Engineering at Princeton
University for its hospitality during the weeks when we ï¬nished the manuscript.
Berlin, June 2002
Hans FÃ¶llmer
Alexander Schied

Contents
Preface to the second edition
v
Preface to the ï¬rst edition
vii
I
Mathematical ï¬nance in one period
1
1
Arbitrage theory
3
1.1
Assets, portfolios, and arbitrage opportunities . . . . . . . . . . . . .
3
1.2
Absence of arbitrage and martingale measures . . . . . . . . . . . . .
6
1.3
Derivative securities . . . . . . . . . . . . . . . . . . . . . . . . . . .
14
1.4
Complete market models . . . . . . . . . . . . . . . . . . . . . . . .
23
1.5
Geometric characterization of arbitrage-free models . . . . . . . . . .
27
1.6
Contingent initial data . . . . . . . . . . . . . . . . . . . . . . . . . .
31
2
Preferences
44
2.1
Preference relations and their numerical representation . . . . . . . .
45
2.2
Von Neumannâ€“Morgenstern representation . . . . . . . . . . . . . . .
51
2.3
Expected utility . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
61
2.4
Uniform preferences
. . . . . . . . . . . . . . . . . . . . . . . . . .
74
2.5
Robust preferences on asset proï¬les
. . . . . . . . . . . . . . . . . .
86
2.6
Probability measures with given marginals . . . . . . . . . . . . . . .
99
3
Optimality and equilibrium
108
3.1
Portfolio optimization and the absence of arbitrage
. . . . . . . . . . 108
3.2
Exponential utility and relative entropy . . . . . . . . . . . . . . . . . 116
3.3
Optimal contingent claims
. . . . . . . . . . . . . . . . . . . . . . . 125
3.4
Microeconomic equilibrium
. . . . . . . . . . . . . . . . . . . . . . 137
4
Monetary measures of risk
152
4.1
Risk measures and their acceptance sets . . . . . . . . . . . . . . . . 153
4.2
Robust representation of convex risk measures . . . . . . . . . . . . . 161
4.3
Convex risk measures on Lâˆ. . . . . . . . . . . . . . . . . . . . . . 171
4.4
Value at Risk
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177
4.5
Law-invariant risk measures
. . . . . . . . . . . . . . . . . . . . . . 183
4.6
Concave distortions . . . . . . . . . . . . . . . . . . . . . . . . . . . 188
4.7
Comonotonic risk measures . . . . . . . . . . . . . . . . . . . . . . . 195
4.8
Measures of risk in a ï¬nancial market
. . . . . . . . . . . . . . . . . 203
4.9
Shortfall risk
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 212

x
Contents
II
Dynamic hedging
221
5
Dynamic arbitrage theory
223
5.1
The multi-period market model . . . . . . . . . . . . . . . . . . . . . 223
5.2
Arbitrage opportunities and martingale measures
. . . . . . . . . . . 227
5.3
European contingent claims . . . . . . . . . . . . . . . . . . . . . . . 234
5.4
Complete markets . . . . . . . . . . . . . . . . . . . . . . . . . . . . 245
5.5
The binomial model . . . . . . . . . . . . . . . . . . . . . . . . . . . 248
5.6
Exotic derivatives . . . . . . . . . . . . . . . . . . . . . . . . . . . . 253
5.7
Convergence to the Blackâ€“Scholes price . . . . . . . . . . . . . . . . 259
6
American contingent claims
277
6.1
Hedging strategies for the seller
. . . . . . . . . . . . . . . . . . . . 277
6.2
Stopping strategies for the buyer . . . . . . . . . . . . . . . . . . . . 282
6.3
Arbitrage-free prices
. . . . . . . . . . . . . . . . . . . . . . . . . . 292
6.4
Stability under pasting
. . . . . . . . . . . . . . . . . . . . . . . . . 297
6.5
Lower and upper Snell envelopes . . . . . . . . . . . . . . . . . . . . 300
7
Superhedging
308
7.1
P -supermartingales . . . . . . . . . . . . . . . . . . . . . . . . . . . 308
7.2
Uniform Doob decomposition
. . . . . . . . . . . . . . . . . . . . . 310
7.3
Superhedging of American and European claims . . . . . . . . . . . . 313
7.4
Superhedging with liquid options . . . . . . . . . . . . . . . . . . . . 322
8
Efï¬cient hedging
333
8.1
Quantile hedging . . . . . . . . . . . . . . . . . . . . . . . . . . . . 333
8.2
Hedging with minimal shortfall risk
. . . . . . . . . . . . . . . . . . 339
9
Hedging under constraints
350
9.1
Absence of arbitrage opportunities . . . . . . . . . . . . . . . . . . . 350
9.2
Uniform Doob decomposition
. . . . . . . . . . . . . . . . . . . . . 357
9.3
Upper Snell envelopes
. . . . . . . . . . . . . . . . . . . . . . . . . 362
9.4
Superhedging and risk measures . . . . . . . . . . . . . . . . . . . . 369
10 Minimizing the hedging error
372
10.1 Local quadratic risk . . . . . . . . . . . . . . . . . . . . . . . . . . . 372
10.2 Minimal martingale measures . . . . . . . . . . . . . . . . . . . . . . 382
10.3 Variance-optimal hedging . . . . . . . . . . . . . . . . . . . . . . . . 392
Appendix
399
A.1
Convexity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 399
A.2
Absolutely continuous probability measures . . . . . . . . . . . . . . 403
A.3
Quantile functions . . . . . . . . . . . . . . . . . . . . . . . . . . . . 406
A.4
The Neymanâ€“Pearson lemma . . . . . . . . . . . . . . . . . . . . . . 414

Contents
xi
A.5
The essential supremum of a family of random variables
. . . . . . . 417
A.6
Spaces of measures . . . . . . . . . . . . . . . . . . . . . . . . . . . 418
A.7
Some functional analysis . . . . . . . . . . . . . . . . . . . . . . . . 428
Notes
433
Bibliography
439
List of symbols
449
Index
451


Part I
Mathematical ï¬nance in one period


Chapter 1
Arbitrage theory
In this chapter, we study the mathematical structure of a simple one-period model of a
ï¬nancial market. We consider a ï¬nite number of assets. Their initial prices at time t =
0 areknown, theirfuturepricesattimet = 1aredescribedasrandomvariablesonsome
probability space. Trading takes place at time t = 0. Already in this simple model,
some basic principles of mathematical ï¬nance appear very clearly. In Section 1.2, we
single out those models which satisfy a condition of market efï¬ciency: There are no
trading opportunities which yield a proï¬t without any downside risk. The absence
of such arbitrage opportunities is characterized by the existence of an equivalent
martingale measure. Under such a measure, discounted prices have the martingale
property, that is, trading in the assets is the same as playing a fair game. As explained
in Section 1.3, any equivalent martingale measure can be identiï¬ed with a pricing rule:
It extends the given prices of the primary assets to a larger space of contingent claims,
or ï¬nancial derivatives, without creating new arbitrage opportunities. In general, there
will be several such extensions. A given contingent claim has a unique price if and only
if it admits a perfect hedge. In our one-period model, this will be the exception rather
than the rule. Thus, we are facing market incompleteness, unless our model satisï¬es
the very restrictive conditions discussed in Section 1.4. The geometric structure of an
arbitrage-free model is described in Section 1.5.
The one-period market model will be used throughout the ï¬rst part of this book.
On the one hand, its structure is rich enough to illustrate some of the key ideas of the
ï¬eld. On the other hand, it will provide an introduction to some of the mathematical
methods which will be used in the dynamic hedging theory of the second part. In fact,
the multi-period situation considered in Chapter 5 can be regarded as a sequence of
one-period models whose initial conditions are contingent on the outcomes of previous
periods. The techniques for dealing with such contingent initial data are introduced
in Section 1.6.
1.1 Assets, portfolios, and arbitrage opportunities
Consider a ï¬nancial market with d + 1 assets. The assets can consist, for instance,
of equities, bonds, commodities, or currencies. In a simple one-period model, these
assets are priced at the initial time t = 0 and at the ï¬nal time t = 1. We assume that
the ith asset is available at time 0 for a price Ï€i â‰¥0. The collection
Ï€ = (Ï€0, Ï€1, . . . , Ï€d) âˆˆRd+1
+

4
1 Arbitrage theory
is called a price system. Prices at time 1 are usually not known beforehand at time 0.
In order to model this uncertainty, we ï¬x a probability space (, F , P ) and describe
the asset prices at time 1 as non-negative measurable functions
S0, S1, . . . , Sd
on (, F ) with values in [0, âˆ). Every Ï‰ âˆˆ corresponds to a particular scenario
of market evolution, and Si(Ï‰) is the price of the ith asset at time 1 if the scenario Ï‰
occurs.
However, not all asset prices in a market are necessarily uncertain. Usually there
is a riskless bond which will pay a sure amount at time 1. In our simple model for one
period, such a riskless investment opportunity will be included by assuming that
Ï€0 = 1
and
S0 â‰¡1 + r
for a constant r, the return of a unit investment into the riskless bond. In most situations
it would be natural to assume r â‰¥0, but for our purposes it is enough to require that
S0 > 0, or equivalently that
r > âˆ’1.
In order to distinguish S0 from the risky assets S1, . . . , Sd, it will be convenient to
use the notation
S = (S0, S1, . . . , Sd) = (S0, S),
and in the same way we will write Ï€ = (1, Ï€).
At time t = 0, an investor will choose a portfolio
Î¾ = (Î¾0, Î¾) = (Î¾0, Î¾1, . . . , Î¾d) âˆˆRd+1,
where Î¾i represents the number of shares of the ith asset. The price for buying the
portfolio Î¾ equals
Ï€ Â· Î¾ =
d

i=0
Ï€iÎ¾i.
At time t = 1, the portfolio will have the value
Î¾ Â· S(Ï‰) =
d

i=0
Î¾iSi(Ï‰) = Î¾0(1 + r) + Î¾ Â· S(Ï‰),
depending on the scenario Ï‰ âˆˆ. Here we assume implicitly that buying and selling
assets does not create extra costs, an assumption which may not be valid for a small
investor but which becomes more realistic for a large ï¬nancial institution. Note our
convention of writing x Â· y for the inner product of two vectors x and y in Euclidean
space.
Our deï¬nition of a portfolio allows the components Î¾i to be negative. If Î¾0 < 0,
this corresponds to taking out a loan such that we receive the amount |Î¾0| at t = 0

1.1 Assets, portfolios, and arbitrage opportunities
5
and pay back the amount (1 + r)|Î¾0| at time t = 1. If Î¾i < 0 for i â‰¥1, a quantity of
|Î¾i| shares of the ith asset is sold without actually owning them. This corresponds to
a short sale of the asset. In particular, an investor is allowed to take a short position
Î¾i < 0, and to use up the received amount Ï€i|Î¾i| for buying quantities Î¾j â‰¥0, j Ì¸= i,
of the other assets. In this case, the price of the portfolio Î¾ = (Î¾0, Î¾) is given by
Î¾ Â· Ï€ = 0.
Deï¬nition 1.1. A portfolio Î¾ âˆˆRd+1 is called an arbitrage opportunity if Ï€ Â· Î¾ â‰¤0
but Î¾ Â· S â‰¥0 P -a.s. and P [ Î¾ Â· S > 0 ] > 0.
Intuitively, an arbitrage opportunity is an investment strategy that yields with
positive probability a positive proï¬t and is not exposed to any downside risk. The
existence of such an arbitrage opportunity may be regarded as a market inefï¬ciency
in the sense that certain assets are not priced in a reasonable way. In real-world
markets, arbitrage opportunities are rather hard to ï¬nd. If such an opportunity would
show up, it would generate a large demand, prices would adjust, and the opportunity
would disappear. Later on, the absence of such arbitrage opportunities will be our
key assumption. Absence of arbitrage implies that Si vanishes P -a.s. once Ï€i = 0.
Hence, there is no loss in generality if we assume from now on that
Ï€i > 0
for i = 1, . . . , d.
Remark 1.2. Note that the probability measure P enters the deï¬nition of an arbitrage
opportunity only through the null sets of P . In particular, the deï¬nition can be for-
mulated without any explicit use of probabilities if  is countable. In this case there
is no loss of generality in assuming that the underlying probability measure satisï¬es
P[{Ï‰}] > 0 for every Ï‰ âˆˆ. Then an arbitrage opportunity is simply a portfolio Î¾
with Ï€ Â· Î¾ â‰¤0, with Î¾ Â· S(Ï‰) â‰¥0 for all Ï‰ âˆˆ, and such that Î¾ Â· S(Ï‰0) > 0 for at
least one Ï‰0 âˆˆ.
â™¦
The following lemma shows that absence of arbitrage is equivalent to the following
property of the market: Any investment in risky assets which yields with positive
probability a better result than investing the same amount in the risk-free asset must
be open to some downside risk.
Lemma 1.3. The following statements are equivalent.
(a) The market model admits an arbitrage opportunity.
(b) There is a vector Î¾ âˆˆRd such that
Î¾ Â· S â‰¥(1 + r)Î¾ Â· Ï€ P -a.s.
and
P [ Î¾ Â· S > (1 + r)Î¾ Â· Ï€ ] > 0.
Proof. To see that (a) implies (b), let Î¾ be an arbitrage opportunity. Then 0 â‰¥Î¾ Â·Ï€ =
Î¾0 + Î¾ Â· Ï€. Hence,
Î¾ Â· S âˆ’(1 + r)Î¾ Â· Ï€ â‰¥Î¾ Â· S + (1 + r)Î¾0 = Î¾ Â· S.

6
1 Arbitrage theory
Since Î¾ Â·S is P -a.s. non-negative and strictly positive with non-vanishing probability,
the same must be true of Î¾ Â· S âˆ’(1 + r)Î¾ Â· Ï€.
Next let Î¾ be as in (b). We claim that the portfolio (Î¾0, Î¾) with Î¾0 := âˆ’Î¾ Â· Ï€ is
an arbitrage opportunity. Indeed, Î¾ Â· Ï€ = Î¾0 + Î¾ Â· Ï€ = 0 by deï¬nition. Moreover,
Î¾ Â· S = âˆ’(1 + r)Î¾ Â· Ï€ + Î¾ Â· S, which is P -a.s. non-negative and strictly positive with
non-vanishing probability.
1.2 Absence of arbitrage and martingale measures
In this section, we are going to characterize those market models which do not admit
any arbitrage opportunities. Such models will be called arbitrage-free.
Deï¬nition 1.4. A probability measure P âˆ—is called a risk-neutral measure, or a mar-
tingale measure, if
Ï€i = Eâˆ—

Si
1 + r

,
i = 0, 1, . . . , d.
(1.1)
Remark 1.5. In (1.1), the price of the ith asset is identiï¬ed as the expectation of
the discounted payoff under the measure P âˆ—. Thus, the pricing formula (1.1) can
be seen as a classical valuation formula which does not take into account any risk
aversion, in contrast to valuations in terms of expected utility which will be discussed
in Section 2.3. This is why a measure P âˆ—satisfying (1.1) is called risk-neutral. The
connection to martingales will be made explicit in Section 1.6.
â™¦
The following basic result is sometimes called the â€œfundamental theorem of asset
pricingâ€ or, in short, FTAP. It characterizes arbitrage-free market models in terms of
the set
P :=

P âˆ—| P âˆ—is a risk-neutral measure with P âˆ—â‰ˆP

of risk-neutral measures which are equivalent to P . Recall that two probability mea-
sures P âˆ—and P are said to be equivalent (P âˆ—â‰ˆP ) if, for A âˆˆF , P âˆ—[ A ] = 0 if
and only if P[ A ] = 0. This holds if and only if P âˆ—has a strictly positive density
dP âˆ—/dP with respect to P ; see Appendix A.2. An equivalent risk-neutral measure is
also called a pricing measure or an equivalent martingale measure.
Theorem 1.6. A market model is arbitrage-free if and only if P Ì¸= âˆ…. In this case,
there exists a P âˆ—âˆˆP which has a bounded density dP âˆ—/dP .
We show ï¬rst that the existence of a risk-neutral measure implies the absence of
arbitrage.
Proof of the implication â‡of Theorem 1.6.
Suppose that there exists a risk-neutral
measure P âˆ—âˆˆP .
Take a portfolio Î¾ âˆˆRd+1 such that Î¾ Â· S â‰¥0 P -a.s. and

1.2 Absence of arbitrage and martingale measures
7
E[ Î¾ Â·S ] > 0. Both properties remain valid if we replace P by the equivalent measure
P âˆ—. Hence,
Ï€ Â· Î¾ =
d

i=0
Ï€iÎ¾i =
d

i=0
Eâˆ—
 Î¾iSi
1 + r

= Eâˆ—
 Î¾ Â· S
1 + r

> 0.
Thus, Î¾ cannot be an arbitrage opportunity.
For the proof of the implication â‡’of Theorem 1.6, it will be convenient to
introduce the random vector Y = (Y 1, . . . , Y d) of discounted net gains:
Y i :=
Si
1 + r âˆ’Ï€i,
i = 1, . . . , d.
(1.2)
With this notation, Lemma 1.3 implies that the absence of arbitrage is equivalent to
the following condition:
For Î¾ âˆˆRd:
Î¾ Â· Y â‰¥0 P -a.s. "â‡’Î¾ Â· Y = 0 P -a.s.
(1.3)
Since Y i is bounded from below by âˆ’Ï€i, the expectation Eâˆ—[ Y i ] of Y i under any
measure P âˆ—is well-deï¬ned, and so P âˆ—is a risk-neutral measure if and only if
Eâˆ—[ Y ] = 0.
(1.4)
Here, Eâˆ—[ Y ] is a shorthand notation for the d-dimensional vector with components
Eâˆ—[ Y i ], i = 1, . . . , d. The assertion of Theorem 1.6 can now be read as follows:
Condition (1.3) holds if and only if there exists some P âˆ—â‰ˆP such that Eâˆ—[ Y ] = 0,
and in this case, P âˆ—can be chosen such that the density dP âˆ—/dP is bounded.
Proof of the implication â‡’of Theorem 1.6. We have to show that (1.3) implies the
existence of some P âˆ—â‰ˆP such that (1.4) holds and such that the density dP âˆ—/dP is
bounded. We will do this ï¬rst in the case in which
E[ |Y| ] < âˆ.
Let Q denote the convex set of all probability measures Q â‰ˆP with bounded
densities dQ/dP , and denote by EQ[ Y ] the d-dimensional vector with components
EQ[ Y i ], i = 1, . . . , d. Due to our assumption that |Y| âˆˆL1(P ), all these expecta-
tions are ï¬nite. Let
C := { EQ[ Y ] | Q âˆˆQ },
and note that C is a convex set in Rd: If Q1, Q0 âˆˆQ and 0 â‰¤Î± â‰¤1, then
QÎ± := Î±Q1 + (1 âˆ’Î±)Q0 âˆˆQ and
Î±EQ1[ Y ] + (1 âˆ’Î±)EQ0[ Y ] = EQÎ±[ Y ],
which lies in C.

8
1 Arbitrage theory
Our aim is to show that C contains the origin. To this end, we suppose by way of
contradictionthat0 /âˆˆC. Usingtheâ€œseparatinghyperplanetheoremâ€intheelementary
form of Proposition A.1, we obtain a vector Î¾ âˆˆRd such that Î¾ Â· x â‰¥0 for all x âˆˆC,
and such that Î¾ Â· x0 > 0 for some x0 âˆˆC. Thus, Î¾ satisï¬es EQ[ Î¾ Â· Y ] â‰¥0 for all
Q âˆˆQ and EQ0[ Î¾ Â· Y ] > 0 for some Q0 âˆˆQ. Clearly, the latter condition yields
that P[ Î¾ Â· Y > 0 ] > 0. We claim that the ï¬rst condition implies that Î¾ Â· Y is P -a.s.
non-negative. This fact will be a contradiction to our assumption (1.3) and thus will
prove that 0 âˆˆC.
To prove the claim that Î¾ Â·Y â‰¥0 P -a.s., let A := { Î¾ Â·Y < 0}, and deï¬ne functions
Ï•n :=

1 âˆ’1
n

Â· IA + 1
n Â· IAc .
We take Ï•n as densities for new probability measures Qn:
dQn
dP
:=
1
E[ Ï•n ] Â· Ï•n,
n = 2, 3, . . . .
Since 0 < Ï•n â‰¤1, it follows that Qn âˆˆQ, and thus that
0 â‰¤Î¾ Â· EQn[ Y ] =
1
E[ Ï•n ] E[ Î¾ Â· Y Ï•n ].
Hence, Lebesgueâ€™s dominated convergence theorem yields that
E

Î¾ Â· Y I{ Î¾Â·Y<0 }

= lim
nâ†‘âˆE[ Î¾ Â· Y Ï•n ] â‰¥0.
This proves the claim that Î¾ Â· Y â‰¥0 P -a.s. and completes the proof of Theorem 1.6
in case E[ |Y| ] < âˆ.
If Y is not P -integrable, then we simply replace the probability measure P by
a suitable equivalent measure 
P whose density d 
P /dP is bounded and for which

E[ |Y| ] < âˆ. For instance, one can deï¬ne 
P by
d 
P
dP =
c
1 + |Y|
for c :=

E

1
1 + |Y|
âˆ’1
.
Recall from Remark 1.2 that replacing P with an equivalent probability measure does
not affect the absence of arbitrage opportunities in our market model. Thus, the ï¬rst
part of this proof yields a risk-neutral measure P âˆ—which is equivalent to 
P and whose
density dP âˆ—/d 
P is bounded. Then P âˆ—âˆˆP, and
dP âˆ—
dP = dP âˆ—
d 
P
Â· d 
P
dP
is bounded. Hence, P âˆ—is as desired, and the theorem is proved.

1.2 Absence of arbitrage and martingale measures
9
Remark 1.7. Our assumption that asset prices are non-negative implies that the com-
ponents of Y are bounded from below. Note however that this assumption was not
needed in our proof. Thus, Theorem 1.6 also holds if we only assume that S is ï¬nite-
valued and Ï€ âˆˆRd. In this case, the deï¬nition of a risk-neutral measure P âˆ—via
(1.1) is meant to include the assumption that Si is integrable with respect to P âˆ—for
i = 1, . . . , d.
â™¦
Example 1.8. Let P be any probability measure on the ï¬nite set  := { Ï‰1, . . . , Ï‰N }
that assigns strictly positive probability pi to each singleton { Ï‰i }. Suppose that there
is a single risky asset deï¬ned by its price Ï€ = Ï€1 at time 0 and by the random variable
S = S1. We may assume without loss of generality that the values si := S(Ï‰i) are
distinct and arranged in increasing order: s1 < Â· Â· Â· < sN. According to Theorem 1.6,
this model does not admit arbitrage opportunities if and only if
Ï€(1 + r) âˆˆ{ 
E[ S ] | 
P â‰ˆP } =
$
N

i=1
sipi
 pi > 0,
N

i=1
pi = 1
%
= (s1, sN),
and P âˆ—is a risk-neutral measure if and only if the probabilities pâˆ—
i := P âˆ—[ {Ï‰i} ] solve
the linear equations
s1pâˆ—
1 + Â· Â· Â· + sNpâˆ—
N = Ï€(1 + r),
pâˆ—
1 + Â· Â· Â· + pâˆ—
N = 1.
If a solution exists, it will be unique if and only if N = 2, and there will be inï¬nitely
many solutions for N > 2.
â™¦
Remark 1.9. The economic reason for working with the discounted asset prices
Xi :=
Si
1 + r ,
i = 0, . . . , d,
(1.5)
is that one should distinguish between one unit of a currency (e.g. â‚¬) at time t = 0
and one unit at time t = 1. Usually people tend to prefer a certain amount today over
the same amount which is promised to be paid at a later time. Such a preference is
reï¬‚ected in an interest r > 0 paid by the riskless bond: Only the amount 1/(1 + r) â‚¬
must be invested at time 0 to obtain 1 â‚¬ at time 1. This effect is sometimes referred to
as the time value of money. Similarly, the price Si of the ith asset is quoted in terms
of â‚¬ at time 1, while Ï€i corresponds to time-zero euros. Thus, in order to compare
the two prices Ï€i and Si, one should ï¬rst convert them to a common standard. This is
achieved by taking the riskless bond as a numÃ©raire and by considering the discounted
prices in (1.5).
â™¦
Remark 1.10. One can choose as numÃ©raire any asset which is strictly positive. For
instance, suppose that Ï€1 > 0 and P [ S1 > 0 ] = 1. Then all asset prices can be
expressed in units of the ï¬rst asset by considering
Ï€i := Ï€i
Ï€1
and
Si
S1 ,
i = 0, . . . , d.

10
1 Arbitrage theory
Clearly, the deï¬nition of an arbitrage opportunity is independent of the choice of a
particular numÃ©raire. Thus, an arbitrage-free market model should admit a risk-neutral
measure with respect to the new numÃ©raire, i.e., a probability measure 
P âˆ—â‰ˆP such
that
Ï€i = 
Eâˆ—
 Si
S1

,
i = 0, . . . , d.
Let us denote by 
P the set of all such measures 
P âˆ—. Then

P =
$

P âˆ— d 
P âˆ—
dP =
S1
Eâˆ—[ S1 ] for some P âˆ—âˆˆP
%
.
Indeed, if 
P âˆ—lies in the set on the right, then

Eâˆ—
 Si
S1

= Eâˆ—[ Si ]
Eâˆ—[ S1 ] = Ï€i
Ï€1 = Ï€i,
and so 
P âˆ—âˆˆ
P . Reversing the roles of 
P and P then yields the identity of the two
sets. Note that
P âˆ©
P = âˆ…
as soon as S1 is not P -a.s. constant, because Jensenâ€™s inequality then implies that
1
Ï€1 = Ï€0 = 
Eâˆ— 1 + r
S1
!
>
1 + r

Eâˆ—[ S1 ]
and hence 
Eâˆ—[ S1 ] > Eâˆ—[ S1 ] for all 
P âˆ—âˆˆ
P and P âˆ—âˆˆP .
â™¦
Let
V :=

Î¾ Â· S | Î¾ âˆˆRd+1 
denote the linear space of all payoffs which can be generated by some portfolio. An
element of V will be called an attainable payoff. The portfolio that generates V âˆˆV
is in general not unique, but we have the following law of one price.
Lemma 1.11. Suppose that the market model is arbitrage-free and that V âˆˆV can
be written as V = Î¾ Â· S = Î¶ Â· S P -a.s. for two different portfolios Î¾ and Î¶. Then
Ï€ Â· Î¾ = Ï€ Â· Î¶.
Proof. We have (Î¾ âˆ’Î¶) Â· S = 0 P âˆ—-a.s. for any P âˆ—âˆˆP . Hence,
Ï€ Â· Î¾ âˆ’Ï€ Â· Î¶ = Eâˆ—
 (Î¾ âˆ’Î¶) Â· S
1 + r

= 0,
due to (1.1).
By the preceding lemma, it makes sense to deï¬ne the price of V âˆˆV as
Ï€(V ) := Ï€ Â· Î¾
if V = Î¾ Â· S,
(1.6)
whenever the market model is arbitrage-free.

1.2 Absence of arbitrage and martingale measures
11
Remark 1.12. Via (1.6), the price system Ï€ can be regarded as a linear form on the
ï¬nite-dimensional vector space V. For any P âˆ—âˆˆP we have
Ï€(V ) = Eâˆ— 
V
1 + r
!
,
V âˆˆV.
Thus, an equivalent risk-neutral measure P âˆ—deï¬nes a linear extension of Ï€ onto the
larger space L1(P âˆ—) of P âˆ—-integrable random variables. Since this space is usually
inï¬nite-dimensional, one cannot expect that such a pricing measure is in general
unique; see however Section 1.4.
â™¦
We have seen above that, in an arbitrage-free market model, the condition Î¾ Â·S = 0
P-a.s. implies that Ï€ Â· Î¾ = 0. In fact, one may assume without loss of generality that
Î¾ Â· S = 0 P -a.s.
"â‡’
Î¾ = 0,
(1.7)
for otherwise we can ï¬nd i âˆˆ{0, . . . , d} such that Î¾i Ì¸= 0 and represent the ith asset
as a linear combination of the remaining ones:
Ï€i = 1
Î¾i

jÌ¸=i
Î¾jÏ€j
and
Si = 1
Î¾i

jÌ¸=i
Î¾jSj.
In this sense, the ith asset is redundant and can be omitted.
Deï¬nition 1.13. The market model is called non-redundant if (1.7) holds.
Remark 1.14. In any non-redundant market model, the components of the vector Y
of discounted net gains are linearly independent in the sense that
Î¾ Â· Y = 0 P -a.s.
"â‡’
Î¾ = 0.
(1.8)
Conversely, via (1.3), condition (1.8) implies non-redundance if the market model is
arbitrage-free.
â™¦
Deï¬nition 1.15. Suppose that the market model is arbitrage-free and that V âˆˆV is
an attainable payoff such that Ï€(V ) Ì¸= 0. Then the return of V is deï¬ned by
R(V ) := V âˆ’Ï€(V )
Ï€(V )
.
Note that we have already seen the special case of the risk-free return
r = S0 âˆ’Ï€0
Ï€0
= R(S0).
If an attainable payoff V is a linear combination V = n
k=1 Î±kVk of non-zero attain-
able payoffs Vk, then
R(V ) =
n

k=1
Î²kR(Vk)
for Î²k =
Î±kÏ€(Vk)
n
i=1 Î±iÏ€(Vi).

12
1 Arbitrage theory
The coefï¬cient Î²k can be interpreted as the proportion of the investment allocated to
Vk. As a particular case of the formula above, we have that
R(V ) =
d

i=0
Ï€i Î¾i
Ï€ Â· Î¾
Â· R(Si)
for all non-zero attainable payoffs V = Î¾ Â· S (recall that we have assumed that all Ï€i
are strictly positive).
Proposition 1.16. Suppose that the market model is arbitrage-free, and let V âˆˆV be
an attainable payoff such that Ï€(V ) Ì¸= 0.
(a) Under any risk-neutral measure P âˆ—, the expected return of V is equal to the
risk-free return r:
Eâˆ—[ R(V ) ] = r.
(b) Under any measure Q â‰ˆP such that EQ[ |S| ] < âˆ, the expected return of V
is given by
EQ[ R(V ) ] = r âˆ’covQ
dP âˆ—
dQ , R(V )

,
where P âˆ—is an arbitrary risk-neutral measure in P and covQ denotes the
covariance with respect to Q.
Proof. (a): Since Eâˆ—[ V ] = Ï€(V )(1 + r), we have
Eâˆ—[ R(V ) ] = Eâˆ—[ V ] âˆ’Ï€(V )
Ï€(V )
= r.
(b): Let P âˆ—âˆˆP and Ï•âˆ—:= dP âˆ—/dQ. Then
covQ

Ï•âˆ—, R(V )

= EQ[ Ï•âˆ—R(V ) ] âˆ’EQ[ Ï•âˆ—] Â· EQ[ R(V ) ]
= Eâˆ—[ R(V ) ] âˆ’EQ[ R(V ) ].
Using part (a) yields the assertion.
Remark 1.17. Let us comment on the extension of the fundamental equivalence in
Theorem 1.6 to market models with an inï¬nity of tradable assets S0, S1, S2, . . . . We
assume that S0 â‰¡1 + r for some r > âˆ’1 and that the random vector
S(Ï‰) =

S1(Ï‰), S2(Ï‰), . . .

takes values in the space â„“âˆof bounded real sequences. This space is a Banach space
with respect to the norm
âˆ¥xâˆ¥âˆ:= sup
iâ‰¥1
|xi|
for x = (x1, x2, . . . ) âˆˆâ„“âˆ.

1.2 Absence of arbitrage and martingale measures
13
A portfolio Î¾ = (Î¾0, Î¾) is chosen in such a way that Î¾ = (Î¾1, Î¾2, . . . ) is a sequence
in the space â„“1, i.e., âˆ
i=1 |Î¾i| < âˆ. We assume that the corresponding price system
Ï€ = (Ï€0, Ï€) satisï¬es Ï€ âˆˆâ„“âˆand Ï€0 = 1. Clearly, this model class includes our
model with d + 1 traded assets as a special case.
Our ï¬rst observation is that the implication â‡of Theorem 1.6 remains valid, i.e.,
the existence of a measure P âˆ—â‰ˆP with the properties
Eâˆ—[ âˆ¥Sâˆ¥âˆ] < âˆ
and
Eâˆ—

Si
1 + r

= Ï€i
implies the absence of arbitrage opportunities. To this end, suppose that Î¾ is a portfolio
strategy such that
Î¾ Â· S â‰¥0 P -a.s.
and
E[ Î¾ Â· S ] > 0.
(1.9)
Then we can replace P in (1.9) by the equivalent measure P âˆ—. Hence, Î¾ cannot be an
arbitrage opportunity since
Î¾ Â· Ï€ =
âˆ

i=0
Î¾iEâˆ—

Si
1 + r

= Eâˆ—
 Î¾ Â· S
1 + r

> 0.
Note that interchanging summation and integration is justiï¬ed by dominated conver-
gence, because
Î¾0 + âˆ¥Sâˆ¥âˆ
âˆ

i=0
|Î¾i| âˆˆL1(P âˆ—).
The following example shows that the implication â‡’of Theorem 1.6, namely that
absence of arbitrage opportunities implies the existence of a risk-neutral measure, may
no longer be true in an inï¬nite market model.
â™¦
Example 1.18. Let  = {1, 2, . . . }, and choose any probability measure P which
assigns strictly positive probability to all singletons {Ï‰}. We take r = 0 and deï¬ne a
price system Ï€i = 1, for i = 0, 1, . . . . Prices at time 1 are given by S0 â‰¡1 and, for
i = 1, 2, . . . , by
Si(Ï‰) =
ï£±
ï£´ï£²
ï£´ï£³
0
if Ï‰ = i,
2
if Ï‰ = i + 1,
1
otherwise.
Let us show that this market model is arbitrage-free. To this end, suppose that Î¾ =
(Î¾0, Î¾) is a portfolio such that Î¾ âˆˆâ„“1 and such that Î¾ Â· S(Ï‰) â‰¥0 for each Ï‰ âˆˆ, but
such that Ï€ Â· Î¾ â‰¤0. Considering the case Ï‰ = 1 yields
0 â‰¤Î¾ Â· S(1) = Î¾0 +
âˆ

k=2
Î¾k = Ï€ Â· Î¾ âˆ’Î¾1 â‰¤âˆ’Î¾1.

14
1 Arbitrage theory
Similarly, for Ï‰ = i > 1,
0 â‰¤Î¾ Â· S(Ï‰) = Î¾0 + 2Î¾iâˆ’1 +
âˆ

k=1
kÌ¸=i,iâˆ’1
Î¾k = Ï€ Â· Î¾ + Î¾iâˆ’1 âˆ’Î¾i â‰¤Î¾iâˆ’1 âˆ’Î¾i.
It follows that 0 â‰¥Î¾1 â‰¥Î¾2 â‰¥Â· Â· Â· . But this can only be true if all Î¾i vanish, since we
have assumed that Î¾ âˆˆâ„“1. Hence, there are no arbitrage opportunities.
However, there exists no probability measure P âˆ—â‰ˆP such that Eâˆ—[ Si ] = Ï€i for
all i. Such a measure P âˆ—would have to satisfy
1 = Eâˆ—[Si ] = 2P âˆ—[{i + 1}] +
âˆ

k=1
kÌ¸=i,i+1
P âˆ—[{k} ]
= 1 + P âˆ—[{i + 1}] âˆ’P âˆ—[{i}]
for i > 1. This relation implies that P âˆ—[ {i} ] = P âˆ—[ {i+1} ] for all i > 1, contradicting
the assumption that P âˆ—is a probability measure and equivalent to P .
â™¦
1.3 Derivative securities
In real ï¬nancial markets, not only the primary assets are traded. There is also a large
variety of securities whose payoff depends in a non-linear way on the primary assets
S0, S1, . . . , Sd, and sometimes also on other factors. Such ï¬nancial instruments are
usually called derivative securities, options, or contingent claims.
Example 1.19. Under a forward contract, one agent agrees to sell to another agent an
asset at time 1 for a price K which is speciï¬ed at time 0. Thus, the owner of a forward
contract on the ith asset gains the difference between the actual market price Si and
the delivery price K if Si is larger than K at time 1. If Si < K, the owner loses
the amount K âˆ’Si to the issuer of the forward contract. Hence, a forward contract
corresponds to the random payoff
Cfw = Si âˆ’K.
â™¦
Example 1.20. The owner of a call option on the ith asset has the right, but not the
obligation, to buy the ith asset at time 1 for a ï¬xed price K, called the strike price.
This corresponds to a payoff of the form
Ccall = (Si âˆ’K)+ =

Si âˆ’K
if Si > K,
0
otherwise.

1.3 Derivative securities
15
Conversely, a put option gives the right, but not the obligation, to sell the asset at time
1 for a strike price K. The corresponding random payoff is given by
Cput = (K âˆ’Si)+ =

K âˆ’Si
if Si < K,
0
otherwise.
Call and put options with the same strike K are related through the formula
Ccall âˆ’Cput = Si âˆ’K.
Hence, if the price Ï€(Ccall) of a call option has already been ï¬xed, then the price
Ï€(Cput) of the corresponding put option is determined by linearity through the put-
call parity
Ï€(Ccall) = Ï€(Cput) + Ï€i âˆ’
K
1 + r .
(1.10)
â™¦
Example 1.21. An option on the value V = Î¾ Â· S of a portfolio of several risky assets
is sometimes called a basket or index option. For instance, a basket call would be of
the form (V âˆ’K)+.
â™¦
Put and call options can be used as building blocks for a large class of derivatives.
Example 1.22. A straddle is a combination of â€œat-the-money" put and call options
on a portfolio V = Î¾ Â· S, i.e., on put and call options with strike K = Ï€(V ):
C = (Ï€(V ) âˆ’V )+ + (V âˆ’Ï€(V ))+ = |V âˆ’Ï€(V )|.
Thus, the payoff of the straddle increases proportionally to the change of the price of
Î¾ between time 0 and time 1. In this sense, a straddle is a bet that the portfolio price
will move, no matter in which direction.
â™¦
Example 1.23. The payoff of a butterï¬‚y spread is of the form
C =

K âˆ’|V âˆ’Ï€(V )|
+,
where K > 0 and where V = Î¾ Â· S is the price of a given portfolio or the value of
a stock index. Clearly, the payoff of the butterï¬‚y spread is maximal if V = Ï€(V )
and decreases if the price at time 1 of the portfolio Î¾ deviates from its price at time 0.
Thus, the butterï¬‚y spread is a bet that the portfolio price will stay close to its present
value. By letting KÂ± := Ï€(V ) Â± K, we can represent C as combinations of call or
put options on V :
C = (V âˆ’Kâˆ’)+ âˆ’2(V âˆ’Ï€(V ))+ + (V âˆ’K+)+
= âˆ’(Kâˆ’âˆ’V )+ + 2(Ï€(V ) âˆ’V )+ âˆ’(K+ âˆ’V )+.
â™¦

16
1 Arbitrage theory
Example 1.24. The idea of portfolio insurance is to increase exposure to rising asset
prices, and to reduce exposure to falling prices. This suggests to replace the payoff
V = Î¾ Â· S of a given portfolio by a modiï¬ed proï¬le h(V ), where h is convex and
increasing. Let us ï¬rst consider the case where V â‰¥0. Then the corresponding
payoff h(V ) can be expressed as a combination of investments in bonds, in V it-
self, and in basket call options on V . To see this, recall that convexity implies that
h(x) = h(0) +
 x
0 hâ€²(y) dy for the increasing right-hand derivative hâ€² := hâ€²
+ of h;
see Appendix A.1. Note that hâ€² can be represented as the distribution function of a
positive Radon measure Î³ on [0, âˆ): hâ€²(x) = Î³ ([0, x]) for x â‰¥0. Hence, Fubiniâ€™s
theorem implies that
h(x) = h(0) +
 x
0

[0,y]
Î³ (dz) dy
= h(0) + Î³ ({0}) x +

(0,âˆ)

{y | zâ‰¤yâ‰¤x}
dy Î³ (dz).
Since the inner integral equals (x âˆ’z)+, we obtain
h(V ) = h(0) + hâ€²(0) V +

(0,âˆ)
(V âˆ’z)+ Î³ (dz).
(1.11)
The payoff V = Î¾ Â· S may take negative values if the portfolio Î¾ contains also
short positions. In this case, the increasing convex function h must be deï¬ned on all
of R. Its right-hand derivative hâ€² can be represented as
hâ€²(y) âˆ’hâ€²(x) = Î³

(x, y]

,
x < y,
for a positive Radon measure Î³ on R. Looking separately at the cases x < 0 and
x â‰¥0, we see that
h(x) = h(0) + hâ€²(0) x +

(0,âˆ)
(x âˆ’z)+ Î³ (dz) +

(âˆ’âˆ,0]
(z âˆ’x)+ Î³ (dz).
Thus, the payoff h(V ) can be realized by holding bonds, shares in V , and a mixture
of call and put options on V :
h(V ) = h(0) + hâ€²(0) V +

(0,âˆ)
(V âˆ’z)+ Î³ (dz) +

(âˆ’âˆ,0]
(z âˆ’V )+ Î³ (dz).
â™¦
Example 1.25. A reverse convertible bond pays interest which is higher than that
earned by an investment into the riskless bond. But at maturity t = 1, the issuer may
convert the bond into a predetermined number of shares of a given asset Si instead
of paying the nominal value in cash. The purchase of this contract is equivalent to
the purchase of a standard bond and the sale of a certain put option. More precisely,
suppose that 1 is the price of the reverse convertible bond at t = 0, that its nominal

1.3 Derivative securities
17
value at maturity is 1 +r, and that it can be converted into x shares of the ith asset.
This conversion will happen if the asset price Si is below K := (1 +r)/x. Thus, the
payoff of the reverse convertible bond is equal to
1 +r âˆ’x(K âˆ’Si)+,
i.e., the purchase of this contract is equivalent to a risk-free investment of 1 with
interest r and the sale of the put option x(K âˆ’Si)+ for the price (r âˆ’r)/(1 + r). â™¦
Example 1.26. A discount certiï¬cate on V = Î¾ Â· S pays off the amount
C = V âˆ§K,
where the number K > 0 is often called the cap. Since
C = V âˆ’(V âˆ’K)+,
buying the discount certiï¬cate is the same as purchasing Î¾ and selling the basket call
option Ccall := (V âˆ’K)+. If the price Ï€(Ccall) has already been ï¬xed, then the price
of C is given by Ï€(C) = Ï€(V ) âˆ’Ï€(Ccall). Hence, the discount certiï¬cate is less
expensive than the portfolio Î¾ itself, and this explains the name. On the other hand, it
participates in gains of Î¾ only up to the cap K.
â™¦
Example 1.27. For an insurance company, it may be desirable to shift some of its
insurance risk to the ï¬nancial market. As an example of such an alternative risk
transfer, consider a catastrophe bond issued by an insurance company. The interest
paid by this security depends on the occurrence of certain special events. For instance,
the contract may specify that no interest will be paid if more than a given number of
insured cars are damaged by hail on a single day during the lifetime of the contract; as
a compensation for taking this risk, the buyer will be paid an interest above the usual
market rate if this event does not occur.
â™¦
Mathematically, it will be convenient to focus on contingent claims whose payoff
is non-negative. Such a contingent claim will be interpreted as a contract which is
sold at time 0 and which pays a random amount C(Ï‰) â‰¥0 at time 1. A derivative
security whose terminal value may also become negative can usually be reduced to a
combination of a non-negative contingent claim and a short position in some of the
primary assets S0, S1, . . . , Sd. For instance, the terminal value of a reverse convertible
bond is bounded from below so that it can be decomposed into a short position in cash
and into a contract with positive value. From now on, we will work with the following
formal deï¬nition of the term â€œcontingent claimâ€.
Deï¬nition 1.28. A contingent claim is a random variable C on the underlying prob-
ability space (, F , P) such that
0 â‰¤C < âˆ
P -a.s.

18
1 Arbitrage theory
A contingent claim C is called a derivative of the primary assets S0, . . . , Sd if it is
measurable with respect to the Ïƒ-ï¬eld Ïƒ(S0, . . . , Sd) generated by the assets, i.e., if
C = f (S0, . . . , Sd)
for a measurable function f on Rd+1.
So far, we have only ï¬xed the prices Ï€i of our primary assets Si. Thus, it is not
clear what the correct price should be for a general contingent claim C. Our main
goal in this section is to identify those possible prices which are compatible with the
given prices in the sense that they do not generate arbitrage. Our approach is based
on the observation that trading C at time 0 for a price Ï€C corresponds to introducing
a new asset with the prices
Ï€d+1 := Ï€C
and
Sd+1 := C.
(1.12)
Deï¬nition 1.29. A real number Ï€C â‰¥0 is called an arbitrage-free price of a contin-
gent claim C if the market model extended according to (1.12) is arbitrage-free. The
set of all arbitrage-free prices for C is denoted (C).
In the previous deï¬nition, we made the implicit assumption that the introduction
of a contingent claim C as a new asset does not affect the prices of primary assets.
This assumption is reasonable as long as the trading volume of C is small compared
to that of the primary assets. In Section 3.4 we will discuss the equilibrium approach
to asset pricing, where an extension of the market will typically change the prices of
all traded assets.
The following result shows in particular that we can always ï¬nd an arbitrage-free
price for a given contingent claim C if the initial model is arbitrage-free.
Theorem 1.30. Suppose that the set P of equivalent risk-neutral measures for the
original market model is non-empty. Then the set of arbitrage-free prices of a contin-
gent claim C is non-empty and given by
(C) =

Eâˆ—

C
1 + r
  P âˆ—âˆˆP such that Eâˆ—[ C ] < âˆ

.
(1.13)
Proof. By Theorem 1.6, Ï€C is an arbitrage-free price for C if and only if there exists
an equivalent risk-neutral measure Ë†P for the market model extended via (1.12), i.e.,
Ï€i = Ë†E

Si
1 + r

for i = 1, . . . , d + 1.
In particular, Ë†P is necessarily contained in P, and we obtain the inclusion âŠ†in (1.13).
Conversely, if Ï€C = Eâˆ—[ C/(1 + r) ] for some P âˆ—âˆˆP , then this P âˆ—is also an
equivalent risk-neutral measure for the extended market model, and so the two sets in
(1.13) are equal.

1.3 Derivative securities
19
To show that (C) is non-empty, we ï¬rst ï¬x some measure 
P â‰ˆP such that

E[ C ] < âˆ. For instance, we can take d 
P = c(1 + C)âˆ’1 dP , where c is the nor-
malizing constant. Under 
P , the market model is arbitrage-free. Hence, Theorem 1.6
yields P âˆ—âˆˆP such that dP âˆ—/d 
P is bounded. In particular, Eâˆ—[ C ] < âˆand
Ï€C = Eâˆ—[ C/(1 + r) ] âˆˆ(C).
The following theorem provides a dual characterization of the lower and upper
bounds
Ï€inf(C) := inf (C)
and
Ï€sup(C) := sup (C),
which are often called arbitrage bounds for C.
Theorem 1.31. In an arbitrage-free market model, the arbitrage bounds of a contin-
gent claim C are given by
Ï€inf(C) = inf
P âˆ—âˆˆP Eâˆ— 
C
1 + r
!
= max
$
m âˆˆ[0, âˆ)
 âˆƒÎ¾ âˆˆRd with m + Î¾ Â· Y â‰¤
C
1 + r P -a.s.
%
and
Ï€sup(C) = sup
P âˆ—âˆˆP
Eâˆ— 
C
1 + r
!
= min
$
m âˆˆ[0, âˆ]
 âˆƒÎ¾ âˆˆRd with m + Î¾ Â· Y â‰¥
C
1 + r P -a.s.
%
.
Proof. We only prove the identities for the upper arbitrage bound. The ones for the
lower bound are obtained in a similar manner. We take m âˆˆ[0, âˆ] and Î¾ âˆˆRd such
that m + Î¾ Â· Y â‰¥C/(1 + r) P -a.s., and we denote by M the set of all such m. Taking
the expectation with P âˆ—âˆˆP yields m â‰¥Eâˆ—[ C/(1 + r) ], and we get
inf M â‰¥sup
P âˆ—âˆˆP
Eâˆ— 
C
1 + r
!
â‰¥sup
$
Eâˆ— 
C
1 + r
!  P âˆ—âˆˆP , Eâˆ—[ C ] < âˆ
%
= Ï€sup(C),
(1.14)
where we have used Theorem 1.30 in the last identity.
Next we show that all inequalities in (1.14) are in fact identities. This is trivial if
Ï€sup(C) = âˆ. For Ï€sup(C) < âˆ, we will show that m > Ï€sup(C) implies m â‰¥inf M.
By deï¬nition, Ï€sup(C) < m < âˆrequires the existence of an arbitrage opportunity
in the market model extended by Ï€d+1 := m and Sd+1 := C. That is, there is
(Î¾, Î¾d+1) âˆˆRd+1 such that Î¾ Â· Y + Î¾d+1(C/(1 + r) âˆ’m) is almost-surely non-
negative and strictly positive with positive probability.
Since the original market

20
1 Arbitrage theory
model is arbitrage-free, Î¾d+1 must be non-zero. In fact, we have Î¾d+1 < 0 as taking
expectations with respect to P âˆ—âˆˆP for which Eâˆ—[ C ] < âˆyields
Î¾d+1	
Eâˆ— 
C
1 + r
!
âˆ’m

â‰¥0,
and the term in parenthesis is negative since m > Ï€sup(C). Thus, we may deï¬ne
Î¶ := âˆ’Î¾/Î¾d+1 âˆˆRd and obtain m + Î¶ Â· Y â‰¥C/(1 + r) P-a.s., hence m â‰¥inf M.
We now prove that the inï¬mum of M is in fact attained. To this end, we may
assume without loss of generality that inf M < âˆand that the market model is non-
redundant in the sense of Deï¬nition 1.13. For a sequence mn âˆˆM that decreases
towards inf M = Ï€sup(C), we ï¬x Î¾n âˆˆRd such that mn +Î¾n Â·Y â‰¥C/(1+r) P -almost
surely. If lim infn |Î¾n| < âˆ, there exists a subsequence of (Î¾n) that converges to some
Î¾ âˆˆRd. Passing to the limit yields Ï€sup(C) + Î¾ Â· Y â‰¥C/(1 + r) P -a.s., which gives
Ï€sup(C) âˆˆM. But this is already the desired result, since the following argument will
show that the case lim infn |Î¾n| = âˆcannot occur. Indeed, after passing to some
subsequence if necessary, Î·n := Î¾n/|Î¾n| converges to some Î· âˆˆRd with |Î·| = 1.
Under the assumption that |Î¾n| â†’âˆ, passing to the limit in
Ï€sup(C)
|Î¾n|
+ Î·n Â· Y â‰¥
C
|Î¾n|(1 + r)
P -a.s.
yields Î· Â·Y â‰¥0. The absence of arbitrage opportunities thus implies Î· Â·Y = 0 P -a.s.,
whence Î· = 0 by non-redundance of the model. But this contradicts the fact that
|Î·| = 1.
Remark 1.32. Theorem 1.31 shows that Ï€sup(C) is the lowest possible price of a
portfolio Î¾ with
Î¾ Â· S â‰¥C
P -a.s.
Such a portfolio is often called a â€œsuperhedging strategyâ€ or â€œsuperreplicationâ€ of C,
and the identities for Ï€inf(C) and Ï€sup(C) obtained in Theorem 1.31 are often called
superhedging duality relations. When using Î¾, the seller of C would be protected
against any possible future claims of the buyer of C. Thus, a natural goal for the seller
would be to ï¬nance such a superhedging strategy from the proceeds of C. Conversely,
the objective of the buyer would be to cover the price of C from the sale of a portfolio
Î· with
Î· Â· S â‰¤C
P-a.s.,
which is possible if and only if Ï€ Â· Î· â‰¤Ï€inf(C). Unless C is an attainable payoff,
however, neither objective can be fulï¬lled by trading C at an arbitrage-free price, as
shown in Corollary 1.34 below. Thus, any arbitrage-free price involves a trade-off
between these two objectives.
â™¦
For a portfolio Î¾ the resulting payoff V = Î¾ Â· S, if positive, may be viewed as
a contingent claim, and in particular as a derivative. Those claims which can be
replicated by a suitable portfolio will play a special role in the sequel.

1.3 Derivative securities
21
Deï¬nition 1.33. A contingent claim C is called attainable (replicable, redundant) if
C = Î¾ Â· S P -a.s. for some Î¾ âˆˆRd+1. Such a portfolio strategy Î¾ is then called a
replicating portfolio for C.
If one can show that a given contingent claim C can be replicated by some portfolio
Î¾, then the problem of determining a price for C has a straightforward solution: The
price of C is unique and equal to the cost Î¾ Â· Ï€ of its replication, due to the law of one
price. The following corollary also shows that the attainable contingent claims are in
fact the only ones for which admit a unique arbitrage-free price.
Corollary 1.34. Suppose the market model is arbitrage-free and C is a contingent
claim.
(a) C is attainable if and only if it admits a unique arbitrage-free price.
(b) If C is not attainable, then Ï€inf(C) < Ï€sup(C) and
(C) =

Ï€inf(C), Ï€sup(C)

.
Proof. Clearly |(C)| = 1 if C is attainable, and so assertion (a) is implied by (b).
In order to prove part (b), note ï¬rst that (C) is non-empty and convex due to
the convexity of P. Hence (C) is an interval. To show that this interval is open, it
sufï¬ces to exclude the possibility that it contains one of its boundary points Ï€inf(C)
and Ï€sup(C). To this end, we use Theorem 1.31 to get Î¾ âˆˆRd such that
Ï€inf(C) + Î¾ Â· Y â‰¤
C
1 + r
P -a.s.
Since C is not attainable, this inequality cannot be an almost-sure identity. Hence, with
Î¾0 := âˆ’(1 + r)Ï€inf(C), the strategy (Î¾0, âˆ’Î¾, 1) âˆˆRd+2 is an arbitrage opportunity in
the market model extended by Ï€d+1 := Ï€inf(C) and Sd+1 := C, so that Ï€inf(C) is not
an arbitrage-free price for C. The possibility Ï€sup(C) âˆˆ(C) is excluded by a similar
argument.
Remark 1.35. In Theorem 1.31, the set P of equivalent risk-neutral measures can be
replaced by the set 
P of risk-neutral measures that are merely absolutely continuous
with respect to P . That is,
Ï€inf(C) = inf

P âˆˆ
P

E
 
C
1 + r
!
and
Ï€sup(C) = sup

P âˆˆ
P

E
 
C
1 + r
!
,
(1.15)
for any contingent claim C. To prove this, note ï¬rst that P âŠ‚
P , so that we get the
two inequalities â€œâ‰¥" and â€œâ‰¤" in (1.15). On the other hand, for any 
P âˆˆ
P , arbitrary
P âˆ—âˆˆP and Îµ âˆˆ(0, 1], the measure P âˆ—
Îµ := ÎµP âˆ—+(1âˆ’Îµ)
P belongs to P and satisï¬es
Eâˆ—
Îµ [ C ] = ÎµEâˆ—[ C ]+(1âˆ’Îµ)
E[ C ]. Sending Îµ â†“0 yields the converse inequalities. â™¦

22
1 Arbitrage theory
Remark 1.36. Consider any arbitrage-free market model, and let Ccall = (Si âˆ’K)+
be a call option on the ith asset with strike K > 0. Clearly, Ccall â‰¤Si so that
Eâˆ—
 Ccall
1 + r

â‰¤Ï€i
for any P âˆ—âˆˆP . From Jensenâ€™s inequality, we obtain the following lower bound:
Eâˆ—
 Ccall
1 + r

â‰¥

Eâˆ—

Si
1 + r

âˆ’
K
1 + r
+
=

Ï€i âˆ’
K
1 + r
+
.
Thus, the following universal bounds hold for any arbitrage-free market model:

Ï€i âˆ’
K
1 + r
+
â‰¤Ï€inf

Ccall
â‰¤Ï€sup

Ccall
â‰¤Ï€i.
(1.16)
For a put option Cput = (K âˆ’Si)+, one obtains the universal bounds
 K
1 + r âˆ’Ï€i
+
â‰¤Ï€inf

Cput
â‰¤Ï€sup

Cput
â‰¤
K
1 + r .
(1.17)
If r â‰¥0, then the lower bound in (1.16) can be further reduced to Ï€inf

Ccall
â‰¥
(Ï€i âˆ’K)+. Informally, this inequality states that the value of the right to buy the
ith asset at t = 0 for a price K is strictly less than any arbitrage-free price for Ccall.
This fact is sometimes expressed by saying that the time value of a call option is
non-negative. The quantity (Ï€i âˆ’K)+ is called the intrinsic value of the call option.
Observe that an analogue of this relation usually fails for put options: The left-hand
side of (1.17) can only be bounded by its intrinsic value (K âˆ’Ï€i)+ if r â‰¤0. If the
intrinsic value of a put or call option is positive, then one says that the option is â€œin the
money". For Ï€i = K one speaks of an â€œat-the-money" option. Otherwise, the option
is â€œout of the money".
â™¦
In many situations, the universal arbitrage bounds (1.16) and (1.17) are in fact
attained, as illustrated by the following example.
Example 1.37. Take any market model with a single risky asset S = S1 such that
the distribution of S under P is concentrated on {0, 1, . . . , } with positive weights.
Without loss of generality, we may assume that S has under P a Poisson distribution
with parameter 1, i.e., S is P -a.s. integer-valued and
P [ S = k ] = eâˆ’1
k!
for k = 0, 1, . . . .
If we take r = 0 and Ï€ = 1, then P is a risk-neutral measure and the market model
is arbitrage-free. We are going to show that the upper and lower bounds in (1.16)

1.4 Complete market models
23
are attained for this model by using Remark 1.35. To this end, consider the measure

P âˆˆ
P which is deï¬ned by its density
d 
P
dP = e Â· I{S=1} .
We get

E[ (S âˆ’K)+ ] = (1 âˆ’K)+ = (Ï€ âˆ’K)+,
so that the lower bound in (1.16) is attained, i.e., we have
Ï€inf

(S âˆ’K)+
= (Ï€ âˆ’K)+.
To see that also the upper bound is sharp, we deï¬ne
gn(k) :=

e âˆ’e
n

Â· I{0}(k) + (n âˆ’1)! Â· e Â· I{n}(k),
k = 0, 1, . . .
It is straightforward to check that
d 
Pn := gn(S) dP
deï¬nes a measure 
Pn âˆˆ
P such that

En[ (S âˆ’K)+ ] =

1 âˆ’K
n
+
.
By sending n â†‘âˆ, we see that also the upper bound in (1.16) is attained:
Ï€sup

(S âˆ’K)+
= Ï€.
Furthermore, the put-call parity (1.10) shows that the universal bounds (1.17) for put
options are attained as well.
â™¦
1.4 Complete market models
Our goal in this section is to characterize the particularly transparent situation in which
all contingent claims are attainable.
Deï¬nition 1.38. Anarbitrage-freemarketmodeliscalledcompleteifeverycontingent
claim is attainable.
In every market model, the following inclusion holds for each P âˆ—âˆˆP :
V =

Î¾ Â· S | Î¾ âˆˆRd+1 
âŠ†L1
, Ïƒ(S1, . . . , Sd), P âˆ—
âŠ†L0(, F , P âˆ—) = L0(, F , P );

24
1 Arbitrage theory
see Appendix A.7 for the deï¬nition of Lp-spaces. If the market is complete then all of
these inclusions are in fact equalities. In particular, F coincides with Ïƒ(S1, . . . , Sd)
modulo P-null sets, and every contingent claim coincides P -a.s. with a derivative of
the traded assets. Since the linear space V is ï¬nite-dimensional, it follows that the
same must be true of L0(, F , P). But this means that the model can be reduced to
a ï¬nite number of relevant scenarios. This observation can be made precise by using
the notion of an atom of the probability space (, F , P ). Recall that a set A âˆˆF is
called an atom of (, F , P), if P [ A ] > 0 and if each B âˆˆF with B âŠ†A satisï¬es
either P [ B ] = 0 or P [ B ] = P [ A ].
Proposition 1.39. Foranyp âˆˆ[0, âˆ], thedimensionofthelinearspaceLp(, F , P )
is given by
dim Lp(, F , P)
(1.18)
= sup

n âˆˆN | âˆƒpartition A1, . . . , An of  with Ai âˆˆF and P [ Ai ] > 0

.
Moreover, n := dim Lp(, F , P) < âˆif and only if there exists a partition of 
into n atoms of (, F , P).
Proof. Suppose that there is a partition A1, . . . , An of  such that Ai âˆˆF and
P[ Ai ] > 0. The corresponding indicator functions IA1, . . . , IAn can be regarded as
linearly independent vectors in Lp := Lp(, F , P ). Thus dim Lp â‰¥n. Conse-
quently, it sufï¬ces to consider only the case in which the right-hand side of (1.18) is a
ï¬nite number, n0. If A1, . . . , An0 is a corresponding partition, then each Ai is an atom
because otherwise n0 would not be maximal. Thus, any Z âˆˆLp is P -a.s. constant on
each Ai. If we denote the value of Z on Ai by zi, then
Z =
n0

i=1
zi IAi
P -a.s.
Hence, the indicator functions IA1, . . . , IAn0 form a basis of Lp, and this implies
dim Lp = n0.
Theorem 1.40. An arbitrage-free market model is complete if and only if there ex-
ists exactly one risk-neutral probability measure, i.e., if |P | = 1.
In this case,
dim L0(, F , P) â‰¤d + 1.
Proof. If the model is complete, then the indicator IA of each set A âˆˆF is an
attainable contingent claim. Hence, Corollary 1.34 implies that P âˆ—[ A ] = Eâˆ—[ IA ]
is independent of P âˆ—âˆˆP. Consequently, there is just one risk-neutral probability
measure.
Conversely, suppose that P = {P âˆ—}, and let C be a bounded contingent claim, so
that Eâˆ—[ C ] < âˆ. Then C has the unique arbitrage-free price Eâˆ—[ C/(1 + r) ], and

1.4 Complete market models
25
Corollary 1.34 implies that C is attainable. It follows that Lâˆ(, F , P ) is contained
in the linear space V of all possible portfolio values. This implies that
dim Lâˆ(, F , P) â‰¤dim V â‰¤d + 1.
Hence, we conclude from Proposition 1.39 that (, F , P ) has at most d + 1 atoms.
But then every contingent claim must be bounded and, in turn, attainable.
Example 1.41. Consider the simple situation where the sample space  consists of
two elements Ï‰+ and Ï‰âˆ’, and where the measure P is such that
p := P [ {Ï‰+} ] âˆˆ(0, 1).
We assume that there is one single risky asset, which takes at time t = 1 the two values
b and a with the respective probabilities p and 1 âˆ’p, where a and b are such that
0 â‰¤a < b:
Ï€
S(Ï‰+) = b
S(Ï‰âˆ’) = a

*
p
HHHHHH
j
1 âˆ’p
This model does not admit arbitrage if and only if
Ï€(1 + r) âˆˆ

E[ S ] | 
P â‰ˆP

=
p b + (1 âˆ’p)a | p âˆˆ(0, 1)

= (a, b);
(1.19)
see also Example 1.8. In this case, the model is also complete: Any risk-neutral
measure P âˆ—must satisfy
Ï€(1 + r) = Eâˆ—[ S ] = pâˆ—b + (1 âˆ’pâˆ—)a,
and this condition uniquely determines the parameter pâˆ—= P âˆ—[ {Ï‰+} ] as
pâˆ—= Ï€(1 + r) âˆ’a
b âˆ’a
âˆˆ(0, 1).
Hence |P | = 1, and completeness follows from Theorem 1.40. Alternatively, we can
directly verify completeness by showing that a given contingent claim C is attainable
if (1.19) holds. Observe that the condition
C(Ï‰) = Î¾0 S0(Ï‰) + Î¾ S(Ï‰) = Î¾0(1 + r) + Î¾ S(Ï‰)
for all Ï‰ âˆˆ
is a system of two linear equations for the two real variables Î¾0 and Î¾. The solution is
given by
Î¾ = C(Ï‰+) âˆ’C(Ï‰âˆ’)
b âˆ’a
and
Î¾0 = C(Ï‰âˆ’)b âˆ’C(Ï‰+)a
(b âˆ’a)(1 + r)
.

26
1 Arbitrage theory
Therefore, the unique arbitrage-free price of C is
Ï€(C) = Ï€ Â· Î¾ = C(Ï‰+)
1 + r Â· Ï€(1 + r) âˆ’a
b âˆ’a
+ C(Ï‰âˆ’)
1 + r Â· b âˆ’Ï€(1 + r)
b âˆ’a
.
For a call option C = (S âˆ’K)+ with strike K âˆˆ[a, b], we have
Ï€

(S âˆ’K)+
= b âˆ’K
b âˆ’a Â· Ï€ âˆ’(b âˆ’K)a
b âˆ’a
Â·
1
1 + r .
(1.20)
Note that this price is independent of p and increasing in r, while the classical dis-
counted expectation with respect to the â€œobjectiveâ€ measure P ,
E

C
1 + r

= p(b âˆ’K)
1 + r
,
is decreasing in r and increasing in p.
In this example, one can illustrate how options can be used to modify the risk of a
position. Consider the particular case in which the risky asset can be bought at time
t = 0 for the price Ï€ = 100. At time t = 1, the price is either S(Ï‰+) = b = 120 or
S(Ï‰âˆ’) = a = 90, both with positive probability. If we invest in the risky asset, the
corresponding returns are given by
R(S)(Ï‰+) = +20%
or
R(S)(Ï‰âˆ’) = âˆ’10%.
Now consider a call option C := (S âˆ’K)+ with strike K = 100. Choosing r = 0,
the price of the call option is
Ï€(C) = 20
3 â‰ˆ6.67
from formula (1.20). Hence the return
R(C) = (S âˆ’K)+ âˆ’Ï€(C)
Ï€(C)
on the initial investment Ï€(C) equals
R(C)(Ï‰+) = 20 âˆ’Ï€(C)
Ï€(C)
= +200%
or
R(C)(Ï‰âˆ’) = 0 âˆ’Ï€(C)
Ï€(C)
= âˆ’100%,
according to the outcome of the market at time t = 1. Here we see a dramatic increase
of both proï¬t opportunity and risk; this is sometimes referred to as the leverage effect
of options.

1.5 Geometric characterization of arbitrage-free models
27
On the other hand, we could reduce the risk of holding the asset by holding a
combination

C := (K âˆ’S)+ + S
of a put option and the asset itself. This â€œportfolio insuranceâ€ will of course involve an
additional cost. If we choose our parameters as above, then the put-call parity (1.10)
yields that the price of the put option (K âˆ’S)+ is equal to 20/3. Thus, in order to
hold both S and a put, we must invest the capital 100 + 20/3 at time t = 0. At time
t = 1, we have an outcome of either 120 or of 100 so that the return of 
C is given by
R(
C)(Ï‰+) = +12.5%
and
R(
C)(Ï‰âˆ’) = âˆ’6.25%.
â™¦
1.5 Geometric characterization of arbitrage-free models
The â€œfundamental theorem of asset pricingâ€ in the form of Theorem 1.6 states that a
market model is arbitrage-free if and only if the origin is contained in the set
Mb(Y, P ) :=
$
EQ[ Y ]
 Q â‰ˆP, dQ
dP is bounded, EQ[ |Y| ] < âˆ
%
âŠ‚Rd,
where Y = (Y 1, . . . , Y d) is the random vector of discounted net gains deï¬ned in (1.2).
The aim of this section is to give a geometric description of the set Mb(Y, P ) as well
as of the larger set
M(Y, P) :=

EQ[ Y ] | Q â‰ˆP, EQ[ |Y| ] < âˆ

.
To this end, it will be convenient to work with the distribution
Âµ := P â—¦Y âˆ’1
of Y with respect to P . That is, Âµ is a Borel probability measure on Rd such that
Âµ(A) = P [ Y âˆˆA ]
for each Borel set A âŠ‚Rd.
If Î½ is a Borel probability measure on Rd such that

|y| Î½(dy) < âˆ, we will call

y Î½(dy) its barycenter.
Lemma 1.42. We have
Mb(Y, P ) = Mb(Âµ) :=
 
y Î½(dy)
 Î½ â‰ˆÂµ, dÎ½
dÂµ is bounded,

|y| Î½(dy) < âˆ

,
and
M(Y, P) = M(Âµ) :=
 
y Î½(dy)
 Î½ â‰ˆÂµ,

|y| Î½(dy) < âˆ

.

28
1 Arbitrage theory
Proof. If Î½ â‰ˆÂµ is a Borel probability measure on Rd, then the Radonâ€“Nikodym
derivativeofÎ½ withrespecttoÂµevaluatedattherandomvariableY deï¬nesaprobability
measure Q â‰ˆP on (, F ):
dQ
dP (Ï‰) := dÎ½
dÂµ

Y(Ï‰)

.
Clearly, EQ[ Y ] =

y Î½(dy). This shows that M(Âµ) âŠ†M(Y, P ) and Mb(Âµ) âŠ†
Mb(Y, P ).
Conversely, if 
Q is a given probability measure on (, F ) which is equivalent
to P , then the Radonâ€“Nikodym theorem in Appendix A.2 shows that the distribution
Î½ := 
Q â—¦Y âˆ’1 must be equivalent to Âµ, whence M(Y, P ) âŠ†M(Âµ). Moreover,
it follows from Proposition A.11 that the density dÎ½/dÂµ is bounded if d 
Q/dP is
bounded, and so Mb(Y, P ) âŠ†Mb(Âµ) also follows.
By the above lemma, the characterization of the two sets Mb(Y, P ) and M(Y, P )
is reduced to a problem for Borel probability measures on Rd. Here and in the sequel,
we do not need the fact that Âµ is the distribution of the lower bounded random vector Y
of discounted net gains; our results are true for arbitrary Âµ such that

|y| Âµ(dy) < âˆ;
see also Remark 1.7.
Deï¬nition 1.43. The support of a Borel probability measure Î½ on Rd is the smallest
closed set A âŠ‚Rd such that Î½(Ac) = 0, and it will be denoted by supp Î½.
The support of a measure Î½ can be obtained as the intersection of all closed sets A
with Î½(Ac) = 0, i.e.,
supp Î½ =

A closed
Î½(Ac)=0
A.
We denote by
(Âµ) := conv (supp Âµ)
=

n

k=1
Î±kyk
 Î±k â‰¥0,
n

k=1
Î±k = 1, yk âˆˆsupp Âµ, n âˆˆN

the convex hull of the support of Âµ. Thus, (Âµ) is the smallest convex set which
contains supp Âµ; see also Appendix A.1.
Example 1.44. Take d = 1, and consider the measure
Âµ = 1
2 (Î´âˆ’1 + Î´+1).
Clearly, the support of Âµ is equal to {âˆ’1, +1} and so (Âµ) = [âˆ’1, +1]. A measure
Î½ is equivalent to Âµ if and only if
Î½ = Î±Î´âˆ’1 + (1 âˆ’Î±)Î´+1
for some Î± âˆˆ(âˆ’1, +1). Hence, Mb(Âµ) = M(Âµ) = (âˆ’1, +1).
â™¦

1.5 Geometric characterization of arbitrage-free models
29
The previous example gives the correct intuition, namely that one always has the
inclusions
Mb(Âµ) âŠ‚M(Âµ) âŠ‚(Âµ).
But while the ï¬rst inclusion will turn out to be an identity, the second inclusion
is usually strict. Characterizing M(Âµ) in terms of (Âµ) will involve the following
concept:
Deï¬nition 1.45. The relative interior of a convex set C âŠ‚Rd is the set of all points
x âˆˆC such that for all y âˆˆC there exists some Îµ > 0 with
x âˆ’Îµ(y âˆ’x) âˆˆC.
The relative interior of C is denoted ri C.
If the convex set C has non-empty topological interior int C, then ri C = int C, and
the elementary properties of the relative interior collected in the following remarks
become obvious. This applies in particular to the set (Âµ) if the non-redundance
condition (1.8) is satisï¬ed. For the general case, proofs of these statements can be
found, for instance, in Â§6 of [166].
Remark 1.46. Let C be a non-empty convex subset of Rd, and consider the afï¬ne
hull aff C spanned by C, i.e., the smallest afï¬ne set which contains C. If we identify
aff C with some Rn, then the relative interior of C is equal to the topological interior
of C, considered as a subset of aff C âˆ¼= Rn. In particular, each non-empty convex set
has non-empty relative interior.
â™¦
Remark 1.47. Let C be a non-empty convex subset of Rd and denote by C its closure.
Then, if x âˆˆri C,
Î±x + (1 âˆ’Î±)y âˆˆri C
for all y âˆˆC and all Î± âˆˆ(0, 1].
(1.21)
In particular, ri C is convex. Moreover, the operations of taking the closure or the
relative interior of a convex set C are consistent with each other:
ri C = ri C
and
ri C = C.
(1.22)
â™¦
After these preparations, we can now state the announced geometric character-
ization of the set Mb(Âµ). Note that the proof of this characterization relies on the
â€œfundamental theorem of asset pricingâ€ in the form of Theorem 1.6.
Theorem 1.48. The set of all barycenters of probability measures Î½ â‰ˆÂµ coincides
with the relative interior of the convex hull of the support of Âµ. More precisely,
Mb(Âµ) = M(Âµ) = ri (Âµ).

30
1 Arbitrage theory
Proof. In a ï¬rst step, we show the inclusion ri (Âµ) âŠ†Mb(Âµ). Suppose we are given
m âˆˆri (Âµ). Let Âµ denote the translated measure
Âµ(A) := Âµ(A + m)
for Borel sets A âŠ‚Rd
where A + m := { x + m | x âˆˆA }. Then Mb(Âµ) = Mb(Âµ) âˆ’m, and analogous
identities hold for M(Âµ) and (Âµ). It follows that there is no loss of generality in
assuming that m = 0, i.e., we must show that 0 âˆˆMb(Âµ) if 0 âˆˆri (Âµ).
We claim that 0 âˆˆri (Âµ) implies the following â€œno-arbitrageâ€ condition:
If Î¾ âˆˆRd is such that Î¾ Â· y â‰¥0 for Âµ-a.e. y, then Î¾ Â· y = 0 for Âµ-a.e. y.
(1.23)
If (1.23) is false, then we can ï¬nd some Î¾ âˆˆRd such that Î¾ Â· y â‰¥0 for Âµ-a.e. y but
Âµ({y | Î¾ Â· y > Î´} ) > 0 for some Î´ > 0. In this case, the support of Âµ is contained in
the closed set { y | Î¾ Â· y â‰¥0 } but not in the hyperplane { y | Î¾ Â· y = 0 }. We conclude
that Î¾ Â· y â‰¥0 for all y âˆˆsupp Âµ and that there exists at least one yâˆ—âˆˆsupp Âµ such
that Î¾ Â· yâˆ—> 0. In particular, yâˆ—âˆˆ(Âµ) so that our assumption m = 0 âˆˆri (Âµ)
implies the existence of some Îµ > 0 such that âˆ’Îµyâˆ—âˆˆ(Âµ). Consequently, âˆ’Îµyâˆ—
can be represented as a convex combination
âˆ’Îµyâˆ—= Î±1y1 + Â· Â· Â· + Î±nyn
of certain y1, . . . , yn âˆˆsupp Âµ. It follows that
0 > âˆ’ÎµÎ¾ Â· yâˆ—= Î±1Î¾ Â· y1 + Â· Â· Â· + Î±nÎ¾ Â· yn,
in contradiction to our assumption that Î¾ Â· y â‰¥0 for all y âˆˆsupp Âµ. Hence, (1.23)
must be true.
Applying the â€œfundamental theorem of asset pricingâ€ in the form of Theorem 1.6 to
 := Rd, P := Âµ, and to the random variable Y(y) := y, yields a probability measure
Âµâˆ—â‰ˆÂµ whose density dÂµâˆ—/dÂµ is bounded and which satisï¬es

|y| Âµâˆ—(dy) < âˆ
and

y Âµâˆ—(dy) = 0. This proves the inclusion ri (Âµ) âŠ†Mb(Âµ).
Clearly, Mb(Âµ) âŠ‚M(Âµ). So the theorem will be proved if we can show the
inclusion M(Âµ) âŠ‚ri (Âµ). To this end, suppose by way of contradiction that Î½ â‰ˆÂµ
is such that

|y| Î½(dy) < âˆ
and
m :=

y Î½(dy) /âˆˆri (Âµ).
Again, we may assume without loss of generality that m = 0. Applying the separating
hyperplane theorem in the form of Proposition A.1 with C := ri (Âµ) yields some
Î¾ âˆˆRd such that Î¾ Â· y â‰¥0 for all y âˆˆri (Âµ) and Î¾ Â· yâˆ—> 0 for at least one
yâˆ—âˆˆri (Âµ). We deduce from (1.21) that Î¾ Â· y â‰¥0 holds also for all y âˆˆ(Âµ).
Moreover, Î¾ Â· y0 must be strictly positive for at least one y0 âˆˆsupp Âµ. Hence,
Î¾ Â· y â‰¥0 for Âµ-a.e. y âˆˆRd
and
Âµ

{y | Î¾ Â· y > 0 }

> 0.
(1.24)

1.6 Contingent initial data
31
By the equivalence of Âµ and Î½, (1.24) is also true for Î½ instead of Âµ, and so
Î¾ Â· m = Î¾ Â·

y Î½(dy) =

Î¾ Â· y Î½(dy) > 0,
in contradiction to our assumption that m = 0. We conclude that M(Âµ) âŠ‚ri (Âµ).
Remark 1.49. Note that Theorem 1.48 does not extend to the set

M(Âµ) :=
 
y Î½(dy)
 Î½ â‰ªÂµ and

|y| Î½(dy) < âˆ

.
Already the simple case Âµ := 1
2(Î´âˆ’1 + Î´+1) serves as a counterexample, because
here 
M(Âµ) = [âˆ’1, +1] while ri (Âµ) = (âˆ’1, +1). In this case, we have an identity
between 
M(Âµ) and (Âµ). However, also this identity fails in general as can be seen
by considering the normalized Lebesgue measure Î» on [âˆ’1, +1]. For this choice one
ï¬nds 
M(Î») = (âˆ’1, +1) but (Î») = [âˆ’1, +1].
â™¦
From Theorem 1.48 we obtain the following geometric characterization of the
absence of arbitrage.
Corollary 1.50. Let Âµ be the distribution of the discounted price vector S/(1 + r) of
the risky assets. Then the market model is arbitrage-free if and only if the price system
Ï€ belongs to the relative interior ri (Âµ) of the convex hull of the support of Âµ.
1.6 Contingent initial data
The idea of hedging contingent claims develops its full power only in a dynamic setting
in which trading may occur at several times. The corresponding discrete-time theory
constitutes the core of these notes and is presented in Chapter 5. The introduction of
additional trading periods requires more sophisticated techniques than those we have
used so far. In this section we will introduce some of these techniques in an extended
version of our previous market model in which initial prices, and hence strategies,
are contingent on scenarios. In this context, we are going to characterize the absence
of arbitrage strategies. The results will be used as building blocks in the multiperiod
setting of Part II; their study can be postponed until Chapter 5.
Suppose that we are given a Ïƒ-algebra F0 âŠ‚F which speciï¬es the information
that is available to an investor at time t = 0. The prices for our d + 1 assets at time
0 will be modelled as non-negative F0-measurable random variables S0
0, S1
0, . . . , Sd
0 .
Thus, the price system Ï€ = (Ï€0, Ï€1, . . . , Ï€d) of our previous discussion is replaced
by the vector
S0 = (S0
0, . . . , Sd
0 ).

32
1 Arbitrage theory
The portfolio Î¾ chosen by an investor at time t = 0 will also depend on the information
available at time 0. Thus, we assume that
Î¾ = (Î¾0, Î¾1, . . . , Î¾d)
is an F0-measurable random vector. The asset prices observed at time t = 1 will be
denoted by
S1 = (S0
1, S1
1, . . . , Sd
1 ).
They are modelled as non-negative random variables which are measurable with re-
spect to a Ïƒ-algebra F1 such that F0 âŠ‚F1 âŠ‚F . The Ïƒ-algebra F1 describes the
information available at time 1, and in this section we can assume that F = F1.
A riskless bond could be included by taking S0
0 â‰¡1 and by assuming S0
1 to be
F0-measurable and P -a.s. strictly positive. However, in the sequel it will be sufï¬cient
to assume that S0
0 is F0-measurable, S0
1 is F1-measurable, and that
P

S0
0 > 0 and S0
1 > 0

= 1.
(1.25)
Thus, we can take the 0th asset as numÃ©raire, and we denote by
Xi
t := Si
t
S0t
,
i = 1, . . . , d, t = 0, 1,
the discounted asset prices and by
Y = X1 âˆ’X0
the vector of the discounted net gains.
Deï¬nition 1.51. An arbitrage opportunity is a portfolio Î¾ such that Î¾ Â· S0 â‰¤0,
Î¾ Â· S1 â‰¥0 P -a.s., and P [ Î¾ Â· S1 > 0 ] > 0.
By our assumption (1.25), any arbitrage opportunity Î¾ = (Î¾0, Î¾) satisï¬es
Î¾ Â· Y â‰¥0 P -a.s.
and
P [ Î¾ Â· Y > 0 ] > 0.
(1.26)
In fact, the existence of a d-dimensional F0-measurable random vector Î¾ with (1.26)
is equivalent to the existence of an arbitrage opportunity. This can be seen as in
Lemma 1.3.
The space of discounted net gains which can be generated by some portfolio is
given by
K :=

Î¾ Â· Y | Î¾ âˆˆL0(, F0, P ; Rd)

.
Here, L0(, F0, P; Rd) denotes the space of Rd-valued random variables which are
P-a.s. ï¬niteandF0-measurablemodulotheequivalencerelation(A.21)ofcoincidence
up to P -null sets. The spaces Lp(, F0, P; Rd) for p > 0 are deï¬ned in the same

1.6 Contingent initial data
33
manner. We denote by Lp
+ := Lp
+(, F1, P) the cone of all non-negative elements
in the space Lp := Lp(, F1, P). With this notation, writing
K âˆ©L0
+ = {0}
is shorthand for the absence of arbitrage opportunities. We will denote by
K âˆ’L0
+
the convex cone of all Z âˆˆL0 which can be written as the difference of some Î¾ Â·Y âˆˆK
and some U âˆˆL0
+.
The following deï¬nition involves the notion of the conditional expectation
EQ[ Z | F0 ]
of a random variable Z with respect to a probability measure Q, given the Ïƒ-algebra
F0 âŠ‚F ; see Appendix A.2 and the references therein. If Z = (Z1, . . . , Zn) is a
random vector, then EQ[ Z | F0 ] is shorthand for the random vector with components
EQ[ Zi | F0 ], i = 1, . . . , n.
Deï¬nition 1.52. A probability measure Q satisfying
EQ[ Xi
t ] < âˆ
for i = 1, . . . , d and t = 0, 1
and
X0 = EQ[ X1 | F0 ]
Q-a.s.
is called a risk-neutral measure or martingale measure. We denote by P the set of all
risk-neutral measures P âˆ—which are equivalent to P .
Remark 1.53. The deï¬nition of a martingale measure Q means that for each asset
i = 0, . . . , d, the discounted price process (Xi
t)t=0,1 is a martingale under Q with
respect to the Ïƒ-ï¬elds (Ft)t=0,1. The systematic discussion of martingales in a multi-
period setting will begin in Section 5.2. The martingale aspect will be crucial for the
theory of dynamic hedging in Part II.
â™¦
Asthemainresultofthissection, wecannowstateanextensionoftheâ€œfundamental
theorem of asset pricingâ€ in Theorem 1.6 to our present setting.
Theorem 1.54. The following conditions are equivalent:
(a) K âˆ©L0
+ = {0}.
(b) (K âˆ’L0
+) âˆ©L0
+ = {0}.
(c) There exists a measure P âˆ—âˆˆP with a bounded density dP âˆ—/dP .
(d) P Ì¸= âˆ….

34
1 Arbitrage theory
Proof. (d) â‡’(a): Suppose by way of contradiction that there exist both a P âˆ—âˆˆP and
some Î¾ âˆˆL0(, F0, P; Rd) with non-zero payoff Î¾ Â· Y âˆˆK âˆ©L0
+. For large enough
c > 0, Î¾(c) := I{|Î¾|â‰¤c}Î¾ will be bounded, and the payoff Î¾(c) Â· Y will still be non-zero
and in K âˆ©L0
+. However,
Eâˆ—[ Î¾(c) Â· Y ] = Eâˆ—
Î¾(c) Â· Eâˆ—[ Y | F0 ]

= 0,
which is the desired contradiction.
(a)â‡”(b): It is obvious that (a) is necessary for (b). In order to prove sufï¬ciency,
suppose that we are given some Z âˆˆ(K âˆ’L0
+) âˆ©L0
+. Then there exists a random
variable U â‰¥0 and a random vector Î¾ âˆˆL0(, F0, P ; Rd) such that
0 â‰¤Z = Î¾ Â· Y âˆ’U.
This implies that Î¾ Â· Y â‰¥U â‰¥0, which, according to condition (a), can only happen
if Î¾ Â· Y = 0. Hence, also U = 0 and in turn Z = 0.
(b) â‡’(c): This is the difï¬cult part of the proof. The assertion will follow by
combining Lemmas 1.56, 1.57, 1.59, and 1.67.
Remark 1.55. If  is discrete, or if there exists a decomposition of  in countable
many atoms of (, F0, P), then the martingale measure P âˆ—can be constructed by
applying the result of Theorem 1.6 separately on each atom. In the general case, the
idea of patching together conditional martingale measures would involve subtle argu-
ments of measurable selection; see [51]. Here we present a different approach which
is based on separation arguments in L1(P ). It is essentially due to W. Schachermayer
[175]; our version uses in addition arguments byY. Kabanov and C. Stricker [122]. â™¦
We start with the following simple lemma, which takes care of the integrability
condition in Deï¬nition 1.52.
Lemma 1.56. For the proof of the implication (b) â‡’(c) in Theorem 1.54, we may
assume without loss of generality that
E[ |Xt| ] < âˆ
for t = 0, 1.
(1.27)
Proof. Deï¬ne a probability measure 
P by
d 
P
dP := c

1 + |X0| + |X1|
âˆ’1
where c is chosen such that the right-hand side integrates to 1. Clearly, (1.27) holds
for 
P. Moreover, condition (b) of Theorem 1.54 is satisï¬ed by P if and only if it is
satisï¬ed by the equivalent measure 
P . If P âˆ—âˆˆP is such that the density dP âˆ—/d 
P is
bounded, then so is the density
dP âˆ—
dP = dP âˆ—
d 
P
Â· d 
P
dP .

1.6 Contingent initial data
35
Therefore, the implication (b) â‡’(c) holds for P if and only if it holds for 
P .
From now on, we will always assume (1.27). Our goal is to construct a suitable
Z âˆˆLâˆsuch that
dP âˆ—
dP :=
Z
E[ Z ]
deï¬nes an equivalent risk-neutral measure P âˆ—. The following simple lemma gives a
criterion for this purpose, involving the convex cone
C := (K âˆ’L0
+) âˆ©L1.
Lemma 1.57. Suppose c â‰¥0 and Z âˆˆLâˆare such that
E[ Z W ] â‰¤c
for all W âˆˆC.
Then:
(a) E[ Z W ] â‰¤0 for all W âˆˆC, i.e., we can take c = 0.
(b) Z â‰¥0 P-a.s.
(c) If Z does not vanish P -a.s., then
dQ
dP :=
Z
E[ Z ]
deï¬nes a risk-neutral measure Q â‰ªP .
Proof. (a): Note that C is a cone, i.e., W âˆˆC implies that Î±W âˆˆC for all Î± â‰¥0.
This property excludes the possibility that E[ ZW ] > 0 for some W âˆˆC.
(b): C contains the function W := âˆ’I{Z<0}. Hence, by part (a),
E[ Zâˆ’] = E[ Z W ] â‰¤0.
(c): For all Î¾ âˆˆLâˆ(, F0, P; Rd) and Î± âˆˆR we have Î±Î¾ Â· Y âˆˆC by our
integrability assumption (1.27). Thus, a similar argument as in the proof of (a) yields
E[ Z Î¾ Â· Y ] = 0. Since Î¾ is bounded, we may conclude that
0 = E[ Z Î¾ Â· Y ] = E

Î¾ Â· E[ ZY | F0 ]

.
As Î¾ is arbitrary, this yields E[ ZY | F0 ] = 0 P -almost surely. Proposition A.12 now
implies
EQ[ Y | F0 ] =
1
E[ Z | F0 ]E[ ZY | F0 ] = 0
Q-a.s.,
which concludes the proof.

36
1 Arbitrage theory
In view of the preceding lemma, the construction of risk-neutral measures is re-
duced to the construction of elements of the set
Z :=

Z âˆˆLâˆ| 0 â‰¤Z â‰¤1, P [ Z > 0 ] > 0, and E[ Z W ] â‰¤0 for all W âˆˆC

.
In the following lemma, we will construct such elements by applying a separation
argument suggested by the condition
C âˆ©L1
+ = {0},
which follows from condition (b) ofTheorem 1.54. This separation argument needs the
additional assumption that C is closed in L1. Showing that this assumption is indeed
satisï¬ed in our situation will be one of the key steps in our proof; see Lemma 1.67
below.
Lemma 1.58. Assume that C is closed in L1 and satisï¬es C âˆ©L1
+ = {0}. Then for
each non-zero F âˆˆL1
+ there exists some Z âˆˆZ such that E[ FZ ] > 0.
Proof. Let B := {F} so that B âˆ©C = âˆ…, and note that the set C is non-empty, convex
and closed. Thus we may apply the Hahnâ€“Banach separation theorem in the form of
Theorem A.56 to obtain a continuous linear functional â„“on L1 such that
sup
WâˆˆC
â„“(W) < â„“(F).
Since the dual space of L1 can be identiï¬ed with Lâˆ, there exists some Z âˆˆLâˆ
such that â„“(F) = E[ FZ ] for all F âˆˆL1. We may assume without loss of generality
that âˆ¥Zâˆ¥âˆâ‰¤1. By construction, Z satisï¬es the assumptions of Lemma 1.57, and
so Z âˆˆZ. Moreover, E[ FZ ] = â„“(F) > 0 since the constant function W â‰¡0 is
contained in C.
We will now use an exhaustion argument to conclude that Z contains a strictly
positive element Zâˆ—under the assumptions of Lemma 1.58. After normalization, Zâˆ—
will serve as the density of our desired risk-neutral measure P âˆ—âˆˆP .
Lemma 1.59. Under the assumptions of Lemma 1.58, there exists Zâˆ—âˆˆZ with
Zâˆ—> 0 P -a.s.
Proof. As a ï¬rst step, we claim that Z is countably convex: If (Î±k)kâˆˆN is a sequence
of non-negative real numbers summing up to 1, and if Z(k) âˆˆZ for all k, then
Z :=
âˆ

k=1
Î±kZ(k) âˆˆZ.
Indeed, for W âˆˆC
âˆ

k=1
|Î±kZ(k)W| â‰¤|W| âˆˆL1,

1.6 Contingent initial data
37
and so Lebesgueâ€™s dominated convergence theorem implies that
E[ ZW ] =
âˆ

k=1
Î±kE[ Z(k)W ] â‰¤0.
For the second step, let
c := sup{P [ Z > 0 ] | Z âˆˆZ }.
We choose Z(n) âˆˆZ such that P [ Z(n) > 0 ] â†’c. Then
Zâˆ—:=
âˆ

n=1
2âˆ’nZ(n) âˆˆZ
by step one, and
{ Zâˆ—> 0 } =
âˆ

n=1
{ Z(n) > 0 }.
Hence P [Zâˆ—> 0] = c.
In the ï¬nal step, we show that c = 1. Then Zâˆ—will be as desired. Suppose by way
of contradiction that P [Zâˆ—= 0] > 0, so that W := I{Zâˆ—=0} is a non-zero element of
L1
+. Lemma 1.58 yields Z âˆˆZ with E[ WZ ] > 0. Hence,
P [ {Z > 0} âˆ©{Zâˆ—= 0} ] > 0,
and so
P
 1
2(Z + Zâˆ—) > 0

> P [ Zâˆ—> 0 ] = c,
in contradiction to the maximality of P [Zâˆ—> 0].
Thus, we have completed the proof of the implication (b) â‡’(c) of Theorem 1.54
up to the requirement that C is closed in L1. Let us pause here in order to state
general versions of two of the arguments we have used so far. The ï¬rst is known as
the Halmosâ€“Savage theorem. It can be proved by a straightforward modiï¬cation of
the exhaustion argument used in the proof of Lemma 1.59.
Theorem 1.60. Let Q be a set of probability measures which are all absolutely con-
tinuous with respect to a given measure P . Suppose that Q â‰ˆP in the sense that
Q[ A ] = 0 for all Q âˆˆQ implies that P [ A ] = 0. Then there exists a countable
subfamily 
Q âŠ‚Q which satisï¬es 
Q â‰ˆP .
An inspection of Lemmas 1.57, 1.58, and 1.59 shows that the particular structure
of C = (K âˆ’L0
+)âˆ©L1 was only used for part (c) of Lemma 1.57. All other arguments
relied only on the fact that C is a closed convex cone in L1 that contains all bounded
negative functions and no non-trivial positive function. Thus, we have in fact proved
the following Krepsâ€“Yan theorem, which was obtained independently in [199] and
[137].

38
1 Arbitrage theory
Theorem 1.61. Suppose C is a closed convex cone in L1 satisfying
C âŠƒâˆ’Lâˆ
+
and
C âˆ©L1
+ = {0}.
Then there exists Z âˆˆLâˆsuch that Z > 0 P -a.s. and E[ W Z ] â‰¤0 for all W âˆˆC.
Let us now turn to the closedness of our set C = (K âˆ’L0
+) âˆ©L1. The following
example illustrates that we cannot expect C to be closed without assuming the absence
of arbitrage opportunities.
Example 1.62. Let P be the Lebesgue measure on the Borel ï¬eld F1 of  = [0, 1],
and take F0 = { âˆ…,  } and Y(Ï‰) = Ï‰. This choice clearly violates the no-arbitrage
condition, i.e., we have K âˆ©L0
+ Ì¸= {0}. The convex set C = (K âˆ’L0
+) âˆ©L1 is a
proper subset of L1. More precisely, C does not contain any function F âˆˆL1 with
F â‰¥1: If we could represent F as Î¾ Â· Y âˆ’U for a non-negative function U, then it
would follow that
Î¾ Â· Y = F + U â‰¥1,
which is impossible for any Î¾. However, as we show next, the closure of C in L1
coincides with the full space L1. In particular, C cannot be closed. Let F âˆˆL1 be
arbitrary, and observe that
Fn := (F + âˆ§n) I[ 1
n ,1] âˆ’F âˆ’
converges to F in L1 as n â†‘âˆ. Moreover, each Fn belongs to C as
(F + âˆ§n) I[ 1
n ,1] â‰¤n2 Â· Y.
Consequently, F is contained in the L1-closure of C.
â™¦
In the special case F0 = {âˆ…, }, we can directly go on to the proof that C is
closed, using a simpliï¬ed version of Lemma 1.67 below. In this way, we obtain an
alternative proof of Theorem 1.6. In the general case we need some preparation. Let
us ï¬rst prove a â€œrandomizedâ€ version of the Bolzanoâ€“WeierstraÃŸ theorem. It yields a
simple construction of a measurable selection of a convergent subsequence of a given
sequence in L0(, F0, P; Rd).
Lemma 1.63. Let (Î¾n) be a sequence in L0(, F0, P ; Rd) with lim infn |Î¾n| < âˆ.
Then there exists Î¾ âˆˆL0(, F0, P; Rd) and a strictly increasing sequence (Ïƒm) of
F0-measurable integer-valued random variables such that
Î¾Ïƒm(Ï‰)(Ï‰) â†’Î¾(Ï‰)
for P -a.e. Ï‰ âˆˆ.
Proof. Let (Ï‰) := lim infn |Î¾n(Ï‰)|, and deï¬ne Ïƒm := m on the P -null set { = âˆ}.
On { < âˆ} we let Ïƒ 0
1 := 1, and we deï¬ne F0-measurable random indices Ïƒ 0
m by
Ïƒ 0
m := inf

n > Ïƒ 0
mâˆ’1

|Î¾n| âˆ’
 â‰¤1
m

,
m = 2, 3, . . . .

1.6 Contingent initial data
39
We use recursion on i = 1, . . . , d to deï¬ne the ith component Î¾i of the limit Î¾ and to
extract a new subsequence Ïƒ i
m of random indices. Let
Î¾i = lim inf
mâ†‘âˆÎ¾i
Ïƒ iâˆ’1
m ,
which is already deï¬ned if i = 1. This Î¾i can be used in the construction of Ïƒ i
m: Let
Ïƒ i
1 := 1 and, for m = 2, 3, . . . ,
Ïƒ i
m(Ï‰) := inf

Ïƒ iâˆ’1
n
(Ï‰)
 Ïƒ iâˆ’1
n
(Ï‰) > Ïƒ i
mâˆ’1(Ï‰) and |Î¾i
Ïƒ iâˆ’1
n
(Ï‰) âˆ’Î¾i(Ï‰)| â‰¤1
m

.
Then Ïƒm := Ïƒ d
m yields the desired sequence of random indices.
It may happen that
Î¾ Â· Y = Î¾ Â· Y
P -a.s.,
although Î¾ andÎ¾ are two different portfolios in L0(, F0, P ; Rd).
Remark 1.64. We could exclude this possibility by the following assumption of non-
redundance:
Î¾ Â· Y = Î¾ Â· Y P -a.s.
"â‡’
Î¾ = Î¾ P -a.s.
(1.28)
Under this assumption, we could immediately move on to the ï¬nal step in Lemma 1.67.
â™¦
Without assumption (1.28), it will be convenient to have a suitable linear space
NâŠ¥of â€œreference portfoliosâ€ which are uniquely determined by their payoff. The
construction of NâŠ¥is the purpose of the following lemma. We will assume that the
spaces L0 and L0(, F0, P; Rd) are endowed with the topology of convergence in
P-measure, which is generated by the metric d of (A.22).
Lemma 1.65. Deï¬ne two linear subspaces N and NâŠ¥of L0(, F0, P ; Rd) by
N :=

Î· âˆˆL0(, F0, P; Rd) | Î· Â· Y = 0 P -a.s.

,
NâŠ¥:=

Î¾ âˆˆL0(, F0, P; Rd) | Î¾ Â· Î· = 0 P -a.s. for all Î· âˆˆN

.
(a) Both N and NâŠ¥are closed in L0(, F0, P ; Rd) and, in the following sense,
invariant under the multiplication with scalar functions g âˆˆL0(, F0, P ): If
Î· âˆˆN and Î¾ âˆˆNâŠ¥, then gÎ· âˆˆN and gÎ¾ âˆˆNâŠ¥.
(b) If Î¾ âˆˆNâŠ¥and Î¾ Â· Y = 0 P -a.s., then Î¾ = 0, i.e., N âˆ©NâŠ¥= {0}.
(c) Every Î¾ âˆˆL0(, F0, P; Rd) has a unique decomposition Î¾ = Î· + Î¾âŠ¥, where
Î· âˆˆN and Î¾âŠ¥âˆˆNâŠ¥.

40
1 Arbitrage theory
Remark 1.66. For the proof of this lemma, we will use a projection argument in
Hilbert space. Let us sketch a more probabilistic construction of the decomposition
Î¾ = Î· + Î¾âŠ¥. Take a regular conditional distribution of Y given F0, i.e., a stochastic
kernel K from (, F0) to Rd such that K(Ï‰, A) = P [ Y âˆˆA | F0 ](Ï‰) for all Borel
sets A âŠ‚Rd and P -a.e. Ï‰ (see, e.g., Â§44 of [19]). If one deï¬nes Î¾âŠ¥(Ï‰) as the
orthogonal projection of Î¾(Ï‰) onto the linear hull L(Ï‰) of the support of the measure
K(Ï‰, Â·), then Î· := Î¾ âˆ’Î¾âŠ¥satisï¬es Î· Â· Y = 0 P -a.s., and any Î· with the same
property must be P -a.s. perpendicular to L(Ï‰). However, carrying out the details
of this construction involves certain measurability problems; this is why we use the
projection argument below.
â™¦
Proof. (a): The closedness of N and NâŠ¥follows immediately from the metrizability
of L0(, F0, P ; Rd) (see Appendix A.7) and the fact that every sequence which
converges in measure has an almost-surely converging subsequence. The invariance
under the multiplication with F0-measurable scalar functions is obvious.
(b): Suppose that Î¾ âˆˆN âˆ©NâŠ¥. Then taking Î· := Î¾ in the deï¬nition of NâŠ¥yields
Î¾ Â· Î¾ = |Î¾|2 = 0 P -a.s.
(c): Any given Î¾ âˆˆL0(, F0, P; Rd) can be written as
Î¾(Ï‰) = Î¾1(Ï‰) e1 + Â· Â· Â· + Î¾d(Ï‰) ed,
where ei denotes the ith Euclidean unit vector, and where Î¾i(Ï‰) is the ith component
of Î¾(Ï‰). Consider ei as a constant element of L0(, F0, P ; Rd), and suppose that we
can decompose ei as
ei = ni + eâŠ¥
i
where ni âˆˆN and eâŠ¥
i âˆˆNâŠ¥.
(1.29)
Since by part (a) both N and NâŠ¥are invariant under the multiplication with F0-
measurable functions, we can then obtain the desired decomposition of Î¾ by letting
Î·(Ï‰) :=
d

i=1
Î¾i(Ï‰) ni(Ï‰)
and
Î¾âŠ¥(Ï‰) :=
d

i=1
Î¾i(Ï‰) eâŠ¥
i (Ï‰).
Uniqueness of the decomposition follows from N âˆ©NâŠ¥= {0}.
It remains to construct the decomposition (1.29) of ei. The constant ei is an element
of the space H := L2(, F0, P; Rd), which becomes a Hilbert space if endowed with
the natural inner product
(Î·, Î¾)H := E[ Î· Â· Î¾ ],
Î·, Î¾ âˆˆL2(, F0, P ; Rd).
Observe that both N âˆ©H and NâŠ¥âˆ©H are closed subspaces of H, because con-
vergence in H implies convergence in L0(, F0, P ; Rd). Therefore, we can deï¬ne
the corresponding orthogonal projections
Ï€0 : H â†’N âˆ©H
and
Ï€âŠ¥: H â†’NâŠ¥âˆ©H.

1.6 Contingent initial data
41
Thus, letting ni := Ï€0(ei) and eâŠ¥
i := Ï€âŠ¥(ei) will be the desired decomposition (1.29),
once we know that ei = Ï€0(ei) + Ï€âŠ¥(ei). To prove this, we need only show that
Î¶ := ei âˆ’Ï€0(ei) is contained in NâŠ¥. We assume by way of contradiction that Î¶ is
not contained in NâŠ¥âˆ©H. Then there exists some Î· âˆˆN such that P [ Î¶ Â· Î· > 0 ] > 0.
Clearly,
Î· := Î· I{Î¶Â·Î·>0, |Î·|â‰¤c}
is contained in N âˆ©H for each c > 0. But if c is large enough, then 0 < E[Î· Â· Î¶ ] =
(Î·, Î¶)H, which contradicts the fact that Î¶ is by construction orthogonal to N âˆ©H.
After these preparations, we can now complete the proof of Theorem 1.54 by
showing the closedness of C = (K âˆ’L0
+) âˆ©L1, which is an immediate consequence
of the following lemma. Recall that we have already proved the equivalence of the
conditions (a) and (b) in Theorem 1.54.
Lemma 1.67. If K âˆ©L0
+ = {0}, then K âˆ’L0
+ is closed in L0.
Proof. Suppose Wn âˆˆ(K âˆ’L0
+) converges in L0 to some W as n â†‘âˆ. By passing
to a suitable subsequence, we may assume without loss of generality that Wn â†’W
P-almost surely. We can write Wn = Î¾n Â· Y âˆ’Un for Î¾n âˆˆNâŠ¥and Un âˆˆL0
+.
In a ï¬rst step, we will prove the assertion given the fact that
lim inf
nâ†‘âˆ|Î¾n| < âˆ
P -a.s.,
(1.30)
which will be established afterwards.
Assuming (1.30), Lemma 1.63 yields
F0-measurable integer-valued random variables Ïƒ1 < Ïƒ2 < Â· Â· Â· and some Î¾ âˆˆ
L0(Ï‰, F0, P; Rd) such that P -a.s. Î¾Ïƒn â†’Î¾. It follows that
UÏƒn = Î¾Ïƒn Â· Y âˆ’WÏƒn âˆ’â†’Î¾ Â· Y âˆ’W =: U
P-a.s.,
(1.31)
so that W = Î¾ Â· Y âˆ’U âˆˆK âˆ’L0
+.
Let us now show that A := { lim infn |Î¾n| = +âˆ} satisï¬es P [ A ] = 0 as claimed
in (1.30). Using Lemma 1.63 on Î¶n := Î¾n/|Î¾n| yields F0-measurable integer-valued
random variables Ï„1 < Ï„2 < Â· Â· Â· and some Î¶ âˆˆL0(Ï‰, F0, P ; Rd) such that P -a.s.
Î¶Ï„n â†’Î¶. The convergence of (Wn) implies that
0 â‰¤IA
UÏ„n
|Î¾Ï„n| = IA
	
Î¶Ï„n Â· Y âˆ’WÏ„n
|Î¾Ï„n|

âˆ’â†’IA Î¶ Â· Y
P -a.s.
Hence, our assumption K âˆ©L0
+ = {0} yields (IAÎ¶) Â· Y = 0. Below we will show that
IAÎ¶ âˆˆNâŠ¥, so that
Î¶ = 0
P -a.s. on A.
(1.32)
On the other hand, the fact that |Î¶n| = 1 P -a.s. implies that |Î¶| = 1 P -a.s., which can
only be consistent with (1.32) if P [ A ] = 0.

42
1 Arbitrage theory
It remains to show that IAÎ¶ âˆˆNâŠ¥. To this end, we ï¬rst observe that each Î¶Ï„n
belongs to NâŠ¥since, for each Î· âˆˆN,
Î¶Ï„n Â· Î· =
âˆ

k=1
I{Ï„n=k}
1
|Î¾k|Î¾k Â· Î· = 0
P -a.s.
The closedness of NâŠ¥implies Î¶ âˆˆNâŠ¥, and A âˆˆF0 yields IAÎ¶ âˆˆNâŠ¥.
If in the proof of Lemma 1.67 Wn = Î¾n Â· Y for all n, then U = 0 in (1.31), and
W = limn Wn is itself contained in K. We thus get the following lemma, which will
be useful in Chapter 5.
Lemma 1.68. Suppose that K âˆ©L0
+ = {0}. Then K is closed in L0.
In fact, it is possible to show that K is always closed in L0; see [193], [175]. But
this stronger result will not be needed here.
As an alternative to the randomized Bolzanoâ€“WeierstraÃŸ theorem in Lemma 1.63,
we can use the following variant of Komlosâ€™ principle of subsequences. It yields a
convergent sequence of convex combinations of a sequence in L0(, F0, P ; Rd), and
this will be needed later on. Recall from Appendix A.1 the notion of the convex hull
conv A =

n

i=1
Î±ixi
 xi âˆˆA, Î±i â‰¥0,
n

i=1
Î±i = 1, n âˆˆN

of a subset A of a linear space, which in our case will be L0(, F0, P ; Rd).
Lemma 1.69. Let (Î¾n) be a sequence in L0(, F0, P ; Rd) such that supn |Î¾n| < âˆ
P-almost surely. Then there exists a sequence of convex combinations
Î·n âˆˆconv{ Î¾n, Î¾n+1, . . . }
which converges P -almost surely to some Î· âˆˆL0(, F0, P ; Rd).
Proof. We can assume without loss of generality that supn |Î¾n| â‰¤1 P -a.s.; otherwise
we consider the sequence Î¾n := Î¾n/ supn |Î¾n|. Then (Î¾n) is a bounded sequence
in the Hilbert space H := L2(, F0, P; Rd). Since the closed unit ball in H is
weakly compact, the sequence (Î¾n) has an accumulation point Î· âˆˆH; note that weak
sequential compactness follows from the Banachâ€“Alaoglu theorem in the form of
Theorem A.62 and the fact that the dual H â€² of the Hilbert space H is isomorphic
to H itself. For each n, the accumulation point Î· belongs to the L2-closure Cn of
conv{Î¾n, Î¾n+1, . . . }, due to the fact that a closed convex set in H is also weakly
closed; see Theorem A.59. Thus, we can ï¬nd Î·n âˆˆconv{Î¾n, Î¾n+1, . . . } such that
E[ |Î·n âˆ’Î·|2 ] â‰¤1
n2 .
This sequence (Î·n) converges P -a.s. to Î·.

1.6 Contingent initial data
43
Remark 1.70. The original result by Komlos [133] is more precise: It states that for
any bounded sequence (Î¾n) in L1(, F , P; Rd) there is a subsequence (Î¾nk) which
satisï¬es a strong law of large numbers, i.e.,
lim
Nâ†‘âˆ
1
N
N

k=1
Î¾nk
exists P -almost surely; see also [195].
â™¦

Chapter 2
Preferences
In a complete ï¬nancial market model, the price of a contingent claim is determined
by arbitrage arguments, without involving the preferences of economic agents. In an
incomplete model, such claims may carry an intrinsic risk which cannot be hedged
away. In order to determine desirable strategies in view of such risks, the preferences
of an investor should be made explicit, and this is usually done in terms of an expected
utility criterion.
The paradigm of expected utility is the theme of this chapter. We begin with a
general discussion of preference relations on a set X of alternative choices and their
numerical representation by some functional U on X. In the ï¬nancial context, such
choices can usually be described as payoff proï¬les. These are deï¬ned as functions
X on an underlying set of scenarios with values in some set of payoffs. Thus we are
facing risk or even uncertainty. In the case of risk, a probability measure is given on
the set of scenarios. In this case, we can focus on the resulting payoff distributions.
We are then dealing with preferences on â€œlotteriesâ€, i.e., on probability measures on
the set of payoffs.
In Sections 2.2 and 2.3 we discuss the conditions â€“ or axioms â€“ under which such
a preference relation on lotteries Âµ can be represented by a functional of the form

u(x) Âµ(dx),
where u is a utility function on the set of payoffs. This formulation of preferences
on lotteries in terms of expected utility goes back to D. Bernoulli [22]; the axiomatic
theory was initiated by J. von Neumann and O. Morgenstern [155]. Section 2.4 char-
acterizes uniform preference relations which are shared by a given class of functions u.
This involves the general theory of probability measures on product spaces with given
marginals which will be discussed in Section 2.6.
In Section 2.5 we return to the more fundamental level where preferences are
deï¬ned on payoff proï¬les, and where we are facing uncertainty in the sense that no
probability measure is given a priori. L. Savage [174] clariï¬ed the conditions under
which such preferences on a space of functions X admit a representation of the form
U(X) = EQ[ u(X) ]
where Q is a â€œsubjectiveâ€ probability measure on the set of scenarios. We are going to
concentrate on a robust extension of the Savage representation which was introduced
by I. Gilboa and D. Schmeidler [104]. Here the utility functional is of the form
U(X) = inf
QâˆˆQ EQ[ u(X) ],

2.1 Preference relations and their numerical representation
45
and it involves a whole class Q of probability measures on the set of scenarios. The
axiomatic approach to the robust Savage representation is closely related to the con-
struction of risk measures, which will be the topic of Chapter 4.
2.1 Preference relations and their numerical representation
Let X be some non-empty set. An element x âˆˆX will be interpreted as a possible
choice of an economic agent. If presented with two choices x, y âˆˆX, the agent might
prefer one over the other. This will be formalized as follows.
Deï¬nition 2.1. A preference order (or preference relation) on X is a binary relation
â‰»with the following two properties.
â€¢ Asymmetry: If x â‰»y, then y Ì¸â‰»x.
â€¢ Negative transitivity: If x â‰»y and z âˆˆX, then either x â‰»z or z â‰»y or both
must hold.
Negative transitivity states that if a clear preference exists between two choices
x and y, and if a third choice z is added, then there is still a choice which is least
preferable (y if z â‰»y) or most preferable (x if x â‰»z).
Deï¬nition 2.2. A preference order â‰»on X induces a corresponding weak preference
order âª°deï¬ned by
x âª°y : â‡â‡’
y Ì¸â‰»x,
and an indifference relation âˆ¼given by
x âˆ¼y : â‡â‡’
x âª°y and y âª°x.
Thus, x âª°y means that either x is preferred to y or there is no clear preference
between the two.
Remark 2.3. It is easy to check that the asymmetry and the negative transitivity of â‰»
are equivalent to the following two respective properties of âª°:
(a) Completeness: For all x, y âˆˆX, either y âª°x or x âª°y or both are true.
(b) Transitivity: If x âª°y and y âª°z, then also x âª°z.
Conversely, any complete and transitive relation âª°induces a preference order â‰»via
the negation of âª°, i.e.,
y â‰»x
: â‡â‡’
x Ì¸âª°y.
The indifference relation âˆ¼is an equivalence relation, i.e., it is reï¬‚exive, symmetric
and transitive.
â™¦

46
2 Preferences
Deï¬nition 2.4. A numerical representation of a preference order â‰»is a function
U : X â†’R such that
y â‰»x
â‡â‡’
U(y) > U(x).
(2.1)
Clearly, (2.1) is equivalent to
y âª°x
â‡â‡’
U(y) â‰¥U(x).
NotethatsuchanumericalrepresentationU isnotunique: Iff isanystrictlyincreasing
function, then 
U(x) := f (U(x)) is again a numerical representation.
Deï¬nition 2.5. Let â‰»be a preference relation on X. A subset Z of X is called order
dense if for any pair x, y âˆˆX such that x â‰»y there exists some z âˆˆZ with x âª°z âª°y.
The following theorem characterizes those preference relations for which there
exists a numerical representation.
Theorem 2.6. For the existence of a numerical representation of a preference relation
â‰»it is necessary and sufï¬cient that X contains a countable, order dense subset Z. In
particular, any preference order admits a numerical representation if X is countable.
Proof. Suppose ï¬rst that we are given a countable order dense subset Z of X. For
x âˆˆX, let
Z(x) := {z âˆˆZ | z â‰»x}
and
Z(x) := {z âˆˆZ | x â‰»z}.
The relation x âª°y implies that Z(x) âŠ†Z(y) and Z(x) âŠ‡Z(y). If the strict relation
x â‰»y holds, then at least one of these inclusions is also strict. To see this, pick
z âˆˆZ with x âª°z âª°y, so that either x â‰»z âª°y or x âª°z â‰»y. In the ï¬rst case,
z âˆˆZ(x)\Z(y), while z âˆˆZ(y)\Z(x) in the second case.
Next, take any strictly positive probability distribution Âµ on Z, and let
U(x) :=

zâˆˆZ(x)
Âµ(z) âˆ’

zâˆˆZ(x)
Âµ(z).
By the above, U(x) > U(y) if and only if x â‰»y so that U is the desired numerical
representation.
For the proof of the converse assertion take a numerical representation U and let
J denote the countable set
J :=

[a, b] | a, b âˆˆQ, a < b, Uâˆ’1([a, b]) Ì¸= âˆ…

.
For every interval I âˆˆJ we can choose some zI âˆˆX with U(zI) âˆˆI and thus deï¬ne
the countable set
A := { zI | I âˆˆJ }.
At ï¬rst glance it may seem that A is a good candidate for an order dense set. However,
it may happen that there are x, y âˆˆX such that U(x) < U(y) and for which there

2.1 Preference relations and their numerical representation
47
is no z âˆˆX with U(x) < U(z) < U(y). In this case, an order dense set must
contain at least one z with U(z) = U(x) or U(z) = U(y), a condition which cannot
be guaranteed by A.
Let us deï¬ne the set C of all pairs (x, y) which do not admit any z âˆˆA with
y â‰»z â‰»x:
C :=

(x, y) | x, y âˆˆX\A, y â‰»x and Ì¸ âˆƒz âˆˆA with y â‰»z â‰»x

.
Then (x, y) âˆˆC implies the apparently stronger fact that we cannot ï¬nd any z âˆˆX
such that y â‰»z â‰»x: Otherwise we could ï¬nd a, b âˆˆQ such that
U(x) < a < U(z) < b < U(y),
so I := [a, b] would belong to J, and the corresponding zI would be an element of
A with y â‰»zI â‰»x, contradicting the assumption that (x, y) âˆˆC.
It follows that all intervals

U(x), U(y)

with (x, y) âˆˆC are disjoint and non-
empty. Hence, there can be only countably many of them. For each such interval J we
pick now exactly one pair (xJ , yJ ) âˆˆC such that U(xJ ) and U(yJ ) are the endpoints
of J, and we denote by B the countable set containing all xJ and all yJ .
Finally, we claim that Z := A âˆªB is an order dense subset of X. Indeed, if x,
y âˆˆX\Z with y â‰»x, then either there is some z âˆˆA such that y â‰»z â‰»x, or
(x, y) âˆˆC. In the latter case, there will be some z âˆˆB with U(y) = U(z) > U(x)
and, consequently, y âª°z â‰»x.
The following example shows that even in a seemingly straightforward situation,
a given preference order may not admit a numerical representation.
Example 2.7. Let â‰»be the usual lexicographical order on X := [0, 1] Ã— [0, 1], i.e.,
(x1, x2) â‰»(y1, y2) if and only if either x1 > y1, or if x1 = y1 and simultaneously
x2 > y2. In order to show that there cannot be a numerical representation for this
preference order, suppose on the contrary that U is such a numerical representation.
Then
d(Î±) := U(Î±, 1) âˆ’U(Î±, 0)
is strictly positive for all Î± âˆˆ[0, 1]. Hence,
[0, 1] =
âˆ

n=1

Î± âˆˆ[0, 1]
 d(Î±) > 1
n

.
Denote An := {Î± | d(Î±) > 1/n}. There must be at least one set An0 having inï¬nitely
many elements, and we can pick an arbitrary number N of elements Î±1, . . . , Î±N âˆˆAn0
such that Î±1 < Â· Â· Â· < Î±N. Since (Î±i+1, 0) â‰»(Î±i, 1), it follows that
U(Î±i+1, 0) âˆ’U(Î±i, 0) > U(Î±i, 1) âˆ’U(Î±i, 0) = d(Î±i) > 1
n0
.

48
2 Preferences
Hence
U(1, 1) âˆ’U(0, 0)
= U(1, 1) âˆ’U(Î±N, 0) +
Nâˆ’1

i=1
[ U(Î±i+1, 0) âˆ’U(Î±i, 0) ] + U(Î±1, 0) âˆ’U(0, 0)
> N âˆ’1
n0
.
But N can be chosen arbitrarily large while n0 remains ï¬xed. Thus U(1, 1)âˆ’U(0, 0)
must be inï¬nite, which is impossible.
â™¦
Deï¬nition 2.8. Let X be a topological space. A preference relation â‰»is called con-
tinuous if for all x âˆˆX
B(x) := {y âˆˆX | y â‰»x}
and
B(x) := {y âˆˆX | x â‰»y}
(2.2)
are open subsets of X.
Remark 2.9. Every preference order that admits a continuous numerical representa-
tion is itself continuous. Under some mild conditions on the underlying space X, the
converse statement is also true; see Theorem 2.15 below.
â™¦
Example 2.10. The lexicographical order of Example 2.7 is not continuous:
If
(x1, x2) âˆˆ[0, 1] Ã— [0, 1] is given, then

(y1, y2) | (y1, y2) â‰»(x1, x2)

= (x1, 1] Ã— [0, 1] âˆª{x1} Ã— (x2, 1],
which is typically not an open subset of [0, 1] Ã— [0, 1].
â™¦
Recall that a topological space X is called a topological Hausdorff space if any
two distinct points in X have disjoint open neighborhoods. In this case, all singletons
{x} are closed. Clearly, every metric space is a topological Hausdorff space.
Proposition 2.11. Let â‰»be a preference order on a topological Hausdorff space X.
Then the following properties are equivalent.
(a) â‰»is continuous.
(b) The set { (x, y) | y â‰»x } is open in X Ã— X.
(c) The set { (x, y) | y âª°x } is closed in X Ã— X.
Proof. (a) â‡’(b): We have to show that for any pair
(x0, y0) âˆˆM := { (x, y) | y â‰»x }
there exist open sets U, V âŠ‚X such that x0 âˆˆU, y0 âˆˆV , and U Ã—V âŠ‚M. Consider
ï¬rst the case in which there exists some z âˆˆB(x0) âˆ©B(y0) for the notation B(x0)

2.1 Preference relations and their numerical representation
49
and B(y0) introduced in (2.2). Then y0 â‰»z â‰»x0, so that U := B(z) and V := B(z)
are open neighborhoods of x0 and y0, respectively. Moreover, if x âˆˆU and y âˆˆV ,
then y â‰»z â‰»x, and thus U Ã— V âŠ‚M.
If B(x0) âˆ©B(y0) = âˆ…, we let U := B(y0) and V := B(x0). If (x, y) âˆˆU Ã— V ,
then y0 â‰»x and y â‰»x0 by deï¬nition. We want to show that y â‰»x in order to
conclude that U Ã—V âŠ‚M. To this end, suppose that x âª°y. Then y0 â‰»y by negative
transitivity, hence y0 â‰»y â‰»x0. But then y âˆˆB(x0) âˆ©B(y0) Ì¸= âˆ…, and we have a
contradiction.
(b) â‡’(c): First note that the mapping Ï†(x, y) := (y, x) is a homeomorphism of
XÃ—X. Then observe that the set { (x, y) | y âª°x } is just the complement of the open
set Ï†({ (x, y) | y â‰»x }).
(c) â‡’(a): Since X is a topological Hausdorff space, {x} Ã— X is closed in X Ã— X,
and so is the set
{x} Ã— X âˆ©{ (x, y) | y âª°x } = {x} Ã— { y | y âª°x }.
Hence { y | y âª°x } is closed in X, and its complement { y | x â‰»y } is open. The
same argument applies to { y | y â‰»x }.
Example 2.12. For x0 < y0 consider the set X := (âˆ’âˆ, x0] âˆª[y0, âˆ) endowed
with the usual order > on R. Then, with the notation introduced in (2.2), B(y0) =
(âˆ’âˆ, x0] and B(x0) = [y0, âˆ). Hence,
B(x0) âˆ©B(y0) = âˆ…
despite y0 â‰»x0, a situation we had to consider in the preceding proof.
â™¦
Recall that the topological space X is called connected if X cannot be written as
the union of two disjoint and non-empty open sets. Assuming that X is connected
will rule out the situation occurring in Example 2.12.
Proposition 2.13. Let X be a connected topological space with a continuous prefer-
ence order â‰». Then every dense subset Z of X is also order dense in X. In particular,
there exists a numerical representation of â‰»if X is separable.
Proof. Take x, y âˆˆX with y â‰»x, and consider B(x) and B(y) as deï¬ned in (2.2).
Since y âˆˆB(x) and x âˆˆB(y), neither B(x) nor B(y) are empty sets. Moreover,
negative transitivity implies that X = B(x) âˆªB(y). Hence, the open sets B(x)
and B(y) cannot be disjoint, as X is connected. Thus, the open set B(x) âˆ©B(y)
must contain some element z of the dense subset Z, which then satisï¬es y â‰»z â‰»x.
Therefore Z is an order dense subset of X.
Separability of X means that there exists a countable dense subset Z of X, which
then is order dense. Hence, the existence of a numerical representation follows from
Theorem 2.6.

50
2 Preferences
Remark 2.14. Consider the situation of Example 2.12, where X := (âˆ’âˆ, x0] âˆª
[y0, âˆ), and suppose that x0 and y0 are both irrational. Then Z := Q âˆ©X is dense
in X, but there exists no z âˆˆZ such that y0 âª°z âª°x0. This example shows that the
assumption of topological connectedness is essential for Proposition 2.13.
â™¦
Theorem 2.15. Let X be a topological space which satisï¬es at least one of the fol-
lowing two properties:
â€¢ X has a countable base of open sets.
â€¢ X is separable and connected.
Then every continuous preference order on X admits a continuous numerical repre-
sentation.
For a proof we refer to [57], Propositions 3 and 4. For our purposes, namely for
the proof of the von Neumannâ€“Morgenstern representation in the next section and for
the proof of the robust Savage representation in Section 2.5, the following lemma will
be sufï¬cient.
Lemma 2.16. Let X be a connected metric space with a continuous preference order
â‰». If U : X â†’R is a continuous function, and if its restriction to some dense subset Z
is a numerical representation for the restriction of â‰»to Z, then U is also a numerical
representation for â‰»on X.
Proof. We have to show that y â‰»x if and only if U(y) > U(x). In order to verify
the â€œonly ifâ€ part, take x, y âˆˆX with y â‰»x. As in the proof of Proposition 2.13,
we obtain the existence of some z0 âˆˆZ with y â‰»z0 â‰»x. Repeating this argument
yields zâ€²
0 âˆˆZ such that z0 â‰»zâ€²
0 â‰»x. Now we take two sequences (zn) and (zâ€²
n) in Z
with zn â†’y and zâ€²
n â†’x. By continuity of â‰», eventually
zn â‰»z0 â‰»zâ€²
0 â‰»zâ€²
n,
and thus
U(zn) > U(z0) > U(zâ€²
0) > U(zâ€²
n).
The continuity of U implies that U(zn) â†’U(y) and U(zâ€²
n) â†’U(x), whence
U(y) â‰¥U(z0) > U(zâ€²
0) â‰¥U(x).
For the proof of the converse implication, suppose that x, y âˆˆX are such that
U(y) > U(x). Since U is continuous,
U(x) := { z âˆˆX | U(z) > U(x) }
and
U(y) := { z âˆˆX | U(z) < U(y) }

2.2 Von Neumannâ€“Morgenstern representation
51
are both non-empty open subsets of X. Moreover, U(y)âˆªU(x) = X. Connectedness
of X implies that U(y)âˆ©U(x) Ì¸= âˆ…. As above, a repeated application of the preceding
argument yields z0, zâ€²
0 âˆˆZ such that
U(y) > U(z0) > U(zâ€²
0) > U(x).
Since Z is a dense subset of X, we can ï¬nd sequences (zn) and (zâ€²
n) in Z with zn â†’y
and zâ€²
n â†’x as well as with U(zn) > U(z0) and U(zâ€²
n) < U(zâ€²
0). Since U is a
numerical representation of â‰»on Z, we have
zn â‰»z0 â‰»zâ€²
0 â‰»zâ€²
n.
Hence, by the continuity of â‰», neither z0 â‰»y nor x â‰»zâ€²
0 can be true, and negative
transitivity yields y â‰»x.
2.2 Von Neumannâ€“Morgenstern representation
Suppose that each possible choice for our economic agent corresponds to a probability
distribution on a given set of scenarios. Thus, the set X can be identiï¬ed with a subset
M of the set M1(S, S) of all probability distributions on a measurable space (S, S). In
the context of the theory of choice, the elements of M are sometimes called lotteries.
We will assume in the sequel that M is convex. The aim of this section is to characterize
those preference orders â‰»on M which allow for a numerical representation U of the
form
U(Âµ) =

u(x) Âµ(dx)
for all Âµ âˆˆM,
(2.3)
where u is a real function on S.
Deï¬nition 2.17. A numerical representation U of a preference order â‰»on M is called
a von Neumannâ€“Morgenstern representation if it is of the form (2.3).
Any von Neumannâ€“Morgenstern representation U is afï¬ne on M in the sense that
U(Î±Âµ + (1 âˆ’Î±)Î½) = Î±U(Âµ) + (1 âˆ’Î±)U(Î½)
for all Âµ, Î½ âˆˆM and Î± âˆˆ[0, 1]. It is easy to check that afï¬nity of U implies the
following two properties, or axioms, for a preference order â‰»on M. The ï¬rst property
says that a preference Âµ â‰»Î½ is preserved in any convex combination, independent of
the context described by another lottery Î».
Deï¬nition 2.18. A preference relation â‰»on M satisï¬es the independence axiom if,
for all Âµ, Î½ âˆˆM, the relation Âµ â‰»Î½ implies
Î±Âµ + (1 âˆ’Î±)Î» â‰»Î±Î½ + (1 âˆ’Î±)Î»
for all Î» âˆˆM and all Î± âˆˆ(0, 1].

52
2 Preferences
The independence axiom is also called the substitution axiom. It can be illustrated
by introducing a compound lottery, which represents the distribution Î±Âµ + (1 âˆ’Î±)Î»
as a two-step procedure. First, we sample either lottery Âµ or Î» with probability Î± and
1 âˆ’Î±, respectively. Then the lottery drawn in this ï¬rst step is realized. Clearly, this
is equivalent to playing directly the lottery Î±Âµ + (1 âˆ’Î±)Î». With probability 1 âˆ’Î±,
the distribution Î» is drawn and in this case there is no difference to the compound
lottery where Î½ is replaced by Âµ. The only difference occurs when Âµ is drawn, and
this happens with probability Î±. Thus, if Âµ â‰»Î½ then it seems reasonable to prefer the
compound lottery with Âµ over the one with Î½.
Deï¬nition 2.19. A preference relation â‰»on M satisï¬es the Archimedean axiom if for
any triple Âµ â‰»Î» â‰»Î½ there are Î±, Î² âˆˆ(0, 1) such that
Î±Âµ + (1 âˆ’Î±)Î½ â‰»Î» â‰»Î²Âµ + (1 âˆ’Î²)Î½.
The Archimedean axiom derives its name from its similarity to the Archimedean
principle in real analysis: For every small Îµ > 0 and each large x, there is some
n âˆˆN such that n Îµ > x. Sometimes it is also called the continuity axiom, because
it can act as a substitute for the continuity of â‰»in a suitable topology on M. More
precisely, suppose that M is endowed with a topology for which convex combinations
are continuous curves, i.e., Î±Âµ + (1 âˆ’Î±)Î½ converges to Î½ or Âµ as Î± â†“0 or Î± â†‘1,
respectively. Then continuity of our preference order â‰»in this topology automatically
implies the Archimedean axiom.
Remark 2.20. Asanaxiomforconsistentbehaviorinthefaceofrisk, theArchimedean
axiom is less intuitive than the independence axiom. Consider the following three de-
terministic distributions: Î½ yields 1000 â‚¬, Î» yields 10 â‚¬, and Âµ is the lottery where one
dies for sure. Even for small Î± âˆˆ(0, 1) it is not clear that someone would prefer the
gamble Î±Âµ + (1 âˆ’Î±)Î½, which involves the probability Î± of dying, over the conserva-
tive 10 â‚¬ yielded by Î». Note, however, that most people would not hesitate to drive a
car for a distance of 50 km in order to receive a premium of 1000 â‚¬, even though this
might involve the risk of a deadly accident.
â™¦
Our ï¬rst goal is to show that the Archimedean axiom and the independence axiom
imply the existence of an afï¬ne numerical representation.
Theorem 2.21. Suppose that â‰»is a preference relation on M satisfying both the
Archimedean and the independence axiom. Then there exists an afï¬ne numerical
representation U of â‰». Moreover, U is unique up to positive afï¬ne transformations,
i.e., any other afï¬ne numerical representation 
U with these properties is of the form

U = a U + b for some a > 0 and b âˆˆR.
In two important cases, such an afï¬ne numerical representation will already be of
von Neumannâ€“Morgenstern form. This is the content of the following two corollaries,
which we state before provingTheorem 2.21. For the ï¬rst corollary, we need the notion

2.2 Von Neumannâ€“Morgenstern representation
53
of a simple probability distribution. This is a probability measure Âµ on S which can be
written as a ï¬nite convex combination of Dirac masses, i.e., there exist x1, . . . , xN âˆˆS
and Î±1, . . . , Î±N âˆˆ(0, 1] such that
Âµ =
N

i=1
Î±iÎ´xi.
Corollary 2.22. Suppose that M is the set of all simple probability distributions on S
and that â‰»is a preference order on M that satisï¬es both the Archimedean and the in-
dependence axiom. Then there exists a von Neumannâ€“Morgenstern representation U.
Moreover, both U and u are unique up to positive afï¬ne transformations.
Proof. Let U be an afï¬ne numerical representation, which exists by Theorem 2.21. We
deï¬ne u(x) := U(Î´x), for x âˆˆS. If Âµ âˆˆM is of the form Âµ = Î±1Î´x1 + Â· Â· Â· + Î±NÎ´xN ,
then afï¬nity of U implies
U(Âµ) =
N

i=1
Î±iU(Î´xi) =

u(x) Âµ(dx).
This is the desired von Neumannâ€“Morgenstern representation.
Onaï¬nitesetS, everyprobabilitymeasureissimple. Thus, weobtainthefollowing
result as a special case.
Corollary 2.23. Suppose that M is the set of all probability distributions on a ï¬nite
set S and that â‰»is a preference order on M that satisï¬es both the Archimedean and the
independence axiom. Then there exists a von Neumannâ€“Morgenstern representation,
and it is unique up to positive afï¬ne transformations.
For the proof of Theorem 2.21, we need the following auxiliary lemma. Its ï¬rst as-
sertion states that taking convex combination is monotone with respect to a preference
order â‰»satisfying our two axioms. Its second part can be regarded as an â€œintermediate
value theoremâ€ for straight lines in M, and (c) is the analogue of the independence
axiom for the indifference relation âˆ¼.
Lemma 2.24. Under the assumptions of Theorem 2.21, the following assertions are
true.
(a) If Âµ â‰»Î½, then Î± â†’Î±Âµ + (1 âˆ’Î±)Î½ is strictly increasing with respect to â‰».
More precisely, Î²Âµ + (1 âˆ’Î²)Î½ â‰»Î±Âµ + (1 âˆ’Î±)Î½ for 0 â‰¤Î± < Î² â‰¤1.
(b) If Âµ â‰»Î½ and Âµ âª°Î» âª°Î½, then there exists a unique Î± âˆˆ[0, 1] with Î» âˆ¼
Î±Âµ + (1 âˆ’Î±)Î½.
(c) If Âµ âˆ¼Î½, then Î±Âµ+(1âˆ’Î±)Î» âˆ¼Î±Î½ +(1âˆ’Î±)Î» for all Î± âˆˆ[0, 1] and all Î» âˆˆM.

54
2 Preferences
Proof. (a): Let Î» := Î²Âµ + (1 âˆ’Î²)Î½. The independence axiom implies that Î» â‰»
Î²Î½ + (1 âˆ’Î²)Î½ = Î½. Hence, for Î³ := Î±/Î²,
Î²Âµ + (1 âˆ’Î²)Î½ = (1 âˆ’Î³ )Î» + Î³ Î» â‰»(1 âˆ’Î³ )Î½ + Î³ Î» = Î±Âµ + (1 âˆ’Î±)Î½.
(b): Part (a) guarantees that Î± is unique if it exists. To show existence, we need
only to consider the case Âµ â‰»Î» â‰»Î½, for otherwise we can take either Î± = 0 or Î± = 1.
The natural candidate is
Î± := sup{ Î³ âˆˆ[0, 1] | Î» âª°Î³ Âµ + (1 âˆ’Î³ )Î½ }.
If Î» âˆ¼Î±Âµ + (1 âˆ’Î±)Î½ is not true, then one of the following two possibilities must
occur:
Î» â‰»Î±Âµ + (1 âˆ’Î±)Î½,
or
Î» â‰ºÎ±Âµ + (1 âˆ’Î±)Î½.
(2.4)
In the ï¬rst case, we apply the Archimedean axiom to obtain some Î² âˆˆ(0, 1) such that
Î» â‰»Î²

Î±Âµ + (1 âˆ’Î±)Î½

+ (1 âˆ’Î²)Âµ = Î³ Âµ + (1 âˆ’Î³ )Î½
(2.5)
for Î³ = 1 âˆ’Î²(1 âˆ’Î±).
Since Î³ > Î±, it follows from the deï¬nition of Î± that
Î³ Âµ + (1 âˆ’Î³ )Î½ â‰»Î», which contradicts (2.5). If the second case in (2.4) occurs, the
Archimedean axiom yields some Î² âˆˆ(0, 1) such that
Î²

Î±Âµ + (1 âˆ’Î±)Î½

+ (1 âˆ’Î²)Î½ = Î²Î±Âµ + (1 âˆ’Î²Î±)Î½ â‰»Î».
(2.6)
Clearly Î²Î± < Î±, so that the deï¬nition of Î± yields some Î³ âˆˆ(Î²Î±, Î±] with Î» âª°
Î³ Âµ + (1 âˆ’Î³ )Î½. Part (a) and the fact that Î²Î± < Î³ imply that
Î» âª°Î³ Âµ + (1 âˆ’Î³ )Î½ â‰»Î²Î±Âµ + (1 âˆ’Î²Î±)Î½,
which contradicts (2.6).
(c): We must exclude both of the following two possibilities
Î±Âµ + (1 âˆ’Î±)Î» â‰»Î±Î½ + (1 âˆ’Î±)Î»
and
Î±Î½ + (1 âˆ’Î±)Î» â‰»Î±Âµ + (1 âˆ’Î±)Î». (2.7)
To this end, we may assume that there exists some Ï âˆˆM with Ï Ì¸âˆ¼Âµ âˆ¼Î½; otherwise
the result is trivial. Let us assume that Ï â‰»Âµ âˆ¼Î½; the case in which Âµ âˆ¼Î½ â‰»Ï
is similar. Suppose that the ï¬rst possibility in (2.7) would occur. The independence
axiom yields
Î²Ï + (1 âˆ’Î²)Î½ â‰»Î²Î½ + (1 âˆ’Î²)Î½ = Î½ âˆ¼Âµ
for all Î² âˆˆ(0, 1). Therefore,
Î±

Î²Ï + (1 âˆ’Î²)Î½

+ (1 âˆ’Î±)Î» â‰»Î±Âµ + (1 âˆ’Î±)Î»
for all Î² âˆˆ(0, 1).
(2.8)
Using our assumption that the ï¬rst possibilities in (2.7) is occurring, we obtain from
part (b) a unique Î³ âˆˆ(0, 1) such that, for any ï¬xed Î²,
Î±Âµ + (1 âˆ’Î±)Î» âˆ¼Î³

Î±

Î²Ï + (1 âˆ’Î²)Î½

+ (1 âˆ’Î±)Î»

+ (1 âˆ’Î³ )[ Î±Î½ + (1 âˆ’Î±)Î» ]
= Î±

Î²Î³Ï + (1 âˆ’Î²Î³ )Î½

+ (1 âˆ’Î±)Î»
â‰»Î±Âµ + (1 âˆ’Î±)Î»,

2.2 Von Neumannâ€“Morgenstern representation
55
where we have used (2.8) for Î² replaced by Î²Î³ in the last step. This is a contradiction.
The second possibility in (2.7) is excluded by an analogous argument.
Proof of Theorem 2.21. For the construction of U, we ï¬rst ï¬x two lotteries Î» and Ï
with Î» â‰»Ï and deï¬ne
M(Î», Ï) := { Âµ âˆˆM | Î» âª°Âµ âª°Ï };
the assertion is trivial if no such pair Î» â‰»Ï exists. If Âµ âˆˆM(Î», Ï), part (b) of
Lemma 2.24 yields a unique Î± âˆˆ[0, 1] such that Âµ âˆ¼Î±Î» + (1 âˆ’Î±)Ï, and we put
U(Âµ) := Î±. To prove that U is a numerical representation of â‰»on M(Î», Ï), we must
show that for Î½, Âµ âˆˆM(Î», Ï) we have U(Âµ) > U(Î½) if and only if Âµ â‰»Î½. To prove
sufï¬ciency, we apply part (a) of Lemma 2.24 to conclude that
Âµ âˆ¼U(Âµ)Î» +

1 âˆ’U(Âµ)

Ï â‰»U(Î½)Î» +

1 âˆ’U(Î½)

Ï âˆ¼Î½,
Hence Âµ â‰»Î½. Conversely, if Âµ â‰»Î½ then the preceding arguments already imply that
we cannot have U(Î½) > U(Âµ). Thus, it sufï¬ces to rule out the case U(Âµ) = U(Î½).
But if U(Âµ) = U(Î½), then the deï¬nition of U yields Âµ âˆ¼Î½, which contradicts Âµ â‰»Î½.
We conclude that U is indeed a numerical representation of â‰»restricted to M(Î», Ï).
Let us now show that M(Î», Ï) is a convex set. Take Âµ, Î½ âˆˆM(Î», Ï) and Î± âˆˆ[0, 1].
Then
Î» âª°Î±Î» + (1 âˆ’Î±)Î½ âª°Î±Âµ + (1 âˆ’Î±)Î½,
using the independence axiom to handle the cases Î» â‰»Î½ and Î» â‰»Âµ, and part (c)
of Lemma 2.24 for Î» âˆ¼Î½ and for Î» âˆ¼Âµ. By the same argument it follows that
Î±Âµ + (1 âˆ’Î±)Î½ âª°Ï, which implies the convexity of the set M(Î», Ï).
Therefore, U(Î±Âµ + (1 âˆ’Î±)Î½) is well deï¬ned; we proceed to show that it equals
Î±U(Âµ) + (1 âˆ’Î±)U(Î½). To this end, we apply part (c) of Lemma 2.24 twice:
Î±Âµ + (1 âˆ’Î±)Î½ âˆ¼Î±

U(Âµ)Î» +

1 âˆ’U(Âµ)

Ï

+ (1 âˆ’Î±)

U(Î½)Î» +

1 âˆ’U(Î½)

Ï

=

Î±U(Âµ) + (1 âˆ’Î±)U(Î½)

Î» +

1 âˆ’Î±U(Âµ) âˆ’(1 âˆ’Î±)U(Î½)

Ï.
The deï¬nition of U and the uniqueness in part (b) of Lemma 2.24 imply that
U(Î±Âµ + (1 âˆ’Î±)Î½) = Î±U(Âµ) + (1 âˆ’Î±)U(Î½).
So U is indeed an afï¬ne numerical representation of â‰»on M(Î», Ï).
In a further step, we now show that the afï¬ne numerical representation U on
M(Î», Ï) is unique up to positive afï¬ne transformations. So let 
U be another afï¬ne
numerical representation of â‰»on M(Î», Ï), and deï¬ne
Ë†U(Âµ) :=

U(Âµ) âˆ’
U(Ï)

U(Î») âˆ’
U(Ï)
,
Âµ âˆˆM(Î», Ï).

56
2 Preferences
Then Ë†U is a positive afï¬ne transformation of 
U, and Ë†U(Ï) = 0 = U(Ï) as well as
Ë†U(Î») = 1 = U(Î»). Hence, afï¬nity of Ë†U and the deï¬nition of U imply
Ë†U(Âµ) = Ë†U

U(Âµ)Î» +

1 âˆ’U(Âµ)

Ï

= U(Âµ) Ë†U(Î») +

1 âˆ’U(Âµ)
 Ë†U(Ï) = U(Âµ)
for all Âµ âˆˆM(Î», Ï). Thus Ë†U = U.
Finally, we have to show that U can be extended as a numerical representation
to the full space M. To this end, we ï¬rst take Î», Ï âˆˆM such that M(Î», Ï) âŠƒ
M(Î», Ï). Bytheargumentsintheï¬rstpartofthisproof, thereexistsanafï¬nenumerical
representation 
U of â‰»on M(Î», Ï), and we may assume that 
U(Î») = 1 and 
U(Ï) =
0; otherwise we apply a positive afï¬ne transformation to 
U. By the previous step
of the proof, 
U coincides with U on M(Î», Ï), and so 
U is the unique consistent
extension of U. Since each lottery belongs to some set M(Î», Ï), the afï¬ne numerical
representation U can be uniquely extended to all of M.
Remark 2.25. In the proof of the preceding theorem, we did not use the fact that the
elements of M are probability measures. All that was needed was convexity of the set
M, theArchimedean, and the independence axiom. Yet, even the concept of convexity
can be generalized by introducing the notion of a mixture space; see, e.g., [138], [84],
or [112].
â™¦
Let us now return to the problem of constructing a von Neumannâ€“Morgenstern
representation for preference relations on distributions. If M is the set of all probability
measures on a ï¬nite set S, any afï¬ne numerical representation is already of this form, as
we saw in the proof of Corollary 2.23. However, the situation becomes more involved
if we take an inï¬nite set S. In fact, the following examples show that in this case a
von Neumannâ€“Morgenstern representation may not exist.
Example 2.26. Let M be the set of probability measures Âµ on S := {1, 2, . . . } for
which U(Âµ) := lim supkâ†‘âˆk Âµ(k) is ï¬nite. Clearly, U is afï¬ne and induces a prefer-
ence order on M which satisï¬es both the Archimedean and the independence axiom.
However, U obviously does not admit a von Neumannâ€“Morgenstern representation.
â™¦
Example 2.27. Let M be set the of all Borel probability measures on S = [0, 1], and
denote by Î» the Lebesgue measure on S. According to the Lebesgue decomposition
theorem, which is recalled in Theorem A.13, every Âµ âˆˆM can be decomposed as
Âµ = Âµs + Âµa,
where Âµs is singular with respect to Î», and Âµa is absolutely continuous. We deï¬ne a
function U : M â†’[0, 1] by
U(Âµ) :=

xÂµa(dx).

2.2 Von Neumannâ€“Morgenstern representation
57
It is easily seen that U is an afï¬ne function on M. Hence, U induces a preference
order â‰»on M which satisï¬es both the Archimedean and the independence axioms.
But â‰»cannot have a von Neumannâ€“Morgenstern representation: Since U(Î´x) = 0
for all x, the only possible choice for u in (2.3) would be u â‰¡0. So the preference
relation would be trivial in the sense that Âµ âˆ¼Î» for all Âµ âˆˆM, in contradiction for
instance to U(Î») = 1
2 and U(Î´ 1
2 ) = 0.
â™¦
One way to obtain a von Neumannâ€“Morgenstern representation is to assume ad-
ditional continuity properties of â‰», where continuity is understood in the sense of
Deï¬nition 2.8. As we have already remarked, the Archimedean axiom holds automat-
ically if taking convex combinations is continuous for the topology on M. This is
indeed the case for the weak topology on the set M1(S, S) of all probability measures
on a separable metric space S, endowed with the Ïƒ-ï¬eld S of Borel sets. The space S
will be ï¬xed for the rest of this section, and we will simply write M1(S) = M1(S, S).
Theorem 2.28. Let M := M1(S) be the space of all probability measures on S
endowed with the weak topology, and let â‰»be a continuous preference order on M
satisfying the independence axiom. Then there exists a von Neumannâ€“Morgenstern
representation
U(Âµ) =

u(x) Âµ(dx)
for which the function u : S â†’R is bounded and continuous. Moreover, U and u are
unique up to positive afï¬ne transformations.
Proof. Let Ms denote the set of all simple probability distributions on S. Since
continuity of â‰»implies the Archimedean axiom, we deduce from Corollary 2.22 that
â‰»restricted to Ms has a von Neumannâ€“Morgenstern representation.
Let us show that the function u in this representation is bounded. For instance, if
u is not bounded from above, then there are x0, x1, . . . âˆˆS such that u(x0) < u(x1)
and u(xn) > n. Now let
Âµn :=

1 âˆ’1
âˆšn

Î´x0 + 1
âˆšnÎ´xn.
Clearly, Âµn â†’Î´x0 weaklyasn â†‘âˆ. Thecontinuityofâ‰»togetherwiththeassumption
that Î´x1 â‰»Î´x0 imply that Î´x1 â‰»Âµn for all large n. However, U(Âµn) > âˆšn for all n,
in contradiction to Î´x1 â‰»Âµn.
Suppose that the function u is not continuous. Then there exists some x âˆˆS and a
sequence (xn)nâˆˆN âŠ‚S such that xn â†’x but u(xn) Ì¸â†’u(x). By taking a subsequence
if necessary, we can assume that u(xn) converges to some number a Ì¸= u(x). Suppose
that u(x) âˆ’a =: Îµ > 0. Then there exists some m such that |u(xn) âˆ’a| < Îµ/3 for all
n â‰¥m. Let Âµ := 1
2(Î´x + Î´xm). For all n â‰¥m
U(Î´x) = a + Îµ > a + 2Îµ
3 > 1
2

u(x) + u(xm)

= U(Âµ) > a + Îµ
3 > U(Î´xn).

58
2 Preferences
Therefore Î´x â‰»Âµ â‰»Î´xn, although Î´xn converges weakly to Î´x, in contradiction to the
continuity of â‰». The case u(x) < a is excluded in the same manner.
Let us ï¬nally show that
U(Âµ) :=

u(x) Âµ(dx)
for Âµ âˆˆM
deï¬nes a numerical representation of â‰»on all of M. Since u is bounded and con-
tinuous, U is continuous with respect to the weak topology on M. Moreover, Theo-
rem A.37 states that Ms is a dense subset of the connected metrizable space M. So
the proof is completed by an application of Lemma 2.16.
The scope of the preceding theorem is limited insofar as it involves only bounded
functions u. This will not be ï¬‚exible enough for our purposes. In the next section,
for instance, we will consider risk-averse preferences which are deï¬ned in terms of
concave functions u on the space S = R. Such a function cannot be bounded unless
it is constant. Thus, we must relax the conditions of the previous theorem. We will
present two approaches. In our ï¬rst approach, we ï¬x some point x0 âˆˆS and denote by
Br(x0) the closed metric ball of radius r around x0. The space of boundedly supported
measures on S is given by
Mb(S) :=

r>0
M1

Br(x0)

=

Âµ âˆˆM1(S) | Âµ

Br(x0)

= 1 for some r â‰¥0

.
Clearly, this deï¬nition does not depend on the particular choice of x0.
Corollary 2.29. Let â‰»be a preference order on Mb(S) whose restriction to each
space M1

Br(x0)

is continuous with respect to the weak topology. If â‰»satisï¬es the
independence axiom, then there exists a von Neumannâ€“Morgenstern representation
U(Âµ) =

u(x) Âµ(dx)
with a continuous function u : S â†’R. Moreover, U and u are unique up to positive
afï¬ne transformations.
Proof. Theorem 2.28 yields a von Neumannâ€“Morgenstern representation of the re-
striction of â‰»to M1

Br(x0)

in terms of some continuous function ur : Br(x0) â†’R.
The uniqueness part of the theorem implies that the restriction of ur to some smaller
ball Brâ€²(x0) must be a equal to urâ€² up to a positive afï¬ne transformation. Thus, it is
possible to ï¬nd a unique continuous extension u : S â†’R of urâ€² which deï¬nes a von
Neumannâ€“Morgenstern representation of â‰»on each set M1

Br(x0)

.
Our second variant of Theorem 2.28 includes measures with unbounded support,
but we need stronger continuity assumptions. Let Ïˆ be a continuous function with

2.2 Von Neumannâ€“Morgenstern representation
59
values in [1, âˆ) on the separable metric space S. We use Ïˆ as a gauge function and
deï¬ne
MÏˆ
1 (S) :=
$
Âµ âˆˆM1(S)


Ïˆ(x) Âµ(dx) < âˆ
%
.
A suitable space of continuous test functions for measures in MÏˆ
1 (S) is provided by
CÏˆ(S) :=

f âˆˆC(S) | âˆƒc : |f (x)| â‰¤c Â· Ïˆ(x) for all x âˆˆS

.
These test functions can now be used to deï¬ne a topology on MÏˆ
1 (S) in precisely
the same way one uses the set of bounded continuous function to deï¬ne the weak
topology: A sequence (Âµn) in MÏˆ
1 (S) converges to some Âµ âˆˆMÏˆ
1 (S) if and only if

f dÂµn âˆ’â†’

f dÂµ
for all f âˆˆCÏˆ(S).
To be rigorous, one should ï¬rst deï¬ne a neighborhood base for the topology and
then check that this topology is metrizable, so that it sufï¬ces indeed to consider the
convergence of sequences; the reader will ï¬nd all necessary details in Appendix A.6.
We will call this topology the Ïˆ-weak topology on MÏˆ
1 (S). If we take the trivial
case Ïˆ â‰¡1, CÏˆ(S) consists of all bounded continuous functions, and we recover the
standard weak topology on M1
1(S) = M1(S). However, by taking Ïˆ as some non-
bounded function, we can also include von Neumannâ€“Morgenstern representations in
terms of unbounded functions u. The following theorem is a version of Theorem 2.28
for the Ïˆ-weak topology. Its proof is analogous to that of Theorem 2.28, and we leave
it to the reader to ï¬ll in the details.
Theorem 2.30. Let â‰»be a preference order on MÏˆ
1 (S) that is continuous in the Ïˆ-
weak topology and satisï¬es the independence axiom. Then there exists a numerical
representation U of von Neumannâ€“Morgenstern form
U(Âµ) =

u(x) Âµ(dx)
with a function u âˆˆCÏˆ(S). Moreover, U and u are unique up to positive afï¬ne
transformations.
Remark 2.31. Instead of making topological assumptions on â‰», one can introduce,
in addition to the Archimedean and the independence axiom, the so-called sure-thing
principle: For Âµ, Î½ âˆˆM and A âˆˆS such that Âµ(A) = 1:
Î´x â‰»Î½ for all x âˆˆA
"â‡’
Âµ â‰»Î½,
and
Î½ â‰»Î´x for all x âˆˆA
"â‡’
Î½ â‰»Âµ.
This axiom, together with a couple of technical assumptions, guarantees the existence
of a von Neumannâ€“Morgenstern representation; see [84]. Conversely, it is easy to

60
2 Preferences
see that the sure-thing principle is automatically implied by the existence of a von
Neumannâ€“Morgenstern representation. Note that the sure-thing principle is violated
in both Examples 2.26 and 2.27.
â™¦
So far, we have presented the classical theory of expected utility, starting with the
independence axiom and the Archimedean axiom. However, it is well known that in
reality people may not behave according to this paradigm.
Example 2.32 (Allais Paradox). The so-called Allais paradox questions the descrip-
tive aspect of expected utility by considering the following lotteries. Lottery
Î½1 = 0.33 Î´2500 + 0.66 Î´2400 + 0.01 Î´0
yields 2500 â‚¬ with a probability of 0.33, 2400 â‚¬ with probability 0.66, and draws a
blank with the remaining probability of 0.01. Lottery
Âµ1 := Î´2400
yields 2400 â‚¬ for sure. When asked, most people prefer the sure amount â€“ even though
lottery Î½1 has the larger expected value, namely 2409 â‚¬.
Next, consider the following two lotteries Âµ2 and Î½2:
Âµ2 := 0.34 Î´2400 + 0.66 Î´0
and
Î½2 := 0.33 Î´2500 + 0.67 Î´0.
Here people tend to prefer the slightly riskier lottery Î½2 over Âµ2, in accordance with
the expectations of Î½2 and Âµ2, which are 825 â‚¬ and 816 â‚¬, respectively.
This observation is due to M. Allais [4]. It was conï¬rmed by D. Kahnemann and
A. Tversky [123] in empirical tests where 82 % of interviewees preferred Âµ1 over
Î½1 while 83 % chose Î½2 rather than Âµ2. This means that at least 65 % chose both
Âµ1 â‰»Î½1 and Î½2 â‰»Âµ2. As pointed out by M. Allais, this simultaneous choice leads
to a â€œparadoxâ€ in the sense that it is inconsistent with the von Neumannâ€“Morgen-
stern paradigm. More precisely, any preference relation â‰»for which Âµ1 â‰»Î½1 and
Î½2 â‰»Âµ2 are both valid violates the independence axiom, as we will show now. If the
independence axiom were satisï¬ed, then necessarily
Î±Âµ1 + (1 âˆ’Î±)Î½2 â‰»Î±Î½1 + (1 âˆ’Î±)Î½2 â‰»Î±Î½1 + (1 âˆ’Î±)Âµ2
for all Î± âˆˆ(0, 1). By taking Î± = 1/2 we would arrive at
1
2(Âµ1 + Î½2) â‰»1
2(Î½1 + Âµ2)
which is a contradiction to the fact that
1
2(Âµ1 + Î½2) = 1
2(Î½1 + Âµ2).
Therefore, the independence axiom was violated by at least 65 % of the people who
wereinterviewed. ThiseffectisempiricalevidenceagainstthevonNeumannâ€“Morgen-
stern theory as a descriptive theory. Even from a normative point of view, there are
good reasons to go beyond our present setting, and this will be done in Section 2.5.
In particular, we will take a second look at the Allais paradox in Remark 2.74.
â™¦

2.3 Expected utility
61
2.3 Expected utility
In this section, we focus on individual ï¬nancial assets under the assumption that their
payoff distributions at a ï¬xed time are known, and without any regard to hedging
opportunities in the context of a ï¬nancial market model. Such asset distributions may
be viewed as lotteries with monetary outcomes in some interval S âŠ‚R. Thus, we
take M as a ï¬xed set of Borel probability measures on S. In this setting, we discuss
the paradigm of expected utility in its standard form, where the function u appearing
in the von Neumannâ€“Morgenstern representation has additional properties suggested
by the monetary interpretation. We introduce risk aversion and certainty equivalents,
and illustrate these notions with a number of examples.
Throughout this section, we assume that M is convex and contains all point masses
Î´x for x âˆˆS. We assume also that each Âµ âˆˆM has a well-deï¬ned expectation
m(Âµ) :=

x Âµ(dx) âˆˆR.
Remark 2.33. For an asset whose (discounted) random payoff has a known distri-
bution Âµ, the expected value m(Âµ) is often called the fair price of the asset. For
an insurance contract where Âµ is the distribution of payments to be received by the
insured party in dependence of some random damage within a given period, the ex-
pected value m(Âµ) is also called the fair premium. Typically, actual asset prices and
actual insurance premiums will be different from these values. In many situations,
such differences can be explained within the conceptual framework of expected utility,
and in particular in terms of risk aversion.
â™¦
Deï¬nition 2.34. A preference relation â‰»on M is called monotone if
x > y implies Î´x â‰»Î´y.
The preference relation is called risk averse if for Âµ âˆˆM
Î´m(Âµ) â‰»Âµ
unless Âµ = Î´m(Âµ).
It is easy to characterize these properties within the class of preference relations
which admit a von Neumannâ€“Morgenstern representation.
Proposition 2.35. Suppose the preference relation â‰»has a von Neumannâ€“Morgen-
stern representation
U(Âµ) =

u dÂµ.
Then:
(a) â‰»is monotone if and only if u is strictly increasing.
(b) â‰»is risk averse if and only if u is strictly concave.

62
2 Preferences
Proof. (a): Monotonicity is equivalent to
u(x) = U(Î´x) > U(Î´y) = u(y)
for x > y.
(b): If â‰»is risk-averse, then
Î´Î±x+(1âˆ’Î±)y â‰»Î± Î´x + (1 âˆ’Î±)Î´y
holds for all distinct x, y âˆˆS and Î± âˆˆ(0, 1). Hence,
u

Î±x + (1 âˆ’Î±)y

> Î± u(x) + (1 âˆ’Î±)u(y),
i.e., u is strictly concave. Conversely, if u is strictly concave, then Jensenâ€™s inequality
implies risk aversion:
U(Î´m(Âµ)) = u
 
x Âµ(dx)

â‰¥

u(x) Âµ(dx) = U(Âµ)
with equality if and only if Âµ = Î´m(Âµ).
Remark 2.36. In view of the monetary interpretation of the state space S, it is natural
to assume that the preference relation â‰»is monotone. The assumption of risk aversion
ismoredebatable, atleastfromadescriptivepointofview. Infact, thereisconsiderable
empirical evidence that agents tend to switch between risk aversion and risk seeking
behavior, depending on the context. In particular, they may be risk averse after prior
gains, and they may become risk seeking if they see an opportunity to compensate
prior losses. Tversky and Kahneman [194] propose to describe such a behavioral
pattern by a function u of the form
u(x) =

(x âˆ’c)Î³
for x â‰¥c,
âˆ’Î»(c âˆ’x)Î³
for x < c,
where c is a given benchmark level, and their experiments suggest parameter values
Î» around 2 and Î³ slightly less than 1. Nevertheless, one can insist on risk aversion
from a normative point of view, and this is the approach we will take for the purposes
in this book.
â™¦
Deï¬nition 2.37. A function u : S â†’R is called a utility function if it is strictly
concave, strictly increasing, and continuous on S.
Any increasing concave function u : S â†’R is necessarily continuous on every
interval (a, b] âŠ‚S; see Proposition A.4. Hence, the condition of continuity in the
preceding deï¬nition is only relevant if S contains its lower boundary point. Note that
any utility function u(x) decreases at least linearly as x â†“inf S. Therefore, u cannot
be bounded from below unless inf S > âˆ’âˆ.

2.3 Expected utility
63
From now on, we will consider a ï¬xed preference relation â‰»on M which admits
an expected utility representation, that is, a von Neumannâ€“Morgenstern representation
U(Âµ) =

u dÂµ
in terms of a utility function u : S â†’R. The intermediate value theorem applied
to the strictly increasing continuous function u yields for any Âµ âˆˆM a unique real
number c(Âµ) for which
u

c(Âµ)

= U(Âµ) =

u dÂµ.
(2.9)
It follows that
Î´c(Âµ) âˆ¼Âµ,
i.e., there is indifference between the lottery Âµ and the sure amount of money c(Âµ).
Deï¬nition 2.38. The certainty equivalent of the lottery Âµ âˆˆM is deï¬ned as the
number c(Âµ) of (2.9), and
Ï(Âµ) := m(Âµ) âˆ’c(Âµ)
is called the risk premium of Âµ.
Risk aversion implies via Jensenâ€™s inequality that c(Âµ) â‰¤m(Âµ), and
c(Âµ) < m(Âµ)
â‡â‡’
Âµ Ì¸= Î´m(Âµ).
In particular, the risk premium Ï(Âµ) is strictly positive as soon as the distribution Âµ
carries any risk.
Remark 2.39. The certainty equivalent c(Âµ) can be viewed as an upper bound for
any price of Âµ which would be acceptable to an economic agent with utility function
u. Thus, the fair price m(Âµ) must be reduced at least by the risk premium Ï(Âµ) if
one wants the agent to buy the asset distribution Âµ. Alternatively, suppose that the
agent holds an asset with distribution Âµ. Then the risk premium may be viewed as the
amount that the agent would be ready to pay for replacing the asset by its expected
value m(Âµ).
â™¦
Example 2.40 (â€œSt. Petersburg Paradoxâ€). Consider the lottery
Âµ =
âˆ

n=1
2âˆ’nÎ´2nâˆ’1
which may be viewed as the payoff distribution of the following game. A fair coin
is tossed until a head appears. If the head appears on the nth toss, the payoff will
be 2nâˆ’1 â‚¬. Up to the early 18th century, it was commonly accepted that the price
of a lottery should be computed as the fair price, i.e., as the expected value m(Âµ).

64
2 Preferences
In the present example, the fair price is given by m(Âµ) = âˆ, but it is hard to ï¬nd
someone who is ready to pay even 20 â‚¬. In view of this â€œparadoxâ€, posed by Nicholas
Bernoulli in 1713, Gabriel Cramer and Daniel Bernoulli [22] independently introduced
the idea of determining the actual price as a certainty equivalent with respect to a utility
function. For the two utility functions
u1(x) = âˆšx
and
u2(x) = log x
proposed, respectively, by G. Cramer and by D. Bernoulli, these certainty equivalents
are given by
c1(Âµ) =

2 âˆ’
âˆš
2
âˆ’2 â‰ˆ2.91
and
c2(Âµ) = 2,
and this is within the range of prices people are usually ready to pay. Note, however,
that for any utility function which is unbounded from above we could modify the
payoff in such a way that the paradox reappears. For example, we could replace
the payoff 2n by uâˆ’1(2n) for n â‰¥1000, so that

u dÂµ = +âˆ. The choice of a
bounded utility function would remove this difï¬culty, but would create others; see the
discussion on pp. 69â€“72.
â™¦
Given the preference order â‰»on M, we can now try to determine those distribu-
tions in M which are maximal with respect to â‰». As a ï¬rst illustration, consider the
following simple optimization problem. Let X be an integrable random variable on
some probability space (, F , P) with non-degenerate distribution Âµ. We assume
that X is bounded from below by some number a in the interior of S. Which is the
best mix
XÎ» := (1 âˆ’Î»)X + Î»c
of the risky payoff X and the certain amount c, that also belongs to the interior of S?
If we evaluate XÎ» by its expected utility E[ u(XÎ») ] and denote by ÂµÎ» the distribution
of XÎ» under P, then we are looking for a maximum of the function f on [0, 1] deï¬ned
by
f (Î») := U(ÂµÎ») =

u dÂµÎ».
Since f is strictly concave, it attains its maximum in a unique point Î»âˆ—âˆˆ[0, 1].
Proposition 2.41.
(a) We have Î»âˆ—= 1 if E[ X ] â‰¤c, and Î»âˆ—> 0 if c â‰¥c(Âµ).
(b) If u is differentiable, then
Î»âˆ—= 1
â‡â‡’
E[ X ] â‰¤c
and
Î»âˆ—= 0
â‡â‡’
c â‰¤E[ Xuâ€²(X) ]
E[ uâ€²(X) ] .

2.3 Expected utility
65
Proof. (a): Jensenâ€™s inequality yields that
f (Î») â‰¤u

E[ XÎ» ]

= u

(1 âˆ’Î»)E[ X ] + Î»c

,
with equality if and only if Î» = 1. It follows that Î»âˆ—= 1 if the right-hand side is
increasing in Î», i.e., if E[ X ] â‰¤c.
Strict concavity of u implies
f (Î») â‰¥E

(1 âˆ’Î»)u(X) + Î»u(c)

= (1 âˆ’Î»)u

c(Âµ)

+ Î»u(c),
with equality if and only if Î» âˆˆ{0, 1}. The right-hand side is increasing in Î» if
c â‰¥c(Âµ), and this implies Î»âˆ—> 0.
(b): Clearly, we have Î»âˆ—= 0 if and only if the right-hand derivative f â€²
+ of f
satisï¬es f â€²
+(0) â‰¤0; see Appendix A.1 for the deï¬nition of f â€²
+ and f â€²
âˆ’. Note that the
difference quotients
u(XÎ») âˆ’u(X)
Î»
= u(XÎ») âˆ’u(X)
XÎ» âˆ’X
Â· (c âˆ’X)
are P-a.s. bounded by
uâ€²
+(a âˆ§c)|c âˆ’X| âˆˆL1(P )
and that they converge to
uâ€²
+(X)(c âˆ’X)+ âˆ’uâ€²
âˆ’(X)(c âˆ’X)âˆ’
as Î» â†“0. By Lebesgueâ€™s theorem, this implies
f â€²
+(0) = E[ uâ€²
+(X)(c âˆ’X)+ ] âˆ’E[ uâ€²
âˆ’(X)(c âˆ’X)âˆ’].
If u is differentiable, or if the countable set { x | uâ€²
+(x) Ì¸= uâ€²
âˆ’(x) } has Âµ-measure 0,
then we can conclude
f â€²
+(0) = E[ uâ€²(X)(c âˆ’X) ],
i.e., f â€²
+(0) â‰¤0 if and only if
c â‰¤E[ Xuâ€²(X) ]
E[ uâ€²(X) ] .
In the same way, we obtain
f â€²
âˆ’(1) = uâ€²
âˆ’(c)E[ (X âˆ’c)âˆ’] âˆ’uâ€²
+(c)E[ (X âˆ’c)+ ].
If u is differentiable at c, then we can conclude
f â€²
âˆ’(1) = uâ€²(c)

c âˆ’E[ X ]

.
This implies f â€²
âˆ’(1) < 0, and hence Î»âˆ—< 1, if and only if E[ X ] > c.

66
2 Preferences
Remark 2.42. Note that for a differentiable utility function u we have
m(Âµ) > c(Âµ) â‰¥E[ uâ€²(X)X ]
E[ uâ€²(X) ] .
(2.10)
Indeed, concavity of u âˆˆC1(R) implies
E[ u(X) ] + E[ uâ€²(X)(c âˆ’X) ] â‰¥u(c),
hence E[ uâ€²(X)(c âˆ’X) ] â‰¥0 for c = c(Âµ).
â™¦
Example 2.43 (Demand for a risky asset). Let S = S1 be a risky asset with price
Ï€ = Ï€1. Given an initial wealth w, an agent with utility function u âˆˆC1 can invest a
fraction (1 âˆ’Î»)w into the asset and the remaining part Î»w into a risk-free bond with
interest rate r. The resulting payoff is
XÎ» = (1 âˆ’Î»)w
Ï€
(S âˆ’Ï€) + Î»w Â· r.
The preceding proposition implies that there will be no investment into the risky asset
if and only if
E

S
1 + r

â‰¤Ï€.
In other words, the price of the risky asset must be below its expected discounted
payoff in order to attract any risk averse investor, and in that case it will indeed be
optimal for the investor to invest at least some amount. Instead of the simple linear
proï¬les XÎ», the investor may wish to consider alternative forms of investment. For
example, this may involve derivatives such as max(S, K) = K + (S âˆ’K)+ for some
threshold K. In order to discuss such non-linear payoff proï¬les, we need an extended
formulation of the optimization problem; see Section 3.3 below.
â™¦
Example 2.44 (Demand for insurance). Suppose an agent with utility function u âˆˆ
C1 considers taking at least some partial insurance against a random loss Y, with
0 â‰¤Y â‰¤w and P [ Y Ì¸= E[ Y ] ] > 0, where w is a given initial wealth. If insurance
of Î»Y is available at the insurance premium Î»Ï€, the resulting ï¬nal payoff is given by
XÎ» := w âˆ’Y + Î»(Y âˆ’Ï€) = (1 âˆ’Î»)(w âˆ’Y) + Î»(w âˆ’Ï€).
By Proposition 2.41, full insurance is optimal if and only if Ï€ â‰¤E[ Y ]. In reality,
however, the insurance premium Ï€ will exceed the â€œfair premiumâ€ E[ Y ]. In this
case, it will be optimal to insure only a fraction Î»âˆ—Y of the loss, with Î»âˆ—âˆˆ[0, 1). This
fraction will be strictly positive as long as
Ï€ < E[ Yuâ€²(w âˆ’Y) ]
E[ uâ€²(w âˆ’Y) ] = w âˆ’E[ (w âˆ’Y)uâ€²(w âˆ’Y) ]
E[ uâ€²(w âˆ’Y) ]
.

2.3 Expected utility
67
Since the right-hand side is strictly larger than E[ Y ] due to (2.10), risk aversion
may create a demand for insurance even if the insurance premium Ï€ lies above the
â€œfairâ€ price E[ Y ]. As in the previous example, the agent may wish to consider
alternative forms of insurance such as a stop-loss contract whose payoff has the non-
linear structure (Y âˆ’K)+ of a call option.
â™¦
LetustakeanotherlookattheriskpremiumÏ(Âµ)ofalotteryÂµ. Foranapproximate
calculation, we consider the Taylor expansion of a sufï¬ciently smooth utility function
u(x) at x = c(Âµ) around m := m(Âµ), and we assume that Âµ has ï¬nite variance var(Âµ).
On the one hand,
u

c(Âµ)

â‰ˆu(m) + uâ€²(m)(c(Âµ) âˆ’m) = u(m) âˆ’uâ€²(m)Ï(Âµ).
On the other hand,
u

c(Âµ)

=

u(x) Âµ(dx)
=
 
u(m) + uâ€²(m)(x âˆ’m) + 1
2uâ€²â€²(m)(x âˆ’m)2 + r(x)

Âµ(dx)
â‰ˆu(m) + 1
2uâ€²â€²(m) var(Âµ),
where r(x) denotes the remainder term in the Taylor expansion of u. It follows that
Ï(Âµ) â‰ˆâˆ’uâ€²â€²(m)
2 Â· uâ€²(m) var(Âµ) =: 1
2 Î±(m) var(Âµ).
(2.11)
Thus, Î±(m(Âµ)) is the factor by which an economic agent with utility function u weighs
the risk, measured by 1
2 var(Âµ), in order to determine the risk premium he or she is
ready to pay.
Deï¬nition 2.45. Suppose that u is a twice continuously differentiable utility function
on S. Then
Î±(x) := âˆ’uâ€²â€²(x)
uâ€²(x)
is called the Arrowâ€“Pratt coefï¬cient of absolute risk aversion of u at level x.
Example 2.46. The following classes of utility functions u and their corresponding
coefï¬cients of risk aversion are standard examples.
(a) Constant absolute risk aversion (CARA): Î±(x) equals some constant Î± > 0.
Since Î±(x) = âˆ’(log uâ€²)â€²(x), it follows that u(x) = aâˆ’bÂ·eâˆ’Î±x. Using an afï¬ne
transformation, u can be normalized to
u(x) = 1 âˆ’eâˆ’Î±x.

68
2 Preferences
(b) Hyperbolic absolute risk aversion (HARA): Î±(x) = (1âˆ’Î³ )/x on S = (0, âˆ)
for some Î³ < 1. Up to afï¬ne transformations, we have
u(x) = log x
for Î³ = 0,
u(x) = 1
Î³ xÎ³
for Î³ Ì¸= 0.
Sometimes, these functions are also called CRRA utility functions, because their
â€œrelative risk aversion" xÎ±(x) is constant. Of course, these utility functions can
be shifted to any interval S = (a, âˆ). The â€œrisk-neutralâ€ case Î³ = 1 would
correspond to an afï¬ne utility function u.
â™¦
Proposition 2.47. Suppose that u andu are two utility functions on S which are twice
continuously differentiable, and that Î± and Î± are the corresponding Arrowâ€“Pratt
coefï¬cients of absolute risk aversion. Then the following conditions are equivalent.
(a) Î±(x) â‰¥Î±(x) for all x âˆˆS.
(b) u = F â—¦u for a strictly increasing concave function F.
(c) The respective risk premiums Ï and Ï associated with u and u satisfy Ï(Âµ) â‰¥
Ï(Âµ) for all Âµ âˆˆM.
Proof. (a) â‡’(b): Since u is strictly increasing, we may deï¬ne its inverse function,
w. Then F(t) := u

w(t)

is clearly increasing, twice differentiable, and satisï¬es
u = F â—¦u. For showing that F is concave and strictly increasing we calculate the ï¬rst
two derivatives of w:
wâ€² =
1
uâ€²(w),
wâ€²â€² = Î±(w) Â·
1
uâ€²(w)2 .
Now we can calculate the ï¬rst two derivatives of F:
F â€² = uâ€²(w) Â· wâ€² = uâ€²(w)
uâ€²(w) > 0
and
F â€²â€² = uâ€²â€²(w)(wâ€²)2 + uâ€²(w)wâ€²â€²
= uâ€²(w)
uâ€²(w)2

Î±(w) âˆ’Î±(w)

(2.12)
â‰¤0.
This proves that F is concave and strictly increasing.
(b) â‡’(c): Jensenâ€™s inequality implies that the respective certainty equivalents c(Âµ)
and c(Âµ) satisfy
u(c(Âµ)) =

u dÂµ =

F â—¦u dÂµ
(2.13)
â‰¤F
 
u dÂµ

= F
u
c(Âµ)

= u(c(Âµ)).

2.3 Expected utility
69
Hence, Ï(Âµ) = m(Âµ) âˆ’c(Âµ) â‰¥m(Âµ) âˆ’c(Âµ) = Ï(Âµ).
(c) â‡’(a): If condition (a) is false, there exists an open interval O âŠ‚S such that
Î±(x) > Î±(x) for all x âˆˆO. Let 
O := u(O), and denote again by w the inverse
of u. Then the function F(t) = u

w(t)

will be strictly convex in the open interval

O by (2.12). Thus, if Âµ is a measure with support in O, the inequality in (2.13) is
reversed and is even strict â€“ unless Âµ is concentrated at a single point. It follows that
Ï(Âµ) < Ï(Âµ), which contradicts condition (c).
In view of the underlying axioms, the paradigm of expected utility has a certain
plausibility on a normative level, i.e., as a guideline of rational behavior in the face
of risk. But this guideline should be applied with care: If pushed too far, it may lead
to unplausible conclusions. In the remaining part of this section we discuss some
of these issues. From now on, we assume that S is unbounded from above, so that
w + x âˆˆS for any x âˆˆS and w â‰¥0. So far, we have implicitly assumed that the
preference relation â‰»on lotteries reï¬‚ects the views of an economic agent in a given set
of conditions, including a ï¬xed level w â‰¥0 of the agentâ€™s initial wealth. In particular,
the utility function may vary as the level of wealth changes, and so it should really
be indexed by w. Usually one assumes that uw is obtained by simply shifting a ï¬xed
utility function u to the level w, i.e., uw(x) := u(w +x). Thus, a lottery Âµ is declined
at a given level of wealth w if and only if

u(w + x) Âµ(dx) < u(w).
Let us now return to the situation of Proposition 2.41 when Âµ is the distribution of an
integrable random variable X on (, F , P), which is bounded from below by some
number a in the interior of S. We view X as the net payoff of some ï¬nancial bet, and
we assume that the bet is favorable in the sense that
m(Âµ) = E[ X ] > 0.
Remark 2.48. Even though the favorable bet X might be declined at a given level
w due to risk aversion, it follows from Proposition 2.41 that it would be optimal to
accept the bet at some smaller scale, i.e., there is some Î³ âˆ—> 0 such that
E[ u(w + Î³ âˆ—X) ] > u(w).
On the other hand, it follows from Lemma 2.50 below that the given bet X becomes
acceptable at a sufï¬ciently high level of wealth whenever the utility function is un-
bounded from above.
â™¦
Sometimes it is assumed that some favorable bet is declined at every level of
wealth. The assumption that such a bet exists is not as innocent as it may look. In fact
it has rather drastic consequences. In particular, we are going to see that it rules out
all utility functions in Example 2.46 except for the class of exponential utilities.

70
2 Preferences
Example 2.49. For any exponential utility function u(x) = 1 âˆ’eâˆ’Î±x with constant
risk aversion Î± > 0, the induced preference order on lotteries does not at all depend
on the initial wealth w. To see this, note that

u(w + x) Âµ(dx) <

u(w + x) Î½(dx)
is equivalent to

eâˆ’Î±x Âµ(dx) >

eâˆ’Î±x Î½(dx).
â™¦
Let us now show that the rejection of some favorable bet Âµ at every wealth level
w leads to a not quite plausible conclusion: At high levels of wealth, the agent would
reject a bet Î½ with huge potential gain even though the potential loss is just a negligible
fraction of the initial wealth.
Lemma 2.50. If the favorable bet Âµ is rejected at any level of wealth, then the utility
function u is bounded from above, and there exists A > 0 such that the bet
Î½ := 1
2(Î´âˆ’A + Î´âˆ)
is rejected at any level of wealth.
Proof. We have assumed that X is bounded from below, i.e., Âµ is concentrated on
[a, âˆ) for some a < 0, where a is in the interior of S. Moreover, we can choose
b > 0 such that
Âµ(B) := Âµ

B âˆ©[a, b]

+ Î´b(B) Â· Âµ

(b, âˆ)

is still favorable. Since u is increasing, we have

u(w + x) Âµ(dx) â‰¤

u(w + x) Âµ(dx) < u(w)
for any w â‰¥0, i.e., also the lottery Âµ is rejected at any level of wealth. It follows that

[0,b]

u(w + x) âˆ’u(w)

Âµ(dx) <

[a,0)

u(w) âˆ’u(w + x)

Âµ(dx).
Let us assume for simplicity that u is differentiable; the general case requires only
minor modiï¬cations. Then the previous inequality implies
uâ€²(w + b) m+(Âµ) < uâ€²(w + a) mâˆ’(Âµ),
where
m+(Âµ) :=

[0,b]
x Âµ(dx) >

[a,0]
(âˆ’x) Âµ(dx) =: mâˆ’(Âµ),

2.3 Expected utility
71
due to the fact that Âµ is favorable. Thus,
uâ€²(w + b)
uâ€²(w âˆ’|a|) < mâˆ’(Âµ)
m+(Âµ) =: Î³ < 1
for any w, hence
uâ€²
x + n(|a| + b)

< Î³ nuâ€²(x)
for any x in the interior of S.
This exponential decay of the derivative implies
u(âˆ) := limxâ†‘âˆu(x) < âˆ.
More precisely, if A := n(|a| + b) for some n,
then
u(âˆ) âˆ’u(x) =
âˆ

k=0
 x+(k+1)A
x+kA
uâ€²(y) dy
=
âˆ

k=0
 x
xâˆ’A
uâ€²(z + (k + 1)A) dz
<
âˆ

k=0
Î³ (k+1)n
 x
xâˆ’A
uâ€²(z) dz
=
Î³ n
1 âˆ’Î³ n

u(x) âˆ’u(x âˆ’A)

.
Take n such that Î³ n â‰¤1/2. Then we obtain
u(âˆ) âˆ’u(x) < u(x) âˆ’u(x âˆ’A),
i.e.,
1
2

u(âˆ) + u(x âˆ’A)

< u(x)
for all x such that x âˆ’A âˆˆS.
Example 2.51. For an exponential utility function u(x) = 1âˆ’eâˆ’Î±x, the bet Î½ deï¬ned
in the preceding lemma is rejected at any level of wealth as soon as A > 1
Î± log 2.
â™¦
Suppose now that the lottery Âµ âˆˆM is played not only once but n times in a row.
For instance, one can think of an insurance company selling identical policies to a large
number of individual customers. More precisely, let (, F , P ) be a probability space
supporting a sequence X1, X2, . . . of independent random variables with common
distribution Âµ. The value of Xi will be interpreted as the outcome of the ith drawing
of the lottery Âµ. The accumulated payoff of n successive independent repetitions of
the ï¬nancial bet X1 is given by
Zn :=
n

i=1
Xi,
and we assume that this accumulated payoff takes values in S; this is the case if, e.g.,
S = [0, âˆ).

72
2 Preferences
Remark 2.52. It may happen that an agent refuses the single favorable bet X at
any level of wealth but feels tempted by a sufï¬ciently large series X1, . . . , Xn of
independent repetitions of the same bet. It is true that, by the weak law of large
numbers, the probability
P [ Zn < 0 ] = P
 1
n
n

i=1
Xi < m(Âµ) âˆ’Îµ
!
(for Îµ := m(Âµ)) of incurring a cumulative loss at the end of the series converges to 0
as n â†‘âˆ. Nevertheless, the decision of accepting n repetitions is not consistent with
the decision to reject the single bet at any wealth level w. In fact, for Wk := w + Zk
we obtain
E[ u(Wn) ] = E

E[ u(Wnâˆ’1 + Xn) | X1, . . . , Xnâˆ’1 ]

= E
 
u(Wnâˆ’1 + x) Âµ(dx)

< E[ u(Wnâˆ’1) ] < Â· Â· Â· < u(w),
i.e., the bet described by Zn should be rejected as well.
â™¦
Let us denote by Âµn the distribution of the accumulated payoff Zn. The lottery Âµn
has the mean m(Âµn) = nÂ·m(Âµ), the certainty equivalent c(Âµn), and the associated risk
premium Ï(Âµn) = n Â· m(Âµ) âˆ’c(Âµn). We are interested in the asymptotic behavior of
these quantities for large n. Kolmogorovâ€™s law of large numbers states that the average
outcome 1
nZn converges P -a.s. to the constant m(Âµ). Therefore, one might guess that
a similar averaging effect occurs on the level of the relative certainty equivalents
cn := c(Âµn)
n
and of the relative risk premiums
Ïn := Ï(Âµn)
n
= m(Âµ) âˆ’cn.
Does cn converge to m(Âµ), and is there a successive reduction of the relative risk
premiums Ïn as n grows to inï¬nity? Applying our heuristic (2.11) to the present
situation yields
Ïn â‰ˆ1
2n Î±

m(Âµn)

var(Âµn) = 1
2 Î±

n Â· m(Âµ)

var(Âµ).
Thus, one should expect that Ïn tends to zero only if the Arrowâ€“Pratt coefï¬cient Î±(x)
becomes arbitrarily small as x becomes large, i.e., if the utility function is decreasingly
risk averse. This guess is conï¬rmed by the following two examples.

2.3 Expected utility
73
Example 2.53. Suppose that u(x) = 1 âˆ’eâˆ’Î±x is a CARA utility function with con-
stant risk aversion Î± > 0 and assume that Âµ is such that

eâˆ’Î±x Âµ(dx) < âˆ. Then,
with the notation introduced above,

eâˆ’Î±x Âµn(dx) = E
 
n

i=1
eâˆ’Î±Xi
!
=
 
eâˆ’Î±x Âµ(dx)
n
.
Hence, the certainty equivalent of Âµn is given by
c(Âµn) = âˆ’n
Î± log

eâˆ’Î±x Âµ(dx) = n Â· c(Âµ).
It follows that cn and Ïn are independent of n. In particular, the relative risk premiums
are not reduced if the lottery is drawn more than once.
â™¦
The second example displays a different behavior. It shows that for HARA utility
functions the relative risk premiums will indeed decrease to 0. In particular, the lottery
Âµn will become attractive for large enough n as soon as the price of the single lottery
Âµ is less than m(Âµ).
Example 2.54. Suppose that Âµ is a non-degenerate lottery concentrated on (0, âˆ),
and that u is a HARA utility function of index Î³ âˆˆ[0, 1). If Î³ > 0 then u(x) = 1
Î³ xÎ³
and c(Âµn) = E[(Zn)Î³ ]1/Î³ , hence
cn = c(Âµn)
n
= E
 1
nZn
Î³ 1/Î³
< m(Âµ).
If Î³ = 0 then u(x) = log x, and the relative certainty equivalent satisï¬es
log cn = log c(Âµn) âˆ’log n = E

log
1
nZn
 
.
Thus, we have
u(cn) = E

u
1
nZn
 
for any Î³ âˆˆ[0, 1). By symmetry,
1
n + 1Zn+1 = E[ Xk | Zn+1 ]
for k = 1, . . . , n + 1;
see part II of Â§20 in [19]. It follows that
1
n + 1Zn+1 = E
 1
nZn
 Zn+1

.
(2.14)

74
2 Preferences
Since u is strictly concave and since Âµ is non-degenerate, we get
u(cn+1) = E

u

E
 1
nZn
 Zn+1
 
> E

E

u
1
nZn
  Zn+1
 
= u(cn),
i.e., the relative certainty equivalents are strictly increasing and the relative risk pre-
miums Ïn are strictly decreasing. By Kolmogorovâ€™s law of large numbers,
1
nZn âˆ’â†’m(Âµ)
P-a.s.
(2.15)
Thus, by Fatouâ€™s lemma (we assume for simplicity that Âµ is concentrated on [Îµ, âˆ)
for some Îµ > 0 if Î³ = 0),
lim inf
nâ†‘âˆu(cn) â‰¥E

lim inf
nâ†‘âˆu
1
nZn
 
= u

m(Âµ)

,
hence
lim
nâ†‘âˆcn = m(Âµ)
and
lim
nâ†‘âˆÏn = 0.
Suppose that the price of Âµ is given by Ï€ âˆˆ

c(Âµ), m(Âµ)

. At initial wealth w = 0,
the agent would decline a single bet. But, in contrast to the situation in Remark 2.52, a
series of n repetitions of the same bet would now become attractive for large enough n,
since c(Âµn) = ncn > nÏ€ for
n â‰¥n0 := min{ k âˆˆN | ck > Ï€ } < âˆ.
â™¦
Remark 2.55. The identity (2.14) can also be written as
1
n + 1Zn+1 = E
1
nZn
 An+1

= E[ X1 | An+1 ]
where An+1 = Ïƒ(Zn+1, Zn+2, . . . ). This means that the stochastic process 1
nZn,
n = 1, 2 . . . , is a reverse martingale. In particular, Kolmogorovâ€™s law of large num-
bers (2.15) can be regarded as a special case of the convergence theorem for reverse
martingales; see part II of Â§20 in [19].
â™¦
2.4 Uniform preferences
So far, we have considered preference relations on distributions deï¬ned in terms of
a ï¬xed utility function u. In this section, we focus on the question whether one

2.4 Uniform preferences
75
distribution is preferred over another, regardless of the choice of a particular utility
function.
For simplicity, we take S = R as the set of possible payoffs. Let M be the set of
all Âµ âˆˆM1(R) with well-deï¬ned and ï¬nite expectation
m(Âµ) =

x Âµ(dx).
Recall from Deï¬nition 2.37 that a utility function on R is a strictly concave and strictly
increasing function u : R â†’R. Since each concave function u is dominated by an
afï¬ne function, the existence of m(Âµ) implies the existence of the integral

u dÂµ as
an extended real number in [âˆ’âˆ, âˆ).
Deï¬nition 2.56. Let Î½ and Âµ be lotteries in M. We say that the lottery Âµ is uniformly
preferred over Î½ and we write
Âµ â‰½uni Î½
if

u dÂµ â‰¥

u dÎ½
for all utility functions u.
Thus, Âµ â‰½uni Î½ holds if and only if every risk-averse agent will prefer Âµ over Î½,
regardless of which utility function the agent is actually using. In this sense, Âµ â‰½uni Î½
expresses a uniform preference for Âµ over Î½. Sometimes, â‰½uni is also called second
order stochastic dominance; the notion of ï¬rst order stochastic dominance will be
introduced in Deï¬nition 2.69.
Remark 2.57. The binary relation â‰½uni is a partial order on M, i.e., â‰½uni satisï¬es the
following three properties:
â€¢ Reï¬‚exivity: Âµ â‰½uni Âµ for all Âµ âˆˆM.
â€¢ Transitivity: Âµ â‰½uni Î½ and Î½ â‰½uni Î» imply Âµ â‰½uni Î».
â€¢ Antisymmetry: Âµ â‰½uni Î½ and Î½ â‰½uni Âµ imply Âµ = Î½.
The ï¬rst two properties are obvious, the third is derived in Remark 2.59. Moreover,
â‰½uni is monotone and risk-averse in the sense that
Î´y â‰½uni Î´x for y â‰¥x,
and
Î´m(Âµ) â‰½uni Âµ for all Âµ âˆˆM.
Note, however, that â‰½uni is not a weak preference relation in the sense of Deï¬nition 2.2,
since it is not complete, see Remark 2.3.
â™¦
In the following theorem, we will give a number of equivalent formulations of the
statement Âµ â‰½uni Î½. One of them needs the notion of a stochastic kernel on R. This is
a mapping
Q : R âˆ’â†’M1(R)
such that x â†’Q(x, A) is measurable for each ï¬xed Borel set A âŠ‚R. See Ap-
pendix A.3 for the notion of a quantile function, which will be used in condition (e).

76
2 Preferences
Theorem 2.58. For any pair Âµ, Î½ âˆˆM the following conditions are equivalent.
(a) Âµ â‰½uni Î½.
(b)

f dÂµ â‰¥

f dÎ½ for all increasing concave functions f .
(c) For all c âˆˆR

(c âˆ’x)+ Âµ(dx) â‰¤

(c âˆ’x)+ Î½(dx).
(d) If FÂµ and FÎ½ denote the distribution functions of Âµ and Î½, then
 c
âˆ’âˆ
FÂµ(x) dx â‰¤
 c
âˆ’âˆ
FÎ½(x) dx
for all c âˆˆR.
(e) If qÂµ and qÎ½ are quantile functions for Âµ and Î½, then
 t
0
qÂµ(s) ds â‰¥
 t
0
qÎ½(s) ds
for 0 < t â‰¤1.
(f) There exists a probability space (, F , P ) with random variables XÂµ and XÎ½
having respective distributions Âµ and Î½ such that
E[ XÎ½ | XÂµ ] â‰¤XÂµ
P -a.s.
(g) There exists a stochastic kernel Q(x, dy) on R such that Q(x, Â·) âˆˆM and
m(Q(x, Â·)) â‰¤x for all x and such that Î½ = ÂµQ, where ÂµQ denotes the
measure
ÂµQ(A) :=

Q(x, A) Âµ(dx)
for Borel sets A âŠ‚R.
Below we will show the following implications between the conditions of the
theorem:
(e) â‡â‡’(d) â‡â‡’(c) â‡â‡’(b) â‡â‡’(a) â‡" (g) â‡" (f).
(2.16)
The difï¬cult part is the proof that (b) implies (f). It will be deferred to Section 2.6,
where we will prove a multidimensional variant of this result; cf. Theorem 2.93.
Proof of (2.16). (e)â‡”(d): This follows from Lemma A.22.
(d)â‡”(c): By Fubiniâ€™s theorem,
 c
âˆ’âˆ
FÂµ(y) dy =
 c
âˆ’âˆ

(âˆ’âˆ,y]
Âµ(dz) dy
=
 
I{zâ‰¤yâ‰¤c} dy Âµ(dz)
=

(c âˆ’z)+ Âµ(dz).

2.4 Uniform preferences
77
(c)â‡”(b): Condition (b) implies (c) because f (x) := âˆ’(c âˆ’x)+ is concave and
increasing. In order to prove the converse assertion, we take an increasing concave
function f and let h := âˆ’f . Then h is convex and decreasing, and its increasing right-
hand derivative hâ€² := hâ€²
+ can be regarded as a â€œdistribution functionâ€ of a non-negative
Radon measure Î³ on R,
hâ€²(b) = hâ€²(a) + Î³

(a, b]

for a < b;
see Appendix A.1. As in (1.11):
h(x) = h(b) âˆ’hâ€²(b) (b âˆ’x) +

(âˆ’âˆ,b]
(z âˆ’x)+ Î³ (dz)
for x < b.
Using hâ€²(b) â‰¤0, Fubiniâ€™s theorem, and condition (c), we obtain that

(âˆ’âˆ,b]
h dÂµ = h(b) âˆ’hâ€²(b)

(b âˆ’x)+ Âµ(dx) +

(âˆ’âˆ,b]

(z âˆ’x)+ Âµ(dx) Î³ (dz)
â‰¤h(b) âˆ’hâ€²(b)

(b âˆ’x)+ Î½(dx) +

(âˆ’âˆ,b]

(z âˆ’x)+ Î½(dx) Î³ (dz)
=

(âˆ’âˆ,b]
h dÎ½.
Taking b â†‘âˆyields

f dÂµ â‰¥

f dÎ½.
(a)â‡”(b): That (b) implies (a) is obvious. For the proof of the converse implication,
choose any utility function u0 for which both

u0 dÂµ and

u0 dÎ½ are ï¬nite. For
instance, one can take
u0(x) :=

x âˆ’ex/2 + 1
if x â‰¤0,
âˆšx + 1 âˆ’1
if x â‰¥0.
Then, for f concave and increasing and for Î± âˆˆ[0, 1),
uÎ±(x) := Î±f (x) + (1 âˆ’Î±)u0(x)
is a utility function. Hence,

f dÂµ = lim
Î±â†‘1

uÎ± dÂµ â‰¥lim
Î±â†‘1

uÎ± dÎ½ =

f dÎ½.
(f) â‡’(g): By considering the joint distribution of XÂµ and XÎ½, we may reduce our
setting to the situation in which  = R2 and where XÂµ and XÎ½ are the respective
projections on the ï¬rst and second coordinates, i.e., for Ï‰ = (x, y) âˆˆ = R2 we
have XÂµ(Ï‰) = x and XÎ½(Ï‰) = y. Let Q(x, dy) be a regular conditional distribution
of XÎ½ given XÂµ, i.e., a stochastic kernel on R such that
P [ XÎ½ âˆˆA | XÂµ ](Ï‰) = Q(XÂµ(Ï‰), A)

78
2 Preferences
for all Borel sets A âŠ†R and for P -a.e. Ï‰ âˆˆ (see, e.g., Theorem 44.3 of [19] for an
existence proof). Clearly, Î½ = ÂµQ. Condition (f) implies that
XÂµ(Ï‰) â‰¥E[ XÎ½ | XÂµ ](Ï‰) =

y Q(XÂµ(Ï‰), dy)
for P -a.e. Ï‰ âˆˆ.
Hence, Q satisï¬es

y Q(x, dy) â‰¤x
for Âµ-a.e. x.
By modifying Q on a Âµ-null set (e.g., by putting Q(x, Â·) := Î´x there), this inequality
can be achieved for all x âˆˆR.
(g) â‡’(a): Let u be a utility function. Jensenâ€™s inequality applied to the measure
Q(x, dy) implies

u(y) Q(x, dy) â‰¤u

m

Q(x, Â·)

â‰¤u(x).
Hence,

u dÎ½ =
 
u(y) Q(x, dy) Âµ(dx) â‰¤

u dÂµ,
completing the proof of the set of implications (2.16).
Remark 2.59. Let us note some consequences of the preceding theorem. First, taking
in condition (b) the increasing concave function f (x) = x yields
m(Âµ) â‰¥m(Î½) if Âµ â‰½uni Î½,
i.e., the expectation m(Â·) is increasing with respect to â‰½uni.
Next, suppose that Âµ and Î½ are such that

(c âˆ’x)+ Âµ(dx) =

(c âˆ’x)+ Î½(dx)
for all c.
Then we have both Âµ â‰½uni Î½ and Î½ â‰½uni Âµ, and condition (d) of the theorem implies that
the respective distribution functions satisfy
 c
âˆ’âˆ
FÂµ(x) dx =
 c
âˆ’âˆ
FÎ½(x) dx
for all c.
Differentiating with respect to c gives the identity Âµ = Î½, i.e., a measure Âµ âˆˆM is
uniquely determined by the integrals

(c âˆ’x)+ Âµ(dx) for all c âˆˆR. In particular,
â‰½uni is antisymmetric.
â™¦
The following proposition characterizes the partial order â‰½uni considered on the
set of all normal distributions N(m, Ïƒ 2). Recall that the standard normal distribution
N(0, 1) is deï¬ned by its density function
Ï•(x) =
1
âˆš
2Ï€
eâˆ’x2/2,
x âˆˆR.

2.4 Uniform preferences
79
The corresponding distribution function is usually denoted
(x) =
 x
âˆ’âˆ
Ï•(y) dy,
x âˆˆR.
More generally, the normal distribution N(m, Ïƒ 2) with mean m âˆˆR and variance
Ïƒ 2 > 0 is given by the density function
1
âˆš
2Ï€Ïƒ 2 Â· exp
	
âˆ’(x âˆ’m)2
2Ïƒ 2

,
x âˆˆR.
Proposition 2.60. For two normal distributions, we have N(m, Ïƒ 2) â‰½uni N(
m,Ïƒ 2) if
and only if both m â‰¥
m and Ïƒ 2 â‰¤Ïƒ 2 hold.
Proof. In order to prove necessity, note that N(m, Ïƒ 2) â‰½uni N(
m,Ïƒ 2) implies that
eâˆ’Î±m+Î±2Ïƒ 2/2 =

eâˆ’Î±x N(m, Ïƒ 2)(dx) â‰¤

eâˆ’Î±x N(
m,Ïƒ 2)(dx) = eâˆ’Î±
m+Î±2Ïƒ 2/2.
Hence, for Î± > 0,
m âˆ’1
2 Î±Ïƒ 2 â‰¥
m âˆ’1
2 Î±Ïƒ 2,
which gives m â‰¥
m by letting Î± â†“0 and Ïƒ 2 â‰¤Ïƒ 2 for Î± â†‘âˆ.
We show sufï¬ciency ï¬rst in the case m = 
m = 0. Note that the distribution
function of N(0, Ïƒ 2) is given by (x/Ïƒ). Since Ï•â€²(x) = âˆ’xÏ•(x),
d
dÏƒ
 c
âˆ’âˆ

	 x
Ïƒ

dx =
 c
âˆ’âˆ
Ï•
	 x
Ïƒ

Â· âˆ’x
Ïƒ 2 dx = Ï•
	 c
Ïƒ

> 0.
Note that interchanging differentiation and integration is justiï¬ed by dominated con-
vergence. Thus, we have shown that Ïƒ â†’
 c
âˆ’âˆ(x/Ïƒ) dx is strictly increasing for
all c, and N(0, Ïƒ 2) â‰½uni N(0,Ïƒ 2) follows from part (d) of Theorem 2.58.
Now we turn to the case of arbitrary expectations m and 
m. Let u be a utility
function. Then

u dN(m, Ïƒ 2) =

u(m + x) N(0, Ïƒ 2)(dx) â‰¥

u(
m + x) N(0, Ïƒ 2)(dx),
because m â‰¥
m. Since x â†’u(
m + x) is again a utility function, we obtain from the
preceding step of the proof that

u(
m + x) N(0, Ïƒ 2)(dx) â‰¥

u(
m + x) N(0,Ïƒ 2)(dx) =

u dN(
m,Ïƒ 2),
and N(m, Ïƒ 2) â‰½uni N(
m,Ïƒ 2) follows.

80
2 Preferences
Remark 2.61. Let us indicate an alternative proof for the sufï¬ciency part of Proposi-
tion 2.60 that uses condition (g) instead of (d) in Theorem 2.58. To this end, we deï¬ne
a stochastic kernel by Q(x, Â·) := N(x + 
m âˆ’m, Ë†Ïƒ 2), where Ë†Ïƒ 2 := Ïƒ 2 âˆ’Ïƒ 2 > 0.
Then m(Q(x, Â·)) = x + 
m âˆ’m â‰¤x and
N(m, Ïƒ 2) Q = N(m, Ïƒ 2) âˆ—N(
m âˆ’m, Ë†Ïƒ 2) = N(m + 
m âˆ’m, Ïƒ 2 + Ë†Ïƒ 2) = N(m,Ïƒ 2),
where âˆ—denotes convolution. Hence, N(m, Ïƒ 2) â‰½uni N(
m,Ïƒ 2) follows.
â™¦
The following corollary investigates the relation Âµ â‰½uni Î½ for lotteries with the same
expectation. A multidimensional version of this result will be given in Corollary 2.94
below.
Corollary 2.62. For all Âµ, Î½ âˆˆM the following conditions are equivalent.
(a) Âµ â‰½uni Î½ and m(Âµ) = m(Î½).
(b)

f dÂµ â‰¥

f dÎ½ for all (not necessarily increasing) concave functions f .
(c) m(Âµ) â‰¥m(Î½) and

(x âˆ’c)+ Âµ(dx) â‰¤

(x âˆ’c)+ Î½(dx) for all c âˆˆR.
(d) There exists a probability space (, F , P ) with random variables XÂµ and XÎ½
having respective distributions Âµ and Î½ such that
E[ XÎ½ | XÂµ ] = XÂµ
P -a.s.
(e) There exists a â€œmean-preserving spreadâ€ Q, i.e., a stochastic kernel on R such
that m(Q(x, Â·)) = x for all x âˆˆS, such that Î½ = ÂµQ.
Proof. (a) â‡’(e): Condition (g) of Theorem 2.58 yields a stochastic kernel Q such
that Î½ = ÂµQ and m

Q(x, Â·)

â‰¤x. Due to the assumption m(Âµ) = m(Î½), Q must
satisfy m

Q(x, Â·)

= x at least for Âµ-a.e. x. By modifying Q on the Âµ-null set where
m

Q(x, Â·)

< x (e.g. by putting Q(x, Â·) := Î´x there), we obtain a kernel as needed
for condition (e).
(e) â‡’(b): Since

f (y) Q(x, dy) â‰¤f

m

Q(x, Â·)

= f (x)
by Jensenâ€™s inequality, we obtain

f dÎ½ =
 
f (y) Q(x, dy) Âµ(dx) â‰¤

f dÂµ.
(b) â‡’(c): Just take the concave functions f (x) = âˆ’(x âˆ’c)+, and f (x) = x.

2.4 Uniform preferences
81
(c) â‡’(a): Note that

(x âˆ’c)+ Âµ(dx) =

(c,âˆ)
x Âµ(dx) âˆ’c + c Âµ

(âˆ’âˆ, c]

.
The existence of m(Âµ) implies that c Âµ

(âˆ’âˆ, c]

â†’0 as c â†“âˆ’âˆ. Hence, we
deduce from the second condition in (c) that m(Âµ) â‰¤m(Î½), i.e., the two expectations
are in fact identical. Now we can apply the following â€œput-call parityâ€ (compare also
(1.10))

(c âˆ’x)+ Âµ(dx) = c âˆ’m(Âµ) +

(x âˆ’c)+ Âµ(dx)
to see that our condition (c) implies the third condition of Theorem 2.58 and, thus,
Âµ â‰½uni Î½.
(d)â‡”(a): Condition (d) implies both m(Âµ) = m(Î½) and condition (f) of Theo-
rem 2.58, and this implies our condition (a). Conversely, assume that (a) holds. Then
Theorem 2.58 provides random variables XÂµ and XÎ½ having the respective distribu-
tions Âµ and Î½ such that E[ XÎ½ | XÂµ ] â‰¤XÂµ. Since XÂµ and XÎ½ have the same mean,
this inequality must in fact be an almost-sure equality, and we obtain condition (d).
Let us denote by
var(Âµ) :=
 
x âˆ’m(Âµ)
2 Âµ(dx) =

x2 Âµ(dx) âˆ’m(Âµ)2 âˆˆ[0, âˆ]
the variance of a lottery Âµ âˆˆM.
Remark 2.63. If Âµ and Î½ are two lotteries in M such that m(Âµ) = m(Î½) and Âµ â‰½uni Î½,
then var(Âµ) â‰¤var(Î½). This follows immediately by taking the concave function
f (x) := âˆ’x2 in condition (b) of Corollary 2.62.
â™¦
In the ï¬nancial context, comparisons of portfolios with known payoff distributions
often use a mean-variance approach based on the relation
Âµ â‰½Î½
: â‡â‡’
m(Âµ) â‰¥m(Î½) and var(Âµ) â‰¤var(Î½).
For normal distributions Âµ and Î½, we have seen that the relation Âµ â‰½Î½ is equivalent
to Âµ â‰½uni Î½. Beyond this special case, the equivalence typically fails as illustrated by
the following example and by Proposition 2.67 below.
Example 2.64. Let Âµ be the uniform distribution on the interval [âˆ’1, 1], so that
m(Âµ) = 0 and var(Âµ) = 1/3. For Î½ we take Î½ = pÎ´âˆ’1/2 +(1âˆ’p)Î´2. With the choice
of p = 4/5 we obtain m(Î½) = 0 and 1 = var(Î½) > var(Âµ). However,
1
16 =
 	
âˆ’1
2 âˆ’x

+
Âµ(dx) >
 	
âˆ’1
2 âˆ’x

+
Î½(dx) = 0,
so Âµ â‰½uni Î½ does not hold.
â™¦

82
2 Preferences
Remark 2.65. Let Âµ and Î½ be two lotteries in M. We will write Âµ â‰½con Î½ if

f dÂµ â‰¥

f dÎ½
for all concave functions f on R.
(2.17)
Note that Âµ â‰½con Î½ implies that m(Âµ) = m(Î½), because both f (x) = x and 
f (x) = âˆ’x
are concave. Corollary 2.62 shows that â‰½con coincides with our uniform partial order
â‰½uni if we compare two measures which have the same mean. The partial order â‰½con
is sometimes called concave stochastic order. It was proposed in [170] and [171] to
express the view that Âµ is less risky than Î½. The inverse relation Âµ â‰½bal Î½ deï¬ned by

f dÂµ â‰¥

f dÎ½
for all convex functions f on R
(2.18)
is sometimes called balayage order or convex stochastic order.
â™¦
The following class of asset distributions is widely used in Finance.
Deï¬nition 2.66. Areal-valuedrandomvariableY onsomeprobabilityspace(,F ,P )
is called log-normally distributed with parameters Î± âˆˆR and Ïƒ â‰¥0 if it can be written
as
Y = exp(Î± + ÏƒX),
(2.19)
where X has a standard normal law N(0, 1).
Clearly, any log-normally distributed random variable Y on (, F , P ) takes
P-a.s. strictly positive values. Recall from above the standard notations Ï• and 
for the density and the distribution function of the standard normal law N(0, 1). We
obtain from (2.19) the distribution function
P [ Y â‰¤y ] = 
log y âˆ’Î±
Ïƒ

,
0 < y < âˆ,
and the density
Ïˆ(y) =
1
Ïƒ Â· y Ï•
log y âˆ’Î±
Ïƒ

Â· I(0,âˆ)(y)
(2.20)
of the log-normally distributed random variable Y. Its pth moment is given by the
formula
E[ Y p ] = exp
	
pÎ± + 1
2 p2Ïƒ 2
.
In particular, the law Âµ of Y has the expectation
m(Âµ) = E[ Y ] = exp
	
Î± + 1
2 Ïƒ 2
and the variance
var(Âµ) = exp

2Î± + Ïƒ 2
exp(Ïƒ 2) âˆ’1

.

2.4 Uniform preferences
83
Proposition 2.67. Let Âµ and Âµ be two log-normal distributions with parameters
(Î±, Ïƒ) and (Î±,Ïƒ), respectively. Then Âµ â‰½uni Âµ holds if and only if Ïƒ 2 â‰¤Ïƒ 2 and
Î± + 1
2Ïƒ 2 â‰¥Î± + 1
2Ïƒ 2.
Proof. First suppose that Ïƒ 2 â‰¤Ïƒ 2 and m(Âµ) â‰¥m(Âµ). We deï¬ne a kernel Q(x, Â·)
as the law of x Â· exp(Î» + Î²Z) where Z is a standard normal random variable. Now
suppose that Âµ is represented by (2.19) with X independent of Z, and let f denote a
bounded measurable function. It follows that

f d(ÂµQ) = E

f

eÎ±+ÏƒX Â· eÎ»+Î²Z 
= E

f

eÎ±+Î»+(Ïƒ 2+Î²2)1/2 U
,
where
U = ÏƒX + Î²Z
&
Ïƒ 2 + Î²2
is also N(0, 1)-distributed. Thus, ÂµQ is a log-normal distribution with parameters
(Î± + Î»,
&
Ïƒ 2 + Î²2 ). By taking Î² :=
âˆš
Ïƒ 2 âˆ’Ïƒ 2 and Î» := Î± âˆ’Î±, we can represent Âµ
as Âµ = ÂµQ. With this parameter choice,
Î» = Î± âˆ’Î± = log m( Âµ) âˆ’log m(Âµ) âˆ’1
2(Ïƒ 2 âˆ’Ïƒ 2 ) â‰¤âˆ’Î²2
2 .
We have thus m(Q(x, Â·)) â‰¤x for all x, and so Âµ â‰½uni Âµ follows from condition (g) of
Theorem 2.58.
As to the converse implication, the inequality m(Âµ) â‰¥m(Âµ) is already clear. To
prove Ïƒ 2 â‰¤Ïƒ 2, let Î½ := Âµ â—¦logâˆ’1 and Î½ := Âµ â—¦logâˆ’1 so that Î½ = N(Î±, Ïƒ 2)
and Î½ = N(Î±,Ïƒ 2). For Îµ > 0 we deï¬ne the concave increasing function fÎµ(x) :=
log(Îµ +x). If u is a concave increasing function on R, the function uâ—¦fÎµ is a concave
and increasing function on [0, âˆ), which can be extended to a concave increasing
function vÎµ on the full real line. Therefore,

u dÎ½ = lim
Îµâ†“0

vÎµ dÂµ â‰¥lim
Îµâ†“0

vÎµ dÂµ =

u dÎ½.
(2.21)
Consequently, Î½ â‰½uni Î½ and Proposition 2.60 yields Ïƒ 2 â‰¤Ïƒ 2.
Remark 2.68. The inequality (2.21) shows that if Î½ = N(Î±, Ïƒ 2), Î½ = N(Î±,Ïƒ 2) and
Âµ and Âµ denote the images of Î½ and Î½ under the map x â†’ex, then Âµ â‰½uni Âµ implies
Î½ â‰½uni Î½. However, the converse implication â€œ Î½ â‰½uni Î½ â‡’Âµ â‰½uni Âµ â€ fails, as can be
seen by increasing Ïƒ until m(Âµ) > m(Âµ).
â™¦
Because of its relation to the analysis of the Blackâ€“Scholes formula for option
prices, we will now sketch a second proof of Proposition 2.67.

84
2 Preferences
Second proof of Proposition 2.67. Let
Ym,Ïƒ := m Â· exp

ÏƒX âˆ’Ïƒ 2
2

for a standard normally distributed random variable X. Then
E

(Ym,Ïƒ âˆ’c)+ 
= m (d+) âˆ’c (dâˆ’)
with dÂ± = log x
c Â± 1
2Ïƒ 2
Ïƒ
;
see Example 5.57 in Chapter 5. Calculating the derivative of this expectation with
respect to Ïƒ > 0, one ï¬nds that
d
dÏƒ E

(Ym,Ïƒ âˆ’c)+ 
= d
dÏƒ

m (d+) âˆ’c (dâˆ’)

= x Ï•(d+) > 0,
see (5.35) in Chapter 5. The law Âµm,Ïƒ of Ym,Ïƒ satisï¬es m(Âµm,Ïƒ) = m for all Ïƒ > 0.
Condition (c) of Corollary 2.62 implies that Âµm,Ïƒ is decreasing in Ïƒ > 0 with respect
to â‰½uni and hence also with respect to â‰½con, i.e., Âµm,Ïƒ â‰½con Âµm,Ïƒ if and only if Ïƒ â‰¤Ïƒ.
For two different expectations m and 
m, simply use the monotonicity of the function
u(y) := (y âˆ’c)+ to conclude

u dÂµm,Ïƒ = E

u

m Â· exp(ÏƒX âˆ’Ïƒ 2/2)
 
â‰¥E

u
 
m Â· exp(ÏƒX âˆ’Ïƒ 2/2)
 
â‰¥

u dÂµ
m,Ïƒ,
provided that m â‰¥
m and 0 < Ïƒ â‰¤Ïƒ.
The partial order â‰½uni was deï¬ned in terms of integrals against increasing concave
functions. By taking the larger class of all concave functions as integrands, we arrived
at the partial order â‰½con deï¬ned by (2.17) and characterized in Corollary 2.62. In
the remainder of this section, we will brieï¬‚y discuss the partial order of stochastic
dominance, which is induced by increasing instead of concave functions:
Deï¬nition 2.69. Let Âµ and Î½ be two arbitrary probability measures on R. We say that
Âµ stochastically dominates Î½ and we write Âµ â‰½mon Î½ if

f dÂµ â‰¥

f dÎ½
for all bounded increasing functions f âˆˆC(R).
Stochastic dominance is sometimes also called ï¬rst order stochastic dominance.
It is indeed a partial order on M1(R): Reï¬‚exivity and transitivity are obvious, and
antisymmetry follows, e.g., from the equivalence (a)â‡”(b) below. As will be shown by
the following theorem, the relation Âµ â‰½mon Î½ means that the distribution Âµ is â€œhigherâ€
than the distribution Î½. In our one-dimensional situation, we can provide a complete
proof of this fact by using elementary properties of distribution functions. The general
version of this result, given in Theorem 2.95, will require different techniques.

2.4 Uniform preferences
85
Theorem 2.70. For Âµ, Î½ âˆˆM1(R) the following conditions are equivalent.
(a) Âµ â‰½mon Î½.
(b) The distribution functions of Âµ and Î½ satisfy FÂµ(x) â‰¤FÎ½(x) for all x.
(c) Any pair of quantile functions for Âµ and Î½ satisï¬es qÂµ(t) â‰¥qÎ½(t) for a.e.
t âˆˆ(0, 1).
(d) There exists a probability space (, F , P ) with random variables XÂµ and XÎ½
with distributions Âµ and Î½ such that XÂµ â‰¥XÎ½ P -a.s.
(e) There exists a stochastic kernel Q(x, dy) on R such that Q(x, (âˆ’âˆ, x]) = 1
and such that Î½ = ÂµQ.
In particular, Âµ â‰½mon Î½ implies Âµ â‰½uni Î½.
Proof. (a) â‡’(b): Note that FÂµ(x) = Âµ

(âˆ’âˆ, x]

can be written as
FÂµ(x) = 1 âˆ’

I(x,âˆ)(y) Âµ(dy).
It is easy to construct a sequence of increasing continuous functions with values in
[0, 1] which increase to I(x,âˆ) for each x. Hence,

I(x,âˆ)(y) Âµ(dy) â‰¥

I(x,âˆ)(y) Î½(dy) = 1 âˆ’FÎ½(x).
(b)â‡”(c): This follows from the deï¬nition of a quantile function and from Lemma
A.17.
(c) â‡’(d): Let (, F , P) be a probability space supporting a random variable U
with a uniform distribution on (0, 1). Then XÂµ := qÂµ(U) and XÎ½ := qÎ½(U) satisfy
XÂµ â‰¥XÎ½ P -almost surely. Moreover, it follows from Lemma A.19 that they have the
distributions Âµ and Î½.
(d) â‡’(e): This is proved as in Theorem 2.58 by using regular conditional distri-
butions.
(e) â‡’(a): Condition (e) implies that x â‰¥y for Q(x, Â·)-a.e. y. Hence, if f is
bounded and increasing, then

f (y) Q(x, dy) â‰¤

f (x) Q(x, dy) = f (x).
Therefore,

f dÎ½ =
 
f (y) Q(x, dy) Âµ(dx) â‰¤

f dÂµ.
Finally, due to the equivalence (a) â‡”(b) above and the equivalence (a) â‡”(d) in
Theorem 2.58, Âµ â‰½mon Î½ implies Âµ â‰½uni Î½.

86
2 Preferences
Remark 2.71. It is clear from conditions (d) or (e) of Theorem 2.70 that the set of
bounded, increasing, and continuous functions in Deï¬nition 2.69 can be replaced by
the set of all increasing functions for which the two integrals make sense. Thus,
Âµ â‰½mon Î½ for Âµ, Î½ âˆˆM implies Âµ â‰½uni Î½, and in particular m(Âµ) â‰¥m(Î½). Moreover,
condition (d) shows that Âµ â‰½mon Î½ together with m(Âµ) = m(Î½) implies Âµ = Î½.
â™¦
2.5 Robust preferences on asset proï¬les
In this section, we discuss the structure of preferences for assets on a more funda-
mental level. Instead of assuming that the distributions of assets are known and that
preferences are deï¬ned on a set of probability measures, we will take as our basic
objects the assets themselves. An asset will be viewed as a function which associates
real-valued payoffs to possible scenarios. More precisely, X will denote a set of
bounded measurable functions X on some measurable set (, F ). We emphasize that
no a priori probability measure is given on (, F ). In other words, we are facing
uncertainty instead of risk.
We assume that X is endowed with a preference relation â‰». In view of the ï¬nancial
interpretation, it is natural to assume that â‰»is monotone in the sense that
Y âª°X
if Y(Ï‰) â‰¥X(Ï‰) for all Ï‰ âˆˆ.
Under a suitable condition of continuity, we could apply the results of Section 2.1 to
obtain a numerical representation of â‰». L. J. Savage introduced a set of additional
axioms which guarantee there is a numerical representation of the special form
U(X) = EQ[ u(X) ] =

u

X(Ï‰)

Q(dÏ‰)
for all X âˆˆX
(2.22)
where Q is a probability measure on (, F ) and u is a function on R. The measure
Q speciï¬es the subjective view of the probabilities of events which is implicit in the
preference relation â‰». Note that the function u : R â†’R is determined by restricting
U to the class of constant functions on (, F ). Clearly, the monotonicity of â‰»is
equivalent to the condition that u is an increasing function.
Deï¬nition 2.72. A numerical representation of the form (2.22) will be called a Savage
representation of the preference relation â‰».
Remark 2.73. Let ÂµQ,X denote the distribution of X under the subjective measure
Q. Clearly, the preference order â‰»on X given by (2.22) induces a preference order
on
MQ := { ÂµQ,X | X âˆˆX }
with von Neumannâ€“Morgenstern representation
UQ(ÂµQ,X) := U(X) = EQ[ u(X) ] =

u dÂµQ,X,

2.5 Robust preferences on asset proï¬les
87
i.e.,
UQ(Âµ) =

u(x) Âµ(dx)
for Âµ âˆˆMQ.
On this level, Section 2.3 speciï¬es the conditions on UQ which guarantee that u is a
(strictly concave and strictly increasing) utility function.
â™¦
Remark 2.74. Even if an economic agent with preferences â‰»would accept the view
that scenarios Ï‰ âˆˆ are generated in accordance to a given objective probability
measure P on (, F ), the preference order â‰»on X may be such that the subjective
measure Q appearing in the Savage representation (2.22) is different from the objective
measureP. Suppose, forexample, thatP isLebesguemeasurerestrictedto = [0, 1],
and that X is the space of bounded right-continuous increasing functions on [0, 1].
Let ÂµP,X denote the distribution of X under P . By Lemma A.19, every probability
measure on R with bounded support is of the form ÂµP,X for some X âˆˆX, i.e.,
Mb(R) = { ÂµP,X | X âˆˆX }.
Suppose the agent agrees that, objectively, X âˆˆX can be identiï¬ed with the lottery
ÂµP,X, so that the preference relation on X could be viewed as a preference relation
on Mb(R) with numerical representation
Uâˆ—(ÂµP,X) := U(X).
This does not imply that Uâˆ—satisï¬es the assumptions of Section 2.2; in particular, the
preference relation on Mb(R) may violate the independence axiom. In fact, the agent
might take a pessimistic view and distort P by putting more emphasis on unfavorable
scenarios. For example, the agent could replace P by the subjective measure
Q := Î±Î´0 + (1 âˆ’Î±)P
for some Î± âˆˆ(0, 1) and specify preferences by a Savage representation in terms of u
and Q. In this case,
Uâˆ—(ÂµP,X) = EQ[ u(X) ] =

u dÂµQ,X
= Î±u

X(0)

+ (1 âˆ’Î±)EP [ u(X) ]
= Î±u

X(0)

+ (1 âˆ’Î±)

u dÂµP,X.
Note that X(0) = â„“(ÂµP,X) for
â„“(Âµ) := inf(supp Âµ) = sup

a âˆˆR | Âµ

(âˆ’âˆ, a)

= 0

,
where supp Âµ is the support of Âµ. Hence, replacing P by Q corresponds to a non-linear
distortion on the level of lotteries: Âµ = ÂµP,X is distorted to the lottery Âµâˆ—= ÂµQ,X
given by
Âµâˆ—= Î± Î´â„“(Âµ) + (1 âˆ’Î±)Âµ,

88
2 Preferences
and the preference relation on lotteries has the numerical representation
Uâˆ—(Âµ) =

u(x) Âµâˆ—(dx)
for Âµ âˆˆMb(R).
Let us now show that such a subjective distortion of objective lotteries provides a
possible explanation of the Allais paradox. Consider the lotteries Âµi and Î½i, i = 1, 2,
described in Example 2.32. Clearly,
Âµâˆ—
1 = Âµ1
and
Î½âˆ—
1 = Î± Î´0 + (1 âˆ’Î±)Î½1,
while
Âµâˆ—
2 = Î± Î´0 + (1 âˆ’Î±)Âµ2
and
Î½âˆ—
1 = Î± Î´0 + (1 âˆ’Î±)Î½1.
For the particular choice u(x) = x we have Uâˆ—(Î½2) > Uâˆ—(Âµ2), and for Î± > 9/2409
we obtain Uâˆ—(Âµ1) > Uâˆ—(Î½1), in accordance with the observed preferences Î½2 â‰»Âµ2
and Âµ1 â‰»Î½1 described in Example 2.32.
For a systematic discussion of preferences described in terms of a subjective distor-
tion of lotteries we refer to [131]. In Section 4.6, we will discuss the role of distortions
in the context of risk measures, and in particular the connection toYaariâ€™s â€œdual theory
of choice under riskâ€ [198].
â™¦
Even in its general form (2.22), however, the paradigm of expected utility has a
limited scope as illustrated by the following example.
Example 2.75 (Ellsberg paradox). You are faced with a choice between two urns,
each containing 100 balls which are either red or black. In the ï¬rst urn, the proportion
p of red balls is know; assume, e.g., p = 0.49. In the second urn, the proportion p is
unknown. Suppose that you get 1000 â‚¬ if you draw a red ball and 0 â‚¬ otherwise. In this
case, most people would choose the ï¬rst urn. Naturally, they make the same choice if
you get 1000 â‚¬ for drawing a black ball and 0 â‚¬ for a red one. But this behavior is not
compatible with the paradigm of expected utility: For any subjective probability p of
drawing a red ball in the second urn, the ï¬rst choice would imply p > p, the second
would yield 1 âˆ’p > 1 âˆ’p, and this is a contradiction.
â™¦
For this reason, we are going to make one further conceptual step beyond the
Savage representation before we start to prove a representation theorem for preferences
on X. Instead of a single measure Q, let us consider a whole class Q of measures
on (, F ). Our aim is to characterize those preference relations on X which admit a
representation of the form
U(X) = inf
QâˆˆQ EQ[ u(X) ].
(2.23)
This may be viewed as a robust version of the paradigm of expected utility: The
agent has in mind a whole collection of possible probabilistic views of the given set
of scenarios and takes a worst-case approach in evaluating the expected utility of a
given payoff.

2.5 Robust preferences on asset proï¬les
89
It will be convenient to extend the discussion to the following framework where
payoffs can be lotteries. Let X denote the space of all bounded measurable functions
on (, F ). We are going to embed X into a certain space 
X of functions 
X on (, F )
with values in the convex set
Mb(R) =

Âµ âˆˆM1(R) | Âµ([âˆ’c, c]) = 1 for some c â‰¥0

of boundedly supported Borel probability measures on R. More precisely, 
X is deï¬ned
as the convex set of all those stochastic kernels 
X(Ï‰, dy) from (, F ) to R for which
there exists a constant c â‰¥0 such that

X

Ï‰, [âˆ’c, c]

= 1
for all Ï‰ âˆˆ.
The space X can be embedded into 
X by virtue of the mapping
X âˆ‹X âˆ’â†’Î´X âˆˆ
X.
(2.24)
In this way, X can be identiï¬ed with the set of all 
X âˆˆ
X for which the measure

X(Ï‰, Â·) is a Dirac measure. A preference order on X deï¬ned by (2.23) clearly extends
to 
X by

U(
X) = inf
QâˆˆQ
 
u(y) 
X(Ï‰, dy) Q(dÏ‰) = inf
QâˆˆQ EQ[u(
X) ]
(2.25)
where u is the afï¬ne function on Mb(R) deï¬ned by
u(Âµ) =

u dÂµ,
Âµ âˆˆMb(R).
Remark 2.76. Restricting the preference order â‰»on 
X obtained from (2.25) to the
constant maps 
X(Ï‰) = Âµ for Âµ âˆˆMb(R), we obtain a preference order on Mb(R),
and on this level we know how to characterize risk aversion by the property that u is
strictly concave.
â™¦
Example 2.77. Let us show how the Ellsberg paradox ï¬ts into our extended setting,
and how it can be resolved by a suitable choice of the set Q. For  = {0, 1} deï¬ne

X0(Ï‰) := p Î´1000 + (1 âˆ’p)Î´0,

X1(Ï‰) := (1 âˆ’p)Î´1000 + p Î´0,
and
Zi(Ï‰) := Î´1000 Â· I{i}(Ï‰) + Î´0 Â· I{1âˆ’i}(Ï‰),
i = 0, 1.
Take
Q :=

q Î´1 + (1 âˆ’q)Î´0 | a â‰¤q â‰¤b

with [a, b] âŠ‚[0, 1]. For any increasing function u, the functional

U(
X) := inf
QâˆˆQ EQ[u(
X) ]

90
2 Preferences
satisï¬es

U(
Xi) > 
U(Zi),
i = 0, 1,
as soon as a < p < b, in accordance with the preferences described in Example 2.75.
â™¦
Let us now formulate those properties of a preference order â‰»on the convex set

X which are crucial for a representation of the form (2.25). For 
X, Y âˆˆ
X and
Î± âˆˆ(0, 1), (2.25) implies

U

Î±
X + (1 âˆ’Î±)Y

= inf
QâˆˆQ

Î± EQ[u(
X) ] + (1 âˆ’Î±) EQ[u(Y) ]

â‰¥Î± 
U(
X) + (1 âˆ’Î±)
U(Y).
In contrast to the Savage case Q = {Q}, we can no longer expect equality, except for
the case of certainty Y(Ï‰) â‰¡Âµ. If 
X âˆ¼Y, then 
U(
X) = 
U(Y), and the lower bound
reduces to 
U(
X) = 
U(Y). Thus, â‰»satisï¬es the following two properties:
Uncertainty aversion: If 
X, Y âˆˆ
X are such that 
X âˆ¼Y, then
Î±
X + (1 âˆ’Î±)Y âª°
X
for all Î± âˆˆ[0, 1].
Certainty independence: For 
X, Y âˆˆ
X, Z â‰¡Âµ âˆˆMb(R), and Î± âˆˆ(0, 1] we have

X â‰»Y
â‡â‡’
Î±
X + (1 âˆ’Î±)Z â‰»Î±Y + (1 âˆ’Î±)Z.
Remark 2.78. In order to motivate the term â€œuncertainty aversionâ€, consider the sit-
uation of the preceding example. Suppose that an agent is indifferent between the
choices Z0 and Z1, which both involve the same kind of uncertainty. For Î± âˆˆ(0, 1),
the convex combination Y := Î±Z0 + (1 âˆ’Î±)Z1, which is weakly preferred to both
Z0 and Z1 in the case of uncertainty aversion, takes the form
Y(Ï‰) =

Î± Î´1000 + (1 âˆ’Î±)Î´0
for Ï‰ = 1,
Î± Î´0 + (1 âˆ’Î±)Î´1000
for Ï‰ = 0,
i.e., uncertainty is reduced in favor of risk. For Î± = 1/2, the resulting lottery Y(Ï‰) â‰¡
1
2(Î´1000 +Î´0) is independent of the scenario Ï‰, i.e., uncertainty is completely replaced
by risk.
â™¦
Remark 2.79. The axiom of â€œcertainty independenceâ€ extends the independence ax-
iom for preferences on lotteries to our present setting, but only under the restriction
that one of the two contingent lotteries 
X and Y is certain, i.e., does not depend on
the scenario Ï‰ âˆˆ. Without this restriction, the extended independence axiom would
lead to the Savage representation in its original form (2.22). There are good reasons
for not requiring full independence for all Z âˆˆ
X. As an example, take  = {0, 1} and
deï¬ne 
X(Ï‰) = Î´Ï‰, Y(Ï‰) = Î´1âˆ’Ï‰, and Z = 
X. An agent may prefer 
X over Y, thus

2.5 Robust preferences on asset proï¬les
91
expressing the implicit view that scenario 1 is somewhat more likely than scenario 0.
At the same time, the agent may like the idea of hedging against the occurrence of
scenario 0, and this could mean that the certain lottery
1
2
 Y + Z

(Â·) â‰¡1
2(Î´0 + Î´1)
is preferred over the contingent lottery
1
2
 
X + Z

(Â·) â‰¡
X(Â·),
thus violating the independence assumption in its unrestricted form. In general, the
role of Z as a hedge against scenarios unfavorable for Y requires that Y and Z are not
comonotone, i.e.,
âˆƒÏ‰, Î· âˆˆ :
Y(Ï‰) â‰»Y(Î·), Z(Ï‰) â‰ºZ(Î·).
(2.26)
Thus, the wish to hedge would still be compatible with the following enforcement of
certainty independence, called
â€¢ comonotonic independence: For 
X, Y, Z âˆˆ
X and Î± âˆˆ(0, 1]

X â‰»Y
â‡â‡’
Î±
X + (1 âˆ’Î±)Z â‰»Î±Y + (1 âˆ’Î±)Z.
whenever Y and Z are comonotone in the sense that (2.26) does not occur.
â™¦
From now on, we assume that â‰»is a given preference order on 
X. The set Mb(R)
will be regarded as a subset of 
X by identifying a constant function Z â‰¡Âµ with its
value Âµ âˆˆMb(R). We assume that â‰»possesses the following properties:
â€¢ Uncertainty aversion.
â€¢ Certainty independence.
â€¢ Monotonicity: If Y(Ï‰) âª°
X(Ï‰) for all Ï‰ âˆˆ, then Y âª°
X. Moreover, â‰»is
compatible with the usual order on R, i.e., Î´y â‰»Î´x if and only if y > x.
â€¢ Continuity: The following analogue of the Archimedean axiom holds on 
X: If

X, Y, Z âˆˆ
X are such that Z â‰»Y â‰»
X, then there are Î±, Î² âˆˆ(0, 1) with
Î±Z + (1 âˆ’Î±)
X â‰»Y â‰»Î²Z + (1 âˆ’Î²)
X.
Moreover, for all c > 0 the restriction of â‰»to M1([âˆ’c, c]) is continuous with
respect to the weak topology.
Let us denote by
M1,f := M1,f (, F )

92
2 Preferences
the class of all set functions Q : F â†’[0, 1] which are normalized to Q[  ] = 1
and which are ï¬nitely additive, i.e., Q[ A âˆªB ] = Q[ A ] + Q[ B ] for all disjoint
A, B âˆˆF . By EQ[ X ] we denote the integral of X with respect to Q âˆˆM1,f ; see
Appendix A.6. With M1(, F ) we denote the Ïƒ-additive members of M1,f , that is,
the class of all probability measures on (, F ).
Theorem 2.80. Consider a preference order â‰»on 
X satisfying the four properties
listed above.
(a) There exists a strictly increasing function u âˆˆC(R) and a convex set Q âŠ‚
M1,f (, F ) such that

U(
X) = min
QâˆˆQ EQ
 
u(x) 
X(Â·, dx)

is a numerical representation of â‰». Moreover, u is unique up to positive afï¬ne trans-
formations.
(b) If the induced preference order â‰»on X, viewed as a subset of 
X as in (2.24),
satisï¬es the following additional continuity property
X â‰»Y and Xn â†—X
"â‡’
Xn â‰»Y
for all large n,
(2.27)
then the set functions in Q are in fact probability measures, i.e., each Q âˆˆQ is
Ïƒ-additive. In this case, the induced preference order on X has the robust Savage
representation
U(X) = min
QâˆˆQ EQ[ u(X) ]
for X âˆˆX
with Q âŠ‚M1(, F ).
Remark 2.81. Even without its axiomatic foundation, the robust Savage representa-
tion is highly plausible as it stands, since it may be viewed as a worst-case approach
to the problem of model uncertainty. This aspect will be of particular relevance in our
discussion of risk measures in Chapter 4.
â™¦
The proof of Theorem 2.80 needs some preparation.
When restricted to Mb(R), viewed as a subset of 
X, the axiom of certainty inde-
pendence is just the independence axiom of the von Neumannâ€“Morgenstern theory.
Thus, the preference relation â‰»on Mb(R) satisï¬es the assumptions of Corollary 2.29,
and we obtain the existence of a continuous function u : R â†’R such that
u(Âµ) :=

u(x) Âµ(dx)
(2.28)
is a numerical representation of â‰»on the set Mb(R). Moreover, u is unique up
to positive afï¬ne transformations. The second part of our monotonicity assumption
implies that u is strictly increasing. Without loss of generality, we assume u(0) = 0
and u(1) = 1.

2.5 Robust preferences on asset proï¬les
93
Remark 2.82. In view of the representation (2.28), it follows as in (2.9) that any
Âµ âˆˆMb(R) admits a unique certainty equivalent c(Âµ) âˆˆR for which
Âµ âˆ¼Î´c(Âµ).
Thus, if X âˆˆX is deï¬ned for 
X âˆˆ
X as X(Ï‰) := c

X(Ï‰)

, then the ï¬rst part of our
monotonicity assumption yields

X âˆ¼Î´X,
(2.29)
and so the preference relation â‰»on 
X is uniquely determined by its restriction to X.
â™¦
Lemma 2.83. There exists a unique extension 
U of the functional u in (2.28) as a
numerical representation of â‰»on 
X.
Proof. For 
X âˆˆ
X let c > 0 be such that 
X(Ï‰, [âˆ’c, c]) = 1 for all Ï‰ âˆˆ. Then
u(Î´âˆ’c) â‰¤u

X(Ï‰)

â‰¤u(Î´c)
for all Ï‰ âˆˆ,
and our monotonicity assumption implies that
Î´c âª°
X âª°Î´âˆ’c.
We will show below that there exists a unique Î± âˆˆ[0, 1] such that

X âˆ¼(1 âˆ’Î±)Î´âˆ’c + Î±Î´c.
(2.30)
Once this has been achieved, the only possible choice for 
U(
X) is

U(
X) := u

(1 âˆ’Î±)Î´âˆ’c + Î±Î´c

= (1 âˆ’Î±)u(Î´âˆ’c) + Î±u(Î´c).
This deï¬nition of 
U provides a numerical representation of â‰»on 
X.
The proof of the existence of a unique Î± âˆˆ[0, 1] with (2.30) is similar to the proof
of Lemma 2.24. Uniqueness follows from the monotonicity
Î² > Î±
"â‡’
(1 âˆ’Î²)Î´âˆ’c + Î²Î´c â‰»(1 âˆ’Î±)Î´âˆ’c + Î±Î´c,
(2.31)
which is an immediate consequence of the von Neumannâ€“Morgenstern representation.
Now we let
Î± := sup

Î³ âˆˆ[0, 1] | 
X âª°(1 âˆ’Î³ )Î´âˆ’c + Î³ Î´c

.
We have to exclude the two following cases:

X â‰»(1 âˆ’Î±)Î´âˆ’c + Î±Î´c
(2.32)
(1 âˆ’Î±)Î´âˆ’c + Î±Î´c â‰»
X.
(2.33)
In the case (2.32), our continuity axiom yields some Î² âˆˆ(0, 1) for which

X â‰»Î²[ (1 âˆ’Î±)Î´âˆ’c + Î±Î´c ] + (1 âˆ’Î²)Î´c = (1 âˆ’Î³ )Î´âˆ’c + Î³ Î´c

94
2 Preferences
where Î³ = Î²Î± + (1 âˆ’Î²) > Î±, in contradiction to the deï¬nition of Î±.
If (2.33) holds, then the same argument as above yields Î² âˆˆ(0, 1) with
Î²Î±Î´c + (1 âˆ’Î²Î±)Î´âˆ’c â‰»
X.
By our deï¬nition of Î± there must be some Î³ âˆˆ(Î²Î±, Î±) with

X âª°(1 âˆ’Î³ )Î´âˆ’c + Î³ Î´c â‰»Î²Î±Î´c + (1 âˆ’Î²Î±)Î´âˆ’c,
where the second relation follows from (2.31). This, however, is a contradiction.
Via the embedding (2.24), Lemma 2.83 induces a numerical representation U of
â‰»on X given by
U(X) := 
U(Î´X).
(2.34)
The following proposition clariï¬es the properties of the functional U and provides the
key to a robust Savage representation of the preference order â‰»on X.
Proposition 2.84. Given u of (2.28) and the numerical representation U on X con-
structed via Lemma 2.83 and (2.34), there exists a unique functional J : X â†’R such
that
U(X) = J

u(X)

for all X âˆˆX,
(2.35)
and such that the following four properties are satisï¬ed:
â€¢ Monotonicity: If Y(Ï‰) â‰¥X(Ï‰) for all Ï‰, then J(Y) â‰¥J(X).
â€¢ Concavity: If Î» âˆˆ[0, 1] then J

Î»X + (1 âˆ’Î»)Y

â‰¥Î»J(X) + (1 âˆ’Î»)J(Y).
â€¢ Positive homogeneity: J(Î»X) = Î»J(X) for Î» â‰¥0.
â€¢ Cash invariance: J(X + z) = J(X) + z for all z âˆˆR.
Moreover, any functional J with these four properties is Lipschitz continuous on X
with respect to the supremum norm âˆ¥Â· âˆ¥, i.e.,
|J(X) âˆ’J(Y)| â‰¤âˆ¥X âˆ’Yâˆ¥
for all X, Y âˆˆX.
Proof. Denote by Xu the space of all X âˆˆX which take values in the range u(R) of
u. Clearly, Xu coincides with the range of the non-linear transformation X âˆ‹X â†’
u(X). Note that this transformation is bijective since u is strictly increasing due to
our assumption of monotonicity. Thus, J is well-deï¬ned on Xu via (2.35). We show
next that this J has the four properties of the assertion.
Monotonicity is obvious. For positive homogeneity on Xu, it sufï¬ces to show that
J(Î»X) = Î»J(X) for X âˆˆXu and Î» âˆˆ(0, 1]. Let X0 âˆˆX be such that u(X0) = X.
We deï¬ne Z âˆˆ
X by
Z := Î»Î´X0 + (1 âˆ’Î»)Î´0.

2.5 Robust preferences on asset proï¬les
95
By (2.29), Z âˆ¼Î´Z where Z is given by
Z(Ï‰) = c

Î»Î´X0(Ï‰) + (1 âˆ’Î»)Î´0

= uâˆ’1
Î»u(X0(Ï‰)) + (1 âˆ’Î»)u(0)

= uâˆ’1
Î»u(X0(Ï‰))

,
where we have used our convention u(0) = 0. It follows that u(Z) = Î»u(X0) = Î»X,
and so
J(Î»X) = U(Z) = 
U(Z).
(2.36)
As in (2.30), one can ï¬nd Î½ âˆˆMb(R) such that Î½ âˆ¼Î´X0. Certainty independence
implies that
Z = Î»Î´X0 + (1 âˆ’Î»)Î´0 âˆ¼Î»Î½ + (1 âˆ’Î»)Î´0.
Hence,

U(Z) = u(Î»Î½ + (1 âˆ’Î»)Î´0) = Î»u(Î½) = Î»U(X0) = Î»J(X).
This shows that J is positively homogeneous on Xu.
Since the range of u is an interval, we can extend J from Xu to all of X by positive
homogeneity, and this extension, again denoted J, is also monotone and positively
homogeneous.
Let us now show that J is cash invariant. First note that
J(1) = J

u(x)

u(x)
= u(Î´x)
u(x) = 1
for any x such that u(x) Ì¸= 0. Now take X âˆˆX and z âˆˆR. By positive homogeneity,
we may assume without loss of generality that 2X âˆˆXu and 2z âˆˆu(R). Then there
are X0 âˆˆX such that 2X = u(X0) as well as z0, x0 âˆˆR with 2z = u(z0) and
2J(X) = u(x0). Note that Î´X0 âˆ¼Î´x0. Thus, certainty independence yields
Z := 1
2(Î´X0 + Î´z0) âˆ¼1
2(Î´x0 + Î´z0) =: Âµ.
On the one hand, it follows that

U(Z) = U(Âµ) = 1
2u(x0) + 1
2u(z0) = J(X) + z.
On the other hand, the same reasoning which lead to (2.36) shows that

U(Z) = J(X + z).
As to concavity, we need only show that J( 1
2X + 1
2Y) â‰¥1
2J(X) + 1
2J(Y) for
X, Y âˆˆXu, by positive homogeneity. Let X0, Y0 âˆˆX be such that X = u(X0) and
Y = u(Y0). If J(X) = J(Y), then Î´X0 âˆ¼Î´Y0, and uncertainty aversion gives
Z := 1
2(Î´X0 + Î´Y0) âª°Î´X0,

96
2 Preferences
which by the same arguments as above yields

U(Z) = J
1
2X + 1
2Y

â‰¥J(X) = 1
2

J(X) + J(Y)

.
The case in which J(X) > J(Y) can be reduced to the previous one by letting
z := J(X) âˆ’J(Y), and by replacing Y by Yz := Y + z. Cash invariance then implies
that
J
1
2X + 1
2Y

+ 1
2 z = J
1
2X + 1
2Yz

â‰¥1
2

J(X) + J(Yz)

= 1
2

J(X) + J(Y)

+ 1
2 z.
Now we show the Lipschitz continuity of J. If X, Y âˆˆX then X â‰¤Y +âˆ¥X âˆ’Yâˆ¥,
and so J(X) â‰¤J(Y) + âˆ¥X âˆ’Yâˆ¥, by monotonicity and cash invariance. Reversing
the roles of X and Y yields
|J(X) âˆ’J(Y)| â‰¤âˆ¥X âˆ’Yâˆ¥.
Letusnowshowthatafunctionwiththefourpropertiesestablishedinthepreceding
proposition can be represented in terms of a family of set functions in the class M1,f .
Proposition 2.85. A functional J : X â†’R is monotone, concave, positively homo-
geneous, and cash invariant if and only if there exists a set Q âŠ‚M1,f such that
J(X) = inf
QâˆˆQ EQ[ X ],
X âˆˆX.
Moreover, the set Q can always be chosen to be convex and such that the inï¬mum
above is attained, i.e.,
J(X) = min
QâˆˆQ EQ[ X ],
X âˆˆX.
Proof. The necessity of the four properties is obvious. Conversely, we will construct
for any X âˆˆX a ï¬nitely additive set function QX such that J(X) = EQX[ X ] and
J(Y) â‰¤EQX[ Y ] for all Y âˆˆX. Then
J(Y) = min
QâˆˆQ0
EQ[ Y ]
for all Y âˆˆX
(2.37)
where Q0 := { QX | X âˆˆX }. Clearly, (2.37) remains true if we replace Q0 by its
convex hull Q := conv Q0.
To construct QX for a given X âˆˆX, we deï¬ne three convex sets in X by
B := { Y âˆˆX | J(Y) > 1 },

2.5 Robust preferences on asset proï¬les
97
C1 := { Y âˆˆX | Y â‰¤1 },
and
C2 :=

Y âˆˆX
 Y â‰¤
X
J(X)

.
The convexity of C1 and C2 implies that the convex hull of their union is given by
C := conv(C1 âˆªC2) =

Î±Y1 + (1 âˆ’Î±)Y2 | Yi âˆˆCi and Î± âˆˆ[0, 1]

.
Since Y âˆˆC is of the form Y = Î±Y1 + (1 âˆ’Î±)Y2 for some Yi âˆˆCi and Î± âˆˆ[0, 1],
J(Y) â‰¤J(Î± + (1 âˆ’Î±)Y2) = Î± + (1 âˆ’Î±)J(Y2) â‰¤1,
and so B and C are disjoint. Let X be endowed with the supremum norm âˆ¥Yâˆ¥:=
supÏ‰âˆˆ |Y(Ï‰)|. Then C1, and hence C, contains the unit ball in X. In particular, C
has non-empty interior. Thus, we may apply the separation argument in the form of
Theorem A.54, which yields a non-zero continuous linear functional â„“on X such that
c := sup
YâˆˆC
â„“(Y) â‰¤inf
ZâˆˆB
â„“(Z).
Since C contains the unit ball, c must be strictly positive, and there is no loss of
generality in assuming c = 1. In particular, â„“(1) â‰¤1 as 1 âˆˆC. On the other hand,
any constant b > 1 is contained in B, and so
â„“(1) = lim
bâ†“1 â„“(b) â‰¥c = 1.
Hence, â„“(1) = 1.
If A âˆˆF then IAc âˆˆC1 âŠ‚C, which implies that
â„“(IA) = â„“(1) âˆ’â„“(IAc ) â‰¥1 âˆ’1 = 0.
By Theorem A.50 there exists a ï¬nitely additive set function QX âˆˆM1,f (, F ) such
that â„“(Y) = EQX[ Y ] for any Y âˆˆX.
It remains to show that EQX[ Y ] â‰¥J(Y) for all Y âˆˆX, with equality for Y = X.
By the cash invariance of J, we need only consider the case in which J(Y) > 0. Then
Yn :=
Y
J(Y) + 1
n âˆˆB,
and Yn â†’Y/J(Y) uniformly, whence
EQX[ Y ]
J(Y)
= lim
nâ†‘âˆEQX[ Yn ] â‰¥1.
On the other hand, X/J(X) âˆˆC2 âŠ‚C yields the inequality
EQX[ X ]
J(X)
â‰¤c = 1.
We are now ready to complete the proof of the main result in this section.

98
2 Preferences
Proof of Theorem 2.80. (a): By Remark 2.82, it sufï¬ces to consider the induced
preference relation â‰»on X once the function u has been determined. According
to Lemma 2.83 and the two Propositions 2.84 and 2.85, there exists a convex set
Q âŠ‚M1,f such that
U(X) = min
QâˆˆQ EQ[ u(X) ]
is a numerical representation of â‰»on X. This proves the ï¬rst part of the assertion.
(b): The assumption (2.27) applied to X â‰¡1 and Y â‰¡b < 1 gives that any
sequence with Xn â†—1 is such that Xn â‰»b for large enough n. We claim that
this implies that U(Xn) â†—u(1) = 1. Otherwise, U(Xn) would increase to some
number a < 1. Since u is continuous and strictly increasing, we may take b such that
a < u(b) < 1. But then U(Xn) > U(b) = u(b) > a for large enough n, which is a
contradiction.
In particular, we obtain that for any increasing sequence An âˆˆF such that

n An = 
lim
nâ†‘âˆmin
QâˆˆQ Q[ An ] = lim
nâ†‘âˆU(IAn) = 1.
But this means that each Q âˆˆQ satisï¬es limn Q[ An ] = 1, which is equivalent to the
Ïƒ-additivity of Q.
The continuity assumption (2.27), required for all Xn âˆˆX, is actually quite strong.
In a topological setting, our discussion of risk measures in Chapter 4 will imply the
following version of the representation theorem.
Proposition 2.86. Consider a preference order â‰»as inTheorem 2.80. Suppose that 
is a Polish space with Borel ï¬eld F and that (2.27) holds if Xn and X are continuous.
Then there exists a class of probability measures Q âŠ‚M1(, F ) such that the induced
preference order on X has the robust Savage representation
U(X) = min
QâˆˆQ EQ[ u(X) ]
for continuous X âˆˆX.
Proof. As in the proof of Theorem 2.80, the continuity property of â‰»implies the
corresponding continuity property of U, and hence of the functional J in (2.35). The
result follows by combining Proposition 2.84, which reduces the representation of U
to a representation of J, with Proposition 4.25 applied to the coherent risk measure
Ï := âˆ’J.
Finally, we consider an alternative setting where we ï¬x in advance a reference mea-
sure P on (, F ). In this context, X will be identiï¬ed with the space Lâˆ(, F , P ),
and the representation of preferences will involve measures which are absolutely con-
tinuous with respect to P . Note, however, that this passage from measurable functions
to equivalence classes of random variables in Lâˆ(, F , P ), and from arbitrary proba-
bility measures to absolutely continuous measures, involves a certain loss of robustness
in the face of model uncertainty.

2.6 Probability measures with given marginals
99
Theorem 2.87. Let â‰»be a preference relation as in Theorem 2.80, and assume that
X âˆ¼Y
whenever X = Y P -a.s.
(a) There exists a robust Savage representation of the form
U(X) = inf
QâˆˆQ EQ

u(X)

,
X âˆˆX,
where Q consists of probability measures on (, F ) which are absolutely continuous
with respect to P , if and only if â‰»satisï¬es the following condition of continuity from
above:
Y â‰»X and Xn â†˜X P -a.s.
"â‡’
Y â‰»Xn
P -a.s. for all large n.
(b) There exists a representation of the form
U(X) = min
QâˆˆQ EQ

u(X)

,
X âˆˆX,
where Q consists of probability measures on (, F ) which are absolutely continuous
with respect to P , if and only if â‰»satisï¬es the following condition of continuity from
below:
X â‰»Y and Xn â†—X P -a.s.
"â‡’
Xn â‰»Y
P -a.s. for all large n.
Proof. As in the proof of Theorem 2.80, the continuity property of â‰»implies the
corresponding continuity property of U, and hence of the functional J in (2.35). The
results follow by combining Proposition 2.84, which reduces the representation of U
to a representation of J, with Corollary 4.34 and Corollary 4.35 applied to the coherent
risk measure Ï := âˆ’J.
2.6 Probability measures with given marginals
In this section, we study the construction of probability measures with given marginals.
In particular, this will yield the missing implication in the characterization of uniform
preference in Theorem 2.58, but the results in this section are of independent interest.
We focus on the following basic question: Suppose Âµ1 and Âµ2 are two probability
measures on S, and  is a convex set of probability measures on S Ã— S; when does 
contain some Âµ which has Âµ1 and Âµ2 as marginals?
The answer to this question will be given in a general topological setting. Let S be
a Polish space, and let us ï¬x a continuous function Ïˆ on S with values in [1, âˆ). As
in Section 2.2 and in Appendix A.6, we use Ïˆ as a gauge function in order to deï¬ne
the space of measures
MÏˆ
1 (S) :=
$
Âµ âˆˆM1(S)


Ïˆ(x) Âµ(dx) < âˆ
%

100
2 Preferences
and the space of continuous test functions
CÏˆ(S) :=

f âˆˆC(S) | âˆƒc : |f (x)| â‰¤c Â· Ïˆ(x) for all x âˆˆS

.
The Ïˆ-weak topology on MÏˆ
1 (S) is the coarsest topology such that
MÏˆ
1 (S) âˆ‹Âµ â†’

f dÂµ
is a continuous mapping for all f âˆˆCÏˆ(S); see Appendix A.6 for details. On the
product space S Ã— S, we take the gauge function
Ïˆ(x, y) := Ïˆ(x) + Ïˆ(y),
and deï¬ne the corresponding set MÏˆ
1 (S Ã—S), which will be endowed with the Ïˆ-weak
topology.
Theorem 2.88. Suppose that  âŠ‚MÏˆ
1 (S Ã— S) is convex and closed in the Ïˆ-weak
topology, and that Âµ1, Âµ2 are probability measures in MÏˆ
1 (S). Then there exists some
Âµ âˆˆ with marginal distributions Âµ1 and Âµ2 if and only if

f1 dÂµ1 +

f2 dÂµ2 â‰¤sup
Î»âˆˆ
 
f1(x)+f2(y)

Î»(dx, dy)
for all f1, f2 âˆˆCÏˆ(S).
Theorem 2.88 is due to V. Strassen [191]. Its proof boils down to an application of
the Hahnâ€“Banach theorem; the difï¬cult part consists in specifying the right topological
setting. First, let us investigate the relations between MÏˆ
1 (S Ã—S) and MÏˆ
1 (S). To this
end, we deï¬ne mappings
Ï€i : MÏˆ
1 (S Ã— S) â†’MÏˆ
1 (S),
i = 1, 2,
that yield the ith marginal distribution of a measure Î» âˆˆMÏˆ
1 (S Ã— S):

f d(Ï€1Î») =

f (x) Î»(dx, dy)
and

f d(Ï€2Î») =

f (y) Î»(dx, dy),
for all f âˆˆCÏˆ(S).
Lemma 2.89. Ï€1 and Ï€2 are continuous and afï¬ne mappings from MÏˆ
1 (S Ã— S) to
MÏˆ
1 (S).
Proof. Suppose that Î»n converges to Î» in MÏˆ
1 (S Ã— S). For f âˆˆCÏˆ(S) let f (x, y) :=
f (x). Clearly, f âˆˆCÏˆ(S Ã— S), and thus

f d(Ï€1Î»n) =

f dÎ»n âˆ’â†’

f dÎ» =

f d(Ï€1Î»).
Therefore, Ï€1 is continuous, and the same is true of Ï€2. Afï¬nity is obvious.

2.6 Probability measures with given marginals
101
Now, let us consider the linear space
E :=

Î±Âµ âˆ’Î²Î½ | Âµ, Î½ âˆˆMÏˆ
1 (S), Î±, Î² âˆˆR

spanned by MÏˆ
1 (S). For Ï = Î±Âµ âˆ’Î²Î½ âˆˆE the integral

f dÏ against a function
f âˆˆCÏˆ(S) is well-deï¬ned and given by

f dÏ = Î±

f dÂµ âˆ’Î²

f dÎ½.
In particular, Ï â†’

f dÏ is linear functional on E, so we can regard CÏˆ(S) as a
subset of the algebraic dual Eâˆ—of E. Note that

f dÏ =

f dÏ for all f âˆˆCÏˆ(S)
implies Ï = Ï, i.e., CÏˆ(S) separates the points of E. We endow E with the coarsest
topology Ïƒ(E, CÏˆ(S)) for which all maps
E âˆ‹Ï â†’

f dÏ,
f âˆˆCÏˆ(S),
are continuous; see Deï¬nition A.57. With this topology, E becomes a locally convex
topological vector space.
Lemma 2.90. Under the above assumptions, MÏˆ
1 (S) is a closed convex subset of E,
and the relative topology of the embedding coincides with the Ïˆ-weak topology.
Proof. The sets of the form
UÎµ(Ï; f1, . . . , fn) :=
n

i=1
$
Ï âˆˆE



fi dÏ âˆ’

fi dÏ
 < Îµ
%
with Ï âˆˆE, n âˆˆN, fi âˆˆCÏˆ(S), and Îµ > 0 form a base of the topology Ïƒ(E, CÏˆ(S)).
Thus, if U âŠ‚E is open, then every point Âµ âˆˆU âˆ©MÏˆ
1 (S) possesses some neigh-
borhood UÎµ(Âµ; f1, . . . , fn) âŠ‚U. But UÎµ(Âµ; f1, . . . , fn) âˆ©MÏˆ
1 (S) is an open neigh-
borhood of Âµ in the Ïˆ-weak topology. Hence, U âˆ©MÏˆ
1 (S) is open in the Ïˆ-weak
topology.
Similarly, one shows that every open set V âŠ‚MÏˆ
1 (S) is of the form
V = U âˆ©MÏˆ
1 (S) for some open subset U of E. This shows that the relative topology
MÏˆ
1 (S) âˆ©Ïƒ

E, CÏˆ(S)

coincides with the Ïˆ-weak topology.
Moreover, MÏˆ
1 (S) is an intersection of closed subsets of E:
MÏˆ
1 (S) =
$
Ï âˆˆE


1 dÏ = 1
%
âˆ©

f âˆˆCÏˆ (S)
f â‰¥0
$
Ï âˆˆE


f dÏ â‰¥0
%
.
Therefore, MÏˆ
1 (S) is closed in E.

102
2 Preferences
Next, let E2 denote the product space E Ã— E. We endow E2 with the product
topology for which the sets U Ã— V with U, V âˆˆÏƒ(E, CÏˆ(S)) form a neighborhood
base. Clearly, E2 is a locally convex topological vector space.
Lemma 2.91. Every continuous linear functional â„“on E2 is of the form
â„“(Ï1, Ï2) =

f1 dÏ1 +

f2 dÏ2
for some f1, f2 âˆˆCÏˆ(S).
Proof. By linearity, â„“is of the form â„“(Ï1, Ï2) = â„“1(Ï1) + â„“2(Ï2), where â„“1(Ï1) :=
â„“(Ï1, 0) and â„“2(Ï2) := â„“(0, Ï2). By continuity of â„“, the set
V := â„“âˆ’1
(âˆ’1, 1)

is open in E2 and contains the point (0, 0). Hence, there are two open neighborhoods
U1, U2 âŠ‚E such that (0, 0) âˆˆU1 Ã— U2 âŠ‚V . Therefore,
0 âˆˆUi âŠ‚â„“âˆ’1
i

(âˆ’1, 1)

for i = 1, 2,
i.e., 0 is an interior point of â„“âˆ’1
i

(âˆ’1, 1)

. It follows that the â„“i are continuous at 0,
which in view of their linearity implies continuity everywhere on E. Finally, we may
conclude from Proposition A.58 that each â„“i is of the form â„“i(Ï) =

fi dÏi for some
fi âˆˆCÏˆ(S).
The proof of the following lemma uses the characterization of compact sets for
the Ïˆ-weak topology that is stated in Corollary A.46. It is here that we need our
assumption that S is Polish.
Lemma 2.92. If  is a closed convex subset of M
Â¯Ïˆ
1 (S Ã— S), then
H := { (Ï€1Î», Ï€2Î») | Î» âˆˆ }
is a closed convex subset of E2.
Proof. It is enough to show that H is closed in MÏˆ
1 (S)2 := MÏˆ
1 (S) Ã— MÏˆ
1 (S),
because Lemma 2.90 implies that the relative topology induced by E2 on MÏˆ
1 (S)2
coincideswiththeproducttopologyfortheÏˆ-weaktopology. Thisisametrictopology
by Corollary A.44. So let (Âµn, Î½n) âˆˆH, n âˆˆN, be a sequence converging to
some (Âµ, Î½) âˆˆMÏˆ
1 (S)2 in the product topology. Since both sequences (Âµn)nâˆˆN
and (Î½n)nâˆˆN are relatively compact for the Ïˆ-weak topology, Corollary A.46 yields
functions Ï†i : S â†’[1, âˆ], i = 1, 2, such that sets of the form Ki
k := {Ï†i â‰¤kÏˆ},
k âˆˆN, are relatively compact in S and such that
sup
nâˆˆN

Ï†1 dÂµn + sup
nâˆˆN

Ï†2 dÎ½n < âˆ.

2.6 Probability measures with given marginals
103
For each n, there exists Î»n âˆˆ such that Ï€1Î»n = Âµn and Ï€2Î»n = Î½n. Hence, if we
let Ï†(x, y) := Ï†1(x) + Ï†2(y), then
sup
nâˆˆN

Ï† dÎ»n = sup
nâˆˆN
	 
Ï†1 dÂµn +

Ï†2 dÎ½n

< âˆ.
Moreover, we claim that each set { Ï† â‰¤kÏˆ} is relatively compact in S Ã— S. To prove
this claim, let li âˆˆN be such that
li â‰¥sup
xâˆˆKi
k
Ïˆ(x) .
Then, since Ïˆ â‰¥1,
{ Ï† â‰¤kÏˆ } âŠ‚K1
k Ã— K2
k(1+l1) âˆªK1
k(1+l2) Ã— K2
k ,
and the right-hand side is a relatively compact set in S Ã— S. It follows from Corollary
A.46 that the sequence (Î»n)nâˆˆN is relatively compact for the Ïˆ-weak topology. Any
accumulation point Î» of this sequence belongs to the closed set . Moreover, Î» has
marginal distributions Âµ and Î½, since the projections Ï€i are continuous according to
Lemma 2.89. Hence (Âµ, Î½) âˆˆH.
Proof of Theorem 2.88. Let Âµ1, Âµ2 âˆˆMÏˆ
1 (S) be given. Since H is closed and
convex in E2 by Lemma 2.92, we may apply Theorem A.56 with B := { (Âµ1, Âµ2) }
and C := H: We conclude that (Âµ1, Âµ2) /âˆˆH if and only if there exists a linear
functional â„“on E2 such that
â„“(Âµ1, Âµ2) >
sup
(Î½1,Î½2)âˆˆH
â„“(Î½1, Î½2) = sup
Î»âˆˆ
â„“(Ï€1Î», Ï€2Î»).
Applying Lemma 2.91 to â„“completes the assertion.
We will now use Theorem 2.88 to deduce the remaining implication of The-
orem 2.58.
We consider here a more general, d-dimensional setting.
Let x =
(x1, . . . , xd) and y = (y1, . . . , yd) be two d-dimensional vectors. We will say that
x â‰¤y if xi â‰¤yi for all i. A function on Rd is called increasing, if it is increasing
with respect to the partial order â‰¤.
Theorem 2.93. Suppose Âµ1 and Âµ2 are Borel probability measures on Rd with

|x|Âµi(dx) < âˆfor i = 1, 2. Then the following assertions are equivalent.
(a)

f dÂµ1 â‰¥

f dÂµ2 for all increasing concave functions f on Rd.
(b) There exists a probability space (, F , P ) with random variables X1 and X2
having distributions Âµ1 and Âµ2, respectively, such that
E[ X2 | X1 ] â‰¤X1
P -a.s.

104
2 Preferences
(c) There exists a kernel Q(x, dy) on Rd such that

Rd y Q(x, dy) â‰¤x
for all x âˆˆRd
and such that Âµ2 = Âµ1Q.
Proof. (a) â‡’(b): We will apply Theorem 2.88 with S := Rd and with the gauge
functions Ïˆ(x) := 1 + |x| and Ïˆ(x, y) := Ïˆ(x) + Ïˆ(y). We denote by Cb(Rd) the
set of bounded and continuous functions on Rd. Let
 :=

f âˆˆCb(Rd)
$
Î» âˆˆMÏˆ
1 (Rd Ã— Rd)


yf (x) Î»(dx, dy) â‰¤

xf (x) Î»(dx, dy)
%
.
Each single set of the intersection is convex and closed in MÏˆ
1 (Rd Ã— Rd), because
the functions g(x, y) := yf (x) and g(x, y) := xf (x) belong to CÏˆ(Rd Ã— Rd) for
f âˆˆCb(S). Therefore,  itself is convex and closed.
Suppose we can show that  contains an element P that has Âµ1 and Âµ2 as marginal
distributions. Then we can take  := Rd Ã— Rd with its Borel Ïƒ-algebra F , and let
X1 and X2 denote the canonical projections on the ï¬rst and the second components,
respectively. By deï¬nition, Xi will have the distribution Âµi, and
E

E[ X2 | X1 ]f (X1)

= E[ X2f (X1) ] â‰¤E[ X1f (X1) ]
for all f âˆˆCb(Rd).
By monotone class arguments, we may thus conclude that
E[ X2 | X1 ] â‰¤X1
P -a.s.
so that the assertion will follow.
It remains to prove the existence of P . To this end, we will apply Theorem 2.88
with the set  deï¬ned above. Take a pair f1, f2 âˆˆCÏˆ(Rd), and let

f2(x) := inf

g(x) | g is concave, increasing, and dominates f2

.
Then 
f2 is concave, increasing, and dominates f2. In fact, 
f2 is the smallest function
with these properties. We have

f1 dÂµ1 +

f2 dÂµ2 â‰¤

f1 dÂµ1 +


f2 dÂµ2
â‰¤

(f1 + 
f2) dÂµ1
â‰¤sup
xâˆˆRd

f1(x) + 
f2(x)

=: r0.
We will establish the condition in Theorem 2.88 for our set  by showing that for
r < r0 we have
r < sup
Î»âˆˆ
 
f1(x) + f2(y)

Î»(dx, dy).

2.6 Probability measures with given marginals
105
To this end, let for z âˆˆRd
z :=
$
Î½ âˆˆMÏˆ
1 (Rd)


x Î½(dx) â‰¤z
%
and
g2(z) := sup
 
f2 dÎ½
 Î½ âˆˆz

.
Then g2 is increasing and g2(z) â‰¥f2(z), because Î´z âˆˆz. Moreover, if Î½1 âˆˆz1
and Î½2 âˆˆz2, then
Î±Î½1 + (1 âˆ’Î±)Î½2 âˆˆÎ±z1+(1âˆ’Î±)z2
for Î± âˆˆ[0, 1]. Therefore, g2 is concave, and we conclude that g2 â‰¥
f2 (recall
that 
f2 is the smallest increasing and concave function dominating f2). Hence, r <
f1(z) + g2(z) for some z âˆˆRd, i.e., there exists some Î½ âˆˆz such that the product
measure Î» := Î´z âŠ—Î½ satisï¬es
r < f1(z) +

f2 dÎ½ =
 
f1(x) + f2(y)

Î»(dx, dy).
But Î» = Î´z âŠ—Î½ âˆˆ.
(b) â‡’(c): This follows as in the proof of the implication (f) â‡’(g) of Theorem 2.58
by using regular conditional distributions.
(c) â‡’(a): As in the proof of (g) â‡’(a) of Theorem 2.58, this follows by an appli-
cation of Jensenâ€™s inequality.
By the same arguments as for Corollary 2.62, we obtain the following result from
Theorem 2.93.
Corollary 2.94. Suppose Âµ1 and Âµ2 are Borel probability measures on Rd such that

|x|Âµi(dx) < âˆ, for i = 1, 2. Then the following conditions are equivalent.
(a)

f dÂµ1 â‰¥

f dÂµ2 for all concave functions f on Rd.
(b) There exists a probability space (, F , P ) with random variables X1 and X2
having distributions Âµ1 and Âµ2, respectively, such that
E[ X2 | X1 ] = X1
P -a.s.
(c) There exists a kernel Q(x, dy) on Rd such that

y Q(x, dy) = x
for all x âˆˆRd
(i.e., Q is a mean-preserving spread) and such that Âµ2 = Âµ1Q.

106
2 Preferences
We conclude this section with a generalization of Theorem 2.70.
Let S be a
Polish space which is endowed with a preference order â‰». We will assume that â‰»is
continuous in the sense of Deï¬nition 2.8. A function on S will be called increasing if
it is increasing with respect to â‰».
Theorem 2.95. For two Borel probability measures Âµ1 and Âµ2 on S, the following
conditions are equivalent.
(a)

f dÂµ1 â‰¥

f dÂµ2 for all bounded, increasing, and measurable functions f
on S.
(b) There exists a probability space (, F , P ) with random variables X1 and X2
having distributions Âµ1 and Âµ2, respectively, such that X1 âª°X2 P -a.s.
(c) There exists a kernel Q on S such that Âµ2 = Âµ1Q and
Q

x, { y | x âª°y }

= 1
for all x âˆˆS.
Proof. (a) â‡’(b): We will apply Theorem 2.88 with the gauge function Ïˆ â‰¡1, so that
MÏˆ
1 (S) is just the space M1(S) of all Borel probability measures on S with the usual
weak topology. Then Ïˆ â‰¡2 which is equivalent to taking Ïˆ := 1. Let
M := { (x, y) âˆˆS Ã— S | x âª°y }.
This set M is closed in S Ã— S by Proposition 2.11. Hence, the portmanteau theorem
in the form of Theorem A.38 implies that the convex set
 := { Î» âˆˆM1(S Ã— S) | Î»(M) = 1 }
is closed in M1(S Ã— S). For f2 âˆˆCb(S), let

f2(x) := sup{ f2(y) | x âª°y }.
Then 
f2 is bounded, increasing, and dominates f2. Therefore, if f1 âˆˆCb(S),

f1 dÂµ1 +

f2 dÂµ2 â‰¤

f1 dÂµ1 +


f2 dÂµ2
â‰¤

(f1 + 
f2) dÂµ1
â‰¤sup
xâˆˆS

f1(x) + 
f2(x)

= sup
xâª°y

f1(x) + f2(y)

.
If x âª°y, then the product measure Î» := Î´x âŠ—Î´y is contained in , and so
sup
xâª°y

f1(x) + f2(y)

= sup
Î»âˆˆ
 
f1(x) + f2(y)

Î»(dx, dy).

2.6 Probability measures with given marginals
107
Hence, all assumptions of Theorem 2.88 are satisï¬ed, and we conclude that there
exists a probability measure P âˆˆ with marginals Âµ1 and Âµ2. Taking  := S Ã— S
and Xi as the projection on the ith coordinate ï¬nishes the proof of (a) â‡’(b).
(b) â‡’(c) follows as in the proof of Theorem 2.58 by using regular conditional
distributions.
(c) â‡’(a) is proved as the corresponding implication of Theorem 2.70.

Chapter 3
Optimality and equilibrium
Consider an investor whose preferences can be expressed in terms of expected utility.
In Section 3.1, we discuss the problem of constructing a portfolio which maximizes
the expected utility of the resulting payoff. The existence of an optimal solution is
equivalent to the absence of arbitrage opportunities. This leads to an alternative proof
of the â€œfundamental theorem of asset pricingâ€, and to a speciï¬c choice of an equivalent
martingale measure deï¬ned in terms of marginal utility. Section 3.2 contains a detailed
case study describing the interplay between exponential utility and relative entropy.
In Section 3.3, the optimization problem is formulated for general contingent claims.
Typically, optimal proï¬les will be non-linear functions of a given market portfolio, and
this is one source of the demand for ï¬nancial derivatives. Section 3.4 introduces the
idea of market equilibrium. Prices of risky assets will no longer be given in advance;
they will be derived as equilibrium prices in a microeconomic setting, where different
agents demand contingent claims in accordance with their preferences and with their
budget constraints.
3.1 Portfolio optimization and the absence of arbitrage
Let us consider the one-period market model of Section 1.1 in which d + 1 assets are
priced at time 0 and at time 1. Prices at time 0 are given by the price system
Ï€ = (Ï€0, Ï€) = (Ï€0, Ï€1, . . . , Ï€d) âˆˆRd+1
+
,
prices at time 1 are modeled by the price vector
S = (S0, S) = (S0, S1, . . . , Sd)
consisting of non-negative random variables Si deï¬ned on some probability space
(, F , P). The 0th asset models a riskless bond, and so we assume that
Ï€0 = 1
and
S0 â‰¡1 + r
for some constant r > âˆ’1. At time t = 0, an investor chooses a portfolio
Î¾ = (Î¾0, Î¾) = (Î¾0, Î¾1, . . . , Î¾d) âˆˆRd+1
where Î¾i represents the amount of shares of the ith asset. Such a portfolio Î¾ requires
an initial investment Ï€ Â· Î¾ and yields at time 1 the random payoff Î¾ Â· S.

3.1 Portfolio optimization and the absence of arbitrage
109
Consider a risk-averse economic agent whose preferences are described in terms
of a utility function u, and who wishes to invest a given amount w into the ï¬nancial
market. Recall from Deï¬nition 2.37 that a real-valued function u is called a utility
function if it is continuous, strictly increasing, and strictly concave. A rational choice
of the investorâ€™s portfolio Î¾ = (Î¾0, Î¾) will be based on the expected utility
E
u(Î¾ Â· S)

(3.1)
of the payoff Î¾ Â· S at time 1, where the portfolio Î¾ satisï¬es the budget constraint
Ï€ Â· Î¾ â‰¤w.
(3.2)
Thus, the problem is to maximize the expected utility (3.1) among all portfolios
Î¾ âˆˆRd+1 which satisfy the budget constraint (3.2). Here we make the implicit
assumption that the payoff Î¾ Â· S is P -a.s. contained in the domain of deï¬nition of the
utility function u.
In a ï¬rst step, we remove the constraint (3.2) by considering instead of (3.1) the
expected utility of the discounted net gain
Î¾ Â· S
1 + r âˆ’Ï€ Â· Î¾ = Î¾ Â· Y
earned by a portfolio Î¾ = (Î¾0, Î¾). Here Y is the d-dimensional random vector with
components
Y i =
Si
1 + r âˆ’Ï€i,
i = 1, . . . , d.
For any portfolio Î¾ with Ï€ Â· Î¾ < w, adding the risk-free investment w âˆ’Ï€ Â· Î¾ would
lead to the strictly better portfolio (Î¾0+wâˆ’Ï€ Â·Î¾, Î¾). Thus, we can focus on portfolios
Î¾ which satisfy Ï€ Â· Î¾ = w, and then the payoff is an afï¬ne function of the discounted
net gain:
Î¾ Â· S = (1 + r)(Î¾ Â· Y + w).
Moreover, for any Î¾ âˆˆRd there exists a unique numÃ©raire component Î¾0 âˆˆR such
that the portfolio Î¾ := (Î¾0, Î¾) satisï¬es Ï€ Â· Î¾ = w.
Let u denote the following transformation of our original utility function u:
u(y) := u

(1 + r)(y + w)

.
Note that u is again a utility function, and that CARA and (shifted) HARA utility
functions are transformed into utility functions in the same class.
Clearly, the original constrained utility maximization problem is equivalent to the
unconstrained problem of maximizing the expected utility E[ u(Î¾ Â· Y) ] among all
Î¾ âˆˆRd such that Î¾ Â· Y is contained in the domain D of u.

110
3 Optimality and equilibrium
Assumption 3.1. We assume one of the following two cases:
(a) D = R. In this case, we will admit all portfolios Î¾ âˆˆRd, but we assume that u
is bounded from above.
(b) D = [a, âˆ) for some a < 0. In this case, we only consider portfolios which
satisfy the constraint
Î¾ Â· Y â‰¥a
P -a.s.,
and we assume that the expected utility generated by such portfolios is ï¬nite,
i.e.,
E[ u(Î¾ Â· Y) ] < âˆ
for all Î¾ âˆˆRd with Î¾ Â· Y â‰¥a P-a.s.
Remark 3.2. Part (a) of this assumption is clearly satisï¬ed in the case of an exponen-
tial utility function u(x) = 1 âˆ’eâˆ’Î±x. Domains of the form D = [a, âˆ) appear, for
example, in the case of (shifted) HARA utility functions u(x) = log(x âˆ’b) for b < a
and u(x) = 1
Î³ (x âˆ’c)Î³ for c â‰¤a and 0 < Î³ < 1. The integrability assumption in (b)
holds if E[ |Y| ] < âˆ, because any concave function is bounded above by an afï¬ne
function.
â™¦
In order to simplify notations, let us denote by
S(D) := { Î¾ âˆˆRd | Î¾ Â· Y âˆˆD P-a.s. }
the set of admissible portfolios for D. Clearly, S(D) = Rd if D = R. Our aim is
to ï¬nd some Î¾âˆ—âˆˆS(D) which is optimal in the sense that it maximizes the expected
utility E[ u(Î¾ Â·Y) ] among all Î¾ âˆˆS(D). In this case, Î¾âˆ—will be an optimal investment
strategy into the risky assets. Complementing Î¾âˆ—with a suitable numÃ©raire component
Î¾0 yields a portfolio Î¾âˆ—= (Î¾0, Î¾âˆ—) which maximizes the expected utility E[u(Î¾ Â· S) ]
under the budget constraint Ï€ Â· Î¾ = w. Our ï¬rst result in this section will relate the
existence of such an optimal portfolio to the absence of arbitrage opportunities.
Theorem 3.3. Suppose that the utility function u : D â†’R satisï¬es Assumption 3.1.
Then there exists a maximizer of the expected utility
E[ u(Î¾ Â· Y) ],
Î¾ âˆˆS(D),
if and only if the market model is arbitrage-free. Moreover, there exists at most one
maximizer if the market model is non-redundant in the sense of Deï¬nition 1.13.
Proof. The uniqueness part of the assertion follows immediately from the strict con-
cavity of the function Î¾ â†’E[ u(Î¾ Â· Y) ] for non-redundant market models. As to
existence, we may assume without loss of generality that our model is non-redundant.
If the non-redundance condition (1.8) does not hold, then we deï¬ne a linear space
N âŠ‚Rd by
N := { Î· âˆˆRd | Î· Â· Y = 0 P -a.s. }.

3.1 Portfolio optimization and the absence of arbitrage
111
Clearly, Y takes P -a.s. values in the orthogonal complement NâŠ¥of N. Moreover,
the no-arbitrage condition (1.3) holds for all Î¾ âˆˆRd if and only if it is satisï¬ed for
all Î¾ âˆˆNâŠ¥. By identifying NâŠ¥with some Rn, we arrive at a situation in which the
non-redundance condition (1.8) is satisï¬ed and where we may apply our result for
non-redundant market models.
If the model admits arbitrage opportunities, then a maximizer Î¾âˆ—of the expected
utility E[ u(Î¾ Â· Y) ] cannot exist: Adding to Î¾âˆ—some non-zero Î· âˆˆRd for which
Î· Â· Y â‰¥0 P-a.s., which exists by Lemma 1.3, would yield a contradiction to the
optimality of Î¾âˆ—, because then
E[ u(Î¾âˆ—Â· Y) ] < E[ u((Î¾âˆ—+ Î·) Â· Y) ].
From now on, we assume that the market model is arbitrage-free. Let us ï¬rst
consider the case in which D = [a, âˆ) for some a âˆˆ(âˆ’âˆ, 0). Then S(D) is
compact. In order to prove this claim, suppose by way of contradiction that (Î¾n) is a
diverging sequence in S(D). By choosing a subsequence if necessary, we may assume
that Î·n := Î¾n/|Î¾n| converges to some unit vector Î· âˆˆRd. Clearly,
Î· Â· Y = lim
nâ†‘âˆ
Î¾n Â· Y
|Î¾n|
â‰¥lim
nâ†‘âˆ
a
|Î¾n| = 0
P -a.s.,
and so non-redundance implies that Î· := (âˆ’Ï€ Â· Î·, Î·) is an arbitrage-opportunity.
In the next step, we show that our assumptions guarantee the continuity of the
function
S(D) âˆ‹Î¾ â†’E[ u(Î¾ Â· Y) ],
which, in view of the compactness of S(D), will imply the existence of a maximizer of
the expected utility. To this end, it sufï¬ces to construct an integrable random variable
which dominates u(Î¾ Â· Y) for all Î¾ âˆˆS(D). Deï¬ne Î· âˆˆRd by
Î·i := 0 âˆ¨max
Î¾âˆˆS(D) Î¾i < âˆ.
Then, Î· Â· S â‰¥Î¾ Â· S for Î¾ âˆˆS(D), and hence
Î¾ Â· Y = Î¾ Â· S
1 + r âˆ’Ï€ Â· Î¾ â‰¤Î· Â· S
1 + r âˆ’0 âˆ§
min
Î¾â€²âˆˆS(D) Ï€ Â· Î¾â€².
Note that Î· Â· Y is bounded below by âˆ’Ï€ Â· Î· and that there exists some Î± âˆˆ(0, 1] such
that Î±Ï€ Â· Î· < |a|. Hence Î±Î· âˆˆS(D), and our assumptions imply E[ u(Î±Î· Â· Y) ] <
âˆ. Applying Lemma 3.4 below ï¬rst with b := Î±Ï€ Â· Î· and then with b := âˆ’0 âˆ§
minÎ¾â€²âˆˆS(D) Ï€ Â· Î¾â€² shows that
E

u
 Î· Â· S
1 + r âˆ’0 âˆ§
min
Î¾â€²âˆˆS(D) Ï€ Â· Î¾â€²
 
< âˆ.
This concludes the proof of the theorem in case D = [a, âˆ).

112
3 Optimality and equilibrium
Let us now turn to the case of a utility function on D = R which is bounded from
above. We will reduce the assertion to a general existence criterion for minimizers of
lower semicontinuous convex functions on Rd, given in Lemma 3.5 below. It will be
applied to the convex function h(Î¾) := âˆ’E[ u(Î¾ Â· Y) ]. We must show that h is lower
semicontinuous. Take a sequence (Î¾n)nâˆˆN in Rd converging to some Î¾. By part (a) of
Assumption 3.1, the random variables âˆ’u(Î¾n Â· Y) are uniformly bounded below, and
so we may apply Fatouâ€™s lemma:
lim inf
nâ†‘âˆh(Î¾n) = lim inf
nâ†‘âˆE[ âˆ’u(Î¾n Â· Y) ] â‰¥E[ âˆ’u(Î¾ Â· Y) ] = h(Î¾).
Thus, h is lower semicontinuous.
By our non-redundance assumption, h is strictly convex and admits at most one
minimizer. We claim that the absence of arbitrage opportunities is equivalent to the
following condition:
lim
Î±â†‘âˆh(Î± Î¾) = +âˆ
for all non-zero Î¾ âˆˆRd.
(3.3)
This is just the condition (3.4) required in Lemma 3.5. It follows from (1.3) and
(1.8) that a non-redundant market model is arbitrage-free if and only if each non-zero
Î¾ âˆˆRd satisï¬es P [Î¾ Â· Y < 0] > 0. Since the utility function u is strictly increasing
and concave, the set {Î¾ Â· Y < 0} can be described as
{ Î¾ Â· Y < 0 } = { lim
Î±â†‘âˆu(Î± Î¾ Â· Y) = âˆ’âˆ}
for Î¾ âˆˆRd.
The probability of the right-hand set is strictly positive if and only if
lim
Î±â†‘âˆE[ u(Î±Î¾ Â· Y) ] = âˆ’âˆ,
because u is bounded from above. This observation proves that the absence of arbitrage
opportunities is equivalent to the condition (3.3) and completes the proof.
Lemma 3.4. If D = [a, âˆ), b < |a|, 0 < Î± â‰¤1, and X is a non-negative random
variable, then
E[ u(Î±X âˆ’b) ] < âˆ
"â‡’
E[ u(X) ] < âˆ.
Proof. As in (A.1) in the proof of Proposition A.4, we obtain that
u(X) âˆ’u(0)
X âˆ’0
â‰¤u(Î±X) âˆ’u(0)
Î±X âˆ’0
â‰¤u(Î±X âˆ’b) âˆ’u(âˆ’b)
Î±X âˆ’b âˆ’(âˆ’b)
.
Multiplying by Î±X shows that u(X) can be dominated by a multiple of u(Î±X âˆ’b)
plus some constant.

3.1 Portfolio optimization and the absence of arbitrage
113
Lemma 3.5. Suppose h : Rd â†’R âˆª{+âˆ} is a convex and lower semicontinuous
function with h(0) < âˆ. Then h attains its inï¬mum provided that
lim
Î±â†‘âˆh(Î± Î¾) = +âˆ
for all non-zero Î¾ âˆˆRd.
(3.4)
Moreover, if h is strictly convex on {h < âˆ}, then also the converse implication holds:
the existence of a minimizer implies (3.4).
Proof.
First suppose that (3.4) holds.
We will show below that the â€œlevel setsâ€
{ x | h(x) â‰¤c } of h are bounded â€“ hence compact â€“ for c > inf h. Once the
compactness of the level sets is established, it follows that the set
{ x âˆˆRd | h(x) = inf h } =

c>inf h
{ x âˆˆRd | h(x) â‰¤c }
of minimizers of h is non-empty as an intersection of decreasing and non-empty
compact sets.
Suppose c > inf h is such that the level set {h â‰¤c} is not compact, and take
a sequence (xn) in {h â‰¤c} such that |xn| â†’âˆ. By passing to a subsequence if
necessary, we may assume that xn/|xn| converges to some non-zero Î¾. For any Î± > 0,
h(Î±Î¾) â‰¤lim inf
nâ†‘âˆh

Î± xn
|xn|

= lim inf
nâ†‘âˆh
 Î±
|xn| xn +

1 âˆ’
Î±
|xn|

0

â‰¤lim inf
nâ†‘âˆ
 Î±
|xn| c +

1 âˆ’
Î±
|xn|

h(0)

= h(0).
Thus, we arrive at a contradiction to condition (3.4). This completes the proof of the
existence of a minimizer under assumption (3.4).
In order to prove the converse implication, suppose that the strictly convex function
h has a minimizer xâˆ—but that there exists a non-zero Î¾ âˆˆRd violating (3.4), i.e., there
exists a sequence (Î±n)nâˆˆN and some c < âˆsuch that Î±n â†‘âˆbut h(Î±nÎ¾) â‰¤c for
all n. Let
xn := Î»nxâˆ—+ (1 âˆ’Î»n)Î±nÎ¾
where Î»n is such that |xâˆ—âˆ’xn| = 1, which is possible for all large enough n. By
the compactness of the Euclidean unit sphere centered in xâˆ—, we may assume that xn
converges to some x. Then necessarily |x âˆ’xâˆ—| = 1. As Î±nÎ¾ diverges, we must have
that Î»n â†’1. By using our assumption that h(Î±nÎ¾) is bounded, we obtain
h(x) â‰¤lim inf
nâ†‘âˆh(xn) â‰¤lim
nâ†‘âˆ

Î»nh(xâˆ—) + (1 âˆ’Î»n)h(Î±nÎ¾)

= h(xâˆ—).
Hence, x is another minimizer of h besides xâˆ—, contradicting the strict convexity of h.
Thus, (3.4) must hold if the strictly convex function h takes on its inï¬mum.

114
3 Optimality and equilibrium
Remark 3.6. Note that the proof of Theorem 3.3 under Assumption 3.1 (a) did not
use the fact that the components of Y are bounded from below. The result remains
true for arbitrary Y.
â™¦
We turn now to a characterization of the solution Î¾âˆ—of our utility maximization
problem for continuously differentiable utility functions.
Proposition 3.7. Let u be a continuously differentiable utility function on D such that
E[ u(Î¾ Â· Y) ] is ï¬nite for all Î¾ âˆˆS(D). Suppose that Î¾âˆ—is a solution of the utility
maximization problem, and that one of the following two sets of conditions is satisï¬ed:
â€¢ u is deï¬ned on D = R and is bounded from above.
â€¢ u is deï¬ned on D = [a, âˆ), and Î¾âˆ—is an interior point of S(D).
Then
uâ€²(Î¾âˆ—Â· Y) |Y| âˆˆL1(P ),
and the following â€œï¬rst-order conditionâ€ holds:
E[ uâ€²(Î¾âˆ—Â· Y) Y ] = 0.
(3.5)
Proof. For Î¾ âˆˆS(D) and Îµ âˆˆ(0, 1] let Î¾Îµ := ÎµÎ¾ + (1 âˆ’Îµ)Î¾âˆ—, and deï¬ne
Îµ := u(Î¾Îµ Â· Y) âˆ’u(Î¾âˆ—Â· Y)
Îµ
.
The concavity of u implies that Îµ â‰¥Î´ for Îµ â‰¤Î´, and so
Îµ â†—uâ€²(Î¾âˆ—Â· Y) (Î¾ âˆ’Î¾âˆ—) Â· Y
as Îµ â†“0.
Note that our assumptions imply that u(Î¾ Â·Y) âˆˆL1(P ) for all Î¾ âˆˆS(D). In particular,
we have 1 âˆˆL1(P ), so that monotone convergence and the optimality of Î¾âˆ—yield
that
0 â‰¥E[ Îµ ] â†—E[ uâ€²(Î¾âˆ—Â· Y) (Î¾ âˆ’Î¾âˆ—) Â· Y ]
as Îµ â†“0.
(3.6)
In particular, the expectation on the right-hand side of (3.6) is ï¬nite.
Both sets of assumptions imply that Î¾âˆ—is an interior point of S(D). Hence, we
deduce from (3.6) by letting Î· := Î¾ âˆ’Î¾âˆ—that
E[ uâ€²(Î¾âˆ—Â· Y) Î· Â· Y ] â‰¤0
for all Î· in a small ball centered in the origin of Rd. Replacing Î· by âˆ’Î· shows that
the expectation must vanish.
Remark 3.8. Let us comment on the assumption that the optimal Î¾âˆ—is an interior
point of S(D):

3.1 Portfolio optimization and the absence of arbitrage
115
(a) If the non-redundance condition (1.8) is not satisï¬ed, then either each or none of
the solutions to the utility maximization problem is contained in the interior of
S(D). This can be seen by using the reduction argument given at the beginning
of the proof of Theorem 3.3.
(b) Note that Î¾ Â· Y is bounded below by âˆ’Ï€ Â· Î¾ in case Î¾ has only non-negative
components. Thus, the interior of S(D) is always non-empty.
(c) As shown by the following example, the optimal Î¾âˆ—need not be contained in the
interior of S(D) and, in this case, the ï¬rst-order condition (3.5) will generally
fail.
â™¦
Example 3.9. Take r = 0, and let S1 be integrable but unbounded. We choose
D = [a, âˆ) with a := âˆ’Ï€1, and we assume that P [ S1 â‰¤Îµ ] > 0 for all Îµ > 0.
Then S(D) = [0, 1]. If 0 < E[ S1 ] < Ï€1 then Example 2.43 shows that the optimal
investment is given by Î¾âˆ—= 0, and so Î¾âˆ—lies in the boundary of S(D). Thus, if u is
sufï¬ciently smooth,
E[ uâ€²(Î¾âˆ—Â· Y) Y ] = uâ€²(0)

E[ S1 ] âˆ’Ï€1
< 0.
The intuitive reason for this failure of the ï¬rst-order condition is that taking a short
position in the asset would be optimal as soon as E[ S1 ] < Ï€1. This choice, however,
is ruled out by the constraint Î¾ âˆˆS(D).
â™¦
Proposition 3.7 yields a formula for the density of a particular equivalent risk-
neutral measure. Recall that P âˆ—is risk-neutral if and only if Eâˆ—[ Y ] = 0.
Corollary 3.10. Suppose that the market model is arbitrage-free and that the as-
sumptions of Proposition 3.7 are satisï¬ed for a utility function u : D â†’R and an
associated maximizer Î¾âˆ—of the expected utility E[u(Î¾ Â· Y)]. Then
dP âˆ—
dP =
uâ€²(Î¾âˆ—Â· Y)
E[uâ€²(Î¾âˆ—Â· Y)]
(3.7)
deï¬nes an equivalent risk neutral measure.
Proof. Proposition 3.7 states that uâ€²(Î¾âˆ—Â·Y)Y is integrable with respect to P and that its
expectation vanishes. Hence, we may conclude that P âˆ—is an equivalent risk-neutral
measure if we can show that P âˆ—is well-deï¬ned by (3.7), i.e., if uâ€²(Î¾âˆ—Â· Y) âˆˆL1(P ).
Let
c := sup{ uâ€²(x) | x âˆˆD and |x| â‰¤|Î¾âˆ—| } â‰¤

uâ€²(a)
for D = [a, âˆ),
uâ€²(âˆ’|Î¾âˆ—|)
for D = R,
which is ï¬nite by our assumption that u is continuously differentiable on all of D.
Thus,
0 â‰¤uâ€²(Î¾âˆ—Â· Y) â‰¤c + uâ€²(Î¾âˆ—Â· Y)|Y| Â· I{|Y|â‰¥1},
and the right-hand side has a ï¬nite expectation.

116
3 Optimality and equilibrium
Remark 3.11. Corollary 3.10 yields an independent and constructive proof of the
â€œfundamental theorem of asset pricingâ€ in the form of Theorem 1.6: Suppose that the
model is arbitrage-free. If Y is P -a.s. bounded, then so is u(Î¾âˆ—Â· Y), and the measure
P âˆ—of (3.7) is an equivalent risk-neutral measure with a bounded density dP âˆ—/dP . If
Y is unbounded, then we may consider the bounded random vector
Y :=
Y
1 + |Y|,
which also satisï¬es the no-arbitrage condition (1.3). Let Î¾âˆ—be a maximizer of the
expected utility E[ u(Î¾ Â· Y) ]. Then an equivalent risk-neutral measure P âˆ—is deï¬ned
through the bounded density
dP âˆ—
dP := c Â· uâ€²(Î¾âˆ—Â· Y)
1 + |Y| ,
where c is an appropriate normalizing constant.
â™¦
Example 3.12. Consider the exponential utility function
u(x) = 1 âˆ’eâˆ’Î±x
with constant absolute risk aversion Î± > 0. The requirement that E[ u(Î¾ Â·Y) ] is ï¬nite
is equivalent to the condition
E[ eÎ¾Â·Y ] < âˆ
for all Î¾ âˆˆRd.
If Î¾âˆ—is a maximizer of the expected utility, then the density of the equivalent risk
neutral measure P âˆ—in (3.7) takes the particular form
dP âˆ—
dP =
eâˆ’Î±Î¾âˆ—Â·Y
E[ eâˆ’Î±Î¾âˆ—Â·Y ].
In fact, P âˆ—is independent of Î± since Î¾âˆ—maximizes the expected utility 1âˆ’E[ eâˆ’Î±Î¾Â·Y ]
if and only if Î»âˆ—:= âˆ’Î±Î¾âˆ—is a minimizer of the moment generating function
Z(Î») := E[ eÎ»Â·Y ],
Î» âˆˆRd,
of Y. In Corollary 3.25 below, the measure P âˆ—will be characterized by the fact that
it minimizes the relative entropy with respect to P among the risk-neutral measures
in P ; see Deï¬nition 3.20 below.
â™¦
3.2 Exponential utility and relative entropy
In this section we give a more detailed study of the problem of portfolio optimization
with respect to a CARA utility function
u(x) = 1 âˆ’eâˆ’Î±x

3.2 Exponential utility and relative entropy
117
for Î± > 0. As in the previous Section 3.1, the problem is to maximize the expected
utility
E[ u(Î¾ Â· Y) ]
of the discounted net gain Î¾ Â· Y earned by an investment into risky assets. The key
assumption for this problem is that
E[ u(Î¾ Â· Y) ] > âˆ’âˆ
for all Î¾ âˆˆRd.
(3.8)
Recall from Example 3.12 that the maximization of E[ u(Î¾ Â· Y) ] is reduced to the
minimization of the moment generating function
Z(Î») := E[ eÎ»Â·Y ],
Î» âˆˆRd,
which does not depend on the risk aversion Î±. The key assumption (3.8) is equivalent
to the condition that
Z(Î») < âˆ
for all Î» âˆˆRd.
(3.9)
Throughout this section, we will always assume that (3.9) holds. But we will not need
the assumption that Y is bounded from below (which in our ï¬nancial market model
follows from assuming that asset prices are non-negative); all results remain true for
general random vectors Y; see also Remarks 1.7 and 3.6.
Lemma 3.13. The condition (3.9) is equivalent to
E[ eÎ±|Y| ] < âˆ
for all Î± > 0.
Proof. Clearly, the condition in the statement of the lemma implies (3.9). To prove
the converse assertion, take a constant c > 0 such that |x| â‰¤c d
i=1 |xi| for x âˆˆRd.
By HÃ¶lderâ€™s inequality,
E[ eÎ±|Y| ] â‰¤E
 
exp
	
Î±c
d

i=1
|Y i|

 !
â‰¤
d
i=1
E[ eÎ±cd|Y i| ]1/d.
In order to show that the ith factor on the right is ï¬nite, take Î» âˆˆRd such that Î»i = Î±cd
and Î»j = 0 for j Ì¸= i. With this choice,
E[ eÎ±cd|Y i| ] â‰¤E[ eÎ»Â·Y ] + E[ eâˆ’Î»Â·Y ],
which is ï¬nite by (3.9).
Deï¬nition 3.14. The exponential family of P with respect to Y is the set of measures
{ PÎ» | Î» âˆˆRd }
deï¬ned via
dPÎ»
dP = eÎ»Â·Y
Z(Î»).

118
3 Optimality and equilibrium
Example 3.15. Suppose that the risky asset S1 has under P a Poisson distribution
with parameter Î± > 0, i.e., S1 takes values in {0, 1, . . . } and satisï¬es
P [ S1 = k ] = eâˆ’Î± Î±k
k! ,
k = 0, 1, . . . .
Then (3.9) is satisï¬ed for Y := S1 âˆ’Ï€1, and S1 has under PÎ» a Poisson distribution
with parameter eÎ»Î±. Hence, the exponential family of P generates the family of all
Poisson distributions.
â™¦
Example 3.16. Let Y have a standard normal distribution N(0, 1). Then (3.9) is
satisï¬ed, and the distribution of Y under PÎ» is equal to the normal distribution N(Î», 1)
with mean Î» and variance 1.
â™¦
Remark 3.17. Two parameters Î» and Î»â€² in Rd determine the same element in the
exponential family of P if and only if (Î» âˆ’Î»â€²) Â· Y = 0 P -almost surely. It follows
that the mapping
Î» âˆ’â†’PÎ»
is injective provided that the non-redundance condition holds in the form
Î¾ Â· Y = 0 P -a.s.
"â‡’
Î¾ = 0.
(3.10)
â™¦
In the sequel, we will be interested in the barycenters of the members of the
exponential family of P with respect to Y. We denote
m(Î») := EÎ»[ Y ] =
1
Z(Î»)E[ YeÎ»Â·Y ],
Î» âˆˆRd.
The next lemma shows that m(Î») can be obtained as the gradient of the logarithmic
moment generating function.
Lemma 3.18. Z is a smooth function on Rd, and the gradient of log Z at Î» is the
expectation of Y under PÎ»:
(âˆ‡log Z)(Î») = EÎ»[ Y ] = m(Î»).
Moreover, the Hessian of log Z at Î» equals the covariance matrix (covPÎ»(Y i, Y j))i,j
of Y under the measure PÎ»:
âˆ‚2
âˆ‚Î»i âˆ‚Î»j log Z(Î») = covPÎ»(Y i, Y j) = EÎ»[ Y iY j ] âˆ’EÎ»[ Y i ]EÎ»[ Y j ].
In particular, log Z is convex.

3.2 Exponential utility and relative entropy
119
Proof. Observe that

âˆ‚eÎ»Â·x
âˆ‚Î»i
 = |xi| eÎ»Â·x â‰¤exp

(1 + |Î»|) Â· |x|

.
Hence, Lemma 3.13 and Lebesgueâ€™s dominated convergence theorem justify the in-
terchanging of differentiation and integration (see the â€œdifferentiation lemmaâ€ in [20],
Â§16, for details).
The following corollary summarizes the results we have obtained so far. Recall
from Section 1.5 the notion of the convex hull (Î½) of the support of a measure Î½ on
Rd and the deï¬nition of the relative interior ri C of a convex set C.
Corollary 3.19. Denote by Âµ := P â—¦Y âˆ’1 the distribution of Y under P . Then the
function
Î» âˆ’â†’Î» Â· m0 âˆ’log Z(Î»)
takes on its maximum if and only if m0 is contained in the relative interior of the convex
hull of the support of Âµ, i.e., if and only if
m0 âˆˆri (Âµ).
In this case, any maximizer Î»âˆ—satisï¬es
m0 = m(Î»âˆ—) = EÎ»âˆ—[ Y ].
In particular, the set {m(Î») | Î» âˆˆRd} coincides with ri (Âµ). Moreover, if the
non-redundance condition (3.10) holds, then there exists at most one maximizer Î»âˆ—.
Proof. Taking Y := Y âˆ’m0 reduces the problem to the situation where m0 = 0.
ApplyingTheorem 3.3 with the utility function u(z) = 1âˆ’eâˆ’z shows that the existence
of a maximizer Î»âˆ—of âˆ’logZ is equivalent to the absence of arbitrage opportunities.
Corollary 3.10 states that m(Î»âˆ—) = 0 and that 0 belongs to Mb(Âµ), where Mb(Âµ) was
deï¬ned in Lemma 1.42. An application of Theorem 1.48 completes the proof.
It will turn out that the maximization problem of the previous corollary is closely
related to the following concept.
Deï¬nition 3.20. The relative entropy of a probability measure Q with respect to P is
deï¬ned as
H(Q|P ) :=
ï£±
ï£²
ï£³
E
 dQ
dP log dQ
dP

if Q â‰ªP ,
+âˆ
otherwise.
Remark 3.21. Jensenâ€™s inequality applied to the strictly convex function h(x) =
x log x yields
H(Q|P ) = E

h
dQ
dP
 
â‰¥h(1) = 0,
(3.11)
with equality if and only if Q = P .
â™¦

120
3 Optimality and equilibrium
Example 3.22. Let  be a ï¬nite set and F be its power set. Every probability Q on
(, F ) is absolutely continuous with respect to the uniform distribution P . Let us
denote Q(Ï‰) := Q[ {Ï‰} ]. Clearly,
H(Q|P ) =

Ï‰âˆˆ
Q(Ï‰) log Q(Ï‰)
P (Ï‰) =

Ï‰âˆˆ
Q(Ï‰) log Q(Ï‰) + log ||.
The quantity
H(Q) := âˆ’

Ï‰âˆˆ
Q(Ï‰) log Q(Ï‰)
is usually called the entropy of Q. Observe that H(P ) = log ||, so that
H(Q|P ) = H(P) âˆ’H(Q).
Since the left-hand side is non-negative by (3.11), the uniform distribution P has
maximal entropy among all probability distributions on (, F ).
â™¦
Example 3.23. Let Âµ = N(m, Ïƒ 2) denote the normal distribution with mean m and
variance Ïƒ 2 on R. Then, for Âµ = N(
m,Ïƒ 2)
dÂµ
dÂµ(x) = Ïƒ
Ïƒ exp

âˆ’(x âˆ’
m)2
2Ïƒ 2
+ (x âˆ’m)2
2Ïƒ 2

,
and hence
H(Âµ|Âµ) = 1
2

log Ïƒ 2
Ïƒ 2 âˆ’1 + Ïƒ 2
Ïƒ 2

+ 1
2
m âˆ’
m
Ïƒ
2
.
â™¦
The following result shows that PÎ» is the unique minimizer of the relative entropy
H(Q|P ) among all probability measures Q with EQ[ Y ] = EÎ»[ Y ].
Theorem 3.24. Let m0 := m(PÎ»0) for some given Î»0 âˆˆRd. Then, for any probability
measure Q on (, F ) such that EQ[ Y ] = m0,
H(Q|P ) â‰¥H(PÎ»0|P ) = Î»0 Â· m0 âˆ’log Z(Î»0),
and equality holds if and only if Q = PÎ»0. Moreover, Î»0 maximizes the function
Î» Â· m0 âˆ’log Z(Î»)
over all Î» âˆˆRd.
Proof. Let Q be a probability measure on (, F ) such that EQ[ Y ] = m0. We show
ï¬rst that for all Î» âˆˆRd
H(Q|P ) = H(Q|PÎ») + Î» Â· m0 âˆ’log Z(Î»).
(3.12)

3.2 Exponential utility and relative entropy
121
To this end, note that both sides of (3.12) are inï¬nite if Q Ì¸â‰ªP . Otherwise
dQ
dP = dQ
dPÎ»
Â· dPÎ»
dP = dQ
dPÎ»
Â· eÎ»Â·Y
Z(Î»),
and taking logarithms and integrating with respect to Q yields (3.12).
Since H(Q|PÎ») â‰¥0 according to (3.11), we get from (3.12) that
H(Q|P ) â‰¥Î» Â· m0 âˆ’log Z(Î»)
(3.13)
for all Î» âˆˆRd and all measures Q such that EQ[ Y ] = m0. Moreover, equality holds
in (3.13) if and only if H(Q|PÎ») = 0, which is equivalent to Q = PÎ». In this case, Î»
must be such that m(Î») = m0. In particular, for any such Î»
H(PÎ»|P ) = Î» Â· m0 âˆ’log Z(Î»).
Thus, Î»0 maximizes the right-hand side of (3.13), and PÎ»0 minimizes the relative
entropy on the set
M0 := { Q | EQ[ Y ] = m0 }.
But the relative entropy H(Q|P ) is a strictly convex functional of Q, and so it can
have at most one minimizer in the convex set M0. Thus, any Î» with m(Î») = m0
induces the same measure PÎ»0.
Taking m0 = 0 in the preceding theorem yields a special equivalent risk-neutral
measure in our ï¬nancial market model, namely the entropy-minimizing risk neutral
measure. Sometimes it is also called the Esscher transform of P . Recall our assump-
tion (3.9).
Corollary 3.25. Suppose the market model is arbitrage-free. Then there exists a
unique equivalent risk-neutral measure P âˆ—âˆˆP which minimizes the relative entropy
H( Ë†P |P) over all Ë†P âˆˆP. The density of P âˆ—is of the form
dP âˆ—
dP =
eÎ»âˆ—Â·Y
E[ eÎ»âˆ—Â·Y ],
where Î»âˆ—denotes a minimizer of the moment generating function E[ eÎ»Â·Y ] of Y.
Proof. This follows immediately from Corollary 3.19 and Theorem 3.24.
By combining Theorem 3.24 with Remark 3.17, we obtain the following corollary.
It clariï¬es the question of uniqueness in the representation of points in the relative
interior of (P â—¦Y âˆ’1) as barycenters of the exponential family.
Corollary 3.26. If the non-redundance condition (3.10) holds, then
Î» âˆ’â†’m(Î»)
is a bijective mapping from Rd to ri (P â—¦Y âˆ’1).

122
3 Optimality and equilibrium
Remark 3.27. It follows from Corollary 3.19 and Theorem 3.24 that for all m âˆˆ
ri (P â—¦Y âˆ’1)
min
EQ[ Y ]=m H(Q|P ) = max
Î»âˆˆRd[Î» Â· m âˆ’log Z(Î»)].
(3.14)
Here, the right-hand side is the Fenchelâ€“Legendre transform of the convex function
log Z evaluated at m âˆˆRd.
â™¦
The following theorem shows that the variational principle (3.14) remains true for
all m âˆˆRd, if we replace â€œminâ€ and â€œmaxâ€ by â€œinfâ€ and â€œsupâ€.
Theorem 3.28. For m âˆˆRd
inf
EQ[ Y ]=m
H(Q|P ) = sup
Î»âˆˆRd[Î» Â· m âˆ’log Z(Î»)].
The proof of this theorem relies on the following two general lemmas.
Lemma 3.29. For any probability measure Q,
H(Q|P ) =
sup
ZâˆˆLâˆ(,F ,P )

EQ[ Z ] âˆ’log E[ eZ ]

= sup

EQ[ Z ] âˆ’log E[ eZ ] | eZ âˆˆL1(P )

.
(3.15)
The second supremum is attained by Z := log dQ
dP if Q â‰ªP .
Proof. We ï¬rst show â‰¥in (3.15). To this end, we may assume that H(Q|P ) < âˆ.
For Z with eZ âˆˆL1(P ) let P Z be deï¬ned by
dP Z
dP
=
eZ
E[ eZ ].
Then P Z is equivalent to P and
log dQ
dP = log dQ
dP Z + log dP Z
dP .
Integrating with respect to Q gives
H(Q|P ) = H(Q|P Z) + EQ[ Z ] âˆ’log E[ eZ ].
Since H(Q|P Z) â‰¥0 by (3.11), we have proved that H(Q|P ) is larger than or equal
to both suprema on the right of (3.15).
To prove the reverse inequality, consider ï¬rst the case Q Ì¸â‰ªP . Take Zn := nIA
where A is such that Q[ A ] > 0 and P [ A ] = 0. Then, as n â†‘âˆ,
EQ[ Zn ] âˆ’log E[ eZn ] = n Â· Q[ A ] âˆ’â†’âˆ= H(Q|P ).

3.2 Exponential utility and relative entropy
123
Now suppose that Q â‰ªP with density Ï• = dQ/dP . Then Z := log Ï• satisï¬es
eZ âˆˆL1(P ) and
H(Q|P ) = EQ[ Z ] âˆ’log E[ eZ ].
For the ï¬rst identity we need an approximation argument. Let Zn = (âˆ’n)âˆ¨(log Ï•)âˆ§n.
We split the expectation E[ eZn ] according to the two sets {Ï• â‰¥1} and {Ï• < 1}. Using
monotone convergence for the ï¬rst integral and dominated convergence for the second
yields
E[ eZn ] âˆ’â†’E[ elog Ï• ] = 1.
Since x log x â‰¥âˆ’1/e, we have Ï•Zn â‰¥âˆ’1/e uniformly in n, and Fatouâ€™s lemma
yields
lim inf
nâ†‘âˆEQ[ Zn ] = lim inf
nâ†‘âˆE[ Ï•Zn ] â‰¥E[ Ï• log Ï• ] = H(Q|P ).
Putting both facts together shows
lim inf
nâ†‘âˆ

EQ[ Zn ] âˆ’log E[ eZn ]

â‰¥H(Q|P ),
and the inequality â‰¤in (3.15) follows.
Remark 3.30. The preceding lemma shows that the relative entropy is monotone with
respect to an increase of the underlying Ïƒ-algebra: Let P and Q be two probability
measures on a measurable space (, F ), and denote by H(Q|P ) their relative entropy.
Suppose that F0 is a Ïƒ-ï¬eld such that F0 âŠ‚F and denote by H0(Q|P ) the relative
entropy of Q with respect to P considered as probability measures on the smaller
space (, F0). Then the relation Lâˆ(, F0, P ) âŠ‚Lâˆ(, F , P ) implies
H0(Q|P ) â‰¤H(Q|P ) ;
in general this inequality is strict.
â™¦
Lemma 3.31. For all Î± â‰¥0, the set
Î± :=

Ï• âˆˆL1(, F , P) | Ï• â‰¥0, E[ Ï• ] = 1, E[ Ï• log Ï• ] â‰¤Î±

is weakly sequentially compact in L1(, F , P ).
Proof. Let Lp := Lp(, F , P). The set of all P -densities,
D :=

Ï• âˆˆL1 | Ï• â‰¥0, E[ Ï• ] = 1

,
is clearly convex and closed in L1. Hence, this set is also weakly closed in L1 by
Theorem A.59. Moreover, Lemma 3.29 states that for Ï• âˆˆD
E[ Ï• log Ï• ] = sup
ZâˆˆLâˆ

E[ Z Ï• ] âˆ’log E[ eZ ]

.

124
3 Optimality and equilibrium
In particular,
Ï• â†’E[ Ï• log Ï• ]
is a weakly lower semicontinuous functional on D, and so Î± is weakly closed. In
addition, Î± is bounded in L1 and uniformly integrable, due to the criterion of de
la VallÃ©e Poussin; see, e.g., Lemma 3 in Â§6 of Chapter II of [187]. Applying the
Dunfordâ€“Pettis theorem and the Eberleinâ€“Å mulian theorem as stated in Appendix A.7
concludes the proof.
Proof of Theorem 3.28. In view of Theorem 3.24 and inequality (3.13) (whose proof
extends to all m âˆˆRd), it remains to prove that
inf
EQ[ Y ]=m
H(Q|P ) â‰¤sup
Î»âˆˆRd[ Î» Â· m âˆ’log Z(Î»)]
(3.16)
for those m which do not belong to ri (Âµ), where Âµ := P â—¦Y âˆ’1. The right-hand side
of (3.16) is just the Fenchelâ€“Legendre transform at m of the convex function log Z
and, thus, denoted (log Z)âˆ—(m).
First, we consider the case in which m is not contained in the closure (Âµ) of the
convex hull of the support of Âµ. Proposition A.1, the separating hyperplane theorem,
yields some Î¾ âˆˆRd such that
Î¾ Â· m > sup{ Î¾ Â· x | x âˆˆ(Âµ) } â‰¥sup{ Î¾ Â· x | x âˆˆsupp Âµ }.
By taking Î»n := nÎ¾, it follows that
Î»n Â· m âˆ’log Z(Î»n) â‰¥n

Î¾ Â· m âˆ’
sup
yâˆˆsupp Âµ
Î¾ Â· y

âˆ’â†’+âˆ
as n â†‘âˆ.
Hence, the right-hand side of (3.16) is inï¬nite if m Ì¸âˆˆ(Âµ).
It remains to prove (3.16) for m âˆˆ(Âµ)\ ri (Âµ) with (log Z)âˆ—(m) < âˆ. Recall
from (1.22) that ri (Âµ) = ri (Âµ). Pick some m1 âˆˆri (Âµ) and let
mn := 1
n m1 +

1 âˆ’1
n

m.
Then mn âˆˆri (Âµ) by (1.21). By the convexity of (log Z)âˆ—, we have
lim sup
nâ†‘âˆ
(log Z)âˆ—(mn) â‰¤lim sup
nâ†‘âˆ
1
n(log Z)âˆ—(m1) + n âˆ’1
n
(log Z)âˆ—(m)

= (log Z)âˆ—(m).
(3.17)
We also know that to each mn there corresponds a Î»n âˆˆRd such that
mn = EÎ»n[ Y ]
and
H(PÎ»n|P ) = (log Z)âˆ—(mn).
(3.18)

3.3 Optimal contingent claims
125
From (3.17) and (3.18) we conclude that
lim sup
nâ†‘âˆ
H(PÎ»n|P ) = lim sup
nâ†‘âˆ
(log Z)âˆ—(mn) â‰¤(log Z)âˆ—(m) < âˆ.
In particular, H(PÎ»n|P ) is uniformly bounded in n, and Lemma 3.31 implies that â€“
after passing to a suitable subsequence if necessary â€“ the densities dPÎ»n/dP converge
weakly in L1(, F , P) to a density Ï•. Let dPâˆ= Ï• dP . By the weak lower
semicontinuity of
dQ
dP âˆ’â†’H(Q|P ),
which follows from Lemma 3.29, we may conclude that H(Pâˆ|P ) â‰¤(log Z)âˆ—(m).
The theorem will be proved once we can show that Eâˆ[ Y ] = m. To this end, let
Î³ := supn(log Z)âˆ—(mn), which is a ï¬nite non-negative number by (3.17). Taking
Z := Î± I{|Y|â‰¥c}|Y|
on the right-hand side of (3.15) yields
Î³ â‰¥Î±EÎ»n

|Y| Â· I{|Y|â‰¥c}

âˆ’log E

exp

Î±|Y|I{|Y|â‰¥c}
 
for all n â‰¤âˆ.
Note that the rightmost expectation is ï¬nite due to condition (3.9) and Lemma 3.13.
By taking Î± large so that Î³/Î± < Îµ/2 for some given Îµ > 0, and by choosing c such
that
log E

exp

Î±|Y|I{|Y|â‰¥c}
 
< Î±Îµ
2 ,
we obtain that
sup
nâ‰¤âˆ
EÎ»n

|Y| Â· I{|Y|â‰¥c}

â‰¤Îµ.
But
EÎ»n

|Y| Â· I{|Y|<c}

âˆ’â†’Eâˆ

|Y| Â· I{|Y|<c}

by the weak convergence of dPÎ»n/dP â†’dPâˆ/dP , and so taking Îµ â†“0 yields
m = lim
nâ†‘âˆEÎ»n[ Y ] = Eâˆ[ Y ],
as desired.
3.3 Optimal contingent claims
In this section we study the problem of maximizing the expected utility
E[ u(X) ]
under a given budget constraint in a broader context. The random variables X will
vary in a general convex class X âŠ‚L0(, F, P ) of admissible payoff proï¬les. In

126
3 Optimality and equilibrium
the setting of our ï¬nancial market model, this will allow us to explain the demand for
non-linear payoff proï¬les provided by ï¬nancial derivatives.
In order to formulate the budget constraint in this general context, we introduce a
linear pricing rule of the form
(X) = Eâˆ—[ X ] = E[ Ï•X ]
where P âˆ—is a probability measure on (, F ), which is equivalent to P with density
Ï•. For a given initial wealth w âˆˆR, the corresponding budget set is deï¬ned as
B := { X âˆˆX âˆ©L1(P âˆ—) | Eâˆ—[ X ] â‰¤w }.
(3.19)
Our optimization problem can now be stated as follows:
Maximize E[ u(X) ] among all X âˆˆB.
(3.20)
Note, however, that we will need some extra conditions which guarantee that the
expectations E[ u(X) ] make sense and are bounded from above.
Remark 3.32. In general, our optimization problem would not be well posed without
the assumption P âˆ—â‰ˆP . Note ï¬rst that it should be rephrased in terms of a class
X of measurable functions on (, F ) since we can no longer pass to equivalence
classes with respect to P . If P is not absolutely continuous with respect to P âˆ—then
there exists A âˆˆF such that P [ A ] > 0 and P âˆ—[ A ] = 0. For X âˆˆL1(P âˆ—) and
c > 0, the random variable 
X := X + c IA would satisfy Eâˆ—[ 
X ] = Eâˆ—[ X ] and
E[ u(
X) ] > E[ u(X) ]. Similarly, if P âˆ—[ A ] > 0 and P [ A ] = 0 then
Ë†X := X + c âˆ’
c
P âˆ—[ A ] IA
would have the same price as X but higher expected utility. In particular, the expec-
tations in (3.20) would be unbounded in both cases if X is the class of all measurable
functions on (, F ) and if the function u is not bounded from above.
â™¦
Remark 3.33. If a solution Xâˆ—with E[ u(Xâˆ—) ] < âˆexists then it is unique, since
B is convex and u is strictly concave. Moreover, if X = L0(, F , P ) or X =
L0
+(, F , P) then Xâˆ—satisï¬es
Eâˆ—[ Xâˆ—] = w
since Eâˆ—[ Xâˆ—] < w would imply that X := Xâˆ—+ w âˆ’Eâˆ—[ Xâˆ—] is a strictly better
choice, due to the strict monotonicity of u.
â™¦
Let us ï¬rst consider the unrestricted case X = L0(, F, P ) where any ï¬nite ran-
dom variable on (, F, P) is admissible. The following heuristic argument identiï¬es
a candidate Xâˆ—for the maximization of the expected utility. Suppose that a solution
Xâˆ—exists. For any X âˆˆLâˆ(P ) and any Î» âˆˆR,
XÎ» := Xâˆ—+ Î»

X âˆ’Eâˆ—[ X ]


3.3 Optimal contingent claims
127
satisï¬es the budget constraint Eâˆ—[ XÎ» ] = w. A formal computation yields
0 = d
dÎ»

Î»=0E[ u(XÎ») ]
= E

uâ€²(Xâˆ—)(X âˆ’Eâˆ—[ X ])

= E[ uâ€²(Xâˆ—)X ] âˆ’E

XE[ uâ€²(Xâˆ—) ] Ï•

= E

X(uâ€²(Xâˆ—) âˆ’c Ï•)

where c := E[ uâ€²(Xâˆ—) ]. The identity
E[ X uâ€²(Xâˆ—) ] = c E[ X Ï• ]
for all bounded measurable X implies uâ€²(Xâˆ—) = c Ï• P-almost surely. Thus, if we
denote by
I := (uâ€²)âˆ’1
the inverse function of the strictly decreasing function uâ€², then Xâˆ—should be of the
form
Xâˆ—= I(c Ï•).
We will now formulate a set of assumptions on our utility function u which guar-
antee that Xâˆ—:= I(c Ï•) is indeed a maximizer of the expected utility, as suggested by
the preceding argument.
Theorem 3.34. Suppose u : R â†’R is a continuously differentiable utility function
which is bounded from above, and whose derivative satisï¬es
lim
xâ†“âˆ’âˆuâ€²(x) = +âˆ.
(3.21)
Assume moreover that c > 0 is a constant such that
Xâˆ—:= I(c Ï•) âˆˆL1(P âˆ—).
Then Xâˆ—is the unique maximizer of the expected utility E[ u(X) ] among all those
X âˆˆL1(P âˆ—) for which Eâˆ—[ X ] â‰¤Eâˆ—[ Xâˆ—]. In particular, Xâˆ—solves our optimization
problem (3.20) for X = L0(, F , P) if c can be chosen such that Eâˆ—[ Xâˆ—] = w.
Proof. Uniqueness follows from Remark 3.33. Since u is bounded from above, its
derivative satisï¬es
lim
xâ†‘âˆuâ€²(x) = 0,
in addition to (3.21). Hence, (0, âˆ) is contained in the range of uâ€², and it follows that
I(c Ï•) is P -a.s. well-deï¬ned for all c > 0.
To show the optimality of Xâˆ—= I(c Ï•), note that the concavity of u implies that
for any X âˆˆL1(P âˆ—)
u(X) â‰¤u(Xâˆ—) + uâ€²(Xâˆ—)(X âˆ’Xâˆ—) = u(Xâˆ—) + c Ï•(X âˆ’Xâˆ—).

128
3 Optimality and equilibrium
Taking expectations with respect to P yields
E[ u(X) ] â‰¤E[ u(Xâˆ—) ] + c Eâˆ—[ X âˆ’Xâˆ—].
Hence, Xâˆ—is indeed a maximizer in the class { X âˆˆL1(P âˆ—) | Eâˆ—[ X ] â‰¤Eâˆ—[ Xâˆ—] }.
Example 3.35. Let u(x) = 1 âˆ’eâˆ’Î±x be an exponential utility function with constant
absolute risk aversion Î± > 0. In this case,
I(y) = âˆ’1
Î± log y
Î± .
It follows that
Eâˆ—[ I(c Ï•) ] = âˆ’1
Î± log c
Î± âˆ’1
Î± Â· E[ Ï• log Ï• ]
= âˆ’1
Î± log c
Î± âˆ’1
Î± Â· H(P âˆ—|P ),
where H(P âˆ—|P ) denotes the relative entropy of P âˆ—with respect to P ; see Deï¬ni-
tion 3.20. Hence, the utility maximization problem can be solved for any w âˆˆR if
and only if the relative entropy H(P âˆ—|P ) is ï¬nite. In this case, the optimal proï¬le is
given by
Xâˆ—= âˆ’1
Î± log Ï• + w + 1
Î± H(P âˆ—|P ),
and the maximal value of expected utility is
E[ u(Xâˆ—) ] = 1 âˆ’exp

âˆ’Î±w âˆ’H(P âˆ—|P )

,
corresponding to the certainty equivalent
w + 1
Î± H(P âˆ—|P ).
Let us now return to the ï¬nancial market model considered in Section 3.1, and let P âˆ—
be the entropy-minimizing risk-neutral measure constructed in Corollary 3.25. The
density of P âˆ—is of the form
Ï• =
eâˆ’Î±Î¾âˆ—Â·Y
E[ eâˆ’Î±Î¾âˆ—Â·Y ],
where Î¾âˆ—âˆˆRd denotes a maximizer of the expected utility E[ u(Î¾ Â· Y) ]; see Exam-
ple 3.12. In this case, the optimal proï¬le takes the form
Xâˆ—= Î¾âˆ—Â· Y + w = Î¾âˆ—Â· S
1 + r ,
i.e., Xâˆ—is the discounted payoff of the portfolio Î¾âˆ—= (Î¾0, Î¾âˆ—), where Î¾0 = w âˆ’Î¾âˆ—Â·Ï€
is determined by the budget constraint Î¾ Â· Ï€ = w. Thus, the optimal proï¬le is given
by a linear proï¬le in the given primary assets S0, . . . , Sd: No derivatives are needed
at this point.
â™¦

3.3 Optimal contingent claims
129
In most situations it will be natural to restrict the discussion to payoff proï¬les which
are non-negative. For the rest of this section we will make this restriction, and so the
utility function u may be deï¬ned only on [0, âˆ). In several applications we will also
use an upper bound given by an F -measurable random variable W :  âˆ’â†’[0, âˆ] .
We include the case W â‰¡+âˆand deï¬ne the convex class of admissible payoff
proï¬les as
X := { X âˆˆL0(P ) | 0 â‰¤X â‰¤W P -a.s. }
Thus, our goal is to maximize the expected utility E[ u(X) ] among all X âˆˆB where
the budget set B is deï¬ned in terms of X and P âˆ—as in (3.19), i.e.,
B =

X âˆˆL1(P âˆ—) | 0 â‰¤X â‰¤W P -a.s. and Eâˆ—[ X ] â‰¤w

.
We ï¬rst formulate a general existence result:
Proposition 3.36. Let u be any utility function on [0, âˆ), and suppose that W is
P-a.s. ï¬nite and satisï¬es E[ u(W) ] < âˆ. Then there exists a unique Xâˆ—âˆˆB which
maximizes the expected utility E[ u(X) ] among all X âˆˆB.
Proof. Take a sequence (Xn) in B with Eâˆ—[ Xn ] â‰¤w and such that E[ u(Xn) ]
converges to the supremum of the expected utility. Since supn |Xn| â‰¤W < âˆ
P-almost surely, we obtain from Lemma 1.69 a sequence

Xn âˆˆconv{ Xn, Xn+1, . . . }
of convex combinations which converge almost-surely to some 
X. Clearly, every 
Xn
is contained in B. Fatouâ€™s lemma implies
Eâˆ—[ 
X ] â‰¤lim inf
nâ†‘âˆEâˆ—[ 
Xn ] â‰¤w,
and so 
X âˆˆB. Each 
Xn can be written as m
i=1 Î±n
i Xni for indices ni â‰¥n and
coefï¬cients Î±n
i â‰¥0 summing up to 1. Hence,
u(
Xn) â‰¥
m

i=1
Î±n
i u(Xni),
and it follows that
E[ u(
Xn) ] â‰¥inf
mâ‰¥n E[ u(Xm) ].
By dominated convergence,
E[ u(
X) ] = lim
nâ†‘âˆE[ u(
Xn) ],
and the right-hand side is equal to the supremum of the expected utility.

130
3 Optimality and equilibrium
Remark 3.37. The argument used to prove the preceding proposition works just as
well in the following general setting. Let U : B â†’R be a concave functional on a
set B of random variables deï¬ned on a probability space (, F , P ) and with values
in Rn. Assume that
â€¢ B is convex and closed under P -a.s. convergence,
â€¢ There exists a random variable W âˆˆL0
+(, F , P ) with |Xi| â‰¤W < âˆP -a.s.
for each X = (X1, . . . , Xn) âˆˆB,
â€¢ sup
XâˆˆB
U(X) < âˆ,
â€¢ U is upper semicontinuous with respect to P -a.s. convergence.
Then there exists an Xâˆ—âˆˆB which maximizes U on B, and Xâˆ—is unique if U is
strictly concave. As a special case, this includes the utility functionals
U(X) = inf
QâˆˆQ EQ[ u(X) ],
appearing in a robust Savage representation of preferences on n-dimensional asset
proï¬les, where u is a utility function on Rn and Q is a set of probability measures
equivalent to P; see Section 2.5.
â™¦
We turn now to a characterization of the optimal proï¬le Xâˆ—in terms of the inverse
of the derivative uâ€² of u in case where u is continuously differentiable on (0, âˆ). Let
a := lim
xâ†‘âˆuâ€²(x) â‰¥0
and
b := uâ€²(0+) = lim
xâ†“0 uâ€²(x) â‰¤+âˆ.
We deï¬ne
I + : (a, b) âˆ’â†’(0, âˆ).
as the continuous, bijective, and strictly decreasing inverse function of uâ€² on (a, b),
and we extend I + to the full half axis [0, âˆ] by setting
I +(y) :=

0
for y â‰¥b,
+âˆ
for y â‰¤a.
(3.22)
With this convention, I + : [0, âˆ] â†’[0, âˆ] is continuous.
Remark 3.38. If u is a utility function deï¬ned on all of R, the function I + is the
inverse of the restriction of uâ€² to [0, âˆ). Thus, I + is simply the positive part of
the function I = (uâ€²)âˆ’1. For instance, in the case of an exponential utility function
u(x) = 1 âˆ’eâˆ’Î±x, we have a = 0, b = Î±, and
I +(y) =
 1
Î± log y
Î±
âˆ’
=

I(y)
+,
y â‰¥0.
(3.23)
â™¦

3.3 Optimal contingent claims
131
Theorem 3.39. Assume that Xâˆ—âˆˆB is of the form
Xâˆ—= I +(c Ï•) âˆ§W
for some constant c > 0 such that Eâˆ—[ Xâˆ—] = w. If E[ u(Xâˆ—) ] < âˆthen Xâˆ—is the
unique maximizer of the expected utility E[ u(X) ] among all X âˆˆB.
Proof. In a ï¬rst step, we consider the function
v(y, Ï‰) :=
sup
0â‰¤xâ‰¤W(Ï‰)

u(x) âˆ’xy

(3.24)
deï¬ned for y âˆˆR and Ï‰ âˆˆ. Clearly, for each Ï‰ with W(Ï‰) < âˆthe supremum
above is attained in a unique point xâˆ—(y) âˆˆ[0, W(Ï‰)], which satisï¬es
xâˆ—(y) = 0
â‡â‡’
uâ€²(x) < y
for all x âˆˆ

0, W(Ï‰)

,
xâˆ—(y) = W(Ï‰)
â‡â‡’
uâ€²(x) > y
for all x âˆˆ

0, W(Ï‰)

.
Moreover, y = uâ€²(xâˆ—(y)) if xâˆ—(y) is an interior point of the interval [0, W(Ï‰)]. It
follows that
xâˆ—(y) = I +(y) âˆ§W(Ï‰),
or
Xâˆ—= xâˆ—(c Ï•)
on {W < âˆ}.
(3.25)
If W(Ï‰) = +âˆ, then the supremum in (3.24) is not attained if and only if
uâ€²(x) > y for all x âˆˆ(0, âˆ). By our convention (3.22), this holds if and only if
y â‰¤a and hence I +(y) = +âˆ. But our assumptions on Xâˆ—imply that I +(c Ï•) < âˆ
P-a.s. on {W = âˆ}, and hence that
Xâˆ—= xâˆ—(c Ï•)
P-a.s. on {W = âˆ}.
(3.26)
Putting (3.24), (3.25), and (3.26) together yields
u(Xâˆ—) âˆ’Xâˆ—c Ï• = v(cÏ•, Â·)
P -a.s.
Applied to an arbitrary X âˆˆB, this shows that
u(Xâˆ—) âˆ’c Ï•Xâˆ—â‰¥u(X) âˆ’c Ï•X
P -a.s.
Taking expectations gives
E[ u(Xâˆ—) ] â‰¥E[ u(X) ] + c Â· Eâˆ—[ Xâˆ—âˆ’X ] â‰¥E[ u(X) ].
Hence, Xâˆ—maximizes the expected utility on B.
Uniqueness follows from Re-
mark 3.33.
In the following examples, we study the application of the preceding theorem to
CARA and HARA utility functions. For simplicity we consider only the case W â‰¡âˆ.
The extension to a non-trivial bound W is straightforward.

132
3 Optimality and equilibrium
Example 3.40. For an exponential utility function u(x) = 1âˆ’eâˆ’Î±x we have by (3.23)
Ï•I +(y Ï•) = 1
Î± Ï•
	
log
	y Ï•
Î±


âˆ’
= 1
y h
	y Ï•
Î±

,
where h(x) = (x log x)âˆ’. Since h is bounded by eâˆ’1, it follows that Ï•I +(y Ï•) belongs
to L1(P ) for all y > 0. Thus,
g(y) := Eâˆ—[ I +(y Ï•) ] = 1
y E
 
h
	y Ï•
Î±

 !
decreases continuously from +âˆto 0 as y increases from 0 to âˆ, and there exists a
unique c with g(c) = w. The corresponding proï¬le
Xâˆ—:= I +(c Ï•)
maximizes the expected utility E[ u(X) ] among all X â‰¥0. Let us now return to
the special situation of the ï¬nancial market model of Section 3.1, and take P âˆ—as the
entropy-minimizing risk-neutral measure of Corollary 3.25. Then the optimal proï¬le
Xâˆ—takes the form
Xâˆ—= (Î¾âˆ—Â· Y âˆ’K)+,
where Î¾âˆ—is the maximizer of the expected utility E[ u(Î¾ Â· Y) ], and where K is given
by
K = 1
Î± log c
Î± âˆ’1
Î± log E[ eâˆ’Î±Î¾âˆ—Â·Y ] = 1
Î± log c
Î± + 1
Î± H(P âˆ—|P ).
Note that Xâˆ—is a linear combination of the primary assets only in the case where
Î¾âˆ—Â· Y â‰¥K P -almost surely. In general, Xâˆ—is a basket call option on the attainable
asset w + (1 + r)Î¾âˆ—Â· Y âˆˆV with strike price w + (1 + r)K. Thus, a demand for
derivatives appears.
â™¦
Example 3.41. If u is a HARA utility function of index Î³ âˆˆ[0, 1) then uâ€²(x) = xÎ³ âˆ’1,
hence
I +(y) = yâˆ’
1
1âˆ’Î³
and
I +(y Ï•) = yâˆ’
1
1âˆ’Î³ Â· Ï•âˆ’
1
1âˆ’Î³ .
In the logarithmic case Î³ = 0, we assume that the relative entropy H(P |P âˆ—) of P
with respect to P âˆ—is ï¬nite. Then
Xâˆ—= w
Ï• = w dP
dP âˆ—
is the unique maximizer, and the maximal value of expected utility is
E[ log Xâˆ—] = log w + H(P |P âˆ—).

3.3 Optimal contingent claims
133
If Î³ âˆˆ(0, 1) and
E

Ï•âˆ’
Î³
1âˆ’Î³ 
= Eâˆ—
Ï•âˆ’
1
1âˆ’Î³ 
< âˆ,
then the unique optimal proï¬le is given by
Xâˆ—= w

E

Ï•âˆ’
Î³
1âˆ’Î³ âˆ’1Ï•âˆ’
1
1âˆ’Î³ ,
and the maximal value of expected utility is equal to
E[ u(Xâˆ—) ] = 1
Î³ wÎ³ 
E

Ï•âˆ’
Î³
1âˆ’Î³ 1âˆ’Î³ .
â™¦
The following corollary gives a simple condition on W which guarantees the
existence of the maximizer Xâˆ—in Theorem 3.39.
Corollary 3.42. If E[ u(W) ] < âˆand if 0 < w < Eâˆ—[ W ] < âˆ, then there exists
a unique constant c > 0 such that
Xâˆ—= I +(c Ï•) âˆ§W
satisï¬es Eâˆ—[ Xâˆ—] = w. In particular, Xâˆ—is the unique maximizer of the expected
utility E[ u(X) ] among all X âˆˆB.
Proof. For any Î² âˆˆ(0, âˆ),
y â†’I +(y) âˆ§Î²
is a continuous decreasing function with limyâ†‘b I +(y) âˆ§Î² = 0 and I +(y) âˆ§Î² = Î²
for all y â‰¤uâ€²(Î²). Hence, dominated convergence implies that the function
g(y) := Eâˆ—[ I +(y Ï•) âˆ§W ],
is continuous and decreasing with
lim
yâ†‘âˆg(y) = 0 < w < Eâˆ—[ W ] = lim
yâ†“0 g(y).
Moreover, g is even strictly decreasing on { y | 0 < g(y) < Eâˆ—[ W ] }. Hence,
there exists a unique c with g(c) = w, and Theorem 3.39 yields the optimality of the
corresponding Xâˆ—.
Let us now extend the discussion to the case where preferences themselves are
uncertain. This additional uncertainty can be modelled by incorporating the choice of
a utility function into the description of possible scenarios; for an axiomatic discussion
see [130]. More precisely, we assume that preferences are described by a measurable
function u on [0, âˆ) Ã—  such that u(Â·, Ï‰) is a utility function on [0, âˆ) which is

134
3 Optimality and equilibrium
continuously differentiable on (0, âˆ). For each Ï‰ âˆˆ, the inverse of uâ€²(Â·, Ï‰) is
extended as above to a function
I +(Â·, Ï‰) : [0, âˆ] âˆ’â†’[0, âˆ].
Using exactly the same arguments as above, we obtain the following extension of
Corollary 3.42 to the case of random preferences:
Corollary 3.43. If E[ u(W, Â·) ] < âˆand if 0 < w < Eâˆ—[ W ] < âˆ, then there exists
a unique constant c > 0 such that
Xâˆ—(Ï‰) : = I +
c Ï•(Ï‰), Ï‰

âˆ§W(Ï‰)
is the unique maximizer of the expected utility
E[ u(X, Â·) ] =

u(X(Ï‰), Ï‰) P (dÏ‰)
among all X âˆˆB.
So far, we have discussed the structure of asset proï¬les which are optimal with
respect to a ï¬xed utility function u. Let us now introduce an optimization problem
with respect to the uniform order â‰½uni as discussed in Section 2.4. The partial order â‰½uni
can be viewed as a reï¬‚exive and transitive relation on the space of ï¬nancial positions
X := L1
+(, F , P )
by letting
X â‰½uni Y : â‡â‡’ÂµX â‰½uni ÂµY
â‡â‡’E[ u(X) ] â‰¥E[ u(Y) ]
for all utility functions u,
(3.27)
where ÂµX and ÂµY denote the distributions of X and Y under P . Note that X â‰½uni
Y â‰½uni X if and only if X and Y have the same distribution; see Remark 2.59. Thus,
the relation â‰½uni is antisymmetric on the level of distributions but not on the level of
ï¬nancial positions.
Let us now ï¬x a position X0 âˆˆX such that Eâˆ—[ X0 ] < âˆ, and let us try to
minimize the cost among all positions X âˆˆX which are uniformly at least as attractive
as X0:
Minimize Eâˆ—[ X ] among all X â‰½uni X0.
In order to describe the minimal cost and the minimizing proï¬le, let us denote by FÏ•
and FX0 the distribution functions and by qÏ• and qX0 quantile functions of Ï• and X0;
see Appendix A.3.
Theorem 3.44. For any X âˆˆX such that X â‰½uni X0,
Eâˆ—[ X ] â‰¥
 1
0
qÏ•(1 âˆ’s) qX0(s) ds.
(3.28)

3.3 Optimal contingent claims
135
The lower bound is attained by Xâˆ—= f (Ï•), where f is the decreasing function on
[0, âˆ) deï¬ned by
f (x) := qX0

1 âˆ’FÏ•(x)

if x is a continuity point of FÏ•, and by
f (x) :=
1
FÏ•(x) âˆ’FÏ•(xâˆ’)
 FÏ•(x)
FÏ•(xâˆ’)
qX0(1 âˆ’t) dt
otherwise.
The proof will use the following lemma, which yields another characterization of
the relation â‰½uni.
Lemma 3.45. For two probability measures Âµ and Î½ on R, the following conditions
are equivalent:
(a) Âµ â‰½uni Î½.
(b) For all decreasing functions h : (0, 1) â†’[0, âˆ),
 1
0
h(t)qÂµ(t) dt â‰¥
 1
0
h(t)qÎ½(t) dt,
(3.29)
where qÂµ and qÎ½ are quantile functions of Âµ and Î½.
(c) The relation (3.29) holds for all bounded decreasing functions h : (0, 1) â†’
[0, âˆ).
Proof. The relation Âµ â‰½uni Î½ is equivalent to
 y
0
qÂµ(t) dt â‰¥
 y
0
qÎ½(t) dt
for all y âˆˆ[0, 1];
see Theorem 2.58. The implication (c) â‡’(a) thus follows by taking h = I(0,t]. For the
proof of (a) â‡’(b), we may assume without loss of generality that h is left-continuous.
Then there exists a positive Radon measure Î· on (0, 1] such that h(t) = Î·([t, 1]).
Fubiniâ€™s theorem yields
 1
0
h(t) qÂµ(t) dt =
 1
0
 y
0
qÂµ(t) dt Î·(dy)
â‰¥
 1
0
 y
0
qÎ½(t) dt Î·(dy)
=
 1
0
h(t) qÎ½(t) dt.

136
3 Optimality and equilibrium
Proof ofTheorem 3.44. Using the ï¬rst Hardyâ€“Littlewood inequality inTheoremA.24,
we see that
Eâˆ—[ X ] = E[ XÏ• ] â‰¥
 1
0
qÏ•(1 âˆ’t) qX(t) dt,
where qX is a quantile function for X. Taking h(t) := qÏ•(1âˆ’t) and using Lemma 3.45
thus yields (3.28).
Let us now turn to the identiï¬cation of the optimal proï¬le. Note that the function
f deï¬ned in the assertion satisï¬es
f (qÏ•) = EÎ»[ g | qÏ• ]
(3.30)
where g is deï¬ned by g(t) = qX0(1âˆ’t), and where EÎ»[ Â· | qÏ• ] denotes the conditional
expectation with respect to qÏ• under the Lebesgue measure Î» on (0, 1). Let us show
that Xâˆ—= f (Ï•) satisï¬es Xâˆ—â‰½uni X0. Indeed, for any utility function u
E[ u(Xâˆ—) ] = E

u

f (Ï•)
 
=
 1
0
u

f (qÏ•)

dt
â‰¥
 1
0
u

qX0(1 âˆ’t)

dt =
 1
0
u

qX0(t)

dt
= E[ u(X0) ],
where we have applied Lemma A.19 and Jensenâ€™s inequality for conditional expecta-
tions. Moreover, Xâˆ—attains the lower bound in (3.28):
Eâˆ—[ Xâˆ—] = E[ f (Ï•) Ï• ] =
 1
0
f

qÏ•(t)

qÏ•(t) dt
=
 1
0
qX0(1 âˆ’t) qÏ•(t) dt =
 1
0
qX0(t) qÏ•(1 âˆ’t) dt,
due to (3.30).
Remark 3.46. The solution Xâˆ—has the same expectation under P as X0. Indeed,
(3.30) shows that
E[ Xâˆ—] = E[ f (Ï•) ] =
 1
0
f (qÏ•(t)) dt =
 1
0
qX0(1 âˆ’t) dt = E[ X0 ].
â™¦
Remark 3.47. The lower bound in (3.28) may be viewed as a â€œreservation priceâ€ for
X0 in the following sense. Let X0 be a ï¬nancial position, and let X be any class of
ï¬nancial positions such that X âˆˆX is available at price Ï€(X). For a given relation âª°
on X âˆª{X0},
Ï€R(X0) := inf{ Ï€(X) | X âˆˆX, X âª°X0 }
is called the reservation price of X0 with respect to X, Ï€, and âª°.

3.4 Microeconomic equilibrium
137
If X is the space of constants with Ï€(c) = c, and if the relation âª°is of von
Neumannâ€“Morgenstern type with some utility function u, then Ï€R(X0) reduces to the
certainty equivalent of X0 with respect to u; see (2.9).
In the context of the optimization problem (3.20), where
X âª°X0 : â‡â‡’
E[ u(X) ] â‰¥E[ u(X0) ],
the reservation price is given by Eâˆ—[ Xâˆ—], where Xâˆ—is the utility maximizer in the
budget set deï¬ned by w := Eâˆ—[ X0 ].
In the context of the ï¬nancial market model of Chapter 1, we can take X as the
space V of attainable claims with
V âª°X0 : â‡â‡’
V â‰¥X0 P -a.s.
and Ï€(V ) = Î¾ Â· Ï€ for V = Î¾ Â· S. In this case, the reservation price Ï€R(X0) coincides
with the upper bound Ï€sup(X0) of the arbitrage-free prices for X0; see Theorem 1.31. â™¦
3.4 Microeconomic equilibrium
The aim of this section is to provide a brief introduction to the theory of market
equilibrium. Prices of assets will no longer be given in advance. Instead, they will
be derived from â€œï¬rst principlesâ€ in a microeconomic setting where different agents
demand asset proï¬les in accordance with their preferences and with their budget
constraints. These budget constraints are determined by a given price system. The
role of equilibrium prices consists in adjusting the constraints in such a way that the
resulting overall demand is matched by the overall supply of assets.
Consider a ï¬nite set A of economic agents and a convex set X âŠ‚L0(, F , P ) of
admissible claims. At time t = 0, each agent a âˆˆA has an initial endowment whose
discounted payoff at time t = 1 is described by an admissible claim
Wa âˆˆX,
a âˆˆA.
The aggregated claim
W :=

aâˆˆA
Wa
is also called the market portfolio. Agents may want to exchange their initial endow-
ment Wa against some other admissible claim Xa âˆˆX. This could lead to a new
allocation (Xa)aâˆˆA if the resulting total demand matches the overall supply:
Deï¬nition 3.48. Acollection(Xa)aâˆˆA âŠ‚Xiscalledafeasibleallocation ifitsatisï¬es
the market clearing condition

aâˆˆA
Xa = W
P-a.s.
(3.31)

138
3 Optimality and equilibrium
The budget constraints will be determined by a linear pricing rule of the form
(X) := E[ Ï• X ],
X âˆˆX,
where Ï• is a price density, i.e., an integrable function on (, F ) such that Ï• > 0 P -a.s.
and E[ |Wa| Ï• ] < âˆfor all a âˆˆA. To any such Ï• we can associate a normalized
price measure P Ï• â‰ˆP with density Ï•E[ Ï• ]âˆ’1.
Remark 3.49. In the context of our one-period model of a ï¬nancial market with
d risky assets S1, . . . , Sd and a risk-free asset S0 â‰¡1 + r, P Ï• is a risk-neutral
measure if the pricing rule  is consistent with the given price vector Ï€ = (Ï€0, Ï€),
where Ï€0 = 1. In this section, the pricing rule will be derived as an equilibrium
price measure, given the agentsâ€™ preferences and endowments. In particular, this will
amount to an endogenous derivation of the price vector Ï€. In a situation where the
structure of the equilibrium is already partially known in the sense that it is consistent
with the given price vector Ï€, the construction of a microeconomic equilibrium yields
a speciï¬c choice of a martingale measure P âˆ—, i.e., of a speciï¬c extension of Ï€ from
the space V of attainable payoffs to a larger space of admissible claims.
â™¦
The preferences of agent a âˆˆA are described by a utility function ua. Given the
price density Ï•, an agent a âˆˆA may want to exchange the endowment Wa for an
admissible claim XÏ•
a which maximizes the expected utility
E[ ua(X) ]
among all X in the agentâ€™s budget set
Ba(Ï•) := { X âˆˆX | E[ Ï• X ] â‰¤E[ Ï• Wa ] }
= { X âˆˆX | EÏ•[ X ] â‰¤EÏ•[ Wa ] }.
In this case, we will say that XÏ•
a solves the utility maximization problem of agent a âˆˆA
with respect to the price density Ï•. The key problem is whether Ï• can be chosen in
such a way that the requested proï¬les XÏ•
a , a âˆˆA, form a feasible allocation.
Deï¬nition 3.50. A price density Ï•âˆ—together with a feasible allocation (Xâˆ—
a)aâˆˆA is
called an Arrowâ€“Debreu equilibrium if each Xâˆ—
a solves the utility maximization prob-
lem of agent a âˆˆA with respect to Ï•âˆ—.
Thus, thepricedensityÏ•âˆ—appearinginanArrowâ€“Debreuequilibriumdecentralizes
the crucial problem of implementing the global feasibility constraint (3.31). This
is achieved by adjusting the budget sets in such a way that the resulting demands
respectthemarketclearingcondition, eventhoughtheindividualdemandisdetermined
without any regard to this global constraint.
Example 3.51. Assume that each agent a âˆˆA has an exponential utility function
with parameter Î±a > 0, and let us consider the unconstrained case
X = L0(, F , P ).

3.4 Microeconomic equilibrium
139
In this case, there is a unique equilibrium, and it is easy to describe it explicitly. For
a given pricing measure P âˆ—â‰ˆP such that Wa âˆˆL1(P âˆ—) for all a âˆˆA, the utility
maximization problem for agent a âˆˆA can be solved if and only if H(P âˆ—|P ) < âˆ,
and in this case the optimal demand is given by
Xâˆ—
a = âˆ’1
Î±a
log Ï•âˆ—+ wâˆ—
a + 1
Î±a
H(P âˆ—|P )
where
wâˆ—
a := Eâˆ—[ Wa ] ;
see Example 3.35. The market clearing condition (3.31) takes the form
W = âˆ’1
Î± log Ï•âˆ—+

aâˆˆA
wâˆ—
a + 1
Î± H(P âˆ—|P )
where Î± is deï¬ned via
1
Î± =

aâˆˆA
1
Î±a
.
(3.32)
Thus, a normalized equilibrium price density must have the form
Ï•âˆ—=
eâˆ’Î±W
E[ eâˆ’Î±W ],
(3.33)
and this shows uniqueness. As to existence, let us assume that
E[ |Wa|eâˆ’Î±W ] < âˆ,
a âˆˆA ;
this condition is satisï¬ed if, e.g., the random variables Wa are bounded from below.
Deï¬ne P âˆ—â‰ˆP via (3.33). Then
H(P âˆ—|P ) = âˆ’Î± Eâˆ—[ W ] âˆ’log E[ eâˆ’Î±W ] < âˆ,
and the optimal proï¬le for agent a âˆˆA with respect to the pricing measure P âˆ—takes
the form
Xâˆ—
a = wâˆ—
a + Î±
Î±a

W âˆ’Eâˆ—[ W ]

.
(3.34)
Since

aâˆˆA
wâˆ—
a = Eâˆ—[ W ],
the allocation (Xâˆ—
a)aâˆˆA is feasible, and so we have constructed an Arrowâ€“Debreu
equilibrium. Thus, the agents share the market portfolio in a linear way, and in
inverse proportion to their risk aversion.

140
3 Optimality and equilibrium
Let us now return to our ï¬nancial market model of Section 3.1. We assume that
the initial endowment of agent a âˆˆA is given by a portfolio Î·a âˆˆRd+1 so that the
discounted payoff at time t = 1 is
Wa = Î·a Â· S
1 + r ,
a âˆˆA.
In this case, the market portfolio is given by W = Î· Â· S/(1 + r) with Î· := 
a Î·a =
(Î·0, Î·). The optimal claim for agent a âˆˆA in (3.34) takes the form
Xâˆ—
a = Î·a Â· Ï€ + Î±
Î±a
Î· Â·

S
1 + r âˆ’Ï€

,
where Ï€ = (1, Ï€) and
Ï€i = Eâˆ—

Si
1 + r

for i = 1, . . . , d.
Thus, we could have formulated the equilibrium problem within the smaller space
X = V of attainable payoffs, and the resulting equilibrium allocation would have been
the same. In particular, the extension of X from V to the general space L0(, F , P )
of admissible claims does not create a demand for derivatives in our present example.
â™¦
From now on we assume that the set of admissible claims is given by
X = L0
+(, F , P ),
and that the preferences of agent a âˆˆA are described by a utility function ua :
[0, âˆ) â†’R which is continuously differentiable on (0, âˆ). In particular, the initial
endowments Wa are assumed to be non-negative. Moreover, we assume
P [ Wa > 0 ] Ì¸= 0
for all a âˆˆA.
and
E[ W ] < âˆ.
(3.35)
A function Ï• âˆˆL1(, F , P) such that Ï• > 0 P -a.s. is a price density if
E[ Ï• W ] < âˆ;
note that this condition is satisï¬ed as soon as Ï• is bounded, due to our assumption
(3.35). Given a price density Ï•, each agent faces exactly the optimization problem
discussed in Section 3.3 in terms of the price measure P Ï• â‰ˆP . Thus, if (Xâˆ—
a)aâˆˆA
is an equilibrium allocation with respect to the price density Ï•âˆ—, feasibility implies
0 â‰¤Xâˆ—
a â‰¤W, and so it follows as in the proof of Corollary 3.42 that
Xâˆ—
a = I +
a (ca Ï•âˆ—),
a âˆˆA,
(3.36)

3.4 Microeconomic equilibrium
141
with positive constants ca > 0. Note that the market clearing condition
W =

aâˆˆA
Xâˆ—
a =

aâˆˆA
I +
a (ca Ï•âˆ—)
will determine Ï•âˆ—as a decreasing function of W, and thus the optimal proï¬les Xâˆ—
a will
be increasing functions of W.
Before we discuss the existence of an Arrowâ€“Debreu equilibrium, let us ï¬rst illus-
trate the structure of such equilibria by the following simple examples. In particular,
they show that an equilibrium allocation will typically involve non-linear derivatives
of the market portfolio W.
Example 3.52. Let us consider the constrained version of the preceding example
where agents a âˆˆA have exponential utility functions with parameters Î±a > 0.
Deï¬ne
w := sup{ c | W â‰¥c P -a.s. } â‰¥0,
and let P âˆ—be the measure deï¬ned via (3.33). For any agent a âˆˆA such that
wâˆ—
a := Eâˆ—[ Wa ] â‰¥Î±
Î±a

Eâˆ—[ W ] âˆ’w

,
(3.37)
the unrestricted optimal proï¬le
Xâˆ—
a = wâˆ—
a + Î±
Î±a

W âˆ’Eâˆ—[ W ]

satisï¬es Xâˆ—
a â‰¥0 P -a.s. Thus, if all agents satisfy the requirement (3.37) then the
unrestricted equilibrium computed in Example 3.51 is a forteriori an Arrowâ€“Debreu
equilibrium in our present context. In this case, there is no need for non-linear deriva-
tives of the market portfolio.
If some agents do not satisfy the requirement (3.37) then the situation becomes
moreinvolved, andtheequilibriumallocationwillneedderivativessuchascalloptions.
Let us illustrate this effect in the simple setting where there are only two agents
a âˆˆA = {1, 2}. Suppose that agent 1 satisï¬es condition (3.37), while agent 2 does
not. For c â‰¥0, we deï¬ne the measure P c â‰ˆP in terms of the density
Ï•c :=
ï£±
ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£³
1
Z1
eâˆ’Î±1W
on {W â‰¤c},
1
Z2
eâˆ’Î±W
on {W â‰¥c},
where Î± is given by (3.32), and where the constants Z1 and Z2 are determined by the
continuity condition
log Z2 âˆ’log Z1 = c(Î±1 âˆ’Î±)

142
3 Optimality and equilibrium
and by the normalization E[ Ï•c ] = 1. Note that P 0 = P âˆ—with P âˆ—as in (3.33).
Consider the equation
Î±
Î±2
Ec[ (W âˆ’c)+ ] = wc
2 := Ec[ W2 ].
(3.38)
Both sides are continuous in c.
As c increases from 0 to +âˆ, the left-hand
side decreases from
Î±
Î±2 Eâˆ—[ W ] to 0, while wc
2 goes from w0
2 <
Î±
Î±2 Eâˆ—[ W ] to
Eâˆ[ W2 ] > 0. Thus, there exists a solution c of (3.38). Let us now check that
Xc
2 := Î±
Î±2
(W âˆ’c)+,
Xc
1 := W âˆ’Xc
2
deï¬nes an equilibrium allocation with respect to the pricing measure P c. Clearly, Xc
1
and Xc
2 are non-negative and satisfy Xc
1 + Xc
2 = W. The budget condition for agent 2
is satisï¬ed due to (3.38), and this implies the budget condition
Ec[ Xc
1 ] = Ec[ W ] âˆ’wc
2 = wc
1
for agent 1. Both are optimal since
Xc
a = I +
a (Î»a Ï•c)
with
Î»1 := Î±1Z1
and
Î»2 := Î±2Z2eÎ±c.
Thus, agent 2 demands Î±
Î±2 shares of a call option on the market portfolio W with strike
c, agent 1 demands the remaining part of W, and so the market is cleared.
In the general case of a ï¬nite set A of agents, the equilibrium price measure Ë†P has
the following structure. There are levels 0 := c0 < Â· Â· Â· < cN = âˆwith 1 â‰¤N â‰¤|A|
such that the price density Ë†Ï• is given by
Ë†Ï• = 1
Zi
eâˆ’Î²iW
on { W âˆˆ[ciâˆ’1, ci] }
for i = 1, . . . , N, where
Î²i :=
	 
Î±âˆˆAi
1
Î±a

âˆ’1
,
and where Ai (i = 1, . . . , N) are the increasing sets of agents which are active at
the ith layer in the sense that Xa > 0 on

W âˆˆ(ciâˆ’1, ci]

. At each layer (ciâˆ’1, ci],
the active agents are sharing the market portfolio in inverse proportions to their risk
aversion. Thus, the optimal proï¬le Ë†Xa of any agent a âˆˆA is given by an increasing
piecewise linear function in W, and thus it can be implemented by a linear combination
of call options with strikes ci. More precisely, an agent a âˆˆAi takes Î²i/Î±a shares of
the spread
(W âˆ’ciâˆ’1)+ âˆ’(W âˆ’ci)+,
i.e., the agent goes long on a call option with strike ciâˆ’1 and short on a call option with
strike ci.
â™¦

3.4 Microeconomic equilibrium
143
Example 3.53. Assume that all agents a âˆˆA have preferences described by HARA
utility functions so that
I +
a (y) = yâˆ’
1
1âˆ’Î³a ,
a âˆˆA
with 0 â‰¤Î³a < 1. For a given price density Ï•, the optimal claims take the form
Xa = I +
a (caÏ•) = ba Ï•âˆ’
1
1âˆ’Î³a
(3.39)
with constants ba > 0. If Î³a = Î³ for all a âˆˆA, then the market clearing condition
(3.31) implies
W =

aâˆˆA
Xa =
	 
aâˆˆA
ba

Ï•âˆ’
1
1âˆ’Î³ ,
i.e., the equilibrium price density Ï•âˆ—takes the form
Ï•âˆ—= 1
Z W Î³ âˆ’1,
where Z is the normalizing constant, and so the agents demand linear shares of the
market portfolio W. If risk aversion varies among the agents then the structure of the
equilibrium becomes more complex, and it will involve non-linear derivatives of the
market portfolio. Let us number the agents so that A = {1, . . . , n} and Î³1 â‰¥Â· Â· Â· â‰¥Î³n.
Condition (3.39) implies
Xi = di XÎ²i
n
with some constants di, and where
Î²i := 1 âˆ’Î³n
1 âˆ’Î³i
satisï¬es Î²1 â‰¥Â· Â· Â· â‰¥Î²n = 1 with at least one strict inequality. Thus, each Xi is a
convex increasing function of Xn. In equilibrium, Xn is a concave function of W
determined by the condition
n

i=1
diXÎ²i
n = W,
(3.40)
and the price density Ï•âˆ—takes the form
Ï•âˆ—= 1
Z XÎ³nâˆ’1
n
.
As an illustration, we consider the special case â€œBernoulli vs. Cramerâ€, where
A = {1, 2} with u1(x) = âˆšx and u2(x) = log x, i.e., Î³1 = 1
2 and Î³2 = 0; see
Example 2.40. The solutions of (3.40) can be parameterized with c â‰¥0 such that
Xc
2 = 2âˆšc
âˆš
W + c âˆ’âˆšc

âˆˆ[0, W]

144
3 Optimality and equilibrium
and
Xc
1 = W âˆ’Xc
2.
The corresponding price density takes the form
Ï•c =
1
Z(c)
1
âˆšW + c âˆ’âˆšc
,
where Z(c) is the normalizing constant. Now assume that W âˆ’1 âˆˆL1(P ), and let
P âˆdenote the measure with density W âˆ’1
E[ W âˆ’1 ]
âˆ’1. As c increases from 0
to âˆ, Ec[ Xc
2 ] increases continuously from 0 to Eâˆ[ W ], while Ec[ W2 ] goes con-
tinuously from E0[ W2 ] > 0 to Eâˆ[ W2 ] < Eâˆ[ W ]; here we use our assumption
that P[ Wa > 0 ] Ì¸= 0 for all a âˆˆA. Thus, there is a c âˆˆ(0, âˆ) such that
Ec[ Xc
2 ] = Ec[ W2 ],
and this implies that the budget constraint is satisï¬ed for both agents. With this choice
of the parameter c, (Xc
1, Xc
2) is an equilibrium allocation with respect to the pricing
measure P c: Agent 2 demands the concave proï¬le Xc
2, agent 1 demands the convex
proï¬le Xc
1, both in accordance with their budget constraints, and the market is cleared.
â™¦
Let us now return to our general setting, and let us prove the existence of an
Arrowâ€“Debreu equilibrium. Consider the following condition:
lim sup
xâ†“0
x uâ€²
a(x) < âˆ
and
E

uâ€²
a
 W
|A|
 
< âˆ,
a âˆˆA.
(3.41)
Remark 3.54. Condition (3.41) is clearly satisï¬ed if
uâ€²
a(0) := lim
xâ†“0 uâ€²
a(x) < âˆ,
a âˆˆA.
(3.42)
But it also includes HARA utility functions ua with parameter Î³a âˆˆ[0, 1) if we assume
E[ W Î³aâˆ’1 ] < âˆ,
a âˆˆA,
in addition to our assumption E[ W ] < âˆ.
â™¦
Theorem 3.55. Under assumptions (3.35) and (3.41), there exists an Arrowâ€“Debreu
equilibrium.
In a ï¬rst step, we are going to show that an equilibrium allocation maximizes a
suitable weighted average
UÎ»(X) :=

aâˆˆA
Î»a E[ ua(Xa) ]

3.4 Microeconomic equilibrium
145
of the individual utility functionals over all feasible allocations X = (Xa)aâˆˆA. The
weights are non-negative, and without loss of generality we can assume that they are
normalized so that the vector Î» := (Î»a)aâˆˆA belongs to the convex compact set
 =
$
Î» âˆˆ[0, 1]A  
aâˆˆA
Î»a = 1
%
.
In a second step, we will use a ï¬xed-point argument to obtain a weight vector and a
corresponding price density such that the maximizing allocation satisï¬es the individual
budget constraints.
Deï¬nition 3.56. A feasible allocation (Xa)aâˆˆA is called Î»-efï¬cient for Î» âˆˆ if it
maximizes UÎ» over all feasible allocations.
In view of (3.36), part (b) of the following lemma shows that the equilibrium
allocation (Xâˆ—
a)aâˆˆA in an Arrowâ€“Debreu equilibrium is Î»-efï¬cient for the vector Î» =
(c Â· câˆ’1
a )aâˆˆA, where câˆ’1 := 
a câˆ’1
a . Thus, the existence proof for an Arrowâ€“Debreu
equilibrium is reduced to the construction of a suitable vector Î»âˆ—âˆˆ.
Lemma 3.57. (a) For any Î» âˆˆ there exists a unique Î»-efï¬cient allocation (XÎ»
a)aâˆˆA.
(b) A feasible allocation (Xa)aâˆˆA is Î»-efï¬cient if and only if it satisï¬es the ï¬rst
order conditions
Î»a uâ€²
a(Xa) â‰¤Ï•,
with equality on {Xa > 0}
(3.43)
with respect to some price density Ï•. In this case, (Xa)aâˆˆA coincides with
(XÎ»
a)aâˆˆA, and the price density can be chosen as
Ï•Î» := max
aâˆˆA Î»a uâ€²
a(XÎ»
a).
(3.44)
(c) For each a âˆˆA, XÎ»
a maximizes E[ ua(X) ] over all X âˆˆX such that
E[ Ï•Î» X ] â‰¤E[ Ï•Î» XÎ»
a ].
Proof. (a): ExistenceanduniquenessfollowfromthegeneralargumentinRemark3.37
applied to the set B of all feasible allocations and to the functional UÎ». Note that
UÎ»(X) â‰¤max
aâˆˆA E[ ua(W) ]
for any feasible allocation, and that the right-hand side is ï¬nite due to our assumption
(3.35). Moreover, by dominated convergence, UÎ» is indeed continuous on B with
respect to P -a.s. convergence.

146
3 Optimality and equilibrium
(b): Letusï¬rstshowsufï¬ciency. IfX = (Xa)aâˆˆA isafeasibleallocationsatisfying
the ï¬rst order conditions, and Y = (Ya)aâˆˆA is another feasible allocation then
UÎ»(X) âˆ’UÎ»(Y) =

aâˆˆA
Î»aE[ ua(Xa) âˆ’ua(Ya) ]
â‰¥

aâˆˆA
Î»aE[ uâ€²
a(Xa)(Xa âˆ’Ya) ]
â‰¥E
 
Ï•
	 
aâˆˆA
Xa âˆ’

aâˆˆA
Ya

 !
= 0,
using concavity of ua in the second step and the ï¬rst order conditions in the third.
This shows that X is Î»-efï¬cient.
Turning to necessity, consider the Î»-efï¬cient allocation (XÎ»
a)aâˆˆA for Î» âˆˆ and
another feasible allocation (Xa)aâˆˆA. For Îµ âˆˆ(0, 1], let Y Îµ
a := ÎµXa + (1 âˆ’Îµ)XÎ»
a.
Since (Y Îµ
a )aâˆˆA is feasible, Î»-efï¬ciency of (XÎ»
a)aâˆˆA yields
0 â‰¥1
Îµ

aâˆˆA
Î»a E[ ua(Y Îµ
a ) âˆ’ua(XÎ»
a) ]
â‰¥1
Îµ

aâˆˆA
Î»aE[ uâ€²
a(Y Îµ
a )(Y Îµ
a âˆ’XÎ»
a) ]
(3.45)
=

aâˆˆA
Î»aE[ uâ€²
a(Y Îµ
a )(Xa âˆ’XÎ»
a) ].
Let us ï¬rst assume (3.42); in part (d) of the proof we show how to modify the
argument under condition (3.41). Using dominated convergence and (3.42), we may
let Îµ â†“0 in the above inequality to conclude

aâˆˆA
E[ Ï•Î»
aXa ] â‰¤

aâˆˆA
E[ Ï•Î»
aXÎ»
a ] â‰¤E[ Ï•Î»W ],
(3.46)
where
Ï•Î»
a := Î»auâ€²
a(XÎ»
a).
Note that Ï•Î» is a price density since by (3.42)
0 < Ï•Î» â‰¤max{ Î»auâ€²
a(0) | a âˆˆA } < âˆ.
Take a feasible allocation (Xa)aâˆˆA such that

aâˆˆA
Ï•Î»
aXa = Ï•Î» W ;
(3.47)
for example, we can enumerate A := {1, . . . , |A|} and take Xa := WI{T =a} where
T (Ï‰) := min{ a | Ï•Î»
a(Ï‰) = Ï•Î»(Ï‰) }.

3.4 Microeconomic equilibrium
147
In view of (3.46), we see that

aâˆˆA
E[ Ï•Î»
a XÎ»
a ] = E[ Ï•Î» W ].
(3.48)
This implies Ï•Î»
a = Ï•Î» on {XÎ»
a > 0}, which is equivalent to the ï¬rst order condition
(3.43) with respect to Ï•Î».
(c): In order to show optimality of XÎ»
a, we may assume without loss of generality
that P [ XÎ»
a > 0 ] > 0, and hence Î»a > 0. Thus, the ï¬rst order condition with respect
to Ï•Î» takes the form
XÎ»
a = I +
a (Î»âˆ’1
a Ï•Î»),
due to our convention (3.22). By Corollary 3.42, XÎ»
a solves the optimization problem
for agent a âˆˆA under the constraint
E[ Ï•Î» X ] â‰¤E[ Ï•Î» XÎ»
a ].
(d): If (3.42) is replaced by (3.41), then we ï¬rst need an additional argument in
order to pass from (3.45) to (3.46). Note ï¬rst that by Fatouâ€™s lemma,
lim inf
Îµâ†“0

aâˆˆA
Î»aE[ uâ€²
a(Y Îµ
a ) Xa ] â‰¥

aâˆˆA
Î»a lim inf
Îµâ†“0
E[ uâ€²
a(Y Îµ
a ) Xa ]
â‰¥

aâˆˆA
Î»aE[ uâ€²
a(XÎ»
a) Xa ].
On the other hand, since
Îº := max
aâˆˆA
sup
0<xâ‰¤1
x uâ€²
a(x) < âˆ
by (3.41), we have xuâ€²
a(x) â‰¤Îº + xuâ€²
a(1) â‰¤Îº(1 + x) for all x â‰¥0. This implies
uâ€²
a(Xa)Xa â‰¤V := Îº(1 + W) âˆˆL1(P ),
(3.49)
and also
uâ€²
a(Y Îµ
a ) XÎ»
a â‰¤uâ€²
a

(1 âˆ’Îµ) XÎ»
a

XÎ»
a â‰¤(1 âˆ’Îµ)âˆ’1 V,
since Y Îµ
a â‰¥(1 âˆ’Îµ)XÎ»
a. Thus, dominated convergence implies
E[ uâ€²
a(Y Îµ
a ) XÎ»
a ] âˆ’â†’E[ uâ€²
a(XÎ»
a) XÎ»
a ],
Îµ â†“0,
and this concludes the proof of (3.46).
By (3.49), we have
Ï•Î»
a XÎ»
a := Î»a uâ€²
a(XÎ»
a) XÎ»
a âˆˆL1(P ).
Hence E[ Ï•Î» W ] < âˆfollows by taking in (3.46) a feasible allocation (Xa)aâˆˆA which
is as in (3.47). We furthermore get (3.48), which yields as in part (b) the ï¬rst order
conditions (3.43).

148
3 Optimality and equilibrium
It remains to show that Ï•Î» is integrable in order to conclude that Ï•Î» is a price
density. Our assumption (3.41) implies
F := max
aâˆˆA uâ€²
a
 W
|A|

âˆˆL1(P ),
(3.50)
and so it is enough to show that F â‰¥Ï•Î». Since XÎ»
a = I +
a

Ï•Î»/Î»a

, feasibility and
Î»a â‰¤1 imply
W â‰¤

aâˆˆA
I +
a (Ï•Î») â‰¤|A| max
aâˆˆA I +
a (Ï•Î»),
hence
F â‰¥max
aâˆˆA uâ€²
a

max
bâˆˆA I +
b (Ï•Î»)

â‰¥uâ€²
a0

I +
a0(Ï•Î»)

= Ï•Î»
on

max
aâˆˆA I +
a (Ï•Î») = I +
a0(Ï•Î»)

.
After these preliminaries, we are now in a position to prove the existence of an
Arrowâ€“Debreu equilibrium.
Note that for each Î» âˆˆ the Î»-efï¬cient allocation
(XÎ»
a)aâˆˆA and the price density Ï•Î» would form an Arrowâ€“Debreu equilibrium if
E[ Ï•Î» Wa ] = E[ Ï•Î» XÎ»
a ]
for all a âˆˆA.
(3.51)
If this is not the case, then we can replace Î» by the vector g(Î») =

ga(Î»)

aâˆˆA deï¬ned
by
ga(Î») := Î»a +
1
E[ V ] Â· E[ Ï•Î»(Wa âˆ’XÎ»
a) ],
where V is given by (3.49). Note that g(Î») âˆˆ: Since the ï¬rst order conditions
(3.43) together with (3.49) imply
E[ Ï•Î» XÎ»
a ] = Î»a E[ uâ€²
a(XÎ»
a) XÎ»
a ] â‰¤Î»a E[ V ],
we have ga(Î») â‰¥0, and 
a ga(Î») = 1 follows by feasibility. Thus, we increase
the weights of agents which were allocated less than they could afford. Clearly, any
ï¬xed point of the map g :  â†’ will satisfy condition (3.51) and thus yield an
Arrowâ€“Debreu equilibrium.
Proof of Theorem 3.55. (a): The set  is convex and compact. Thus, the existence of
a ï¬xed point of the map g :  â†’ follows from Brouwerâ€™s ï¬xed point theorem as
soon as we can verify that g is continuous; see, for instance, Corollary 16.52 in [2]
for a proof of Brouwerâ€™s ï¬xed point theorem. Suppose that the sequence (Î»n) âŠ‚
converges to Î» âˆˆ. In part (c) we show that Xn := XÎ»n and Ï•n := Ï•Î»n converge
P-a.s. to XÎ» and Ï•Î», respectively. We will show next that we may apply the dominated
convergence theorem, so that
lim
nâ†‘âˆE[ Ï•n Wa ] = E[ Ï•Î» Wa ]

3.4 Microeconomic equilibrium
149
and
lim
nâ†‘âˆE[ Ï•n Xn ] = E[ Ï•Î» XÎ» ]
and this will prove the continuity of g. To verify the assumptions of the dominated
convergence theorem, note that
Wa Ï•n â‰¤W Ï•n â‰¤WF,
where F is as in (3.50). Moreover,
WF â‰¤|A|F I{Wâ‰¤|A|} + max
aâˆˆA uâ€²
a(1) Â· W âˆˆL1(P ).
Thus, Ï•n Wa and Ï•n Xn are bounded by WF âˆˆL1(P ).
(b): By our convention (3.22), the map f :  Ã— [0, âˆ] â†’[0, âˆ] deï¬ned by
f (Î», y) =

aâˆˆA
I +
a (Î»âˆ’1
a
y)
is continuous. If we ï¬x Î» âˆˆ, then the function f (Î», Â·) is continuous on [0, âˆ] and
strictly decreasing on (a(Î»), b(Î»)) where
a(Î») := max
aâˆˆA lim
xâ†‘âˆÎ»a uâ€²
a(x) â‰¥0
and
b(Î») = max
aâˆˆA Î»a uâ€²
a(0+) â‰¤+âˆ.
Moreover, f (Î», y) = âˆfor y â‰¤a(Î») and f (Î», y) = 0 for y â‰¥b(Î»). Hence, for
each w âˆˆ(0, âˆ) there exists exactly one solution yÎ» âˆˆ(a(Î»), b(Î»)) of the equation
f (Î», yÎ») = w.
Recall that [0, âˆ] can be regarded as a compact topological space. To see that yÎ»
depends continuously on Î» âˆˆ, take a sequence Î»n â†’Î» and a subsequence (Î»nk)
such that the solutions yk = yÎ»nk of f (Î»nk, y) = w converge to some limit yâˆâˆˆ
[a(Î»), b(Î»)]. By continuity of f ,
f (Î», yâˆ) = lim
kâ†‘âˆf (Î»nk, yk) = w,
and so yâˆmust coincide with yÎ».
(c): Recall that
XÎ»
a = I +
a (Î»âˆ’1
a Ï•Î»)
(3.52)
for any a âˆˆA. By feasibility,
W =

aâˆˆA
XÎ»
a = f (Î», Ï•Î»).
Thus, Ï•Î»n converges P -a.s. to Ï•Î» as Î»n â†’Î» due to part (b), and so XÎ»n converges P -
a.s. to XÎ» due to (3.52). This completes the proof in (a) that the map g is continuous.

150
3 Optimality and equilibrium
Remark 3.58. In order to simplify the exposition, we have restricted the discussion
of equilibrium prices to contingent claims with payoff at time t = 1. We have argued
in terms of discounted payoffs, and so we have implicitly assumed that the interest
rate r has already been ï¬xed. From an economic point of view, also the interest rate
should be determined by an equilibrium argument. This requires an intertemporal
extension of our setting, which distinguishes between deterministic payoffs y at time
t = 0 and nominal contingent payoffs Y at time t = 1. Thus, we replace X = L0
+ by
the space
Y :=

Y = (y, Y) | y âˆˆ[0, âˆ), Y âˆˆL0
+

.
A pricing rule is given by a linear functional on Y of the form
(Y) := Ï•0 Â· y + E[ Ï• Y ],
where Ï•0 âˆˆ(0, âˆ) and Ï• is a price density as before. Any such price system speciï¬es
an interest rate for transferring income from time t = 0 to time t = 1. Indeed,
comparing the forward price c Â· E[ Ï• ] for the ï¬xed amount c to be delivered at time 1
with the spot price c Â· Ï•0 for the amount c made available at time 0, we see that the
implicit interest rate is given by
1 + r = E[ Ï• ]
Ï•0
.
If we describe the preferences of agent a âˆˆA by a utility functional of the form
Ua(Y) = ua,0(y) + E[ua,1(Y)]
with smooth utility functions ua,0 and ua,1, then we can show along the lines of the
preceding discussion that anArrowâ€“Debreu equilibrium exists in this extended setting.
Thus, we obtain an equilibrium allocation (Y âˆ—
a)aâˆˆA and an equilibrium price system
âˆ—= (Ï•âˆ—
0, Ï•âˆ—) such that each Y âˆ—
a maximizes the functional Ua in the agentâ€™s budget
set determined by an initial endowment in Y and by the pricing rule âˆ—. In particular,
we have then speciï¬ed an equilibrium interest rate râˆ—. Normalizing the price system
to Ï•âˆ—
0 = 1 and deï¬ning P âˆ—as a probability measure with density Ï•âˆ—/E[ Ï•âˆ—], we see
that the price at time t = 0 of a contingent claim with nominal payoff Y â‰¥0 at time
t = 1 is given as the expectation
Eâˆ—

Y
1 + râˆ—

of the discounted claim with respect to the measure P âˆ—.
â™¦
Let us now extend the discussion to situations where agents are heterogeneous not
only in their utility functions but also in their expectations. Thus, we assume that the
preferences of agent a âˆˆA are described by a Savage functional of the form
Ua(X) := EQa[ ua(X) ],

3.4 Microeconomic equilibrium
151
where Qa is a probability measure on (, F ) which is equivalent to P . In addition
to our assumption
lim sup
xâ†“0
x uâ€²
a(x) < âˆ,
a âˆˆA,
(3.53)
we assume that
EQa[ W ] < âˆ
and
EQa

uâ€²
a
 W
|A|
 
< âˆ,
a âˆˆA,
(3.54)
As before, a feasible allocation (Xâˆ—
a)aâˆˆA together with a price density Ï•âˆ—is called
an Arrowâ€“Debreu equilibrium if each Xâˆ—
a maximizes the functional Ua on the budget
set of agent a âˆˆA, which is determined by Ï•âˆ—.
Theorem 3.59. Under assumptions (3.35), (3.53), and (3.54), there exists an Arrowâ€“
Debreu equilibrium.
Proof. For any Î» âˆˆ, the general argument of Remark 3.37 yields the existence of
a Î»-efï¬cient allocation (XÎ»
a)aâˆˆA, i.e., of a feasible allocation which maximizes the
functional
UÎ»(X) :=

aâˆˆA
Î»aUa(Xa)
over all feasible allocations X = (Xa)aâˆˆA. Since
Ua(XÎ»
a) = E[ Ï•a ua(XÎ»
a) ],
(XÎ»
a)aâˆˆAcan be viewed as a Î»-efï¬cient allocation in the model where agents have
random utility functions of the form
ua(x, Ï‰) = ua(x) Ï•a(Ï‰),
while their expectations are homogeneous and given by P . In view of Corollary 3.43,
it follows as before that XÎ» satisï¬es the ï¬rst order conditions
XÎ»
a = I +
a (Î»âˆ’1
a Ï•âˆ’1
a
Ï•Î»),
a âˆˆA,
with
Ï•Î» = max
aâˆˆA Î»a uâ€²
a(XÎ»
a) Ï•a,
and that XÎ»
a satisï¬es
Ua(XÎ»
a) â‰¥E[ ua(Ya) Ï•a ] â‰¥Ua(Ya)
for all Ya in the budget set of agent a âˆˆA. The remaining arguments are essentially
the same as in the proof of Theorem 3.55.

Chapter 4
Monetary measures of risk
In this chapter, we discuss the problem of quantifying the risk of a ï¬nancial position.
As in Chapter 2, such a position will be described by the corresponding payoff proï¬le,
that is, by a real-valued function X on some set of possible scenarios. In a probabilistic
model, speciï¬ed by a probability measure on scenarios, we could focus on the resulting
distribution of X and try to measure the risk in terms of moments or quantiles. Note
that a classical measure of risk such as the variance does not capture a basic asymmetry
in the ï¬nancial interpretation of X: Here it is the downside risk that matters. This
asymmetry is taken into account by measures such as Value at Risk which are based
on quantiles for the lower tail of the distribution, see Section 4.4 below. Value at Risk,
however, fails to satisfy some natural consistency requirements. Such observations
have motivated the systematic investigation of measures of risk that satisfy certain
basic axioms.
From the point of view of an investor, we could simply turn around the discussion
of Chapter 2 and measure the risk of a position X in terms of the loss functional
L(X) = âˆ’U(X).
Here U is a utility functional representing a given preference relation â‰»on ï¬nancial
positions. Assuming robust preferences, we are led to the notion of robust shortfall
risk deï¬ned by
L(X) = sup
QâˆˆQ
EQ[ â„“(âˆ’X) ],
where â„“(x) := âˆ’u(âˆ’x) is a convex increasing loss function and Q is a class of
probability measures. The results of Section 2.5 show how such loss functionals can
be characterized in terms of convexity and monotonicity properties of the preference
relation. In particular, a ï¬nancial position could be viewed as being acceptable if the
robust shortfall risk of X does not exceed a given bound.
From the point of view of a supervising agency, however, a speciï¬c monetary
purpose comes into play. In this perspective a risk measure is viewed as a capital
requirement: We are looking for the minimal amount of capital which, if added to the
position and invested in a risk-free manner, makes the position acceptable. This mon-
etary interpretation is captured by an additional axiom of cash invariance. Together
with convexity and monotonicity, it singles out the class of convex measures of risk.
These measures can be represented in the form
Ï(X) = sup
Q

EQ[ âˆ’X ] âˆ’Î±(Q)

,
where Î± is a penalty function deï¬ned on probability measures on .
Under the
additional condition of positive homogeneity, we obtain the class of coherent risk

4.1 Risk measures and their acceptance sets
153
measures. Here we are back to the situation in Proposition 2.85, and the representation
takes the form
Ï(X) = sup
QâˆˆQ
EQ[ âˆ’X ],
where Q is some class of probability measures on .
The axiomatic approach to such monetary risk measures was initiated by P.Artzner,
F. Delbaen, J. Eber, and D. Heath [11], and it will be developed in the ï¬rst three
sections. In Section 4.4 we discuss some coherent risk measures related to Value
at Risk.
These risk measures only involve the distribution of a position under a
given probability measure. In Section 4.5 we characterize the class of convex risk
measures which share this property of law-invariance. Section 4.6 discusses the role
of concave distortions, and in Section 4.7 the resulting risk measures are characterized
by a property of comonotonicity. In Section 4.8 we discuss measures of risk which
arise naturally in the context of a ï¬nancial market model. In Section 4.9 we analyze
the structure of monetary measures of risk which are induced by our notion of robust
shortfall risk.
4.1 Risk measures and their acceptance sets
Let  be a ï¬xed set of scenarios. A ï¬nancial position is described by a mapping
X :  âˆ’â†’R where X(Ï‰) is the discounted net worth of the position at the end of
the trading period if the scenario Ï‰ âˆˆ is realized. Our aim is to quantify the risk of
X by some number Ï(X), where X belongs to a given class X of ï¬nancial positions.
Throughout this section, X will be a linear space of bounded functions containing the
constants. We do not assume that a probability measure is given on .
Deï¬nition 4.1. A mapping Ï : X â†’R is called a monetary measure of risk if it
satisï¬es the following conditions for all X, Y âˆˆX.
â€¢ Monotonicity: If X â‰¤Y, then Ï(X) â‰¥Ï(Y).
â€¢ Cash invariance: If m âˆˆR, then Ï(X + m) = Ï(X) âˆ’m.
The ï¬nancial meaning of monotonicity is clear: The downside risk of a position
is reduced if the payoff proï¬le is increased. Cash invariance is also called translation
invariance. It is motivated by the interpretation of Ï(X) as a capital requirement,
i.e., Ï(X) is the amount which should be added to the position X in order to make
it acceptable from the point of view of a supervising agency. Thus, if the amount m
is added to the position and invested in a risk-free manner, the capital requirement is
reduced by the same amount. In particular, cash invariance implies
Ï

X + Ï(X)

= 0,
(4.1)

154
4 Monetary measures of risk
and
Ï(m) = Ï(0) âˆ’m
for all m âˆˆR.
For most purposes it would be no loss of generality to assume that a given monetary
risk measure satisï¬es the condition of
â€¢ Normalization: Ï(0) = 0.
In some situations, however, it will be convenient not to insist on normalization.
Remark 4.2. We are using the convention that X describes the worth of a ï¬nancial
position after discounting.
For instance, the discounting factor can be chosen as
1/(1+r) where r is the return of a risk-free investment. Instead of measuring the risk
of the discounted position X, one could consider directly the nominal worth

X = (1 + r)X.
The corresponding risk measure Ï(
X) := Ï(X) is again monotone. Cash invariance
is replaced by the following property:
Ï

X + (1 + r)m

= Ï(
X) âˆ’m,
(4.2)
i.e., the risk is reduced by m if an additional amount m is invested in a risk-free manner.
Conversely, any Ï : X â†’R which is monotone and satisï¬es (4.2) deï¬nes a monetary
measure of risk via Ï(X) := Ï

(1 + r)X

.
â™¦
Lemma 4.3. Any monetary measure of risk Ï is Lipschitz continuous with respect to
the supremum norm âˆ¥Â· âˆ¥:
|Ï(X) âˆ’Ï(Y)| â‰¤âˆ¥X âˆ’Yâˆ¥.
Proof. Clearly, X â‰¤Y + âˆ¥X âˆ’Yâˆ¥, and so Ï(Y) âˆ’âˆ¥X âˆ’Yâˆ¥â‰¤Ï(X) by monotonicity
and cash invariance. Reversing the roles of X and Y yields the assertion.
From now on we concentrate on monetary measures of risk which have an addi-
tional convexity property.
Deï¬nition 4.4. A monetary risk measure Ï : X â†’R is called a convex measure of
risk if it satisï¬es
â€¢ Convexity: Ï(Î»X + (1 âˆ’Î»)Y) â‰¤Î»Ï(X) + (1 âˆ’Î»)Ï(Y), for 0 â‰¤Î» â‰¤1.
Consider the collection of possible future outcomes that can be generated with the
resources available to an investor: One investment strategy leads to X, while a second
strategy leads to Y. If one diversiï¬es, spending only the fraction Î» of the resources on
the ï¬rst possibility and using the remaining part for the second alternative, one obtains
Î»X + (1 âˆ’Î»)Y. Thus, the axiom of convexity gives a precise meaning to the idea that
diversiï¬cation should not increase the risk. If Ï is convex and normalized, then
Ï(Î»X) â‰¤Î»Ï(X)
for 0 â‰¤Î» â‰¤1,
Ï(Î»X) â‰¥Î»Ï(X)
for Î» â‰¥1.

4.1 Risk measures and their acceptance sets
155
Deï¬nition 4.5. A convex measure of risk Ï is called a coherent risk measure if it
satisï¬es
â€¢ Positive Homogeneity: If Î» â‰¥0, then Ï(Î»X) = Î»Ï(X).
If a monetary measure of risk Ï is positively homogeneous, then it is normalized,
i.e., Ï(0) = 0. Under the assumption of positive homogeneity, convexity is equivalent
to
â€¢ Subadditivity: Ï(X + Y) â‰¤Ï(X) + Ï(Y).
This property allows to decentralize the task of managing the risk arising from a
collection of different positions: If separate risk limits are given to different â€œdesksâ€,
then the risk of the aggregate position is bounded by the sum of the individual risk
limits.
In many situations, however, risk may grow in a non-linear way as the size of the
position increases. For this reason we will not insist on positive homogeneity. Instead,
our focus will be on convex measures of risk.
A monetary measure of risk Ï induces the class
AÏ := { X âˆˆX | Ï(X) â‰¤0 }
of positions which are acceptable in the sense that they do not require additional capital.
The class AÏ will be called the acceptance set of Ï. The following two propositions
summarize the relations between monetary measures of risk and their acceptance sets.
Proposition 4.6. Suppose that Ï is a monetary measure of risk with acceptance set
A := AÏ.
(a) A is non-empty, and satisï¬es the following two conditions:
inf{ m âˆˆR | m âˆˆA } > âˆ’âˆ.
(4.3)
X âˆˆA, Y âˆˆX, Y â‰¥X
"â‡’
Y âˆˆA.
(4.4)
Moreover, A has the following closure property: For X âˆˆA and Y âˆˆX,

Î» âˆˆ[0, 1] | Î»X + (1 âˆ’Î»)Y âˆˆA

is closed in [0, 1].
(4.5)
(b) Ï can be recovered from A:
Ï(X) = inf{ m âˆˆR | m + X âˆˆA }.
(4.6)
(c) Ï is a convex risk measure if and only if A is convex.
(d) Ï is positively homogeneous if and only if A is a cone. In particular, Ï is
coherent if and only if A is a convex cone.

156
4 Monetary measures of risk
Proof. The ï¬rst two properties in (a) are straightforward. As to (4.5), the function
Î» â†’Ï(Î»X + (1 âˆ’Î»)Y) is continuous by Lemma 4.3. Hence, the set of Î» âˆˆ[0, 1]
such that Ï(Î»X + (1 âˆ’Î»)Y) â‰¤0 is closed.
(b): Cash invariance implies that for X âˆˆX,
inf{ m âˆˆR | m + X âˆˆAÏ } = inf{ m âˆˆR | Ï(m + X) â‰¤0 }
= inf{ m âˆˆR | Ï(X) â‰¤m }
= Ï(X).
(c): A is clearly convex if Ï is a convex measure of risk. The converse will follow
from Proposition 4.7 together with (4.8).
(d): Clearly, positive homogeneity of Ï implies that A is a cone. The converse
follows as in (c).
Conversely, one can take a given class A âŠ‚X of acceptable positions as the
primary object. For a position X âˆˆX, we can then deï¬ne the capital requirement as
the minimal amount m for which m + X becomes acceptable:
ÏA(X) := inf{ m âˆˆR | m + X âˆˆA }.
(4.7)
Note that, with this notation, (4.6) takes the form
ÏAÏ = Ï.
(4.8)
Proposition 4.7. Assume that A is a non-empty subset of X which satisï¬es (4.3) and
(4.4). Then the functional ÏA has the following properties:
(a) ÏA is a monetary measure of risk.
(b) If A is a convex set, then ÏA is a convex measure of risk.
(c) If A is a cone, then ÏA is positively homogeneous. In particular, ÏA is a coherent
measure of risk if A is a convex cone.
(d) A is a subset of AÏA. If A satisï¬es the closure property (4.5) then A = AÏA.
Proof. (a): It is straightforward to verify that ÏA satisï¬es cash invariance and mono-
tonicity. We show next that ÏA takes only ï¬nite values. To this end, ï¬x some Y in the
non-empty set A. For X âˆˆX given, there exists a ï¬nite number m with m + X > Y,
because X and Y are both bounded. Then
ÏA(X) âˆ’m = ÏA(m + X) â‰¤ÏA(Y) â‰¤0,
and hence ÏA(X) â‰¤m < âˆ. Note that (4.3) is equivalent to ÏA(0) > âˆ’âˆ. To
show that ÏA(X) > âˆ’âˆfor arbitrary X âˆˆX, we take mâ€² such that X + mâ€² â‰¤0 and
conclude by monotonicity and cash invariance that ÏA(X) â‰¥ÏA(0) + mâ€² > âˆ’âˆ.

4.1 Risk measures and their acceptance sets
157
(b): Suppose that X1, X2 âˆˆX and that m1, m2 âˆˆR are such that mi +Xi âˆˆA. If
Î» âˆˆ[0, 1], then the convexity of A implies that Î»(m1 +X1)+(1âˆ’Î»)(m2 +X2) âˆˆA.
Thus, by the cash invariance of ÏA,
0 â‰¥ÏA

Î»(m1 + X1) + (1 âˆ’Î»)(m2 + X2)

= ÏA

Î»X1 + (1 âˆ’Î»)X2

âˆ’

Î»m1 + (1 âˆ’Î»)m2

,
and the convexity of ÏA follows.
(c): As in the proof of convexity, we obtain that ÏA(Î»X) â‰¤Î»ÏA(X) for Î» â‰¥0 if
A is a cone. To prove the converse inequality, let m < ÏA(X). Then m + X /âˆˆA and
hence Î»m + Î»X /âˆˆA for Î» â‰¥0. Thus Î»m < ÏA(Î»X), and (c) follows.
(d): The inclusion A âŠ†AÏA is obvious. Now assume that A satisï¬es (4.5). We
have to show that X /âˆˆA implies that ÏA(X) > 0. To this end, take m > âˆ¥Xâˆ¥=
supÏ‰ |X(Ï‰)|. By assumption, there exists an Îµ âˆˆ(0, 1) such that Îµm+(1âˆ’Îµ)X /âˆˆA.
Thus,
0 â‰¤ÏA

Îµ m + (1 âˆ’Îµ)X

= ÏA

(1 âˆ’Îµ)X

âˆ’Îµ m.
Since ÏA is a monetary measure of risk, Lemma 4.3 shows that
ÏA

(1 âˆ’Îµ)X

âˆ’ÏA(X)
 â‰¤Îµ âˆ¥Xâˆ¥.
Hence,
ÏA(X) â‰¥ÏA

(1 âˆ’Îµ)X

âˆ’Îµ âˆ¥Xâˆ¥â‰¥Îµ

m âˆ’âˆ¥Xâˆ¥

> 0.
In the following examples, we take X as the linear space of all bounded measurable
functions on some measurable space (, F ), and we denote by M1 = M1(, F ) the
class of all probability measures on (, F ).
Example 4.8. Consider the worst-case risk measure Ïmax deï¬ned by
Ïmax(X) = âˆ’inf
Ï‰âˆˆ X(Ï‰)
for all X âˆˆX.
The value Ïmax(X) is the least upper bound for the potential loss which can occur in
any scenario. The corresponding acceptance set A is given by the convex cone of all
non-negative functions in X. Thus, Ïmax is a coherent measure of risk. It is the most
conservative measure of risk in the sense that any normalized monetary risk measure
Ï on X satisï¬es
Ï(X) â‰¤Ï

inf
Ï‰âˆˆ X(Ï‰)

= Ïmax(X).
Note that Ïmax can be represented in the form
Ïmax(X) = sup
QâˆˆQ
EQ[ âˆ’X ],
(4.9)
where Q is the class M1 of all probability measures on (, F ).
â™¦

158
4 Monetary measures of risk
Example 4.9. Let Q be a set of probability measures on (, F ), and consider a
mapping Î³ : Q â†’R with supQ Î³ (Q) < âˆ, which speciï¬es for each Q âˆˆQ some
â€œï¬‚oorâ€ Î³ (Q). Suppose that a position X is acceptable if
EQ[ X ] â‰¥Î³ (Q)
for all Q âˆˆQ.
The set A of such positions satisï¬es (4.3) and (4.4), and it is convex. Thus, the
associated monetary risk measure Ï = ÏA is convex, and it takes the form
Ï(X) = sup
QâˆˆQ
(Î³ (Q) âˆ’EQ[ X ]).
Alternatively, we can write
Ï(X) = sup
QâˆˆM1

EQ[ âˆ’X ] âˆ’Î±(Q)

,
(4.10)
where the penalty function Î± : M1 â†’(âˆ’âˆ, âˆ] is deï¬ned by Î±(Q) = âˆ’Î³ (Q)
for Q âˆˆQ and Î±(Q) = +âˆotherwise. Note that Ï is a coherent risk measure if
Î³ (Q) = 0 for all Q âˆˆQ.
â™¦
Example 4.10. Consider a utility function u on R, a probability measure Q âˆˆM1,
and ï¬x some threshold c âˆˆR. Let us call a position X acceptable if its certainty
equivalent is at least c, i.e., if its expected utility EQ[ u(X) ] is bounded from below
by u(c). Clearly, the set
A := { X âˆˆX | EQ[ u(X) ] â‰¥u(c) }.
is non-empty, convex, and satisï¬es (4.3) and (4.4). Thus, ÏA is a convex measure of
risk. As an obvious robust extension, we can deï¬ne acceptability in terms of a whole
class Q of probability measures on (, F ), i.e.,
A :=

QâˆˆQ
{ X âˆˆX | EQ[ u(X) ] â‰¥u(cQ) },
with constants cQ such that supQâˆˆQ cQ < âˆ. The corresponding risk measures will
be studied in more detail in Section 4.9.
â™¦
Example 4.11. Suppose now that we have speciï¬ed a probabilistic model, i.e., a
probability measure P on (, F ). In this context, a position X is often considered to
be acceptable if the probability of a loss is bounded by a given level Î» âˆˆ(0, 1), i.e., if
P [ X < 0 ] â‰¤Î».
The corresponding monetary risk measure V@RÎ», deï¬ned by
V@RÎ»(X) = inf{ m âˆˆR | P [ m + X < 0 ] â‰¤Î» },

4.1 Risk measures and their acceptance sets
159
is called Value at Risk at level Î». Note that it is well deï¬ned on the space L0(, F , P )
of all random variables which are P -a.s. ï¬nite, and that
V@RÎ»(X) = E[ âˆ’X ] + âˆ’1(1 âˆ’Î»)Ïƒ(X),
(4.11)
if X is a Gaussian random variable with variance Ïƒ 2(X) and âˆ’1 denotes the inverse
of the distribution function  of N(0, 1). Clearly, V@RÎ» is positively homogeneous,
but in general it is not convex, as shown by Example 4.41 below. In Section 4.4, Value
at Risk will be discussed in detail. In particular, we will study some closely related
coherent and convex measures of risk.
â™¦
Example 4.12. As in the preceding example, we ï¬x a probability measure P on
(, F ). For an asset with payoff 
X âˆˆL2 = L2(, F , P ), price Ï€(
X), and variance
Ïƒ 2(
X) Ì¸= 0, the Sharpe ratio is deï¬ned as
E[ 
X ] âˆ’Ï€(
X)(1 + r)
Ïƒ(
X)
= E[ X ]
Ïƒ(X) ,
where X := 
X(1 + r)âˆ’1 âˆ’Ï€(
X) is the corresponding discounted net worth. Suppose
that we ï¬nd the position X acceptable if the Sharpe ratio is bounded from below by
some constant c > 0. The resulting functional Ïc on L2 deï¬ned by (4.7) for the class
Ac := { X âˆˆL2 | E[ X ] â‰¥c Â· Ïƒ(X) }
is given by
Ïc(X) = E[ âˆ’X ] + c Â· Ïƒ(X).
It is cash invariant and positively homogeneous, and it is convex since Ïƒ( Â· ) is a convex
functional on L2. But Ïc is not a monetary risk measure, because it is not monotone.
Indeed, if X = eZ and Z is a random variable with normal distribution N(0, Ïƒ 2), then
X â‰¥0 but
Ïc(X) = âˆ’eÏƒ 2/2 + ceÏƒ 2/2&
eÏƒ 2 âˆ’1
becomes positive for large enough Ïƒ. Note, however, that (4.11) shows that Ïc(X)
coincides with V@RÎ»(X) if X is Gaussian and if c = âˆ’1(1 âˆ’Î») with 0 < Î» â‰¤1/2.
Thus, both Ïc and V@RÎ» have all the properties of a coherent risk measure if restricted
to a Gaussian subspace 
X of L2, i.e, a linear space consisting of normally distributed
random variables. But neither Ïc nor V@RÎ» can be coherent on the full space L2,
since the existence of normal random variables on (, F , P ) implies that X will also
contain random variables as considered in Example 4.41.
â™¦
Example 4.13. Let c : F â†’[0, 1] be any set function which is normalized and
monotone in the sense that c(âˆ…) = 0, c() = 1, and c(A) â‰¤c(B) if A âŠ‚B. For
instance, c can be given by c(A) := Ïˆ(P[ A ]) for some probability measure P and
an increasing function Ïˆ : [0, 1] â†’[0, 1] such that Ïˆ(0) = 0 and Ïˆ(1) = 1. The

160
4 Monetary measures of risk
Choquet integral of a bounded measurable function X â‰¥0 with respect to c is deï¬ned
as

X dc :=
 âˆ
0
c(X > x) dx.
If c is a probability measure, Fubiniâ€™s theorem implies that

X dc coincides with the
usual integral. In the general case, the Choquet integral is a nonlinear functional of X,
but we still have

Î»X dc = Î»

X dc and

(X + m) dc =

X dc + m for constants
Î», m â‰¥0. If X âˆˆX is arbitrary, we take m âˆˆR such that X + m â‰¥0 and get

(X + m) dc âˆ’m =
 0
âˆ’m

c(X > x) âˆ’1

dx +
 âˆ
0
c(X > x) dx.
The right-hand side is independent of m â‰¥âˆ’inf X, and so it makes sense to extend
the deï¬nition of the Choquet integral by putting

X dc :=
 0
âˆ’âˆ

c(X > x) âˆ’1

dx +
 âˆ
0
c(X > x) dx
for all X âˆˆX. It follows that

Î»X dc = Î»

X dc
and

(X + m) dc =

X dc + m
for all Î» â‰¥0 and m âˆˆR. Moreover, we have

Y dc â‰¥

X dc
for Y â‰¥X.
Thus, the Choquet integral of the loss,
Ï(X) :=

(âˆ’X) dc,
is a positively homogeneous monetary risk measure on X. In Section 4.7, we will
characterize these risk measures in terms of a property called â€œcomonotonicityâ€. We
will also show that Ï is convex, and hence coherent, if and only if c is submodular or
2-alternating, i.e.,
c(A âˆ©B) + c(A âˆªB) â‰¤c(A) + c(B)
for A, B âˆˆF .
In this case, Ï admits the representation
Ï(X) = max
QâˆˆQc
EQ[ âˆ’X ],
(4.12)
where Qc is the core of c, deï¬ned as the class of all ï¬nitely additive and normalized set
functions Q : F â†’[0, 1] such that Q[ A ] â‰¤c(A) for all A âˆˆF ; see Theorem 4.88.
â™¦
In the next two sections, we are going to show how representations of the form
(4.9), (4.12), or (4.10) for coherent or convex risk measures arise in a systematic
manner.

4.2 Robust representation of convex risk measures
161
4.2 Robust representation of convex risk measures
In this section, we consider the situation where X consists of all bounded measurable
functions on the measurable space (, F ). Recall that X is a Banach space if endowed
with the supremum norm âˆ¥Â·âˆ¥. As in Section 2.5, we denote by M1 := M1(, F ) the
set of all probability measures on (, F ) and by M1,f := M1,f (, F ) the set of all
ï¬nitely additive set functions Q : F â†’[0, 1] which are normalized to Q[  ] = 1.
By EQ[ X ] we denote the integral of X with respect to Q âˆˆM1,f ; see Appendix A.6.
We do not assume that a probability measure on (, F ) is given a priori.
If Ï is a coherent measure of risk on X, then we are in the context of Proposi-
tion 2.85, i.e., the functional J deï¬ned by J(X) := âˆ’Ï(X) satisï¬es the four properties
listed in Proposition 2.84. Hence, we have the following result:
Proposition 4.14. A functional Ï : X â†’R is a coherent measure of risk if and only
if there exists a subset Q of M1,f such that
Ï(X) = sup
QâˆˆQ
EQ[ âˆ’X ],
X âˆˆX.
(4.13)
Moreover, Q can be chosen as a convex set for which the supremum in (4.13) is
attained.
Our ï¬rst goal in this section is to obtain an analogue of this result for convex
measures of risk. Applied to a coherent measure of risk, it will yield an alternative
proof of Proposition 4.14, which does not depend on the discussion in Chapter 2, and
it will provide a description of the maximal set Q in (4.13). Our second goal will be
to obtain criteria which guarantee that a measure of risk can be represented in terms
of Ïƒ-additive probability measures.
Let Î± : M1,f â†’R âˆª{+âˆ} be any functional such that
inf
QâˆˆM1,f
Î±(Q) âˆˆR.
For each Q âˆˆM1,f the functional X â†’EQ[ âˆ’X ] âˆ’Î±(Q) is convex, monotone,
and cash invariant on X, and these three properties are preserved when taking the
supremum over Q âˆˆM1,f . Hence,
Ï(X) :=
sup
QâˆˆM1,f

EQ[ âˆ’X ] âˆ’Î±(Q)

(4.14)
deï¬nes a convex measure of risk on X such that
Ï(0) = âˆ’
inf
QâˆˆM1,f
Î±(Q).
The functional Î± will be called a penalty function for Ï on M1,f , and we will say that
Ï is represented by Î± on M1,f .

162
4 Monetary measures of risk
Theorem 4.15. Any convex measure of risk Ï on X is of the form
Ï(X) =
max
QâˆˆM1,f

EQ[ âˆ’X ] âˆ’Î±min(Q)

,
X âˆˆX,
(4.15)
where the penalty function Î±min is given by
Î±min(Q) := sup
XâˆˆAÏ
EQ[ âˆ’X ]
for Q âˆˆM1,f .
Moreover, Î±min is the minimal penalty function which represents Ï, i.e., any penalty
function Î± for which (4.14) holds satisï¬es Î±(Q) â‰¥Î±min(Q) for all Q âˆˆM1,f .
Proof. In a ï¬rst step, we show that
Ï(X) â‰¥
sup
QâˆˆM1,f

EQ[ âˆ’X ] âˆ’Î±min(Q)

for all X âˆˆX.
To this end, recall that Xâ€² := Ï(X) + X âˆˆAÏ by (4.1). Thus, for all Q âˆˆM1,f
Î±min(Q) â‰¥EQ[ âˆ’Xâ€² ] = EQ[ âˆ’X ] âˆ’Ï(X).
From here, our claim follows.
For X given, we will now construct some QX âˆˆM1,f such that
Ï(X) â‰¤EQX[ âˆ’X ] âˆ’Î±min(QX),
which, in view of the previous step, will prove our representation (4.15). By cash
invariance it sufï¬ces to prove this for X âˆˆX with Ï(X) = 0. Moreover, we may
assume without loss of generality that Ï(0) = 0. Then X is not contained in the
nonempty convex set
B := { Y âˆˆX | Ï(Y) < 0 }.
Since B is open is open due to Lemma 4.3, we may apply the separation argument in
the form of Theorem A.54. It yields a non-zero continuous linear functional â„“on X
such that
â„“(X) â‰¤inf
YâˆˆB â„“(Y) =: b.
We claim that â„“(Y) â‰¥0 if Y â‰¥0. Monotonicity and cash invariance of Ï imply
that 1 + Î»Y âˆˆB for any Î» > 0. Hence,
â„“(X) â‰¤â„“(1 + Î»Y) = â„“(1) + Î»â„“(Y)
for all Î» > 0,
which could not be true if â„“(Y) < 0.
Our next claim is that â„“(1) > 0. Since â„“does not vanish identically, there must
be some Y such that 0 < â„“(Y) = â„“(Y +) âˆ’â„“(Y âˆ’). We may assume without loss of
generality that âˆ¥Yâˆ¥< 1. Positivity of â„“implies â„“(Y +) > 0 and â„“(1 âˆ’Y +) â‰¥0.
Hence â„“(1) = â„“(1 âˆ’Y +) + â„“(Y +) > 0.

4.2 Robust representation of convex risk measures
163
By the two preceding steps and Theorem A.50, we conclude that there exists some
QX âˆˆM1,f such that
EQX[ Y ] = â„“(Y)
â„“(1)
for all Y âˆˆX.
Note that B âŠ‚AÏ, and so
Î±min(QX) = sup
YâˆˆAÏ
EQX[ âˆ’Y ] â‰¥sup
YâˆˆB
EQX[ âˆ’Y ] = âˆ’b
â„“(1).
On the other hand, Y + Îµ âˆˆB for any Y âˆˆAÏ and each Îµ > 0. This shows that
Î±min(QX) is in fact equal to âˆ’b/â„“(1). It follows that
EQX[ âˆ’X ] âˆ’Î±min(QX) =
1
â„“(1)

b âˆ’â„“(X)

â‰¥0 = Ï(X).
Thus, QX is as desired, and the proof of the representation (4.15) is complete.
Finally, let Î± be any penalty function for Ï. Then, for all Q âˆˆM1,f and X âˆˆX
Ï(X) â‰¥EQ[ âˆ’X ] âˆ’Î±(Q),
and hence
Î±(Q) â‰¥sup
XâˆˆX

EQ[ âˆ’X ] âˆ’Ï(X)

â‰¥sup
XâˆˆAÏ

EQ[ âˆ’X ] âˆ’Ï(X)

(4.16)
â‰¥Î±min(Q).
Thus, Î± dominates Î±min.
Remark 4.16.
(a) If we take Î± = Î±min in (4.16), then all inequalities in (4.16) must
be identities. Thus, we obtain an alternative formula for the minimal penalty
function Î±min:
Î±min(Q) = sup
XâˆˆX

EQ[ âˆ’X ] âˆ’Ï(X)

.
(4.17)
(b) Note that Î±min is convex and lower semicontinuous for the total variation dis-
tance on M1,f as deï¬ned in Deï¬nition A.49, since it is the supremum of afï¬ne
continuous functions on M1,f .
(c) Suppose Ï is deï¬ned via Ï := ÏA for a given acceptance set A âŠ‚X. Then A
determines Î±min:
Î±min(Q) = sup
XâˆˆA
EQ[ âˆ’X ]
for all Q âˆˆM1,f .
This follows from the fact that X âˆˆA implies Îµ + X âˆˆAÏ for all Îµ > 0.
â™¦

164
4 Monetary measures of risk
Remark 4.17. Equation (4.17) shows that the penalty function Î±min corresponds to
the Fenchelâ€“Legendre transform, or conjugate function, of the convex function Ï on
the Banach space X. More precisely,
Î±min(Q) = Ïâˆ—(â„“Q),
(4.18)
where Ïâˆ—: Xâ€² â†’R âˆª{+âˆ} is deï¬ned on the dual Xâ€² of X by
Ïâˆ—(â„“) = sup
XâˆˆX

â„“(X) âˆ’Ï(X)

,
and where â„“Q âˆˆXâ€² is given by â„“Q(X) = EQ[ âˆ’X ] for Q âˆˆM1,f . This suggests
an alternative proof of Theorem 4.15. First note that, by Theorem A.50, Xâ€² can
be identiï¬ed with the space ba := ba(, F ) of ï¬nitely additive set functions with
ï¬nite total variation. Moreover, Ï is lower semicontinuous with respect to the weak
topology Ïƒ(X, Xâ€²), since any set {Ï â‰¤c} is convex, strongly closed due to Lemma 4.3,
and hence weakly closed by Theorem A.59. Thus, the general duality theorem for
conjugate functions as stated in Theorem A.61 yields
Ïâˆ—âˆ—= Ï,
where Ïâˆ—âˆ—denotes the conjugate function of Ïâˆ—, i.e.,
Ï(X) = sup
â„“âˆˆba

â„“(X) âˆ’Ïâˆ—(â„“)

.
(4.19)
In a second step, using the arguments in the second part of the proof of Theorem
4.15, we can now check that monotonicity and cash invariance of Ï imply that â„“â‰¤0
and â„“(1) = âˆ’1 for any â„“âˆˆXâ€² = ba such that Ïâˆ—(â„“) < âˆ. Identifying âˆ’â„“with
Q âˆˆM1,f and using equation (4.18), we see that (4.19) reduces to the representation
Ï(X) =
sup
QâˆˆM1,f

EQ[ âˆ’X ] âˆ’Î±min(Q)

.
Moreover, the supremum is actually attained: M1,f is weakâˆ—compact in Xâ€² = ba
due to the Banachâ€“Alaoglu theorem stated in Theorem A.62, and so the upper semi-
continuous functional Q â†’EQ[ âˆ’X ] âˆ’Î±min(Q) attains its maximum on M1,f . â™¦
The representation
Ï(X) = sup
QâˆˆQ
EQ[ âˆ’X ],
X âˆˆX,
(4.20)
of a coherent measure of risk Ï via some set Q âŠ‚M1,f is a particular case of the
representation theorem for convex measures of risk, since it corresponds to the penalty
function
Î±(Q) =

0
if Q âˆˆQ
+âˆ
otherwise.
The following corollary shows that the minimal penalty function of a coherent measure
of risk is always of this type.

4.2 Robust representation of convex risk measures
165
Corollary 4.18. The minimal penalty function Î±min of a coherent measure of risk Ï
takes only the values 0 and +âˆ. In particular,
Ï(X) =
max
QâˆˆQmax
EQ[ âˆ’X ],
X âˆˆX,
for the convex set
Qmax := { Q âˆˆM1,f | Î±min(Q) = 0 },
and Qmax is the largest set for which a representation of the form (4.20) holds.
Proof. Recall from Proposition 4.6 that the acceptance set AÏ of a coherent measure
of risk is a cone. Thus, the minimal penalty function satisï¬es
Î±min(Q) = sup
XâˆˆAÏ
EQ[ âˆ’X ] =
sup
Î»XâˆˆAÏ
EQ[ âˆ’Î» X ] = Î» Î±min(Q)
for all Q âˆˆM1,f and Î» > 0. Hence, Î±min can take only the values 0 and +âˆ.
The penalty function Î± arising in the representation (4.14) is not unique, and it is
often convenient to represent a convex measure of risk by a penalty function that is not
the minimal one. For instance, the minimal penalty function may be ï¬nite for certain
ï¬nitely additive set functions while another Î± is concentrated only on probability
measures as in the case of Example 4.8. Another situation of this type occurs for risk
measures which are constructed as the supremum of a family of convex measures of
risk:
Proposition 4.19. Suppose that for every i in some index set I we are given a convex
measure of risk Ïi on X with associated penalty function Î±i. If supiâˆˆI Ïi(0) < âˆ
then
Ï(X) := sup
iâˆˆI
Ïi(X),
X âˆˆX,
is a convex measure of risk that can be represented with the penalty function
Î±(Q) := inf
iâˆˆI Î±i(Q),
Q âˆˆM1,f .
Proof. The condition Ï(0) = supiâˆˆI Ïi(0) < âˆimplies that Ï takes only ï¬nite values.
Moreover,
Ï(X) = sup
iâˆˆI
sup
QâˆˆM1,f

EQ[ âˆ’X ] âˆ’Î±i(Q)

=
sup
QâˆˆM1,f

EQ[ âˆ’X ] âˆ’inf
iâˆˆI Î±i(Q)

,
and the assertion follows.
In the sequel, we are particularly interested in those convex measures of risk
which admit a representation in terms of Ïƒ-additive probability measures. Such a risk

166
4 Monetary measures of risk
measure Ï can be represented by a penalty function Î± which is inï¬nite outside the set
M1 := M1(, F ):
Ï(X) = sup
QâˆˆM1

EQ[ âˆ’X ] âˆ’Î±(Q)

.
(4.21)
In this case, one can no longer expect that the supremum above is attained. This is
illustrated by Example 4.8 if X does not take on its inï¬mum.
A representation (4.21) in terms of probability measures is closely related to certain
continuity properties of Ï. We ï¬rst examine a necessary condition of â€œcontinuity from
aboveâ€.
Lemma 4.20. A convex measure of risk Ï which admits a representation (4.21) on
M1 is continuous from above in the sense that
Xn â†˜X
"â‡’
Ï(Xn) â†—Ï(X).
(4.22)
Moreover, continuity from above is equivalent to lower semicontinuity with respect to
bounded pointwise convergence: If (Xn) is a bounded sequence in X which converges
pointwise to X âˆˆX, then
Ï(X) â‰¤lim inf
nâ†‘âˆÏ(Xn).
(4.23)
Proof. First we show (4.23) under the assumption that Ï has a representation in terms
of probability measures. Dominated convergence implies that EQ[ Xn ] â†’EQ[ X ]
for each Q âˆˆM1. Hence,
Ï(X) = sup
QâˆˆM1

lim
nâ†‘âˆ
EQ[ âˆ’Xn ] âˆ’Î±(Q)

â‰¤lim inf
nâ†‘âˆ
sup
QâˆˆM1

EQ[ âˆ’Xn ] âˆ’Î±(Q)

= lim inf
nâ†‘âˆÏ(Xn).
In order to show the equivalence of (4.23) and (4.22), let us ï¬rst assume (4.23). By
monotonicity, Ï(Xn) â‰¤Ï(X) for each n if Xn â†˜X, and so Ï(Xn) â†—Ï(X) follows.
Now we assume continuity from above. Let (Xn) be a bounded sequence in X
which converges pointwise to X. Deï¬ne Ym := supnâ‰¥m Xn âˆˆX. Then Ym decreases
P-a.s. to X. Since Ï(Xn) â‰¥Ï(Yn) by monotonicity, condition (4.22) yields that
lim inf
nâ†‘âˆÏ(Xn) â‰¥lim
nâ†‘âˆÏ(Yn) = Ï(X).
The following proposition gives a strong sufï¬cient condition which guarantees
that any penalty function for Ï is concentrated on the set M1 of probability measures.
This condition is â€œcontinuity from belowâ€ rather than from above; we will see a class
of examples in Section 4.9.

4.2 Robust representation of convex risk measures
167
Proposition 4.21. Let Ï be a convex measure of risk which is continuous from below
in the sense that
Xn â†—X
"â‡’
Ï(Xn) â†˜Ï(X),
and suppose that Î± is any penalty function on M1,f representing Ï. Then Î± is con-
centrated on the class M1 of probability measures, i.e.,
Î±(Q) < âˆ
"â‡’
Q is Ïƒ-additive.
Proof. Recall that Q is Ïƒ-additive if and only if Q[ An ] â†—1 for any increasing
sequence of events An âˆˆF such that 
n An = . Thus, the assertion is implied by
Lemma 4.22 below if we take Xn := IAn.
Lemma 4.22. Let Ï be a convex measure of risk on X which is represented by the
penalty function Î± on M1,f , and consider the level sets
c := { Q âˆˆM1,f | Î±(Q) â‰¤c },
for c > âˆ’Ï(0) =
inf
QâˆˆM1,f
Î±(Q).
For any sequence (Xn) in X such that 0 â‰¤Xn â‰¤1, the following two conditions are
equivalent:
(a) Ï(Î»Xn) âˆ’â†’Ï(Î») for each Î» â‰¥1.
(b)
inf
Qâˆˆc
EQ[ Xn ] âˆ’â†’1 for all c > âˆ’Ï(0).
Proof. (a) â‡’(b): In a ï¬rst step, we show that for all Y âˆˆX
inf
Qâˆˆc
EQ[ Y ] â‰¥âˆ’c + Ï(Î»Y)
Î»
for all Î» > 0.
(4.24)
Indeed, since Î± represents Ï, we have for Q âˆˆc
c â‰¥Î±(Q) â‰¥EQ[ âˆ’Î»Y ] âˆ’Ï(Î»Y),
and dividing by âˆ’Î» yields (4.24).
Now consider a sequence (Xn) which satisï¬es (a). Then (4.24) shows that for all
Î» â‰¥1
lim inf
nâ†‘âˆ
inf
Qâˆˆc
EQ[ Xn ] â‰¥âˆ’lim
nâ†‘âˆ
c + Ï(Î»Xn)
Î»
= 1 âˆ’c + Ï(0)
Î»
.
Taking Î» â†‘âˆand assuming Xn â‰¤1 proves (b).
(b) â‡’(a): Clearly, for all n
Ï(Î») â‰¤Ï(Î»Xn) =
sup
QâˆˆM1,f

EQ[ âˆ’Î»Xn ] âˆ’Î±(Q)

.

168
4 Monetary measures of risk
Since EQ[ âˆ’Î»Xn ] â‰¤0 for all Q, only those Q can contribute to the supremum on the
right-hand side for which
Î±(Q) â‰¤1 âˆ’Ï(Î») = 1 + Î» âˆ’Ï(0) =: c.
Hence, for all n
Ï(Î»Xn) = sup
Qâˆˆc

EQ[ âˆ’Î»Xn ] âˆ’Î±(Q)

.
But condition (b) implies that EQ[ âˆ’Î»Xn ] converges to âˆ’Î» uniformly in Q âˆˆc,
and so (a) follows.
Remark 4.23. Let Ï be a convex measure of risk which is continuous from below.
Then Ï is also continuous from above, as can be seen by combining Proposition 4.21
and Lemma 4.20. Thus, a straightforward argument yields that Ï(Xn) âˆ’â†’Ï(X)
whenever (Xn) is a bounded sequence in X which converges pointwise to X.
â™¦
Example 4.24. Let us consider a utility function u on R, a probability measure
Q âˆˆM1(, F ), and ï¬x some threshold c âˆˆR. As in Example 4.10, we suppose
that a position X is acceptable if its expected utility EQ[ u(X) ] is bounded from below
by u(c).
Alternatively, we can introduce the convex increasing loss function
â„“(x) = âˆ’u(âˆ’x) and deï¬ne the convex set of acceptable positions
A := { X âˆˆX | EQ[ â„“(âˆ’X) ] â‰¤x0 },
where x0 := âˆ’u(c). Let Ï := ÏA denote the convex measure of risk induced by A.
In Section 4.9, we will show that Ï is continuous from below, and we will derive a
formula for its minimal penalty function.
â™¦
Let us now continue the discussion in a topological setting. More precisely, we
will assume for the rest of this section that  is a separable metric space and that F is
the Ïƒ-ï¬eld of Borel sets. As before, X is the linear space of all bounded measurable
functions on (, F ). We denote by Cb() the subspace of bounded continuous
functions on , and we focus on the representation of convex risk measures viewed
as functionals on Cb().
Proposition 4.25. Let Ï be a convex measure of risk on X such that
Ï(Xn) â†˜Ï(Î») for any sequence (Xn) in Cb() that increases to a constant Î» > 0.
(4.25)
Then there exists a penalty function Î± on M1 such that
Ï(X) = max
QâˆˆM1

EQ[ âˆ’X ] âˆ’Î±(Q)

for X âˆˆCb().
(4.26)
In fact, one can take
Î±(Q) := inf

Î±min(
Q) | E
Q[ Â· ] = EQ[ Â· ] on Cb()

.
(4.27)

4.2 Robust representation of convex risk measures
169
Proof. Let Î±min be the minimal penalty function of Ï on M1,f . We show that for
any 
Q with Î±min(
Q) < âˆthere exists Q âˆˆM1 such that E
Q[ X ] = EQ[ X ] for all
X âˆˆCb(). Take a sequence (Yn) in Cb() which increases to some Y âˆˆCb(),
and choose Î´ > 0 such that Xn := 1 + Î´(Yn âˆ’Y) â‰¥0 for all n. Clearly, (Xn) satisï¬es
condition (a) of Lemma 4.22, and so E
Q[ Xn ] â†’1, i.e.,
E
Q[ Yn ] â†—E
Q[ Y ].
This continuity property of the linear functional E
Q[ Â· ] on Cb() implies, via the
Daniellâ€“Stone representation theorem as stated in Appendix A.6, that it coincides on
Cb() with the integral with respect to a Ïƒ-additive measure Q. Taking Î± as in (4.27)
gives the result.
Remark 4.26. If  is compact then any convex risk measure admits a representation
(4.26) on the space Cb() = C(). In order to see that condition (4.25) is veriï¬ed,
recall Diniâ€™s lemma: On a compact set, a sequence of continuous functions Xn in-
creasing to a continuous function X converges even uniformly. Indeed, the compact
sets Kn := {Xn â‰¥X âˆ’Îµ} satisfy 
n Kn = âˆ…, hence Kn0 = âˆ…for some n0. Since Ï
is Lipschitz continuous on C() by Lemma 4.3, it satisï¬es condition (4.25).
Alternatively, we could argue as in Remark 4.17 and apply the general duality
theorem for the Fenchelâ€“Legendre transform to the convex functional Ï on the Banach
space C(). Just note that any continuous functional â„“on C() which is positive and
normalized is of the form â„“(X) = EQ[ X ] for some probability measure Q âˆˆM1;
see Theorem A.47.
â™¦
Deï¬nition 4.27. A convex risk measure Ï on X is called tight if there exists an
increasing sequence K1 âŠ‚K2 âŠ‚Â· Â· Â· of compact subsets of  such that
Ï(Î»IKn) âˆ’â†’Ï(Î»)
for all Î» â‰¥1.
Note that every convex measure of risk is tight if  is compact.
Proposition 4.28. Suppose that the convex risk measure Ï on X is tight. Then (4.25)
holds and the conclusion of Proposition 4.25 is valid. Moreover, if  is a Polish space
and Î± is a penalty function on M1 such that
Ï(X) = sup
QâˆˆM1

EQ[ âˆ’X ] âˆ’Î±(Q)

for X âˆˆCb(),
then the level sets c = { Q âˆˆM1 | Î±(Q) â‰¤c } are relatively compact for the weak
topology on M1.
Proof. First we show (4.25). Suppose Xn âˆˆCb() are such that Xn â†—Î» > 0.We may
assume without loss of generality that Ï is normalized. Convexity and normalization
guarantee that condition (4.25) holds for all Î» > 0 as soon as it holds for all Î» â‰¥c
where c is an arbitrary constant larger than 1. Hence, the cash invariance of Ï implies

170
4 Monetary measures of risk
that there is no loss of generality in assuming Xn â‰¥0 for all n. We must show that
Ï(Xn) â‰¤Ï(Î») + 2Îµ eventually, where we take Îµ âˆˆ(0, Î» âˆ’1).
By assumption, there exists a compact set KN such that
Ï

(Î» âˆ’Îµ)IKN

â‰¤Ï(Î» âˆ’Îµ) + Îµ = Ï(Î») + 2Îµ.
By Diniâ€™s lemma as recalled in Remark 4.26, there exists some n0 âˆˆN such that
Î» âˆ’Îµ â‰¤Xn on KN for all n â‰¥n0. Finally, monotonicity implies
Ï(Xn) â‰¤Ï

(Î» âˆ’Îµ)IKN

â‰¤Ï(Î») + 2Îµ.
To prove the relative compactness of c, we will show that for any Îµ > 0 there
exists a compact set KÎµ âŠ‚ such that for all c > âˆ’Ï(0)
inf
Qâˆˆc
Q[ KÎµ ] â‰¥1 âˆ’Îµ(c + Ï(0) + 1).
The relative compactness of c will then be an immediate consequence of Prohorovâ€™s
characterization of weakly compact sets in M1, as stated in Theorem A.41. We ï¬x a
countable dense set {Ï‰1, Ï‰2, . . . } âŠ‚ and a complete metric Î´ which generates the
topology of . For r > 0 we deï¬ne continuous functions r
i on  by
r
i (Ï‰) := 1 âˆ’Î´(Ï‰, Ï‰i) âˆ§r
r
.
The function r
i is dominated by the indicator function of the closed metric ball
Br(Ï‰i) := { Ï‰ âˆˆ | Î´(Ï‰, Ï‰i) â‰¤r }.
Let
Xr
n(Ï‰) := max
iâ‰¤n r
i (Ï‰).
Clearly, Xr
n is continuous and satisï¬es 0 â‰¤Xr
n â‰¤1 as well as Xr
n â†—1 for n â†‘âˆ.
According to (4.24), we have for all Î» > 0
inf
Qâˆˆc
Q
 
n

i=1
Br(Ï‰i)
!
â‰¥inf
Qâˆˆc
EQ[ Xr
n ] â‰¥âˆ’c + Ï(Î»Xr
n)
Î»
.
Now we take Î»k := 2k/Îµ and rk := 1/k. The ï¬rst part of this proof and (4.25) yield
the existence of nk âˆˆN such that
Ï

Î»kXrknk

â‰¤Ï(Î»k) + 1 = âˆ’Î»k + 1,
and thus
sup
Qâˆˆc
Q
 nk

i=1
\Brk(Ï‰i)
!
â‰¤c + 1
Î»k
= Îµ2âˆ’k(c + 1).

4.3 Convex risk measures on Lâˆ
171
We let
KÎµ :=
âˆ

k=1
nk

i=1
Brk(Ï‰i).
Then, for each Q âˆˆc
Q[ KÎµ ] = 1 âˆ’Q
 
âˆ

k=1
nk

i=1
\Brk(Ï‰i)
!
â‰¥1 âˆ’
âˆ

k=1
Îµ2âˆ’k(c + 1)
= 1 âˆ’Îµ(c + 1).
The reader may notice that KÎµ is closed, totally bounded and, hence, compact. A short
proof of this fact goes as follows: Let (xj) be a sequence in KÎµ. We must show that
(xj) has a convergent subsequence. Since KÎµ is covered by Brk(Ï‰1), . . . , Brk(Ï‰nk)
for each k, there exists some ik â‰¤nk such that inï¬nitely many xj are contained in
Brk(Ï‰ik). A diagonalization argument yields a single subsequence (xjâ€²) which for
each k is contained in some Brk(Ï‰ik). Thus, (xjâ€²) is a Cauchy sequence with respect
to the complete metric Î´ and, hence, converging to some element Ï‰ âˆˆ.
Remark 4.29. Note that the representation (4.26) does not necessarily extend from
Cb() to the space X of all bounded measurable functions. Suppose in fact that 
is compact but not ï¬nite, so that condition (4.25) holds as explained in Remark 4.26.
There is a ï¬nitely additive Q0 âˆˆM1,f which does not belong to M1; see Exam-
pleA.52. The proof of Proposition 4.25 shows that there is some 
Q âˆˆM1 such that the
coherent risk measure Ï deï¬ned by Ï(X) := EQ0[ âˆ’X ] coincides with E
Q[ âˆ’X ] for
X âˆˆCb(). But Ï does not admit a representation of the form
Ï(X) = sup
QâˆˆM1

EQ[ âˆ’X ] âˆ’Î±(Q)

for all X âˆˆX.
In fact, this would imply
Î±(Q) â‰¥EQ0[ X ] âˆ’EQ[ X ]
for Q âˆˆM1 and any X âˆˆX, hence Î±(Q) = âˆfor any Q âˆˆM1.
â™¦
4.3 Convex risk measures on Lâˆ
For the rest of this chapter, we ï¬x a probability measure P on (, F ) and consider
risk measures Ï such that
Ï(X) = Ï(Y)
if X = Y P -a.s.
(4.28)
Note that only the nullsets of P will matter in this section.

172
4 Monetary measures of risk
Lemma 4.30. Let Ï be a convex measure of risk that satisï¬es (4.28) and which
is represented by a penalty function Î± as in (4.14). Then Î±(Q) = +âˆfor any
Q âˆˆM1,f (, F ) which is not absolutely continuous with respect to P .
Proof. If Q âˆˆM1,f (, F ) is not absolutely continuous with respect to P , then there
exists A âˆˆF such that Q[ A ] > 0 but P [ A ] = 0. Take any X âˆˆAÏ, and deï¬ne
Xn := X âˆ’n IA. Then Ï(Xn) = Ï(X), i.e., Xn is again contained in AÏ. Hence,
Î±(Q) â‰¥Î±min(Q) â‰¥EQ[ âˆ’Xn ] = EQ[ âˆ’X ] + n Q[ A ] âˆ’â†’âˆ
as n â†‘âˆ.
In view of (4.28), we can identify X with the Banach space Lâˆ:= Lâˆ(, F , P ).
Let us denote by
M1(P ) := M1(, F , P )
the set of all probability measures on (, F ) which are absolutely continuous with
respect to P. The following theorem characterizes those convex risk measures on Lâˆ
that can be represented by a penalty function concentrated on probability measures,
and hence on M1(P ), due to Lemma 4.30.
Theorem 4.31. Suppose Ï : Lâˆâ†’R is a convex measure of risk. Then the following
conditions are equivalent.
(a) Ï can be represented by some penalty function on M1(P ).
(b) Ï can be represented by the restriction of the minimal penalty function Î±min to
M1(P ):
Ï(X) =
sup
QâˆˆM1(P )

EQ[ âˆ’X ] âˆ’Î±min(Q)

,
X âˆˆLâˆ.
(4.29)
(c) Ï is continuous from above: If Xn â†˜X P -a.s. then Ï(Xn) â†—Ï(X).
(d) Ï has the â€œFatou propertyâ€: For any bounded sequence (Xn) which converges
P-a.s. to some X,
Ï(X) â‰¤lim inf
nâ†‘âˆÏ(Xn).
(e) Ï is lower semicontinuous for the weakâˆ—topology Ïƒ(Lâˆ, L1).
(f) The acceptance set AÏ of Ï is weakâˆ—closed in Lâˆ, i.e., AÏ is closed with
respect to the topology Ïƒ(Lâˆ, L1).
Proof. (f) â‡’(b): We ï¬x some X âˆˆX and let
m =
sup
QâˆˆM1(P )

EQ[ âˆ’X ] âˆ’Î±min(Q)

.
(4.30)

4.3 Convex risk measures on Lâˆ
173
In view of Theorem 4.15, we need to show that m â‰¥Ï(X) or, equivalently, that
m + X âˆˆAÏ. Suppose by way of contradiction that m + X /âˆˆAÏ. Since the non-
empty convex set AÏ is weakâˆ—closed by assumption, we may apply Theorem A.56 in
the locally convex space (Lâˆ, Ïƒ(Lâˆ, L1)) with C := AÏ and B := {m + X}. We
obtain a continuous linear functional â„“on (Lâˆ, Ïƒ(Lâˆ, L1)) such that
Î² := inf
YâˆˆAÏ
â„“(Y) > â„“(m + X) =: Î³ > âˆ’âˆ.
(4.31)
By PropositionA.58, â„“is of the form â„“(Y) = E[ YZ ] for some Z âˆˆL1. In fact, Z â‰¥0.
To show this, ï¬x Y â‰¥0 and note that Ï(Î»Y) â‰¤Ï(0) for Î» â‰¥0, by monotonicity.
Hence Î»Y + Ï(0) âˆˆAÏ for all Î» â‰¥0. It follows that
âˆ’âˆ< Î³ < â„“

Î»Y + Ï(0)

= Î»â„“(Y) + â„“

Ï(0)

.
Taking Î» â†‘âˆyields that â„“(Y) â‰¥0 and in turn that Z â‰¥0. Moreover, P [ Z > 0 ] > 0
since â„“is non-zero. Thus,
dQ0
dP :=
Z
E[ Z ]
deï¬nes a probability measure Q0 âˆˆM1(P ). By (4.31), we see that
Î±min(Q0) = sup
YâˆˆAÏ
EQ0[ âˆ’Y ] = âˆ’
Î²
E[ Z ].
However,
EQ0[ X ] + m = â„“(m + X)
E[ Z ]
=
Î³
E[ Z ] <
Î²
E[ Z ] = âˆ’Î±min(Q0),
in contradiction to (4.30). Hence, m+X must be contained in AÏ, and thus m â‰¥Ï(X).
(b) â‡’(a) is obvious, and (a) â‡’(c)â‡”(d) follows as in Lemma 4.20, replacing point-
wise convergence by P -a.s. convergence.
(c) â‡’(e): We have to show that C := {Ï â‰¤c} is weakâˆ—closed for c âˆˆR. To
this end, let Cr := C âˆ©{ X âˆˆLâˆ| âˆ¥Xâˆ¥âˆâ‰¤r } for r > 0. If (Xn) is a sequence
in Cr converging in L1 to some random variable X, then there is a subsequence that
converges P-a.s., and the Fatou property of Ï implies that X âˆˆCr. Hence, Cr is
closed in L1, and Lemma A.64 implies that C := {Ï â‰¤c} is weakâˆ—closed.
(e) â‡’(f) is obvious.
Deï¬nition 4.32. A convex measure of risk Ï on Lâˆis called sensitive with respect
to P if
Ï(âˆ’X) > Ï(0)
for all X âˆˆLâˆ
+ such that P [ X > 0 ] > 0.

174
4 Monetary measures of risk
Sensitivity is also called relevance.
The theorem shows that any convex measure of risk of Lâˆthat is continuous
from above arises in the following manner. We consider any probabilistic model
Q âˆˆM1(P ), but these models are taken more or less seriously as described by the
penalty function. Thus, the value Ï(X) is computed as the worst case, over all models
Q âˆˆM1(P ), of the expected loss EQ[ âˆ’X ], but reduced by Î±(Q). In the following
example, the given model P is the one which is taken most seriously, and the penalty
function Î±(Q) is proportional to the deviation of Q from P , measured by the relative
entropy.
Example 4.33. Consider the penalty function Î± : M1(P ) â†’(0, âˆ] deï¬ned by
Î±(Q) := 1
Î² H(Q|P ),
where Î² > 0 is a given constant and
H(Q|P ) = EQ
 
log dQ
dP
!
is the relative entropy of Q âˆˆM1(P ) with respect to P ; see Deï¬nition 3.20. The
corresponding entropic risk measure Ï is given by
Ï(X) =
sup
QâˆˆM1(P )
	
EQ[ âˆ’X ] âˆ’1
Î² H(Q|P )

.
The variational principle for the relative entropy as stated in Lemma 3.29 shows that
EQ[ âˆ’X ] âˆ’1
Î² H(Q|P ) â‰¤1
Î² log E[ eâˆ’Î²X ],
and the upper bound is attained by the measure with the density eâˆ’Î²X/E[ eâˆ’Î²X ].
Thus, the entropic risk measure takes the form
Ï(X) = 1
Î² log E[ eâˆ’Î²X ].
In particular, Ï is sensitive with respect to P . Note that Î± is in fact the minimal penalty
function representing Ï, since Lemma 3.29 implies
Î±min(Q) = sup
XâˆˆLâˆ
	
EQ[ âˆ’X ] âˆ’1
Î² log E[ eâˆ’Î²X ]

= 1
Î² H(Q|P ).
A ï¬nancial interpretation of the entropic risk measure in terms of shortfall risk will be
discussed in Example 4.105.
â™¦
Theorem 4.31 takes the following form for coherent measures of risk; the proof is
the same as the one for Corollary 4.18.

4.3 Convex risk measures on Lâˆ
175
Corollary 4.34. A coherent measure of risk on Lâˆcan be represented by a set Q âŠ‚
M1(P ) if and only if the equivalent conditions of Theorem 4.31 are satisï¬ed. In this
case, the maximal representing subset of M1(P ) is given by
Qmax := { Q âˆˆM1(P ) | Î±min(Q) = 0 }.
Moreover, Ï is sensitive if and only if Qmax â‰ˆP in the sense that for any A âˆˆF
P [ A ] = 0
â‡â‡’
Q[ A ] = 0
for all Q âˆˆQmax.
Let us also state a characterization of those coherent measures of risk on Lâˆwhich
are continuous from below.
Corollary 4.35. For a coherent measure of risk Ï on Lâˆthe following properties are
equivalent:
(a) Ï is continuous from below: Xn â†—X "â‡’Ï(Xn) â†˜Ï(X).
(b) There exists a set Q âŠ‚M1(P ) representing Ï such that the supremum is at-
tained:
Ï(X) = max
QâˆˆQ EQ[ âˆ’X ]
for all X âˆˆX.
(c) There exists a set Q âŠ‚M1(P ) representing Ï such that the set of densities
D :=
 dQ
dP
 Q âˆˆQ

is weakly compact in L1(, F , P).
Proof. (c) â‡’(a): This follows from Diniâ€™s lemma; see Remark 4.26.
(a) â‡’(b) follows from Corollary 4.18 and Proposition 4.21.
(b) â‡’(c): Without loss of generality, we can assume that D is weakly closed in
L1. For any X âˆˆLâˆ, the continuous linear functional JX on L1 deï¬ned by
JX(Z) := E[ XZ ]
attains its inï¬mum on D. According to Jamesâ€™ theorem as stated in Appendix A.7,
this implies weak compactness of D.
We now give examples of coherent measures of risk which will be studied in more
detail in Section 4.4.
Example 4.36. In our present context, where we require condition (4.28), the worst-
case risk measure takes the form
Ïmax(X) := âˆ’ess inf X = inf

m âˆˆR | X + m â‰¥0 P -a.s.

.

176
4 Monetary measures of risk
One can easily check that Ïmax is coherent and satisï¬es the Fatou property. Moreover,
the acceptance set of Ïmax is equal to the positive cone Lâˆ
+ in Lâˆ, and this implies
Î±min(Q) = 0 for any Q âˆˆM1(P ). Thus,
Ïmax(X) =
sup
QâˆˆM1(P )
EQ[ âˆ’X ].
Note however that the supremum on the right cannot be replaced by a maximum in
case (, F , P) cannot be reduced to a ï¬nite model. Indeed, let X âˆˆLâˆbe such that
X does not attain its essential inï¬mum. Then there can be no Q âˆˆM1(P ) such that
EQ[ X ] = ess inf X = âˆ’Ïmax(X). In this case, the preceding corollary shows that
Ïmax is not continuous from below.
â™¦
Example 4.37. Let QÎ» be the class of all Q âˆˆM1(P ) whose density dQ/dP is
bounded by 1/Î» for some ï¬xed parameter Î» âˆˆ(0, 1). The corresponding coherent
risk measure
AV@RÎ»(X) := sup
QâˆˆQÎ»
EQ[ âˆ’X ]
(4.32)
will be called the Average Value at Risk at level Î». This terminology will become
clear in Section 4.4, which contains a detailed study of AV@RÎ». Note that the set of
densities dQ/dP for Q âˆˆQÎ» is weakly closed in L1. Moreover, it is weakly compact
due to the Dunfordâ€“Pettis theorem; see Theorem A.67. Thus, the supremum in (4.32)
is actually attained. An explicit construction of the maximizing measure will be given
in the proof of Theorem 4.47.
â™¦
Example 4.38. We take for Q the class of all conditional distributions P [ Â· | A ] such
that A âˆˆF has P [ A ] > Î» for some ï¬xed level Î» âˆˆ(0, 1). The coherent measure of
risk induced by Q,
WCEÎ»(X) := sup{ E[ âˆ’X | A ] | A âˆˆF , P [ A ] > Î» },
(4.33)
is called the worst conditional expectation at level Î». We will show in Section 4.4
that it coincides with the Average Value at Risk of Example 4.37 if the underlying
probability space is rich enough.
â™¦
Remark 4.39. In analogy to Remark 4.17, the implication (e) â‡’(a) in the Repre-
sentation Theorem 4.31 can be viewed as a special case of the general duality in
Theorem A.61 for the Fenchelâ€“Legendre transform of the convex function Ï on Lâˆ,
combined with the properties of a monetary risk measure. From this general point of
view, it is now clear how to state representation theorems for convex risk measures on
the Banach spaces Lp(, F , P) for 1 â‰¤p < âˆ. More precisely, let q âˆˆ(1, âˆ] be
such that 1
p + 1
q = 1, and deï¬ne
Mq
1(P ) :=
$
Q âˆˆM1(P )
 dQ
dP âˆˆLq %
.

4.4 Value at Risk
177
A convex risk measure Ï on Lp is of the form
Ï(X) =
sup
QâˆˆMq
1 (P )

EQ[ âˆ’X ] âˆ’Î±(Q)

if and only if it is lower semicontinuous on Lp, i.e., the Fatou property holds in the
form
Xn âˆ’â†’X in Lp
"â‡’
Ï(X) â‰¤lim inf
nâ†‘âˆÏ(Xn).
â™¦
4.4 Value at Risk
A common approach to the problem of measuring the risk of a ï¬nancial position X
consists in specifying a quantile of the distribution of X under the given probability
measure P. For Î» âˆˆ(0, 1), a Î»-quantile of a random variable X on (, F , P ) is any
real number q with the property
P [ X â‰¤q ] â‰¥Î»
and
P [ X < q ] â‰¤Î»,
and the set of all Î»-quantiles of X is an interval [qâˆ’
X(Î»), q+
X(Î»)], where
qâˆ’
X(t) = sup{ x | P [ X < x ] < t } = inf{ x | P [ X â‰¤x ] â‰¥t }
is the lower and
q+
X(t) = inf{ x | P [ X â‰¤x ] > t } = sup{ x | P [ X < x ] â‰¤t }
is the upper quantile function of X; see Appendix A.3. In this section, we will focus
on the properties of q+
X(Î»), viewed as a functional on a space of ï¬nancial positions X.
Deï¬nition 4.40. Fix some level Î» âˆˆ(0, 1). For a ï¬nancial position X, we deï¬ne its
Value at Risk at level Î» as
V@RÎ»(X) := âˆ’q+
X(Î») = qâˆ’
âˆ’X(1 âˆ’Î») = inf{ m | P [ X + m < 0 ] â‰¤Î» }.
(4.34)
In ï¬nancial terms, V@RÎ»(X) is the smallest amount of capital which, if added to
X and invested in the risk-free asset, keeps the probability of a negative outcome below
the level Î». However, Value at Risk only controls the probability of a loss; it does not
capture the size of such a loss if it occurs. Clearly, V@RÎ» is a monetary measure of
risk on X = L0, which is positively homogeneous. The following example shows
that the acceptance set of V@RÎ» is typically not convex, and so V@RÎ» is not a convex
measure of risk. Thus, V@RÎ» may penalize diversiï¬cation instead of encouraging it.

178
4 Monetary measures of risk
Example 4.41. Consider an investment into two defaultable corporate bonds, each
with returnr > r, where r â‰¥0 is the return on a riskless investment. The discounted
net gain of an investment w > 0 in the ith bond is given by
Xi =
ï£±
ï£´ï£²
ï£´ï£³
âˆ’w
in case of default,
w(r âˆ’r)
1 + r
otherwise.
If a default of the ï¬rst bond occurs with probability p â‰¤Î», then
P
 
X1 âˆ’w(r âˆ’r)
1 + r
< 0
!
= P [ 1
st bond defaults ] = p â‰¤Î».
Hence,
V@RÎ»(X1) = âˆ’w(r âˆ’r)
1 + r
< 0.
This means that the position X1 is acceptable in the sense that is does not carry a
positive Value at Risk, regardless of the possible loss of the entire investment w.
Diversifying the portfolio by investing the amount w/2 into each of the two bonds
leads to the position Y := (X1 + X2)/2. Let us assume that the two bonds default
independently of each other, each of them with probability p. For realistic r, the
probability that Y is negative is equal to the probability that at least one of the two
bonds defaults: P [ Y < 0 ] = p(2 âˆ’p). If, for instance, p = 0.009 and Î» = 0.01
then we have p < Î» < p(2 âˆ’p), hence
V@RÎ»(Y) = w
2 Â·

1 âˆ’r âˆ’r
1 + r

.
Typically, this value is close to one half of the invested capital w. In particular, the
acceptance set of V@RÎ» is not convex. This example also shows that V@R may
strongly discourage diversiï¬cation: It penalizes quite drastically the increase of the
probability that something goes wrong, without rewarding the signiï¬cant reduction
of the expected loss conditional on the event of default. Thus, optimizing a portfolio
with respect to V@RÎ» may lead to a concentration of the portfolio in one single asset
with a sufï¬ciently small default probability, but with an exposure to large losses.
â™¦
In the remainder of this section, we will focus on monetary measures of risk which,
in contrast to V@RÎ», are convex or even coherent on X := Lâˆ. In particular, we are
looking for convex risk measures which come close to V@RÎ». A ï¬rst guess might
be that one should take the smallest convex measure of risk, continuous from above,
which dominates V@RÎ». However, since V@RÎ» itself is not convex, the following
proposition shows that such a smallest V@RÎ»-dominating convex measure of risk
does not exist.
Proposition 4.42. For each X âˆˆX and each Î» âˆˆ(0, 1),
V@RÎ»(X) = min

Ï(X) | Ï is convex, continuous from above, and â‰¥V@RÎ»

.

4.4 Value at Risk
179
Proof. Let q := âˆ’V@RÎ»(X) = q+
X(Î») so that P [ X < q ] â‰¤Î». If A âˆˆF satisï¬es
P[ A ] > Î», then P [ A âˆ©{X â‰¥q} ] > 0. Thus, we may deï¬ne a measure QA by
QA := P [ Â· | A âˆ©{X â‰¥q} ].
It follows that EQA[ âˆ’X ] â‰¤âˆ’q = V@RÎ»(X).
Let Q := { QA | P [ A ] > Î» }, and use this set to deï¬ne a coherent measure of
risk Ï via
Ï(Y) := sup
QâˆˆQ
EQ[ âˆ’Y ].
Then Ï(X) â‰¤V@RÎ»(X).
Hence, the assertion will follow if we can show that
Ï(Y) â‰¥V@RÎ»(Y) for each Y âˆˆX. Let Îµ > 0 and take A := { Y â‰¤âˆ’V@RÎ»(Y)+Îµ }.
Clearly P [ A ] > Î», and so QA âˆˆQ. Moreover, QA[ A ] = 1, and we obtain
Ï(Y) â‰¥EQA[ âˆ’Y ] â‰¥V@RÎ»(Y) âˆ’Îµ.
Since Îµ > 0 is arbitrary, the result follows.
For the rest of this section, we concentrate on the following risk measure which
is deï¬ned in terms of Value at Risk, but does satisfy the axioms of a coherent risk
measure.
Deï¬nition 4.43. The Average Value at Risk at level Î» âˆˆ(0, 1] of a position X âˆˆX is
given by
AV@RÎ»(X) = 1
Î»
 Î»
0
V@RÎ³ (X) dÎ³.
Sometimes, theAverageValue at Risk is also called the â€œConditionalValue at Riskâ€
or the â€œexpected shortfallâ€, and one writes CV@RÎ»(X) or ESÎ»(X). These terms are
motivated by formulas (4.37) and (4.35) below, but they are potentially misleading:
â€œConditional Value at Riskâ€ might also be used to denote the Value at Risk with
respect to a conditional distribution, and â€œexpected shortfallâ€ might be understood as
the expectation of the shortfall Xâˆ’. For these reasons, we prefer the term Average
Value at Risk. Note that
AV@RÎ»(X) = âˆ’1
Î»
 Î»
0
qX(t) dt
by (4.34).
In particular, the deï¬nition of AV@RÎ»(X) makes sense for any X âˆˆ
L1(, F , P) and we have, in view of Lemma A.19,
AV@R1(X) = âˆ’
 1
0
q+
X(t) dt = E[ âˆ’X ].
Remark 4.44. Theorem 2.58 shows that the partial order â‰½uni on probability measures
on R with ï¬nite mean can be characterized in terms of Average Value at Risk:
Âµ â‰½uni Î½ â‡â‡’AV@RÎ»(XÂµ) â‰¤AV@RÎ»(XÎ½)
for all Î» âˆˆ(0, 1],
where XÂµ and XÎ½ are random variables with distributions Âµ and Î½.
â™¦

180
4 Monetary measures of risk
Remark 4.45. For X âˆˆLâˆ, we have
lim
Î»â†“0 V@RÎ»(X) = âˆ’ess inf X = inf{ m | P [ X + m < 0 ] â‰¤0 }.
Hence, it makes sense to deï¬ne
AV@R0(X) := V@R0(X) := âˆ’ess inf X,
which is the worst-case risk measure on Lâˆintroduced in Example 4.36. Recall that
it is continuous from above but in general not from below.
â™¦
Lemma 4.46. For Î» âˆˆ(0, 1) and any Î»-quantile q of X,
AV@RÎ»(X) = 1
Î» E[ (q âˆ’X)+ ] âˆ’q = 1
Î» inf
râˆˆR

E[ (r âˆ’X)+ ] âˆ’Î»r

.
(4.35)
Proof. Let qX be a quantile function with qX(Î») = q. By Lemma A.19,
1
Î» E[ (qâˆ’X)+ ]âˆ’q = 1
Î»
 1
0
(qâˆ’qX(t))+ dt âˆ’q = âˆ’1
Î»
 Î»
0
qX(t) dt = AV@RÎ»(X).
This proves the ï¬rst identity. The second one follows from Lemma A.22.
Theorem 4.47. For Î» âˆˆ(0, 1], AV@RÎ» is a coherent measure of risk which is con-
tinuous from below. It has the representation
AV@RÎ»(X) = max
QâˆˆQÎ»
EQ[ âˆ’X ],
X âˆˆX,
(4.36)
where QÎ» is the set of all probability measures Q â‰ªP whose density dQ/dP is P -a.s.
bounded by 1/Î». Moreover, QÎ» is equal to the maximal set Qmax of Corollary 4.34.
Proof. Since Q1 = {P }, the assertion is obvious for Î» = 1. For 0 < Î» < 1, consider
the coherent risk measure ÏÎ»(X) := supQâˆˆQÎ» EQ[ âˆ’X ]. First we assume that we are
given some X < 0. We deï¬ne a measure 
P â‰ˆP by d 
P /dP = X/E[ X ]. Then
ÏÎ»(X) = E[ âˆ’X ]
Î»
sup
 
E[ Ï• ] | 0 â‰¤Ï• â‰¤1, E[ Ï• ] = Î»

.
Clearly, the condition E[ Ï• ] = Î» on the right can be replaced by E[ Ï• ] â‰¤Î». Thus,
we can apply the Neymanâ€“Pearson lemma in the form of Theorem A.30 and conclude
that the supremum is attained by
Ï•0 = I{X<q} + ÎºI{X=q}
for a Î»-quantile q of X and some Îº âˆˆ[0, 1] for which E[ Ï•0 ] = Î». Hence,
ÏÎ»(X) = E[ âˆ’X ]
Î»
Â· 
E[ Ï•0 ] = 1
Î»E[ âˆ’XÏ•0 ],

4.4 Value at Risk
181
Since dQ0 = Î»âˆ’1Ï•0 dP deï¬nes a probability measure in QÎ», we conclude that
ÏÎ»(X) = max
QâˆˆQÎ»
EQ[ âˆ’X ] = EQ0[ âˆ’X ]
= 1
Î»

E[ âˆ’X; X < q] âˆ’qÎ» + qP [ X < q ]

= 1
Î» E[ (q âˆ’X)+ ] âˆ’q
= AV@RÎ»(X),
where we have used (4.35) in the last step. This proves (4.36) for X < 0. For arbitrary
X âˆˆLâˆ, we use the cash invariance of both ÏÎ» and AV@RÎ».
It remains to prove that QÎ» is the maximal set of Corollary 4.34. To this end, we
show that
sup
XâˆˆX

EQ[ âˆ’X ] âˆ’AV@RÎ»(X)

= +âˆ
for Q /âˆˆQÎ». We denote by Ï• the density dQ/dP . There exist Î»â€² âˆˆ(0, Î») and
k > 1/Î»â€² such that P [ Ï• âˆ§k â‰¥1/Î»â€² ] > 0. For c > 0 deï¬ne X(c) âˆˆX by
X(c) := âˆ’c(Ï• âˆ§k)I{Ï•â‰¥1/Î»â€²}.
Since
P [ X(c) < 0 ] = P

Ï• â‰¥1
Î»â€²

â‰¤Î»â€² < Î»,
we have V@RÎ»(X(c)) = 0, and (4.35) yields that
AV@RÎ»(X(c)) = 1
Î»E[ âˆ’X(c) ] = c
Î»E

Ï• âˆ§k; Ï• â‰¥1
Î»â€²

.
On the other hand,
EQ[ âˆ’X(c) ] = c Â· E

Ï• Â· Ï• âˆ§k; Ï• â‰¥1
Î»â€²

â‰¥c
Î»â€² E

Ï• âˆ§k; Ï• â‰¥1
Î»â€²

.
Thus, the difference between EQ[ âˆ’X(c) ] and AV@RÎ»(X(c)) becomes arbitrarily
large as c â†‘âˆ.
Remark 4.48. The proof shows that for Î» âˆˆ(0, 1) the maximum in (4.36) is attained
by the measure Q0 âˆˆQÎ», whose density is given by
dQ0
dP = 1
Î»

I{X<q} + ÎºI{X=q}

,
where q is a Î»-quantile of X, and where Îº is deï¬ned as
Îº :=
ï£±
ï£´ï£²
ï£´ï£³
0
if P [ X = q ] = 0,
Î» âˆ’P [ X < q ]
P [ X = q ]
otherwise.
â™¦

182
4 Monetary measures of risk
Corollary 4.49. For all X âˆˆX,
AV@RÎ»(X) â‰¥WCEÎ»(X)
â‰¥E[ âˆ’X | âˆ’X â‰¥V@RÎ»(X) ]
(4.37)
â‰¥V@RÎ»(X),
where WCEÎ» is the coherent risk measure deï¬ned in (4.33). Moreover, the ï¬rst two
inequalities are in fact identities if
P

X â‰¤q+
Î» (X)

= Î»,
(4.38)
which is the case if X has a continuous distribution.
Proof. If P[ A ] â‰¥Î», then the density P [ Â· | A ] with respect to P is bounded by 1/Î».
Therefore, Theorem 4.47 implies that AV@RÎ» dominates WCEÎ». Since
P

âˆ’X â‰¥V@RÎ»(X) âˆ’Îµ

> Î»,
we have
WCEÎ»(X) â‰¥E

âˆ’X | âˆ’X â‰¥V@RÎ»(X) âˆ’Îµ

,
and the second inequality follows by taking the limit Îµ â†“0. Moreover, (4.35) shows
that
AV@RÎ»(X) = E

âˆ’X | âˆ’X â‰¥V@RÎ»(X)

as soon as (4.38) holds.
Remark 4.50. We will see in Corollary 4.62 that the two coherent risk measures
AV@RÎ» and WCEÎ» coincide if the underlying probability space is rich enough. If this
is not the case, then the ï¬rst inequality in (4.37) may be strict for some X; see [1].
Moreover, the functional
E[ âˆ’X | âˆ’X â‰¥V@RÎ»(X) ]
does not deï¬ne a convex measure of risk. Hence, the second inequality in (4.37)
cannot reduce to an identity in general.
â™¦
Remark 4.51. We have seen in Proposition 4.42 that there is no smallest convex risk
measure dominating V@RÎ». But if we restrict our attention to the class of convex
risk measures that dominate V@RÎ» and only depend on the distribution of a random
variable, then the situation is different. In fact, we will see in Theorem 4.61 that
AV@RÎ» is the smallest risk measure in this class, provided that the underlying prob-
ability space is rich enough. In this sense, Average Value at Risk can be regarded as
the best conservative approximation to Value at Risk.
â™¦

4.5 Law-invariant risk measures
183
4.5
Law-invariant risk measures
Clearly, V@RÎ» and AV@RÎ» only involve the distribution of a position under the given
probability measure P . In this section we study the class of all risk measures which
share this property of law-invariance.
Deï¬nition 4.52. A monetary measure of risk Ï on X = Lâˆ(, F , P ) is called
law-invariant if Ï(X) = Ï(Y) whenever X and Y have the same distribution under P .
Throughout this section, we assume that the probability space (, F , P ) is rich
enough in the sense that it supports a random variable with a continuous distribution.
This condition is satisï¬ed if and only if (, F , P ) is atomless; see Proposition A.27.
Remark 4.53. Any law-invariant monetary risk measure Ï is monotone with respect
to the partial order â‰½mon introduced in Deï¬nition 2.69. More precisely,
Âµ â‰½mon Î½
"â‡’
Ï(XÂµ) â‰¤Ï(XÎ½),
if XÂµ and XÎ½ are random variables with distributions Âµ and Î½. To prove this, let qÂµ
and qÎ½ be quantile functions for Âµ and Î½ and take a random variable U with a uniform
distribution on (0, 1). Then 
XÂµ := qÂµ(U) â‰¥qÎ½(U) =: 
XÎ½ by Theorem 2.70, and

XÂµ and 
XÎ½ have the same distribution as XÂµ and XÎ½ by Lemma A.19. Hence, law-
invariance and monotonicity of Ï imply Ï(XÂµ) = Ï(
XÂµ) â‰¤Ï(
XÎ½) = Ï(XÎ½).
â™¦
We can now formulate our ï¬rst structure theorem for law-invariant convex risk
measures.
Theorem 4.54. Let Ï be a convex measure of risk and suppose that Ï is continuous
from above. Then Ï is law-invariant if and only if its minimal penalty function Î±min(Q)
depends only on the law of Ï•Q := dQ
dP under P when Q âˆˆM1(P ). In this case, Ï has
the representation
Ï(X) =
sup
QâˆˆM1(P )
	  1
0
qâˆ’X(t)qÏ•Q(t) dt âˆ’Î±min(Q)

,
and the minimal penalty function satisï¬es
Î±min(Q) = sup
XâˆˆAÏ
 1
0
qâˆ’X(t)qÏ•Q(t) dt
= sup
XâˆˆLâˆ
	  1
0
qâˆ’X(t)qÏ•Q(t) âˆ’Ï(X)

.
(4.39)
For the proof, we will need the following lemma.
Lemma 4.55. For X âˆˆLâˆand Y âˆˆL1,
 1
0
qX(t)qY (t) dt = sup

Xâˆ¼X
E[ 
XY ],
where 
X âˆ¼X indicates that 
X is a random variable with the same law as X.

184
4 Monetary measures of risk
Proof. The upper Hardyâ€“Littlewood inequality in TheoremA.24 yields â€œâ‰¥â€. To prove
the reverse inequality, let us ï¬rst assume that Y has a continuous distribution. Then
Lemma A.21 implies that U := FY (Y) has a uniform distribution and that P -a.s.
Y = qY (U). Since 
X := qX(U) âˆ¼X by Lemma A.19, we obtain
E[ 
XY ] = E[ qX(U)qY (U) ] =
 1
0
qX(t)qY (t) dt,
and hence â€œâ‰¤â€.
In the general case, let D be the set of all y such that P [ Y = y ] > 0 and take
a random variable Z âˆˆL1
+ with a continuous distribution. Such a random variable
exists due to Proposition A.27. We claim that the law of
Yn := Y + 1
nZI{YâˆˆD}
is continuous. Indeed, for any y,
P [ Yn = y ] = P [ Y = y, Y /âˆˆD ] +

xâˆˆD
P [ Y = x, Z = n(y âˆ’x) ] = 0.
Thus, Un := FYn(Yn) has a uniform distribution on (0, 1), and Xn := qX(Un) has the
same distribution as X. By adding a suitable constant to X, we may assume without
loss of generality that X â‰¥0. Since Yn â‰¥Y we have qYn â‰¥qY a.e., and it follows
from the ï¬rst part of the proof that
 1
0
qX(t)qY (t) dt â‰¤lim inf
nâ†‘âˆ
 1
0
qX(t)qYn(t) dt
= lim inf
nâ†‘âˆ
sup

Xâˆ¼X
E[ 
XYn ]
= sup

Xâˆ¼X
E[ 
XY ],
where the last identity follows from the fact that
E[ 
XYn ] âˆ’E[ 
XY ]
 â‰¤1
nâˆ¥Zâˆ¥1âˆ¥Xâˆ¥âˆ,
for all 
X âˆ¼X.
Proof of Theorem 4.54. Suppose ï¬rst that Ï is law-invariant. Then X âˆˆAÏ implies
that 
X âˆˆAÏ for all 
X âˆ¼X. Hence,
Î±min(Q) = sup
XâˆˆAÏ
E[ âˆ’XÏ•Q ] = sup
XâˆˆAÏ
sup

Xâˆ¼X
E[ âˆ’
XÏ•Q ] = sup
XâˆˆAÏ
 1
0
qâˆ’X(t)qÏ•Q(t) dt,

4.5 Law-invariant risk measures
185
where we have used Lemma 4.55 in the last step. It follows that Î±min(Q) depends
only on the law of Ï•Q. In order to check the second identity in (4.39), note that

X := X + Ï(X) belongs to AÏ for any X âˆˆLâˆand that qâˆ’X âˆ’Ï(X) is a quantile
function for âˆ’
X.
Conversely, let us assume that Î±min(Q) depends only on the law of Ï•Q. Let us
write 
Q âˆ¼Q to indicate that Ï•Q and Ï•
Q have the same law. Then Lemma 4.55 yields
Ï(X) =
sup
QâˆˆM1(P )
	
EQ[ âˆ’X ] âˆ’Î±min(Q)

=
sup
QâˆˆM1(P )
sup

Qâˆ¼Q
	
E[ âˆ’XÏ•
Q ] âˆ’Î±min(Q)

=
sup
QâˆˆM1(P )
	  1
0
qâˆ’X(t)qÏ•Q(t) dt âˆ’Î±min(Q)

.
Example 4.56. Let u : R â†’R be an increasing concave function, and suppose that
a position X âˆˆLâˆis acceptable if E[ u(X) ] â‰¥c, where c is a given constant in the
interior of u(R). We have seen in Example 4.10 that the corresponding acceptance set
induces a convex risk measure Ï. Clearly, Ï is law-invariant, and it will be shown in
Proposition 4.104 that Ï is continuous from below and, hence, from above. Moreover,
the corresponding minimal penalty function can be computed as
Î±min(Q) = inf
Î»>0
1
Î»

x0 +
 1
0
â„“âˆ—
Î» Â· qÏ•Q(t)

dt

,
where
â„“âˆ—(y) = sup
xâˆˆR

xy + u(âˆ’x)

= sup
xâˆˆR

xy âˆ’â„“(x)

is the Fenchelâ€“Legendre transform of the convex increasing loss function â„“(x) :=
âˆ’u(âˆ’x); see Theorem 4.106.
â™¦
The following theorem clariï¬es the crucial role of the risk measures AV@RÎ»: they
can be viewed as the building blocks for law-invariant convex measures of risk on Lâˆ.
Recall that we assume that (, F , P) is atomless.
Theorem 4.57. A convex measure of risk Ï is law-invariant and continuous from
above if and only if
Ï(X) =
sup
ÂµâˆˆM1((0,1])
	 
(0,1]
AV@RÎ»(X) Âµ(dÎ») âˆ’Î²min(Âµ)

,
(4.40)
where
Î²min(Âµ) = sup
XâˆˆAÏ

(0,1]
AV@RÎ»(X) Âµ(dÎ»).

186
4 Monetary measures of risk
Proof. Clearly, the right-hand side of (4.40) deï¬nes a law-invariant convex risk mea-
sure that is continuous from above. Conversely, let Ï be law-invariant and continuous
from above. We will show that for Q âˆˆM1(P ) there exists a measure Âµ âˆˆM1((0, 1])
such that
 1
0
qâˆ’X(t)qÏ•(t) dt =

(0,1]
AV@Rs(X) Âµ(ds),
where Ï• := Ï•Q = dQ
dP . Then the assertion will follow from Theorem 4.54. Since
qâˆ’X(t) = V@R1âˆ’t(X) and qÏ•(t) = q+
Ï• (t) for a.e. t âˆˆ(0, 1),
 1
0
qâˆ’X(t)qÏ•(t) dt =
 1
0
V@Rt(X)q+
Ï• (1 âˆ’t) dt.
Since q+
Ï• is increasing and right-continuous, we can write q+
Ï• (t) = Î½((1 âˆ’t, 1]) for
some positive locally ï¬nite measure Î½ on (0, 1]. Moreover, the measure Âµ given by
Âµ(dt) = t Î½(dt) is a probability measure on (0, 1]:

(0,1]
t Î½(dt) =
 1
0
Î½((s, 1]) ds =
 1
0
q+
Ï• (s) ds = E[ Ï• ] = 1.
Thus,
 1
0
qâˆ’X(t)qÏ•(t) dt =
 1
0
V@Rt(X)

(t,1]
1
s Âµ(ds) dt
=

(0,1]
1
s
 s
0
V@Rt(X) dt Âµ(ds)
(4.41)
=

(0,1]
AV@Rs(X) Âµ(ds).
Conversely, for any probability measure Âµ on (0, 1], the function q deï¬ned by q(t) :=

(1âˆ’t,1] sâˆ’1 Âµ(ds) can be viewed as the quantile function of the density Ï• := q(U)
of a measure Q âˆˆM1(P ), where U has a uniform distribution on (0, 1). Altogether,
we obtain a one-to-one correspondence between laws of densities Ï• and probability
measures Âµ on (0, 1].
Theorem 4.57 takes the following form for coherent measures of risk.
Corollary 4.58. AcoherentriskmeasureÏ iscontinuousfromaboveandlaw-invariant
if and only if
Ï(X) = sup
ÂµâˆˆM

(0,1]
AV@RÎ»(X) Âµ(dÎ»)
for some set M âŠ‚M1((0, 1]).
Randomness of a position is reduced in terms of P if we replace the position by
its conditional expectation with respect to some Ïƒ-algebra G âŠ‚F . Such a reduction
of randomness is reï¬‚ected by a convex risk measure if it is law-invariant:

4.5 Law-invariant risk measures
187
Corollary 4.59. Assume that Ï is a convex risk measure which is continuous from
above and law-invariant. Then Ï is monotone with respect to the binary relation â‰½uni
introduced in (3.27):
Y â‰½uni X
"â‡’
Ï(Y) â‰¤Ï(X),
for Y, X âˆˆX. In particular,
Ï

E[ X | G ]

â‰¤Ï(X),
for X âˆˆX and any Ïƒ-algebra G âŠ‚F , and
Ï

E[ X ]

= Ï(0) âˆ’E[ X ] â‰¤Ï(X).
Proof. The ï¬rst inequality follows from Theorem 4.57 combined with Remark 4.44.
The second inequality is a special case of the ï¬rst one, since E[ X |G ] â‰½uni X according
to Theorem 2.58. The third follows from the second by taking G = {âˆ…, }.
Recall from Theorem 2.70 that Âµ â‰½mon Î½ implies Âµ â‰½uni Î½. Thus, the preceding
conclusion for convex risk measures is stronger than the one of Remark 4.53 for
monetary risk measures.
Remark 4.60. If G1 âŠ‚G2 âŠ‚Â· Â· Â· âŠ‚F are Ïƒ-algebras, then
Ï

E[ X | Gn ]

âˆ’â†’Ï

E[ X | Gâˆ]

as n â†‘âˆ,
where Ï is as in Corollary 4.59 and Gâˆ= Ïƒ
 
n Gn

.
Indeed, Doobâ€™s martin-
gale convergence theorem (see, e.g., Theorem 19.1 in [19]) states that E[ X | Gn ] â†’
E[ X | Gâˆ] P-a.s. as n â†‘âˆ. Hence, the Fatou property and Corollary 4.59 show
that
Ï

E[ X | Gâˆ]

= Ï

lim
nâ†‘âˆE[ X | Gn ]

â‰¤lim inf
nâ†‘âˆÏ

E[ X | Gn ]

â‰¤Ï

E[ X | Gâˆ]

.
â™¦
In contrast to Proposition 4.42, the following theorem shows that AV@RÎ» is the
best conservative approximation to V@RÎ» in the class of all law-invariant convex
measures of risk which are continuous from above.
Theorem 4.61. AV@RÎ» is the smallest law-invariant convex measure of risk which
is continuous from above and dominates V@RÎ».
Proof. That AV@RÎ» dominates V@RÎ» was already stated in (4.37). Suppose now that
Ï is another law-invariant convex risk measure which dominates V@RÎ» and which is
continuous from above. We must show that for a given X âˆˆX
Ï(X) â‰¥AV@RÎ»(X).
(4.42)

188
4 Monetary measures of risk
Take Îµ > 0, and let A := { âˆ’X â‰¥V@RÎ»(X) âˆ’Îµ } and
Y := E[ X | XIAc ] = X Â· IAc + E[ X | A ] Â· IA.
Since Y > q+
X(Î») + Îµ â‰¥E[ X | A ] on Ac, we get P [ Y < E[ X | A ] ] = 0. On the
other hand, P[ Y â‰¤E[ X | A ] ] â‰¥P [ A ] > Î», and this implies that V@RÎ»(Y) =
E[ âˆ’X | A ]. Since Ï dominates V@RÎ», we have Ï(Y) â‰¥E[ âˆ’X | A ]. Thus,
Ï(X) â‰¥Ï(Y) = E[ âˆ’X | âˆ’X â‰¥V@RÎ»(X) âˆ’Îµ ],
by Corollary 4.59. Taking Îµ â†“0 yields
Ï(X) â‰¥E[ âˆ’X | âˆ’X â‰¥V@RÎ»(X) ].
If the distribution of X is continuous, Corollary 4.49 states that the conditional expec-
tation on the right equals AV@RÎ»(X), and we obtain (4.42). If the distribution of X
is not continuous, we denote by D the set of all points x such that P [ X = x ] > 0
and take any bounded random variable Z â‰¥0 with a continuous distribution. Such a
random variable exists due to Proposition A.27. We have seen in the proof of Lemma
4.55 that Xn := X + 1
n ZI{XâˆˆD} has a continuous distribution. Moreover, Xn de-
creases to X. The inequality (4.42) holds for each Xn and extends to X by continuity
from above.
Corollary 4.62. AV@RÎ» and WCEÎ» coincide under our assumption that the proba-
bility space is atomless.
Proof. We know from Corollary 4.49 that WCEÎ»(X) = AV@RÎ»(X) if X has a
continuous distribution. Repeating the approximation argument at the end of the
preceding proof yields WCEÎ»(X) = AV@RÎ»(X) for each X âˆˆX.
4.6
Concave distortions
Let us now have a closer look at the coherent risk measures
ÏÂµ(X) :=

AV@RÎ»(X) Âµ(dÎ»),
(4.43)
which appear in the Representation Theorem 4.57 for law-invariant convex risk mea-
sures. WearegoingtocharacterizetheseriskmeasuresÏÂµ intwoways, ï¬rstasChoquet
integrals with respect to some concave distortion of the underlying probability measure
P, and then, in the next section, by a property of comonotonicity.
Again, we will assume throughout this section that the underlying probability
space (, F , P) is atomless. Since AV@RÎ» is coherent, continuous from below,

4.6 Concave distortions
189
and law-invariant, any mixture ÏÂµ for some probability measure Âµ on (0, 1] has the
same properties. According to Remark 4.45, we may set AV@R0(X) = âˆ’ess inf X
so that we can extend the deï¬nition (4.43) to probability measures Âµ on the closed
interval [0, 1]. However, ÏÂµ will only be continuous from above and not from below
if Âµ({0}) > 0, because AV@R0 is not continuous from below.
Our ï¬rst goal is to show that ÏÂµ(X) can be identiï¬ed with the Choquet integral
of the loss âˆ’X with respect to the set function cÏˆ(A) := Ïˆ(P[ A ]), where Ïˆ is the
concave function deï¬ned in the following lemma. Choquet integrals were introduced
in Remark ??. Recall that every concave function Ïˆ admits a right-continuous right-
hand derivative Ïˆâ€²
+; see Proposition A.4.
Lemma 4.63. The identity
Ïˆâ€²
+(t) =

(t,1]
sâˆ’1 Âµ(ds) ,
0 < t < 1,
(4.44)
deï¬nes a one-to-one correspondence between probability measures Âµ on [0, 1] and
increasing concave functions Ïˆ : [0, 1] â†’[0, 1] with Ïˆ(0) = 0 and Ïˆ(1) = 1.
Moreover, we have Ïˆ(0+) = Âµ({0}).
Proof. Suppose ï¬rst that Âµ is given and Ïˆ is deï¬ned by Ïˆ(1) = 1 and (4.44). Then
Ïˆ is concave and increasing on (0, 1]. Moreover,
1 âˆ’Ïˆ(0+) =
 1
0
Ïˆâ€²(t) dt =

(0,1]
1
s
 1
0
I{t<sâ‰¤1} dt Âµ(ds) = Âµ((0, 1]) â‰¤1.
Hence, we may set Ïˆ(0) := 0 and obtain an increasing concave function on [0, 1].
Conversely, if Ïˆ is given, then Ïˆâ€²
+(t) is a decreasing right-continuous function on
(0, 1) and can be written as Ïˆâ€²
+(t) = Î½((t, 1]) for some locally ï¬nite positive measure
Î½ on (0, 1]. We ï¬rst deï¬ne Âµ on (0, 1] by Âµ(dt) = t Î½(dt). Then (4.44) holds and, by
Fubiniâ€™s theorem,
Âµ((0, 1]) =
 1
0

(0,1]
I{t<s} Î½(ds) dt = 1 âˆ’Ïˆ(0+) â‰¤1.
Hence, setting Âµ({0}) := Ïˆ(0+) deï¬nes a probability measure Âµ on [0, 1].
Theorem 4.64. For a probability measure Âµ on [0, 1], let Ïˆ be the concave function
deï¬ned in Lemma 4.63. Then, for X âˆˆX,
ÏÂµ(âˆ’X) = Ïˆ(0+)AV@R0(âˆ’X) +
 1
0
qX(t)Ïˆâ€²(1 âˆ’t) dt
=
 0
âˆ’âˆ

Ïˆ(P[ X > x ]) âˆ’1

dx +
 âˆ
0
Ïˆ(P[ X > x ]) dx.

190
4 Monetary measures of risk
Proof. Using the fact that V@RÎ»(âˆ’X) = qâˆ’
X(1 âˆ’Î»), we get as in (4.41) that

(0,1]
AV@RÎ»(âˆ’X) Âµ(dÎ») =
 1
0
qX(t)Ïˆâ€²(1 âˆ’t) dt.
Hence, we obtain the ï¬rst identity. For the second one, we will ï¬rst assume X â‰¥0.
Then
q+
X(t) = sup{ x â‰¥0 | FX(x) â‰¤t } =
 âˆ
0
I{FX(x)â‰¤t} dx,
where FX is the distribution function of X. Using Fubiniâ€™s theorem, we obtain
 1
0
qX(t)Ïˆâ€²(1 âˆ’t) dt =
 âˆ
0
 1
0
I{FX(x)â‰¤1âˆ’t}Ïˆâ€²(t) dt dx
=
 âˆ
0
Ïˆ(1 âˆ’FX(x)) dx âˆ’Ïˆ(0+) ess sup X,
since
 y
0 Ïˆâ€²(t) dt = (Ïˆ(y) âˆ’Ïˆ(0+))I{y>0}. This proves the second identity for
X â‰¥0, since Ïˆ(0+) = Âµ({0}) and ess sup X = AV@R0(âˆ’X). If X âˆˆLâˆis
arbitrary, we consider X + C, where C := âˆ’ess inf X. The cash invariance of ÏÂµ
yields
C + ÏÂµ(âˆ’X) =
 âˆ
0
Ïˆ(P[ X > x âˆ’C ]) dx
=
 0
âˆ’C
Ïˆ(P[ X > x ]) dx +
 âˆ
0
Ïˆ(P[ X > x ]) dx
= C +
 0
âˆ’âˆ

Ïˆ(P[ X > x ]) âˆ’1

dx +
 âˆ
0
Ïˆ(P[ X > x ]) dx.
Example 4.65. Clearly, the risk measure AV@RÎ» is itself of the form ÏÂµ where
Âµ = Î´Î». For Î» > 0, the corresponding concave distortion function is given by
Ïˆ(t) =
	 t
Î»

âˆ§1 = 1
Î» (t âˆ§Î»).
Thus, we obtain yet another representation of AV@RÎ»:
AV@RÎ»(âˆ’X) = 1
Î»
 âˆ
0
P [ X > x ] âˆ§Î» dx
for X âˆˆLâˆ
+ .
â™¦
Corollary 4.66. If Âµ({0}) = 0 in Theorem 4.64, then
ÏÂµ(X) = âˆ’
 1
0
qX(Ï•(t)) dt,
where Ï• is an inverse function of Ïˆ, taken in the sense of Deï¬nition A.14.

4.6 Concave distortions
191
Proof. Due to Lemma A.15, the distribution of Ï• under the Lebesgue measure has the
distribution function Ïˆ and hence the density Ïˆâ€². Therefore
 1
0
qX(Ï•(t)) dt =
 1
0
qX(t)Ïˆâ€²(t) dt = âˆ’
 1
0
qâˆ’X(1 âˆ’t)Ïˆâ€²(t) dt,
where we have used Lemma A.23 in the last step. An application of Theorem 4.64
concludes the proof.
Let us continue with a brief discussion of the set function cÏˆ(A) = Ïˆ(P[ A ]).
Deï¬nition 4.67. Let Ïˆ : [0, 1] â†’[0, 1] be an increasing function such that Ïˆ(0) = 0
and Ïˆ(1) = 1. The set function
cÏˆ(A) := Ïˆ(P[ A ]),
A âˆˆF ,
is called the distortion of the probability measure P with respect to the distortion
function Ïˆ.
Deï¬nition 4.68. A set function c : F â†’[0, 1] is called monotone if
c(A) â‰¤c(B)
for A âŠ‚B
and normalized if
c(âˆ…) = 0
and
c() = 1.
A monotone set function is called submodular or 2-alternating if
c(A âˆªB) + c(A âˆ©B) â‰¤c(A) + c(B).
Clearly, any distortion cÏˆ is normalized and monotone.
Proposition 4.69. Let cÏˆ be the distortion of P with respect to the distortion function
Ïˆ. If Ïˆ is concave, then cÏˆ is submodular. Moreover, if the underlying probability
space is atomless, then also the converse implication holds.
Proof. Suppose ï¬rst that Ïˆ is concave. Take A, B âˆˆF with P [ A ] â‰¤P [ B ]. We
must show that c := cÏˆ satisï¬es
c(A) âˆ’c(A âˆ©B) â‰¥c(A âˆªB) âˆ’c(B).
This is trivial if r = 0, where
r := P [ A ] âˆ’P [ A âˆ©B ] = P [ A âˆªB ] âˆ’P [ B ].
For r > 0 the concavity of Ïˆ yields via (A.1) that
c(A) âˆ’c(A âˆ©B)
P [ A ] âˆ’P [ A âˆ©B ] â‰¥
c(A âˆªB) âˆ’c(B)
P [ A âˆªB ] âˆ’P [ B ].

192
4 Monetary measures of risk
Multiplying both sides with r gives the result.
Now suppose that c = cÏˆ is submodular and assume that (, F , P ) is atomless.
We have to show that Ïˆ(y) â‰¥(Ïˆ(x) + Ïˆ(z))/2 whenever 0 â‰¤x â‰¤z â‰¤1 and
y = (x + z)/2. To this end, we will construct two sets A, B âŠ‚F such that P [ A ] =
P[ B ] = y, P[ A âˆ©B ] = x, and P [ A âˆªB ] = z.
Submodularity then gives
Ïˆ(x) + Ïˆ(z) â‰¤2Ïˆ(y) and in turn the concavity of Ïˆ.
In order to construct the two sets A and B, take a random variable U with a uniform
distribution on [0, 1], which exists by Proposition A.27. Then
A := { 0 â‰¤U â‰¤y }
and
B := { z âˆ’y â‰¤U â‰¤z }
are as desired.
Let us now recall the notion of a Choquet integral, which was introduced in Ex-
ample 4.13.
Deï¬nition 4.70. Let c : F â†’[0, 1] be any set function which is normalized and
monotone. The Choquet integral of a bounded measurable function X on (, F )
with respect to c is deï¬ned as

X dc :=
 0
âˆ’âˆ
(c(X > x) âˆ’1) dx +
 âˆ
0
c(X > x) dx.
Note that the Choquet integral coincides with the usual integral as soon as c is a
Ïƒ-additive probability measure; see also Lemma 4.91 below.
With this deï¬nition, Theorem 4.64 allows us to identify the risk measure ÏÂµ as the
Choquet integral of the loss with respect to a concave distortion cÏˆ of the underlying
probability measure P :
Corollary 4.71. For a probability measure Âµ on [0, 1], let Ïˆ be the concave distortion
function deï¬ned in Lemma 4.63, and let cÏˆ denote the distortion of P with respect
to Ïˆ. Then, for X âˆˆLâˆ,
ÏÂµ(X) =

(âˆ’X) dcÏˆ.
Combining Corollary 4.71 with Theorem 4.57, we obtain the following character-
ization of law-invariant convex risk measures in terms of concave distortions:
Corollary 4.72. A convex risk measure Ï is law-invariant and continuous from above
if and only if
Ï(X) = sup
Ïˆ
	 
(âˆ’X) dcÏˆ âˆ’Î³min(Ïˆ)

,
where the supremum is taken over the class of all concave distortion functions Ïˆ and
Î³min(Ïˆ) := sup
XâˆˆAÏ

(âˆ’X) dcÏˆ.

4.6 Concave distortions
193
As another consequence of Theorem 4.64, we obtain an explicit description of the
maximal representing set QÂµ âŠ‚M1(P ) for the coherent risk measure ÏÂµ.
Theorem 4.73. Let Âµ be a probability measure on [0, 1], and let Ïˆ be the correspond-
ing concave function deï¬ned in Lemma 4.63. Then ÏÂµ can be represented as
ÏÂµ(X) = sup
QâˆˆQÂµ
EQ[ âˆ’X ],
where the set QÂµ is given by
QÂµ :=
$
Q âˆˆM1(P )
 Ï• := dQ
dP satisï¬es
 1
t
qÏ•(s) ds â‰¤Ïˆ(1 âˆ’t) for t âˆˆ(0, 1)
%
.
Moreover, QÂµ is the maximal subset of M1(P ) that represents ÏÂµ.
Proof. The risk measure ÏÂµ is coherent and continuous from above. By Corollary 4.34,
it can be represented by taking the supremum of expectations over the set Qmax =
{ Q âˆˆM1(P ) | Î±min(Q) = 0 }. Using (4.39) and Theorem 4.64, we see that a measure
Q âˆˆM1(P ) with density Ï• = dQ/dP belongs to Qmax if and only if
 1
0
qX(s)qÏ•(s) ds â‰¤ÏÂµ(âˆ’X)
= Ïˆ(0+)AV@R0(âˆ’X) +
 1
0
qX(s)Ïˆâ€²(1 âˆ’s) ds
(4.45)
for all X âˆˆLâˆ. For constant random variables X â‰¡t, we have qX = I[t,1] a.e., and
so we obtain
 1
t
qÏ•(s) ds â‰¤Ïˆ(0+) +
 1
t
Ïˆâ€²(1 âˆ’s) ds = Ïˆ(1 âˆ’t)
for all t âˆˆ(0, 1). Hence Qmax âŠ‚QÂµ. For the proof of the converse inclusion, we show
that the density Ï• of a ï¬xed measure Q âˆˆQÂµ satisï¬es (4.45) for any given X âˆˆLâˆ.
To this end, let Î½ be the positive ï¬nite measure on [0, 1] such that q+
X(s) = Î½([0, s]).
Using Fubiniâ€™s theorem and the deï¬nition of QÂµ, we get
 1
0
qX(s)qÏ•(s) ds =

[0,1]
 1
t
qÏ•(s) ds Î½(dt)
â‰¤

[0,1]
Ïˆ(1 âˆ’t) Î½(dt)
= Ïˆ(0+)Î½([0, 1]) +
 1
0
Ïˆâ€²(1 âˆ’s)

[0,s]
Î½(dt) ds,
which coincides with the right-hand side of (4.45).

194
4 Monetary measures of risk
Corollary 4.74. In the context of Theorem 4.73, the following conditions are equiv-
alent.
(a) ÏÂµ is continuous from below.
(b) Âµ({0}) = 0.
(c) ÏÂµ(X) = max
QâˆˆQÂµ
EQ[ âˆ’X ] for all X âˆˆLâˆ.
If these equivalent conditions are satisï¬ed, then the maximum in (c) is attained by
the measure QX âˆˆQÂµ with density dQX/dP = f (X), where f is the decreasing
function deï¬ned by
f (x) := Ïˆâ€²(FX(x))
if x is a continuity point of FX, and by
f (x) :=
1
FX(x) âˆ’FX(xâˆ’)
 FX(x)
FX(xâˆ’)
Ïˆâ€²(t) dt
otherwise. Moreover, with Î» denoting the Lebesgue measure on (0, 1),
QÂµ =
$
Q â‰ªP
 P â—¦
	dQ
dP

âˆ’1
â‰½uni Î» â—¦(Ïˆâ€²)âˆ’1 %
.
(4.46)
Proof. The equivalence of conditions (a) and (c) has already been proved in Corol-
lary 4.35.
If (b) holds, then ÏÂµ is continuous from below, due to Theorem 4.47
and monotone convergence. Let us now show that condition (a) is not satisï¬ed if
Î´ := Âµ({0}) > 0. In this case, we can write
ÏÂµ = Î´AV@R0 + (1 âˆ’Î´)ÏÂµâ€²,
where Âµâ€² := Âµ( Â· |(0, 1]). Then ÏÂµâ€² is continuous from below since Âµâ€²({0}) = 0, but
AV@R0 is not, and so ÏÂµ does not satisfy (a); see Remark 4.45.
Let us now prove the remaining assertions.
Since Ïˆ(0+) = Âµ({0}) = 0, a
measure Q with density Ï• = dQ/dP belongs to QÂµ if and only if
 1
t qÏ•(s) ds â‰¤
 1
t Ïˆâ€²(1âˆ’s) ds for all t. Since Ïˆâ€²(1âˆ’t) is a quantile function for the law of Ïˆâ€² under
Î», part (e) of Theorem 2.58 implies (4.46). The problem of identifying the maximizing
measure QX is hence equivalent to minimizing E[ Ï•X ] under the constraint that Ï•
is a density function such that P â—¦Ï•âˆ’1 â‰½uni Î» â—¦(Ïˆâ€²)âˆ’1. Let us ï¬rst assume that
X â‰¥0. Then it follows from Theorem 3.44 that f (X) minimizes E[ YX ] among
all Y âˆˆL1
+ such that P â—¦Y âˆ’1 â‰½uni Î» â—¦(Ïˆâ€²)âˆ’1. Moreover, Remark 3.46 shows that
E[ f (X) ] =
 1
0 Ïˆâ€²(t) dt = 1, and so Ï•X := f (X) â‰¥0 is the density of an optimal
probability measure QX âˆˆQÂµ. If X is not positive, then we may take a constant
c such that X + c â‰¥0 and apply the preceding argument. The formula for f then
follows from the fact that FX+c(X + c) = FX(X).

4.7 Comonotonic risk measures
195
Remark 4.75. As long as we are interested in a law-invariant risk assessment, we can
represent a ï¬nancial position X âˆˆLâˆby its distribution function FX or, equivalently,
by the function
GX(t) := 1 âˆ’FX(t) = P [ X > t ].
If we only consider positions X with values in [0, 1] then their proxies GX vary in
the class of right-continuous decreasing functions G on [0, 1] such that G(1) = 0 and
G(0) â‰¤1. Due to Theorem 4.64, a law-invariant coherent risk measure ÏÂµ induces a
functional U on the class of proxies via
U(GX) := ÏÂµ(âˆ’X) =
 1
0
Ïˆ(GX(t)) dt.
Since Ïˆ is increasing and concave, the functional U has the form of a von Neumannâ€“
Morgenstern utility functional on the probability space given by Lebesgue measure on
the unit interval [0, 1]. As such, it can be characterized by the axioms in Section 2.3,
and this is the approach taken inYaariâ€™s â€œdual theory of choiceâ€ [198]. More generally,
we can introduce a utility function u on [0, 1] with u(0) = 0 and consider the functional
U(GX) :=
 1
0
Ïˆ(GX(t)) du(t)
introduced by Quiggin [161]. For u(x) = x this reduces to the â€œdual theoryâ€, for
Ïˆ(x) = x we recover the classical utility functionals
U(GX) =
 1
0
GX(t) du(t)
= âˆ’
 1
0
u(t) dGX(t)
= E[ u(X) ]
discussed in Section 2.3.
â™¦
4.7
Comonotonic risk measures
In many situations, the risk of a combined position X + Y will be strictly lower than
the sum of the individual risks, because one position serves as a hedge against adverse
changes in the other position. If, on the other hand, there is no way for X to work
as a hedge for Y then we may want the risk simply to add up. In order to make
this idea precise, we introduce the notion of comonotonicity. Our main goal in this
section is to characterize the class of all convex risk measures that share this property
of comonotonicity.
As in the ï¬rst two sections of this chapter, we will denote by X the linear space
of all bounded measurable functions on the measurable space (, F ).

196
4 Monetary measures of risk
Deï¬nition 4.76. TwomeasurablefunctionsX andY on(, F )arecalledcomonotone
if

X(Ï‰) âˆ’X(Ï‰â€²)

Y(Ï‰) âˆ’Y(Ï‰â€²)

â‰¥0
for all (Ï‰, Ï‰â€²) âˆˆ Ã— .
(4.47)
A monetary measure of risk Ï on X is called comonotonic if
Ï(X + Y) = Ï(X) + Ï(Y)
whenever X, Y âˆˆX are comonotone.
Lemma 4.77. If Ï is a comonotonic monetary risk measure on X, then Ï is positively
homogeneous.
Proof. Note that (X, X) is a comonotone pair. Hence Ï(2X) = 2Ï(X). An iteration
of this argument yields Ï(rX) = rÏ(X) for all rational numbers r â‰¥0. Positive
homogeneity now follows from the Lipschitz continuity of Ï; see Lemma 4.3.
We will see below that every comonotonic monetary risk measure on X arises as
the Choquet integral with respect to a certain set function on (, F ). In the sequel,
c : F â†’[0, 1] will always denote a set function that is normalized and monotone; see
Deï¬nition 4.68. Unless otherwise mentioned, we will not assume that c enjoys any
additivity properties. Recall from Deï¬nition 4.70 that the Choquet integral of X âˆˆX
with respect to c is deï¬ned as

X dc =
 0
âˆ’âˆ
(c(X > x) âˆ’1) dx +
 âˆ
0
c(X > x) dx.
The proof of the following proposition was already given in Example 4.13.
Proposition 4.78. The Choquet integral of the loss,
Ï(X) :=

(âˆ’X) dc,
is a monetary risk measure on X which is positively homogeneous.
Deï¬nition 4.79. Let X be a measurable function on (, F ). An inverse function
rX : (0, 1) â†’R of the increasing function GX(x) := 1 âˆ’c(X > x), taken in the
sense of Deï¬nition A.14, is called a quantile function for X with respect to c.
If c is a probability measure, then GX(x) = c(X â‰¤x). Hence, the preceding
deï¬nition extends the notion of a quantile function given in Deï¬nition A.20. The
following proposition yields an alternative representation of the Choquet integral in
terms of quantile functions with respect to c.
Proposition 4.80. Let rX be a quantile function with respect to c for X âˆˆX. Then

X dc =
 1
0
rX(t) dt.

4.7 Comonotonic risk measures
197
Proof. We have

(X+m) dc =

X dc+m, and one easily checks that rX+m = rX+m
a.e. for all m âˆˆR and each quantile function rX+m of X + m. Thus, we may assume
without loss of generality that X â‰¥0. In this case, Remark A.16 and Lemma A.15
imply that the largest quantile function r+
X is given by
r+
X(t) = sup{ x â‰¥0 | GX(x) â‰¤t } =
 âˆ
0
I{GX(x)â‰¤t} dx.
Since rX = r+
X a.e. on (0, 1), Fubiniâ€™s theorem implies
 1
0
rX(t) dt =
 1
0
 âˆ
0
I{GX(x)â‰¤t} dx dt
=
 âˆ
0
(1 âˆ’GX(x)) dx
=

X dc.
The preceding proposition yields the following generalization of Corollary 4.66
when applied to a continuous distortion of a probability measure as deï¬ned in Deï¬ni-
tion 4.67.
Corollary 4.81. Let cÏˆ(A) = Ïˆ(P[ A ]) be the distortion of the probability measure
P with respect to the continuous distortion function Ïˆ. If Ï• is an inverse function for
the increasing function Ïˆ in the sense of Deï¬nition A.14, then the Choquet integral
with respect to cÏˆ satisï¬es

X dcÏˆ =
 1
0
qX

1 âˆ’Ï•(t)

dt,
where qX is a quantile function for X âˆˆX, taken with respect to P .
Proof. Due to the continuity of Ïˆ, we have Ïˆ(a) â‰¤t if and only if a â‰¤Ï•+(t) =
inf{x | Ïˆ(x) > t}. Thus, we can compute the lower quantile function of X with respect
to cÏˆ:
râˆ’
X(t) = inf{ x âˆˆR | 1 âˆ’cÏˆ(X > x) â‰¥t}
= inf{ x âˆˆR | Ïˆ(P[ X > x ]) â‰¤1 âˆ’t}
= inf{ x âˆˆR | P [ X > x ] â‰¤Ï•+(1 âˆ’t)}
= qâˆ’
X(1 âˆ’Ï•+(1 âˆ’t)).
Next note that Ï•+(t) = Ï•(t) for a.e. t. Moreover, Ï• has the continuous distribution
function Ïˆ under the Lebesgue measure, and so we can replace qâˆ’
X by the arbitrary
quantile function qX.

198
4 Monetary measures of risk
Theorem 4.82. A monetary risk measure Ï on X is comonotonic if and only if there
exists a normalized monotone set function c on (, F ) such that
Ï(X) =

(âˆ’X) dc,
X âˆˆX.
In this case, c is given by c(A) = Ï(âˆ’IA).
The preceding theorem implies in view of Corollary 4.71 that all mixtures
ÏÂµ =

[0,1]
AV@RÎ» Âµ(dÎ»)
are comonotonic. We will see in Theorem 4.87 below that these are in fact all convex
risk measures that are law-invariant and comonotonic. The proof of Theorem 4.82
requires a further analysis of comonotone random variables.
Lemma 4.83. Two measurable functions X and Y on (, F ) are comonotone if and
only if there exists a third measurable function Z on (, F ) and increasing functions
f and g on R such that X = f (Z) and Y = g(Z).
Proof. Clearly, X := f (Z) and Y := g(Z) are comonotone for given Z, f , and g.
Conversely, suppose that X and Y are comonotone and deï¬ne Z by Z := X + Y.
We show that z := Z(Ï‰) has a unique decomposition as z = x + y, where (x, y) =
(X(Ï‰â€²), Y(Ï‰â€²)) for some Ï‰â€² âˆˆ. Having established this, we can put f (z) := x
and g(z) := y. The existence of the decomposition as z = x + y follows by taking
x := X(Ï‰) and y := Y(Ï‰), so it remains to show that these are the only possible
values x and y. To this end, let us suppose that X(Ï‰) + Y(Ï‰) = z = X(Ï‰â€²) + Y(Ï‰â€²)
for some Ï‰â€² âˆˆ. Then
X(Ï‰) âˆ’X(Ï‰â€²) = âˆ’

Y(Ï‰) âˆ’Y(Ï‰â€²)

,
and comonotonicity implies that this expression vanishes. Hence x = X(Ï‰â€²) and
y = Y(Ï‰â€²).
Next, we check that both f and g are increasing functions on Z(). So let us
suppose that
X(Ï‰1) + Y(Ï‰1) = z1 â‰¤z2 = X(Ï‰2) + Y(Ï‰2).
This implies
X(Ï‰1) âˆ’X(Ï‰2) â‰¤âˆ’

Y(Ï‰1) âˆ’Y(Ï‰2)

.
Comonotonicity thus yields that X(Ï‰1)âˆ’X(Ï‰2) â‰¤0 and Y(Ï‰1)âˆ’Y(Ï‰2) â‰¤0, whence
f (z1) â‰¤f (z2) and g(z1) â‰¤g(z2). Thus, f and g are increasing on Z(), and it is
straightforward to extend them to increasing functions deï¬ned on R.
Lemma 4.84. If X, Y âˆˆX is a pair of comonotone functions, and rX, rY , rX+Y are
quantile functions with respect to c, then
rX+Y (t) = rX(t) + rY (t)
for a.e. t.

4.7 Comonotonic risk measures
199
Proof. Write X = f (Z) and Y = g(Z) as in Lemma 4.83. The same argument as
in the proof of Lemma A.23 shows that f (rZ) and g(rZ) are quantile functions for
X and Y under c if rZ is a quantile function for Z. An identical argument applied to
the increasing function h := f + g shows that h(rZ) = f (rZ) + g(rZ) is a quantile
function for X +Y. The assertion now follows from the fact that all quantile functions
of a random variable coincide almost everywhere, due to Lemma A.15.
Remark 4.85. Applied to the special case of quantile function with respect to a prob-
ability measure, the preceding lemma yields that V@RÎ» and AV@RÎ» are comono-
tonic.
â™¦
Proof of Theorem 4.82. We already know from Proposition 4.78 that the Choquet
integral of the loss is a monetary risk measure. Comonotonicity follows by combining
Proposition 4.80 with Lemma 4.84.
Conversely, suppose now that Ï is comonotonic. Then Ï is coherent according to
Lemma 4.77. Thus, we obtain a normalized monotone set function by letting c(A) :=
Ï(âˆ’IA). Moreover, Ïc(X) :=

(âˆ’X) dc is a comonotonic monetary risk measure on
X that coincides with Ï on indicator functions: Ï(âˆ’IA) = c(A) = Ïc(âˆ’IA). Let us
now show that Ï and Ïc coincide on simple random variables of the form
X =
n

i=1
xiIAi ,
xi âˆˆR, Ai âˆˆF .
Since these random variables are dense in Lâˆ, Lemma 4.3 will then imply that Ï = Ïc.
In order to show that Ïc(X) = Ï(X) for X as above, we may assume without loss of
generalitythatx1 â‰¥x2 â‰¥Â· Â· Â· â‰¥xn andthatthesetsAi aredisjoint. Bycashinvariance,
we may also assume X â‰¥0, i.e., xn â‰¥0. Thus, we can write X = n
i=1 biIBi , where
bi := xi âˆ’xi+1 â‰¥0, xn+1 := 0, and Bi := i
k=1 Ak. Note that biIBi and bkIBk is
a pair of comonotone functions. Hence, also kâˆ’1
i=1 biIBi and bkIBk are comonotone,
and we get inductively
Ï(âˆ’X) =
n

i=1
biÏ(âˆ’IBi ) =
n

i=1
biÏc(âˆ’IBi ) = Ïc(âˆ’X).
Remark 4.86. The argument at the end of the preceding proof shows that the Choquet
integral of a simple random variable
X =
n

i=1
xiIAi
with x1 â‰¥Â· Â· Â· â‰¥xn â‰¥xn+1 := 0
can be computed as

X dc =
n

i=1
(xi âˆ’xi+1)c(Bi) =
n

i=1
xi

c(Bi) âˆ’c(Biâˆ’1)

,
where B0 := âˆ…and Bi := i
k=1 Ak for i = 1, . . . , n.
â™¦

200
4 Monetary measures of risk
So far, we have shown that comonotonic monetary risk measures can be identiï¬ed
with Choquet integrals of normalized monotone set functions. Our next goal is to
characterize those set functions that induce risk measures with the additional property
of convexity. To this end, we will ï¬rst consider law-invariant risk measures. The
following result shows that the risk measures AV@RÎ» may be viewed as the extreme
points in the convex class of all law-invariant convex risk measures on Lâˆthat are
comonotonic.
Theorem 4.87. On an atomless probability space, the class of risk measures
ÏÂµ(X) :=

AV@RÎ»(X) Âµ(dÎ»),
Âµ âˆˆM1([0, 1]),
is precisely the class of all law-invariant convex risk measures on Lâˆthat are comono-
tonic. In particular, any convex measure of risk that is law-invariant and comonotonic
is also coherent and continuous from above.
Proof. Comonotonicity of ÏÂµ follows from Corollary 4.71 and Theorem 4.82. Con-
versely, let us assume that Ï is a law-invariant convex measure of risk that is also
comonotonic. By Theorem 4.82, Ï(X) =

(âˆ’X) dc for c(A) := Ï(âˆ’IA). The
law-invariance of Ï implies that c(A) is a function of the probability P [ A ], i.e.,
there exists an increasing function Ïˆ on [0, 1] such that Ïˆ(0) = 0, Ïˆ(1) = 1, and
c(A) = Ïˆ(P[ A ]). Note that IAâˆªB and IAâˆ©B is a pair of comonotone functions for all
A, B âˆˆF . Hence, comonotonicity and subadditivity of Ï imply
c(A âˆ©B) + c(A âˆªB) = Ï(âˆ’IAâˆ©B ) + Ï(âˆ’IAâˆªB ) = Ï

âˆ’IAâˆ©B âˆ’IAâˆªB

= Ï

âˆ’IA âˆ’IB

(4.48)
â‰¤c(A) + c(B).
Proposition 4.69 thus implies that Ïˆ is concave. Corollary 4.71 ï¬nally shows that the
Choquet integral with respect to c can be identiï¬ed with a risk measure ÏÂµ, where Âµ
is obtained from Ïˆ via Lemma 4.63.
Now we turn to the characterization of all comonotonic convex risk measures
on X. Recall that, for a positively homogeneous monetary risk measure, convexity is
equivalent to subadditivity. Also recall that M1,f := M1,f (, F ) denotes the set of
all ï¬nitely additive normalized set functions Q : F â†’[0, 1], and that EQ[ X ] denotes
the integral of X âˆˆX with respect to Q âˆˆM1,f , as constructed in Theorem A.50.
Theorem 4.88. For the Choquet integral with respect to a normalized monotone set
function c, the following conditions are equivalent.
(a) Ï(X) :=

(âˆ’X) dc is a convex risk measure on X.
(b) Ï(X) :=

(âˆ’X) dc is a coherent risk measure on X.

4.7 Comonotonic risk measures
201
(c) For Qc := {Q âˆˆM1,f | Q[ A ] â‰¤c(A) for all A âˆˆF },

X dc = max
QâˆˆQc
EQ[ X ]
for X âˆˆX.
(d) The set function c is submodular.
In this case, Qc is equal to the maximal representing set Qmax for Ï.
Before giving the proof of this theorem, let us state the following corollary, which
gives a complete characterization of all comonotonic convex risk measures, and a
remark concerning the set Qc in part (c), which is usually called the core of c.
Corollary 4.89. A convex risk measure on X is comonotonic if and only if it arises
as the Choquet integral of the loss with respect to a submodular, normalized, and
monotone set function c. In this case, c is given by c(A) = Ï(âˆ’IA), and Ï has the
representation
Ï(X) = max
QâˆˆQc
EQ[ âˆ’X ],
where Qc = {Q âˆˆM1,f | Q[ A ] â‰¤c(A) for all A âˆˆF } is equal to the maximal
representing set Qmax.
Proof. Theorems 4.82 and 4.88 state that Ï(X) :=

(âˆ’X) dc is a comonotonic
coherent risk measure, which can be represented as in the assertion, as soon as c is a
submodular, normalized, and monotone set function. Conversely, any comonotonic
convex risk measure Ï is coherent and arises as the Choquet integral of c(A) :=
Ï(âˆ’IA), due to Theorem 4.82. Theorem 4.88 then gives the submodularity of c.
Remark 4.90. Let c be a normalized monotone submodular set function.
Theo-
rem 4.88 implies in particular that the core Qc of c is non-empty. Moreover, c can be
recovered from Qc:
c(A) = max
QâˆˆQc
Q[ A ]
for all A âˆˆF .
If c has the additional continuity property that c(An) â†’0 for any decreasing sequence
(An) of events such that 
n An = âˆ…, then this property is shared by any Q âˆˆQc, and it
follows that Q is Ïƒ-additive. Thus, the corresponding coherent risk measure Ï(X) =

(âˆ’X) dc admits a representation in terms of Ïƒ-additive probability measures. It
follows by Lemma 4.20 that Ï is continuous from above.
â™¦
The proof of Theorem 4.88 requires some preparations. The assertion of the
following lemma is not entirely obvious, since Fubiniâ€™s theorem may fail if Q âˆˆM1,f
is not Ïƒ-additive.
Lemma 4.91. For X âˆˆX and Q âˆˆM1,f , the integral EQ[ X ] is equal to the Choquet
integral

X dQ.

202
4 Monetary measures of risk
Proof. It is enough to prove the result for X â‰¥0. Suppose ï¬rst that X = n
i=1 xiIAi
is as in Remark 4.86. Then

X dQ =
n

i=1
(xi âˆ’xi+1)Q
 
i
k=1
Ak
!
=
n

i=1
xiQ[ Ai ] = EQ[ X ].
The result for general X âˆˆX follows by approximating X uniformly with Xn which
take only ï¬nitely many values, and by using the Lipschitz continuity of both EQ[ Â· ]
and

Â· dQ with respect to the supremum norm.
Lemma 4.92. Let A1, . . . , An be a partition of  into disjoint measurable sets, and
suppose that the normalized monotone set function c is submodular. Let Q be the
probability measure on F0 := Ïƒ(A1, . . . , An) with weights
Q[ Ak ] := c(Bk) âˆ’c(Bkâˆ’1)
for B0 := âˆ…and Bk :=
k
j=1
Aj, k â‰¥1.
(4.49)
Then

X dc â‰¥EQ[ X ] for all bounded F0-measurable X = n
i=1 xiIAi , and equal-
ity holds if the values of X are arranged in decreasing order: x1 â‰¥Â· Â· Â· â‰¥xn.
Proof. Clearly, it sufï¬ces to consider only the case X â‰¥0. Then Remark 4.86 implies

X dc = EQ[ X ] as soon as the values of X are arranged in decreasing order.
Now we prove

X dc â‰¥EQ[ X ] for arbitrary F0-measurable X. To this end,
note that any permutation Ïƒ of {1, . . . , n} induces a probability measure QÏƒ on F0
by applying the deï¬nition of Q to the re-labeled partition AÏƒ(1) . . . , AÏƒ(n). If Ïƒ is a
permutation such that xÏƒ(1) â‰¥Â· Â· Â· â‰¥xÏƒ(n), then we have

X dc = EQÏƒ [ X ], and so
the assertion will follow if we can prove that EQÏƒ [ X ] â‰¥EQ[ X ]. To this end, it is
enough to show that EQÏ„ [ X ] â‰¥EQ[ X ] if Ï„ is the transposition of two indices i and
i + 1 which are such that xi < xi+1, because Ïƒ can be represented as a ï¬nite product
of such transpositions.
Note next that
EQÏ„ [ X ]âˆ’EQ[ X ] = xi(QÏ„[ Ai ]âˆ’Q[ Ai ])+xi+1(QÏ„[ Ai+1 ]âˆ’Q[ Ai+1 ]). (4.50)
To compute the probabilities QÏ„[ Ak ], let us introduce
BÏ„
0 := âˆ…
and
BÏ„
k :=
k
j=1
AÏ„(j),
k = 1, . . . , n.
Then BÏ„
k = Bk for k Ì¸= i. Hence,
QÏ„[ Ai ] + QÏ„[ Ai+1 ] = QÏ„[ AÏ„(i) ] + QÏ„[ AÏ„(i+1) ] = c(BÏ„
i+1) âˆ’c(BÏ„
iâˆ’1)
= c(Bi+1) âˆ’c(Biâˆ’1) = Q[ Ai ] + Q[ Ai+1 ].
(4.51)

4.8 Measures of risk in a ï¬nancial market
203
Moreover, BÏ„
i âˆ©Bi = Biâˆ’1, BÏ„
i âˆªBi = Bi+1, and hence c(Biâˆ’1) + c(Bi+1) â‰¤
c(BÏ„
i ) + c(Bi), due to the submodularity of c. Thus,
Q[ Ai+1 ] = c(Bi+1) âˆ’c(Bi) â‰¤c(BÏ„
i ) âˆ’c(BÏ„
iâˆ’1) = QÏ„[ AÏ„(i)] = QÏ„[ Ai+1].
Using (4.50), (4.51), and our assumption xi < xi+1 thus yields EQÏ„ [ X ] â‰¥EQ[ X ].
Proof of Theorem 4.88.
(a)â‡”(b): According to Proposition 4.78, the property of
positive homogeneity is shared by all Choquet integrals, and the implication (b) â‡’(a)
is obvious.
(b) â‡’(c): By Corollary 4.18, Ï(âˆ’X) = maxQâˆˆQmax EQ[ X ], where Q âˆˆM1,f
belongs to Qmax if and only if
EQ[ X ] â‰¤Ï(âˆ’X) =

X dc
for all X âˆˆX.
(4.52)
We will now show that this set Qmax coincides with the set Qc. If Q âˆˆQmax then,
in particular, Q[ A ] â‰¤

IA dc = c(A) for all A âˆˆF . Hence Q âˆˆQc. Conversely,
suppose Q âˆˆQc. If X â‰¥0 then

X dc =
 âˆ
0
c(X > x) dx â‰¥
 âˆ
0
Q[ X > x ] dx = EQ[ X ],
where we have used Lemma 4.91. Cash invariance yields (4.52).
(c) â‡’(b) is obvious.
(b) â‡’(d): This follows precisely as in (4.48).
(d) â‡’(a): We have to show that the Choquet integral is subadditive. By Lemma
4.3, it is again enough to prove this for random variables which only take ï¬nitely many
values. Thus, let A1, . . . , An be a partition of  into ï¬nitely many disjoint measurable
sets. Let us write X = 
i xiIAi , Y = 
i yiIAi , and let us assume that the indices
i = 1, . . . , n are arranged such that x1 + y1 â‰¥Â· Â· Â· â‰¥xn + yn. Then the probability
measure Q constructed in Lemma 4.92 is such that

(X + Y) dc = EQ[ X + Y ] = EQ[ X ] + EQ[ Y ] â‰¤

X dc +

Y dc.
But this is the required subadditivity of the Choquet integral.
4.8 Measures of risk in a ï¬nancial market
In this section, we will consider risk measures which arise in the ï¬nancial market
model of Section 1.1. In this model, d + 1 assets are priced at times t = 0 and t = 1.
Prices at time 1 are modelled as non-negative random variables S0, S1, . . . , Sd on

204
4 Monetary measures of risk
some probability space (, F , P), with S0 â‰¡1 + r. Prices at time 0 are given by
a vector Ï€ = (1, Ï€), with Ï€ = (Ï€1, . . . , Ï€d). The discounted net gain of a trading
strategy Î¾ = (Î¾0, Î¾) is given by Î¾ Â· Y, where the random vector Y = (Y 1, . . . , Y d) is
deï¬ned by
Y i =
Si
1 + r âˆ’Ï€i
for i = 1, . . . , d.
As in the previous two sections, risk measures will be deï¬ned on the space
Lâˆ= Lâˆ(, F , P). A ï¬nancial position X can be viewed as riskless if X â‰¥0
or, more generally, if X can be hedged without additional costs, i.e., if there exists a
trading strategy Î¾ = (Î¾0, Î¾) such that Ï€ Â· Î¾ = 0 and
X + Î¾ Â· S
1 + r = X + Î¾ Â· Y â‰¥0
P -a.s.
(4.53)
Thus, we deï¬ne the following set of acceptable positions in Lâˆ:
A0 :=

X âˆˆLâˆ| âˆƒÎ¾ âˆˆRd with X + Î¾ Â· Y â‰¥0 P -a.s.

.
Proposition 4.93. Suppose that inf{m âˆˆRd | m âˆˆA0} > âˆ’âˆ. Then Ï0 := ÏA0 is a
coherent measure of risk. Moreover, Ï0 is sensitive in the sense of Deï¬nition 4.32 if and
only if the market model is arbitrage-free. In this case, Ï0 is continuous from above
and can be represented in terms of the set P of equivalent risk-neutral measures:
Ï0(X) = sup
P âˆ—âˆˆP
Eâˆ—[ âˆ’X ].
(4.54)
Proof. The fact that Ï0 is a coherent measure of risk follows from Proposition 4.7. If
the model is arbitrage-free, then Theorem 1.31 yields the representation (4.54), and it
follows that Ï0 is sensitive and continuous from above.
Conversely, suppose that Ï0 is sensitive, but the market model admits an arbitrage
opportunity. Then there are Î¾ âˆˆRd and Îµ > 0 such that 0 â‰¤Î¾ Â· Y P -a.s. and
A := {Î¾ Â· Y â‰¥Îµ} satisï¬es P [ A ] > 0. It follows that Î¾ Â· Y âˆ’ÎµIA â‰¥0, i.e., âˆ’ÎµIA is
acceptable. However, the sensitivity of Ï0 implies that
Ï0(âˆ’ÎµIA) = ÎµÏ0(âˆ’IA) > Ï0(0) = 0,
where we have used the coherence of Ï0, which follows from fact that A0 is a cone.
Thus, we arrive at a contradiction.
There are several reasons why it may make sense to allow in (4.53) only strategies
Î¾ that belong to a proper subset S of the class Rd of all strategies. For instance,
if the resources available to an investor are limited, only those strategies should be
considered for which the initial investment in risky assets is below a certain amount.
Such a restriction corresponds to an upper bound on Î¾ Â· Ï€. There may be other
constraints. For instance, short sales constraints are lower bounds on the number of

4.8 Measures of risk in a ï¬nancial market
205
shares in the portfolio. In view of market illiquidity, the investor may also wish to
avoid holding too many shares of one single asset, since the market capacity may not
sufï¬ce to resell the shares. Such constraints will be taken into account by assuming
throughout the remainder of this section that S has the following properties:
â€¢ 0 âˆˆS.
â€¢ S is convex.
â€¢ Each Î¾ âˆˆS is admissible in the sense that Î¾ Â· Y is P -a.s. bounded from below.
Under these conditions, the set
AS :=

X âˆˆLâˆ| âˆƒÎ¾ âˆˆS with X + Î¾ Â· Y â‰¥0 P -a.s.

(4.55)
is non-empty, convex, and contains all X âˆˆX which dominate some Z âˆˆAS.
Moreover, we will assume from now on that
inf{ m âˆˆR | m âˆˆAS } > âˆ’âˆ.
(4.56)
Proposition 4.7 then guarantees that the induced risk measure
ÏS(X) := ÏAS(X) = inf{m âˆˆR | m + X âˆˆAS}
is a convex risk measure on Lâˆ. Note that (4.56) holds, in particular, if S does not
contain arbitrage opportunities in the sense that Î¾ Â· Y â‰¥0 P -a.s. for Î¾ âˆˆS implies
P[ Î¾ Â· Y = 0 ] = 1.
Remark 4.94. Admissibility of portfolios is a serious restriction; in particular, it pre-
vents unhedged short sales of any unbounded asset. Note, however, that it is consistent
with our notion of acceptability for bounded claims in (4.55), since X + Î¾ Â· Y â‰¥0
implies Î¾ Â· Y â‰¥âˆ’âˆ¥Xâˆ¥.
â™¦
Two questions arise: When is ÏS continuous from above, and thus admits a rep-
resentation (4.29) in terms of probability measures? And, if such a representation
exists, how can we identify the minimal penalty function Î±S
min on M1(P )? In the case
S = Rd, both questions were addressed in Proposition 4.93. For general S, only the
second question has a straightforward answer, which will be given in Proposition 4.96.
As can be seen from the proof of Proposition 4.93, an analysis of the ï¬rst question
requires an extension of the arbitrage theory in Chapter 1 for the case of portfolio
constraints. Such a theory will be developed in Chapter 9 in a more general dynamic
setting, and we will address both questions for the corresponding risk measures in
Corollary 9.30. This result implies the following theorem for the simple one-period
model of the present section:
Theorem 4.95. In addition to the above assumptions, suppose that the market model
is non-redundant in the sense of Deï¬nition 1.13 and that S is a closed subset of Rd.

206
4 Monetary measures of risk
Then ÏS is sensitive if and only if S contains no arbitrage opportunities. In this case,
ÏS is continuous from above and admits the representation
ÏS(X) =
sup
QâˆˆM1(P )

EQ[ âˆ’X ] âˆ’sup
Î¾âˆˆS
EQ[ Î¾ Â· Y ]

.
(4.57)
In the following proposition, we will explain the speciï¬c form of the penalty func-
tion in (4.57). This result will not require the additional assumptions of Theorem 4.95.
Proposition 4.96. For Q âˆˆM1(P ), the minimal penalty function Î±S
min of ÏS is given
by
Î±S
min(Q) = sup
Î¾âˆˆS
EQ[ Î¾ Â· Y ].
In particular, ÏS can be represented as in (4.57) if ÏS is continuous from above and,
especially, if S does not contain arbitrage opportunities.
Proof. Fix Q âˆˆM1(P ). Clearly, the expectation EQ[ Î¾ Â· Y ] is well deï¬ned for each
Î¾ âˆˆS by admissibility. If X âˆˆAS, there exists Î· âˆˆS such that âˆ’X â‰¤Î· Â·Y P -almost
surely. Thus,
EQ[ âˆ’X ] â‰¤EQ[ Î· Â· Y ] â‰¤sup
Î¾âˆˆS
EQ[ Î¾ Â· Y ]
for any Q âˆˆM1(P ). Hence, the deï¬nition of the minimal penalty function yields
Î±S
min(Q) â‰¤sup
Î¾âˆˆS
EQ[ Î¾ Â· Y ].
To prove the converse inequality, take Î¾ âˆˆS. Note that Xk := âˆ’((Î¾ Â· Y) âˆ§k) is
bounded since Î¾ is admissible. Moreover,
Xk + Î¾ Â· Y = (Î¾ Â· Y âˆ’k) I{Î¾Â·Yâ‰¥k} â‰¥0,
so that Xk âˆˆAS. Hence,
Î±S
min(Q) â‰¥EQ[ âˆ’Xk ] = EQ[ (Î¾ Â· Y) âˆ§k ],
and so Î±S
min(Q) â‰¥EQ[ Î¾ Â· Y ] by monotone convergence.
Remark 4.97. SupposethatS isacone. ThentheacceptancesetAS isalsoacone, and
ÏS is a coherent measure of risk. If ÏS is continuous from above, then Corollary 4.34
yields the representation
ÏS(X) =
sup
QâˆˆQSmax
EQ[ âˆ’X ]
in terms of the non-empty set QS
max = { Q âˆˆM1(P ) | Î±S
min(Q) = 0 }. It follows from
Proposition 4.96 that for Q âˆˆM1(P )
Q âˆˆQS
max if and only if EQ[ Î¾ Â· Y ] â‰¤0 for all Î¾ âˆˆS.

4.8 Measures of risk in a ï¬nancial market
207
If ÏS is sensitive then the set S cannot contain any arbitrage opportunities, and QS
max
contains the set P of all equivalent martingale measures whenever such measures
exist. More precisely, QS
max can be described as the set of absolutely continuous
supermartingale measures with respect to S; this will be discussed in more detail in
the dynamical setting of Chapter 9.
â™¦
Let us now relax the condition of acceptability in (4.55). We no longer insist
that the ï¬nal outcome of an acceptable position, suitably hedged, should always be
non-negative. Instead, we only require that the hedged position is acceptable in terms
of a given convex risk measure ÏA with acceptance set A. Thus, we deï¬ne
Â¯A :=

X âˆˆLâˆ| âˆƒÎ¾ âˆˆS, A âˆˆA with X + Î¾ Â· Y â‰¥A P -a.s.

.
(4.58)
Clearly, A âŠ‚Â¯A and hence
ÏA â‰¥Ï := Ï Â¯A.
From now on, we assume that
Ï > âˆ’âˆ,
which implies our assumption (4.56) for AS.
Proposition 4.98. The minimal penalty function Î±min for Ï is given by
Î±min(Q) = Î±S
min(Q) + Î±min(Q),
where Î±S
min is the minimal penalty function for ÏS, and Î±min is the minimal penalty
function for ÏA.
Proof. We claim that
Â¯A = { XS + A | XS âˆˆAS, A âˆˆA }.
(4.59)
If X âˆˆÂ¯A, then there exists A âˆˆA and Î¾ âˆˆS such that X + Î¾ Â· Y â‰¥A. Therefore
XS := X âˆ’A âˆˆAS. Conversely, if XS âˆˆAS then XS + Î¾ Â· Y â‰¥0 for some Î¾ âˆˆS.
Hence, for any A âˆˆA, we get XS + A + Î¾ Â· Y â‰¥X âˆˆA, i.e., X := XS + A âˆˆÂ¯A.
In view of (4.59), we have
Î±min(Q) = sup
XâˆˆÂ¯A
EQ[ âˆ’X ]
=
sup
XSâˆˆAS sup
AâˆˆA
EQ[ âˆ’XS âˆ’A ]
= Î±S
min(Q) + Î±min(Q).
For the rest of this section, we consider the following case study, which is based
on [36]. Let us ï¬x a ï¬nite class
Q0 = {Q1, . . . , Qn}

208
4 Monetary measures of risk
of equivalent probability measures Qi â‰ˆP such that |Y| âˆˆL1(Qi); as in [36], we
call the measures in Q0 valuation measures. Deï¬ne the sets
B :=

X âˆˆL0 | EQi[ X ] exists and is â‰¥0, i = 1, . . . , n

(4.60)
and
B0 :=

X âˆˆB | EQi[ X ] = 0 for i = 1, . . . , n

.
Note that
B0 âˆ©L0
+ = {0},
(4.61)
since X = 0 P -a.s. as soon as X â‰¥0 P -a.s. and EQi[ X ] = 0, due to the equivalence
Qi â‰ˆP.
As the initial acceptance set, we take the convex cone
A := B âˆ©Lâˆ
(4.62)
The corresponding set Â¯A of positions which become acceptable if combined with a
suitable hedge is deï¬ned as in (4.58):
Â¯A :=

X âˆˆLâˆ| âˆƒÎ¾ âˆˆRd with X + Î¾ Â· Y âˆˆB

.
Let us now introduce the following stronger version of the no-arbitrage condition
K âˆ©L0
+ = {0}, where K := { Î¾ Â· Y | Î¾ âˆˆRd }:
K âˆ©B = K âˆ©B0.
(4.63)
In other words, there is no portfolio Î¾ âˆˆRd such that the result satisï¬es the valuation
inequalities in (4.60) and is strictly favorable in the sense that at least one of the
inequalities is strict.
Note that (4.63) implies the absence of arbitrage opportunities:
K âˆ©L0
+ = K âˆ©B âˆ©L0
+ = K âˆ©B0 âˆ©L0
+ = {0},
where we have used (4.61) and B âˆ©L0
+ = L0
+. Thus, (4.63) implies, in particular, the
existence of an equivalent martingale measure, i.e., P Ì¸= âˆ…. The following proposition
may be viewed as an extension of the â€œfundamental theorem of asset pricingâ€. Let us
denote by
R :=
$
n

i=1
Î»iQi
 Î»i > 0,
n

i=1
Î»i = 1
%
the class of all â€œrepresentativeâ€ models for the class Q0, i.e., all mixtures such that
each Q âˆˆQ0 appears with a positive weight.
Proposition 4.99. The following two properties are equivalent:
(a) K âˆ©B = K âˆ©B0.
(b) P âˆ©R Ì¸= âˆ….

4.8 Measures of risk in a ï¬nancial market
209
Proof. (b) â‡’(a): For V âˆˆK âˆ©B and R âˆˆR, we have ER[ V ] â‰¥0. If we can
choose R âˆˆP âˆ©R then we get ER[ V ] = 0, hence V âˆˆB0.
(a) â‡’(b): Consider the convex set
C := { ER[ Y ] | R âˆˆR } âŠ‚Rd ;
we have to show that C contains the origin. If this is not the case then there exists
Î¾ âˆˆRd such that
Î¾ Â· x â‰¥0
for x âˆˆC,
(4.64)
and
Î¾ Â· xâˆ—> 0
for some xâˆ—âˆˆC ;
see Proposition A.1. Deï¬ne V := Î¾ Â· Y âˆˆK. Condition (4.64) implies
ER[ V ] â‰¥0
for all R âˆˆR,
hence V âˆˆK âˆ©B. Let Râˆ—âˆˆR be such that xâˆ—= ERâˆ—[ Y ]. Then V satisï¬es
ERâˆ—[ Y ] > 0, hence V /âˆˆK âˆ©B0, in contradiction to our assumption (a).
We can now state a representation theorem for the coherent risk measure Ï corre-
sponding to the convex cone Â¯A. It is a special case of Theorem 4.102 which will be
proved below.
Theorem 4.100. Under assumption (4.63), the coherent risk measure Ï := Ï Â¯A cor-
responding to the acceptance set Â¯A is given by
Ï(X) =
sup
P âˆ—âˆˆP âˆ©R
Eâˆ—[ âˆ’X ].
Let us now introduce a second ï¬nite set Q1 âŠ‚M1(P ) of probability measures
Q â‰ªP with |Y| âˆˆL1(Q); as in [36], we call them stress test measures. In addition
to the valuation inequalities in (4.60), we require that an admissible position passes a
stress test speciï¬ed by a â€œï¬‚oorâ€
Î³ (Q) < 0
for each Q âˆˆQ1.
Thus, the convex cone A in (4.62) is reduced to the convex set
A1 := A âˆ©B1 = Lâˆâˆ©

B âˆ©B1

,
where
B1 :=

X âˆˆL0 | EQ[ X ] â‰¥Î³ (Q) for Q âˆˆQ1

.
Let
Â¯A1 :=

X âˆˆLâˆ| âˆƒÎ¾ âˆˆRd with X + Î¾ Â· Y âˆˆB âˆ©B1

denote the resulting acceptance set for positions combined with a suitable hedge.

210
4 Monetary measures of risk
Remark 4.101. The analogue
K âˆ©(B âˆ©B1) = K âˆ©B0
(4.65)
of our condition (4.63) looks weaker, but it is in fact equivalent to (4.63). Indeed, for
X âˆˆK âˆ©B we can ï¬nd Îµ > 0 such that X1 := ÎµX satisï¬es the additional constraints
EQ[ X1 ] â‰¥Î³ (Q)
for Q âˆˆQ1.
Since X1 âˆˆK âˆ©B âˆ©B1, condition (4.65) implies X1 âˆˆK âˆ©B0, hence X = 1
ÎµX1 âˆˆ
K âˆ©B0, since K âˆ©B0 is a cone.
â™¦
LetusnowidentifytheconvexmeasureofriskÏ1 inducedbytheconvexacceptance
set Â¯A1. Deï¬ne
R1 :=
$ 
QâˆˆQ
Î»(Q) Â· Q
 Î»(Q) â‰¥0,

QâˆˆQ
Î»(Q) = 1
%
âŠƒR
as the convex hull of Q := Q0 âˆªQ1, and deï¬ne
Î³ (R) :=

QâˆˆQ
Î»(Q)Î³ (Q)
for R = 
Q Î»(Q)Q âˆˆR with Î³ (Q) := 0 for Q âˆˆQ0.
Theorem 4.102. Under assumption (4.63), the convex risk measure Ï1 induced by
the acceptance set Â¯A1 is given by
Ï1(X) =
sup
P âˆ—âˆˆP âˆ©R1

Eâˆ—[ âˆ’X ] + Î³ (P âˆ—)

,
(4.66)
i.e., Ï1 is determined by the penalty function
Î±1(Q) :=

+âˆ
for Q Ì¸âˆˆP âˆ©R1,
âˆ’Î³ (Q)
for Q âˆˆP âˆ©R1.
Proof. Let Ïâˆ—denote the convex risk measure deï¬ned by the right-hand side of (4.66),
and let Aâˆ—denote the corresponding acceptance set:
Aâˆ—:=

X âˆˆLâˆ| Eâˆ—[ X ] â‰¥Î³ (P âˆ—) for all P âˆ—âˆˆP âˆ©R1

.
It is enough to show Aâˆ—= Â¯A1.
(a): In order to show Â¯A1 âŠ‚Aâˆ—, take X âˆˆÂ¯A1 and P âˆ—âˆˆP âˆ©R1. There exists
Î¾ âˆˆRd and A1 âˆˆA1 such that X + Î¾ Â· Y â‰¥A1. Thus,
Eâˆ—[ X + Î¾ Â· Y ] â‰¥Eâˆ—[ A1 ] â‰¥Î³ (P âˆ—),

4.8 Measures of risk in a ï¬nancial market
211
due to P âˆ—âˆˆR1. Since Eâˆ—[ Î¾ Â· Y ] = 0 due to P âˆ—âˆˆP , we obtain Eâˆ—[ X ] â‰¥Î³ (P âˆ—),
hence X âˆˆAâˆ—.
(b): In order to show Aâˆ—âŠ‚Â¯A1, we take X âˆˆAâˆ—and assume that X /âˆˆÂ¯A1. This
means that the vector xâˆ—= (xâˆ—
1, . . . , xâˆ—
N) with components
xâˆ—
i := EQi[ X ] âˆ’Î³ (Qi)
does not belong to the convex cone
C :=

(EQi[ Î¾ Â· Y ])i=1,...,N + y | Î¾ âˆˆRd, y âˆˆRN
+

âŠ‚RN,
where Q = Q0 âˆªQ1 = {Q1, . . . , QN} with N â‰¥n. In part (c) of this proof we will
show that C is closed. Thus, there exists Î» âˆˆRN such that
Î» Â· xâˆ—< inf
xâˆˆC Î» Â· x ;
(4.67)
see Proposition A.1. Since C âŠƒRN
+, we obtain Î»i â‰¥0 for i = 1, . . . , N, and we may
assume 
i Î»i = 1 since Î» Ì¸= 0. Deï¬ne
R :=
N

i=1
Î»iQi âˆˆR1.
Since C contains the linear space of vectors

EQi[ V ]

i=1,...,N with V âˆˆK, (4.67)
implies
ER[ V ] = 0
for V âˆˆK,
hence R âˆˆP . Moreover, the right-hand side of (4.67) must be zero, and the condition
Î» Â· xâˆ—< 0 translates into
ER[ X ] < Î³ (R),
contradicting our assumption X âˆˆAâˆ—.
(c): It remains to show that C is closed. For Î¾ âˆˆRd we deï¬ne y(Î¾) as the vector
in RN with coordinates yi(Î¾) = EQi[ Î¾ Â· Y ]. Any x âˆˆC admits a representation
x = y(Î¾) + z
with z âˆˆRN
+ and Î¾ âˆˆNâŠ¥, where
N :=

Î· âˆˆRd | EQi[ Î· Â· Y ] = 0 for i = 1, . . . , N

,
and
NâŠ¥:=

Î¾ âˆˆRd | Î¾ Â· Î· = 0 for all Î· âˆˆN

.
Take a sequence
xn = y(Î¾n) + zn,
n = 1, 2, . . . ,

212
4 Monetary measures of risk
with Î¾n âˆˆNâŠ¥and zn âˆˆRN
+, such that xn converges to x âˆˆRN. If lim infn |Î¾n| < âˆ,
then we may assume, passing to a subsequence if necessary, that Î¾n converges to
Î¾ âˆˆRd. Inthiscase, zn mustconvergetosomez âˆˆRN
+, andwehavex = y(Î¾)+z âˆˆC.
Let us now show that the case limn |Î¾n| = âˆis in fact excluded.
In that case,
Î±n := (1 + |Î¾n|)âˆ’1 converges to 0, and the vectors Î¶n := Î±nÎ¾n stay bounded. Thus,
we may assume that Î¶n converges to Î¶ âˆˆNâŠ¥. This implies
y(Î¶) = lim
nâ†‘âˆy(Î¶n) = âˆ’lim
nâ†‘âˆÎ±nzn âˆˆâˆ’RN
+.
Since Î¶ âˆˆNâŠ¥and |Î¶| = limn |Î¶n| = 1, we obtain y(Î¶) Ì¸= 0. Thus, the inequality
EQi[ (âˆ’Î¶) Â· Y ] = âˆ’yi(Î¶) â‰¥0
holds for all i and is strict for some i, in contradiction to our assumption (4.63).
4.9 Shortfall risk
In this section, we will establish a connection between convex measures of risk and
the expected utility theory of Chapter 2.
Supposethatarisk-averseinvestorassessesthedownsideriskofaï¬nancialposition
X âˆˆX by taking the expected utility E[ u(âˆ’Xâˆ’) ] derived from the shortfall Xâˆ’,
or by considering the expected utility E[ u(X) ] of the position itself. If the focus
is on the downside risk, then it is natural to change the sign and to replace u by the
function â„“(x) := âˆ’u(âˆ’x). Then â„“is a strictly convex and increasing function, and
the maximization of expected utility is equivalent to minimizing the expected loss
E[ â„“(âˆ’X) ] or the shortfall risk E[ â„“(Xâˆ’) ]. In order to unify the discussion of both
cases, we do not insist on strict convexity. In particular, â„“may vanish on (âˆ’âˆ, 0],
and in this case the shortfall risk takes the form
E[ â„“(Xâˆ’) ] = E[ â„“(âˆ’X) ].
Deï¬nition 4.103. A function â„“: R â†’R is called a loss function if it is increasing
and not identically constant.
In this section, we will only consider convex loss functions. Let us return to the
setting where we consider risk measures deï¬ned on the class X of all bounded mea-
surable functions on some given measurable space (, F ). First, we ï¬x a probability
measure P on (, F ). For a given convex loss function â„“and an interior point x0 in
the range of â„“, we deï¬ne the following acceptance set:
A := { X âˆˆX | E[ â„“(âˆ’X) ] â‰¤x0 }.
(4.68)

4.9 Shortfall risk
213
Proposition 4.104. The acceptance set A deï¬nes a convex measure of risk Ï := ÏA
which is continuous from below. Moreover, the minimal penalty function Î±min for Ï
is concentrated on M1(P ), and Ï can be represented in the form
Ï(X) =
max
QâˆˆM1(P )

EQ[ âˆ’X ] âˆ’Î±min(Q)

.
(4.69)
Proof. Clearly, the convex set A satisï¬es the ï¬rst two properties of Proposition 4.6
(a), and so Ï is a convex measure of risk. We have to show that Ï is continuous from
below. Note ï¬rst that
Ï(X) = inf

m âˆˆR | E[ â„“(âˆ’m âˆ’X)] â‰¤x0

is the unique solution to the equation
E[ â„“(âˆ’z âˆ’X) ] = x0.
(4.70)
Indeed, that Ï(X) solves (4.70) follows by dominated convergence, since the ï¬nite
convex function â„“is continuous. The solution is unique, since â„“is strictly increasing
on (â„“âˆ’1(x0) âˆ’Îµ, âˆ) for some Îµ > 0.
Suppose now that (Xn) is a sequence in X which increases pointwise to some
X âˆˆX. Then Ï(Xn) decreases to some ï¬nite limit R. Using the continuity of â„“and
dominated convergence, it follows that
E[ â„“(âˆ’Ï(Xn) âˆ’Xn)] âˆ’â†’E[ â„“(âˆ’R âˆ’X) ].
But each of the approximating expectations equals x0, and so R is a solution to (4.70).
Hence R = Ï(X), and this proves continuity from below. Since Ï satisï¬es (4.28), the
representation (4.69) follows from Proposition 4.21 and Lemma 4.30.
Let us now compute the minimal penalty function Î±min.
Example 4.105. For an exponential loss function â„“(x) = eÎ²x, the minimal penalty
function can be described in terms of relative entropy, and the resulting risk measure
coincides, up to an additive constant, with the entropic risk measure introduced in
Example 4.33. In fact,
Ï(X) = inf

m âˆˆR | E[ eâˆ’Î²(m+X) ] â‰¤x0

= 1
Î²

log E[ eâˆ’Î²X ] âˆ’log x0

.
In this special case, the general formula (4.17) for Î±min reduces to the variational
formula for the relative entropy H(Q|P ) of Q with respect to P :
Î±min(Q) = sup
XâˆˆX

EQ[ âˆ’X ] âˆ’1
Î² log E[ eâˆ’Î²X ]

âˆ’log x0
Î²
= 1
Î²

H(Q|P ) âˆ’log x0

;

214
4 Monetary measures of risk
see Lemma 3.29. Thus, the representation (4.69) of Ï is equivalent to the following
dual variational identity:
log E[ eX ] =
max
QâˆˆM1(P )

EQ[ X ] âˆ’H(Q|P )

.
â™¦
In general, the minimal penalty function Î±min on M1(P ) can be expressed in terms
of the Fenchelâ€“Legendre transform or conjugate function â„“âˆ—of the convex function â„“
deï¬ned by
â„“âˆ—(z) := sup
xâˆˆR

zx âˆ’â„“(x)

.
Theorem 4.106. For any convex loss function â„“, the minimal penalty function in the
representation (4.69) is given by
Î±min(Q) = inf
Î»>0
1
Î»

x0 + E

â„“âˆ—

Î»dQ
dP
 
,
Q âˆˆM1(P ).
(4.71)
To prepare the proof of Theorem 4.106, we summarize some properties of the
functions â„“and â„“âˆ—as stated in Appendix A.1. First note that â„“âˆ—is a proper convex
function, i.e., it is convex and takes some ï¬nite value. We denote by J := (â„“âˆ—)â€²
+ its
right-continuous derivative. Then, for x, z âˆˆR,
xz â‰¤â„“(x) + â„“âˆ—(z)
with equality if x = J(z).
(4.72)
Lemma 4.107. Let (â„“n) be a sequence of convex loss functions which decreases point-
wise to the convex loss function â„“. Then the corresponding conjugate functions â„“âˆ—
n
increase pointwise to â„“âˆ—.
Proof. It follows immediately from the deï¬nition of the Fenchelâ€“Legendre transform
that each â„“âˆ—
n is dominated by â„“âˆ—, and that â„“âˆ—
n(z) increases to some limit â„“âˆ—
âˆ(z). We
have to prove that â„“âˆ—
âˆ= â„“âˆ—.
The function z â†’â„“âˆ—
âˆ(z) is a lower semicontinuous convex function as the in-
creasing limit of such functions. Moreover, â„“âˆ—
âˆis a proper convex function, since it
is dominated by the proper convex function â„“âˆ—. Consider the conjugate function â„“âˆ—âˆ—
âˆ
of â„“âˆ—
âˆ. Clearly, â„“âˆ—âˆ—
âˆâ‰¥â„“, since â„“âˆ—
âˆâ‰¤â„“âˆ—and since â„“âˆ—âˆ—= â„“by Proposition A.6. On
the other hand, we have by a similar argument that â„“âˆ—âˆ—
âˆâ‰¤â„“n for each n. By taking
n â†‘âˆ, this shows â„“âˆ—âˆ—
âˆ= â„“, which in turn gives â„“âˆ—
âˆ= â„“âˆ—.
Lemma 4.108. The functions â„“and â„“âˆ—have the following properties.
(a) â„“âˆ—(0) = âˆ’infxâˆˆR â„“(x) and â„“âˆ—(z) â‰¥âˆ’â„“(0) for all z.
(b) There exists some z1 âˆˆ[0, âˆ) such that
â„“âˆ—(z) = sup
xâ‰¥0

xz âˆ’â„“(x)

for z â‰¥z1.
In particular, â„“âˆ—is increasing on [z1, âˆ).

4.9 Shortfall risk
215
(c) â„“âˆ—(z)
z
âˆ’â†’âˆas z â†‘âˆ.
Proof. Part (a) is obvious.
(b): Let N := { z âˆˆR | â„“âˆ—(z) = âˆ’â„“(0) }. We show in a ï¬rst step that N Ì¸= âˆ….
Note that convexity of â„“implies that the set S of all z with zx â‰¤â„“(x) âˆ’â„“(0) for all
x âˆˆR is non-empty. For z âˆˆS we clearly have â„“âˆ—(z) â‰¤âˆ’â„“(0). On the other hand,
â„“âˆ—(z) â‰¥âˆ’â„“(0) by (a).
Now we take z1 := sup N. It is clear that z1 â‰¥0. If z > z1 and x < 0, then
xz âˆ’â„“(x) â‰¤xz1 âˆ’â„“(x) â‰¤â„“âˆ—(z1) â‰¤âˆ’â„“(0),
where the last inequality follows from the lower semicontinuity of â„“âˆ—. But â„“âˆ—(z) >
âˆ’â„“(0), hence
sup
x<0

xz âˆ’â„“(x)

< â„“âˆ—(z).
(c): For z â‰¥z1,
â„“âˆ—(z)/z = sup
xâ‰¥0

x âˆ’â„“(x)/z

by (b). Hence
â„“âˆ—(z)
z
â‰¥xz âˆ’1,
where xz := sup{ x | â„“(x) â‰¤z }. Since â„“is convex, increasing, and takes only ï¬nite
values, we have xz â†’âˆas z â†‘âˆ.
Proof of Theorem 4.106. Fix Q âˆˆM1(P ), and denote by Ï• := dQ/dP its density.
First, we show that it sufï¬ces to prove the claim for x0 > â„“(0). Otherwise we can ï¬nd
some a âˆˆR such that â„“(âˆ’a) < x0, since x0 was assumed to be an interior point of
â„“(R). Let â„“(x) := â„“(x âˆ’a), and

A :=
 
X âˆˆX | E[â„“(âˆ’
X) ] â‰¤x0

.
Then 
A = { X âˆ’a | X âˆˆA }, and hence
sup

Xâˆˆ
A
EQ[ âˆ’
X ] = sup
XâˆˆA
EQ[ âˆ’X ] + a.
(4.73)
The convex loss function â„“satisï¬es the requirement â„“(0) < x0. So if the assertion is
established in this case, we ï¬nd that
sup

Xâˆˆ
A
EQ[ âˆ’
X ] = inf
Î»>0
1
Î»(x0 + E[â„“âˆ—(Î»Ï•) ]) = inf
Î»>0
1
Î»(x0 + E[ â„“âˆ—(Î»Ï•) ]) + a ;
here we have used the fact that the Fenchelâ€“Legendre transform â„“âˆ—of â„“satisï¬es
â„“âˆ—(z) = â„“âˆ—(z) + az. Together with (4.73), this proves that the reduction to the case
â„“(0) < x0 is indeed justiï¬ed.

216
4 Monetary measures of risk
For any Î» > 0 and X âˆˆA, (4.72) implies
âˆ’XÏ• = 1
Î»(âˆ’X)(Î»Ï•) â‰¤1
Î»

â„“(âˆ’X) + â„“âˆ—(Î»Ï•)

.
Hence, for any Î» > 0
Î±min(Q) â‰¤sup
XâˆˆA
1
Î»

E[ â„“(âˆ’X) ] + E[ â„“âˆ—(Î»Ï•)]

â‰¤1
Î»

x0 + E[ â„“âˆ—(Î»Ï•)]

Thus, it remains to prove that
Î±min(Q) â‰¥inf
Î»>0
1
Î»

x0 + E[ â„“âˆ—(Î»Ï•)]

(4.74)
in case where Î±min(Q) < âˆ.
This will be done ï¬rst under the following extra
conditions:
There exists Îº âˆˆR such that â„“(x) = inf â„“for all x â‰¤Îº.
(4.75)
â„“âˆ—is ï¬nite on (0, âˆ).
(4.76)
J is continuous on (0, âˆ).
(4.77)
Notethattheseassumptionsimplythatâ„“âˆ—(0) < âˆandthatJ(0+) â‰¥Îº. Moreover,
J(z) increases to +âˆas z â†‘âˆ, and hence so does â„“(J(z)). Since
â„“âˆ—(z) â‰¥âˆ’â„“(0) > âˆ’x0
for all z,
(4.78)
it follows from (4.72) that
lim
zâ†“0 â„“(J(z)) âˆ’x0 < lim
zâ†“0

â„“(J(z)) + â„“âˆ—(z)

= lim
zâ†“0 zJ(z) = 0.
These facts and the continuity of J imply that for large enough n there exists some
Î»n > 0 such that
E

â„“

J(Î»nÏ•)I{Ï•â‰¤n}
 
= x0.
Let us deï¬ne
Xn := âˆ’J(Î»nÏ•)I{Ï•â‰¤n}.
Then Xn is bounded and belongs to A. Hence, it follows from (4.72) and (4.78) that
Î±min(Q) â‰¥EQ[ âˆ’Xn ]
= 1
Î»n
E

I{Ï•â‰¤n}J(Î»nÏ•)(Î»nÏ•)

= 1
Î»n
E
 
â„“(âˆ’Xn) + â„“âˆ—(Î»nÏ•)

Â· I{Ï•â‰¤n}

= 1
Î»n

x0 âˆ’â„“(0) Â· P [ Ï• > n ] + E

â„“âˆ—(Î»nÏ•)I{Ï•â‰¤n}

â‰¥x0 âˆ’â„“(0)
Î»n
.

4.9 Shortfall risk
217
Since we assumed that Î±min(Q) < âˆ, the decreasing limit Î»âˆof Î»n must be strictly
positive. The fact that â„“âˆ—is bounded from below allows us to apply Fatouâ€™s lemma:
Î±min(Q) â‰¥lim inf
nâ†‘âˆ
1
Î»n

x0 âˆ’â„“(0) Â· P [ Ï• > n ] + E

â„“âˆ—(Î»nÏ•)I{Ï•â‰¤n}

â‰¥
1
Î»âˆ

x0 + E[ â„“âˆ—(Î»âˆÏ•) ]

.
This proves (4.74) under the assumptions (4.75), (4.76), and (4.77).
If (4.75) and (4.76) hold, but J is not continuous, then we can approximate the
upper semicontinuous function J from above with an increasing continuous function

J on [0, âˆ) such that
â„“âˆ—(z) := â„“âˆ—(0) +
 z
0

J(y) dy
satisï¬es
â„“âˆ—(z) â‰¤â„“âˆ—(z) â‰¤â„“âˆ—
(1 + Îµ)z

for z â‰¥0.
Let â„“:= â„“âˆ—âˆ—denote the Fenchelâ€“Legendre transform of â„“âˆ—.
Since â„“âˆ—âˆ—= â„“by
Proposition A.6, it follows that
â„“
	
x
1 + Îµ

â‰¤â„“(x) â‰¤â„“(x).
Therefore,

A :=

X âˆˆX | E[â„“(âˆ’X) ] â‰¤x0

âŠ†

(1 + Îµ)X | X âˆˆA

=: AÎµ.
Since we already know that the assertion holds for â„“, we get that
inf
Î»>0
1
Î»

x0 + E

â„“âˆ—

Î»dQ
dP
 
â‰¤inf
Î»>0
1
Î»

x0 + E

â„“âˆ—

Î»dQ
dP
 
= sup
Xâˆˆ
A
EQ[ âˆ’X ]
â‰¤sup
XâˆˆAÎµ
EQ[ âˆ’X ]
= (1 + Îµ)Î±min(Q).
By letting Îµ â†“0, we obtain (4.74).
Finally, we remove conditions (4.75) and (4.76). If â„“âˆ—(z) = +âˆfor some z,
then z must be an upper bound for the slope of â„“. So we will approximate â„“by a
sequence (â„“n) of convex loss functions whose slope is unbounded. Simultaneously,
we can handle the case where â„“does not take on its inï¬mum. To this end, we choose
a sequence Îºn â†“inf â„“such that Îºn â‰¤â„“(0) < x0. We can deï¬ne, for instance,
â„“n(x) := â„“(x) âˆ¨Îºn + 1
n(ex âˆ’1)+.

218
4 Monetary measures of risk
Then â„“n decreases pointwise to â„“. Each loss function â„“n satisï¬es (4.75) and (4.76).
Hence, for any Îµ > 0 there are Î»Îµ
n such that
âˆ> Î±min(Q) â‰¥Î±n
min(Q) â‰¥1
Î»Îµn

x0 + E[ â„“âˆ—
n(Î»Îµ
nÏ•) ]

âˆ’Îµ
for each n,
where Î±n
min(Q) is the penalty function arising from â„“n.
Note that â„“âˆ—
n â†—â„“âˆ—by
Lemma 4.107. Our assumption Î±min(Q) < âˆ, the fact that
inf
zâˆˆR â„“âˆ—
n(z) â‰¥âˆ’â„“n(0) = âˆ’â„“(0) > âˆ’x0,
and part (c) of Lemma 4.108 show that the sequence (Î»Îµ
n)nâˆˆN must be bounded away
from zero and from inï¬nity. Therefore, we may assume that Î»Îµ
n converges to some
Î»Îµ âˆˆ(0, âˆ). Using again the fact that â„“âˆ—
n(z) â‰¥âˆ’â„“(0) uniformly in n and z, Fatouâ€™s
lemma yields
Î±min(Q) + Îµ â‰¥lim inf
nâ†‘âˆ
1
Î»Îµn

x0 + E[ â„“âˆ—
n(Î»Îµ
nÏ•) ]

â‰¥1
Î»Îµ

x0 + E[ â„“âˆ—(Î»ÎµÏ•) ]

.
This completes the proof of the theorem.
Example 4.109. Take
â„“(x) :=
 1
pxp
if x â‰¥0,
0
otherwise,
where p > 1. Then
â„“âˆ—(z) :=
 1
q zq
if z â‰¥0,
+âˆ
otherwise,
where q = p/(p âˆ’1) is the usual dual coefï¬cient. We may apply Theorem 4.106 for
any x0 > 0. Let Q âˆˆM1(P ) with density Ï• := dQ/dP . Clearly, Î±min(Q) = +âˆif
Ï• /âˆˆLq(, F , P). Otherwise, the inï¬mum in (4.71) is attained for
Î»Q =
 px0
E[ Ï•q ]
1/q
.
Hence, we can identify Î±min(Q) for any Q â‰ªP as
Î±p
min(Q) = (px0)1/p Â· E
 dQ
dP
q 1/q
.
Taking the limit p â†“1, we obtain the case â„“(x) = x+ where we measure the risk in
terms of the expected shortfall. Here we have
Î±1
min(Q) = x0 Â·

dQ
dP

âˆ
.
â™¦

4.9 Shortfall risk
219
Together with Proposition 4.19, Theorem 4.106 yields the following result for risk
measures which are deï¬ned in terms of a robust notion of bounded shortfall risk. Here
it is convenient to deï¬ne â„“âˆ—(âˆ) := âˆ.
Corollary 4.110. Suppose that Q is a family of probability measures on (, F ), and
that â„“, â„“âˆ—, and x0 are as in Theorem 4.106. We deï¬ne a set of acceptable positions by
A :=

X âˆˆX | EP [ â„“(âˆ’X) ] â‰¤x0 for all P âˆˆQ

.
Then the corresponding convex risk measure can be represented in terms of the penalty
function
Î±(Q) = inf
Î»>0
1
Î»

x0 + inf
P âˆˆQ EP

â„“âˆ—

Î»dQ
dP
 
,
Q âˆˆM1(, F ),
where dQ/dP is the density appearing in the Lebesgue decomposition of Q with
respect to P as in Theorem A.13.
Example 4.111. In the case of Example 4.105, the corresponding robust problem in
Corollary 4.110 leads to the following entropy minimization problem: For a given Q
and a set Q of probability measures, ï¬nd
inf
P âˆˆQ H(Q|P ).
Note that this problem is different from the standard problem of minimizing H(Q|P )
with respect to the ï¬rst variable Q as it appears in Section 3.2.
â™¦
Example 4.112. Take x0 = 0 in (4.68) and â„“(x) := x. Then
â„“âˆ—(z) :=

0
if z = 1,
+âˆ
otherwise.
Therefore, Î±(Q) = âˆif Q Ì¸= P , and Ï(X) = E[ âˆ’X ]. If Q is a set of probability
measures, the â€œrobustâ€ risk measure Ï of Corollary 4.110 is coherent, and it is given
by
Ï(X) = sup
P âˆˆQ
EP [ âˆ’X ].
â™¦


Part II
Dynamic hedging


Chapter 5
Dynamic arbitrage theory
In this chapter we develop a dynamic version of the arbitrage theory of Chapter 1.
Here we will work in a multiperiod setting, where the stochastic price ï¬‚uctuation of
a ï¬nancial asset is described as a stochastic process in discrete time. Portfolios will
be successively readjusted, taking into account the information available at each time.
Market efï¬ciency requires that such dynamic trading strategies do not create arbitrage
opportunities. In Section 5.2 we show that an arbitrage-free model is characterized
by the existence of an equivalent martingale measure. Under such a measure, the
discounted price processes of the traded assets are martingales, that is, they have the
mathematical structure of a fair game. In Section 5.3 we introduce European con-
tingent claims. These are ï¬nancial instruments whose payoff at the expiration date
depends on the behavior of the underlying primary assets, and possibly on other fac-
tors. We discuss the problem of pricing such contingent claims in a manner which
does not create new arbitrage opportunities. The pricing problem is closely related to
the problem of hedging a given claim by using a dynamic trading strategy based on
the primary assets. An ideal situation occurs if any contingent claim can be perfectly
replicated by the ï¬nal outcome of such a strategy. In such a complete model, the
equivalent martingale measure P âˆ—is unique, and derivatives are priced in a canon-
ical manner by taking the expectation of the discounted payoff with respect to the
measure P âˆ—. Section 5.5 contains a simple case study for completeness, the binomial
model introduced by Cox, Ross, and Rubinstein. In this context, it is possible to obtain
explicit pricing formulas for a number of exotic options, as explained in Section 5.6.
In Section 5.7 we pass to the limiting diffusion model of geometric Brownian motion.
Using a suitable version of the central limit theorem, we are led to the general Blackâ€“
Scholes formula for European contingent claims and to explicit pricing formulas for
some exotic options such as the up-and-in call.
The general structure of complete models is described in Section 5.4. There it will
become clear that completeness is the exception rather than the rule: Typical market
models in discrete time are incomplete.
5.1 The multi-period market model
Throughout this chapter, we consider a market model in which d + 1 assets are priced
at times t = 0, 1, . . . , T . The price of the ith asset at time t is modelled as a non-
negative random variable Si
t on a given probability space (, F , P ). The random
vector St = (S0
t , St) = (S0
t , S1
t , . . . , Sd
t ) is assumed to be measurable with respect

224
5 Dynamic arbitrage theory
to a Ïƒ-algebra Ft âŠ‚F . One should think of Ft as the class of all events which are
observable up to time t. Thus, it is natural to assume that
F0 âŠ‚F1 âŠ‚Â· Â· Â· âŠ‚FT .
(5.1)
Deï¬nition 5.1. A family (Ft)t=0,...,T of Ïƒ-algebras satisfying (5.1) is called a ï¬ltra-
tion. In this case, (, F , (Ft)t=0,...,T , P) is also called a ï¬ltered probability space.
To simplify the presentation, we will assume that
F0 = {âˆ…, }
and
F = FT .
(5.2)
Let (E, E) be a measurable space. A stochastic process with state space (E, E) is
given by a family of E-valued random variables on (, F , P ) indexed by time. In
our context, the typical parameter sets will be {0, . . . , T } or {1, . . . , T }, and the state
space will be some Euclidean space.
Deï¬nition 5.2. Let (, F , P) be a probability space and (Ft)t=0,...,T be a ï¬ltration.
(a) A stochastic process Y = (Yt)t=0,...,T is called adapted with respect to the
ï¬ltration (Ft)t=0,...,T if each Yt is Ft-measurable.
(b) A stochastic process Z = (Zt)t=1,...,T is called predictable with respect to
(Ft)t=0,...,T if each Zt is Ftâˆ’1-measurable.
Note that in our deï¬nition predictable processes start at t = 1 while adapted
processes are also deï¬ned at t = 0. In particular, the asset prices S = (St)t=0,...,T
form an adapted stochastic process with values in Rd+1.
Deï¬nition 5.3. A trading strategy is a predictable Rd+1-valued process Î¾ = (Î¾0, Î¾) =
(Î¾0
t , Î¾1
t , . . . , Î¾d
t )t=1,...,T .
The value Î¾i
t of a trading strategy Î¾ corresponds to the quantity of shares of the
ith asset held during the tth trading period between t âˆ’1 and t. Thus, Î¾i
t Si
tâˆ’1 is the
amount invested into the ith asset at time t âˆ’1, while Î¾i
t Si
t is the resulting value at
time t. The total value of the portfolio Î¾t at time t âˆ’1 is
Î¾t Â· Stâˆ’1 =
d

i=0
Î¾i
t Si
tâˆ’1.
By time t, the value of the portfolio Î¾t has changed to
Î¾t Â· St =
d

i=0
Î¾i
t Si
t .
The predictability of Î¾ expresses the fact that investments must be allocated at the
beginning of each trading period, without anticipating future price increments.

5.1 The multi-period market model
225
Deï¬nition 5.4. A trading strategy Î¾ is called self-ï¬nancing if
Î¾t Â· St = Î¾t+1 Â· St
for t = 1, . . . , T âˆ’1.
(5.3)
Intuitively, (5.3) means that the portfolio is always rearranged in such a way that its
present value is preserved. It follows that the accumulated gains and losses resulting
from the asset price ï¬‚uctuations are the only source of variations of the portfolio value:
Î¾t+1 Â· St+1 âˆ’Î¾t Â· St = Î¾t+1 Â· (St+1 âˆ’St).
(5.4)
In fact, a trading strategy is self-ï¬nancing if and only if (5.4) holds for t = 1, . . . , T âˆ’1.
It follows through summation over (5.4) that
Î¾t Â· St = Î¾1 Â· S0 +
t
k=1
Î¾k Â· (Sk âˆ’Skâˆ’1)
for t = 1, . . . , T .
Here, the constant Î¾1 Â· S0 can be interpreted as the initial investment for the purchase
of the portfolio Î¾1.
Example 5.5. Often it is assumed that the 0th asset plays the role of a locally riskless
bond. In this case, one takes S0
0 â‰¡1 and one lets S0
t evolve according to a spot rate
rt â‰¥0: At time t, an investment x made at time t âˆ’1 yields the payoff x(1 + rt).
Thus, a unit investment at time 0 produces the value
S0
t =
t
k=1
(1 + rk)
at time t. An investment in S0 is â€œlocally risklessâ€ if the spot rate rt is known before-
hand at time t âˆ’1. This idea can be made precise by assuming that the process r is
predictable.
â™¦
Without assuming predictability as in the preceding example, we assume from
now on that
S0
t > 0
P -a.s. for all t.
This assumption allows us to use the 0th asset as a numÃ©raire and to form the discounted
price processes
Xi
t := Si
t
S0t
,
t = 0, . . . , T, i = 0, . . . , d.
Then X0
t â‰¡1, and Xt = (X1
t , . . . , Xd
t ) expresses the value of the remaining assets in
units of the numÃ©raire. As explained in Remark 1.9, discounting allows comparison
of asset prices which are quoted at different times.

226
5 Dynamic arbitrage theory
Deï¬nition 5.6. The (discounted) value process V = (Vt)t=0,...,T associated with a
trading strategy Î¾ is given by
V0 := Î¾1 Â· X0
and
Vt := Î¾t Â· Xt
for t = 1, . . . , T.
The gains process associated with Î¾ is deï¬ned as
G0 := 0
and
Gt :=
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1)
for t = 1, . . . , T .
Clearly,
Vt = Î¾t Â· Xt = Î¾t Â· St
S0t
,
so Vt can be interpreted as the portfolio value at the end of the tth trading period
expressed in units of the numÃ©raire asset. The gains process
Gt =
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1)
reï¬‚ects, in terms of the numÃ©raire, the net gains which have accumulated through the
trading strategy Î¾ up to time t. For a self-ï¬nancing trading strategy Î¾, the identity
Î¾t Â· St = Î¾1 Â· S0 +
t
k=1
Î¾k Â· (Sk âˆ’Skâˆ’1)
(5.5)
remains true if all relevant quantities are computed in units of the numÃ©raire. This is
the content of the following simple proposition.
Proposition 5.7. For a trading strategy Î¾ the following conditions are equivalent:
(a) Î¾ is self-ï¬nancing.
(b) Î¾t Â· Xt = Î¾t+1 Â· Xt for t = 1, . . . , T âˆ’1.
(c) Vt = V0 + Gt = Î¾1 Â· X0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) for all t.
Proof. By dividing both sides of (5.3) by S0
t it is seen that condition (b) is a reformu-
lation of Deï¬nition 5.4. Moreover, (b) holds if and only if
Î¾t+1 Â· Xt+1 âˆ’Î¾t Â· Xt = Î¾t+1 Â· (Xt+1 âˆ’Xt) = Î¾t+1 Â· (Xt+1 âˆ’Xt)
for t = 1, . . . , T âˆ’1, and this identity is equivalent to (c).

5.2 Arbitrage opportunities and martingale measures
227
Remark 5.8. The numÃ©raire component of a self-ï¬nancing trading strategy Î¾ satisï¬es
Î¾0
t+1 âˆ’Î¾0
t = âˆ’(Î¾t+1 âˆ’Î¾t) Â· Xt
for t = 1, . . . , T âˆ’1.
(5.6)
Since
Î¾0
1 = V0 âˆ’Î¾1 Â· X0,
(5.7)
the entire process Î¾0 is determined by the initial investment V0 and the d-dimensional
process Î¾. Consequently, if a constant V0 and an arbitrary d-dimensional predictable
process Î¾ are given, then we can use (5.7) and (5.6) as the deï¬nition of a predictable
process Î¾0, and this construction yields a self-ï¬nancing trading strategy Î¾ := (Î¾0, Î¾).
In dealing with self-ï¬nancing strategies Î¾, it is thus sufï¬cient to focus on the initial
investment V0 and the d-dimensional processes X and Î¾.
â™¦
Remark 5.9. Different economic agents investing into the same market may choose
different numÃ©raires. For example, consider the following simple market model in
which prices are quoted in euros ( â‚¬) as the domestic currency. Let S0 be a locally
riskless â‚¬-bond with the predictable spot rate process r0, i.e.,
S0
t =
t
k=1
(1 + r0
k ),
and let S1 describe the price of a locally riskless investment into US dollars ($). Since
the price of this $-bond is quoted in â‚¬, the asset S1 is modeled as
S1
t = Ut Â·
t
k=1
(1 + r1
k ),
where r1 is the spot rate for a $-investment, and Ut denotes the price of 1$ in terms
of â‚¬, i.e., Ut is the exchange rate of the $ versus the â‚¬. While it may be natural for
European investors to take S0 as their numÃ©raire, it may be reasonable for anAmerican
investor to choose S1. This simple example explains why it may be relevant to check
which concepts and results of our theory are invariant under a change of numÃ©raire;
see, e.g., the discussion at the end of Section 5.2.
â™¦
5.2 Arbitrage opportunities and martingale measures
Intuitively, an arbitrage opportunity is an investment strategy that yields a positive
proï¬t with positive probability but without any downside risk.
Deï¬nition 5.10. A self-ï¬nancing trading strategy is called an arbitrage opportunity
if its value process V satisï¬es
V0 â‰¤0,
VT â‰¥0 P -a.s.,
and
P [ VT > 0 ] > 0.

228
5 Dynamic arbitrage theory
The existence of such an arbitrage opportunity may be regarded as a market in-
efï¬ciency in the sense that certain assets are not priced in a reasonable way. In this
section, we will characterize those market models which do not allow for arbitrage
opportunities. Such models will be called arbitrage-free. The following proposition
shows that the market model is arbitrage-free if and only if there are no arbitrage
opportunities for each single trading period. Later on, this fact will allow us to apply
the results of Section 1.6 to our multi-period model.
Proposition 5.11. The market model admits an arbitrage opportunity if and only if
there exist t âˆˆ{1, . . . , T } and Î· âˆˆL0(, Ftâˆ’1, P ; Rd) such that
Î· Â· (Xt âˆ’Xtâˆ’1) â‰¥0 P -a.s., and P [ Î· Â· (Xt âˆ’Xtâˆ’1) > 0 ] > 0.
(5.8)
Proof. To prove necessity, take an arbitrage opportunity Î¾ = (Î¾0, Î¾) with value process
V , and let
t := min

k | Vk â‰¥0 P -a.s., and P [ Vk > 0 ] > 0

.
Then t â‰¤T by assumption, and either Vtâˆ’1 = 0 P -a.s. or P [ Vtâˆ’1 < 0 ] > 0. In the
ï¬rst case, it follows that
Î¾t Â· (Xt âˆ’Xtâˆ’1) = Vt âˆ’Vtâˆ’1 = Vt
P -a.s.
Thus, Î· := Î¾t satisï¬es (5.8). In the second case, we let Î· := Î¾t I{Vtâˆ’1<0}. Then Î· is
Ftâˆ’1-measurable, and
Î· Â· (Xt âˆ’Xtâˆ’1) = (Vt âˆ’Vtâˆ’1) I{Vtâˆ’1<0} â‰¥âˆ’Vtâˆ’1 I{Vtâˆ’1<0}.
The expression on the right-hand side is non-negative and strictly positive with a
positive probability, so (5.8) holds.
Now we prove sufï¬ciency. For t and Î· as in (b), deï¬ne a d-dimensional predictable
process Î¾ by
Î¾s :=

Î·
if s = t,
0
otherwise.
Via (5.7) and (5.6), Î¾ uniquely deï¬nes a self-ï¬nancing trading strategy Î¾ = (Î¾0, Î¾)
with initial investment V0 = 0.
Since the corresponding value process satisï¬es
VT = Î· Â· (Xt âˆ’Xtâˆ’1), the strategy Î¾ is an arbitrage opportunity.
Deï¬nition 5.12. A stochastic process M = (Mt)t=0,...,T on a ï¬ltered probability
space (, F , (Ft), Q) is called a martingale if M is adapted, satisï¬es EQ[ |Mt| ] < âˆ
for all t, and if
Ms = EQ[ Mt | Fs ]
for 0 â‰¤s â‰¤t â‰¤T .
(5.9)
A martingale can be regarded as the mathematical formalization of a â€œfair gameâ€:
For each time s and for each horizon t > s, the conditional expectation of the future
gain Mt âˆ’Ms is zero, given the information available at s.

5.2 Arbitrage opportunities and martingale measures
229
Remark 5.13. Clearly, (5.9) is equivalent to the following condition:
Mt = EQ[ Mt+1 | Ft ]
for 0 â‰¤t â‰¤T âˆ’1.
Taking t = T in (5.9), we see that, in our context of a ï¬nite time horizon, a process
M is a martingale if and only if it arises as a sequence of successive conditional
expectations EQ[ F | Ft ] for some F âˆˆL1(, FT , Q). Consider, for example, the
density process
Zt := d 
Q
dQ

Ft
,
t = 0, . . . , T,
of a probability measure 
Q that is absolutely continuous with respect to Q. It follows
from Proposition A.11 that Zt = EQ[ ZT | Ft ], so that Z is a martingale.
â™¦
Whether or not a given process M is a martingale depends on the underlying
probability measure Q. If we wish to emphasize the dependence of the martingale
property of M on a particular measure Q, we will say that M is a Q-martingale or
that M is a martingale under the measure Q.
Deï¬nition 5.14. A probability measure Q on (, FT ) is called a martingale measure
if the discounted price process X is a (d-dimensional) Q-martingale, i.e.,
EQ[ Xi
t ] < âˆ
and
Xi
s = EQ[ Xi
t | Fs ],
0 â‰¤s â‰¤t â‰¤T, i = 1, . . . , d.
A martingale measure P âˆ—is called an equivalent martingale measure if it is equivalent
to the original measure P on FT . The set of all equivalent martingale measures is
denoted by P .
The following result is a version of Doobâ€™s fundamental â€œsystems theoremâ€ for
martingales. It states that a fair game admits no realistic gambling system which
produces a positive expected gain. Here, Y âˆ’denotes the negative part âˆ’Y âˆ§0 of a
random variable Y.
Theorem 5.15. For a probability measure Q, the following conditions are equivalent.
(a) Q is a martingale measure.
(b) If Î¾ = (Î¾0, Î¾) is self-ï¬nancing and Î¾ is bounded, then the value process V of
Î¾ is a Q-martingale.
(c) If Î¾ = (Î¾0, Î¾) is self-ï¬nancing and its value process V satisï¬es EQ[ V âˆ’
T ] < âˆ,
then V is a Q-martingale.
(d) If Î¾ = (Î¾0, Î¾) is self-ï¬nancing and its value process V satisï¬es VT â‰¥0 Q-a.s.,
then EQ[ VT ] = V0.

230
5 Dynamic arbitrage theory
Proof. (a) â‡’(b): Let V be the value process of a self-ï¬nancing trading strategy
Î¾ = (Î¾0, Î¾) such that |Î¾| is bounded by a constant c. Then
|Vt| â‰¤|V0| +
t
k=1
c

|Xk| + |Xkâˆ’1|

.
Since each |Xk| belongs to L1(Q), we have EQ[ |Vt| ] < âˆ. Moreover, for 0 â‰¤t â‰¤
T âˆ’1,
EQ[ Vt+1 | Ft ] = EQ

Vt + Î¾t+1 Â· (Xt+1 âˆ’Xt) | Ft

= Vt + Î¾t+1 Â· EQ[ Xt+1 âˆ’Xt | Ft ]
= Vt,
where we have used that Î¾t+1 is Ft-measurable and bounded.
(b) â‡’(c): We will show the following implication:
If EQ[ V âˆ’
t ] < âˆthen EQ[ Vt | Ftâˆ’1 ] = Vtâˆ’1.
(5.10)
Since EQ[ V âˆ’
T ] < âˆby assumption, we will then get
EQ[ V âˆ’
T âˆ’1 ] = EQ

EQ[ VT | FT âˆ’1 ]âˆ’
â‰¤EQ[ V âˆ’
T ] < âˆ,
due to Jensenâ€™s inequality for conditional expectations. Repeating this argument will
yield EQ[ V âˆ’
t ] < âˆand EQ[ Vt | Ftâˆ’1 ] = Vtâˆ’1 for all t. Since V0 is a ï¬nite constant,
we will also get EQ[ Vt ] = V0, which together with the fact that EQ[ V âˆ’
t ] < âˆ
implies Vt âˆˆL1(Q) for all t. Thus, the martingale property of V will follow.
To prove (5.10), note ï¬rst that EQ[ Vt | Ftâˆ’1 ] is well deï¬ned due to our assumption
EQ[ V âˆ’
t ] < âˆ. Next, let Î¾(a)
t
:= Î¾t I{|Î¾t|â‰¤a} for a > 0. Then Î¾(a)
t
Â· (Xt âˆ’Xtâˆ’1) is
a martingale increment by condition (b). In particular, Î¾(a)
t
Â· (Xt âˆ’Xtâˆ’1) âˆˆL1(Q)
and EQ[ Î¾(a)
t
Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ] = 0. Hence,
EQ[ Vt | Ftâˆ’1 ] I{|Î¾t|â‰¤a} = EQ[ Vt I{|Î¾t|â‰¤a} | Ftâˆ’1 ] âˆ’EQ[ Î¾(a)
t
Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ]
= EQ

Vt I{|Î¾t|â‰¤a} âˆ’Î¾(a)
t
Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1

= EQ

Vtâˆ’1 I{|Î¾t|â‰¤a} | Ftâˆ’1

= Vtâˆ’1 I{|Î¾t|â‰¤a}.
By sending a â†‘âˆ, we obtain (5.10).
(c) â‡’(d): By (5.2), every Q-martingale M satisï¬es
M0 = EQ[ MT | F0 ] = EQ[ MT ].
(d) â‡’(a): To prove that Xi
t âˆˆL1(Q) for given i and t, consider the deterministic
process Î¾ deï¬ned by Î¾i
s := I{sâ‰¤t} and Î¾j
s := 0 for j Ì¸= i. By Remark 5.8, Î¾ can be

5.2 Arbitrage opportunities and martingale measures
231
complemented with a predictable process Î¾0 such that Î¾ = (Î¾0, Î¾) is a self-ï¬nancing
strategy with initial investment V0 = Xi
0. The corresponding value process satisï¬es
VT = V0 +
T

s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1) = Xi
t â‰¥0.
From (d) we get
EQ[ Xi
t ] = EQ[ VT ] = V0 = Xi
0,
(5.11)
which yields Xi
t âˆˆL1(Q).
Condition (a) will follow if we can show that EQ[ Xi
t; A ] = EQ[ Xi
tâˆ’1; A ] for
given t, i, and A âˆˆFtâˆ’1. To this end, we deï¬ne a d-dimensional predictable process Î·
by Î·i
s := I{s<t} + IAc I{s=t} and Î·j
s := 0 for j Ì¸= i. As above, we take a predictable
process Î·0 such that Î· = (Î·0, Î·) is a self-ï¬nancing strategy with initial investment

V0 = Xi
0. Its terminal value is given by

VT = 
V0 +
T

s=1
Î·s Â· (Xs âˆ’Xsâˆ’1) = Xi
tIAc + Xi
tâˆ’1IA â‰¥0.
Using (d) yields
Xi
0 = 
V0 = EQ[ 
VT ] = EQ[ Xi
t; Ac ] + EQ[ Xi
tâˆ’1; A ].
Bycomparingthisidentitywith(5.11), weconcludethatEQ[Xi
t; A] = EQ[Xi
tâˆ’1; A].
Remark 5.16. (a) Suppose that the â€œobjectiveâ€ measure P is itself a martingale mea-
sure, so that the ï¬‚uctuation of prices may be viewed as a fair game. In this case, the
preceding proposition shows that there are no realistic self-ï¬nancing strategies which
would generate a positive expected gain. Thus, the assumption P âˆˆP is a strong
version of the so-called efï¬cient market hypothesis. For a market model containing
a locally risk-less bond, this strong hypothesis would imply that risk-averse investors
would not be attracted towards investing into the risky assets if their expectations are
consistent with P ; see Example 2.43.
(b) The strong assumption P âˆˆP implies, in particular, that there is no arbitrage
opportunity, i.e., no self-ï¬nancing strategy with positive expected gain and without
any downside risk. Indeed, Theorem 5.15 implies that the value process of any self-
ï¬nancing strategy with V0 â‰¤0 and VT â‰¥0 satisï¬es E[ VT ] = V0, hence VT = 0 P -
almost surely. The assumption that the market model is arbitrage-free may be viewed
as a much milder and hence more ï¬‚exible form of the efï¬cient market hypothesis. â™¦
We can now state the following dynamic version of the â€œfundamental theorem of
asset pricingâ€, which relates the absence of arbitrage opportunities to the existence of
equivalent martingale measures.

232
5 Dynamic arbitrage theory
Theorem 5.17. The market model is arbitrage-free if and only if the set P of all
equivalent martingale measures is non-empty. In this case, there exists a P âˆ—âˆˆP
with bounded density dP âˆ—/dP.
Proof. Suppose ï¬rst that there exists an equivalent martingale measure P âˆ—. Then it
follows as in Remark 5.16 (b) that the market model in which the probability measure
P is replaced by P âˆ—is arbitrage-free. Since the notion of an arbitrage opportunity
depends on the underlying measure only through its null sets and since these are
common for the two equivalent measures P and P âˆ—, it follows that also the original
market model is arbitrage-free.
Let us turn to the proof of the converse assertion. For t âˆˆ{1, . . . , T }, we deï¬ne
Kt :=

Î· Â· (Xt âˆ’Xtâˆ’1) | Î· âˆˆL0(, Ftâˆ’1, P ; Rd)

.
(5.12)
By Proposition 5.11, the market model is arbitrage-free if and only if
Kt âˆ©L0
+(, Ft, P) = {0}
(5.13)
holds for all t. Note that (5.13) depends on the measure P only through its null sets.
Condition (5.13) allows us to apply Theorem 1.54 to the tth trading period. For
t = T we obtain a probability measure 
PT â‰ˆP which has a bounded density d 
PT /dP
and which satisï¬es

ET [ XT âˆ’XT âˆ’1 | FT âˆ’1 ] = 0.
Now suppose that we already have a probability measure 
Pt+1 â‰ˆP with a bounded
density d 
Pt+1/dP such that

Et+1[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] = 0
for t + 1 â‰¤k â‰¤T.
(5.14)
The equivalence of 
Pt+1 and P implies that (5.13) also holds with P replaced by 
Pt+1.
Applying Theorem 1.54 to the tth trading period yields a probability measure 
Pt with
a bounded Ft-measurable density Zt := d 
Pt/d 
Pt+1 > 0 such that

Et[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] = 0.
Clearly, 
Pt is equivalent to P and has a bounded density, since
d 
Pt
dP =
d 
Pt
d 
Pt+1
Â· d 
Pt+1
dP
is the product of two bounded densities. Moreover, if t +1 â‰¤k â‰¤T , PropositionA.12
and the Ft-measurability of Zt = d 
Pt/d 
Pt+1 imply

Et[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] =

Et+1[ (Xk âˆ’Xkâˆ’1)Zt | Fkâˆ’1 ]

Et+1[ Zt | Fkâˆ’1 ]
= 
Et+1[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ]
= 0.

5.2 Arbitrage opportunities and martingale measures
233
Hence, (5.14) carries over from 
Pt+1 to 
Pt. We can repeat this recursion until ï¬nally
P âˆ—:= 
P1 yields the desired equivalent martingale measure.
Clearly, the absence of arbitrage in the market is independent of the choice of the
numÃ©raire, while the set P of equivalent martingale measures generally does depend
on the numÃ©raire. In order to investigate the structure of this dependence, suppose
that the ï¬rst asset S1 is P -a.s. strictly positive, so that it can serve as an alternative
numÃ©raire. The price process discounted by S1 is denoted by
Y t = (Y 0
t , Y 1
t , . . . , Y d
t ) :=
S0
t
S1t
, 1, S2
t
S1t
, . . . , Sd
t
S1t

= S0
t
S1t
Xt,
t = 0, . . . , T.
Let 
P be the set of equivalent martingale measures for Y. Then 
P Ì¸= âˆ…if and only
if P Ì¸= âˆ…, according to Theorem 5.17 and the fact that the existence of arbitrage
opportunities is independent of the choice of the numÃ©raire.
Proposition 5.18. The two sets P and 
P are related via the identity

P =
$

P âˆ— d 
P âˆ—
dP âˆ—= X1
T
X1
0
for some P âˆ—âˆˆP
%
.
Proof.
The process X1
t /X1
0 is a P âˆ—-martingale for any P âˆ—âˆˆP .
In particular,
Eâˆ—[ X1
T /X1
0 ] = 1, and the formula
d 
P âˆ—
dP âˆ—= X1
T
X1
0
deï¬nes a probability measure 
P âˆ—which is equivalent to P . Moreover, by Proposi-
tion A.12,

Eâˆ—[ Y t | Fs ] = 1
X1s
Â· Eâˆ—[ Y t Â· X1
t |Fs ]
= 1
X1s
Â· Eâˆ—[ Xt | Fs ]
= Y s.
Hence, 
P âˆ—is an equivalent martingale measure for Y, and it follows that

P âŠ‡
$

P âˆ— d 
P âˆ—
dP âˆ—= X1
T
X1
0
for some P âˆ—âˆˆP
%
.
Reversing the roles of X and Y yields the identity of the two sets.
Remark 5.19. Unless X1
T is P -a.s. constant, the two sets P and 
P satisfy
P âˆ©
P = âˆ….
This can be proved as in Remark 1.10.
â™¦

234
5 Dynamic arbitrage theory
5.3 European contingent claims
Akeytopicofmathematicalï¬nanceistheanalysisofderivativesecuritiesorcontingent
claims, i.e., of certain assets whose payoff depends on the behavior of the primary
assets S0, S1, . . . , Sd and, in some cases, also on other factors.
Deï¬nition 5.20. A non-negative random variable C on (, FT , P ) is called a Eu-
ropean contingent claim. A European contingent claim C is called a derivative of
the underlying assets S0, S1, . . . , Sd if C is measurable with respect to the Ïƒ-algebra
generated by the price process (St)t=0,...,T .
A European contingent claim has the interpretation of an asset which yields at
time T the amount C(Ï‰), depending on the scenario Ï‰ of the market evolution. T is
called the expiration date or the maturity of C. Of course, maturities prior to the ï¬nal
trading period T of our model are also possible, but unless it is otherwise mentioned,
we will assume that our European contingent claims expire at T . In Chapter 6, we will
meet another class of derivative securities, the so-called American contingent claims.
As long as there is no risk of confusion between European and American contingent
claims, we will use the term â€œcontingent claimâ€ to refer to a European contingent
claim.
Example 5.21. The owner of a European call option has the right, but not the obli-
gation, to buy an asset at time T for a ï¬xed price K, called the strike price. This
corresponds to a contingent claim of the form
Ccall = (Si
T âˆ’K)+.
Conversely, a European put option gives the right, but not the obligation, to sell the
asset at time T for a strike price K. This corresponds to the contingent claim
Cput = (K âˆ’Si
T )+.
â™¦
Example 5.22. The payoff of an Asian option depends on the average price
Si
av := 1
|T|

tâˆˆT
Si
t
of the underlying asset during a predetermined set of periods T âŠ‚{0, . . . , T }. For
instance, an average price call with strike K corresponds to the contingent claim
Ccall
av := (Si
av âˆ’K)+,
and an average price put has the payoff
Cput
av := (K âˆ’Si
av)+.
Average price options can be used, for instance, to secure regular cash streams against
exchange rate ï¬‚uctuations. For example, assume that an economic agent receives at

5.3 European contingent claims
235
each time t âˆˆT a ï¬xed amount of a foreign currency with exchange rates Si
t . In
this case, an average price put option may be an efï¬cient instrument for securing the
incoming cash stream against the risk of unfavorable exchange rates.
An average strike call corresponds to the contingent claim
(Si
T âˆ’Si
av)+,
while an average strike put pays off the amount
(Si
av âˆ’Si
T )+.
An average strike put can be used, for example, to secure the risk from selling at time T
a quantity of an asset which was bought at successive times over the period T.
â™¦
Example 5.23. The payoff of a barrier option depends on whether the price of the
underlying asset reaches a certain level before maturity. Most barrier options are
either knock-out or knock-in options. A knock-in option pays off only if the barrier B
is reached. The simplest example is a digital option
Cdig :=
ï£±
ï£²
ï£³
1
if max
0â‰¤tâ‰¤T Si
t â‰¥B,
0
otherwise,
which has a unit payoff if the price processes reaches a given upper barrier B > Si
0.
Another example is the down-and-in put with strike price K and lower barrier 
B < Si
0
which pays off
Cput
d&i :=
ï£±
ï£²
ï£³
(K âˆ’Si
T )+
if min
0â‰¤tâ‰¤T Si
t â‰¤
B,
0
otherwise.
A knock-out barrier option has a zero payoff once the price of the underlying asset
reaches the predetermined barrier. For instance, an up-and-out call corresponds to the
contingent claim
Ccall
u&o :=
ï£±
ï£²
ï£³
(Si
T âˆ’K)+
if max
0â‰¤tâ‰¤T Si
t < B,
0
otherwise;
see Figure 5.1. Down-and-out and up-and-in options are deï¬ned analogously.
â™¦
Example 5.24. Using a lookback option, one can trade the underlying asset at the
maximal or minimal price that occurred during the life of the option. A lookback call
has the payoff
Si
T âˆ’min
0â‰¤tâ‰¤T Si
t ,
while a lookback put corresponds to the contingent claim
max
0â‰¤tâ‰¤T Si
t âˆ’Si
T .
â™¦

236
5 Dynamic arbitrage theory
B
S1
0
K
T
Figure 5.1. In one scenario, the payoff of the up-and-out call becomes zero because the stock
price hits the barrier B before time T . In the other scenario, the payoff is given by (ST âˆ’K)+.
The discounted value of a contingent claim C when using the numÃ©raire S0 is
given by
H := C
S0
T
.
We will call H the discounted European claim or just the discounted claim associated
withC. Intheremainderofthistext, â€œHâ€willbethegenericnotationforthediscounted
payoff of any type of contingent claim.
The reader may wonder why we work simultaneously with the notions of a con-
tingent claim and a discounted claim. From a purely mathematical point of view,
there would be no loss of generality in assuming that the numÃ©raire asset is identically
equal to one. In fact, the entire theory to be developed in Part II can be seen as a
discrete-time â€œstochastic analysisâ€ for the d-dimensional process X = (X1, . . . , Xd)
and its â€œstochastic integralsâ€
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1)
of predictable d-dimensional processes Î¾. However, some of the economic intuition
would be lost if we would limit the discussion to this level. For instance, we have
already seen the economic relevance of the particular choice of the numÃ©raire, even
though this choice may be irrelevant from the mathematicianâ€™s point of view. As a com-
promise between the mathematicianâ€™s preference for conciseness and the economistâ€™s

5.3 European contingent claims
237
concern for keeping track explicitly of economically relevant quantities, we develop
the mathematics on the level of discounted prices, but we will continue to discuss
deï¬nitions and results in terms of undiscounted prices whenever it seems appropriate.
From now on, we will assume that our market model is arbitrage-free or, equiva-
lently, that
P Ì¸= âˆ….
Deï¬nition 5.25. A contingent claim C is called attainable (replicable, redundant) if
there exists a self-ï¬nancing trading strategy Î¾ whose terminal portfolio value coincides
with C, i.e.,
C = Î¾T Â· ST
P -a.s.
Such a trading strategy Î¾ is called a replicating strategy for C.
Clearly, a contingent claim C is attainable if and only if the corresponding dis-
counted claim H = C/S0
T is of the form
H = Î¾T Â· XT = VT = V0 +
T

t=1
Î¾t Â· (Xt âˆ’Xtâˆ’1),
for a self-ï¬nancing trading strategy Î¾ = (Î¾0, Î¾) with value process V . In this case,
we will say that the discounted claim H is attainable, and we will call Î¾ a replicating
strategy for H. The following theorem yields the surprising result that an attainable
discounted claim is automatically integrable with respect to every equivalent mar-
tingale measure. Note, however, that integrability may not hold for an attainable
contingent claim prior to discounting.
Theorem 5.26. Any attainable discounted claim H is integrable with respect to each
equivalent martingale measure, i.e.,
Eâˆ—[ H ] < âˆ
for all P âˆ—âˆˆP .
Moreover, for each P âˆ—âˆˆP the value process of any replicating strategy satisï¬es
Vt = Eâˆ—[ H | Ft ]
P -a.s. for t = 0, . . . , T .
In particular, V is a non-negative P âˆ—-martingale.
Proof. This follows from VT = H â‰¥0 and the systems theorem in the form of
Theorem 5.15.
Remark 5.27. The identity
Vt = Eâˆ—[ H | Ft ],
t = 0, . . . , T,
appearing in Theorem 5.26 has two remarkable implications. Since its right-hand side
is independent of the particular replicating strategy, all such strategies must have the

238
5 Dynamic arbitrage theory
same value process. Moreover, the left-hand side does not depend on the choice of
P âˆ—âˆˆP . Hence, Vt is a version of the conditional expectation Eâˆ—[ H | Ft ] for every
P âˆ—âˆˆP . In particular, Eâˆ—[ H ] is the same for all P âˆ—âˆˆP .
â™¦
Remark 5.28. When applied to an attainable contingent claim C prior to discounting,
Theorem 5.26 states that
Î¾t Â· St = S0
t Eâˆ—
 C
S0
T
 Ft

,
t = 0, . . . , T,
P-a.s. for all P âˆ—âˆˆP and for every replicating strategy Î¾. In particular, the initial
investment which is needed for a replication of C is given by
Î¾1 Â· S0 = S0
0Eâˆ—
 C
S0
T

.
â™¦
Let us now turn to the problem of pricing a contingent claim. Consider ï¬rst a
discounted claim H which is attainable. Then the (discounted) initial investment
Î¾1 Â· X0 = V0 = Eâˆ—[ H ]
(5.15)
needed for the replication of H can be interpreted as the unique (discounted) â€œfair
priceâ€ of H. In fact, a different price for H would create an arbitrage opportunity.
For instance, if H could be sold at time 0 for a price Ï€ which is higher than (5.15),
then selling H and buying the replicating portfolio Î¾ yields the proï¬t
Ï€ âˆ’Î¾1 Â· X0 > 0
at time 0, although the terminal portfolio value VT = Î¾T Â· XT sufï¬ces for settling the
claim H at maturity T . In order to make this idea precise, let us formalize the idea of
an â€œarbitrage-free priceâ€ of a general discounted claim H.
Deï¬nition 5.29. A real number Ï€H â‰¥0 is called an arbitrage-free price of a dis-
counted claim H, if there exists an adapted stochastic process Xd+1 such that
Xd+1
0
= Ï€H,
Xd+1
t
â‰¥0 for t = 1, . . . , T âˆ’1, and
(5.16)
Xd+1
T
= H,
and such that the enlarged market model with price process (X0, X1, . . . , Xd, Xd+1)
is arbitrage-free. The set of all arbitrage-free prices of H is denoted by (H). The
lower and upper bounds of (H) are denoted by
Ï€inf(H) := inf (H)
and
Ï€sup(H) := sup (H).

5.3 European contingent claims
239
Thus, an arbitrage-free price Ï€H of a discounted claim H is by deï¬nition a price at
which H can be traded at time 0 without introducing arbitrage opportunities into the
market model: If H is sold for Ï€H, then neither buyer nor seller can ï¬nd an investment
strategy which both eliminates all the risk and yields an opportunity to make a positive
proï¬t. Our aim in this section is to characterize the set of all arbitrage-free prices of
a discounted claim H.
Note that an arbitrage-free price Ï€H is quoted in units of the numÃ©raire asset. The
amount that corresponds to Ï€H in terms of currency units prior to discounting is equal
to
Ï€C := S0
0Ï€H,
and Ï€C is an (undiscounted) arbitrage-free price of the contingent claim C := S0
T H.
Theorem 5.30. The set of arbitrage-free prices of a discounted claim H is non-empty
and given by
(H) =

Eâˆ—[ H ] | P âˆ—âˆˆP and Eâˆ—[ H ] < âˆ

.
(5.17)
Moreover, the lower and upper bounds of (H) are given by
Ï€inf(H) = inf
P âˆ—âˆˆP
Eâˆ—[ H ]
and
Ï€sup(H) = sup
P âˆ—âˆˆP
Eâˆ—[ H ].
Proof. By Theorem 5.17, Ï€H is an arbitrage-free price for H if and only if we can
ï¬nd an equivalent martingale measure Ë†P for the market model extended via (5.16).
Ë†P must satisfy
Xi
t = Ë†E[ Xi
T | Ft]
for t = 0, . . . , T and i = 1, . . . , d + 1.
In particular, Ë†P belongs to P and satisï¬es Ï€H = Ë†E[ H ]. Thus, we obtain the inclusion
âŠ†in (5.17).
Conversely, if Ï€H = Eâˆ—[ H ] for some P âˆ—âˆˆP , then we can deï¬ne the stochastic
process
Xd+1
t
:= Eâˆ—[ H | Ft],
t = 0, . . . , T,
which satisï¬es all the requirements of (5.16). Moreover, the same measure P âˆ—is
clearly an equivalent martingale measure for the extended market model, which hence
is arbitrage-free. Thus, we obtain the identity of the two sets in (5.17).
To show that (H) is non-empty, we ï¬rst ï¬x some measure 
P â‰ˆP such that

E[ H ] < âˆ. For instance, we can take d 
P = c(1+H)âˆ’1 dP , where c is the normal-
izing constant. Under 
P , the market model is arbitrage-free. Hence, Theorem 5.17
yields P âˆ—âˆˆP such that dP âˆ—/d 
P is bounded. In particular, Eâˆ—[ H ] < âˆand hence
Eâˆ—[ H ] âˆˆ(H).
The formula for Ï€inf(H) follows immediately from (5.17) and the fact that
(H) Ì¸= âˆ…. The one for Ï€sup(H) needs an additional argument. Suppose that P âˆâˆˆP
is such that Eâˆ[ H ] = âˆ. We must show that for any c > 0 there exists some

240
5 Dynamic arbitrage theory
Ï€ âˆˆ(H) with Ï€ > c. To this end, let n be such that Ï€ := Eâˆ[ H âˆ§n ] > c, and
deï¬ne
Xd+1
t
:= Eâˆ[ H âˆ§n | Ft ],
t = 0, . . . , T.
Then P âˆis an equivalent martingale measure for the extended market model
(X0, . . . , Xd, Xd+1), which hence is arbitrage-free.
Applying the already estab-
lished fact that the set of arbitrage-free prices of any contingent claim is nonempty
to the extended market model yields an equivalent martingale measure P âˆ—for
(X0, . . . , Xd, Xd+1) such that Eâˆ—[ H ] < âˆ.
Since P âˆ—is also a martingale
measure for the original market model, the ï¬rst part of this proof implies that
Ï€ := Eâˆ—[ H ] âˆˆ(H). Finally, note that
Ï€ = Eâˆ—[ H ] â‰¥Eâˆ—[ H âˆ§n ] = Eâˆ—[ Xd+1
T
] = Xd+1
0
= Ï€ > c.
Hence, the formula for Ï€sup(H) is proved.
Example 5.31. In an arbitrage-free market model, we consider a European call op-
tion Ccall = (S1
T âˆ’K)+ with strike K > 0 and with maturity T . We assume that the
numÃ©raire S0 is the predictable price process of a locally riskless bond as in Exam-
ple 5.5. Then S0
t is increasing in t and satisï¬es S0
0 â‰¡1. For any P âˆ—âˆˆP , Theorem 5.30
yields an arbitrage-free price Ï€call of Ccall which is given by
Ï€call = Eâˆ—
 Ccall
S0
T

= Eâˆ—
 
X1
T âˆ’K
S0
T
+ 
.
Due to the convexity of the function x â†’x+ = x âˆ¨0 and our assumptions on S0,
Ï€call can be bounded below as follows:
Ï€call â‰¥

Eâˆ—

X1
T âˆ’K
S0
T
+
=

S1
0 âˆ’Eâˆ—
 K
S0
T
+
â‰¥

S1
0 âˆ’K)+.
In ï¬nancial language, this fact is usually expressed by saying that the value of the
option is higher than its â€œintrinsic valueâ€ (S1
0 âˆ’K)+, i.e., the payoff if the option were
exercised immediately. The difference of the price Ï€call of an option and its intrinsic
value is often called the â€œtime-valueâ€ of the European call option; see Figure 5.2. â™¦
Example 5.32. For a European put option Cput = (K âˆ’S1
T )+, the situation is more
complicated. If we consider the same situation as in Example 5.31, then the analogue
of (5.31) fails unless the numÃ©raire S0 is constant. In fact, as a consequence of the
put-call parity, the â€œtime valueâ€ of a put option whose intrinsic value is large (i.e., the
option is â€œin the moneyâ€) usually becomes negative; see Figure 5.3.
â™¦

5.3 European contingent claims
241
K
S1
0
Figure 5.2. The typical price of a call option as a function of S1
0 is always above the optionâ€™s
intrinsic value (S1
0 âˆ’K)+.
K
S1
0
Figure 5.3. The typical price of a European put option as a function of S1
0 compared to the
optionâ€™s intrinsic value (K âˆ’S1
0)+.
Our next aim is to characterize the structure of the set of arbitrage-free prices of a
discounted claim H. It follows from Theorem 5.30 that every arbitrage-free price Ï€H
of H must lie between the two numbers
Ï€inf(H) = inf
P âˆ—âˆˆP
Eâˆ—[ H ]
and
Ï€sup(H) = sup
P âˆ—âˆˆP
Eâˆ—[ H ].
We also know that Ï€inf(H) and Ï€sup(H) are equal if H is attainable. The following
theorem shows that also the converse implication holds, i.e., H is attainable if and
only if Ï€inf(H) = Ï€sup(H).

242
5 Dynamic arbitrage theory
Theorem 5.33. Let H be a discounted claim.
(a) If H is attainable, then the set (H) of arbitrage-free prices for H consists of
the single element V0, where V is the value process of any replicating strategy
for H.
(b) If H is not attainable, then Ï€inf(H) < Ï€sup(H) and
(H) =

Ï€inf(H), Ï€sup(H)

.
Proof. The ï¬rst assertion follows from Remark 5.27 and Theorem 5.30.
To prove (b), note ï¬rst that
(H) = { Eâˆ—[ H ] | P âˆ—âˆˆP , Eâˆ—[ H ] < âˆ}
is an interval because P is a convex set. We will show that (H) is open by construct-
ing for any Ï€ âˆˆ(H) two arbitrage-free prices Ë‡Ï€ and Ë†Ï€ for H such that Ë‡Ï€ < Ï€ < Ë†Ï€.
To this end, take P âˆ—âˆˆP such that Ï€ = Eâˆ—[ H ]. We will ï¬rst construct an equivalent
martingale measure Ë†P âˆˆP such that Ë†E[ H ] > Eâˆ—[ H ]. Let
Ut := Eâˆ—[ H | Ft ],
t = 0, . . . , T,
so that
H = U0 +
T

t=1
(Ut âˆ’Utâˆ’1).
Since H is not attainable, there must be some t âˆˆ{1, . . . , T } such that Ut âˆ’Utâˆ’1 /âˆˆ
Kt âˆ©L1(P âˆ—), where
Kt :=

Î· Â· (Xt âˆ’Xtâˆ’1) | Î· âˆˆL0(, Ftâˆ’1, P ; Rd)

.
By Lemma 1.68, Kt âˆ©L1(P âˆ—) is a closed linear subspace of L1(, Ft, P âˆ—).
Therefore, Theorem A.56 applied with B := {Ut âˆ’Utâˆ’1} and C := Kt âˆ©L1(P âˆ—)
yields some Z âˆˆLâˆ(, Ft, P âˆ—) such that
sup

Eâˆ—[ W Z ] | W âˆˆKt âˆ©L1(P âˆ—)

< Eâˆ—[ (Ut âˆ’Utâˆ’1) Z ] < âˆ.
From the linearity of Kt âˆ©L1(P âˆ—) we deduce that
Eâˆ—[ W Z ] = 0
for all W âˆˆKt âˆ©L1(P âˆ—),
(5.18)
and hence that
Eâˆ—[ (Ut âˆ’Utâˆ’1) Z ] > 0.
(5.19)
There is no loss of generality in assuming that |Z| â‰¤1/3, so that
Ë†Z := 1 + Z âˆ’Eâˆ—[ Z | Ftâˆ’1 ]

5.3 European contingent claims
243
can be taken as the density d Ë†P /dP âˆ—= Ë†Z of a new probability measure Ë†P â‰ˆP . Since
Z is Ft-measurable, the expectation of H under Ë†P satisï¬es
Ë†E[ H ] = Eâˆ—[ H Ë†Z ]
= Eâˆ—[ H ] + Eâˆ—
Eâˆ—[ H | Ft] Z

âˆ’Eâˆ—
Eâˆ—[ H | Ftâˆ’1] Eâˆ—[ Z | Ftâˆ’1]

= Eâˆ—[ H ] + Eâˆ—[ Ut Z ] âˆ’Eâˆ—[ Utâˆ’1 Z ]
> Eâˆ—[ H ],
where we have used (5.19) in the last step. On the other hand, Ë†E[ H ] â‰¤5
3Eâˆ—[ H ] <
âˆ. Thus, Ë†Ï€ := Ë†E[ H ] will yield the desired arbitrage-free price larger than Ï€ if we
have Ë†P âˆˆP .
Let us prove that Ë†P âˆˆP. For k > t, the Ft-measurability of Ë†Z and Proposi-
tion A.12 yield that
Ë†E[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] = Eâˆ—[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] = 0.
For k = t, (5.18) yields Eâˆ—[ (Xt âˆ’Xtâˆ’1) Z | Ftâˆ’1 ] = 0. Thus, it follows from
Eâˆ—[ Ë†Z | Ftâˆ’1 ] = 1 that
Ë†E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
= Eâˆ—
(Xt âˆ’Xtâˆ’1)

1 âˆ’Eâˆ—[ Z | Ftâˆ’1]

| Ftâˆ’1

+ Eâˆ—[ (Xt âˆ’Xtâˆ’1)Z | Ftâˆ’1 ]
= 0.
Finally, if k < t then P âˆ—and Ë†P coincide on Fk. Hence
Ë†E[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] = Eâˆ—[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] = 0,
and we may conclude that Ë†P âˆˆP.
It remains to construct another equivalent martingale measure Ë‡P such that
Ë‡Ï€ := Ë‡E[ H ] < Eâˆ—[ H ] = Ï€.
(5.20)
But this is simply achieved by letting
d Ë‡P
dP âˆ—:= 2 âˆ’d Ë†P
dP âˆ—,
which deï¬nes a probability measure Ë‡P â‰ˆP , because the density d Ë†P /dP âˆ—is bounded
above by 5/3 and below by 1/3. Ë‡P âˆˆP is then obvious as is (5.20).
Remark 5.34. So far, we have assumed that a contingent claim is settled at the termi-
nal time T . A natural way of dealing with an FT0-measurable payoff C0 â‰¥0 maturing
at some time T0 < T is to apply our results to the corresponding discounted claim
H0 := C0
S0
T0

244
5 Dynamic arbitrage theory
in the market model with the restricted time horizon T0. Clearly, this restricted model
is arbitrage-free. An alternative approach is to invest the payoff C0 at time T0 into the
numÃ©raire asset S0. At time T , this yields the contingent claim
C := C0 Â· S0
T
S0
T0
,
whose discounted claim
H = C
S0
T
= C0
S0
T0
is formally identical to H0. Moreover, our results can be directly applied to H. It is
intuitively clear that these two approaches for determining the arbitrage-free prices of
C0 should be equivalent. A formal proof must show that the set (H) is equal to the
set
(H0) :=

Eâˆ—
0[ H0 ] | P âˆ—
0 âˆˆP0 and Eâˆ—
0[ H0 ] < âˆ

of arbitrage-free prices of H0 in the market model whose time horizon is T0. Here,
P0 denotes the set of measures P âˆ—
0 on (, FT0) which are equivalent to P on FT0 and
which are martingale measures for the restricted price process (Xt)t=0,...,T0. Clearly,
each P âˆ—âˆˆP deï¬nes an element of P0 by restricting P âˆ—to the Ïƒ-algebra FT0. In fact,
Proposition 5.35 below shows that every element in P0 arises in this way. Thus, the
two sets of arbitrage-free prices for H and H0 coincide, i.e.,
(H) = (H0)
It follows, in particular, that H0 is attainable if and only if H is attainable.
â™¦
Proposition 5.35. Consider the situation described in Remark 5.34 and let P âˆ—
0 âˆˆP0
be given. Then there exists some P âˆ—âˆˆP whose restriction to FT0 is equal to P âˆ—
0 .
Proof. Let Ë†P âˆˆP be arbitrary, and denote by ZT0 the density of P âˆ—
0 with respect to
the restriction of Ë†P to the Ïƒ-algebra FT0. Then ZT0 is FT0-measurable, and
dP âˆ—:= ZT0 d Ë†P
deï¬nes a probability measure on F . Clearly, P âˆ—is equivalent to Ë†P and to P , and it
coincides with P âˆ—
0 on FT0. To check that P âˆ—âˆˆP , it sufï¬ces to show that Xt âˆ’Xtâˆ’1
is a martingale increment under P âˆ—for t > T0. For these t, the density ZT0 is Ftâˆ’1-
measurable, so Proposition A.12 implies that
Eâˆ—[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] = Ë†E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] = 0.
Example 5.36. Let us consider the situation of Example 5.31, where the numÃ©raire S0
is a locally riskless bond. Remark 5.34 allows us to compare the arbitrage-free prices
of two European call options C0 = (S1
T0 âˆ’K)+ and C = (S1
T âˆ’K)+ with the same

5.4 Complete markets
245
strikes and underlyings but with different maturities T0 < T . As in Example 5.31, we
get that for P âˆ—âˆˆP
Eâˆ—
 C
S0
T
 FT0

â‰¥
1
S0
T0

S1
T0 âˆ’K Eâˆ—
 S0
T0
S0
T
 FT0
+
(5.21)
â‰¥C0
S0
T0
.
Hence, if P âˆ—is used to calculate arbitrage-free prices for C0 and C, the resulting price
of C0 is lower than the price of C:
Eâˆ—
 C
S0
T

â‰¥Eâˆ—
 C0
S0
T0

.
This argument suggests that the price of a European call option should be an increasing
function of the maturity.
â™¦
5.4 Complete markets
We have seen in Theorem 5.33 that any attainable claim in an arbitrage-free market
model has a unique arbitrage-free price. Thus, the situation becomes particularly
transparent if all contingent claims are attainable.
Deï¬nition 5.37. Anarbitrage-freemarketmodeliscalledcompleteifeverycontingent
claim is attainable.
Complete market models are precisely those models in which every contingent
claim has a unique and unambiguous arbitrage-free price. However, in discrete time,
onlyaverylimitedclassofmodelsenjoysthisproperty. Thefollowingcharacterization
of market completeness is sometimes called the â€œsecond fundamental theorem of asset
pricingâ€.
Theorem 5.38. An arbitrage-free market model is complete if and only if there exists
exactly one equivalent martingale measure. In this case, the number of atoms in
(, FT , P) is bounded above by (d + 1)T .
Proof. If the model is complete, then H := IA for A âˆˆFT is an attainable discounted
claim. It follows from the results of Section 5.3 that the mapping P âˆ—â†’Eâˆ—[ H ] =
P âˆ—[ A ] is constant over the set P. Hence, there can be only one equivalent martingale
measure.
Conversely, if |P | = 1, then the set (H) of arbitrage-free prices of every dis-
counted claim H has exactly one element. Hence, Theorem 5.33 implies that H is
attainable.

246
5 Dynamic arbitrage theory
To prove the second assertion, note ï¬rst that the asserted bound on the number of
atoms in FT holds for T = 1 by Theorem 1.40 and Proposition 1.39. We proceed
by induction on T . Suppose that the assertion holds for T âˆ’1. By assumption, any
bounded FT -measurable random variable H â‰¥0 can be written as
H = VT âˆ’1 + Î¾T Â· (XT âˆ’XT âˆ’1),
where both VT âˆ’1 and Î¾T are FT âˆ’1-measurable and hence constant on each atom A of
(, FT âˆ’1, P). It follows that the dimension of the linear space Lâˆ(, FT , P [ Â· |A])
is less than or equal to d + 1. Thus, Proposition 1.39 implies that (, FT , P [ Â· |A])
has at most d + 1 atoms. Applying the induction hypothesis concludes the proof.
Below we state additional characterizations of market completeness. Denote by
Q the set of all martingale measures in the sense of Deï¬nition 5.14. Then both P and
Q are convex sets. Recall that an element of a convex set is called an extreme point
of this set if it cannot be written as a non-trivial convex combination of members of
this set.
Property (d) in the following theorem is usually called the predictable represen-
tation property, or the martingale representation property, of the P âˆ—-martingale X.
Theorem 5.39. For P âˆ—âˆˆP the following conditions are equivalent:
(a) P = {P âˆ—}.
(b) P âˆ—is an extreme point of P
(c) P âˆ—is an extreme point of Q.
(d) Every P âˆ—-martingale M can be represented as a â€œstochastic integralâ€ of a
d-dimensional predictable process Î¾:
Mt = M0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1)
for t = 0, . . . , T .
Proof. (a) â‡’(c): If P âˆ—can be written as P âˆ—= Î±Q1 + (1 âˆ’Î±)Q2 for Î± âˆˆ(0, 1) and
Q1, Q2 âˆˆQ, then Q1 and Q2 are both absolutely continuous with respect to P âˆ—. By
deï¬ning
Pi := 1
2(Qi + P âˆ—),
i = 1, 2,
we thus obtain two martingale measures P1 and P2 which are equivalent to P âˆ—. Hence,
P1 = P2 = P âˆ—and, in turn, Q1 = Q2 = P âˆ—.
(c) â‡’(b): This is obvious since P âŠ‚Q.
(b) â‡’(a): Suppose that there exists a Ë†P âˆˆP which is different from P âˆ—. We
will show below that in this case Ë†P can be chosen such that the density d Ë†P /dP âˆ—is

5.4 Complete markets
247
bounded by some constant c > 0. Then, if Îµ > 0 is less than 1/c,
dP â€²
dP âˆ—:= 1 + Îµ âˆ’Îµ d Ë†P
dP âˆ—
deï¬nes another measure P â€² âˆˆP different from P âˆ—. Moreover, P âˆ—can be represented
as the convex combination
P âˆ—=
Îµ
1 + Îµ
Ë†P +
1
1 + Îµ P â€²,
which contradicts condition (b). Hence, P âˆ—must be the unique equivalent martingale
measure.
It remains to prove the existence of Ë†P âˆˆP with a bounded density d Ë†P /dP âˆ—
if there exists some 
P âˆˆP which is different from P âˆ—. Then there exists a set
A âˆˆFT such that P âˆ—[ A ] Ì¸= 
P [ A ]. We enlarge our market model by introducing the
additional asset
Xd+1
t
:= 
P [ A | Ft ],
t = 0, . . . , T,
and we take P âˆ—instead of P as our reference measure. By deï¬nition, 
P is an equiv-
alent martingale measure for (X0, X1, . . . , Xd, Xd+1). Hence, the extended market
model is arbitrage-free, and Theorem 5.17 guarantees the existence of an equivalent
martingale measure Ë†P such that the density d Ë†P /dP âˆ—is bounded. Moreover, Ë†P must
be different from P âˆ—, since P âˆ—is not a martingale measure for Xd+1:
Xd+1
0
= 
P [ A ] Ì¸= P âˆ—[ A ] = Eâˆ—[ Xd+1
T
].
(a) â‡’(d): The terminal value MT of a P âˆ—-martingale M can be decomposed into
the difference of its positive and negative parts:
MT = M+
T âˆ’Mâˆ’
T .
M+
T and Mâˆ’
T can be regarded as two discounted claims, which are attainable by
Theorem 5.38. Hence, there exist two d-dimensional predictable process Î¾+ and Î¾âˆ’
such that
MÂ±
T = V Â±
0 +
T

k=1
Î¾Â±
k Â· (Xk âˆ’Xkâˆ’1)
P âˆ—-a.s.
for two non-negative constants V +
0 and V âˆ’
0 . Since the value processes
V Â±
t
:= V Â±
0 +
t
k=1
Î¾Â±
k Â· (Xk âˆ’Xkâˆ’1)
are P âˆ—-martingales by Theorem 5.26, we get that
Mt = Eâˆ—[ M+
T âˆ’Mâˆ’
T | Ft ] = V +
t
âˆ’V âˆ’
t .

248
5 Dynamic arbitrage theory
This proves that the desired representation of M holds in terms of the d-dimensional
predictable process Î¾ := Î¾+ âˆ’Î¾âˆ’.
(d) â‡’(a): Applying our assumption to the martingale Mt := P âˆ—[ A | Ft ] shows
that H = IA is an attainable contingent claim. Hence, it follows from the results of
Section 5.3 that the mapping P âˆ—â†’P âˆ—[ A ] is constant over the set P . Thus, there
can be only one equivalent martingale measure.
5.5 The binomial model
A complete ï¬nancial market model with only one risky asset must have a binary tree
structure, as we have seen inTheorem 5.38. Under an additional homogeneity assump-
tion, this reduces to the following particularly simple model, which was introduced
by Cox, Ross, and Rubinstein in [42]. It involves the riskless bond
S0
t := (1 + r)t,
t = 0, . . . , T,
with r > âˆ’1 and one risky asset S1 = S, whose return
Rt := St âˆ’Stâˆ’1
Stâˆ’1
in the tth trading period can only take two possible values a, b âˆˆR such that
âˆ’1 < a < b.
Thus, the stock price jumps from Stâˆ’1 either to the higher value St = Stâˆ’1(1 + b) or
to the lower value St = Stâˆ’1(1 + a). In this context, we are going to derive explicit
formulas for the arbitrage-free prices and replicating strategies of various contingent
claims.
Let us construct the model on the sample space
 := {âˆ’1, +1}T =

Ï‰ = (y1, . . . , yT ) | yi âˆˆ{âˆ’1, +1}

.
Denote by
Yt(Ï‰) := yt
for Ï‰ = (y1, . . . , yT )
(5.22)
the projection on the tth coordinate, and let
Rt(Ï‰) := a 1 âˆ’Yt(Ï‰)
2
+ b 1 + Yt(Ï‰)
2
=

a
if Yt(Ï‰) = âˆ’1,
b
if Yt(Ï‰) = +1.
The price process of the risky asset is modeled as
St := S0
t
k=1
(1 + Rk),

5.5 The binomial model
249
where the initial value S0 > 0 is a given constant. The discounted price process takes
the form
Xt = St
S0t
= S0
t
k=1
1 + Rk
1 + r .
As ï¬ltration we take
Ft := Ïƒ(S0, . . . , St) = Ïƒ(X0, . . . , Xt),
t = 0, . . . , T.
Note that F0 = {âˆ…, }, and
Ft = Ïƒ(Y1, . . . , Yt) = Ïƒ(R1, . . . , Rt)
for t = 1, . . . , T ;
F := FT coincides with the power set of . Let us ï¬x any probability measure P on
(, F ) such that
P [ {Ï‰} ] > 0
for all Ï‰ âˆˆ.
(5.23)
Such a model will be called a binomial model or a CRR model. The following theorem
characterizes those parameter values a, b, r for which the model is arbitrage-free.
Theorem 5.40. The CRR model is arbitrage-free if and only if a < r < b. In this
case, the CRR model is complete, and there is a unique martingale measure P âˆ—. The
martingale measure is characterized by the fact that the random variables R1, . . . , RT
are independent under P âˆ—with common distribution
P âˆ—[ Rt = b ] = pâˆ—:= r âˆ’a
b âˆ’a ,
t = 1, . . . , T.
Proof. A measure Q on (, F ) is a martingale measure if and only if the discounted
price process is a martingale under Q, i.e.,
Xt = EQ[ Xt+1 | Ft ] = Xt EQ
 1 + Rt+1
1 + r
 Ft

Q-a.s.
for all t â‰¤T âˆ’1. This identity is equivalent to the equation
r = EQ[ Rt+1 | Ft ] = b Â· Q[ Rt+1 = b | Ft ] + a Â·

1 âˆ’Q[ Rt+1 = b | Ft ]

,
i.e., to the condition
Q[ Rt+1 = b | Ft ](Ï‰) = pâˆ—= r âˆ’a
b âˆ’a
for Q-a.e. Ï‰ âˆˆ.
But this holds if and only if the random variables R1, . . . , RT are independent under
Q with common distribution Q[ Rt = b ] = pâˆ—. In particular, there can be at most
one martingale measure for X.

250
5 Dynamic arbitrage theory
If the market model is arbitrage-free, then there exists an equivalent martingale
measure P âˆ—. The condition P âˆ—â‰ˆP implies
pâˆ—= P âˆ—[ R1 = b ] âˆˆ(0, 1),
which holds if and only if a < r < b.
Conversely, if a < r < b then we can deï¬ne a measure P âˆ—â‰ˆP on (, F ) by
P âˆ—[ {Ï‰} ] := (pâˆ—)k Â· (1 âˆ’pâˆ—)T âˆ’k > 0
where k denotes the number of occurrences of +1 in Ï‰ = (y1, . . . , yT ). Under P âˆ—,
Y1, . . . , YT , and hence R1, . . . , RT , are independent random variables with common
distribution P âˆ—[ Yt = 1 ] = P âˆ—[ Rt = b ] = pâˆ—, and so P âˆ—is an equivalent martingale
measure.
From now on, we consider only CRR models which are arbitrage-free, and we
denote by P âˆ—the unique equivalent martingale measure.
Remark 5.41. NotethattheuniquemartingalemeasureP âˆ—, andhencethevaluationof
any contingent claim, is completely independent of the initial choice of the â€œobjectiveâ€
measure P within the class of measures satisfying (5.23).
â™¦
Let us now turn to the problem of pricing and hedging a given contingent claim C.
The discounted claim H = C/S0
T can be written as
H = h(S0, . . . , ST )
for a suitable function h.
Proposition 5.42. The value process
Vt = Eâˆ—[ H | Ft ],
t = 0, . . . , T,
of a replicating strategy for H is of the form
Vt(Ï‰) = vt

S0, S1(Ï‰), . . . , St(Ï‰)

,
where the function vt is given by
vt(x0, . . . , xt) = Eâˆ—

h

x0, . . . , xt, xt
S1
S0
, . . . , xt
ST âˆ’t
S0
 
.
(5.24)
Proof. Clearly,
Vt = Eâˆ—

h

S0, S1, . . . , St, St
St+1
St
, . . . , St
ST
St
  Ft

.

5.5 The binomial model
251
Each quotient St+s/St is independent of Ft and has under P âˆ—the same distribution as
Ss
S0
=
s
k=1
(1 + Rk).
Hence (5.24) follows from the standard properties of conditional expectations.
Since V is characterized by the recursion
VT := H
and
Vt = Eâˆ—[ Vt+1 | Ft ],
t = T âˆ’1, . . . , 0,
we obtain a recursive formula for the functions vt deï¬ned in (5.24):
vT (x0, . . . , xT ) = h(x0, . . . , xT ),
(5.25)
vt(x0, . . . , xt) = pâˆ—Â· vt+1(x0, . . . , xt, xt Ë†b) + (1 âˆ’pâˆ—) Â· vt+1(x0, . . . , xt, xt Ë†a),
where
Ë†a := 1 + a
and
Ë†b := 1 + b.
Example 5.43. If H = h(ST ) depends only on the terminal value ST of the stock
price, then Vt depends only on the value St of the current stock price:
Vt(Ï‰) = vt

St(Ï‰)

.
Moreover, the formula (5.24) for vt reduces to an expectation with respect to the
binomial distribution with parameter pâˆ—:
vt(xt) =
T âˆ’t

k=0
h

xt Ë†aT âˆ’tâˆ’k Ë†bkT âˆ’t
k

(pâˆ—)k(1 âˆ’pâˆ—)T âˆ’tâˆ’k.
In particular, the unique arbitrage-free price of H is given by
Ï€(H) = v0(S0) =
T

k=0
h

S0 Ë†aT âˆ’k Ë†bkT
k

(pâˆ—)k(1 âˆ’pâˆ—)T âˆ’k.
For h(x) = (x âˆ’K)+/(1+r)T or h(x) = (K âˆ’x)+/(1+r)T , we obtain explicit for-
mulas for the arbitrage-free prices of European call or put options with strike price K.
For instance, the price of H call := (ST âˆ’K)+/(1 + r)T is given by
Ï€(H
call) =
1
(1 + r)T
T

k=0

S0 Ë†aT âˆ’k Ë†bk âˆ’K
+
T
k

(pâˆ—)k(1 âˆ’pâˆ—)T âˆ’k.
â™¦

252
5 Dynamic arbitrage theory
Example 5.44. Denote by
Mt := max
0â‰¤sâ‰¤t Ss,
0 â‰¤t â‰¤T,
the running maximum of S, and consider a discounted claim with payoff H =
h(ST , MT ). For instance, H can be an up-and-in or up-and-out barrier option or
a lookback put. Then the value process of H is of the form
Vt = vt(St, Mt),
where
vt(xt, mt) = Eâˆ—

h

xt
ST âˆ’t
S0
, mt âˆ¨

xt
MT âˆ’t
S0
 
.
This follows from (5.24) or directly from the fact that
MT = Mt âˆ¨

St max
tâ‰¤uâ‰¤T
Su
St

,
where maxtâ‰¤uâ‰¤T Su/St is independent of Ft and has the same law as MT âˆ’t/S0 under
P âˆ—. The same argument works for options that depend on the minimum of the stock
price such as lookback calls or down-and-in barrier options.
For an Asian option depending on the average price
Sav := 1
|T|

tâˆˆT
St
during a predetermined set of periods T âŠ‚{0, . . . , T }, one introduces the process
At :=

sâˆˆT, sâ‰¤t
Ss.
Using a similar argument as above, one shows that the value process Vt of the Asian
option is a function of St, At, and t.
â™¦
Let us now derive a formula for the hedging strategy Î¾ = (Î¾0, Î¾) of our discounted
claim H = h(S0, . . . , ST ).
Proposition 5.45. The hedging strategy is given by
Î¾t(Ï‰) = t

S0, S1(Ï‰), . . . , Stâˆ’1(Ï‰)

,
where
t(x0, . . . , xtâˆ’1) := (1 + r)t vt(x0, . . . , xtâˆ’1, xtâˆ’1 Ë†b) âˆ’vt(x0, . . . , xtâˆ’1, xtâˆ’1 Ë†a)
xtâˆ’1 Ë†b âˆ’xtâˆ’1 Ë†a
.

5.6 Exotic derivatives
253
Proof. For each Ï‰ = (y1, . . . , yT ), Î¾t must satisfy
Î¾t(Ï‰)

Xt(Ï‰) âˆ’Xtâˆ’1(Ï‰)

= Vt(Ï‰) âˆ’Vtâˆ’1(Ï‰).
(5.26)
In this equation, the random variables Î¾t, Xtâˆ’1, and Vtâˆ’1 depend only on the ï¬rst t âˆ’1
components of Ï‰. For a ï¬xed t, let us deï¬ne Ï‰+ and Ï‰âˆ’by
Ï‰Â± := (y1, . . . , ytâˆ’1, Â±1, yt+1, . . . , yT ).
Plugging Ï‰+ and Ï‰âˆ’into (5.26) shows
Î¾t(Ï‰) Â·

Xtâˆ’1(Ï‰) Ë†b(1 + r)âˆ’1 âˆ’Xtâˆ’1(Ï‰)

= Vt(Ï‰+) âˆ’Vtâˆ’1(Ï‰)
Î¾t(Ï‰) Â·

Xtâˆ’1(Ï‰) Ë†a(1 + r)âˆ’1 âˆ’Xtâˆ’1(Ï‰)

= Vt(Ï‰âˆ’) âˆ’Vtâˆ’1(Ï‰).
Solving for Î¾t(Ï‰) and using our formula (5.25) for Vt, we obtain
Î¾t(Ï‰) = (1 + r)Vt(Ï‰+) âˆ’Vt(Ï‰âˆ’)
Xtâˆ’1(Ï‰)(Ë†b âˆ’Ë†a)
= t

S0, S1(Ï‰), . . . , Stâˆ’1(Ï‰)

.
Remark 5.46. The term t may be viewed as a discrete â€œderivativeâ€ of the value
function vt with respect to the possible stock price changes. In ï¬nancial language,
a hedging strategy based on a derivative of the value process is often called a Delta
hedge.
â™¦
Remark 5.47. Let H = h(ST ) be a discounted claim which depends on the terminal
value of S by way of an increasing function h. For instance, h can be the discounted
payoff function h(x) = (x âˆ’K)+/(1 + r)T of a European call option. Then
vt(x) = Eâˆ—[ h(x ST âˆ’t/S0) ]
is also increasing in x, and so the hedging strategy satisï¬es
Î¾t(Ï‰) = (1 + r)t vt

Stâˆ’1(Ï‰) Ë†b

âˆ’vt

Stâˆ’1(Ï‰) Ë†a

Stâˆ’1(Ï‰) Ë†b âˆ’Stâˆ’1(Ï‰) Ë†a
â‰¥0.
In other words, the hedging strategy for H does not involve short sales of the risky
asset.
â™¦
5.6
Exotic derivatives
The recursion formula (5.25) can be used for the numeric computation of the value
process of any contingent claim. For the value processes of certain exotic derivatives
which depend on the maximum of the stock price, it is even possible to obtain simple
closed-form solutions if we make the additional assumption that
Ë†a = 1
Ë†b
,

254
5 Dynamic arbitrage theory
where Ë†a = 1 + a and Ë†b = 1 + b. In this case, the price process of the risky asset is of
the form
St(Ï‰) = S0 Ë†bZt(Ï‰)
where, for Yk as in (5.22),
Z0 := 0
and
Zt := Y1 + Â· Â· Â· + Yt,
t = 1, . . . , T.
Let P denote the uniform distribution
P[ {Ï‰} ] :=
1
|| = 2âˆ’T ,
Ï‰ âˆˆ.
Under the measure P, the random variables Yt are independent with common distri-
bution P[ Yt = +1 ] = 1
2. Thus, the stochastic process Z becomes a standard random
walk under P. Therefore,
P[ Zt = k ] =
ï£±
ï£²
ï£³
2âˆ’t
 t
t+k
2

if t + k is even,
0
otherwise.
(5.27)
The following lemma is the key to numerous explicit results on the distribution of
Z under the measure P; see, e.g., Chapter III of [83]. For its statement, it will be
convenient to assume that the random walk Z is deï¬ned up to time T + 1; this can
always be achieved by enlarging our probability space (, F ). We denote by
Mt := max
0â‰¤sâ‰¤t Zs
the running maximum of Z.
Lemma 5.48 (Reï¬‚ection principle). For all k âˆˆN and l âˆˆN0,
P

MT â‰¥k and ZT = k âˆ’l

= P[ ZT = k + l ],
and
P

MT = k and ZT = k âˆ’l

= 2k + l + 1
T + 1
P[ ZT +1 = 1 + k + l ].
Proof. Let
Ï„(Ï‰) := inf{ t â‰¥0 | Zt(Ï‰) = k } âˆ§T.
For Ï‰ = (y1, . . . , yT ) âˆˆ we deï¬ne Ï†(Ï‰) by Ï†(Ï‰) = Ï‰ if Ï„(Ï‰) = T and by
Ï†(Ï‰) =

y1, . . . , yÏ„(Ï‰), âˆ’yÏ„(Ï‰)+1, . . . , âˆ’yT

otherwise, i.e., if the level k is reached before the deadline T . Intuitively, the two
trajectories

Zt(Ï‰)

t=0,...,T and

Zt(Ï†(Ï‰)

t=0,...,T coincide up to Ï„(Ï‰), but from then

5.6 Exotic derivatives
255
Ï„
T
k âˆ’l
k
k + l
Figure 5.4. The reï¬‚ection principle.
on the latter path is obtained by reï¬‚ecting the original one on the horizontal axis at
level k; see Figure 5.4.
Let Ak,l denote the set of all Ï‰ âˆˆ such that ZT (Ï‰) = k âˆ’l and MT â‰¥k. Then
Ï† is a bijection from Ak,l to the set

MT â‰¥k and ZT = k + l

,
which coincides with {ZT = k + l}, due to our assumption l â‰¥0. Hence, the uniform
distribution P must assign the same probability to Ak,l and {ZT = k + l}, and we
obtain our ï¬rst formula.
The second formula is trivial in case T + k + l is not even. Otherwise, we let
j := (T + k + l)/2 and apply (5.27) together with part one of this lemma:
P

MT = k; ZT = k âˆ’l

= P

MT â‰¥k; ZT = k âˆ’l

âˆ’P

MT â‰¥k + 1; ZT = k âˆ’l

= P[ ZT = k + l ] âˆ’P[ ZT = k + l + 2 ]
= 2âˆ’T
T
j

âˆ’2âˆ’T
 T
j + 1

= 2âˆ’T
T + 1
j + 1
 2j + 1 âˆ’T
T + 1
,
and this expression is equal to the right-hand side of our second formula.

256
5 Dynamic arbitrage theory
Formula (5.27) changes as follows if we replace the uniform distribution P by our
martingale measure P âˆ—, described in Theorem 5.40:
P âˆ—[ Zt = k ] =
ï£±
ï£²
ï£³
(pâˆ—)
t+k
2 (1 âˆ’pâˆ—)
tâˆ’k
2
 t
t+k
2

if t + k is even,
0
otherwise.
Let us now show how the reï¬‚ection principle carries over to P âˆ—.
Lemma 5.49 (Reï¬‚ection principle for P âˆ—). For all k âˆˆN and l âˆˆN0,
P âˆ—
MT â‰¥k, ZT = k âˆ’l

=
	1 âˆ’pâˆ—
pâˆ—

l
P âˆ—[ ZT = k + l ]
=
	
pâˆ—
1 âˆ’pâˆ—

k
P âˆ—[ ZT = âˆ’k âˆ’l ],
and
P âˆ—
MT = k, ZT = k âˆ’l

= 1
pâˆ—Â·
	1 âˆ’pâˆ—
pâˆ—

l
Â· k + l + 1
T + 1
P âˆ—[ ZT +1 = 1 + k + l ]
=
1
1 âˆ’pâˆ—Â·
	
pâˆ—
1 âˆ’pâˆ—

k
Â· k + l + 1
T + 1
P âˆ—[ ZT +1 = âˆ’1 âˆ’k âˆ’l ].
Proof. We show ï¬rst that the density of P âˆ—with respect to P is given by
dP âˆ—
dP = 2T Â· (pâˆ—)
T +ZT
2
(1 âˆ’pâˆ—)
T âˆ’ZT
2
.
Indeed, P âˆ—puts the weight
P âˆ—[ {Ï‰} ] = (pâˆ—)k(1 âˆ’pâˆ—)T âˆ’k
to each Ï‰ = (y1, . . . , yT ) âˆˆ which contains exactly k components with yi = +1.
But for such an Ï‰ we have ZT (Ï‰) = k âˆ’(T âˆ’k) = 2k âˆ’T , and our formula follows.
From the density formula, we get
P âˆ—
MT â‰¥k and ZT = k âˆ’l

= 2T (pâˆ—)
T +kâˆ’l
2
(1 âˆ’pâˆ—)
T +lâˆ’k
2
P

MT â‰¥k and ZT = k âˆ’l

.
Applying the reï¬‚ection principle and using again the density formula, we see that the
probability term on the right is equal to
P[ ZT = k + l ] = 2âˆ’T (pâˆ—)âˆ’T +k+l
2
(1 âˆ’pâˆ—)âˆ’T âˆ’kâˆ’l
2
P âˆ—[ ZT = k + l ],
which gives the ï¬rst identity. The proof of the remaining ones is analogous.

5.6 Exotic derivatives
257
Example 5.50 (Up-and-in call option). Consider an up-and-in call option of the form
Ccall
u&i =
ï£±
ï£²
ï£³
(ST âˆ’K)+
if max
0â‰¤tâ‰¤T St â‰¥B,
0
otherwise,
where B > S0 âˆ¨K denotes a given barrier, and where K > 0 is the strike price. Our
aim is to compute the arbitrage-free price
Ï€(Ccall
u&i) =
1
(1 + r)T Eâˆ—[ Ccall
u&i ].
Clearly,
Eâˆ—
Ccall
u&i

= Eâˆ—
(ST âˆ’K)+; max
0â‰¤tâ‰¤T St â‰¥B

=Eâˆ—
(ST âˆ’K)+; ST â‰¥B

+ Eâˆ—
(ST âˆ’K)+; max
0â‰¤tâ‰¤T St â‰¥B, ST < B

.
The ï¬rst expectation on the right can be computed explicitly in terms of the binomial
distribution. Thus, it remains to compute the second expectation, which we denote
by I. To this end, we may assume without loss of generality that B lies within the
range of possible asset prices, i.e., there exists some k âˆˆN such that B = S0 Ë†bk. Then,
by Lemma 5.49,
I =

lâ‰¥1
Eâˆ—
(ST âˆ’K)+; MT â‰¥k, ZT = k âˆ’l

=

lâ‰¥1
(S0 Ë†bkâˆ’l âˆ’K)+P âˆ—[ MT â‰¥k, ZT = k âˆ’l ]
=

lâ‰¥1
(S0 Ë†bkâˆ’l âˆ’K)+	
pâˆ—
1 âˆ’pâˆ—

k
P âˆ—[ ZT = âˆ’k âˆ’l ]
=
	
pâˆ—
1 âˆ’pâˆ—

k Ë†b2k 
lâ‰¥1
(S0 Ë†bâˆ’kâˆ’l âˆ’
K)+P âˆ—[ ZT = âˆ’k âˆ’l ]
=
	
pâˆ—
1 âˆ’pâˆ—

k	 B
S0

2
Eâˆ—
(ST âˆ’
K)+; ST < B

,
where

K = K Ë†bâˆ’2k = K
	S0
B

2
.
Hence, we obtain the formula
Ï€(Ccall
u&i) =
1
(1 + r)T

Eâˆ—
(ST âˆ’K)+; ST â‰¥B

+
	
pâˆ—
1 âˆ’pâˆ—

k	 B
S0

2
Eâˆ—
(ST âˆ’
K)+; ST < B

.

258
5 Dynamic arbitrage theory
Both expectations on the right now only involve the binomial distribution with param-
eters pâˆ—and T . They can be computed as in Example 5.43, and so we get the explicit
formula
Ï€(Ccall
u&i) =
1
(1 + r)T
 nk

n=0
(S0 Ë†bT âˆ’2n âˆ’K)+(pâˆ—)T âˆ’n(1 âˆ’pâˆ—)n

T
T âˆ’n

+
	
pâˆ—
1 âˆ’pâˆ—

k	 B
S0

2
T

n=nk+1
(S0 Ë†bT âˆ’2n âˆ’
K)+(pâˆ—)T âˆ’n(1 âˆ’pâˆ—)n

T
T âˆ’n

,
where nk is the largest integer n such that T âˆ’2n â‰¥k.
â™¦
Example 5.51 (Up-and-out call option). Consider an up-and-out call option of the
form
Ccall
u&o =
ï£±
ï£²
ï£³
0
if max
0â‰¤tâ‰¤T St â‰¥B,
(ST âˆ’K)+
otherwise,
where K > 0 is the strike price and B > S0 âˆ¨K is an upper barrier for the stock price.
As in the preceding example, we assume that B = S0(1 + b)k for some k âˆˆN. Let
Ccall := (ST âˆ’K)+
denote the corresponding â€œplain vanilla callâ€, whose arbitrage-free price is given by
Ï€

Ccall
=
1
(1 + r)T Eâˆ—[ (ST âˆ’K)+ ].
Since Ccall = Ccall
u&o + Ccall
u&i, we get from Example 5.50 that
Ï€

Ccall
u&o

= Ï€

Ccall
âˆ’Ï€

Ccall
u&i

=
1
(1 + r)T

Eâˆ—
(ST âˆ’K)+; ST < B

âˆ’
	
pâˆ—
1 âˆ’pâˆ—

k	 B
S0

2
Eâˆ—
(ST âˆ’
K)+; ST < B

.
where 
K = KS2
0/B2. These expectations can be computed as in Example 5.50.
â™¦
Similarly, one obtains pricing formulas for barrier options with a lower stock
price barrier such as down-and-out put options or down-and-in calls. In the following
example, we compute the price of a lookback put option. Lookback call options are
handled in the same manner.
Example 5.52 (Lookback put option). A lookback put option corresponds to the con-
tingent claim
Cput
max := max
0â‰¤tâ‰¤T St âˆ’ST ;

5.7 Convergence to the Blackâ€“Scholes price
259
see Example 5.24. In the CRR model, the discounted arbitrage-free price of Cput
max is
given by
Ï€

Cput
max

=
1
(1 + r)T Eâˆ—
max
0â‰¤tâ‰¤T St

âˆ’S0.
The expectation of the maximum can be computed as
Eâˆ—
max
0â‰¤tâ‰¤T St

= S0
T

k=0
Ë†bk P âˆ—
MT = k

Lemma 5.49 yields
P âˆ—[ MT = k ] =

lâ‰¥0
P âˆ—[ MT = k, ZT = k âˆ’l ]
=

lâ‰¥0
1
1 âˆ’pâˆ—
	
pâˆ—
1 âˆ’pâˆ—

k k + l + 1
T + 1 P âˆ—[ ZT +1 = âˆ’1 âˆ’k âˆ’l ]
=
1
1 âˆ’pâˆ—
	
pâˆ—
1 âˆ’pâˆ—

k
1
T + 1Eâˆ—[ âˆ’ZT +1; ZT +1 â‰¤âˆ’1 âˆ’k ].
Thus, we arrive at the formula
Ï€

Cput
max

+ S0 =
S0
(1 + r)T (1 âˆ’pâˆ—)(T + 1) Â·
Â·
T

k=0
Ë†bk	
pâˆ—
1 âˆ’pâˆ—

k
Eâˆ—[ âˆ’ZT +1; ZT +1 â‰¤âˆ’1 âˆ’k ].
As before, one can give explicit formulas for the expectations occurring on the right. â™¦
5.7 Convergence to the Blackâ€“Scholes price
In practice, a huge number of trading periods may occur between the current time
t = 0 and the maturity T of a European contingent claim. Thus, the computation
of option prices in terms of some martingale measure may become rather elaborate.
On the other hand, one can hope that the pricing formulas in discrete time converge
to a transparent limit as the number of intermediate trading periods grows larger and
larger. In this section, we will formulate conditions under which such a convergence
occurs.
Throughout this section, T will not denote the number of trading periods in a ï¬xed
discrete-time market model but rather a physical date. The time interval [0, T ] will be
divided into N equidistant time steps T
N , 2T
N , . . . , NT
N , and the date kT
N will correspond
to the kth trading period of an arbitrage-free market model. For simplicity, we will

260
5 Dynamic arbitrage theory
assume that each market model contains a riskless bond and just one risky asset. In
the Nth approximation, the risky asset will be denoted by S(N), and the riskless bond
will be deï¬ned by a constant interest rate rN > âˆ’1.
The question is whether the prices of contingent claims in the approximating
market models converge as N tends to inï¬nity.
Since the terminal values of the
riskless bonds should converge, we assume that
lim
Nâ†‘âˆ(1 + rN)N = erT ,
where r is a ï¬nite constant. This condition is in fact equivalent to the following one:
lim
Nâ†‘âˆN rN = r T.
Let us now consider the risky assets. We assume that the initial prices S(N)
0
do not
depend on N, i.e., S(N)
0
= S0 for some constant S0 > 0. The prices S(N)
k
are random
variables on some probability space (N, F (N), P âˆ—
N), where P âˆ—
N is a risk-neutral
measure for each approximating market model, i.e., the discounted price process
X(N)
k
:=
S(N)
k
(1 + rN)k ,
k = 0, . . . , N,
is a P âˆ—
N-martingale with respect to the ï¬ltration F (N)
k
:= Ïƒ(S(N)
1
, . . . , S(N)
k
). Our
remaining conditions will be stated in terms of the returns
R(N)
k
:= S(N)
k
âˆ’S(N)
kâˆ’1
S(N)
kâˆ’1
,
k = 1, . . . , N.
First, we assume that, for each N, the random variables R(N)
1
, . . . , R(N)
N
are indepen-
dent under P âˆ—
N and satisfy
âˆ’1 < Î±N â‰¤R(N)
k
â‰¤Î²N,
k = 1, . . . , N,
for constants Î±N and Î²N such that
lim
Nâ†‘âˆÎ±N = lim
Nâ†‘âˆÎ²N = 0.
Second, we assume that the variances varN

R(N)
k

under P âˆ—
N are such that
Ïƒ 2
N := 1
T
N

k=1
varN

R(N)
k

âˆ’â†’Ïƒ 2 âˆˆ(0, âˆ).
The following result can be regarded as a multiplicative version of the central limit
theorem.

5.7 Convergence to the Blackâ€“Scholes price
261
Theorem 5.53. Under the above assumptions, the distributions of S(N)
N
under P âˆ—
N
converge weakly to the log-normal distribution with parameters log S0 + rT âˆ’1
2 Ïƒ 2T
and Ïƒ
âˆš
T , i.e., to the distribution of
ST := S0 exp

Ïƒ WT +

r âˆ’1
2Ïƒ 2

T

,
(5.28)
where WT has a centered normal law N(0, T ) with variance T .
Proof. We may assume without loss of generality that S0 = 1. Consider the Taylor
expansion
log(1 + x) = x âˆ’1
2 x2 + Ï(x) x2
(5.29)
where the remainder term Ï is such that
|Ï(x)| â‰¤Î´(Î±, Î²)
for âˆ’1 < Î± â‰¤x â‰¤Î²,
and where Î´(Î±, Î²) â†’0 for Î±, Î² â†’0. Applied to
S(N)
N
=
N

k=1

1 + R(N)
k

,
this yields
log S(N)
N
=
N

k=1

R(N)
k
âˆ’1
2

R(N)
k
2
+ N,
where
|N| â‰¤Î´(Î±N, Î²N)
N

k=1

R(N)
k
2.
Since P âˆ—
N is a martingale measure, we have Eâˆ—
N[ R(N)
k
] = rN, and it follows that
Eâˆ—
N[ |N| ] â‰¤Î´(Î±N, Î²N)
N

k=1

varN

R(N)
k

+ r2
N

âˆ’â†’0.
In particular, N â†’0 in probability, and the corresponding laws converge weakly
to the Dirac measure Î´0. Slutskyâ€™s theorem, as stated in Appendix A.6, asserts that it
sufï¬ces to show that the distributions of
ZN :=
N

k=1

R(N)
k
âˆ’1
2

R(N)
k
2
=:
N

k=1
Y (N)
k
converge weakly to the normal law N(rT âˆ’1
2Ïƒ 2T, Ïƒ 2T ). To this end, we will check
that the conditions of the central limit theorem in the form of Theorem A.36 are
satisï¬ed.

262
5 Dynamic arbitrage theory
Note that
max
1â‰¤kâ‰¤N
Y (N)
k
 â‰¤Î³N + 1
2Î³ 2
N âˆ’â†’0
for Î³N := |Î±N| âˆ¨|Î²N|, and that
Eâˆ—
N[ ZN ] = NrN âˆ’1
2

Ïƒ 2
N T + Nr2
N

âˆ’â†’r T âˆ’1
2 Ïƒ 2 T.
Finally,
varN(ZN) âˆ’â†’Ïƒ 2 T,
since for p > 2
N

k=1
Eâˆ—
N
R(N)
k
p
â‰¤Î³ pâˆ’2
N
N

k=1
Eâˆ—
N

R(N)
k
2
âˆ’â†’0.
Thus, the conditions of Theorem A.36 are satisï¬ed.
Remark 5.54. The assumption of independent returns in Theorem 5.53 can be re-
laxed. Instead of Theorem A.36, we can apply a central limit theorem for martingales
under suitable assumptions on the behavior of the conditional variances
varN( R(n)
k
| Fkâˆ’1 ) ;
for details see, e.g., Section 9.3 of [39].
â™¦
Example 5.55. Suppose the approximating model in the Nth stage is a CRR model
with interest rate
rN = r T
N ,
and with returns R(N)
k
, which can take the two possible values aN and bN; see Sec-
tion 5.5. We assume that
Ë†aN = 1 + aN = eâˆ’ÏƒâˆšT /N
and
Ë†bN = 1 + bN = eÏƒâˆšT/N
for some given Ïƒ > 0. Since
âˆš
NrN âˆ’â†’0,
âˆš
NaN âˆ’â†’âˆ’Ïƒ
âˆš
T ,
âˆš
NbN âˆ’â†’Ïƒ
âˆš
T
as N â†‘âˆ,
(5.30)
we have aN < rN < bN for large enough N. Theorem 5.40 yields that the Nth model
is arbitrage-free and admits a unique equivalent martingale measure P âˆ—
N. The measure
P âˆ—
N is characterized by
P âˆ—
N[ R(N)
k
= bN] =: pâˆ—
N = rN âˆ’aN
bN âˆ’aN
,

5.7 Convergence to the Blackâ€“Scholes price
263
and we obtain from (5.30) that
lim
Nâ†‘âˆpâˆ—
N = 1
2.
Moreover, Eâˆ—
N[ R(N)
k
] = rN, and we get
N

k=1
varN

R(N)
k

= N

pâˆ—
Nb2
N + (1 âˆ’pâˆ—
N)a2
N âˆ’r2
N

âˆ’â†’Ïƒ 2T
as N â†‘âˆ. Hence, the assumptions of Theorem 5.53 are satisï¬ed.
â™¦
Let us consider a derivative which is deï¬ned in terms of a function f â‰¥0 of
the risky assetâ€™s terminal value. In each approximating model, this corresponds to a
contingent claim
C(N) = f

S(N)
N

.
Corollary 5.56. If f is bounded and continuous, the arbitrage-free prices of C(N)
calculated under P âˆ—
N converge to a discounted expectation with respect to a log-normal
distribution, which is often called the Blackâ€“Scholes price. More precisely,
lim
Nâ†‘âˆEâˆ—
N

C(N)
(1 + rN)N

= eâˆ’rT Eâˆ—[ f (ST )]
= eâˆ’rT
âˆš
2Ï€
 âˆ
âˆ’âˆ
f

S0eÏƒ
âˆš
T y+rT âˆ’Ïƒ 2T/2
eâˆ’y2/2 dy,
(5.31)
where ST has the form (5.28) under P âˆ—.
This convergence result applies in particular to the choice f (x) = (K âˆ’x)+
corresponding to a European put option with strike K. Since the put-call parity
Eâˆ—
N
 (S(N)
N
âˆ’K)+
(1 + rN)N

= Eâˆ—
N
 (K âˆ’S(N)
N )+
(1 + rN)N

+ S0 âˆ’
K
(1 + rN)N
holds for each N, the convergence (5.31) is also true for a European call option with
the unbounded payoff proï¬le f (x) = (x âˆ’K)+.
Example 5.57 (Blackâ€“Scholes formula for the price of a call option).
The limit of
the arbitrage-free prices of C(N) = (S(N)
N
âˆ’K)+ is given by v(S0, T ), where
v(x, T ) = eâˆ’rT
 âˆ
âˆ’âˆ

xeÏƒ
âˆš
T y+rT âˆ’Ïƒ 2T/2 âˆ’K
+eâˆ’y2/2 dy.
The integrand on the right vanishes for
y â‰¤âˆ’log x
K +

r âˆ’1
2Ïƒ 2
T
Ïƒ
âˆš
T
=: âˆ’dâˆ’(x, T ) =: âˆ’dâˆ’.

264
5 Dynamic arbitrage theory
Let us also deï¬ne
d+ := d+(x, T ) := dâˆ’(x, T ) + Ïƒ
âˆš
T = log x
K +

r + 1
2Ïƒ 2
T
Ïƒ
âˆš
T
,
and let us denote by (z) = (2Ï€)âˆ’1  x
âˆ’âˆeâˆ’y2/2 dy the distribution function of the
standard normal distribution. Then
v(x, T ) =
x
âˆš
2Ï€
 +âˆ
âˆ’dâˆ’
eâˆ’(yâˆ’Ïƒ
âˆš
T )2/2 dy âˆ’eâˆ’rT K

1 âˆ’(âˆ’dâˆ’)

,
and we arrive at the Blackâ€“Scholes formula for the price of a European call option
with strike K and maturity T :
v(x, T ) = x (d+(x, T )) âˆ’eâˆ’rT K(dâˆ’(x, T )).
(5.32)
See Figure 5.5 for the plot of the function v(x, t).
â™¦
0
0
t
T
2K
K
Figure 5.5. The Blackâ€“Scholes price v(x, t) of a European call option (ST âˆ’K)+ plotted as a
function of the initial spot price x = S0 and the time to maturity t.
Remark 5.58. For ï¬xed x and T , the Blackâ€“Scholes price of a European call option
increases to the upper arbitrage bound x as Ïƒ â†‘âˆ. In the limit Ïƒ â†“0, we obtain the
lower arbitrage bound (x âˆ’eâˆ’rT K)+; see Remark 1.36.
â™¦
The following proposition gives a criterion for the convergence (5.31) in case f is
not necessarily bounded and continuous. It applies in particular to f (x) = (x âˆ’K)+,
and so we get an alternative proof for the convergence of call option prices to the
Blackâ€“Scholes price.

5.7 Convergence to the Blackâ€“Scholes price
265
Proposition 5.59. Let f : (0, âˆ) â†’R be measurable, continuous a.e., and such
that |f (x)| â‰¤c (1 + x)q for some c â‰¥0 and 0 â‰¤q < 2. Then
Eâˆ—
N

f

S(N)
N
 
âˆ’â†’Eâˆ—
f (ST )

,
where ST has the form (5.28) under P âˆ—.
Proof. Let us note ï¬rst that by the Taylor expansion (5.29)
log Eâˆ—
N
 
S(N)
N
2 
= log
N

k=1

varN

1 + R(N)
k

+ Eâˆ—
N

1 + R(N)
k
2
=
N

k=1
log

varN

R(N)
k

+ (1 + rN)2
â‰¤Ïƒ 2
NT + 2N rN + N r2
N +c
N

k=1

varN

R(N)
k

+ 2|rN| + r2
N
2
for a ï¬nite constant c. Thus,
sup
N
Eâˆ—
N
 
S(N)
N
2 
< âˆ.
With this property established, the assertion follows immediately from Theorem 5.53
and the Corollaries A.45 and A.46, but we also give the following more elementary
proof. To this end, we may assume that q > 0, and we deï¬ne p := 2/q > 1. Then
sup
N
Eâˆ—
N
 f

S(N)
N
p 
â‰¤cp sup
N
Eâˆ—
N
 
1 + S(N)
N
2 
< âˆ,
and the assertion follows from Lemma 5.60 below.
Lemma 5.60. Suppose (ÂµN)NâˆˆN is a sequence of probability measures on R con-
verging weakly to Âµ. If f is a measurable and Âµ-a.e. continuous function on R such
that
c := sup
NâˆˆN

|f |p dÂµN < âˆ
for some p > 1,
then

f dÂµN âˆ’â†’

f dÂµ.
Proof. We may assume without loss of generality that f â‰¥0. Then fk := f âˆ§k is a
bounded and Âµ-a.e. continuous function for each k > 0. Clearly,

f dÂµN =

fk dÂµN +

(f âˆ’k)+ dÂµN.

266
5 Dynamic arbitrage theory
Due to part (e) of the portmanteau theorem in the form of Theorem A.38, the ï¬rst
integral on the right converges to

fk dÂµ as N â†‘âˆ. Let us consider the second term
on the right:

(f âˆ’k)+ dÂµN â‰¤

{f >k}
f dÂµN â‰¤
1
kpâˆ’1

f pâˆ’1f dÂµN â‰¤
c
kpâˆ’1 ,
uniformly in N. Hence,

fk dÂµ = lim
Nâ†‘âˆ

fk dÂµN â‰¤lim inf
Nâ†‘âˆ

f dÂµN
â‰¤lim sup
Nâ†‘âˆ

f dÂµN â‰¤

fk dÂµ +
c
kpâˆ’1 .
Letting k â†‘âˆ, we have

fk dÂµ â†—

f dÂµ, and convergence follows.
Let us now continue the discussion of the Blackâ€“Scholes price of a European call
option where f (x) = (x âˆ’K)+. We are particularly interested how it depends on the
various model parameters. The dependence on the spot price S0 = x can be analyzed
via the x-derivatives of the function v(t, x) appearing in the Blackâ€“Scholes formula
(5.32). The ï¬rst derivative
(x, t) := âˆ‚
âˆ‚x v(x, t) = 

d+(x, t)

is called the optionâ€™s Delta; see Figure 5.6. In analogy to the formula for the hedging
strategy in the binomial model obtained in Proposition (5.45), (x, t) determines the
â€œDelta hedging portfolioâ€ needed for a replication of the call option in continuous
time, as explained in (5.37) below.
The Gamma of the call option is given by
(x, t) := âˆ‚
âˆ‚x (x, t) = âˆ‚2
âˆ‚x2 v(x, t) = Ï•

d+(x, t)

1
xÏƒâˆšt ;
see Figure 5.7. Here Ï•(x) = â€²(x) = eâˆ’x2/2/
âˆš
2Ï€ stands as usual for the density
of the standard normal distribution. Large Gamma values occur in regions where the
Delta changes rapidly, corresponding to the need for frequent readjustments of the
Delta hedging portfolio. Note that  is always strictly positive. It follows that v(x, t)
is a strictly convex function of its ï¬rst argument.

5.7 Convergence to the Blackâ€“Scholes price
267
0
1
0
2
t
T
K
K
Figure 5.6. The Delta (x, t) of the Blackâ€“Scholes price of a European call option.
0
0
2
t
T
K
K
Figure 5.7. The optionâ€™s Gamma (x, t).
Remark 5.61. On the one hand, 0 â‰¤(x, t) â‰¤1 implies that
|v(x, t) âˆ’v(y, t)| â‰¤|x âˆ’y|.
Thus, the total change of the option values is always less than a corresponding change
in the asset prices. On the other hand, the strict convexity of x â†’v(x, t) together
with (A.1) yields that for t > 0 and z > y
v(z, t) âˆ’v(y, t)
z âˆ’y
> v(y, t) âˆ’v(0, t)
y âˆ’0
= v(y, t)
y

268
5 Dynamic arbitrage theory
and hence
v(z, t) âˆ’v(y, t)
v(y, t)
> z âˆ’y
y
.
Similarly, one obtains
v(x, t) âˆ’v(y, t)
v(y, t)
< x âˆ’y
y
for x < y. Thus, the relative change of option prices is larger in absolute value than
the relative change of asset values. This fact can be interpreted as the leverage effect
for call options; see also Example 1.41.
â™¦
Another important parameter is the Theta
(x, t) := âˆ‚
âˆ‚t v(x, t) = xÏƒ
2âˆšt Ï•

d+(x, t)

+ Kr eâˆ’rt

dâˆ’(x, t)

;
see Figure 5.8. The fact  > 0 corresponds to our general observation, made in Ex-
ample 5.36, that arbitrage-free prices of European call options are typically increasing
functions of the maturity.
0
0
2
t
T
K
K
Figure 5.8. The Theta (x, t).
Note that, for t > 0, the parameters , , and  are related by the equation
(x, t) = rx (x, t) + 1
2Ïƒ 2x2 (x, t) âˆ’r v(x, t).
Thus, for (x, t) âˆˆ(0, âˆ) Ã— (0, âˆ), the function v solves the partial differential
equation
âˆ‚v
âˆ‚t = rx âˆ‚v
âˆ‚x + 1
2Ïƒ 2x2 âˆ‚2v
âˆ‚x2 âˆ’rv,
(5.33)

5.7 Convergence to the Blackâ€“Scholes price
269
often called the Blackâ€“Scholes equation. Since
v(x, t) âˆ’â†’f (x) = (x âˆ’K)+
as t â†“0,
(5.34)
v(x, t) is a solution of the Cauchy problem deï¬ned via (5.33) and (5.34). This fact is
not limited to call options, it remains valid for all reasonable payoff proï¬les f .
Proposition 5.62. Let f be a continuous function on (0, âˆ) such that |f (x)| â‰¤
c(1 + x)p for some c, p â‰¥0, and deï¬ne
u(x, t) := eâˆ’rtEâˆ—[ f (St) ] = eâˆ’rt
âˆš
2Ï€
 âˆ
âˆ’âˆ
f

xeÏƒâˆšty+rtâˆ’Ïƒ 2t/2
eâˆ’y2/2 dy,
where St = x exp(ÏƒWt + rt âˆ’Ïƒ 2t/2) and Wt has law N(0, t) under P âˆ—. Then
u solves the Cauchy problem deï¬ned by the Blackâ€“Scholes equation (5.33) and the
initial condition limtâ†“0 u(x, t) = f (x), locally uniformly in x.
Proof. By using the formula (2.20) for the density of a log-normally distributed random
variable, we obtain
Eâˆ—[ f (St) ] =
 âˆ
0
1
yÏƒâˆšt Ï•
	log y âˆ’rt + Ïƒ 2t/2 âˆ’log x
Ïƒâˆšt

f (y) dy,
where Ï•(x) = eâˆ’x2/2/
âˆš
2Ï€. The validity of (5.33) can now be checked by differen-
tiating under the integral. The initial condition is veriï¬ed via Lebesgueâ€™s theorem.
Recall that the Blackâ€“Scholes price v(S0, T ) was obtained as the expectation of
the discounted payoff eâˆ’rT (ST âˆ’K)+ under the measure P âˆ—. Thus, at a ï¬rst glance,
it may come as a surprise that the Rho of the option,
Ï±(x, t) := âˆ‚
âˆ‚r v(x, t) = Kt eâˆ’rt 

dâˆ’(x, t)

,
is strictly positive, i.e., the price is increasing in r; see Figure 5.9. Note, however, that
the measure P âˆ—depends itself on the interest rate r, since Eâˆ—[ eâˆ’rT ST ] = S0. In a
simple one-period model, we have already seen this effect in Example 1.41.
The parameter Ïƒ is called the volatility. As we have seen, the Blackâ€“Scholes price
of a European call option is an increasing function of the volatility, and this is reï¬‚ected
in the strict positivity of
V(x, t) := âˆ‚
âˆ‚Ïƒ v(x, t) = x
âˆš
t Ï•

d+(x, t)

;
(5.35)
see Figure 5.10. The function V is often called the Vega of the call option price, and
the functions , , , Ï±, and V are usually called the Greeks (although â€œvegaâ€ does
not correspond to a letter of the Greek alphabet).

270
5 Dynamic arbitrage theory
0
0
2
t
T
K
K
Figure 5.9. The Rho Ï±(x, t) of a call option.
0
0
t
T
K
K
2
Figure 5.10. The Vega V(x, t).
Let us conclude this section with some informal comments on the dynamic picture
behind the convergence result in Theorem 5.53 and the pricing formulas in Exam-
ple 5.57 and Proposition 5.59. The constant r is viewed as the interest rate of a
riskfree savings account
S0
t = ert,
0 â‰¤t â‰¤T.
The prices of the risky asset in each discrete-time model are considered as a continuous
process S(N) =
S(N)
t

0â‰¤tâ‰¤T , deï¬ned as S(N)
t
:= S(N)
k
at the dates t = kT
N , and by
linear interpolation in between. Theorem 5.53 shows that the distributions of S(N)
t

5.7 Convergence to the Blackâ€“Scholes price
271
converge for each ï¬xed t weakly to the distribution of
St = S0 exp
	
Ïƒ Wt +
	
r âˆ’1
2Ïƒ 2
t

,
(5.36)
where Wt has a centered normal distribution with variance t. In fact, one can prove
convergence in the much stronger sense of a functional central limit theorem:
The laws of the processes S(N), considered as C[0, T ]-valued random variables on
(N, F (N), P âˆ—
N), converge weakly to the law of a geometric Brownian motion S =
(St)0â‰¤tâ‰¤T , where each St is of the form (5.36), and where the process W = (Wt)0â‰¤tâ‰¤T
is a standard Brownian motion or Wiener process. A Wiener process is characterized
by the following properties:
â€¢ W0 = 0 almost surely,
â€¢ t â†’Wt is continuous,
â€¢ for each sequence 0 = t0 < t1 < Â· Â· Â· < tn = T , the increments
Wt1 âˆ’Wt0, . . . , Wtn âˆ’Wtnâˆ’1
are independent and have normal distributions N(0, ti âˆ’tiâˆ’1);
see, e.g., [129]. This multiplicative version of a functional central limit theorem fol-
lows as above if we replace the classical central limit theorem by Donskerâ€™s invariance
principle; for details see, e.g., [73].
Geometric Brownian motion is the classical reference model in continuous-time
mathematical ï¬nance. In order to describe the model more explicitly, we denote by
W = (Wt)0â‰¤tâ‰¤T the coordinate process on the canonical path space  = C[0, T ],
deï¬ned by Wt(Ï‰) = Ï‰(t), and furthermore by (Ft)0â‰¤tâ‰¤T the ï¬ltration given by
Ft = Ïƒ(Ws; s â‰¤t). There is exactly one probability measure P on (, FT ) such
that W is a Wiener process under P, and it is called the Wiener measure. Let us now
model the price process of a risky asset as a geometric Brownian motion S deï¬ned by
(5.36). The discounted price process
Xt := St
ert = S0eÏƒWtâˆ’Ïƒ 2t/2,
0 â‰¤t â‰¤T,
is a martingale under P, since
E[ Xt | Fs ] = XsE

eÏƒ(Wtâˆ’Ws)âˆ’Ïƒ 2(tâˆ’s)/2 
= Xs
for 0 â‰¤s â‰¤t â‰¤T . In fact, P is the only probability measure equivalent to P with
that property.
As in discrete time, uniqueness of the equivalent martingale measure implies com-
pleteness of the model. Let us sketch the construction of the replicating strategy for a
given European option with reasonable payoff proï¬le f (ST ), for example a call option

272
5 Dynamic arbitrage theory
with strike K. At time t the price of the asset is St(Ï‰), the remaining time to maturity
is T âˆ’t, and the discounted price of the option is given by
Vt(Ï‰) = eâˆ’rtu(St(Ï‰), T âˆ’t),
where u is the function deï¬ned in Proposition 5.62. The process V = (Vt)0â‰¤tâ‰¤T can
be viewed as the value process of the trading strategy Î¾ = (Î¾0, Î¾) deï¬ned by
Î¾t = (St, T âˆ’t),
Î¾0
t = eâˆ’rtu(St, T âˆ’t) âˆ’Î¾t Xt,
(5.37)
where  = âˆ‚u/âˆ‚x is the optionâ€™s Delta. Indeed, if we view Î¾ as the number of shares
in the risky asset S and Î¾0 as the number of shares in the riskfree savings account
S0
t = ert, then the value of the resulting portfolio in units of the numÃ©raire is given by
Vt = Î¾t Â· Xt + Î¾0
t = eâˆ’rt(Î¾t Â· St + Î¾0
t Â· S0
t ).
The strategy replicates the option since
VT := lim
tâ†‘T eâˆ’rtu(St, T âˆ’t) = eâˆ’rT f (ST ) = f (ST )
S0
T
,
due to Proposition 5.62. Moreover, its initial cost is given by the Blackâ€“Scholes price
V0 = u(S0, T ) = eâˆ’rT E[ f (ST ) ] = eâˆ’rT
âˆš
2Ï€
 âˆ
âˆ’âˆ
f

xeÏƒ
âˆš
T y+rT âˆ’Ïƒ 2T/2
eâˆ’y2/2 dy.
It remains to show that the strategy is self-ï¬nancing in the sense that changes in
the portfolio value are only due to price changes in the underlying assets and do not
require any additional capital. To this end, we use ItÃ´â€™s formula
dF(Wt, t) = âˆ‚F
âˆ‚x (Wt, t) dWt +
	1
2
âˆ‚2F
âˆ‚x2 + âˆ‚F
âˆ‚t

(Wt, t) dt
for a smooth function F, see, e.g., [129] or, for a strictly pathwise approach, [87].
Applied to the function F(x, t) = exp(Ïƒx + rt âˆ’Ïƒ 2t/2), it shows that the price
process S satisï¬es the stochastic differential equation
dSt = ÏƒSt dWt + rSt dt.
(5.38)
Thus, the inï¬nitesimal return dSt/St is the sum of the safe return r dt and an additional
noise term with zero expectation under P âˆ—. The strength of the noise is measured by
the volatility parameter Ïƒ. Similarly, we obtain
dXt = ÏƒXt dWt = eâˆ’rt(dSt âˆ’rSt dt).
(5.39)
Applying ItÃ´â€™s formula to the function
F(x, t) = eâˆ’rtu

exp(x + rt âˆ’Ïƒ 2t/2), T âˆ’t


5.7 Convergence to the Blackâ€“Scholes price
273
and using (5.38), we obtain
dVt = eâˆ’rt âˆ‚u
âˆ‚x (St, t) dSt + eâˆ’rt	1
2Ïƒ 2S2
t
âˆ‚2u
âˆ‚x2 âˆ’âˆ‚u
âˆ‚t âˆ’ru

(St, t) dt.
The Blackâ€“Scholes partial differential equation (5.33) shows that the term in paren-
thesis is equal to âˆ’rStâˆ‚u/âˆ‚x, and we obtain from (5.39) that
dVt = âˆ‚u
âˆ‚x (St, t) dXt = Î¾t dXt.
More precisely,
Vt = V0 +
 t
0
Î¾s dXs,
where the integral with respect to X is deï¬ned as an ItÃ´ integral, i.e., as the limit of
non-anticipating Riemann sums

tiâˆˆDn, tiâ‰¤t
Î¾ti(Xti+1 âˆ’Xti)
along an increasing sequence (Dn) of partitions of the interval [0, T ]; see, e.g., [87].
Thus, the ItÃ´ integral can be interpreted in ï¬nancial terms as the cumulative net gain
generatedbydynamichedginginthediscountedriskyassetasdescribedbythehedging
strategy Î¾. This fact is an analogue of property (c) in Proposition 5.7, and in this sense
Î¾ = (Î¾0, Î¾) is a self-ï¬nancing trading strategy in continuous time. Similarly, we obtain
the following continuous-time analogue of (5.5), which describes the undiscounted
value of the portfolio as a result of dynamic trading both in the undiscounted risky
asset and the riskfree asset:
ertVt = V0 +
 t
0
Î¾s dSs +
 t
0
Î¾0
s dS0
s .
Perfect replication also works for exotic options C(S) deï¬ned by reasonable func-
tionals C on the path space C[0, T ], due to a general representation theorem for such
functionals as ItÃ´ integrals of the underlying Brownian motion W or, via (5.39), of
the process X. Weak convergence on path space implies, in analogy to Proposition
5.62, that the arbitrage-free prices of the options C(S(N)), computed as discounted
expectations under the measure P âˆ—
N, converge to the discounted expectation
eâˆ’rT E[ C(S) ]
under the Wiener measure P.
On the other hand, the discussion in Section 5.6 suggests that the prices of certain
exotic contingent claims, such as barrier options, can be computed in closed form as
the Blackâ€“Scholes price for some corresponding payoff proï¬le of the form f (ST ).
This is illustrated by the following example, where the price of an up-and-in call is
computed in terms of the distribution of the terminal stock price under the equivalent
martingale measure.

274
5 Dynamic arbitrage theory
Example 5.63 (Blackâ€“Scholes price of an up-and-in call option). Consider an up-
and-in call option
Ccall
u&i(S) =
ï£±
ï£²
ï£³
(ST âˆ’K)+
if max
0â‰¤tâ‰¤T St â‰¥B,
0
otherwise,
where B > S0 âˆ¨K denotes a given barrier, and where K > 0 is the strike price. As
approximating models we choose the CRR models of Example 5.55. That is, we have
interest rates
rN = r T
N
and parameters aN and bN deï¬ned by
Ë†aN = 1 + aN = eâˆ’ÏƒâˆšT /N
and
Ë†bN = 1 + bN = eÏƒâˆšT/N
for some given Ïƒ > 0. Applying the formula obtained in Example 5.50 yields
Eâˆ—
N

Ccall
u&i(S(N))

= Eâˆ—
N

(S(N)
N
âˆ’K)+; S(N)
N
â‰¥B

+
	
pâˆ—
N
1 âˆ’pâˆ—
N

kN 	BN
S0

2
Eâˆ—
N

(S(N)
N
âˆ’
KN)+; S(N)
N
< B

,
where BN and 
KN are given by

KN = K Ë†bâˆ’2kN
N
= K
	 S0
BN

2
,
and where
kN =
" âˆš
N
Ïƒ
âˆš
T
log B
S0
#
is the smallest integer k such that B â‰¤S0 Ë†bk
N. Then we have
BN â†˜B
and

KN â†—
K = K
	S0
B

2
.
Since f (x) = (x âˆ’K)+I{xâ‰¥B} is continuous a.e., we obtain
Eâˆ—
N

(S(N)
N
âˆ’K)+; S(N)
T
â‰¥B

âˆ’â†’E

(ST âˆ’K)+; ST â‰¥B

,
due to Proposition 5.59. Combining the preceding argument with the fact that
P âˆ—
N[ 
KN â‰¤S(N)
N
â‰¤
K ] âˆ’â†’0

5.7 Convergence to the Blackâ€“Scholes price
275
also gives the convergence of the second expectation:
Eâˆ—
N

(S(N)
N
âˆ’
KN)+; S(N)
N
< B

âˆ’â†’E

(ST âˆ’
K)+; ST < B

.
Next we note that for constants c, d > 0
lim
xâ†“0
1
x log cx2 + 1 âˆ’eâˆ’dx
edx âˆ’1 âˆ’cx2 = 2c
d âˆ’d,
due to lâ€™HÃ´pitalâ€™s rule. From this fact, one deduces that
	
pâˆ—
N
1 âˆ’pâˆ—
N

kN âˆ’â†’
	 B
S0

 2r
Ïƒ2 âˆ’1
.
Thus, we may conclude that the arbitrage-free prices
1
(1 + rN)N Eâˆ—
N

Ccall
u&i(S(N))

in the Nth approximating model converge to
eâˆ’rT

E

(ST âˆ’
K)+; ST < B

+
	 B
S0

 2r
Ïƒ2 +1
E

(ST âˆ’
K)+; ST < B

.
The expectations occurring in this formula are integrals with respect to a log-normal
distribution and can be explicitly computed as in Example 5.57. Moreover, our limit
is in fact equal to the Blackâ€“Scholes price of the up-and-in call option: The functional
Ccall
u&i( Â· ) is continuous in each path in C[0, T ] whose maximum is different from
the value B, and one can show that these paths have full measure for the law of S
under P. Hence, Ccall
u&i( Â· ) is continuous P â—¦Sâˆ’1-a.e., and the functional version of
Proposition 5.59 yields
Eâˆ—
N

Ccall
u&i(S(N))

âˆ’â†’E

Ccall
u&i(S)

,
so that our limiting price must coincide with the discounted expectation on the right. â™¦
Remark 5.64. Let us assume, more generally, that the price process S is deï¬ned by
St = S0eÏƒWt+Î±t,
0 â‰¤t â‰¤T,
for some Î± âˆˆR. Applying ItÃ´â€™s formula as in (5.38), we see that S is governed by the
stochastic differential equation
dSt = ÏƒSt dWt + bSt dt
with b = Î± + 1
2Ïƒ 2. The discounted price process is given by
Xt = S0eÏƒWt+(Î±âˆ’r)t = S0eÏƒW âˆ—
t âˆ’Ïƒ 2t/2

276
5 Dynamic arbitrage theory
with W âˆ—
t = Wt + Î»t for Î» = (b âˆ’r)/Ïƒ. The process W âˆ—is a Wiener process under
the measure P âˆ—â‰ˆP deï¬ned by the density
dP âˆ—
dP = eâˆ’Î»WT âˆ’Î»2T/2.
In fact, P âˆ—is the unique equivalent martingale measure for X. We can now repeat the
arguments above to conclude that the cost of perfect replication for a contingent claim
C(S) is given by
eâˆ’rT Eâˆ—[ C(S) ].
â™¦
EveninthecontextofsimplediffusionmodelssuchasgeometricBrownianmotion,
however, completeness is lost as soon as the future behavior of the volatility parameter
Ïƒ is unknown. If, for instance, volatility itself is modeled as a stochastic process, we
are facing incompleteness. Thus, the problems of pricing and hedging in discrete-
time incomplete markets as discussed in this book reappear in continuous time. Other
versions of the invariance principle may lead to other classes of continuous-time
models with discontinuous paths, for instance to geometric Poisson or LÃ©vy processes.
Discontinuity of paths is another important source of incompleteness. In fact, this has
already been illustrated in this book, since discrete-time models can be regarded as
stochastic processes in continuous time, where jumps occur at predictable dates.

Chapter 6
American contingent claims
So far, we have studied European contingent claims whose payoff is due at a ï¬xed
maturity date. In the case of American options, the buyer can claim the payoff at any
time up to the expiration of the contract.
First, we take the point of view of the seller, whose aim is to hedge against all pos-
sible claims of the buyer. In Section 6.1, this problem is solved under the assumption
of market completeness, using the Snell envelope of the contingent claim. The buyer
tries to choose the best date for exercising the claim, contingent on the information
available up to that time. Since future prices are usually unknown, a formulation of
this problem will typically involve subjective preferences. If preferences are expressed
in terms of expected utility, the choice of the best exercise date amounts to solving
an optimal stopping problem. In the special case of a complete market model, any
exercise strategy which maximizes the expected payoff under the unique equivalent
martingale measure turns out to be optimal even in an almost sure sense.
In Section 6.3, we characterize the set of all arbitrage-free prices of an American
contingent claim in an incomplete market model. This involves a lower Snell envelope
of the claim, which is analyzed in Section 6.5, using the fact that the class of equivalent
martingale measures is stable under pasting. This notion of stability under pasting
is discussed in Section 6.4 in a general context, and in Section 6.5 we explain its
connection with the time-consistency of dynamic risk measures. The results on lower
Snell envelopes can also be regarded as a solution to the buyerâ€™s optimal stopping
problem in the case where preferences are described by robust Savage functionals.
Moreover, these results will be used in the theory of superhedging of Chapter 7.
6.1 Hedging strategies for the seller
We start this section by introducing the Doob decomposition of an adapted process
and the notion of a supermartingale.
Proposition 6.1. Let Q be a probability measure on (, FT ), and suppose that Y
is an adapted process such that Yt âˆˆL1(Q) for all t. Then there exists a unique
decomposition
Y = M âˆ’A,
(6.1)
where M is a Q-martingale and A is a process such that A0 = 0 and (At)t=1,...,T
is predictable. The decomposition (6.1) is called the Doob decomposition of Y with
respect to the probability measure Q.

278
6 American contingent claims
Proof. Deï¬ne A by
At âˆ’Atâˆ’1 := âˆ’EQ[ Yt âˆ’Ytâˆ’1 | Ftâˆ’1 ]
for t = 1, . . . , T .
(6.2)
Then A is predictable and Mt := Yt + At is a Q-martingale. Clearly, any process A
with the required properties must satisfy (6.2), so the uniqueness of the decomposition
follows.
Deï¬nition 6.2. Let Q be a probability measure on (, FT ) and suppose that Y is an
adapted process such that Yt âˆˆL1(Q) for all t. Denote by Y = M âˆ’A the Doob
decomposition of Y.
(a) Y is called a Q-supermartingale if A is increasing.
(b) Y is called a Q-submartingale if A is decreasing.
Clearly, a process is a martingale if and only if it is both a supermartingale and a
submartingale, i.e., if and only if A â‰¡0. The following result gives equivalent char-
acterizations of the supermartingale property of a process Y. Its proof is elementary
and left to the reader.
Proposition 6.3. Let Y be an adapted process with Yt âˆˆL1(Q) for all t. Then the
following conditions are equivalent:
(a) Y is a Q-supermartingale.
(b) Ys â‰¥EQ[ Yt | Fs ] for 0 â‰¤s â‰¤t â‰¤T .
(c) Ytâˆ’1 â‰¥EQ[ Yt | Ftâˆ’1 ] for t = 1, . . . , T .
(d) âˆ’Y is a Q-submartingale.
We now return to the market model introduced in Section 5.1. AnAmerican option,
or American contingent claim, corresponds to a contract which is issued at time 0 and
which obliges the seller to pay a certain amount CÏ„ â‰¥0 if the buyer decides at time
Ï„ to exercise the option. The choice of the exercise time Ï„ is entirely up to the buyer,
except that the claim is automatically exercised at the â€œexpiration dateâ€ of the claim.
TheAmerican contingent claim can be exercised only once: It becomes invalid as soon
as the payoff has been claimed by the buyer. This concept is formalized as follows:
Deï¬nition 6.4. An American contingent claim is a non-negative adapted process
C = (Ct)t=0,...,T on the ï¬ltered space (, (Ft)t=0,...,T ).
For each t, the random variable Ct is interpreted as the payoff of the American
contingent claim if the claim is exercised at time t. The time horizon T plays the role
of the expiration date of the claim. The possible exercise times for C are not limited to
ï¬xed deterministic times t âˆˆ{ 0. . . . , T }; the buyer may exercise the claim in a way
which depends on the scenario Ï‰ âˆˆ of the market evolution.

6.1 Hedging strategies for the seller
279
Deï¬nition 6.5. An exercise strategy for an American contingent claim C is an
FT -measurable random variable Ï„ taking values in { 0, . . . , T }. The payoff obtained
by using Ï„ is equal to
CÏ„(Ï‰) := CÏ„(Ï‰)(Ï‰),
Ï‰ âˆˆ.
Example 6.6. An American put option on the ith asset and with strike K > 0 pays
the amount
Cput
t
:= (K âˆ’Si
t )+
if it is exercised at time t. The payoff at time t of the corresponding American call
option is given by
Ccall
t
:= (Si
t âˆ’K)+.
Clearly, the American call option is â€œout of the moneyâ€ (i.e., has zero payoff) if
the corresponding American put is â€œin the moneyâ€ (i.e., has non-zero payoff). It
is therefore a priori clear that the respective owners of Cput and Ccall will usually
exercise their claims at different times. In particular, there will be no put-call parity
for American options.
â™¦
Similarly, one deï¬nes American versions of most options mentioned in the exam-
ples of Section 5.3. Clearly, the value of an American option is at least as high as the
value of the corresponding European option with maturity T .
Remark 6.7. It should be emphasized that the concept ofAmerican contingent claims
can be regarded as a generalization of European contingent claims: If CE is a European
contingent claim, then we can deï¬ne a corresponding American claim CA by
CA
t =

0
if t < T ,
CE
if t = T .
(6.3)
â™¦
Example 6.8. A Bermuda option can be exercised by its buyer at each time of a
predetermined subset T âŠ‚{0, . . . , T }. For instance, a Bermuda call option pays the
amount (Si
t âˆ’K)+ if it is exercised at some time t âˆˆT. Thus, a Bermuda option
is a ï¬nancial instrument â€œbetweenâ€ an American option with T = {0, . . . , T } and a
European option with T = {T }, just as Bermuda lies between America and Europe;
hence the name â€œBermuda optionâ€. A Bermuda option can be regarded as a particular
American option C that pays the amount Ct = 0 for t /âˆˆT.
â™¦
The process
Ht = Ct
S0t
,
t = 0, . . . , T,
of discounted payoffs of C will be called the discounted American claim associated
with C. As far as the mathematical theory is concerned, the discounted American
claim H will be the primary object. For certain examples it will be helpful to keep
track of the numÃ©raire and, thus, of the payoffs Ct prior to discounting.

280
6 American contingent claims
Inthissection, wewillanalyzethetheoryofhedgingAmericanclaimsinacomplete
market model. We will therefore assume throughout this section that the set P of
equivalent martingale measures consists of one single element P âˆ—:
P = { P âˆ—}.
Under this assumption, we will construct a suitable trading strategy that permits the
seller of an American claim to hedge against the buyerâ€™s discounted claim HÏ„. Let us
ï¬rst try to characterize the minimal amount of capital Ut which will be needed at time
t âˆˆ{0, . . . , T }. Since the choice of the exercise time Ï„ is entirely up to the buyer, the
seller must be prepared to pay at any time t the current payoff Ht of the option. This
amounts to the condition Ut â‰¥Ht. Moreover, the amount Ut must sufï¬ce to cover
the purchase of the hedging portfolio for the possible payoffs Hu for u > t. Since the
latter condition is void at maturity, we require
UT = HT .
At time T âˆ’1, our ï¬rst requirement on UT âˆ’1 reads UT âˆ’1 â‰¥HT âˆ’1. The second
requirement states that the amount UT âˆ’1 must sufï¬ce for hedging the claim HT in
case the option is not exercised before time T . Due to our assumption of market
completeness, the latter amount equals
Eâˆ—[ HT | FT âˆ’1 ] = Eâˆ—[ UT | FT âˆ’1 ].
Thus,
UT âˆ’1 := HT âˆ’1 âˆ¨Eâˆ—[ UT | FT âˆ’1 ]
is the minimal amount that fulï¬lls both requirements. Iterating this argument leads to
the following recursive scheme for Ut:
UT := HT ,
Ut := Ht âˆ¨Eâˆ—[ Ut+1 | Ft ]
for t = T âˆ’1, . . . , 0.
(6.4)
Deï¬nition 6.9. The process UP âˆ—:= U deï¬ned by the recursion (6.4) is called the
Snell envelope of the process H with respect to the measure P âˆ—.
Example 6.10. Let H E be a discounted European claim. Then the Snell envelope
with respect to P âˆ—of the discountedAmerican claim H A associated with H E via (6.3)
satisï¬es
UP âˆ—
t
= Eâˆ—[ H A
T | Ft ] = Eâˆ—[ H E | Ft ].
Thus, U is equal to the value process of a replicating strategy for H E.
â™¦
Clearly, a Snell envelope UQ can be deï¬ned for any probability measure Q on
(, FT ) and for any adapted process H that satisï¬es the following integrability con-
dition:
Ht âˆˆL1(Q)
for t = 0, . . . , T .
(6.5)

6.1 Hedging strategies for the seller
281
In our ï¬nite-time setting, this condition is equivalent to
EQ

max
tâ‰¤T |Ht|

< âˆ.
For later applications, the following proposition is stated for a general measure Q.
Proposition 6.11. Let H be an adapted process such that (6.5) holds. Then the Snell
envelope UQ of H with respect to Q is the smallest Q-supermartingale dominating H:
If 
U is another Q-supermartingale such that 
Ut â‰¥Ht Q-a.s. for all t, then 
Ut â‰¥UQ
t
Q-a.s. for all t.
Proof. It follows immediately from the deï¬nition of UQ that UQ
tâˆ’1 â‰¥EQ[ UQ
t
| Ftâˆ’1 ]
so that UQ is indeed a supermartingale. If 
U is another supermartingale dominating
H, then 
UT â‰¥HT = UQ
T . We now proceed by backward induction on t. If we already
know that 
Ut â‰¥UQ
t , then

Utâˆ’1 â‰¥EQ[ 
Ut | Ftâˆ’1 ] â‰¥EQ[ UQ
t
| Ftâˆ’1 ].
Adding our assumption 
Utâˆ’1 â‰¥Htâˆ’1 yields that

Utâˆ’1 â‰¥Htâˆ’1 âˆ¨EQ[ UQ
t
| Ftâˆ’1 ] = UQ
tâˆ’1,
and the result follows.
Proposition 6.11 illustrates how the seller can (super-) hedge a discounted Amer-
ican claim H by using the Doob decomposition
UP âˆ—
t
= Mt âˆ’At,
t = 0, . . . , T,
of the Snell envelope UP âˆ—with respect to P âˆ—. Then M is a P âˆ—-martingale, A is
increasing, and (At)t=1,...,T is predictable. Since we assume the completeness of the
market model, Theorem 5.39 yields the representation of the martingale M as the
â€œstochastic integralâ€ of a suitable d-dimensional predictable process Î¾:
Mt = UP âˆ—
0
+
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1),
t = 0, . . . , T.
(6.6)
It follows that
Mt â‰¥UP âˆ—
t
â‰¥Ht
for all t.
By adding a numÃ©raire component Î¾0 such that Î¾ = (Î¾0, Î¾) becomes a self-ï¬nancing
trading strategy with initial investment UP âˆ—
0 , we obtain a (super-) hedge for H, namely
a self-ï¬nancing trading strategy whose value process V satisï¬es
Vt â‰¥Ht
for all t.
(6.7)

282
6 American contingent claims
Thus, UP âˆ—
t
may be viewed as the resulting capital at each time t if we use the self-
ï¬nancing strategy Î¾, combined with a refunding scheme where we withdraw suc-
cessively the amounts deï¬ned by the increments of A. In fact, UP âˆ—
t
is the minimal
investment at time t for which one can purchase a hedging strategy such that (6.7)
holds. This follows from our next result.
Theorem 6.12. Let H be a discountedAmerican claim with Snell envelope UP âˆ—. Then
there exists a d-dimensional predictable process Î¾ such that
UP âˆ—
t
+
u

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥Hu
for all u â‰¥t.
(6.8)
Moreover, any Ft-measurable random variable 
Ut which, for some predictable Î¾,
satisï¬es (6.8) in place of UP âˆ—
t
is such that

Ut â‰¥UP âˆ—
t
P âˆ—-a.s.
Thus, UP âˆ—
t
is the minimal amount of capital which is necessary to hedge H from time t
up to maturity.
Proof. Clearly, UP âˆ—satisï¬es (6.8) for Î¾ as in (6.6). Now suppose that 
Ut is Ft-
measurable, thatÎ¾ is predictable, and that
Vu := 
Ut +
u

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥Hu
for all u â‰¥t.
We show Vu â‰¥UP âˆ—
u
for all u â‰¥t by backward induction. VT â‰¥HT = UP âˆ—
T
holds
by assumption, so assume Vu+1 â‰¥UP âˆ—
u+1 for some u. Since our market model is
complete, Theorem 5.38 implies thatÎ¾ is bounded. Hence, we get
Eâˆ—[ Vu+1 âˆ’Vu | Fu ] = Eâˆ—[Î¾u+1 Â· (Xu+1 âˆ’Xu) | Fu ] = 0
P -a.s.
It follows that
Vu = Eâˆ—[ Vu+1 | Fu ] â‰¥Hu âˆ¨Eâˆ—[ UP âˆ—
u+1 | Fu ] = UP âˆ—
u .
6.2 Stopping strategies for the buyer
In this section, we take the point of view of the buyer of an American contingent
claim. Thus, our aim is to optimize the exercise strategy. It is natural to assume that
the decision to exercise the claim at a particular time t depends only on the market
information which is available at t. This constraint can be formulated as follows:

6.2 Stopping strategies for the buyer
283
Deï¬nition 6.13. A function Ï„ :  â†’{ 0, 1, . . . , T } âˆª{ +âˆ} is called a stopping
time if { Ï„ = t } âˆˆFt for t = 0, . . . , T .
Inparticular, theconstantfunctionÏ„ â‰¡t isastoppingtimeforï¬xedt âˆˆ{0, . . . , T }.
Remark 6.14. A function Ï„ :  â†’{ 0, 1, . . . , T } âˆª{ +âˆ} is a stopping time if and
only if { Ï„ â‰¤t } âˆˆFt for each t. Moreover, if Ï„ and Ïƒ are two stopping times, then
the following functions are also stopping times:
Ï„ âˆ§Ïƒ,
Ï„ âˆ¨Ïƒ,
(Ï„ + Ïƒ) âˆ§T.
The proof is easy and left to the reader.
â™¦
Example 6.15. A typical example of a non-trivial stopping time is the ï¬rst time at
which an adapted process Y exceeds a certain level c:
Ï„(Ï‰) := inf{ t â‰¥0 | Yt(Ï‰) â‰¥c }.
In fact,
{Ï„ â‰¤t} =
t
s=0
{Ys â‰¥c} âˆˆFt
for t = 0, . . . , T . This example also illustrates the role of the value +âˆin Deï¬ni-
tion 6.13: We have Ï„(Ï‰) = +âˆif, for this particular Ï‰, the criterion that triggers Ï„
is not met for any t âˆˆ{ 0, . . . , T }.
â™¦
Deï¬nition 6.16. For any stochastic process Y and each stopping time Ï„ we denote by
Y Ï„ the process stopped in Ï„:
Y Ï„
t (Ï‰) := Ytâˆ§Ï„(Ï‰)(Ï‰)
for Ï‰ âˆˆ and for all t âˆˆ{0, . . . , T }.
It follows from the deï¬nition of a stopping time that Y Ï„ is an adapted process if Y
is. Informally, the following basic theorem states that a martingale cannot be turned
into a favorable game by using a clever stopping strategy. This result is often called
Doobâ€™s stopping theorem or the optional sampling theorem. Recall that we assume
F0 = {âˆ…, }.
Theorem 6.17. Let M be an adapted process such that Mt âˆˆL1(Q) for each t. Then
the following conditions are equivalent:
(a) M is a Q-martingale.
(b) For any stopping time Ï„ the stopped process MÏ„ is a Q-martingale.
(c) EQ[ MÏ„âˆ§T ] = M0 for any stopping time Ï„.

284
6 American contingent claims
Proof. (a) â‡’(b): Note that
MÏ„
t+1 âˆ’MÏ„
t = (Mt+1 âˆ’Mt) I{Ï„>t}.
Since {Ï„ > t} âˆˆFt, we obtain that
EQ[ MÏ„
t+1 âˆ’MÏ„
t | Ft ] = EQ[ Mt+1 âˆ’Mt | Ft ] Â· I{Ï„>t} = 0.
(b) â‡’(c): This follows simply from the fact that the expectation of MÏ„
t is constant
in t.
(c) â‡’(a): We need to show that if t < T , then
EQ[ MT ; A ] = EQ[ Mt; A ]
(6.9)
for each A âˆˆFt. Fix such an A and deï¬ne a stopping time Ï„ as
Ï„(Ï‰) :=

t
if Ï‰ âˆˆA,
T
if Ï‰ /âˆˆA.
We obtain that
M0 = EQ[ MT âˆ§Ï„ ] = EQ[ Mt; A ] + EQ[ MT ; Ac ].
Using the constant stopping time T instead of Ï„ yields that
M0 = EQ[ MT ] = EQ[ MT ; A ] + EQ[ MT ; Ac ].
Subtracting the latter identity from the previous one yields (6.9).
Corollary 6.18. Let U be an adapted process such that Ut âˆˆL1(Q) for each t. Then
the following conditions are equivalent:
(a) U is a Q-supermartingale.
(b) For any stopping time Ï„, the stopped process UÏ„ is a Q-supermartingale.
Proof. If U = M âˆ’A is the Doob decomposition of U, then one checks that
UÏ„ = MÏ„ âˆ’AÏ„
(6.10)
is the Doob decomposition of UÏ„. This observation and Theorem 6.17 yield the
equivalence of (a) and (b).
Let us return to the problem of ï¬nding an optimal exercise time Ï„ for a discounted
American claim H. We assume that the buyer chooses the possible exercise times
from the set
T :=

Ï„ | Ï„ is a stopping time with Ï„ â‰¤T


6.2 Stopping strategies for the buyer
285
of all stopping times which do not take the value +âˆ. Assume that the aim of the
buyer is to choose a payoff from the class { HÏ„ | Ï„ âˆˆT } which is optimal in the sense
that it has maximal expectation. Thus, the problem is:
Maximize E[ HÏ„ ] among all Ï„ âˆˆT .
(6.11)
The analysis of the optimal stopping problem (6.11) does not require any properties
of the underlying market model, not even the absence of arbitrage. We may also drop
the positivity assumption on H: All we have to assume is that H is an adapted process
which satisï¬es
Ht âˆˆL1(, Ft, P)
for all t.
(6.12)
This relaxed assumption will be useful in Chapter 9, and it allows us to include
the interpretation of the optimal stopping problem in terms of the following utility
maximization problem:
Remark 6.19. Suppose the buyer uses a preference relation on X := { HÏ„ | Ï„ âˆˆT }
which can be represented in terms of a Savage representation
U(HÏ„) = EQ[ u(HÏ„) ]
where Q is a probability measure on (, F ), and u is a measurable or continuous
function; see Section 2.5. Then a natural goal is to maximize the utility U(HÏ„)
among all Ï„ âˆˆT . This is equivalent to the optimal stopping problem (6.11) for the
transformed process 
Ht := u(Ht), and with respect to the measure Q instead of P .
This utility maximization problem is covered by the discussion in this section as long
as 
Ht âˆˆL1(Q) for all t. In Remark 6.51 we will discuss the problem of maximizing
the more general utility functionals which appear in a robust Savage representation.
â™¦
Under the assumption (6.12), we can construct the Snell envelope U := UP of H
with respect to P , i.e., U is deï¬ned via the recursive formula
UT := HT
and
Ut := Ht âˆ¨E[ Ut+1 | Ft ],
t = T âˆ’1, . . . , 0.
Let us deï¬ne a stopping time Ï„min by
Ï„min := min{ t â‰¥0 | Ut = Ht }.
Note that Ï„min â‰¤T since UT = HT . As we will see in the following theorem, Ï„min
maximizes the expectation of HÏ„ among all Ï„ âˆˆT . In other words, Ï„min is a solution
to our optimal stopping problem (6.11). Similarly, we let
Ï„ (t)
min := min{ u â‰¥t | Uu = Hu},
which is a member of the set
Tt := { Ï„ âˆˆT | Ï„ â‰¥t }.

286
6 American contingent claims
Theorem 6.20. The Snell envelope U of H satisï¬es
Ut = E[ HÏ„ (t)
min | Ft ] = ess sup
Ï„âˆˆTt
E[ HÏ„ | Ft ].
In particular,
U0 = E[ HÏ„min ] = sup
Ï„âˆˆT
E[ HÏ„ ].
Proof. Since U is a supermartingale under P , Corollary 6.18 shows that for Ï„ âˆˆTt
Ut â‰¥E[ UÏ„ | Ft ] â‰¥E[ HÏ„ | Ft ].
Therefore,
Ut â‰¥ess sup
Ï„âˆˆTt
E[ HÏ„ | Ft ].
Hence, the theorem will be proved if we can show that Ut = E[ HÏ„ (t)
min | Ft ], which is
in turn implied by the identity
Ut = E[ UÏ„ (t)
min | Ft ].
(6.13)
In order to prove (6.13), let U(t) denote the stopped process
U(t)
s
:= Usâˆ§Ï„ (t)
min,
and ï¬x some s between t and T . Then Us > Hs on {Ï„ (t)
min > s}. Hence, P -a.s. on
{Ï„ (t)
min > s}:
U(t)
s
= Us = Hs âˆ¨E[ Us+1 | Fs ] = E[ Us+1 | Fs ] = E[ U(t)
s+1 | Fs ].
On the set {Ï„ (t)
min â‰¤s} one has U(t)
s+1 = UÏ„ (t)
min = U(t)
s , hence U(t)
s
= E[ U(t)
s+1 | Fs ].
Thus, U(t) is a martingale from time t on:
U(t)
s
= E[ U(t)
s+1 | Fs ]
for all s âˆˆ{t, t + 1, . . . , T }.
It follows that
E[ UÏ„ (t)
min | Ft ] = E[ U(t)
T
| Ft ] = U(t)
t
= Ut.
This proves the claim (6.13).
Deï¬nition 6.21. A stopping time Ï„ âˆ—âˆˆT is called optimal (with respect to P ) if
E[ HÏ„ âˆ—] = sup
Ï„âˆˆT
E[ HÏ„ ].

6.2 Stopping strategies for the buyer
287
In particular, Ï„min is an optimal stopping time in the sense of this deï¬nition. The
following result implies that Ï„min is in fact the minimal optimal stopping time.
Proposition 6.22. A stopping time Ï„ âˆˆT is optimal if and only if HÏ„ = UÏ„ P -a.s.,
and if the stopped process UÏ„ is a martingale. In particular, any optimal stopping
time Ï„ satisï¬es Ï„ â‰¥Ï„min.
Proof. First note that Ï„ âˆˆT is optimal if it satisï¬es the two conditions of the assertion,
because then Theorem 6.20 implies that
sup
ÏƒâˆˆT
E[ HÏƒ ] = U0 = E[ UÏ„
T ] = E[ UÏ„ ] = E[ HÏ„ ].
For the converse implication, we apply the assumption of optimality, the fact that
HÏ„ â‰¤UÏ„, and the stopping theorem for supermartingales to obtain that
U0 = E[ HÏ„ ] â‰¤E[ UÏ„ ] â‰¤U0,
so that all inequalities are in fact equalities. It follows in particular that HÏ„ = UÏ„
P -almost surely. Moreover, the identity E[ UÏ„ ] = U0 implies that the stopped process
UÏ„ is a supermartingale with constant expectation U0, and hence is a martingale.
In general, there can be many different optimal stopping times. The largest optimal
stopping time admits an explicit description: It is the ï¬rst time before T for which the
Snell envelope U loses the martingale property:
Ï„max := inf

t â‰¥0 | E[ Ut+1 âˆ’Ut | Ft ] Ì¸= 0

âˆ§T
= inf{ t â‰¥0 | At+1 Ì¸= 0} âˆ§T.
Here, A denotes the increasing process obtained from the Doob decomposition of U
under P .
Theorem 6.23. The stopping time Ï„max is the largest optimal stopping time. Moreover,
a stopping time Ï„ is optimal if and only if P -a.s. Ï„ â‰¤Ï„max and UÏ„ = HÏ„.
Proof. Let U = M âˆ’A be the Doob decomposition of U. Recall from (6.10) that
UÏ„ = MÏ„ âˆ’AÏ„ is the Doob decomposition of UÏ„ for any stopping time Ï„. Thus, UÏ„
is a martingale if and only if AÏ„ = 0, because A is increasing. Therefore, UÏ„ is a
martingale if and only if Ï„ â‰¤Ï„max, and so the second part of the assertion follows from
Proposition 6.22. It remains to prove that Ï„max itself is optimal, i.e., that UÏ„max = HÏ„max.
This is clear on the set { Ï„max = T }. On the set { Ï„max = t } for t < T one has At = 0
and At+1 > 0. Hence,
E[ Ut+1 âˆ’Ut | Ft ] = âˆ’(At+1 âˆ’At) = âˆ’At+1 < 0
on { Ï„max = t }.
Thus, Ut > E[ Ut+1 | Ft ] and the deï¬nition of the Snell envelope yields that Ut =
Ht âˆ¨E[ Ut+1 | Ft ] = Ht on { Ï„max = t }.

288
6 American contingent claims
Let us now return to our complete ï¬nancial market model, where Ht is the dis-
counted payoff of an American contingent claim. Thus, an optimal stopping strategy
for H maximizes the expected payoff E[ HÏ„ ]. But a stopping time turns out to be the
best choice even in a pathwise sense, provided that it is optimal with respect to the
unique equivalent martingale measure P âˆ—in a complete market model. In order to
explain this fact, let us ï¬rst recall from Section 6.1 the construction of a perfect hedge
of H from the sellerâ€™s perspective. Let
UP âˆ—= M âˆ’A
denote the Doob decomposition of the Snell envelope UP âˆ—of H with respect to P âˆ—.
Since P âˆ—is the unique equivalent martingale measure in our model, the martingale M
has the representation
Mt = UP âˆ—
0
+
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1),
t = 0, . . . , T,
for a d-dimensional predictable process Î¾. Clearly, M is equal to the value process of
the self-ï¬nancing strategy constructed from Î¾ and the initial investment UP âˆ—
0 . Since
M dominates H, this yields a perfect hedge of H from the perspective of the seller: If
the buyer exercises the option at some stopping time Ï„, then the seller makes a proï¬t
MÏ„ âˆ’HÏ„ â‰¥0. The following corollary states that the buyer can in fact meet the
value of the sellerâ€™s hedging portfolio, and that this happens if and only if the option
is exercised at an optimal stopping time with respect to P âˆ—. In this sense, UP âˆ—
0
can be
regarded as the unique arbitrage-free price of the discounted American claim H.
Corollary 6.24. With the above notation,
HÏ„ â‰¤MÏ„ = UP âˆ—
0
+
Ï„

k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1),
P âˆ—-a.s. for all Ï„ âˆˆT ,
and equality holds P âˆ—-almost surely if and only if Ï„ is optimal with respect to P âˆ—.
Proof. At time Ï„,
HÏ„ â‰¤UP âˆ—
Ï„
= MÏ„ âˆ’AÏ„ â‰¤MÏ„.
Moreover, by Theorem 6.23, both HÏ„ = UP âˆ—
Ï„
and AÏ„ = 0 hold P âˆ—-a.s. if and only if
Ï„ is optimal with respect to P âˆ—.
Let us now compare a discounted American claim H to the corresponding dis-
counted European claim HT , i.e., to the contract which is obtained from H by restrict-
ing the exercise time to be T . In particular, we are interested in the relation between
American and European put or call options. Let
Vt := Eâˆ—[ HT | Ft ]

6.2 Stopping strategies for the buyer
289
denote the amount needed at time t to hedge HT . Since our market model is complete,
Vt can also be regarded as the unique arbitrage-free price of the discounted claim HT
at time t. From the sellerâ€™s perspective, UP âˆ—
t
plays a similar role for the American
option. It is intuitively clear that anAmerican claim should be more expensive than the
corresponding European one. This is made mathematically precise in the following
statement.
Proposition 6.25. With the above notation, UP âˆ—
t
â‰¥Vt for all t. Moreover, if V
dominates H, then UP âˆ—and V coincide.
Proof. The ï¬rst statement follows immediately from the supermartingale property of
UP âˆ—:
UP âˆ—
t
â‰¥Eâˆ—[ UP âˆ—
T
| Ft ] = Eâˆ—[ HT | Ft ] = Vt.
Next, if the P âˆ—-martingale V dominates H, then it also dominates the corresponding
Snell envelope UP âˆ—by Proposition 6.11. Thus V and UP âˆ—must coincide.
Remark 6.26. The situation in which V dominates H occurs, in particular, when the
process H is a P âˆ—-submartingale. This happens, for instance, if H is obtained by
applying a convex function f : Rd â†’[0, âˆ) to the discounted price process X.
Indeed, in this case, Jensenâ€™s inequality for conditional expectations implies that
Eâˆ—[ f (Xt+1) | Ft ] â‰¥f

Eâˆ—[ Xt+1 | Ft ]

= f (Xt).
â™¦
Example 6.27. The discounted payoff of an American call option Ccall
t
= (S1
t âˆ’K)+
is given by
H call
t
=

X1
t âˆ’K
S0t
+
.
Under the hypothesis that S0
t is increasing in t, (5.21) states that
Eâˆ—[ H call
t+1 | Ft ] â‰¥H call
t
P âˆ—-a.s. for t = 0, . . . , T âˆ’1.
In other words, H call is a submartingale, and the Snell envelope UP âˆ—of H call coincides
with the value process
Vt = Eâˆ—
 
X1
T âˆ’K
S0
T
+  Ft

of the corresponding European call option with maturity T . In particular, we have
UP âˆ—
0
= V0, i.e., the unique arbitrage-free price of the American call option is equal to
its European counterpart. Moreover, Theorem 6.23 implies that the maximal optimal
stopping time with respect to P âˆ—is given by Ï„max â‰¡T . This suggests that, in a
complete model, an American call should not be exercised before maturity.
â™¦

290
6 American contingent claims
Example 6.28. For an American put option Cput
t
:= (K âˆ’S1
t )+ the situation is differ-
ent, because the argument in (5.21) fails unless S0 is decreasing. If S0 is an increasing
bond, then the time value
Wt := S0
t Eâˆ—
 (K âˆ’S1
T )+
S0
T
 Ft

âˆ’(K âˆ’S1
t )+
of a European put (K âˆ’S1
T )+ typically becomes negative at a certain time t, corre-
sponding to an early exercise premium âˆ’Wt; see Figure 5.3. Thus, the early exercise
premium is the surplus which an owner of the American put option would have over
the value of the European put (K âˆ’S1
T )+.
The relation between the price of a put option and its intrinsic value can be illus-
trated in the context of the CRR model. With the notation of Section 5.5, the price
process of the risky asset St = S1
t can be written as
St = S0 t
for
t :=
t
k=1
(1 + Rk)
and with the constant S0 â‰¥0. Recall that the returns Rk can take only two possible
values a and b with âˆ’1 < a < b, and that the market model is arbitrage-free if and
only if the riskless interest rate r satisï¬es a < r < b. In this case, the model is
complete, and the unique equivalent martingale measure P âˆ—is characterized by the
fact that it makes R1, . . . , RT independent with common distribution
P âˆ—[ Rk = b ] = pâˆ—= r âˆ’a
b âˆ’a .
(6.14)
Let
Ï€(x) := sup
Ï„âˆˆT
Eâˆ—
 (K âˆ’xÏ„)+
(1 + r)Ï„

denote the price of Cput regarded as a function of x := S0. Clearly, Ï€(x) is a convex
and decreasing function in x. Let us assume that r > 0 and that the parameter a is
strictly negative. A trivial situation occurs if the option is â€œfar out of the moneyâ€ in
the sense that
x â‰¥
K
(1 + a)T ,
because then St = xt â‰¥K for all t, and the payoff of Cput is always zero. In
particular, Ï€(x) = 0. If
x â‰¤
K
(1 + b)T
(6.15)
then St = xt â‰¤K for all t, and hence
Ï€(x) = sup
Ï„âˆˆT

Eâˆ—

K
(1 + r)Ï„

âˆ’x

= K âˆ’x.

6.2 Stopping strategies for the buyer
291
In this case, the price of theAmerican put option is equal to its intrinsic value (K âˆ’x)+
at time t = 0, and an optimal strategy for the owner would simply consist in exercising
the option immediately, i.e., there is no demand for the option in the regime (6.15).
Now consider the case
K â‰¤x <
K
(1 + a)T
of a put option which is â€œat the moneyâ€ or â€œnot too far out of the moneyâ€. For large
enough t > 0, the probability P âˆ—[ Cput
t
> 0 ] of a non-zero payoff is strictly positive,
while the intrinsic value (K âˆ’x)+ vanishes. It follows that the price Ï€(x) is strictly
higher than the intrinsic value, and so it is not optimal for the buyer to exercise the
option immediately.
Summarizing our observations, we can say that there exists a value xâˆ—with
K
(1 + b)T < xâˆ—â‰¤K
such that
Ï€(x) = (K âˆ’x)+
for x â‰¤xâˆ—,
Ï€(x) > (K âˆ’x)+
for xâˆ—< x < K/(1 + a)T , and
Ï€(x) = 0
for x â‰¥K/(1 + a)T ;
see Figure 6.1.
â™¦
 
K
S0
Figure 6.1. The price of an American put option as a function of S0 compared to the optionâ€™s
intrinsic value (K âˆ’S0)+.
Remark 6.29. In the context of an arbitrage-free CRR model, we consider a dis-
counted American claim H whose payoff is determined by a function of time and of

292
6 American contingent claims
the current spot price, i.e.,
Ht = ht(St)
for all t.
Clearly, this setting includes American call and put options as special cases. By using
the same arguments as in the derivation of (5.25), we get that the Snell envelope UP âˆ—
of H is of the form
UP âˆ—
t
= ut(St),
t = 0, . . . , T,
where the functions ut are determined by the recursion
uT (x) = hT (x)
and
ut(x) = ht(x) âˆ¨

ut+1(x Ë†b ) pâˆ—+ ut+1(x Ë†a) (1 âˆ’pâˆ—)

.
Here pâˆ—is deï¬ned as in (6.14), and the parameters Ë†a and Ë†b are given by Ë†a = 1 + a and
Ë†b = 1 + b. Thus, the space [0, T ] Ã— [0, âˆ) can be decomposed into the two regions
Rc := { (t, x) | ut(x) > ht(x) }
and
Rs := { (t, x) | ut(x) = ht(x) },
and the minimal optimal stopping time Ï„min can be described as the ï¬rst exit time of
the space time process (t, St) from the continuation region Rc or, equivalently, as the
ï¬rst entrance time into the stopping region Rs:
Ï„min = min{ t â‰¥0 | (t, St) /âˆˆRc } = min{ t â‰¥0 | (t, St) âˆˆRs }.
â™¦
6.3 Arbitrage-free prices
In this section, we drop the condition of market completeness, and we develop the
notion of an arbitrage-free price Ï€ for a discounted American claim H in a general
incomplete framework. The basic idea consists in reducing the problem to the deter-
mination of the arbitrage-free price for the payoff HÏ„ which arises from H by ï¬xing
the exercise strategy Ï„. The following remark explains that HÏ„ can be treated like the
discounted payoff of a European contingent claim, whose set of arbitrage-free prices
is given by
(HÏ„) =

Eâˆ—[ HÏ„ ] | P âˆ—âˆˆP , Eâˆ—[ HÏ„ ] < âˆ

.
(6.16)
Remark 6.30. As observed in Remark 5.34, a discounted payoff 
Ht which is received
at time t < T can be regarded as a discounted European claim 
H E maturing at T .

H E is obtained from 
Ht by investing at time t the payoff S0
t 
Ht into the numÃ©raire,
i.e., by buying 
Ht shares of the 0th asset, and by considering the discounted terminal
value of this investment:

H E = 1
S0
T
( S0
T 
Ht ) = 
Ht.

6.3 Arbitrage-free prices
293
In the case of our discounted American claim H which is payed off at the random
time Ï„, we can either apply this argument to each payoff

Ht := HÏ„ I{Ï„=t} = Ht I{Ï„=t},
or directly use a stopping time version of this argument. We conclude that HÏ„ can
be regarded as a discounted European claim, whose arbitrage-free prices are given by
(6.16).
â™¦
Now suppose that H is offered at time t = 0 for a price Ï€ â‰¥0. From the buyerâ€™s
point of view there should be at least one exercise strategy Ï„ such that the proposed
price Ï€ is not too high in the sense that Ï€ â‰¤Ï€â€² for some Ï€â€² âˆˆ(HÏ„). From the sellerâ€™s
point of view the situation looks different: There should be no exercise strategy Ï„ â€²
such that the proposed price Ï€ is too low in the sense that Ï€ < Ï€â€² for all Ï€â€² âˆˆ(HÏ„ â€²).
By adding the assumption that the buyer only uses stopping times in exercising the
option, we obtain the following formal deï¬nition.
Deï¬nition 6.31. A real number Ï€ is called an arbitrage-free price of a discounted
American claim H if the following two conditions are satisï¬ed.
â€¢ The price Ï€ is not too high in the sense that there exists some Ï„ âˆˆT and
Ï€â€² âˆˆ(HÏ„) such that Ï€ â‰¤Ï€â€².
â€¢ The price Ï€ is not too low in the sense that there exists no Ï„ â€² âˆˆT such that
Ï€ < Ï€â€² for all Ï€â€² âˆˆ(HÏ„ â€²).
The set of all arbitrage-free prices of H is denoted (H), and we deï¬ne
Ï€inf(H) := inf (H)
and
Ï€sup(H) := sup (H).
Recall from Remark 6.7 that every discounted European claim H E can be regarded
as a discountedAmerican claim H A whose payoff is zero if H A is exercised before T ,
and whose payoff at T equals H E. Clearly, the two sets (H E) and (H A) coincide,
and so the two Deï¬nitions 5.29 and 6.31 are consistent with each other.
Remark 6.32. It follows from the deï¬nition that any arbitrage-free price Ï€ for H
must be an arbitrage-free price for some HÏ„. Hence, (6.16) implies that Ï€ = Eâˆ—[ HÏ„ ]
for some P âˆ—âˆˆP . Similarly, we obtain from the second condition in Deï¬nition 6.31
that Ï€ â‰¥infP âˆ—âˆˆP Eâˆ—[ HÏ„ ] for all Ï„ âˆˆT . It follows that
sup
Ï„âˆˆT
inf
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ] â‰¤Ï€ â‰¤sup
Ï„âˆˆT
sup
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ]
for all Ï€ âˆˆ(H).
(6.17)
In particular,
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ]
is the unique arbitrage-free price of H if P âˆ—is the unique equivalent martingale
measure in a complete market model, and so Deï¬nition 6.31 is consistent with the
results of the Section 6.1 and 6.2.
â™¦

294
6 American contingent claims
Our main goal in this section is to characterize the set (H), and to identify the
upper and lower bounds in (6.17) with the quantities Ï€sup(H) and Ï€inf(H). We will
work under the simplifying assumption that
Ht âˆˆL1(P âˆ—) for all t and each P âˆ—âˆˆP .
(6.18)
Note that (6.18) implies the condition
inf
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] < âˆ.
For each P âˆ—âˆˆP we denote by UP âˆ—the corresponding Snell envelope of H, i.e.,
UP âˆ—
t
= ess sup
Ï„âˆˆTt
Eâˆ—[ HÏ„ | Ft ].
With this notation, the right-hand bound in (6.17) can be written as
sup
Ï„âˆˆT
sup
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ] = sup
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] = sup
P âˆ—âˆˆP
UP âˆ—
0 .
In fact, a similar relation also holds for the lower bound in (6.17):
sup
Ï„âˆˆT
inf
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ] = inf
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] = inf
P âˆ—âˆˆP
UP âˆ—
0 .
(6.19)
The proof that the above interchange of inï¬mum and supremum is indeed justiï¬ed
under assumption (6.18) is postponed to the next section; see Theorem 6.47.
Theorem 6.33. Under condition (6.18), the set of arbitrage-free prices for H is a real
interval with endpoints
Ï€inf(H) = inf
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] = sup
Ï„âˆˆT
inf
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ]
and
Ï€sup(H) = sup
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] = sup
Ï„âˆˆT
sup
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ].
Moreover, (H) either consists of one single point or does not contain its upper
endpoint Ï€sup(H).
Proof. LetÏ„ âˆ—beastoppingtimewhichisoptimalwithrespecttoagivenP âˆ—âˆˆP . Then
UP âˆ—
0
= Eâˆ—[ HÏ„ âˆ—] = supÏ„ â€²âˆˆT Eâˆ—[ HÏ„ â€² ], and consequently UP âˆ—
0
âˆˆ(H). Together
with the a priori bounds (6.17), we obtain the inclusions
{ UP âˆ—
0
| P âˆ—âˆˆP } âŠ‚(H) âŠ‚[a, b],
(6.20)
where
a := sup
Ï„âˆˆT
inf
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ]
and
b := sup
Ï„âˆˆT
sup
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ].

6.3 Arbitrage-free prices
295
Moreover, the minimax identity (6.19) shows that
a = inf
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] = inf
P âˆ—âˆˆP UP âˆ—
0
and
b = sup
P âˆ—âˆˆP
UP âˆ—
0 .
Together with (6.20), this yields the identiï¬cation of Ï€inf(H) and Ï€sup(H) as a and b.
Now we claim that { UP âˆ—
0
| P âˆ—âˆˆP } is an interval, which, in view of the preceding
step, will prove that (H) is also an interval. Take P0, P1 âˆˆP and deï¬ne PÎ± âˆˆP
by PÎ± := Î±P1 + (1 âˆ’Î±)P0 for 0 â‰¤Î± â‰¤1. By Theorem 6.20, f (Î±) := UPÎ±
0
is the
supremum of the afï¬ne functions
Î± â†’EÎ±[ HÏ„ ] = Î±E1[ HÏ„ ] + (1 âˆ’Î±)E0[ HÏ„ ],
Ï„ âˆˆT .
Thus, f is convex and lower semicontinuous on [0, 1], hence continuous; see part (a)
of Proposition A.4. Since P is convex, this proves our claim.
It remains to exclude the possibility that b belongs to (H) in case a < b. Suppose
by way of contradiction that b âˆˆ(H). Then there exist Ë†Ï„ âˆˆT and Ë†P âˆˆP such that
Ë†E[ HË†Ï„ ] = b = sup
Ï„âˆˆT
sup
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ].
In particular, Ë†P attains the supremum of Eâˆ—[ HË†Ï„ ] for P âˆ—âˆˆP . Theorem 5.33 im-
plies that the discounted European claim HË†Ï„ is attainable and that Eâˆ—[ HË†Ï„ ] is in fact
independent of P âˆ—âˆˆP. Hence,
b = Ë†E[ HË†Ï„ ] = inf
P âˆ—âˆˆP Eâˆ—[ HË†Ï„ ] â‰¤sup
Ï„âˆˆT
inf
P âˆ—âˆˆP Eâˆ—[ HÏ„ ],
and we end up with the contradiction b â‰¤a. Thus, b cannot belong to (H).
Comparing the previous result with Theorem 5.33, one might wonder whether
(H) contains its lower bound if Ï€inf(H) < Ï€sup(H). At a ï¬rst glance, it may come
as a surprise that both cases
Ï€inf(H) âˆˆ(H)
and
Ï€inf(H) /âˆˆ(H)
can occur, as is illustrated by the following simple example.
Example 6.34. Consider a complete market model with T = 2, deï¬ned on some
probability space (0, F0, P0). This model will be enlarged by adding two external
states Ï‰+ and Ï‰âˆ’, i.e., we deï¬ne  := 0 Ã— {Ï‰+, Ï‰âˆ’} and
P [ {(Ï‰0, Ï‰Â±)} ] := 1
2 P0[ {Ï‰0} ],
Ï‰0 âˆˆ0.
The enlarged ï¬nancial market model will then be incomplete, and the corresponding
set P of equivalent martingale measures is given by
P = { P âˆ—
p | 0 < p < 1 },

296
6 American contingent claims
where P âˆ—
p is determined by P âˆ—
p [ 0 Ã— {Ï‰+} ] = p. Consider the discounted American
claim H deï¬ned as
H0 â‰¡0,
H1 â‰¡1,
and
H2(Ï‰) :=

2
if Ï‰ = (Ï‰0, Ï‰+),
0
if Ï‰ = (Ï‰0, Ï‰âˆ’).
Clearly, Ï„2 â‰¡2 is an optimal stopping time for P âˆ—
p if p > 1
2, while Ï„1 â‰¡1 is optimal
for p â‰¤1
2. Hence,
(H) = [1, 2),
and the lower bound Ï€inf(H) = 1 is an arbitrage-free price for H. Now consider the
discounted American claim 
H deï¬ned by 
Ht = Ht for t = 0, 2 and by 
H1 â‰¡0. In
this case, we have
( 
H) = (0, 2).
â™¦
Theorem 6.33 suggests that anAmerican claim H which admits a unique arbitrage-
free price should be attainable in an appropriate sense. Corollary 6.24, our hedging
resultinthecaseofacompletemarket, suggeststhefollowingdeï¬nitionofattainability.
Deï¬nition 6.35. A discounted American claim H is called attainable if there exists
a stopping time Ï„ âˆˆT and a self-ï¬nancing trading strategy Î¾ whose value process V
satisï¬es P-a.s.
Vt â‰¥Ht for all t, and VÏ„ = HÏ„.
The trading strategy Î¾ is called a hedging strategy for H.
If H is attainable, then a hedging strategy protects the seller not only against those
claims HÏ„ which arise from stopping times Ï„. The seller is on the safe side even if the
buyer would have full knowledge of future prices and would exercise H at an arbitrary
FT -measurable random time Ïƒ. For instance, the buyer even could choose Ïƒ such that
HÏƒ = max
0â‰¤tâ‰¤T Ht.
In fact, we will see in Remark 7.12 that H is attainable in the sense of Deï¬nition 6.35
if and only if Vt â‰¥Ht for all t and VÏƒ = HÏƒ for some FT -measurable random time Ïƒ.
If the market model is complete, then every American claim H is attainable.
Moreover, Theorem 6.12 and Corollary 6.24 imply that the minimal initial investment
needed for the purchase of a hedging strategy for H is equal to the unique arbitrage-
free price of H. In a general market model, every attainable discounted American
claim H satisï¬es our integrability condition (6.18) and has a unique arbitrage-free
price which is equal to the initial investment of a hedging strategy for H. This follows
from Theorem 5.26. In fact, the converse implication is also true:
Theorem 6.36. For a discounted American claim H satisfying (6.18), the following
conditions are equivalent:

6.4 Stability under pasting
297
(a) H is attainable.
(b) H admits a unique arbitrage-free price Ï€(H), i.e., (H) = {Ï€(H)}.
(c) Ï€sup(H) âˆˆ(H).
Moreover, if H is attainable, then Ï€(H) is equal to the initial investment of any hedging
strategy for H.
The equivalence of (b) and (c) is an immediate consequence of Theorem 6.33.
The remainder of the proof of Theorem 6.36 is postponed to Remark 7.10 because it
requires the technique of superhedging, which will be introduced in Section 7.
6.4
Stability under pasting
In this section we deï¬ne the pasting of two equivalent probability measures at a given
stopping time. This operation will play an important role in the analysis of lower
and upper Snell envelopes as developed in Section 6.5. In particular, we will prepare
for the proof of the minimax identity (6.17), which was used in the characterization
of arbitrage-free prices of an American contingent claim. Let us start with a few
preparations.
Deï¬nition 6.37. Let Ï„ be a stopping time. The Ïƒ-algebra of events which are observ-
able up to time Ï„ is deï¬ned as
FÏ„ :=

A âˆˆF | A âˆ©{Ï„ â‰¤t} âˆˆFt for all t

.
It is straightforward to check that FÏ„ is indeed a Ïƒ-algebra and that
FÏ„ =

A âˆˆF | A âˆ©{Ï„ = t} âˆˆFt for all t

.
In particular, FÏ„ coincides with Ft if Ï„ â‰¡t. Moreover, if Ïƒ is a stopping time with
Ïƒ(Ï‰) â‰¤Ï„(Ï‰) for all Ï‰ âˆˆ, then FÏƒ âŠ‚FÏ„.
The following result is an addendum to Doobâ€™s stopping theorem; see Theo-
rem 6.17:
Proposition 6.38. For an adapted process M in L1(Q) the following conditions are
equivalent:
(a) M is a Q-martingale.
(b) EQ[ MÏ„ | FÏƒ ] = MÏ„âˆ§Ïƒ for all Ï„ âˆˆT and all stopping times Ïƒ.

298
6 American contingent claims
Proof. (a) â‡’(b): Take a set A âˆˆFÏƒ and let us write
EQ[ MÏ„; A ] = EQ

MÏ„; A âˆ©{Ï„ â‰¤Ïƒ}

+ EQ

MÏ„; A âˆ©{Ï„ > Ïƒ}

.
Condition (b) will follow if we may replace MÏ„ by MÏƒ in the rightmost expectation.
To this end, note that
A âˆ©{Ïƒ = t} âˆ©{Ï„ > Ïƒ} = A âˆ©{Ïƒ = t} âˆ©{Ï„ > t} âˆˆFt.
Thus, since the stopped process MÏ„ is a martingale by Theorem 6.17,
EQ

MÏ„; A âˆ©{Ï„ > Ïƒ}

=
T

t=0
EQ

MÏ„
T ; A âˆ©{Ïƒ = t} âˆ©{Ï„ > Ïƒ}

=
T

t=0
EQ

MÏ„
t ; A âˆ©{Ïƒ = t} âˆ©{Ï„ > Ïƒ}

= EQ

MÏƒ; A âˆ©{Ï„ > Ïƒ}

.
(b) â‡’(a): This follows by taking Ï„ â‰¡t and Ïƒ â‰¡s â‰¤t.
Example 6.39. Let Z be the density process of a probability measure 
Q that is abso-
lutely continuous with respect to Q; see Remark 5.13. If Ïƒ is a stopping time, then
we have 
Q â‰ªQ on FÏƒ, and Propositions A.11 and 6.38 show that the corresponding
density is given by
d 
Q
dQ

FÏƒ
= EQ[ ZT | FÏƒ ] = ZT âˆ§Ïƒ.
â™¦
We have also the following extension of Theorem 6.20. It provides the solution to
the optimal stopping problem posed at any stopping time Ï„ â‰¤T .
Proposition 6.40. LetH beanadaptedprocessinL1(, F , Q), anddeï¬neforÏ„ âˆˆT
TÏ„ := { Ïƒ âˆˆT | Ïƒ â‰¥Ï„ }.
Then the Snell envelope UQ of H satisï¬es Q-a.s.
UQ
Ï„ = ess sup
ÏƒâˆˆTÏ„
EQ[ HÏƒ | FÏ„ ],
and the essential supremum is attained for
Ïƒ (Ï„)
min := min{ t â‰¥Ï„ | Ht = UQ
t }.
Proof. It is not difï¬cult to reduce the assertion to Theorem 6.20 by using the identity
EQ[ HÏƒ | FÏ„ ] = EQ[ HÏƒ | Ft ]
Q-a.s. on {Ï„ = t},
(6.21)
which is proved by checking the deï¬ning properties of the conditional expectation.

6.4 Stability under pasting
299
Deï¬nition 6.41. Let Q1 and Q2 be two equivalent probability measures and take
Ïƒ âˆˆT . The probability measure

Q[ A ] := EQ1

Q2[ A | FÏƒ ]

,
A âˆˆFT ,
is called the pasting of Q1 and Q2 in Ïƒ.
The monotone convergence theorem for conditional expectations guarantees that

Q is indeed a probability measure and that
E
Q[ Y ] = EQ1

EQ2[ Y | FÏƒ ]

for all FT -measurable Y â‰¥0. Note that 
Q coincides with Q1 on FÏƒ, i.e.,
E
Q[ Y ] = EQ1[ Y ]
for all FÏƒ-measurable Y â‰¥0.
Lemma 6.42. For Q1 â‰ˆQ2, their pasting in Ïƒ âˆˆT is equivalent to Q1 and satisï¬es
d 
Q
dQ1
= ZT
ZÏƒ
,
where Z is the density process of Q2 with respect to Q1.
Proof. For Y â‰¥0,
E
Q[ Y ] = EQ1

EQ2[ Y | FÏƒ ]

= EQ1
 1
ZÏƒ
EQ1[ YZT | FÏƒ ]
!
= EQ1
 ZT
ZÏƒ
Y
!
,
where we have used the martingale property of Z and the fact that ZÏƒ > 0 Q1-almost
surely. The equivalence of 
Q and Q1 follows from ZT > 0 Q1-almost surely.
Lemma 6.43. For Q1 â‰ˆQ2, let 
Q be their pasting in Ïƒ âˆˆT . Then, for all stopping
times Ï„ and FT -measurable Y â‰¥0,
E
Q[ Y | FÏ„ ] = EQ1

EQ2[ Y | FÏƒâˆ¨Ï„ ] | FÏ„

.
Proof. If Ï• â‰¥0 is FÏ„-measurable, then Ï•I{Ï„â‰¤Ïƒ} is FÏƒ âˆ©FÏ„-measurable. Hence,
E
Q[ YÏ•; Ï„ â‰¤Ïƒ ]
=
EQ1

EQ2[ Y | FÏƒ ]Ï•; Ï„ â‰¤Ïƒ

=
EQ1

EQ1

EQ2[ Y | FÏƒ ] | FÏ„

Ï•; Ï„ â‰¤Ïƒ

=
E
Q

EQ1

EQ2[ Y | FÏƒ ] | FÏ„

Ï•; Ï„ â‰¤Ïƒ

,

300
6 American contingent claims
where we have used the fact that 
Q coincides with Q1 on FÏƒ. On the other hand,
E
Q[ YÏ•; Ï„ > Ïƒ ]
=
EQ1

EQ2

EQ2[ Y | FÏ„ ]Ï• | FÏƒ

; Ï„ > Ïƒ

=
E
Q

EQ2[ Y | FÏ„ ]Ï•; Ï„ > Ïƒ

.
It follows that
E
Q[ Y | FÏ„ ] = EQ1

EQ2[ Y | FÏƒ ] | FÏ„

I{Ï„â‰¤Ïƒ} + EQ2[ Y | FÏ„ ] I{Ï„>Ïƒ},
and this coincides with the right-hand side of the asserted identity.
Deï¬nition 6.44. A set Q of equivalent probability measures on (, F ) is called stable
if, for any Q1, Q2 âˆˆQ and Ïƒ âˆˆT , also their pasting in Ïƒ is contained in Q.
The condition of stability in the preceding deï¬nition is sometimes also called fork
convexity, m-stability, or stability under pasting. For the purposes of this book, the
most important example of a stable set is the class P of all equivalent martingale
measures, but in Section 6.5 we will also discuss the connection between stable sets
and dynamic risk measures.
Proposition 6.45. P is stable.
Proof. Take P1, P2 âˆˆP and denote by 
P their pasting a given Ïƒ âˆˆT . Doobâ€™s
stopping theorem in the form of Proposition 6.38 and Lemma 6.43 applied with
Y := Xi
t â‰¥0 and Ï„ â‰¡s yield that

E[ Xt | Fs ] = E1

E2[ Xt | FÏƒâˆ¨s ] | Fs

= E1[ XÏƒâˆ¨s | Fs ] = Xs.
It follows in particular that each component Xi
t is in L1(
P ) since 
E[ Xi
t ] = Xi
0 < âˆ,
concluding the proof of 
P âˆˆP .
6.5
Lower and upper Snell envelopes
Our main goal in this section is to provide a proof of the minimax identity (6.19),
that was used in the characterization of the set of arbitrage-free prices of an American
contingent claim. The techniques and results which we develop here will help to
characterize the time-consistency of dynamic coherent risk measures and they will
also be needed in Chapter 7. Moreover, they can be interpreted in terms of an optimal
stopping problem for general utility functionals which appear in a robust Savage
representation of preferences on payoff proï¬les. Let us now ï¬x a set Q of equivalent
probability measures and an adapted process H such that
Ht âˆˆL1(Q) for all t and each Q âˆˆQ.

6.5 Lower and upper Snell envelopes
301
Recall that this condition implies
inf
QâˆˆQ
sup
Ï„âˆˆT
EQ[ HÏ„ ] = inf
QâˆˆQ
UQ
0 < âˆ,
where UQ denotes the Snell envelope of H with respect to Q âˆˆQ. Let us also assume
that
Q is stable.
Deï¬nition 6.46. The lower Snell envelope of H is deï¬ned as
Uâ†“
t := ess inf
QâˆˆQ
UQ
t
= ess inf
QâˆˆQ
ess sup
Ï„âˆˆTt
EQ[ HÏ„ | Ft ],
t = 0, . . . , T.
The upper Snell envelope of H is deï¬ned as
Uâ†‘
t := ess sup
QâˆˆQ
UQ
t
= ess sup
Ï„âˆˆTt
ess sup
QâˆˆQ
EQ[ HÏ„ | Ft ],
t = 0, . . . , T.
We will ï¬rst study the lower Snell envelope. The following â€œminimax theoremâ€
states that the essential inï¬mum and the essential supremum occurring in the deï¬nition
of Uâ†“may be interchanged if Q is stable. Applied at t = 0 and combined with
Proposition 6.45, this gives the identity (6.19), which was used in our characterization
of the arbitrage-free prices of H.
Theorem 6.47. The lower Snell envelope of H satisï¬es
Uâ†“
t = ess sup
Ï„âˆˆTt
ess inf
QâˆˆQ
EQ[ HÏ„ | Ft ]
for each t.
(6.22)
In particular,
Uâ†“
0 = inf
QâˆˆQ
sup
Ï„âˆˆT
EQ[ HÏ„ ] = sup
Ï„âˆˆT
inf
QâˆˆQ
EQ[ HÏ„ ].
The inequality â‰¥in (6.22) is obvious. Its converse is an immediate consequence
of the next theorem, which solves the following optimal stopping problem that is
formulated with respect to the nonadditive expectation operator infQâˆˆQ EQ[ Â· ]:
maximize inf
QâˆˆQ EQ[ HÏ„ ] among all Ï„ âˆˆT .
Theorem 6.48. Deï¬ne a stopping time Ï„t âˆˆTt by
Ï„t := min{ u â‰¥t | Uâ†“
u = Hu }.
Then, P -a.s.,
Uâ†“
t = ess inf
QâˆˆQ EQ[ HÏ„t | Ft ].
(6.23)
In particular,
sup
Ï„âˆˆT
inf
QâˆˆQ
EQ[ HÏ„ ] = inf
QâˆˆQ
EQ[ HÏ„0 ] = Uâ†“
0 .

302
6 American contingent claims
For the proof of Theorem 6.48, we need some preparations.
Lemma 6.49. Suppose that we are given Q1, Q2 âˆˆQ, a stopping time Ï„ âˆˆT , and a
set B âˆˆFÏ„. Let 
Q âˆˆQ be the pasting of Q1 and Q2 in the stopping time
Ïƒ := Ï„ IB + T IBc .
Then the Snell envelopes associated with these three measures are related as follows:
U 
Q
Ï„ = UQ2
Ï„
IB + UQ1
Ï„
IBc
P -a.s.
(6.24)
Proof. With Proposition 6.40 and its notation, we have
U 
Q
Ï„ = ess sup
ÏâˆˆTÏ„
E
Q[ HÏ | FÏ„ ].
To compute the conditional expectation on the right, note ï¬rst that
EQ2[ HÏ | FÏƒâˆ¨Ï„ ] = EQ2[ HÏ | FÏ„ ] IB + HÏ IBc .
Hence, Lemma 6.43 yields that
E
Q[ HÏ | FÏ„ ] = EQ2[ HÏ | FÏ„ ] IB + EQ1[ HÏ | FÏ„ ] IBc .
Moreover, whenever Ï1, Ï2 âˆˆTÏ„, then
Ï := Ï1 IB + Ï2 IBc
is also a stopping time in TÏ„. Thus,
U 
Q
Ï„ = ess sup
ÏâˆˆTÏ„
EQ2[ HÏ | FÏ„ ] IB + ess sup
ÏâˆˆTÏ„
EQ1[ HÏ | FÏ„ ] IBc ,
and (6.24) follows.
Lemma 6.50. For any Q âˆˆQ and Ï„ âˆˆT there exist Qk âˆˆQ such that Qk = Q on
FÏ„ and
UQk
Ï„
â†˜ess inf
Ë†QâˆˆQ
U Ë†Q
Ï„ = Uâ†“
Ï„ .
Similarly, there exist Qk âˆˆQ such that Qk = Q on FÏ„ and
UQk
Ï„
â†—ess sup
Ë†QâˆˆQ
U Ë†Q
Ï„ =: Uâ†‘
Ï„ .
Proof. For Q1, Q2 âˆˆQ, B := { UQ1
Ï„
> UQ2
Ï„
}, take 
Q âˆˆQ as in Lemma 6.49. Then
U 
Q
Ï„ = UQ1
Ï„
Â· IBc + UQ2
Ï„
Â· IB = UQ1
Ï„
âˆ§UQ2
Ï„
.
(6.25)

6.5 Lower and upper Snell envelopes
303
Moreover, if Q1 = Q on FÏ„ then also 
Q = Q on FÏ„. Hence, the set
 :=

U Ë†Q
Ï„ | Ë†Q âˆˆQ and Ë†Q = Q on FÏ„

is such that Uâ†“
Ï„ = ess inf . Moreover, (6.25) implies that  is directed downwards,
and the second part of Theorem A.32 states the existence of the desired sequence
(Qk) âŠ‚Q. The proof for the essential supremum is analogous.
Proof of Theorem 6.48. To prove (6.23), observe ï¬rst that UQ
t
â‰¥EQ[ HÏ„t | Ft ] for
each Q âˆˆQ, so that â‰¥holds in (6.23). For the proof of the converse inequality, note
that
Ï„t â‰¤min{ u â‰¥t | UQ
u = Hu } =: Ï„ Q
t
for Q âˆˆQ.
It was shown in Theorem 6.20 that Ï„ Q
t
is the minimal optimal stopping time after time
t and with respect to Q. It was also shown in the proof of Theorem 6.20 that the
stopped process (UQ)Ï„ Q
t is a Q-martingale from time t on. In particular,
UQ
t
= EQ[ UQ
Ï„t | Ft ]
for all Q âˆˆQ.
(6.26)
Let us now ï¬x some Q âˆˆQ. Lemma 6.50 yields Qk âˆˆQ with Qk = Q on FÏ„t
such that UQk
Ï„t
decreases to Uâ†“
Ï„t . We obtain
EQ[ HÏ„t | Ft ] = EQ[ Uâ†“
Ï„t | Ft ] = EQ

lim
kâ†‘âˆUQk
Ï„t
| Ft

= lim
kâ†‘âˆEQ[ UQk
Ï„t
| Ft ] = lim
kâ†‘âˆEQk[ UQk
Ï„t
| Ft ]
= lim
kâ†‘âˆUQk
t
â‰¥Uâ†“
t .
Here we have used the facts that HÏ„t
â‰¤UQk
Ï„t
â‰¤UQ1
Ï„t
and EQ[ |UQ1
Ï„t | ] =
EQ1[ |UQ1
Ï„t | ] < âˆtogether with dominated convergence in the third step, the fact
that Qk = Q on FÏ„t âŠƒFt in the fourth, and (6.26) in the ï¬fth identity.
Remark 6.51. Suppose the buyer of an American option uses a utility functional of
the form
inf
QâˆˆQ EQ[ u(Z) ],
where Q is a set of probability measures and u is a measurable function. This may be
viewed as a robust Savage representation of a preference relation on discounted asset
payoffs; see Section 2.5. Thus, the aim of the buyer is to maximize the utility
inf
QâˆˆQ EQ[ u(HÏ„) ]
of the discounted payoff HÏ„ among all stopping times Ï„ âˆˆT . This generalized
utility maximization problem can be solved with the results developed in this section,

304
6 American contingent claims
provided that the set Q is a stable set of equivalent probability measures. Indeed,
assume

Ht := u(Ht) âˆˆL1(Q)
for all t and each Q âˆˆQ,
and let UQ be the Snell envelope of 
Ht with respect to Q âˆˆQ. Theorem 6.48 states
that the generalized optimal stopping problem is solved by the stopping time
Ï„ âˆ—:= min{ t â‰¥0 | ess inf
QâˆˆQ UQ
t
= 
Ht },
i.e.,
inf
QâˆˆQ
sup
Ï„âˆˆT
EQ[ u(HÏ„) ] = Uâ†“
0 = inf
QâˆˆQ
EQ[ u(HÏ„ âˆ—) ].
â™¦
Let us now turn to the analysis of the upper Snell envelope
Uâ†‘
t := ess sup
QâˆˆQ
UQ
t
= ess sup
Ï„âˆˆTt
ess sup
QâˆˆQ
EQ[ HÏ„ | Ft ],
t = 0, . . . , T.
In order to simplify the presentation, we will assume from now on that
sup
QâˆˆQ
EQ[ |Ht| ] < âˆ
for all t.
This condition implies that
Uâ†‘
0 = sup
QâˆˆQ
UQ
0 â‰¤sup
Ï„âˆˆT
sup
QâˆˆQ
EQ[ |HÏ„| ] < âˆ.
Our main result on upper Snell envelopes states that, for stable sets Q, the upper
Snell envelope Uâ†‘satisï¬es a recursive scheme that is similar to the one for ordinary
Snell envelopes. In contrast to (6.4), however, it involves the nonadditive conditional
expectation operators ess supQ EQ[ Â· | Ft ].
Theorem 6.52. Uâ†‘satisï¬es the following recursive scheme:
Uâ†‘
T = HT and Uâ†‘
t = Ht âˆ¨ess sup
QâˆˆQ
EQ[ Uâ†‘
t+1 | Ft ],
t = T âˆ’1 . . . , 0.
(6.27)
Proof. The deï¬nition of the Snell envelope UQ implies that
Uâ†‘
t = ess sup
QâˆˆQ
UQ
t
= Ht âˆ¨ess sup
QâˆˆQ
EQ[ UQ
t+1 | Ft ].
(6.28)
Next, we ï¬x Q âˆˆQ and denote by Qt+1(Q) the set of all Ë†Q âˆˆQ which coincide
with Q on Ft+1. According to Lemma 6.50, there are Qk âˆˆQt+1(Q) such that

6.5 Lower and upper Snell envelopes
305
UQk
t+1 â†—Uâ†‘
t+1. The fact that EQ[ |UQ1
t+1| ] = EQ1[ |UQ1
t+1| ] < âˆcombined with
monotone convergence for conditional expectations shows that
ess sup
QâˆˆQ
EQ[ Uâ†‘
t+1 | Ft ] â‰¥ess sup
QâˆˆQ
EQ[ UQ
t+1 | Ft ]
= ess sup
QâˆˆQ
ess sup
Ë†QâˆˆQt+1(Q)
EQ[ U
Ë†Q
t+1 | Ft ]
â‰¥ess sup
QâˆˆQ
lim inf
kâ†‘âˆEQ[ UQk
t+1 | Ft ]
= ess sup
QâˆˆQ
EQ[ Uâ†‘
t+1 | Ft ].
(6.29)
In particular, all inequalities are in fact identities. Together with (6.28) we obtain the
recursive scheme for Uâ†‘.
The following result shows that the nonadditive conditional expectation operators
ess supQ EQ[ Â· | Ft ] associated with a stable set Q enjoy a consistency property that
is similar to the martingale property for ordinary conditional expectations.
Theorem 6.53. Let Q be a set of equivalent probability measures and
V â†‘
t := ess sup
QâˆˆQ
EQ[ H | Ft ],
t = 0, . . . , T,
for some FT -measurable H â‰¥0 such that V â†‘
0 < âˆ. If Q is stable then
V â†‘
Ïƒ = ess sup
QâˆˆQ
EQ[ V â†‘
Ï„ | FÏƒ ]
for Ïƒ, Ï„ âˆˆT with Ïƒ â‰¤Ï„.
If, in addition, Q is convex and the set of densities { dQ/dP | Q âˆˆQ } is closed in
L1(P ) for some equivalent reference measure P , then also the following converse
implication holds: if for all Ï„ âˆˆT and H âˆˆLâˆ(P ),
sup
QâˆˆQ
EQ[ H ] = sup
QâˆˆQ
EQ

ess sup
Qâ€²âˆˆQ
EQâ€²[ H | FÏ„ ]

,
(6.30)
then Q is stable.
Remark 6.54. Note that, for H as in the theorem and Ï„ âˆˆT ,
V â†‘
Ï„ =
T

t=0
ess sup
QâˆˆQ
EQ[ H | Ft ]I{Ï„=t}
=
T

t=0
ess sup
QâˆˆQ
EQ[ H | FÏ„ ]I{Ï„=t}
= ess sup
QâˆˆQ
EQ[ H | FÏ„ ],
where we have used (6.21) in the second identity.
â™¦

306
6 American contingent claims
Proof of Theorem 6.53. By Remark 6.54,
V â†‘
Ïƒ = ess sup
QâˆˆQ
EQ[ H | FÏƒ ] = ess sup
QâˆˆQ
EQ

EQ[ H | FÏ„ ]
 FÏƒ

.
The proof that the right-hand side is equal to ess supQâˆˆQ EQ[ V â†‘
Ï„ | FÏƒ ] is done by
ï¬rst noting that V â†‘is equal to the upper Snell envelope of the process Ht given by
HT = H and Ht = 0 for t < T . Then the same argument as in (6.29) applies. All
one has to do is to replace t + 1 by Ï„.
To prove the converse implication, let us assume by way of contradiction that the
pasting 
Q of some measures Q1, Q2 âˆˆQ in a stopping time Ï„ âˆˆT does not belong
to Q. By the Hahnâ€“Banach theorem, there exists some H âˆˆLâˆ(P ) such that
sup
QâˆˆQ
EQ[ H ] < E
Q[ H ].
(6.31)
Using the deï¬nition of 
Q and our assumption (6.30), we obtain
E
Q[ H ] = EQ1

EQ2[ H | FÏ„ ]

â‰¤EQ1

ess sup
Qâ€²âˆˆQ
EQâ€²[ H | FÏ„ ]

â‰¤sup
QâˆˆQ
EQ

ess sup
Qâ€²âˆˆQ
EQâ€²[ H | FÏ„ ]

= sup
QâˆˆQ
EQ[ H ],
in contradiction to (6.31).
Let us conclude this section by pointing out the connection between stability under
pasting and the time-consistency of dynamic coherent risk measures. Let
Ï(Y) := sup
QâˆˆQ
EQ[ âˆ’Y ],
Y âˆˆLâˆ(P ),
be a coherent risk measure on Lâˆ(P ) deï¬ned in terms of a set Q of probability
measures equivalent to P . In the context of a dynamic ï¬nancial market model, it is
natural to update the initial risk assessment at later times t > 0. If one continues to
use Q as a basis to compute the risk but takes into account the available information,
one is led to consider the conditional risk measures
Ït(Y) = ess sup
QâˆˆQ
EQ[ âˆ’Y | Ft ],
t = 0, . . . , T.
(6.32)
The sequence Ï0 . . . , ÏT can be regarded as a dynamic coherent risk measure. Often,
such a dynamic risk measure is called time-consistent or dynamically consistent if
Ïs(âˆ’Ït(Y)) = Ïs(Y)
for 0 â‰¤s â‰¤t â‰¤T .
(6.33)

6.5 Lower and upper Snell envelopes
307
Corollary 6.55. Let Q be a set of equivalent probability measures. The dynamic risk
measure Ï0, . . . , ÏT arising from Q via (6.32) is time-consistent as soon as Q is stable.
Conversely, stability of Q is necessary if time-consistency is required also for stopping
times and if Q coincides with Qmax, the maximal representing subset of M1(P ) for Ï.
Proof. This follows from Theorem 6.53, since
$ dQ
dP
 Q âˆˆQmax
%
=

XâˆˆAÏ

Ï• âˆˆL1
+(P ) | E[ Ï•X ] â‰¥0, E[ Ï• ] = 1

is convex and closed in L1(P ).
If one requires time-consistency only in the weak form (6.33), one can show by
using the arguments in this section that it is necessary and sufï¬cient for Q to be stable
under pasting in stopping times that take at most one value different from T .

Chapter 7
Superhedging
The idea of superhedging is to ï¬nd a self-ï¬nancing trading strategy with minimal initial
investment which covers any possible future obligation resulting from the sale of a
contingent claim. If the contingent claim is not attainable, the proof of the existence
of such a â€œsuperhedging strategyâ€ requires new techniques, and in particular a new
uniform version of the Doob decomposition. We will develop this theory for general
American contingent claims. In doing so, we will also obtain new results for European
contingent claims. In the ï¬rst three sections of this chapter, we assume that our market
model is arbitrage-free or, equivalently, that the set of equivalent martingale measures
satisï¬es
P Ì¸= âˆ….
In the ï¬nal Section 7.4, we discuss liquid options in a setting where no probabilistic
model is ï¬xed a priori. Such options may be used for the construction of speciï¬c
martingale measures, and also for the purpose of hedging illiquid exotic derivatives.
7.1 P-supermartingales
In this section, H denotes a discounted American claim with
sup
P âˆ—âˆˆP
Eâˆ—[ Ht ] < âˆ
for all t.
(7.1)
Our aim in this chapter is to ï¬nd the minimal amount of capital Ut that will be needed
at time t in order to purchase a self-ï¬nancing trading strategy whose value process
satisï¬es Vu â‰¥Hu for all u â‰¥t. In analogy to our derivation of the recursive scheme
(6.4), we will now heuristically derive a formula for Ut. At time T , the minimal
amount needed is clearly given by
UT = HT .
At time T âˆ’1, a ï¬rst requirement is to have UT âˆ’1 â‰¥HT âˆ’1. Moreover, the amount
UT âˆ’1 must sufï¬ce to purchase an FT âˆ’1-measurable portfolio Î¾T such that Î¾T Â· XT â‰¥
HT almost surely. An informal application of Theorem 1.31, conditional on FT âˆ’1,
shows that
UT âˆ’1 â‰¥ess sup
P âˆ—âˆˆP
Eâˆ—[ HT | FT âˆ’1 ].

7.1 P-supermartingales
309
Hence, the minimal amount UT âˆ’1 is equal to the maximum of HT âˆ’1 and this essential
supremum. An iteration of this argument yields the recursive scheme
UT = HT
and
Ut = Ht âˆ¨ess sup
P âˆ—âˆˆP
Eâˆ—[ Ut+1 | Ft ]
for t = T âˆ’1, . . . , 0. By combining Proposition 6.45 and Theorem 6.52, we can
identify U as the upper Snell envelope
Uâ†‘
t = ess sup
P âˆ—âˆˆP
UP âˆ—
t
= ess sup
Ï„âˆˆTt
ess sup
P âˆ—âˆˆP
Eâˆ—[ HÏ„ | Ft ]
of H with respect to the stable set P , where UP âˆ—denotes the Snell envelope of H
with respect to P âˆ—. In the ï¬rst three sections of this chapter, we will in particular give
a rigorous version of the heuristic argument above.
Note ï¬rst that condition (7.1) implies that
Ï€sup(H) = sup
P âˆ—âˆˆP
UP âˆ—
0
= sup
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] < âˆ,
where we have used the identiï¬cation of the upper bound Ï€sup(H) of the arbitrage-free
prices of H given in Theorem 6.33. It will turn out that the following deï¬nition applies
to the upper Snell envelope if we choose Q = P .
Deï¬nition 7.1. SupposethatQ isanon-emptysetofprobabilitymeasureson(, FT ).
An adapted process is called a Q-supermartingale if it is a supermartingale with respect
to each Q âˆˆQ. Analogously, we deï¬ne the notions of a Q-submartingale and of a
Q-martingale.
In Theorem 5.26, we have already encountered an example of a P -martingale,
namely the value process of the replicating strategy of an attainable discounted Euro-
pean claim.
Theorem 7.2. The upper Snell envelope Uâ†‘of H is the smallest P -supermartingale
that dominates H.
Proof. For each P âˆ—âˆˆP the recursive scheme (6.27) implies that P âˆ—-a.s.
Uâ†‘
t â‰¥Ht âˆ¨Eâˆ—[ Uâ†‘
t+1 | Ft ] â‰¥Eâˆ—[ Uâ†‘
t+1 | Ft ].
Since Uâ†‘
0 is a ï¬nite constant due to our integrability assumption (7.1), induction on
t shows that Uâ†‘
t is integrable with respect to each P âˆ—âˆˆP and hence is a P -super-
martingale dominating H.
If 
U is another P -supermartingale which dominates H, then 
UT â‰¥HT = Uâ†‘
T .
Moreover, if 
Ut+1 â‰¥Uâ†‘
t+1 for some t, then

Ut â‰¥Ht âˆ¨Eâˆ—[ 
Ut+1 | Ft ] â‰¥Ht âˆ¨Eâˆ—[ Uâ†‘
t+1 | Ft ].

310
7 Superhedging
Thus,

Ut â‰¥Ht âˆ¨ess sup
P âˆ—âˆˆP
Eâˆ—[ Uâ†‘
t+1 | Ft ] = Uâ†‘
t ,
and backward induction shows that 
U dominates Uâ†‘.
For European claims, Theorem 7.2 takes the following form.
Corollary 7.3. Let H E be a discounted European claim such that
sup
P âˆ—âˆˆP
Eâˆ—[ H E ] < âˆ.
Then
V â†‘
t := ess sup
P âˆ—âˆˆP
Eâˆ—[ H E | Ft ],
t = 0, . . . , T,
is the smallest P -supermartingale whose terminal value dominates H E.
Remark 7.4. Note that the proof of Theorem 7.2 did not use any special properties
of the set P . Thus, if Q is an arbitrary set of equivalent probability measures, the
process U deï¬ned by the recursion
UT = HT
and
Ut = Ht âˆ¨ess sup
QâˆˆQ
EQ[ Ut+1 | Ft ]
is the smallest Q-supermartingale dominating the adapted process H.
â™¦
7.2 Uniform Doob decomposition
The aim of this section is to give a complete characterization of all non-negative
P-supermartingales. It will turn out that an integrable and non-negative process U is a
P -supermartingale if and only if it can be written as the difference of a P -martingale
N and an increasing adapted process B satisfying B0 = 0. This decomposition
may be viewed as a uniform version of the Doob decomposition since it involves
simultaneously the whole class P . It will turn out that the P -martingale N has a
special structure: It can be written as a â€œstochastic integralâ€ of the underlying process
X, which deï¬nes the class P. On the other hand, the increasing process B is only
adapted, notpredictableasintheDoobdecomposition withrespecttoasinglemeasure.
Theorem 7.5. For an adapted, non-negative process U, the following two statements
are equivalent.
(a) U is a P -supermartingale.

7.2 Uniform Doob decomposition
311
(b) There exists an adapted increasing process B with B0 = 0 and a d-dimensional
predictable process Î¾ such that
Ut = U0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) âˆ’Bt
P -a.s. for all t.
Proof. First, we prove the easier implication (b) â‡’(a). Fix P âˆ—âˆˆP and note that
VT := U0 +
T

k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥UT â‰¥0.
Hence, V is a P-martingale by Theorem 5.15. It follows that Ut âˆˆL1(P âˆ—) for all t.
Moreover, for P âˆ—âˆˆP
Eâˆ—[ Ut+1 | Ft ] = Eâˆ—[ Vt+1 âˆ’Bt+1 | Ft ] â‰¤Vt âˆ’Bt = Ut,
and so U is a P -supermartingale.
The proof of the implication (a) â‡’(b) is similar to the proof of Theorem 5.33. We
must show that for any given t âˆˆ{1, . . . , T }, there exist Î¾t âˆˆL0(, Ftâˆ’1, P ; Rd)
and Rt âˆˆL0
+(, Ft, P) such that
Ut âˆ’Utâˆ’1 = Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆ’Rt.
This condition can be written as
Ut âˆ’Utâˆ’1 âˆˆKt âˆ’L0
+(, Ft, P ),
where Kt is as in (5.12). There is no loss of generality in assuming that P is itself
a martingale measure. In this case, Ut âˆ’Utâˆ’1 is contained in L1(, Ft, P ) by the
deï¬nition of a P -supermartingale. Assume that
Ut âˆ’Utâˆ’1 /âˆˆC :=

Kt âˆ’L0
+(, Ft, P )

âˆ©L1(P ).
Sinceourmodelisarbitrage-free, Lemma1.67impliesthatC isclosedinL1(, Ft, P ).
Hence, Theorem A.56 implies the existence of some Z âˆˆLâˆ(, Ft, P ) such that
Î± := sup
WâˆˆC
E[ Z W ] < E[ Z (Ut âˆ’Utâˆ’1) ] =: Î´ < âˆ.
(7.2)
Infact, wehaveÎ± = 0sinceC isaconecontainingtheconstantfunction0. Lemma1.57
implies that such a random variable Z must be non-negative and must satisfy
E[ (Xt âˆ’Xtâˆ’1) Z | Ftâˆ’1] = 0.
(7.3)
In fact, we can always modify Z such that it is bounded below by some Îµ > 0 and
still satisï¬es (7.2). To see this, note ï¬rst that every W âˆˆC is dominated by a term of

312
7 Superhedging
the form Î¾t Â· (Xt âˆ’Xtâˆ’1). Hence, our assumption P âˆˆP , the integrability of W, and
an application of Fatouâ€™s lemma as yield that
E[ W ] â‰¤E[ Î¾t Â· (Xt âˆ’Xtâˆ’1) ] â‰¤lim inf
câ†‘âˆE

I{|Î¾t|â‰¤c}Î¾t Â· (Xt âˆ’Xtâˆ’1)

â‰¤0.
Thus, if we let ZÎµ := Îµ + Z, then ZÎµ also satisï¬es E[ ZÎµ W ] â‰¤0 for all W âˆˆC. If
we chose Îµ small enough, then E[ ZÎµ (Ut âˆ’Utâˆ’1) ] is still larger than 0; i.e., ZÎµ also
satisï¬es (7.2) and in turn (7.3). Therefore, we may assume from now on that our Z
with (7.2) is bounded below by some constant Îµ > 0.
Let
Ztâˆ’1 := E[ Z | Ftâˆ’1 ],
and deï¬ne a new measure 
P â‰ˆP by
d 
P
dP :=
Z
Ztâˆ’1
.
We claim that 
P âˆˆP . To prove this, note ï¬rst that Xk âˆˆL1(
P ) for all k, because the
density d 
P /dP is bounded. Next, let
Ï•k := E

Z
Ztâˆ’1
 Fk

,
k = 0, . . . , T.
If k Ì¸= t, then Ï•kâˆ’1 = Ï•k; this is clear for k > t, and for k < t it follows from
Ï•k = E
 E[ Z | Ftâˆ’1 ]
Ztâˆ’1
 Fk

= 1.
Thus, for k Ì¸= t

E[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] =
1
Ï•kâˆ’1
E[ (Xk âˆ’Xkâˆ’1) Ï•k | Fkâˆ’1 ]
= E[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ]
= 0.
If k = t, then (7.3) yields that

E[ Xk âˆ’Xkâˆ’1 | Fkâˆ’1 ] =
1
Ztâˆ’1
E[ (Xt âˆ’Xtâˆ’1) Z | Ftâˆ’1 ] = 0.
Hence 
P âˆˆP .
Since 
P âˆˆP, we have 
E[ Ut âˆ’Utâˆ’1 | Ftâˆ’1 ] â‰¤0, and we get
0 â‰¥
E
 
E[ Ut âˆ’Utâˆ’1 | Ftâˆ’1 ] Ztâˆ’1

= 
E[ (Ut âˆ’Utâˆ’1) Ztâˆ’1 ]
= E[ (Ut âˆ’Utâˆ’1) Z ]
= Î´.
This, however, contradicts the fact that Î´ > 0.

7.3 Superhedging of American and European claims
313
Remark 7.6. The decomposition in part (b) of Theorem 7.5 is sometimes called the
optional decomposition of the P -supermartingale U. The existence of such a de-
composition was ï¬rst proved by El Karoui and Quenez [80] and D. Kramkov [135]
in a continuous-time framework where B is an â€œoptionalâ€ process; this explains the
terminology.
â™¦
7.3 Superhedging of American and European claims
Let H be a discounted American claim such that
sup
P âˆ—âˆˆP
Eâˆ—[ Ht ] < âˆ
for all t,
which is equivalent to the condition that the upper bound of the arbitrage-free prices
of H is ï¬nite:
Ï€sup(H) = sup
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] < âˆ.
Our aim in this section is to construct self-ï¬nancing trading strategies such that the
seller of H stays on the safe side in the sense that the corresponding portfolio value is
always above H.
Deï¬nition 7.7. Any self-ï¬nancing trading strategy Î¾ whose value process V satisï¬es
Vt â‰¥Ht
P -a.s. for all t
is called a superhedging strategy for H.
Sometimes, a superhedging strategy is also called a superreplication strategy.
According to Deï¬nition 6.35, H is attainable if and only if there exist Ï„ âˆˆT and a
superhedging strategy whose value process satisï¬es VÏ„ = HÏ„ P -almost surely.
Lemma 7.8. If H is not attainable, then the value process V of any superhedging
strategy satisï¬es
P [ Vt > Ht for all t ] > 0.
Proof. We introduce the stopping time
Ï„ := inf{ t â‰¥0 | Ht = Vt }.
Then P[ Ï„ = âˆ] = P [ Vt > Ht for all t ]. Suppose that P [ Ï„ = âˆ] = 0. In this
case, VÏ„ = HÏ„ P -a.s so that we arrive at the contradiction that H must be an attainable
American claim.
Let us now turn to the question whether superhedging strategies exist. In Sec-
tion 6.1, we have already seen how one can use the Doob decomposition of the Snell

314
7 Superhedging
envelope UP âˆ—of H together with the martingale representation of Theorem 5.39 in
order to obtain a superhedging strategy for the price UP âˆ—
0 , where P âˆ—denotes the unique
equivalent martingale measure in a complete market model. We have also seen that
UP âˆ—
0
is the minimal amount for which such a superhedging strategy is available, and
that UP âˆ—
0
is the unique arbitrage-free price of H. The same is true of any attainable
American claim in an incomplete market model.
In the context of a non-attainable American claim H in an incomplete ï¬nancial
market model, the P âˆ—-Snell envelope will be replaced with the upper Snell envelope
Uâ†‘of H. The uniform Doob decomposition will take over the roles played by the
usual Doob decomposition and the martingale representation theorem. Since Uâ†‘is a
P -supermartingale by Theorem 7.2, the uniform Doob decomposition states that Uâ†‘
takes the form
Uâ†‘
t = Uâ†‘
0 +
t
s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1) âˆ’Bt
(7.4)
â‰¥Ht
forsomepredictableprocessÎ¾ andsomeincreasingprocessB. Thus, theself-ï¬nancing
trading strategy Î¾ = (Î¾0, Î¾) deï¬ned by Î¾ and the initial capital
Î¾1 Â· X0 = Uâ†‘
0 = Ï€sup(H)
is a superhedging strategy for H. Moreover, if 
V is the value process of any super-
hedging strategy, then Lemma 7.8 implies that 
V0 > Eâˆ—[ HÏ„ ] for all Ï„ âˆˆT and each
P âˆ—âˆˆP . In particular, 
V0 is larger than any arbitrage-free price for H, and it follows
that 
V0 â‰¥Ï€sup(H). Thus, we have proved:
Corollary 7.9. There exists a superhedging strategy with initial investment Ï€sup(H),
and this is the minimal amount needed to implement a superhedging strategy.
We will call Ï€sup(H) the cost of superhedging of H. Sometimes, a superhedging
strategy is also called a superreplication strategy, and one says that Ï€sup(H) is the cost
of superreplication or the upper hedging price of H. Recall, however, that Ï€sup(H) is
typically not an arbitrage-free price for H. In particular, the seller cannot expect to
receive the amount Ï€sup(H) for selling H.
On the other hand, the process B in the decomposition (7.4) can be interpreted
as a refunding scheme: Using the superhedging strategy Î¾, the seller may withdraw
successively the amounts deï¬ned by the increments of B. With this capital ï¬‚ow, the
hedging portfolio at time t has the value Uâ†‘
t â‰¥Ht. Thus, the seller is on the safe side
at no matter when the buyer decides to exercise the option. As we are going to show
in Theorem 7.13 below, this procedure is optimal in the sense that, if started at any
time t, it requires a minimal amount of capital.
Remark 7.10. Suppose Ï€sup(H) belongs to the set (H) of arbitrage-free prices for
H. By Theorem 6.33, this holds if and only if Ï€sup(H) is the only element of (H).

7.3 Superhedging of American and European claims
315
In this case, the deï¬nition of (H) yields a stopping time Ï„ âˆˆT and some P âˆ—âˆˆP
such that
Ï€sup(H) = Eâˆ—[ HÏ„ ].
Now let V be the value process of a superhedging strategy bought at V0 = Ï€sup(H). It
follows that Eâˆ—[ VÏ„ ] = Ï€sup(H). Hence, VÏ„ = HÏ„ P -a.s., so that H is attainable in the
sense of Deï¬nition 6.35. This observation completes the proof of Theorem 6.36.
â™¦
Remark 7.11. If the American claim H is not attainable, then Ï€sup(H) is not an
arbitrage-free price of H. Thus, one may expect the existence of arbitrage oppor-
tunities if H would be traded at the price Ï€sup(H). Indeed, selling H for Ï€sup(H) and
buying a superhedging strategy Î¾ creates such an arbitrage opportunity: The balance
at t = 0 is zero, but Lemma 7.8 implies that the value process V of Î¾ cannot be reached
by any exercise strategy Ïƒ, i.e., we always have
VÏƒ â‰¥HÏƒ
and
P [ VÏƒ > HÏƒ ] > 0.
(7.5)
Note that (7.5) is not limited to exercise strategies which are stopping times but holds
for arbitrary FT -measurable random times Ïƒ :  â†’{0, . . . , T }. In other words,
Ï€sup(H) is too expensive even if the buyer of H would have full information about the
future price evolution.
â™¦
Remark 7.12. The argument of Remark 7.11 implies that anAmerican claim H is at-
tainable if and only if there exists an FT -measurable random time Ïƒ :  â†’{0, . . . , T }
such that HÏƒ = VÏƒ, where V the value process of a superhedging strategy. In other
words, the notion of attainability of American claims does not need the restriction to
stopping times.
â™¦
We already know that Ï€sup(H) is the smallest amount for which one can buy a su-
perhedging strategy at time 0. The following â€œsuperhedging duality theoremâ€ extends
this result to times t > 0. To this end, denote by Uâ†‘
t (H) the set of all Ft-measurable
random variables 
Ut â‰¥0 for which there exists a d-dimensional predictable process
Î¾ such that

Ut +
u

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥Hu
for all u â‰¥t P -a.s.
(7.6)
Theorem 7.13. The upper Snell envelope Uâ†‘
t of H is the minimal element of Uâ†‘
t (H).
More precisely:
(a) Uâ†‘
t âˆˆUâ†‘
t (H),
(b) Uâ†‘
t = ess inf Uâ†‘
t (H).

316
7 Superhedging
Proof. Assertion (a) follows immediately from the uniform Doob decomposition of the
P -supermartingale Uâ†‘. As to part (b), we clearly get Uâ†‘
t â‰¥ess inf Uâ†‘
t (H) from (a).
For the proof of the converse inequality, take 
Ut âˆˆUâ†‘
t (H) and choose a predictable
processÎ¾ for which (7.6) holds. We must show that the set B := { Uâ†‘
t â‰¤
Ut } satisï¬es
P[ B ] = 1. Let
Ë†Ut := Uâ†‘
t âˆ§
Ut = Uâ†‘
t Â· IB + 
Ut Â· IBc .
Then Ë†Ut â‰¤Uâ†‘
t , and our claim will follow if we can show that Uâ†‘
t
â‰¤Ë†Ut. Let Î¾
denote the predictable process obtained from the uniform Doob decomposition of the
P -supermartingale Uâ†‘, and deï¬ne
Ë†Î¾s :=

Î¾s
if s â‰¤t,
Î¾s Â· IB +Î¾s Â· IBc
if s > t.
With this choice, Ë†Ut satisï¬es (7.6), i.e., Ë†Ut âˆˆUâ†‘
t (H). Let
Ë†Vs := Uâ†‘
0 +
s

k=1
Ë†Î¾k Â· (Xk âˆ’Xkâˆ’1).
Then Ë†Vs â‰¥Uâ†‘
s for all s â‰¤t. In particular Ë†Vt â‰¥Ë†Ut, and hence Ë†VT â‰¥HT , which
implies that Ë†V is a P -martingale; see Theorem 5.26. Hence, Doobâ€™s stopping theorem
implies
Uâ†‘
t = ess sup
P âˆ—âˆˆP
ess sup
Ï„âˆˆTt
Eâˆ—[ HÏ„ | Ft ]
â‰¤ess sup
P âˆ—âˆˆP
ess sup
Ï„âˆˆT
Eâˆ— 
Ë†Ut +
Ï„

k=t+1
Ë†Î¾k Â· (Xk âˆ’Xkâˆ’1)
 Ft
!
= Ë†Ut,
which concludes the proof.
We now take the point of view of the buyer of the American claim H. The buyer
allocates an initial investment Ï€ to purchase H, and then receives the amount HÏ„ â‰¥0.
The objective is to ï¬nd an exercise strategy and a self-ï¬nancing trading strategy Î·
with initial investment âˆ’Ï€, such that the portfolio value is covered by the payoff of
the claim. In other words, ï¬nd Ï„ âˆˆT and a self-ï¬nancing trading strategy with value
process V such that V0 = âˆ’Ï€ and VÏ„ + HÏ„ â‰¥0. As shown below, the maximal Ï€ for
which this is possible is equal to
Ï€inf(H) = sup
Ï„âˆˆT
inf
P âˆ—âˆˆP
Eâˆ—[ HÏ„ ] = inf
P âˆ—âˆˆP
sup
Ï„âˆˆT
Eâˆ—[ HÏ„ ] = Uâ†“
0 ,

7.3 Superhedging of American and European claims
317
where
Uâ†“
t = ess inf
P âˆ—âˆˆP
UP âˆ—
t
= ess inf
P âˆ—âˆˆP
ess sup
Ï„âˆˆTt
Eâˆ—[ HÏ„ | Ft ]
= ess sup
Ï„âˆˆTt
ess inf
P âˆ—âˆˆP
Eâˆ—[ HÏ„ | Ft ]
is the lower Snell envelope of H with respect to the stable set P . More generally,
we will consider the buyerâ€™s problem for arbitrary t â‰¥0. To this end, denote by
Uâ†“
t (H) the set of all Ft-measurable random variables 
Ut â‰¥0 for which there exists
a d-dimensional predictable process Î· and a stopping time Ïƒ âˆˆTt such that

Ut âˆ’
Ïƒ

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1) â‰¤HÏƒ
P -a.s.
Theorem 7.14. Uâ†“
t is the maximal element of Uâ†“
t (H). More precisely:
(a) Uâ†“
t âˆˆUâ†“
t (H),
(b) Uâ†“
t = ess sup Uâ†“
t (H).
Proof. (a): Let Î¾ be a superhedging strategy for H with initial investment Ï€sup(H),
and denote by V the value process of Î¾. The main idea of the proof is to use that
Vt âˆ’Ht â‰¥0 can be regarded as a new discounted American claim, to which we
can apply Theorem 7.13. However, we must take care of the basic asymmetry of
the hedging problem for American options: The seller of H must hedge against all
possible exercise strategies, while the buyer must ï¬nd only one suitable stopping time.
It will turn out that a suitable stopping time is given by Ï„t := inf{u â‰¥t | Uâ†“
u = Hu}.
With this choice, let us deï¬ne a modiï¬ed discounted American claim 
H by

Hu = (Vu âˆ’Hu) Â· I{u=Ï„t},
u = 0, . . . , T.
Clearly 
HÏƒ â‰¤
HÏ„t for all Ïƒ âˆˆTt. It follows that
ess sup
ÏƒâˆˆTt
ess sup
P âˆ—âˆˆP
Eâˆ—[ 
HÏƒ | Ft ] = ess sup
P âˆ—âˆˆP
Eâˆ—[ 
HÏ„t | Ft ]
= Vt âˆ’ess inf
P âˆ—âˆˆP Eâˆ—[ HÏ„t | Ft ]
= Vt âˆ’Uâ†“
t ,
where we have used that V is a P -martingale in the second and Theorem 6.48 in
the third step. Thus, Vt âˆ’Uâ†“
t
is equal to the upper Snell envelope 
Uâ†‘of 
H at

318
7 Superhedging
time t. Let Î¾ be the d-dimensional predictable process obtained from the uniform
Doob decomposition of 
Uâ†‘. Then, due to part (a) of Theorem 7.13,
Vt âˆ’Uâ†“
t +
u

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥
Hu = (Vu âˆ’Hu) Â· I{u=Ï„t}
for all u â‰¥t.
Thus, Î· := Î¾ âˆ’Î¾ is as desired.
(b): Part (a) implies the inequality â‰¤in (b). To prove its converse, take 
Ut âˆˆUâ†“
t ,
a d-dimensional predictable process Î·, and Ïƒ âˆˆTt such that

Ut âˆ’
Ïƒ

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1) â‰¤HÏƒ
P -a.s.
We will show below that
Eâˆ— 
Ïƒ

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1)
 Ft
!
= 0
for all P âˆ—âˆˆP .
(7.7)
Given this fact, we obtain that

Ut â‰¤Eâˆ—[ HÏƒ | Ft ] â‰¤ess sup
Ï„âˆˆTt
Eâˆ—[ HÏ„ | Ft ]
for all P âˆ—âˆˆP . Taking the essential inï¬mum over P âˆ—âˆˆP thus yields 
Ut â‰¤Uâ†“
t and
in turn (b).
To prove (7.7), let

Gs := I{sâ‰¥t+1}
s

k=t+1
I{kâ‰¤Ïƒ}Î·k Â· (Xk âˆ’Xkâˆ’1),
s = 0, . . . , T.
Then 
GT â‰¥
Ut âˆ’HÏƒ â‰¥âˆ’HÏƒ âˆˆL1(P âˆ—) for all P âˆ—, and Theorem 5.15 implies that

G is a P -martingale. Hence (7.7) follows.
We conclude this section by stating explicitly the corresponding results for Eu-
ropean claims. Recall from Remark 6.7 that every discounted European claim H E
can be regarded as the discounted American claim. Therefore, the results we have
obtained so far include the corresponding â€œEuropeanâ€ counterparts as special cases.
Corollary 7.15. For any discounted European claim H E such that
sup
P âˆ—âˆˆP
Eâˆ—[ H E ] < âˆ,

7.3 Superhedging of American and European claims
319
there exist two d-dimensional predictable processes Î¾ and Î· such that P -a.s.
ess sup
P âˆ—âˆˆP
Eâˆ—[ H E | Ft ] +
T

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥H E,
(7.8)
ess inf
P âˆ—âˆˆP Eâˆ—[ H E | Ft ] âˆ’
T

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1) â‰¤H E.
(7.9)
Remark 7.16. For t = 0, (7.8) takes the form
sup
P âˆ—âˆˆP
Eâˆ—[ H E ] +
T

k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥H E
P -a.s.
Thus, the self-ï¬nancing trading strategy Î¾ arising from Î¾ and the initial investment
Î¾1 Â· X0 = supP âˆ—âˆˆP Eâˆ—[ H E ] allows the seller to cover all possible obligations
without any downside risk.
Similarly, (7.9) yields an interpretation of the self-
ï¬nancing trading strategy Î· which arises from Î· and the initial investment Î·1 Â· X0 =
âˆ’infP âˆ—âˆˆP Eâˆ—[ H E ]. The latter quantity corresponds to the largest loan the buyer can
take out and still be sure that, by using the trading strategy Î·, this debt will be covered
by the payoff H E.
â™¦
Remark 7.17. Let H be a discounted European claim such that
sup
P âˆ—âˆˆP
Eâˆ—[ H E ] < âˆ.
Suppose that Ë†P âˆˆP is such that Ë†E[ H ] = Ï€sup(H). If Î¾ = (Î¾0, Î¾) is a superhedging
strategy for H, then
Ë†H := Ë†E[ H ] +
T

k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1)
satisï¬es Ë†H â‰¥H â‰¥0. Hence, Ë†H is an attainable discounted claim, and it follows from
Theorem 5.26 that
Ë†E[ Ë†H ] = Ë†E[ H ].
This shows that Ë†H and H are identical and that H is attainable. We have thus obtained
another proof of Theorem 5.33.
â™¦
As the last result in this section, we formulate the following â€œsuperhedging duality
theoremâ€, which states that the bounds in (7.8) and (7.9) are optimal.
Corollary 7.18. Suppose that H E is a discounted European claim with
sup
P âˆ—âˆˆP
Eâˆ—[ H E ] < âˆ.

320
7 Superhedging
Denote by Uâ†‘
t (H E) the set of all Ft measurable random variables 
Ut for which there
exists a d-dimensional predictable processÎ¾ such that

Ut +
T

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥H E
P -a.s.
Then
ess sup
P âˆ—âˆˆP
Eâˆ—[ H E | Ft ] = ess inf Uâ†‘
t (H E).
By Uâ†“
t (H E) we denote the set of all Ft measurable random variables 
Ut for which
there exists a d-dimensional predictable process Î· such that

Ut âˆ’
T

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1) â‰¤H E
P -a.s.
Then
ess inf
P âˆ—âˆˆP Eâˆ—[ H E | Ft ] = ess sup Uâ†“
t (H E).
Remark 7.19. Deï¬ne A as the set of ï¬nancial positions Z âˆˆLâˆ(, FT , P ) which
are acceptable in the sense that there exists a d-dimensional predictable process Î¾ such
that
Z +
T

k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) â‰¥0
P -a.s.
As in Section 4.8, this set A induces a coherent measure of risk Ï on Lâˆ(, FT , P ):
Ï(Z) = inf{ m âˆˆR | m + Z âˆˆA },
Z âˆˆLâˆ(, FT , P ).
Corollary 7.18 implies that Ï can be represented as
Ï(Z) = sup
P âˆ—âˆˆP
Eâˆ—[ âˆ’Z ].
We therefore obtain a multiperiod version of Proposition 4.93.
â™¦
Remark 7.20. Often, the superhedging strategy in a given incomplete model can be
identiï¬ed as the perfect hedge in an associated â€œextremalâ€ model. As an example,
consider a one-period model with d discounted risky assets given by bounded random
variables X1, . . . , Xd. Denote by Âµ the distribution of X = (X1, . . . , Xd) and by
(Âµ) the convex hull of the support of Âµ. The closure K := (Âµ) of (Âµ) is convex
and compact. We know from Section 1.5 that the model is arbitrage-free if and only if
the price system Ï€ = (Ï€1, . . . , Ï€d) is contained in the relative interior of (Âµ), and
the equivalent martingale measures can be identiï¬ed with the measures Âµâˆ—â‰ˆÂµ with

7.3 Superhedging of American and European claims
321
barycenter Ï€. Consider a derivative H = h(X) given by a convex function h on K.
The cost of superhedging is given by
sup
Âµâˆ—

h dÂµâˆ—= inf

Î±(Ï€) | Î± afï¬ne on K, Î± â‰¥h Âµ-a.s.

,
which is a special case of the duality result of Theorem 1.31. Since {Î± â‰¥h} is convex
and closed, the condition Âµ(Î± â‰¥h) = 1 implies Î± â‰¥h on K. Denote by M(Ï€) the
class of all probability measures on K with barycenter Ï€. For any afï¬ne function Î±
with Î± â‰¥h on K, and for any Âµ âˆˆM(Ï€) we have

h dÂµ â‰¤

Î± dÂµ = Î±(Ï€).
Thus,
Ë†h(Ï€) =
sup
ÂµâˆˆM(Ï€)

h dÂµ
(7.10)
where we deï¬ne for f âˆˆC(K)
Ë†f := inf

Î± | Î± afï¬ne on K, Î± â‰¥f Âµ-a.s.

.
The supremum in (7.10) is attained since M(Ï€) is weakly compact. More precisely,
it is attained by any measure Ë†Âµ âˆˆM(Ï€) on K which is maximal with respect to the
balayage order â‰½bal deï¬ned for measures on K as in (2.18); see ThÃ©orÃ¨me X. 41 in
[65]. But such a maximal measure is supported by the set of extreme points of the
convex compact set K, i.e., by the Choquet boundary of K. This follows from a
general integral representation theorem of Choquet; see, e.g., ThÃ©orÃ¨me X. 43 of [65].
In our ï¬nite-dimensional setting, Ë†Âµ can in fact be chosen to have a support consisting
of at most d + 1 points, due to a theorem of CarathÃ©odory and the representation of
K as the convex hull of its extreme points; see [166], Theorems 17.1 and 18.5. But
this means that Ë†Âµ can be identiï¬ed with a complete model, due to Proposition 1.39.
Thus, the cost of superhedging Ë†h(Ï€) can be identiï¬ed with the canonical price
Ë†Ï€ :=

h d Ë†Âµ
of the derivative H, computed in the complete model Ë†Âµ. Note that Ë†Âµ sits on the Choquet
boundary of K = (Âµ), but typically it will no longer be equivalent or absolutely
continuous with respect to the original measure Âµ. As a simple illustration, consider
a one-period model with one risky asset X1. If X1 is bounded, then the distribution
Âµ of X1 has bounded support, and (Âµ) is of the form [a, b]. In this case, the cost of
superhedging H = h(X1) for a convex function h is given by the price
pâˆ—h(b) + (1 âˆ’pâˆ—)h(a),
computed in the binary model in which X1 takes only the values a and b, and where
pâˆ—âˆˆ(0, 1) is determined by
pâˆ—b + (1 âˆ’pâˆ—)a = Ï€1.
â™¦

322
7 Superhedging
The following example illustrates that a superhedging strategy is typically too
expensive from a practical point of view. However, we will see in Chapter 8 how
superhedging strategies can be used in order to construct other hedging strategies
which are efï¬cient in terms of cost and shortfall risk.
Example 7.21. Consider a simple one-period model where S1
1 has under P a Poisson
distribution and where S0 â‰¡1. Let H := (S1
1 âˆ’K)+ be a call option with strike
K > 0. We have seen in Example 1.37 that Ï€inf(H) and Ï€sup(H) coincide with the
universal arbitrage bounds of Remark 1.36:
(S1
0 âˆ’K)+ = Ï€inf(H)
and
Ï€sup(H) = S1
0.
Thus, the superhedging strategy for the seller consists in the trivial hedge of buying
the asset at time 0, while the corresponding strategy for the buyer is a short-sale of the
asset in case the option is in the money, i.e., if S1
0 > K.
â™¦
7.4 Superhedging with liquid options
In practice, some derivatives such as put or call options are traded so frequently that
their prices are quoted just like those of the primary assets. The prices of such liquid
options can be regarded as an additional source of information on the expectations of
the market as to the future evolution of asset prices. This information can be exploited
in various ways. First, it serves to single out those martingale measures P âˆ—which
are compatible with the observed options prices, in the sense that the observed prices
coincide with the expectations of the discounted payoff under P âˆ—. Second, liquid
options may be used as instruments for hedging more exotic options.
Our aim in this section is to illustrate these ideas in a simple setting. Assume that
there is only one risky asset S1 such that S1
0 is a positive constant, and that S0 is a
riskless bond with interest rate r = 0. Thus, the discounted price process of the risky
asset is given by Xt = S1
t â‰¥0 for t = 0, . . . , T . As the underlying space of scenarios,
we use the product space
 := [0, âˆ)T .
We deï¬ne Xt(Ï‰) = xt for Ï‰ = (x1, . . . , xT ) âˆˆ, and denote by Ft the Ïƒ-algebra
generated by X0, . . . , Xt; note that F0 = {âˆ…, }. No probability measure P is given
a priori. Let us now introduce a linear space X of FT -measurable functions as the
smallest linear space such that the following conditions are satisï¬ed:
(a) 1 âˆˆX.
(b) (Xt âˆ’Xs) IA âˆˆX for 0 â‰¤s < t â‰¤T and A âˆˆFs.
(c) (Xt âˆ’K)+ âˆˆX for K â‰¥0 and t = 1, . . . , T .

7.4 Superhedging with liquid options
323
The functions in the space X will be interpreted as (discounted) payoffs of liquid
derivatives. The constant 1 in (a) corresponds to a unit investment into the riskless
bond. The function Xt âˆ’Xs in (b) corresponds to the payoff of a forward contract on
the risky asset, issued at time s for the price Xs and expiring at time t. The decision
to buy such a forward contract at time s may depend on the market situation at time s;
this is taken into account by allowing for payoffs (Xt âˆ’Xs) IA with A âˆˆFs. Linearity
of X together with conditions (a) and (b) implies that
Xt âˆˆX
for all t.
Finally, condition (c) states that call options with any possible strike and any maturity
up to time T can be used as liquid securities.
Suppose that a linear pricing rule  is given on X. The value (Y) will be
interpreted as the market price of the liquid security Y âˆˆX. The price of a liquid call
option with strike K and maturity t will be denoted by
Ct(K) := 

(Xt âˆ’K)+
.
Assumption 7.22. We assume that  : X â†’R is a linear functional which satisï¬es
the following conditions.
(a) (1) = 1.
(b) (Y) â‰¥0 if Y â‰¥0.
(c) 

(Xt âˆ’Xs) IA

= 0 for all 0 â‰¤s < t â‰¤T and A âˆˆFs.
(d) Ct(K) = 

(Xt âˆ’K)+
â†’0 as K â†‘âˆfor all t.
The ï¬rst two conditions must clearly be satisï¬ed if the pricing rule  shall not
create arbitrage opportunities. Condition (c) states that Xs is the fair price for a forward
contract issued at time s. This condition is quite natural in view of Theorem 5.30.
In our present setting, it can also be justiï¬ed by the following simple replication
argument. At time s, take out a loan Xs(Ï‰) and use it for buying the asset. At time t,
the asset is worth Xt(Ï‰) and the loan must be paid back, which results in a balance
Xt(Ï‰) âˆ’Xs(Ï‰). Since this investment strategy requires zero initial capital, the price
of the corresponding payoff should also be zero. The continuity condition (d) is also
quite natural.
Our ï¬rst goal is to show that any such pricing rule  is compatible with the
paradigm that arbitrage-free prices can be identiï¬ed as expectations with respect to
some martingale measure forX. More precisely, we are going to construct a martingale
measure P âˆ—such that (Y) = Eâˆ—[ Y ] for all Y âˆˆX. On the one hand, this will imply
regularity properties of . On the other hand, this will yield an extension of our pricing
rule  to a larger space of payoffs including path-dependent exotic options. As a ï¬rst
step in this direction, we have the following result.

324
7 Superhedging
Lemma 7.23. For each t, there exists a unique probability measure Âµt on [0, âˆ) such
that for all K â‰¥0
Ct(K) = 

(Xt âˆ’K)+
=

(x âˆ’K)+ Âµt(dx).
In particular, Âµt has the mean

x Âµt(dx) = X0.
Proof. Since K â†’(Xt âˆ’K)+ is convex and decreasing, linearity and positivity of
 imply that the function Ï†t(K) := 

(Xt âˆ’K)+
is convex and decreasing as well.
Hence, there exists a decreasing right-continuous function f : [0, âˆ) â†’[0, âˆ) such
that
Ct(K) = Ct(0) âˆ’
 K
0
f (x) dx
= X0 âˆ’
 K
0
f (x) dx,
i.e., âˆ’f (K) is equal to the right-hand derivative of Ct(K) at K. Our fourth condition
on  yields
 âˆ
0
f (x) dx = X0,
so that f (x) â†˜0 as x â†‘âˆ. Hence, there exists a positive measure Âµt on (0, âˆ)
such that
f (x) = Âµt

(x, âˆ)

for x > 0.
Fubiniâ€™s theorem implies

(0,âˆ)
x Âµt(dx) =
 âˆ
0
f (y) dy = X0
and
Ct(K) = X0 âˆ’
 K
0

(0,âˆ)
I{y<x} Âµt(dx) dy
=

(0,âˆ)
(x âˆ’K)+ Âµt(dx).
It remains to show that Âµt can be extended to a probability measure on [0, âˆ),
i.e., we must show that Âµt

(0, âˆ)

â‰¤1. To this end, we will use the â€œput-call parityâ€
Ct(K) = X0 âˆ’K + 

(K âˆ’Xt)+
,

7.4 Superhedging with liquid options
325
which follows from our assumptions on . Thus,


(K âˆ’Xt)+
=
 K
0
g(x) dx,
where g(x) = 1 âˆ’f (x). Since K â†’

(K âˆ’Xt)+
is increasing, g must be
non-negative, and we obtain 1 â‰¥f (0) = Âµt

(0, âˆ)

.
The following lemma shows that the measures Âµt constructed in Lemma 7.23 are
related to each other by the balayage order â‰½bal, deï¬ned by
Âµ â‰½bal Î½
â‡â‡’

f dÂµ â‰¥

f dÎ½
for all convex functions f
for probability measures with ï¬nite expectation; see Remark 2.65.
Lemma 7.24. The map t â†’Âµt is increasing with respect to the balayage order â‰½bal:
Âµt+1 â‰½bal Âµt
for all t.
Proof. Note that
(Xt+1 âˆ’K)+ âˆ’(Xt+1 âˆ’Xt) I{Xt>K} âˆ’(Xt âˆ’K)+
= (Xt+1 âˆ’K)+ âˆ’(Xt+1 âˆ’K)+ I{Xt>K}
â‰¥0.
Since the price of the forward contract (Xt+1âˆ’Xt) I{Xt>K} vanishes under our pricing
rule , we must have that for all K â‰¥0

(x âˆ’K)+ Âµt+1 (dx) âˆ’

(x âˆ’K)+ Âµt(dx)
= Ct+1(K) âˆ’Ct(K)
â‰¥0.
An application of Corollary 2.62 concludes the proof.
Let us introduce the class
P =

P âˆ—âˆˆM1(, F ) | Eâˆ—[ Y ] = (Y) for all Y âˆˆX

of all probability measures P âˆ—on (, F ) which coincide with  on X. Note that for
any P âˆ—âˆˆP,
Eâˆ—[ (Xt âˆ’Xs) IA ] = 0
for s < t and A âˆˆFs,
so that P consists of martingale measures for X. Our ï¬rst main result in this section
can be regarded as a version of the â€œfundamental theorem of asset pricingâ€ without an
a priori measure P .

326
7 Superhedging
Theorem 7.25. Under Assumption 7.22, the class P is non-empty. Moreover, there
exists P âˆ—âˆˆP with the Markov property: For 0 â‰¤s â‰¤t â‰¤T and each bounded
measurable function f ,
Eâˆ—[ f (Xt) | Fs ] = Eâˆ—[ f (Xt) | Xs ].
Proof. Since Âµt+1 â‰½bal Âµt, Corollary 2.62 yields the existence of stochastic kernel
Qt+1 such that

y Qt+1(x, dy) = x and Âµt+1 = ÂµtQt+1. Let us deï¬ne
P âˆ—:= Âµ1 âŠ—Q2 âŠ—Â· Â· Â· âŠ—QT ,
i.e., for each measurable set A âŠ‚ = [0, âˆ)T
P âˆ—[ A ] =

Âµ1(dx1)

Q2(x1, dx2) . . .

QT (xT âˆ’1, dxT ) IA(x1, x2, . . . , xT ).
Clearly, Âµt is the law of Xt under P âˆ—. In particular, all call options are priced correctly
by calculating their expectation with respect to P âˆ—. Then one checks that
Eâˆ—[ f (Xt+1) | Ft ] =

f (y) Qt+1(Xt, dy) = Eâˆ—[ f (Xt+1) | Xt ]
P âˆ—-a.s.
(7.11)
The ï¬rst identity above implies Eâˆ—[ Xt+1 âˆ’Xt | Ft ] = 0. In particular, P âˆ—is
a martingale measure, and the expectation of (Xt âˆ’Xs) IA vanishes for s < t and
A âˆˆFs. It follows that Eâˆ—[ Y ] = (Y) for all Y âˆˆX. Finally, an induction argument
applied to (7.11) yields the Markov property.
So far, we have assumed that our space X of liquidly traded derivatives contains
call options with all possible strike prices and maturities. From now on, we will
simplify our setting by assuming that only call options with maturity T are liquidly
traded. Thus, we replace X by the smaller space XT which is deï¬ned as the linear
hull of the constants, of all forward contracts
(Xt âˆ’Xs) IA,
0 â‰¤s < t â‰¤T, A âˆˆFs,
and of all call options
(XT âˆ’K)+,
K â‰¥0,
with maturity T . The observed market prices of derivatives in XT are as before
modeled by a linear pricing rule
T : XT â†’R.
We assume that T satisï¬es Assumption 7.22 in the sense that condition (d) is only
required for t = T :
(dâ€²) CT (K) := T

(XT âˆ’K)+
â†’0 as K â†‘âˆ.

7.4 Superhedging with liquid options
327
By
PT =

P âˆ—âˆˆM1(, F ) | Eâˆ—[ Y ] = T (Y) for all Y âˆˆXT

we denote the class of all probability measures P âˆ—on (, F ) which coincide with T
onXT . Asbefore, itfollowsfromcondition(c)ofAssumption7.22thatanyP âˆ—âˆˆPT
will be a martingale measure for the price process X. Obviously, any linear pricing
rule  which is deï¬ned on the full space X and which satisï¬es Assumption 7.22 can
be restricted to XT , and this restriction satisï¬es the above assumptions. Thus, we
have PT âŠƒP Ì¸= âˆ….
Proposition 7.26. Under the above assumptions, PT is non-empty.
Proof. Let ÂµT be the measure constructed in Lemma 7.23 from the call prices with
maturity T . Now consider the measure 
P on (, F ) deï¬ned as

P := Î´X0 âŠ—Â· Â· Â· âŠ—Î´X0 âŠ—ÂµT ,
i.e., under 
P we have Xt = X0 
P -a.s. for t < T , and the law of XT is ÂµT . Clearly,
we have 
P âˆˆPT .
A measure P âˆ—âˆˆPT can be regarded as an extension of the pricing rule T to
the larger space L1(P âˆ—), and the expectation Eâˆ—[ H ] of some European claim H â‰¥0
can be regarded as an arbitrage-free price for H. Our aim is to obtain upper and
lower bounds for Eâˆ—[ H ] which hold simultaneously for all P âˆ—âˆˆP. We will derive
such bounds for various exotic options; this will amount to the construction of certain
superhedging strategies in terms of liquid securities.
As a ï¬rst example, we consider the following digital option
H dig :=
ï£±
ï£²
ï£³
1
if max
0â‰¤tâ‰¤T Xt â‰¥B
0
otherwise,
which has a unit payoff if the price processes reaches a given upper barrier B > X0.
If we denote by
Ï„B := inf{ t â‰¥0 | Xt â‰¥B }
the ï¬rst hitting time of the barrier B, then the payoff of the digital option can also be
described as
H dig = I{Ï„Bâ‰¤T }.
For simplicity, we will assume from now on that
CT (B) > 0,
so that in particular ÂµT

(B, âˆ)

> 0.

328
7 Superhedging
Theorem 7.27. The following upper bound on the arbitrage-free prices of the digital
option holds:
max
P âˆ—âˆˆPT
Eâˆ—[ H dig ] =
min
0â‰¤K<B
CT (K)
B âˆ’K .
(7.12)
Proof. For 0 â‰¤K < B, we have XÏ„B â‰¥B. Hence,
H dig = I{Ï„Bâ‰¤T } â‰¤(XT âˆ’K)+
B âˆ’K
+ XÏ„B âˆ’XT
B âˆ’K
I{Ï„Bâ‰¤T }.
Taking expectations with respect to some P âˆ—âˆˆPT yields
Eâˆ—[ H dig ] â‰¤CT (K)
B âˆ’K +
1
B âˆ’K Eâˆ—[ (XÏ„B âˆ’XT ) I{Ï„Bâ‰¤T } ].
Since P âˆ—is a martingale measure, the stopping theorem in the form of Proposition 6.38
implies
Eâˆ—[ XT I{Ï„Bâ‰¤T } ] = Eâˆ—[ XÏ„B I{Ï„Bâ‰¤T } ].
This shows that
sup
P âˆ—âˆˆPT
Eâˆ—[ H dig ] â‰¤
inf
0â‰¤K<B
CT (K)
B âˆ’K .
The proof will be completed by Lemmas 7.28 and 7.29 below.
Lemma 7.28. If we let
Î» := 1 âˆ’
inf
0â‰¤K<B
CT (K)
B âˆ’K âˆˆ(0, 1),
then the inï¬mum on the right-hand side is attained in K if and only if K belongs to
the set of Î»-quantiles for ÂµT , i.e., if and only if
ÂµT ([0, K)) â‰¤Î» â‰¤ÂµT ([0, K]).
In particular, it is attained in
Kâˆ—:= inf

K | ÂµT ([0, K]) â‰¥Î»

.
Proof. The convex function CT has left- and right-hand derivatives
(CT )â€²
âˆ’(K) = âˆ’ÂµT

[K, âˆ)

and
(CT )â€²
+(K) = âˆ’ÂµT

(K, âˆ)

;
see also PropositionA.4. Thus, the function g(K) := CT (K)/(Bâˆ’K) has a minimum
in K if and only if its left- and right-hand derivatives satisfy
gâ€²
âˆ’(K) â‰¤0
and
gâ€²
+(K) â‰¥0.
By computing gâ€²
âˆ’and gâ€²
+, one sees that these two conditions are equivalent to the
requirement that K is a Î»-quantile for ÂµT ; see Lemma A.15.

7.4 Superhedging with liquid options
329
Lemma 7.29. There exists a martingale measure Ë†P âˆˆPT such that
Ë†P [ Ï„B â‰¤T ] =
min
0â‰¤K<B
CT (K)
B âˆ’K .
Moreover, Ë†P can be taken such that
Ï„B = T âˆ’1
and
XÏ„B = B
Ë†P -a.s. on {Ï„B â‰¤T }
and
{ XT > Kâˆ—} âŠ‚{ Ï„B â‰¤T } âŠ‚{ XT â‰¥Kâˆ—}
modulo Ë†P -nullsets,
where Kâˆ—is as in Lemma 7.28.
Proof. Let Î» be as in Lemma 7.28, and let
q(t) := qâˆ’
Âµ (t) = inf

K | ÂµT ([0, K]) â‰¥t

be the lower quantile function for Âµ; see A.3. We take an auxiliary probability space
(, 
F , 
P) supporting a random variable U which is uniformly distributed on (0, 1).
By Lemma A.19, 
XT := q(U) has distribution ÂµT under 
P . Let Î³ be such that
X0 = Î³ Î» + B(1 âˆ’Î»).
Since B > X0 we have 0 â‰¤Î³ < X0. We deï¬ne 
XT âˆ’1 by

XT âˆ’1 := Î³ I{Uâ‰¤Î»} + B I{U>Î»},
and we let 
Xt := X0 for 0 â‰¤t â‰¤T âˆ’2.
We now prove that 
X is a martingale with respect to its natural ï¬ltration 
Ft :=
Ïƒ(
X0, . . . , 
Xt). To this end, note ï¬rst that 
FT âˆ’2 = {âˆ…, }, and hence

E[ 
XT âˆ’1 | 
FT âˆ’2 ] = 
E[ 
XT âˆ’1 ] = X0 = 
XT âˆ’2.
Furthermore, since Kâˆ—= q(Î»),

E[ 
XT ; 
XT âˆ’1 = B ] = 
E[ 
XT ; U > Î» ]
= 
E[ (
XT âˆ’Kâˆ—)+ ] + Kâˆ—
P [ U > Î» ]
= CT (Kâˆ—) + Kâˆ—(1 âˆ’Î»)
= (1 âˆ’Î»)(B âˆ’Kâˆ—) + Kâˆ—(1 âˆ’Î»)
= B Â· 
P [ 
XT âˆ’1 = B ].
Hence,

E[ 
XT ; 
XT âˆ’1 = Î³ ] = 
E[ 
XT ] âˆ’
E[ 
XT ; 
XT âˆ’1 = B ]
= X0 âˆ’B Â· 
P [ 
XT âˆ’1 = B ]
= Î³ 
P [ 
XT âˆ’1 = Î³ ],

330
7 Superhedging
It follows that

E[ 
XT | 
FT âˆ’1 ] = 
E[ 
XT | 
XT âˆ’1 ] = 
XT âˆ’1,
and so 
X is indeed a martingale.
As the next step, we note that
{ 
XT â‰¥B } âŠ‚{ 
XT > Kâˆ—}
âŠ‚{ U > Î» } = { 
XT âˆ’1 = B }
âŠ‚{ U â‰¥Î» } âŠ‚{ 
XT â‰¥Kâˆ—},
where we have used the fact that Kâˆ—= q(Î»). Hence, if we denote by Ï„B := inf{ t â‰¥
0 | 
Xt â‰¥B } the ï¬rst time at which 
X hits the barrier B, then
{ 
XT > Kâˆ—} âŠ‚

Ï„B â‰¤T } = { 
XT âˆ’1 = B } âŠ‚{ 
XT â‰¥Kâˆ—}.
Hence, {Ï„B â‰¤T } = {Ï„B = T âˆ’1} = {
XT âˆ’1 = B},

P[Ï„B â‰¤T ] = 
P [ 
XT âˆ’1 = B ] = 1 âˆ’Î» =
min
0â‰¤K<B
CT (K)
B âˆ’K ,
and the distribution Ë†P of 
X under 
P is as desired.
Remark 7.30. The inequality
H dig â‰¤(XT âˆ’K)+
B âˆ’K
+ XÏ„B âˆ’XT
B âˆ’K
I{Ï„Bâ‰¤T }
appearing in the proof of Theorem 7.27 can be interpreted in terms of a suitable
superhedging strategy for the claim H dig by using call options and forward contracts:
At time t = 0, we buy (B âˆ’K)âˆ’1 call options with strike K, and at the ï¬rst time when
the price process passes the barrier B, we sell forward (B âˆ’K)âˆ’1 shares of the asset.
This strategy will be optimal if the strike price K is such that it realizes the minimum
on the right-hand side of (7.12). By virtue of Lemma 7.28, such an optimal strike
price can be identiï¬ed as the Value at Risk at level 1 âˆ’Î» of a short position âˆ’XT in
the asset.
â™¦
Let us now derive bounds on the arbitrage-free prices of barrier call options. More
precisely, we will consider an up-and-in call option
H call
u&i :=
ï£±
ï£²
ï£³
(XT âˆ’K)+
if max
0â‰¤tâ‰¤T Xt â‰¥B,
0
otherwise,
and the corresponding up-and-out call
H call
u&o :=
ï£±
ï£²
ï£³
(XT âˆ’K)+
if max
0â‰¤tâ‰¤T Xt < B,
0
otherwise.

7.4 Superhedging with liquid options
331
If the barrier B is below the strike price K, then the up-and-in call is identical to a
â€œplain vanilla callâ€ (XT âˆ’K)+, and the payoff of the up-and-out call is zero. Thus,
we assume from now on that
K < B.
Recall that Kâˆ—denotes the minimizer of the function c â†’CT (c)/(B âˆ’c) as con-
structed in Lemma 7.28.
Theorem 7.31. For an up-and-in call option,
max
P âˆ—âˆˆPT
Eâˆ—
H call
u&i

=
ï£±
ï£´ï£²
ï£´ï£³
CT (K)
if Kâˆ—â‰¤K,
B âˆ’K
B âˆ’Kâˆ—CT (Kâˆ—)
if Kâˆ—> K.
Proof. For any c with K â‰¤c < B,
H call
u&i â‰¤B âˆ’K
B âˆ’c (XT âˆ’c)+ + c âˆ’K
B âˆ’c (XÏ„B âˆ’XT ) I{Ï„Bâ‰¤T }.
Indeed, on {XT â‰¤K} or on {Ï„B > T } the payoff of H call
u&i is zero, and the right-
hand side is non-negative. On { XT â‰¥c, Ï„B â‰¤T }, both sides are equal, and on
{ c > XT > K, Ï„B â‰¤T } we may have a strict inequality. The expectation of the
right-hand side under a martingale measure P âˆ—âˆˆPT is equal to
B âˆ’K
B âˆ’c CT (c) + c âˆ’K
B âˆ’c Eâˆ—
(XÏ„B âˆ’XT ) I{Ï„Bâ‰¤T }

= B âˆ’K
B âˆ’c CT (c),
due to the stopping theorem. The minimum of this upper bound over all c âˆˆ[K, B)
is attained in c = K âˆ¨Kâˆ—, which shows â‰¤in the assertion.
Finally, let Ë†P be the martingale measure constructed in Lemma 7.29. If Kâˆ—â‰¤K
then
(XT âˆ’K)+ I{Ï„Bâ‰¤T } = (XT âˆ’K)+
Ë†P -a.s.,
and so Ë†E[ H call
u&i ] = CT (K). If Kâˆ—> K then Ë†P -a.s.
B âˆ’K
B âˆ’Kâˆ—(XT âˆ’Kâˆ—)+ + Kâˆ—âˆ’K
B âˆ’Kâˆ—(B âˆ’XT ) I{Ï„Bâ‰¤T } = H call
u&i.
Taking expectations with respect to Ë†P concludes the proof.
Remark 7.32. The inequality
H call
u&i â‰¤B âˆ’K
B âˆ’c (XT âˆ’c)+ + c âˆ’K
B âˆ’c (XÏ„B âˆ’XT ) I{Ï„Bâ‰¤T }
appearing in the preceding proof can be interpreted as a superhedging strategy for the
up-and-in call with liquid derivatives: At time t = 0, we purchase (B âˆ’K)/(B âˆ’c)
call options with strike c, and at the ï¬rst time when the stock price passes the barrier B,
we sell forward (c âˆ’K)/(B âˆ’c) shares of the asset. This strategy will be optimal for
c = Kâˆ—âˆ¨K.
â™¦

332
7 Superhedging
We now turn to the analysis of the up-and-out call option
H call
u&o = (XT âˆ’K)+ I{Ï„B>T }.
Theorem 7.33. For an up-and-out call,
max
P âˆ—âˆˆPT
Eâˆ—
H call
u&o

= CT (K) âˆ’CT (B) âˆ’(B âˆ’K) ÂµT

[B, âˆ)

.
Proof. Clearly,
H call
u&o â‰¤(XT âˆ’K)+ I{XT <B}
(7.13)
= (XT âˆ’K)+ âˆ’(XT âˆ’B)+ âˆ’(B âˆ’K) I{XT â‰¥B}.
Taking expectations yields â‰¤in the assertion.
Now consider the measure 
P on (, F ) deï¬ned as

P := Î´X0 âŠ—Â· Â· Â· âŠ—Î´X0 âŠ—ÂµT ,
i.e., under 
P we have Xt = X0 
P -a.s. for t < T , and the law of XT is ÂµT . Clearly

P âˆˆPT , and (7.13) is 
P -a.s. an identity.
Using the identity
(XT âˆ’K)+ = H call
u&o + H call
u&i,
we get the following lower bounds as an immediate corollary.
Corollary 7.34. We have
min
P âˆ—âˆˆPT
Eâˆ—
H call
u&i

= CT (B) + (B âˆ’K) ÂµT

[B, âˆ)

,
and
min
P âˆ—âˆˆPT
Eâˆ—
H call
u&o

=
ï£±
ï£²
ï£³
0
if Kâˆ—â‰¤K,
CT (K) âˆ’B âˆ’K
B âˆ’Kâˆ—CT (Kâˆ—)
if Kâˆ—> K.

Chapter 8
Efï¬cient hedging
In an incomplete ï¬nancial market model, a contingent claim typically will not admit
a perfect hedge. Superhedging provides a method for staying on the safe side, but the
required cost is usually too high both from a theoretical and from a practical point of
view. It is thus natural to relax the requirements.
As a ï¬rst preliminary step, we consider strategies of quantile hedging which stay
on the safe side with high probability. In other words, we maximize the probability
for staying on the safe side under a given cost constraint. The main idea consists
in reducing the construction of such strategies for a given claim H to a problem of
superhedging for a modiï¬ed claim 
H, which is the solution to a static optimization
problem of Neymanâ€“Pearson type. Typically, 
H will have the form of a knock-out
option, that is, 
H = H Â· IA. At this stage, we only focus on the probability that a
shortfall occurs; we do not take into account the size of the shortfall if it does occur.
In Section 8.2 we take a more comprehensive view of the downside risk. Our
discussion of risk measures in Section 4.8 suggests to quantify the downside risk in
terms of an acceptance set for suitably hedged positions. If acceptability is deï¬ned
in terms of shortfall risk as in Section 4.9, we are led to the problem of constructing
efï¬cient strategies which minimize the shortfall risk under a given cost constraint.
As in the case of quantile hedging, this problem can be decomposed into a static
optimization problem and the construction of a superhedging strategy for a modiï¬ed
payoff proï¬le 
H.
8.1 Quantile hedging
Let H be a discounted European claim in an arbitrage-free market model such that
Ï€sup(H) = sup
P âˆ—âˆˆP
Eâˆ—[ H ] < âˆ.
We saw in Corollary 7.15 that there exists a self-ï¬nancing trading strategy whose value
process V â†‘satisï¬es
V â†‘
T â‰¥H
P -a.s.
By using such a superhedging strategy, the seller of H can cover almost any possible
obligation which may arise from the sale of H and thus eliminate completely the
corresponding risk. The smallest amount for which such a superhedging strategy is
available is given by Ï€sup(H). This cost will often be too high from a practical point of
view, as illustrated by Example 7.21. Furthermore, if H is not attainable then Ï€sup(H),

334
8 Efï¬cient hedging
viewed as a price for H, is too high from a theoretical point of view since it would
permit arbitrage. Even if H is attainable, a complete elimination of risk by using a
replicating strategy for H would consume the entire proceeds from the sale of H, and
any opportunity of making a proï¬t would be lost along with the risk.
Let us therefore suppose that the seller is unwilling to put up the initial amount
of capital required by a superhedge and is ready to accept some risk. What is the
optimal partial hedge which can be achieved with a given smaller amount of capital?
In order to make this question precise, we need a criterion expressing the sellerâ€™s
attitude towards risk. Several of such criteria will be studied in the following sections.
In this section, our aim is to construct a strategy which maximizes the probability of a
successful hedge given a constraint on the initial cost.
More precisely, let us ï¬x an initial amount
v < Ï€sup(H).
We are looking for a self-ï¬nancing trading strategy whose value process maximizes
the probability
P [ VT â‰¥H ]
among all those strategies whose initial investment V0 is bounded by v and which
respect the bounds Vt â‰¥0 for t = 0, . . . , T . In view of Theorem 5.26, the second
restriction amounts to admissibility in the following sense:
Deï¬nition 8.1. A self-ï¬nancing trading strategy is called an admissible strategy if its
value process satisï¬es VT â‰¥0.
The problem of quantile hedging consists in constructing an admissible strategy
Î¾âˆ—such that its value process V âˆ—satisï¬es
P [ V âˆ—
T â‰¥H ] = max P [ VT â‰¥H ]
(8.1)
where the maximum is taken over all value processes V of admissible strategies subject
to the constraint
V0 â‰¤v.
(8.2)
Note that this problem would not be well posed if considered without the constraint
of admissibility.
Let us emphasize that the idea of quantile hedging corresponds to a Value at Risk
criterion, and that it invites the same criticism: Only the probability of a shortfall is
taken into account, not the size of the loss if a shortfall occurs. This exclusive focus
on the shortfall probability may be reasonable in cases where a loss is to be avoided
by any means. But for most applications, other optimality criteria as considered in
the next section will usually be more appropriate from an economic point of view. In
view of the mathematical techniques, however, some key ideas already appear quite
clearly in our present context.

8.1 Quantile hedging
335
Let us ï¬rst consider the particularly transparent situation of a complete market
model before passing to the general incomplete case. The set
{ VT â‰¥H }
will be called the success set associated with the value process V of an admissible
strategy. As a ï¬rst step, we reduce our problem to the construction of a success set of
maximal probability.
Proposition 8.2. Let P âˆ—denote the unique equivalent martingale measure in a com-
plete market model, and assume that Aâˆ—âˆˆFT maximizes the probability P [A] among
all sets A âˆˆFT satisfying the constraint
Eâˆ—[ H Â· IA ] â‰¤v.
(8.3)
Then the replicating strategy Î¾âˆ—of the knock-out option
H âˆ—:= H Â· IAâˆ—
solves the optimization problem deï¬ned by (8.1) and (8.2), and Aâˆ—coincides up to
P-null sets with the success set of Î¾âˆ—.
Proof. As a ï¬rst step, let V be the value process of any admissible strategy such that
V0 â‰¤v. We denote by A := {VT â‰¥H} the corresponding success set. Admissibility
yields that VT â‰¥H Â· IA. Moreover, the results of Section 5.3 imply that V is a
P âˆ—-martingale. Hence, we obtain that
Eâˆ—[ H Â· IA ] â‰¤Eâˆ—[ VT ] = V0 â‰¤v.
Therefore, A fulï¬lls the constraint (8.3) and it follows that
P [ A ] â‰¤P [ Aâˆ—].
As a second step, we consider the trading strategy Î¾âˆ—and its value process V âˆ—.
Clearly, Î¾âˆ—is admissible, and its success set satisï¬es
{ V âˆ—
T â‰¥H } = { H Â· IAâˆ—â‰¥H } âŠ‡Aâˆ—.
On the other hand, the ï¬rst part of the proof yields that
P [ V âˆ—
T â‰¥H ] â‰¤P [ Aâˆ—].
It follows that the two sets Aâˆ—and { V âˆ—
T â‰¥H } coincide up to P -null sets. In particular,
Î¾âˆ—is an optimal strategy.
Our next goal is the construction of the optimal success set Aâˆ—, whose existence
was assumed in Proposition 8.2. This problem is solved by using the Neymanâ€“Pearson
lemma. To this end, we introduce the measure Qâˆ—given by
dQâˆ—
dP âˆ—:=
H
Eâˆ—[ H ].
(8.4)

336
8 Efï¬cient hedging
The constraint (8.3) can be written as
Qâˆ—[ A ] â‰¤Î± :=
v
Eâˆ—[ H ].
(8.5)
Thus, an optimal success set must maximize the probability P [ A ] under the constraint
Qâˆ—[ A ] â‰¤Î±. We denote by dP/dQâˆ—the generalized density of P with respect to Qâˆ—
in the sense of the Lebesgue decomposition as constructed in Theorem A.13. Thus,
we may deï¬ne the level
câˆ—:= inf

c â‰¥0
 Qâˆ—
 dP
dQâˆ—> c Â· Eâˆ—[ H ]

â‰¤Î±

,
(8.6)
and the set
Aâˆ—:=
 dP
dQâˆ—> câˆ—Â· Eâˆ—[ H ]

=
 dP
dP âˆ—> câˆ—Â· H

.
(8.7)
Proposition 8.3. If the set Aâˆ—in (8.7) satisï¬es
Qâˆ—[ Aâˆ—] = Î±,
then Aâˆ—maximizes the probability P [ A ] over all A âˆˆFT satisfying the constraint
Eâˆ—[ H Â· IA ] â‰¤v.
Proof. The condition Eâˆ—[ H Â·IA ] â‰¤v is equivalent to Qâˆ—[ A ] â‰¤Î± = Qâˆ—[ Aâˆ—]. Thus,
the particular form of the set Aâˆ—in (8.7) and the Neymanâ€“Pearson lemma in the form
of Proposition A.28 imply that P [ A ] â‰¤P [ Aâˆ—].
By combining the two Propositions 8.2 and 8.3, we obtain the following result.
Corollary 8.4. Denote by P âˆ—the unique equivalent martingale measure in a complete
market model, and assume that the set Aâˆ—of (8.7) satisï¬es
Qâˆ—[ Aâˆ—] = Î±.
Then the optimal strategy solving (8.1) and (8.2) is given by the replicating strategy
of the knock-out option H âˆ—= H Â· IAâˆ—.
Our solution to the optimization problem (8.1) and (8.2) still relies on the assump-
tion that the set Aâˆ—of (8.7) satisï¬es Qâˆ—[ Aâˆ—] = Î±. This condition is clearly satisï¬ed
if
P
 dP
dP âˆ—= câˆ—Â· H

= 0.
However, it may not in general be possible to ï¬nd any set A whose Qâˆ—-probability
is exactly Î±. In such a situation, the Neymanâ€“Pearson theory suggests replacing the

8.1 Quantile hedging
337
indicator function IAâˆ—of the â€œcritical regionâ€ Aâˆ—by a randomized test, i.e., by an
FT -measurable [0, 1]-valued function Ïˆ. Let R denote the class of all randomized
tests, and consider the following optimization problem:
E[ Ïˆâˆ—] = max

E[ Ïˆ ] | Ïˆ âˆˆR and EQâˆ—[ Ïˆ ] â‰¤Î±

,
where Qâˆ—is the measure deï¬ned in (8.4) and Î± = v/Eâˆ—[ H ] as in (8.5). The gener-
alized Neymanâ€“Pearson lemma in the form of Theorem A.30 states that the solution
is given by
Ïˆâˆ—= I
dP
dP âˆ—>câˆ—Â·H
 + Î³ Â· I
dP
dPâˆ—=câˆ—Â·H
,
(8.8)
where câˆ—is deï¬ned through (8.6) and Î³ is chosen such that EQâˆ—[ Ïˆâˆ—] = Î±, i.e.,
Î³ = Î± âˆ’Qâˆ— dP
dP âˆ—> câˆ—Â· H

Qâˆ— dP
dP âˆ—= câˆ—Â· H

in case P
 dP
dP âˆ—= câˆ—Â· H

Ì¸= 0.
Deï¬nition 8.5. Let V be the value process of an admissible strategy Î¾. The success
ratio of Î¾ is deï¬ned as the randomized test
ÏˆV = I{VT â‰¥H} + VT
H Â· I{VT <H}.
Note that the set { ÏˆV = 1 } coincides with the success set { VT â‰¥H } of V . In
the extended version of our original problem, we are now looking for a strategy which
maximizes the expected success ratio E[ ÏˆV ] under the measure P under the cost
constraint V0 â‰¤v:
Theorem 8.6. Suppose that P âˆ—is the unique equivalent martingale measure in a
complete market model. Let Ïˆâˆ—be given by (8.8), and denote by Î¾âˆ—a replicating
strategy for the discounted claim H âˆ—= H Â· Ïˆâˆ—. Then the success ratio ÏˆV âˆ—of Î¾âˆ—
maximizes the expected success ratio E[ ÏˆV ] among all admissible strategies with
initial investment V0 â‰¤v. Moreover, the optimal success ratio ÏˆV âˆ—is P -a.s. equal
to Ïˆâˆ—.
We do not prove this theorem here, as it is a special case of Theorem 8.7 below
and its proof is similar to the one of Corollary 8.4, once the optimal randomized test
Ïˆâˆ—has been determined by the generalized Neymanâ€“Pearson lemma. Note that the
condition
P
 dP
dP âˆ—= câˆ—Â· H

= 0
implies that Ïˆâˆ—= IAâˆ—with Aâˆ—as in (8.7), so in this case the strategy Î¾âˆ—reduces to
the one described in Corollary 8.4.

338
8 Efï¬cient hedging
Now we turn to the general case of an arbitrage-free but possibly incomplete market
model, i.e., we no longer assume that the set P of equivalent martingale measures
consists of a single element, but we assume only that
P Ì¸= âˆ….
In this setting, our aim is to ï¬nd an admissible strategy whose success ratio ÏˆV âˆ—
satisï¬es
E[ ÏˆV âˆ—] = max E[ ÏˆV ],
(8.9)
where the maximum on the right-hand side is taken over all admissible strategies
whose initial investment satisï¬es the constraint
V0 â‰¤v.
(8.10)
Theorem 8.7. There exists a randomized test Ïˆâˆ—such that
sup
P âˆ—âˆˆP
Eâˆ—[ H Â· Ïˆâˆ—] = v,
(8.11)
and which maximizes E[ Ïˆ ] among all Ïˆ âˆˆR subject to the constraints
Eâˆ—[ H Â· Ïˆ ] â‰¤v
for all P âˆ—âˆˆP .
(8.12)
Moreover, the superhedging strategy for the modiï¬ed claim
H âˆ—= H Â· Ïˆâˆ—
with initial investment Ï€sup(H âˆ—) solves the problem (8.9) and (8.10).
Proof. Denote by R0 the set of all Ïˆ âˆˆR which satisfy the constraints (8.12), and
take a sequence Ïˆn âˆˆR0 such that
E[ Ïˆn ] âˆ’â†’sup
ÏˆâˆˆR0
E[ Ïˆ ]
as n â†‘âˆ.
Lemma 1.69 yields a sequence of convex combinations 
Ïˆn âˆˆconv{Ïˆn, Ïˆn+1, . . . }
converging P -a.s. to a function 
Ïˆ âˆˆR. Clearly, 
Ïˆn âˆˆR0 for each n. Hence, Fatouâ€™s
lemma yields that
Eâˆ—[ H 
Ïˆ ] â‰¤lim inf
nâ†‘âˆEâˆ—[ H 
Ïˆn ] â‰¤v
for all P âˆ—âˆˆP ,
and it follows that 
Ïˆ âˆˆR0. Moreover,
E[ 
Ïˆ ] = lim
nâ†‘âˆ
E[ 
Ïˆn ] = lim
nâ†‘âˆ
E[ Ïˆn ] = sup
ÏˆâˆˆR0
E[ Ïˆ ],
so Ïˆâˆ—:= 
Ïˆ is the desired maximizer.

8.2 Hedging with minimal shortfall risk
339
We must also show that (8.11) holds. To this end, note ï¬rst that P [ Ïˆâˆ—= 1 ] = 1 is
impossible due to our assumption v < Ï€sup(H). Hence, if supP âˆ—âˆˆP Eâˆ—[ H Â· Ïˆâˆ—] < v,
then we can ï¬nd some Îµ > 0 such that ÏˆÎµ := Îµ+(1âˆ’Îµ)Ïˆâˆ—âˆˆR0, and the expectation
E[ ÏˆÎµ ] must be strictly larger than E[ Ïˆâˆ—]. This, however, contradicts the maximality
of E[ Ïˆâˆ—].
Now let Î¾ be any admissible strategy whose value process V satisï¬es V0 â‰¤v. If
ÏˆV denotes the corresponding success ratio, then
H Â· ÏˆV = H âˆ§VT â‰¤VT .
The P -martingale property of V yields that for all P âˆ—âˆˆP ,
Eâˆ—[ H Â· ÏˆV ] â‰¤Eâˆ—[ VT ] = V0 â‰¤v.
(8.13)
Therefore, ÏˆV is contained in R0 and it follows that
E[ ÏˆV ] â‰¤E[ Ïˆâˆ—].
(8.14)
Consider the superhedging strategy Î¾âˆ—of H âˆ—= H Â·Ïˆâˆ—and denote by V âˆ—its value
process. Clearly, Î¾âˆ—is an admissible strategy. Moreover,
V âˆ—
0 = Ï€sup(H âˆ—) = sup
P âˆ—âˆˆP
Eâˆ—[ H Â· Ïˆâˆ—] = v.
Thus, (8.14) yields that ÏˆV âˆ—satisï¬es
E[ ÏˆV âˆ—] â‰¤E[ Ïˆâˆ—].
(8.15)
On the other hand, V âˆ—
T dominates H âˆ—, so
H Â· ÏˆV âˆ—= H âˆ§V âˆ—
T â‰¥H âˆ§H âˆ—= H Â· Ïˆâˆ—.
Therefore, ÏˆV âˆ—dominates Ïˆâˆ—on the set { H > 0 }. Moreover, any success ratio is
equal to one on { H = 0 }, and we obtain that ÏˆV âˆ—â‰¥Ïˆâˆ—P -almost surely. According
to (8.15), this can only happen if the two randomized tests ÏˆV âˆ—and Ïˆâˆ—coincide
P-almost everywhere. This proves that Î¾âˆ—solves the hedging problem (8.9) and
(8.10).
8.2 Hedging with minimal shortfall risk
Our starting point in this section is the same as in the previous one: At time T , an
investor must pay the discounted random amount H â‰¥0. A complete elimination of
the corresponding risk would involve the cost
Ï€sup(H) = sup
P âˆ—âˆˆP
Eâˆ—[ H ]

340
8 Efï¬cient hedging
of superhedging H, but the investor is only willing to put up a smaller amount
v âˆˆ

0, Ï€sup(H)

.
This means that the investor is ready to take some risk: Any â€œpartialâ€ hedging strategy
whose value process V satisï¬es the capital constraint V0 â‰¤v will generate a non-trivial
shortfall
(H âˆ’VT )+.
In the previous section, we constructed trading strategies which minimize the shortfall
probability
P [ VT < H ]
among the class of trading strategies whose initial investment is bounded by v, and
which are admissible in the sense of Deï¬nition 8.1, i.e., their terminal value VT is
non-negative. In this section, we assess the shortfall in terms of a loss function, i.e.,
an increasing function â„“: R â†’R which is not identically constant. We assume
furthermore that
â„“(x) = 0 for x â‰¤0
and
E[ â„“(H) ] < âˆ.
A particular role will be played by convex loss functions, which correspond to risk
aversion in view of the shortfall; compare the discussion in Section 4.9.
Deï¬nition 8.8. Given a loss function â„“satisfying the above assumptions, the shortfall
risk of an admissible strategy with value process V is deï¬ned as the expectation
E

â„“(H âˆ’VT )

= E

â„“

(H âˆ’VT )+  
of the shortfall weighted by the loss function â„“.
Our aim is to minimize the shortfall risk among all admissible strategies satisfying
the capital constraint V0 â‰¤v. Alternatively, we could minimize the cost under a
given bound on the shortfall risk. In other words, the problem consists in constructing
strategies which are efï¬cient with respect to the trade-off between cost and shortfall
risk. This generalizes our discussion of quantile hedging in the previous Section 8.1,
whichcorrespondstoaminimizationoftheshortfallriskwithrespecttothenon-convex
loss function
â„“(x) = I(0,âˆ)(x).
Remark 8.9. Recall our discussion of risk measures in Chapter 4. From this point of
view, it is natural to quantify the downside risk in terms of an acceptance set A for
hedged positions. As in Section 4.8, we denote by Â¯A the class of all positions X such
that there exists an admissible strategy Î¾ with value process V such that
V0 = 0
and
X + VT â‰¥A
P-a.s.

8.2 Hedging with minimal shortfall risk
341
for some A âˆˆA. Thus, the downside risk of the position âˆ’H takes the form
Ï(âˆ’H) = inf{ m âˆˆR | m âˆ’H âˆˆÂ¯A }.
Suppose that the acceptance set A is deï¬ned in terms of shortfall risk, i.e.,
A := { X âˆˆLâˆ| E[ â„“(Xâˆ’) ] â‰¤x0 },
where â„“is a convex loss function and x0 is a given threshold. Then Ï(âˆ’H) is the
smallest amount m such that there exists an admissible strategy Î¾ whose value process
V satisï¬es V0 = m and
E

â„“

(H âˆ’VT )+ 
â‰¤x0.
For a given m, we are thus led to the problem of ï¬nding a strategy Î¾ which minimizes
the shortfall risk under the cost constraint V0 â‰¤m. In this way, the problem of
quantifying the downside risk of a contingent claim is reduced to the construction of
efï¬cient hedging strategies as discussed in this section.
â™¦
As in the preceding section, the construction of the optimal hedging strategy is
carried out in two steps. The ï¬rst one is to solve the â€œstaticâ€ problem of minimizing
E[ â„“(H âˆ’Y) ]
among all FT -measurable random variables Y â‰¥0 which satisfy the constraints
sup
P âˆ—âˆˆP
Eâˆ—[ Y ] â‰¤v.
If Y âˆ—solves this problem, then so does Y := H âˆ§Y âˆ—. Hence, we may assume that
0 â‰¤Y âˆ—â‰¤H or, equivalently, that Y âˆ—= H Ïˆâˆ—for some randomized test Ïˆâˆ—, which
belongs to the set R of all FT -measurable random variables with values in [0, 1]. Thus,
the static problem can be reformulated as follows: Find a randomized test Ïˆâˆ—âˆˆR
which minimizes the â€œshortfall riskâ€
E

â„“

H(1 âˆ’Ïˆ)

(8.16)
among all Ïˆ âˆˆR subject to the constraints
Eâˆ—[ H Ïˆ ] â‰¤v
for all P âˆ—âˆˆP .
(8.17)
The next step is to ï¬t the terminal value VT of an admissible strategy to the
optimal proï¬le H Ïˆâˆ—. It turns out that this step can be carried out without any further
assumptions on our loss function â„“. Thus, we assume at this point that the optimal Ïˆâˆ—
of step one is granted, and we construct the corresponding optimal strategy.
Theorem 8.10. Given a randomized test Ïˆâˆ—which minimizes (8.16) subject to (8.17),
a superhedging strategy Î¾âˆ—for the modiï¬ed discounted claim
H âˆ—:= H Ïˆâˆ—
with initial investment Ï€sup(H âˆ—) has minimal shortfall risk among all admissible strate-
gies Î¾ which satisfy the capital constraint Î¾1 Â· X0 â‰¤v.

342
8 Efï¬cient hedging
Proof. The proof extends the last argument in the proof of Theorem 8.7. As a ï¬rst
step, we take any admissible strategy Î¾ such that the corresponding value process V
satisï¬es the capital constraint V0 â‰¤v. Denote by
ÏˆV = I{VT â‰¥H} + VT
H Â· I{VT <H}
the corresponding success ratio. It follows as in (8.13) that ÏˆV satisï¬es the constraints
Eâˆ—[ H ÏˆV

â‰¤v
for all P âˆ—âˆˆP .
Thus, the optimality of Ïˆâˆ—implies the following lower bound on the shortfall risk
of Î¾:
E

â„“

H âˆ’VT

= E

â„“

H(1 âˆ’ÏˆV )

â‰¥E

â„“

H(1 âˆ’Ïˆâˆ—)

.
In the second step, we consider the admissible strategy Î¾âˆ—and its value process
V âˆ—. On the one hand,
V âˆ—
0 = Ï€sup(H âˆ—) = sup
P âˆ—âˆˆP
Eâˆ—[ H Ïˆâˆ—] â‰¤v,
so Î¾âˆ—satisï¬es the capital constraint. Hence, the ï¬rst part of the proof yields
E

â„“

H âˆ’V âˆ—
T

= E

â„“

H(1 âˆ’ÏˆV âˆ—)

â‰¥E

â„“

H(1 âˆ’Ïˆâˆ—)

.
(8.18)
On the other hand, V âˆ—
T â‰¥H âˆ—= H Ïˆâˆ—, and therefore
ÏˆV âˆ—â‰¥Ïˆâˆ—
P -a.s.
Hence, the inequality in (8.18) is in fact an equality, and the assertion follows.
Let us now return to the static problem deï¬ned by (8.16) and (8.17). We start by
considering the special case of risk aversion in view of the shortfall.
Proposition 8.11. If the loss function â„“is convex, then there exists a randomized test
Ïˆâˆ—âˆˆR which minimizes the shortfall risk
E

â„“

H(1 âˆ’Ïˆ)

among all Ïˆ âˆˆR subject to the constraints
Eâˆ—[ H Ïˆ ] â‰¤v
for all P âˆ—âˆˆP .
(8.19)
If â„“is strictly convex on [0, âˆ), then Ïˆâˆ—is uniquely determined on {H > 0}.
Proof. The proof is similar to the one of Proposition 3.36. Let R0 denote the set of
all randomized tests which satisfy the constraints (8.19). Take Ïˆn âˆˆR0 such that
E[â„“( H(1âˆ’Ïˆn) )] converges to the inï¬mum of the shortfall risk, and use Lemma 1.69

8.2 Hedging with minimal shortfall risk
343
to select convex combinations 
Ïˆn âˆˆconv{Ïˆn, Ïˆn+1, . . . } which converge P -a.s. to
some 
Ïˆ âˆˆR. Since â„“is continuous and increasing, Fatouâ€™s lemma implies that
E

â„“

H(1 âˆ’
Ïˆ)

â‰¤lim inf
nâ†‘âˆE

â„“

H(1 âˆ’
Ïˆn)

= inf
ÏˆâˆˆR0
E

â„“

H(1 âˆ’Ïˆ)

,
where we have used the convexity of â„“to conclude that E[â„“( H(1 âˆ’
Ïˆn) )] tends to
the same limit as E[â„“( H(1 âˆ’Ïˆn) )].
Fatouâ€™s lemma also yields that for all P âˆ—âˆˆP
Eâˆ—[ H 
Ïˆ ] â‰¤lim inf
nâ†‘âˆEâˆ—[ H 
Ïˆn ] â‰¤v.
Hence 
Ïˆ âˆˆR0, and we conclude that Ïˆâˆ—:= 
Ïˆ is the desired minimizer. The
uniqueness part is obvious.
Remark 8.12. The proof shows that the analogous existence result holds if we use a
robust version of the shortfall risk deï¬ned as
sup
QâˆˆQ
EQ

â„“

H(1 âˆ’Ïˆ)

,
where Q is a class of equivalent probability measures; see also Remark 3.37.
â™¦
Combining Proposition 8.11 and Theorem 8.10 yields existence and uniqueness
of an optimal hedging strategy under risk aversion in a general arbitrage-free market
model.
Corollary 8.13. Assume that the loss function â„“is strictly convex on [0, âˆ). Then
there exists an admissible strategy which is optimal in the sense that it minimizes
the shortfall risk among all admissible strategies Î¾ subject to the capital constraint
Î¾1 Â· X0 â‰¤v. Moreover, any optimal strategy requires the exact initial investment v,
and its success ratio is P -a.s. equal to
Ïˆâˆ—Â· I{H>0} + I{H=0},
where Ïˆâˆ—denotes the solution of the static problem constructed in Proposition 8.11.
Proof. The existence of an optimal strategy follows by combining Proposition 8.11
and Theorem 8.10. Strict convexity of â„“implies that Ïˆâˆ—is P -a.s. unique on {H > 0}.
Since â„“is strictly increasing on [0, âˆ), Ïˆâˆ—and the success ratio ÏˆV âˆ—of any optimal
strategy Î¾âˆ—must coincide P -a.s. on {H > 0}. On {H = 0}, the success ratio ÏˆV âˆ—is
equal to 1 by deï¬nition.
Since â„“is strictly increasing on [0, âˆ), we must have that
sup
P âˆ—âˆˆP
Eâˆ—[ H Ïˆâˆ—] = v,

344
8 Efï¬cient hedging
for otherwise we could ï¬nd some Îµ > 0 such that ÏˆÎµ := Îµ + (1 âˆ’Îµ)Ïˆâˆ—would also
satisfy the constraints (8.17). Since we have assumed that v < Ï€sup(H), the constraints
(8.17) imply that Ïˆâˆ—Ì¸â‰¡1 and hence that
E

â„“

H(1 âˆ’ÏˆÎµ)

< E

â„“

H(1 âˆ’Ïˆâˆ—)

.
This, however, contradicts the optimality of Ïˆâˆ—.
Since the value process V âˆ—of an optimal strategy is a P -martingale, and since
V âˆ—
T â‰¥H ÏˆV âˆ—= H Ïˆâˆ—,
we conclude from the above that
v â‰¥V âˆ—
0 = sup
P âˆ—âˆˆP
Eâˆ—[ V âˆ—
T ] â‰¥sup
P âˆ—âˆˆP
Eâˆ—[ H Ïˆâˆ—] = v.
Thus, V âˆ—
0 is equal to v.
Beyond the general existence statement of Proposition 8.11, it is possible to obtain
an explicit formula for the optimal solution of the static problem if the market model
is complete. Recall that we assume that the loss function â„“(x) vanishes for x â‰¤0. In
addition, we will also assume that
â„“is strictly convex and continuously differentiable on (0, âˆ).
Then the derivative â„“â€² of â„“is strictly increasing on (0, âˆ). Let J denote the inverse
function of â„“â€² deï¬ned on the range of â„“â€², i.e., on the interval (a, b) where a :=
limxâ†“0 â„“â€²(x) and b := limxâ†‘âˆâ„“â€²(x). We extend J to a function J + : [0, âˆ] â†’[0, âˆ]
by setting
J +(y) :=

+âˆ
for y â‰¥b,
0
for y â‰¤a.
From now on, we assume also that
P = {P âˆ—},
i.e., P âˆ—is the unique equivalent martingale measure in a complete market model. Its
density will be denoted by
Ï•âˆ—:= dP âˆ—
dP .
Theorem 8.14. Under the above assumptions, the solution of the static optimization
problem of Proposition 8.11 is given by
Ïˆâˆ—= 1 âˆ’J +(c Ï•âˆ—)
H
âˆ§1
P -a.s. on { H > 0 },
where the constant c is determined by the condition Eâˆ—[ H Ïˆâˆ—] = v.

8.2 Hedging with minimal shortfall risk
345
Proof. The problem is of the same type as those considered in Section 3.3. It can in
fact be reduced to Corollary 3.43 by considering the random utility function
u(x, Ï‰) := âˆ’â„“(H(Ï‰) âˆ’x),
0 â‰¤x â‰¤H(Ï‰).
Just note that the shortfall risk E[ â„“(H âˆ’Y) ] coincides with the negative expected
utility âˆ’E[u(Y, Â·) ] for any proï¬le Y such that 0 â‰¤Y â‰¤H. Moreover, since our
market model is complete, it has a ï¬nite structure by Theorem 5.38, and so all inte-
grability conditions are automatically satisï¬ed. Thus, Corollary 3.43 states that the
optimal proï¬le H âˆ—:= Y âˆ—which maximizes the expected utility E[ u(Y, Â·) ] under the
constraints 0 â‰¤Y â‰¤H and Eâˆ—[ Y ] â‰¤v is given by
H âˆ—(Ï‰) = I +(c Ï•âˆ—(Ï‰), Ï‰) âˆ§H(Ï‰) =

H(Ï‰) âˆ’J +(c Ï•âˆ—(Ï‰))
+.
Dividing by H yields the formula for the optimal randomized test Ïˆâˆ—.
Corollary 8.15. In the situation of Theorem 8.14, suppose that the objective proba-
bility measure P is equal to the martingale measure P âˆ—. Then the modiï¬ed discounted
claim takes the simple form
H âˆ—= H Ïˆâˆ—=

H âˆ’J +(câˆ—)
+.
Example 8.16. Consider the discounted payoff H of a European call option
(Si
T âˆ’K)+ with strike K under the assumption that the numÃ©raire S0 is a risk-
less bond, i.e., that S0
t = (1 + r)t for a certain constant r â‰¥0. If the assumptions
of Corollary 8.15 hold, then the modiï¬ed proï¬le H âˆ—is the discounted value of the
European call option struck at 
K := K + J +(câˆ—) Â· (1 + r)T , i.e.,
H âˆ—= (Si
T âˆ’
K)+
(1 + r)T
.
â™¦
Example 8.17. Consider an exponential loss function â„“(x) = (eÎ±x âˆ’1)+ for some
Î± > 0. In this case,
J +(y) =
 1
Î± log y
Î±
+
,
y â‰¥0,
and the optimal proï¬le is given by
H âˆ—= H âˆ’
 1
Î± log cÏ•âˆ—
Î±
+
âˆ§H.
â™¦
Example 8.18. If â„“is the particular loss function
â„“(x) = xp
p ,
x â‰¥0,

346
8 Efï¬cient hedging
for some p > 1, then the problem is to minimize a lower partial moment of the
difference VT âˆ’H. Theorem 8.14 implies that it is optimal to hedge the modiï¬ed
claim
H Ïˆâˆ—
p = H âˆ’(cp Â· Ï•âˆ—)1/(pâˆ’1) âˆ§H
(8.20)
where the constant cp is determined by Eâˆ—[ H Ïˆâˆ—
p

= v.
â™¦
Let us now consider the limit p â†‘âˆin (8.20), corresponding to ever increasing
risk aversion with respect to large losses.
Proposition 8.19. Let us consider the loss functions
â„“p(x) = xp
p ,
x â‰¥0,
for p > 1. As p â†‘âˆ, the modiï¬ed claims H Ïˆâˆ—
p of (8.20) converge P -a.s. and in
L1(P âˆ—) to the discounted claim
(H âˆ’câˆ)+
where the constant câˆis determined by
Eâˆ—[ (H âˆ’câˆ)+ ] = v.
(8.21)
Proof. Let Î³ (p) be shorthand for 1/(p âˆ’1) and note that
(Ï•âˆ—)Î³ (p) âˆ’â†’1
P -a.s. as p â†‘âˆ.
Hence, if (pn) is a sequence for which cÎ³ (pn)
pn
converges to some c âˆˆ[0, âˆ], then
lim
nâ†‘âˆH Ïˆâˆ—
pn = H âˆ’c âˆ§H = (H âˆ’c )+.
Hence,
Eâˆ—[ H Ïˆâˆ—
pn ] âˆ’â†’Eâˆ—[ (H âˆ’c )+ ].
Since each term on the left-hand side equals v, we must have
Eâˆ—[ (H âˆ’c )+ ] = v,
which determines c uniquely as the constant câˆof (8.21).
Example 8.20. If the discounted claim H in Proposition 8.19 is the discounted payoff
of a call option with strike K, and the numÃ©raire is a riskless bond as in Example 8.16,
then the limiting proï¬le limpâ†‘âˆH Ïˆâˆ—
p is equal to the discounted call with the higher
strike price K + câˆÂ· S0
T .
â™¦
In the remainder of this section, we consider loss functions which are not convex
but which correspond to risk neutrality and to risk-seeking preferences. Let us ï¬rst
consider the risk-neutral case.

8.2 Hedging with minimal shortfall risk
347
Example 8.21. In the case of risk neutrality, the loss function is given by
â„“(x) = x
for x â‰¥0.
Thus, the task is to minimize the expected shortfall
E[ (H âˆ’VT )+ ]
under the capital constraint V0 â‰¤v. Let P âˆ—be the unique equivalent martingale
measure in a complete market model.
Then the static problem corresponding to
Proposition 8.11 is to maximize the expectation
E[ H Ïˆ ]
under the constraint that Ïˆ âˆˆR satisï¬es
Eâˆ—[ H Ïˆ ] â‰¤v.
For simplicity, we assume P [ H > 0 ] = 1. Then we can deï¬ne two equivalent
measures Q and Qâˆ—by
dQ
dP =
H
E[ H ]
and
dQâˆ—
dP âˆ—=
H
Eâˆ—[ H ].
The problem then becomes the hypothesis testing problem of maximizing EQ[ Ïˆ ]
under the side condition
EQâˆ—[ Ïˆ ] â‰¤Î± :=
v
Eâˆ—[ H ].
Since the density dQ/dQâˆ—is proportional to the inverse of the density Ï•âˆ—= dP âˆ—/dP ,
Theorem A.30 implies that the optimal test takes the form
Ïˆâˆ—
1 = I{Ï•âˆ—<c1} + Î³ Â· I{Ï•âˆ—=c1}
where the constant c1 is given by
c1 = sup

c âˆˆR | Eâˆ—[ H; Ï•âˆ—< c ] â‰¤v

,
and where the constant Î³ is chosen such that Eâˆ—[ H Ïˆâˆ—
1 ] = v.
â™¦
Assume now that the shortfall risk is assessed by an investor who, instead of being
risk-averse, is in fact inclined to take risk. In our context, this corresponds to a loss
function which is concave on [0, âˆ) rather than convex. It is not difï¬cult to generalize
Theorem 8.14 so that it covers this situation. Here we limit ourselves to the following
explicit case study.

348
8 Efï¬cient hedging
Example 8.22. Consider the loss function
â„“(x) = xq
q ,
x â‰¥0,
for some q âˆˆ(0, 1). In order to solve our static optimization problem, one could
apply the results and techniques of Section 3.3. Here we will use an approach based
on the Neymanâ€“Pearson lemma. Note ï¬rst that for Ïˆ âˆˆR
â„“

H(1 âˆ’Ïˆ)

= (1 âˆ’Ïˆ)q Â· â„“(H) â‰¥â„“(H) âˆ’Ïˆ Â· â„“(H).
Hence, we get a lower bound on the â€œshortfall riskâ€ of Ïˆ:
E

â„“

H(1 âˆ’Ïˆ)
 
â‰¥E

â„“(H)

âˆ’E

Ïˆ Â· â„“(H)

.
(8.22)
The problem of ï¬nding a minimizer of the right-hand side is equivalent to maximiz-
ing the expectation EQ[ Ïˆ ] under the constraint that EQâˆ—[ Ïˆ ] â‰¤v/Eâˆ—[ H ] for the
measures Q and Qâˆ—deï¬ned via
dQ
dP =
H q
E[ H q ]
and
dQâˆ—
dP âˆ—=
H
Eâˆ—[ H ],
if we assume again P [ H > 0 ] = 1. As in Example 8.21, we then conclude that the
optimal test must be of the form
I{1>câˆ—
qÏ•âˆ—H 1âˆ’q} + Î³ Â· I{1=câˆ—
qÏ•âˆ—H 1âˆ’q}.
(8.23)
for certain constants câˆ—
q and Î³ . Under the simplifying assumption that
P [ 1 = câˆ—
qÏ•âˆ—H 1âˆ’q ] = 0,
(8.24)
the formula (8.23) reduces to
Ïˆâˆ—
q =

1
on { 1 > câˆ—
qÏ•âˆ—H 1âˆ’q },
0
otherwise.
(8.25)
By taking Ïˆ = Ïˆâˆ—
q we obtain an identity in (8.22), and so Ïˆâˆ—
q must be a minimizer for
E[ â„“(H(1 âˆ’Ïˆ)) ] under the constraint that Eâˆ—[ H Ïˆ ] â‰¤v.
â™¦
In our last result of this section, we recover the knock-out option
H Â· I{1>câˆ—
0Â·H Ï•âˆ—},
which was obtained as the solution to the problem of quantile hedging by taking the
limit q â†“0 in (8.25). Intuitively, decreasing q corresponds to an increasing appetite
for risk in view of the shortfall.

8.2 Hedging with minimal shortfall risk
349
Proposition 8.23. Let us assume for simplicity that (8.24) holds for all q âˆˆ(0, 1),
that P [ H > 0 ] = 1, and that there exists a unique constant câˆ—
0 such that
Eâˆ—
H Â· I{1>câˆ—
0Â·H Ï•âˆ—}

= v.
(8.26)
Then the solutions Ïˆâˆ—
q of (8.25) converge P -a.s. to the solution
Ïˆâˆ—
0 = I{1>câˆ—
0Â·H Ï•âˆ—}
of the corresponding problem of quantile hedging as constructed in Proposition 8.3.
Proof. Take any sequence qn â†“0 such that (câˆ—
qn)1/(1âˆ’qn) converges to somec âˆˆ[0, âˆ].
Then
lim
nâ†‘âˆÏˆâˆ—
qn = I{1>cÂ·H Ï•âˆ—}.
Hence,
Eâˆ—[ H Ïˆâˆ—
qn ] âˆ’â†’Eâˆ—
H Â· I{1>cÂ·H Ï•âˆ—}

.
Since we assumed (8.24) for all q âˆˆ(0, 1), the left-hand terms are all equal to v, and
it follows from (8.26) that c = câˆ—
0. This establishes the desired convergence.

Chapter 9
Hedging under constraints
So far, we have focussed on frictionless market models, where asset transactions can
be carried out with no limitation. In this chapter, we study the impact of market
imperfections generated by convex trading constraints. Thus, we develop the theory
of dynamic hedging under the condition that only trading strategies from a given
class S may be used. In Section 9.1 we characterize those market models for which
S does not contain arbitrage opportunities. Then we take a direct approach to the
superhedging duality for American options. To this end, we ï¬rst derive a uniform
Doob decomposition under constraints in Section 9.2. The appropriate upper Snell
envelopes are analyzed in Section 9.3. In Section 9.4 we derive a superhedging duality
under constraints, and we explain its role in the analysis of convex risk measures in a
ï¬nancial market model.
9.1 Absence of arbitrage opportunities
In practice, it may be reasonable to restrict the class of trading strategies which are
admissible for hedging purposes. As discussed in Section 4.8, there may be upper
bounds on the capital invested into risky assets, or upper and lower bounds on the
number of shares of an asset. Here we model such portfolio constraints by a set S of
d-dimensional predictable processes, viewed as admissible investment strategies into
risky assets. Throughout this chapter, we will assume that S satisï¬es the following
conditions:
(a) 0 âˆˆS.
(b) S is predictably convex: If Î¾, Î· âˆˆS and h is a predictable process with
0 â‰¤h â‰¤1, then the process
ht Î¾t + (1 âˆ’ht) Î·t,
t = 1, . . . , T,
belongs to S.
(c) For each t âˆˆ{1, . . . , T }, the set
St := { Î¾t | Î¾ âˆˆS }
is closed in L0(, Ftâˆ’1, P; Rd).
(d) For all t, Î¾t âˆˆSt implies Î¾âŠ¥
t
âˆˆSt.

9.1 Absence of arbitrage opportunities
351
In order to explain condition (d), let us recall from Lemma 1.65 that each Î¾t âˆˆ
L0(, Ftâˆ’1, P ; Rd) can be uniquely decomposed as
Î¾t = Î·t + Î¾âŠ¥
t ,
where Î·t âˆˆNt and Î¾âŠ¥
t
âˆˆNâŠ¥
t ,
and where
Nt =

Î·t âˆˆL0(, Ftâˆ’1, P; Rd) | Î·t Â· (Xt âˆ’Xtâˆ’1) = 0 P -a.s.

,
NâŠ¥
t
=

Î¾t âˆˆL0(, Ftâˆ’1, P; Rd) | Î¾t Â· Î·t = 0 P -a.s. for all Î·t âˆˆNt

.
Remark 9.1. Under condition (d), we may replace Î¾t Â·(Xt âˆ’Xtâˆ’1) by Î¾âŠ¥
t Â·(Xt âˆ’Xtâˆ’1),
and Î¾âŠ¥
t Â· (Xt âˆ’Xtâˆ’1) = 0 P -a.s. implies Î¾âŠ¥
t
= 0. Note that condition (d) holds if
the price increments satisfy the following non-redundance condition: For all t âˆˆ
{1, . . . , T } and Î¾t âˆˆL0(, Ftâˆ’1, P; Rd),
Î¾t Â· (Xt âˆ’Xtâˆ’1) = 0 P -a.s.
"â‡’
Î¾t = 0 P -a.s.
(9.1)
â™¦
Example 9.2. For each t let Ct be a closed convex subset of Rd such that 0 âˆˆCt. Take
S as the class of all d-dimensional predictable processes Î¾ such that Î¾t âˆˆCt P -a.s.
for all t. If the non-redundance condition (9.1) holds, then S satisï¬es conditions (a)
through (d). This case includes short sales constraints and restrictions on the size of
a long position.
â™¦
Example 9.3. Let a, b be two constants such that âˆ’âˆâ‰¤a < 0 < b â‰¤âˆ, and take
S as the set of all d-dimensional predictable processes such that
a â‰¤Î¾t Â· Xtâˆ’1 â‰¤b
P-a.s. for t = 1, . . . , T .
This class S corresponds to constraints on the capital invested into risky assets. If
we assume that the non-redundance condition (9.1) holds, then S satisï¬es conditions
(a) through (d). More generally, instead of the two constants a and b, one can take
dynamic margins deï¬ned via two predictable processes (at) and (bt).
â™¦
Let S denote the set of all self-ï¬nancing trading strategies Î¾ = (Î¾0, Î¾) which arise
from an investment strategy Î¾ âˆˆS, i.e.,
S =

Î¾ = (Î¾0, Î¾) | Î¾ is self-ï¬nancing and Î¾ âˆˆS

.
In this section, our goal is to characterize the absence of arbitrage opportunities in S.
The existence of an equivalent martingale measure P âˆ—âˆˆP is clearly sufï¬cient. A
condition which is both necessary and sufï¬cient will involve a larger class PS âŠƒP .
In order to introduce this condition, we need some preparation.

352
9 Hedging under constraints
Deï¬nition 9.4. An adapted stochastic process Z on (, F , (Ft), Q) is called a local
Q-martingale if there exists a sequence of stopping times (Ï„n)nâˆˆN âŠ‚T such that
Ï„n â†—T Q-a.s., and such that the stopped processes ZÏ„n are Q-martingales. The
sequence (Ï„n)nâˆˆN is called a localizing sequence for Z. In the same way, we deï¬ne
local supermartingales and local submartingales.
Remark 9.5. If Q is a martingale measure for the discounted price process X, then
the value process V of each self-ï¬nancing trading strategy Î¾ = (Î¾0, Î¾) is a local
Q-martingale. To prove this, one can take the sequence
Ï„n := inf

t â‰¥0 | |Î¾t+1| > n

âˆ§T
as a localizing sequence. With this choice, |Î¾t| â‰¤n on {Ï„n â‰¥t}, and the increments
V Ï„n
t
âˆ’V Ï„n
tâˆ’1 = I{Ï„nâ‰¥t} Î¾t Â· (Xt âˆ’Xtâˆ’1),
t = 1, . . . , T,
of the stopped process V Ï„n are Q-integrable and satisfy
EQ[ V Ï„n
t
âˆ’V Ï„n
tâˆ’1 | Ftâˆ’1 ] = I{Ï„nâ‰¥t} Î¾t Â· EQ[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] = 0.
â™¦
Thefollowingpropositionisageneralizationofanargumentwhichwehavealready
used in the proof of Theorem 5.26. Throughout this chapter, we will assume that
F0 = {âˆ…, } and FT = F .
Proposition 9.6. A local Q-supermartingale Z whose negative part Zâˆ’
t is integrable
for each t âˆˆ{1, . . . , T } is a Q-supermartingale.
Proof. Let (Ï„n) be a localizing sequence. Then
ZÏ„n
t
â‰¥âˆ’
T

s=0
Zâˆ’
s âˆˆL1(Q).
In view of limn ZÏ„n
t
= Zt, Fatouâ€™s lemma for conditional expectations implies that
Q-a.s.
EQ[ Zt | Ftâˆ’1 ] â‰¤lim inf
nâ†‘âˆEQ[ ZÏ„n
t
| Ftâˆ’1 ] â‰¤lim inf
nâ†‘âˆZÏ„n
tâˆ’1 = Ztâˆ’1.
We get in particular that EQ[ Zt ] â‰¤Z0 < âˆ. Thus Zt âˆˆL1(Q), and the assertion
follows.
Deï¬nition 9.7. By PS we denote the class of all probability measures 
P â‰ˆP such
that
Xt âˆˆL1(
P )
for all t,
(9.2)
andsuchthatthevalueprocessofanytradingstrategyinS isalocal 
P -supermartingale.

9.1 Absence of arbitrage opportunities
353
Remark 9.8. If S contains all self-ï¬nancing trading strategies Î¾ = (Î¾0, Î¾) with
bounded Î¾, then PS coincides with the class P of all equivalent martingale mea-
sures. To prove this, let 
P âˆˆPS, and note that the value process V of any such Î¾ is a

P-supermartingale by (9.2) and by Proposition 9.6. The same applies to the strategy
âˆ’Î¾, so V is in fact a 
P -martingale, and Theorem 5.15 shows that 
P is a martingale
measure for X.
â™¦
The following result extends the â€œfundamental theorem of asset pricingâ€ to our
present setting; see Theorem 5.17.
Theorem 9.9. There are no arbitrage opportunities in S if and only if PS is non-
empty. In this case, there exists a measure 
P âˆˆPS which has a bounded density
d 
P /dP .
We will ï¬rst show that the condition PS Ì¸= âˆ…implies the absence of arbitrage
opportunities in S:
Proof of sufï¬ciency. Suppose 
P is a measure in PS, and V is the value process of
a trading strategy in S such that VT â‰¥0 P -almost surely. Combining Lemma 9.10
below with Proposition 9.6 shows that V is a 
P -supermartingale. Hence V0 â‰¥
E[ VT ],
so V cannot be the value process of an arbitrage opportunity.
Lemma 9.10. Suppose that PS Ì¸= âˆ…and that V is the value process of a trading
strategy in S such that VT â‰¥0 P -almost surely. Then Vt â‰¥0 P -a.s. for all t.
Proof. The assertion will be proved by backward induction on t. We have VT â‰¥0
by assumption, so let us assume that Vt â‰¥0 P -a.s. for some t. For Î¾ = (Î¾0, Î¾) âˆˆS
with value process V , we let Î¾(c)
s
:= Î¾s I{|Î¾s|â‰¤c} for c > 0 and for all s. Then the value
process V (c) of Î¾(c) is a 
P -supermartingale for any ï¬xed 
P âˆˆPS. Furthermore,
Vtâˆ’1 I{|Î¾t|â‰¤c} = Vt I{|Î¾t|â‰¤c} âˆ’Î¾(c)
t
Â· (Xt âˆ’Xtâˆ’1)
â‰¥âˆ’Î¾(c)
t
Â· (Xt âˆ’Xtâˆ’1)
= V (c)
tâˆ’1 âˆ’V (c)
t
.
The last term on the right belongs to L1(
P ), so we may take the conditional expectation

E[ Â· | Ftâˆ’1 ] on both sides of the inequality. We get
Vtâˆ’1 I{|Î¾t|â‰¤c} â‰¥
E[ V (c)
tâˆ’1 âˆ’V (c)
t
| Ftâˆ’1 ] â‰¥0

P -a.s.
By letting c â†‘âˆ, we obtain Vtâˆ’1 â‰¥0.
Let us now prepare for the proof that the condition PS Ì¸= âˆ…is necessary. First we
show that the absence of arbitrage opportunities in S is equivalent to the absence of

354
9 Hedging under constraints
arbitrage opportunities in each of the embedded one-period models, i.e., to the non-
existence of Î¾t âˆˆSt such that Î¾t Â· (Xt âˆ’Xtâˆ’1) amounts to a non-trivial positive gain.
This observation will allow us to apply the techniques of Section 1.6. Let us denote
Sâˆ:= { Î¾ âˆˆS | Î¾ is bounded }.
Similarly, we deï¬ne
Sâˆ
t
:= { Î¾t | Î¾ âˆˆSâˆ} = St âˆ©Lâˆ(, Ftâˆ’1, P ; Rd).
Lemma 9.11. The following conditions are equivalent:
(a) There exists an arbitrage opportunity in S.
(b) There exist t âˆˆ{1, . . . , T } and Î¾t âˆˆSt such that
Î¾t Â· (Xt âˆ’Xtâˆ’1) â‰¥0 P -a.s.,
and
P [ Î¾t Â· (Xt âˆ’Xtâˆ’1) > 0 ] > 0.
(9.3)
(c) There exist t âˆˆ{1, . . . , T } and Î¾t âˆˆSâˆ
t
which satisï¬es (9.3).
Proof. The proof is essentially the same as the one of Proposition 5.11.
In order to apply the results of Section 1.6, we introduce the convex sets
KS
t :=

Î¾t Â· (Xt âˆ’Xtâˆ’1) | Î¾t âˆˆSt

,
for t âˆˆ{1, . . . , T }. Lemma 9.11 shows that S contains no arbitrage opportunities if
and only if the condition
KS
t âˆ©L0
+ = {0}
(9.4)
holds for all t âˆˆ{1, . . . , T }.
Lemma 9.12. Condition (9.4) implies that KS
t âˆ’L0
+(, Ft, P ) is a closed convex
subset of L0(, Ft, P).
Proof. The proof is essentially the same as the one of Lemma 1.67. Only the following
additional observation is required: If (Î¾n) is sequence in St, and if Î± and Ïƒ are two
Ftâˆ’1-measurable random variables such that 0 â‰¤Î± â‰¤1 and Ïƒ is integer-valued, then
Î¶ := Î±Î¾Ïƒ âˆˆSt. Indeed, predictable convexity of S implies that
Î±
n

k=1
I{Ïƒ=k}Î¾k âˆˆSt
for each n, and the closedness of St in L0(, Ftâˆ’1, P ; Rd) yields
Î¶ = Î±
âˆ

k=1
I{Ïƒ=k}Î¾k âˆˆSt.

9.1 Absence of arbitrage opportunities
355
From now on, we will assume that
E[ |Xs| ] < âˆ
for all s.
(9.5)
For the purpose of provingTheorem 9.9, this can be assumed without loss of generality:
If (9.5) does not hold, then we replace P by an equivalent measure P â€² which has a
bounded density dP â€²/dP and for which the price process X is integrable. For instance,
we can take
dP â€² = c exp
 
âˆ’
T

s=1
|Xs|
!
dP,
where c denotes the normalizing constant. If there exist a measure 
P â‰ˆP â€² such that
each value process for a strategy in S is a local 
P -supermartingale and such that the
density d 
P /dP â€² is bounded, then 
P âˆˆPS, and the density d 
P /dP is bounded as
well.
Lemma 9.13. If S contains no arbitrage opportunities, then for each t âˆˆ{1, . . . , T }
there exists some Zt âˆˆLâˆ(, Ft, P) such that Zt > 0 P -a.s. and such that
E[ Zt Î¾t Â· (Xt âˆ’Xtâˆ’1) ] â‰¤0
for all Î¾ âˆˆSâˆ.
(9.6)
Proof. Consider the positive cone
R := { Î» Î¾ | Î¾ âˆˆS, Î» â‰¥0 }
generated by S. Accordingly, we deï¬ne the cones R, Rt, and KR
t . Clearly, R does
not contain arbitrage opportunities if and only if S is arbitrage-free. Hence, for each t
KR
t
âˆ©L0
+(, Ft, P ) = {0}
(9.7)
by Lemma 9.11. Thus, Lemma 9.12 implies that each
CR
t
:=

KR
t
âˆ’L0
+(, FT , P )

âˆ©L1
is a closed convex cone in L1 which contains âˆ’L0
+(, Ft, P ). Furthermore, it follows
from (9.7) that CR
t
âˆ©L0
+ = {0}, so CR
t
satisï¬es the assumptions of the Krepsâ€“
Yan theorem, which is stated in Theorem 1.61. We conclude that there exist Zt âˆˆ
Lâˆ(, Ft, P) such that P [ Zt > 0 ] = 1, and such that E[ Zt W ] â‰¤0 for each
W âˆˆCR
t . As Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆˆCR
t
for each Î¾ âˆˆSâˆ, Zt has property (9.6).
Now we can complete the proof of Theorem 9.9 by showing that the absence of
arbitrage opportunities in S implies the existence of a measure 
P that belongs to the
class PS and has a bounded density d 
P /dP.
Proof of necessity in Theorem 9.9. Suppose that S does not contain arbitrage opportu-
nities. We are going to construct the desired measure 
P via backward recursion. First

356
9 Hedging under constraints
we consider the case t = T . Take a bounded random variable ZT > 0 as constructed
in Lemma 9.13, and deï¬ne a probability measure 
PT by
d 
PT
dP =
ZT
E[ ZT ].
Clearly, 
PT is equivalent to P , and Xt âˆˆL1(
PT ) for all t. We claim that

ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ] â‰¤0
for all Î¾ âˆˆSâˆ.
(9.8)
To prove this claim, consider the family
 :=
 
ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ] | Î¾ âˆˆSâˆ
.
For Î¾,Î¾ âˆˆSâˆ, let
A :=
 
ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ] > 
ET [Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ]

,
and deï¬ne Î¾â€² by Î¾â€²
t = 0 for t < T and
Î¾â€²
T := Î¾T IA +Î¾T IAc .
The predictable convexity of S implies that Î¾â€² âˆˆSâˆ. Furthermore, we have

ET [ Î¾â€²
T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ]
= 
ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ] âˆ¨
ET [Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ].
Hence, the family  is directed upwards in the sense of Theorem A.32. By virtue
of that theorem, ess sup  is the increasing limit of a sequence in . By monotone
convergence, we get

ET

ess sup
Î¾âˆˆSâˆ

ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ]

= sup
Î¾âˆˆSâˆ

ET
 
ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ]

=
1
E[ ZT ] sup
Î¾âˆˆSâˆE[ Î¾T Â· (XT âˆ’XT âˆ’1) ZT ]
â‰¤0,
(9.9)
where we have used (9.6) in the last step. Since S contains 0, it follows that
ess sup
Î¾âˆˆSâˆ

ET [ Î¾T Â· (XT âˆ’XT âˆ’1) | FT âˆ’1 ] = 0

PT -a.s.,
which yields our claim (9.8).

9.2 Uniform Doob decomposition
357
Now we apply the previous argument inductively: Suppose we already have a
probability measure 
Pt+1 â‰ˆP with a bounded density d 
Pt+1/dP such that

Et+1[ |Xs| ] < âˆ
for all s,
and such that

Et+1[ Î¾k Â· (Xk âˆ’Xkâˆ’1) | Fkâˆ’1 ] â‰¤0
P -a.s. for k â‰¥t + 1 and Î¾ âˆˆSâˆ.
(9.10)
Then we may apply Lemma 9.13 with P replaced by 
Pt+1, and we get some strictly
positive Zt âˆˆLâˆ(, Ft, 
Pt+1) satisfying (9.6) with 
Pt+1 in place of P . We now
proceed as in the ï¬rst step by deï¬ning a probability measure 
Pt â‰ˆ
Pt+1 â‰ˆP as
d 
Pt
d 
Pt+1
=
Zt

Et+1[ Zt ]
.
Then 
Pt has bounded densities with respect to both 
Pt+1 and P .
In particular,

Et[ |Xs| ] < âˆfor all s. Moreover, the Ft-measurability of d 
Pt/d 
Pt+1 implies
that (9.10) is satisï¬ed for 
Pt replacing 
Pt+1. Repeating the arguments that led to (9.8)
yields

Et[ Î¾t Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ] â‰¤0
for all Î¾ âˆˆSâˆ.
After T steps, we arrive at the desired measure 
P := 
P1 âˆˆPS.
9.2 Uniform Doob decomposition
The goal of this section is to characterize those non-negative adapted processes U
which can be decomposed as
Ut = U0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) âˆ’Bt,
(9.11)
where the predictable d-dimensional process Î¾ belongs to S, and where B is an adapted
and increasing process such that B0 = 0. In the unconstrained case where S consists
of all strategies, we have seen in Section 7.2 that such a decomposition exists if and
only if U is a supermartingale under each equivalent martingale measure P âˆ—âˆˆP . In
our present context, a ï¬rst guess might be that the role of P is now played by PS. Since
each value process of a strategy in S is a local 
P -supermartingale for each 
P âˆˆPS,
any process U which has a decomposition (9.11) is also a local 
P -supermartingale for

P âˆˆPS. Thus, one might suspect that the latter property would also be sufï¬cient for
the existence of a decomposition (9.11). This, however, is not the case, as is illustrated
by the following simple example.

358
9 Hedging under constraints
Example 9.14. Consider a one-period market model with the riskless bond S0
0 â‰¡
S0
1 â‰¡1 and with one risky asset S1. We assume that S1
0 â‰¡1 and that S1
1 takes the
values S1
1(Ï‰âˆ’) = 1
2 and S1
1(Ï‰+) = 3
2 on  := {Ï‰âˆ’, Ï‰+}. We choose any measure
P on  which assigns positive mass to both Ï‰+ and Ï‰âˆ’. If we let S = [0, 1],
then a measure 
P belongs to PS if and only if 
P [ {Ï‰+} ] âˆˆ

0, 1
2

. Thus, for any
positive initial value U0, the process deï¬ned by U1(Ï‰âˆ’) := 0 and U1(Ï‰+) := 2U0 is a
PS-supermartingale. If U can be decomposed according to (9.11), then we must be
able to write
2U0 = U1(Ï‰+) = U0 + Î¾ Â·

S1
1(Ï‰+) âˆ’S1
0(Ï‰+)

âˆ’B1(Ï‰+)
for some B1(Ï‰+) â‰¥0. This requirement is equivalent to U0 â‰¤Î¾/2. Hence the
decomposition (9.11) fails for U0 > 1/2.
â™¦
The reason for the failure of the decomposition (9.11) for certain PS-supermar-
tingales is that PS does not reï¬‚ect the full structure of S; the deï¬nition of PS depends
only on the cone
{ Î» Î¾ | Î» > 0, Î¾ âˆˆS }
generated by S. In the approach we are going to present here, the structure of S will
be reï¬‚ected by a stochastic process which we associate to any measure Q â‰ªP :
Deï¬nition 9.15. For a measure Q â‰ªP , the upper variation process for S is the
increasing process AQ deï¬ned by
AQ
0 := 0
and
AQ
t+1 âˆ’AQ
t := ess sup
Î¾âˆˆS

Î¾t+1 Â·

EQ[ Xt+1 | Ft ] âˆ’Xt

for t = 0, . . . , T âˆ’1. By QS we denote the set of all Q â‰ˆP such that
EQ[ AQ
T ] < âˆ
and such that
EQ[ |Xt+1 âˆ’Xt| | Ft ] < âˆ
P -a.s. for all t.
Clearly, the upper variation process of any measure Q â‰ˆP satisï¬es
AQ
t+1 âˆ’AQ
t = ess sup
Î¾âˆˆSâˆ

Î¾t+1 Â·

EQ[ Xt+1 | Ft ] âˆ’Xt

,
where Sâˆare the bounded processes in S. Hence for Q âˆˆQS and Î¾ âˆˆSâˆ, the
condition EQ[ |Xt+1 âˆ’Xt| | Ft ] < âˆguarantees that
Î¾t+1 Â·

EQ[ Xt+1 | Ft ] âˆ’Xt

= EQ[ Î¾t+1 Â· (Xt+1 âˆ’Xt) | Ft ],
and it follows that
AQ
t+1 âˆ’AQ
t = ess sup
Î¾âˆˆSâˆEQ[ Î¾t+1 Â· (Xt+1 âˆ’Xt) | Ft ]
for Q âˆˆQS.
(9.12)

9.2 Uniform Doob decomposition
359
In particular, we have
A
P
T = 0
for 
P âˆˆPS,
(9.13)
which implies the inclusion
P âŠ‚PS âŠ‚QS.
(9.14)
Proposition 9.16. If Q âˆˆQS, and V is the value process of a trading strategy in S,
then V âˆ’AQ is a local Q-supermartingale.
Proof. Let V be the value process of Î¾ = (Î¾0, Î¾) âˆˆS. Denote by Ï„n(Ï‰) the ï¬rst time
t at which
|Î¾t+1(Ï‰)| > n
or
EQ

|Xt+1 âˆ’Xt| | Ft

(Ï‰) > n.
If such a t does not exist, let Ï„n(Ï‰) := T . Then Ï„n is a stopping time. Since
|V Ï„n
t+1 âˆ’V Ï„n
t | â‰¤I{Ï„nâ‰¥t+1}|Î¾t+1| Â· |Xt+1 âˆ’Xt| âˆˆL1(Q),
V Ï„n
t
belongs to L1(Q), and
EQ[ V Ï„n
t+1 âˆ’V Ï„n
t
| Ft ] = I{Ï„nâ‰¥t+1}Î¾t+1 Â·

EQ[ Xt+1 | Ft ] âˆ’Xt

â‰¤(AQ)Ï„n
t+1 âˆ’(AQ)Ï„n
t .
This proves that V Ï„n âˆ’(AQ)Ï„n is a Q-supermartingale.
Let us identify the class QS in some special cases.
Remark 9.17. IfSâˆconsistsofallboundedpredictableprocessesÎ¾ withnon-negative
components, then QS = PS. To prove this, take Q âˆˆQS, and note ï¬rst that AQ â‰¡0,
due to (9.12) and the fact that S is a cone. Thus, value processes of strategies in S are
local Q-supermartingales by Proposition 9.16. By taking Î¾ âˆˆS such that Î¾i
t â‰¡1 and
Î¾j
t â‰¡0 for j Ì¸= i, we get that Xi is a local Q-supermartingale, and Proposition 9.6
implies that Xi is a Q-supermartingale. In particular, Xi
t is Q-integrable, and we
conclude Q âˆˆPS.
â™¦
Remark 9.18. If Sâˆconsists of all bounded predictable processes Î¾, then QS = P .
This follows by combining Remarks 9.8 and 9.17.
â™¦
Example 9.19. Suppose our market model contains just one risky asset, and S consists
of all predictable processes Î¾ such that
at â‰¤Î¾t â‰¤bt
P -a.s. for all t,
where a and b are two given predictable processes with
âˆ’âˆ< at â‰¤0 â‰¤bt < âˆ
P -a.s.

360
9 Hedging under constraints
IfweassumeinadditionthatE[ |Xt+1âˆ’Xt| | Ft ] > 0P -a.s., thenthenon-redundance
condition (9.1) holds, and S satisï¬es the assumptions (a) through (d) stated at the
beginning of this chapter. If Q â‰ˆP is any probability measure such that
EQ

|Xt+1 âˆ’Xt| | Ft

< âˆ
P -a.s. for all t,
(9.15)
then
ess sup
Î¾âˆˆSâˆEQ[ Î¾t+1 Â· (Xt+1 âˆ’Xt) | Ft ]
= bt+1

EQ[ Xt+1 âˆ’Xt | Ft ]
+ âˆ’at+1

EQ[ Xt+1 âˆ’Xt | Ft ]
âˆ’
< âˆ
P -a.s.
Hence, QS consists of all measures Q â‰ˆP with (9.15).
â™¦
We now state the uniform Doob decomposition under constraints, which is the
main result of this section.
Theorem 9.20. Suppose that PS is non-empty. Then for any adapted process U with
UT â‰¥0 P -a.s., the following conditions are equivalent.
(a) U âˆ’AQ is a Q-supermartingale for every Q âˆˆQS.
(b) There exists Î¾ âˆˆS and an adapted increasing process B such that B0 = 0 and
Ut = U0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) âˆ’Bt
P -a.s. for all t.
Proof. (b) â‡’(a): Fix Q âˆˆQS. According to Proposition 9.16, the process
MQ
t
:= U0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1) âˆ’AQ
t
is a local Q-supermartingale. Since MQ
T + AQ
T â‰¥UT â‰¥0 P -a.s., we get from
Lemma 9.10 that the negative part of MQ
t
is bounded below by âˆ’AQ
t
âˆˆL1(Q). So
MQ is a Q-supermartingale by Proposition 9.6. Since
MQ
T â‰¥MQ
T âˆ’BT = UT âˆ’AQ
T â‰¥âˆ’AQ
T
P -a.s.,
and since B is increasing, each Bt belongs to L1(Q), and M âˆ’B = U âˆ’AQ is a
Q-supermartingale.
(a) â‡’(b): We must show that for any given t âˆˆ{1, . . . , T } there exist some
Î¾ âˆˆS and a non-negative random variable Rt playing the role of Bt âˆ’Btâˆ’1 such that
Ut âˆ’Utâˆ’1 = Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆ’Rt, i.e.,
Ut âˆ’Utâˆ’1 âˆˆKS
t âˆ’L0
+(, Ft, P ),

9.2 Uniform Doob decomposition
361
where
KS
t = { Î¾t Â· (Xt âˆ’Xtâˆ’1) | Î¾ âˆˆS }.
The formulation of this problem does not change if we switch from P to any equivalent
probability measure, so we can assume without loss of generality that P âˆˆPS. In
this case AP â‰¡0, and U is a P -supermartingale. In particular, Us âˆˆL1(P ) for all s.
We assume by way of contradiction that
Ut âˆ’Utâˆ’1 /âˆˆCS
t =

KS
t âˆ’L0
+(, Ft, P )

âˆ©L1(P ).
(9.16)
Recall that we have proved in Lemma 9.12 that CS
t is a closed convex subset of
L1(, Ft, P). The Hahnâ€“Banach separation theorem, Theorem A.56, now implies
the existence of a random variable Z âˆˆLâˆ(, Ft, P ) such that
Î± := sup
WâˆˆCS
t
E[ Z W ] < E[ Z (Ut âˆ’Utâˆ’1) ] =: Î² < âˆ.
(9.17)
Note that the function âˆ’Î»I{Z<0} belongs to CS
t for all Î» â‰¥0. Thus
0 â‰¤(âˆ’Î») E

Z I{Z<0}

â‰¤Î±
for every Î» â‰¥0, and it follows that Z â‰¥0 P -almost surely.
In fact, we can always modify Z such that it is bounded below by some Îµ > 0 and
still satisï¬es (9.17). To see this, note ï¬rst that every W âˆˆCS
t is dominated by some
Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆˆKS
t with integrable negative part. Therefore
E[ W ] â‰¤E[ Î¾t Â· (Xt âˆ’Xtâˆ’1) ] â‰¤lim inf
câ†‘âˆE

Î¾t Â· (Xt âˆ’Xtâˆ’1)I{|Î¾t|â‰¤c}

â‰¤0,
where we have used our assumption that P âˆˆPS. If we let ZÎµ := Îµ 1 + (1 âˆ’Îµ)Z,
then ZÎµ still satisï¬es E[ ZÎµ W ] â‰¤0 for all W âˆˆCS
t , and for Îµ small enough, the
expectation E[ ZÎµ (Ut âˆ’Utâˆ’1) ] is still larger than Î±. So ZÎµ also satisï¬es (9.17).
Therefore, we may assume from now on that our Z with (9.17) is bounded below by
some constant Îµ > 0.
For the next step, let Ztâˆ’1 := E[ Z | Ftâˆ’1 ] and
dQ
dP :=
Z
Ztâˆ’1
.
Since this density is bounded and since P âˆˆPS, we get
EQ

|Xs âˆ’Xsâˆ’1| | Fsâˆ’1

< âˆ
P -a.s. for all s.
(9.18)
Moreover, it is not difï¬cult to check that
EQ[ Î¾sÂ·(Xsâˆ’Xsâˆ’1) | Fsâˆ’1 ] = E[ Î¾sÂ·(Xsâˆ’Xsâˆ’1) | Fsâˆ’1 ] â‰¤0
for s Ì¸= t; (9.19)

362
9 Hedging under constraints
see the proof of Theorem 7.5 for details. We now consider the case s = t. As we have
seen in the proof of Theorem 9.9, the family

EQ[ Î¾t Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ] | Î¾ âˆˆS

is directed upwards. Therefore, we may conclude as in (9.9) that
EQ

Ztâˆ’1 ess sup
Î¾âˆˆS
EQ[ Î¾t Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ]

= sup
Î¾âˆˆS
E[ Î¾t Â· (Xt âˆ’Xtâˆ’1) Z ]
(9.20)
â‰¤Î±.
Since Ztâˆ’1 â‰¥Îµ, (9.20) implies that
EQ

AQ
t âˆ’AQ
tâˆ’1

= EQ

ess sup
Î¾âˆˆS
EQ[ Î¾t Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ]

â‰¤Î±
Îµ .
By (9.19) we may conclude that EQ[ AQ
T ] â‰¤Î±/Îµ, and so (9.18) yields Q âˆˆQS.
As a ï¬nal step, we show that U âˆ’AQ cannot be a Q-supermartingale, thus leading
our assumption (9.16) to a contradiction with our hypothesis (a). To this end, we use
again (9.20):
EQ

Ztâˆ’1 EQ[ Ut âˆ’Utâˆ’1 | Ftâˆ’1 ]

= EQ[ Ztâˆ’1 (Ut âˆ’Utâˆ’1) ]
= E[ Z (Ut âˆ’Utâˆ’1) ] = Î²
> Î±
â‰¥EQ

Ztâˆ’1 ess sup
Î¾âˆˆS
EQ[ Î¾t Â· (Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ]

= EQ

Ztâˆ’1 (AQ
t âˆ’AQ
tâˆ’1)

.
Thus, we cannot have
EQ[ Ut âˆ’Utâˆ’1 | Ftâˆ’1 ] â‰¤AQ
t âˆ’AQ
tâˆ’1
P -a.s.,
so U âˆ’AQ cannot be a Q-supermartingale, in contradiction to our hypothesis (a).
9.3 Upper Snell envelopes
From now on, we assume that S does not contain arbitrage opportunities, which is
equivalent to the condition PS Ì¸= âˆ…. Let H be a discounted American claim. Our
goal is to construct a superhedging strategy for H that belongs to our class S of

9.3 Upper Snell envelopes
363
admissible strategies. The uniform Doob decomposition suggests that we should
ï¬nd an adapted process U â‰¥H such that U âˆ’AQ is a Q-supermartingale for each
Q âˆˆQS. If we consider only one such Q, then the minimal process U which satisï¬es
these requirements is given by 
UQ + AQ, where

UQ
t
:= ess sup
Ï„âˆˆTt
EQ[ HÏ„ âˆ’AQ
Ï„ | Ft ]
t = 0, . . . , T,
(9.21)
is the Snell envelope of H âˆ’AQ with respect to Q. Thus, one may guess that
ess sup
QâˆˆQS
(
UQ
t
+ AQ
t ),
t = 0, . . . , T,
is the minimal process U which dominates H and for which U âˆ’AQ is a Q-
supermartingale for each Q âˆˆQS. Let us assume that
sup
QâˆˆQS

UQ
0 = sup
QâˆˆQS
sup
Ï„âˆˆT
EQ[ HÏ„ âˆ’AQ
Ï„ ] < âˆ.
Note that this condition holds if H is bounded.
Deï¬nition 9.21. The process

Uâ†‘
t := ess sup
QâˆˆQS

AQ
t + 
UQ
t

= ess sup
QâˆˆQS

AQ
t + ess sup
Ï„âˆˆTt
EQ[ HÏ„ âˆ’AQ
Ï„ | Ft ]

,
t = 0, . . . , T,
will be called the upper QS-Snell envelope of H.
The main result of this section conï¬rms our guess that 
Uâ†‘is the process we are
looking for.
Theorem 9.22. The upper QS-Snell envelope of H is the smallest process U â‰¥H
such that U âˆ’AQ is a Q-supermartingale for each Q âˆˆQS.
For a European claim, we have the following additional result.
Proposition 9.23. For a discounted European claim H E with
sup
QâˆˆQS
EQ[ H E âˆ’AQ
T ] < âˆ,
the upper QS-Snell envelope takes the form

Uâ†‘
t = ess sup
QâˆˆQS

EQ[ H E âˆ’AQ
T | Ft ] + AQ
t

,
t = 0, . . . , T.

364
9 Hedging under constraints
Proposition 9.23 will follow from Lemma 9.28 below. The next result provides a
schemefortherecursivecalculationof 
Uâ†‘. ItwillbeusedintheproofofTheorem9.22.
Proposition 9.24. For ï¬xed Q0 âˆˆQS let Qt(Q0) denote the set of all Q âˆˆQS which
coincide with Q0 on Ft. Then 
Uâ†‘satisï¬es the following recursion formula:

Uâ†‘
t âˆ’AQ0
t
= (Ht âˆ’AQ0
t
) âˆ¨ess sup
QâˆˆQt(Q0)
EQ[ 
Uâ†‘
t+1 âˆ’AQ
t+1 | Ft ],
t = 0, . . . , T âˆ’1.
The proofs of this proposition and of Theorem 9.22 will be given at the end of this
section. LetusrecallthefollowingconceptsfromSection6.4. Thepastingoftwoprob-
abilitymeasuresQ1 â‰ˆQ2 inastoppingtimeÏ„ âˆˆT = { Ïƒ | Ïƒ is a stopping time â‰¤T }
is the probability measure

Q[ A ] = EQ1

Q2[ A | FÏ„ ]

,
A âˆˆF .
It was shown in Lemma 6.43 that, for all stopping times Ïƒ and FT -measurable Y â‰¥0,
E
Q[ Y | FÏƒ ] = EQ1

EQ2[ Y | FÏ„âˆ¨Ïƒ ] | FÏƒ

.
(9.22)
Recall also that a set Q of equivalent probability measures on (, F ) is called stable
if for any pair Q1, Q2 âˆˆQ and all Ï„ âˆˆT the corresponding pasting also belongs
to Q. A technical inconvenience arises from the fact that our set QS may not be
stable. We must introduce a further condition on Ï„ which guarantees that the pasting
of Q1, Q2 âˆˆQS in Ï„ also belongs to QS.
Lemma 9.25. For Ï„ âˆˆT , the pasting 
Q of Q1, Q2 âˆˆQS in Ï„ satisï¬es
E
Q[ |Xt+1 âˆ’Xt| | Ft ] < âˆ
P -a.s.,
and its upper variation process is given by
A

Q
t = AQ1
tâˆ§Ï„ + (AQ2
t
âˆ’AQ2
Ï„ ) Â· I{Ï„<t}.
Moreover, we have 
Q âˆˆQS under the condition that there exists Îµ > 0 such that
dQ2
dQ1

FÏ„
â‰¥Îµ a.s. on {Ï„ < T }.
(9.23)
Proof. The identity (9.22) yields
E
Q[ |Xt+1âˆ’Xt| | Ft ] = EQ1[ |Xt+1âˆ’Xt| | Ft ]I{Ï„>t}+EQ2[ |Xt+1âˆ’Xt| | Ft ]I{Ï„â‰¤t},
and each of the two conditional expectations is ï¬nite almost surely.
Now we will compute the upper variation process A
Q of 
Q. As above, (9.22)
yields
E
Q[ Î¾t Â· (Xt+1 âˆ’Xt) | Ft ]
= EQ1[ Î¾t Â· (Xt+1 âˆ’Xt) | Ft ]I{Ï„>t} + EQ2[ Î¾t Â· (Xt+1 âˆ’Xt) | Ft ]I{Ï„â‰¤t}.

9.3 Upper Snell envelopes
365
Taking the essential supremum over Î¾t âˆˆSâˆ
t
gives
A

Q
t+1 âˆ’A

Q
t = (AQ1
t+1 âˆ’AQ1
t
)I{Ï„>t} + (AQ2
t+1 âˆ’AQ2
t
)I{Ï„â‰¤t},
and from this our formula for A

Q
t follows.
In a ï¬nal step, we show that 
Q belongs to QS under condition (9.23). We must
show that E
Q[ A

Q
T ] < âˆ. Let Zt denote the density of Q2 with respect to Q1 on Ft.
Then, by our formula for A

Q
T ,
E
Q[ A

Q
T ] = E
Q[ AQ1
Ï„
+ AQ2
T
âˆ’AQ2
Ï„
]
= EQ1[ AQ1
Ï„
+ EQ2[ AQ2
T
âˆ’AQ2
Ï„
| FÏ„ ] ]
â‰¤EQ1[ AQ1
T
] + EQ1
 1
ZÏ„
EQ1[ (AQ2
T
âˆ’AQ2
Ï„ ) ZT | FÏ„ ]
!
â‰¤EQ1[ AQ1
T
] + 1
Îµ EQ2[ AQ2
T
],
which is ï¬nite for Q1, Q2 âˆˆQS.
Lemma 9.26. Suppose we are given Q1, Q2 âˆˆQS, a stopping time Ï„ âˆˆT , and a set
B âˆˆFÏ„ such that dQ2/dQ1|FÏ„ â‰¥Îµ a.s. on B. Let 
Q be the pasting of Q1 and Q2 in
the stopping time
Ïƒ := Ï„IB + T IBc .
Then 
Q âˆˆQS, and the Snell envelopes associated with these three measures by (9.21)
are related as follows:

U 
Q
Ï„ + A
Q
Ï„ = (
UQ1
Ï„
+ AQ1
Ï„ ) Â· IBc + (
UQ2
Ï„
+ AQ2
Ï„ ) Â· IB
P -a.s.
(9.24)
Proof. We have dQ2/dQ1|FÏƒ â‰¥Îµ, hence 
Q âˆˆQS follows from Lemma 9.25. Let
Ï be a stopping time in the set TÏ„ of all stopping times â‰¥Ï„. The formula for A
Q in
Lemma 9.25 yields
A
Q
Ï = AQ1
Ï„
+ (AQ1
Ï
âˆ’AQ1
Ï„ )IBc + (AQ2
Ï
âˆ’AQ2
Ï„ )IB .
Moreover, (9.22) implies that
E
Q[ Y | FÏ„ ] = EQ1[ Y | FÏ„ ]IBc + EQ2[ Y | FÏ„ ]IB
for all random variables Y such that all conditional expectations make sense. Hence,
E
Q[ HÏ âˆ’A
Q
Ï | FÏ„ ] + A
Q
Ï„
=

EQ1[ HÏ âˆ’AQ1
Ï
| FÏ„ ] + AQ1
Ï„

IBc +

EQ2[ HÏ âˆ’AQ2
Ï
| FÏ„ ] + AQ2
Ï„

IB .

366
9 Hedging under constraints
Whenever Ï1, Ï2 are stopping times in TÏ„, then Ï := Ï1 IBc +Ï2 IB is also a stopping
time in TÏ„. Conversely, every Ï âˆˆTÏ„ can be written in that way for stopping times
Ï1 and Ï2. Thus, taking the essential supremum over all Ï1 and Ï2 and applying
Proposition 6.38 yields (9.24).
In fact, we have A

Q
Ï„ = AQ1
Ï„
in (9.24), as we will have AQk
Ï„
= AQ0
Ï„
in the following
lemma.
Lemma 9.27. For any Q0 âˆˆQS, Ï„ âˆˆT , and Î´ > 0, there exist a set Î´ âˆˆFÏ„ such
that Q0[ Î´ ] â‰¥1 âˆ’Î´ and measures Qk âˆˆQS such that Qk = Q0 on FÏ„ and

UQk
Ï„
+ AQk
Ï„
â†—ess sup
QâˆˆQS
(
UQ
Ï„ + AQ
Ï„ ) = 
Uâ†‘
Ï„
P -a.s. on Î´.
Proof. By Theorem A.32 and its proof, there exists a sequence (Q0
n) âŠ‚QS such that
lim
kâ†‘âˆmax
nâ‰¤k

UQ0
n
Ï„
+ AQ0
n
Ï„

= 
Uâ†‘
Ï„
P -a.s.
We will recursively deï¬ne measures Qk âˆˆQS and sets k
Î´ âˆˆFÏ„ such that k
Î´ âŠ‚kâˆ’1
Î´
,
Q0[ k
Î´ ] â‰¥1 âˆ’(1 âˆ’2âˆ’k)Î´, and

UQk
Ï„
+ AQk
Ï„
= max
nâ‰¤k

UQ0
n
Ï„
+ AQ0
n
Ï„

P -a.s. on k
Î´.
By letting Î´ := 
k k
Î´, this will imply the ï¬rst part of the assertion. We start this
recursion in k = 0 by taking Q0 and 0
Î´ := .
For Qk given, the equivalence of Qk and Q0
k+1 implies that there exists some
Îµ > 0 such that the set
D :=
 dQ0
k+1
dQk

FÏ„
â‰¥Îµ

âˆˆFÏ„
satisï¬es Q0[ D ] â‰¥1 âˆ’2âˆ’(k+1) Î´. Thus, k+1
Î´
:= k
Î´ âˆ©D satisï¬es Q0[ k+1
Î´
] â‰¥
1 âˆ’(1 âˆ’2âˆ’(k+1))Î´. We now deï¬ne a set
B :=
$

U
Q0
k+1
Ï„
+ A
Q0
k+1
Ï„
> 
UQk
Ï„
+ AQk
Ï„
%
âˆ©D,
and consider the pasting Qk+1 of Qk and Q0
k+1 in the stopping time Ïƒ := Ï„IB +T IBc .
By Lemma 9.26, Qk+1 âˆˆQS and

UQk+1
Ï„
+ AQk+1
Ï„
=

UQk
Ï„
+ AQk
Ï„

Â· IBc +

U
Q0
k+1
Ï„
+ A
Q0
k+1
Ï„

Â· IB
P -a.s.
=

UQk
Ï„
+ AQk
Ï„

âˆ¨

U
Q0
k+1
Ï„
+ A
Q0
k+1
Ï„

P -a.s. on D
= max
nâ‰¤k+1

UQ0
n
Ï„
+ AQ0
n
Ï„

P -a.s. on k+1
Î´
.

9.3 Upper Snell envelopes
367
Now we can proceed to proving the main results in this section.
Proof of Proposition 9.24. For Q0 âˆˆQS and t âˆˆ{t, . . . , T }, Qt(Q0) denotes the set
of all Q âˆˆQS which coincide with Q0 on Ft. By Lemma 9.27 and by the deï¬nition
of 
UQ as the Snell envelope of H âˆ’AQ,

Uâ†‘
t âˆ’AQ0
t
= ess sup
QâˆˆQt(Q0)

UQ
t
= ess sup
QâˆˆQt(Q0)

(Ht âˆ’AQ
t ) âˆ¨EQ[ 
UQ
t+1 | Ft ]

= (Ht âˆ’AQ0
t
) âˆ¨ess sup
QâˆˆQt(Q0)
EQ[ 
UQ
t+1 | Ft ].
Since 
UQ
t+1 â‰¤
Uâ†‘
t+1 âˆ’AQ
t+1, we get

Uâ†‘
t âˆ’AQ0
t
â‰¤(Ht âˆ’AQ0
t
) âˆ¨ess sup
QâˆˆQt(Q0)
EQ[ 
Uâ†‘
t+1 âˆ’AQ
t+1 | Ft ].
(9.25)
For the proof of the converse inequality, let us ï¬x an arbitrary Q âˆˆQt(Q0). For
any Î´ > 0, Lemma 9.27 yields a set Î´ âˆˆFt+1 with measure Q[ Î´ ] â‰¥1 âˆ’Î´ and
Qk âˆˆQt+1(Q) such that 
UQk
t+1 â†—
Uâ†‘
t+1 âˆ’AQ
t+1 P -a.s. on Î´. Since Qk coincides
with Q on Ft+1, we have P -a.s. on Î´
EQ[ 
Uâ†‘
t+1 âˆ’AQ
t+1 | Ft ] = lim
kâ†‘âˆEQ[ 
UQk
t+1 | Ft ] = lim
kâ†‘âˆEQk[ 
UQk
t+1 | Ft ]
â‰¤lim sup
kâ†‘âˆ

UQk
t
â‰¤
ess sup

QâˆˆQt+1(Q)

U

Q
t
â‰¤ess sup

QâˆˆQt(Q)

U

Q
t
= 
Uâ†‘
t âˆ’AQ
t
= 
Uâ†‘
t âˆ’AQ0
t
By taking Î´ â†“0 and by recalling 
Uâ†‘
t â‰¥Ht, we arrive at the converse of the inequal-
ity (9.25).
Proof of Theorem 9.22.
Since Q0 âˆˆQS is obviously contained in Qt(Q0), the
recursion formula of Proposition 9.24 yields

Uâ†‘
t âˆ’AQ0
t
â‰¥(Ht âˆ’AQ0
t
) âˆ¨EQ0[ 
Uâ†‘
t+1 âˆ’AQ0
t+1 | Ft ] â‰¥EQ0[ 
Uâ†‘
t+1 âˆ’AQ0
t+1 | Ft ],
i.e., 
Uâ†‘
t âˆ’AQ0 is indeed a Q0-supermartingale for each Q0 âˆˆQS. We also know that

Uâ†‘dominates H.
Let U be any process which dominates H and for which U âˆ’AQ is a Q-
supermartingale for each Q âˆˆQS. For ï¬xed Q, the Q-supermartingale U âˆ’AQ

368
9 Hedging under constraints
dominates H âˆ’AQ and hence also 
UQ, since 
UQ is the smallest Q-supermartingale
dominating H âˆ’AQ by Proposition 6.11. It follows that
Ut â‰¥ess sup
QâˆˆQS

UQ
t
+ AQ
t

= 
Uâ†‘
t
P -a.s. for all t.
Proposition 9.23 we will be implied by taking Ï„ âˆ—â‰¡T in the following lemma.
Lemma 9.28. Let H be a discounted American claim whose payoff is zero if it is not
exercised at a given stopping time Ï„ âˆ—âˆˆT , i.e., Ht(Ï‰) = 0 if t Ì¸= Ï„ âˆ—(Ï‰). Then its
upper QS-Snell envelope is given by

Uâ†‘
t = I{Ï„ âˆ—â‰¥t} ess sup
QâˆˆQS

EQ[ HÏ„ âˆ—âˆ’AQ
Ï„ âˆ—| Ft ] + AQ
t

,
t = 0, . . . , T.
Proof. By deï¬nition,

Uâ†‘
t = ess sup
Ï„âˆˆTt
ess sup
QâˆˆQS

EQ[ HÏ„ âˆ’AQ
Ï„ | Ft ] + AQ
t

.
Since each process AQ is increasing, it is clearly optimal to take Ï„ = t on {Ï„ âˆ—â‰¤t}.
Hence,

Uâ†‘
t =

0
on {Ï„ âˆ—< t},
Ht
on {Ï„ âˆ—= t}.
So we have to show that choosing Ï„ â‰¡Ï„ âˆ—is optimal on {Ï„ âˆ—> t}. If Ïƒ âˆˆTt is a
stopping time with P [ Ïƒ > Ï„ âˆ—] > 0, then Ï„ := Ïƒ âˆ§Ï„ âˆ—is as least as good as Ïƒ, since
each process AQ is increasing. So it remains to exclude the case that there exists a
stopping time Ïƒ âˆˆTt with Ïƒ â‰¤Ï„ âˆ—on {Ï„ âˆ—> t} and P [ Ïƒ < Ï„ âˆ—] > 0, such that Ïƒ
yields a strictly better result than Ï„ âˆ—. In this case, there exists some Q1 âˆˆQS such
that
EQ1[ HÏƒ âˆ’AQ1
Ïƒ
| Ft ] + AQ1
t
> ess sup
QâˆˆQS

EQ[ HÏ„ âˆ—âˆ’AQ
Ï„ âˆ—| Ft ] + AQ
t

(9.26)
with strictly positive probability on {Ï„ âˆ—> t}. Take any 
P âˆˆPS and Îµ > 0, and deï¬ne
BÎµ :=
 d 
P
dQ1

FÏƒ
â‰¥Îµ

.
Now let QÎµ be the pasting Q1 and 
P in the stopping time ÏƒIBÎµ + T IBc
Îµ . Accord-
ing to Lemmas 9.25 and 9.26, QÎµ âˆˆQS, and its upper variation process satisï¬es
AQÎµ
t
= AQ1
t
and AQÎµ
Ïƒ
= AQ1
Ïƒ
as well as
AQÎµ
Ï„ âˆ—= AQ1
Ï„ âˆ—IBc
Îµ + AQ1
Ïƒ
IBÎµ
P -a.s. on {Ï„ âˆ—> t}.

9.4 Superhedging and risk measures
369
By using our assumption that HÏƒ â‰¤HÏ„ âˆ—, we get
EQ1[ HÏƒ âˆ’AQ1
Ïƒ
| Ft ] + AQ1
t
â‰¤EQÎµ[ HÏ„ âˆ—âˆ’AQÎµ
Ï„ âˆ—| Ft ] + AQÎµ
t
P -a.s. on BÎµ.
By letting Îµ â†“0, the P -measure of BÎµ becomes arbitrarily close to 1, and we arrive at
a contradiction to (9.26).
9.4 Superhedging and risk measures
Let H be a discounted American claim such that

Uâ†‘
0 = sup
QâˆˆQS

UQ
0 = sup
QâˆˆQS
sup
Ï„âˆˆT
EQ[ HÏ„ âˆ’AQ
Ï„ ] < âˆ.
Our aim in this section is to construct superhedging strategies for H which belong to
our set S of admissible trading strategies. Recall that a superhedging strategy for H
is any self-ï¬nancing trading strategy whose value process dominates H. If applied
with t = 0, the following theorem shows that 
Uâ†‘
0 is the minimal amount for which a
superhedging strategy is available.
Denote by 
Uâ†‘
t (H) the set of all Ft-measurable random variables Ut â‰¥0 for which
there exists some Î· âˆˆS such that
Ut +
u

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1) â‰¥Hu
for all u â‰¥t P -a.s.
(9.27)
Theorem 9.29. The upper QS-Snell envelope 
Uâ†‘
t of H is the minimal element of

Uâ†‘
t (H). More precisely,
(a) 
Uâ†‘
t âˆˆ
Uâ†‘
t (H),
(b) 
Uâ†‘
t = ess inf 
Uâ†‘
t (H).
Proof. The uniform Doob decomposition in Section 9.2 combined with Theorem 9.22
yields an increasing adapted process B and some Î¾ âˆˆS such that

Uâ†‘
u = 
Uâ†‘
t +
u

k=t+1
Î¾k Â· (Xk âˆ’Xkâˆ’1) + Bt âˆ’Bu
P -a.s. for u â‰¥t.
So the fact that 
Uâ†‘dominates H proves (a).
As to part (b), we ï¬rst get 
Uâ†‘
t
â‰¥ess inf 
Uâ†‘
t (H) from (a). For the proof of the
converse inequality, take Ut âˆˆ
Uâ†‘
t (H) and choose a predictable process Î· âˆˆS for

370
9 Hedging under constraints
which (9.27) holds. We must show that the set B := { 
Uâ†‘
t â‰¤Ut } satisï¬es P [ B ] = 1.
Let
Ë†Ut := 
Uâ†‘
t âˆ§Ut = 
Uâ†‘
t Â· IB + Ut Â· IBc .
Then Ë†Ut â‰¤
Uâ†‘
t , and our claim will follow if we can show that Uâ†‘
t
â‰¤Ë†Ut. Let Î¾
denote the predictable process obtained from the uniform Doob decomposition of the
P -supermartingale 
Uâ†‘, and deï¬ne
Ë†Î¾s :=

Î¾s
if s â‰¤t,
Î¾s Â· IB + Î·s Â· IBc
if s > t.
With this choice, Ë†Î¾ âˆˆS by predictable convexity, and Ë†Ut satisï¬es (9.27), i.e.,
Ë†Ut âˆˆ
Uâ†‘
t (H). Let
Ë†Vs := 
Uâ†‘
0 +
s

k=1
Ë†Î¾k Â· (Xk âˆ’Xkâˆ’1).
Then Ë†Vs â‰¥Hs â‰¥0 for all s, and so Ë†V âˆ’AQ is a Q-supermartingale for each Q âˆˆQS
by Propositions 9.16 and 9.6. Hence,

Uâ†‘
t = ess sup
QâˆˆQS
ess sup
Ï„âˆˆTt
EQ[ HÏ„ âˆ’AQ
Ï„ + AQ
t | Ft ]
â‰¤ess sup
Q, Ï„
EQ
 
Ë†Ut +
Ï„

k=t+1
Ë†Î¾k Â· (Xk âˆ’Xkâˆ’1) âˆ’AQ
Ï„ + AQ
t
 Ft
!
â‰¤Ë†Ut.
This proves 
Uâ†‘
t â‰¤ess inf 
Uâ†‘
t (H).
For European claims, the upper QS-Snell envelope takes the form

Uâ†‘
t = ess sup
QâˆˆQS

EQ[ H E âˆ’AQ
T | Ft ] + AQ
t

,
t = 0, . . . , T.
By taking t = 0, it follows that

Uâ†‘
0 = sup
QâˆˆQS

EQ[ H E ] âˆ’EQ[ AQ
T ]

(9.28)
is the smallest initial investment which sufï¬ces for superhedging the claim H E. In
fact, the formula above can be regarded as a special case of the representation theorem
for convex measures of risk in our ï¬nancial market model. This will be explained next.
Let us take Lâˆ:= Lâˆ(, F , P) as the space of all ï¬nancial positions. A position
Y âˆˆLâˆwill be regarded as acceptable if it can be hedged with a strategy in S at no
additional cost. Thus, we introduce the acceptance set
AS :=
$
Y âˆˆLâˆ âˆƒÎ¾ âˆˆS : Y +
T

t=1
Î¾t Â· (Xt âˆ’Xtâˆ’1) â‰¥0 P -a.s.
%
.

9.4 Superhedging and risk measures
371
Due to the convexity of S, this set AS is convex, and under the mild condition
inf{ m âˆˆR | m âˆˆAS } > âˆ’âˆ,
(9.29)
AS induces a convex measure of risk ÏS := ÏAS via
ÏS(Y) := inf{ m âˆˆR | m + Y âˆˆAS } ;
see Section 4.1. Note that condition (9.29) holds in particular if S does not contain
arbitrage opportunities. In this case, we have in fact
ÏS(0) = inf{ m âˆˆR | m âˆˆAS } = 0,
i.e., ÏS is normalized. The main results of this chapter can be restated in terms of ÏS:
Corollary 9.30. The following conditions are equivalent:
(a) ÏS is sensitive.
(b) S contains no arbitrage opportunities.
(c) PS Ì¸= âˆ….
If these equivalent conditions hold, then
ÏS(Y) = sup
QâˆˆQS

EQ[ âˆ’Y ] âˆ’EQ[ AQ
T ]

,
Y âˆˆLâˆ.
(9.30)
In other words, ÏS can be represented in terms of the penalty function
Î±(Q) =

EQ[ AQ
T ]
if Q âˆˆQS,
+âˆ
otherwise.
Proof. That (a) implies (b) is obvious. The equivalence between (b) and (c) was shown
in Theorem 9.9. Since both sides of (9.30) are cash invariant, it sufï¬ces to prove (9.30)
for Y â‰¤0. But then the representation for ÏS is just a special case of the superhedging
duality (9.28). Finally, (9.30) and (c) imply that ÏS(X) â‰¥sup
P âˆˆPS 
E[ âˆ’X ], and the
sensitivity of ÏS follows.

Chapter 10
Minimizing the hedging error
In this chapter, we present an alternative approach to the problem of hedging in an
incomplete market model. Instead of controlling the downside risk, we simply aim at
minimizing the quadratic hedging error. We begin with a local version of the minimiza-
tion problem, which may be viewed as a sequential regression procedure. Its solution
involves an orthogonal decomposition of a given contingent claim; this extends a
classical decomposition theorem for martingales known as the Kunitaâ€“Watanabe de-
composition. Often, the value process generated by a locally risk-minimizing strategy
can be described as the martingale of conditional expectations of the given contin-
gent claim for a special choice of an equivalent martingale measure. Such â€œminimalâ€
martingale measures will be studied in Section 10.2. In Section 10.3, we investigate
the connection between local risk minimization and the problem of variance-optimal
hedging where one tries to minimize the global quadratic hedging error. The local and
the global versions coincide if the underlying measure is itself a martingale measure.
10.1 Local quadratic risk
In this section, we no longer restrict our discussion to strategies which are self-
ï¬nancing. Instead, we admit the possibility that the value of a position is readjusted
at the end of each period by an additional investment in the numÃ©raire asset. This
means that, in addition to the initial investment at time t = 0, we allow for a cash
ï¬‚ow throughout the trading periods up to the ï¬nal time T . In particular, it will now
be possible to replicate any given European claim, simply by matching the difference
between the payoff of the claim and the value generated by the preceding strategy with
a ï¬nal transfer at time T .
Deï¬nition 10.1. A generalized trading strategy is a pair of two stochastic process
(Î¾0, Î¾) such that Î¾0 = (Î¾0
t )t=0,...,T is adapted, and such that Î¾ = (Î¾t)t=1,...,T is a
d-dimensional predictable process. The (discounted) value process V of (Î¾0, Î¾) is
deï¬ned as
V0 := Î¾0
0
and
Vt := Î¾0
t + Î¾t Â· Xt
for t â‰¥1.
For such a generalized trading strategy (Î¾0, Î¾), the gains and losses accumulated
up to time t by investing into the risky assets are given by the sum
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1).

10.1 Local quadratic risk
373
The value process V takes the form
V0 = Î¾0
1 + Î¾1 Â· X0
and
Vt = V0 +
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1),
t = 1, . . . , T,
if and only if Î¾ = (Î¾0
t , Î¾t)t=1,...,T is a self-ï¬nancing trading strategy with initial
investment V0 = Î¾0
0 = Î¾0
1 + Î¾1 Â· X0. In this case, (Î¾0
t )t=1,...,T is a predictable process.
In general, however, the difference
Vt âˆ’
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1)
is now non-trivial, and it can be interpreted as the cumulative cost up to time t. This
motivates the following deï¬nition.
Deï¬nition 10.2. The gains process G of a generalized trading strategy (Î¾0, Î¾) is given
by
G0 := 0
and
Gt :=
t
k=1
Î¾k Â· (Xk âˆ’Xkâˆ’1),
t = 1, . . . , T.
The cost process C of (Î¾0, Î¾) is deï¬ned by the difference
Ct := Vt âˆ’Gt,
t = 0, . . . , T,
of the value process V and the gains process G.
In this and in the following sections, we will measure the risk of a strategy in terms
of quadratic criteria for the hedging error, based on the â€œobjectiveâ€ measure P . Our
aim will be to minimize such criteria within the class of those generalized strategies
(Î¾0, Î¾) which replicate a given discounted European claim H in the sense that their
value process satisï¬es
VT = H
P -a.s.
The claim H will be ï¬xed for the remainder of this section. As usual we assume that
the Ïƒ-ï¬eld F0 is trivial, i.e., F0 = {âˆ…, }. In contrast to the previous sections of Part
II, however, our approach does not exclude a priori the existence of arbitrage opportu-
nities, even though the interesting cases will be those in which there exist equivalent
martingale measures. Since our approach is based on L2-techniques, another set of
hypotheses is needed:
Assumption 10.3. Throughout this section, we assume that the discounted claim H
and the discounted price process X of the risky assets are both square-integrable with
respect to the objective measure P :
(a) H âˆˆL2(, FT , P) =: L2(P ).
(b) Xt âˆˆL2(, Ft, P; Rd) for all t.

374
10 Minimizing the hedging error
In addition to these assumptions, the quadratic optimality criteria we have in mind
require the following integrability conditions for strategies.
Deï¬nition 10.4. An L2-admissible strategy for H is a generalized trading strategy
(Î¾0, Î¾) whose value process V satisï¬es
VT = H P-a.s.
and
Vt âˆˆL2(P ) for each t,
and whose gains process G is such that
Gt âˆˆL2(P )
for each t.
We can now introduce the local version of a quadratic criterion for the hedging
error of an L2-admissible strategy.
Deï¬nition 10.5. The local risk process of an L2-admissible strategy (Î¾0, Î¾) is the
process
Rloc
t (Î¾0, Î¾) := E[ (Ct+1 âˆ’Ct)2 | Ft ],
t = 0, . . . , T âˆ’1.
An L2-admissible strategy (Ë†Î¾0, Ë†Î¾) is called a locally risk-minimizing strategy if, for
all t,
Rloc
t (Ë†Î¾0, Ë†Î¾) â‰¤Rloc
t (Î¾0, Î¾)
P -a.s.
for each L2-admissible strategy (Î¾0, Î¾) whose value process satisï¬es Vt+1 = Ë†Î¾0
t+1 +
Ë†Î¾t+1 Â· Xt+1 = Ë†Vt+1.
Remark 10.6. The reason for ï¬xing the value Vt+1 = Ë†Vt+1 in the preceding def-
inition becomes clear when we try to construct a locally risk-minimizing strategy
(Ë†Î¾0, Ë†Î¾) backwards in time. At time T , we want to construct Ë†Î¾0
T âˆ’1, Ë†Î¾0
T , Ë†Î¾T âˆ’1, Ë†Î¾T as
a minimizer for the local risk Rloc
T âˆ’1(Î¾0, Î¾). Since the terminal value of every L2-
admissible strategy must be equal to H, this minimization requires the side condition
Î¾0
T + Î¾T Â· XT = H = Ë†VT . As we will see in the proof of Theorem 10.9 below, mini-
mality of Rloc
T âˆ’1(Ë†Î¾0, Ë†Î¾) completely determines Ë†Î¾0
T and Ë†Î¾T and Ë†VT âˆ’1, but one is still free
to choose Ë†Î¾0
T âˆ’1 and Ë†Î¾T âˆ’1 among all Î¾0
T âˆ’1, Î¾T âˆ’1 with Î¾0
T âˆ’1 + Î¾T âˆ’1 Â· XT âˆ’1 = Ë†VT âˆ’1.
In the next step, it is therefore natural to minimize Rloc
T âˆ’2(Î¾0, Î¾) under the condition
that VT âˆ’1 is equal to the value Ë†VT âˆ’1 obtained from the preceding step. Moreover, the
problem will now be of the same type as the previous one.
â™¦
Although locally risk-minimizing strategies are generally not self-ï¬nancing, it will
turn out that they are â€œself-ï¬nancing on averageâ€ in the following sense:
Deï¬nition 10.7. An L2-admissible strategy is called mean self-ï¬nancing if its cost
process C is a P -martingale, i.e., if
E[ Ct+1 âˆ’Ct | Ft ] = 0
P -a.s. for all t.

10.1 Local quadratic risk
375
In order to formulate conditions for the existence of a locally risk-minimizing
strategy, let us ï¬rst introduce some notation. The conditional covariance of two
random variables W and Z with respect to P is deï¬ned as
cov(W, Z | Ft ) := E[ W Z | Ft ] âˆ’E[ W | Ft ] E[ Z | Ft ]
provided that the conditional expectations and their difference make sense. Similarly,
we deï¬ne the conditional variance of W under P :
var( W | Ft ) := E[ W 2 | Ft ] âˆ’E[ W | Ft ]2
= cov(W, W | Ft ).
Deï¬nition 10.8. Two adapted processes U and Y are called strongly orthogonal with
respect to P if the conditional covariances
cov( Ut+1 âˆ’Ut, Yt+1 âˆ’Yt | Ft ),
t = 0, . . . , T âˆ’1,
are well-deï¬ned and vanish P -almost surely.
When we consider the strong orthogonality of two processes U and Y in the
sequel, then usually one of them will be a P -martingale. In this case, their conditional
covariance reduces to
cov( Ut+1 âˆ’Ut, Yt+1 âˆ’Yt | Ft ) = E

(Ut+1 âˆ’Ut)(Yt+1 âˆ’Yt) | Ft

.
After these preparations, we are now ready to state our ï¬rst result, namely the following
characterization of locally risk-minimizing strategies.
Theorem 10.9. An L2-admissible strategy is locally risk-minimizing if and only if it
is mean self-ï¬nancing and its cost process is strongly orthogonal to X.
Proof. The local risk process of any L2-admissible strategy (Î¾0, Î¾) can be expressed
as a sum of two non-negative terms:
Rloc
t (Î¾0, Î¾) = var( Ct+1 âˆ’Ct | Ft ) + E[ Ct+1 âˆ’Ct | Ft ]2.
Since the conditional variance does not change if we add Ft-measurable random
variables to its argument, the ï¬rst term on the right-hand side takes the form
var( Ct+1 âˆ’Ct | Ft ) = var

Vt+1 âˆ’Î¾t+1 Â· (Xt+1 âˆ’Xt) | Ft

.
(10.1)
The second term satisï¬es
E[ Ct+1 âˆ’Ct | Ft ]2 =

E[ Vt+1 | Ft ] âˆ’Î¾t+1 Â· E[ Xt+1 âˆ’Xt | Ft ] âˆ’Vt
2. (10.2)
In a second step, we ï¬x t and Vt+1, and we consider Î¾t+1 and Vt as parameters.
Our purpose is to derive necessary conditions for the minimality of Rloc
t (Î¾0, Î¾) with

376
10 Minimizing the hedging error
respect to variations of Î¾t+1 and Vt. To this end, note ï¬rst that it is possible to change
the parameters Î¾0
t and Î¾t in such a way that Vt takes any given value, that the modiï¬ed
strategy is still an L2-admissible strategy for H, and that the values of Î¾t+1 and
Vt+1 remain unchanged. In particular, the value in (10.1) is not affected by such a
modiï¬cation, and so it is necessary for the optimality of Rloc
t (Î¾0, Î¾) that Vt minimizes
(10.2). This is the case if and only if
Vt = E[ Vt+1 | Ft ] âˆ’Î¾t+1 Â· E[ Xt+1 âˆ’Xt | Ft ].
(10.3)
The value of (10.1) is independent of Vt and a quadratic form in terms of the
Ft-measurable random vector Î¾t+1. Thus, (10.1) is minimal if and only if Î¾t+1 solves
the linear equation
0 = cov

Vt+1 âˆ’Î¾t+1 Â· ( Xt+1 âˆ’Xt), Xt+1 âˆ’Xt | Ft

.
(10.4)
Note that (10.3) is equivalent to
E[ Ct+1 âˆ’Ct | Ft ] = E

Vt+1 âˆ’Î¾t+1 Â· (Xt+1 âˆ’Xt) | Ft

âˆ’Vt = 0.
Moreover, given (10.3), the condition (10.4) holds if and only if
E

(Ct+1 âˆ’Ct)(Xt+1 âˆ’Xt) | Ft

= 0
where we have used the fact that the conditional covariance in (10.4) is not changed by
subtracting the Ft-measurable random variable Vt from the ï¬rst argument. Backward
induction on t concludes the proof.
The previous proof provides a recipe for a recursive construction of a locally
risk-minimizing strategy: If Vt+1 is already given, minimize
E

(Ct+1 âˆ’Ct)2 | Ft

= E
 
Vt+1 âˆ’

Vt + Î¾t+1 Â· (Xt+1 âˆ’Xt)
2 | Ft

with respect to Vt and Î¾t+1. This is just a conditional version of the standard problem
of determining the linear regression of Vt+1 on the increment Xt+1 âˆ’Xt. Let us now
consider the case
d = 1,
where our market model contains just one risky asset. Then the following recursive
scheme yields formally an explicit solution:
Ë†VT := H,
Ë†Î¾t+1 := cov( Ë†Vt+1, Xt+1 âˆ’Xt | Ft )
Ïƒ 2
t+1
Â· I{Ïƒt+1Ì¸=0},
(10.5)
Ë†Vt := E[ Ë†Vt+1 | Ft ] âˆ’Ë†Î¾t+1 Â· E[ Xt+1 âˆ’Xt | Ft ].

10.1 Local quadratic risk
377
Here Ïƒ 2
t+1 is a shorthand notation for the conditional variance
Ïƒ 2
t+1 := var( Xt+1 âˆ’Xt | Ft ).
Deï¬ning Ë†Î¾0
t := Ë†Vt âˆ’Ë†Î¾t Â· Xt, we obtain a generalized trading strategy (Ë†Î¾0, Ë†Î¾) whose
terminal portfolio value Ë†VT coincides with H. However, an extra condition is needed
to conclude that this strategy is indeed L2-admissible.
Proposition 10.10. Consider a market model with a single risky asset and assume
that there exists a constant C such that

E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
2 â‰¤C Â· Ïƒ 2
t
P -a.s. for all t.
(10.6)
Then the recursion (10.5) deï¬nes a locally risk-minimizing strategy (Ë†Î¾0, Ë†Î¾). Moreover,
any other locally risk-minimizing strategy coincides with (Ë†Î¾0, Ë†Î¾) up to modiï¬cations
of Ë†Î¾t on the set {Ïƒ 2
t = 0}.
Proof. We have to show that (Ë†Î¾0, Ë†Î¾) is L2-admissible. To this end, observe that the
recursion (10.5) and the condition (10.6) imply that
E
 Ë†Î¾t Â· (Xt âˆ’Xtâˆ’1)
2 
= E
 cov( Ë†Vt, Xt âˆ’Xtâˆ’1 | Ftâˆ’1 )2
Ïƒ 4t
Â· E[ (Xt âˆ’Xtâˆ’1)2 | Ftâˆ’1 ] I{Ïƒ 2
t Ì¸=0}

â‰¤(1 + C) Â· E
 cov( Ë†Vt, Xt âˆ’Xtâˆ’1 | Ftâˆ’1 )2
Ïƒ 2t

â‰¤(1 + C) Â· E

var( Ë†Vt | Ftâˆ’1)

.
The last expectation is ï¬nite if Ë†Vt is square-integrable. In this case, Ë†Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆˆ
L2(P ) and in turn Ë†Vtâˆ’1 âˆˆL2(P ). Hence, L2-admissibility of (Ë†Î¾0, Ë†Î¾) follows by
backward induction. The claim that (Ë†Î¾0, Ë†Î¾) is locally risk-minimizing as well as the
uniqueness assertion follow immediately from the construction.
Remark 10.11. The predictable process
t
s=1

E[ Xs âˆ’Xsâˆ’1 | Fsâˆ’1 ]
2
var( Xs âˆ’Xsâˆ’1 | Fsâˆ’1 ) ,
t = 1, . . . , T,
is called the mean-variance trade-off process of X, and condition (10.6) is known
as the assumption of bounded mean-variance trade-off. Intuitively, it states that the
forecast E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] of the price increment Xt âˆ’Xtâˆ’1 is of the same order
as the corresponding standard deviation Ïƒt.
â™¦

378
10 Minimizing the hedging error
Remark 10.12. The assumption of bounded mean-variance trade-off is equivalent to
the existence of some Î´ < 1 such that

E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
2 â‰¤Î´ Â· E[ (Xt âˆ’Xtâˆ’1)2 | Ftâˆ’1 ]
P -a.s. for all t.
(10.7)
Indeed, with Î±t = E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ], the assumption of bounded mean-variance
trade-off is equivalent to
Î±2
t â‰¤C

E[ (Xt âˆ’Xtâˆ’1)2 | Ftâˆ’1 ] âˆ’Î±2
t

,
which is seen to be equivalent to (10.7) by choosing Î´ = C/(1 + C).
â™¦
Example 10.13. Let us consider a market model consisting of a single risky asset S1
and a riskless bond
S0
t = (1 + r)t,
t = 0, . . . , T,
with constant return r > âˆ’1. We assume that S1
0 = 1, and that the returns
Rt := S1
t âˆ’S1
tâˆ’1
S1
tâˆ’1
,
t = 1, . . . , T,
of the risky asset are independent and identically distributed random variables in
L2(P ). Under these assumptions, the discounted price process X, deï¬ned by
Xt =
t
s=1
1 + Rs
1 + r ,
t = 0, . . . , T,
is square-integrable. Denoting by 
m the mean of Rt and by Ïƒ 2 its variance, we get
E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] = Xtâˆ’1 Â· 
m âˆ’r
1 + r ,
var( Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ) = X2
tâˆ’1 Â·
Ïƒ 2
(1 + r)2 .
Thus, the condition of bounded mean-variance trade-off holds without any further as-
sumptions, and a locally risk-minimizing strategy exists. Moreover, P is a martingale
measure if and only if 
m = r.
â™¦
Let us return to our general market model with an arbitrary number of risky assets
X = (X1, . . . , Xd).
The following result characterizes the existence of locally risk-minimizing strategies
in terms of a decomposition of the claim H.

10.1 Local quadratic risk
379
Corollary 10.14. There exists a locally risk-minimizing strategy if and only if H
admits a decomposition
H = c +
T

t=1
Î¾t Â· (Xt âˆ’Xtâˆ’1) + LT
P -a.s.,
(10.8)
where c is a constant, Î¾ is a d-dimensional predictable process such that
Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆˆL2(P )
for all t,
and where L is a square integrable P -martingale which is strongly orthogonal to X
and satisï¬es L0 = 0. In this case, the locally risk-minimizing strategy (Ë†Î¾0, Ë†Î¾) is given
by Ë†Î¾ = Î¾ and by the adapted process Ë†Î¾0 deï¬ned via Ë†Î¾0
0 = c and
Ë†Î¾0
t = c +
t
s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1) + Lt âˆ’Î¾t Â· Xt,
t = 1, . . . , T.
Moreover, the decomposition (10.8) is unique in the sense that the constant c and the
martingale L are uniquely determined.
Proof. If (Ë†Î¾0, Ë†Î¾) is a given locally risk-minimizing strategy with cost process Ë†C, then
Lt := Ë†Ct âˆ’Ë†C0 is a square-integrable P -martingale which is strongly orthogonal to
X by Theorem 10.9. Hence, we obtain a decomposition (10.8). Conversely, if such a
decomposition exists, then the strategy (Ë†Î¾0, Ë†Î¾) has the cost process Ë†C = c + L, and
Theorem 10.9 implies that (Ë†Î¾0, Ë†Î¾) is locally risk-minimizing.
To show that L is uniquely determined, suppose that there exists another decom-
position of H in terms of c,Î¾, and L. Then
Nt := c âˆ’c + Lt âˆ’Lt =
t
s=1
(Î¾s âˆ’Î¾s) Â· (Xs âˆ’Xsâˆ’1)
is a square-integrable P -martingale which is strongly orthogonal to X and which can
be represented as a â€œstochastic integralâ€ with respect to X. Strong orthogonality means
that
0 = E

(Î¾t âˆ’Î¾t) Â· (Xt âˆ’Xtâˆ’1)(Xt âˆ’Xtâˆ’1) | Ftâˆ’1

.
Multiplying this identity withÎ¾t âˆ’Î¾t gives
0 = E
 
(Î¾t âˆ’Î¾t) Â· (Xt âˆ’Xtâˆ’1)
2 | Ftâˆ’1

,
and so Nt âˆ’Ntâˆ’1 = (Î¾t âˆ’Î¾t) Â· (Xt âˆ’Xtâˆ’1) = 0 P -almost surely. In view of
L0 = L0 = 0, we thus get L = L and in turn c = c.
A decomposition of the form (10.8) will be called the orthogonal decomposition
of the contingent claim H with respect to the process X. If X is itself a P -martingale,
then the orthogonal decomposition reduces to the Kunitaâ€“Watanabe decomposition,
which we will explain next. To this end, we will need some preparation.

380
10 Minimizing the hedging error
Lemma 10.15. For two square-integrable martingales M and N, the following two
conditions are equivalent:
(a) M and N are strongly orthogonal.
(b) The product MN is a martingale.
Proof. The martingale property of M and N gives
E[ (Mt+1 âˆ’Mt)(Nt+1 âˆ’Nt) | Ft ] = E[ Mt+1Nt+1 | Ft ] âˆ’MtNt,
and this expression vanishes if and only if MN is a martingale.
Let H2 denote the space of all square-integrable P -martingales. Via the iden-
tity Mt = E[ MT | Ft ], each M âˆˆH2 can be identiï¬ed with its terminal value
MT âˆˆL2(P ). With the standard identiï¬cation of random variables which coincide
P -a.s., H2 becomes a Hilbert space isomorphic to L2(P ), if endowed with the inner
product
(M, N)H2 := E[ MT NT ],
M, N âˆˆH2.
Recall from Deï¬nition 6.16 that, for a stopping time Ï„, the stopped process MÏ„ is
deï¬ned as
MÏ„
t := MÏ„âˆ§t,
t = 0, . . . , T.
Deï¬nition 10.16. A subspace S of H2 is called stable if MÏ„ âˆˆS for each M âˆˆS
and every stopping time Ï„.
Proposition 10.17. For a stable subspace S of H2 and for L âˆˆH2 with L0 = 0, the
following conditions are equivalent.
(a) L is orthogonal to S, i.e.,
(L, M)H2 = 0
for all M âˆˆS.
(b) L is strongly orthogonal to S, i.e., for each M âˆˆS
E[ (Lt+1 âˆ’Lt)(Mt+1 âˆ’Mt) | Ft ] = 0
P -a.s. for all t.
(c) The product LM is a martingale for each M âˆˆS.
Proof. The equivalence of (b) and (c) follows from Lemma 10.15. To prove (a)â‡”(c),
we will show that LM is a martingale for ï¬xed M âˆˆS if and only if (L, MÏ„)H2 = 0
for all stopping times Ï„ â‰¤T . By the stopping theorem in the form of Proposition 6.38,
(L, MÏ„)H2 = E[ LT MÏ„ ] = E[LÏ„MÏ„].
Using the fact that L0M0 = 0 and applying the stopping theorem in the form of
Theorem 6.17, we conclude that (L, MÏ„)H2 = 0 for all stopping times Ï„ â‰¤T if and
only if LM is a martingale.

10.1 Local quadratic risk
381
After these preparations, we can now state the existence theorem for the discrete-
time version of the Kunitaâ€“Watanabe decomposition.
Theorem 10.18. If the process X is a square-integrable martingale under P , then
every martingale M âˆˆH2 is of the form
Mt = M0 +
t
s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1) + Lt
where Î¾ is a d-dimensional predictable process such that Î¾t Â·(Xt âˆ’Xtâˆ’1) âˆˆL2(P ) for
each t, and where L is a square-integrable P -martingale which is strongly orthogonal
to X and satisï¬es L0 = 0. Moreover, this decomposition is unique in the sense that L
is uniquely determined.
Proof. Denote by X the set of all d-dimensional predictable processes Î¾ such that
Î¾t Â· (Xt âˆ’Xtâˆ’1) âˆˆL2(P ) for each t, and denote by
Gt(Î¾) :=
t
s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1),
t = 0, . . . , T,
the â€œstochastic integralâ€ of Î¾ âˆˆX with respect to X. Since for Î¾ âˆˆX the process
G(Î¾) is a square-integrable P -martingale, the set G of all those martingales can be
regarded as a linear subspace of the Hilbert space H2. In fact, G is a closed subspace
of H2. To prove this claim, note that the martingale property of G(Î¾) implies that

G(Î¾), G(Î¾)

H2 = E
 
GT (Î¾)
2 
=
T

t=1
E
 
Î¾t Â· (Xt âˆ’Xtâˆ’1)
2 
.
Thus, if Î¾(n) is such that G(Î¾(n)) is a Cauchy sequence in H2, then Î¾(n)
t
Â· (Xt âˆ’Xtâˆ’1)
is a Cauchy sequence in L2(P ) for each t. Since P is a martingale measure, we
may apply Lemma 1.68 to conclude that any limit point of Î¾(n)
t
Â· (Xt âˆ’Xtâˆ’1) is of
the form Î¾t Â· (Xt âˆ’Xtâˆ’1) for some Î¾t âˆˆL0(, Ftâˆ’1, P ; Rd). Hence, G is closed
in H2. Moreover, G is stable. Indeed, if Î¾ âˆˆX and Ï„ is a stopping time, then
Gtâˆ§Ï„(Î¾) = Gt(Î¾) where
Î¾s := Î¾s Â· I{Ï„â‰¥s},
s = 1, . . . , T.
Furthermore, we haveÎ¾ âˆˆX since
E
Î¾t Â· (Xt âˆ’Xtâˆ’1)
2
â‰¤E

Î¾t Â· (Xt âˆ’Xtâˆ’1)
2
< âˆ.
Since G is closed, the orthogonal projection N of M âˆ’M0 onto G is well-deï¬ned by
standard Hilbert space techniques. The martingale N belongs to G, and the difference

382
10 Minimizing the hedging error
L := M âˆ’M0 âˆ’N is orthogonal to G. By Proposition 10.17, L is strongly orthogonal
to G and hence strongly orthogonal to X. Therefore, M = M0 + N + L is the desired
decomposition of M. The uniqueness of L follows as in the proof of Corollary 10.14.
Remark 10.19. In dimension d = 1, the assumption of bounded mean-variance
trade-off (10.6) is clearly satisï¬ed if X is a square-integrable P -martingale. Com-
bining Proposition 10.10 with Corollary 10.14 then yields an alternative proof of
Theorem 10.18. Moreover, the recursion (10.5) identiï¬es the predictable process Î¾
appearing in the Kunitaâ€“Watanabe decomposition of a martingale M:
Î¾t = E[ (Mt âˆ’Mtâˆ’1)(Xt âˆ’Xtâˆ’1) | Ftâˆ’1 ]
E[ (Xt âˆ’Xtâˆ’1)2 | Ftâˆ’1 ]
Â· I{E[ (Xtâˆ’Xtâˆ’1)2|Ftâˆ’1 ]Ì¸=0}.
â™¦
10.2 Minimal martingale measures
If P is itself a martingale measure, Theorem 10.18 combined with Corollary 10.14
yields immediately a solution to our original problem of constructing locally risk-
minimizing strategies:
Corollary 10.20. If P is a martingale measure, then there exists a locally risk-
minimizing strategy. Moreover, this strategy is unique in the sense that its value
process Ë†V is uniquely determined as
Ë†Vt = E[ H | Ft ],
t = 0, . . . , T,
(10.9)
and that its cost process is given by
Ë†Ct = Ë†V0 + Lt,
t = 0, . . . , T,
where L is the strongly orthogonal P -martingale arising in the Kunitaâ€“Watanabe
decomposition of Ë†V .
The identity (10.9) allows for a time-consistent interpretation of Ë†Vt as an arbitrage-
free price for H at time t. In the general case in which X is not a martingale under
P, one may ask whether there exists an equivalent martingale measure Ë†P such that
the value process Ë†V of a locally risk-minimizing strategy can be obtained in a similar
manner as the martingale
Ë†E[ H | Ft ],
t = 0, . . . , T.
(10.10)
Deï¬nition 10.21. An equivalent martingale measure Ë†P âˆˆP is called a minimal mar-
tingale measure if
E
 d Ë†P
dP
2 
< âˆ,

10.2 Minimal martingale measures
383
and if every P-martingale M âˆˆH2 which is strongly orthogonal to X is also a
Ë†P -martingale.
The following result shows that a minimal martingale measure provides the desired
representation (10.10) â€“ if such a minimal martingale measure exists.
Theorem 10.22. If Ë†P is a minimal martingale measure, and if Ë†V is the value process
of a locally risk-minimizing strategy, then
Ë†Vt = Ë†E[ H | Ft ],
t = 0, . . . , T.
Proof. Denote by
H = c +
T

t=1
Î¾t Â· (Xt âˆ’Xtâˆ’1) + LT
an orthogonal decomposition of H as in Corollary 10.14. Then Ë†V is given by
Ë†Vt = c +
t
s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1) + Lt.
The process L is a Ë†P -martingale, because it is a square-integrable P -martingale
strongly orthogonal to X.
Moreover, Î¾s Â· (Xs âˆ’Xsâˆ’1) âˆˆL1( Ë†P ), because both
Î¾s Â· (Xs âˆ’Xsâˆ’1) and d Ë†P /dP are square-integrable with respect to P . It follows that
Ë†V is a Ë†P -martingale. In view of Ë†VT = H, the assertion follows.
Our next goal is to derive a characterization of a minimal martingale measure and
to use it in order to obtain criteria for its existence. To this end, we have to analyze the
effect of an equivalent change of measure on the structure of martingales. The results
we will obtain in this direction are of independent interest, and their continuous-time
analogues have a wide range of applications in stochastic analysis.
Lemma 10.23. Let 
P be a probability measure equivalent to P . An adapted process

M is a 
P-martingale if and only if the process

Mt Â· E
 d 
P
dP
 Ft

,
t = 0, . . . , T,
is a P-martingale.
Proof. Let us denote
Zt := E
 d 
P
dP
 Ft

.
Observe that 
Mt âˆˆL1(
P ) if and only if 
MtZt âˆˆL1(P ). Moreover, the process Z
is P-a.s. strictly positive by the equivalence of 
P and P . Hence, Proposition A.12
yields that
Zt Â· 
E[ 
Mt+1 | Ft ] = E[ 
Mt+1Zt+1 | Ft ],

384
10 Minimizing the hedging error
and it follows that 
E[ 
Mt+1 | Ft ] = 
Mt if and only if E[ 
Mt+1Zt+1 | Ft ] = 
MtZt.
The following representation (10.12) of the density process may be viewed as the
discrete-time version of the DolÃ©ansâ€“Dade stochastic exponential in continuous-time
stochastic calculus.
Proposition 10.24. If 
P is a probability measure equivalent to P , then there exists a
P-martingale  such that
0 = 1
and
t+1 âˆ’t > âˆ’1
P -a.s. for all t,
(10.11)
and such that the martingale
Zt := E
 d 
P
dP
 Ft

,
t = 0, . . . , T,
can be represented as
Zt =
t
s=1
(1 + s âˆ’sâˆ’1),
t = 0, . . . , T.
(10.12)
Conversely, if  is a P -martingale with (10.11) and such that (10.12) deï¬nes a
P-martingale Z, then
d 
P := ZT dP
deï¬nes a probability measure 
P â‰ˆP .
Proof. For 
P â‰ˆP given, deï¬ne  by 0 = 1 and
t+1 := t + Zt+1 âˆ’Zt
Zt
,
t = 0, . . . , T âˆ’1.
Clearly, (10.12) holds with this choice of . In particular,  satisï¬es (10.11), because
the equivalence of P and 
P implies that Zt is P -a.s. strictly positive for all t.
In the next step, we show by induction on t that t âˆˆL1(P ). For t = 0 this holds
by deï¬nition. Suppose that t âˆˆL1(P ). Since Z is non-negative, the conditional
expectation of Zt+1/Zt is well-deï¬ned and satisï¬es P -a.s.
E
 Zt+1
Zt
 Ft

= 1
Zt
Â· E[ Zt+1 | Ft ] = 1.
It follows that Zt+1/Zt âˆˆL1(P ) and in turn that
t+1 = t âˆ’1 + Zt+1
Zt
âˆˆL1(P ).

10.2 Minimal martingale measures
385
Now it is easy to derive the martingale property of : Since Zt is strictly positive,
we may divide both sides of the equation E[ Zt+1 | Ft ] = Zt by Zt, and we arrive at
E[ t+1 âˆ’t | Ft ] = 0.
As for the second assertion, it is clear that E[ Zt ] = Z0 = 1 for all t, provided
that  is a P -martingale such that (10.11) holds and such that (10.12) deï¬nes a strictly
positive P-martingale Z.
The following theorem shows how a martingale M is affected by an equivalent
change of the underlying probability measure P. Typically, M will no longer be a mar-
tingale under the new measure 
P , and so a non-trivial predictable process (At)t=1,...,T
will appear in the Doob decomposition
M = 
M + A
of M under 
P. Alternatively, âˆ’A may be viewed as the predictable process arising in
the Doob decomposition of the 
P -martingale 
M under the measure P . The following
result, a discrete-time version of the Girsanov formula, describes A in terms of the
martingale  arising in the representation (10.12) of the successive densities.
Theorem 10.25. Let P and 
P be two equivalent probability measures, and let  de-
note the P -martingale arising in the representation (10.12) of the successive densities
Zt := E[ d 
P/dP | Ft ]. If 
M is a 
P -martingale such that 
Mt âˆˆL1(P ) for all t, then
Mt := 
Mt +
t
s=1
E

(s âˆ’sâˆ’1)( 
Ms âˆ’
Msâˆ’1) | Fsâˆ’1

is a P-martingale.
Proof. Note ï¬rst that
(t âˆ’tâˆ’1)( 
Mt âˆ’
Mtâˆ’1) =
1
Ztâˆ’1

Zt( 
Mt âˆ’
Mtâˆ’1)

âˆ’( 
Mt âˆ’
Mtâˆ’1) .
(10.13)
According to Lemma 10.23, Zt( 
Mt âˆ’
Mtâˆ’1) is a martingale increment, and hence
belongs to L1(P ). If we let
Ï„n := inf{ t | Zt < 1/n } âˆ§T,
n = 2, 3, . . . ,
it follows that
(t âˆ’tâˆ’1)( 
Mt âˆ’
Mtâˆ’1) I{Ï„nâ‰¥t} âˆˆL1(P ) .
In particular, the conditional expectations appearing in the statement of the theorem
are P-a.s. well-deï¬ned. Moreover, the identity (10.13) implies that P -a.s. on {Ï„n â‰¥t}
E[ 
Mt âˆ’
Mtâˆ’1 | Ftâˆ’1 ]
=
1
Ztâˆ’1
E

Zt( 
Mt âˆ’
Mtâˆ’1) | Ftâˆ’1

âˆ’E[ (t âˆ’tâˆ’1)( 
Mt âˆ’
Mtâˆ’1) | Ftâˆ’1 ]
= âˆ’E

(t âˆ’tâˆ’1)( 
Mt âˆ’
Mtâˆ’1) | Ftâˆ’1

.

386
10 Minimizing the hedging error
Thus, we have identiï¬ed the Doob decomposition of 
M under P .
TheprecedingtheoremallowsustocharacterizethoseequivalentmeasuresP âˆ—â‰ˆP
which are martingale measures. Let
X = Y + B
(10.14)
denote the Doob decomposition of X under P , where Y is a d-dimensional
P-martingale, and (Bt)t=1,...,T is a d-dimensional predictable process.
Corollary 10.26. Let P âˆ—â‰ˆP be such that Eâˆ—[ |Xt| ] < âˆfor each t, and denote by
 the P-martingale arising in the representation (10.12) of the successive densities
Zt := E[ dP âˆ—/dP | Ft ]. Then P âˆ—is an equivalent martingale measure if and only if
the predictable process B in the Doob decomposition (10.14) satisï¬es
Bt = âˆ’
t
s=1
E

(s âˆ’sâˆ’1)(Ys âˆ’Ysâˆ’1) | Fsâˆ’1

= âˆ’
t
s=1
E

(s âˆ’sâˆ’1)(Xs âˆ’Xsâˆ’1) | Fsâˆ’1

P-a.s. for t = 1, . . . , T .
Proof.
If P âˆ—is an equivalent martingale measure, then our formula for B is an
immediate consequence of Theorem 10.25. For the proof of the converse direction,
we denote by
X = Y âˆ—+ Bâˆ—
the Doob decomposition of X under P âˆ—. Then Y âˆ—is a P âˆ—-martingale. Using Theo-
rem 10.25, we see that Y âˆ—:= Y âˆ—+ 
Bâˆ—is a P -martingale where

Bâˆ—
t =
t
s=1
E

(s âˆ’sâˆ’1)(Y âˆ—
s âˆ’Y âˆ—
sâˆ’1) | Fs

= âˆ’Bt.
On the other hand, Y = X âˆ’B = Y âˆ—+ (Bâˆ—âˆ’B) is a P -martingale. It follows that
the Doob decomposition of Y âˆ—under P is given by Y âˆ—= Y + (B âˆ’Bâˆ—). Hence,
Y + (B âˆ’Bâˆ—) = Y âˆ—= Y âˆ—âˆ’
Bâˆ—= Y âˆ—+ B.
The uniqueness of the Doob decomposition implies Bâˆ—â‰¡0, so X is a P âˆ—-martingale.
We can now return to our initial task of characterizing a minimal martingale mea-
sure.

10.2 Minimal martingale measures
387
Theorem 10.27. Let Ë†P âˆˆP be an equivalent martingale measure whose density
d Ë†P /dP is square-integrable. Then Ë†P is a minimal martingale measure if and only
if the P-martingale  of (10.12) admits a representation as a â€œstochastic integralâ€
with respect to the P -martingale Y arising in the Doob decomposition of X:
t = 1 +
t
s=1
Î»s Â· (Ys âˆ’Ysâˆ’1),
t = 0, . . . , T,
(10.15)
for some d-dimensional predictable process Î».
Proof. To prove sufï¬ciency of (10.15), we have to show that if M âˆˆH2 is strongly
orthogonal to X, then M is a Ë†P -martingale. By Lemma 10.23 this follows if we can
show that MZ is a P -martingale where
Zt := E
 d Ë†P
dP
 Ft

.
Clearly, MtZt âˆˆL1(P ) since M and Z are both square-integrable.
For the next step, we introduce the stopping times
Ï„n := inf

t â‰¥0 | |Î»t+1| > n

.
By stopping the martingale  at Ï„n, we obtain the P -martingale Ï„n. Since X is
square-integrable, an application of Jensenâ€™s inequality yields that E[ |Yt|2 ] < âˆfor
all t. In particular, MÏ„n is integrable. Furthermore, Lemma 10.15 shows that the
strong orthogonality of M and Y implies that MY is a d-dimensional P -martingale.
Hence,
E

Mt+1(Ï„n
t+1 âˆ’Ï„n
t ) | Ft

= I{t+1â‰¤Ï„n}Î»t+1 Â·

E[ Mt+1Yt+1 | Ft ] âˆ’E[ Mt+1 | Ft ]Yt

= 0.
Noting that
ZÏ„n
t
=
t
s=1
(1 + Ï„n
s âˆ’Ï„n
sâˆ’1),
and that ZÏ„n is square-integrable, we conclude that
E[ Mt+1ZÏ„n
t+1 | Ft ] = ZÏ„n
t E

Mt+1(1 + Ï„n
t+1 âˆ’Ï„n
t ) | Ft

= ZÏ„n
t Mt.
Thus, ZÏ„nM is a P -martingale for each n. By Doobâ€™s stopping theorem, the process
(ZÏ„nM)Ï„n = (ZM)Ï„n
is also a P -martingale. Since Ï„n â†—T P-a.s. and
MÏ„n
t+1ZÏ„n
t+1
 â‰¤
T

s=0
MsZs
 âˆˆL1(P ),

388
10 Minimizing the hedging error
we may apply the dominated convergence theorem for conditional expectations to
obtain the desired martingale property of MZ:
E[ Mt+1Zt+1 | Ft ] = lim
nâ†‘âˆE[ MÏ„n
t+1ZÏ„n
t+1 | Ft ] = lim
nâ†‘âˆMÏ„n
t ZÏ„n
t
= MtZt.
Thus, Ë†P is a minimal martingale measure.
For the proof of the converse assertion of the theorem, denote by
Zt = 1 +
t
s=1
Î·s Â· (Ys âˆ’Ysâˆ’1) + Lt
the Kunitaâ€“Watanabe decomposition of the density process Z with respect to the
measure P and the square-integrable martingale Y, as explained in Theorem 10.18.
The process L is a square-integrable P -martingale strongly orthogonal to Y, and hence
to X. Thus, the assumption that Ë†P is a minimal martingale measure implies that L is
also a Ë†P -martingale. Applying Lemma 10.23, it follows that
LtZt = Lt + Lt
t
s=1
Î·s Â· (Ys âˆ’Ysâˆ’1) + L2
t
is a P-martingale. According to Lemma 10.15, the strong orthogonality of L and Y
yields that
Lt
t
s=1
Î·s Â· (Ys âˆ’Ysâˆ’1)
is a P-martingale; recall that Î·s Â· (Ys âˆ’Ysâˆ’1) âˆˆL2(P ) for all s. But then (L2
t ) must
also be a martingale. In particular, the expectation of L2
t is independent of t and so
E[ L2
t ] = L2
0 = 0
from which we get that L vanishes P -almost surely. Hence, Z is equal to the â€œstochas-
tic integralâ€ of Î· with respect to Y, and we conclude that
t+1 âˆ’t = Zt+1 âˆ’Zt
Zt
= 1
Zt
Î·t+1 Â· (Yt+1 âˆ’Yt),
so that (10.15) holds with Î»t := Î·t/Ztâˆ’1.
Corollary 10.28. There exists at most one minimal martingale measure.
Proof. Let Ë†P and Ë†P â€² be two minimal martingale measures, and denote the martingales
in the representation (10.12) by  and â€², respectively. On the one hand, it follows
from Corollary 10.26 that the martingale N := âˆ’â€² is strongly orthogonal to Y. On

10.2 Minimal martingale measures
389
the other hand, Theorem 10.27 implies that N admits a representation as a â€œstochastic
integralâ€ with respect to the P -martingale Y:
Nt =
t
s=1
(Î»s âˆ’Î»â€²
s) Â· (Ys âˆ’Ysâˆ’1),
t = 0, . . . , T.
Let Ï„n := inf{t | |Î»t+1 âˆ’Î»â€²
t+1| > n}, so that NÏ„n is in L2(P ). Then it follows as
in the proof of Corollary 10.14 that NÏ„n vanishes P -almost surely. Hence the densities
of Ë†P and Ë†P â€² coincide.
Recall that, for d = 1, we denote by
Ïƒ 2
t = var( Xt âˆ’Xtâˆ’1 | Ftâˆ’1 )
the conditional variance of the increments of X.
Corollary 10.29. In dimension d = 1, the following two conditions are implied by
the existence of a minimal martingale measure Ë†P :
(a) The predictable process Î» arising in the representation formula (10.15) is of the
form
Î»t = âˆ’E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
Ïƒ 2t
P -a.s. on { Ïƒ 2
t Ì¸= 0 }.
(10.16)
(b) For each t, P -a.s. on {Ïƒ 2
t Ì¸= 0},
(Xt âˆ’Xtâˆ’1) Â· E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] < E[ (Xt âˆ’Xtâˆ’1)2 | Ftâˆ’1 ].
Proof. (a): Denote by X = Y + B the Doob decomposition of X with respect to P .
According to Corollary 10.26, the P -martingale  arising in the representation (10.12)
of the density d Ë†P /dP must satisfy
Bt âˆ’Btâˆ’1 = âˆ’E

(t âˆ’tâˆ’1)(Yt âˆ’Ytâˆ’1) | Ftâˆ’1

.
Using that Ïƒ 2
t = E[ (Yt âˆ’Ytâˆ’1)2 | Ftâˆ’1 ] and that Bt âˆ’Btâˆ’1 = E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
yields our formula for Î»t.
(b): By Proposition 10.24, the P -martingale  must be such that
t âˆ’tâˆ’1 = Î»t Â· (Yt âˆ’Ytâˆ’1) > âˆ’1
P -a.s. for all t.
Given (a), this condition is equivalent to (b).
Note that condition (b) of Corollary 10.29 is rather restrictive as it imposes
an almost-sure bound on the Ft-measurable increment Xt âˆ’Xtâˆ’1 in terms of
Ftâˆ’1-measurable quantities.

390
10 Minimizing the hedging error
Theorem 10.30. Consider a market model with a single risky asset satisfying condi-
tion (b) of Corollary 10.29 and the assumption

E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
2 â‰¤C Â· Ïƒ 2
t ,
P -a.s. for all t â‰¥1,
of bounded mean-variance trade-off. Then there exists a unique minimal martingale
measure Ë†P whose density d Ë†P /dP = ZT is given via (10.16), (10.15), and (10.12).
Proof. Denote by X = Y + B the Doob decomposition of X under P . For Î»t deï¬ned
via (10.16), the assumption of bounded mean-variance trade-off yields that
E
 
Î»t Â· (Yt âˆ’Ytâˆ’1)
2 | Ftâˆ’1

â‰¤C
P -a.s.
(10.17)
Hence, t deï¬ned according to (10.15) is a square-integrable P -martingale. As ob-
served in the second part of the proof of Corollary 10.29, its condition (b) holds if and
only if t âˆ’tâˆ’1 > âˆ’1 for all t, so that Z deï¬ned by
Zt =
t
s=1
(1 + s âˆ’sâˆ’1) =
t
s=1

1 + Î»s Â· (Ys âˆ’Ysâˆ’1)

is P-a.s. strictly positive. Moreover, the bound (10.17) guarantees that Z is a square-
integrable P-martingale. We may thus conclude from Proposition 10.24 that Z is
the density process of a probability measure Ë†P â‰ˆP with a square-integrable density
d Ë†P /dP . In particular, Xt is Ë†P -integrable for all t. Our choice of Î» implies that
E

(t âˆ’tâˆ’1)(Yt âˆ’Ytâˆ’1) | Ftâˆ’1

= âˆ’E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ]
= âˆ’(Bt âˆ’Btâˆ’1),
and so Ë†P is an equivalent martingale measure by Corollary 10.26. Finally, The-
orem 10.27 states that Ë†P is a minimal martingale measure, while uniqueness was
already established in Corollary 10.28.
Example 10.31. Let us consider again the market model of Example 10.13 with in-
dependent and identically distributed returns Rt âˆˆL2(P ). We have seen that the
condition of bounded mean-variance trade-off is satisï¬ed without further assump-
tions. Let 
m := E[ R1 ] and Ïƒ 2 := var(R1). A short calculation using the formulas
for E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ] and var( Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ) obtained in Example 10.13
shows that the crucial condition (b) of Corollary 10.29 is equivalent to
(
m âˆ’r)R1 < Ïƒ 2 + 
m(
m âˆ’r)
P -a.s.
(10.18)
Hence, (10.18) is equivalent to the existence of the minimal martingale measure. For

m > r the condition (10.18) is an upper bound on R1, while we obtain a lower bound

10.2 Minimal martingale measures
391
for 
m < r. In the case 
m = r, the measure P is itself the minimal martingale measure,
and the condition (10.18) is void. If the distribution of R1 is given, and if
a â‰¤R1 â‰¤b
P -a.s.
for certain constants a > âˆ’1 and b < âˆ, then (10.18) is satisï¬ed for all r in a certain
neighborhood of 
m.
â™¦
Remark 10.32. The purpose of condition (b) of Corollary 10.29 is to ensure that the
density Z deï¬ned via
Zt =
t
s=1

1 + Î»s Â· (Ys âˆ’Ysâˆ’1)

is strictly positive. In cases where this condition is violated, Z may still be a square-
integrable P-martingale and can be regarded as the density of a signed measure
d Ë†P = ZT dP,
whichsharessomepropertieswiththeminimalmartingalemeasureofDeï¬nition10.21;
see, e.g., [186].
â™¦
In the remainder of this section, we consider brieï¬‚y another quadratic criterion for
the risk of an L2-admissible strategy.
Deï¬nition 10.33. Theremainingconditionalrisk ofanL2-admissiblestrategy(Î¾0, Î¾)
with cost process C is given by the process
Rrem
t
(Î¾0, Î¾) := E[ (CT âˆ’Ct)2 | Ft ],
t = 0, . . . , T.
We say that an L2-admissible strategy (Î¾0, Î¾) minimizes the remaining conditional
risk if
Rrem
t
(Î¾0, Î¾) â‰¤Rrem
t
(Î·0, Î·)
P -a.s.
for all t and for each L2-admissible strategy (Î·0, Î·) which coincides with (Î¾0, Î¾) up
to time t.
The next result shows that minimizing the remaining conditional risk for a mar-
tingale measure is the same as minimizing the local risk. In this case, Corollary 10.20
yields formulas for the value process and the cost process of a minimizing strategy.
Proposition 10.34. For P âˆˆP, an L2-admissible strategy minimizes the remaining
conditional risk if and only if it is locally risk minimizing.

392
10 Minimizing the hedging error
Proof.
Let (Ë†Î¾0, Ë†Î¾) be a locally risk-minimizing strategy, which exists by Corol-
lary 10.20, and write Ë†V and Ë†C for its value and cost processes. Take another L2-
admissible strategy (Î·0, Î·) whose value and cost processes are denoted by V and C.
Since Ë†VT = H = VT , the cost process C satisï¬es
CT âˆ’Ct = VT âˆ’Vt âˆ’
T

k=t+1
Î·k Â· (Xk âˆ’Xkâˆ’1)
= Ë†Vt âˆ’Vt +
T

k=t+1
(Ë†Î¾k âˆ’Î·k) Â· (Xk âˆ’Xkâˆ’1) + Ë†CT âˆ’Ë†Ct.
Since X and Ë†C are strongly orthogonal martingales, the remaining conditional risk of
(Î·0, Î·) satisï¬es
Rrem
t
(Î·0, Î·)
= ( Ë†Vt âˆ’Vt)2 + E
 
T

k=t+1
(Ë†Î¾k âˆ’Î·k)2 (Xk âˆ’Xkâˆ’1)2  Ft
!
+ E[ ( Ë†CT âˆ’Ë†Ct)2 | Ft ],
and this expression is minimal if and only if Vt = 
Vt and Î·k = Ë†Î¾k for all k â‰¥t + 1
P-almost surely.
In general, however, an L2-admissible strategy minimizing the remaining condi-
tional risk does not exist, as will be shown in the following Section 10.3.
10.3 Variance-optimal hedging
Let H âˆˆL2(P ) be a square-integrable discounted claim. Throughout this section,
we assume that the discounted price process X of the risky asset is square-integrable
with respect to P :
E[ |Xt|2
< âˆ
for all t.
As in the previous section, there is no need to exclude the existence of arbitrage
opportunities, even though the cases of interest will of course be arbitrage-free.
Informally, the problem of variance-minimal hedging is to minimize the quadratic
hedging error deï¬ned as the squared L2(P )-distance
âˆ¥H âˆ’VT âˆ¥2
2 = E[ (H âˆ’VT )2 ]
between H and the terminal value of the value process V of a self-ï¬nancing trading
strategy.

10.3 Variance-optimal hedging
393
Remark 10.35. Mean-variance hedging is closely related to the discussion in the pre-
ceding sections, where we considered the problems of minimizing the local conditional
risk or the remaining conditional risk within the class of L2-admissible strategies for
H. To see this, let (Î¾0, Î¾) be an L2-admissible strategy for H in the sense of Deï¬ni-
tion 10.4, and denote by V , G, and C the resulting value, gains, and cost processes.
The quantity
R(Î¾0, Î¾) := E

(CT âˆ’C0)2 
may be called the â€œglobal quadratic riskâ€ of (Î¾0, Î¾). It coincides with the initial value
of the process Rrem
0 (Î¾0, Î¾) of the remaining conditional risk introduced in Deï¬ni-
tion 10.33. Note that
R(Î¾0, Î¾) = E

(H âˆ’V0 âˆ’GT )2 
is independent of the values of the numÃ©raire component Î¾0 at the times t = 1, . . . , T .
Thus, the global quadratic risk of the generalized trading strategy (Î¾0, Î¾) coincides
with the quadratic hedging error
E

(H âˆ’
VT )2 
where 
V is the value process of the self-ï¬nancing trading strategy arising from the
d-dimensional predictable process Î¾ and the initial investment 
V0 = V0 = Î¾0
0 .
â™¦
Let us rephrase the problem of mean-variance hedging in a form which can be
interpreted both within the class of self-ï¬nancing trading strategies and within the
context of Section 10.1. For a d-dimensional predictable process Î¾ we denote by
G(Î¾) the gains process
Gt(Î¾) =
t
s=1
Î¾s Â· (Xs âˆ’Xsâˆ’1),
t = 0, . . . , T,
associated with Î¾. Let us introduce the class
S :=

Î¾ | Î¾ is predictable and Gt(Î¾) âˆˆL2(P ) for all t

.
Deï¬nition 10.36. A pair (V âˆ—
0 , Î¾âˆ—) where V âˆ—
0 âˆˆR and Î¾âˆ—âˆˆS is called a variance-
optimal strategy for the discounted claim H if
E
 
H âˆ’V âˆ—
0 âˆ’GT (Î¾âˆ—)
2 
â‰¤E
 
H âˆ’V0 âˆ’GT (Î¾)
2 
for all V0 âˆˆR and all Î¾ âˆˆS.
Our ï¬rst result identiï¬es a variance-optimal strategy in the case P âˆˆP .
Proposition 10.37. Assume that P âˆˆP, and let (Ë†Î¾0, Ë†Î¾) be a locally risk-minimizing
L2-admissible strategy as constructed in Corollary 10.20. Then (V âˆ—
0 , Î¾âˆ—) := (Ë†Î¾0
0 , Ë†Î¾)
is a variance-optimal strategy.

394
10 Minimizing the hedging error
Proof. Recall from Remark 10.35 that if (Î¾0, Î¾) is an L2-admissible strategy for H
with value process V , then the expression
E
 
H âˆ’V0 âˆ’GT (Î¾)
2 
is equal to the initial value Rrem
0 (Î¾0, Î¾) of the remaining conditional risk process of
(Î¾0, Î¾). But according to Proposition 10.34, Rrem
0
is minimized by (Ë†Î¾0, Ë†Î¾).
The general case where X is not a P -martingale will be studied under the simpli-
fying assumption that the market model contains only one risky asset. We will ï¬rst
derive a general existence result, and then determine an explicit solution in a special
setting. The key idea for showing the existence of a variance-optimal strategy is to
minimize the functional
S âˆ‹Î¾ âˆ’â†’E
 
H âˆ’V0 âˆ’GT (Î¾)
2 
,
ï¬rst for ï¬xed V0, and then to vary the parameter V0. The ï¬rst step will be accomplished
by projecting H âˆ’V0 onto the space of â€œstochastic integralsâ€
GT :=

GT (Î¾) | Î¾ âˆˆS

.
Clearly, GT is a linear subspace of L2(P ). Thus, we can obtain the optimal Î¾ = Î¾(V0)
by using the orthogonal projection of H âˆ’V0 on GT as soon as we know that GT is
closed in L2(P ). In order to formulate a criterion for the closedness on GT , we denote
by
Ïƒ 2
t := var( Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ),
t = 1, . . . , T,
the conditional variance, and by
Î±t := E[ Xt âˆ’Xtâˆ’1 | Ftâˆ’1 ],
t = 1, . . . , T,
the conditional mean of the increments of X.
Proposition 10.38. Suppose that d = 1, and assume the condition of bounded mean-
variance trade-off
Î±2
t â‰¤C Â· Ïƒ 2
t
P -a.s. for all t.
(10.19)
Then GT is a closed linear subspace of L2(P ).
Proof. Let X = M + A be the Doob decomposition of X into a P -martingale M and
a process A such that A0 = 0 and (At)t=1,...,T is predictable. Since
Ïƒ 2
T = var( XT âˆ’XT âˆ’1 | FT âˆ’1 ) = E

(MT âˆ’MT âˆ’1)2 | FT âˆ’1

,
we get for Î¾ âˆˆS
E

GT (Î¾)2 
= E

GT âˆ’1(Î¾) + Î¾T Â· (XT âˆ’XT âˆ’1)
2 
= E

GT âˆ’1(Î¾) + Î¾T Â· (AT âˆ’AT âˆ’1)
2 
+ E

Î¾T Â· (MT âˆ’MT âˆ’1)
2 
â‰¥E

Î¾2
T Â· Ïƒ 2
T

.
(10.20)

10.3 Variance-optimal hedging
395
Suppose now that Î¾n is a sequence in S such that GT (Î¾n) converges in L2(P ) to some
Y. Applying the inequality (10.20) to GT (Î¾n) âˆ’GT (Î¾m) = GT (Î¾n âˆ’Î¾m), we ï¬nd
that Ï†n := Î¾n
T Â· ÏƒT is a Cauchy sequence in L2(P ). Denote Ï† := limn Ï†n, and let
Î¾T := I{ÏƒT >0}
Ï†
ÏƒT
.
By using our assumption (10.19), we obtain
E
 
Î¾n
T Â· (XT âˆ’XT âˆ’1) âˆ’Î¾T Â· (XT âˆ’XT âˆ’1)
2 
= E

(Î¾n
T âˆ’Î¾T )2 Â· E[ (XT âˆ’XT âˆ’1)2 | FT âˆ’1 ]

= E

(Î¾n
T âˆ’Î¾T )2 Â· (Ïƒ 2
T + Î±2
T )

â‰¤(1 + C) E[ (Î¾n
T ÏƒT âˆ’Î¾T ÏƒT )2 ]
= (1 + C) E[ (Ï†n âˆ’Ï†)2 ].
Since the latter term converges to 0, it follows that
GT âˆ’1(Î¾n) = GT (Î¾n) âˆ’Î¾n
T Â· (XT âˆ’XT âˆ’1) âˆ’â†’Y âˆ’Î¾T Â· (XT âˆ’XT âˆ’1)
in L2(P ). A backward iteration of this argument yields a predictable process Î¾ âˆˆS
such that Y = GT (Î¾). Hence, GT is closed in L2(P ).
Theorem 10.39. Indimensiond = 1, thecondition(10.19)ofboundedmean-variance
trade-off guarantees the existence of a variance-optimal strategy (V âˆ—
0 , Î¾âˆ—). Such a
strategy is P-a.s. unique up to modiï¬cations of Î¾âˆ—
t on {Ïƒt = 0}.
Proof.
Let p : L2(P ) â†’GT denote the orthogonal projection onto the closed
subspace GT of the Hilbert space L2(P ), i.e., p : L2(P ) â†’GT is a linear operator
such that
E
 
Y âˆ’p(Y)
2 
= min
ZâˆˆGT
E

(Y âˆ’Z)2 
(10.21)
for all Y âˆˆL2(P ).
For any V0 âˆˆR we choose some Î¾(V0) âˆˆS such that GT

Î¾(V0)

= p(H âˆ’V0).
The identity (10.21) shows that Î¾(V0) minimizes the functional
E
 
H âˆ’V0 âˆ’GT (Î¾)
2
among all Î¾ âˆˆS. Note that
V0 â†’GT

Î¾(V0)

= p(H âˆ’V0) = p(H) âˆ’V0 Â· p(1)
is an afï¬ne mapping. Hence,
E
 
H âˆ’V0 âˆ’GT

Î¾(V0)
2

396
10 Minimizing the hedging error
is a quadratic function of V0 and there exists a minimizer V âˆ—
0 . For any V0 âˆˆR and
Î¾ âˆˆS we clearly have
E
 
H âˆ’V0 âˆ’GT (Î¾)
2
â‰¥E
 
H âˆ’V0 âˆ’GT

Î¾(V0)
2
â‰¥E
 
H âˆ’V âˆ—
0 âˆ’GT

Î¾(V âˆ—
0 )
2
.
Hence (V âˆ—
0 , Î¾âˆ—) := (V âˆ—
0 , Î¾(V âˆ—
0 )) is a variance-optimal strategy. Uniqueness follows
from (10.20) and an induction argument.
Under the additional assumption that
Î±2
t
Ïƒ 2t
is deterministic for each t
(10.22)
(here we use the convention 0
0 := 0), the variance-optimal strategy (Î¾âˆ—, V âˆ—
0 ) can be
determined explicitly. It turns out that (Î¾âˆ—, V âˆ—
0 ) is closely related to the locally risk-
minimizing strategy (Ë†Î¾0, Ë†Î¾) for the discounted claim H. Recall from Proposition 10.10
that (Ë†Î¾0, Ë†Î¾) and its value process Ë†V are determined by the following recursion:
Ë†VT = H,
Ë†Î¾t+1 = cov( Ë†Vt+1, Xt+1 âˆ’Xt | Ft )
Ïƒ 2
t+1
Â· I{Ïƒt+1Ì¸=0},
Ë†Vt = E[ Ë†Vt+1 | Ft ] âˆ’Ë†Î¾t+1 Â· E[ Xt+1 âˆ’Xt | Ft ] ;
the numÃ©raire component Ë†Î¾0 is given by Ë†Î¾0
t := Ë†Vt âˆ’Ë†Î¾t Â· Xt.
Theorem 10.40. Under condition (10.22), V âˆ—
0 := Ë†V0 and
Î¾âˆ—
t := Ë†Î¾t +
Î±t
Î±2t + Ïƒ 2t
 Ë†Vtâˆ’1 âˆ’Ë†V0 âˆ’Gtâˆ’1(Î¾âˆ—)

,
t = 1, . . . , T,
deï¬nes a variance-optimal strategy (Î¾âˆ—, V âˆ—
0 ). Moreover,
E
 
H âˆ’V âˆ—
0 + GT (Î¾âˆ—)
2
=
T

t=1
Î³t Â· E

( Ë†Ct âˆ’Ë†Ctâˆ’1)2 
,
where Ë†C denotes the cost process of ( Ë†Î¾0, Ë†Î¾ ), and Î³t is given by
Î³t :=
T
k=t+1
Ïƒ 2
k
Ïƒ 2
k + Î±2
k
.

10.3 Variance-optimal hedging
397
Proof. We prove the assertion by induction on T . For T = 1 the problem is just a
particular case of Proposition 10.10, which yields Î¾âˆ—
1 = Ë†Î¾1 and V âˆ—
0 = Ë†V0.
For T > 1 we use the orthogonal decomposition
H = Ë†VT = Ë†V0 +
T

t=1
Ë†Î¾t Â· (Xt âˆ’Xtâˆ’1) + Ë†CT âˆ’Ë†C0,
(10.23)
ofthediscountedclaimH asconstructedinCorollary10.14. Supposethattheassertion
is proved for T âˆ’1. Let us consider the minimization of
Î¾T â†’E
  Ë†VT âˆ’VT âˆ’1 âˆ’Î¾T Â· (XT âˆ’XT âˆ’1)
2
,
(10.24)
where VT âˆ’1 is any random variable in L2(, FT âˆ’1, P ).
By (10.23) and Theo-
rem 10.9, we may write Ë†VT as
Ë†VT = Ë†VT âˆ’1 + Ë†Î¾T Â· (XT âˆ’XT âˆ’1) + Ë†CT âˆ’Ë†CT âˆ’1,
where Ë†C is a P-martingale strongly orthogonal to X. Thus,
E
  Ë†VT âˆ’VT âˆ’1 âˆ’Î¾T Â· (XT âˆ’XT âˆ’1)
2
= E
  Ë†VT âˆ’1 âˆ’VT âˆ’1 + ( Ë†Î¾T âˆ’Î¾T ) Â· (XT âˆ’XT âˆ’1) + Ë†CT âˆ’Ë†CT âˆ’1
2
.
The expectation conditional on FT âˆ’1 of the integrand on the right-hand side is equal
to
( Ë†VT âˆ’1 âˆ’VT âˆ’1)2 + 2( Ë†VT âˆ’1 âˆ’VT âˆ’1)( Ë†Î¾T âˆ’Î¾T ) Â· Î±T
+ ( Ë†Î¾T âˆ’Î¾T )2(Ïƒ 2
T + Î±2
T ) + E

( Ë†CT âˆ’Ë†CT âˆ’1)2 | FT âˆ’1

.
(10.25)
This expression is minimized by
Î¾T (VT âˆ’1) := Ë†Î¾T +
Î±T
Î±2
T + Ïƒ 2
T
( Ë†VT âˆ’1 âˆ’VT âˆ’1),
(10.26)
which must also be the minimizer in (10.24). The minimal value in (10.25) is given
by
( Ë†VT âˆ’1 âˆ’VT âˆ’1)2
1
1 + Î±2
T /Ïƒ 2
T
+ E

( Ë†CT âˆ’Ë†CT âˆ’1)2 | FT âˆ’1

.
Using our assumption (10.22) that Î±2
T /Ïƒ 2
T is constant, we can compute the expectation
of the latter expression, and we arrive at the following identity:
E
  Ë†VT âˆ’VT âˆ’1 âˆ’Î¾T (VT âˆ’1) Â· (XT âˆ’XT âˆ’1)
2
= E

( Ë†VT âˆ’1 âˆ’VT âˆ’1)2 
Â·
Ïƒ 2
T
Ïƒ 2
T + Î±2
T
+ E

( Ë†CT âˆ’Ë†CT âˆ’1)2
.
(10.27)

398
10 Minimizing the hedging error
So far, we have not speciï¬ed VT âˆ’1. Let us now consider the minimization of
E
  Ë†VT âˆ’VT âˆ’1 âˆ’Î¾T (VT âˆ’1) Â· (XT âˆ’XT âˆ’1)
2
with respect to VT âˆ’1, when VT âˆ’1 is of the form VT âˆ’1 = V0 + GT âˆ’1(Î¾) for Î¾ âˆˆS
and V0 âˆˆR. According to our identity (10.27), this problem is equivalent to the
minimization of
(V0, Î¾) âˆ’â†’E
 
HT âˆ’1 âˆ’V0 + GT âˆ’1(Î¾)
2
,
where HT âˆ’1 := Ë†VT âˆ’1. By the induction hypotheses, this problem is solved by V âˆ—
0
and (Î¾âˆ—
t )t=1,...,T âˆ’1 as deï¬ned in the assertion.
Inserting our formula (10.26) for
Î¾T

V âˆ—
0 + GT âˆ’1(Î¾âˆ—)

completes the induction argument.
Remark 10.41. The martingale property of Ë†C implies
E

( Ë†CT âˆ’Ë†C0)2 
=
T

t=1
E

( Ë†Ct âˆ’Ë†Ctâˆ’1)2 
.
If Ë†C Ì¸â‰¡Ë†C0 and if Î³1 < 1, then E[ ( Ë†CT âˆ’Ë†C0)2 ] must be strictly larger than the minimal
global risk
E
 
H âˆ’(V âˆ—
0 + GT (Î¾âˆ—))
2
=
T

t=1
Î³t Â· E

( Ë†Ct âˆ’Ë†Ctâˆ’1)2 
.
â™¦
Remark 10.42. If follows from Theorem 10.40 as well as from the preceding remark
that the component Ë†Î¾ of a variance-optimal strategy (Ë†Î¾0, Ë†Î¾) will differ from the corre-
sponding Î¾âˆ—of a locally risk-minimizing strategy, if Î±t does not vanish for all t, i.e.,
if P is not a martingale measure. This explains why there may be no strategy which
minimizes the remaining conditional risk in the sense of Deï¬nition 10.33: For the
minimality of
Rrem
0 (Î¾0, Î¾) = E

(CT âˆ’C0)2 
= E

(H âˆ’Î¾0
0 âˆ’GT (Î¾))2 
we need that Î¾ = Î¾âˆ—, while the minimality of
Rrem
T âˆ’1(Î¾0, Î¾) = E

(CT âˆ’CT âˆ’1)2 | FT âˆ’1

= Rloc
T âˆ’1(Î¾0, Î¾)
requires Î¾T = Ë†Î¾T . Hence, the two minimality requirements are in general incom-
patible.
â™¦

Appendix
A.1 Convexity
This section contains a few basic facts on convex functions and on convex sets in
Euclidean space. Denote by
|x| := âˆšx Â· x
the Euclidean norm of x âˆˆRn.
Proposition A.1. Suppose that C âŠ‚Rn is a non-empty convex set with 0 /âˆˆC. Then
there exists Î· âˆˆRn with Î· Â· x â‰¥0 for all x âˆˆC, and with Î· Â· x0 > 0 for at least one
x0 âˆˆC. Moreover, if infxâˆˆC |x| > 0, then one can ï¬nd Î· âˆˆRn with infxâˆˆC Î· Â· x > 0.
Proof. First we consider the case in which infxâˆˆC |x| > 0. This inï¬mum is attained
by some y in the closure C of C. Since the set C is also convex, |y +Î±(x âˆ’y)|2 â‰¥|y|2
for each x âˆˆC and all Î± âˆˆ[0, 1]. Thus
2Î± y Â· (x âˆ’y) + Î±2 |x âˆ’y|2 â‰¥0.
For Î± â†“0 we obtain y Â· x â‰¥y Â· y > 0, and so we can take Î· := y.
Now let C be any non-empty convex subset of Rn such that 0 /âˆˆC. In a ï¬rst step,
we will show that C is a proper subset of Rn. To this end, let {e1, . . . , ek} be a maximal
collection of linearly independent vectors in C. Then each x âˆˆC can be expressed as
a linear combination of e1, . . . , ek. We claim that
z := âˆ’
k

i=1
ei
is not contained in C. We assume by way of contradiction that z âˆˆC. Then there are
zn âˆˆC converging to z. If we write zn = k
i=1 Î»i
nei, then zn â†’z is equivalent to
the convergence Î»i
n â†’âˆ’1 for all i. It follows that for some n0 âˆˆN all coefï¬cients
Î»i
n0 are strictly negative. Let
Î±0 :=
1
1 âˆ’k
i=1 Î»in0
and
Î±j :=
âˆ’Î»j
n0
1 âˆ’k
i=1 Î»in0
for j = 1, . . . , k.
Then the Î±jâ€™s are non-negative and sum up to 1. Thus, the convexity of C implies that
0 = Î±0zn0 + Î±1e1 + Â· Â· Â· + Î±kek âˆˆC,
which is a contradiction. Hence, z is not contained in C.

400
Appendix
Now we are in a position to prove the existence of a separating Î· in the case in
which 0 is a boundary point of C, and thus infxâˆˆC |x| = 0. We may assume without
loss of generality that the linear hull of C is the full space Rn. Since we already
know that C is not dense in Rn, we may choose a sequence (zm) âŠ‚Rn such that
infxâˆˆC |x âˆ’zm| > 0 and zm â†’0. Then Cm := C âˆ’zm satisï¬es infxâˆˆCm |x| > 0,
and the ï¬rst part of the proof yields corresponding vectors Î·m. We may assume that
|Î·m| = 1 for all m. By compactness of the (n âˆ’1)-dimensional unit sphere, there
exists a convergent subsequence (Î·mk) with limit Î·, which satisï¬es
Î· Â· x = lim
kâ†‘âˆÎ·mk Â· x = lim
kâ†‘âˆÎ·mk Â· (x âˆ’zmk) â‰¥0
for all x âˆˆC. Since Î· is also a unit vector and C is not contained in a proper linear
subspace of Rn, the case Î· Â· x = 0 for all x âˆˆC cannot occur, and so there must be
some x0 âˆˆC with Î· Â· x0 > 0.
Deï¬nition A.2. Let A be any subset of a linear space E. The convex hull of A is
deï¬ned as
conv A =
$
n

i=1
Î±ixi
 xi âˆˆA, Î±i â‰¥0,
n

i=1
Î±i = 1, n âˆˆN
%
.
It is straightforward to check that conv A is the smallest convex set containing A.
Let us now turn to convex functions on R.
Deï¬nition A.3. A function f : R â†’R âˆª{+âˆ} is called a proper convex function if
f (x) < âˆfor some x âˆˆR and if
f

Î±x + (1 âˆ’Î±)y

â‰¤Î± f (x) + (1 âˆ’Î±) f (y)
for x, y âˆˆR and Î± âˆˆ[0, 1]. The effective domain of f , denoted by dom f , consists
of all x âˆˆR such that f (x) < âˆ.
Clearly, the effective domain of a proper convex function f is a real interval
S = dom f . If considered as a function f : S â†’R, the function f is convex in
the usual sense. Conversely, any convex function f : S â†’R deï¬ned on some non-
empty interval S may be viewed as a proper convex function deï¬ned by f (x) := +âˆ
for x âˆˆR\S. The following proposition summarizes continuity and differentiability
properties of a proper convex function on its effective domain.
Proposition A.4. Let f be a proper convex function, and denote by D the interior of
dom f .
(a) f is upper semicontinuous on dom f and locally Lipschitz continuous on D.
(b) f admits left- and right-hand derivatives
f â€²
âˆ’(y) := lim
xâ†‘y
f (x) âˆ’f (y)
x âˆ’y
and
f â€²
+(y) := lim
zâ†“y
f (z) âˆ’f (y)
z âˆ’y
at each y âˆˆD. Both f â€²
+ and f â€²
âˆ’are increasing functions and satisfy f â€²
âˆ’â‰¤f â€²
+.

A.1 Convexity
401
(c) The right-hand derivative f â€²
+ is right-continuous, the left-hand derivative f â€²
âˆ’is
left-continuous.
(d) f is differentiable a.e. in D, and for any x0 âˆˆD
f (x) = f (x0) +
 x
x0
f â€²
+(y) dy = f (x0) +
 x
x0
f â€²
âˆ’(y) dy,
x âˆˆD.
Proof. We ï¬rst prove part (b). For x, y, z âˆˆD with x < y < z, we take Î± âˆˆ(0, 1)
such that y = Î±z + (1 âˆ’Î±)x. Using the convexity of f , one gets
f (y) âˆ’f (x)
y âˆ’x
â‰¤f (z) âˆ’f (x)
z âˆ’x
â‰¤f (z) âˆ’f (y)
z âˆ’y
.
(A.1)
Thus, the difference quotient
f (x) âˆ’f (y)
x âˆ’y
is an increasing function of x, which shows the existence of the left- and right-hand
derivatives. Moreover, we get f â€²
âˆ’(y) â‰¤f â€²
+(y) â‰¤f â€²
âˆ’(z) for y < z.
(a): Let z âˆˆdom f , and take a sequence (xn) âŠ‚dom f such that xn â†’z.
Without loss of generality, we may assume that xn â†“z or xn â†‘z. In either case,
xn = Î´n x1 + (1 âˆ’Î´n)z, where Î´n â†“0. Convexity of f yields
lim sup
nâ†‘âˆ
f (xn) â‰¤lim sup
nâ†‘âˆ

Î´n f (x1) + (1 âˆ’Î´n) f (z)

= f (z),
and so f is upper semicontinuous. To prove local Lipschitz continuity, take a â‰¤x <
y â‰¤b such that [a, b] âŠ‚D. We get from part (b) that
f â€²
+(a) â‰¤f â€²
+(x) â‰¤f (x) âˆ’f (y)
x âˆ’y
â‰¤f â€²
âˆ’(y) â‰¤f â€²
+(b).
Hence, f is Lipschitz continuous on [a, b] with Lipschitz constant L := |f â€²
+(a)| âˆ¨
|f â€²
âˆ’(b)|.
(c): Continuity of f shows that for x < z
f (z) âˆ’f (x)
z âˆ’x
= lim
yâ†“x
f (z) âˆ’f (y)
z âˆ’y
â‰¥lim sup
yâ†“x
f â€²
+(y).
Taking z â†“x yields f â€²
+(x) â‰¥lim supyâ†“x f â€²
+(y). Since f â€²
+ is increasing, we must in
fact have f â€²
+(y) â†’f â€²
+(x) as y â†“x. In the same way, one shows left-continuity of f â€²
âˆ’.
(d): Since the function f is Lipschitz continuous, it is absolutely continuous. By
Lebesgueâ€™s differentiation theorem, f is hence a.e. differentiable and equal to the
integral of its derivative, which is equal to f â€²
âˆ’(x) = f â€²
+(x) for a.e. x âˆˆD.

402
Appendix
Deï¬nition A.5. The Fenchelâ€“Legendre transform of a function f : R â†’R âˆª{+âˆ}
is deï¬ned as
f âˆ—(y) := sup
xâˆˆR

y x âˆ’f (x)

,
y âˆˆR.
If f Ì¸â‰¡+âˆ, then f âˆ—is a convex and lower semicontinuous as the supremum of
the afï¬ne functions y â†’y x âˆ’f (x). In particular, f âˆ—is a proper convex function
which is continuous on its effective domain. If f is itself a proper convex function,
then f âˆ—is also called the conjugate function of f .
Proposition A.6. Let f be a proper convex function.
(a) For all x, y âˆˆR,
xy â‰¤f (x) + f âˆ—(y)
(A.2)
with equality if x belongs to the interior of dom f and if y âˆˆ[f â€²
âˆ’(x), f â€²
+(x)].
(b) If f is lower semicontinuous, then f âˆ—âˆ—= f , i.e.,
f (x) = sup
yâˆˆR

x y âˆ’f âˆ—(y)

,
x âˆˆR.
Proof. (a): The inequality (A.2) is obvious. Now suppose that x0 belongs to the
interior of dom f . Proposition A.4 yields f (x) â‰¥f (x0) + f â€²
Â±(x0)(x âˆ’x0) for all
x in the interior of dom f and, by upper semi-continuity, for all x âˆˆR. Hence,
f (x) â‰¥f (x0) + y0 (x âˆ’x0) whenever y0 âˆˆ[f â€²
âˆ’(x0), f â€²
+(x0)]. This shows that
x y0 âˆ’f (x) â‰¤x0 y0 âˆ’f (x0) for all x âˆˆR, i.e.,
x0 y0 âˆ’f (x0) = sup
xâˆˆR

x y0 âˆ’f (x)

= f âˆ—(y0).
(b): We ï¬rst show the following auxiliary claim: If Î² < f (x0), then there exists
an afï¬ne function h such that h(x0) = Î² and h(x) < f (x) for all x. For the proof of
this claim let
C := { (x, a) âˆˆR2 | f (x) â‰¤a }.
C is usually called the epigraph of f . Lower semicontinuity of f implies that C is
closed. The point (x0, Î²) does not belong to C, and Proposition A.1 thus yields some
Î· = (Î·1, Î·2) âˆˆR2 such that
inf
xâˆˆdom f(Î·1x + Î·2f (x)) â‰¥Î´ :=
inf
(x,a)âˆˆC(Î·1x + Î·2a) > Î·1x0 + Î·2Î².
If f (x0) < âˆ, we get Î·1x0 + Î·2f (x0) > Î·1x0 + Î·2Î². Hence Î·2 > 0, and one checks
that
h(x) := âˆ’Î·1
Î·2
(x âˆ’x0) + Î²
is as desired. If f (x0) = âˆand Î·2 > 0, then the same deï¬nition works. Now
assume that f (x0) = âˆand Î·2 = 0. Letting h(x) := Î´ âˆ’Î·1x we have h(x0) > 0

A.2 Absolutely continuous probability measures
403
and h(x) â‰¤0 for x âˆˆdom f . Since f is proper, the ï¬rst step of the proof of our
claim allows us to construct an afï¬ne function g with g < f . If g(x0) â‰¥Î², then
h := g + Î² âˆ’g(x0) is as desired. Otherwise, we let h(x) := g(x) + Î»h(x) for
Î» := (Î² âˆ’g(x0))/h(x0). This concludes the proof of our auxiliary claim.
Now we can prove part (b) of the assertion. It is clear from the deï¬nition that
f â‰¥f âˆ—âˆ—. Suppose there exists a point x0 such that f (x0) > f âˆ—âˆ—(x0). Take Î² strictly
between f âˆ—âˆ—(x0) and f (x0). By the auxiliary claim, there exists an afï¬ne function
h < f such that h(x0) = Î². Let us write h(x) = y0x + Î±. Then it follows that
f âˆ—(y0) < âˆ’Î± and hence
f âˆ—âˆ—(x0) â‰¥y0x0 âˆ’f âˆ—(y0) > h(x0) = Î²,
which is a contradiction.
A.2 Absolutely continuous probability measures
Suppose that P and Q are two probability measures on a measurable space (, F ).
Deï¬nition A.7. Q is said to be absolutely continuous with respect to P on the
Ïƒ-algebra F , and we write Q â‰ªP , if for all A âˆˆF ,
P [ A ] = 0
"â‡’
Q[ A ] = 0.
If both Q â‰ªP and P â‰ªQ hold, we will say that Q and P are equivalent, and we
will write Q â‰ˆP .
The following characterization of absolute continuity is known as the Radonâ€“
Nikodym theorem:
Theorem A.8 (Radonâ€“Nikodym). Q is absolutely continuous with respect to P on
F if and only if there exists an F -measurable function Ï• â‰¥0 such that

F dQ =

FÏ• dP
for all F -measurable functions F â‰¥0.
(A.3)
Proof. See, e.g., Â§17 of [20].
The function Ï• is called the density or Radonâ€“Nikodym derivative of Q with respect
to P , and we will write
dQ
dP := Ï•.
Clearly, the Radonâ€“Nikodym derivative is uniquely determined through (A.3).

404
Appendix
Corollary A.9. If Q â‰ªP on F , then
Q â‰ˆP
â‡â‡’
dQ
dP > 0 P -a.s.
In this case, the density of P with respect to Q is given by
dP
dQ =
 dQ
dP
âˆ’1
.
Proof. Suppose that Q â‰ªP , let Ï• := dQ/dP . Take an F -measurable function
F â‰¥0. Then

F dQ =

{Ï•>0}
FÏ• dP =

{Ï•>0}
F dQ.
In particular, Q[ Ï• = 0 ] = 0. Replacing F with FÏ•âˆ’1 yields

FÏ•âˆ’1 dQ =

{Ï•>0}
FÏ•âˆ’1 dQ =

{Ï•>0}
FÏ•âˆ’1Ï• dP.
Note that the term on the right-hand side equals

F dP for all F if and only if
P[ Ï• = 0 ] = 0. This proves the result.
Remark A.10. Let us stress that absolute continuity depends on the underlying Ïƒ-
ï¬eld F . For example, let P be the Lebesgue measure on  := [0, 1). Then every
probability measure Q is absolutely continuous with respect to P on a Ïƒ-algebra F0
which is generated by ï¬nitely many intervals [aiâˆ’1, ai) with 0 = a0 < a1 < Â· Â· Â· <
an = 1. However, if we take for F the Borel Ïƒ-algebra on , then for instance a
Dirac point mass Q = Î´x is clearly not absolutely continuous with respect to P on F .
â™¦
While the preceding example shows that, in general, absolute continuity is not
preserved under an enlargement of the underlying Ïƒ-algebra, the next proposition
states that it is safe to take smaller Ïƒ-algebras. This proposition involves the notion
of a conditional expectation
E[ F | F0 ]
of an F -measurable function F â‰¥0 with respect to a probability measure P and a
Ïƒ-algebra F0 âŠ‚F . Recall that E[ F | F0 ] may be deï¬ned as the P -a.s. unique
F0-measurable random variable F0 such that
E[ F ; A0 ] = E[ F0 ; A0 ]
for all A0 âˆˆF0;
(A.4)
see, e.g., Â§15 of [19]. Note also our shorthand convention of writing
E[ F ; A0 ] := E[ F IA0 ].
Clearly, we can replace in (A.4) the class of all indicator functions of sets in F0 by
the class of all bounded F0-measurable functions or by the class of all non-negative
F0-measurable functions.

A.2 Absolutely continuous probability measures
405
Proposition A.11. Suppose that Q and P are two probability measures on the mea-
surable space (, F ) and that Q â‰ªP on F with density Ï•. If F0 is a Ïƒ-algebra
contained in F , then Q â‰ªP on F0, and the corresponding density is given by
dQ
dP

F0
= E[ Ï• | F0 ]
P -a.s.
Proof. Q â‰ªP on F0 follows immediately from the deï¬nition of absolute continuity.
Since Ï• is the density on F âŠ‡F0, it follows for A âˆˆF0 that
Q[ A ] =

A
Ï• dP =

A
E[ Ï• | F0 ] dP.
Therefore the F0-measurable random variable E[ Ï• | F0 ] must coincide with the
density on F0.
Now we prove a formula for computing a conditional expectation EQ[ F | F0 ]
underameasureQintermsofconditionalexpectationswithrespecttoanothermeasure
P with Q â‰ªP.
Proposition A.12. Suppose that Q â‰ªP on F with density Ï•, and that F0 âŠ†F is
another Ïƒ-algebra. Then, for any F -measurable F â‰¥0,
EQ[ F | F0 ] =
1
E[ Ï• | F0 ] Â· E[ FÏ• | F0 ]
Q-a.s.
Proof. Suppose that G0 â‰¥0 is F0-measurable. Then
EQ[ G0F ] = E[ G0FÏ• ] = E

G0 Â· E[ FÏ•
F0 ]

.
Let Ï•0 := E[Ï• | F0]. Proposition A.11 implies that Ï•0 > 0 Q-almost surely. Hence,
we may assume that G0 = 0 P -a.s. on {Ï•0 = 0}, and Corollary A.9 yields
E

G0 Â· E[ FÏ•
F0 ]

= EQ

G0 Â·
1
E[ Ï• | F0 ]E[ FÏ• | F0 ]

.
This proves the assertion.
If neither Q â‰ªP nor P â‰ªQ holds, one can use the following Lebesgue decom-
position of P with respect to Q.
Theorem A.13. For any two probability measures Q and P on (, F ), there exists
a set N âˆˆF with Q[ N ] = 0 and a F -measurable function Ï• â‰¥0 such that
P [ A ] = P [ A âˆ©N ] +

A
Ï• dQ
for all A âˆˆF .
One writes
dP
dQ :=

Ï•
on Nc,
+âˆ
on N.

406
Appendix
Proof. Let R := 1
2(Q + P ). Then both Q and P are absolutely continuous with
respect to R with respective densities dQ/dR and dP/dR. Let
N :=
 dQ
dR = 0

.
Then Q[ N ] = 0. We deï¬ne
dP
dQ := Ï• :=
ï£±
ï£´ï£²
ï£´ï£³
dP
dR Â·
dQ
dR
âˆ’1
on Nc,
+âˆ
on N.
Then, for F -measurable f â‰¥0,

f dP =

N
f dP +

Nc f dP
dR dR
=

N
f dP +

Nc f dP
dR Â·
dQ
dR
âˆ’1
dQ
=

N
f dP +

f Ï• dQ,
where we have used the fact that Q[ N ] = 0 in the last step.
A.3
Quantile functions
Suppose that F : (a, b) â†’R is an increasing function which is not necessarily strictly
increasing. Let
c := lim
xâ†“a F(x)
and
d := lim
xâ†‘b F(x).
Deï¬nition A.14. A function q : (c, d) â†’(a, b) is called an inverse function for F if
F

q(s)âˆ’

â‰¤s â‰¤F

q(s)+

for all s âˆˆ(c, d).
The functions
qâˆ’(s) := sup{ x âˆˆR | F(x) < s }
and
q+(s) := inf{ x âˆˆR | F(x) > s }
are called the left- and right-continuous inverse functions.
The following lemma explains the reason for calling qâˆ’and q+ the left- and
right-continuous inverse functions of F.

A.3 Quantile functions
407
Lemma A.15. A function q : (c, d) â†’(a, b) is an inverse function for F if and only
if
qâˆ’(s) â‰¤q(s) â‰¤q+(s)
for all s âˆˆ(c, d).
In particular, qâˆ’and q+ are inverse functions. Moreover, qâˆ’is left-continuous,
q+ is right-continuous, and every inverse function q is increasing and satisï¬es
q(sâˆ’) = qâˆ’(s) and q(s+) = q+(s) for all s âˆˆ(c, d). In particular, any two
inverse functions coincide a.e. on (c, d).
Proof. We have qâˆ’â‰¤q+, and any inverse function q satisï¬es qâˆ’â‰¤q â‰¤q+, due to
the deï¬nitions of qâˆ’and q+. Hence, the ï¬rst part of the assertion follows if we can
show that F(q+(s)âˆ’) â‰¤s â‰¤F(qâˆ’(s)+) for all s. But x < q+(s) implies F(x) â‰¤s
and y > qâˆ’(s) implies F(y) â‰¥s, which gives the result.
Next, the set { x | F(x) > s } is the union of the sets { x | F(x) > s + Îµ } for Îµ < 0,
and so q+ is right-continuous. An analogous argument shows the left-continuity of
qâˆ’. It is clear that both qâˆ’and q+ are increasing, so that the second part of the
assertion follows.
Remark A.16. The left- and right-continuous inverse functions can also be repre-
sented as
qâˆ’(s) = inf{ x âˆˆR | F(x) â‰¥s }
and
q+(s) = sup{ x âˆˆR | F(x) â‰¤s }.
To see this, note ï¬rst that qâˆ’(s) is clearly dominated by the inï¬mum on the right.
On the other hand, y > qâˆ’(s) implies F(y) â‰¥s, and we get qâˆ’(s) â‰¥inf{ x âˆˆR |
F(x) â‰¥s }. The proof for q+ is analogous.
â™¦
Lemma A.17. Let q be an inverse function for F. Then F is an inverse function for q.
In particular,
F(x+) = inf{ s âˆˆ(c, d) | q(s) > x }
for x with F(x) < d.
(A.5)
Proof. If s > F(x) then q(s) â‰¥qâˆ’(s) â‰¥x, and hence q(F(x)+) â‰¥x. Conversely,
s < F(x) implies q(s) â‰¤q+(s) â‰¤x, and thus q(F(x)âˆ’) â‰¤x. This proves that F is
an inverse function for q.
Remark A.18. By deï¬ning q(d) := b we can extend (A.5) to
F(x+) = inf{ s âˆˆ(c, d] | q(s) > x }
for all x âˆˆ(a, b).
â™¦
From now on we will assume that
F : R âˆ’â†’[0, 1] is increasing and right-continuous
and that F is normalized in the sense that c = 0 and d = 1. This assumption always
holds if F is the distribution function of a random variable X on some probability

408
Appendix
space (, F , P), i.e., F is given by F(x) = P [ X â‰¤x ]. The following lemma
shows in particular that also the converse is true: any normalized increasing right-
continuous functions F : R â†’[0, 1] is the distribution function of some random
variable. By considering the laws of random variables, we also obtain the one-to-one
correspondence F(x) = Âµ((âˆ’âˆ, x]) between all Borel probability measures Âµ on R
and all normalized increasing right-continuous functions F : R â†’[0, 1].
Lemma A.19. Let U be a random variable on a probability space (, F , P ) with a
uniform distribution on (0, 1), i.e., P [ U â‰¤s ] = s for all s âˆˆ(0, 1). If q is an inverse
function of a normalized increasing right-continuous function F : R â†’[0, 1], then
X(Ï‰) := q

U(Ï‰)

has the distribution function F.
Proof. First note that any inverse function for F is measurable because it coincides with
the measurable function q+ outside the countable set { s âˆˆ(0, 1) | qâˆ’(s) < q+(s) }.
Since q(F(x)âˆ’) â‰¤x, we have q(s) â‰¤x for s < F(x). Moreover, Lemma A.17
shows that q(s) â‰¤x implies F(x) â‰¥F(q(s)) = F(q(s)+) â‰¥s. It follows that
(0, F(x)) âŠ†{ s âˆˆ(0, 1) | q(s) â‰¤x } âŠ†(0, F(x)].
Hence,
F(x) = P

U âˆˆ

0, F(x)
 
â‰¤P

U âˆˆ{ s | q(s) â‰¤x }

â‰¤P

U âˆˆ(0, F(x)]

= F(x).
The assertion now follows from the identity P [U âˆˆ{ s | q(s) â‰¤x }] = P [X â‰¤x ].
Deï¬nition A.20. An inverse function q : (0, 1) â†’R of a distribution function F is
called a quantile function. That is, q is a function with
F

q(s)âˆ’

â‰¤s â‰¤F

q(s)

for all s âˆˆ(0, 1).
The left- and rightcontinuous inverses,
qâˆ’(s) = sup{ x âˆˆR | F(x) < s }
and
q+(s) = inf{ x âˆˆR | F(x) > s },
are called the lower and upper quantile functions.
We will often use the generic notation FX for the distribution function of a random
variable X. When the emphasis is on the law Âµ of X, we will also write FÂµ. In
the same manner, we will write qX or qÂµ for the corresponding quantile functions.
The value qX(Î») of a quantile function at a given level Î» âˆˆ(0, 1) is often called a
Î»-quantile of X.
The following result complements LemmaA.19. It implies that a probability space
supports a random variable with uniform distribution on (0, 1) if and only if it supports
any non-constant random variable X with a continuous distribution.

A.3 Quantile functions
409
Lemma A.21. Let X be a random variable with a continuous distribution function
FX and with quantile function qX. Then U := FX(X) is uniformly distributed on
(0, 1), and X = qX(U) P-almost surely.
Proof. Let (, 
F, 
P ) be a probability space that supports a random variable 
U with a
uniform distribution on (0, 1). Then 
X := qX(
U) has the same distribution as X due
to Lemma A.19. Hence, FX(X) and FX(
X) also have the same distribution. On the
other hand, if FX is continuous, then FX

qX(s)

= s and thus FX(
X) = 
U.
To show that X = qX(U) P -a.s., note ï¬rst that q+
X(F(t)) â‰¥t and hence qX(U) =
q+
X(U) â‰¥X P-almostsurely. Nowletf : R â†’(0, 1)beastrictlyincreasingfunction.
Since qX(U) and X have the same law, we have E[ f (qX(U)) ] = E[ f (X) ] and get
P[ qX(U) > X ] = 0.
The following lemma uses the concept of the Fenchelâ€“Legendre transform of a
convex function as introduced in Deï¬nition A.5.
Lemma A.22. Let X be a random variable with distribution function FX and quantile
function qX such that E[ |X| ] < âˆ. Then the Fenchelâ€“Legendre transform of the
convex function
(x) :=
 x
âˆ’âˆ
FX(z) dz = E[ (x âˆ’X)+ ]
is given by
âˆ—(y) = sup
xâˆˆR
(xy âˆ’(x)) =
ï£±
ï£²
ï£³
 y
0
qX(t) dt
if 0 â‰¤y â‰¤1,
+âˆ
otherwise.
Moreover, for 0 < y < 1, the supremum above is attained in x if and only if x is a
y-quantile of X.
Proof. Note ï¬rst that, by Fubiniâ€™s theorem and Lemma A.19,
(x) = E
  x
âˆ’âˆ
I{Xâ‰¤z} dz
!
= E[ (x âˆ’X)+ ] =
 1
0
(x âˆ’qX(t))+ dt.
(A.6)
It follows that âˆ—(y) = +âˆfor y < 0, âˆ—(0) = âˆ’infx (x) = 0,
âˆ—(1) = sup
xâˆˆR
(x âˆ’(x)) = lim
xâ†‘âˆ
 1
0
x âˆ’(x âˆ’qX(t))+ dt =
 1
0
qX(t) dt,
and âˆ—(y) = âˆfor y > 1. To prove our formula for 0 < y < 1, note that the
right-hand and left-hand derivatives of the concave function f (x) = xy âˆ’(x) are
given by f â€²
+(x) = y âˆ’FX(x) and f â€²
âˆ’(x) = y âˆ’FX(xâˆ’). A point x is a maximizer of

410
Appendix
f if f â€²
+(x) â‰¤0 and f â€²
âˆ’(x) â‰¥0, which is equivalent to x being a y-quantile. Taking
x = qX(y) and using (A.6) gives
(x) =
 y
0
(x âˆ’qX(t)) dt = xy âˆ’
 y
0
qX(t) dt,
and our formula follows.
Lemma A.23. If X = f (Y) for an increasing function f and qY is a quantile function
for Y, then f (qY (t)) is a quantile function for X. In particular,
qX(t) = qf (Y)(t) = f (qY (t))
for a.e. t âˆˆ(0, 1),
for any quantile function qX of X.
If f is decreasing, then f (qY (1 âˆ’t)) is a quantile function for X. In particular,
qX(t) = qf (Y)(t) = f (qY (1 âˆ’t))
for a.e. t âˆˆ(0, 1).
Proof. If f is decreasing, then q(t) := f (qY (1 âˆ’t)) satisï¬es
FX(q(t)) = P

f (Y) â‰¤f

qY (1 âˆ’t)
 
â‰¥P [ Y â‰¥qY (1 âˆ’t) ]
â‰¥t
â‰¥P [ Y > qY (1 âˆ’t) ]
â‰¥FX(q(t)âˆ’),
since FY (qY (1 âˆ’t)âˆ’) â‰¤1 âˆ’t â‰¤FY (qY (1 âˆ’t)) by deï¬nition. Hence q(t) =
f (qY (1 âˆ’t)) is a quantile function. A similar argument applies to an increasing
function f .
The following theorem is a version of the Hardyâ€“Littlewood inequalities. They
estimate the expectation E[ XY ] in terms of quantile functions qX and qY .
Theorem A.24. Let X and Y be two random variables on (, F , P ) with quantile
functions qX and qY . Then,
 1
0
qX(1 âˆ’s)qY (s) ds â‰¤E[ XY ] â‰¤
 1
0
qX(s)qY (s) ds,
provided that all integrals are well deï¬ned. If X = f (Y) and the lower (upper) bound
is ï¬nite, then the lower (upper) bound is attained if and only if f can be chosen as a
decreasing (increasing) function.

A.3 Quantile functions
411
Proof. We ï¬rst prove the result for X, Y â‰¥0. By Fubiniâ€™s theorem,
E[ XY ] = E
  âˆ
0
I{X>x} dx
 âˆ
0
I{Y>y} dy
!
=
 âˆ
0
 âˆ
0
P [ X > x, Y > y ] dx dy.
Since
P [ X > x, Y > y ] â‰¥(P[ X > x ] âˆ’P [ Y â‰¤y ] )+
=
 1
0
I{FY (y)â‰¤s} I{sâ‰¤1âˆ’FX(x)} ds,
and since
q+
Z (s) = sup{ x â‰¥0 | FZ(x) â‰¤s } =
 âˆ
0
I{FZ(x)â‰¤s} dx
for any random variable Z â‰¥0, another application of Fubiniâ€™s theorem yields
E[ XY ] â‰¥
 1
0
q+
X(1 âˆ’s) q+
Y (s) ds =
 1
0
qX(1 âˆ’s) qY (s) ds.
In the same way, the upper estimate follows from the inequality
P [ X > x, Y > y ] â‰¤P [ X > x ] âˆ§P [ Y > y ]
=
 1
0
I{FX(x)â‰¤s} I{FY (y)â‰¤s} ds.
For X = f (Y),
E[ XY ] = E[ f (Y)Y ] =
 1
0
f (qY (t))qY (t) dt,
(A.7)
due to Lemma A.19, and so Lemma A.23 implies that the upper and lower bounds are
attained for increasing and decreasing functions, respectively.
Conversely, assume that X = f (Y), and that the upper bound is attained and ï¬nite:
E[ f (Y)Y ] =
 1
0
qX(t)qY (t) dt < âˆ.
(A.8)
Our aim is to show that
X = f (Y) = 
f (Y)
P -a.s.,
where 
f is the increasing function on [0, âˆ) deï¬ned by

f (x) := qX(FY (x))

412
Appendix
if x is a continuity point of FY , and by

f (x) :=
1
FY (x) âˆ’FY (xâˆ’)
 FY (x)
FY (xâˆ’)
qX(t) dt
otherwise. Note that

f (qY ) = EÎ»[ qX | qY ],
(A.9)
where EÎ»[ Â· | qY ] denotes the conditional expectation with respect to qY under the
Lebesgue measure Î» on (0, 1). Hence, (A.8) takes the form
âˆ>
 1
0
f

qY (t)

qY (t) dt =
 1
0

f

qY (t)

qY (t) dt,
(A.10)
where we have used Lemma A.19. Let Î½ denote the distribution of Y. By introducing
the positive measures dÂµ = f dÎ½ and dÂµ = 
f dÎ½, (A.10) can be written as
 âˆ
0
Âµ([y, âˆ)) dy =

x Âµ(dx) =

x Âµ(dx) =
 âˆ
0
Âµ([y, âˆ)) dy.
(A.11)
On the other hand, with g denoting the increasing function I[y,âˆ), the upper Hardyâ€“
Littlewood inequality, Lemma A.23, and (A.9) yield
Âµ([y, âˆ)) = E[ g(Y)f (Y) ]
â‰¤
 1
0
qg(Y)(t)qX(t) dt
=
 1
0
g

qY (t)
 
f

qY (t)

dt
= Âµ([y, âˆ)).
In view of (A.11), we obtain Âµ = Âµ, hence f = 
f Î½-a.s. and X = 
f (Y) P -almost
surely. An analogous argument applies to the lower bound, and the proof for X, Y â‰¥0
is concluded.
The result for general X and Y is reduced to the case of non-negative random
variables by separately considering the positive and negative parts of X and Y:
E[ XY ] = E[ X+Y + ] âˆ’E[ X+Y âˆ’] âˆ’E[ Xâˆ’Y + ] + E[ Xâˆ’Y âˆ’]
â‰¤
 1
0
qX+(t)qY +(t) dt âˆ’
 1
0
qX+(t)qY âˆ’(1 âˆ’t) dt
âˆ’
 1
0
qXâˆ’(1 âˆ’t)qY +(t) dt +
 1
0
qXâˆ’(t)qY âˆ’(t) dt,
(A.12)
where we have used the upper Hardyâ€“Littlewood inequality on the positive terms
and the lower one on the negative terms. Since qZ+(t) = (qZ(t))+ and qZâˆ’(t) =

A.3 Quantile functions
413
(qZ(1 âˆ’t))âˆ’for all random variables due to Lemma A.23, one checks that the right-
hand side of (A.12) is equal to
 1
0 qX(t)qY (t) dt, and we obtain the general form of
the upper Hardyâ€“Littlewood inequality. The same argument also works for the lower
one.
Now suppose that X = f (Y). We ï¬rst note that (A.7) still holds, and so Lemma
A.23 implies that the upper and lower bounds are attained for increasing and decreasing
functions, respectively. Conversely, let us assume that the upper Hardyâ€“Littlewood
inequality is an identity. Then all four inequalities used in (A.12) must also be equal-
ities. Using the fact that XY + = f (Y +)Y + and XY âˆ’= f (âˆ’Y âˆ’)Y âˆ’, the assertion
is reduced to the case of non-negative random variables, and one checks that f can
be chosen as an increasing function. The same argument applies if the lower Hardyâ€“
Littlewood inequality is attained.
Remark A.25. ForindicatorfunctionsoftwosetsAandB inF , theHardyâ€“Littlewood
inequalities reduce to the elementary inequalities

P [ A ] + P [ B ] âˆ’1
+ â‰¤P [ A âˆ©B ] â‰¤P [ A ] âˆ§P [ B ];
(A.13)
note that these estimates were used in the preceding proof. Applied to the sets {X â‰¤x}
and {Y â‰¤y}, where X and Y are random variables with distribution functions FX and
FY and joint distribution function FX,Y deï¬ned by FX,Y (x, y) = P [ X â‰¤x, Y â‰¤y ],
they take the form

FX(x) + FY (y) âˆ’1
+ â‰¤FX,Y (x, y) â‰¤FX(X) âˆ§FY (y).
(A.14)
The estimates (A.13) and (A.14) are often called FrÃ©chet bounds, and the Hardyâ€“
Littlewoodinequalitiesprovidetheirnaturalextensionfromsetstorandomvariables.â™¦
Deï¬nition A.26. A probability space (, .F , P ) is called atomless if it contains no
atoms. That is, there is no set A âˆˆF such that P [ A ] > 0 and P [ B ] = 0 or
P[ B ] = P [ A ] whenever B âˆˆF is a subset of A.
Proposition A.27. For any probability space, the following conditions are equivalent.
(a) (, F , P) is atomless.
(b) There exists an i.i.d. sequence X1, X2, . . . of random variables with Bernoulli
distribution
P [ X1 = 1 ] = P [ X1 = 0 ] = 1
2.
(c) For any Âµ âˆˆM1(R) there exist i.i.d. random variables Y1, Y2, . . . with common
distribution Âµ.
(d) (, F , P) supports a random variable with a continuous distribution.

414
Appendix
Proof.
(a) â‡’(b): We need the following intuitive fact from measure theory: If
(, F , P) is atomless, then for every A âˆˆF and all Î´ with 0 â‰¤Î´ â‰¤P [ A ] there
exists a measurable set B âŠ‚A such that P [ B ] = Î´; see Theorem 9.51 of [2]. Thus,
we may take a set A âˆˆF such that P [ A ] = 1/2 and deï¬ne X1 := 1 on A and
X1 := 0 on Ac. Now suppose that X1, . . . , Xn have already been constructed. Then
P [ X1 = x1, . . . , Xn = xn ] = 2âˆ’n
for all x1, . . . , xn âˆˆ{0, 1}, and this property is equivalent to X1, . . . , Xn being inde-
pendent with the desired symmetric Bernoulli distribution. For all x1, . . . , xn âˆˆ{0, 1}
we may choose a set
B âŠ‚{X1 = x1, . . . , Xn = xn}
such that P[ B ] = 2âˆ’(n+1) and deï¬ne Xn+1 := 1 on B and Xn+1 := 0 on Bc. Clearly,
the collection X1, . . . , Xn+1 is again i.i.d. with a symmetric Bernoulli distribution.
(b) â‡’(c): By relabeling the sequence X1, X2, . . . , we may obtain a double-
indexed sequence (Xi,j)i,jâˆˆN of independent Bernoulli-distributed random variables.
If we let
Ui :=
âˆ

n=1
2âˆ’nXi,n,
then it is straightforward to check that Ui has a uniform distribution. Let q be a quantile
function for Âµ. LemmaA.19 shows that the i.i.d. sequence Yi := q(Ui), i = 1, 2, . . . ,
has common distribution Âµ.
The proofs of the implications (c) â‡’(d) and (d) â‡’(a) are straightforward.
A.4 The Neymanâ€“Pearson lemma
Suppose that P and Q are two probability measures on (, F ), and denote by
P [ A ] = P [ A âˆ©N ] +

A
dP
dQ dQ,
A âˆˆF ,
the Lebesgue decomposition of P with respect to Q as in Theorem A.13. For ï¬xed
c â‰¥0, we let
A0 :=
 dP
dQ > c

,
where we make use of the convention that dP/dQ = âˆon N.
Proposition A.28 (Neymanâ€“Pearson lemma). IfA âˆˆF issuchthatQ[A] â‰¤Q[A0 ],
then P [A] â‰¤P [A0 ].

A.4 The Neymanâ€“Pearson lemma
415
Proof. Let F := IA0 âˆ’IA. Then F â‰¥0 on N, and F Â· (dP /dQ âˆ’c) â‰¥0. Hence
P [ A0 ] âˆ’P [ A ] =

F dP
=

N
F dP +

F Â· dP
dQ dQ
â‰¥c

F dQ
= c(Q[ A0 ] âˆ’Q[ A ]).
This proves the proposition.
Remark A.29. In statistical test theory, A0 is interpreted as the likelihood quotient
test of the null hypothesis Q against the alternative hypothesis P : If the outcome Ï‰
of a statistical experiment is in A0, then the null hypothesis is rejected. There are two
possible kinds of error which can occur in such a test. A type 1 error occurs if the
null hypotheses is rejected despite the fact that Q is the â€œtrueâ€ probability. Similarly,
a type 2 error occurs when the null hypothesis is not rejected, although Q is not
the â€œtrueâ€ probability. The probability of a type 1 error is given by Q[ A0 ]. This
quantity is usually called the size or the signiï¬cance level of the statistical test A0.
A type 2 error occurs with probability P [ (A0)c ]. The complementary probability
P[ A0 ] = 1 âˆ’P [ (A0)c ] is called the power of the test A0. In this setting, the set A
of Proposition A.28 can be regarded as another statistical test to which our likelihood
quotient test is compared. The proposition can thus be restated as follows: A likelihood
quotient test has maximal power on its signiï¬cance level.
â™¦
Indicator functions of sets take only the values 0 and 1.
We now generalize
Proposition A.28 by considering F -measurable functions Ïˆ :  â†’[0, 1]; let R
denote the set of all such functions.
Theorem A.30. Let  := 1
2(P + Q), and deï¬ne the density Ï• := dP/dQ as above.
(a) Take c â‰¥0, and suppose that Ïˆ0 âˆˆR satisï¬es -a.s.
Ïˆ0 =
ï£±
ï£´ï£²
ï£´ï£³
1
on { Ï• > c },
0
on { Ï• < c }.
(A.15)
Then, for any Ïˆ âˆˆR,

Ïˆ dQ â‰¤

Ïˆ0 dQ
"â‡’

Ïˆ dP â‰¤

Ïˆ0 dP.
(A.16)

416
Appendix
(b) For any Î±0 âˆˆ(0, 1) there is some Ïˆ0 âˆˆR of the form (A.15) such that

Ïˆ0 dQ = Î±0. More precisely, if c is an (1 âˆ’Î±0)-quantile of Ï• under Q,
we can deï¬ne Ïˆ0 by
Ïˆ0 = I{Ï•>c} + ÎºI{Ï•=c},
where Îº is deï¬ned as
Îº :=
ï£±
ï£²
ï£³
0
if Q[ Ï• = c ] = 0,
Î±0 âˆ’Q[ Ï• > c ]
Q[ Ï• = c ]
otherwise.
(c) Any Ïˆ0 âˆˆR satisfying (A.16) is of the form (A.15) for some c â‰¥0.
Proof. (a): Take F := Ïˆ0 âˆ’Ïˆ and repeat the proof of Proposition A.28.
(b): Let F denote the distribution function of Ï• under Q. Then Q[ Ï• > c ] =
1 âˆ’F(c) â‰¤Î±0 and
Q[ Ï• = c ] = F(c) âˆ’F(câˆ’)
â‰¥F(c) âˆ’1 + Î±0
= Î±0 âˆ’Q[ Ï• > c ].
Hence 0 â‰¤Îº â‰¤1 and Ïˆ0 belongs to R. The fact that

Ïˆ0 dQ = Î±0 is obvious.
(c): Suppose that Ïˆâˆ—satisï¬es

Ïˆ dQ â‰¤

Ïˆâˆ—dQ
"â‡’

Ïˆ dP â‰¤

Ïˆâˆ—dP.
The cases in which Î±0 :=

Ïˆâˆ—dQ equals 0 or 1 are trivial. For 0 < Î±0 < 1, we
can take Ïˆ0 as in part (b). Then Î±0 =

Ïˆâˆ—dQ =

Ïˆ0 dQ. One also has that

Ïˆâˆ—dP =

Ïˆ0 dP , as can be seen by applying (A.16) to both Ïˆâˆ—and Ïˆ0 with
reversed roles. Hence, for f := Ïˆ0 âˆ’Ïˆâˆ—and N = {Ï• = âˆ},
0 =

f dP âˆ’c

f dQ =

N
f dP +

f Â· (Ï• âˆ’c) dQ.
But (A.15) implies that both f â‰¥0 P -a.s. on N, and f Â· (Ï• âˆ’c) â‰¥0 Q-a.s. Hence
f vanishes -a.s. on {Ï• Ì¸= c}.
Remark A.31. In the context of Remark A.29, an element Ïˆ of R is interpreted as a
randomized statistical test: If Ï‰ is the outcome of a statistical experiment and p :=
Ïˆ(Ï‰), then the null hypothesis is rejected with probability p, i.e., after performing
an independent random coin toss with success probability p. Signiï¬cance level and
power of a randomized test are deï¬ned as above, and a test of the form (A.15) is called
a generalized likelihood quotient test. Thus, the general Neymanâ€“Pearson lemma in
the form of Theorem A.30 can be stated as follows: A randomized test has maximal
power on its signiï¬cance level, if and only if it is a generalized likelihood quotient
test.
â™¦

A.5 The essential supremum of a family of random variables
417
A.5 The essential supremum of a family of random variables
In this section, we discuss the essential supremum of an arbitrary family  of random
variables on a given probability space (, F , P ). Consider ï¬rst the case in which the
set  is countable. Then Ï•âˆ—(Ï‰) := supÏ•âˆˆ Ï•(Ï‰) will also be a random variable, i.e., Ï•âˆ—
is measurable. Measurability of the pointwise supremum, however, is not guaranteed
if  is uncountable. Even if the pointwise supremum is measurable, it may not be
the right concept, when we focus on almost sure properties. This can be illustrated by
taking P as the Lebesgue measure on  := [0, 1] and  := {I{x} | 0 â‰¤x â‰¤1}. Then
supÏ•âˆˆ Ï•(x) â‰¡1 whereas Ï• = 0 P -a.s. for each single Ï• âˆˆ. This suggests the
following notion of an essential supremum deï¬ned in terms of almost sure inequalities.
Theorem A.32. Let  be any set of random variables on (, F , P ).
(a) There exists a random variable Ï•âˆ—such that
Ï•âˆ—â‰¥Ï• P -a.s. for all Ï• âˆˆ.
(A.17)
Moreover, Ï•âˆ—is almost surely unique in the following sense: Any other random vari-
able Ïˆ with property (A.17) satisï¬es Ïˆ â‰¥Ï•âˆ—P -almost surely.
(b) Suppose that  is directed upwards, i.e., for Ï•, Ï• âˆˆ there exists Ïˆ âˆˆ with
Ïˆ â‰¥Ï• âˆ¨Ï•. Then there exists an increasing sequence Ï•1 â‰¤Ï•2 â‰¤Â· Â· Â· in  such that
Ï•âˆ—= limn Ï•n P-almost surely.
Deï¬nition A.33. The random variable Ï•âˆ—in Theorem A.32 is called the essential
supremum of  with respect to P , and we write
ess sup  = ess sup
Ï•âˆˆ
Ï• := Ï•âˆ—.
The essential inï¬mum of  with respect to P is deï¬ned as
ess inf  = ess inf
Ï•âˆˆ
Ï• := âˆ’ess sup
Ï•âˆˆ
(âˆ’Ï•).
Proof of Theorem A.32. Without loss of generality, we may assume that each Ï• âˆˆ
takes values in [0, 1]; otherwise we may consider  := { f â—¦Ï• | Ï• âˆˆ } with
f : R â†’[0, 1] strictly increasing.
If  âŠ‚ is countable, let Ï•(Ï‰) := supÏ•âˆˆ Ï•(Ï‰). Then Ï• is measurable. We
claim that the upper bound
c := sup{ E[ Ï• ] |  âŠ‚ countable }
is attained by some countable âˆ—âŠ‚. To see this, take n with E[ Ï•n ] â†’c and
let âˆ—:= 
n n. Then âˆ—is countable and E[ Ï•âˆ—] = c.
We now show that Ï•âˆ—:= Ï•âˆ—satisï¬es (A.17). Suppose that (A.17) does not hold.
Then there exists Ï• âˆˆ such that P [ Ï• > Ï•âˆ—] > 0. Hence â€² := âˆ—âˆª{Ï•} satisï¬es
E[ Ï•â€² ] > E[ Ï•âˆ—] = c,

418
Appendix
in contradiction to the deï¬nition of c. Furthermore, if Ïˆ is any other random variable
satisfying (A.17), then obviously Ïˆ â‰¥Ï•âˆ—.
Finally, the construction shows that Ï•âˆ—can be approximated by an increasing
sequence if  is directed upwards.
Remark A.34. For a given random variable X let  be the set of all constants c such
that P[ X > c ] > 0. The number
ess sup X := ess sup 
is the smallest constant c â‰¤+âˆsuch that X â‰¤c P -a.s. and called the essential
supremum of X with respect to P . The essential inï¬mum of X is deï¬ned as
ess inf X := ess sup(âˆ’X).
â™¦
A.6 Spaces of measures
Let S be a topological space. S is called metrizable if there exists a metric d on S
which generates the topology of S. That is, the open d-balls
BÎµ(x) := { y âˆˆS | d(x, y) < Îµ },
x âˆˆS, Îµ > 0,
form a base for the topology of S in the sense that a set U âŠ‚S is open if and only if it
can be written as a union of such d-balls. A convenient feature of metrizable spaces
is that their topological properties can be characterized via convergent sequences.
For instance, a subset A of the metrizable space S is closed if and only if for every
convergent sequence in A its limit point is also contained in A. Moreover, a function
f : S â†’R is continuous at y âˆˆS if and only if f (yn) converges to f (y) for every
sequence (yn) converging to y. We write
Cb(S)
for the set of all bounded and continuous functions on S.
The metrizable space S is called separable if there exists a countable dense subset
{ x1, x2, . . . } of S. In this case, the Borel Ïƒ-algebra S of S is generated by the open
d-balls BÎµ(x) with radii Îµ > 0, Îµ âˆˆQ, and centered in x âˆˆ{ x1, x2, . . . }. In what
follows, we will always assume that S is separable and metrizable. If, moreover, the
metric d can be chosen to be complete, i.e., if every Cauchy sequence with respect to
d converges to some point in S, then S is called a Polish space. Clearly, Rd with the
Euclidean distance is a complete and separable metric space, hence a Polish space.
Let us denote by
M(S) := M(S, S)

A.6 Spaces of measures
419
the set of all non-negative ï¬nite measures on (S, S). Every Âµ âˆˆM(S) is of the
form Âµ = Î± Î½ for some factor Î± âˆˆ[0, âˆ) and some probability measure Î½ on the
measurable space (S, S). The space of all probability measures on (S, S) is denoted
by
M1(S) = M1(S, S).
Deï¬nition A.35. The weak topology on M(S) is the coarsest topology for which all
mappings
M(S) âˆ‹Âµ â†’

f dÂµ,
f âˆˆCb(S),
are continuous.
It follows from this deï¬nition that the sets
UÎµ

Âµ; f1, . . . , fn

:=
n

i=1
$
Î½ âˆˆM(S)



fi dÎ½ âˆ’

fi dÂµ
 < Îµ
%
(A.18)
for Âµ âˆˆM(S), Îµ > 0, n âˆˆN, and f1, . . . , fn âˆˆCb(S) form a base for the weak
topology on M(S); for details see, e.g., Section 2.13 of [2].
Since the constant
function 1 is continuous,
M1(S) =
$
Âµ âˆˆM(S)
 Âµ(S) =

1 dÂµ = 1
%
is a closed subset of M(S). A well-known example for weak convergence of proba-
bility measures is the classical central limit theorem; the following version is needed
in Section 5.7.
Theorem A.36. Suppose that for each N âˆˆN we are given N independent random
variables Y (N)
1
, . . . , Y (N)
N
on (N, FN, PN) which satisfy the following conditions:
â€¢ There are constants Î³N such that Î³N â†’0 and |Y (N)
k
| â‰¤Î³N PN-a.s.
â€¢
N

k=1
EN[ Y (N)
k
] âˆ’â†’m.
â€¢
N

k=1
varN

Y (N)
k

âˆ’â†’Ïƒ 2, where varN denotes the variance with respect to PN.
Then the distributions of
ZN :=
N

k=1
Y (N)
k
,
N = 1, 2, . . . ,
converge weakly to the normal distribution with mean m and variance Ïƒ 2.

420
Appendix
Proof. See, for instance, the corollary to Theorem 7.1.2 of [40].
The following theorem allows us to examine the weak topology in terms of weakly
converging sequences of measures.
Theorem A.37. The space M(S) is separable and metrizable for the weak topology.
If S is Polish, then so is M(S). Moreover, if S0 is a dense subset of S, then the set
$
n

i=1
Î±iÎ´xi
 Î±i âˆˆQ+, xi âˆˆS0, n âˆˆN
%
of simple measures on S0 with rational weights is dense in M(S) for the weak topology.
Proof. In most textbooks on measure theory, the previous result is proved for M1(S)
instead of M(S); see, e.g., Theorem 14.12 of [2]. The general case requires only
minor modiï¬cations. It is treated in full generality in Chapter IX, Â§5, of [27].
The following characterization of weak convergence in M(S) is known as the
â€œportmanteau theoremâ€.
Theorem A.38. For any sequence Âµ, Âµ1, Âµ2, . . . of measures in M(S), the following
conditions are equivalent:
(a) The sequence (Âµn)nâˆˆN converges weakly to Âµ.
(b) Âµn(S) â†’Âµ(S) and
lim sup
nâ†‘âˆ
Âµn(A) â‰¤Âµ(A)
for every closed set A âŠ‚S.
(c) Âµn(S) â†’Âµ(S) and
lim inf
nâ†‘âˆÂµn(U) â‰¥Âµ(U)
for every open set U âŠ‚S.
(d) Âµn(B) â†’Âµ(B) for every Borel set B whose boundary âˆ‚B is not charged by Âµ
in the sense that Âµ(âˆ‚B) = 0.
(e)

f dÂµn â†’

f dÂµ for every bounded measurable function f which is Âµ-a.e.
continuous.
(f)

f dÂµn â†’

f dÂµ for every bounded and uniformly continuous function f .
Proof. The result is proved for M1(S) in [2], Theorem 14.3. The general case requires
only minor modiï¬cations; see Chapter IX of [27].

A.6 Spaces of measures
421
Remark A.39. It follows from the portmanteau theorem that, on S = R, weak con-
vergence of Âµn to Âµ is equivalent to the condition
F(xâˆ’) â‰¤lim inf
nâ†‘âˆFn(x) â‰¤lim sup
nâ†‘âˆ
Fn(x) â‰¤F(x)
for the corresponding distribution functions (Fn) and F, or to the pointwise conver-
gence of Fn(x) to F(x) in any continuity point of F. It is also equivalent to the
condition
qâˆ’
Âµ (t) â‰¤lim inf
nâ†‘âˆqn(t) â‰¤lim sup
nâ†‘âˆ
qn(t) â‰¤q+
Âµ (t)
for any choice of the quantile functions qn of Âµn, or to the pointwise convergence of
qn(t) to q+
Âµ (t) in any continuity point of q+
Âµ .
â™¦
The next theorem can be regarded as a stability result for weak convergence.
Theorem A.40 (Slutsky). Suppose that, for n âˆˆN, Xn and Yn are real-valued random
variables on (n, Fn, Pn) such that the laws of Xn converge weakly to the law of X,
and the laws of Yn converge weakly to Î´y for some y âˆˆR. Then:
(a) The laws of Xn + Yn converge weakly to the law of X + y.
(b) The laws of Xn Â· Yn converge weakly to the law of X Â· y.
Proof. See, for instance, Section 8.1 of [39].
We turn now to the fundamental characterization of the relative compact subsets
of M(S) known as Prohorovâ€™s theorem.
Theorem A.41 (Prohorov). Let S be a Polish space. A subset M of M(S) is relatively
compact for the weak topology if and only if
sup
ÂµâˆˆM
Âµ(S) < âˆ
and if M is tight, i.e., if for every Îµ > 0 there exists a compact subset K of S such that
sup
ÂµâˆˆM
Âµ(Kc) â‰¤Îµ.
In particular, M1(S) is weakly compact if S is a compact metric space.
Proof. For a proof in the context of probability measures, see for instance Theorem 1
in Â§III.2 of [187]. The general case requires only minor modiï¬cations; see Chapter IX
of [27].

422
Appendix
Example A.42. Take for S the positive half axis [0, âˆ) and deï¬ne
Âµn := n âˆ’1
n
Î´0 + 1
n Î´n
and
Âµ := Î´0,
where Î´x denotes the Dirac point mass in x âˆˆS, i.e., Î´x(A) = IA(x). Clearly,

f dÂµn âˆ’â†’

f dÂµ
for all f âˆˆCb(S)
so that Âµn converges weakly to Âµ. However, if we take the continuous but unbounded
function f (x) = x, then

f dÂµn = 1 for all n so that
lim
nâ†‘âˆ

f dÂµn = 1 Ì¸=

f dÂµ.
â™¦
The preceding example shows that the weak topology is not an appropriate topol-
ogy for ensuring the convergence of integrals against unbounded test functions. Let
us introduce a suitable transformation of the weak topology which will allow us to
deal with certain classes of unbounded functions.
We ï¬x a continuous function
Ïˆ : S â†’[1, âˆ)
which will serve as a gauge function, and we denote by
CÏˆ(S)
the linear space of all continuous functions f on S for which there exists a constant c
such that
|f (x)| â‰¤c Â· Ïˆ(x)
for all x âˆˆS.
Furthermore, we denote by
MÏˆ(S)
the set of all measures Âµ âˆˆM(S) such that

Ïˆ dÂµ < âˆ.
Deï¬nition A.43. The Ïˆ-weak topology on MÏˆ(S) is the coarsest topology for which
all mappings
MÏˆ(S) âˆ‹Âµ â†’

f dÂµ,
f âˆˆCÏˆ(S),
are continuous.
Since the gauge function Ïˆ takes values in [1, âˆ), every bounded continuous
function f belongs to CÏˆ(S). It follows that all mappings
MÏˆ(S) âˆ‹Âµ â†’

f dÂµ,
f âˆˆCb(S),

A.6 Spaces of measures
423
are continuous. In particular, the set
MÏˆ
1 (S) :=

Âµ âˆˆMÏˆ(S) | Âµ(S) = 1

of all Borel probability measures in MÏˆ(S) is closed for the Ïˆ-weak topology.
As in the case of the weak topology, it follows that the sets
UÏˆ
Îµ

Âµ; f1, . . . , fn

:=
n

i=1
$
Î½ âˆˆMÏˆ(S)



fi dÎ½ âˆ’

fi dÂµ
 < Îµ
%
for Âµ âˆˆMÏˆ(S), Îµ > 0, n âˆˆN, and f1, . . . , fn âˆˆCÏˆ(S) form a base for the Ïˆ-weak
topology on MÏˆ(S).
Let us deï¬ne a mapping
 : M(S) âˆ’â†’MÏˆ(S)
by
d(Âµ) := 1
Ïˆ dÂµ,
Âµ âˆˆM(S).
Clearly,  is a bijective mapping between the two sets M(S) and MÏˆ(S). Moreover,
if we apply  to an open neighborhood for the weak topology as in (A.18), we get


UÎµ(Âµ; f1, . . . , fn)

= UÏˆ
Îµ

(Âµ); f1Ïˆ, . . . , fnÏˆ

.
Since f Ïˆ âˆˆCÏˆ(S) for each bounded and continuous function f , and since every
function in CÏˆ(S) arises in this way, we conclude that a subset U of M(S) is weakly
open if and only if (U) is open for the Ïˆ-weak topology. Hence,  is a homeomor-
phism. This observation allows us to translate statements for the weak topology into
results for the Ïˆ-weak topology:
Corollary A.44. For separable and metrizable S, the space MÏˆ(S) is separable and
metrizable for the Ïˆ-weak topology. If S is Polish, then so is MÏˆ(S). Moreover, if S0
is a dense subset of S, then the set
$
n

i=1
Î±iÎ´xi
 Î±i âˆˆQ+, xi âˆˆS0, n âˆˆN
%
of simple measures on S0 with rational weights is dense in MÏˆ(S) for the Ïˆ-weak
topology.
The preceding corollary implies in particular that it sufï¬ces to consider Ïˆ-weakly
converging sequences when studying the Ïˆ-weak topology. The following corollary
is implied by the portmanteau theorem.

424
Appendix
Corollary A.45. A sequence (Âµn)nâˆˆN in MÏˆ(S) converges Ïˆ-weakly to Âµ if and only
if

f dÂµn âˆ’â†’

f dÂµ
for every measurable function f which is Âµ-a.e. continuous and for which exists a
constant c such that |f | â‰¤c Â· Ïˆ Âµ-almost everywhere.
Prohorovâ€™s theorem translates as follows to our present setting:
Corollary A.46. Let S be a Polish space and M be a subset of MÏˆ(S). The following
conditions are equivalent:
(a) M is relatively compact for the Ïˆ-weak topology.
(b) We have
sup
ÂµâˆˆM

Ïˆ dÂµ < âˆ,
and for every Îµ > 0 there exists a compact subset K of S such that
sup
ÂµâˆˆM

Kc Ïˆ dÂµ â‰¤Îµ .
(c) There exists a measurable function Ï† : S â†’[1, âˆ] such that each set
{ x âˆˆS | Ï†(x) â‰¤n Ïˆ(x) } ,
n âˆˆN ,
is relatively compact in S, and such that
sup
ÂµâˆˆM

Ï† dÂµ < âˆ.
Proof. (a)â‡”(b): This follows immediately from Theorem A.41 and the fact that  is
a homeomorphism.
(b) â‡’(c): Take an increasing sequence K1 âŠ‚K2 âŠ‚Â· Â· Â· of compact sets in S such
that
sup
ÂµâˆˆM

Kcn
Ïˆ dÂµ â‰¤2âˆ’n,
and deï¬ne Ï† by
Ï†(x) := Ïˆ(x) +
âˆ

n=1
IKc
n (x)Ïˆ(x).
Then {Ï† â‰¤nÏˆ} âŠ‚Kn. Moreover,
sup
ÂµâˆˆM

Ï† dÂµ â‰¤sup
ÂµâˆˆM

Ïˆ dÂµ + 1 < âˆ.

A.6 Spaces of measures
425
(c) â‡’(b): Since {Ï† â‰¤Ïˆ} is relatively compact, we have that
c := sup{ Ïˆ(x) | x âˆˆS, Ï†(x) â‰¤Ïˆ(x) } < âˆ,
and hence
sup
ÂµâˆˆM

Ïˆ dÂµ â‰¤(1 + c) sup
ÂµâˆˆM

Ï† dÂµ < âˆ.
Moreover, for n â‰¥Îµâˆ’1 supÂµâˆˆM

Ï† dÂµ, the relatively compact set K := {Ï† â‰¤nÏˆ}
satisï¬es
sup
ÂµâˆˆM

Kc Ïˆ dÂµ â‰¤1
n sup
ÂµâˆˆM

Kcn
Ï† dÂµ â‰¤Îµ,
and so condition (b) is satisï¬ed.
We turn now to the task of identifying a linear functional on a space of functions
as the integral with respect to a suitable measure.
Theorem A.47 (Riesz). Let  be a compact metric space and suppose that I is a
linear functional on C() that is non-negative in the sense that f â‰¥0 everywhere on
 implies I(f ) â‰¥0. Then there exists a unique positive Borel measure Âµ on  such
that
I(f ) =

f dÂµ
for all f âˆˆC().
To state a general version of the preceding theorem, we need the notion of a vector
lattice of real-valued functions on an arbitrary set . This is a linear space L that
is stable under the operation of taking the pointwise maximum: for f, g âˆˆL also
f âˆ¨g âˆˆL. One example is the space of all bounded measurable functions on (, F ).
Another one is the space Cb() of all bounded continuous functions on a separable
metric space . In this case, the Ïƒ-algebra Ïƒ(L) generated by L coincides with the
Borel Ïƒ-algebra of the underlying metric space. Note that Theorem A.47 is implied
by the following result, together with Diniâ€™s lemma as recalled in Remark 4.26.
Theorem A.48 (Daniellâ€“Stone). Let I be a linear functional on a vector lattice L of
functions on  such that the following conditions hold:
(a) I is non-negative in the sense that f â‰¥0 everywhere on  implies I(f ) â‰¥0.
(b) If (fn) is a sequence in L such that fn â†˜0, then I(fn) â†˜0.
Then there exists a unique positive measure Âµ on the measurable space

, Ïƒ(L)

such that
I(f ) =

f dÂµ
for all f âˆˆL.

426
Appendix
Proof. See, e.g., Theorem 4.5.2 of [72] or Satz 40.5 in [18].
Without the continuity assumption (b), the preceding result takes a different form,
as we will discuss now.
Deï¬nition A.49. Let (, F ) be a measurable space. A mapping Âµ : F â†’R is
called a ï¬nitely additive set function if Âµ(âˆ…) = 0, and if for any ï¬nite collection
A1, . . . , An âˆˆF of mutually disjoint sets
Âµ
	 n

i=1
Ai

=
n

i=1
Âµ(Ai).
We denote by M1,f := M1,f (, F ) the set of all those ï¬nitely additive set functions
Âµ : F â†’[0, 1] which are normalized to Âµ() = 1. The total variation of a ï¬nitely
additive set function Âµ is deï¬ned as
âˆ¥Âµâˆ¥var := sup
$
n

i=1
|Âµ(Ai)|
 A1, . . . , An disjoint sets in F , n âˆˆN
%
.
The space of all ï¬nitely additive measures Âµ whose total variation is ï¬nite is denoted
by ba(, F ).
We will now give a brief outline of the integration theory with respect to a measure
Âµ âˆˆba := ba(, F ); for details we refer to Chapter III in [76]. The space X of
all bounded measurable functions on (, F ) is a Banach space if endowed with the
supremum norm,
âˆ¥Fâˆ¥:= sup
Ï‰âˆˆ
F(Ï‰)
,
F âˆˆX.
Let X0 denote the linear subspace of all ï¬nitely valued step functions which can be
represented in the form
F =
n

i=1
Î±i IAi ,
for some n âˆˆN, Î±i âˆˆR, and disjoint sets A1, . . . , An âˆˆF . For this F we deï¬ne

F dÂµ :=
n

i=1
Î±i Âµ(Ai),
and one can check that this deï¬nition is independent of the particular representation
of F. Moreover,


F dÂµ
 â‰¤âˆ¥Fâˆ¥Â· âˆ¥Âµâˆ¥var.
(A.19)
Since X0 is dense in X with respect to âˆ¥Â· âˆ¥, this inequality allows us to deï¬ne
the integral on the full space X as the extension of the continuous linear functional

A.6 Spaces of measures
427
X0 âˆ‹F â†’

F dÂµ. Clearly, M1,f is contained in ba, and we will denote the integral
of a function F âˆˆX with respect to Q âˆˆM1,f by
EQ[ F ] :=

F dQ.
Theorem A.50. The integral
â„“(F) =

F dÂµ,
F âˆˆX,
deï¬nes a one-to-one correspondence between continuous linear functionals â„“on X
and ï¬nitely additive set functions Âµ âˆˆba.
Proof. By deï¬nition of the integral and by (A.19), it is clear that any Âµ âˆˆba deï¬nes a
continuous linear functional on X. Conversely, if a continuous linear functional â„“is
given, then we can deï¬ne a ï¬nitely additive set function Âµ on (, F ) by
Âµ(A) := â„“(IA),
A âˆˆF .
If L â‰¥0 is such that â„“(F) â‰¤L for âˆ¥Fâˆ¥â‰¤1, then âˆ¥Âµâˆ¥var â‰¤L, and so Âµ âˆˆba. One
then checks that the integral with respect to Âµ coincides with â„“on X0. Since X0 is
dense in X, we see that

FdÂµ and â„“(F) coincide for all F âˆˆX.
Remark A.51. Theorem A.50 yields in particular a one-to-one correspondence be-
tween set functions Q âˆˆM1,f and continuous linear functionals â„“on X such that
â„“(1) = 1 and â„“(X) â‰¥0 for X â‰¥0.
â™¦
Example A.52. Clearly, the set M1,f coincides with the set M1 := M1(, F ) of all
Ïƒ-additive probability measures if (, F ) can be reduced to a ï¬nite set, in the sense
that F is generated by a ï¬nite partition of . Otherwise, M1,f is strictly larger than
M1. Suppose in fact that there are inï¬nitely many disjoint sets A1, A2, . . . âˆˆF , take
Ï‰n âˆˆAn, and deï¬ne
â„“n(X) := 1
n
n

i=1
X(Ï‰i),
n = 1, 2, . . .
The continuous linear functionals â„“n on X belong to the unit ball B1 in the dual Banach
space Xâ€². By Theorem A.62, there exists a cluster point â„“of (â„“n). For any X âˆˆX
there is a subsequence (nk) such that â„“nk(X) â†’â„“(X). This implies that â„“(X) â‰¥0
for X â‰¥0 and â„“(1) = 1. Hence, Theorem A.50 allows us to write â„“(X) = EQ[ X ]
for some Q âˆˆM1,f . But Q is not Ïƒ-additive, since Q[ An ] = â„“(IAn) = 0 and
Q
 
n An

= 1.
â™¦

428
Appendix
A.7 Some functional analysis
Numerous arguments in this book involve inï¬nite-dimensional vector spaces. Typical
examples are the spaces Lp for 0 â‰¤p â‰¤âˆ, which we will introduce below. To this
end, we ï¬rst take p âˆˆ(0, âˆ] and denote by Lp(, F , P ) the set of all F -measurable
functions Z on (, F , P) such that âˆ¥Zâˆ¥p < âˆ, where
âˆ¥Zâˆ¥p :=
ï£±
ï£´ï£²
ï£´ï£³
E[ |Z|p ]1/p,
if 0 < p < âˆ,
inf

c â‰¥0 | P [ |Z| > c ] = 0

,
if p = âˆ.
(A.20)
Let us also introduce the space L0(, F , P), deï¬ned as the set of all P -a.s. ï¬nite
random variables. If no ambiguity with respect to Ïƒ-algebra and measure can arise, we
may sometimes write Lp(P ) or just Lp instead of Lp(, F , P ). For p âˆˆ[0, âˆ], the
space Lp(, F , P), or just Lp, is obtained from Lp by identifying random variables
which coincide up to a P -null set. Thus, Lp consists of all equivalence classes with
respect to the equivalence relation
Z âˆ¼Z
: â‡â‡’
Z = Z P -a.s.
(A.21)
If p âˆˆ[1, âˆ] then the vector space Lp is a Banach space with respect to the norm
âˆ¥Â·âˆ¥p deï¬ned in (A.20), i.e., every Cauchy sequence with respect to âˆ¥Â· âˆ¥p converges to
some element in Lp. In principle, one should distinguish between a random variable
Z âˆˆLp and its associated equivalence class [Z] âˆˆLp, of which Z is a representative
element.
In order to keep things simple, we will follow the usual convention of
identifying Z with its equivalence class, i.e., we will just write Z âˆˆLp.
On the space L0, we use the topology of convergence in P -measure. This topology
is generated by the metric
d(X, Y) := E[ |X âˆ’Y| âˆ§1 ],
X, Y âˆˆL0.
(A.22)
Note, however, that d is not a norm.
Deï¬nition A.53. A linear space E which carries a topology is called a topological
vector space if every singleton {x} for x âˆˆE is a closed set, and if the vector space
operations are continuous in the following sense:
(x, y) âˆ’â†’x + y
is a continuous mapping from E Ã— E into E, and
(Î±, x) âˆ’â†’Î±x
is a continuous mapping from R Ã— E into E.

A.7 Some functional analysis
429
Clearly, every Banach space is a topological vector space. The following result is a
generalization of the separation argument in PropositionA.1 to an inï¬nite-dimensional
setting.
Theorem A.54. In a topological vector space E, any two disjoint convex sets B and
C, one of which has an interior point, can be separated by a non-zero continuous
linear functional â„“on E, i.e.,
â„“(x) â‰¤â„“(y)
for all x âˆˆC and all y âˆˆB.
(A.23)
Proof. See [76], Theorem V.2.8.
If one wishes to strictly separate two convex sets by a linear functional in the sense
that one has a strict inequality in (A.23), then one needs additional conditions both on
the convex sets and on the underlying space E.
Deï¬nition A.55. A topological vector space E is called a locally convex space if its
topology has a base consisting of convex sets.
If E is a Banach space with norm âˆ¥Â· âˆ¥, then the open balls
{ y âˆˆE | âˆ¥y âˆ’xâˆ¥< r },
x âˆˆE, r > 0,
form by deï¬nition a base for the topology of E. Since such balls are convex sets,
any Banach space is locally convex. The space L0(, F , P ) with the topology of
convergence in P -measure, however, is not locally convex if (, F , P ) has no atoms;
see, e.g., Theorem 12.41 of [2].
The following theorem is one variant of the classical Hahnâ€“Banach theorem on
the existence of â€œseparating hyperplanesâ€.
Theorem A.56 (Hahnâ€“Banach). Suppose that B and C are two non-empty, disjoint,
and convex subsets of a locally convex space E. Then, if B is compact and C is closed,
there exists a continuous linear functional â„“on E such that
sup
xâˆˆC
â„“(x) < inf
yâˆˆB
â„“(y).
Proof. See, for instance, [178], p. 65, or [76], Theorem V.2.10.
One corollary of the preceding result is that, on a locally convex space E, the
collection
Eâ€² := { â„“: E â†’R | â„“is continuous and linear }
separates the points of E, i.e., for any two distinct points x, y âˆˆE there exists some
â„“âˆˆEâ€² such that â„“(x) Ì¸= â„“(y). The space Eâ€² is called the dual or the dual space of E.
For instance, if p âˆˆ[1, âˆ) it is well-known that the dual of Lp(, F , P ) is given by
Lq(, F , P), where 1
p + 1
q = 1. The following deï¬nition describes a natural way in
which locally convex topologies often arise.

430
Appendix
Deï¬nition A.57. Let E be linear space, and suppose that F is a linear class of linear
functionals on E which separates the points of E. The F-topology on E, denoted by
Ïƒ(E, F), is the topology on E which is obtained by taking as a base all sets of the
form
{ y âˆˆE | |â„“i(y) âˆ’â„“i(x)| < r, i = 1, . . . , n },
where n âˆˆN, x âˆˆE, â„“i âˆˆF, and r > 0. If E already carries a locally convex
topology, then the Eâ€²-topology Ïƒ(E, Eâ€²) is called the weak topology on E.
IfE isinï¬nite-dimensional, thenE istypicallynot metrizableintheF-topology. In
this case, it may not sufï¬ce to consider converging sequences when making topological
assertions; see, however, TheoremA.65 below. The following proposition summarizes
a few elementary properties of the F-topology.
Proposition A.58. Consider the situation of the preceding deï¬nition. Then:
(a) E is a locally convex space for the F-topology.
(b) The F-topology is the coarsest topology on E for which every â„“âˆˆF is contin-
uous.
(c) The dual of E for the F-topology is equal to F.
Proof. See, e.g., Section V.3 of [76].
Theorem A.59. Suppose that E is a locally convex space and that C is a convex subset
of E. Then C is weakly closed if and only if C is closed in the original topology of E.
Proof. If the convex set C is closed in the original topology then, by Theorem A.56,
it is the intersection of the halfspaces H = {â„“â‰¤c} such that H âŠƒC, and thus closed
in the weak topology Ïƒ(E, Eâ€²). The converse is clear.
For a given locally convex space E we can turn things around and consider E as
a set of linear functionals on the dual space Eâ€² by letting x(â„“) := â„“(x) for â„“âˆˆEâ€² and
x âˆˆE. The E-topology Ïƒ(Eâ€², E) obtained in this way is called the weakâˆ—topology
on Eâ€². According to part (c) of Proposition A.58, E is then the topological dual of
(Eâ€², Ïƒ(Eâ€², E)). For example, the Banach space Lâˆ:= Lâˆ(, F , P ) is the dual of
L1, but the converse is generally not true. However, L1 becomes the dual of Lâˆif
we endow Lâˆwith the weakâˆ—topology Ïƒ(Lâˆ, L1).
The mutual duality between E and Eâ€² allows us to state a general version of part (b)
of Proposition A.6. As in the one-dimensional situation of Deï¬nition A.3, a convex
function f : E â†’R âˆª{+âˆ} is called a proper convex function if f (x) < âˆfor
some x âˆˆR.
Deï¬nition A.60. The Fenchelâ€“Legendre transform of a function f : E â†’Râˆª{+âˆ}
is the function f âˆ—on Eâ€² deï¬ned by
f âˆ—(â„“) := sup
xâˆˆE

â„“(x) âˆ’f (x)

.

A.7 Some functional analysis
431
If f Ì¸â‰¡+âˆ, then f âˆ—is a proper convex and lower semicontinuous function as the
supremum of afï¬ne functions. If f is itself a proper convex function, then f âˆ—is also
called the conjugate function of f .
Theorem A.61. Let f be a proper convex function on a locally convex space E. If f
is lower semicontinuous with respect to Ïƒ(E, Eâ€²), then f = f âˆ—âˆ—.
It is straightforward to adapt the proof we gave in the one-dimensional case of
Proposition A.6 to the inï¬nite-dimensional situation of Theorem A.61; all one has
to do is to replace the separating hyperplane lemma by the Hahnâ€“Banach separation
theorem in the form of Theorem A.56.
One of the reasons for considering the weak topology on a Banach space or, more
generally, on a locally convex space is that typically more sets are compact for the
weak topology than for the original topology. The following result shows that the
unit ball in the dual of a Banach space is weakâˆ—compact. Here we use the fact that a
Banach space (E, âˆ¥Â· âˆ¥E) deï¬nes the following norm on its dual Eâ€²:
âˆ¥â„“âˆ¥Eâ€² :=
sup
âˆ¥xâˆ¥Eâ‰¤1
â„“(x),
â„“âˆˆEâ€².
Theorem A.62 (Banachâ€“Alaoglu). Let E be a Banach space with dual Eâ€². Then
{ x âˆˆEâ€² | âˆ¥xâˆ¥Eâ€² â‰¤r } is weakâˆ—compact for every r â‰¥0.
Proof. See, e.g., Theorem IV.21 in [164].
Theorem A.63 (Kreinâ€“Å mulian). Let E be a Banach space and suppose that C is a
convex subset of the dual space Eâ€². Then C is weakâˆ—closed if and only if
C âˆ©{ x âˆˆEâ€² | âˆ¥xâˆ¥Eâ€² â‰¤r }
is weakâˆ—closed for each r > 0.
Proof. See Theorem V.5.7 in [76].
The preceding theorem implies the following characterization of weakâˆ—closed sets
in Lâˆ.
Lemma A.64. A convex subset C of Lâˆis weakâˆ—closed if for every r > 0
Cr := C âˆ©{ X âˆˆLâˆ| âˆ¥Xâˆ¥âˆâ‰¤r }
is closed in L1.
Proof. Since Cr is convex and closed in L1, it is weakly closed in L1 by TheoremA.59.
Since the natural injection

Lâˆ, Ïƒ(Lâˆ, L1)

âˆ’â†’

L1, Ïƒ(L1, Lâˆ)


432
Appendix
is continuous, Cr is Ïƒ(Lâˆ, L1)-closed in Lâˆ. Thus, C is weakâˆ—closed due to the
Kreinâ€“Å mulian theorem.
Finally, we state a few fundamental results on weakly compact sets.
Theorem A.65 (Eberleinâ€“Å mulian). For any subset A of a Banach space E, the fol-
lowing conditions are equivalent:
(a) A is weakly sequentially compact, i.e., any sequence in A has a subsequence
which converges weakly in E.
(b) A is weakly relatively compact, i.e., the weak closure of A is weakly compact.
Proof. See [76], Theorem V.6.1.
Theorem A.66 (James). In a Banach space E, a bounded and weakly closed convex
subset A is weakly compact if and only if every continuous linear functional attains
its supremum on A.
Proof. See, for instance, [86].
The following result characterizes the weakly relatively compact subsets of the
Banach space L1 := L1(, F , P). It implies, in particular, that a set of the form
{ f âˆˆL1 | |f | â‰¤g } with given g âˆˆL1 is weakly compact in L1.
Theorem A.67 (Dunfordâ€“Pettis). A subset A of L1 is weakly relatively compact if
and only if it is bounded and uniformly integrable.
Proof. See, e.g., Theorem IV.8.9 or Corollary IV.8.11 in [76].

Notes
In these notes, we do not make any attempt to give a systematic account of all the
sources which have been relevant for the development of the ï¬eld. We simply mention
a number of references which had a direct inï¬‚uence on our decisions how to present
the topics discussed in this book. A more comprehensive list of references can be
found, e.g., in [129].
Chapter 1: The proof of Theorem 1.6 is based on Dalang, Morton, andWillinger [51].
Remark 1.17 and Example 1.18 are taken from Schachermayer [175]. Section 1.6
is mainly based on [175], with the exception of Lemma 1.63, which is taken from
Kabanov and Stricker [122]. Our proof of Lemma 1.67 combines ideas from [122]
with the original argument in [175], as suggested to us by Irina Penner. For a historical
overview of the development of arbitrage pricing and for an outlook to continuous-time
developments, we refer to Schachermayer [177]. For some mathematical connections
between superhedging of call options as discussed in Section 1.3 and bounds on stop-
loss premiums in insurance see Chapter 5 of Goovaerts et al. [105].
Chapter 2: The results on the structure of preferences developed in this chapter are,
to a large extent, standard topics in mathematical economics. We refer to textbooks
on expected utility theory such as Fishburn [84], [85], Kreps [138], or Savage [174],
and to the survey articles in [10], [17]. The ideas and results of Section 2.1 go back to
classical references such as Debreu [57], Eilenberg [78], Milgram [151], and Rader
[163]. The theory of afï¬ne numerical representations in Section 2.2 was initiated by
von Neumann and Morgenstern [155] and further developed by Herstein and Milnor
[112]. The drastic consequences of the assumption that a favorable bet is rejected at
any level of wealth, as explained in Lemma 2.50, were stressed by Rabin [162]. The
discussion of the partial orders â‰½uni, â‰½mon, and â‰½bal in Sections 2.4 and 2.6 has a long
history. A ï¬rst version of Theorem 2.58 is already contained in Hardy, Littlewood, and
Polya [107]. A complete treatment was given by Strassen [191]; this paper is also the
source for Section 2.6. The economic interpretation ofTheorem 2.58 was developed by
Rothschild and Stiglitz [170], [171]. The analysis of robust preferences in Section 2.5
is mainly based on the ideas of Savage [174], Anscombe and Aumann [5], and Gilboa
and Schmeidler [104]. See Gilboa [103] for an alternative axiomatic approach to
the characterization in part (b) of Theorem 2.80, and [131] for a survey of related
developments. In the context of robust statistics, a special case of Proposition 2.85
appears in Huber [114].
Chapter 3: Given a preference relation of von Neumannâ€“Morgenstern type, the
analysis of optimal portfolios in Section 3.1 or, more generally, of optimal asset proï¬les
in Section 3.3 is a standard exercise, both in microeconomic theory and in convex

434
Notes
optimization. Section 3.1 shows that the existence of a solution is equivalent to the
absence to arbitrage; here we follow Rogers [168]. In the special case of exponential
utility, the construction of the optimal portfolio is equivalent to the minimization of
relative entropy as discussed in Section 3.2. This may be viewed as the ï¬nancial
interpretation of general results on entropy minimization in Csiszar [43], [44]. The
methods for characterizing optimal asset proï¬les in Section 3.3 in terms of â€œï¬rst-order
conditionsâ€ are well-known; see, for example, [79] or [129], where they are developed
in greater generality. The optimization problem in Theorem 3.44, which is formulated
in terms of the partial order â‰½uni and involves the Hardyâ€“Littlewood inequalities of
Theorem A.24, is less standard. Our discussion is based on Dybvig [77], Jouini and
Kallal [120] and on a proof of Dana and Meilijson, and we are obliged to Rose-
Anne Dana for introducing us to this topic; see [53] for further developments. As
to the existence of Arrowâ€“Debreu equilibria discussed in Section 3.4, we refer to the
classical version in Debreu [56] and to the survey articles in [10]. In our ï¬nancial
context, equilibrium allocations do no longer involve commodity bundles in Euclidean
space as in [56] but asset proï¬les described by random variables on a probability space.
This formulation of the equilibrium problem goes back to Borch [26], where it was
motivated by the problem of risk exchange in a reinsurance market. The systematic
analysis of the equilibrium problem in an inï¬nite-dimensional setting was developed
by Bewley, Mas-Colell, and others; see [23] and, for example, [147], [148], [3].
In our introductory approach, the existence proof is reduced to an application of
Brouwerâ€™s ï¬xed point theorem. Here we beneï¬tted from discussions with Peter Bank;
see also Dana [52]. Examples 3.51 and Example 3.52 are based on BÃ¼hlmann [31];
see also [32]. As mentioned in Remark 3.58, the equilibrium discussion of interest
rates requires an intertemporal setting; for a systematic discussion see, e.g., Dufï¬e
[73] and, in a different conceptual framework, Bank and Riedel [16].
Chapter 4: The axiomatic approach to coherent measures of risk and their acceptance
sets was initiated by Artzner, Delbaen, Eber, and Heath [11], and most results of
Section 4.1 are based on this seminal paper. The extension to convex measures of risk
was given independently by Heath [110], Heath and Ku [111], FÃ¶llmer and Schied
[93], and Frittelli and Rosazza Gianin [100]. The robust representation theorems in
Section 4.2 are taken from [94]; the discussion of convex risk measures on a space
of continuous functions corrects an error in [94] and in the ï¬rst edition of this book;
see also KrÃ¤tschmer [134] for a further analysis. The representation theory on Lâˆas
presented in Section 4.3 was developed by Delbaen [58], [59]; for the connection to
the general duality theory as explained in Remarks 4.17 and 4.39 see [58], [59], [100],
[101]. Among the results onValue at Risk and its various modiï¬cations in Section 4.4,
Proposition 4.42 andTheorem 4.61 are taken from [11] and [58]. AverageValue at Risk
is discussed, e.g., byAcerbi andTasche [1], Delbaen [58], and Rockafellar and Uryasev
[167]. Remark 4.44 was pointed out to us by Ruszczynski; see [157]. The notation
V@R is taken from Pï¬‚ug and Ruszczynski [158]. The representations of law-invariant
risk measures given in Section 4.5 were ï¬rst obtained in the coherent case by Kusuoka

Notes
435
[141]; see also Kunze [140] and Frittelli and Rosazza Gianin [101] for the extension
to the general convex case. Theorem 4.64 in Section 4.6 was ï¬rst proved in [141]. The
representations of the core of a concave distortion in Theorem 4.73 and Corollary 4.74
are due to Carlier and Dana [34]. See also [35] for further applications. The study
of Choquet integrals with respect to general set functions as used in Section 4.7 was
started by Choquet [38]. The connections with coherent risk measures were observed
by Delbaen [58], [59]. The two directions in Theorem 4.82 are due to Dellacherie
[64] and Schmeidler [182], respectively. The proof via Lemma 4.83, which we give
here, is taken from Denneberg [67]. Theorem 4.87 is due to Kusuoka [141]. The
equivalence between (b) and (d) in Theorem 4.88 was ï¬rst proved in [38], item (c)
was added in [182]. The proof given here is based on [67]. The ï¬rst part of Section 4.8
is based on [93], the second on Carr, Geman, and Madan [36]. Section 4.9 is taken
from [93]. Theorem 4.106 is an extension of a classical result for Orlicz spaces; see
Krasnoselskii and Rutickii [136]. For some mathematical connections between risk
measures and premium principles in insurance see, e.g., Denneberg [68] and Wang
and Dhaene [196]. Market equilibria in terms of risk measures are studied in Heath
and Ku [111].
Chapter 5: Martingales in Finance have a long history; see, e.g., Samuelson [172].
In the context of dynamic arbitrage theory, martingales and martingale measures are
playing a central role, both in discrete and continuous time; for a historical overview
we refer again to Schachermayer [177]. The ï¬rst four sections of this chapter are
based on Harrison and Kreps [108], Kreps [137], Harrison and Pliska [109], Dalang,
Morton, andWillinger [51], Stricker [193], Schachermayer [175], Jacka [117], Rogers
[168], Ansel and Stricker [9], and Kabanov and Kramkov [121]. The binomial model
of Section 5.5 was introduced by Cox, Ross, and Rubinstein in [42]. Geometric
Brownian motion, which appears in Section 5.7 as the diffusion limit of binomial
models, was proposed since the late 1950s by Samuelson and others as a model
for price ï¬‚uctuations in continuous time, following the re-discovery of the linear
Brownian motion model of Bachelier [15]; see Samuelson [173] and Cootner [41].
The corresponding dynamic theory of arbitrage pricing in continuous time goes back
to Black and Scholes [24] and Merton [150]. A Blackâ€“Scholes type formula for option
pricing appears in Sprenkle [190] in an ad hoc manner, without the arbitrage argument
introduced by Black and Scholes. The approximation of Blackâ€“Scholes prices for
various options by arbitrage-free prices in binomial models goes back to Cox, Ross,
and Rubinstein [42]. A functional version of Theorem 5.53, based on Donskerâ€™s
invariance principle, can be found in [73].
Chapter 6: The dynamic arbitrage theory for American options begins with Ben-
soussan [21] and Karatzas [124]. A survey is given in Myeni [154]. The theory of
optimal stopping problems as presented in Sections 6.1 and 6.2 was initiated by Snell
[189]; see [156] for a systematic introduction. Stability under pasting as discussed in
Section 6.4 has appeared under several names in various contexts; see Delbaen [60]
for a number of references and for an extension to continuous time. Our discussion

436
Notes
of upper and lower Snell envelopes in Section 6.5 uses ideas from Karatzas and Kou
[127] and standard techniques from dynamic programming. The application to the
time consistency of dynamic coherent risk measures recovers results by Artzner et al.
[12], [13], [14] and Riedel [165]; see also Delbaen [60].
Chapter 7: Optional decompositions, or uniform Doob decompositions as we call
them, and the resulting construction of superhedging strategies were ï¬rst obtained
by El Karoui and Quenez [80] in a jump-diffusion model. In a general semimartin-
gale setting, the theory was developed by Kramkov [135] and FÃ¶llmer and Kabanov
[89]. From a mathematical point of view, the existence of martingale measures with
marginals determined by given option prices in Theorem 7.25 is a corollary of Strassen
[191]; continuous-time analoga were proved by Doob [70] and Kellerer [132]. For
the economic interpretation, see, e.g., Breeden and Litzenberger [28]. The results on
superhedging of exotic derivatives by means of plain vanilla options stated in Theo-
rems 7.27, 7.31, 7.33, and Corollary 7.34 are due to Hobson [113] and Brown, Hobson,
and Rogers [29]; they are related to martingale inequalities of Dubins and Gilat [71].
Chapter 8: The analysis of quantile hedging was triggered by a talk of D. Heath
in March 1995 at the Isaac Newton Institute on the results in Kulldorf [139], where
an optimization problem for Brownian motion with drift is reduced to the Neymanâ€“
Pearson lemma. Section 8.1 is based on FÃ¶llmer and Leukert [91]; see also Karatzas
[125], Cvitanic and Spivak [50], Cvitanic and Karatzas [49], and Browne [30]. The
results in Section 8.2 on minimizing the shortfall risk are taken from FÃ¶llmer and
Leukert [92]; see also Leukert [145], Cvitanic and Karatzas [48], Cvitanic [45], and
Pham [159].
Chapter 9: In continuous-time models, dynamic arbitrage pricing with portfolio
constraints was considered by Cvitanic and Karatzas [46], [47]. In a discrete-time
model with convex constraints, absence of arbitrage was characterized by Carrassus,
Pham, and Touzi [33]. In a general semimartingale setting, FÃ¶llmer and Kramkov
[90] proved a uniform Doob decomposition and superhedging duality theorems for a
predictably convex set of admissible trading strategies and for American contingent
claims; see also Karatzas and Kou [127].
Chapter 10: The idea of quadratic risk minimization for hedging strategies goes back
to FÃ¶llmer and Sondermann [97], where the optimality criterion was formulated with
respect to a martingale measure. Extensions to the general case and the construc-
tion of minimal martingale measures were developed by FÃ¶llmer and Schweizer [96]
and Schweizer; see, e.g., [183], [184]. Our exposition also uses arguments from
FÃ¶llmer and Schweizer [95], SchÃ¤l [179], and Li and Xia [146]. Variance-optimal
hedging was introduced by Dufï¬e and Richardson [75] and further developed by
Schweizer and others; the discrete-time theory as presented in Section 10.3 is based
on Schweizer [185]. Melnikov and Nechaev [149] give an explicit formula for a

Notes
437
variance-optimal strategy without condition (10.22); in fact, they show that their for-
mula always deï¬nes a variance-optimal strategy if one does not insist on the square-
integrability of the gains process at intermediate times. For a survey on related results,
we refer to [186].


Bibliography
[1] Acerbi, C., Tasche, D., On the coherence of expected shortfall. J. Banking & Finance
26 (7), 2002, 1487â€“1503.
[2] Aliprantis, C. D., Border, K. C., Inï¬nite dimensionalAnalysis.A hitchhikerâ€™s guide, 2nd
edition. Springer-Verlag, Berlin, 1999.
[3] Aliprantis, C., Brown, D., Burkinshaw, O., Existence and optimality of competitive
equilibria. Springer-Verlag, Berlin, 1989.
[4] Allais, M., Le comportement de lâ€™homme rationell devant de risque: Critique des pos-
tulats et axiomes de lâ€™Ã©cole AmÃ©ricaine. Econometrica 21 (1953), 503â€“546 .
[5] Anscombe, F. J., Aumann, R. J., A deï¬nition of subjective probability. Ann. Math.
Statistics 34 (1963), 199â€“205.
[6] Ansel, J.-P., Stricker, C., Quelques remarques sur un thÃ©orÃ¨me de Yan. SÃ©minaire de
probabilitÃ©s XXIV, 1988/89 (J. AzÃ©ma, P. AndrÃ© and M. Yor, eds.), Lecture Notes in
Math. 1426, Springer-Verlag, Berlin, 1990, 266â€“274.
[7] Ansel, J.-P., Stricker, C., Lois de martingale, densitÃ©s et dÃ©composition de FÃ¶llmer-
Schweizer. Ann. Inst. H. PoincarÃ© Probab. Statist. 28 (1992), 375â€“392.
[8] Ansel, J.-P., Stricker, C., UnicitÃ© et existence de la loi minimale. In: SÃ©minaire de prob-
abilitÃ©s XXVII (J. AzÃ©ma et al., eds.). Lecture Notes in Math. 1557, Springer-Verlag,
Berlin, 1993, 22â€“29.
[9] Ansel, J.-P., Stricker, C., Couverture des actifs contingents et prix maximum. Ann. Inst.
H. PoincarÃ© Probab. Statist. 30 (1994), 303â€“315.
[10] Arrow, K., Hildebrandt,W., Intriligator, D., Sonnenschein, H. (eds.), Handbook of Math-
ematical Economics, Vol. Iâ€“IV, Elsevier Science Publishers, Amsterdam, 1991.
[11] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Coherent measures of risk. Math. Finance
9 (1999), 203â€“228.
[12] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Ku, H., Coherent multiperiod risk ad-
justed values and Bellmanâ€™s priciple. Preprint, ETH ZÃ¼rich (2003).
[13] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Ku, H., Coherent multiperiod risk mea-
surement. Preprint, ETH ZÃ¼rich (2003).
[14] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Ku, H., Multiperiod risk and coherent
multiperiod risk measurement. Preprint, ETH ZÃ¼rich (2003).
[15] Bachelier, L., ThÃ©orie de la spÃ©culation. Ann. Sci. Ã‰cole Norm. Sup. 17 (1900), 21â€“86.
[16] Bank, P., Riedel. F., Existence and Structure of Stochastic Equilibria with Intertemporal
Substitution. Finance Stoch. 5 (2001), 487â€“509.
[17] Barbera, S., Hammond, P. J., Seidl, C. (eds.), Handbook of Utility Theory, Vol. 1:
Principles, Kluwer Academic Publishers, 1998.
[18] Bauer, H., Wahrscheinlichkeitstheorie und GrundzÃ¼ge der MaÃŸtheorie. Third edition.
Walter de Gruyter, Berlinâ€“New York, 1978.

440
Bibliography
[19] Bauer, H., Probability theory. De Gruyter Stud. Math. 23,Walter de Gruyter, Berlinâ€“New
York, 1996.
[20] Bauer, H., Measure and integration theory. De Gruyter Stud. Math. 26,Walter de Gruyter,
Berlinâ€“New York, 2001.
[21] Bensoussan, A., On the theory of option pricing. Acta Appl. Math. 2 (1984), 139â€“158.
[22] Bernoulli, D., Specimen theoriae novae de mensura sortis. Commentarii Academiae
Scientiarum Imperialis Petropolitanae 5 (1738), 175â€“192. Translated by L. Sommer:
Econometrica 22 (1954), 23â€“36.
[23] Bewley, T., Existence of equilibria in economies with inï¬nitely many commodities.
J. Econom. Theory 43 (1972), 514â€“540.
[24] Black, F., Scholes, M., The pricing of options and corporate liabilities. J. Polit. Econom.
81 (1973), 637â€“654.
[25] Blackwell, D., Dubins, L., A Converse to the dominated convergence theorem. Illinois
J. Math. 7 (1963), 508â€“514.
[26] Borch, K., Equilibrium in a re-insurance market. Econometrica 30 (1962), 424â€“444.
[27] Bourbaki, N., IntÃ©gration. Hermann, Paris, 1969.
[28] Breeden, D., Litzenberger, R., Prices of state-contingent claims implicit in option prices.
J. Business 51 (1978), 621â€“651.
[29] Brown, H., Hobson, D., Rogers, L. C. G., Robust hedging of barrier options. Math.
Finance 11 (2001), 285â€“314.
[30] Browne, S., The risks and rewards of minimizing shortfall probability. J. Portfolio Man-
agement 25 (1999), 76â€“85.
[31] BÃ¼hlmann, H.,The general economic premium priciple.Astin Bulletin 14 (1984), 13â€“21.
[32] BÃ¼hlmann, H., Jewell, S., Optimal risk exchanges. Astin Bulletin 10 (1979), 243â€“262.
[33] Carassus, L., Pham, H., Touzi, N., No-arbitrage in discrete-time under portfolio con-
straints. Math. Finance 11 (2001), 315â€“329.
[34] Carlier, G., Dana, R. A., Core of convex distortions of a probability. J. Econom. Theory
113 (2) (2003), 199â€“222.
[35] Carlier, G., Dana, R.A., Insurance contracts with deductibles and upper limits. Preprint,
Ceremade, UniversitÃ© Paris Dauphine (2002).
[36] Carr, P., Geman, H., Madan, D., Pricing and hedging in incomplete markets. J. Financial
Econom. 62 (2001), 131â€“167.
[37] Cheridito, P., Delbaen, F., Kupper, M., Coherent and convex monetary risk measures
for bounded cÃ dlÃ g processes. Stochastic Process. Appl. 112 (1) (2004), 1â€“22.
[38] Choquet, G., Theory of capacities. Ann. Inst. Fourier 5 (1953/54), 131â€“295.
[39] Chow,Y. S., Teicher, H., Probability Theory: Independence, interchangeability, martin-
gales. Springer-Verlag, New Yorkâ€“Heidelbergâ€“Berlin, 1978.
[40] Chung, K.-L., A course in probability theory. 2nd ed. Academic Press, New Yorkâ€“
London, 1974.

Bibliography
441
[41] Cootner,P.H.(ed.),Therandomcharacterofstockmarketprices.MITPress,Cambridge,
MA, 1964.
[42] Cox, J., Ross, S., Rubinstein, M., Option pricing: a simpliï¬ed approach. J. Financial
Econom. 7 (1979), 229â€“263.
[43] CsisÂ´zar, I., I-divergence geometry of probability distributions and minimization prob-
lems. Ann. Probab. 3 (1975), 146â€“158.
[44] CsiszÃ¡r, I., Sanov property, generalized I-projection and a conditional limit theorem.
Ann. Probab. 12 (1984), 768â€“793.
[45] Cvitanic, J., Minimizing expected loss of hedging in incomplete and constrained mar-
kets. SIAM J. Control Optim. 38 (2000), 1050â€“1066.
[46] Cvitanic, J., Karatzas, I., Convex duality in constrained portfolio optimization. Ann.
Appl. Probab. 2 (1992), 767â€“818.
[47] Cvitanic, J., Karatzas, I., Hedging contingent claims with constrained portfolios. Ann.
Appl. Probab. 3 (1993), 652â€“681.
[48] Cvitanic, J., Karatzas, I., On dynamic measures of risk. Finance Stoch. 3 (1999),
451â€“482.
[49] Cvitanic, J., Karatzas, I., Generalized Neyman-Pearson lemma via convex duality.
Bernoulli 7 (2001), 79â€“97.
[50] Cvitanic, J., Spivak, G., Maximizing the probability of perfect hedge.Ann.Appl. Probab.
9 (1999), 1303â€“1328.
[51] Dalang, R., Morton,A., Willinger, W., Equivalent martingale measures and no-arbitrage
in stochastic securities market models. Stochastics Stochastics Rep. 29 (1990), 185â€“201.
[52] Dana, R.-A., Existence and uniqueness of equilibria when preferences are additively
separable and gross substitute. Econometrica 61 (1993), 953â€“957.
[53] Dana, R.-A., Stochastic dominance, individual decision making, and equilibrium asset
pricing. Preprint, Ceremade, UniversitÃ© Paris Dauphine (2002).
[54] Dana, R.-A., Jeanblanc-PiquÃ©, M., MarchÃ©s ï¬nanciers en temps continu. Economica
(1994), Paris.
[55] Davis, M. H. A., Option pricing in incomplete markets. In: Mathematics of derivative
securities (Dempster, M.A. H. and Pliska, S. R., eds.), Publ. Newton Inst. 15, Cambridge
University Press, Cambridge, 1997, 216â€“226.
[56] Debreu, G., Theory of value: an axiomatic analysis of economic equilibrium. Cowles
Foundation for Research in Economics at Yale University, Monograph 17, John Wiley
& Sons, Inc., New York; Chapman & Hall, Ltd., London, 1959.
[57] Debreu, G., Continuity properties of paretian utility. International Econ. Rev. 5 (1964),
285â€“293.
[58] Delbaen, F., Coherent risk measures on general probability spaces. In: Advances in
Finance and Stochastics. Essays in Honour of Dieter Sondermann, Springer-Verlag,
Berlin, 2002, 1â€“37.
[59] Delbaen, F., Coherent risk measures. Cattedra Galileiana. Scuola Normale Superiore,
Classe di Scienze, Pisa, 2000.

442
Bibliography
[60] Delbaen, F., The structure of m-stable sets and in particular of the set of riskneutral
measures. Preprint, ETH ZÃ¼rich (2003).
[61] Delbaen, F., Grandits, P., RheinlÃ¤nder, T., Samperi, D., Schweizer, M. and Stricker, C.,
Exponential Hedging and Entropic Penalties. Math. Finance 12 (2002), 99â€“123.
[62] Delbaen, F., Schachermayer, W., A general version of the fundamental theorem of asset
pricing. Math. Ann. 300 (1994), 463â€“520.
[63] Delbaen, F., Schachermayer, W., The fundamental theorem of asset pricing for un-
bounded stochastic processes. Math. Ann. 312 (1998), 215â€“250.
[64] Dellacherie, C., Quelques commentaires sur les prolongements de capacitÃ©s. SÃ©minaire
ProbabilitÃ©s V, Sttrasbourg, Lecture Notes in Math. 191, Springer-Verlag, Berlin, 1970.
[65] Dellacherie, C., Meyer, P.-A., ProbabilitÃ©s et potentiel. Chapitres IX Ã  XI. ThÃ©orie
discrÃ¨te du potential. Revised edition. Publications de lâ€™Institut de MathÃ©matiques de
lâ€™UniversitÃ© de Strasbourg, XVIII. ActualitÃ©s Sci. Indust. 1410, Hermann, Paris, 1983
[66] Dembo, A., Zeitouni, O., Large deviations techniques and applications. Second edition.
Appl. Math. 38. Springer-Verlag, New York, 1998.
[67] Denneberg, D., Non-additive measure and integral. Theory Decis. Lib. Ser. B Math.
Statist. Meth. 27, Kluwer Academic Publishers, Dordrecht, 1994.
[68] Denneberg, D., Distorted probabilities and insurance premium. Methods Operations
Research 52 (1990), 21â€“42.
[69] Deuschel, J.-D., Stroock, D., Large deviations. Pure Appl. Math. 137, Academic Press,
Inc., Boston, MA, 1989.
[70] Doob, J., Generalized sweeping-out and probability. J. Funct. Anal. (1968), 207â€“225.
[71] Dubins, L., Gilat, D., On the distribution of maxima of martingales. Proc. Amer. Math.
Soc. 68 (1978), 337â€“338.
[72] Dudley, R., Real analysis and probability. Wadsworth & Brooks/Cole, Paciï¬c Grove,
CA, 1989.
[73] Dufï¬e, D., Security markets. Econom. Theory Econometrics Math. Econom.,Academic
Press, Boston, MA, 1988.
[74] Dufï¬e, D., Dynamic asset pricing theory. 2nd ed. Princeton University Press, Princeton,
NJ, 1996.
[75] Dufï¬e, D., Richardson, H. R., Mean-variance hedging in continuous time. Ann. Appl.
Probab. 1 (1991), 1â€“15.
[76] Dunford, N., Schwartz, J., Linear Operators. Part I: General Theory. Interscience Pub-
lishers, New York, 1958.
[77] Dybvig, P., Distributional analysis of portfolio choice. J. Business 61 (1988), 369â€“393.
[78] Eilenberg, S., Ordered topological spaces. Amer. J. Math. LXIII (1941), 39â€“45.
[79] Ekeland, I., Temam, R., Convex analysis and variational problems. Stud. Math. Appl. 1,
North-Holland Publishing Co.,Amsterdamâ€“Oxford;American Elsevier Publishing Co.,
Inc., New York, 1976.
[80] El Karoui, N., Quenez, M.-C., Dynamic programming and pricing of contingent claims
in an incomplete market. SIAM J. Control Optim. 33 (1995), 29â€“66.

Bibliography
443
[81] Elliott, R., FÃ¶llmer, H., Orthogonal martingale representation. In: Stochastic analysis.
Liber amicorum for Moshe Zakai, Academic Press, Boston, MA, 1991, 139â€“152.
[82] Elliott, R., Kopp, P., Mathematics of ï¬nancial markets. Springer Finance, Springer-
Verlag, New York, 1999.
[83] Feller, W., An introduction to probability theory and its applications. 3rd edition. John
Wiley & Sons, New York, 1968.
[84] Fishburn, P., Utility theory for decision making. Publ. Operations Res. 18, John Wiley,
New York, 1970.
[85] Fishburn, P. C., Nonlinear preference and utility theory. The John Hopkins University
Press, Baltimore, MD, 1988.
[86] Floret, K., Weakly compact sets. Lecture Notes in Math. 801, Springer-Verlag, Berlin,
1980.
[87] FÃ¶llmer, H., Calcul dâ€™Ito sans probabilitÃ©s. Seminaire de probabilites XV, Univ. Stras-
bourg 1979/80, Lect. Notes Math. 850 (1981), 143-150.
[88] FÃ¶llmer, H., Probabilistic Aspects of Financial Risk. Plenary Lecture at the Third Euro-
pean Congress of Mathematics. Proceedings of the European Congress of Mathematics,
Barcelona 2000, BirkhÃ¤user, Basel, 2001.
[89] FÃ¶llmer, H., Kabanov, Yu. M., Optional decomposition and Lagrange multipliers. Fi-
nance Stoch. 2 (1998), 69â€“81.
[90] FÃ¶llmer, H., Kramkov, D., Optional decompositions under constraints. Probab. Theory
Related Fields 109 (1997), 1â€“25.
[91] FÃ¶llmer, H., Leukert, P., Quantile hedging. Finance Stoch. 3 (1999), 251â€“273.
[92] FÃ¶llmer, H., Leukert, P., Efï¬cient hedging: cost versus shortfall risk. Finance Stoch. 4
(2000), 117â€“146.
[93] FÃ¶llmer, H., Schied,A., Convex measures of risk and trading constraints. Finance Stoch.
6 (4) (2002).
[94] FÃ¶llmer, H., Schied, A., Robust representation of convex measures of risk. In: Advances
in Finance and Stochastics. Essays in Honour of Dieter Sondermann, Springer-Verlag,
Berlin, 2002, 39â€“56.
[95] FÃ¶llmer, H., Schweizer, M., Hedging by sequential regression: An introduction to the
mathematics of option trading. Astin Bulletin 18 (1989), 147â€“160.
[96] FÃ¶llmer,H.,Schweizer,M.,Hedgingofcontingentclaimsunderincompleteinformation.
Applied stochastic analysis, London, Stochastic Monogr. 5 (1990), 389â€“414.
[97] FÃ¶llmer, H., Sondermann, D., Hedging of non-redundant contingent claims. Contribu-
tions to mathematical economics, Hon. G. Debreu, 206â€“223 (1986).
[98] Frittelli, M., Introduction to a theory of value coherent with the no arbitrage principle,
Finance Stoch. 4 (3) (2000), 275â€“297.
[99] Frittelli, M., The minimal entropy martingale measure and the valuation problem in
incomplete markets, Math. Finance 10 (2000), 39â€“52.
[100] Frittelli, M., Rosazza Gianin, E., Putting order in risk measures. J. Banking & Finance
26 (2002), 1473â€“1486.

444
Bibliography
[101] Frittelli, M., Rosazza Gianin, E., Dynamic convex risk measures. In: New Risk Measures
in Investment and Regulation, G. SzegÃ¶ ed., John Wiley & Sons, New York, 2003.
[102] Frittelli, M., Scandolo, G., Risk measures and capital requirements for processes.
Preprint, UniversitÃ  di Firenze (2004).
[103] Gilboa, I., Expected utility with purely subjective non-additive probabilities. J. Math.
Econom. 16 (1987), 65â€“88.
[104] Gilboa, I., Schmeidler, D., Maxmin expected utility with non-unique prior. J. Math.
Econom. 18 (1989), 141â€“153.
[105] Goovaerts, M. J., De Vylder, F., Haezendonck, J., Insurance premiums. Theory and
applications. North-Holland Publishing Co., Amsterdam, 1984.
[106] Halmos, P., Savage, L., Application of the Radon-Nikodym theorem to the theory of
sufï¬cient statistics. Ann. Math. Stat. 20 (1949), 225â€“241.
[107] Hardy, G. H., Littlewood, J. E., PÃ³lya, G., Inequalities. 2nd edition, Cambridge Univer-
sity Press, Cambridge, 1952.
[108] Harrison, J., Kreps, D., Martingales and arbitrage in multiperiod securities markets.
J. Econom. Theory 20 (1979), 381â€“408.
[109] Harrison, J., Pliska, S., Martingales and stochastic integrals in the theory of continuous
trading. Stochastic Process. Appl. 11 (1981), 215â€“260.
[110] Heath, D., Back to the future. Plenary lecture, First World Congress of the Bachelier
Finance Society, Paris, 2000.
[111] Heath, D., Ku, H., Pareto equilibria with coherent measures of risk. Math. Finance 14
(2) (2004), 163â€“172.
[112] Herstein, I. N., Milnor J., An axiomatic approach to measurable utility. Econometrica
21 (1953), 291â€“297.
[113] Hobson, D., Robust hedging of the loockback option. Finance Stoch. 2 (1998), 329â€“347.
[114] Huber, P., Robust statistics. Wiley Ser. Probab. Math. Statist., Wiley, New York, 1981.
[115] Huber, P., Strassen, V., Minimax tests and the Neyman-Pearson lemma for capacities.
Ann. Statist. 1 (1973), 251â€“263.
[116] Hull, J., Options, futures, and other derivatives. 4th edition. Prentice Hall, London, 2000.
[117] Jacka, S., A martingale representation result and an application to incomplete ï¬nancial
markets. Math. Finance 2 (1992), 239â€“250.
[118] Jaschke, S., KÃ¼chler, U., Coherent Risk Measures and Good-Deal Bounds. Finance
Stoch. 5 (2) (2001), 181â€“200
[119] Jouini, E., Kallal, H., Arbitrage in securities markets with short-sales constraints. Math.
Finance 3 (1995), 197â€“232.
[120] Jouini, E., Kallal, H., Efï¬cient trading strategies in the presence of market frictions. The
Review of Financial Studies 14 (2001), 343â€“369.
[121] Kabanov, Yu. M., Kramkov, D. O., No-arbitrage and equivalent martingale measures:
An elementary proof of the Harrison-Pliska theorem. Theory Probab. Appl. 39 (1994),
523â€“527.

Bibliography
445
[122] Kabanov, Yu. M., Stricker, C., A teacherâ€™s note on no-arbitrage criteria. SÃ©m. Probab.
35, Lecture Notes in Math. 1755, Springer-Verlag, 2001, Berlin, 149â€“152.
[123] Kahneman, D., Tversky, A., Prospect theory: An analysis of decision under risk. Econo-
metrica 47 (1979), 263â€“291.
[124] Karatzas, I., On the pricing of American options. App. Math. Optimization 17 (1988),
37â€“60.
[125] Karatzas, I., Lectures on the mathematics of ï¬nance. CRM Monogr. Ser. 8, American
Mathematical Society, Providence, RI, 1996.
[126] Karatzas, I., Kou, S. G., On the pricing of contingent claims under constraints. Ann.
Appl. Probab. 6 (1996), 321â€“369.
[127] Karatzas, I., Kou, S. G., HedgingAmerican contingent claims with constraint portfolios.
Finance Stoch. 2 (1998), 215â€“258.
[128] Karatzas, I., Shreve, S., Brownian motion and stochastic calculus. Grad. Texts in Math.
113, Springer-Verlag, New York, 1991.
[129] Karatzas, I., Shreve, S., Methods of mathematical ï¬nance.Appl. Math., Springer-Verlag,
Berlin, 1998.
[130] Karni, E., Schmeidler, D., Vind, K., On state-dependent preferences and subjective
probabilities. Econometrica 51 (1983), 1021â€“1031.
[131] Karni, E., Schmeidler, D., Utility theory with uncertainty. In: Handbook of Mathemat-
ical Economics, Vol. IV (W. Hildebrandt and H. Sonnenschein, eds.), Elsevier Science
Publishers, Amsterdam, 1991, 1763â€“1831.
[132] Kellerer, H., Markov-Komposition und eine Anwendung auf Martingale. Math. Ann.
198 (1972), 99â€“122.
[133] Komlos, J., A generalization of a problem of Steinhaus. Acta Math. Acad. Sci. Hung.
18 (1967), 217â€“229.
[134] KrÃ¤tschmer, V., Robust representation of convex risk measures by probability. Preprint,
UniversitÃ¤t des Saarlandes (2004).
[135] Kramkov, D. O., Optional decomposition of supermartingales and hedging contingent
claims in incomplete security markets. Probab. Theory Related Fields 105 (1996),
459â€“479.
[136] Krasnoselâ€™skii, M., Rutickii, Ya., Convex functions and Orlicz spaces. Gordon and
Breach Science Publishers, 1961.
[137] Kreps, D., Arbitrage and equilibrium in economies with inï¬nitely many commodities.
J. Math. Econom. 8 (1981) 15â€“35.
[138] Kreps, D., Notes on the theory of choice. Westview Press, Boulder, CO, 1988.
[139] Kulldorff, M., Optimal control of favorable games with a time limit. SIAM J. Control
Optim. 31 (1993), 52â€“69.
[140] Kunze, M., Verteilungsinvariante konvexe RisikomaÃŸe. Diplomarbeit, Humboldt-Uni-
versitÃ¤t zu Berlin, 2003.
[141] Kusuoka, S., On law invariant coherent risk measures.Adv. Math. Econ. 3 (2001), 83â€“95.

446
Bibliography
[142] Lamberton, D., Lapeyre, B., Introduction to stochastic calculus applied to ï¬nance. Chap-
man & Hall, London, 1995.
[143] Lamberton, D., Lapeyre, B., Introduction au calcul stochastique appliquÃ© Ã  la ï¬nance.
2Ã¨me Ã©d. Ellipses, Paris, 1997.
[144] Leland, H., Who should buy portolio insurance? J. Finance 35 (1980), 581â€“594.
[145] Leukert, P., Absicherungsstrategien zur Minimierung des Verlustrisikos. Dissertation,
Humboldt-UniversitÃ¤t zu Berlin (1999).
[146] Li, P., Xia, J., Minimal martingale measures in discrete time. Acta Math. Appl. Sinica
(2002).
[147] Mas-Colell,A.,Thetheoryofgeneralequilibrium:Adifferentiableapproach.Cambridge
University Press, Cambridge, 1985.
[148] Mas-Colell, A., Zame, W., Equilibrium theory in inï¬nite dimensional spaces. In: Hand-
book of Mathematical Economics IV (W. Hildebrandt and H. Sonnenschein, eds.), El-
sevier Science Publishers, Amsterdam, 1991, 1835â€“1898.
[149] Melnikov, A. V., Nechaev, M. L., On the mean-variance hedging problem. Theory
Probab. Appl. 43 (1998), 588â€“603; translation from Teor. Veroyatnost. i Primenen. 43
(1998), 672â€“691.
[150] Merton, R., Theory of rational option pricing. Bell J. Econom. Manag. Sci. 4 (1973),
141â€“183.
[151] Milgram,A. N., Partially ordered sets, separating systems and inductiveness. Rep. Math.
Colloq. II Ser. 1, University of Notre Dame, 1939, 18â€“30.
[152] Monat, P., Stricker, C., FÃ¶llmer-Schweizer decomposition and mean-variance hedging
for general claims. Ann. Probab. 23 (1995), 605â€“628.
[153] Musiela, M., Rutkowski, M., Martingale methods in ï¬nancial modelling. Appl. Math.,
Springer-Verlag, Berlin, 1997.
[154] Myeni, R., The pricing of the American option. Ann. Appl. Probab. 2 (1992), 1â€“23.
[155] von Neumann, J., Morgenstern, O., Theory of games and economic behavior. 2nd. Ed.
Princeton University Press, Princeton, NJ, 1947.
[156] Neveu, J., Discrete-parameter martingales. North-Holland, Amsterdamâ€“Oxford, 1975.
[157] Ogryczak, W., Ruszczynski, A., Dual stochastic dominance and related mean-risk mod-
els. SIAM J. Optim. 13 (1) (2002), 60â€“78.
[158] Pï¬‚ug, G., Ruszczynski, A., Risk measures for income streams. Preprint, UniversitÃ¤t
Wien (2001).
[159] Pham,H.,DynamicLp-hedgingindiscretetimeunderconeconstraints.SIAMJ.Control
Optim. 38 (2000), 665â€“682.
[160] Pliska, S., Introduction to Mathematical Finance. Blackwell Publishers, 1997.
[161] Quiggin, J., A Theory of Anticipated Utility. J. Economic Behavior and Organization 3
(1982), 225â€“243.
[162] Rabin, M., Risk aversion and expected-utility theory:A calibration theorem. Economet-
rica 68 (5) (2000), 1281â€“1292.

Bibliography
447
[163] Rader, J., The existence of a utility function to represent preferences. Rev. Econom.
Stud. 30 (1963), 229â€“232.
[164] Reed, M., Simon, B., Methods of modern mathematical physics. Vol. 1: Functional
analysis. Academic Press, New Yorkâ€“London, 1972.
[165] Riedel, F., Dynamic coherent risk measures. Stoch. Proc.Appl. 112 (2) (2004), 185â€“200.
[166] Rockafellar, R. T., Convex analysis. Princeton University Press, Princeton, NJ, 1970.
[167] Rockafellar, R. T., Uryasev, S., Conditional value-at-risk for general loss distributions.
Research report 2001-5, ISE Dept., University of Florida, 2001.
[168] Rogers, L. C. G., Equivalent martingale measures and no-arbitrage. Stochastics Stochas-
tics Rep. 51 (1994), 41â€“49.
[169] Ross, S. A., The arbitrage theory of capital asset pricing. J. Econom. Theory 13 (1976),
341â€“360.
[170] Rothschild, M., Stiglitz, J., Increasing risk: I. A deï¬nition. J. Econom. Theory 2 (1970),
225â€“243.
[171] Rothschild, M., Stiglitz, J., Increasing risk: II. Its economic consequences. J. Econom.
Theory 3 (1971), 66â€“84.
[172] Samuelson, P. A., Proof that properly anticipated prices ï¬‚uctuate randomly. Industrial
Management Rev. 4 (1965), 41â€“50.
[173] Samuelson, P. A., Rational theory of warrant pricing. Industrial Management Rev. 6
(1965), 13â€“31.
[174] Savage, L. J., The foundations of statistics. Wiley Publ. Stat., John Wiley and Sons, New
York, 1954.
[175] Schachermayer, W., A Hilbert space proof of the fundamental theorem of asset pricing
in ï¬nite discrete time. Insurance Math. Econom. 11 (1992), 249â€“257.
[176] Schachermayer, W., Optimal Investment in Incomplete Financial Markets. Proceedings
of the ï¬rstWorld Congress of the Bachelier Society, Paris 2000, Springer-Verlag, Berlin,
2001.
[177] Schachermayer, W., Introduction to the mathematics of ï¬nancial markets. In: Lectures
on probability theory and statistics (Saint-Flour, 2000) , Lecture Notes in Math. 1816,
Springer-Verlag, Berlin, 107â€“179.
[178] Schaefer, H., Topological vector spaces. Grad. Texts in Math. 3, Springer-Verlag, New
York, 1971.
[179] SchÃ¤l, M., On quadratic cost criteria for option hedging. Math. Oper. Research 19 (1994),
121â€“131.
[180] Schied,A., On the Neyman-Pearson problem for law-invariant risk measures and robust
utility functionals. Ann. Appl. Probab. 14 (2004), 1398â€“1423.
[181] Schied,A.,Optimalinvestmentsforrobustutilityfunctionalsincompletemarketmodels.
To appear in Math. Oper. Research.
[182] Schmeidler, D., Integral representation without additivity. Proc. Amer. Math. Soc. 97
(2) (1986), 255â€“261.

448
Bibliography
[183] Schweizer, M., Hedging of options in a general semimartingale model. Diss. ETH ZÃ¼rich
No. 8615 (1988).
[184] Schweizer, M., Risk-minimality and orthogonality of martingales. Stochastics Stochas-
tics Rep. 30 (1990), 123â€“131.
[185] Schweizer, M., Variance-optimal hedging in discrete time. Math. Oper. Res. 20 (1995)
1â€“32.
[186] Schweizer, M., A Guided Tour through Quadratic Hedging Approaches. In: Option
pricing, interest rates, and risk management (Jouini, E., Musiela, M., Cvitanic, J., eds.).
Cambridge University Press, Cambridge, 2001, 538â€“574.
[187] Shiryaev, A. N., Probability. 2nd ed. Grad. Texts in Math. 95, Springer-Verlag, New
York, 1995.
[188] Shiryaev, A. N., Essentials of stochastic ï¬nance. Adv. Ser. Stat. Sci. Appl. Probab. 3,
World Scientiï¬c, Singapore, 1999.
[189] Snell, L., Applications of the martingale systems theorem. Trans. Amer. Math. Soc. 73
(1952), 293â€“312.
[190] Sprenkle, C., Warrant prices as indicators of expectations and preferences. Yale Eco-
nomic Essays 1 (1964), 178â€“231.
[191] Strassen, V., The existence of probability measures with given marginals. Ann. Math.
Stat. 36 (1965), 423â€“439.
[192] Staum, J., Fundamental theorems of asset pricing for good deal bounds. Math. Finance
14 (2) (2004), 141â€“161.
[193] Stricker, C., Arbitrage et lois de martingale. Ann. Inst. H. PoincarÃ© Probab. Statist. 26
(1990), 451â€“460.
[194] Tversky, A., Kahneman, D., Advances in prospect theory: Cumulative representation of
uncertainty. J. Risk Uncertainty 5 (1992), 297â€“323.
[195] von WeizsÃ¤cker, H., Can one drop L1-boundedness in KomlÃ³sâ€™Subsequence Theorem?
American Math. Monthly 111 (2004), 900â€“903.
[196] Wang, S., Dhaene, J., Comonotonicity, correlation order and premium principles. Insur-
ance Math. Econom. 22 (1998), 235â€“242.
[197] Weber, S., Distribution-invariant dynamic risk measures. Preprint, Humboldt-Univer-
sitÃ¤t zu Berlin (2004).
[198] Yaari, M., The dual theory of choice under risk. Econometrica 55 (1987), 95â€“116.
[199] Yan, J.-A., CaractÃ©risation dâ€™une classe dâ€™ensembles convexes de L1 ou H 1. Seminaire
de probabilitÃ©s XIV, 1978/79 (J. AzÃ©ma and M. Yor, eds.), Lecture Notes in Math. 784,
Springer-Verlag, Berlin, 1980, 220â€“222.

List of symbols
â‰», 45
âˆ¼, 45
âª°, 45
â‰½bal, 82
â‰½con, 82
â‰½uni, 75
â‰½mon, 84
âˆ¥Â· âˆ¥, 426
âˆ¥Â· âˆ¥p, 428
âˆ¥Â· âˆ¥âˆ, 428
âˆ¥Â· âˆ¥var, 426
AQ, 358
AV@R, 179
ba(, F ), 426
Cb(S), 418
conv A, 400
cov(Â· | F0), 375
CÏˆ(S), 422
Ct(K), 323
E[ F ; A0 ], 404
E[ F | F0 ], 404
ess inf X, 418
ess sup X, 418
ess inf , 417
ess sup , 417
FÂµ, 408
FX, 408
Ft, 224
FÏ„, 297
(Âµ), 28
H(Q|P), 119
H2, 380
I +, 130
Lp(, F , P ), 428
Lp(, F , P ), 428
ÂµQ, 76
M(S, S), 418
MÏˆ(S), 422
Mb(S), 58
M1(P ), 172
M1(S, S), 51, 92, 419
M1,f , 91, 426
M1,f (, F ), 426
MÏˆ
1 (S), 99, 423
M(Âµ), 27
Mb(Âµ), 27
N(m, Ïƒ 2), 79
NâŠ¥, 39, 351
Ï€, 3
Ï€inf(C), 19
Ï€inf(H), 238, 293
Ï€sup(C), 19
Ï€sup(H), 238, 293
Ï€(V ), 10
(C), 18
(H), 238, 293
P , 6, 229
P, 325
PT , 327
PS, 352
QS, 358
R(V ), 11
Ïƒ(E, F), 430
Ïƒ(Lâˆ, L1), 430
S, 204, 350, 393
Sâˆ, 354
Sâˆ
t , 354

450
List of symbols
St, 350
supp Âµ, 28
T , 284
Tt, 285
TÏ„, 298
UP âˆ—, 280
UQ, 280
Uâ†“, 301
Uâ†‘, 301, 363
V@R, 158, 177
var(Â· | F0), 375
var(Âµ), 81
|x|, 399

X âˆ¼X, 183

Index
absolute risk aversion, 67
absolutely continuous measure, 403
acceptanceset,155,172,204,219,320,
340, 370
adapted process, 224
admissible strategy, 205, 334
afï¬ne hull of a convex set, 29
afï¬ne numerical representation, 51
Allais paradox, 60, 88
American claim
arbitrage-free price of, 288, 293
attainable, 296
hedging strategy, 296
American option, 277
call, 279
put, 279, 290
arbitrage bounds, 19
arbitrage opportunity, 5, 32, 206, 227,
323
arbitrage-free price
of a European claim, 238
of a contingent claim, 18
of American claim, 288, 293
universal bounds, 22, 327
Archimedean axiom, 52, 91
Arrowâ€“Debreu equilibrium, 138
and interest rate, 150
w.r.t. general utility functionals,
151
Arrowâ€“Pratt coefï¬cient, 67
Asian option, 234, 252
asymmetric relation, 45
at-the-money option, 22
atom of a probability space, 24, 183,
413
atomless probability space, 183, 413
attainable
American claim, 296
European claim, 237
payoff, 10
average
price option, 234
strike option, 235
Average Value at Risk, 179
comonotonicity, 198, 199
balayage order, 82, 321, 325
Banach space, 428
Banachâ€“Alaoglu theorem, 431
barrier option, 235, 252
Blackâ€“Scholes price of, 274
up-and-in call, 257, 330
up-and-out call, 258, 330, 332
barycenter of a measure, 27
basket call option, 132
basket option, 15
Bermuda option, 279
Bernoulli, Daniel, 44, 64
Bernoulli, Nicholas, 64
binomial model, 249, 262, 290
Blackâ€“Scholes formula, 264, 266
Blackâ€“Scholes p.d.e., 269, 273
Blackâ€“Scholes price, 263
of a European call option, 264,
266
Bolzanoâ€“WeierstraÃŸ theorem
randomized version, 38
boundedly supported measures, 58
Brownian motion, 271
butterï¬‚y spread, 15
call option, 14, 132, 322
American, 279, 289
Asian, 234
Bermuda, 279
Blackâ€“Scholes price, 264, 266
European, 234, 244, 289, 345
universal bounds on price, 22

452
Index
with barrier, 235, 330
call-put parity, 15
cap, 17
CARA utility, 67, 73, 110, 116, 128,
132
cash invariance, 94, 153
catastrophe bond, 17
central limit theorem, 419
functional, 271
multiplicative, 260
certainty equivalent, 63, 93
as reservation price, 137
certainty independence, 90
Choquet boundary, 321
Choquet integral, 160, 192, 196
coherent measure of risk, 155
and superhedging, 320
representation theorem, 165, 175
coherent risk measure
conditional, 306
dynamic, 306
dynamically consistent, 306
time-consistent, 306
comonotone random variables, 196
comonotonicity, 91
complete
market, 23, 245
relation, 45
compound lottery, 52
concave stochastic order, 82
conditional coherent risk measure, 306
conditional expectation, 33, 404
Conditional Value at Risk, 179
conjugate function, 214, 402, 431
of a convex risk measure, 164,
176
connected topological space, 49
constant absolute risk aversion, 67
constant relative risk aversion, 68
contingent claim, 17
American, 278
arbitrage-free price of, 18
attainable, 21
European, 234
redundant, 21
replicable, 21
continuation region, 292
continuity axiom, 52, 91
continuity from above, 99, 166, 172
continuityfrombelow,92,99,167,213
convex function
duality theory, 430
proper, 400, 430
convex hull, 400
of the support of a measure, 28
convex measure of risk, 154
acceptance set of, 155
continuous from above, 166, 172
continuous from below, 167, 213
in ï¬nancial market, 203, 340, 370
law-invariant, 183
penalty function for, 161, 165,
172, 213, 219
relevant, 174
representation theorem, 161, 172
sensitive, 173, 371
tight, 169
convex stochastic order, 82, 321, 325
core of a set function, 201
cost of superhedging, 314
cost process, 373
countably convex set, 36
Coxâ€“Rossâ€“Rubinstein model, 249,
262, 290
CRR model, 249, 262, 290
CRRA utility, 68
decline of a favorable bet, 69
Delta hedging, 253, 266, 272
Delta of a call option, 266
density function, 403
density process, 229, 298
derivative securities, 18, 234
digital option, 235, 327
Diniâ€™s lemma, 169
Dirac measure, 422

Index
453
discount certiï¬cate, 17
discounted American claim, 279
discounted claim, 236
discounting, 9, 150
distortion function, 191
distortionofaprobabilitymeasure,191
distribution
log-normal, 82, 261
normal, 78
Poisson, 22
distribution function, 407
and stochastic dominance, 85
and stochastic order, 76
diversiï¬cation, 154
DolÃ©ansâ€“Dade exponential, 384
Donskerâ€™s invariance principle, 271
Doob decomposition, 277, 310, 385
uniform, 310, 360
Doobâ€™s stopping theorem, 283, 297
Doobâ€™s systems theorem, 229
down-and-in option, 235, 252
down-and-out option, 235
dual space, 429
dualitytheoryofconvexfunctions,430
Dunfordâ€“Pettis theorem, 432
dynamic coherent risk measure, 306
dynamicconsistencyofariskmeasure,
306
early exercise premium, 290
Eberleinâ€“Å mulian theorem, 432
efï¬cient market hypothesis, 231
Ellsberg paradox, 88
entropic risk measure, 174, 213
entropy of a measure, 120
entropy-minimizing risk-neutral
measure, 121, 132
epigraph of a convex function, 402
equivalent martingale measure, 6, 229
equivalent measure, 403
Esscher transform, 121
essential inï¬mum, 417
of a random variable, 418
essential supremum, 417
of a random variable, 418
European call option, 244, 289, 322
Blackâ€“Scholes price, 264, 266
efï¬cient hedging of, 345
intrinsic value of, 240
time value of, 240
European contingent claim, 234
arbitrage-free price, 238
attainable, 237, 242
redundant, 237
replicable, 237
European put option, 263
exercise strategy for American claim,
279
expected shortfall, 179, 218, 347
expiration date of a contingent claim,
234
exponential family, 117
exponentialutilityfunction,67,73,132
extreme point
in the set of comonotonic convex
risk measures, 200
of a convex set, 246
fair premium, 61
fair price, 61
Fatou property, 172
on Lp, 177
favorable bet
decline of, 69
feasible allocation, 137
Fenchelâ€“Legendretransform,122,124,
214, 402, 409, 430
of a convex risk measure, 164,
176
ï¬ltered probability space, 224
ï¬ltration, 224
ï¬nancial position, 153
ï¬nitely additive set function, 92, 161,
426
ï¬rst order stochastic dominance, 84,
106

454
Index
fork convex sets, 300
forward contract, 14, 323
FrÃ©chet bounds, 413
FTAP, 6, 231
under portfolio constraints, 353
fundamental theorem of asset pricing
for multi-period market, 231
geometric form, 29
in one period, 6
second, 245
under portfolio constraints, 353
with contingent initial data, 33
without a priori measure, 325
gains process, 226, 373
Gamma of a call option, 266
gauge function, 59, 99, 422
generalizedlikelihoodquotienttest,416
generalized trading strategy, 372
mean self-ï¬nancing, 374
geometric Brownian motion, 271
Girsanov formula, 385
global quadratic risk, 393
Greeks, 269
Hahnâ€“Banach theorem, 429
Halmosâ€“Savage theorem, 37
HARA utility, 68, 73, 110, 132
Hardyâ€“Littlewoodinequality,136,410
Hausdorff space, 48
hedging strategy for American claim,
296
hyperbolic absolute risk aversion, 68
in-the-money option, 22
independence axiom, 51, 87, 90, 92
indifference relation, 45
inequality
Hardyâ€“Littlewood, 136, 410
insurance, 17, 66, 71
interest rate, 150
intrinsic value, 22, 240
inverse function, 406
left-continuous, 406
right-continuous, 406
ItÃ´ integral, 273
ItÃ´â€™s formula, 272
Jamesâ€™ theorem, 432
knock-in option, 235, 331
knock-out option, 235, 335
Kolmogorovâ€™s law of large numbers,
43, 72, 74
Kreinâ€“Å mulian theorem, 431
Krepsâ€“Yan theorem, 37, 355
Kunitaâ€“Watanabe decomposition, 381
L2-admissible strategy, 374
Î»-efï¬cient allocation, 145
Î»-quantile, 177
Î»-quantile, 408
law of large numbers, 72, 74
strong, 43
law of one price, 10, 21
Lebesgue decomposition, 405
left-continuous inverse, 406
Legendre transform, 409
leverage effect, 26
intheBlackâ€“Scholesformula,268
lexicographical order, 47, 48
likelihood quotient test, 415
liquid option, 322
local martingale, 352
local risk process, 374
locally convex space, 429
locally risk-minimizing strategy, 374
locally riskless bond, 225
log-normal distribution, 82, 261
lookback call, 252
lookback option, 235, 258
lookback put, 252
loss function, 212, 340
lottery, 44, 51
variance of, 81
lower quantile function, 408
lower Snell envelope, 301, 317

Index
455
m-stable sets, 300
market clearing condition, 137
market portfolio, 137
Markov property, 326
martingale, 33, 228
convergence theorem, 74
local, 352
of successive densities, 229, 298
reverse, 74
strongly orthogonal, 375
martingale measure, 6, 33, 229
as extension of a pricing rule, 325
minimal, 382
martingalerepresentationproperty,246
maturity of a contingent claim, 234
mean self-ï¬nancing strategy, 374
mean-preserving spread, 80, 105, 106
mean-variance trade-off process, 377,
394
measure
absolutely continuous, 403
entropy of, 120
equivalent, 403
simple, 420, 423
support of, 28
measure of risk
cash invariant, 153
coherent, 155, 320
comonotonic, 196
continuous from above, 166, 172
continuous from below, 167
convex, 154
in ï¬nancial market, 203, 340, 370
monetary, 153
monotone, 153
normalized, 154
penalty function for, 161
positive homogeneous, 155
relevant, 174
representation theorem, 161
sensitive, 173, 371
subadditive, 155
translation invariant, 153
metric space, 418
minimal martingale measure, 382
mixture space, 56
model uncertainty, 92
moment generating function, 116
monetary measure of risk, 153
monotone preference relation
on distributions, 61
on assets, 86
monotone set function, 191
negative transitive relation, 45
Neymanâ€“Pearson lemma, 336, 414,
415
generalized, 415
non-redundance condition, 11, 351
normal distribution, 78, 82, 118, 120
normalized set function, 191
numÃ©raire, 9, 32, 225
change of, 227, 233
numerical representation, 46, 49
afï¬ne, 51
of robust Savage form, 303
of Savage form, 86, 285
of von Neumannâ€“Morgenstern
form, 51, 57, 59, 61, 92
optimal stopping problem, 285
continuation region, 292
stopping region, 292
option
Blackâ€“Scholes price, 263
optional decomposition, 313
theorem, 310
under constraints, 360
optional sampling theorem, 283, 297
order dense set, 46
orthogonal decomposition
of a contingent claim, 379
out-of-the-money option, 22
paradox
Allais, 60, 88
Ellsberg, 88

456
Index
St. Petersburg, 63
partial order, 75
pasting of two probability measures,
299, 364
penalty function, 161
Poisson distribution, 22, 118
Polish space, 418
portfolio, 4
portfolio insurance, 16
portmanteau theorem, 420
positive afï¬ne transformations, 52
power of a statistical test, 415, 416
predictable process, 224
predictablerepresentationproperty,246
predictably convex set, 350
preference order, 45
preference relation, 45
monotone, 61
asymmetry of, 45
continuous, 48
continuous from above, 99
continuous from below, 99
lexicographical, 47, 48
monotone, 86
negative transitivity of, 45
numerical representation of, 46,
49, 51, 57, 59, 61
random, 134
risk averse, 61
weak, 45
price density, 138
price system, 4
pricing measure, 6
probability measure
absolutely continuous, 403
equivalent, 403
Prohorovâ€™s theorem, 421
for Ïˆ-weak topology, 424
proper convex function, 400, 430
Ïˆ-weak topology, 59, 100, 422
put option, 15
Asian, 234
European, 234, 263
universal bounds on price, 22
with barrier, 235
American, 290
put-call parity, 15
Q-martingale, 309
QS-Snell envelope
upper, 369
Q-submartingale, 309
Q-supermartingale, 309
quadratic risk
global, 393
local, 374
remaining, 393
quantile, 328
quantile function, 177, 408
and stochastic order, 76
fornon-additivesetfunctions,196
quantile hedging, 348
Radonâ€“Nikodym
derivative, 403
theorem, 403
random walk, 254
randomized test, 337, 341, 416
reference portfolio, 39
reï¬‚ection principle, 254
regular conditional distribution, 40, 78
relation
antisymmetric, 75
asymmetric, 45
complete, 45
equivalence, 45
indifference, 45
negative transitive, 45
reï¬‚exive, 75
transitive, 45, 75
relative entropy, 119, 213
relative interior of a convex set, 29
relative risk aversion, 68
relevant risk measure, 174
remaining conditional risk, 391
replicating
portfolio, 21

Index
457
strategy, 237
representation theorem for risk
measures, 161
on Lâˆ, 172
reservation price, 136
return, 11
reverse convertible bond, 16
reverse martingale, 74
Rho of a call option, 269
right-continuous inverse, 406
risk aversion, 61, 75, 89, 109, 340
absolute, 67
relative, 68
risk measure, 320
cash invariant, 153
coherent, 155
comonotonic, 196
conditional, 306
continuous from above, 166, 172
continuous from below, 167, 213
convex, 154
dynamic, 306
dynamically consistent, 306
entropic, 174, 213
in ï¬nancial market, 203, 340, 370
monetary, 153
monotone, 153
normalized, 154
penalty function for, 161
positive homogeneous, 155
relevant, 174
representation theorem, 161
sensitive, 173, 371
subadditive, 155
tight, 169
time-consistent, 306
translation invariant, 153
risk neutrality, 68
risk premium, 63
risk transfer, 17
risk-neutral measure, 6, 33
entropy-minimizing, 121, 132
robust Savage representation, 92, 98,
303
robust shortfall risk, 219
running maximum, 252, 254
Savage representation, 86, 285
robust, 92, 98, 303
second fundamental theorem of asset
pricing, 245
secondorderstochasticdominance,75,
103, 105
self-ï¬nancing strategy, 225
in continuous time, 273
sensitive risk measure, 173, 371
separable metric space, 418
separating hyperplane theorem, 399
separation theorems, 429
set function
core of, 201
ï¬nitely additive, 92, 161, 426
monotone, 191, 196
normalized, 191, 196
submodular, 160, 191, 201
2-alternating, 160, 191, 201
Sharpe ratio, 159
short sales, 5
constraints, 204, 351
shortfall, 212
shortfall risk, 212, 340
robust, 219
signiï¬cance level of a statistical test,
415, 416
simple measure, 420, 423
simple probability distribution, 53
size of a statistical test, 415
Snell envelope, 280, 285, 363
lower, 301
upper, 301, 309, 314, 315
upper QS-, 363
space of reference portfolios, 39
St. Petersburg paradox, 63
stability under pasting, 300
stable set of measures, 300, 364

458
Index
stable subspace of H2, 380
standard normal distribution, 78
statistical test, 415
randomized, 337, 341, 416
stochastic differential equation, 272
stochastic dominance, 84
ï¬rst order, 84, 106
second order, 75, 103, 134
stochastic kernel, 75, 89
stochastic order
concave, 82, 105
convex, 82, 325
monotone, 84, 106
stochastic process, 224
adapted, 224
predictable, 224
stop-loss contract, 67
stopping region, 292
stopping theorem, 283, 297
stopping time, 283
straddle, 15
strategy
L2-admissible, 374
locally risk-minimizing, 374
mean self-ï¬nancing, 374
self-ï¬nancing, 225
self-ï¬nancing in continuous time,
273
stress test measures, 209
strike price, 14, 234
strong law of large numbers, 43, 72, 74
strong orthogonality, 375
submartingale, 278
local, 352
submodular set function, 160, 191, 201
substitution axiom, 52
success ratio, 337
success set, 335
superhedging, 20, 282
duality, 315, 319, 369
strategy, 313, 369
supermartingale, 278
local, 352
superreplication strategy, 313, 314
support of a measure, 28
supremum norm, 426
sure-thing principle, 59
systems theorem, 229
theorem
Doobâ€™s systems theorem, 229
Dunfordâ€“Pettis, 432
Eberleinâ€“Å mulian, 432
Hahnâ€“Banach, 429
Halmosâ€“Savage, 37
Jamesâ€™, 432
Kreinâ€“Å mulian, 431
Krepsâ€“Yan, 37, 355
optional decomposition, 310
portmanteau, 420
Radonâ€“Nikodym, 403
randomizedBolzanoâ€“WeierstraÃŸ,
38
separating hyperplane, 399
separation, 429
stopping, 283, 297
superhedging duality, 315
optional sampling, 283
Theta of a call option, 268
tightness
of a set of measures, 421
of risk measure, 169
timeconsistencyofariskmeasure,306
time value, 22, 240
of a European call option, 240
topological space
connected, 49
Hausdorff, 48
topological vector space, 428
locally convex, 429
topology
weak, 430
weakâˆ—, 430
total variation, 163, 426
trading strategy, 224
generalized, 372

Index
459
replicating, 237
self-ï¬nancing, 225
L2-admissible, 374
transitive relation, 45
translation invariance, 153
2-alternatingsetfunction,160,191,201
type 2 error, 415
type 1 error, 415
uncertainty aversion, 90
Uniform Doob decomposition, 310
uniform Doob decomposition
under constraints, 360
universal arbitrage bounds, 22, 322
up-and-in call, 330
up-and-in option, 252, 257
Blackâ€“Scholes price of, 274
up-and-out call, 330, 332
up-and-out option, 235, 252, 258
upper QS-Snell envelope, 363
characterization of, 369
upper hedging price, 314
upper quantile function, 408
upper Snell envelope, 301, 309
characterization of, 315
optional decomposition of, 314
utility function, 62, 75, 109
CARA, 67, 73, 110, 116, 128, 132
CRRA, 68
decreasingly risk averse, 72
exponential,67,73,110,116,128,
132
HARA, 68, 110, 132
random, 134, 345
Value at Risk, 152, 159, 177, 178, 187,
330, 334
comonotonicity, 199
value process, 226
variance, 81
variance-optimal strategy, 393
vector lattice, 425
Vega of a call option, 269
volatility, 269, 272
von Neumannâ€“Morgenstern represen-
tation, 51, 57, 59, 61, 92
weak preference order, 45
weak topology
on a Banach space, 430
on a locally convex space, 430
weak topology for measures, 419
weakâˆ—topology, 430
weakly compact set, 432
Wiener measure, 271
Wiener process, 271
worstconditionalexpectation,176,188
worst-case risk measure, 157
on Lâˆ, 175, 180



