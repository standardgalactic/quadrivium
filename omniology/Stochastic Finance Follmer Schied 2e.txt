
de Gruyter Studies in Mathematics 27
Editors: Carlos Kenig ¬∑ Andrew Ranicki ¬∑ Michael R√∂ckner

de Gruyter Studies in Mathematics
1 Riemannian Geometry, 2nd rev. ed., Wilhelm P. A. Klingenberg
2 Semimartingales, Michel Me¬¥tivier
3 Holomorphic Functions of Several Variables, Ludger Kaup and Burchard Kaup
4 Spaces of Measures, Corneliu Constantinescu
5 Knots, 2nd rev. and ext. ed., Gerhard Burde and Heiner Zieschang
6 Ergodic Theorems, Ulrich Krengel
7 Mathematical Theory of Statistics, Helmut Strasser
8 Transformation Groups, Tammo tom Dieck
9 Gibbs Measures and Phase Transitions, Hans-Otto Georgii
10 Analyticity in Infinite Dimensional Spaces, Michel Herve¬¥
11 Elementary Geometry in Hyperbolic Space, Werner Fenchel
12 Transcendental Numbers, Andrei B. Shidlovskii
13 Ordinary Differential Equations, Herbert Amann
14 Dirichlet Forms and Analysis on Wiener Space, Nicolas Bouleau and
Francis Hirsch
15 Nevanlinna Theory and Complex Differential Equations, Ilpo Laine
16 Rational Iteration, Norbert Steinmetz
17 Korovkin-type Approximation Theory and its Applications, Francesco Altomare
and Michele Campiti
18 Quantum Invariants of Knots and 3-Manifolds, Vladimir G. Turaev
19 Dirichlet Forms and Symmetric Markov Processes, Masatoshi Fukushima,
Yoichi Oshima and Masayoshi Takeda
20 Harmonic Analysis of Probability Measures on Hypergroups, Walter R. Bloom
and Herbert Heyer
21 Potential Theory on Infinite-Dimensional Abelian Groups, Alexander Bendikov
22 Methods of Noncommutative Analysis, Vladimir E. Nazaikinskii,
Victor E. Shatalov and Boris Yu. Sternin
23 Probability Theory, Heinz Bauer
24 Variational Methods for Potential Operator Equations, Jan Chabrowski
25 The Structure of Compact Groups, Karl H. Hofmann and Sidney A. Morris
26 Measure and Integration Theory, Heinz Bauer
27 Stochastic Finance, 2nd rev. and ext. ed., Hans F√∂llmer and Alexander Schied
28 Painleve¬¥ Differential Equations in the Complex Plane, Valerii I. Gromak, Ilpo
Laine and Shun Shimomura
29 Discontinuous Groups of Isometries in the Hyperbolic Plane, Werner Fenchel
and Jakob Nielsen
30 The Reidemeister Torsion of 3-Manifolds, Liviu I. Nicolaescu
31 Elliptic Curves, Susanne Schmitt and Horst G. Zimmer

Hans F√∂llmer ¬∑ Alexander Schied
Stochastic Finance
An Introduction in Discrete Time
Second Revised and Extended Edition
Walter de Gruyter
Berlin ¬∑ New York
‚â•

Authors
Hans F√∂llmer
Institut f√ºr Mathematik
Humboldt Universit√§t zu Berlin
Unter den Linden 6
10099 Berlin
Germany
Alexander Schied
Institut f√ºr Mathematik, MA 74
Technische Universit√§t Berlin
Stra√üe des 17. Juni 136
10623 Berlin
Germany
Series Editors
Carlos E. Kenig
Department of Mathematics
University of Chicago
5734 University Ave
Chicago, IL 60637
USA
Andrew Ranicki
School of Mathematics
University of Edinburgh
Mayfield Road
Edinburgh EH9 3JZ
Great Britain
Michael R√∂ckner
Fakult√§t f√ºr Mathematik
Universit√§t Bielefeld
Universit√§tsstra√üe 25
33615 Bielefeld
Germany
Mathematics Subject Classification 2000: Primary: 60-01, 91-01, 91-02; secondary: 46N10, 60E15,
60G40, 60G42, 91B08, 91B16, 91B28, 91B30, 91B50, 91B52, 91B70
Keywords: Martingales, arbitrage, contingent claims, options, hedging, preferences, optimization, equi-
librium, value at risk, risk measures
E
P Printed on acid-free paper which falls within the guidelines of the ANSI
to ensure permanence and durability.
Library of Congress  Cataloging-in-Publication Data
F√∂llmer, Hans.
Stochastic finance : an introduction in discrete time / by Hans F√∂ll-
mer, Alexander Schied. 2nd rev. and extended ed.
p.
cm.  (De Gruyter studies in mathematics ; 27)
Includes bibliographical references and index.
ISBN 3-11-018346-3 (Cloth : alk. paper)
1. Finance  Statistical methods.
2. Stochastic analysis.
3. Prob-
abilities.
I. Schied, Alexander.
II. Title.
III. Series.
HG176.5.F65
2004
3321.011519232dc22
004021608
ISBN 3-11-018346-3
Bibliographic information published by Die Deutsche Bibliothek
Die Deutsche Bibliothek lists this publication in the Deutsche Nationalbibliografie;
detailed bibliographic data is available in the Internet at http://dnb.ddb.de.
 Copyright 2004 by Walter de Gruyter GmbH & Co. KG, 10785 Berlin, Germany.
All rights reserved, including those of translation into foreign languages. No part of this book may be
reproduced in any form or by any means, electronic or mechanical, including photocopy, recording, or
any information storage and retrieval system, without permission in writing from the publisher.
Printed in Germany.
Cover design: Rudolf H√ºbler, Berlin.
Typeset using the authors‚Äô TEX files: I. Zimmermann, Freiburg.
Printing and binding: Hubert & Co. GmbH & Co. KG, G√∂ttingen.

Preface to the second edition
Since the publication of the Ô¨Årst edition we have used it as the basis for several courses.
These include courses for a whole semester on Mathematical Finance in Berlin and
also short courses on special topics such as risk measures given at the Institut Henri
Poincar√© in Paris, at the Department of Operations Research at Cornell University, at
theAcademia Sinica in Taipei, and at the 8th Symposium on Probability and Stochastic
Processes in Puebla. In the process we have made a large number of minor corrections,
we have discovered many opportunities for simpliÔ¨Åcation and clariÔ¨Åcation, and we
have also learned more about several topics. As a result, major parts of this book
have been improved or even entirely rewritten. Among them are those on robust
representations of risk measures, arbitrage-free pricing of contingent claims, exotic
derivatives in the CRR model, convergence to Black‚ÄìScholes prices, and stability
under pasting with its connections to dynamically consistent coherent risk measures.
In addition, this second edition contains several new sections, including a systematic
discussion of law-invariant risk measures, of concave distortions, and of the relations
between risk measures and Choquet integration.
It is a pleasure to express our thanks to all students and colleagues whose comments
have helped us to prepare this second edition, in particular to Dirk Becherer, Hans
B√ºhler, Rose-Anne Dana, Ulrich Horst, Mesrop Janunts, Christoph K√ºhn, Maren
Liese, Harald Luschgy, Holger Pint, Philip Protter, Lothar Rogge, Stephan Sturm,
Stefan Weber, Wiebke Wittm√º√ü, and Ching-Tang Wu. Special thanks are due to Peter
Bank and toYuliya Mishura and Georgiy Shevchenko, our translators for the Russian
edition. Finally, we thank Irene Zimmermann and Manfred Karbe of de GruyterVerlag
for urging us to write a second edition and for their efÔ¨Åcient support.
Berlin, September 2004
Hans F√∂llmer
Alexander Schied


Preface to the Ô¨Årst edition
This book is an introduction to probabilistic methods in Finance. It is intended for
graduate students in mathematics, and it may also be useful for mathematicians in
academia and in the Ô¨Ånancial industry. Our focus is on stochastic models in discrete
time. This limitation has two immediate beneÔ¨Åts. First, the probabilistic machinery
is simpler, and we can discuss right away some of the key problems in the theory
of pricing and hedging of Ô¨Ånancial derivatives. Second, the paradigm of a complete
Ô¨Ånancial market, where all derivatives admit a perfect hedge, becomes the exception
rather than the rule. Thus, the discrete-time setting provides a shortcut to some of the
more recent literature on incomplete Ô¨Ånancial market models.
As a textbook for mathematicians, it is an introduction at an intermediate level,
with special emphasis on martingale methods. Since it does not use the continuous-
time methods of It√¥ calculus, it needs less preparation than more advanced texts such
as [73], [74], [82], [129], [188]. On the other hand, it is technically more demanding
than textbooks such as [160]: We work on general probability spaces, and so the text
captures the interplay between probability theory and functional analysis which has
been crucial for some of the recent advances in mathematical Ô¨Ånance.
The book is based on our notes for Ô¨Årst courses in Mathematical Finance which
both of us are teaching in Berlin at Humboldt University and at Technical University.
These courses are designed for students in mathematics with some background in
probability. Sometimes, they are given in parallel to a systematic course on stochastic
processes. At other times, martingale methods in discrete time are developed in the
course, as they are in this book. Usually the course is followed by a second course on
Mathematical Finance in continuous time. There it turns out to be useful that students
are already familiar with some of the key ideas of Mathematical Finance.
The core of this book is the dynamic arbitrage theory in the Ô¨Årst chapters of Part II.
When teaching a course, we found it useful to explain some of the main arguments
in the more transparent one-period model before using them in the dynamical setting.
So one approach would be to start immediately in the multi-period framework of
Chapter 5, and to go back to selected sections of Part I as the need arises. As an
alternative, one could Ô¨Årst focus on the one-period model, and then move on to Part II.
We include in Chapter 2 a brief introduction to the mathematical theory of expected
utility, even though this is a classical topic, and there is no shortage of excellent
expositions; see, for instance, [138] which happens to be our favorite. We have three
reasons for including this chapter. Our focus in this book is on incompleteness, and
incompleteness involves, in one form or another, preferences in the face of risk and
uncertainty. We feel that mathematicians working in this area should be aware, at
least to some extent, of the long line of thought which leads from Daniel Bernoulli via
von Neumann‚ÄìMorgenstern and Savage to some more recent developments which are
motivated by shortcomings of the classical paradigm. This is our Ô¨Årst reason. Second,

viii
Preface to the Ô¨Årst edition
the analysis of risk measures has emerged as a major topic in mathematical Ô¨Ånance,
and this is closely related to a robust version of the Savage theory. Third, but not least,
our experience is that this part of the course was found particularly enjoyable, both by
the students and by ourselves.
We acknowledge our debt and express our thanks to all colleagues who have
contributed, directly or indirectly, through their publications and through informal
discussions, to our understanding of the topics discussed in this book. Ideas and
methods developed by Freddy Delbaen, Darrell DufÔ¨Åe, Nicole El Karoui, David Heath,
Yuri Kabanov, Ioannis Karatzas, Dimitri Kramkov, David Kreps, Stanley Pliska, Chris
Rogers, Steve Ross, Walter Schachermayer, Martin Schweizer, Dieter Sondermann
and Christophe Stricker play a key role in our exposition. We are obliged to many
others; for instance the textbooks [54], [73], [74], [116], and [143] were a great help
when we started to teach courses on the subject.
We are grateful to all those who read parts of the manuscript and made useful
suggestions, in particular to Dirk Becherer, Ulrich Horst, Steffen Kr√ºger, Irina Penner,
and to Alexander Giese who designed some of the Ô¨Ågures. Special thanks are due to
Peter Bank for a large number of constructive comments. We also express our thanks to
Erhan √áinlar, Adam Monahan, and Philip Protter for improving some of the language,
and to the Department of Operations Research and Financial Engineering at Princeton
University for its hospitality during the weeks when we Ô¨Ånished the manuscript.
Berlin, June 2002
Hans F√∂llmer
Alexander Schied

Contents
Preface to the second edition
v
Preface to the Ô¨Årst edition
vii
I
Mathematical Ô¨Ånance in one period
1
1
Arbitrage theory
3
1.1
Assets, portfolios, and arbitrage opportunities . . . . . . . . . . . . .
3
1.2
Absence of arbitrage and martingale measures . . . . . . . . . . . . .
6
1.3
Derivative securities . . . . . . . . . . . . . . . . . . . . . . . . . . .
14
1.4
Complete market models . . . . . . . . . . . . . . . . . . . . . . . .
23
1.5
Geometric characterization of arbitrage-free models . . . . . . . . . .
27
1.6
Contingent initial data . . . . . . . . . . . . . . . . . . . . . . . . . .
31
2
Preferences
44
2.1
Preference relations and their numerical representation . . . . . . . .
45
2.2
Von Neumann‚ÄìMorgenstern representation . . . . . . . . . . . . . . .
51
2.3
Expected utility . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
61
2.4
Uniform preferences
. . . . . . . . . . . . . . . . . . . . . . . . . .
74
2.5
Robust preferences on asset proÔ¨Åles
. . . . . . . . . . . . . . . . . .
86
2.6
Probability measures with given marginals . . . . . . . . . . . . . . .
99
3
Optimality and equilibrium
108
3.1
Portfolio optimization and the absence of arbitrage
. . . . . . . . . . 108
3.2
Exponential utility and relative entropy . . . . . . . . . . . . . . . . . 116
3.3
Optimal contingent claims
. . . . . . . . . . . . . . . . . . . . . . . 125
3.4
Microeconomic equilibrium
. . . . . . . . . . . . . . . . . . . . . . 137
4
Monetary measures of risk
152
4.1
Risk measures and their acceptance sets . . . . . . . . . . . . . . . . 153
4.2
Robust representation of convex risk measures . . . . . . . . . . . . . 161
4.3
Convex risk measures on L‚àû. . . . . . . . . . . . . . . . . . . . . . 171
4.4
Value at Risk
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177
4.5
Law-invariant risk measures
. . . . . . . . . . . . . . . . . . . . . . 183
4.6
Concave distortions . . . . . . . . . . . . . . . . . . . . . . . . . . . 188
4.7
Comonotonic risk measures . . . . . . . . . . . . . . . . . . . . . . . 195
4.8
Measures of risk in a Ô¨Ånancial market
. . . . . . . . . . . . . . . . . 203
4.9
Shortfall risk
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 212

x
Contents
II
Dynamic hedging
221
5
Dynamic arbitrage theory
223
5.1
The multi-period market model . . . . . . . . . . . . . . . . . . . . . 223
5.2
Arbitrage opportunities and martingale measures
. . . . . . . . . . . 227
5.3
European contingent claims . . . . . . . . . . . . . . . . . . . . . . . 234
5.4
Complete markets . . . . . . . . . . . . . . . . . . . . . . . . . . . . 245
5.5
The binomial model . . . . . . . . . . . . . . . . . . . . . . . . . . . 248
5.6
Exotic derivatives . . . . . . . . . . . . . . . . . . . . . . . . . . . . 253
5.7
Convergence to the Black‚ÄìScholes price . . . . . . . . . . . . . . . . 259
6
American contingent claims
277
6.1
Hedging strategies for the seller
. . . . . . . . . . . . . . . . . . . . 277
6.2
Stopping strategies for the buyer . . . . . . . . . . . . . . . . . . . . 282
6.3
Arbitrage-free prices
. . . . . . . . . . . . . . . . . . . . . . . . . . 292
6.4
Stability under pasting
. . . . . . . . . . . . . . . . . . . . . . . . . 297
6.5
Lower and upper Snell envelopes . . . . . . . . . . . . . . . . . . . . 300
7
Superhedging
308
7.1
P -supermartingales . . . . . . . . . . . . . . . . . . . . . . . . . . . 308
7.2
Uniform Doob decomposition
. . . . . . . . . . . . . . . . . . . . . 310
7.3
Superhedging of American and European claims . . . . . . . . . . . . 313
7.4
Superhedging with liquid options . . . . . . . . . . . . . . . . . . . . 322
8
EfÔ¨Åcient hedging
333
8.1
Quantile hedging . . . . . . . . . . . . . . . . . . . . . . . . . . . . 333
8.2
Hedging with minimal shortfall risk
. . . . . . . . . . . . . . . . . . 339
9
Hedging under constraints
350
9.1
Absence of arbitrage opportunities . . . . . . . . . . . . . . . . . . . 350
9.2
Uniform Doob decomposition
. . . . . . . . . . . . . . . . . . . . . 357
9.3
Upper Snell envelopes
. . . . . . . . . . . . . . . . . . . . . . . . . 362
9.4
Superhedging and risk measures . . . . . . . . . . . . . . . . . . . . 369
10 Minimizing the hedging error
372
10.1 Local quadratic risk . . . . . . . . . . . . . . . . . . . . . . . . . . . 372
10.2 Minimal martingale measures . . . . . . . . . . . . . . . . . . . . . . 382
10.3 Variance-optimal hedging . . . . . . . . . . . . . . . . . . . . . . . . 392
Appendix
399
A.1
Convexity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 399
A.2
Absolutely continuous probability measures . . . . . . . . . . . . . . 403
A.3
Quantile functions . . . . . . . . . . . . . . . . . . . . . . . . . . . . 406
A.4
The Neyman‚ÄìPearson lemma . . . . . . . . . . . . . . . . . . . . . . 414

Contents
xi
A.5
The essential supremum of a family of random variables
. . . . . . . 417
A.6
Spaces of measures . . . . . . . . . . . . . . . . . . . . . . . . . . . 418
A.7
Some functional analysis . . . . . . . . . . . . . . . . . . . . . . . . 428
Notes
433
Bibliography
439
List of symbols
449
Index
451


Part I
Mathematical Ô¨Ånance in one period


Chapter 1
Arbitrage theory
In this chapter, we study the mathematical structure of a simple one-period model of a
Ô¨Ånancial market. We consider a Ô¨Ånite number of assets. Their initial prices at time t =
0 areknown, theirfuturepricesattimet = 1aredescribedasrandomvariablesonsome
probability space. Trading takes place at time t = 0. Already in this simple model,
some basic principles of mathematical Ô¨Ånance appear very clearly. In Section 1.2, we
single out those models which satisfy a condition of market efÔ¨Åciency: There are no
trading opportunities which yield a proÔ¨Åt without any downside risk. The absence
of such arbitrage opportunities is characterized by the existence of an equivalent
martingale measure. Under such a measure, discounted prices have the martingale
property, that is, trading in the assets is the same as playing a fair game. As explained
in Section 1.3, any equivalent martingale measure can be identiÔ¨Åed with a pricing rule:
It extends the given prices of the primary assets to a larger space of contingent claims,
or Ô¨Ånancial derivatives, without creating new arbitrage opportunities. In general, there
will be several such extensions. A given contingent claim has a unique price if and only
if it admits a perfect hedge. In our one-period model, this will be the exception rather
than the rule. Thus, we are facing market incompleteness, unless our model satisÔ¨Åes
the very restrictive conditions discussed in Section 1.4. The geometric structure of an
arbitrage-free model is described in Section 1.5.
The one-period market model will be used throughout the Ô¨Årst part of this book.
On the one hand, its structure is rich enough to illustrate some of the key ideas of the
Ô¨Åeld. On the other hand, it will provide an introduction to some of the mathematical
methods which will be used in the dynamic hedging theory of the second part. In fact,
the multi-period situation considered in Chapter 5 can be regarded as a sequence of
one-period models whose initial conditions are contingent on the outcomes of previous
periods. The techniques for dealing with such contingent initial data are introduced
in Section 1.6.
1.1 Assets, portfolios, and arbitrage opportunities
Consider a Ô¨Ånancial market with d + 1 assets. The assets can consist, for instance,
of equities, bonds, commodities, or currencies. In a simple one-period model, these
assets are priced at the initial time t = 0 and at the Ô¨Ånal time t = 1. We assume that
the ith asset is available at time 0 for a price œÄi ‚â•0. The collection
œÄ = (œÄ0, œÄ1, . . . , œÄd) ‚ààRd+1
+

4
1 Arbitrage theory
is called a price system. Prices at time 1 are usually not known beforehand at time 0.
In order to model this uncertainty, we Ô¨Åx a probability space (, F , P ) and describe
the asset prices at time 1 as non-negative measurable functions
S0, S1, . . . , Sd
on (, F ) with values in [0, ‚àû). Every œâ ‚àà corresponds to a particular scenario
of market evolution, and Si(œâ) is the price of the ith asset at time 1 if the scenario œâ
occurs.
However, not all asset prices in a market are necessarily uncertain. Usually there
is a riskless bond which will pay a sure amount at time 1. In our simple model for one
period, such a riskless investment opportunity will be included by assuming that
œÄ0 = 1
and
S0 ‚â°1 + r
for a constant r, the return of a unit investment into the riskless bond. In most situations
it would be natural to assume r ‚â•0, but for our purposes it is enough to require that
S0 > 0, or equivalently that
r > ‚àí1.
In order to distinguish S0 from the risky assets S1, . . . , Sd, it will be convenient to
use the notation
S = (S0, S1, . . . , Sd) = (S0, S),
and in the same way we will write œÄ = (1, œÄ).
At time t = 0, an investor will choose a portfolio
Œæ = (Œæ0, Œæ) = (Œæ0, Œæ1, . . . , Œæd) ‚ààRd+1,
where Œæi represents the number of shares of the ith asset. The price for buying the
portfolio Œæ equals
œÄ ¬∑ Œæ =
d

i=0
œÄiŒæi.
At time t = 1, the portfolio will have the value
Œæ ¬∑ S(œâ) =
d

i=0
ŒæiSi(œâ) = Œæ0(1 + r) + Œæ ¬∑ S(œâ),
depending on the scenario œâ ‚àà. Here we assume implicitly that buying and selling
assets does not create extra costs, an assumption which may not be valid for a small
investor but which becomes more realistic for a large Ô¨Ånancial institution. Note our
convention of writing x ¬∑ y for the inner product of two vectors x and y in Euclidean
space.
Our deÔ¨Ånition of a portfolio allows the components Œæi to be negative. If Œæ0 < 0,
this corresponds to taking out a loan such that we receive the amount |Œæ0| at t = 0

1.1 Assets, portfolios, and arbitrage opportunities
5
and pay back the amount (1 + r)|Œæ0| at time t = 1. If Œæi < 0 for i ‚â•1, a quantity of
|Œæi| shares of the ith asset is sold without actually owning them. This corresponds to
a short sale of the asset. In particular, an investor is allowed to take a short position
Œæi < 0, and to use up the received amount œÄi|Œæi| for buying quantities Œæj ‚â•0, j Ã∏= i,
of the other assets. In this case, the price of the portfolio Œæ = (Œæ0, Œæ) is given by
Œæ ¬∑ œÄ = 0.
DeÔ¨Ånition 1.1. A portfolio Œæ ‚ààRd+1 is called an arbitrage opportunity if œÄ ¬∑ Œæ ‚â§0
but Œæ ¬∑ S ‚â•0 P -a.s. and P [ Œæ ¬∑ S > 0 ] > 0.
Intuitively, an arbitrage opportunity is an investment strategy that yields with
positive probability a positive proÔ¨Åt and is not exposed to any downside risk. The
existence of such an arbitrage opportunity may be regarded as a market inefÔ¨Åciency
in the sense that certain assets are not priced in a reasonable way. In real-world
markets, arbitrage opportunities are rather hard to Ô¨Ånd. If such an opportunity would
show up, it would generate a large demand, prices would adjust, and the opportunity
would disappear. Later on, the absence of such arbitrage opportunities will be our
key assumption. Absence of arbitrage implies that Si vanishes P -a.s. once œÄi = 0.
Hence, there is no loss in generality if we assume from now on that
œÄi > 0
for i = 1, . . . , d.
Remark 1.2. Note that the probability measure P enters the deÔ¨Ånition of an arbitrage
opportunity only through the null sets of P . In particular, the deÔ¨Ånition can be for-
mulated without any explicit use of probabilities if  is countable. In this case there
is no loss of generality in assuming that the underlying probability measure satisÔ¨Åes
P[{œâ}] > 0 for every œâ ‚àà. Then an arbitrage opportunity is simply a portfolio Œæ
with œÄ ¬∑ Œæ ‚â§0, with Œæ ¬∑ S(œâ) ‚â•0 for all œâ ‚àà, and such that Œæ ¬∑ S(œâ0) > 0 for at
least one œâ0 ‚àà.
‚ô¶
The following lemma shows that absence of arbitrage is equivalent to the following
property of the market: Any investment in risky assets which yields with positive
probability a better result than investing the same amount in the risk-free asset must
be open to some downside risk.
Lemma 1.3. The following statements are equivalent.
(a) The market model admits an arbitrage opportunity.
(b) There is a vector Œæ ‚ààRd such that
Œæ ¬∑ S ‚â•(1 + r)Œæ ¬∑ œÄ P -a.s.
and
P [ Œæ ¬∑ S > (1 + r)Œæ ¬∑ œÄ ] > 0.
Proof. To see that (a) implies (b), let Œæ be an arbitrage opportunity. Then 0 ‚â•Œæ ¬∑œÄ =
Œæ0 + Œæ ¬∑ œÄ. Hence,
Œæ ¬∑ S ‚àí(1 + r)Œæ ¬∑ œÄ ‚â•Œæ ¬∑ S + (1 + r)Œæ0 = Œæ ¬∑ S.

6
1 Arbitrage theory
Since Œæ ¬∑S is P -a.s. non-negative and strictly positive with non-vanishing probability,
the same must be true of Œæ ¬∑ S ‚àí(1 + r)Œæ ¬∑ œÄ.
Next let Œæ be as in (b). We claim that the portfolio (Œæ0, Œæ) with Œæ0 := ‚àíŒæ ¬∑ œÄ is
an arbitrage opportunity. Indeed, Œæ ¬∑ œÄ = Œæ0 + Œæ ¬∑ œÄ = 0 by deÔ¨Ånition. Moreover,
Œæ ¬∑ S = ‚àí(1 + r)Œæ ¬∑ œÄ + Œæ ¬∑ S, which is P -a.s. non-negative and strictly positive with
non-vanishing probability.
1.2 Absence of arbitrage and martingale measures
In this section, we are going to characterize those market models which do not admit
any arbitrage opportunities. Such models will be called arbitrage-free.
DeÔ¨Ånition 1.4. A probability measure P ‚àóis called a risk-neutral measure, or a mar-
tingale measure, if
œÄi = E‚àó

Si
1 + r

,
i = 0, 1, . . . , d.
(1.1)
Remark 1.5. In (1.1), the price of the ith asset is identiÔ¨Åed as the expectation of
the discounted payoff under the measure P ‚àó. Thus, the pricing formula (1.1) can
be seen as a classical valuation formula which does not take into account any risk
aversion, in contrast to valuations in terms of expected utility which will be discussed
in Section 2.3. This is why a measure P ‚àósatisfying (1.1) is called risk-neutral. The
connection to martingales will be made explicit in Section 1.6.
‚ô¶
The following basic result is sometimes called the ‚Äúfundamental theorem of asset
pricing‚Äù or, in short, FTAP. It characterizes arbitrage-free market models in terms of
the set
P :=

P ‚àó| P ‚àóis a risk-neutral measure with P ‚àó‚âàP

of risk-neutral measures which are equivalent to P . Recall that two probability mea-
sures P ‚àóand P are said to be equivalent (P ‚àó‚âàP ) if, for A ‚ààF , P ‚àó[ A ] = 0 if
and only if P[ A ] = 0. This holds if and only if P ‚àóhas a strictly positive density
dP ‚àó/dP with respect to P ; see Appendix A.2. An equivalent risk-neutral measure is
also called a pricing measure or an equivalent martingale measure.
Theorem 1.6. A market model is arbitrage-free if and only if P Ã∏= ‚àÖ. In this case,
there exists a P ‚àó‚ààP which has a bounded density dP ‚àó/dP .
We show Ô¨Årst that the existence of a risk-neutral measure implies the absence of
arbitrage.
Proof of the implication ‚áêof Theorem 1.6.
Suppose that there exists a risk-neutral
measure P ‚àó‚ààP .
Take a portfolio Œæ ‚ààRd+1 such that Œæ ¬∑ S ‚â•0 P -a.s. and

1.2 Absence of arbitrage and martingale measures
7
E[ Œæ ¬∑S ] > 0. Both properties remain valid if we replace P by the equivalent measure
P ‚àó. Hence,
œÄ ¬∑ Œæ =
d

i=0
œÄiŒæi =
d

i=0
E‚àó
 ŒæiSi
1 + r

= E‚àó
 Œæ ¬∑ S
1 + r

> 0.
Thus, Œæ cannot be an arbitrage opportunity.
For the proof of the implication ‚áíof Theorem 1.6, it will be convenient to
introduce the random vector Y = (Y 1, . . . , Y d) of discounted net gains:
Y i :=
Si
1 + r ‚àíœÄi,
i = 1, . . . , d.
(1.2)
With this notation, Lemma 1.3 implies that the absence of arbitrage is equivalent to
the following condition:
For Œæ ‚ààRd:
Œæ ¬∑ Y ‚â•0 P -a.s. "‚áíŒæ ¬∑ Y = 0 P -a.s.
(1.3)
Since Y i is bounded from below by ‚àíœÄi, the expectation E‚àó[ Y i ] of Y i under any
measure P ‚àóis well-deÔ¨Åned, and so P ‚àóis a risk-neutral measure if and only if
E‚àó[ Y ] = 0.
(1.4)
Here, E‚àó[ Y ] is a shorthand notation for the d-dimensional vector with components
E‚àó[ Y i ], i = 1, . . . , d. The assertion of Theorem 1.6 can now be read as follows:
Condition (1.3) holds if and only if there exists some P ‚àó‚âàP such that E‚àó[ Y ] = 0,
and in this case, P ‚àócan be chosen such that the density dP ‚àó/dP is bounded.
Proof of the implication ‚áíof Theorem 1.6. We have to show that (1.3) implies the
existence of some P ‚àó‚âàP such that (1.4) holds and such that the density dP ‚àó/dP is
bounded. We will do this Ô¨Årst in the case in which
E[ |Y| ] < ‚àû.
Let Q denote the convex set of all probability measures Q ‚âàP with bounded
densities dQ/dP , and denote by EQ[ Y ] the d-dimensional vector with components
EQ[ Y i ], i = 1, . . . , d. Due to our assumption that |Y| ‚ààL1(P ), all these expecta-
tions are Ô¨Ånite. Let
C := { EQ[ Y ] | Q ‚ààQ },
and note that C is a convex set in Rd: If Q1, Q0 ‚ààQ and 0 ‚â§Œ± ‚â§1, then
QŒ± := Œ±Q1 + (1 ‚àíŒ±)Q0 ‚ààQ and
Œ±EQ1[ Y ] + (1 ‚àíŒ±)EQ0[ Y ] = EQŒ±[ Y ],
which lies in C.

8
1 Arbitrage theory
Our aim is to show that C contains the origin. To this end, we suppose by way of
contradictionthat0 /‚ààC. Usingthe‚Äúseparatinghyperplanetheorem‚Äùintheelementary
form of Proposition A.1, we obtain a vector Œæ ‚ààRd such that Œæ ¬∑ x ‚â•0 for all x ‚ààC,
and such that Œæ ¬∑ x0 > 0 for some x0 ‚ààC. Thus, Œæ satisÔ¨Åes EQ[ Œæ ¬∑ Y ] ‚â•0 for all
Q ‚ààQ and EQ0[ Œæ ¬∑ Y ] > 0 for some Q0 ‚ààQ. Clearly, the latter condition yields
that P[ Œæ ¬∑ Y > 0 ] > 0. We claim that the Ô¨Årst condition implies that Œæ ¬∑ Y is P -a.s.
non-negative. This fact will be a contradiction to our assumption (1.3) and thus will
prove that 0 ‚ààC.
To prove the claim that Œæ ¬∑Y ‚â•0 P -a.s., let A := { Œæ ¬∑Y < 0}, and deÔ¨Åne functions
œïn :=

1 ‚àí1
n

¬∑ IA + 1
n ¬∑ IAc .
We take œïn as densities for new probability measures Qn:
dQn
dP
:=
1
E[ œïn ] ¬∑ œïn,
n = 2, 3, . . . .
Since 0 < œïn ‚â§1, it follows that Qn ‚ààQ, and thus that
0 ‚â§Œæ ¬∑ EQn[ Y ] =
1
E[ œïn ] E[ Œæ ¬∑ Y œïn ].
Hence, Lebesgue‚Äôs dominated convergence theorem yields that
E

Œæ ¬∑ Y I{ Œæ¬∑Y<0 }

= lim
n‚Üë‚àûE[ Œæ ¬∑ Y œïn ] ‚â•0.
This proves the claim that Œæ ¬∑ Y ‚â•0 P -a.s. and completes the proof of Theorem 1.6
in case E[ |Y| ] < ‚àû.
If Y is not P -integrable, then we simply replace the probability measure P by
a suitable equivalent measure 
P whose density d 
P /dP is bounded and for which

E[ |Y| ] < ‚àû. For instance, one can deÔ¨Åne 
P by
d 
P
dP =
c
1 + |Y|
for c :=

E

1
1 + |Y|
‚àí1
.
Recall from Remark 1.2 that replacing P with an equivalent probability measure does
not affect the absence of arbitrage opportunities in our market model. Thus, the Ô¨Årst
part of this proof yields a risk-neutral measure P ‚àówhich is equivalent to 
P and whose
density dP ‚àó/d 
P is bounded. Then P ‚àó‚ààP, and
dP ‚àó
dP = dP ‚àó
d 
P
¬∑ d 
P
dP
is bounded. Hence, P ‚àóis as desired, and the theorem is proved.

1.2 Absence of arbitrage and martingale measures
9
Remark 1.7. Our assumption that asset prices are non-negative implies that the com-
ponents of Y are bounded from below. Note however that this assumption was not
needed in our proof. Thus, Theorem 1.6 also holds if we only assume that S is Ô¨Ånite-
valued and œÄ ‚ààRd. In this case, the deÔ¨Ånition of a risk-neutral measure P ‚àóvia
(1.1) is meant to include the assumption that Si is integrable with respect to P ‚àófor
i = 1, . . . , d.
‚ô¶
Example 1.8. Let P be any probability measure on the Ô¨Ånite set  := { œâ1, . . . , œâN }
that assigns strictly positive probability pi to each singleton { œâi }. Suppose that there
is a single risky asset deÔ¨Åned by its price œÄ = œÄ1 at time 0 and by the random variable
S = S1. We may assume without loss of generality that the values si := S(œâi) are
distinct and arranged in increasing order: s1 < ¬∑ ¬∑ ¬∑ < sN. According to Theorem 1.6,
this model does not admit arbitrage opportunities if and only if
œÄ(1 + r) ‚àà{ 
E[ S ] | 
P ‚âàP } =
$
N

i=1
sipi
 pi > 0,
N

i=1
pi = 1
%
= (s1, sN),
and P ‚àóis a risk-neutral measure if and only if the probabilities p‚àó
i := P ‚àó[ {œâi} ] solve
the linear equations
s1p‚àó
1 + ¬∑ ¬∑ ¬∑ + sNp‚àó
N = œÄ(1 + r),
p‚àó
1 + ¬∑ ¬∑ ¬∑ + p‚àó
N = 1.
If a solution exists, it will be unique if and only if N = 2, and there will be inÔ¨Ånitely
many solutions for N > 2.
‚ô¶
Remark 1.9. The economic reason for working with the discounted asset prices
Xi :=
Si
1 + r ,
i = 0, . . . , d,
(1.5)
is that one should distinguish between one unit of a currency (e.g. ‚Ç¨) at time t = 0
and one unit at time t = 1. Usually people tend to prefer a certain amount today over
the same amount which is promised to be paid at a later time. Such a preference is
reÔ¨Çected in an interest r > 0 paid by the riskless bond: Only the amount 1/(1 + r) ‚Ç¨
must be invested at time 0 to obtain 1 ‚Ç¨ at time 1. This effect is sometimes referred to
as the time value of money. Similarly, the price Si of the ith asset is quoted in terms
of ‚Ç¨ at time 1, while œÄi corresponds to time-zero euros. Thus, in order to compare
the two prices œÄi and Si, one should Ô¨Årst convert them to a common standard. This is
achieved by taking the riskless bond as a num√©raire and by considering the discounted
prices in (1.5).
‚ô¶
Remark 1.10. One can choose as num√©raire any asset which is strictly positive. For
instance, suppose that œÄ1 > 0 and P [ S1 > 0 ] = 1. Then all asset prices can be
expressed in units of the Ô¨Årst asset by considering
œÄi := œÄi
œÄ1
and
Si
S1 ,
i = 0, . . . , d.

10
1 Arbitrage theory
Clearly, the deÔ¨Ånition of an arbitrage opportunity is independent of the choice of a
particular num√©raire. Thus, an arbitrage-free market model should admit a risk-neutral
measure with respect to the new num√©raire, i.e., a probability measure 
P ‚àó‚âàP such
that
œÄi = 
E‚àó
 Si
S1

,
i = 0, . . . , d.
Let us denote by 
P the set of all such measures 
P ‚àó. Then

P =
$

P ‚àó d 
P ‚àó
dP =
S1
E‚àó[ S1 ] for some P ‚àó‚ààP
%
.
Indeed, if 
P ‚àólies in the set on the right, then

E‚àó
 Si
S1

= E‚àó[ Si ]
E‚àó[ S1 ] = œÄi
œÄ1 = œÄi,
and so 
P ‚àó‚àà
P . Reversing the roles of 
P and P then yields the identity of the two
sets. Note that
P ‚à©
P = ‚àÖ
as soon as S1 is not P -a.s. constant, because Jensen‚Äôs inequality then implies that
1
œÄ1 = œÄ0 = 
E‚àó 1 + r
S1
!
>
1 + r

E‚àó[ S1 ]
and hence 
E‚àó[ S1 ] > E‚àó[ S1 ] for all 
P ‚àó‚àà
P and P ‚àó‚ààP .
‚ô¶
Let
V :=

Œæ ¬∑ S | Œæ ‚ààRd+1 
denote the linear space of all payoffs which can be generated by some portfolio. An
element of V will be called an attainable payoff. The portfolio that generates V ‚ààV
is in general not unique, but we have the following law of one price.
Lemma 1.11. Suppose that the market model is arbitrage-free and that V ‚ààV can
be written as V = Œæ ¬∑ S = Œ∂ ¬∑ S P -a.s. for two different portfolios Œæ and Œ∂. Then
œÄ ¬∑ Œæ = œÄ ¬∑ Œ∂.
Proof. We have (Œæ ‚àíŒ∂) ¬∑ S = 0 P ‚àó-a.s. for any P ‚àó‚ààP . Hence,
œÄ ¬∑ Œæ ‚àíœÄ ¬∑ Œ∂ = E‚àó
 (Œæ ‚àíŒ∂) ¬∑ S
1 + r

= 0,
due to (1.1).
By the preceding lemma, it makes sense to deÔ¨Åne the price of V ‚ààV as
œÄ(V ) := œÄ ¬∑ Œæ
if V = Œæ ¬∑ S,
(1.6)
whenever the market model is arbitrage-free.

1.2 Absence of arbitrage and martingale measures
11
Remark 1.12. Via (1.6), the price system œÄ can be regarded as a linear form on the
Ô¨Ånite-dimensional vector space V. For any P ‚àó‚ààP we have
œÄ(V ) = E‚àó 
V
1 + r
!
,
V ‚ààV.
Thus, an equivalent risk-neutral measure P ‚àódeÔ¨Ånes a linear extension of œÄ onto the
larger space L1(P ‚àó) of P ‚àó-integrable random variables. Since this space is usually
inÔ¨Ånite-dimensional, one cannot expect that such a pricing measure is in general
unique; see however Section 1.4.
‚ô¶
We have seen above that, in an arbitrage-free market model, the condition Œæ ¬∑S = 0
P-a.s. implies that œÄ ¬∑ Œæ = 0. In fact, one may assume without loss of generality that
Œæ ¬∑ S = 0 P -a.s.
"‚áí
Œæ = 0,
(1.7)
for otherwise we can Ô¨Ånd i ‚àà{0, . . . , d} such that Œæi Ã∏= 0 and represent the ith asset
as a linear combination of the remaining ones:
œÄi = 1
Œæi

jÃ∏=i
ŒæjœÄj
and
Si = 1
Œæi

jÃ∏=i
ŒæjSj.
In this sense, the ith asset is redundant and can be omitted.
DeÔ¨Ånition 1.13. The market model is called non-redundant if (1.7) holds.
Remark 1.14. In any non-redundant market model, the components of the vector Y
of discounted net gains are linearly independent in the sense that
Œæ ¬∑ Y = 0 P -a.s.
"‚áí
Œæ = 0.
(1.8)
Conversely, via (1.3), condition (1.8) implies non-redundance if the market model is
arbitrage-free.
‚ô¶
DeÔ¨Ånition 1.15. Suppose that the market model is arbitrage-free and that V ‚ààV is
an attainable payoff such that œÄ(V ) Ã∏= 0. Then the return of V is deÔ¨Åned by
R(V ) := V ‚àíœÄ(V )
œÄ(V )
.
Note that we have already seen the special case of the risk-free return
r = S0 ‚àíœÄ0
œÄ0
= R(S0).
If an attainable payoff V is a linear combination V = n
k=1 Œ±kVk of non-zero attain-
able payoffs Vk, then
R(V ) =
n

k=1
Œ≤kR(Vk)
for Œ≤k =
Œ±kœÄ(Vk)
n
i=1 Œ±iœÄ(Vi).

12
1 Arbitrage theory
The coefÔ¨Åcient Œ≤k can be interpreted as the proportion of the investment allocated to
Vk. As a particular case of the formula above, we have that
R(V ) =
d

i=0
œÄi Œæi
œÄ ¬∑ Œæ
¬∑ R(Si)
for all non-zero attainable payoffs V = Œæ ¬∑ S (recall that we have assumed that all œÄi
are strictly positive).
Proposition 1.16. Suppose that the market model is arbitrage-free, and let V ‚ààV be
an attainable payoff such that œÄ(V ) Ã∏= 0.
(a) Under any risk-neutral measure P ‚àó, the expected return of V is equal to the
risk-free return r:
E‚àó[ R(V ) ] = r.
(b) Under any measure Q ‚âàP such that EQ[ |S| ] < ‚àû, the expected return of V
is given by
EQ[ R(V ) ] = r ‚àícovQ
dP ‚àó
dQ , R(V )

,
where P ‚àóis an arbitrary risk-neutral measure in P and covQ denotes the
covariance with respect to Q.
Proof. (a): Since E‚àó[ V ] = œÄ(V )(1 + r), we have
E‚àó[ R(V ) ] = E‚àó[ V ] ‚àíœÄ(V )
œÄ(V )
= r.
(b): Let P ‚àó‚ààP and œï‚àó:= dP ‚àó/dQ. Then
covQ

œï‚àó, R(V )

= EQ[ œï‚àóR(V ) ] ‚àíEQ[ œï‚àó] ¬∑ EQ[ R(V ) ]
= E‚àó[ R(V ) ] ‚àíEQ[ R(V ) ].
Using part (a) yields the assertion.
Remark 1.17. Let us comment on the extension of the fundamental equivalence in
Theorem 1.6 to market models with an inÔ¨Ånity of tradable assets S0, S1, S2, . . . . We
assume that S0 ‚â°1 + r for some r > ‚àí1 and that the random vector
S(œâ) =

S1(œâ), S2(œâ), . . .

takes values in the space ‚Ñì‚àûof bounded real sequences. This space is a Banach space
with respect to the norm
‚à•x‚à•‚àû:= sup
i‚â•1
|xi|
for x = (x1, x2, . . . ) ‚àà‚Ñì‚àû.

1.2 Absence of arbitrage and martingale measures
13
A portfolio Œæ = (Œæ0, Œæ) is chosen in such a way that Œæ = (Œæ1, Œæ2, . . . ) is a sequence
in the space ‚Ñì1, i.e., ‚àû
i=1 |Œæi| < ‚àû. We assume that the corresponding price system
œÄ = (œÄ0, œÄ) satisÔ¨Åes œÄ ‚àà‚Ñì‚àûand œÄ0 = 1. Clearly, this model class includes our
model with d + 1 traded assets as a special case.
Our Ô¨Årst observation is that the implication ‚áêof Theorem 1.6 remains valid, i.e.,
the existence of a measure P ‚àó‚âàP with the properties
E‚àó[ ‚à•S‚à•‚àû] < ‚àû
and
E‚àó

Si
1 + r

= œÄi
implies the absence of arbitrage opportunities. To this end, suppose that Œæ is a portfolio
strategy such that
Œæ ¬∑ S ‚â•0 P -a.s.
and
E[ Œæ ¬∑ S ] > 0.
(1.9)
Then we can replace P in (1.9) by the equivalent measure P ‚àó. Hence, Œæ cannot be an
arbitrage opportunity since
Œæ ¬∑ œÄ =
‚àû

i=0
ŒæiE‚àó

Si
1 + r

= E‚àó
 Œæ ¬∑ S
1 + r

> 0.
Note that interchanging summation and integration is justiÔ¨Åed by dominated conver-
gence, because
Œæ0 + ‚à•S‚à•‚àû
‚àû

i=0
|Œæi| ‚ààL1(P ‚àó).
The following example shows that the implication ‚áíof Theorem 1.6, namely that
absence of arbitrage opportunities implies the existence of a risk-neutral measure, may
no longer be true in an inÔ¨Ånite market model.
‚ô¶
Example 1.18. Let  = {1, 2, . . . }, and choose any probability measure P which
assigns strictly positive probability to all singletons {œâ}. We take r = 0 and deÔ¨Åne a
price system œÄi = 1, for i = 0, 1, . . . . Prices at time 1 are given by S0 ‚â°1 and, for
i = 1, 2, . . . , by
Si(œâ) =
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
0
if œâ = i,
2
if œâ = i + 1,
1
otherwise.
Let us show that this market model is arbitrage-free. To this end, suppose that Œæ =
(Œæ0, Œæ) is a portfolio such that Œæ ‚àà‚Ñì1 and such that Œæ ¬∑ S(œâ) ‚â•0 for each œâ ‚àà, but
such that œÄ ¬∑ Œæ ‚â§0. Considering the case œâ = 1 yields
0 ‚â§Œæ ¬∑ S(1) = Œæ0 +
‚àû

k=2
Œæk = œÄ ¬∑ Œæ ‚àíŒæ1 ‚â§‚àíŒæ1.

14
1 Arbitrage theory
Similarly, for œâ = i > 1,
0 ‚â§Œæ ¬∑ S(œâ) = Œæ0 + 2Œæi‚àí1 +
‚àû

k=1
kÃ∏=i,i‚àí1
Œæk = œÄ ¬∑ Œæ + Œæi‚àí1 ‚àíŒæi ‚â§Œæi‚àí1 ‚àíŒæi.
It follows that 0 ‚â•Œæ1 ‚â•Œæ2 ‚â•¬∑ ¬∑ ¬∑ . But this can only be true if all Œæi vanish, since we
have assumed that Œæ ‚àà‚Ñì1. Hence, there are no arbitrage opportunities.
However, there exists no probability measure P ‚àó‚âàP such that E‚àó[ Si ] = œÄi for
all i. Such a measure P ‚àówould have to satisfy
1 = E‚àó[Si ] = 2P ‚àó[{i + 1}] +
‚àû

k=1
kÃ∏=i,i+1
P ‚àó[{k} ]
= 1 + P ‚àó[{i + 1}] ‚àíP ‚àó[{i}]
for i > 1. This relation implies that P ‚àó[ {i} ] = P ‚àó[ {i+1} ] for all i > 1, contradicting
the assumption that P ‚àóis a probability measure and equivalent to P .
‚ô¶
1.3 Derivative securities
In real Ô¨Ånancial markets, not only the primary assets are traded. There is also a large
variety of securities whose payoff depends in a non-linear way on the primary assets
S0, S1, . . . , Sd, and sometimes also on other factors. Such Ô¨Ånancial instruments are
usually called derivative securities, options, or contingent claims.
Example 1.19. Under a forward contract, one agent agrees to sell to another agent an
asset at time 1 for a price K which is speciÔ¨Åed at time 0. Thus, the owner of a forward
contract on the ith asset gains the difference between the actual market price Si and
the delivery price K if Si is larger than K at time 1. If Si < K, the owner loses
the amount K ‚àíSi to the issuer of the forward contract. Hence, a forward contract
corresponds to the random payoff
Cfw = Si ‚àíK.
‚ô¶
Example 1.20. The owner of a call option on the ith asset has the right, but not the
obligation, to buy the ith asset at time 1 for a Ô¨Åxed price K, called the strike price.
This corresponds to a payoff of the form
Ccall = (Si ‚àíK)+ =

Si ‚àíK
if Si > K,
0
otherwise.

1.3 Derivative securities
15
Conversely, a put option gives the right, but not the obligation, to sell the asset at time
1 for a strike price K. The corresponding random payoff is given by
Cput = (K ‚àíSi)+ =

K ‚àíSi
if Si < K,
0
otherwise.
Call and put options with the same strike K are related through the formula
Ccall ‚àíCput = Si ‚àíK.
Hence, if the price œÄ(Ccall) of a call option has already been Ô¨Åxed, then the price
œÄ(Cput) of the corresponding put option is determined by linearity through the put-
call parity
œÄ(Ccall) = œÄ(Cput) + œÄi ‚àí
K
1 + r .
(1.10)
‚ô¶
Example 1.21. An option on the value V = Œæ ¬∑ S of a portfolio of several risky assets
is sometimes called a basket or index option. For instance, a basket call would be of
the form (V ‚àíK)+.
‚ô¶
Put and call options can be used as building blocks for a large class of derivatives.
Example 1.22. A straddle is a combination of ‚Äúat-the-money" put and call options
on a portfolio V = Œæ ¬∑ S, i.e., on put and call options with strike K = œÄ(V ):
C = (œÄ(V ) ‚àíV )+ + (V ‚àíœÄ(V ))+ = |V ‚àíœÄ(V )|.
Thus, the payoff of the straddle increases proportionally to the change of the price of
Œæ between time 0 and time 1. In this sense, a straddle is a bet that the portfolio price
will move, no matter in which direction.
‚ô¶
Example 1.23. The payoff of a butterÔ¨Çy spread is of the form
C =

K ‚àí|V ‚àíœÄ(V )|
+,
where K > 0 and where V = Œæ ¬∑ S is the price of a given portfolio or the value of
a stock index. Clearly, the payoff of the butterÔ¨Çy spread is maximal if V = œÄ(V )
and decreases if the price at time 1 of the portfolio Œæ deviates from its price at time 0.
Thus, the butterÔ¨Çy spread is a bet that the portfolio price will stay close to its present
value. By letting K¬± := œÄ(V ) ¬± K, we can represent C as combinations of call or
put options on V :
C = (V ‚àíK‚àí)+ ‚àí2(V ‚àíœÄ(V ))+ + (V ‚àíK+)+
= ‚àí(K‚àí‚àíV )+ + 2(œÄ(V ) ‚àíV )+ ‚àí(K+ ‚àíV )+.
‚ô¶

16
1 Arbitrage theory
Example 1.24. The idea of portfolio insurance is to increase exposure to rising asset
prices, and to reduce exposure to falling prices. This suggests to replace the payoff
V = Œæ ¬∑ S of a given portfolio by a modiÔ¨Åed proÔ¨Åle h(V ), where h is convex and
increasing. Let us Ô¨Årst consider the case where V ‚â•0. Then the corresponding
payoff h(V ) can be expressed as a combination of investments in bonds, in V it-
self, and in basket call options on V . To see this, recall that convexity implies that
h(x) = h(0) +
 x
0 h‚Ä≤(y) dy for the increasing right-hand derivative h‚Ä≤ := h‚Ä≤
+ of h;
see Appendix A.1. Note that h‚Ä≤ can be represented as the distribution function of a
positive Radon measure Œ≥ on [0, ‚àû): h‚Ä≤(x) = Œ≥ ([0, x]) for x ‚â•0. Hence, Fubini‚Äôs
theorem implies that
h(x) = h(0) +
 x
0

[0,y]
Œ≥ (dz) dy
= h(0) + Œ≥ ({0}) x +

(0,‚àû)

{y | z‚â§y‚â§x}
dy Œ≥ (dz).
Since the inner integral equals (x ‚àíz)+, we obtain
h(V ) = h(0) + h‚Ä≤(0) V +

(0,‚àû)
(V ‚àíz)+ Œ≥ (dz).
(1.11)
The payoff V = Œæ ¬∑ S may take negative values if the portfolio Œæ contains also
short positions. In this case, the increasing convex function h must be deÔ¨Åned on all
of R. Its right-hand derivative h‚Ä≤ can be represented as
h‚Ä≤(y) ‚àíh‚Ä≤(x) = Œ≥

(x, y]

,
x < y,
for a positive Radon measure Œ≥ on R. Looking separately at the cases x < 0 and
x ‚â•0, we see that
h(x) = h(0) + h‚Ä≤(0) x +

(0,‚àû)
(x ‚àíz)+ Œ≥ (dz) +

(‚àí‚àû,0]
(z ‚àíx)+ Œ≥ (dz).
Thus, the payoff h(V ) can be realized by holding bonds, shares in V , and a mixture
of call and put options on V :
h(V ) = h(0) + h‚Ä≤(0) V +

(0,‚àû)
(V ‚àíz)+ Œ≥ (dz) +

(‚àí‚àû,0]
(z ‚àíV )+ Œ≥ (dz).
‚ô¶
Example 1.25. A reverse convertible bond pays interest which is higher than that
earned by an investment into the riskless bond. But at maturity t = 1, the issuer may
convert the bond into a predetermined number of shares of a given asset Si instead
of paying the nominal value in cash. The purchase of this contract is equivalent to
the purchase of a standard bond and the sale of a certain put option. More precisely,
suppose that 1 is the price of the reverse convertible bond at t = 0, that its nominal

1.3 Derivative securities
17
value at maturity is 1 +r, and that it can be converted into x shares of the ith asset.
This conversion will happen if the asset price Si is below K := (1 +r)/x. Thus, the
payoff of the reverse convertible bond is equal to
1 +r ‚àíx(K ‚àíSi)+,
i.e., the purchase of this contract is equivalent to a risk-free investment of 1 with
interest r and the sale of the put option x(K ‚àíSi)+ for the price (r ‚àír)/(1 + r). ‚ô¶
Example 1.26. A discount certiÔ¨Åcate on V = Œæ ¬∑ S pays off the amount
C = V ‚àßK,
where the number K > 0 is often called the cap. Since
C = V ‚àí(V ‚àíK)+,
buying the discount certiÔ¨Åcate is the same as purchasing Œæ and selling the basket call
option Ccall := (V ‚àíK)+. If the price œÄ(Ccall) has already been Ô¨Åxed, then the price
of C is given by œÄ(C) = œÄ(V ) ‚àíœÄ(Ccall). Hence, the discount certiÔ¨Åcate is less
expensive than the portfolio Œæ itself, and this explains the name. On the other hand, it
participates in gains of Œæ only up to the cap K.
‚ô¶
Example 1.27. For an insurance company, it may be desirable to shift some of its
insurance risk to the Ô¨Ånancial market. As an example of such an alternative risk
transfer, consider a catastrophe bond issued by an insurance company. The interest
paid by this security depends on the occurrence of certain special events. For instance,
the contract may specify that no interest will be paid if more than a given number of
insured cars are damaged by hail on a single day during the lifetime of the contract; as
a compensation for taking this risk, the buyer will be paid an interest above the usual
market rate if this event does not occur.
‚ô¶
Mathematically, it will be convenient to focus on contingent claims whose payoff
is non-negative. Such a contingent claim will be interpreted as a contract which is
sold at time 0 and which pays a random amount C(œâ) ‚â•0 at time 1. A derivative
security whose terminal value may also become negative can usually be reduced to a
combination of a non-negative contingent claim and a short position in some of the
primary assets S0, S1, . . . , Sd. For instance, the terminal value of a reverse convertible
bond is bounded from below so that it can be decomposed into a short position in cash
and into a contract with positive value. From now on, we will work with the following
formal deÔ¨Ånition of the term ‚Äúcontingent claim‚Äù.
DeÔ¨Ånition 1.28. A contingent claim is a random variable C on the underlying prob-
ability space (, F , P) such that
0 ‚â§C < ‚àû
P -a.s.

18
1 Arbitrage theory
A contingent claim C is called a derivative of the primary assets S0, . . . , Sd if it is
measurable with respect to the œÉ-Ô¨Åeld œÉ(S0, . . . , Sd) generated by the assets, i.e., if
C = f (S0, . . . , Sd)
for a measurable function f on Rd+1.
So far, we have only Ô¨Åxed the prices œÄi of our primary assets Si. Thus, it is not
clear what the correct price should be for a general contingent claim C. Our main
goal in this section is to identify those possible prices which are compatible with the
given prices in the sense that they do not generate arbitrage. Our approach is based
on the observation that trading C at time 0 for a price œÄC corresponds to introducing
a new asset with the prices
œÄd+1 := œÄC
and
Sd+1 := C.
(1.12)
DeÔ¨Ånition 1.29. A real number œÄC ‚â•0 is called an arbitrage-free price of a contin-
gent claim C if the market model extended according to (1.12) is arbitrage-free. The
set of all arbitrage-free prices for C is denoted (C).
In the previous deÔ¨Ånition, we made the implicit assumption that the introduction
of a contingent claim C as a new asset does not affect the prices of primary assets.
This assumption is reasonable as long as the trading volume of C is small compared
to that of the primary assets. In Section 3.4 we will discuss the equilibrium approach
to asset pricing, where an extension of the market will typically change the prices of
all traded assets.
The following result shows in particular that we can always Ô¨Ånd an arbitrage-free
price for a given contingent claim C if the initial model is arbitrage-free.
Theorem 1.30. Suppose that the set P of equivalent risk-neutral measures for the
original market model is non-empty. Then the set of arbitrage-free prices of a contin-
gent claim C is non-empty and given by
(C) =

E‚àó

C
1 + r
  P ‚àó‚ààP such that E‚àó[ C ] < ‚àû

.
(1.13)
Proof. By Theorem 1.6, œÄC is an arbitrage-free price for C if and only if there exists
an equivalent risk-neutral measure ÀÜP for the market model extended via (1.12), i.e.,
œÄi = ÀÜE

Si
1 + r

for i = 1, . . . , d + 1.
In particular, ÀÜP is necessarily contained in P, and we obtain the inclusion ‚äÜin (1.13).
Conversely, if œÄC = E‚àó[ C/(1 + r) ] for some P ‚àó‚ààP , then this P ‚àóis also an
equivalent risk-neutral measure for the extended market model, and so the two sets in
(1.13) are equal.

1.3 Derivative securities
19
To show that (C) is non-empty, we Ô¨Årst Ô¨Åx some measure 
P ‚âàP such that

E[ C ] < ‚àû. For instance, we can take d 
P = c(1 + C)‚àí1 dP , where c is the nor-
malizing constant. Under 
P , the market model is arbitrage-free. Hence, Theorem 1.6
yields P ‚àó‚ààP such that dP ‚àó/d 
P is bounded. In particular, E‚àó[ C ] < ‚àûand
œÄC = E‚àó[ C/(1 + r) ] ‚àà(C).
The following theorem provides a dual characterization of the lower and upper
bounds
œÄinf(C) := inf (C)
and
œÄsup(C) := sup (C),
which are often called arbitrage bounds for C.
Theorem 1.31. In an arbitrage-free market model, the arbitrage bounds of a contin-
gent claim C are given by
œÄinf(C) = inf
P ‚àó‚ààP E‚àó 
C
1 + r
!
= max
$
m ‚àà[0, ‚àû)
 ‚àÉŒæ ‚ààRd with m + Œæ ¬∑ Y ‚â§
C
1 + r P -a.s.
%
and
œÄsup(C) = sup
P ‚àó‚ààP
E‚àó 
C
1 + r
!
= min
$
m ‚àà[0, ‚àû]
 ‚àÉŒæ ‚ààRd with m + Œæ ¬∑ Y ‚â•
C
1 + r P -a.s.
%
.
Proof. We only prove the identities for the upper arbitrage bound. The ones for the
lower bound are obtained in a similar manner. We take m ‚àà[0, ‚àû] and Œæ ‚ààRd such
that m + Œæ ¬∑ Y ‚â•C/(1 + r) P -a.s., and we denote by M the set of all such m. Taking
the expectation with P ‚àó‚ààP yields m ‚â•E‚àó[ C/(1 + r) ], and we get
inf M ‚â•sup
P ‚àó‚ààP
E‚àó 
C
1 + r
!
‚â•sup
$
E‚àó 
C
1 + r
!  P ‚àó‚ààP , E‚àó[ C ] < ‚àû
%
= œÄsup(C),
(1.14)
where we have used Theorem 1.30 in the last identity.
Next we show that all inequalities in (1.14) are in fact identities. This is trivial if
œÄsup(C) = ‚àû. For œÄsup(C) < ‚àû, we will show that m > œÄsup(C) implies m ‚â•inf M.
By deÔ¨Ånition, œÄsup(C) < m < ‚àûrequires the existence of an arbitrage opportunity
in the market model extended by œÄd+1 := m and Sd+1 := C. That is, there is
(Œæ, Œæd+1) ‚ààRd+1 such that Œæ ¬∑ Y + Œæd+1(C/(1 + r) ‚àím) is almost-surely non-
negative and strictly positive with positive probability.
Since the original market

20
1 Arbitrage theory
model is arbitrage-free, Œæd+1 must be non-zero. In fact, we have Œæd+1 < 0 as taking
expectations with respect to P ‚àó‚ààP for which E‚àó[ C ] < ‚àûyields
Œæd+1	
E‚àó 
C
1 + r
!
‚àím

‚â•0,
and the term in parenthesis is negative since m > œÄsup(C). Thus, we may deÔ¨Åne
Œ∂ := ‚àíŒæ/Œæd+1 ‚ààRd and obtain m + Œ∂ ¬∑ Y ‚â•C/(1 + r) P-a.s., hence m ‚â•inf M.
We now prove that the inÔ¨Åmum of M is in fact attained. To this end, we may
assume without loss of generality that inf M < ‚àûand that the market model is non-
redundant in the sense of DeÔ¨Ånition 1.13. For a sequence mn ‚ààM that decreases
towards inf M = œÄsup(C), we Ô¨Åx Œæn ‚ààRd such that mn +Œæn ¬∑Y ‚â•C/(1+r) P -almost
surely. If lim infn |Œæn| < ‚àû, there exists a subsequence of (Œæn) that converges to some
Œæ ‚ààRd. Passing to the limit yields œÄsup(C) + Œæ ¬∑ Y ‚â•C/(1 + r) P -a.s., which gives
œÄsup(C) ‚ààM. But this is already the desired result, since the following argument will
show that the case lim infn |Œæn| = ‚àûcannot occur. Indeed, after passing to some
subsequence if necessary, Œ∑n := Œæn/|Œæn| converges to some Œ∑ ‚ààRd with |Œ∑| = 1.
Under the assumption that |Œæn| ‚Üí‚àû, passing to the limit in
œÄsup(C)
|Œæn|
+ Œ∑n ¬∑ Y ‚â•
C
|Œæn|(1 + r)
P -a.s.
yields Œ∑ ¬∑Y ‚â•0. The absence of arbitrage opportunities thus implies Œ∑ ¬∑Y = 0 P -a.s.,
whence Œ∑ = 0 by non-redundance of the model. But this contradicts the fact that
|Œ∑| = 1.
Remark 1.32. Theorem 1.31 shows that œÄsup(C) is the lowest possible price of a
portfolio Œæ with
Œæ ¬∑ S ‚â•C
P -a.s.
Such a portfolio is often called a ‚Äúsuperhedging strategy‚Äù or ‚Äúsuperreplication‚Äù of C,
and the identities for œÄinf(C) and œÄsup(C) obtained in Theorem 1.31 are often called
superhedging duality relations. When using Œæ, the seller of C would be protected
against any possible future claims of the buyer of C. Thus, a natural goal for the seller
would be to Ô¨Ånance such a superhedging strategy from the proceeds of C. Conversely,
the objective of the buyer would be to cover the price of C from the sale of a portfolio
Œ∑ with
Œ∑ ¬∑ S ‚â§C
P-a.s.,
which is possible if and only if œÄ ¬∑ Œ∑ ‚â§œÄinf(C). Unless C is an attainable payoff,
however, neither objective can be fulÔ¨Ålled by trading C at an arbitrage-free price, as
shown in Corollary 1.34 below. Thus, any arbitrage-free price involves a trade-off
between these two objectives.
‚ô¶
For a portfolio Œæ the resulting payoff V = Œæ ¬∑ S, if positive, may be viewed as
a contingent claim, and in particular as a derivative. Those claims which can be
replicated by a suitable portfolio will play a special role in the sequel.

1.3 Derivative securities
21
DeÔ¨Ånition 1.33. A contingent claim C is called attainable (replicable, redundant) if
C = Œæ ¬∑ S P -a.s. for some Œæ ‚ààRd+1. Such a portfolio strategy Œæ is then called a
replicating portfolio for C.
If one can show that a given contingent claim C can be replicated by some portfolio
Œæ, then the problem of determining a price for C has a straightforward solution: The
price of C is unique and equal to the cost Œæ ¬∑ œÄ of its replication, due to the law of one
price. The following corollary also shows that the attainable contingent claims are in
fact the only ones for which admit a unique arbitrage-free price.
Corollary 1.34. Suppose the market model is arbitrage-free and C is a contingent
claim.
(a) C is attainable if and only if it admits a unique arbitrage-free price.
(b) If C is not attainable, then œÄinf(C) < œÄsup(C) and
(C) =

œÄinf(C), œÄsup(C)

.
Proof. Clearly |(C)| = 1 if C is attainable, and so assertion (a) is implied by (b).
In order to prove part (b), note Ô¨Årst that (C) is non-empty and convex due to
the convexity of P. Hence (C) is an interval. To show that this interval is open, it
sufÔ¨Åces to exclude the possibility that it contains one of its boundary points œÄinf(C)
and œÄsup(C). To this end, we use Theorem 1.31 to get Œæ ‚ààRd such that
œÄinf(C) + Œæ ¬∑ Y ‚â§
C
1 + r
P -a.s.
Since C is not attainable, this inequality cannot be an almost-sure identity. Hence, with
Œæ0 := ‚àí(1 + r)œÄinf(C), the strategy (Œæ0, ‚àíŒæ, 1) ‚ààRd+2 is an arbitrage opportunity in
the market model extended by œÄd+1 := œÄinf(C) and Sd+1 := C, so that œÄinf(C) is not
an arbitrage-free price for C. The possibility œÄsup(C) ‚àà(C) is excluded by a similar
argument.
Remark 1.35. In Theorem 1.31, the set P of equivalent risk-neutral measures can be
replaced by the set 
P of risk-neutral measures that are merely absolutely continuous
with respect to P . That is,
œÄinf(C) = inf

P ‚àà
P

E
 
C
1 + r
!
and
œÄsup(C) = sup

P ‚àà
P

E
 
C
1 + r
!
,
(1.15)
for any contingent claim C. To prove this, note Ô¨Årst that P ‚äÇ
P , so that we get the
two inequalities ‚Äú‚â•" and ‚Äú‚â§" in (1.15). On the other hand, for any 
P ‚àà
P , arbitrary
P ‚àó‚ààP and Œµ ‚àà(0, 1], the measure P ‚àó
Œµ := ŒµP ‚àó+(1‚àíŒµ)
P belongs to P and satisÔ¨Åes
E‚àó
Œµ [ C ] = ŒµE‚àó[ C ]+(1‚àíŒµ)
E[ C ]. Sending Œµ ‚Üì0 yields the converse inequalities. ‚ô¶

22
1 Arbitrage theory
Remark 1.36. Consider any arbitrage-free market model, and let Ccall = (Si ‚àíK)+
be a call option on the ith asset with strike K > 0. Clearly, Ccall ‚â§Si so that
E‚àó
 Ccall
1 + r

‚â§œÄi
for any P ‚àó‚ààP . From Jensen‚Äôs inequality, we obtain the following lower bound:
E‚àó
 Ccall
1 + r

‚â•

E‚àó

Si
1 + r

‚àí
K
1 + r
+
=

œÄi ‚àí
K
1 + r
+
.
Thus, the following universal bounds hold for any arbitrage-free market model:

œÄi ‚àí
K
1 + r
+
‚â§œÄinf

Ccall
‚â§œÄsup

Ccall
‚â§œÄi.
(1.16)
For a put option Cput = (K ‚àíSi)+, one obtains the universal bounds
 K
1 + r ‚àíœÄi
+
‚â§œÄinf

Cput
‚â§œÄsup

Cput
‚â§
K
1 + r .
(1.17)
If r ‚â•0, then the lower bound in (1.16) can be further reduced to œÄinf

Ccall
‚â•
(œÄi ‚àíK)+. Informally, this inequality states that the value of the right to buy the
ith asset at t = 0 for a price K is strictly less than any arbitrage-free price for Ccall.
This fact is sometimes expressed by saying that the time value of a call option is
non-negative. The quantity (œÄi ‚àíK)+ is called the intrinsic value of the call option.
Observe that an analogue of this relation usually fails for put options: The left-hand
side of (1.17) can only be bounded by its intrinsic value (K ‚àíœÄi)+ if r ‚â§0. If the
intrinsic value of a put or call option is positive, then one says that the option is ‚Äúin the
money". For œÄi = K one speaks of an ‚Äúat-the-money" option. Otherwise, the option
is ‚Äúout of the money".
‚ô¶
In many situations, the universal arbitrage bounds (1.16) and (1.17) are in fact
attained, as illustrated by the following example.
Example 1.37. Take any market model with a single risky asset S = S1 such that
the distribution of S under P is concentrated on {0, 1, . . . , } with positive weights.
Without loss of generality, we may assume that S has under P a Poisson distribution
with parameter 1, i.e., S is P -a.s. integer-valued and
P [ S = k ] = e‚àí1
k!
for k = 0, 1, . . . .
If we take r = 0 and œÄ = 1, then P is a risk-neutral measure and the market model
is arbitrage-free. We are going to show that the upper and lower bounds in (1.16)

1.4 Complete market models
23
are attained for this model by using Remark 1.35. To this end, consider the measure

P ‚àà
P which is deÔ¨Åned by its density
d 
P
dP = e ¬∑ I{S=1} .
We get

E[ (S ‚àíK)+ ] = (1 ‚àíK)+ = (œÄ ‚àíK)+,
so that the lower bound in (1.16) is attained, i.e., we have
œÄinf

(S ‚àíK)+
= (œÄ ‚àíK)+.
To see that also the upper bound is sharp, we deÔ¨Åne
gn(k) :=

e ‚àíe
n

¬∑ I{0}(k) + (n ‚àí1)! ¬∑ e ¬∑ I{n}(k),
k = 0, 1, . . .
It is straightforward to check that
d 
Pn := gn(S) dP
deÔ¨Ånes a measure 
Pn ‚àà
P such that

En[ (S ‚àíK)+ ] =

1 ‚àíK
n
+
.
By sending n ‚Üë‚àû, we see that also the upper bound in (1.16) is attained:
œÄsup

(S ‚àíK)+
= œÄ.
Furthermore, the put-call parity (1.10) shows that the universal bounds (1.17) for put
options are attained as well.
‚ô¶
1.4 Complete market models
Our goal in this section is to characterize the particularly transparent situation in which
all contingent claims are attainable.
DeÔ¨Ånition 1.38. Anarbitrage-freemarketmodeliscalledcompleteifeverycontingent
claim is attainable.
In every market model, the following inclusion holds for each P ‚àó‚ààP :
V =

Œæ ¬∑ S | Œæ ‚ààRd+1 
‚äÜL1
, œÉ(S1, . . . , Sd), P ‚àó
‚äÜL0(, F , P ‚àó) = L0(, F , P );

24
1 Arbitrage theory
see Appendix A.7 for the deÔ¨Ånition of Lp-spaces. If the market is complete then all of
these inclusions are in fact equalities. In particular, F coincides with œÉ(S1, . . . , Sd)
modulo P-null sets, and every contingent claim coincides P -a.s. with a derivative of
the traded assets. Since the linear space V is Ô¨Ånite-dimensional, it follows that the
same must be true of L0(, F , P). But this means that the model can be reduced to
a Ô¨Ånite number of relevant scenarios. This observation can be made precise by using
the notion of an atom of the probability space (, F , P ). Recall that a set A ‚ààF is
called an atom of (, F , P), if P [ A ] > 0 and if each B ‚ààF with B ‚äÜA satisÔ¨Åes
either P [ B ] = 0 or P [ B ] = P [ A ].
Proposition 1.39. Foranyp ‚àà[0, ‚àû], thedimensionofthelinearspaceLp(, F , P )
is given by
dim Lp(, F , P)
(1.18)
= sup

n ‚ààN | ‚àÉpartition A1, . . . , An of  with Ai ‚ààF and P [ Ai ] > 0

.
Moreover, n := dim Lp(, F , P) < ‚àûif and only if there exists a partition of 
into n atoms of (, F , P).
Proof. Suppose that there is a partition A1, . . . , An of  such that Ai ‚ààF and
P[ Ai ] > 0. The corresponding indicator functions IA1, . . . , IAn can be regarded as
linearly independent vectors in Lp := Lp(, F , P ). Thus dim Lp ‚â•n. Conse-
quently, it sufÔ¨Åces to consider only the case in which the right-hand side of (1.18) is a
Ô¨Ånite number, n0. If A1, . . . , An0 is a corresponding partition, then each Ai is an atom
because otherwise n0 would not be maximal. Thus, any Z ‚ààLp is P -a.s. constant on
each Ai. If we denote the value of Z on Ai by zi, then
Z =
n0

i=1
zi IAi
P -a.s.
Hence, the indicator functions IA1, . . . , IAn0 form a basis of Lp, and this implies
dim Lp = n0.
Theorem 1.40. An arbitrage-free market model is complete if and only if there ex-
ists exactly one risk-neutral probability measure, i.e., if |P | = 1.
In this case,
dim L0(, F , P) ‚â§d + 1.
Proof. If the model is complete, then the indicator IA of each set A ‚ààF is an
attainable contingent claim. Hence, Corollary 1.34 implies that P ‚àó[ A ] = E‚àó[ IA ]
is independent of P ‚àó‚ààP. Consequently, there is just one risk-neutral probability
measure.
Conversely, suppose that P = {P ‚àó}, and let C be a bounded contingent claim, so
that E‚àó[ C ] < ‚àû. Then C has the unique arbitrage-free price E‚àó[ C/(1 + r) ], and

1.4 Complete market models
25
Corollary 1.34 implies that C is attainable. It follows that L‚àû(, F , P ) is contained
in the linear space V of all possible portfolio values. This implies that
dim L‚àû(, F , P) ‚â§dim V ‚â§d + 1.
Hence, we conclude from Proposition 1.39 that (, F , P ) has at most d + 1 atoms.
But then every contingent claim must be bounded and, in turn, attainable.
Example 1.41. Consider the simple situation where the sample space  consists of
two elements œâ+ and œâ‚àí, and where the measure P is such that
p := P [ {œâ+} ] ‚àà(0, 1).
We assume that there is one single risky asset, which takes at time t = 1 the two values
b and a with the respective probabilities p and 1 ‚àíp, where a and b are such that
0 ‚â§a < b:
œÄ
S(œâ+) = b
S(œâ‚àí) = a

*
p
HHHHHH
j
1 ‚àíp
This model does not admit arbitrage if and only if
œÄ(1 + r) ‚àà

E[ S ] | 
P ‚âàP

=
p b + (1 ‚àíp)a | p ‚àà(0, 1)

= (a, b);
(1.19)
see also Example 1.8. In this case, the model is also complete: Any risk-neutral
measure P ‚àómust satisfy
œÄ(1 + r) = E‚àó[ S ] = p‚àób + (1 ‚àíp‚àó)a,
and this condition uniquely determines the parameter p‚àó= P ‚àó[ {œâ+} ] as
p‚àó= œÄ(1 + r) ‚àía
b ‚àía
‚àà(0, 1).
Hence |P | = 1, and completeness follows from Theorem 1.40. Alternatively, we can
directly verify completeness by showing that a given contingent claim C is attainable
if (1.19) holds. Observe that the condition
C(œâ) = Œæ0 S0(œâ) + Œæ S(œâ) = Œæ0(1 + r) + Œæ S(œâ)
for all œâ ‚àà
is a system of two linear equations for the two real variables Œæ0 and Œæ. The solution is
given by
Œæ = C(œâ+) ‚àíC(œâ‚àí)
b ‚àía
and
Œæ0 = C(œâ‚àí)b ‚àíC(œâ+)a
(b ‚àía)(1 + r)
.

26
1 Arbitrage theory
Therefore, the unique arbitrage-free price of C is
œÄ(C) = œÄ ¬∑ Œæ = C(œâ+)
1 + r ¬∑ œÄ(1 + r) ‚àía
b ‚àía
+ C(œâ‚àí)
1 + r ¬∑ b ‚àíœÄ(1 + r)
b ‚àía
.
For a call option C = (S ‚àíK)+ with strike K ‚àà[a, b], we have
œÄ

(S ‚àíK)+
= b ‚àíK
b ‚àía ¬∑ œÄ ‚àí(b ‚àíK)a
b ‚àía
¬∑
1
1 + r .
(1.20)
Note that this price is independent of p and increasing in r, while the classical dis-
counted expectation with respect to the ‚Äúobjective‚Äù measure P ,
E

C
1 + r

= p(b ‚àíK)
1 + r
,
is decreasing in r and increasing in p.
In this example, one can illustrate how options can be used to modify the risk of a
position. Consider the particular case in which the risky asset can be bought at time
t = 0 for the price œÄ = 100. At time t = 1, the price is either S(œâ+) = b = 120 or
S(œâ‚àí) = a = 90, both with positive probability. If we invest in the risky asset, the
corresponding returns are given by
R(S)(œâ+) = +20%
or
R(S)(œâ‚àí) = ‚àí10%.
Now consider a call option C := (S ‚àíK)+ with strike K = 100. Choosing r = 0,
the price of the call option is
œÄ(C) = 20
3 ‚âà6.67
from formula (1.20). Hence the return
R(C) = (S ‚àíK)+ ‚àíœÄ(C)
œÄ(C)
on the initial investment œÄ(C) equals
R(C)(œâ+) = 20 ‚àíœÄ(C)
œÄ(C)
= +200%
or
R(C)(œâ‚àí) = 0 ‚àíœÄ(C)
œÄ(C)
= ‚àí100%,
according to the outcome of the market at time t = 1. Here we see a dramatic increase
of both proÔ¨Åt opportunity and risk; this is sometimes referred to as the leverage effect
of options.

1.5 Geometric characterization of arbitrage-free models
27
On the other hand, we could reduce the risk of holding the asset by holding a
combination

C := (K ‚àíS)+ + S
of a put option and the asset itself. This ‚Äúportfolio insurance‚Äù will of course involve an
additional cost. If we choose our parameters as above, then the put-call parity (1.10)
yields that the price of the put option (K ‚àíS)+ is equal to 20/3. Thus, in order to
hold both S and a put, we must invest the capital 100 + 20/3 at time t = 0. At time
t = 1, we have an outcome of either 120 or of 100 so that the return of 
C is given by
R(
C)(œâ+) = +12.5%
and
R(
C)(œâ‚àí) = ‚àí6.25%.
‚ô¶
1.5 Geometric characterization of arbitrage-free models
The ‚Äúfundamental theorem of asset pricing‚Äù in the form of Theorem 1.6 states that a
market model is arbitrage-free if and only if the origin is contained in the set
Mb(Y, P ) :=
$
EQ[ Y ]
 Q ‚âàP, dQ
dP is bounded, EQ[ |Y| ] < ‚àû
%
‚äÇRd,
where Y = (Y 1, . . . , Y d) is the random vector of discounted net gains deÔ¨Åned in (1.2).
The aim of this section is to give a geometric description of the set Mb(Y, P ) as well
as of the larger set
M(Y, P) :=

EQ[ Y ] | Q ‚âàP, EQ[ |Y| ] < ‚àû

.
To this end, it will be convenient to work with the distribution
¬µ := P ‚ó¶Y ‚àí1
of Y with respect to P . That is, ¬µ is a Borel probability measure on Rd such that
¬µ(A) = P [ Y ‚ààA ]
for each Borel set A ‚äÇRd.
If ŒΩ is a Borel probability measure on Rd such that

|y| ŒΩ(dy) < ‚àû, we will call

y ŒΩ(dy) its barycenter.
Lemma 1.42. We have
Mb(Y, P ) = Mb(¬µ) :=
 
y ŒΩ(dy)
 ŒΩ ‚âà¬µ, dŒΩ
d¬µ is bounded,

|y| ŒΩ(dy) < ‚àû

,
and
M(Y, P) = M(¬µ) :=
 
y ŒΩ(dy)
 ŒΩ ‚âà¬µ,

|y| ŒΩ(dy) < ‚àû

.

28
1 Arbitrage theory
Proof. If ŒΩ ‚âà¬µ is a Borel probability measure on Rd, then the Radon‚ÄìNikodym
derivativeofŒΩ withrespectto¬µevaluatedattherandomvariableY deÔ¨Ånesaprobability
measure Q ‚âàP on (, F ):
dQ
dP (œâ) := dŒΩ
d¬µ

Y(œâ)

.
Clearly, EQ[ Y ] =

y ŒΩ(dy). This shows that M(¬µ) ‚äÜM(Y, P ) and Mb(¬µ) ‚äÜ
Mb(Y, P ).
Conversely, if 
Q is a given probability measure on (, F ) which is equivalent
to P , then the Radon‚ÄìNikodym theorem in Appendix A.2 shows that the distribution
ŒΩ := 
Q ‚ó¶Y ‚àí1 must be equivalent to ¬µ, whence M(Y, P ) ‚äÜM(¬µ). Moreover,
it follows from Proposition A.11 that the density dŒΩ/d¬µ is bounded if d 
Q/dP is
bounded, and so Mb(Y, P ) ‚äÜMb(¬µ) also follows.
By the above lemma, the characterization of the two sets Mb(Y, P ) and M(Y, P )
is reduced to a problem for Borel probability measures on Rd. Here and in the sequel,
we do not need the fact that ¬µ is the distribution of the lower bounded random vector Y
of discounted net gains; our results are true for arbitrary ¬µ such that

|y| ¬µ(dy) < ‚àû;
see also Remark 1.7.
DeÔ¨Ånition 1.43. The support of a Borel probability measure ŒΩ on Rd is the smallest
closed set A ‚äÇRd such that ŒΩ(Ac) = 0, and it will be denoted by supp ŒΩ.
The support of a measure ŒΩ can be obtained as the intersection of all closed sets A
with ŒΩ(Ac) = 0, i.e.,
supp ŒΩ =

A closed
ŒΩ(Ac)=0
A.
We denote by
(¬µ) := conv (supp ¬µ)
=

n

k=1
Œ±kyk
 Œ±k ‚â•0,
n

k=1
Œ±k = 1, yk ‚ààsupp ¬µ, n ‚ààN

the convex hull of the support of ¬µ. Thus, (¬µ) is the smallest convex set which
contains supp ¬µ; see also Appendix A.1.
Example 1.44. Take d = 1, and consider the measure
¬µ = 1
2 (Œ¥‚àí1 + Œ¥+1).
Clearly, the support of ¬µ is equal to {‚àí1, +1} and so (¬µ) = [‚àí1, +1]. A measure
ŒΩ is equivalent to ¬µ if and only if
ŒΩ = Œ±Œ¥‚àí1 + (1 ‚àíŒ±)Œ¥+1
for some Œ± ‚àà(‚àí1, +1). Hence, Mb(¬µ) = M(¬µ) = (‚àí1, +1).
‚ô¶

1.5 Geometric characterization of arbitrage-free models
29
The previous example gives the correct intuition, namely that one always has the
inclusions
Mb(¬µ) ‚äÇM(¬µ) ‚äÇ(¬µ).
But while the Ô¨Årst inclusion will turn out to be an identity, the second inclusion
is usually strict. Characterizing M(¬µ) in terms of (¬µ) will involve the following
concept:
DeÔ¨Ånition 1.45. The relative interior of a convex set C ‚äÇRd is the set of all points
x ‚ààC such that for all y ‚ààC there exists some Œµ > 0 with
x ‚àíŒµ(y ‚àíx) ‚ààC.
The relative interior of C is denoted ri C.
If the convex set C has non-empty topological interior int C, then ri C = int C, and
the elementary properties of the relative interior collected in the following remarks
become obvious. This applies in particular to the set (¬µ) if the non-redundance
condition (1.8) is satisÔ¨Åed. For the general case, proofs of these statements can be
found, for instance, in ¬ß6 of [166].
Remark 1.46. Let C be a non-empty convex subset of Rd, and consider the afÔ¨Åne
hull aff C spanned by C, i.e., the smallest afÔ¨Åne set which contains C. If we identify
aff C with some Rn, then the relative interior of C is equal to the topological interior
of C, considered as a subset of aff C ‚àº= Rn. In particular, each non-empty convex set
has non-empty relative interior.
‚ô¶
Remark 1.47. Let C be a non-empty convex subset of Rd and denote by C its closure.
Then, if x ‚ààri C,
Œ±x + (1 ‚àíŒ±)y ‚ààri C
for all y ‚ààC and all Œ± ‚àà(0, 1].
(1.21)
In particular, ri C is convex. Moreover, the operations of taking the closure or the
relative interior of a convex set C are consistent with each other:
ri C = ri C
and
ri C = C.
(1.22)
‚ô¶
After these preparations, we can now state the announced geometric character-
ization of the set Mb(¬µ). Note that the proof of this characterization relies on the
‚Äúfundamental theorem of asset pricing‚Äù in the form of Theorem 1.6.
Theorem 1.48. The set of all barycenters of probability measures ŒΩ ‚âà¬µ coincides
with the relative interior of the convex hull of the support of ¬µ. More precisely,
Mb(¬µ) = M(¬µ) = ri (¬µ).

30
1 Arbitrage theory
Proof. In a Ô¨Årst step, we show the inclusion ri (¬µ) ‚äÜMb(¬µ). Suppose we are given
m ‚ààri (¬µ). Let ¬µ denote the translated measure
¬µ(A) := ¬µ(A + m)
for Borel sets A ‚äÇRd
where A + m := { x + m | x ‚ààA }. Then Mb(¬µ) = Mb(¬µ) ‚àím, and analogous
identities hold for M(¬µ) and (¬µ). It follows that there is no loss of generality in
assuming that m = 0, i.e., we must show that 0 ‚ààMb(¬µ) if 0 ‚ààri (¬µ).
We claim that 0 ‚ààri (¬µ) implies the following ‚Äúno-arbitrage‚Äù condition:
If Œæ ‚ààRd is such that Œæ ¬∑ y ‚â•0 for ¬µ-a.e. y, then Œæ ¬∑ y = 0 for ¬µ-a.e. y.
(1.23)
If (1.23) is false, then we can Ô¨Ånd some Œæ ‚ààRd such that Œæ ¬∑ y ‚â•0 for ¬µ-a.e. y but
¬µ({y | Œæ ¬∑ y > Œ¥} ) > 0 for some Œ¥ > 0. In this case, the support of ¬µ is contained in
the closed set { y | Œæ ¬∑ y ‚â•0 } but not in the hyperplane { y | Œæ ¬∑ y = 0 }. We conclude
that Œæ ¬∑ y ‚â•0 for all y ‚ààsupp ¬µ and that there exists at least one y‚àó‚ààsupp ¬µ such
that Œæ ¬∑ y‚àó> 0. In particular, y‚àó‚àà(¬µ) so that our assumption m = 0 ‚ààri (¬µ)
implies the existence of some Œµ > 0 such that ‚àíŒµy‚àó‚àà(¬µ). Consequently, ‚àíŒµy‚àó
can be represented as a convex combination
‚àíŒµy‚àó= Œ±1y1 + ¬∑ ¬∑ ¬∑ + Œ±nyn
of certain y1, . . . , yn ‚ààsupp ¬µ. It follows that
0 > ‚àíŒµŒæ ¬∑ y‚àó= Œ±1Œæ ¬∑ y1 + ¬∑ ¬∑ ¬∑ + Œ±nŒæ ¬∑ yn,
in contradiction to our assumption that Œæ ¬∑ y ‚â•0 for all y ‚ààsupp ¬µ. Hence, (1.23)
must be true.
Applying the ‚Äúfundamental theorem of asset pricing‚Äù in the form of Theorem 1.6 to
 := Rd, P := ¬µ, and to the random variable Y(y) := y, yields a probability measure
¬µ‚àó‚âà¬µ whose density d¬µ‚àó/d¬µ is bounded and which satisÔ¨Åes

|y| ¬µ‚àó(dy) < ‚àû
and

y ¬µ‚àó(dy) = 0. This proves the inclusion ri (¬µ) ‚äÜMb(¬µ).
Clearly, Mb(¬µ) ‚äÇM(¬µ). So the theorem will be proved if we can show the
inclusion M(¬µ) ‚äÇri (¬µ). To this end, suppose by way of contradiction that ŒΩ ‚âà¬µ
is such that

|y| ŒΩ(dy) < ‚àû
and
m :=

y ŒΩ(dy) /‚ààri (¬µ).
Again, we may assume without loss of generality that m = 0. Applying the separating
hyperplane theorem in the form of Proposition A.1 with C := ri (¬µ) yields some
Œæ ‚ààRd such that Œæ ¬∑ y ‚â•0 for all y ‚ààri (¬µ) and Œæ ¬∑ y‚àó> 0 for at least one
y‚àó‚ààri (¬µ). We deduce from (1.21) that Œæ ¬∑ y ‚â•0 holds also for all y ‚àà(¬µ).
Moreover, Œæ ¬∑ y0 must be strictly positive for at least one y0 ‚ààsupp ¬µ. Hence,
Œæ ¬∑ y ‚â•0 for ¬µ-a.e. y ‚ààRd
and
¬µ

{y | Œæ ¬∑ y > 0 }

> 0.
(1.24)

1.6 Contingent initial data
31
By the equivalence of ¬µ and ŒΩ, (1.24) is also true for ŒΩ instead of ¬µ, and so
Œæ ¬∑ m = Œæ ¬∑

y ŒΩ(dy) =

Œæ ¬∑ y ŒΩ(dy) > 0,
in contradiction to our assumption that m = 0. We conclude that M(¬µ) ‚äÇri (¬µ).
Remark 1.49. Note that Theorem 1.48 does not extend to the set

M(¬µ) :=
 
y ŒΩ(dy)
 ŒΩ ‚â™¬µ and

|y| ŒΩ(dy) < ‚àû

.
Already the simple case ¬µ := 1
2(Œ¥‚àí1 + Œ¥+1) serves as a counterexample, because
here 
M(¬µ) = [‚àí1, +1] while ri (¬µ) = (‚àí1, +1). In this case, we have an identity
between 
M(¬µ) and (¬µ). However, also this identity fails in general as can be seen
by considering the normalized Lebesgue measure Œª on [‚àí1, +1]. For this choice one
Ô¨Ånds 
M(Œª) = (‚àí1, +1) but (Œª) = [‚àí1, +1].
‚ô¶
From Theorem 1.48 we obtain the following geometric characterization of the
absence of arbitrage.
Corollary 1.50. Let ¬µ be the distribution of the discounted price vector S/(1 + r) of
the risky assets. Then the market model is arbitrage-free if and only if the price system
œÄ belongs to the relative interior ri (¬µ) of the convex hull of the support of ¬µ.
1.6 Contingent initial data
The idea of hedging contingent claims develops its full power only in a dynamic setting
in which trading may occur at several times. The corresponding discrete-time theory
constitutes the core of these notes and is presented in Chapter 5. The introduction of
additional trading periods requires more sophisticated techniques than those we have
used so far. In this section we will introduce some of these techniques in an extended
version of our previous market model in which initial prices, and hence strategies,
are contingent on scenarios. In this context, we are going to characterize the absence
of arbitrage strategies. The results will be used as building blocks in the multiperiod
setting of Part II; their study can be postponed until Chapter 5.
Suppose that we are given a œÉ-algebra F0 ‚äÇF which speciÔ¨Åes the information
that is available to an investor at time t = 0. The prices for our d + 1 assets at time
0 will be modelled as non-negative F0-measurable random variables S0
0, S1
0, . . . , Sd
0 .
Thus, the price system œÄ = (œÄ0, œÄ1, . . . , œÄd) of our previous discussion is replaced
by the vector
S0 = (S0
0, . . . , Sd
0 ).

32
1 Arbitrage theory
The portfolio Œæ chosen by an investor at time t = 0 will also depend on the information
available at time 0. Thus, we assume that
Œæ = (Œæ0, Œæ1, . . . , Œæd)
is an F0-measurable random vector. The asset prices observed at time t = 1 will be
denoted by
S1 = (S0
1, S1
1, . . . , Sd
1 ).
They are modelled as non-negative random variables which are measurable with re-
spect to a œÉ-algebra F1 such that F0 ‚äÇF1 ‚äÇF . The œÉ-algebra F1 describes the
information available at time 1, and in this section we can assume that F = F1.
A riskless bond could be included by taking S0
0 ‚â°1 and by assuming S0
1 to be
F0-measurable and P -a.s. strictly positive. However, in the sequel it will be sufÔ¨Åcient
to assume that S0
0 is F0-measurable, S0
1 is F1-measurable, and that
P

S0
0 > 0 and S0
1 > 0

= 1.
(1.25)
Thus, we can take the 0th asset as num√©raire, and we denote by
Xi
t := Si
t
S0t
,
i = 1, . . . , d, t = 0, 1,
the discounted asset prices and by
Y = X1 ‚àíX0
the vector of the discounted net gains.
DeÔ¨Ånition 1.51. An arbitrage opportunity is a portfolio Œæ such that Œæ ¬∑ S0 ‚â§0,
Œæ ¬∑ S1 ‚â•0 P -a.s., and P [ Œæ ¬∑ S1 > 0 ] > 0.
By our assumption (1.25), any arbitrage opportunity Œæ = (Œæ0, Œæ) satisÔ¨Åes
Œæ ¬∑ Y ‚â•0 P -a.s.
and
P [ Œæ ¬∑ Y > 0 ] > 0.
(1.26)
In fact, the existence of a d-dimensional F0-measurable random vector Œæ with (1.26)
is equivalent to the existence of an arbitrage opportunity. This can be seen as in
Lemma 1.3.
The space of discounted net gains which can be generated by some portfolio is
given by
K :=

Œæ ¬∑ Y | Œæ ‚ààL0(, F0, P ; Rd)

.
Here, L0(, F0, P; Rd) denotes the space of Rd-valued random variables which are
P-a.s. Ô¨ÅniteandF0-measurablemodulotheequivalencerelation(A.21)ofcoincidence
up to P -null sets. The spaces Lp(, F0, P; Rd) for p > 0 are deÔ¨Åned in the same

1.6 Contingent initial data
33
manner. We denote by Lp
+ := Lp
+(, F1, P) the cone of all non-negative elements
in the space Lp := Lp(, F1, P). With this notation, writing
K ‚à©L0
+ = {0}
is shorthand for the absence of arbitrage opportunities. We will denote by
K ‚àíL0
+
the convex cone of all Z ‚ààL0 which can be written as the difference of some Œæ ¬∑Y ‚ààK
and some U ‚ààL0
+.
The following deÔ¨Ånition involves the notion of the conditional expectation
EQ[ Z | F0 ]
of a random variable Z with respect to a probability measure Q, given the œÉ-algebra
F0 ‚äÇF ; see Appendix A.2 and the references therein. If Z = (Z1, . . . , Zn) is a
random vector, then EQ[ Z | F0 ] is shorthand for the random vector with components
EQ[ Zi | F0 ], i = 1, . . . , n.
DeÔ¨Ånition 1.52. A probability measure Q satisfying
EQ[ Xi
t ] < ‚àû
for i = 1, . . . , d and t = 0, 1
and
X0 = EQ[ X1 | F0 ]
Q-a.s.
is called a risk-neutral measure or martingale measure. We denote by P the set of all
risk-neutral measures P ‚àówhich are equivalent to P .
Remark 1.53. The deÔ¨Ånition of a martingale measure Q means that for each asset
i = 0, . . . , d, the discounted price process (Xi
t)t=0,1 is a martingale under Q with
respect to the œÉ-Ô¨Åelds (Ft)t=0,1. The systematic discussion of martingales in a multi-
period setting will begin in Section 5.2. The martingale aspect will be crucial for the
theory of dynamic hedging in Part II.
‚ô¶
Asthemainresultofthissection, wecannowstateanextensionofthe‚Äúfundamental
theorem of asset pricing‚Äù in Theorem 1.6 to our present setting.
Theorem 1.54. The following conditions are equivalent:
(a) K ‚à©L0
+ = {0}.
(b) (K ‚àíL0
+) ‚à©L0
+ = {0}.
(c) There exists a measure P ‚àó‚ààP with a bounded density dP ‚àó/dP .
(d) P Ã∏= ‚àÖ.

34
1 Arbitrage theory
Proof. (d) ‚áí(a): Suppose by way of contradiction that there exist both a P ‚àó‚ààP and
some Œæ ‚ààL0(, F0, P; Rd) with non-zero payoff Œæ ¬∑ Y ‚ààK ‚à©L0
+. For large enough
c > 0, Œæ(c) := I{|Œæ|‚â§c}Œæ will be bounded, and the payoff Œæ(c) ¬∑ Y will still be non-zero
and in K ‚à©L0
+. However,
E‚àó[ Œæ(c) ¬∑ Y ] = E‚àó
Œæ(c) ¬∑ E‚àó[ Y | F0 ]

= 0,
which is the desired contradiction.
(a)‚áî(b): It is obvious that (a) is necessary for (b). In order to prove sufÔ¨Åciency,
suppose that we are given some Z ‚àà(K ‚àíL0
+) ‚à©L0
+. Then there exists a random
variable U ‚â•0 and a random vector Œæ ‚ààL0(, F0, P ; Rd) such that
0 ‚â§Z = Œæ ¬∑ Y ‚àíU.
This implies that Œæ ¬∑ Y ‚â•U ‚â•0, which, according to condition (a), can only happen
if Œæ ¬∑ Y = 0. Hence, also U = 0 and in turn Z = 0.
(b) ‚áí(c): This is the difÔ¨Åcult part of the proof. The assertion will follow by
combining Lemmas 1.56, 1.57, 1.59, and 1.67.
Remark 1.55. If  is discrete, or if there exists a decomposition of  in countable
many atoms of (, F0, P), then the martingale measure P ‚àócan be constructed by
applying the result of Theorem 1.6 separately on each atom. In the general case, the
idea of patching together conditional martingale measures would involve subtle argu-
ments of measurable selection; see [51]. Here we present a different approach which
is based on separation arguments in L1(P ). It is essentially due to W. Schachermayer
[175]; our version uses in addition arguments byY. Kabanov and C. Stricker [122]. ‚ô¶
We start with the following simple lemma, which takes care of the integrability
condition in DeÔ¨Ånition 1.52.
Lemma 1.56. For the proof of the implication (b) ‚áí(c) in Theorem 1.54, we may
assume without loss of generality that
E[ |Xt| ] < ‚àû
for t = 0, 1.
(1.27)
Proof. DeÔ¨Åne a probability measure 
P by
d 
P
dP := c

1 + |X0| + |X1|
‚àí1
where c is chosen such that the right-hand side integrates to 1. Clearly, (1.27) holds
for 
P. Moreover, condition (b) of Theorem 1.54 is satisÔ¨Åed by P if and only if it is
satisÔ¨Åed by the equivalent measure 
P . If P ‚àó‚ààP is such that the density dP ‚àó/d 
P is
bounded, then so is the density
dP ‚àó
dP = dP ‚àó
d 
P
¬∑ d 
P
dP .

1.6 Contingent initial data
35
Therefore, the implication (b) ‚áí(c) holds for P if and only if it holds for 
P .
From now on, we will always assume (1.27). Our goal is to construct a suitable
Z ‚ààL‚àûsuch that
dP ‚àó
dP :=
Z
E[ Z ]
deÔ¨Ånes an equivalent risk-neutral measure P ‚àó. The following simple lemma gives a
criterion for this purpose, involving the convex cone
C := (K ‚àíL0
+) ‚à©L1.
Lemma 1.57. Suppose c ‚â•0 and Z ‚ààL‚àûare such that
E[ Z W ] ‚â§c
for all W ‚ààC.
Then:
(a) E[ Z W ] ‚â§0 for all W ‚ààC, i.e., we can take c = 0.
(b) Z ‚â•0 P-a.s.
(c) If Z does not vanish P -a.s., then
dQ
dP :=
Z
E[ Z ]
deÔ¨Ånes a risk-neutral measure Q ‚â™P .
Proof. (a): Note that C is a cone, i.e., W ‚ààC implies that Œ±W ‚ààC for all Œ± ‚â•0.
This property excludes the possibility that E[ ZW ] > 0 for some W ‚ààC.
(b): C contains the function W := ‚àíI{Z<0}. Hence, by part (a),
E[ Z‚àí] = E[ Z W ] ‚â§0.
(c): For all Œæ ‚ààL‚àû(, F0, P; Rd) and Œ± ‚ààR we have Œ±Œæ ¬∑ Y ‚ààC by our
integrability assumption (1.27). Thus, a similar argument as in the proof of (a) yields
E[ Z Œæ ¬∑ Y ] = 0. Since Œæ is bounded, we may conclude that
0 = E[ Z Œæ ¬∑ Y ] = E

Œæ ¬∑ E[ ZY | F0 ]

.
As Œæ is arbitrary, this yields E[ ZY | F0 ] = 0 P -almost surely. Proposition A.12 now
implies
EQ[ Y | F0 ] =
1
E[ Z | F0 ]E[ ZY | F0 ] = 0
Q-a.s.,
which concludes the proof.

36
1 Arbitrage theory
In view of the preceding lemma, the construction of risk-neutral measures is re-
duced to the construction of elements of the set
Z :=

Z ‚ààL‚àû| 0 ‚â§Z ‚â§1, P [ Z > 0 ] > 0, and E[ Z W ] ‚â§0 for all W ‚ààC

.
In the following lemma, we will construct such elements by applying a separation
argument suggested by the condition
C ‚à©L1
+ = {0},
which follows from condition (b) ofTheorem 1.54. This separation argument needs the
additional assumption that C is closed in L1. Showing that this assumption is indeed
satisÔ¨Åed in our situation will be one of the key steps in our proof; see Lemma 1.67
below.
Lemma 1.58. Assume that C is closed in L1 and satisÔ¨Åes C ‚à©L1
+ = {0}. Then for
each non-zero F ‚ààL1
+ there exists some Z ‚ààZ such that E[ FZ ] > 0.
Proof. Let B := {F} so that B ‚à©C = ‚àÖ, and note that the set C is non-empty, convex
and closed. Thus we may apply the Hahn‚ÄìBanach separation theorem in the form of
Theorem A.56 to obtain a continuous linear functional ‚Ñìon L1 such that
sup
W‚ààC
‚Ñì(W) < ‚Ñì(F).
Since the dual space of L1 can be identiÔ¨Åed with L‚àû, there exists some Z ‚ààL‚àû
such that ‚Ñì(F) = E[ FZ ] for all F ‚ààL1. We may assume without loss of generality
that ‚à•Z‚à•‚àû‚â§1. By construction, Z satisÔ¨Åes the assumptions of Lemma 1.57, and
so Z ‚ààZ. Moreover, E[ FZ ] = ‚Ñì(F) > 0 since the constant function W ‚â°0 is
contained in C.
We will now use an exhaustion argument to conclude that Z contains a strictly
positive element Z‚àóunder the assumptions of Lemma 1.58. After normalization, Z‚àó
will serve as the density of our desired risk-neutral measure P ‚àó‚ààP .
Lemma 1.59. Under the assumptions of Lemma 1.58, there exists Z‚àó‚ààZ with
Z‚àó> 0 P -a.s.
Proof. As a Ô¨Årst step, we claim that Z is countably convex: If (Œ±k)k‚ààN is a sequence
of non-negative real numbers summing up to 1, and if Z(k) ‚ààZ for all k, then
Z :=
‚àû

k=1
Œ±kZ(k) ‚ààZ.
Indeed, for W ‚ààC
‚àû

k=1
|Œ±kZ(k)W| ‚â§|W| ‚ààL1,

1.6 Contingent initial data
37
and so Lebesgue‚Äôs dominated convergence theorem implies that
E[ ZW ] =
‚àû

k=1
Œ±kE[ Z(k)W ] ‚â§0.
For the second step, let
c := sup{P [ Z > 0 ] | Z ‚ààZ }.
We choose Z(n) ‚ààZ such that P [ Z(n) > 0 ] ‚Üíc. Then
Z‚àó:=
‚àû

n=1
2‚àínZ(n) ‚ààZ
by step one, and
{ Z‚àó> 0 } =
‚àû

n=1
{ Z(n) > 0 }.
Hence P [Z‚àó> 0] = c.
In the Ô¨Ånal step, we show that c = 1. Then Z‚àówill be as desired. Suppose by way
of contradiction that P [Z‚àó= 0] > 0, so that W := I{Z‚àó=0} is a non-zero element of
L1
+. Lemma 1.58 yields Z ‚ààZ with E[ WZ ] > 0. Hence,
P [ {Z > 0} ‚à©{Z‚àó= 0} ] > 0,
and so
P
 1
2(Z + Z‚àó) > 0

> P [ Z‚àó> 0 ] = c,
in contradiction to the maximality of P [Z‚àó> 0].
Thus, we have completed the proof of the implication (b) ‚áí(c) of Theorem 1.54
up to the requirement that C is closed in L1. Let us pause here in order to state
general versions of two of the arguments we have used so far. The Ô¨Årst is known as
the Halmos‚ÄìSavage theorem. It can be proved by a straightforward modiÔ¨Åcation of
the exhaustion argument used in the proof of Lemma 1.59.
Theorem 1.60. Let Q be a set of probability measures which are all absolutely con-
tinuous with respect to a given measure P . Suppose that Q ‚âàP in the sense that
Q[ A ] = 0 for all Q ‚ààQ implies that P [ A ] = 0. Then there exists a countable
subfamily 
Q ‚äÇQ which satisÔ¨Åes 
Q ‚âàP .
An inspection of Lemmas 1.57, 1.58, and 1.59 shows that the particular structure
of C = (K ‚àíL0
+)‚à©L1 was only used for part (c) of Lemma 1.57. All other arguments
relied only on the fact that C is a closed convex cone in L1 that contains all bounded
negative functions and no non-trivial positive function. Thus, we have in fact proved
the following Kreps‚ÄìYan theorem, which was obtained independently in [199] and
[137].

38
1 Arbitrage theory
Theorem 1.61. Suppose C is a closed convex cone in L1 satisfying
C ‚äÉ‚àíL‚àû
+
and
C ‚à©L1
+ = {0}.
Then there exists Z ‚ààL‚àûsuch that Z > 0 P -a.s. and E[ W Z ] ‚â§0 for all W ‚ààC.
Let us now turn to the closedness of our set C = (K ‚àíL0
+) ‚à©L1. The following
example illustrates that we cannot expect C to be closed without assuming the absence
of arbitrage opportunities.
Example 1.62. Let P be the Lebesgue measure on the Borel Ô¨Åeld F1 of  = [0, 1],
and take F0 = { ‚àÖ,  } and Y(œâ) = œâ. This choice clearly violates the no-arbitrage
condition, i.e., we have K ‚à©L0
+ Ã∏= {0}. The convex set C = (K ‚àíL0
+) ‚à©L1 is a
proper subset of L1. More precisely, C does not contain any function F ‚ààL1 with
F ‚â•1: If we could represent F as Œæ ¬∑ Y ‚àíU for a non-negative function U, then it
would follow that
Œæ ¬∑ Y = F + U ‚â•1,
which is impossible for any Œæ. However, as we show next, the closure of C in L1
coincides with the full space L1. In particular, C cannot be closed. Let F ‚ààL1 be
arbitrary, and observe that
Fn := (F + ‚àßn) I[ 1
n ,1] ‚àíF ‚àí
converges to F in L1 as n ‚Üë‚àû. Moreover, each Fn belongs to C as
(F + ‚àßn) I[ 1
n ,1] ‚â§n2 ¬∑ Y.
Consequently, F is contained in the L1-closure of C.
‚ô¶
In the special case F0 = {‚àÖ, }, we can directly go on to the proof that C is
closed, using a simpliÔ¨Åed version of Lemma 1.67 below. In this way, we obtain an
alternative proof of Theorem 1.6. In the general case we need some preparation. Let
us Ô¨Årst prove a ‚Äúrandomized‚Äù version of the Bolzano‚ÄìWeierstra√ü theorem. It yields a
simple construction of a measurable selection of a convergent subsequence of a given
sequence in L0(, F0, P; Rd).
Lemma 1.63. Let (Œæn) be a sequence in L0(, F0, P ; Rd) with lim infn |Œæn| < ‚àû.
Then there exists Œæ ‚ààL0(, F0, P; Rd) and a strictly increasing sequence (œÉm) of
F0-measurable integer-valued random variables such that
ŒæœÉm(œâ)(œâ) ‚ÜíŒæ(œâ)
for P -a.e. œâ ‚àà.
Proof. Let (œâ) := lim infn |Œæn(œâ)|, and deÔ¨Åne œÉm := m on the P -null set { = ‚àû}.
On { < ‚àû} we let œÉ 0
1 := 1, and we deÔ¨Åne F0-measurable random indices œÉ 0
m by
œÉ 0
m := inf

n > œÉ 0
m‚àí1

|Œæn| ‚àí
 ‚â§1
m

,
m = 2, 3, . . . .

1.6 Contingent initial data
39
We use recursion on i = 1, . . . , d to deÔ¨Åne the ith component Œæi of the limit Œæ and to
extract a new subsequence œÉ i
m of random indices. Let
Œæi = lim inf
m‚Üë‚àûŒæi
œÉ i‚àí1
m ,
which is already deÔ¨Åned if i = 1. This Œæi can be used in the construction of œÉ i
m: Let
œÉ i
1 := 1 and, for m = 2, 3, . . . ,
œÉ i
m(œâ) := inf

œÉ i‚àí1
n
(œâ)
 œÉ i‚àí1
n
(œâ) > œÉ i
m‚àí1(œâ) and |Œæi
œÉ i‚àí1
n
(œâ) ‚àíŒæi(œâ)| ‚â§1
m

.
Then œÉm := œÉ d
m yields the desired sequence of random indices.
It may happen that
Œæ ¬∑ Y = Œæ ¬∑ Y
P -a.s.,
although Œæ andŒæ are two different portfolios in L0(, F0, P ; Rd).
Remark 1.64. We could exclude this possibility by the following assumption of non-
redundance:
Œæ ¬∑ Y = Œæ ¬∑ Y P -a.s.
"‚áí
Œæ = Œæ P -a.s.
(1.28)
Under this assumption, we could immediately move on to the Ô¨Ånal step in Lemma 1.67.
‚ô¶
Without assumption (1.28), it will be convenient to have a suitable linear space
N‚ä•of ‚Äúreference portfolios‚Äù which are uniquely determined by their payoff. The
construction of N‚ä•is the purpose of the following lemma. We will assume that the
spaces L0 and L0(, F0, P; Rd) are endowed with the topology of convergence in
P-measure, which is generated by the metric d of (A.22).
Lemma 1.65. DeÔ¨Åne two linear subspaces N and N‚ä•of L0(, F0, P ; Rd) by
N :=

Œ∑ ‚ààL0(, F0, P; Rd) | Œ∑ ¬∑ Y = 0 P -a.s.

,
N‚ä•:=

Œæ ‚ààL0(, F0, P; Rd) | Œæ ¬∑ Œ∑ = 0 P -a.s. for all Œ∑ ‚ààN

.
(a) Both N and N‚ä•are closed in L0(, F0, P ; Rd) and, in the following sense,
invariant under the multiplication with scalar functions g ‚ààL0(, F0, P ): If
Œ∑ ‚ààN and Œæ ‚ààN‚ä•, then gŒ∑ ‚ààN and gŒæ ‚ààN‚ä•.
(b) If Œæ ‚ààN‚ä•and Œæ ¬∑ Y = 0 P -a.s., then Œæ = 0, i.e., N ‚à©N‚ä•= {0}.
(c) Every Œæ ‚ààL0(, F0, P; Rd) has a unique decomposition Œæ = Œ∑ + Œæ‚ä•, where
Œ∑ ‚ààN and Œæ‚ä•‚ààN‚ä•.

40
1 Arbitrage theory
Remark 1.66. For the proof of this lemma, we will use a projection argument in
Hilbert space. Let us sketch a more probabilistic construction of the decomposition
Œæ = Œ∑ + Œæ‚ä•. Take a regular conditional distribution of Y given F0, i.e., a stochastic
kernel K from (, F0) to Rd such that K(œâ, A) = P [ Y ‚ààA | F0 ](œâ) for all Borel
sets A ‚äÇRd and P -a.e. œâ (see, e.g., ¬ß44 of [19]). If one deÔ¨Ånes Œæ‚ä•(œâ) as the
orthogonal projection of Œæ(œâ) onto the linear hull L(œâ) of the support of the measure
K(œâ, ¬∑), then Œ∑ := Œæ ‚àíŒæ‚ä•satisÔ¨Åes Œ∑ ¬∑ Y = 0 P -a.s., and any Œ∑ with the same
property must be P -a.s. perpendicular to L(œâ). However, carrying out the details
of this construction involves certain measurability problems; this is why we use the
projection argument below.
‚ô¶
Proof. (a): The closedness of N and N‚ä•follows immediately from the metrizability
of L0(, F0, P ; Rd) (see Appendix A.7) and the fact that every sequence which
converges in measure has an almost-surely converging subsequence. The invariance
under the multiplication with F0-measurable scalar functions is obvious.
(b): Suppose that Œæ ‚ààN ‚à©N‚ä•. Then taking Œ∑ := Œæ in the deÔ¨Ånition of N‚ä•yields
Œæ ¬∑ Œæ = |Œæ|2 = 0 P -a.s.
(c): Any given Œæ ‚ààL0(, F0, P; Rd) can be written as
Œæ(œâ) = Œæ1(œâ) e1 + ¬∑ ¬∑ ¬∑ + Œæd(œâ) ed,
where ei denotes the ith Euclidean unit vector, and where Œæi(œâ) is the ith component
of Œæ(œâ). Consider ei as a constant element of L0(, F0, P ; Rd), and suppose that we
can decompose ei as
ei = ni + e‚ä•
i
where ni ‚ààN and e‚ä•
i ‚ààN‚ä•.
(1.29)
Since by part (a) both N and N‚ä•are invariant under the multiplication with F0-
measurable functions, we can then obtain the desired decomposition of Œæ by letting
Œ∑(œâ) :=
d

i=1
Œæi(œâ) ni(œâ)
and
Œæ‚ä•(œâ) :=
d

i=1
Œæi(œâ) e‚ä•
i (œâ).
Uniqueness of the decomposition follows from N ‚à©N‚ä•= {0}.
It remains to construct the decomposition (1.29) of ei. The constant ei is an element
of the space H := L2(, F0, P; Rd), which becomes a Hilbert space if endowed with
the natural inner product
(Œ∑, Œæ)H := E[ Œ∑ ¬∑ Œæ ],
Œ∑, Œæ ‚ààL2(, F0, P ; Rd).
Observe that both N ‚à©H and N‚ä•‚à©H are closed subspaces of H, because con-
vergence in H implies convergence in L0(, F0, P ; Rd). Therefore, we can deÔ¨Åne
the corresponding orthogonal projections
œÄ0 : H ‚ÜíN ‚à©H
and
œÄ‚ä•: H ‚ÜíN‚ä•‚à©H.

1.6 Contingent initial data
41
Thus, letting ni := œÄ0(ei) and e‚ä•
i := œÄ‚ä•(ei) will be the desired decomposition (1.29),
once we know that ei = œÄ0(ei) + œÄ‚ä•(ei). To prove this, we need only show that
Œ∂ := ei ‚àíœÄ0(ei) is contained in N‚ä•. We assume by way of contradiction that Œ∂ is
not contained in N‚ä•‚à©H. Then there exists some Œ∑ ‚ààN such that P [ Œ∂ ¬∑ Œ∑ > 0 ] > 0.
Clearly,
Œ∑ := Œ∑ I{Œ∂¬∑Œ∑>0, |Œ∑|‚â§c}
is contained in N ‚à©H for each c > 0. But if c is large enough, then 0 < E[Œ∑ ¬∑ Œ∂ ] =
(Œ∑, Œ∂)H, which contradicts the fact that Œ∂ is by construction orthogonal to N ‚à©H.
After these preparations, we can now complete the proof of Theorem 1.54 by
showing the closedness of C = (K ‚àíL0
+) ‚à©L1, which is an immediate consequence
of the following lemma. Recall that we have already proved the equivalence of the
conditions (a) and (b) in Theorem 1.54.
Lemma 1.67. If K ‚à©L0
+ = {0}, then K ‚àíL0
+ is closed in L0.
Proof. Suppose Wn ‚àà(K ‚àíL0
+) converges in L0 to some W as n ‚Üë‚àû. By passing
to a suitable subsequence, we may assume without loss of generality that Wn ‚ÜíW
P-almost surely. We can write Wn = Œæn ¬∑ Y ‚àíUn for Œæn ‚ààN‚ä•and Un ‚ààL0
+.
In a Ô¨Årst step, we will prove the assertion given the fact that
lim inf
n‚Üë‚àû|Œæn| < ‚àû
P -a.s.,
(1.30)
which will be established afterwards.
Assuming (1.30), Lemma 1.63 yields
F0-measurable integer-valued random variables œÉ1 < œÉ2 < ¬∑ ¬∑ ¬∑ and some Œæ ‚àà
L0(œâ, F0, P; Rd) such that P -a.s. ŒæœÉn ‚ÜíŒæ. It follows that
UœÉn = ŒæœÉn ¬∑ Y ‚àíWœÉn ‚àí‚ÜíŒæ ¬∑ Y ‚àíW =: U
P-a.s.,
(1.31)
so that W = Œæ ¬∑ Y ‚àíU ‚ààK ‚àíL0
+.
Let us now show that A := { lim infn |Œæn| = +‚àû} satisÔ¨Åes P [ A ] = 0 as claimed
in (1.30). Using Lemma 1.63 on Œ∂n := Œæn/|Œæn| yields F0-measurable integer-valued
random variables œÑ1 < œÑ2 < ¬∑ ¬∑ ¬∑ and some Œ∂ ‚ààL0(œâ, F0, P ; Rd) such that P -a.s.
Œ∂œÑn ‚ÜíŒ∂. The convergence of (Wn) implies that
0 ‚â§IA
UœÑn
|ŒæœÑn| = IA
	
Œ∂œÑn ¬∑ Y ‚àíWœÑn
|ŒæœÑn|

‚àí‚ÜíIA Œ∂ ¬∑ Y
P -a.s.
Hence, our assumption K ‚à©L0
+ = {0} yields (IAŒ∂) ¬∑ Y = 0. Below we will show that
IAŒ∂ ‚ààN‚ä•, so that
Œ∂ = 0
P -a.s. on A.
(1.32)
On the other hand, the fact that |Œ∂n| = 1 P -a.s. implies that |Œ∂| = 1 P -a.s., which can
only be consistent with (1.32) if P [ A ] = 0.

42
1 Arbitrage theory
It remains to show that IAŒ∂ ‚ààN‚ä•. To this end, we Ô¨Årst observe that each Œ∂œÑn
belongs to N‚ä•since, for each Œ∑ ‚ààN,
Œ∂œÑn ¬∑ Œ∑ =
‚àû

k=1
I{œÑn=k}
1
|Œæk|Œæk ¬∑ Œ∑ = 0
P -a.s.
The closedness of N‚ä•implies Œ∂ ‚ààN‚ä•, and A ‚ààF0 yields IAŒ∂ ‚ààN‚ä•.
If in the proof of Lemma 1.67 Wn = Œæn ¬∑ Y for all n, then U = 0 in (1.31), and
W = limn Wn is itself contained in K. We thus get the following lemma, which will
be useful in Chapter 5.
Lemma 1.68. Suppose that K ‚à©L0
+ = {0}. Then K is closed in L0.
In fact, it is possible to show that K is always closed in L0; see [193], [175]. But
this stronger result will not be needed here.
As an alternative to the randomized Bolzano‚ÄìWeierstra√ü theorem in Lemma 1.63,
we can use the following variant of Komlos‚Äô principle of subsequences. It yields a
convergent sequence of convex combinations of a sequence in L0(, F0, P ; Rd), and
this will be needed later on. Recall from Appendix A.1 the notion of the convex hull
conv A =

n

i=1
Œ±ixi
 xi ‚ààA, Œ±i ‚â•0,
n

i=1
Œ±i = 1, n ‚ààN

of a subset A of a linear space, which in our case will be L0(, F0, P ; Rd).
Lemma 1.69. Let (Œæn) be a sequence in L0(, F0, P ; Rd) such that supn |Œæn| < ‚àû
P-almost surely. Then there exists a sequence of convex combinations
Œ∑n ‚ààconv{ Œæn, Œæn+1, . . . }
which converges P -almost surely to some Œ∑ ‚ààL0(, F0, P ; Rd).
Proof. We can assume without loss of generality that supn |Œæn| ‚â§1 P -a.s.; otherwise
we consider the sequence Œæn := Œæn/ supn |Œæn|. Then (Œæn) is a bounded sequence
in the Hilbert space H := L2(, F0, P; Rd). Since the closed unit ball in H is
weakly compact, the sequence (Œæn) has an accumulation point Œ∑ ‚ààH; note that weak
sequential compactness follows from the Banach‚ÄìAlaoglu theorem in the form of
Theorem A.62 and the fact that the dual H ‚Ä≤ of the Hilbert space H is isomorphic
to H itself. For each n, the accumulation point Œ∑ belongs to the L2-closure Cn of
conv{Œæn, Œæn+1, . . . }, due to the fact that a closed convex set in H is also weakly
closed; see Theorem A.59. Thus, we can Ô¨Ånd Œ∑n ‚ààconv{Œæn, Œæn+1, . . . } such that
E[ |Œ∑n ‚àíŒ∑|2 ] ‚â§1
n2 .
This sequence (Œ∑n) converges P -a.s. to Œ∑.

1.6 Contingent initial data
43
Remark 1.70. The original result by Komlos [133] is more precise: It states that for
any bounded sequence (Œæn) in L1(, F , P; Rd) there is a subsequence (Œænk) which
satisÔ¨Åes a strong law of large numbers, i.e.,
lim
N‚Üë‚àû
1
N
N

k=1
Œænk
exists P -almost surely; see also [195].
‚ô¶

Chapter 2
Preferences
In a complete Ô¨Ånancial market model, the price of a contingent claim is determined
by arbitrage arguments, without involving the preferences of economic agents. In an
incomplete model, such claims may carry an intrinsic risk which cannot be hedged
away. In order to determine desirable strategies in view of such risks, the preferences
of an investor should be made explicit, and this is usually done in terms of an expected
utility criterion.
The paradigm of expected utility is the theme of this chapter. We begin with a
general discussion of preference relations on a set X of alternative choices and their
numerical representation by some functional U on X. In the Ô¨Ånancial context, such
choices can usually be described as payoff proÔ¨Åles. These are deÔ¨Åned as functions
X on an underlying set of scenarios with values in some set of payoffs. Thus we are
facing risk or even uncertainty. In the case of risk, a probability measure is given on
the set of scenarios. In this case, we can focus on the resulting payoff distributions.
We are then dealing with preferences on ‚Äúlotteries‚Äù, i.e., on probability measures on
the set of payoffs.
In Sections 2.2 and 2.3 we discuss the conditions ‚Äì or axioms ‚Äì under which such
a preference relation on lotteries ¬µ can be represented by a functional of the form

u(x) ¬µ(dx),
where u is a utility function on the set of payoffs. This formulation of preferences
on lotteries in terms of expected utility goes back to D. Bernoulli [22]; the axiomatic
theory was initiated by J. von Neumann and O. Morgenstern [155]. Section 2.4 char-
acterizes uniform preference relations which are shared by a given class of functions u.
This involves the general theory of probability measures on product spaces with given
marginals which will be discussed in Section 2.6.
In Section 2.5 we return to the more fundamental level where preferences are
deÔ¨Åned on payoff proÔ¨Åles, and where we are facing uncertainty in the sense that no
probability measure is given a priori. L. Savage [174] clariÔ¨Åed the conditions under
which such preferences on a space of functions X admit a representation of the form
U(X) = EQ[ u(X) ]
where Q is a ‚Äúsubjective‚Äù probability measure on the set of scenarios. We are going to
concentrate on a robust extension of the Savage representation which was introduced
by I. Gilboa and D. Schmeidler [104]. Here the utility functional is of the form
U(X) = inf
Q‚ààQ EQ[ u(X) ],

2.1 Preference relations and their numerical representation
45
and it involves a whole class Q of probability measures on the set of scenarios. The
axiomatic approach to the robust Savage representation is closely related to the con-
struction of risk measures, which will be the topic of Chapter 4.
2.1 Preference relations and their numerical representation
Let X be some non-empty set. An element x ‚ààX will be interpreted as a possible
choice of an economic agent. If presented with two choices x, y ‚ààX, the agent might
prefer one over the other. This will be formalized as follows.
DeÔ¨Ånition 2.1. A preference order (or preference relation) on X is a binary relation
‚âªwith the following two properties.
‚Ä¢ Asymmetry: If x ‚âªy, then y Ã∏‚âªx.
‚Ä¢ Negative transitivity: If x ‚âªy and z ‚ààX, then either x ‚âªz or z ‚âªy or both
must hold.
Negative transitivity states that if a clear preference exists between two choices
x and y, and if a third choice z is added, then there is still a choice which is least
preferable (y if z ‚âªy) or most preferable (x if x ‚âªz).
DeÔ¨Ånition 2.2. A preference order ‚âªon X induces a corresponding weak preference
order ‚™∞deÔ¨Åned by
x ‚™∞y : ‚áê‚áí
y Ã∏‚âªx,
and an indifference relation ‚àºgiven by
x ‚àºy : ‚áê‚áí
x ‚™∞y and y ‚™∞x.
Thus, x ‚™∞y means that either x is preferred to y or there is no clear preference
between the two.
Remark 2.3. It is easy to check that the asymmetry and the negative transitivity of ‚âª
are equivalent to the following two respective properties of ‚™∞:
(a) Completeness: For all x, y ‚ààX, either y ‚™∞x or x ‚™∞y or both are true.
(b) Transitivity: If x ‚™∞y and y ‚™∞z, then also x ‚™∞z.
Conversely, any complete and transitive relation ‚™∞induces a preference order ‚âªvia
the negation of ‚™∞, i.e.,
y ‚âªx
: ‚áê‚áí
x Ã∏‚™∞y.
The indifference relation ‚àºis an equivalence relation, i.e., it is reÔ¨Çexive, symmetric
and transitive.
‚ô¶

46
2 Preferences
DeÔ¨Ånition 2.4. A numerical representation of a preference order ‚âªis a function
U : X ‚ÜíR such that
y ‚âªx
‚áê‚áí
U(y) > U(x).
(2.1)
Clearly, (2.1) is equivalent to
y ‚™∞x
‚áê‚áí
U(y) ‚â•U(x).
NotethatsuchanumericalrepresentationU isnotunique: Iff isanystrictlyincreasing
function, then 
U(x) := f (U(x)) is again a numerical representation.
DeÔ¨Ånition 2.5. Let ‚âªbe a preference relation on X. A subset Z of X is called order
dense if for any pair x, y ‚ààX such that x ‚âªy there exists some z ‚ààZ with x ‚™∞z ‚™∞y.
The following theorem characterizes those preference relations for which there
exists a numerical representation.
Theorem 2.6. For the existence of a numerical representation of a preference relation
‚âªit is necessary and sufÔ¨Åcient that X contains a countable, order dense subset Z. In
particular, any preference order admits a numerical representation if X is countable.
Proof. Suppose Ô¨Årst that we are given a countable order dense subset Z of X. For
x ‚ààX, let
Z(x) := {z ‚ààZ | z ‚âªx}
and
Z(x) := {z ‚ààZ | x ‚âªz}.
The relation x ‚™∞y implies that Z(x) ‚äÜZ(y) and Z(x) ‚äáZ(y). If the strict relation
x ‚âªy holds, then at least one of these inclusions is also strict. To see this, pick
z ‚ààZ with x ‚™∞z ‚™∞y, so that either x ‚âªz ‚™∞y or x ‚™∞z ‚âªy. In the Ô¨Årst case,
z ‚ààZ(x)\Z(y), while z ‚ààZ(y)\Z(x) in the second case.
Next, take any strictly positive probability distribution ¬µ on Z, and let
U(x) :=

z‚ààZ(x)
¬µ(z) ‚àí

z‚ààZ(x)
¬µ(z).
By the above, U(x) > U(y) if and only if x ‚âªy so that U is the desired numerical
representation.
For the proof of the converse assertion take a numerical representation U and let
J denote the countable set
J :=

[a, b] | a, b ‚ààQ, a < b, U‚àí1([a, b]) Ã∏= ‚àÖ

.
For every interval I ‚ààJ we can choose some zI ‚ààX with U(zI) ‚ààI and thus deÔ¨Åne
the countable set
A := { zI | I ‚ààJ }.
At Ô¨Årst glance it may seem that A is a good candidate for an order dense set. However,
it may happen that there are x, y ‚ààX such that U(x) < U(y) and for which there

2.1 Preference relations and their numerical representation
47
is no z ‚ààX with U(x) < U(z) < U(y). In this case, an order dense set must
contain at least one z with U(z) = U(x) or U(z) = U(y), a condition which cannot
be guaranteed by A.
Let us deÔ¨Åne the set C of all pairs (x, y) which do not admit any z ‚ààA with
y ‚âªz ‚âªx:
C :=

(x, y) | x, y ‚ààX\A, y ‚âªx and Ã∏ ‚àÉz ‚ààA with y ‚âªz ‚âªx

.
Then (x, y) ‚ààC implies the apparently stronger fact that we cannot Ô¨Ånd any z ‚ààX
such that y ‚âªz ‚âªx: Otherwise we could Ô¨Ånd a, b ‚ààQ such that
U(x) < a < U(z) < b < U(y),
so I := [a, b] would belong to J, and the corresponding zI would be an element of
A with y ‚âªzI ‚âªx, contradicting the assumption that (x, y) ‚ààC.
It follows that all intervals

U(x), U(y)

with (x, y) ‚ààC are disjoint and non-
empty. Hence, there can be only countably many of them. For each such interval J we
pick now exactly one pair (xJ , yJ ) ‚ààC such that U(xJ ) and U(yJ ) are the endpoints
of J, and we denote by B the countable set containing all xJ and all yJ .
Finally, we claim that Z := A ‚à™B is an order dense subset of X. Indeed, if x,
y ‚ààX\Z with y ‚âªx, then either there is some z ‚ààA such that y ‚âªz ‚âªx, or
(x, y) ‚ààC. In the latter case, there will be some z ‚ààB with U(y) = U(z) > U(x)
and, consequently, y ‚™∞z ‚âªx.
The following example shows that even in a seemingly straightforward situation,
a given preference order may not admit a numerical representation.
Example 2.7. Let ‚âªbe the usual lexicographical order on X := [0, 1] √ó [0, 1], i.e.,
(x1, x2) ‚âª(y1, y2) if and only if either x1 > y1, or if x1 = y1 and simultaneously
x2 > y2. In order to show that there cannot be a numerical representation for this
preference order, suppose on the contrary that U is such a numerical representation.
Then
d(Œ±) := U(Œ±, 1) ‚àíU(Œ±, 0)
is strictly positive for all Œ± ‚àà[0, 1]. Hence,
[0, 1] =
‚àû

n=1

Œ± ‚àà[0, 1]
 d(Œ±) > 1
n

.
Denote An := {Œ± | d(Œ±) > 1/n}. There must be at least one set An0 having inÔ¨Ånitely
many elements, and we can pick an arbitrary number N of elements Œ±1, . . . , Œ±N ‚ààAn0
such that Œ±1 < ¬∑ ¬∑ ¬∑ < Œ±N. Since (Œ±i+1, 0) ‚âª(Œ±i, 1), it follows that
U(Œ±i+1, 0) ‚àíU(Œ±i, 0) > U(Œ±i, 1) ‚àíU(Œ±i, 0) = d(Œ±i) > 1
n0
.

48
2 Preferences
Hence
U(1, 1) ‚àíU(0, 0)
= U(1, 1) ‚àíU(Œ±N, 0) +
N‚àí1

i=1
[ U(Œ±i+1, 0) ‚àíU(Œ±i, 0) ] + U(Œ±1, 0) ‚àíU(0, 0)
> N ‚àí1
n0
.
But N can be chosen arbitrarily large while n0 remains Ô¨Åxed. Thus U(1, 1)‚àíU(0, 0)
must be inÔ¨Ånite, which is impossible.
‚ô¶
DeÔ¨Ånition 2.8. Let X be a topological space. A preference relation ‚âªis called con-
tinuous if for all x ‚ààX
B(x) := {y ‚ààX | y ‚âªx}
and
B(x) := {y ‚ààX | x ‚âªy}
(2.2)
are open subsets of X.
Remark 2.9. Every preference order that admits a continuous numerical representa-
tion is itself continuous. Under some mild conditions on the underlying space X, the
converse statement is also true; see Theorem 2.15 below.
‚ô¶
Example 2.10. The lexicographical order of Example 2.7 is not continuous:
If
(x1, x2) ‚àà[0, 1] √ó [0, 1] is given, then

(y1, y2) | (y1, y2) ‚âª(x1, x2)

= (x1, 1] √ó [0, 1] ‚à™{x1} √ó (x2, 1],
which is typically not an open subset of [0, 1] √ó [0, 1].
‚ô¶
Recall that a topological space X is called a topological Hausdorff space if any
two distinct points in X have disjoint open neighborhoods. In this case, all singletons
{x} are closed. Clearly, every metric space is a topological Hausdorff space.
Proposition 2.11. Let ‚âªbe a preference order on a topological Hausdorff space X.
Then the following properties are equivalent.
(a) ‚âªis continuous.
(b) The set { (x, y) | y ‚âªx } is open in X √ó X.
(c) The set { (x, y) | y ‚™∞x } is closed in X √ó X.
Proof. (a) ‚áí(b): We have to show that for any pair
(x0, y0) ‚ààM := { (x, y) | y ‚âªx }
there exist open sets U, V ‚äÇX such that x0 ‚ààU, y0 ‚ààV , and U √óV ‚äÇM. Consider
Ô¨Årst the case in which there exists some z ‚ààB(x0) ‚à©B(y0) for the notation B(x0)

2.1 Preference relations and their numerical representation
49
and B(y0) introduced in (2.2). Then y0 ‚âªz ‚âªx0, so that U := B(z) and V := B(z)
are open neighborhoods of x0 and y0, respectively. Moreover, if x ‚ààU and y ‚ààV ,
then y ‚âªz ‚âªx, and thus U √ó V ‚äÇM.
If B(x0) ‚à©B(y0) = ‚àÖ, we let U := B(y0) and V := B(x0). If (x, y) ‚ààU √ó V ,
then y0 ‚âªx and y ‚âªx0 by deÔ¨Ånition. We want to show that y ‚âªx in order to
conclude that U √óV ‚äÇM. To this end, suppose that x ‚™∞y. Then y0 ‚âªy by negative
transitivity, hence y0 ‚âªy ‚âªx0. But then y ‚ààB(x0) ‚à©B(y0) Ã∏= ‚àÖ, and we have a
contradiction.
(b) ‚áí(c): First note that the mapping œÜ(x, y) := (y, x) is a homeomorphism of
X√óX. Then observe that the set { (x, y) | y ‚™∞x } is just the complement of the open
set œÜ({ (x, y) | y ‚âªx }).
(c) ‚áí(a): Since X is a topological Hausdorff space, {x} √ó X is closed in X √ó X,
and so is the set
{x} √ó X ‚à©{ (x, y) | y ‚™∞x } = {x} √ó { y | y ‚™∞x }.
Hence { y | y ‚™∞x } is closed in X, and its complement { y | x ‚âªy } is open. The
same argument applies to { y | y ‚âªx }.
Example 2.12. For x0 < y0 consider the set X := (‚àí‚àû, x0] ‚à™[y0, ‚àû) endowed
with the usual order > on R. Then, with the notation introduced in (2.2), B(y0) =
(‚àí‚àû, x0] and B(x0) = [y0, ‚àû). Hence,
B(x0) ‚à©B(y0) = ‚àÖ
despite y0 ‚âªx0, a situation we had to consider in the preceding proof.
‚ô¶
Recall that the topological space X is called connected if X cannot be written as
the union of two disjoint and non-empty open sets. Assuming that X is connected
will rule out the situation occurring in Example 2.12.
Proposition 2.13. Let X be a connected topological space with a continuous prefer-
ence order ‚âª. Then every dense subset Z of X is also order dense in X. In particular,
there exists a numerical representation of ‚âªif X is separable.
Proof. Take x, y ‚ààX with y ‚âªx, and consider B(x) and B(y) as deÔ¨Åned in (2.2).
Since y ‚ààB(x) and x ‚ààB(y), neither B(x) nor B(y) are empty sets. Moreover,
negative transitivity implies that X = B(x) ‚à™B(y). Hence, the open sets B(x)
and B(y) cannot be disjoint, as X is connected. Thus, the open set B(x) ‚à©B(y)
must contain some element z of the dense subset Z, which then satisÔ¨Åes y ‚âªz ‚âªx.
Therefore Z is an order dense subset of X.
Separability of X means that there exists a countable dense subset Z of X, which
then is order dense. Hence, the existence of a numerical representation follows from
Theorem 2.6.

50
2 Preferences
Remark 2.14. Consider the situation of Example 2.12, where X := (‚àí‚àû, x0] ‚à™
[y0, ‚àû), and suppose that x0 and y0 are both irrational. Then Z := Q ‚à©X is dense
in X, but there exists no z ‚ààZ such that y0 ‚™∞z ‚™∞x0. This example shows that the
assumption of topological connectedness is essential for Proposition 2.13.
‚ô¶
Theorem 2.15. Let X be a topological space which satisÔ¨Åes at least one of the fol-
lowing two properties:
‚Ä¢ X has a countable base of open sets.
‚Ä¢ X is separable and connected.
Then every continuous preference order on X admits a continuous numerical repre-
sentation.
For a proof we refer to [57], Propositions 3 and 4. For our purposes, namely for
the proof of the von Neumann‚ÄìMorgenstern representation in the next section and for
the proof of the robust Savage representation in Section 2.5, the following lemma will
be sufÔ¨Åcient.
Lemma 2.16. Let X be a connected metric space with a continuous preference order
‚âª. If U : X ‚ÜíR is a continuous function, and if its restriction to some dense subset Z
is a numerical representation for the restriction of ‚âªto Z, then U is also a numerical
representation for ‚âªon X.
Proof. We have to show that y ‚âªx if and only if U(y) > U(x). In order to verify
the ‚Äúonly if‚Äù part, take x, y ‚ààX with y ‚âªx. As in the proof of Proposition 2.13,
we obtain the existence of some z0 ‚ààZ with y ‚âªz0 ‚âªx. Repeating this argument
yields z‚Ä≤
0 ‚ààZ such that z0 ‚âªz‚Ä≤
0 ‚âªx. Now we take two sequences (zn) and (z‚Ä≤
n) in Z
with zn ‚Üíy and z‚Ä≤
n ‚Üíx. By continuity of ‚âª, eventually
zn ‚âªz0 ‚âªz‚Ä≤
0 ‚âªz‚Ä≤
n,
and thus
U(zn) > U(z0) > U(z‚Ä≤
0) > U(z‚Ä≤
n).
The continuity of U implies that U(zn) ‚ÜíU(y) and U(z‚Ä≤
n) ‚ÜíU(x), whence
U(y) ‚â•U(z0) > U(z‚Ä≤
0) ‚â•U(x).
For the proof of the converse implication, suppose that x, y ‚ààX are such that
U(y) > U(x). Since U is continuous,
U(x) := { z ‚ààX | U(z) > U(x) }
and
U(y) := { z ‚ààX | U(z) < U(y) }

2.2 Von Neumann‚ÄìMorgenstern representation
51
are both non-empty open subsets of X. Moreover, U(y)‚à™U(x) = X. Connectedness
of X implies that U(y)‚à©U(x) Ã∏= ‚àÖ. As above, a repeated application of the preceding
argument yields z0, z‚Ä≤
0 ‚ààZ such that
U(y) > U(z0) > U(z‚Ä≤
0) > U(x).
Since Z is a dense subset of X, we can Ô¨Ånd sequences (zn) and (z‚Ä≤
n) in Z with zn ‚Üíy
and z‚Ä≤
n ‚Üíx as well as with U(zn) > U(z0) and U(z‚Ä≤
n) < U(z‚Ä≤
0). Since U is a
numerical representation of ‚âªon Z, we have
zn ‚âªz0 ‚âªz‚Ä≤
0 ‚âªz‚Ä≤
n.
Hence, by the continuity of ‚âª, neither z0 ‚âªy nor x ‚âªz‚Ä≤
0 can be true, and negative
transitivity yields y ‚âªx.
2.2 Von Neumann‚ÄìMorgenstern representation
Suppose that each possible choice for our economic agent corresponds to a probability
distribution on a given set of scenarios. Thus, the set X can be identiÔ¨Åed with a subset
M of the set M1(S, S) of all probability distributions on a measurable space (S, S). In
the context of the theory of choice, the elements of M are sometimes called lotteries.
We will assume in the sequel that M is convex. The aim of this section is to characterize
those preference orders ‚âªon M which allow for a numerical representation U of the
form
U(¬µ) =

u(x) ¬µ(dx)
for all ¬µ ‚ààM,
(2.3)
where u is a real function on S.
DeÔ¨Ånition 2.17. A numerical representation U of a preference order ‚âªon M is called
a von Neumann‚ÄìMorgenstern representation if it is of the form (2.3).
Any von Neumann‚ÄìMorgenstern representation U is afÔ¨Åne on M in the sense that
U(Œ±¬µ + (1 ‚àíŒ±)ŒΩ) = Œ±U(¬µ) + (1 ‚àíŒ±)U(ŒΩ)
for all ¬µ, ŒΩ ‚ààM and Œ± ‚àà[0, 1]. It is easy to check that afÔ¨Ånity of U implies the
following two properties, or axioms, for a preference order ‚âªon M. The Ô¨Årst property
says that a preference ¬µ ‚âªŒΩ is preserved in any convex combination, independent of
the context described by another lottery Œª.
DeÔ¨Ånition 2.18. A preference relation ‚âªon M satisÔ¨Åes the independence axiom if,
for all ¬µ, ŒΩ ‚ààM, the relation ¬µ ‚âªŒΩ implies
Œ±¬µ + (1 ‚àíŒ±)Œª ‚âªŒ±ŒΩ + (1 ‚àíŒ±)Œª
for all Œª ‚ààM and all Œ± ‚àà(0, 1].

52
2 Preferences
The independence axiom is also called the substitution axiom. It can be illustrated
by introducing a compound lottery, which represents the distribution Œ±¬µ + (1 ‚àíŒ±)Œª
as a two-step procedure. First, we sample either lottery ¬µ or Œª with probability Œ± and
1 ‚àíŒ±, respectively. Then the lottery drawn in this Ô¨Årst step is realized. Clearly, this
is equivalent to playing directly the lottery Œ±¬µ + (1 ‚àíŒ±)Œª. With probability 1 ‚àíŒ±,
the distribution Œª is drawn and in this case there is no difference to the compound
lottery where ŒΩ is replaced by ¬µ. The only difference occurs when ¬µ is drawn, and
this happens with probability Œ±. Thus, if ¬µ ‚âªŒΩ then it seems reasonable to prefer the
compound lottery with ¬µ over the one with ŒΩ.
DeÔ¨Ånition 2.19. A preference relation ‚âªon M satisÔ¨Åes the Archimedean axiom if for
any triple ¬µ ‚âªŒª ‚âªŒΩ there are Œ±, Œ≤ ‚àà(0, 1) such that
Œ±¬µ + (1 ‚àíŒ±)ŒΩ ‚âªŒª ‚âªŒ≤¬µ + (1 ‚àíŒ≤)ŒΩ.
The Archimedean axiom derives its name from its similarity to the Archimedean
principle in real analysis: For every small Œµ > 0 and each large x, there is some
n ‚ààN such that n Œµ > x. Sometimes it is also called the continuity axiom, because
it can act as a substitute for the continuity of ‚âªin a suitable topology on M. More
precisely, suppose that M is endowed with a topology for which convex combinations
are continuous curves, i.e., Œ±¬µ + (1 ‚àíŒ±)ŒΩ converges to ŒΩ or ¬µ as Œ± ‚Üì0 or Œ± ‚Üë1,
respectively. Then continuity of our preference order ‚âªin this topology automatically
implies the Archimedean axiom.
Remark 2.20. Asanaxiomforconsistentbehaviorinthefaceofrisk, theArchimedean
axiom is less intuitive than the independence axiom. Consider the following three de-
terministic distributions: ŒΩ yields 1000 ‚Ç¨, Œª yields 10 ‚Ç¨, and ¬µ is the lottery where one
dies for sure. Even for small Œ± ‚àà(0, 1) it is not clear that someone would prefer the
gamble Œ±¬µ + (1 ‚àíŒ±)ŒΩ, which involves the probability Œ± of dying, over the conserva-
tive 10 ‚Ç¨ yielded by Œª. Note, however, that most people would not hesitate to drive a
car for a distance of 50 km in order to receive a premium of 1000 ‚Ç¨, even though this
might involve the risk of a deadly accident.
‚ô¶
Our Ô¨Årst goal is to show that the Archimedean axiom and the independence axiom
imply the existence of an afÔ¨Åne numerical representation.
Theorem 2.21. Suppose that ‚âªis a preference relation on M satisfying both the
Archimedean and the independence axiom. Then there exists an afÔ¨Åne numerical
representation U of ‚âª. Moreover, U is unique up to positive afÔ¨Åne transformations,
i.e., any other afÔ¨Åne numerical representation 
U with these properties is of the form

U = a U + b for some a > 0 and b ‚ààR.
In two important cases, such an afÔ¨Åne numerical representation will already be of
von Neumann‚ÄìMorgenstern form. This is the content of the following two corollaries,
which we state before provingTheorem 2.21. For the Ô¨Årst corollary, we need the notion

2.2 Von Neumann‚ÄìMorgenstern representation
53
of a simple probability distribution. This is a probability measure ¬µ on S which can be
written as a Ô¨Ånite convex combination of Dirac masses, i.e., there exist x1, . . . , xN ‚ààS
and Œ±1, . . . , Œ±N ‚àà(0, 1] such that
¬µ =
N

i=1
Œ±iŒ¥xi.
Corollary 2.22. Suppose that M is the set of all simple probability distributions on S
and that ‚âªis a preference order on M that satisÔ¨Åes both the Archimedean and the in-
dependence axiom. Then there exists a von Neumann‚ÄìMorgenstern representation U.
Moreover, both U and u are unique up to positive afÔ¨Åne transformations.
Proof. Let U be an afÔ¨Åne numerical representation, which exists by Theorem 2.21. We
deÔ¨Åne u(x) := U(Œ¥x), for x ‚ààS. If ¬µ ‚ààM is of the form ¬µ = Œ±1Œ¥x1 + ¬∑ ¬∑ ¬∑ + Œ±NŒ¥xN ,
then afÔ¨Ånity of U implies
U(¬µ) =
N

i=1
Œ±iU(Œ¥xi) =

u(x) ¬µ(dx).
This is the desired von Neumann‚ÄìMorgenstern representation.
OnaÔ¨ÅnitesetS, everyprobabilitymeasureissimple. Thus, weobtainthefollowing
result as a special case.
Corollary 2.23. Suppose that M is the set of all probability distributions on a Ô¨Ånite
set S and that ‚âªis a preference order on M that satisÔ¨Åes both the Archimedean and the
independence axiom. Then there exists a von Neumann‚ÄìMorgenstern representation,
and it is unique up to positive afÔ¨Åne transformations.
For the proof of Theorem 2.21, we need the following auxiliary lemma. Its Ô¨Årst as-
sertion states that taking convex combination is monotone with respect to a preference
order ‚âªsatisfying our two axioms. Its second part can be regarded as an ‚Äúintermediate
value theorem‚Äù for straight lines in M, and (c) is the analogue of the independence
axiom for the indifference relation ‚àº.
Lemma 2.24. Under the assumptions of Theorem 2.21, the following assertions are
true.
(a) If ¬µ ‚âªŒΩ, then Œ± ‚ÜíŒ±¬µ + (1 ‚àíŒ±)ŒΩ is strictly increasing with respect to ‚âª.
More precisely, Œ≤¬µ + (1 ‚àíŒ≤)ŒΩ ‚âªŒ±¬µ + (1 ‚àíŒ±)ŒΩ for 0 ‚â§Œ± < Œ≤ ‚â§1.
(b) If ¬µ ‚âªŒΩ and ¬µ ‚™∞Œª ‚™∞ŒΩ, then there exists a unique Œ± ‚àà[0, 1] with Œª ‚àº
Œ±¬µ + (1 ‚àíŒ±)ŒΩ.
(c) If ¬µ ‚àºŒΩ, then Œ±¬µ+(1‚àíŒ±)Œª ‚àºŒ±ŒΩ +(1‚àíŒ±)Œª for all Œ± ‚àà[0, 1] and all Œª ‚ààM.

54
2 Preferences
Proof. (a): Let Œª := Œ≤¬µ + (1 ‚àíŒ≤)ŒΩ. The independence axiom implies that Œª ‚âª
Œ≤ŒΩ + (1 ‚àíŒ≤)ŒΩ = ŒΩ. Hence, for Œ≥ := Œ±/Œ≤,
Œ≤¬µ + (1 ‚àíŒ≤)ŒΩ = (1 ‚àíŒ≥ )Œª + Œ≥ Œª ‚âª(1 ‚àíŒ≥ )ŒΩ + Œ≥ Œª = Œ±¬µ + (1 ‚àíŒ±)ŒΩ.
(b): Part (a) guarantees that Œ± is unique if it exists. To show existence, we need
only to consider the case ¬µ ‚âªŒª ‚âªŒΩ, for otherwise we can take either Œ± = 0 or Œ± = 1.
The natural candidate is
Œ± := sup{ Œ≥ ‚àà[0, 1] | Œª ‚™∞Œ≥ ¬µ + (1 ‚àíŒ≥ )ŒΩ }.
If Œª ‚àºŒ±¬µ + (1 ‚àíŒ±)ŒΩ is not true, then one of the following two possibilities must
occur:
Œª ‚âªŒ±¬µ + (1 ‚àíŒ±)ŒΩ,
or
Œª ‚â∫Œ±¬µ + (1 ‚àíŒ±)ŒΩ.
(2.4)
In the Ô¨Årst case, we apply the Archimedean axiom to obtain some Œ≤ ‚àà(0, 1) such that
Œª ‚âªŒ≤

Œ±¬µ + (1 ‚àíŒ±)ŒΩ

+ (1 ‚àíŒ≤)¬µ = Œ≥ ¬µ + (1 ‚àíŒ≥ )ŒΩ
(2.5)
for Œ≥ = 1 ‚àíŒ≤(1 ‚àíŒ±).
Since Œ≥ > Œ±, it follows from the deÔ¨Ånition of Œ± that
Œ≥ ¬µ + (1 ‚àíŒ≥ )ŒΩ ‚âªŒª, which contradicts (2.5). If the second case in (2.4) occurs, the
Archimedean axiom yields some Œ≤ ‚àà(0, 1) such that
Œ≤

Œ±¬µ + (1 ‚àíŒ±)ŒΩ

+ (1 ‚àíŒ≤)ŒΩ = Œ≤Œ±¬µ + (1 ‚àíŒ≤Œ±)ŒΩ ‚âªŒª.
(2.6)
Clearly Œ≤Œ± < Œ±, so that the deÔ¨Ånition of Œ± yields some Œ≥ ‚àà(Œ≤Œ±, Œ±] with Œª ‚™∞
Œ≥ ¬µ + (1 ‚àíŒ≥ )ŒΩ. Part (a) and the fact that Œ≤Œ± < Œ≥ imply that
Œª ‚™∞Œ≥ ¬µ + (1 ‚àíŒ≥ )ŒΩ ‚âªŒ≤Œ±¬µ + (1 ‚àíŒ≤Œ±)ŒΩ,
which contradicts (2.6).
(c): We must exclude both of the following two possibilities
Œ±¬µ + (1 ‚àíŒ±)Œª ‚âªŒ±ŒΩ + (1 ‚àíŒ±)Œª
and
Œ±ŒΩ + (1 ‚àíŒ±)Œª ‚âªŒ±¬µ + (1 ‚àíŒ±)Œª. (2.7)
To this end, we may assume that there exists some œÅ ‚ààM with œÅ Ã∏‚àº¬µ ‚àºŒΩ; otherwise
the result is trivial. Let us assume that œÅ ‚âª¬µ ‚àºŒΩ; the case in which ¬µ ‚àºŒΩ ‚âªœÅ
is similar. Suppose that the Ô¨Årst possibility in (2.7) would occur. The independence
axiom yields
Œ≤œÅ + (1 ‚àíŒ≤)ŒΩ ‚âªŒ≤ŒΩ + (1 ‚àíŒ≤)ŒΩ = ŒΩ ‚àº¬µ
for all Œ≤ ‚àà(0, 1). Therefore,
Œ±

Œ≤œÅ + (1 ‚àíŒ≤)ŒΩ

+ (1 ‚àíŒ±)Œª ‚âªŒ±¬µ + (1 ‚àíŒ±)Œª
for all Œ≤ ‚àà(0, 1).
(2.8)
Using our assumption that the Ô¨Årst possibilities in (2.7) is occurring, we obtain from
part (b) a unique Œ≥ ‚àà(0, 1) such that, for any Ô¨Åxed Œ≤,
Œ±¬µ + (1 ‚àíŒ±)Œª ‚àºŒ≥

Œ±

Œ≤œÅ + (1 ‚àíŒ≤)ŒΩ

+ (1 ‚àíŒ±)Œª

+ (1 ‚àíŒ≥ )[ Œ±ŒΩ + (1 ‚àíŒ±)Œª ]
= Œ±

Œ≤Œ≥œÅ + (1 ‚àíŒ≤Œ≥ )ŒΩ

+ (1 ‚àíŒ±)Œª
‚âªŒ±¬µ + (1 ‚àíŒ±)Œª,

2.2 Von Neumann‚ÄìMorgenstern representation
55
where we have used (2.8) for Œ≤ replaced by Œ≤Œ≥ in the last step. This is a contradiction.
The second possibility in (2.7) is excluded by an analogous argument.
Proof of Theorem 2.21. For the construction of U, we Ô¨Årst Ô¨Åx two lotteries Œª and œÅ
with Œª ‚âªœÅ and deÔ¨Åne
M(Œª, œÅ) := { ¬µ ‚ààM | Œª ‚™∞¬µ ‚™∞œÅ };
the assertion is trivial if no such pair Œª ‚âªœÅ exists. If ¬µ ‚ààM(Œª, œÅ), part (b) of
Lemma 2.24 yields a unique Œ± ‚àà[0, 1] such that ¬µ ‚àºŒ±Œª + (1 ‚àíŒ±)œÅ, and we put
U(¬µ) := Œ±. To prove that U is a numerical representation of ‚âªon M(Œª, œÅ), we must
show that for ŒΩ, ¬µ ‚ààM(Œª, œÅ) we have U(¬µ) > U(ŒΩ) if and only if ¬µ ‚âªŒΩ. To prove
sufÔ¨Åciency, we apply part (a) of Lemma 2.24 to conclude that
¬µ ‚àºU(¬µ)Œª +

1 ‚àíU(¬µ)

œÅ ‚âªU(ŒΩ)Œª +

1 ‚àíU(ŒΩ)

œÅ ‚àºŒΩ,
Hence ¬µ ‚âªŒΩ. Conversely, if ¬µ ‚âªŒΩ then the preceding arguments already imply that
we cannot have U(ŒΩ) > U(¬µ). Thus, it sufÔ¨Åces to rule out the case U(¬µ) = U(ŒΩ).
But if U(¬µ) = U(ŒΩ), then the deÔ¨Ånition of U yields ¬µ ‚àºŒΩ, which contradicts ¬µ ‚âªŒΩ.
We conclude that U is indeed a numerical representation of ‚âªrestricted to M(Œª, œÅ).
Let us now show that M(Œª, œÅ) is a convex set. Take ¬µ, ŒΩ ‚ààM(Œª, œÅ) and Œ± ‚àà[0, 1].
Then
Œª ‚™∞Œ±Œª + (1 ‚àíŒ±)ŒΩ ‚™∞Œ±¬µ + (1 ‚àíŒ±)ŒΩ,
using the independence axiom to handle the cases Œª ‚âªŒΩ and Œª ‚âª¬µ, and part (c)
of Lemma 2.24 for Œª ‚àºŒΩ and for Œª ‚àº¬µ. By the same argument it follows that
Œ±¬µ + (1 ‚àíŒ±)ŒΩ ‚™∞œÅ, which implies the convexity of the set M(Œª, œÅ).
Therefore, U(Œ±¬µ + (1 ‚àíŒ±)ŒΩ) is well deÔ¨Åned; we proceed to show that it equals
Œ±U(¬µ) + (1 ‚àíŒ±)U(ŒΩ). To this end, we apply part (c) of Lemma 2.24 twice:
Œ±¬µ + (1 ‚àíŒ±)ŒΩ ‚àºŒ±

U(¬µ)Œª +

1 ‚àíU(¬µ)

œÅ

+ (1 ‚àíŒ±)

U(ŒΩ)Œª +

1 ‚àíU(ŒΩ)

œÅ

=

Œ±U(¬µ) + (1 ‚àíŒ±)U(ŒΩ)

Œª +

1 ‚àíŒ±U(¬µ) ‚àí(1 ‚àíŒ±)U(ŒΩ)

œÅ.
The deÔ¨Ånition of U and the uniqueness in part (b) of Lemma 2.24 imply that
U(Œ±¬µ + (1 ‚àíŒ±)ŒΩ) = Œ±U(¬µ) + (1 ‚àíŒ±)U(ŒΩ).
So U is indeed an afÔ¨Åne numerical representation of ‚âªon M(Œª, œÅ).
In a further step, we now show that the afÔ¨Åne numerical representation U on
M(Œª, œÅ) is unique up to positive afÔ¨Åne transformations. So let 
U be another afÔ¨Åne
numerical representation of ‚âªon M(Œª, œÅ), and deÔ¨Åne
ÀÜU(¬µ) :=

U(¬µ) ‚àí
U(œÅ)

U(Œª) ‚àí
U(œÅ)
,
¬µ ‚ààM(Œª, œÅ).

56
2 Preferences
Then ÀÜU is a positive afÔ¨Åne transformation of 
U, and ÀÜU(œÅ) = 0 = U(œÅ) as well as
ÀÜU(Œª) = 1 = U(Œª). Hence, afÔ¨Ånity of ÀÜU and the deÔ¨Ånition of U imply
ÀÜU(¬µ) = ÀÜU

U(¬µ)Œª +

1 ‚àíU(¬µ)

œÅ

= U(¬µ) ÀÜU(Œª) +

1 ‚àíU(¬µ)
 ÀÜU(œÅ) = U(¬µ)
for all ¬µ ‚ààM(Œª, œÅ). Thus ÀÜU = U.
Finally, we have to show that U can be extended as a numerical representation
to the full space M. To this end, we Ô¨Årst take Œª, œÅ ‚ààM such that M(Œª, œÅ) ‚äÉ
M(Œª, œÅ). BytheargumentsintheÔ¨Årstpartofthisproof, thereexistsanafÔ¨Ånenumerical
representation 
U of ‚âªon M(Œª, œÅ), and we may assume that 
U(Œª) = 1 and 
U(œÅ) =
0; otherwise we apply a positive afÔ¨Åne transformation to 
U. By the previous step
of the proof, 
U coincides with U on M(Œª, œÅ), and so 
U is the unique consistent
extension of U. Since each lottery belongs to some set M(Œª, œÅ), the afÔ¨Åne numerical
representation U can be uniquely extended to all of M.
Remark 2.25. In the proof of the preceding theorem, we did not use the fact that the
elements of M are probability measures. All that was needed was convexity of the set
M, theArchimedean, and the independence axiom. Yet, even the concept of convexity
can be generalized by introducing the notion of a mixture space; see, e.g., [138], [84],
or [112].
‚ô¶
Let us now return to the problem of constructing a von Neumann‚ÄìMorgenstern
representation for preference relations on distributions. If M is the set of all probability
measures on a Ô¨Ånite set S, any afÔ¨Åne numerical representation is already of this form, as
we saw in the proof of Corollary 2.23. However, the situation becomes more involved
if we take an inÔ¨Ånite set S. In fact, the following examples show that in this case a
von Neumann‚ÄìMorgenstern representation may not exist.
Example 2.26. Let M be the set of probability measures ¬µ on S := {1, 2, . . . } for
which U(¬µ) := lim supk‚Üë‚àûk ¬µ(k) is Ô¨Ånite. Clearly, U is afÔ¨Åne and induces a prefer-
ence order on M which satisÔ¨Åes both the Archimedean and the independence axiom.
However, U obviously does not admit a von Neumann‚ÄìMorgenstern representation.
‚ô¶
Example 2.27. Let M be set the of all Borel probability measures on S = [0, 1], and
denote by Œª the Lebesgue measure on S. According to the Lebesgue decomposition
theorem, which is recalled in Theorem A.13, every ¬µ ‚ààM can be decomposed as
¬µ = ¬µs + ¬µa,
where ¬µs is singular with respect to Œª, and ¬µa is absolutely continuous. We deÔ¨Åne a
function U : M ‚Üí[0, 1] by
U(¬µ) :=

x¬µa(dx).

2.2 Von Neumann‚ÄìMorgenstern representation
57
It is easily seen that U is an afÔ¨Åne function on M. Hence, U induces a preference
order ‚âªon M which satisÔ¨Åes both the Archimedean and the independence axioms.
But ‚âªcannot have a von Neumann‚ÄìMorgenstern representation: Since U(Œ¥x) = 0
for all x, the only possible choice for u in (2.3) would be u ‚â°0. So the preference
relation would be trivial in the sense that ¬µ ‚àºŒª for all ¬µ ‚ààM, in contradiction for
instance to U(Œª) = 1
2 and U(Œ¥ 1
2 ) = 0.
‚ô¶
One way to obtain a von Neumann‚ÄìMorgenstern representation is to assume ad-
ditional continuity properties of ‚âª, where continuity is understood in the sense of
DeÔ¨Ånition 2.8. As we have already remarked, the Archimedean axiom holds automat-
ically if taking convex combinations is continuous for the topology on M. This is
indeed the case for the weak topology on the set M1(S, S) of all probability measures
on a separable metric space S, endowed with the œÉ-Ô¨Åeld S of Borel sets. The space S
will be Ô¨Åxed for the rest of this section, and we will simply write M1(S) = M1(S, S).
Theorem 2.28. Let M := M1(S) be the space of all probability measures on S
endowed with the weak topology, and let ‚âªbe a continuous preference order on M
satisfying the independence axiom. Then there exists a von Neumann‚ÄìMorgenstern
representation
U(¬µ) =

u(x) ¬µ(dx)
for which the function u : S ‚ÜíR is bounded and continuous. Moreover, U and u are
unique up to positive afÔ¨Åne transformations.
Proof. Let Ms denote the set of all simple probability distributions on S. Since
continuity of ‚âªimplies the Archimedean axiom, we deduce from Corollary 2.22 that
‚âªrestricted to Ms has a von Neumann‚ÄìMorgenstern representation.
Let us show that the function u in this representation is bounded. For instance, if
u is not bounded from above, then there are x0, x1, . . . ‚ààS such that u(x0) < u(x1)
and u(xn) > n. Now let
¬µn :=

1 ‚àí1
‚àön

Œ¥x0 + 1
‚àönŒ¥xn.
Clearly, ¬µn ‚ÜíŒ¥x0 weaklyasn ‚Üë‚àû. Thecontinuityof‚âªtogetherwiththeassumption
that Œ¥x1 ‚âªŒ¥x0 imply that Œ¥x1 ‚âª¬µn for all large n. However, U(¬µn) > ‚àön for all n,
in contradiction to Œ¥x1 ‚âª¬µn.
Suppose that the function u is not continuous. Then there exists some x ‚ààS and a
sequence (xn)n‚ààN ‚äÇS such that xn ‚Üíx but u(xn) Ã∏‚Üíu(x). By taking a subsequence
if necessary, we can assume that u(xn) converges to some number a Ã∏= u(x). Suppose
that u(x) ‚àía =: Œµ > 0. Then there exists some m such that |u(xn) ‚àía| < Œµ/3 for all
n ‚â•m. Let ¬µ := 1
2(Œ¥x + Œ¥xm). For all n ‚â•m
U(Œ¥x) = a + Œµ > a + 2Œµ
3 > 1
2

u(x) + u(xm)

= U(¬µ) > a + Œµ
3 > U(Œ¥xn).

58
2 Preferences
Therefore Œ¥x ‚âª¬µ ‚âªŒ¥xn, although Œ¥xn converges weakly to Œ¥x, in contradiction to the
continuity of ‚âª. The case u(x) < a is excluded in the same manner.
Let us Ô¨Ånally show that
U(¬µ) :=

u(x) ¬µ(dx)
for ¬µ ‚ààM
deÔ¨Ånes a numerical representation of ‚âªon all of M. Since u is bounded and con-
tinuous, U is continuous with respect to the weak topology on M. Moreover, Theo-
rem A.37 states that Ms is a dense subset of the connected metrizable space M. So
the proof is completed by an application of Lemma 2.16.
The scope of the preceding theorem is limited insofar as it involves only bounded
functions u. This will not be Ô¨Çexible enough for our purposes. In the next section,
for instance, we will consider risk-averse preferences which are deÔ¨Åned in terms of
concave functions u on the space S = R. Such a function cannot be bounded unless
it is constant. Thus, we must relax the conditions of the previous theorem. We will
present two approaches. In our Ô¨Årst approach, we Ô¨Åx some point x0 ‚ààS and denote by
Br(x0) the closed metric ball of radius r around x0. The space of boundedly supported
measures on S is given by
Mb(S) :=

r>0
M1

Br(x0)

=

¬µ ‚ààM1(S) | ¬µ

Br(x0)

= 1 for some r ‚â•0

.
Clearly, this deÔ¨Ånition does not depend on the particular choice of x0.
Corollary 2.29. Let ‚âªbe a preference order on Mb(S) whose restriction to each
space M1

Br(x0)

is continuous with respect to the weak topology. If ‚âªsatisÔ¨Åes the
independence axiom, then there exists a von Neumann‚ÄìMorgenstern representation
U(¬µ) =

u(x) ¬µ(dx)
with a continuous function u : S ‚ÜíR. Moreover, U and u are unique up to positive
afÔ¨Åne transformations.
Proof. Theorem 2.28 yields a von Neumann‚ÄìMorgenstern representation of the re-
striction of ‚âªto M1

Br(x0)

in terms of some continuous function ur : Br(x0) ‚ÜíR.
The uniqueness part of the theorem implies that the restriction of ur to some smaller
ball Br‚Ä≤(x0) must be a equal to ur‚Ä≤ up to a positive afÔ¨Åne transformation. Thus, it is
possible to Ô¨Ånd a unique continuous extension u : S ‚ÜíR of ur‚Ä≤ which deÔ¨Ånes a von
Neumann‚ÄìMorgenstern representation of ‚âªon each set M1

Br(x0)

.
Our second variant of Theorem 2.28 includes measures with unbounded support,
but we need stronger continuity assumptions. Let œà be a continuous function with

2.2 Von Neumann‚ÄìMorgenstern representation
59
values in [1, ‚àû) on the separable metric space S. We use œà as a gauge function and
deÔ¨Åne
Mœà
1 (S) :=
$
¬µ ‚ààM1(S)


œà(x) ¬µ(dx) < ‚àû
%
.
A suitable space of continuous test functions for measures in Mœà
1 (S) is provided by
Cœà(S) :=

f ‚ààC(S) | ‚àÉc : |f (x)| ‚â§c ¬∑ œà(x) for all x ‚ààS

.
These test functions can now be used to deÔ¨Åne a topology on Mœà
1 (S) in precisely
the same way one uses the set of bounded continuous function to deÔ¨Åne the weak
topology: A sequence (¬µn) in Mœà
1 (S) converges to some ¬µ ‚ààMœà
1 (S) if and only if

f d¬µn ‚àí‚Üí

f d¬µ
for all f ‚ààCœà(S).
To be rigorous, one should Ô¨Årst deÔ¨Åne a neighborhood base for the topology and
then check that this topology is metrizable, so that it sufÔ¨Åces indeed to consider the
convergence of sequences; the reader will Ô¨Ånd all necessary details in Appendix A.6.
We will call this topology the œà-weak topology on Mœà
1 (S). If we take the trivial
case œà ‚â°1, Cœà(S) consists of all bounded continuous functions, and we recover the
standard weak topology on M1
1(S) = M1(S). However, by taking œà as some non-
bounded function, we can also include von Neumann‚ÄìMorgenstern representations in
terms of unbounded functions u. The following theorem is a version of Theorem 2.28
for the œà-weak topology. Its proof is analogous to that of Theorem 2.28, and we leave
it to the reader to Ô¨Åll in the details.
Theorem 2.30. Let ‚âªbe a preference order on Mœà
1 (S) that is continuous in the œà-
weak topology and satisÔ¨Åes the independence axiom. Then there exists a numerical
representation U of von Neumann‚ÄìMorgenstern form
U(¬µ) =

u(x) ¬µ(dx)
with a function u ‚ààCœà(S). Moreover, U and u are unique up to positive afÔ¨Åne
transformations.
Remark 2.31. Instead of making topological assumptions on ‚âª, one can introduce,
in addition to the Archimedean and the independence axiom, the so-called sure-thing
principle: For ¬µ, ŒΩ ‚ààM and A ‚ààS such that ¬µ(A) = 1:
Œ¥x ‚âªŒΩ for all x ‚ààA
"‚áí
¬µ ‚âªŒΩ,
and
ŒΩ ‚âªŒ¥x for all x ‚ààA
"‚áí
ŒΩ ‚âª¬µ.
This axiom, together with a couple of technical assumptions, guarantees the existence
of a von Neumann‚ÄìMorgenstern representation; see [84]. Conversely, it is easy to

60
2 Preferences
see that the sure-thing principle is automatically implied by the existence of a von
Neumann‚ÄìMorgenstern representation. Note that the sure-thing principle is violated
in both Examples 2.26 and 2.27.
‚ô¶
So far, we have presented the classical theory of expected utility, starting with the
independence axiom and the Archimedean axiom. However, it is well known that in
reality people may not behave according to this paradigm.
Example 2.32 (Allais Paradox). The so-called Allais paradox questions the descrip-
tive aspect of expected utility by considering the following lotteries. Lottery
ŒΩ1 = 0.33 Œ¥2500 + 0.66 Œ¥2400 + 0.01 Œ¥0
yields 2500 ‚Ç¨ with a probability of 0.33, 2400 ‚Ç¨ with probability 0.66, and draws a
blank with the remaining probability of 0.01. Lottery
¬µ1 := Œ¥2400
yields 2400 ‚Ç¨ for sure. When asked, most people prefer the sure amount ‚Äì even though
lottery ŒΩ1 has the larger expected value, namely 2409 ‚Ç¨.
Next, consider the following two lotteries ¬µ2 and ŒΩ2:
¬µ2 := 0.34 Œ¥2400 + 0.66 Œ¥0
and
ŒΩ2 := 0.33 Œ¥2500 + 0.67 Œ¥0.
Here people tend to prefer the slightly riskier lottery ŒΩ2 over ¬µ2, in accordance with
the expectations of ŒΩ2 and ¬µ2, which are 825 ‚Ç¨ and 816 ‚Ç¨, respectively.
This observation is due to M. Allais [4]. It was conÔ¨Årmed by D. Kahnemann and
A. Tversky [123] in empirical tests where 82 % of interviewees preferred ¬µ1 over
ŒΩ1 while 83 % chose ŒΩ2 rather than ¬µ2. This means that at least 65 % chose both
¬µ1 ‚âªŒΩ1 and ŒΩ2 ‚âª¬µ2. As pointed out by M. Allais, this simultaneous choice leads
to a ‚Äúparadox‚Äù in the sense that it is inconsistent with the von Neumann‚ÄìMorgen-
stern paradigm. More precisely, any preference relation ‚âªfor which ¬µ1 ‚âªŒΩ1 and
ŒΩ2 ‚âª¬µ2 are both valid violates the independence axiom, as we will show now. If the
independence axiom were satisÔ¨Åed, then necessarily
Œ±¬µ1 + (1 ‚àíŒ±)ŒΩ2 ‚âªŒ±ŒΩ1 + (1 ‚àíŒ±)ŒΩ2 ‚âªŒ±ŒΩ1 + (1 ‚àíŒ±)¬µ2
for all Œ± ‚àà(0, 1). By taking Œ± = 1/2 we would arrive at
1
2(¬µ1 + ŒΩ2) ‚âª1
2(ŒΩ1 + ¬µ2)
which is a contradiction to the fact that
1
2(¬µ1 + ŒΩ2) = 1
2(ŒΩ1 + ¬µ2).
Therefore, the independence axiom was violated by at least 65 % of the people who
wereinterviewed. ThiseffectisempiricalevidenceagainstthevonNeumann‚ÄìMorgen-
stern theory as a descriptive theory. Even from a normative point of view, there are
good reasons to go beyond our present setting, and this will be done in Section 2.5.
In particular, we will take a second look at the Allais paradox in Remark 2.74.
‚ô¶

2.3 Expected utility
61
2.3 Expected utility
In this section, we focus on individual Ô¨Ånancial assets under the assumption that their
payoff distributions at a Ô¨Åxed time are known, and without any regard to hedging
opportunities in the context of a Ô¨Ånancial market model. Such asset distributions may
be viewed as lotteries with monetary outcomes in some interval S ‚äÇR. Thus, we
take M as a Ô¨Åxed set of Borel probability measures on S. In this setting, we discuss
the paradigm of expected utility in its standard form, where the function u appearing
in the von Neumann‚ÄìMorgenstern representation has additional properties suggested
by the monetary interpretation. We introduce risk aversion and certainty equivalents,
and illustrate these notions with a number of examples.
Throughout this section, we assume that M is convex and contains all point masses
Œ¥x for x ‚ààS. We assume also that each ¬µ ‚ààM has a well-deÔ¨Åned expectation
m(¬µ) :=

x ¬µ(dx) ‚ààR.
Remark 2.33. For an asset whose (discounted) random payoff has a known distri-
bution ¬µ, the expected value m(¬µ) is often called the fair price of the asset. For
an insurance contract where ¬µ is the distribution of payments to be received by the
insured party in dependence of some random damage within a given period, the ex-
pected value m(¬µ) is also called the fair premium. Typically, actual asset prices and
actual insurance premiums will be different from these values. In many situations,
such differences can be explained within the conceptual framework of expected utility,
and in particular in terms of risk aversion.
‚ô¶
DeÔ¨Ånition 2.34. A preference relation ‚âªon M is called monotone if
x > y implies Œ¥x ‚âªŒ¥y.
The preference relation is called risk averse if for ¬µ ‚ààM
Œ¥m(¬µ) ‚âª¬µ
unless ¬µ = Œ¥m(¬µ).
It is easy to characterize these properties within the class of preference relations
which admit a von Neumann‚ÄìMorgenstern representation.
Proposition 2.35. Suppose the preference relation ‚âªhas a von Neumann‚ÄìMorgen-
stern representation
U(¬µ) =

u d¬µ.
Then:
(a) ‚âªis monotone if and only if u is strictly increasing.
(b) ‚âªis risk averse if and only if u is strictly concave.

62
2 Preferences
Proof. (a): Monotonicity is equivalent to
u(x) = U(Œ¥x) > U(Œ¥y) = u(y)
for x > y.
(b): If ‚âªis risk-averse, then
Œ¥Œ±x+(1‚àíŒ±)y ‚âªŒ± Œ¥x + (1 ‚àíŒ±)Œ¥y
holds for all distinct x, y ‚ààS and Œ± ‚àà(0, 1). Hence,
u

Œ±x + (1 ‚àíŒ±)y

> Œ± u(x) + (1 ‚àíŒ±)u(y),
i.e., u is strictly concave. Conversely, if u is strictly concave, then Jensen‚Äôs inequality
implies risk aversion:
U(Œ¥m(¬µ)) = u
 
x ¬µ(dx)

‚â•

u(x) ¬µ(dx) = U(¬µ)
with equality if and only if ¬µ = Œ¥m(¬µ).
Remark 2.36. In view of the monetary interpretation of the state space S, it is natural
to assume that the preference relation ‚âªis monotone. The assumption of risk aversion
ismoredebatable, atleastfromadescriptivepointofview. Infact, thereisconsiderable
empirical evidence that agents tend to switch between risk aversion and risk seeking
behavior, depending on the context. In particular, they may be risk averse after prior
gains, and they may become risk seeking if they see an opportunity to compensate
prior losses. Tversky and Kahneman [194] propose to describe such a behavioral
pattern by a function u of the form
u(x) =

(x ‚àíc)Œ≥
for x ‚â•c,
‚àíŒª(c ‚àíx)Œ≥
for x < c,
where c is a given benchmark level, and their experiments suggest parameter values
Œª around 2 and Œ≥ slightly less than 1. Nevertheless, one can insist on risk aversion
from a normative point of view, and this is the approach we will take for the purposes
in this book.
‚ô¶
DeÔ¨Ånition 2.37. A function u : S ‚ÜíR is called a utility function if it is strictly
concave, strictly increasing, and continuous on S.
Any increasing concave function u : S ‚ÜíR is necessarily continuous on every
interval (a, b] ‚äÇS; see Proposition A.4. Hence, the condition of continuity in the
preceding deÔ¨Ånition is only relevant if S contains its lower boundary point. Note that
any utility function u(x) decreases at least linearly as x ‚Üìinf S. Therefore, u cannot
be bounded from below unless inf S > ‚àí‚àû.

2.3 Expected utility
63
From now on, we will consider a Ô¨Åxed preference relation ‚âªon M which admits
an expected utility representation, that is, a von Neumann‚ÄìMorgenstern representation
U(¬µ) =

u d¬µ
in terms of a utility function u : S ‚ÜíR. The intermediate value theorem applied
to the strictly increasing continuous function u yields for any ¬µ ‚ààM a unique real
number c(¬µ) for which
u

c(¬µ)

= U(¬µ) =

u d¬µ.
(2.9)
It follows that
Œ¥c(¬µ) ‚àº¬µ,
i.e., there is indifference between the lottery ¬µ and the sure amount of money c(¬µ).
DeÔ¨Ånition 2.38. The certainty equivalent of the lottery ¬µ ‚ààM is deÔ¨Åned as the
number c(¬µ) of (2.9), and
œÅ(¬µ) := m(¬µ) ‚àíc(¬µ)
is called the risk premium of ¬µ.
Risk aversion implies via Jensen‚Äôs inequality that c(¬µ) ‚â§m(¬µ), and
c(¬µ) < m(¬µ)
‚áê‚áí
¬µ Ã∏= Œ¥m(¬µ).
In particular, the risk premium œÅ(¬µ) is strictly positive as soon as the distribution ¬µ
carries any risk.
Remark 2.39. The certainty equivalent c(¬µ) can be viewed as an upper bound for
any price of ¬µ which would be acceptable to an economic agent with utility function
u. Thus, the fair price m(¬µ) must be reduced at least by the risk premium œÅ(¬µ) if
one wants the agent to buy the asset distribution ¬µ. Alternatively, suppose that the
agent holds an asset with distribution ¬µ. Then the risk premium may be viewed as the
amount that the agent would be ready to pay for replacing the asset by its expected
value m(¬µ).
‚ô¶
Example 2.40 (‚ÄúSt. Petersburg Paradox‚Äù). Consider the lottery
¬µ =
‚àû

n=1
2‚àínŒ¥2n‚àí1
which may be viewed as the payoff distribution of the following game. A fair coin
is tossed until a head appears. If the head appears on the nth toss, the payoff will
be 2n‚àí1 ‚Ç¨. Up to the early 18th century, it was commonly accepted that the price
of a lottery should be computed as the fair price, i.e., as the expected value m(¬µ).

64
2 Preferences
In the present example, the fair price is given by m(¬µ) = ‚àû, but it is hard to Ô¨Ånd
someone who is ready to pay even 20 ‚Ç¨. In view of this ‚Äúparadox‚Äù, posed by Nicholas
Bernoulli in 1713, Gabriel Cramer and Daniel Bernoulli [22] independently introduced
the idea of determining the actual price as a certainty equivalent with respect to a utility
function. For the two utility functions
u1(x) = ‚àöx
and
u2(x) = log x
proposed, respectively, by G. Cramer and by D. Bernoulli, these certainty equivalents
are given by
c1(¬µ) =

2 ‚àí
‚àö
2
‚àí2 ‚âà2.91
and
c2(¬µ) = 2,
and this is within the range of prices people are usually ready to pay. Note, however,
that for any utility function which is unbounded from above we could modify the
payoff in such a way that the paradox reappears. For example, we could replace
the payoff 2n by u‚àí1(2n) for n ‚â•1000, so that

u d¬µ = +‚àû. The choice of a
bounded utility function would remove this difÔ¨Åculty, but would create others; see the
discussion on pp. 69‚Äì72.
‚ô¶
Given the preference order ‚âªon M, we can now try to determine those distribu-
tions in M which are maximal with respect to ‚âª. As a Ô¨Årst illustration, consider the
following simple optimization problem. Let X be an integrable random variable on
some probability space (, F , P) with non-degenerate distribution ¬µ. We assume
that X is bounded from below by some number a in the interior of S. Which is the
best mix
XŒª := (1 ‚àíŒª)X + Œªc
of the risky payoff X and the certain amount c, that also belongs to the interior of S?
If we evaluate XŒª by its expected utility E[ u(XŒª) ] and denote by ¬µŒª the distribution
of XŒª under P, then we are looking for a maximum of the function f on [0, 1] deÔ¨Åned
by
f (Œª) := U(¬µŒª) =

u d¬µŒª.
Since f is strictly concave, it attains its maximum in a unique point Œª‚àó‚àà[0, 1].
Proposition 2.41.
(a) We have Œª‚àó= 1 if E[ X ] ‚â§c, and Œª‚àó> 0 if c ‚â•c(¬µ).
(b) If u is differentiable, then
Œª‚àó= 1
‚áê‚áí
E[ X ] ‚â§c
and
Œª‚àó= 0
‚áê‚áí
c ‚â§E[ Xu‚Ä≤(X) ]
E[ u‚Ä≤(X) ] .

2.3 Expected utility
65
Proof. (a): Jensen‚Äôs inequality yields that
f (Œª) ‚â§u

E[ XŒª ]

= u

(1 ‚àíŒª)E[ X ] + Œªc

,
with equality if and only if Œª = 1. It follows that Œª‚àó= 1 if the right-hand side is
increasing in Œª, i.e., if E[ X ] ‚â§c.
Strict concavity of u implies
f (Œª) ‚â•E

(1 ‚àíŒª)u(X) + Œªu(c)

= (1 ‚àíŒª)u

c(¬µ)

+ Œªu(c),
with equality if and only if Œª ‚àà{0, 1}. The right-hand side is increasing in Œª if
c ‚â•c(¬µ), and this implies Œª‚àó> 0.
(b): Clearly, we have Œª‚àó= 0 if and only if the right-hand derivative f ‚Ä≤
+ of f
satisÔ¨Åes f ‚Ä≤
+(0) ‚â§0; see Appendix A.1 for the deÔ¨Ånition of f ‚Ä≤
+ and f ‚Ä≤
‚àí. Note that the
difference quotients
u(XŒª) ‚àíu(X)
Œª
= u(XŒª) ‚àíu(X)
XŒª ‚àíX
¬∑ (c ‚àíX)
are P-a.s. bounded by
u‚Ä≤
+(a ‚àßc)|c ‚àíX| ‚ààL1(P )
and that they converge to
u‚Ä≤
+(X)(c ‚àíX)+ ‚àíu‚Ä≤
‚àí(X)(c ‚àíX)‚àí
as Œª ‚Üì0. By Lebesgue‚Äôs theorem, this implies
f ‚Ä≤
+(0) = E[ u‚Ä≤
+(X)(c ‚àíX)+ ] ‚àíE[ u‚Ä≤
‚àí(X)(c ‚àíX)‚àí].
If u is differentiable, or if the countable set { x | u‚Ä≤
+(x) Ã∏= u‚Ä≤
‚àí(x) } has ¬µ-measure 0,
then we can conclude
f ‚Ä≤
+(0) = E[ u‚Ä≤(X)(c ‚àíX) ],
i.e., f ‚Ä≤
+(0) ‚â§0 if and only if
c ‚â§E[ Xu‚Ä≤(X) ]
E[ u‚Ä≤(X) ] .
In the same way, we obtain
f ‚Ä≤
‚àí(1) = u‚Ä≤
‚àí(c)E[ (X ‚àíc)‚àí] ‚àíu‚Ä≤
+(c)E[ (X ‚àíc)+ ].
If u is differentiable at c, then we can conclude
f ‚Ä≤
‚àí(1) = u‚Ä≤(c)

c ‚àíE[ X ]

.
This implies f ‚Ä≤
‚àí(1) < 0, and hence Œª‚àó< 1, if and only if E[ X ] > c.

66
2 Preferences
Remark 2.42. Note that for a differentiable utility function u we have
m(¬µ) > c(¬µ) ‚â•E[ u‚Ä≤(X)X ]
E[ u‚Ä≤(X) ] .
(2.10)
Indeed, concavity of u ‚ààC1(R) implies
E[ u(X) ] + E[ u‚Ä≤(X)(c ‚àíX) ] ‚â•u(c),
hence E[ u‚Ä≤(X)(c ‚àíX) ] ‚â•0 for c = c(¬µ).
‚ô¶
Example 2.43 (Demand for a risky asset). Let S = S1 be a risky asset with price
œÄ = œÄ1. Given an initial wealth w, an agent with utility function u ‚ààC1 can invest a
fraction (1 ‚àíŒª)w into the asset and the remaining part Œªw into a risk-free bond with
interest rate r. The resulting payoff is
XŒª = (1 ‚àíŒª)w
œÄ
(S ‚àíœÄ) + Œªw ¬∑ r.
The preceding proposition implies that there will be no investment into the risky asset
if and only if
E

S
1 + r

‚â§œÄ.
In other words, the price of the risky asset must be below its expected discounted
payoff in order to attract any risk averse investor, and in that case it will indeed be
optimal for the investor to invest at least some amount. Instead of the simple linear
proÔ¨Åles XŒª, the investor may wish to consider alternative forms of investment. For
example, this may involve derivatives such as max(S, K) = K + (S ‚àíK)+ for some
threshold K. In order to discuss such non-linear payoff proÔ¨Åles, we need an extended
formulation of the optimization problem; see Section 3.3 below.
‚ô¶
Example 2.44 (Demand for insurance). Suppose an agent with utility function u ‚àà
C1 considers taking at least some partial insurance against a random loss Y, with
0 ‚â§Y ‚â§w and P [ Y Ã∏= E[ Y ] ] > 0, where w is a given initial wealth. If insurance
of ŒªY is available at the insurance premium ŒªœÄ, the resulting Ô¨Ånal payoff is given by
XŒª := w ‚àíY + Œª(Y ‚àíœÄ) = (1 ‚àíŒª)(w ‚àíY) + Œª(w ‚àíœÄ).
By Proposition 2.41, full insurance is optimal if and only if œÄ ‚â§E[ Y ]. In reality,
however, the insurance premium œÄ will exceed the ‚Äúfair premium‚Äù E[ Y ]. In this
case, it will be optimal to insure only a fraction Œª‚àóY of the loss, with Œª‚àó‚àà[0, 1). This
fraction will be strictly positive as long as
œÄ < E[ Yu‚Ä≤(w ‚àíY) ]
E[ u‚Ä≤(w ‚àíY) ] = w ‚àíE[ (w ‚àíY)u‚Ä≤(w ‚àíY) ]
E[ u‚Ä≤(w ‚àíY) ]
.

2.3 Expected utility
67
Since the right-hand side is strictly larger than E[ Y ] due to (2.10), risk aversion
may create a demand for insurance even if the insurance premium œÄ lies above the
‚Äúfair‚Äù price E[ Y ]. As in the previous example, the agent may wish to consider
alternative forms of insurance such as a stop-loss contract whose payoff has the non-
linear structure (Y ‚àíK)+ of a call option.
‚ô¶
LetustakeanotherlookattheriskpremiumœÅ(¬µ)ofalottery¬µ. Foranapproximate
calculation, we consider the Taylor expansion of a sufÔ¨Åciently smooth utility function
u(x) at x = c(¬µ) around m := m(¬µ), and we assume that ¬µ has Ô¨Ånite variance var(¬µ).
On the one hand,
u

c(¬µ)

‚âàu(m) + u‚Ä≤(m)(c(¬µ) ‚àím) = u(m) ‚àíu‚Ä≤(m)œÅ(¬µ).
On the other hand,
u

c(¬µ)

=

u(x) ¬µ(dx)
=
 
u(m) + u‚Ä≤(m)(x ‚àím) + 1
2u‚Ä≤‚Ä≤(m)(x ‚àím)2 + r(x)

¬µ(dx)
‚âàu(m) + 1
2u‚Ä≤‚Ä≤(m) var(¬µ),
where r(x) denotes the remainder term in the Taylor expansion of u. It follows that
œÅ(¬µ) ‚âà‚àíu‚Ä≤‚Ä≤(m)
2 ¬∑ u‚Ä≤(m) var(¬µ) =: 1
2 Œ±(m) var(¬µ).
(2.11)
Thus, Œ±(m(¬µ)) is the factor by which an economic agent with utility function u weighs
the risk, measured by 1
2 var(¬µ), in order to determine the risk premium he or she is
ready to pay.
DeÔ¨Ånition 2.45. Suppose that u is a twice continuously differentiable utility function
on S. Then
Œ±(x) := ‚àíu‚Ä≤‚Ä≤(x)
u‚Ä≤(x)
is called the Arrow‚ÄìPratt coefÔ¨Åcient of absolute risk aversion of u at level x.
Example 2.46. The following classes of utility functions u and their corresponding
coefÔ¨Åcients of risk aversion are standard examples.
(a) Constant absolute risk aversion (CARA): Œ±(x) equals some constant Œ± > 0.
Since Œ±(x) = ‚àí(log u‚Ä≤)‚Ä≤(x), it follows that u(x) = a‚àíb¬∑e‚àíŒ±x. Using an afÔ¨Åne
transformation, u can be normalized to
u(x) = 1 ‚àíe‚àíŒ±x.

68
2 Preferences
(b) Hyperbolic absolute risk aversion (HARA): Œ±(x) = (1‚àíŒ≥ )/x on S = (0, ‚àû)
for some Œ≥ < 1. Up to afÔ¨Åne transformations, we have
u(x) = log x
for Œ≥ = 0,
u(x) = 1
Œ≥ xŒ≥
for Œ≥ Ã∏= 0.
Sometimes, these functions are also called CRRA utility functions, because their
‚Äúrelative risk aversion" xŒ±(x) is constant. Of course, these utility functions can
be shifted to any interval S = (a, ‚àû). The ‚Äúrisk-neutral‚Äù case Œ≥ = 1 would
correspond to an afÔ¨Åne utility function u.
‚ô¶
Proposition 2.47. Suppose that u andu are two utility functions on S which are twice
continuously differentiable, and that Œ± and Œ± are the corresponding Arrow‚ÄìPratt
coefÔ¨Åcients of absolute risk aversion. Then the following conditions are equivalent.
(a) Œ±(x) ‚â•Œ±(x) for all x ‚ààS.
(b) u = F ‚ó¶u for a strictly increasing concave function F.
(c) The respective risk premiums œÅ and œÅ associated with u and u satisfy œÅ(¬µ) ‚â•
œÅ(¬µ) for all ¬µ ‚ààM.
Proof. (a) ‚áí(b): Since u is strictly increasing, we may deÔ¨Åne its inverse function,
w. Then F(t) := u

w(t)

is clearly increasing, twice differentiable, and satisÔ¨Åes
u = F ‚ó¶u. For showing that F is concave and strictly increasing we calculate the Ô¨Årst
two derivatives of w:
w‚Ä≤ =
1
u‚Ä≤(w),
w‚Ä≤‚Ä≤ = Œ±(w) ¬∑
1
u‚Ä≤(w)2 .
Now we can calculate the Ô¨Årst two derivatives of F:
F ‚Ä≤ = u‚Ä≤(w) ¬∑ w‚Ä≤ = u‚Ä≤(w)
u‚Ä≤(w) > 0
and
F ‚Ä≤‚Ä≤ = u‚Ä≤‚Ä≤(w)(w‚Ä≤)2 + u‚Ä≤(w)w‚Ä≤‚Ä≤
= u‚Ä≤(w)
u‚Ä≤(w)2

Œ±(w) ‚àíŒ±(w)

(2.12)
‚â§0.
This proves that F is concave and strictly increasing.
(b) ‚áí(c): Jensen‚Äôs inequality implies that the respective certainty equivalents c(¬µ)
and c(¬µ) satisfy
u(c(¬µ)) =

u d¬µ =

F ‚ó¶u d¬µ
(2.13)
‚â§F
 
u d¬µ

= F
u
c(¬µ)

= u(c(¬µ)).

2.3 Expected utility
69
Hence, œÅ(¬µ) = m(¬µ) ‚àíc(¬µ) ‚â•m(¬µ) ‚àíc(¬µ) = œÅ(¬µ).
(c) ‚áí(a): If condition (a) is false, there exists an open interval O ‚äÇS such that
Œ±(x) > Œ±(x) for all x ‚ààO. Let 
O := u(O), and denote again by w the inverse
of u. Then the function F(t) = u

w(t)

will be strictly convex in the open interval

O by (2.12). Thus, if ¬µ is a measure with support in O, the inequality in (2.13) is
reversed and is even strict ‚Äì unless ¬µ is concentrated at a single point. It follows that
œÅ(¬µ) < œÅ(¬µ), which contradicts condition (c).
In view of the underlying axioms, the paradigm of expected utility has a certain
plausibility on a normative level, i.e., as a guideline of rational behavior in the face
of risk. But this guideline should be applied with care: If pushed too far, it may lead
to unplausible conclusions. In the remaining part of this section we discuss some
of these issues. From now on, we assume that S is unbounded from above, so that
w + x ‚ààS for any x ‚ààS and w ‚â•0. So far, we have implicitly assumed that the
preference relation ‚âªon lotteries reÔ¨Çects the views of an economic agent in a given set
of conditions, including a Ô¨Åxed level w ‚â•0 of the agent‚Äôs initial wealth. In particular,
the utility function may vary as the level of wealth changes, and so it should really
be indexed by w. Usually one assumes that uw is obtained by simply shifting a Ô¨Åxed
utility function u to the level w, i.e., uw(x) := u(w +x). Thus, a lottery ¬µ is declined
at a given level of wealth w if and only if

u(w + x) ¬µ(dx) < u(w).
Let us now return to the situation of Proposition 2.41 when ¬µ is the distribution of an
integrable random variable X on (, F , P), which is bounded from below by some
number a in the interior of S. We view X as the net payoff of some Ô¨Ånancial bet, and
we assume that the bet is favorable in the sense that
m(¬µ) = E[ X ] > 0.
Remark 2.48. Even though the favorable bet X might be declined at a given level
w due to risk aversion, it follows from Proposition 2.41 that it would be optimal to
accept the bet at some smaller scale, i.e., there is some Œ≥ ‚àó> 0 such that
E[ u(w + Œ≥ ‚àóX) ] > u(w).
On the other hand, it follows from Lemma 2.50 below that the given bet X becomes
acceptable at a sufÔ¨Åciently high level of wealth whenever the utility function is un-
bounded from above.
‚ô¶
Sometimes it is assumed that some favorable bet is declined at every level of
wealth. The assumption that such a bet exists is not as innocent as it may look. In fact
it has rather drastic consequences. In particular, we are going to see that it rules out
all utility functions in Example 2.46 except for the class of exponential utilities.

70
2 Preferences
Example 2.49. For any exponential utility function u(x) = 1 ‚àíe‚àíŒ±x with constant
risk aversion Œ± > 0, the induced preference order on lotteries does not at all depend
on the initial wealth w. To see this, note that

u(w + x) ¬µ(dx) <

u(w + x) ŒΩ(dx)
is equivalent to

e‚àíŒ±x ¬µ(dx) >

e‚àíŒ±x ŒΩ(dx).
‚ô¶
Let us now show that the rejection of some favorable bet ¬µ at every wealth level
w leads to a not quite plausible conclusion: At high levels of wealth, the agent would
reject a bet ŒΩ with huge potential gain even though the potential loss is just a negligible
fraction of the initial wealth.
Lemma 2.50. If the favorable bet ¬µ is rejected at any level of wealth, then the utility
function u is bounded from above, and there exists A > 0 such that the bet
ŒΩ := 1
2(Œ¥‚àíA + Œ¥‚àû)
is rejected at any level of wealth.
Proof. We have assumed that X is bounded from below, i.e., ¬µ is concentrated on
[a, ‚àû) for some a < 0, where a is in the interior of S. Moreover, we can choose
b > 0 such that
¬µ(B) := ¬µ

B ‚à©[a, b]

+ Œ¥b(B) ¬∑ ¬µ

(b, ‚àû)

is still favorable. Since u is increasing, we have

u(w + x) ¬µ(dx) ‚â§

u(w + x) ¬µ(dx) < u(w)
for any w ‚â•0, i.e., also the lottery ¬µ is rejected at any level of wealth. It follows that

[0,b]

u(w + x) ‚àíu(w)

¬µ(dx) <

[a,0)

u(w) ‚àíu(w + x)

¬µ(dx).
Let us assume for simplicity that u is differentiable; the general case requires only
minor modiÔ¨Åcations. Then the previous inequality implies
u‚Ä≤(w + b) m+(¬µ) < u‚Ä≤(w + a) m‚àí(¬µ),
where
m+(¬µ) :=

[0,b]
x ¬µ(dx) >

[a,0]
(‚àíx) ¬µ(dx) =: m‚àí(¬µ),

2.3 Expected utility
71
due to the fact that ¬µ is favorable. Thus,
u‚Ä≤(w + b)
u‚Ä≤(w ‚àí|a|) < m‚àí(¬µ)
m+(¬µ) =: Œ≥ < 1
for any w, hence
u‚Ä≤
x + n(|a| + b)

< Œ≥ nu‚Ä≤(x)
for any x in the interior of S.
This exponential decay of the derivative implies
u(‚àû) := limx‚Üë‚àûu(x) < ‚àû.
More precisely, if A := n(|a| + b) for some n,
then
u(‚àû) ‚àíu(x) =
‚àû

k=0
 x+(k+1)A
x+kA
u‚Ä≤(y) dy
=
‚àû

k=0
 x
x‚àíA
u‚Ä≤(z + (k + 1)A) dz
<
‚àû

k=0
Œ≥ (k+1)n
 x
x‚àíA
u‚Ä≤(z) dz
=
Œ≥ n
1 ‚àíŒ≥ n

u(x) ‚àíu(x ‚àíA)

.
Take n such that Œ≥ n ‚â§1/2. Then we obtain
u(‚àû) ‚àíu(x) < u(x) ‚àíu(x ‚àíA),
i.e.,
1
2

u(‚àû) + u(x ‚àíA)

< u(x)
for all x such that x ‚àíA ‚ààS.
Example 2.51. For an exponential utility function u(x) = 1‚àíe‚àíŒ±x, the bet ŒΩ deÔ¨Åned
in the preceding lemma is rejected at any level of wealth as soon as A > 1
Œ± log 2.
‚ô¶
Suppose now that the lottery ¬µ ‚ààM is played not only once but n times in a row.
For instance, one can think of an insurance company selling identical policies to a large
number of individual customers. More precisely, let (, F , P ) be a probability space
supporting a sequence X1, X2, . . . of independent random variables with common
distribution ¬µ. The value of Xi will be interpreted as the outcome of the ith drawing
of the lottery ¬µ. The accumulated payoff of n successive independent repetitions of
the Ô¨Ånancial bet X1 is given by
Zn :=
n

i=1
Xi,
and we assume that this accumulated payoff takes values in S; this is the case if, e.g.,
S = [0, ‚àû).

72
2 Preferences
Remark 2.52. It may happen that an agent refuses the single favorable bet X at
any level of wealth but feels tempted by a sufÔ¨Åciently large series X1, . . . , Xn of
independent repetitions of the same bet. It is true that, by the weak law of large
numbers, the probability
P [ Zn < 0 ] = P
 1
n
n

i=1
Xi < m(¬µ) ‚àíŒµ
!
(for Œµ := m(¬µ)) of incurring a cumulative loss at the end of the series converges to 0
as n ‚Üë‚àû. Nevertheless, the decision of accepting n repetitions is not consistent with
the decision to reject the single bet at any wealth level w. In fact, for Wk := w + Zk
we obtain
E[ u(Wn) ] = E

E[ u(Wn‚àí1 + Xn) | X1, . . . , Xn‚àí1 ]

= E
 
u(Wn‚àí1 + x) ¬µ(dx)

< E[ u(Wn‚àí1) ] < ¬∑ ¬∑ ¬∑ < u(w),
i.e., the bet described by Zn should be rejected as well.
‚ô¶
Let us denote by ¬µn the distribution of the accumulated payoff Zn. The lottery ¬µn
has the mean m(¬µn) = n¬∑m(¬µ), the certainty equivalent c(¬µn), and the associated risk
premium œÅ(¬µn) = n ¬∑ m(¬µ) ‚àíc(¬µn). We are interested in the asymptotic behavior of
these quantities for large n. Kolmogorov‚Äôs law of large numbers states that the average
outcome 1
nZn converges P -a.s. to the constant m(¬µ). Therefore, one might guess that
a similar averaging effect occurs on the level of the relative certainty equivalents
cn := c(¬µn)
n
and of the relative risk premiums
œÅn := œÅ(¬µn)
n
= m(¬µ) ‚àícn.
Does cn converge to m(¬µ), and is there a successive reduction of the relative risk
premiums œÅn as n grows to inÔ¨Ånity? Applying our heuristic (2.11) to the present
situation yields
œÅn ‚âà1
2n Œ±

m(¬µn)

var(¬µn) = 1
2 Œ±

n ¬∑ m(¬µ)

var(¬µ).
Thus, one should expect that œÅn tends to zero only if the Arrow‚ÄìPratt coefÔ¨Åcient Œ±(x)
becomes arbitrarily small as x becomes large, i.e., if the utility function is decreasingly
risk averse. This guess is conÔ¨Årmed by the following two examples.

2.3 Expected utility
73
Example 2.53. Suppose that u(x) = 1 ‚àíe‚àíŒ±x is a CARA utility function with con-
stant risk aversion Œ± > 0 and assume that ¬µ is such that

e‚àíŒ±x ¬µ(dx) < ‚àû. Then,
with the notation introduced above,

e‚àíŒ±x ¬µn(dx) = E
 
n

i=1
e‚àíŒ±Xi
!
=
 
e‚àíŒ±x ¬µ(dx)
n
.
Hence, the certainty equivalent of ¬µn is given by
c(¬µn) = ‚àín
Œ± log

e‚àíŒ±x ¬µ(dx) = n ¬∑ c(¬µ).
It follows that cn and œÅn are independent of n. In particular, the relative risk premiums
are not reduced if the lottery is drawn more than once.
‚ô¶
The second example displays a different behavior. It shows that for HARA utility
functions the relative risk premiums will indeed decrease to 0. In particular, the lottery
¬µn will become attractive for large enough n as soon as the price of the single lottery
¬µ is less than m(¬µ).
Example 2.54. Suppose that ¬µ is a non-degenerate lottery concentrated on (0, ‚àû),
and that u is a HARA utility function of index Œ≥ ‚àà[0, 1). If Œ≥ > 0 then u(x) = 1
Œ≥ xŒ≥
and c(¬µn) = E[(Zn)Œ≥ ]1/Œ≥ , hence
cn = c(¬µn)
n
= E
 1
nZn
Œ≥ 1/Œ≥
< m(¬µ).
If Œ≥ = 0 then u(x) = log x, and the relative certainty equivalent satisÔ¨Åes
log cn = log c(¬µn) ‚àílog n = E

log
1
nZn
 
.
Thus, we have
u(cn) = E

u
1
nZn
 
for any Œ≥ ‚àà[0, 1). By symmetry,
1
n + 1Zn+1 = E[ Xk | Zn+1 ]
for k = 1, . . . , n + 1;
see part II of ¬ß20 in [19]. It follows that
1
n + 1Zn+1 = E
 1
nZn
 Zn+1

.
(2.14)

74
2 Preferences
Since u is strictly concave and since ¬µ is non-degenerate, we get
u(cn+1) = E

u

E
 1
nZn
 Zn+1
 
> E

E

u
1
nZn
  Zn+1
 
= u(cn),
i.e., the relative certainty equivalents are strictly increasing and the relative risk pre-
miums œÅn are strictly decreasing. By Kolmogorov‚Äôs law of large numbers,
1
nZn ‚àí‚Üím(¬µ)
P-a.s.
(2.15)
Thus, by Fatou‚Äôs lemma (we assume for simplicity that ¬µ is concentrated on [Œµ, ‚àû)
for some Œµ > 0 if Œ≥ = 0),
lim inf
n‚Üë‚àûu(cn) ‚â•E

lim inf
n‚Üë‚àûu
1
nZn
 
= u

m(¬µ)

,
hence
lim
n‚Üë‚àûcn = m(¬µ)
and
lim
n‚Üë‚àûœÅn = 0.
Suppose that the price of ¬µ is given by œÄ ‚àà

c(¬µ), m(¬µ)

. At initial wealth w = 0,
the agent would decline a single bet. But, in contrast to the situation in Remark 2.52, a
series of n repetitions of the same bet would now become attractive for large enough n,
since c(¬µn) = ncn > nœÄ for
n ‚â•n0 := min{ k ‚ààN | ck > œÄ } < ‚àû.
‚ô¶
Remark 2.55. The identity (2.14) can also be written as
1
n + 1Zn+1 = E
1
nZn
 An+1

= E[ X1 | An+1 ]
where An+1 = œÉ(Zn+1, Zn+2, . . . ). This means that the stochastic process 1
nZn,
n = 1, 2 . . . , is a reverse martingale. In particular, Kolmogorov‚Äôs law of large num-
bers (2.15) can be regarded as a special case of the convergence theorem for reverse
martingales; see part II of ¬ß20 in [19].
‚ô¶
2.4 Uniform preferences
So far, we have considered preference relations on distributions deÔ¨Åned in terms of
a Ô¨Åxed utility function u. In this section, we focus on the question whether one

2.4 Uniform preferences
75
distribution is preferred over another, regardless of the choice of a particular utility
function.
For simplicity, we take S = R as the set of possible payoffs. Let M be the set of
all ¬µ ‚ààM1(R) with well-deÔ¨Åned and Ô¨Ånite expectation
m(¬µ) =

x ¬µ(dx).
Recall from DeÔ¨Ånition 2.37 that a utility function on R is a strictly concave and strictly
increasing function u : R ‚ÜíR. Since each concave function u is dominated by an
afÔ¨Åne function, the existence of m(¬µ) implies the existence of the integral

u d¬µ as
an extended real number in [‚àí‚àû, ‚àû).
DeÔ¨Ånition 2.56. Let ŒΩ and ¬µ be lotteries in M. We say that the lottery ¬µ is uniformly
preferred over ŒΩ and we write
¬µ ‚âΩuni ŒΩ
if

u d¬µ ‚â•

u dŒΩ
for all utility functions u.
Thus, ¬µ ‚âΩuni ŒΩ holds if and only if every risk-averse agent will prefer ¬µ over ŒΩ,
regardless of which utility function the agent is actually using. In this sense, ¬µ ‚âΩuni ŒΩ
expresses a uniform preference for ¬µ over ŒΩ. Sometimes, ‚âΩuni is also called second
order stochastic dominance; the notion of Ô¨Årst order stochastic dominance will be
introduced in DeÔ¨Ånition 2.69.
Remark 2.57. The binary relation ‚âΩuni is a partial order on M, i.e., ‚âΩuni satisÔ¨Åes the
following three properties:
‚Ä¢ ReÔ¨Çexivity: ¬µ ‚âΩuni ¬µ for all ¬µ ‚ààM.
‚Ä¢ Transitivity: ¬µ ‚âΩuni ŒΩ and ŒΩ ‚âΩuni Œª imply ¬µ ‚âΩuni Œª.
‚Ä¢ Antisymmetry: ¬µ ‚âΩuni ŒΩ and ŒΩ ‚âΩuni ¬µ imply ¬µ = ŒΩ.
The Ô¨Årst two properties are obvious, the third is derived in Remark 2.59. Moreover,
‚âΩuni is monotone and risk-averse in the sense that
Œ¥y ‚âΩuni Œ¥x for y ‚â•x,
and
Œ¥m(¬µ) ‚âΩuni ¬µ for all ¬µ ‚ààM.
Note, however, that ‚âΩuni is not a weak preference relation in the sense of DeÔ¨Ånition 2.2,
since it is not complete, see Remark 2.3.
‚ô¶
In the following theorem, we will give a number of equivalent formulations of the
statement ¬µ ‚âΩuni ŒΩ. One of them needs the notion of a stochastic kernel on R. This is
a mapping
Q : R ‚àí‚ÜíM1(R)
such that x ‚ÜíQ(x, A) is measurable for each Ô¨Åxed Borel set A ‚äÇR. See Ap-
pendix A.3 for the notion of a quantile function, which will be used in condition (e).

76
2 Preferences
Theorem 2.58. For any pair ¬µ, ŒΩ ‚ààM the following conditions are equivalent.
(a) ¬µ ‚âΩuni ŒΩ.
(b)

f d¬µ ‚â•

f dŒΩ for all increasing concave functions f .
(c) For all c ‚ààR

(c ‚àíx)+ ¬µ(dx) ‚â§

(c ‚àíx)+ ŒΩ(dx).
(d) If F¬µ and FŒΩ denote the distribution functions of ¬µ and ŒΩ, then
 c
‚àí‚àû
F¬µ(x) dx ‚â§
 c
‚àí‚àû
FŒΩ(x) dx
for all c ‚ààR.
(e) If q¬µ and qŒΩ are quantile functions for ¬µ and ŒΩ, then
 t
0
q¬µ(s) ds ‚â•
 t
0
qŒΩ(s) ds
for 0 < t ‚â§1.
(f) There exists a probability space (, F , P ) with random variables X¬µ and XŒΩ
having respective distributions ¬µ and ŒΩ such that
E[ XŒΩ | X¬µ ] ‚â§X¬µ
P -a.s.
(g) There exists a stochastic kernel Q(x, dy) on R such that Q(x, ¬∑) ‚ààM and
m(Q(x, ¬∑)) ‚â§x for all x and such that ŒΩ = ¬µQ, where ¬µQ denotes the
measure
¬µQ(A) :=

Q(x, A) ¬µ(dx)
for Borel sets A ‚äÇR.
Below we will show the following implications between the conditions of the
theorem:
(e) ‚áê‚áí(d) ‚áê‚áí(c) ‚áê‚áí(b) ‚áê‚áí(a) ‚áê" (g) ‚áê" (f).
(2.16)
The difÔ¨Åcult part is the proof that (b) implies (f). It will be deferred to Section 2.6,
where we will prove a multidimensional variant of this result; cf. Theorem 2.93.
Proof of (2.16). (e)‚áî(d): This follows from Lemma A.22.
(d)‚áî(c): By Fubini‚Äôs theorem,
 c
‚àí‚àû
F¬µ(y) dy =
 c
‚àí‚àû

(‚àí‚àû,y]
¬µ(dz) dy
=
 
I{z‚â§y‚â§c} dy ¬µ(dz)
=

(c ‚àíz)+ ¬µ(dz).

2.4 Uniform preferences
77
(c)‚áî(b): Condition (b) implies (c) because f (x) := ‚àí(c ‚àíx)+ is concave and
increasing. In order to prove the converse assertion, we take an increasing concave
function f and let h := ‚àíf . Then h is convex and decreasing, and its increasing right-
hand derivative h‚Ä≤ := h‚Ä≤
+ can be regarded as a ‚Äúdistribution function‚Äù of a non-negative
Radon measure Œ≥ on R,
h‚Ä≤(b) = h‚Ä≤(a) + Œ≥

(a, b]

for a < b;
see Appendix A.1. As in (1.11):
h(x) = h(b) ‚àíh‚Ä≤(b) (b ‚àíx) +

(‚àí‚àû,b]
(z ‚àíx)+ Œ≥ (dz)
for x < b.
Using h‚Ä≤(b) ‚â§0, Fubini‚Äôs theorem, and condition (c), we obtain that

(‚àí‚àû,b]
h d¬µ = h(b) ‚àíh‚Ä≤(b)

(b ‚àíx)+ ¬µ(dx) +

(‚àí‚àû,b]

(z ‚àíx)+ ¬µ(dx) Œ≥ (dz)
‚â§h(b) ‚àíh‚Ä≤(b)

(b ‚àíx)+ ŒΩ(dx) +

(‚àí‚àû,b]

(z ‚àíx)+ ŒΩ(dx) Œ≥ (dz)
=

(‚àí‚àû,b]
h dŒΩ.
Taking b ‚Üë‚àûyields

f d¬µ ‚â•

f dŒΩ.
(a)‚áî(b): That (b) implies (a) is obvious. For the proof of the converse implication,
choose any utility function u0 for which both

u0 d¬µ and

u0 dŒΩ are Ô¨Ånite. For
instance, one can take
u0(x) :=

x ‚àíex/2 + 1
if x ‚â§0,
‚àöx + 1 ‚àí1
if x ‚â•0.
Then, for f concave and increasing and for Œ± ‚àà[0, 1),
uŒ±(x) := Œ±f (x) + (1 ‚àíŒ±)u0(x)
is a utility function. Hence,

f d¬µ = lim
Œ±‚Üë1

uŒ± d¬µ ‚â•lim
Œ±‚Üë1

uŒ± dŒΩ =

f dŒΩ.
(f) ‚áí(g): By considering the joint distribution of X¬µ and XŒΩ, we may reduce our
setting to the situation in which  = R2 and where X¬µ and XŒΩ are the respective
projections on the Ô¨Årst and second coordinates, i.e., for œâ = (x, y) ‚àà = R2 we
have X¬µ(œâ) = x and XŒΩ(œâ) = y. Let Q(x, dy) be a regular conditional distribution
of XŒΩ given X¬µ, i.e., a stochastic kernel on R such that
P [ XŒΩ ‚ààA | X¬µ ](œâ) = Q(X¬µ(œâ), A)

78
2 Preferences
for all Borel sets A ‚äÜR and for P -a.e. œâ ‚àà (see, e.g., Theorem 44.3 of [19] for an
existence proof). Clearly, ŒΩ = ¬µQ. Condition (f) implies that
X¬µ(œâ) ‚â•E[ XŒΩ | X¬µ ](œâ) =

y Q(X¬µ(œâ), dy)
for P -a.e. œâ ‚àà.
Hence, Q satisÔ¨Åes

y Q(x, dy) ‚â§x
for ¬µ-a.e. x.
By modifying Q on a ¬µ-null set (e.g., by putting Q(x, ¬∑) := Œ¥x there), this inequality
can be achieved for all x ‚ààR.
(g) ‚áí(a): Let u be a utility function. Jensen‚Äôs inequality applied to the measure
Q(x, dy) implies

u(y) Q(x, dy) ‚â§u

m

Q(x, ¬∑)

‚â§u(x).
Hence,

u dŒΩ =
 
u(y) Q(x, dy) ¬µ(dx) ‚â§

u d¬µ,
completing the proof of the set of implications (2.16).
Remark 2.59. Let us note some consequences of the preceding theorem. First, taking
in condition (b) the increasing concave function f (x) = x yields
m(¬µ) ‚â•m(ŒΩ) if ¬µ ‚âΩuni ŒΩ,
i.e., the expectation m(¬∑) is increasing with respect to ‚âΩuni.
Next, suppose that ¬µ and ŒΩ are such that

(c ‚àíx)+ ¬µ(dx) =

(c ‚àíx)+ ŒΩ(dx)
for all c.
Then we have both ¬µ ‚âΩuni ŒΩ and ŒΩ ‚âΩuni ¬µ, and condition (d) of the theorem implies that
the respective distribution functions satisfy
 c
‚àí‚àû
F¬µ(x) dx =
 c
‚àí‚àû
FŒΩ(x) dx
for all c.
Differentiating with respect to c gives the identity ¬µ = ŒΩ, i.e., a measure ¬µ ‚ààM is
uniquely determined by the integrals

(c ‚àíx)+ ¬µ(dx) for all c ‚ààR. In particular,
‚âΩuni is antisymmetric.
‚ô¶
The following proposition characterizes the partial order ‚âΩuni considered on the
set of all normal distributions N(m, œÉ 2). Recall that the standard normal distribution
N(0, 1) is deÔ¨Åned by its density function
œï(x) =
1
‚àö
2œÄ
e‚àíx2/2,
x ‚ààR.

2.4 Uniform preferences
79
The corresponding distribution function is usually denoted
(x) =
 x
‚àí‚àû
œï(y) dy,
x ‚ààR.
More generally, the normal distribution N(m, œÉ 2) with mean m ‚ààR and variance
œÉ 2 > 0 is given by the density function
1
‚àö
2œÄœÉ 2 ¬∑ exp
	
‚àí(x ‚àím)2
2œÉ 2

,
x ‚ààR.
Proposition 2.60. For two normal distributions, we have N(m, œÉ 2) ‚âΩuni N(
m,œÉ 2) if
and only if both m ‚â•
m and œÉ 2 ‚â§œÉ 2 hold.
Proof. In order to prove necessity, note that N(m, œÉ 2) ‚âΩuni N(
m,œÉ 2) implies that
e‚àíŒ±m+Œ±2œÉ 2/2 =

e‚àíŒ±x N(m, œÉ 2)(dx) ‚â§

e‚àíŒ±x N(
m,œÉ 2)(dx) = e‚àíŒ±
m+Œ±2œÉ 2/2.
Hence, for Œ± > 0,
m ‚àí1
2 Œ±œÉ 2 ‚â•
m ‚àí1
2 Œ±œÉ 2,
which gives m ‚â•
m by letting Œ± ‚Üì0 and œÉ 2 ‚â§œÉ 2 for Œ± ‚Üë‚àû.
We show sufÔ¨Åciency Ô¨Årst in the case m = 
m = 0. Note that the distribution
function of N(0, œÉ 2) is given by (x/œÉ). Since œï‚Ä≤(x) = ‚àíxœï(x),
d
dœÉ
 c
‚àí‚àû

	 x
œÉ

dx =
 c
‚àí‚àû
œï
	 x
œÉ

¬∑ ‚àíx
œÉ 2 dx = œï
	 c
œÉ

> 0.
Note that interchanging differentiation and integration is justiÔ¨Åed by dominated con-
vergence. Thus, we have shown that œÉ ‚Üí
 c
‚àí‚àû(x/œÉ) dx is strictly increasing for
all c, and N(0, œÉ 2) ‚âΩuni N(0,œÉ 2) follows from part (d) of Theorem 2.58.
Now we turn to the case of arbitrary expectations m and 
m. Let u be a utility
function. Then

u dN(m, œÉ 2) =

u(m + x) N(0, œÉ 2)(dx) ‚â•

u(
m + x) N(0, œÉ 2)(dx),
because m ‚â•
m. Since x ‚Üíu(
m + x) is again a utility function, we obtain from the
preceding step of the proof that

u(
m + x) N(0, œÉ 2)(dx) ‚â•

u(
m + x) N(0,œÉ 2)(dx) =

u dN(
m,œÉ 2),
and N(m, œÉ 2) ‚âΩuni N(
m,œÉ 2) follows.

80
2 Preferences
Remark 2.61. Let us indicate an alternative proof for the sufÔ¨Åciency part of Proposi-
tion 2.60 that uses condition (g) instead of (d) in Theorem 2.58. To this end, we deÔ¨Åne
a stochastic kernel by Q(x, ¬∑) := N(x + 
m ‚àím, ÀÜœÉ 2), where ÀÜœÉ 2 := œÉ 2 ‚àíœÉ 2 > 0.
Then m(Q(x, ¬∑)) = x + 
m ‚àím ‚â§x and
N(m, œÉ 2) Q = N(m, œÉ 2) ‚àóN(
m ‚àím, ÀÜœÉ 2) = N(m + 
m ‚àím, œÉ 2 + ÀÜœÉ 2) = N(m,œÉ 2),
where ‚àódenotes convolution. Hence, N(m, œÉ 2) ‚âΩuni N(
m,œÉ 2) follows.
‚ô¶
The following corollary investigates the relation ¬µ ‚âΩuni ŒΩ for lotteries with the same
expectation. A multidimensional version of this result will be given in Corollary 2.94
below.
Corollary 2.62. For all ¬µ, ŒΩ ‚ààM the following conditions are equivalent.
(a) ¬µ ‚âΩuni ŒΩ and m(¬µ) = m(ŒΩ).
(b)

f d¬µ ‚â•

f dŒΩ for all (not necessarily increasing) concave functions f .
(c) m(¬µ) ‚â•m(ŒΩ) and

(x ‚àíc)+ ¬µ(dx) ‚â§

(x ‚àíc)+ ŒΩ(dx) for all c ‚ààR.
(d) There exists a probability space (, F , P ) with random variables X¬µ and XŒΩ
having respective distributions ¬µ and ŒΩ such that
E[ XŒΩ | X¬µ ] = X¬µ
P -a.s.
(e) There exists a ‚Äúmean-preserving spread‚Äù Q, i.e., a stochastic kernel on R such
that m(Q(x, ¬∑)) = x for all x ‚ààS, such that ŒΩ = ¬µQ.
Proof. (a) ‚áí(e): Condition (g) of Theorem 2.58 yields a stochastic kernel Q such
that ŒΩ = ¬µQ and m

Q(x, ¬∑)

‚â§x. Due to the assumption m(¬µ) = m(ŒΩ), Q must
satisfy m

Q(x, ¬∑)

= x at least for ¬µ-a.e. x. By modifying Q on the ¬µ-null set where
m

Q(x, ¬∑)

< x (e.g. by putting Q(x, ¬∑) := Œ¥x there), we obtain a kernel as needed
for condition (e).
(e) ‚áí(b): Since

f (y) Q(x, dy) ‚â§f

m

Q(x, ¬∑)

= f (x)
by Jensen‚Äôs inequality, we obtain

f dŒΩ =
 
f (y) Q(x, dy) ¬µ(dx) ‚â§

f d¬µ.
(b) ‚áí(c): Just take the concave functions f (x) = ‚àí(x ‚àíc)+, and f (x) = x.

2.4 Uniform preferences
81
(c) ‚áí(a): Note that

(x ‚àíc)+ ¬µ(dx) =

(c,‚àû)
x ¬µ(dx) ‚àíc + c ¬µ

(‚àí‚àû, c]

.
The existence of m(¬µ) implies that c ¬µ

(‚àí‚àû, c]

‚Üí0 as c ‚Üì‚àí‚àû. Hence, we
deduce from the second condition in (c) that m(¬µ) ‚â§m(ŒΩ), i.e., the two expectations
are in fact identical. Now we can apply the following ‚Äúput-call parity‚Äù (compare also
(1.10))

(c ‚àíx)+ ¬µ(dx) = c ‚àím(¬µ) +

(x ‚àíc)+ ¬µ(dx)
to see that our condition (c) implies the third condition of Theorem 2.58 and, thus,
¬µ ‚âΩuni ŒΩ.
(d)‚áî(a): Condition (d) implies both m(¬µ) = m(ŒΩ) and condition (f) of Theo-
rem 2.58, and this implies our condition (a). Conversely, assume that (a) holds. Then
Theorem 2.58 provides random variables X¬µ and XŒΩ having the respective distribu-
tions ¬µ and ŒΩ such that E[ XŒΩ | X¬µ ] ‚â§X¬µ. Since X¬µ and XŒΩ have the same mean,
this inequality must in fact be an almost-sure equality, and we obtain condition (d).
Let us denote by
var(¬µ) :=
 
x ‚àím(¬µ)
2 ¬µ(dx) =

x2 ¬µ(dx) ‚àím(¬µ)2 ‚àà[0, ‚àû]
the variance of a lottery ¬µ ‚ààM.
Remark 2.63. If ¬µ and ŒΩ are two lotteries in M such that m(¬µ) = m(ŒΩ) and ¬µ ‚âΩuni ŒΩ,
then var(¬µ) ‚â§var(ŒΩ). This follows immediately by taking the concave function
f (x) := ‚àíx2 in condition (b) of Corollary 2.62.
‚ô¶
In the Ô¨Ånancial context, comparisons of portfolios with known payoff distributions
often use a mean-variance approach based on the relation
¬µ ‚âΩŒΩ
: ‚áê‚áí
m(¬µ) ‚â•m(ŒΩ) and var(¬µ) ‚â§var(ŒΩ).
For normal distributions ¬µ and ŒΩ, we have seen that the relation ¬µ ‚âΩŒΩ is equivalent
to ¬µ ‚âΩuni ŒΩ. Beyond this special case, the equivalence typically fails as illustrated by
the following example and by Proposition 2.67 below.
Example 2.64. Let ¬µ be the uniform distribution on the interval [‚àí1, 1], so that
m(¬µ) = 0 and var(¬µ) = 1/3. For ŒΩ we take ŒΩ = pŒ¥‚àí1/2 +(1‚àíp)Œ¥2. With the choice
of p = 4/5 we obtain m(ŒΩ) = 0 and 1 = var(ŒΩ) > var(¬µ). However,
1
16 =
 	
‚àí1
2 ‚àíx

+
¬µ(dx) >
 	
‚àí1
2 ‚àíx

+
ŒΩ(dx) = 0,
so ¬µ ‚âΩuni ŒΩ does not hold.
‚ô¶

82
2 Preferences
Remark 2.65. Let ¬µ and ŒΩ be two lotteries in M. We will write ¬µ ‚âΩcon ŒΩ if

f d¬µ ‚â•

f dŒΩ
for all concave functions f on R.
(2.17)
Note that ¬µ ‚âΩcon ŒΩ implies that m(¬µ) = m(ŒΩ), because both f (x) = x and 
f (x) = ‚àíx
are concave. Corollary 2.62 shows that ‚âΩcon coincides with our uniform partial order
‚âΩuni if we compare two measures which have the same mean. The partial order ‚âΩcon
is sometimes called concave stochastic order. It was proposed in [170] and [171] to
express the view that ¬µ is less risky than ŒΩ. The inverse relation ¬µ ‚âΩbal ŒΩ deÔ¨Åned by

f d¬µ ‚â•

f dŒΩ
for all convex functions f on R
(2.18)
is sometimes called balayage order or convex stochastic order.
‚ô¶
The following class of asset distributions is widely used in Finance.
DeÔ¨Ånition 2.66. Areal-valuedrandomvariableY onsomeprobabilityspace(,F ,P )
is called log-normally distributed with parameters Œ± ‚ààR and œÉ ‚â•0 if it can be written
as
Y = exp(Œ± + œÉX),
(2.19)
where X has a standard normal law N(0, 1).
Clearly, any log-normally distributed random variable Y on (, F , P ) takes
P-a.s. strictly positive values. Recall from above the standard notations œï and 
for the density and the distribution function of the standard normal law N(0, 1). We
obtain from (2.19) the distribution function
P [ Y ‚â§y ] = 
log y ‚àíŒ±
œÉ

,
0 < y < ‚àû,
and the density
œà(y) =
1
œÉ ¬∑ y œï
log y ‚àíŒ±
œÉ

¬∑ I(0,‚àû)(y)
(2.20)
of the log-normally distributed random variable Y. Its pth moment is given by the
formula
E[ Y p ] = exp
	
pŒ± + 1
2 p2œÉ 2
.
In particular, the law ¬µ of Y has the expectation
m(¬µ) = E[ Y ] = exp
	
Œ± + 1
2 œÉ 2
and the variance
var(¬µ) = exp

2Œ± + œÉ 2
exp(œÉ 2) ‚àí1

.

2.4 Uniform preferences
83
Proposition 2.67. Let ¬µ and ¬µ be two log-normal distributions with parameters
(Œ±, œÉ) and (Œ±,œÉ), respectively. Then ¬µ ‚âΩuni ¬µ holds if and only if œÉ 2 ‚â§œÉ 2 and
Œ± + 1
2œÉ 2 ‚â•Œ± + 1
2œÉ 2.
Proof. First suppose that œÉ 2 ‚â§œÉ 2 and m(¬µ) ‚â•m(¬µ). We deÔ¨Åne a kernel Q(x, ¬∑)
as the law of x ¬∑ exp(Œª + Œ≤Z) where Z is a standard normal random variable. Now
suppose that ¬µ is represented by (2.19) with X independent of Z, and let f denote a
bounded measurable function. It follows that

f d(¬µQ) = E

f

eŒ±+œÉX ¬∑ eŒª+Œ≤Z 
= E

f

eŒ±+Œª+(œÉ 2+Œ≤2)1/2 U
,
where
U = œÉX + Œ≤Z
&
œÉ 2 + Œ≤2
is also N(0, 1)-distributed. Thus, ¬µQ is a log-normal distribution with parameters
(Œ± + Œª,
&
œÉ 2 + Œ≤2 ). By taking Œ≤ :=
‚àö
œÉ 2 ‚àíœÉ 2 and Œª := Œ± ‚àíŒ±, we can represent ¬µ
as ¬µ = ¬µQ. With this parameter choice,
Œª = Œ± ‚àíŒ± = log m( ¬µ) ‚àílog m(¬µ) ‚àí1
2(œÉ 2 ‚àíœÉ 2 ) ‚â§‚àíŒ≤2
2 .
We have thus m(Q(x, ¬∑)) ‚â§x for all x, and so ¬µ ‚âΩuni ¬µ follows from condition (g) of
Theorem 2.58.
As to the converse implication, the inequality m(¬µ) ‚â•m(¬µ) is already clear. To
prove œÉ 2 ‚â§œÉ 2, let ŒΩ := ¬µ ‚ó¶log‚àí1 and ŒΩ := ¬µ ‚ó¶log‚àí1 so that ŒΩ = N(Œ±, œÉ 2)
and ŒΩ = N(Œ±,œÉ 2). For Œµ > 0 we deÔ¨Åne the concave increasing function fŒµ(x) :=
log(Œµ +x). If u is a concave increasing function on R, the function u‚ó¶fŒµ is a concave
and increasing function on [0, ‚àû), which can be extended to a concave increasing
function vŒµ on the full real line. Therefore,

u dŒΩ = lim
Œµ‚Üì0

vŒµ d¬µ ‚â•lim
Œµ‚Üì0

vŒµ d¬µ =

u dŒΩ.
(2.21)
Consequently, ŒΩ ‚âΩuni ŒΩ and Proposition 2.60 yields œÉ 2 ‚â§œÉ 2.
Remark 2.68. The inequality (2.21) shows that if ŒΩ = N(Œ±, œÉ 2), ŒΩ = N(Œ±,œÉ 2) and
¬µ and ¬µ denote the images of ŒΩ and ŒΩ under the map x ‚Üíex, then ¬µ ‚âΩuni ¬µ implies
ŒΩ ‚âΩuni ŒΩ. However, the converse implication ‚Äú ŒΩ ‚âΩuni ŒΩ ‚áí¬µ ‚âΩuni ¬µ ‚Äù fails, as can be
seen by increasing œÉ until m(¬µ) > m(¬µ).
‚ô¶
Because of its relation to the analysis of the Black‚ÄìScholes formula for option
prices, we will now sketch a second proof of Proposition 2.67.

84
2 Preferences
Second proof of Proposition 2.67. Let
Ym,œÉ := m ¬∑ exp

œÉX ‚àíœÉ 2
2

for a standard normally distributed random variable X. Then
E

(Ym,œÉ ‚àíc)+ 
= m (d+) ‚àíc (d‚àí)
with d¬± = log x
c ¬± 1
2œÉ 2
œÉ
;
see Example 5.57 in Chapter 5. Calculating the derivative of this expectation with
respect to œÉ > 0, one Ô¨Ånds that
d
dœÉ E

(Ym,œÉ ‚àíc)+ 
= d
dœÉ

m (d+) ‚àíc (d‚àí)

= x œï(d+) > 0,
see (5.35) in Chapter 5. The law ¬µm,œÉ of Ym,œÉ satisÔ¨Åes m(¬µm,œÉ) = m for all œÉ > 0.
Condition (c) of Corollary 2.62 implies that ¬µm,œÉ is decreasing in œÉ > 0 with respect
to ‚âΩuni and hence also with respect to ‚âΩcon, i.e., ¬µm,œÉ ‚âΩcon ¬µm,œÉ if and only if œÉ ‚â§œÉ.
For two different expectations m and 
m, simply use the monotonicity of the function
u(y) := (y ‚àíc)+ to conclude

u d¬µm,œÉ = E

u

m ¬∑ exp(œÉX ‚àíœÉ 2/2)
 
‚â•E

u
 
m ¬∑ exp(œÉX ‚àíœÉ 2/2)
 
‚â•

u d¬µ
m,œÉ,
provided that m ‚â•
m and 0 < œÉ ‚â§œÉ.
The partial order ‚âΩuni was deÔ¨Åned in terms of integrals against increasing concave
functions. By taking the larger class of all concave functions as integrands, we arrived
at the partial order ‚âΩcon deÔ¨Åned by (2.17) and characterized in Corollary 2.62. In
the remainder of this section, we will brieÔ¨Çy discuss the partial order of stochastic
dominance, which is induced by increasing instead of concave functions:
DeÔ¨Ånition 2.69. Let ¬µ and ŒΩ be two arbitrary probability measures on R. We say that
¬µ stochastically dominates ŒΩ and we write ¬µ ‚âΩmon ŒΩ if

f d¬µ ‚â•

f dŒΩ
for all bounded increasing functions f ‚ààC(R).
Stochastic dominance is sometimes also called Ô¨Årst order stochastic dominance.
It is indeed a partial order on M1(R): ReÔ¨Çexivity and transitivity are obvious, and
antisymmetry follows, e.g., from the equivalence (a)‚áî(b) below. As will be shown by
the following theorem, the relation ¬µ ‚âΩmon ŒΩ means that the distribution ¬µ is ‚Äúhigher‚Äù
than the distribution ŒΩ. In our one-dimensional situation, we can provide a complete
proof of this fact by using elementary properties of distribution functions. The general
version of this result, given in Theorem 2.95, will require different techniques.

2.4 Uniform preferences
85
Theorem 2.70. For ¬µ, ŒΩ ‚ààM1(R) the following conditions are equivalent.
(a) ¬µ ‚âΩmon ŒΩ.
(b) The distribution functions of ¬µ and ŒΩ satisfy F¬µ(x) ‚â§FŒΩ(x) for all x.
(c) Any pair of quantile functions for ¬µ and ŒΩ satisÔ¨Åes q¬µ(t) ‚â•qŒΩ(t) for a.e.
t ‚àà(0, 1).
(d) There exists a probability space (, F , P ) with random variables X¬µ and XŒΩ
with distributions ¬µ and ŒΩ such that X¬µ ‚â•XŒΩ P -a.s.
(e) There exists a stochastic kernel Q(x, dy) on R such that Q(x, (‚àí‚àû, x]) = 1
and such that ŒΩ = ¬µQ.
In particular, ¬µ ‚âΩmon ŒΩ implies ¬µ ‚âΩuni ŒΩ.
Proof. (a) ‚áí(b): Note that F¬µ(x) = ¬µ

(‚àí‚àû, x]

can be written as
F¬µ(x) = 1 ‚àí

I(x,‚àû)(y) ¬µ(dy).
It is easy to construct a sequence of increasing continuous functions with values in
[0, 1] which increase to I(x,‚àû) for each x. Hence,

I(x,‚àû)(y) ¬µ(dy) ‚â•

I(x,‚àû)(y) ŒΩ(dy) = 1 ‚àíFŒΩ(x).
(b)‚áî(c): This follows from the deÔ¨Ånition of a quantile function and from Lemma
A.17.
(c) ‚áí(d): Let (, F , P) be a probability space supporting a random variable U
with a uniform distribution on (0, 1). Then X¬µ := q¬µ(U) and XŒΩ := qŒΩ(U) satisfy
X¬µ ‚â•XŒΩ P -almost surely. Moreover, it follows from Lemma A.19 that they have the
distributions ¬µ and ŒΩ.
(d) ‚áí(e): This is proved as in Theorem 2.58 by using regular conditional distri-
butions.
(e) ‚áí(a): Condition (e) implies that x ‚â•y for Q(x, ¬∑)-a.e. y. Hence, if f is
bounded and increasing, then

f (y) Q(x, dy) ‚â§

f (x) Q(x, dy) = f (x).
Therefore,

f dŒΩ =
 
f (y) Q(x, dy) ¬µ(dx) ‚â§

f d¬µ.
Finally, due to the equivalence (a) ‚áî(b) above and the equivalence (a) ‚áî(d) in
Theorem 2.58, ¬µ ‚âΩmon ŒΩ implies ¬µ ‚âΩuni ŒΩ.

86
2 Preferences
Remark 2.71. It is clear from conditions (d) or (e) of Theorem 2.70 that the set of
bounded, increasing, and continuous functions in DeÔ¨Ånition 2.69 can be replaced by
the set of all increasing functions for which the two integrals make sense. Thus,
¬µ ‚âΩmon ŒΩ for ¬µ, ŒΩ ‚ààM implies ¬µ ‚âΩuni ŒΩ, and in particular m(¬µ) ‚â•m(ŒΩ). Moreover,
condition (d) shows that ¬µ ‚âΩmon ŒΩ together with m(¬µ) = m(ŒΩ) implies ¬µ = ŒΩ.
‚ô¶
2.5 Robust preferences on asset proÔ¨Åles
In this section, we discuss the structure of preferences for assets on a more funda-
mental level. Instead of assuming that the distributions of assets are known and that
preferences are deÔ¨Åned on a set of probability measures, we will take as our basic
objects the assets themselves. An asset will be viewed as a function which associates
real-valued payoffs to possible scenarios. More precisely, X will denote a set of
bounded measurable functions X on some measurable set (, F ). We emphasize that
no a priori probability measure is given on (, F ). In other words, we are facing
uncertainty instead of risk.
We assume that X is endowed with a preference relation ‚âª. In view of the Ô¨Ånancial
interpretation, it is natural to assume that ‚âªis monotone in the sense that
Y ‚™∞X
if Y(œâ) ‚â•X(œâ) for all œâ ‚àà.
Under a suitable condition of continuity, we could apply the results of Section 2.1 to
obtain a numerical representation of ‚âª. L. J. Savage introduced a set of additional
axioms which guarantee there is a numerical representation of the special form
U(X) = EQ[ u(X) ] =

u

X(œâ)

Q(dœâ)
for all X ‚ààX
(2.22)
where Q is a probability measure on (, F ) and u is a function on R. The measure
Q speciÔ¨Åes the subjective view of the probabilities of events which is implicit in the
preference relation ‚âª. Note that the function u : R ‚ÜíR is determined by restricting
U to the class of constant functions on (, F ). Clearly, the monotonicity of ‚âªis
equivalent to the condition that u is an increasing function.
DeÔ¨Ånition 2.72. A numerical representation of the form (2.22) will be called a Savage
representation of the preference relation ‚âª.
Remark 2.73. Let ¬µQ,X denote the distribution of X under the subjective measure
Q. Clearly, the preference order ‚âªon X given by (2.22) induces a preference order
on
MQ := { ¬µQ,X | X ‚ààX }
with von Neumann‚ÄìMorgenstern representation
UQ(¬µQ,X) := U(X) = EQ[ u(X) ] =

u d¬µQ,X,

2.5 Robust preferences on asset proÔ¨Åles
87
i.e.,
UQ(¬µ) =

u(x) ¬µ(dx)
for ¬µ ‚ààMQ.
On this level, Section 2.3 speciÔ¨Åes the conditions on UQ which guarantee that u is a
(strictly concave and strictly increasing) utility function.
‚ô¶
Remark 2.74. Even if an economic agent with preferences ‚âªwould accept the view
that scenarios œâ ‚àà are generated in accordance to a given objective probability
measure P on (, F ), the preference order ‚âªon X may be such that the subjective
measure Q appearing in the Savage representation (2.22) is different from the objective
measureP. Suppose, forexample, thatP isLebesguemeasurerestrictedto = [0, 1],
and that X is the space of bounded right-continuous increasing functions on [0, 1].
Let ¬µP,X denote the distribution of X under P . By Lemma A.19, every probability
measure on R with bounded support is of the form ¬µP,X for some X ‚ààX, i.e.,
Mb(R) = { ¬µP,X | X ‚ààX }.
Suppose the agent agrees that, objectively, X ‚ààX can be identiÔ¨Åed with the lottery
¬µP,X, so that the preference relation on X could be viewed as a preference relation
on Mb(R) with numerical representation
U‚àó(¬µP,X) := U(X).
This does not imply that U‚àósatisÔ¨Åes the assumptions of Section 2.2; in particular, the
preference relation on Mb(R) may violate the independence axiom. In fact, the agent
might take a pessimistic view and distort P by putting more emphasis on unfavorable
scenarios. For example, the agent could replace P by the subjective measure
Q := Œ±Œ¥0 + (1 ‚àíŒ±)P
for some Œ± ‚àà(0, 1) and specify preferences by a Savage representation in terms of u
and Q. In this case,
U‚àó(¬µP,X) = EQ[ u(X) ] =

u d¬µQ,X
= Œ±u

X(0)

+ (1 ‚àíŒ±)EP [ u(X) ]
= Œ±u

X(0)

+ (1 ‚àíŒ±)

u d¬µP,X.
Note that X(0) = ‚Ñì(¬µP,X) for
‚Ñì(¬µ) := inf(supp ¬µ) = sup

a ‚ààR | ¬µ

(‚àí‚àû, a)

= 0

,
where supp ¬µ is the support of ¬µ. Hence, replacing P by Q corresponds to a non-linear
distortion on the level of lotteries: ¬µ = ¬µP,X is distorted to the lottery ¬µ‚àó= ¬µQ,X
given by
¬µ‚àó= Œ± Œ¥‚Ñì(¬µ) + (1 ‚àíŒ±)¬µ,

88
2 Preferences
and the preference relation on lotteries has the numerical representation
U‚àó(¬µ) =

u(x) ¬µ‚àó(dx)
for ¬µ ‚ààMb(R).
Let us now show that such a subjective distortion of objective lotteries provides a
possible explanation of the Allais paradox. Consider the lotteries ¬µi and ŒΩi, i = 1, 2,
described in Example 2.32. Clearly,
¬µ‚àó
1 = ¬µ1
and
ŒΩ‚àó
1 = Œ± Œ¥0 + (1 ‚àíŒ±)ŒΩ1,
while
¬µ‚àó
2 = Œ± Œ¥0 + (1 ‚àíŒ±)¬µ2
and
ŒΩ‚àó
1 = Œ± Œ¥0 + (1 ‚àíŒ±)ŒΩ1.
For the particular choice u(x) = x we have U‚àó(ŒΩ2) > U‚àó(¬µ2), and for Œ± > 9/2409
we obtain U‚àó(¬µ1) > U‚àó(ŒΩ1), in accordance with the observed preferences ŒΩ2 ‚âª¬µ2
and ¬µ1 ‚âªŒΩ1 described in Example 2.32.
For a systematic discussion of preferences described in terms of a subjective distor-
tion of lotteries we refer to [131]. In Section 4.6, we will discuss the role of distortions
in the context of risk measures, and in particular the connection toYaari‚Äôs ‚Äúdual theory
of choice under risk‚Äù [198].
‚ô¶
Even in its general form (2.22), however, the paradigm of expected utility has a
limited scope as illustrated by the following example.
Example 2.75 (Ellsberg paradox). You are faced with a choice between two urns,
each containing 100 balls which are either red or black. In the Ô¨Årst urn, the proportion
p of red balls is know; assume, e.g., p = 0.49. In the second urn, the proportion p is
unknown. Suppose that you get 1000 ‚Ç¨ if you draw a red ball and 0 ‚Ç¨ otherwise. In this
case, most people would choose the Ô¨Årst urn. Naturally, they make the same choice if
you get 1000 ‚Ç¨ for drawing a black ball and 0 ‚Ç¨ for a red one. But this behavior is not
compatible with the paradigm of expected utility: For any subjective probability p of
drawing a red ball in the second urn, the Ô¨Årst choice would imply p > p, the second
would yield 1 ‚àíp > 1 ‚àíp, and this is a contradiction.
‚ô¶
For this reason, we are going to make one further conceptual step beyond the
Savage representation before we start to prove a representation theorem for preferences
on X. Instead of a single measure Q, let us consider a whole class Q of measures
on (, F ). Our aim is to characterize those preference relations on X which admit a
representation of the form
U(X) = inf
Q‚ààQ EQ[ u(X) ].
(2.23)
This may be viewed as a robust version of the paradigm of expected utility: The
agent has in mind a whole collection of possible probabilistic views of the given set
of scenarios and takes a worst-case approach in evaluating the expected utility of a
given payoff.

2.5 Robust preferences on asset proÔ¨Åles
89
It will be convenient to extend the discussion to the following framework where
payoffs can be lotteries. Let X denote the space of all bounded measurable functions
on (, F ). We are going to embed X into a certain space 
X of functions 
X on (, F )
with values in the convex set
Mb(R) =

¬µ ‚ààM1(R) | ¬µ([‚àíc, c]) = 1 for some c ‚â•0

of boundedly supported Borel probability measures on R. More precisely, 
X is deÔ¨Åned
as the convex set of all those stochastic kernels 
X(œâ, dy) from (, F ) to R for which
there exists a constant c ‚â•0 such that

X

œâ, [‚àíc, c]

= 1
for all œâ ‚àà.
The space X can be embedded into 
X by virtue of the mapping
X ‚àãX ‚àí‚ÜíŒ¥X ‚àà
X.
(2.24)
In this way, X can be identiÔ¨Åed with the set of all 
X ‚àà
X for which the measure

X(œâ, ¬∑) is a Dirac measure. A preference order on X deÔ¨Åned by (2.23) clearly extends
to 
X by

U(
X) = inf
Q‚ààQ
 
u(y) 
X(œâ, dy) Q(dœâ) = inf
Q‚ààQ EQ[u(
X) ]
(2.25)
where u is the afÔ¨Åne function on Mb(R) deÔ¨Åned by
u(¬µ) =

u d¬µ,
¬µ ‚ààMb(R).
Remark 2.76. Restricting the preference order ‚âªon 
X obtained from (2.25) to the
constant maps 
X(œâ) = ¬µ for ¬µ ‚ààMb(R), we obtain a preference order on Mb(R),
and on this level we know how to characterize risk aversion by the property that u is
strictly concave.
‚ô¶
Example 2.77. Let us show how the Ellsberg paradox Ô¨Åts into our extended setting,
and how it can be resolved by a suitable choice of the set Q. For  = {0, 1} deÔ¨Åne

X0(œâ) := p Œ¥1000 + (1 ‚àíp)Œ¥0,

X1(œâ) := (1 ‚àíp)Œ¥1000 + p Œ¥0,
and
Zi(œâ) := Œ¥1000 ¬∑ I{i}(œâ) + Œ¥0 ¬∑ I{1‚àíi}(œâ),
i = 0, 1.
Take
Q :=

q Œ¥1 + (1 ‚àíq)Œ¥0 | a ‚â§q ‚â§b

with [a, b] ‚äÇ[0, 1]. For any increasing function u, the functional

U(
X) := inf
Q‚ààQ EQ[u(
X) ]

90
2 Preferences
satisÔ¨Åes

U(
Xi) > 
U(Zi),
i = 0, 1,
as soon as a < p < b, in accordance with the preferences described in Example 2.75.
‚ô¶
Let us now formulate those properties of a preference order ‚âªon the convex set

X which are crucial for a representation of the form (2.25). For 
X, Y ‚àà
X and
Œ± ‚àà(0, 1), (2.25) implies

U

Œ±
X + (1 ‚àíŒ±)Y

= inf
Q‚ààQ

Œ± EQ[u(
X) ] + (1 ‚àíŒ±) EQ[u(Y) ]

‚â•Œ± 
U(
X) + (1 ‚àíŒ±)
U(Y).
In contrast to the Savage case Q = {Q}, we can no longer expect equality, except for
the case of certainty Y(œâ) ‚â°¬µ. If 
X ‚àºY, then 
U(
X) = 
U(Y), and the lower bound
reduces to 
U(
X) = 
U(Y). Thus, ‚âªsatisÔ¨Åes the following two properties:
Uncertainty aversion: If 
X, Y ‚àà
X are such that 
X ‚àºY, then
Œ±
X + (1 ‚àíŒ±)Y ‚™∞
X
for all Œ± ‚àà[0, 1].
Certainty independence: For 
X, Y ‚àà
X, Z ‚â°¬µ ‚ààMb(R), and Œ± ‚àà(0, 1] we have

X ‚âªY
‚áê‚áí
Œ±
X + (1 ‚àíŒ±)Z ‚âªŒ±Y + (1 ‚àíŒ±)Z.
Remark 2.78. In order to motivate the term ‚Äúuncertainty aversion‚Äù, consider the sit-
uation of the preceding example. Suppose that an agent is indifferent between the
choices Z0 and Z1, which both involve the same kind of uncertainty. For Œ± ‚àà(0, 1),
the convex combination Y := Œ±Z0 + (1 ‚àíŒ±)Z1, which is weakly preferred to both
Z0 and Z1 in the case of uncertainty aversion, takes the form
Y(œâ) =

Œ± Œ¥1000 + (1 ‚àíŒ±)Œ¥0
for œâ = 1,
Œ± Œ¥0 + (1 ‚àíŒ±)Œ¥1000
for œâ = 0,
i.e., uncertainty is reduced in favor of risk. For Œ± = 1/2, the resulting lottery Y(œâ) ‚â°
1
2(Œ¥1000 +Œ¥0) is independent of the scenario œâ, i.e., uncertainty is completely replaced
by risk.
‚ô¶
Remark 2.79. The axiom of ‚Äúcertainty independence‚Äù extends the independence ax-
iom for preferences on lotteries to our present setting, but only under the restriction
that one of the two contingent lotteries 
X and Y is certain, i.e., does not depend on
the scenario œâ ‚àà. Without this restriction, the extended independence axiom would
lead to the Savage representation in its original form (2.22). There are good reasons
for not requiring full independence for all Z ‚àà
X. As an example, take  = {0, 1} and
deÔ¨Åne 
X(œâ) = Œ¥œâ, Y(œâ) = Œ¥1‚àíœâ, and Z = 
X. An agent may prefer 
X over Y, thus

2.5 Robust preferences on asset proÔ¨Åles
91
expressing the implicit view that scenario 1 is somewhat more likely than scenario 0.
At the same time, the agent may like the idea of hedging against the occurrence of
scenario 0, and this could mean that the certain lottery
1
2
 Y + Z

(¬∑) ‚â°1
2(Œ¥0 + Œ¥1)
is preferred over the contingent lottery
1
2
 
X + Z

(¬∑) ‚â°
X(¬∑),
thus violating the independence assumption in its unrestricted form. In general, the
role of Z as a hedge against scenarios unfavorable for Y requires that Y and Z are not
comonotone, i.e.,
‚àÉœâ, Œ∑ ‚àà :
Y(œâ) ‚âªY(Œ∑), Z(œâ) ‚â∫Z(Œ∑).
(2.26)
Thus, the wish to hedge would still be compatible with the following enforcement of
certainty independence, called
‚Ä¢ comonotonic independence: For 
X, Y, Z ‚àà
X and Œ± ‚àà(0, 1]

X ‚âªY
‚áê‚áí
Œ±
X + (1 ‚àíŒ±)Z ‚âªŒ±Y + (1 ‚àíŒ±)Z.
whenever Y and Z are comonotone in the sense that (2.26) does not occur.
‚ô¶
From now on, we assume that ‚âªis a given preference order on 
X. The set Mb(R)
will be regarded as a subset of 
X by identifying a constant function Z ‚â°¬µ with its
value ¬µ ‚ààMb(R). We assume that ‚âªpossesses the following properties:
‚Ä¢ Uncertainty aversion.
‚Ä¢ Certainty independence.
‚Ä¢ Monotonicity: If Y(œâ) ‚™∞
X(œâ) for all œâ ‚àà, then Y ‚™∞
X. Moreover, ‚âªis
compatible with the usual order on R, i.e., Œ¥y ‚âªŒ¥x if and only if y > x.
‚Ä¢ Continuity: The following analogue of the Archimedean axiom holds on 
X: If

X, Y, Z ‚àà
X are such that Z ‚âªY ‚âª
X, then there are Œ±, Œ≤ ‚àà(0, 1) with
Œ±Z + (1 ‚àíŒ±)
X ‚âªY ‚âªŒ≤Z + (1 ‚àíŒ≤)
X.
Moreover, for all c > 0 the restriction of ‚âªto M1([‚àíc, c]) is continuous with
respect to the weak topology.
Let us denote by
M1,f := M1,f (, F )

92
2 Preferences
the class of all set functions Q : F ‚Üí[0, 1] which are normalized to Q[  ] = 1
and which are Ô¨Ånitely additive, i.e., Q[ A ‚à™B ] = Q[ A ] + Q[ B ] for all disjoint
A, B ‚ààF . By EQ[ X ] we denote the integral of X with respect to Q ‚ààM1,f ; see
Appendix A.6. With M1(, F ) we denote the œÉ-additive members of M1,f , that is,
the class of all probability measures on (, F ).
Theorem 2.80. Consider a preference order ‚âªon 
X satisfying the four properties
listed above.
(a) There exists a strictly increasing function u ‚ààC(R) and a convex set Q ‚äÇ
M1,f (, F ) such that

U(
X) = min
Q‚ààQ EQ
 
u(x) 
X(¬∑, dx)

is a numerical representation of ‚âª. Moreover, u is unique up to positive afÔ¨Åne trans-
formations.
(b) If the induced preference order ‚âªon X, viewed as a subset of 
X as in (2.24),
satisÔ¨Åes the following additional continuity property
X ‚âªY and Xn ‚ÜóX
"‚áí
Xn ‚âªY
for all large n,
(2.27)
then the set functions in Q are in fact probability measures, i.e., each Q ‚ààQ is
œÉ-additive. In this case, the induced preference order on X has the robust Savage
representation
U(X) = min
Q‚ààQ EQ[ u(X) ]
for X ‚ààX
with Q ‚äÇM1(, F ).
Remark 2.81. Even without its axiomatic foundation, the robust Savage representa-
tion is highly plausible as it stands, since it may be viewed as a worst-case approach
to the problem of model uncertainty. This aspect will be of particular relevance in our
discussion of risk measures in Chapter 4.
‚ô¶
The proof of Theorem 2.80 needs some preparation.
When restricted to Mb(R), viewed as a subset of 
X, the axiom of certainty inde-
pendence is just the independence axiom of the von Neumann‚ÄìMorgenstern theory.
Thus, the preference relation ‚âªon Mb(R) satisÔ¨Åes the assumptions of Corollary 2.29,
and we obtain the existence of a continuous function u : R ‚ÜíR such that
u(¬µ) :=

u(x) ¬µ(dx)
(2.28)
is a numerical representation of ‚âªon the set Mb(R). Moreover, u is unique up
to positive afÔ¨Åne transformations. The second part of our monotonicity assumption
implies that u is strictly increasing. Without loss of generality, we assume u(0) = 0
and u(1) = 1.

2.5 Robust preferences on asset proÔ¨Åles
93
Remark 2.82. In view of the representation (2.28), it follows as in (2.9) that any
¬µ ‚ààMb(R) admits a unique certainty equivalent c(¬µ) ‚ààR for which
¬µ ‚àºŒ¥c(¬µ).
Thus, if X ‚ààX is deÔ¨Åned for 
X ‚àà
X as X(œâ) := c

X(œâ)

, then the Ô¨Årst part of our
monotonicity assumption yields

X ‚àºŒ¥X,
(2.29)
and so the preference relation ‚âªon 
X is uniquely determined by its restriction to X.
‚ô¶
Lemma 2.83. There exists a unique extension 
U of the functional u in (2.28) as a
numerical representation of ‚âªon 
X.
Proof. For 
X ‚àà
X let c > 0 be such that 
X(œâ, [‚àíc, c]) = 1 for all œâ ‚àà. Then
u(Œ¥‚àíc) ‚â§u

X(œâ)

‚â§u(Œ¥c)
for all œâ ‚àà,
and our monotonicity assumption implies that
Œ¥c ‚™∞
X ‚™∞Œ¥‚àíc.
We will show below that there exists a unique Œ± ‚àà[0, 1] such that

X ‚àº(1 ‚àíŒ±)Œ¥‚àíc + Œ±Œ¥c.
(2.30)
Once this has been achieved, the only possible choice for 
U(
X) is

U(
X) := u

(1 ‚àíŒ±)Œ¥‚àíc + Œ±Œ¥c

= (1 ‚àíŒ±)u(Œ¥‚àíc) + Œ±u(Œ¥c).
This deÔ¨Ånition of 
U provides a numerical representation of ‚âªon 
X.
The proof of the existence of a unique Œ± ‚àà[0, 1] with (2.30) is similar to the proof
of Lemma 2.24. Uniqueness follows from the monotonicity
Œ≤ > Œ±
"‚áí
(1 ‚àíŒ≤)Œ¥‚àíc + Œ≤Œ¥c ‚âª(1 ‚àíŒ±)Œ¥‚àíc + Œ±Œ¥c,
(2.31)
which is an immediate consequence of the von Neumann‚ÄìMorgenstern representation.
Now we let
Œ± := sup

Œ≥ ‚àà[0, 1] | 
X ‚™∞(1 ‚àíŒ≥ )Œ¥‚àíc + Œ≥ Œ¥c

.
We have to exclude the two following cases:

X ‚âª(1 ‚àíŒ±)Œ¥‚àíc + Œ±Œ¥c
(2.32)
(1 ‚àíŒ±)Œ¥‚àíc + Œ±Œ¥c ‚âª
X.
(2.33)
In the case (2.32), our continuity axiom yields some Œ≤ ‚àà(0, 1) for which

X ‚âªŒ≤[ (1 ‚àíŒ±)Œ¥‚àíc + Œ±Œ¥c ] + (1 ‚àíŒ≤)Œ¥c = (1 ‚àíŒ≥ )Œ¥‚àíc + Œ≥ Œ¥c

94
2 Preferences
where Œ≥ = Œ≤Œ± + (1 ‚àíŒ≤) > Œ±, in contradiction to the deÔ¨Ånition of Œ±.
If (2.33) holds, then the same argument as above yields Œ≤ ‚àà(0, 1) with
Œ≤Œ±Œ¥c + (1 ‚àíŒ≤Œ±)Œ¥‚àíc ‚âª
X.
By our deÔ¨Ånition of Œ± there must be some Œ≥ ‚àà(Œ≤Œ±, Œ±) with

X ‚™∞(1 ‚àíŒ≥ )Œ¥‚àíc + Œ≥ Œ¥c ‚âªŒ≤Œ±Œ¥c + (1 ‚àíŒ≤Œ±)Œ¥‚àíc,
where the second relation follows from (2.31). This, however, is a contradiction.
Via the embedding (2.24), Lemma 2.83 induces a numerical representation U of
‚âªon X given by
U(X) := 
U(Œ¥X).
(2.34)
The following proposition clariÔ¨Åes the properties of the functional U and provides the
key to a robust Savage representation of the preference order ‚âªon X.
Proposition 2.84. Given u of (2.28) and the numerical representation U on X con-
structed via Lemma 2.83 and (2.34), there exists a unique functional J : X ‚ÜíR such
that
U(X) = J

u(X)

for all X ‚ààX,
(2.35)
and such that the following four properties are satisÔ¨Åed:
‚Ä¢ Monotonicity: If Y(œâ) ‚â•X(œâ) for all œâ, then J(Y) ‚â•J(X).
‚Ä¢ Concavity: If Œª ‚àà[0, 1] then J

ŒªX + (1 ‚àíŒª)Y

‚â•ŒªJ(X) + (1 ‚àíŒª)J(Y).
‚Ä¢ Positive homogeneity: J(ŒªX) = ŒªJ(X) for Œª ‚â•0.
‚Ä¢ Cash invariance: J(X + z) = J(X) + z for all z ‚ààR.
Moreover, any functional J with these four properties is Lipschitz continuous on X
with respect to the supremum norm ‚à•¬∑ ‚à•, i.e.,
|J(X) ‚àíJ(Y)| ‚â§‚à•X ‚àíY‚à•
for all X, Y ‚ààX.
Proof. Denote by Xu the space of all X ‚ààX which take values in the range u(R) of
u. Clearly, Xu coincides with the range of the non-linear transformation X ‚àãX ‚Üí
u(X). Note that this transformation is bijective since u is strictly increasing due to
our assumption of monotonicity. Thus, J is well-deÔ¨Åned on Xu via (2.35). We show
next that this J has the four properties of the assertion.
Monotonicity is obvious. For positive homogeneity on Xu, it sufÔ¨Åces to show that
J(ŒªX) = ŒªJ(X) for X ‚ààXu and Œª ‚àà(0, 1]. Let X0 ‚ààX be such that u(X0) = X.
We deÔ¨Åne Z ‚àà
X by
Z := ŒªŒ¥X0 + (1 ‚àíŒª)Œ¥0.

2.5 Robust preferences on asset proÔ¨Åles
95
By (2.29), Z ‚àºŒ¥Z where Z is given by
Z(œâ) = c

ŒªŒ¥X0(œâ) + (1 ‚àíŒª)Œ¥0

= u‚àí1
Œªu(X0(œâ)) + (1 ‚àíŒª)u(0)

= u‚àí1
Œªu(X0(œâ))

,
where we have used our convention u(0) = 0. It follows that u(Z) = Œªu(X0) = ŒªX,
and so
J(ŒªX) = U(Z) = 
U(Z).
(2.36)
As in (2.30), one can Ô¨Ånd ŒΩ ‚ààMb(R) such that ŒΩ ‚àºŒ¥X0. Certainty independence
implies that
Z = ŒªŒ¥X0 + (1 ‚àíŒª)Œ¥0 ‚àºŒªŒΩ + (1 ‚àíŒª)Œ¥0.
Hence,

U(Z) = u(ŒªŒΩ + (1 ‚àíŒª)Œ¥0) = Œªu(ŒΩ) = ŒªU(X0) = ŒªJ(X).
This shows that J is positively homogeneous on Xu.
Since the range of u is an interval, we can extend J from Xu to all of X by positive
homogeneity, and this extension, again denoted J, is also monotone and positively
homogeneous.
Let us now show that J is cash invariant. First note that
J(1) = J

u(x)

u(x)
= u(Œ¥x)
u(x) = 1
for any x such that u(x) Ã∏= 0. Now take X ‚ààX and z ‚ààR. By positive homogeneity,
we may assume without loss of generality that 2X ‚ààXu and 2z ‚ààu(R). Then there
are X0 ‚ààX such that 2X = u(X0) as well as z0, x0 ‚ààR with 2z = u(z0) and
2J(X) = u(x0). Note that Œ¥X0 ‚àºŒ¥x0. Thus, certainty independence yields
Z := 1
2(Œ¥X0 + Œ¥z0) ‚àº1
2(Œ¥x0 + Œ¥z0) =: ¬µ.
On the one hand, it follows that

U(Z) = U(¬µ) = 1
2u(x0) + 1
2u(z0) = J(X) + z.
On the other hand, the same reasoning which lead to (2.36) shows that

U(Z) = J(X + z).
As to concavity, we need only show that J( 1
2X + 1
2Y) ‚â•1
2J(X) + 1
2J(Y) for
X, Y ‚ààXu, by positive homogeneity. Let X0, Y0 ‚ààX be such that X = u(X0) and
Y = u(Y0). If J(X) = J(Y), then Œ¥X0 ‚àºŒ¥Y0, and uncertainty aversion gives
Z := 1
2(Œ¥X0 + Œ¥Y0) ‚™∞Œ¥X0,

96
2 Preferences
which by the same arguments as above yields

U(Z) = J
1
2X + 1
2Y

‚â•J(X) = 1
2

J(X) + J(Y)

.
The case in which J(X) > J(Y) can be reduced to the previous one by letting
z := J(X) ‚àíJ(Y), and by replacing Y by Yz := Y + z. Cash invariance then implies
that
J
1
2X + 1
2Y

+ 1
2 z = J
1
2X + 1
2Yz

‚â•1
2

J(X) + J(Yz)

= 1
2

J(X) + J(Y)

+ 1
2 z.
Now we show the Lipschitz continuity of J. If X, Y ‚ààX then X ‚â§Y +‚à•X ‚àíY‚à•,
and so J(X) ‚â§J(Y) + ‚à•X ‚àíY‚à•, by monotonicity and cash invariance. Reversing
the roles of X and Y yields
|J(X) ‚àíJ(Y)| ‚â§‚à•X ‚àíY‚à•.
Letusnowshowthatafunctionwiththefourpropertiesestablishedinthepreceding
proposition can be represented in terms of a family of set functions in the class M1,f .
Proposition 2.85. A functional J : X ‚ÜíR is monotone, concave, positively homo-
geneous, and cash invariant if and only if there exists a set Q ‚äÇM1,f such that
J(X) = inf
Q‚ààQ EQ[ X ],
X ‚ààX.
Moreover, the set Q can always be chosen to be convex and such that the inÔ¨Åmum
above is attained, i.e.,
J(X) = min
Q‚ààQ EQ[ X ],
X ‚ààX.
Proof. The necessity of the four properties is obvious. Conversely, we will construct
for any X ‚ààX a Ô¨Ånitely additive set function QX such that J(X) = EQX[ X ] and
J(Y) ‚â§EQX[ Y ] for all Y ‚ààX. Then
J(Y) = min
Q‚ààQ0
EQ[ Y ]
for all Y ‚ààX
(2.37)
where Q0 := { QX | X ‚ààX }. Clearly, (2.37) remains true if we replace Q0 by its
convex hull Q := conv Q0.
To construct QX for a given X ‚ààX, we deÔ¨Åne three convex sets in X by
B := { Y ‚ààX | J(Y) > 1 },

2.5 Robust preferences on asset proÔ¨Åles
97
C1 := { Y ‚ààX | Y ‚â§1 },
and
C2 :=

Y ‚ààX
 Y ‚â§
X
J(X)

.
The convexity of C1 and C2 implies that the convex hull of their union is given by
C := conv(C1 ‚à™C2) =

Œ±Y1 + (1 ‚àíŒ±)Y2 | Yi ‚ààCi and Œ± ‚àà[0, 1]

.
Since Y ‚ààC is of the form Y = Œ±Y1 + (1 ‚àíŒ±)Y2 for some Yi ‚ààCi and Œ± ‚àà[0, 1],
J(Y) ‚â§J(Œ± + (1 ‚àíŒ±)Y2) = Œ± + (1 ‚àíŒ±)J(Y2) ‚â§1,
and so B and C are disjoint. Let X be endowed with the supremum norm ‚à•Y‚à•:=
supœâ‚àà |Y(œâ)|. Then C1, and hence C, contains the unit ball in X. In particular, C
has non-empty interior. Thus, we may apply the separation argument in the form of
Theorem A.54, which yields a non-zero continuous linear functional ‚Ñìon X such that
c := sup
Y‚ààC
‚Ñì(Y) ‚â§inf
Z‚ààB
‚Ñì(Z).
Since C contains the unit ball, c must be strictly positive, and there is no loss of
generality in assuming c = 1. In particular, ‚Ñì(1) ‚â§1 as 1 ‚ààC. On the other hand,
any constant b > 1 is contained in B, and so
‚Ñì(1) = lim
b‚Üì1 ‚Ñì(b) ‚â•c = 1.
Hence, ‚Ñì(1) = 1.
If A ‚ààF then IAc ‚ààC1 ‚äÇC, which implies that
‚Ñì(IA) = ‚Ñì(1) ‚àí‚Ñì(IAc ) ‚â•1 ‚àí1 = 0.
By Theorem A.50 there exists a Ô¨Ånitely additive set function QX ‚ààM1,f (, F ) such
that ‚Ñì(Y) = EQX[ Y ] for any Y ‚ààX.
It remains to show that EQX[ Y ] ‚â•J(Y) for all Y ‚ààX, with equality for Y = X.
By the cash invariance of J, we need only consider the case in which J(Y) > 0. Then
Yn :=
Y
J(Y) + 1
n ‚ààB,
and Yn ‚ÜíY/J(Y) uniformly, whence
EQX[ Y ]
J(Y)
= lim
n‚Üë‚àûEQX[ Yn ] ‚â•1.
On the other hand, X/J(X) ‚ààC2 ‚äÇC yields the inequality
EQX[ X ]
J(X)
‚â§c = 1.
We are now ready to complete the proof of the main result in this section.

98
2 Preferences
Proof of Theorem 2.80. (a): By Remark 2.82, it sufÔ¨Åces to consider the induced
preference relation ‚âªon X once the function u has been determined. According
to Lemma 2.83 and the two Propositions 2.84 and 2.85, there exists a convex set
Q ‚äÇM1,f such that
U(X) = min
Q‚ààQ EQ[ u(X) ]
is a numerical representation of ‚âªon X. This proves the Ô¨Årst part of the assertion.
(b): The assumption (2.27) applied to X ‚â°1 and Y ‚â°b < 1 gives that any
sequence with Xn ‚Üó1 is such that Xn ‚âªb for large enough n. We claim that
this implies that U(Xn) ‚Üóu(1) = 1. Otherwise, U(Xn) would increase to some
number a < 1. Since u is continuous and strictly increasing, we may take b such that
a < u(b) < 1. But then U(Xn) > U(b) = u(b) > a for large enough n, which is a
contradiction.
In particular, we obtain that for any increasing sequence An ‚ààF such that

n An = 
lim
n‚Üë‚àûmin
Q‚ààQ Q[ An ] = lim
n‚Üë‚àûU(IAn) = 1.
But this means that each Q ‚ààQ satisÔ¨Åes limn Q[ An ] = 1, which is equivalent to the
œÉ-additivity of Q.
The continuity assumption (2.27), required for all Xn ‚ààX, is actually quite strong.
In a topological setting, our discussion of risk measures in Chapter 4 will imply the
following version of the representation theorem.
Proposition 2.86. Consider a preference order ‚âªas inTheorem 2.80. Suppose that 
is a Polish space with Borel Ô¨Åeld F and that (2.27) holds if Xn and X are continuous.
Then there exists a class of probability measures Q ‚äÇM1(, F ) such that the induced
preference order on X has the robust Savage representation
U(X) = min
Q‚ààQ EQ[ u(X) ]
for continuous X ‚ààX.
Proof. As in the proof of Theorem 2.80, the continuity property of ‚âªimplies the
corresponding continuity property of U, and hence of the functional J in (2.35). The
result follows by combining Proposition 2.84, which reduces the representation of U
to a representation of J, with Proposition 4.25 applied to the coherent risk measure
œÅ := ‚àíJ.
Finally, we consider an alternative setting where we Ô¨Åx in advance a reference mea-
sure P on (, F ). In this context, X will be identiÔ¨Åed with the space L‚àû(, F , P ),
and the representation of preferences will involve measures which are absolutely con-
tinuous with respect to P . Note, however, that this passage from measurable functions
to equivalence classes of random variables in L‚àû(, F , P ), and from arbitrary proba-
bility measures to absolutely continuous measures, involves a certain loss of robustness
in the face of model uncertainty.

2.6 Probability measures with given marginals
99
Theorem 2.87. Let ‚âªbe a preference relation as in Theorem 2.80, and assume that
X ‚àºY
whenever X = Y P -a.s.
(a) There exists a robust Savage representation of the form
U(X) = inf
Q‚ààQ EQ

u(X)

,
X ‚ààX,
where Q consists of probability measures on (, F ) which are absolutely continuous
with respect to P , if and only if ‚âªsatisÔ¨Åes the following condition of continuity from
above:
Y ‚âªX and Xn ‚ÜòX P -a.s.
"‚áí
Y ‚âªXn
P -a.s. for all large n.
(b) There exists a representation of the form
U(X) = min
Q‚ààQ EQ

u(X)

,
X ‚ààX,
where Q consists of probability measures on (, F ) which are absolutely continuous
with respect to P , if and only if ‚âªsatisÔ¨Åes the following condition of continuity from
below:
X ‚âªY and Xn ‚ÜóX P -a.s.
"‚áí
Xn ‚âªY
P -a.s. for all large n.
Proof. As in the proof of Theorem 2.80, the continuity property of ‚âªimplies the
corresponding continuity property of U, and hence of the functional J in (2.35). The
results follow by combining Proposition 2.84, which reduces the representation of U
to a representation of J, with Corollary 4.34 and Corollary 4.35 applied to the coherent
risk measure œÅ := ‚àíJ.
2.6 Probability measures with given marginals
In this section, we study the construction of probability measures with given marginals.
In particular, this will yield the missing implication in the characterization of uniform
preference in Theorem 2.58, but the results in this section are of independent interest.
We focus on the following basic question: Suppose ¬µ1 and ¬µ2 are two probability
measures on S, and  is a convex set of probability measures on S √ó S; when does 
contain some ¬µ which has ¬µ1 and ¬µ2 as marginals?
The answer to this question will be given in a general topological setting. Let S be
a Polish space, and let us Ô¨Åx a continuous function œà on S with values in [1, ‚àû). As
in Section 2.2 and in Appendix A.6, we use œà as a gauge function in order to deÔ¨Åne
the space of measures
Mœà
1 (S) :=
$
¬µ ‚ààM1(S)


œà(x) ¬µ(dx) < ‚àû
%

100
2 Preferences
and the space of continuous test functions
Cœà(S) :=

f ‚ààC(S) | ‚àÉc : |f (x)| ‚â§c ¬∑ œà(x) for all x ‚ààS

.
The œà-weak topology on Mœà
1 (S) is the coarsest topology such that
Mœà
1 (S) ‚àã¬µ ‚Üí

f d¬µ
is a continuous mapping for all f ‚ààCœà(S); see Appendix A.6 for details. On the
product space S √ó S, we take the gauge function
œà(x, y) := œà(x) + œà(y),
and deÔ¨Åne the corresponding set Mœà
1 (S √óS), which will be endowed with the œà-weak
topology.
Theorem 2.88. Suppose that  ‚äÇMœà
1 (S √ó S) is convex and closed in the œà-weak
topology, and that ¬µ1, ¬µ2 are probability measures in Mœà
1 (S). Then there exists some
¬µ ‚àà with marginal distributions ¬µ1 and ¬µ2 if and only if

f1 d¬µ1 +

f2 d¬µ2 ‚â§sup
Œª‚àà
 
f1(x)+f2(y)

Œª(dx, dy)
for all f1, f2 ‚ààCœà(S).
Theorem 2.88 is due to V. Strassen [191]. Its proof boils down to an application of
the Hahn‚ÄìBanach theorem; the difÔ¨Åcult part consists in specifying the right topological
setting. First, let us investigate the relations between Mœà
1 (S √óS) and Mœà
1 (S). To this
end, we deÔ¨Åne mappings
œÄi : Mœà
1 (S √ó S) ‚ÜíMœà
1 (S),
i = 1, 2,
that yield the ith marginal distribution of a measure Œª ‚ààMœà
1 (S √ó S):

f d(œÄ1Œª) =

f (x) Œª(dx, dy)
and

f d(œÄ2Œª) =

f (y) Œª(dx, dy),
for all f ‚ààCœà(S).
Lemma 2.89. œÄ1 and œÄ2 are continuous and afÔ¨Åne mappings from Mœà
1 (S √ó S) to
Mœà
1 (S).
Proof. Suppose that Œªn converges to Œª in Mœà
1 (S √ó S). For f ‚ààCœà(S) let f (x, y) :=
f (x). Clearly, f ‚ààCœà(S √ó S), and thus

f d(œÄ1Œªn) =

f dŒªn ‚àí‚Üí

f dŒª =

f d(œÄ1Œª).
Therefore, œÄ1 is continuous, and the same is true of œÄ2. AfÔ¨Ånity is obvious.

2.6 Probability measures with given marginals
101
Now, let us consider the linear space
E :=

Œ±¬µ ‚àíŒ≤ŒΩ | ¬µ, ŒΩ ‚ààMœà
1 (S), Œ±, Œ≤ ‚ààR

spanned by Mœà
1 (S). For œÅ = Œ±¬µ ‚àíŒ≤ŒΩ ‚ààE the integral

f dœÅ against a function
f ‚ààCœà(S) is well-deÔ¨Åned and given by

f dœÅ = Œ±

f d¬µ ‚àíŒ≤

f dŒΩ.
In particular, œÅ ‚Üí

f dœÅ is linear functional on E, so we can regard Cœà(S) as a
subset of the algebraic dual E‚àóof E. Note that

f dœÅ =

f dœÅ for all f ‚ààCœà(S)
implies œÅ = œÅ, i.e., Cœà(S) separates the points of E. We endow E with the coarsest
topology œÉ(E, Cœà(S)) for which all maps
E ‚àãœÅ ‚Üí

f dœÅ,
f ‚ààCœà(S),
are continuous; see DeÔ¨Ånition A.57. With this topology, E becomes a locally convex
topological vector space.
Lemma 2.90. Under the above assumptions, Mœà
1 (S) is a closed convex subset of E,
and the relative topology of the embedding coincides with the œà-weak topology.
Proof. The sets of the form
UŒµ(œÅ; f1, . . . , fn) :=
n

i=1
$
œÅ ‚ààE



fi dœÅ ‚àí

fi dœÅ
 < Œµ
%
with œÅ ‚ààE, n ‚ààN, fi ‚ààCœà(S), and Œµ > 0 form a base of the topology œÉ(E, Cœà(S)).
Thus, if U ‚äÇE is open, then every point ¬µ ‚ààU ‚à©Mœà
1 (S) possesses some neigh-
borhood UŒµ(¬µ; f1, . . . , fn) ‚äÇU. But UŒµ(¬µ; f1, . . . , fn) ‚à©Mœà
1 (S) is an open neigh-
borhood of ¬µ in the œà-weak topology. Hence, U ‚à©Mœà
1 (S) is open in the œà-weak
topology.
Similarly, one shows that every open set V ‚äÇMœà
1 (S) is of the form
V = U ‚à©Mœà
1 (S) for some open subset U of E. This shows that the relative topology
Mœà
1 (S) ‚à©œÉ

E, Cœà(S)

coincides with the œà-weak topology.
Moreover, Mœà
1 (S) is an intersection of closed subsets of E:
Mœà
1 (S) =
$
œÅ ‚ààE


1 dœÅ = 1
%
‚à©

f ‚ààCœà (S)
f ‚â•0
$
œÅ ‚ààE


f dœÅ ‚â•0
%
.
Therefore, Mœà
1 (S) is closed in E.

102
2 Preferences
Next, let E2 denote the product space E √ó E. We endow E2 with the product
topology for which the sets U √ó V with U, V ‚ààœÉ(E, Cœà(S)) form a neighborhood
base. Clearly, E2 is a locally convex topological vector space.
Lemma 2.91. Every continuous linear functional ‚Ñìon E2 is of the form
‚Ñì(œÅ1, œÅ2) =

f1 dœÅ1 +

f2 dœÅ2
for some f1, f2 ‚ààCœà(S).
Proof. By linearity, ‚Ñìis of the form ‚Ñì(œÅ1, œÅ2) = ‚Ñì1(œÅ1) + ‚Ñì2(œÅ2), where ‚Ñì1(œÅ1) :=
‚Ñì(œÅ1, 0) and ‚Ñì2(œÅ2) := ‚Ñì(0, œÅ2). By continuity of ‚Ñì, the set
V := ‚Ñì‚àí1
(‚àí1, 1)

is open in E2 and contains the point (0, 0). Hence, there are two open neighborhoods
U1, U2 ‚äÇE such that (0, 0) ‚ààU1 √ó U2 ‚äÇV . Therefore,
0 ‚ààUi ‚äÇ‚Ñì‚àí1
i

(‚àí1, 1)

for i = 1, 2,
i.e., 0 is an interior point of ‚Ñì‚àí1
i

(‚àí1, 1)

. It follows that the ‚Ñìi are continuous at 0,
which in view of their linearity implies continuity everywhere on E. Finally, we may
conclude from Proposition A.58 that each ‚Ñìi is of the form ‚Ñìi(œÅ) =

fi dœÅi for some
fi ‚ààCœà(S).
The proof of the following lemma uses the characterization of compact sets for
the œà-weak topology that is stated in Corollary A.46. It is here that we need our
assumption that S is Polish.
Lemma 2.92. If  is a closed convex subset of M
¬Øœà
1 (S √ó S), then
H := { (œÄ1Œª, œÄ2Œª) | Œª ‚àà }
is a closed convex subset of E2.
Proof. It is enough to show that H is closed in Mœà
1 (S)2 := Mœà
1 (S) √ó Mœà
1 (S),
because Lemma 2.90 implies that the relative topology induced by E2 on Mœà
1 (S)2
coincideswiththeproducttopologyfortheœà-weaktopology. Thisisametrictopology
by Corollary A.44. So let (¬µn, ŒΩn) ‚ààH, n ‚ààN, be a sequence converging to
some (¬µ, ŒΩ) ‚ààMœà
1 (S)2 in the product topology. Since both sequences (¬µn)n‚ààN
and (ŒΩn)n‚ààN are relatively compact for the œà-weak topology, Corollary A.46 yields
functions œÜi : S ‚Üí[1, ‚àû], i = 1, 2, such that sets of the form Ki
k := {œÜi ‚â§kœà},
k ‚ààN, are relatively compact in S and such that
sup
n‚ààN

œÜ1 d¬µn + sup
n‚ààN

œÜ2 dŒΩn < ‚àû.

2.6 Probability measures with given marginals
103
For each n, there exists Œªn ‚àà such that œÄ1Œªn = ¬µn and œÄ2Œªn = ŒΩn. Hence, if we
let œÜ(x, y) := œÜ1(x) + œÜ2(y), then
sup
n‚ààN

œÜ dŒªn = sup
n‚ààN
	 
œÜ1 d¬µn +

œÜ2 dŒΩn

< ‚àû.
Moreover, we claim that each set { œÜ ‚â§kœà} is relatively compact in S √ó S. To prove
this claim, let li ‚ààN be such that
li ‚â•sup
x‚ààKi
k
œà(x) .
Then, since œà ‚â•1,
{ œÜ ‚â§kœà } ‚äÇK1
k √ó K2
k(1+l1) ‚à™K1
k(1+l2) √ó K2
k ,
and the right-hand side is a relatively compact set in S √ó S. It follows from Corollary
A.46 that the sequence (Œªn)n‚ààN is relatively compact for the œà-weak topology. Any
accumulation point Œª of this sequence belongs to the closed set . Moreover, Œª has
marginal distributions ¬µ and ŒΩ, since the projections œÄi are continuous according to
Lemma 2.89. Hence (¬µ, ŒΩ) ‚ààH.
Proof of Theorem 2.88. Let ¬µ1, ¬µ2 ‚ààMœà
1 (S) be given. Since H is closed and
convex in E2 by Lemma 2.92, we may apply Theorem A.56 with B := { (¬µ1, ¬µ2) }
and C := H: We conclude that (¬µ1, ¬µ2) /‚ààH if and only if there exists a linear
functional ‚Ñìon E2 such that
‚Ñì(¬µ1, ¬µ2) >
sup
(ŒΩ1,ŒΩ2)‚ààH
‚Ñì(ŒΩ1, ŒΩ2) = sup
Œª‚àà
‚Ñì(œÄ1Œª, œÄ2Œª).
Applying Lemma 2.91 to ‚Ñìcompletes the assertion.
We will now use Theorem 2.88 to deduce the remaining implication of The-
orem 2.58.
We consider here a more general, d-dimensional setting.
Let x =
(x1, . . . , xd) and y = (y1, . . . , yd) be two d-dimensional vectors. We will say that
x ‚â§y if xi ‚â§yi for all i. A function on Rd is called increasing, if it is increasing
with respect to the partial order ‚â§.
Theorem 2.93. Suppose ¬µ1 and ¬µ2 are Borel probability measures on Rd with

|x|¬µi(dx) < ‚àûfor i = 1, 2. Then the following assertions are equivalent.
(a)

f d¬µ1 ‚â•

f d¬µ2 for all increasing concave functions f on Rd.
(b) There exists a probability space (, F , P ) with random variables X1 and X2
having distributions ¬µ1 and ¬µ2, respectively, such that
E[ X2 | X1 ] ‚â§X1
P -a.s.

104
2 Preferences
(c) There exists a kernel Q(x, dy) on Rd such that

Rd y Q(x, dy) ‚â§x
for all x ‚ààRd
and such that ¬µ2 = ¬µ1Q.
Proof. (a) ‚áí(b): We will apply Theorem 2.88 with S := Rd and with the gauge
functions œà(x) := 1 + |x| and œà(x, y) := œà(x) + œà(y). We denote by Cb(Rd) the
set of bounded and continuous functions on Rd. Let
 :=

f ‚ààCb(Rd)
$
Œª ‚ààMœà
1 (Rd √ó Rd)


yf (x) Œª(dx, dy) ‚â§

xf (x) Œª(dx, dy)
%
.
Each single set of the intersection is convex and closed in Mœà
1 (Rd √ó Rd), because
the functions g(x, y) := yf (x) and g(x, y) := xf (x) belong to Cœà(Rd √ó Rd) for
f ‚ààCb(S). Therefore,  itself is convex and closed.
Suppose we can show that  contains an element P that has ¬µ1 and ¬µ2 as marginal
distributions. Then we can take  := Rd √ó Rd with its Borel œÉ-algebra F , and let
X1 and X2 denote the canonical projections on the Ô¨Årst and the second components,
respectively. By deÔ¨Ånition, Xi will have the distribution ¬µi, and
E

E[ X2 | X1 ]f (X1)

= E[ X2f (X1) ] ‚â§E[ X1f (X1) ]
for all f ‚ààCb(Rd).
By monotone class arguments, we may thus conclude that
E[ X2 | X1 ] ‚â§X1
P -a.s.
so that the assertion will follow.
It remains to prove the existence of P . To this end, we will apply Theorem 2.88
with the set  deÔ¨Åned above. Take a pair f1, f2 ‚ààCœà(Rd), and let

f2(x) := inf

g(x) | g is concave, increasing, and dominates f2

.
Then 
f2 is concave, increasing, and dominates f2. In fact, 
f2 is the smallest function
with these properties. We have

f1 d¬µ1 +

f2 d¬µ2 ‚â§

f1 d¬µ1 +


f2 d¬µ2
‚â§

(f1 + 
f2) d¬µ1
‚â§sup
x‚ààRd

f1(x) + 
f2(x)

=: r0.
We will establish the condition in Theorem 2.88 for our set  by showing that for
r < r0 we have
r < sup
Œª‚àà
 
f1(x) + f2(y)

Œª(dx, dy).

2.6 Probability measures with given marginals
105
To this end, let for z ‚ààRd
z :=
$
ŒΩ ‚ààMœà
1 (Rd)


x ŒΩ(dx) ‚â§z
%
and
g2(z) := sup
 
f2 dŒΩ
 ŒΩ ‚ààz

.
Then g2 is increasing and g2(z) ‚â•f2(z), because Œ¥z ‚ààz. Moreover, if ŒΩ1 ‚ààz1
and ŒΩ2 ‚ààz2, then
Œ±ŒΩ1 + (1 ‚àíŒ±)ŒΩ2 ‚ààŒ±z1+(1‚àíŒ±)z2
for Œ± ‚àà[0, 1]. Therefore, g2 is concave, and we conclude that g2 ‚â•
f2 (recall
that 
f2 is the smallest increasing and concave function dominating f2). Hence, r <
f1(z) + g2(z) for some z ‚ààRd, i.e., there exists some ŒΩ ‚ààz such that the product
measure Œª := Œ¥z ‚äóŒΩ satisÔ¨Åes
r < f1(z) +

f2 dŒΩ =
 
f1(x) + f2(y)

Œª(dx, dy).
But Œª = Œ¥z ‚äóŒΩ ‚àà.
(b) ‚áí(c): This follows as in the proof of the implication (f) ‚áí(g) of Theorem 2.58
by using regular conditional distributions.
(c) ‚áí(a): As in the proof of (g) ‚áí(a) of Theorem 2.58, this follows by an appli-
cation of Jensen‚Äôs inequality.
By the same arguments as for Corollary 2.62, we obtain the following result from
Theorem 2.93.
Corollary 2.94. Suppose ¬µ1 and ¬µ2 are Borel probability measures on Rd such that

|x|¬µi(dx) < ‚àû, for i = 1, 2. Then the following conditions are equivalent.
(a)

f d¬µ1 ‚â•

f d¬µ2 for all concave functions f on Rd.
(b) There exists a probability space (, F , P ) with random variables X1 and X2
having distributions ¬µ1 and ¬µ2, respectively, such that
E[ X2 | X1 ] = X1
P -a.s.
(c) There exists a kernel Q(x, dy) on Rd such that

y Q(x, dy) = x
for all x ‚ààRd
(i.e., Q is a mean-preserving spread) and such that ¬µ2 = ¬µ1Q.

106
2 Preferences
We conclude this section with a generalization of Theorem 2.70.
Let S be a
Polish space which is endowed with a preference order ‚âª. We will assume that ‚âªis
continuous in the sense of DeÔ¨Ånition 2.8. A function on S will be called increasing if
it is increasing with respect to ‚âª.
Theorem 2.95. For two Borel probability measures ¬µ1 and ¬µ2 on S, the following
conditions are equivalent.
(a)

f d¬µ1 ‚â•

f d¬µ2 for all bounded, increasing, and measurable functions f
on S.
(b) There exists a probability space (, F , P ) with random variables X1 and X2
having distributions ¬µ1 and ¬µ2, respectively, such that X1 ‚™∞X2 P -a.s.
(c) There exists a kernel Q on S such that ¬µ2 = ¬µ1Q and
Q

x, { y | x ‚™∞y }

= 1
for all x ‚ààS.
Proof. (a) ‚áí(b): We will apply Theorem 2.88 with the gauge function œà ‚â°1, so that
Mœà
1 (S) is just the space M1(S) of all Borel probability measures on S with the usual
weak topology. Then œà ‚â°2 which is equivalent to taking œà := 1. Let
M := { (x, y) ‚ààS √ó S | x ‚™∞y }.
This set M is closed in S √ó S by Proposition 2.11. Hence, the portmanteau theorem
in the form of Theorem A.38 implies that the convex set
 := { Œª ‚ààM1(S √ó S) | Œª(M) = 1 }
is closed in M1(S √ó S). For f2 ‚ààCb(S), let

f2(x) := sup{ f2(y) | x ‚™∞y }.
Then 
f2 is bounded, increasing, and dominates f2. Therefore, if f1 ‚ààCb(S),

f1 d¬µ1 +

f2 d¬µ2 ‚â§

f1 d¬µ1 +


f2 d¬µ2
‚â§

(f1 + 
f2) d¬µ1
‚â§sup
x‚ààS

f1(x) + 
f2(x)

= sup
x‚™∞y

f1(x) + f2(y)

.
If x ‚™∞y, then the product measure Œª := Œ¥x ‚äóŒ¥y is contained in , and so
sup
x‚™∞y

f1(x) + f2(y)

= sup
Œª‚àà
 
f1(x) + f2(y)

Œª(dx, dy).

2.6 Probability measures with given marginals
107
Hence, all assumptions of Theorem 2.88 are satisÔ¨Åed, and we conclude that there
exists a probability measure P ‚àà with marginals ¬µ1 and ¬µ2. Taking  := S √ó S
and Xi as the projection on the ith coordinate Ô¨Ånishes the proof of (a) ‚áí(b).
(b) ‚áí(c) follows as in the proof of Theorem 2.58 by using regular conditional
distributions.
(c) ‚áí(a) is proved as the corresponding implication of Theorem 2.70.

Chapter 3
Optimality and equilibrium
Consider an investor whose preferences can be expressed in terms of expected utility.
In Section 3.1, we discuss the problem of constructing a portfolio which maximizes
the expected utility of the resulting payoff. The existence of an optimal solution is
equivalent to the absence of arbitrage opportunities. This leads to an alternative proof
of the ‚Äúfundamental theorem of asset pricing‚Äù, and to a speciÔ¨Åc choice of an equivalent
martingale measure deÔ¨Åned in terms of marginal utility. Section 3.2 contains a detailed
case study describing the interplay between exponential utility and relative entropy.
In Section 3.3, the optimization problem is formulated for general contingent claims.
Typically, optimal proÔ¨Åles will be non-linear functions of a given market portfolio, and
this is one source of the demand for Ô¨Ånancial derivatives. Section 3.4 introduces the
idea of market equilibrium. Prices of risky assets will no longer be given in advance;
they will be derived as equilibrium prices in a microeconomic setting, where different
agents demand contingent claims in accordance with their preferences and with their
budget constraints.
3.1 Portfolio optimization and the absence of arbitrage
Let us consider the one-period market model of Section 1.1 in which d + 1 assets are
priced at time 0 and at time 1. Prices at time 0 are given by the price system
œÄ = (œÄ0, œÄ) = (œÄ0, œÄ1, . . . , œÄd) ‚ààRd+1
+
,
prices at time 1 are modeled by the price vector
S = (S0, S) = (S0, S1, . . . , Sd)
consisting of non-negative random variables Si deÔ¨Åned on some probability space
(, F , P). The 0th asset models a riskless bond, and so we assume that
œÄ0 = 1
and
S0 ‚â°1 + r
for some constant r > ‚àí1. At time t = 0, an investor chooses a portfolio
Œæ = (Œæ0, Œæ) = (Œæ0, Œæ1, . . . , Œæd) ‚ààRd+1
where Œæi represents the amount of shares of the ith asset. Such a portfolio Œæ requires
an initial investment œÄ ¬∑ Œæ and yields at time 1 the random payoff Œæ ¬∑ S.

3.1 Portfolio optimization and the absence of arbitrage
109
Consider a risk-averse economic agent whose preferences are described in terms
of a utility function u, and who wishes to invest a given amount w into the Ô¨Ånancial
market. Recall from DeÔ¨Ånition 2.37 that a real-valued function u is called a utility
function if it is continuous, strictly increasing, and strictly concave. A rational choice
of the investor‚Äôs portfolio Œæ = (Œæ0, Œæ) will be based on the expected utility
E
u(Œæ ¬∑ S)

(3.1)
of the payoff Œæ ¬∑ S at time 1, where the portfolio Œæ satisÔ¨Åes the budget constraint
œÄ ¬∑ Œæ ‚â§w.
(3.2)
Thus, the problem is to maximize the expected utility (3.1) among all portfolios
Œæ ‚ààRd+1 which satisfy the budget constraint (3.2). Here we make the implicit
assumption that the payoff Œæ ¬∑ S is P -a.s. contained in the domain of deÔ¨Ånition of the
utility function u.
In a Ô¨Årst step, we remove the constraint (3.2) by considering instead of (3.1) the
expected utility of the discounted net gain
Œæ ¬∑ S
1 + r ‚àíœÄ ¬∑ Œæ = Œæ ¬∑ Y
earned by a portfolio Œæ = (Œæ0, Œæ). Here Y is the d-dimensional random vector with
components
Y i =
Si
1 + r ‚àíœÄi,
i = 1, . . . , d.
For any portfolio Œæ with œÄ ¬∑ Œæ < w, adding the risk-free investment w ‚àíœÄ ¬∑ Œæ would
lead to the strictly better portfolio (Œæ0+w‚àíœÄ ¬∑Œæ, Œæ). Thus, we can focus on portfolios
Œæ which satisfy œÄ ¬∑ Œæ = w, and then the payoff is an afÔ¨Åne function of the discounted
net gain:
Œæ ¬∑ S = (1 + r)(Œæ ¬∑ Y + w).
Moreover, for any Œæ ‚ààRd there exists a unique num√©raire component Œæ0 ‚ààR such
that the portfolio Œæ := (Œæ0, Œæ) satisÔ¨Åes œÄ ¬∑ Œæ = w.
Let u denote the following transformation of our original utility function u:
u(y) := u

(1 + r)(y + w)

.
Note that u is again a utility function, and that CARA and (shifted) HARA utility
functions are transformed into utility functions in the same class.
Clearly, the original constrained utility maximization problem is equivalent to the
unconstrained problem of maximizing the expected utility E[ u(Œæ ¬∑ Y) ] among all
Œæ ‚ààRd such that Œæ ¬∑ Y is contained in the domain D of u.

110
3 Optimality and equilibrium
Assumption 3.1. We assume one of the following two cases:
(a) D = R. In this case, we will admit all portfolios Œæ ‚ààRd, but we assume that u
is bounded from above.
(b) D = [a, ‚àû) for some a < 0. In this case, we only consider portfolios which
satisfy the constraint
Œæ ¬∑ Y ‚â•a
P -a.s.,
and we assume that the expected utility generated by such portfolios is Ô¨Ånite,
i.e.,
E[ u(Œæ ¬∑ Y) ] < ‚àû
for all Œæ ‚ààRd with Œæ ¬∑ Y ‚â•a P-a.s.
Remark 3.2. Part (a) of this assumption is clearly satisÔ¨Åed in the case of an exponen-
tial utility function u(x) = 1 ‚àíe‚àíŒ±x. Domains of the form D = [a, ‚àû) appear, for
example, in the case of (shifted) HARA utility functions u(x) = log(x ‚àíb) for b < a
and u(x) = 1
Œ≥ (x ‚àíc)Œ≥ for c ‚â§a and 0 < Œ≥ < 1. The integrability assumption in (b)
holds if E[ |Y| ] < ‚àû, because any concave function is bounded above by an afÔ¨Åne
function.
‚ô¶
In order to simplify notations, let us denote by
S(D) := { Œæ ‚ààRd | Œæ ¬∑ Y ‚ààD P-a.s. }
the set of admissible portfolios for D. Clearly, S(D) = Rd if D = R. Our aim is
to Ô¨Ånd some Œæ‚àó‚ààS(D) which is optimal in the sense that it maximizes the expected
utility E[ u(Œæ ¬∑Y) ] among all Œæ ‚ààS(D). In this case, Œæ‚àówill be an optimal investment
strategy into the risky assets. Complementing Œæ‚àówith a suitable num√©raire component
Œæ0 yields a portfolio Œæ‚àó= (Œæ0, Œæ‚àó) which maximizes the expected utility E[u(Œæ ¬∑ S) ]
under the budget constraint œÄ ¬∑ Œæ = w. Our Ô¨Årst result in this section will relate the
existence of such an optimal portfolio to the absence of arbitrage opportunities.
Theorem 3.3. Suppose that the utility function u : D ‚ÜíR satisÔ¨Åes Assumption 3.1.
Then there exists a maximizer of the expected utility
E[ u(Œæ ¬∑ Y) ],
Œæ ‚ààS(D),
if and only if the market model is arbitrage-free. Moreover, there exists at most one
maximizer if the market model is non-redundant in the sense of DeÔ¨Ånition 1.13.
Proof. The uniqueness part of the assertion follows immediately from the strict con-
cavity of the function Œæ ‚ÜíE[ u(Œæ ¬∑ Y) ] for non-redundant market models. As to
existence, we may assume without loss of generality that our model is non-redundant.
If the non-redundance condition (1.8) does not hold, then we deÔ¨Åne a linear space
N ‚äÇRd by
N := { Œ∑ ‚ààRd | Œ∑ ¬∑ Y = 0 P -a.s. }.

3.1 Portfolio optimization and the absence of arbitrage
111
Clearly, Y takes P -a.s. values in the orthogonal complement N‚ä•of N. Moreover,
the no-arbitrage condition (1.3) holds for all Œæ ‚ààRd if and only if it is satisÔ¨Åed for
all Œæ ‚ààN‚ä•. By identifying N‚ä•with some Rn, we arrive at a situation in which the
non-redundance condition (1.8) is satisÔ¨Åed and where we may apply our result for
non-redundant market models.
If the model admits arbitrage opportunities, then a maximizer Œæ‚àóof the expected
utility E[ u(Œæ ¬∑ Y) ] cannot exist: Adding to Œæ‚àósome non-zero Œ∑ ‚ààRd for which
Œ∑ ¬∑ Y ‚â•0 P-a.s., which exists by Lemma 1.3, would yield a contradiction to the
optimality of Œæ‚àó, because then
E[ u(Œæ‚àó¬∑ Y) ] < E[ u((Œæ‚àó+ Œ∑) ¬∑ Y) ].
From now on, we assume that the market model is arbitrage-free. Let us Ô¨Årst
consider the case in which D = [a, ‚àû) for some a ‚àà(‚àí‚àû, 0). Then S(D) is
compact. In order to prove this claim, suppose by way of contradiction that (Œæn) is a
diverging sequence in S(D). By choosing a subsequence if necessary, we may assume
that Œ∑n := Œæn/|Œæn| converges to some unit vector Œ∑ ‚ààRd. Clearly,
Œ∑ ¬∑ Y = lim
n‚Üë‚àû
Œæn ¬∑ Y
|Œæn|
‚â•lim
n‚Üë‚àû
a
|Œæn| = 0
P -a.s.,
and so non-redundance implies that Œ∑ := (‚àíœÄ ¬∑ Œ∑, Œ∑) is an arbitrage-opportunity.
In the next step, we show that our assumptions guarantee the continuity of the
function
S(D) ‚àãŒæ ‚ÜíE[ u(Œæ ¬∑ Y) ],
which, in view of the compactness of S(D), will imply the existence of a maximizer of
the expected utility. To this end, it sufÔ¨Åces to construct an integrable random variable
which dominates u(Œæ ¬∑ Y) for all Œæ ‚ààS(D). DeÔ¨Åne Œ∑ ‚ààRd by
Œ∑i := 0 ‚à®max
Œæ‚ààS(D) Œæi < ‚àû.
Then, Œ∑ ¬∑ S ‚â•Œæ ¬∑ S for Œæ ‚ààS(D), and hence
Œæ ¬∑ Y = Œæ ¬∑ S
1 + r ‚àíœÄ ¬∑ Œæ ‚â§Œ∑ ¬∑ S
1 + r ‚àí0 ‚àß
min
Œæ‚Ä≤‚ààS(D) œÄ ¬∑ Œæ‚Ä≤.
Note that Œ∑ ¬∑ Y is bounded below by ‚àíœÄ ¬∑ Œ∑ and that there exists some Œ± ‚àà(0, 1] such
that Œ±œÄ ¬∑ Œ∑ < |a|. Hence Œ±Œ∑ ‚ààS(D), and our assumptions imply E[ u(Œ±Œ∑ ¬∑ Y) ] <
‚àû. Applying Lemma 3.4 below Ô¨Årst with b := Œ±œÄ ¬∑ Œ∑ and then with b := ‚àí0 ‚àß
minŒæ‚Ä≤‚ààS(D) œÄ ¬∑ Œæ‚Ä≤ shows that
E

u
 Œ∑ ¬∑ S
1 + r ‚àí0 ‚àß
min
Œæ‚Ä≤‚ààS(D) œÄ ¬∑ Œæ‚Ä≤
 
< ‚àû.
This concludes the proof of the theorem in case D = [a, ‚àû).

112
3 Optimality and equilibrium
Let us now turn to the case of a utility function on D = R which is bounded from
above. We will reduce the assertion to a general existence criterion for minimizers of
lower semicontinuous convex functions on Rd, given in Lemma 3.5 below. It will be
applied to the convex function h(Œæ) := ‚àíE[ u(Œæ ¬∑ Y) ]. We must show that h is lower
semicontinuous. Take a sequence (Œæn)n‚ààN in Rd converging to some Œæ. By part (a) of
Assumption 3.1, the random variables ‚àíu(Œæn ¬∑ Y) are uniformly bounded below, and
so we may apply Fatou‚Äôs lemma:
lim inf
n‚Üë‚àûh(Œæn) = lim inf
n‚Üë‚àûE[ ‚àíu(Œæn ¬∑ Y) ] ‚â•E[ ‚àíu(Œæ ¬∑ Y) ] = h(Œæ).
Thus, h is lower semicontinuous.
By our non-redundance assumption, h is strictly convex and admits at most one
minimizer. We claim that the absence of arbitrage opportunities is equivalent to the
following condition:
lim
Œ±‚Üë‚àûh(Œ± Œæ) = +‚àû
for all non-zero Œæ ‚ààRd.
(3.3)
This is just the condition (3.4) required in Lemma 3.5. It follows from (1.3) and
(1.8) that a non-redundant market model is arbitrage-free if and only if each non-zero
Œæ ‚ààRd satisÔ¨Åes P [Œæ ¬∑ Y < 0] > 0. Since the utility function u is strictly increasing
and concave, the set {Œæ ¬∑ Y < 0} can be described as
{ Œæ ¬∑ Y < 0 } = { lim
Œ±‚Üë‚àûu(Œ± Œæ ¬∑ Y) = ‚àí‚àû}
for Œæ ‚ààRd.
The probability of the right-hand set is strictly positive if and only if
lim
Œ±‚Üë‚àûE[ u(Œ±Œæ ¬∑ Y) ] = ‚àí‚àû,
because u is bounded from above. This observation proves that the absence of arbitrage
opportunities is equivalent to the condition (3.3) and completes the proof.
Lemma 3.4. If D = [a, ‚àû), b < |a|, 0 < Œ± ‚â§1, and X is a non-negative random
variable, then
E[ u(Œ±X ‚àíb) ] < ‚àû
"‚áí
E[ u(X) ] < ‚àû.
Proof. As in (A.1) in the proof of Proposition A.4, we obtain that
u(X) ‚àíu(0)
X ‚àí0
‚â§u(Œ±X) ‚àíu(0)
Œ±X ‚àí0
‚â§u(Œ±X ‚àíb) ‚àíu(‚àíb)
Œ±X ‚àíb ‚àí(‚àíb)
.
Multiplying by Œ±X shows that u(X) can be dominated by a multiple of u(Œ±X ‚àíb)
plus some constant.

3.1 Portfolio optimization and the absence of arbitrage
113
Lemma 3.5. Suppose h : Rd ‚ÜíR ‚à™{+‚àû} is a convex and lower semicontinuous
function with h(0) < ‚àû. Then h attains its inÔ¨Åmum provided that
lim
Œ±‚Üë‚àûh(Œ± Œæ) = +‚àû
for all non-zero Œæ ‚ààRd.
(3.4)
Moreover, if h is strictly convex on {h < ‚àû}, then also the converse implication holds:
the existence of a minimizer implies (3.4).
Proof.
First suppose that (3.4) holds.
We will show below that the ‚Äúlevel sets‚Äù
{ x | h(x) ‚â§c } of h are bounded ‚Äì hence compact ‚Äì for c > inf h. Once the
compactness of the level sets is established, it follows that the set
{ x ‚ààRd | h(x) = inf h } =

c>inf h
{ x ‚ààRd | h(x) ‚â§c }
of minimizers of h is non-empty as an intersection of decreasing and non-empty
compact sets.
Suppose c > inf h is such that the level set {h ‚â§c} is not compact, and take
a sequence (xn) in {h ‚â§c} such that |xn| ‚Üí‚àû. By passing to a subsequence if
necessary, we may assume that xn/|xn| converges to some non-zero Œæ. For any Œ± > 0,
h(Œ±Œæ) ‚â§lim inf
n‚Üë‚àûh

Œ± xn
|xn|

= lim inf
n‚Üë‚àûh
 Œ±
|xn| xn +

1 ‚àí
Œ±
|xn|

0

‚â§lim inf
n‚Üë‚àû
 Œ±
|xn| c +

1 ‚àí
Œ±
|xn|

h(0)

= h(0).
Thus, we arrive at a contradiction to condition (3.4). This completes the proof of the
existence of a minimizer under assumption (3.4).
In order to prove the converse implication, suppose that the strictly convex function
h has a minimizer x‚àóbut that there exists a non-zero Œæ ‚ààRd violating (3.4), i.e., there
exists a sequence (Œ±n)n‚ààN and some c < ‚àûsuch that Œ±n ‚Üë‚àûbut h(Œ±nŒæ) ‚â§c for
all n. Let
xn := Œªnx‚àó+ (1 ‚àíŒªn)Œ±nŒæ
where Œªn is such that |x‚àó‚àíxn| = 1, which is possible for all large enough n. By
the compactness of the Euclidean unit sphere centered in x‚àó, we may assume that xn
converges to some x. Then necessarily |x ‚àíx‚àó| = 1. As Œ±nŒæ diverges, we must have
that Œªn ‚Üí1. By using our assumption that h(Œ±nŒæ) is bounded, we obtain
h(x) ‚â§lim inf
n‚Üë‚àûh(xn) ‚â§lim
n‚Üë‚àû

Œªnh(x‚àó) + (1 ‚àíŒªn)h(Œ±nŒæ)

= h(x‚àó).
Hence, x is another minimizer of h besides x‚àó, contradicting the strict convexity of h.
Thus, (3.4) must hold if the strictly convex function h takes on its inÔ¨Åmum.

114
3 Optimality and equilibrium
Remark 3.6. Note that the proof of Theorem 3.3 under Assumption 3.1 (a) did not
use the fact that the components of Y are bounded from below. The result remains
true for arbitrary Y.
‚ô¶
We turn now to a characterization of the solution Œæ‚àóof our utility maximization
problem for continuously differentiable utility functions.
Proposition 3.7. Let u be a continuously differentiable utility function on D such that
E[ u(Œæ ¬∑ Y) ] is Ô¨Ånite for all Œæ ‚ààS(D). Suppose that Œæ‚àóis a solution of the utility
maximization problem, and that one of the following two sets of conditions is satisÔ¨Åed:
‚Ä¢ u is deÔ¨Åned on D = R and is bounded from above.
‚Ä¢ u is deÔ¨Åned on D = [a, ‚àû), and Œæ‚àóis an interior point of S(D).
Then
u‚Ä≤(Œæ‚àó¬∑ Y) |Y| ‚ààL1(P ),
and the following ‚ÄúÔ¨Årst-order condition‚Äù holds:
E[ u‚Ä≤(Œæ‚àó¬∑ Y) Y ] = 0.
(3.5)
Proof. For Œæ ‚ààS(D) and Œµ ‚àà(0, 1] let ŒæŒµ := ŒµŒæ + (1 ‚àíŒµ)Œæ‚àó, and deÔ¨Åne
Œµ := u(ŒæŒµ ¬∑ Y) ‚àíu(Œæ‚àó¬∑ Y)
Œµ
.
The concavity of u implies that Œµ ‚â•Œ¥ for Œµ ‚â§Œ¥, and so
Œµ ‚Üóu‚Ä≤(Œæ‚àó¬∑ Y) (Œæ ‚àíŒæ‚àó) ¬∑ Y
as Œµ ‚Üì0.
Note that our assumptions imply that u(Œæ ¬∑Y) ‚ààL1(P ) for all Œæ ‚ààS(D). In particular,
we have 1 ‚ààL1(P ), so that monotone convergence and the optimality of Œæ‚àóyield
that
0 ‚â•E[ Œµ ] ‚ÜóE[ u‚Ä≤(Œæ‚àó¬∑ Y) (Œæ ‚àíŒæ‚àó) ¬∑ Y ]
as Œµ ‚Üì0.
(3.6)
In particular, the expectation on the right-hand side of (3.6) is Ô¨Ånite.
Both sets of assumptions imply that Œæ‚àóis an interior point of S(D). Hence, we
deduce from (3.6) by letting Œ∑ := Œæ ‚àíŒæ‚àóthat
E[ u‚Ä≤(Œæ‚àó¬∑ Y) Œ∑ ¬∑ Y ] ‚â§0
for all Œ∑ in a small ball centered in the origin of Rd. Replacing Œ∑ by ‚àíŒ∑ shows that
the expectation must vanish.
Remark 3.8. Let us comment on the assumption that the optimal Œæ‚àóis an interior
point of S(D):

3.1 Portfolio optimization and the absence of arbitrage
115
(a) If the non-redundance condition (1.8) is not satisÔ¨Åed, then either each or none of
the solutions to the utility maximization problem is contained in the interior of
S(D). This can be seen by using the reduction argument given at the beginning
of the proof of Theorem 3.3.
(b) Note that Œæ ¬∑ Y is bounded below by ‚àíœÄ ¬∑ Œæ in case Œæ has only non-negative
components. Thus, the interior of S(D) is always non-empty.
(c) As shown by the following example, the optimal Œæ‚àóneed not be contained in the
interior of S(D) and, in this case, the Ô¨Årst-order condition (3.5) will generally
fail.
‚ô¶
Example 3.9. Take r = 0, and let S1 be integrable but unbounded. We choose
D = [a, ‚àû) with a := ‚àíœÄ1, and we assume that P [ S1 ‚â§Œµ ] > 0 for all Œµ > 0.
Then S(D) = [0, 1]. If 0 < E[ S1 ] < œÄ1 then Example 2.43 shows that the optimal
investment is given by Œæ‚àó= 0, and so Œæ‚àólies in the boundary of S(D). Thus, if u is
sufÔ¨Åciently smooth,
E[ u‚Ä≤(Œæ‚àó¬∑ Y) Y ] = u‚Ä≤(0)

E[ S1 ] ‚àíœÄ1
< 0.
The intuitive reason for this failure of the Ô¨Årst-order condition is that taking a short
position in the asset would be optimal as soon as E[ S1 ] < œÄ1. This choice, however,
is ruled out by the constraint Œæ ‚ààS(D).
‚ô¶
Proposition 3.7 yields a formula for the density of a particular equivalent risk-
neutral measure. Recall that P ‚àóis risk-neutral if and only if E‚àó[ Y ] = 0.
Corollary 3.10. Suppose that the market model is arbitrage-free and that the as-
sumptions of Proposition 3.7 are satisÔ¨Åed for a utility function u : D ‚ÜíR and an
associated maximizer Œæ‚àóof the expected utility E[u(Œæ ¬∑ Y)]. Then
dP ‚àó
dP =
u‚Ä≤(Œæ‚àó¬∑ Y)
E[u‚Ä≤(Œæ‚àó¬∑ Y)]
(3.7)
deÔ¨Ånes an equivalent risk neutral measure.
Proof. Proposition 3.7 states that u‚Ä≤(Œæ‚àó¬∑Y)Y is integrable with respect to P and that its
expectation vanishes. Hence, we may conclude that P ‚àóis an equivalent risk-neutral
measure if we can show that P ‚àóis well-deÔ¨Åned by (3.7), i.e., if u‚Ä≤(Œæ‚àó¬∑ Y) ‚ààL1(P ).
Let
c := sup{ u‚Ä≤(x) | x ‚ààD and |x| ‚â§|Œæ‚àó| } ‚â§

u‚Ä≤(a)
for D = [a, ‚àû),
u‚Ä≤(‚àí|Œæ‚àó|)
for D = R,
which is Ô¨Ånite by our assumption that u is continuously differentiable on all of D.
Thus,
0 ‚â§u‚Ä≤(Œæ‚àó¬∑ Y) ‚â§c + u‚Ä≤(Œæ‚àó¬∑ Y)|Y| ¬∑ I{|Y|‚â•1},
and the right-hand side has a Ô¨Ånite expectation.

116
3 Optimality and equilibrium
Remark 3.11. Corollary 3.10 yields an independent and constructive proof of the
‚Äúfundamental theorem of asset pricing‚Äù in the form of Theorem 1.6: Suppose that the
model is arbitrage-free. If Y is P -a.s. bounded, then so is u(Œæ‚àó¬∑ Y), and the measure
P ‚àóof (3.7) is an equivalent risk-neutral measure with a bounded density dP ‚àó/dP . If
Y is unbounded, then we may consider the bounded random vector
Y :=
Y
1 + |Y|,
which also satisÔ¨Åes the no-arbitrage condition (1.3). Let Œæ‚àóbe a maximizer of the
expected utility E[ u(Œæ ¬∑ Y) ]. Then an equivalent risk-neutral measure P ‚àóis deÔ¨Åned
through the bounded density
dP ‚àó
dP := c ¬∑ u‚Ä≤(Œæ‚àó¬∑ Y)
1 + |Y| ,
where c is an appropriate normalizing constant.
‚ô¶
Example 3.12. Consider the exponential utility function
u(x) = 1 ‚àíe‚àíŒ±x
with constant absolute risk aversion Œ± > 0. The requirement that E[ u(Œæ ¬∑Y) ] is Ô¨Ånite
is equivalent to the condition
E[ eŒæ¬∑Y ] < ‚àû
for all Œæ ‚ààRd.
If Œæ‚àóis a maximizer of the expected utility, then the density of the equivalent risk
neutral measure P ‚àóin (3.7) takes the particular form
dP ‚àó
dP =
e‚àíŒ±Œæ‚àó¬∑Y
E[ e‚àíŒ±Œæ‚àó¬∑Y ].
In fact, P ‚àóis independent of Œ± since Œæ‚àómaximizes the expected utility 1‚àíE[ e‚àíŒ±Œæ¬∑Y ]
if and only if Œª‚àó:= ‚àíŒ±Œæ‚àóis a minimizer of the moment generating function
Z(Œª) := E[ eŒª¬∑Y ],
Œª ‚ààRd,
of Y. In Corollary 3.25 below, the measure P ‚àówill be characterized by the fact that
it minimizes the relative entropy with respect to P among the risk-neutral measures
in P ; see DeÔ¨Ånition 3.20 below.
‚ô¶
3.2 Exponential utility and relative entropy
In this section we give a more detailed study of the problem of portfolio optimization
with respect to a CARA utility function
u(x) = 1 ‚àíe‚àíŒ±x

3.2 Exponential utility and relative entropy
117
for Œ± > 0. As in the previous Section 3.1, the problem is to maximize the expected
utility
E[ u(Œæ ¬∑ Y) ]
of the discounted net gain Œæ ¬∑ Y earned by an investment into risky assets. The key
assumption for this problem is that
E[ u(Œæ ¬∑ Y) ] > ‚àí‚àû
for all Œæ ‚ààRd.
(3.8)
Recall from Example 3.12 that the maximization of E[ u(Œæ ¬∑ Y) ] is reduced to the
minimization of the moment generating function
Z(Œª) := E[ eŒª¬∑Y ],
Œª ‚ààRd,
which does not depend on the risk aversion Œ±. The key assumption (3.8) is equivalent
to the condition that
Z(Œª) < ‚àû
for all Œª ‚ààRd.
(3.9)
Throughout this section, we will always assume that (3.9) holds. But we will not need
the assumption that Y is bounded from below (which in our Ô¨Ånancial market model
follows from assuming that asset prices are non-negative); all results remain true for
general random vectors Y; see also Remarks 1.7 and 3.6.
Lemma 3.13. The condition (3.9) is equivalent to
E[ eŒ±|Y| ] < ‚àû
for all Œ± > 0.
Proof. Clearly, the condition in the statement of the lemma implies (3.9). To prove
the converse assertion, take a constant c > 0 such that |x| ‚â§c d
i=1 |xi| for x ‚ààRd.
By H√∂lder‚Äôs inequality,
E[ eŒ±|Y| ] ‚â§E
 
exp
	
Œ±c
d

i=1
|Y i|

 !
‚â§
d
i=1
E[ eŒ±cd|Y i| ]1/d.
In order to show that the ith factor on the right is Ô¨Ånite, take Œª ‚ààRd such that Œªi = Œ±cd
and Œªj = 0 for j Ã∏= i. With this choice,
E[ eŒ±cd|Y i| ] ‚â§E[ eŒª¬∑Y ] + E[ e‚àíŒª¬∑Y ],
which is Ô¨Ånite by (3.9).
DeÔ¨Ånition 3.14. The exponential family of P with respect to Y is the set of measures
{ PŒª | Œª ‚ààRd }
deÔ¨Åned via
dPŒª
dP = eŒª¬∑Y
Z(Œª).

118
3 Optimality and equilibrium
Example 3.15. Suppose that the risky asset S1 has under P a Poisson distribution
with parameter Œ± > 0, i.e., S1 takes values in {0, 1, . . . } and satisÔ¨Åes
P [ S1 = k ] = e‚àíŒ± Œ±k
k! ,
k = 0, 1, . . . .
Then (3.9) is satisÔ¨Åed for Y := S1 ‚àíœÄ1, and S1 has under PŒª a Poisson distribution
with parameter eŒªŒ±. Hence, the exponential family of P generates the family of all
Poisson distributions.
‚ô¶
Example 3.16. Let Y have a standard normal distribution N(0, 1). Then (3.9) is
satisÔ¨Åed, and the distribution of Y under PŒª is equal to the normal distribution N(Œª, 1)
with mean Œª and variance 1.
‚ô¶
Remark 3.17. Two parameters Œª and Œª‚Ä≤ in Rd determine the same element in the
exponential family of P if and only if (Œª ‚àíŒª‚Ä≤) ¬∑ Y = 0 P -almost surely. It follows
that the mapping
Œª ‚àí‚ÜíPŒª
is injective provided that the non-redundance condition holds in the form
Œæ ¬∑ Y = 0 P -a.s.
"‚áí
Œæ = 0.
(3.10)
‚ô¶
In the sequel, we will be interested in the barycenters of the members of the
exponential family of P with respect to Y. We denote
m(Œª) := EŒª[ Y ] =
1
Z(Œª)E[ YeŒª¬∑Y ],
Œª ‚ààRd.
The next lemma shows that m(Œª) can be obtained as the gradient of the logarithmic
moment generating function.
Lemma 3.18. Z is a smooth function on Rd, and the gradient of log Z at Œª is the
expectation of Y under PŒª:
(‚àálog Z)(Œª) = EŒª[ Y ] = m(Œª).
Moreover, the Hessian of log Z at Œª equals the covariance matrix (covPŒª(Y i, Y j))i,j
of Y under the measure PŒª:
‚àÇ2
‚àÇŒªi ‚àÇŒªj log Z(Œª) = covPŒª(Y i, Y j) = EŒª[ Y iY j ] ‚àíEŒª[ Y i ]EŒª[ Y j ].
In particular, log Z is convex.

3.2 Exponential utility and relative entropy
119
Proof. Observe that

‚àÇeŒª¬∑x
‚àÇŒªi
 = |xi| eŒª¬∑x ‚â§exp

(1 + |Œª|) ¬∑ |x|

.
Hence, Lemma 3.13 and Lebesgue‚Äôs dominated convergence theorem justify the in-
terchanging of differentiation and integration (see the ‚Äúdifferentiation lemma‚Äù in [20],
¬ß16, for details).
The following corollary summarizes the results we have obtained so far. Recall
from Section 1.5 the notion of the convex hull (ŒΩ) of the support of a measure ŒΩ on
Rd and the deÔ¨Ånition of the relative interior ri C of a convex set C.
Corollary 3.19. Denote by ¬µ := P ‚ó¶Y ‚àí1 the distribution of Y under P . Then the
function
Œª ‚àí‚ÜíŒª ¬∑ m0 ‚àílog Z(Œª)
takes on its maximum if and only if m0 is contained in the relative interior of the convex
hull of the support of ¬µ, i.e., if and only if
m0 ‚ààri (¬µ).
In this case, any maximizer Œª‚àósatisÔ¨Åes
m0 = m(Œª‚àó) = EŒª‚àó[ Y ].
In particular, the set {m(Œª) | Œª ‚ààRd} coincides with ri (¬µ). Moreover, if the
non-redundance condition (3.10) holds, then there exists at most one maximizer Œª‚àó.
Proof. Taking Y := Y ‚àím0 reduces the problem to the situation where m0 = 0.
ApplyingTheorem 3.3 with the utility function u(z) = 1‚àíe‚àíz shows that the existence
of a maximizer Œª‚àóof ‚àílogZ is equivalent to the absence of arbitrage opportunities.
Corollary 3.10 states that m(Œª‚àó) = 0 and that 0 belongs to Mb(¬µ), where Mb(¬µ) was
deÔ¨Åned in Lemma 1.42. An application of Theorem 1.48 completes the proof.
It will turn out that the maximization problem of the previous corollary is closely
related to the following concept.
DeÔ¨Ånition 3.20. The relative entropy of a probability measure Q with respect to P is
deÔ¨Åned as
H(Q|P ) :=
Ô£±
Ô£≤
Ô£≥
E
 dQ
dP log dQ
dP

if Q ‚â™P ,
+‚àû
otherwise.
Remark 3.21. Jensen‚Äôs inequality applied to the strictly convex function h(x) =
x log x yields
H(Q|P ) = E

h
dQ
dP
 
‚â•h(1) = 0,
(3.11)
with equality if and only if Q = P .
‚ô¶

120
3 Optimality and equilibrium
Example 3.22. Let  be a Ô¨Ånite set and F be its power set. Every probability Q on
(, F ) is absolutely continuous with respect to the uniform distribution P . Let us
denote Q(œâ) := Q[ {œâ} ]. Clearly,
H(Q|P ) =

œâ‚àà
Q(œâ) log Q(œâ)
P (œâ) =

œâ‚àà
Q(œâ) log Q(œâ) + log ||.
The quantity
H(Q) := ‚àí

œâ‚àà
Q(œâ) log Q(œâ)
is usually called the entropy of Q. Observe that H(P ) = log ||, so that
H(Q|P ) = H(P) ‚àíH(Q).
Since the left-hand side is non-negative by (3.11), the uniform distribution P has
maximal entropy among all probability distributions on (, F ).
‚ô¶
Example 3.23. Let ¬µ = N(m, œÉ 2) denote the normal distribution with mean m and
variance œÉ 2 on R. Then, for ¬µ = N(
m,œÉ 2)
d¬µ
d¬µ(x) = œÉ
œÉ exp

‚àí(x ‚àí
m)2
2œÉ 2
+ (x ‚àím)2
2œÉ 2

,
and hence
H(¬µ|¬µ) = 1
2

log œÉ 2
œÉ 2 ‚àí1 + œÉ 2
œÉ 2

+ 1
2
m ‚àí
m
œÉ
2
.
‚ô¶
The following result shows that PŒª is the unique minimizer of the relative entropy
H(Q|P ) among all probability measures Q with EQ[ Y ] = EŒª[ Y ].
Theorem 3.24. Let m0 := m(PŒª0) for some given Œª0 ‚ààRd. Then, for any probability
measure Q on (, F ) such that EQ[ Y ] = m0,
H(Q|P ) ‚â•H(PŒª0|P ) = Œª0 ¬∑ m0 ‚àílog Z(Œª0),
and equality holds if and only if Q = PŒª0. Moreover, Œª0 maximizes the function
Œª ¬∑ m0 ‚àílog Z(Œª)
over all Œª ‚ààRd.
Proof. Let Q be a probability measure on (, F ) such that EQ[ Y ] = m0. We show
Ô¨Årst that for all Œª ‚ààRd
H(Q|P ) = H(Q|PŒª) + Œª ¬∑ m0 ‚àílog Z(Œª).
(3.12)

3.2 Exponential utility and relative entropy
121
To this end, note that both sides of (3.12) are inÔ¨Ånite if Q Ã∏‚â™P . Otherwise
dQ
dP = dQ
dPŒª
¬∑ dPŒª
dP = dQ
dPŒª
¬∑ eŒª¬∑Y
Z(Œª),
and taking logarithms and integrating with respect to Q yields (3.12).
Since H(Q|PŒª) ‚â•0 according to (3.11), we get from (3.12) that
H(Q|P ) ‚â•Œª ¬∑ m0 ‚àílog Z(Œª)
(3.13)
for all Œª ‚ààRd and all measures Q such that EQ[ Y ] = m0. Moreover, equality holds
in (3.13) if and only if H(Q|PŒª) = 0, which is equivalent to Q = PŒª. In this case, Œª
must be such that m(Œª) = m0. In particular, for any such Œª
H(PŒª|P ) = Œª ¬∑ m0 ‚àílog Z(Œª).
Thus, Œª0 maximizes the right-hand side of (3.13), and PŒª0 minimizes the relative
entropy on the set
M0 := { Q | EQ[ Y ] = m0 }.
But the relative entropy H(Q|P ) is a strictly convex functional of Q, and so it can
have at most one minimizer in the convex set M0. Thus, any Œª with m(Œª) = m0
induces the same measure PŒª0.
Taking m0 = 0 in the preceding theorem yields a special equivalent risk-neutral
measure in our Ô¨Ånancial market model, namely the entropy-minimizing risk neutral
measure. Sometimes it is also called the Esscher transform of P . Recall our assump-
tion (3.9).
Corollary 3.25. Suppose the market model is arbitrage-free. Then there exists a
unique equivalent risk-neutral measure P ‚àó‚ààP which minimizes the relative entropy
H( ÀÜP |P) over all ÀÜP ‚ààP. The density of P ‚àóis of the form
dP ‚àó
dP =
eŒª‚àó¬∑Y
E[ eŒª‚àó¬∑Y ],
where Œª‚àódenotes a minimizer of the moment generating function E[ eŒª¬∑Y ] of Y.
Proof. This follows immediately from Corollary 3.19 and Theorem 3.24.
By combining Theorem 3.24 with Remark 3.17, we obtain the following corollary.
It clariÔ¨Åes the question of uniqueness in the representation of points in the relative
interior of (P ‚ó¶Y ‚àí1) as barycenters of the exponential family.
Corollary 3.26. If the non-redundance condition (3.10) holds, then
Œª ‚àí‚Üím(Œª)
is a bijective mapping from Rd to ri (P ‚ó¶Y ‚àí1).

122
3 Optimality and equilibrium
Remark 3.27. It follows from Corollary 3.19 and Theorem 3.24 that for all m ‚àà
ri (P ‚ó¶Y ‚àí1)
min
EQ[ Y ]=m H(Q|P ) = max
Œª‚ààRd[Œª ¬∑ m ‚àílog Z(Œª)].
(3.14)
Here, the right-hand side is the Fenchel‚ÄìLegendre transform of the convex function
log Z evaluated at m ‚ààRd.
‚ô¶
The following theorem shows that the variational principle (3.14) remains true for
all m ‚ààRd, if we replace ‚Äúmin‚Äù and ‚Äúmax‚Äù by ‚Äúinf‚Äù and ‚Äúsup‚Äù.
Theorem 3.28. For m ‚ààRd
inf
EQ[ Y ]=m
H(Q|P ) = sup
Œª‚ààRd[Œª ¬∑ m ‚àílog Z(Œª)].
The proof of this theorem relies on the following two general lemmas.
Lemma 3.29. For any probability measure Q,
H(Q|P ) =
sup
Z‚ààL‚àû(,F ,P )

EQ[ Z ] ‚àílog E[ eZ ]

= sup

EQ[ Z ] ‚àílog E[ eZ ] | eZ ‚ààL1(P )

.
(3.15)
The second supremum is attained by Z := log dQ
dP if Q ‚â™P .
Proof. We Ô¨Årst show ‚â•in (3.15). To this end, we may assume that H(Q|P ) < ‚àû.
For Z with eZ ‚ààL1(P ) let P Z be deÔ¨Åned by
dP Z
dP
=
eZ
E[ eZ ].
Then P Z is equivalent to P and
log dQ
dP = log dQ
dP Z + log dP Z
dP .
Integrating with respect to Q gives
H(Q|P ) = H(Q|P Z) + EQ[ Z ] ‚àílog E[ eZ ].
Since H(Q|P Z) ‚â•0 by (3.11), we have proved that H(Q|P ) is larger than or equal
to both suprema on the right of (3.15).
To prove the reverse inequality, consider Ô¨Årst the case Q Ã∏‚â™P . Take Zn := nIA
where A is such that Q[ A ] > 0 and P [ A ] = 0. Then, as n ‚Üë‚àû,
EQ[ Zn ] ‚àílog E[ eZn ] = n ¬∑ Q[ A ] ‚àí‚Üí‚àû= H(Q|P ).

3.2 Exponential utility and relative entropy
123
Now suppose that Q ‚â™P with density œï = dQ/dP . Then Z := log œï satisÔ¨Åes
eZ ‚ààL1(P ) and
H(Q|P ) = EQ[ Z ] ‚àílog E[ eZ ].
For the Ô¨Årst identity we need an approximation argument. Let Zn = (‚àín)‚à®(log œï)‚àßn.
We split the expectation E[ eZn ] according to the two sets {œï ‚â•1} and {œï < 1}. Using
monotone convergence for the Ô¨Årst integral and dominated convergence for the second
yields
E[ eZn ] ‚àí‚ÜíE[ elog œï ] = 1.
Since x log x ‚â•‚àí1/e, we have œïZn ‚â•‚àí1/e uniformly in n, and Fatou‚Äôs lemma
yields
lim inf
n‚Üë‚àûEQ[ Zn ] = lim inf
n‚Üë‚àûE[ œïZn ] ‚â•E[ œï log œï ] = H(Q|P ).
Putting both facts together shows
lim inf
n‚Üë‚àû

EQ[ Zn ] ‚àílog E[ eZn ]

‚â•H(Q|P ),
and the inequality ‚â§in (3.15) follows.
Remark 3.30. The preceding lemma shows that the relative entropy is monotone with
respect to an increase of the underlying œÉ-algebra: Let P and Q be two probability
measures on a measurable space (, F ), and denote by H(Q|P ) their relative entropy.
Suppose that F0 is a œÉ-Ô¨Åeld such that F0 ‚äÇF and denote by H0(Q|P ) the relative
entropy of Q with respect to P considered as probability measures on the smaller
space (, F0). Then the relation L‚àû(, F0, P ) ‚äÇL‚àû(, F , P ) implies
H0(Q|P ) ‚â§H(Q|P ) ;
in general this inequality is strict.
‚ô¶
Lemma 3.31. For all Œ± ‚â•0, the set
Œ± :=

œï ‚ààL1(, F , P) | œï ‚â•0, E[ œï ] = 1, E[ œï log œï ] ‚â§Œ±

is weakly sequentially compact in L1(, F , P ).
Proof. Let Lp := Lp(, F , P). The set of all P -densities,
D :=

œï ‚ààL1 | œï ‚â•0, E[ œï ] = 1

,
is clearly convex and closed in L1. Hence, this set is also weakly closed in L1 by
Theorem A.59. Moreover, Lemma 3.29 states that for œï ‚ààD
E[ œï log œï ] = sup
Z‚ààL‚àû

E[ Z œï ] ‚àílog E[ eZ ]

.

124
3 Optimality and equilibrium
In particular,
œï ‚ÜíE[ œï log œï ]
is a weakly lower semicontinuous functional on D, and so Œ± is weakly closed. In
addition, Œ± is bounded in L1 and uniformly integrable, due to the criterion of de
la Vall√©e Poussin; see, e.g., Lemma 3 in ¬ß6 of Chapter II of [187]. Applying the
Dunford‚ÄìPettis theorem and the Eberlein‚Äì≈†mulian theorem as stated in Appendix A.7
concludes the proof.
Proof of Theorem 3.28. In view of Theorem 3.24 and inequality (3.13) (whose proof
extends to all m ‚ààRd), it remains to prove that
inf
EQ[ Y ]=m
H(Q|P ) ‚â§sup
Œª‚ààRd[ Œª ¬∑ m ‚àílog Z(Œª)]
(3.16)
for those m which do not belong to ri (¬µ), where ¬µ := P ‚ó¶Y ‚àí1. The right-hand side
of (3.16) is just the Fenchel‚ÄìLegendre transform at m of the convex function log Z
and, thus, denoted (log Z)‚àó(m).
First, we consider the case in which m is not contained in the closure (¬µ) of the
convex hull of the support of ¬µ. Proposition A.1, the separating hyperplane theorem,
yields some Œæ ‚ààRd such that
Œæ ¬∑ m > sup{ Œæ ¬∑ x | x ‚àà(¬µ) } ‚â•sup{ Œæ ¬∑ x | x ‚ààsupp ¬µ }.
By taking Œªn := nŒæ, it follows that
Œªn ¬∑ m ‚àílog Z(Œªn) ‚â•n

Œæ ¬∑ m ‚àí
sup
y‚ààsupp ¬µ
Œæ ¬∑ y

‚àí‚Üí+‚àû
as n ‚Üë‚àû.
Hence, the right-hand side of (3.16) is inÔ¨Ånite if m Ã∏‚àà(¬µ).
It remains to prove (3.16) for m ‚àà(¬µ)\ ri (¬µ) with (log Z)‚àó(m) < ‚àû. Recall
from (1.22) that ri (¬µ) = ri (¬µ). Pick some m1 ‚ààri (¬µ) and let
mn := 1
n m1 +

1 ‚àí1
n

m.
Then mn ‚ààri (¬µ) by (1.21). By the convexity of (log Z)‚àó, we have
lim sup
n‚Üë‚àû
(log Z)‚àó(mn) ‚â§lim sup
n‚Üë‚àû
1
n(log Z)‚àó(m1) + n ‚àí1
n
(log Z)‚àó(m)

= (log Z)‚àó(m).
(3.17)
We also know that to each mn there corresponds a Œªn ‚ààRd such that
mn = EŒªn[ Y ]
and
H(PŒªn|P ) = (log Z)‚àó(mn).
(3.18)

3.3 Optimal contingent claims
125
From (3.17) and (3.18) we conclude that
lim sup
n‚Üë‚àû
H(PŒªn|P ) = lim sup
n‚Üë‚àû
(log Z)‚àó(mn) ‚â§(log Z)‚àó(m) < ‚àû.
In particular, H(PŒªn|P ) is uniformly bounded in n, and Lemma 3.31 implies that ‚Äì
after passing to a suitable subsequence if necessary ‚Äì the densities dPŒªn/dP converge
weakly in L1(, F , P) to a density œï. Let dP‚àû= œï dP . By the weak lower
semicontinuity of
dQ
dP ‚àí‚ÜíH(Q|P ),
which follows from Lemma 3.29, we may conclude that H(P‚àû|P ) ‚â§(log Z)‚àó(m).
The theorem will be proved once we can show that E‚àû[ Y ] = m. To this end, let
Œ≥ := supn(log Z)‚àó(mn), which is a Ô¨Ånite non-negative number by (3.17). Taking
Z := Œ± I{|Y|‚â•c}|Y|
on the right-hand side of (3.15) yields
Œ≥ ‚â•Œ±EŒªn

|Y| ¬∑ I{|Y|‚â•c}

‚àílog E

exp

Œ±|Y|I{|Y|‚â•c}
 
for all n ‚â§‚àû.
Note that the rightmost expectation is Ô¨Ånite due to condition (3.9) and Lemma 3.13.
By taking Œ± large so that Œ≥/Œ± < Œµ/2 for some given Œµ > 0, and by choosing c such
that
log E

exp

Œ±|Y|I{|Y|‚â•c}
 
< Œ±Œµ
2 ,
we obtain that
sup
n‚â§‚àû
EŒªn

|Y| ¬∑ I{|Y|‚â•c}

‚â§Œµ.
But
EŒªn

|Y| ¬∑ I{|Y|<c}

‚àí‚ÜíE‚àû

|Y| ¬∑ I{|Y|<c}

by the weak convergence of dPŒªn/dP ‚ÜídP‚àû/dP , and so taking Œµ ‚Üì0 yields
m = lim
n‚Üë‚àûEŒªn[ Y ] = E‚àû[ Y ],
as desired.
3.3 Optimal contingent claims
In this section we study the problem of maximizing the expected utility
E[ u(X) ]
under a given budget constraint in a broader context. The random variables X will
vary in a general convex class X ‚äÇL0(, F, P ) of admissible payoff proÔ¨Åles. In

126
3 Optimality and equilibrium
the setting of our Ô¨Ånancial market model, this will allow us to explain the demand for
non-linear payoff proÔ¨Åles provided by Ô¨Ånancial derivatives.
In order to formulate the budget constraint in this general context, we introduce a
linear pricing rule of the form
(X) = E‚àó[ X ] = E[ œïX ]
where P ‚àóis a probability measure on (, F ), which is equivalent to P with density
œï. For a given initial wealth w ‚ààR, the corresponding budget set is deÔ¨Åned as
B := { X ‚ààX ‚à©L1(P ‚àó) | E‚àó[ X ] ‚â§w }.
(3.19)
Our optimization problem can now be stated as follows:
Maximize E[ u(X) ] among all X ‚ààB.
(3.20)
Note, however, that we will need some extra conditions which guarantee that the
expectations E[ u(X) ] make sense and are bounded from above.
Remark 3.32. In general, our optimization problem would not be well posed without
the assumption P ‚àó‚âàP . Note Ô¨Årst that it should be rephrased in terms of a class
X of measurable functions on (, F ) since we can no longer pass to equivalence
classes with respect to P . If P is not absolutely continuous with respect to P ‚àóthen
there exists A ‚ààF such that P [ A ] > 0 and P ‚àó[ A ] = 0. For X ‚ààL1(P ‚àó) and
c > 0, the random variable 
X := X + c IA would satisfy E‚àó[ 
X ] = E‚àó[ X ] and
E[ u(
X) ] > E[ u(X) ]. Similarly, if P ‚àó[ A ] > 0 and P [ A ] = 0 then
ÀÜX := X + c ‚àí
c
P ‚àó[ A ] IA
would have the same price as X but higher expected utility. In particular, the expec-
tations in (3.20) would be unbounded in both cases if X is the class of all measurable
functions on (, F ) and if the function u is not bounded from above.
‚ô¶
Remark 3.33. If a solution X‚àówith E[ u(X‚àó) ] < ‚àûexists then it is unique, since
B is convex and u is strictly concave. Moreover, if X = L0(, F , P ) or X =
L0
+(, F , P) then X‚àósatisÔ¨Åes
E‚àó[ X‚àó] = w
since E‚àó[ X‚àó] < w would imply that X := X‚àó+ w ‚àíE‚àó[ X‚àó] is a strictly better
choice, due to the strict monotonicity of u.
‚ô¶
Let us Ô¨Årst consider the unrestricted case X = L0(, F, P ) where any Ô¨Ånite ran-
dom variable on (, F, P) is admissible. The following heuristic argument identiÔ¨Åes
a candidate X‚àófor the maximization of the expected utility. Suppose that a solution
X‚àóexists. For any X ‚ààL‚àû(P ) and any Œª ‚ààR,
XŒª := X‚àó+ Œª

X ‚àíE‚àó[ X ]


3.3 Optimal contingent claims
127
satisÔ¨Åes the budget constraint E‚àó[ XŒª ] = w. A formal computation yields
0 = d
dŒª

Œª=0E[ u(XŒª) ]
= E

u‚Ä≤(X‚àó)(X ‚àíE‚àó[ X ])

= E[ u‚Ä≤(X‚àó)X ] ‚àíE

XE[ u‚Ä≤(X‚àó) ] œï

= E

X(u‚Ä≤(X‚àó) ‚àíc œï)

where c := E[ u‚Ä≤(X‚àó) ]. The identity
E[ X u‚Ä≤(X‚àó) ] = c E[ X œï ]
for all bounded measurable X implies u‚Ä≤(X‚àó) = c œï P-almost surely. Thus, if we
denote by
I := (u‚Ä≤)‚àí1
the inverse function of the strictly decreasing function u‚Ä≤, then X‚àóshould be of the
form
X‚àó= I(c œï).
We will now formulate a set of assumptions on our utility function u which guar-
antee that X‚àó:= I(c œï) is indeed a maximizer of the expected utility, as suggested by
the preceding argument.
Theorem 3.34. Suppose u : R ‚ÜíR is a continuously differentiable utility function
which is bounded from above, and whose derivative satisÔ¨Åes
lim
x‚Üì‚àí‚àûu‚Ä≤(x) = +‚àû.
(3.21)
Assume moreover that c > 0 is a constant such that
X‚àó:= I(c œï) ‚ààL1(P ‚àó).
Then X‚àóis the unique maximizer of the expected utility E[ u(X) ] among all those
X ‚ààL1(P ‚àó) for which E‚àó[ X ] ‚â§E‚àó[ X‚àó]. In particular, X‚àósolves our optimization
problem (3.20) for X = L0(, F , P) if c can be chosen such that E‚àó[ X‚àó] = w.
Proof. Uniqueness follows from Remark 3.33. Since u is bounded from above, its
derivative satisÔ¨Åes
lim
x‚Üë‚àûu‚Ä≤(x) = 0,
in addition to (3.21). Hence, (0, ‚àû) is contained in the range of u‚Ä≤, and it follows that
I(c œï) is P -a.s. well-deÔ¨Åned for all c > 0.
To show the optimality of X‚àó= I(c œï), note that the concavity of u implies that
for any X ‚ààL1(P ‚àó)
u(X) ‚â§u(X‚àó) + u‚Ä≤(X‚àó)(X ‚àíX‚àó) = u(X‚àó) + c œï(X ‚àíX‚àó).

128
3 Optimality and equilibrium
Taking expectations with respect to P yields
E[ u(X) ] ‚â§E[ u(X‚àó) ] + c E‚àó[ X ‚àíX‚àó].
Hence, X‚àóis indeed a maximizer in the class { X ‚ààL1(P ‚àó) | E‚àó[ X ] ‚â§E‚àó[ X‚àó] }.
Example 3.35. Let u(x) = 1 ‚àíe‚àíŒ±x be an exponential utility function with constant
absolute risk aversion Œ± > 0. In this case,
I(y) = ‚àí1
Œ± log y
Œ± .
It follows that
E‚àó[ I(c œï) ] = ‚àí1
Œ± log c
Œ± ‚àí1
Œ± ¬∑ E[ œï log œï ]
= ‚àí1
Œ± log c
Œ± ‚àí1
Œ± ¬∑ H(P ‚àó|P ),
where H(P ‚àó|P ) denotes the relative entropy of P ‚àówith respect to P ; see DeÔ¨Åni-
tion 3.20. Hence, the utility maximization problem can be solved for any w ‚ààR if
and only if the relative entropy H(P ‚àó|P ) is Ô¨Ånite. In this case, the optimal proÔ¨Åle is
given by
X‚àó= ‚àí1
Œ± log œï + w + 1
Œ± H(P ‚àó|P ),
and the maximal value of expected utility is
E[ u(X‚àó) ] = 1 ‚àíexp

‚àíŒ±w ‚àíH(P ‚àó|P )

,
corresponding to the certainty equivalent
w + 1
Œ± H(P ‚àó|P ).
Let us now return to the Ô¨Ånancial market model considered in Section 3.1, and let P ‚àó
be the entropy-minimizing risk-neutral measure constructed in Corollary 3.25. The
density of P ‚àóis of the form
œï =
e‚àíŒ±Œæ‚àó¬∑Y
E[ e‚àíŒ±Œæ‚àó¬∑Y ],
where Œæ‚àó‚ààRd denotes a maximizer of the expected utility E[ u(Œæ ¬∑ Y) ]; see Exam-
ple 3.12. In this case, the optimal proÔ¨Åle takes the form
X‚àó= Œæ‚àó¬∑ Y + w = Œæ‚àó¬∑ S
1 + r ,
i.e., X‚àóis the discounted payoff of the portfolio Œæ‚àó= (Œæ0, Œæ‚àó), where Œæ0 = w ‚àíŒæ‚àó¬∑œÄ
is determined by the budget constraint Œæ ¬∑ œÄ = w. Thus, the optimal proÔ¨Åle is given
by a linear proÔ¨Åle in the given primary assets S0, . . . , Sd: No derivatives are needed
at this point.
‚ô¶

3.3 Optimal contingent claims
129
In most situations it will be natural to restrict the discussion to payoff proÔ¨Åles which
are non-negative. For the rest of this section we will make this restriction, and so the
utility function u may be deÔ¨Åned only on [0, ‚àû). In several applications we will also
use an upper bound given by an F -measurable random variable W :  ‚àí‚Üí[0, ‚àû] .
We include the case W ‚â°+‚àûand deÔ¨Åne the convex class of admissible payoff
proÔ¨Åles as
X := { X ‚ààL0(P ) | 0 ‚â§X ‚â§W P -a.s. }
Thus, our goal is to maximize the expected utility E[ u(X) ] among all X ‚ààB where
the budget set B is deÔ¨Åned in terms of X and P ‚àóas in (3.19), i.e.,
B =

X ‚ààL1(P ‚àó) | 0 ‚â§X ‚â§W P -a.s. and E‚àó[ X ] ‚â§w

.
We Ô¨Årst formulate a general existence result:
Proposition 3.36. Let u be any utility function on [0, ‚àû), and suppose that W is
P-a.s. Ô¨Ånite and satisÔ¨Åes E[ u(W) ] < ‚àû. Then there exists a unique X‚àó‚ààB which
maximizes the expected utility E[ u(X) ] among all X ‚ààB.
Proof. Take a sequence (Xn) in B with E‚àó[ Xn ] ‚â§w and such that E[ u(Xn) ]
converges to the supremum of the expected utility. Since supn |Xn| ‚â§W < ‚àû
P-almost surely, we obtain from Lemma 1.69 a sequence

Xn ‚ààconv{ Xn, Xn+1, . . . }
of convex combinations which converge almost-surely to some 
X. Clearly, every 
Xn
is contained in B. Fatou‚Äôs lemma implies
E‚àó[ 
X ] ‚â§lim inf
n‚Üë‚àûE‚àó[ 
Xn ] ‚â§w,
and so 
X ‚ààB. Each 
Xn can be written as m
i=1 Œ±n
i Xni for indices ni ‚â•n and
coefÔ¨Åcients Œ±n
i ‚â•0 summing up to 1. Hence,
u(
Xn) ‚â•
m

i=1
Œ±n
i u(Xni),
and it follows that
E[ u(
Xn) ] ‚â•inf
m‚â•n E[ u(Xm) ].
By dominated convergence,
E[ u(
X) ] = lim
n‚Üë‚àûE[ u(
Xn) ],
and the right-hand side is equal to the supremum of the expected utility.

130
3 Optimality and equilibrium
Remark 3.37. The argument used to prove the preceding proposition works just as
well in the following general setting. Let U : B ‚ÜíR be a concave functional on a
set B of random variables deÔ¨Åned on a probability space (, F , P ) and with values
in Rn. Assume that
‚Ä¢ B is convex and closed under P -a.s. convergence,
‚Ä¢ There exists a random variable W ‚ààL0
+(, F , P ) with |Xi| ‚â§W < ‚àûP -a.s.
for each X = (X1, . . . , Xn) ‚ààB,
‚Ä¢ sup
X‚ààB
U(X) < ‚àû,
‚Ä¢ U is upper semicontinuous with respect to P -a.s. convergence.
Then there exists an X‚àó‚ààB which maximizes U on B, and X‚àóis unique if U is
strictly concave. As a special case, this includes the utility functionals
U(X) = inf
Q‚ààQ EQ[ u(X) ],
appearing in a robust Savage representation of preferences on n-dimensional asset
proÔ¨Åles, where u is a utility function on Rn and Q is a set of probability measures
equivalent to P; see Section 2.5.
‚ô¶
We turn now to a characterization of the optimal proÔ¨Åle X‚àóin terms of the inverse
of the derivative u‚Ä≤ of u in case where u is continuously differentiable on (0, ‚àû). Let
a := lim
x‚Üë‚àûu‚Ä≤(x) ‚â•0
and
b := u‚Ä≤(0+) = lim
x‚Üì0 u‚Ä≤(x) ‚â§+‚àû.
We deÔ¨Åne
I + : (a, b) ‚àí‚Üí(0, ‚àû).
as the continuous, bijective, and strictly decreasing inverse function of u‚Ä≤ on (a, b),
and we extend I + to the full half axis [0, ‚àû] by setting
I +(y) :=

0
for y ‚â•b,
+‚àû
for y ‚â§a.
(3.22)
With this convention, I + : [0, ‚àû] ‚Üí[0, ‚àû] is continuous.
Remark 3.38. If u is a utility function deÔ¨Åned on all of R, the function I + is the
inverse of the restriction of u‚Ä≤ to [0, ‚àû). Thus, I + is simply the positive part of
the function I = (u‚Ä≤)‚àí1. For instance, in the case of an exponential utility function
u(x) = 1 ‚àíe‚àíŒ±x, we have a = 0, b = Œ±, and
I +(y) =
 1
Œ± log y
Œ±
‚àí
=

I(y)
+,
y ‚â•0.
(3.23)
‚ô¶

3.3 Optimal contingent claims
131
Theorem 3.39. Assume that X‚àó‚ààB is of the form
X‚àó= I +(c œï) ‚àßW
for some constant c > 0 such that E‚àó[ X‚àó] = w. If E[ u(X‚àó) ] < ‚àûthen X‚àóis the
unique maximizer of the expected utility E[ u(X) ] among all X ‚ààB.
Proof. In a Ô¨Årst step, we consider the function
v(y, œâ) :=
sup
0‚â§x‚â§W(œâ)

u(x) ‚àíxy

(3.24)
deÔ¨Åned for y ‚ààR and œâ ‚àà. Clearly, for each œâ with W(œâ) < ‚àûthe supremum
above is attained in a unique point x‚àó(y) ‚àà[0, W(œâ)], which satisÔ¨Åes
x‚àó(y) = 0
‚áê‚áí
u‚Ä≤(x) < y
for all x ‚àà

0, W(œâ)

,
x‚àó(y) = W(œâ)
‚áê‚áí
u‚Ä≤(x) > y
for all x ‚àà

0, W(œâ)

.
Moreover, y = u‚Ä≤(x‚àó(y)) if x‚àó(y) is an interior point of the interval [0, W(œâ)]. It
follows that
x‚àó(y) = I +(y) ‚àßW(œâ),
or
X‚àó= x‚àó(c œï)
on {W < ‚àû}.
(3.25)
If W(œâ) = +‚àû, then the supremum in (3.24) is not attained if and only if
u‚Ä≤(x) > y for all x ‚àà(0, ‚àû). By our convention (3.22), this holds if and only if
y ‚â§a and hence I +(y) = +‚àû. But our assumptions on X‚àóimply that I +(c œï) < ‚àû
P-a.s. on {W = ‚àû}, and hence that
X‚àó= x‚àó(c œï)
P-a.s. on {W = ‚àû}.
(3.26)
Putting (3.24), (3.25), and (3.26) together yields
u(X‚àó) ‚àíX‚àóc œï = v(cœï, ¬∑)
P -a.s.
Applied to an arbitrary X ‚ààB, this shows that
u(X‚àó) ‚àíc œïX‚àó‚â•u(X) ‚àíc œïX
P -a.s.
Taking expectations gives
E[ u(X‚àó) ] ‚â•E[ u(X) ] + c ¬∑ E‚àó[ X‚àó‚àíX ] ‚â•E[ u(X) ].
Hence, X‚àómaximizes the expected utility on B.
Uniqueness follows from Re-
mark 3.33.
In the following examples, we study the application of the preceding theorem to
CARA and HARA utility functions. For simplicity we consider only the case W ‚â°‚àû.
The extension to a non-trivial bound W is straightforward.

132
3 Optimality and equilibrium
Example 3.40. For an exponential utility function u(x) = 1‚àíe‚àíŒ±x we have by (3.23)
œïI +(y œï) = 1
Œ± œï
	
log
	y œï
Œ±


‚àí
= 1
y h
	y œï
Œ±

,
where h(x) = (x log x)‚àí. Since h is bounded by e‚àí1, it follows that œïI +(y œï) belongs
to L1(P ) for all y > 0. Thus,
g(y) := E‚àó[ I +(y œï) ] = 1
y E
 
h
	y œï
Œ±

 !
decreases continuously from +‚àûto 0 as y increases from 0 to ‚àû, and there exists a
unique c with g(c) = w. The corresponding proÔ¨Åle
X‚àó:= I +(c œï)
maximizes the expected utility E[ u(X) ] among all X ‚â•0. Let us now return to
the special situation of the Ô¨Ånancial market model of Section 3.1, and take P ‚àóas the
entropy-minimizing risk-neutral measure of Corollary 3.25. Then the optimal proÔ¨Åle
X‚àótakes the form
X‚àó= (Œæ‚àó¬∑ Y ‚àíK)+,
where Œæ‚àóis the maximizer of the expected utility E[ u(Œæ ¬∑ Y) ], and where K is given
by
K = 1
Œ± log c
Œ± ‚àí1
Œ± log E[ e‚àíŒ±Œæ‚àó¬∑Y ] = 1
Œ± log c
Œ± + 1
Œ± H(P ‚àó|P ).
Note that X‚àóis a linear combination of the primary assets only in the case where
Œæ‚àó¬∑ Y ‚â•K P -almost surely. In general, X‚àóis a basket call option on the attainable
asset w + (1 + r)Œæ‚àó¬∑ Y ‚ààV with strike price w + (1 + r)K. Thus, a demand for
derivatives appears.
‚ô¶
Example 3.41. If u is a HARA utility function of index Œ≥ ‚àà[0, 1) then u‚Ä≤(x) = xŒ≥ ‚àí1,
hence
I +(y) = y‚àí
1
1‚àíŒ≥
and
I +(y œï) = y‚àí
1
1‚àíŒ≥ ¬∑ œï‚àí
1
1‚àíŒ≥ .
In the logarithmic case Œ≥ = 0, we assume that the relative entropy H(P |P ‚àó) of P
with respect to P ‚àóis Ô¨Ånite. Then
X‚àó= w
œï = w dP
dP ‚àó
is the unique maximizer, and the maximal value of expected utility is
E[ log X‚àó] = log w + H(P |P ‚àó).

3.3 Optimal contingent claims
133
If Œ≥ ‚àà(0, 1) and
E

œï‚àí
Œ≥
1‚àíŒ≥ 
= E‚àó
œï‚àí
1
1‚àíŒ≥ 
< ‚àû,
then the unique optimal proÔ¨Åle is given by
X‚àó= w

E

œï‚àí
Œ≥
1‚àíŒ≥ ‚àí1œï‚àí
1
1‚àíŒ≥ ,
and the maximal value of expected utility is equal to
E[ u(X‚àó) ] = 1
Œ≥ wŒ≥ 
E

œï‚àí
Œ≥
1‚àíŒ≥ 1‚àíŒ≥ .
‚ô¶
The following corollary gives a simple condition on W which guarantees the
existence of the maximizer X‚àóin Theorem 3.39.
Corollary 3.42. If E[ u(W) ] < ‚àûand if 0 < w < E‚àó[ W ] < ‚àû, then there exists
a unique constant c > 0 such that
X‚àó= I +(c œï) ‚àßW
satisÔ¨Åes E‚àó[ X‚àó] = w. In particular, X‚àóis the unique maximizer of the expected
utility E[ u(X) ] among all X ‚ààB.
Proof. For any Œ≤ ‚àà(0, ‚àû),
y ‚ÜíI +(y) ‚àßŒ≤
is a continuous decreasing function with limy‚Üëb I +(y) ‚àßŒ≤ = 0 and I +(y) ‚àßŒ≤ = Œ≤
for all y ‚â§u‚Ä≤(Œ≤). Hence, dominated convergence implies that the function
g(y) := E‚àó[ I +(y œï) ‚àßW ],
is continuous and decreasing with
lim
y‚Üë‚àûg(y) = 0 < w < E‚àó[ W ] = lim
y‚Üì0 g(y).
Moreover, g is even strictly decreasing on { y | 0 < g(y) < E‚àó[ W ] }. Hence,
there exists a unique c with g(c) = w, and Theorem 3.39 yields the optimality of the
corresponding X‚àó.
Let us now extend the discussion to the case where preferences themselves are
uncertain. This additional uncertainty can be modelled by incorporating the choice of
a utility function into the description of possible scenarios; for an axiomatic discussion
see [130]. More precisely, we assume that preferences are described by a measurable
function u on [0, ‚àû) √ó  such that u(¬∑, œâ) is a utility function on [0, ‚àû) which is

134
3 Optimality and equilibrium
continuously differentiable on (0, ‚àû). For each œâ ‚àà, the inverse of u‚Ä≤(¬∑, œâ) is
extended as above to a function
I +(¬∑, œâ) : [0, ‚àû] ‚àí‚Üí[0, ‚àû].
Using exactly the same arguments as above, we obtain the following extension of
Corollary 3.42 to the case of random preferences:
Corollary 3.43. If E[ u(W, ¬∑) ] < ‚àûand if 0 < w < E‚àó[ W ] < ‚àû, then there exists
a unique constant c > 0 such that
X‚àó(œâ) : = I +
c œï(œâ), œâ

‚àßW(œâ)
is the unique maximizer of the expected utility
E[ u(X, ¬∑) ] =

u(X(œâ), œâ) P (dœâ)
among all X ‚ààB.
So far, we have discussed the structure of asset proÔ¨Åles which are optimal with
respect to a Ô¨Åxed utility function u. Let us now introduce an optimization problem
with respect to the uniform order ‚âΩuni as discussed in Section 2.4. The partial order ‚âΩuni
can be viewed as a reÔ¨Çexive and transitive relation on the space of Ô¨Ånancial positions
X := L1
+(, F , P )
by letting
X ‚âΩuni Y : ‚áê‚áí¬µX ‚âΩuni ¬µY
‚áê‚áíE[ u(X) ] ‚â•E[ u(Y) ]
for all utility functions u,
(3.27)
where ¬µX and ¬µY denote the distributions of X and Y under P . Note that X ‚âΩuni
Y ‚âΩuni X if and only if X and Y have the same distribution; see Remark 2.59. Thus,
the relation ‚âΩuni is antisymmetric on the level of distributions but not on the level of
Ô¨Ånancial positions.
Let us now Ô¨Åx a position X0 ‚ààX such that E‚àó[ X0 ] < ‚àû, and let us try to
minimize the cost among all positions X ‚ààX which are uniformly at least as attractive
as X0:
Minimize E‚àó[ X ] among all X ‚âΩuni X0.
In order to describe the minimal cost and the minimizing proÔ¨Åle, let us denote by Fœï
and FX0 the distribution functions and by qœï and qX0 quantile functions of œï and X0;
see Appendix A.3.
Theorem 3.44. For any X ‚ààX such that X ‚âΩuni X0,
E‚àó[ X ] ‚â•
 1
0
qœï(1 ‚àís) qX0(s) ds.
(3.28)

3.3 Optimal contingent claims
135
The lower bound is attained by X‚àó= f (œï), where f is the decreasing function on
[0, ‚àû) deÔ¨Åned by
f (x) := qX0

1 ‚àíFœï(x)

if x is a continuity point of Fœï, and by
f (x) :=
1
Fœï(x) ‚àíFœï(x‚àí)
 Fœï(x)
Fœï(x‚àí)
qX0(1 ‚àít) dt
otherwise.
The proof will use the following lemma, which yields another characterization of
the relation ‚âΩuni.
Lemma 3.45. For two probability measures ¬µ and ŒΩ on R, the following conditions
are equivalent:
(a) ¬µ ‚âΩuni ŒΩ.
(b) For all decreasing functions h : (0, 1) ‚Üí[0, ‚àû),
 1
0
h(t)q¬µ(t) dt ‚â•
 1
0
h(t)qŒΩ(t) dt,
(3.29)
where q¬µ and qŒΩ are quantile functions of ¬µ and ŒΩ.
(c) The relation (3.29) holds for all bounded decreasing functions h : (0, 1) ‚Üí
[0, ‚àû).
Proof. The relation ¬µ ‚âΩuni ŒΩ is equivalent to
 y
0
q¬µ(t) dt ‚â•
 y
0
qŒΩ(t) dt
for all y ‚àà[0, 1];
see Theorem 2.58. The implication (c) ‚áí(a) thus follows by taking h = I(0,t]. For the
proof of (a) ‚áí(b), we may assume without loss of generality that h is left-continuous.
Then there exists a positive Radon measure Œ∑ on (0, 1] such that h(t) = Œ∑([t, 1]).
Fubini‚Äôs theorem yields
 1
0
h(t) q¬µ(t) dt =
 1
0
 y
0
q¬µ(t) dt Œ∑(dy)
‚â•
 1
0
 y
0
qŒΩ(t) dt Œ∑(dy)
=
 1
0
h(t) qŒΩ(t) dt.

136
3 Optimality and equilibrium
Proof ofTheorem 3.44. Using the Ô¨Årst Hardy‚ÄìLittlewood inequality inTheoremA.24,
we see that
E‚àó[ X ] = E[ Xœï ] ‚â•
 1
0
qœï(1 ‚àít) qX(t) dt,
where qX is a quantile function for X. Taking h(t) := qœï(1‚àít) and using Lemma 3.45
thus yields (3.28).
Let us now turn to the identiÔ¨Åcation of the optimal proÔ¨Åle. Note that the function
f deÔ¨Åned in the assertion satisÔ¨Åes
f (qœï) = EŒª[ g | qœï ]
(3.30)
where g is deÔ¨Åned by g(t) = qX0(1‚àít), and where EŒª[ ¬∑ | qœï ] denotes the conditional
expectation with respect to qœï under the Lebesgue measure Œª on (0, 1). Let us show
that X‚àó= f (œï) satisÔ¨Åes X‚àó‚âΩuni X0. Indeed, for any utility function u
E[ u(X‚àó) ] = E

u

f (œï)
 
=
 1
0
u

f (qœï)

dt
‚â•
 1
0
u

qX0(1 ‚àít)

dt =
 1
0
u

qX0(t)

dt
= E[ u(X0) ],
where we have applied Lemma A.19 and Jensen‚Äôs inequality for conditional expecta-
tions. Moreover, X‚àóattains the lower bound in (3.28):
E‚àó[ X‚àó] = E[ f (œï) œï ] =
 1
0
f

qœï(t)

qœï(t) dt
=
 1
0
qX0(1 ‚àít) qœï(t) dt =
 1
0
qX0(t) qœï(1 ‚àít) dt,
due to (3.30).
Remark 3.46. The solution X‚àóhas the same expectation under P as X0. Indeed,
(3.30) shows that
E[ X‚àó] = E[ f (œï) ] =
 1
0
f (qœï(t)) dt =
 1
0
qX0(1 ‚àít) dt = E[ X0 ].
‚ô¶
Remark 3.47. The lower bound in (3.28) may be viewed as a ‚Äúreservation price‚Äù for
X0 in the following sense. Let X0 be a Ô¨Ånancial position, and let X be any class of
Ô¨Ånancial positions such that X ‚ààX is available at price œÄ(X). For a given relation ‚™∞
on X ‚à™{X0},
œÄR(X0) := inf{ œÄ(X) | X ‚ààX, X ‚™∞X0 }
is called the reservation price of X0 with respect to X, œÄ, and ‚™∞.

3.4 Microeconomic equilibrium
137
If X is the space of constants with œÄ(c) = c, and if the relation ‚™∞is of von
Neumann‚ÄìMorgenstern type with some utility function u, then œÄR(X0) reduces to the
certainty equivalent of X0 with respect to u; see (2.9).
In the context of the optimization problem (3.20), where
X ‚™∞X0 : ‚áê‚áí
E[ u(X) ] ‚â•E[ u(X0) ],
the reservation price is given by E‚àó[ X‚àó], where X‚àóis the utility maximizer in the
budget set deÔ¨Åned by w := E‚àó[ X0 ].
In the context of the Ô¨Ånancial market model of Chapter 1, we can take X as the
space V of attainable claims with
V ‚™∞X0 : ‚áê‚áí
V ‚â•X0 P -a.s.
and œÄ(V ) = Œæ ¬∑ œÄ for V = Œæ ¬∑ S. In this case, the reservation price œÄR(X0) coincides
with the upper bound œÄsup(X0) of the arbitrage-free prices for X0; see Theorem 1.31. ‚ô¶
3.4 Microeconomic equilibrium
The aim of this section is to provide a brief introduction to the theory of market
equilibrium. Prices of assets will no longer be given in advance. Instead, they will
be derived from ‚ÄúÔ¨Årst principles‚Äù in a microeconomic setting where different agents
demand asset proÔ¨Åles in accordance with their preferences and with their budget
constraints. These budget constraints are determined by a given price system. The
role of equilibrium prices consists in adjusting the constraints in such a way that the
resulting overall demand is matched by the overall supply of assets.
Consider a Ô¨Ånite set A of economic agents and a convex set X ‚äÇL0(, F , P ) of
admissible claims. At time t = 0, each agent a ‚ààA has an initial endowment whose
discounted payoff at time t = 1 is described by an admissible claim
Wa ‚ààX,
a ‚ààA.
The aggregated claim
W :=

a‚ààA
Wa
is also called the market portfolio. Agents may want to exchange their initial endow-
ment Wa against some other admissible claim Xa ‚ààX. This could lead to a new
allocation (Xa)a‚ààA if the resulting total demand matches the overall supply:
DeÔ¨Ånition 3.48. Acollection(Xa)a‚ààA ‚äÇXiscalledafeasibleallocation ifitsatisÔ¨Åes
the market clearing condition

a‚ààA
Xa = W
P-a.s.
(3.31)

138
3 Optimality and equilibrium
The budget constraints will be determined by a linear pricing rule of the form
(X) := E[ œï X ],
X ‚ààX,
where œï is a price density, i.e., an integrable function on (, F ) such that œï > 0 P -a.s.
and E[ |Wa| œï ] < ‚àûfor all a ‚ààA. To any such œï we can associate a normalized
price measure P œï ‚âàP with density œïE[ œï ]‚àí1.
Remark 3.49. In the context of our one-period model of a Ô¨Ånancial market with
d risky assets S1, . . . , Sd and a risk-free asset S0 ‚â°1 + r, P œï is a risk-neutral
measure if the pricing rule  is consistent with the given price vector œÄ = (œÄ0, œÄ),
where œÄ0 = 1. In this section, the pricing rule will be derived as an equilibrium
price measure, given the agents‚Äô preferences and endowments. In particular, this will
amount to an endogenous derivation of the price vector œÄ. In a situation where the
structure of the equilibrium is already partially known in the sense that it is consistent
with the given price vector œÄ, the construction of a microeconomic equilibrium yields
a speciÔ¨Åc choice of a martingale measure P ‚àó, i.e., of a speciÔ¨Åc extension of œÄ from
the space V of attainable payoffs to a larger space of admissible claims.
‚ô¶
The preferences of agent a ‚ààA are described by a utility function ua. Given the
price density œï, an agent a ‚ààA may want to exchange the endowment Wa for an
admissible claim Xœï
a which maximizes the expected utility
E[ ua(X) ]
among all X in the agent‚Äôs budget set
Ba(œï) := { X ‚ààX | E[ œï X ] ‚â§E[ œï Wa ] }
= { X ‚ààX | Eœï[ X ] ‚â§Eœï[ Wa ] }.
In this case, we will say that Xœï
a solves the utility maximization problem of agent a ‚ààA
with respect to the price density œï. The key problem is whether œï can be chosen in
such a way that the requested proÔ¨Åles Xœï
a , a ‚ààA, form a feasible allocation.
DeÔ¨Ånition 3.50. A price density œï‚àótogether with a feasible allocation (X‚àó
a)a‚ààA is
called an Arrow‚ÄìDebreu equilibrium if each X‚àó
a solves the utility maximization prob-
lem of agent a ‚ààA with respect to œï‚àó.
Thus, thepricedensityœï‚àóappearinginanArrow‚ÄìDebreuequilibriumdecentralizes
the crucial problem of implementing the global feasibility constraint (3.31). This
is achieved by adjusting the budget sets in such a way that the resulting demands
respectthemarketclearingcondition, eventhoughtheindividualdemandisdetermined
without any regard to this global constraint.
Example 3.51. Assume that each agent a ‚ààA has an exponential utility function
with parameter Œ±a > 0, and let us consider the unconstrained case
X = L0(, F , P ).

3.4 Microeconomic equilibrium
139
In this case, there is a unique equilibrium, and it is easy to describe it explicitly. For
a given pricing measure P ‚àó‚âàP such that Wa ‚ààL1(P ‚àó) for all a ‚ààA, the utility
maximization problem for agent a ‚ààA can be solved if and only if H(P ‚àó|P ) < ‚àû,
and in this case the optimal demand is given by
X‚àó
a = ‚àí1
Œ±a
log œï‚àó+ w‚àó
a + 1
Œ±a
H(P ‚àó|P )
where
w‚àó
a := E‚àó[ Wa ] ;
see Example 3.35. The market clearing condition (3.31) takes the form
W = ‚àí1
Œ± log œï‚àó+

a‚ààA
w‚àó
a + 1
Œ± H(P ‚àó|P )
where Œ± is deÔ¨Åned via
1
Œ± =

a‚ààA
1
Œ±a
.
(3.32)
Thus, a normalized equilibrium price density must have the form
œï‚àó=
e‚àíŒ±W
E[ e‚àíŒ±W ],
(3.33)
and this shows uniqueness. As to existence, let us assume that
E[ |Wa|e‚àíŒ±W ] < ‚àû,
a ‚ààA ;
this condition is satisÔ¨Åed if, e.g., the random variables Wa are bounded from below.
DeÔ¨Åne P ‚àó‚âàP via (3.33). Then
H(P ‚àó|P ) = ‚àíŒ± E‚àó[ W ] ‚àílog E[ e‚àíŒ±W ] < ‚àû,
and the optimal proÔ¨Åle for agent a ‚ààA with respect to the pricing measure P ‚àótakes
the form
X‚àó
a = w‚àó
a + Œ±
Œ±a

W ‚àíE‚àó[ W ]

.
(3.34)
Since

a‚ààA
w‚àó
a = E‚àó[ W ],
the allocation (X‚àó
a)a‚ààA is feasible, and so we have constructed an Arrow‚ÄìDebreu
equilibrium. Thus, the agents share the market portfolio in a linear way, and in
inverse proportion to their risk aversion.

140
3 Optimality and equilibrium
Let us now return to our Ô¨Ånancial market model of Section 3.1. We assume that
the initial endowment of agent a ‚ààA is given by a portfolio Œ∑a ‚ààRd+1 so that the
discounted payoff at time t = 1 is
Wa = Œ∑a ¬∑ S
1 + r ,
a ‚ààA.
In this case, the market portfolio is given by W = Œ∑ ¬∑ S/(1 + r) with Œ∑ := 
a Œ∑a =
(Œ∑0, Œ∑). The optimal claim for agent a ‚ààA in (3.34) takes the form
X‚àó
a = Œ∑a ¬∑ œÄ + Œ±
Œ±a
Œ∑ ¬∑

S
1 + r ‚àíœÄ

,
where œÄ = (1, œÄ) and
œÄi = E‚àó

Si
1 + r

for i = 1, . . . , d.
Thus, we could have formulated the equilibrium problem within the smaller space
X = V of attainable payoffs, and the resulting equilibrium allocation would have been
the same. In particular, the extension of X from V to the general space L0(, F , P )
of admissible claims does not create a demand for derivatives in our present example.
‚ô¶
From now on we assume that the set of admissible claims is given by
X = L0
+(, F , P ),
and that the preferences of agent a ‚ààA are described by a utility function ua :
[0, ‚àû) ‚ÜíR which is continuously differentiable on (0, ‚àû). In particular, the initial
endowments Wa are assumed to be non-negative. Moreover, we assume
P [ Wa > 0 ] Ã∏= 0
for all a ‚ààA.
and
E[ W ] < ‚àû.
(3.35)
A function œï ‚ààL1(, F , P) such that œï > 0 P -a.s. is a price density if
E[ œï W ] < ‚àû;
note that this condition is satisÔ¨Åed as soon as œï is bounded, due to our assumption
(3.35). Given a price density œï, each agent faces exactly the optimization problem
discussed in Section 3.3 in terms of the price measure P œï ‚âàP . Thus, if (X‚àó
a)a‚ààA
is an equilibrium allocation with respect to the price density œï‚àó, feasibility implies
0 ‚â§X‚àó
a ‚â§W, and so it follows as in the proof of Corollary 3.42 that
X‚àó
a = I +
a (ca œï‚àó),
a ‚ààA,
(3.36)

3.4 Microeconomic equilibrium
141
with positive constants ca > 0. Note that the market clearing condition
W =

a‚ààA
X‚àó
a =

a‚ààA
I +
a (ca œï‚àó)
will determine œï‚àóas a decreasing function of W, and thus the optimal proÔ¨Åles X‚àó
a will
be increasing functions of W.
Before we discuss the existence of an Arrow‚ÄìDebreu equilibrium, let us Ô¨Årst illus-
trate the structure of such equilibria by the following simple examples. In particular,
they show that an equilibrium allocation will typically involve non-linear derivatives
of the market portfolio W.
Example 3.52. Let us consider the constrained version of the preceding example
where agents a ‚ààA have exponential utility functions with parameters Œ±a > 0.
DeÔ¨Åne
w := sup{ c | W ‚â•c P -a.s. } ‚â•0,
and let P ‚àóbe the measure deÔ¨Åned via (3.33). For any agent a ‚ààA such that
w‚àó
a := E‚àó[ Wa ] ‚â•Œ±
Œ±a

E‚àó[ W ] ‚àíw

,
(3.37)
the unrestricted optimal proÔ¨Åle
X‚àó
a = w‚àó
a + Œ±
Œ±a

W ‚àíE‚àó[ W ]

satisÔ¨Åes X‚àó
a ‚â•0 P -a.s. Thus, if all agents satisfy the requirement (3.37) then the
unrestricted equilibrium computed in Example 3.51 is a forteriori an Arrow‚ÄìDebreu
equilibrium in our present context. In this case, there is no need for non-linear deriva-
tives of the market portfolio.
If some agents do not satisfy the requirement (3.37) then the situation becomes
moreinvolved, andtheequilibriumallocationwillneedderivativessuchascalloptions.
Let us illustrate this effect in the simple setting where there are only two agents
a ‚ààA = {1, 2}. Suppose that agent 1 satisÔ¨Åes condition (3.37), while agent 2 does
not. For c ‚â•0, we deÔ¨Åne the measure P c ‚âàP in terms of the density
œïc :=
Ô£±
Ô£¥Ô£¥Ô£¥Ô£≤
Ô£¥Ô£¥Ô£¥Ô£≥
1
Z1
e‚àíŒ±1W
on {W ‚â§c},
1
Z2
e‚àíŒ±W
on {W ‚â•c},
where Œ± is given by (3.32), and where the constants Z1 and Z2 are determined by the
continuity condition
log Z2 ‚àílog Z1 = c(Œ±1 ‚àíŒ±)

142
3 Optimality and equilibrium
and by the normalization E[ œïc ] = 1. Note that P 0 = P ‚àówith P ‚àóas in (3.33).
Consider the equation
Œ±
Œ±2
Ec[ (W ‚àíc)+ ] = wc
2 := Ec[ W2 ].
(3.38)
Both sides are continuous in c.
As c increases from 0 to +‚àû, the left-hand
side decreases from
Œ±
Œ±2 E‚àó[ W ] to 0, while wc
2 goes from w0
2 <
Œ±
Œ±2 E‚àó[ W ] to
E‚àû[ W2 ] > 0. Thus, there exists a solution c of (3.38). Let us now check that
Xc
2 := Œ±
Œ±2
(W ‚àíc)+,
Xc
1 := W ‚àíXc
2
deÔ¨Ånes an equilibrium allocation with respect to the pricing measure P c. Clearly, Xc
1
and Xc
2 are non-negative and satisfy Xc
1 + Xc
2 = W. The budget condition for agent 2
is satisÔ¨Åed due to (3.38), and this implies the budget condition
Ec[ Xc
1 ] = Ec[ W ] ‚àíwc
2 = wc
1
for agent 1. Both are optimal since
Xc
a = I +
a (Œªa œïc)
with
Œª1 := Œ±1Z1
and
Œª2 := Œ±2Z2eŒ±c.
Thus, agent 2 demands Œ±
Œ±2 shares of a call option on the market portfolio W with strike
c, agent 1 demands the remaining part of W, and so the market is cleared.
In the general case of a Ô¨Ånite set A of agents, the equilibrium price measure ÀÜP has
the following structure. There are levels 0 := c0 < ¬∑ ¬∑ ¬∑ < cN = ‚àûwith 1 ‚â§N ‚â§|A|
such that the price density ÀÜœï is given by
ÀÜœï = 1
Zi
e‚àíŒ≤iW
on { W ‚àà[ci‚àí1, ci] }
for i = 1, . . . , N, where
Œ≤i :=
	 
Œ±‚ààAi
1
Œ±a

‚àí1
,
and where Ai (i = 1, . . . , N) are the increasing sets of agents which are active at
the ith layer in the sense that Xa > 0 on

W ‚àà(ci‚àí1, ci]

. At each layer (ci‚àí1, ci],
the active agents are sharing the market portfolio in inverse proportions to their risk
aversion. Thus, the optimal proÔ¨Åle ÀÜXa of any agent a ‚ààA is given by an increasing
piecewise linear function in W, and thus it can be implemented by a linear combination
of call options with strikes ci. More precisely, an agent a ‚ààAi takes Œ≤i/Œ±a shares of
the spread
(W ‚àíci‚àí1)+ ‚àí(W ‚àíci)+,
i.e., the agent goes long on a call option with strike ci‚àí1 and short on a call option with
strike ci.
‚ô¶

3.4 Microeconomic equilibrium
143
Example 3.53. Assume that all agents a ‚ààA have preferences described by HARA
utility functions so that
I +
a (y) = y‚àí
1
1‚àíŒ≥a ,
a ‚ààA
with 0 ‚â§Œ≥a < 1. For a given price density œï, the optimal claims take the form
Xa = I +
a (caœï) = ba œï‚àí
1
1‚àíŒ≥a
(3.39)
with constants ba > 0. If Œ≥a = Œ≥ for all a ‚ààA, then the market clearing condition
(3.31) implies
W =

a‚ààA
Xa =
	 
a‚ààA
ba

œï‚àí
1
1‚àíŒ≥ ,
i.e., the equilibrium price density œï‚àótakes the form
œï‚àó= 1
Z W Œ≥ ‚àí1,
where Z is the normalizing constant, and so the agents demand linear shares of the
market portfolio W. If risk aversion varies among the agents then the structure of the
equilibrium becomes more complex, and it will involve non-linear derivatives of the
market portfolio. Let us number the agents so that A = {1, . . . , n} and Œ≥1 ‚â•¬∑ ¬∑ ¬∑ ‚â•Œ≥n.
Condition (3.39) implies
Xi = di XŒ≤i
n
with some constants di, and where
Œ≤i := 1 ‚àíŒ≥n
1 ‚àíŒ≥i
satisÔ¨Åes Œ≤1 ‚â•¬∑ ¬∑ ¬∑ ‚â•Œ≤n = 1 with at least one strict inequality. Thus, each Xi is a
convex increasing function of Xn. In equilibrium, Xn is a concave function of W
determined by the condition
n

i=1
diXŒ≤i
n = W,
(3.40)
and the price density œï‚àótakes the form
œï‚àó= 1
Z XŒ≥n‚àí1
n
.
As an illustration, we consider the special case ‚ÄúBernoulli vs. Cramer‚Äù, where
A = {1, 2} with u1(x) = ‚àöx and u2(x) = log x, i.e., Œ≥1 = 1
2 and Œ≥2 = 0; see
Example 2.40. The solutions of (3.40) can be parameterized with c ‚â•0 such that
Xc
2 = 2‚àöc
‚àö
W + c ‚àí‚àöc

‚àà[0, W]

144
3 Optimality and equilibrium
and
Xc
1 = W ‚àíXc
2.
The corresponding price density takes the form
œïc =
1
Z(c)
1
‚àöW + c ‚àí‚àöc
,
where Z(c) is the normalizing constant. Now assume that W ‚àí1 ‚ààL1(P ), and let
P ‚àûdenote the measure with density W ‚àí1
E[ W ‚àí1 ]
‚àí1. As c increases from 0
to ‚àû, Ec[ Xc
2 ] increases continuously from 0 to E‚àû[ W ], while Ec[ W2 ] goes con-
tinuously from E0[ W2 ] > 0 to E‚àû[ W2 ] < E‚àû[ W ]; here we use our assumption
that P[ Wa > 0 ] Ã∏= 0 for all a ‚ààA. Thus, there is a c ‚àà(0, ‚àû) such that
Ec[ Xc
2 ] = Ec[ W2 ],
and this implies that the budget constraint is satisÔ¨Åed for both agents. With this choice
of the parameter c, (Xc
1, Xc
2) is an equilibrium allocation with respect to the pricing
measure P c: Agent 2 demands the concave proÔ¨Åle Xc
2, agent 1 demands the convex
proÔ¨Åle Xc
1, both in accordance with their budget constraints, and the market is cleared.
‚ô¶
Let us now return to our general setting, and let us prove the existence of an
Arrow‚ÄìDebreu equilibrium. Consider the following condition:
lim sup
x‚Üì0
x u‚Ä≤
a(x) < ‚àû
and
E

u‚Ä≤
a
 W
|A|
 
< ‚àû,
a ‚ààA.
(3.41)
Remark 3.54. Condition (3.41) is clearly satisÔ¨Åed if
u‚Ä≤
a(0) := lim
x‚Üì0 u‚Ä≤
a(x) < ‚àû,
a ‚ààA.
(3.42)
But it also includes HARA utility functions ua with parameter Œ≥a ‚àà[0, 1) if we assume
E[ W Œ≥a‚àí1 ] < ‚àû,
a ‚ààA,
in addition to our assumption E[ W ] < ‚àû.
‚ô¶
Theorem 3.55. Under assumptions (3.35) and (3.41), there exists an Arrow‚ÄìDebreu
equilibrium.
In a Ô¨Årst step, we are going to show that an equilibrium allocation maximizes a
suitable weighted average
UŒª(X) :=

a‚ààA
Œªa E[ ua(Xa) ]

3.4 Microeconomic equilibrium
145
of the individual utility functionals over all feasible allocations X = (Xa)a‚ààA. The
weights are non-negative, and without loss of generality we can assume that they are
normalized so that the vector Œª := (Œªa)a‚ààA belongs to the convex compact set
 =
$
Œª ‚àà[0, 1]A  
a‚ààA
Œªa = 1
%
.
In a second step, we will use a Ô¨Åxed-point argument to obtain a weight vector and a
corresponding price density such that the maximizing allocation satisÔ¨Åes the individual
budget constraints.
DeÔ¨Ånition 3.56. A feasible allocation (Xa)a‚ààA is called Œª-efÔ¨Åcient for Œª ‚àà if it
maximizes UŒª over all feasible allocations.
In view of (3.36), part (b) of the following lemma shows that the equilibrium
allocation (X‚àó
a)a‚ààA in an Arrow‚ÄìDebreu equilibrium is Œª-efÔ¨Åcient for the vector Œª =
(c ¬∑ c‚àí1
a )a‚ààA, where c‚àí1 := 
a c‚àí1
a . Thus, the existence proof for an Arrow‚ÄìDebreu
equilibrium is reduced to the construction of a suitable vector Œª‚àó‚àà.
Lemma 3.57. (a) For any Œª ‚àà there exists a unique Œª-efÔ¨Åcient allocation (XŒª
a)a‚ààA.
(b) A feasible allocation (Xa)a‚ààA is Œª-efÔ¨Åcient if and only if it satisÔ¨Åes the Ô¨Årst
order conditions
Œªa u‚Ä≤
a(Xa) ‚â§œï,
with equality on {Xa > 0}
(3.43)
with respect to some price density œï. In this case, (Xa)a‚ààA coincides with
(XŒª
a)a‚ààA, and the price density can be chosen as
œïŒª := max
a‚ààA Œªa u‚Ä≤
a(XŒª
a).
(3.44)
(c) For each a ‚ààA, XŒª
a maximizes E[ ua(X) ] over all X ‚ààX such that
E[ œïŒª X ] ‚â§E[ œïŒª XŒª
a ].
Proof. (a): ExistenceanduniquenessfollowfromthegeneralargumentinRemark3.37
applied to the set B of all feasible allocations and to the functional UŒª. Note that
UŒª(X) ‚â§max
a‚ààA E[ ua(W) ]
for any feasible allocation, and that the right-hand side is Ô¨Ånite due to our assumption
(3.35). Moreover, by dominated convergence, UŒª is indeed continuous on B with
respect to P -a.s. convergence.

146
3 Optimality and equilibrium
(b): LetusÔ¨ÅrstshowsufÔ¨Åciency. IfX = (Xa)a‚ààA isafeasibleallocationsatisfying
the Ô¨Årst order conditions, and Y = (Ya)a‚ààA is another feasible allocation then
UŒª(X) ‚àíUŒª(Y) =

a‚ààA
ŒªaE[ ua(Xa) ‚àíua(Ya) ]
‚â•

a‚ààA
ŒªaE[ u‚Ä≤
a(Xa)(Xa ‚àíYa) ]
‚â•E
 
œï
	 
a‚ààA
Xa ‚àí

a‚ààA
Ya

 !
= 0,
using concavity of ua in the second step and the Ô¨Årst order conditions in the third.
This shows that X is Œª-efÔ¨Åcient.
Turning to necessity, consider the Œª-efÔ¨Åcient allocation (XŒª
a)a‚ààA for Œª ‚àà and
another feasible allocation (Xa)a‚ààA. For Œµ ‚àà(0, 1], let Y Œµ
a := ŒµXa + (1 ‚àíŒµ)XŒª
a.
Since (Y Œµ
a )a‚ààA is feasible, Œª-efÔ¨Åciency of (XŒª
a)a‚ààA yields
0 ‚â•1
Œµ

a‚ààA
Œªa E[ ua(Y Œµ
a ) ‚àíua(XŒª
a) ]
‚â•1
Œµ

a‚ààA
ŒªaE[ u‚Ä≤
a(Y Œµ
a )(Y Œµ
a ‚àíXŒª
a) ]
(3.45)
=

a‚ààA
ŒªaE[ u‚Ä≤
a(Y Œµ
a )(Xa ‚àíXŒª
a) ].
Let us Ô¨Årst assume (3.42); in part (d) of the proof we show how to modify the
argument under condition (3.41). Using dominated convergence and (3.42), we may
let Œµ ‚Üì0 in the above inequality to conclude

a‚ààA
E[ œïŒª
aXa ] ‚â§

a‚ààA
E[ œïŒª
aXŒª
a ] ‚â§E[ œïŒªW ],
(3.46)
where
œïŒª
a := Œªau‚Ä≤
a(XŒª
a).
Note that œïŒª is a price density since by (3.42)
0 < œïŒª ‚â§max{ Œªau‚Ä≤
a(0) | a ‚ààA } < ‚àû.
Take a feasible allocation (Xa)a‚ààA such that

a‚ààA
œïŒª
aXa = œïŒª W ;
(3.47)
for example, we can enumerate A := {1, . . . , |A|} and take Xa := WI{T =a} where
T (œâ) := min{ a | œïŒª
a(œâ) = œïŒª(œâ) }.

3.4 Microeconomic equilibrium
147
In view of (3.46), we see that

a‚ààA
E[ œïŒª
a XŒª
a ] = E[ œïŒª W ].
(3.48)
This implies œïŒª
a = œïŒª on {XŒª
a > 0}, which is equivalent to the Ô¨Årst order condition
(3.43) with respect to œïŒª.
(c): In order to show optimality of XŒª
a, we may assume without loss of generality
that P [ XŒª
a > 0 ] > 0, and hence Œªa > 0. Thus, the Ô¨Årst order condition with respect
to œïŒª takes the form
XŒª
a = I +
a (Œª‚àí1
a œïŒª),
due to our convention (3.22). By Corollary 3.42, XŒª
a solves the optimization problem
for agent a ‚ààA under the constraint
E[ œïŒª X ] ‚â§E[ œïŒª XŒª
a ].
(d): If (3.42) is replaced by (3.41), then we Ô¨Årst need an additional argument in
order to pass from (3.45) to (3.46). Note Ô¨Årst that by Fatou‚Äôs lemma,
lim inf
Œµ‚Üì0

a‚ààA
ŒªaE[ u‚Ä≤
a(Y Œµ
a ) Xa ] ‚â•

a‚ààA
Œªa lim inf
Œµ‚Üì0
E[ u‚Ä≤
a(Y Œµ
a ) Xa ]
‚â•

a‚ààA
ŒªaE[ u‚Ä≤
a(XŒª
a) Xa ].
On the other hand, since
Œ∫ := max
a‚ààA
sup
0<x‚â§1
x u‚Ä≤
a(x) < ‚àû
by (3.41), we have xu‚Ä≤
a(x) ‚â§Œ∫ + xu‚Ä≤
a(1) ‚â§Œ∫(1 + x) for all x ‚â•0. This implies
u‚Ä≤
a(Xa)Xa ‚â§V := Œ∫(1 + W) ‚ààL1(P ),
(3.49)
and also
u‚Ä≤
a(Y Œµ
a ) XŒª
a ‚â§u‚Ä≤
a

(1 ‚àíŒµ) XŒª
a

XŒª
a ‚â§(1 ‚àíŒµ)‚àí1 V,
since Y Œµ
a ‚â•(1 ‚àíŒµ)XŒª
a. Thus, dominated convergence implies
E[ u‚Ä≤
a(Y Œµ
a ) XŒª
a ] ‚àí‚ÜíE[ u‚Ä≤
a(XŒª
a) XŒª
a ],
Œµ ‚Üì0,
and this concludes the proof of (3.46).
By (3.49), we have
œïŒª
a XŒª
a := Œªa u‚Ä≤
a(XŒª
a) XŒª
a ‚ààL1(P ).
Hence E[ œïŒª W ] < ‚àûfollows by taking in (3.46) a feasible allocation (Xa)a‚ààA which
is as in (3.47). We furthermore get (3.48), which yields as in part (b) the Ô¨Årst order
conditions (3.43).

148
3 Optimality and equilibrium
It remains to show that œïŒª is integrable in order to conclude that œïŒª is a price
density. Our assumption (3.41) implies
F := max
a‚ààA u‚Ä≤
a
 W
|A|

‚ààL1(P ),
(3.50)
and so it is enough to show that F ‚â•œïŒª. Since XŒª
a = I +
a

œïŒª/Œªa

, feasibility and
Œªa ‚â§1 imply
W ‚â§

a‚ààA
I +
a (œïŒª) ‚â§|A| max
a‚ààA I +
a (œïŒª),
hence
F ‚â•max
a‚ààA u‚Ä≤
a

max
b‚ààA I +
b (œïŒª)

‚â•u‚Ä≤
a0

I +
a0(œïŒª)

= œïŒª
on

max
a‚ààA I +
a (œïŒª) = I +
a0(œïŒª)

.
After these preliminaries, we are now in a position to prove the existence of an
Arrow‚ÄìDebreu equilibrium.
Note that for each Œª ‚àà the Œª-efÔ¨Åcient allocation
(XŒª
a)a‚ààA and the price density œïŒª would form an Arrow‚ÄìDebreu equilibrium if
E[ œïŒª Wa ] = E[ œïŒª XŒª
a ]
for all a ‚ààA.
(3.51)
If this is not the case, then we can replace Œª by the vector g(Œª) =

ga(Œª)

a‚ààA deÔ¨Åned
by
ga(Œª) := Œªa +
1
E[ V ] ¬∑ E[ œïŒª(Wa ‚àíXŒª
a) ],
where V is given by (3.49). Note that g(Œª) ‚àà: Since the Ô¨Årst order conditions
(3.43) together with (3.49) imply
E[ œïŒª XŒª
a ] = Œªa E[ u‚Ä≤
a(XŒª
a) XŒª
a ] ‚â§Œªa E[ V ],
we have ga(Œª) ‚â•0, and 
a ga(Œª) = 1 follows by feasibility. Thus, we increase
the weights of agents which were allocated less than they could afford. Clearly, any
Ô¨Åxed point of the map g :  ‚Üí will satisfy condition (3.51) and thus yield an
Arrow‚ÄìDebreu equilibrium.
Proof of Theorem 3.55. (a): The set  is convex and compact. Thus, the existence of
a Ô¨Åxed point of the map g :  ‚Üí follows from Brouwer‚Äôs Ô¨Åxed point theorem as
soon as we can verify that g is continuous; see, for instance, Corollary 16.52 in [2]
for a proof of Brouwer‚Äôs Ô¨Åxed point theorem. Suppose that the sequence (Œªn) ‚äÇ
converges to Œª ‚àà. In part (c) we show that Xn := XŒªn and œïn := œïŒªn converge
P-a.s. to XŒª and œïŒª, respectively. We will show next that we may apply the dominated
convergence theorem, so that
lim
n‚Üë‚àûE[ œïn Wa ] = E[ œïŒª Wa ]

3.4 Microeconomic equilibrium
149
and
lim
n‚Üë‚àûE[ œïn Xn ] = E[ œïŒª XŒª ]
and this will prove the continuity of g. To verify the assumptions of the dominated
convergence theorem, note that
Wa œïn ‚â§W œïn ‚â§WF,
where F is as in (3.50). Moreover,
WF ‚â§|A|F I{W‚â§|A|} + max
a‚ààA u‚Ä≤
a(1) ¬∑ W ‚ààL1(P ).
Thus, œïn Wa and œïn Xn are bounded by WF ‚ààL1(P ).
(b): By our convention (3.22), the map f :  √ó [0, ‚àû] ‚Üí[0, ‚àû] deÔ¨Åned by
f (Œª, y) =

a‚ààA
I +
a (Œª‚àí1
a
y)
is continuous. If we Ô¨Åx Œª ‚àà, then the function f (Œª, ¬∑) is continuous on [0, ‚àû] and
strictly decreasing on (a(Œª), b(Œª)) where
a(Œª) := max
a‚ààA lim
x‚Üë‚àûŒªa u‚Ä≤
a(x) ‚â•0
and
b(Œª) = max
a‚ààA Œªa u‚Ä≤
a(0+) ‚â§+‚àû.
Moreover, f (Œª, y) = ‚àûfor y ‚â§a(Œª) and f (Œª, y) = 0 for y ‚â•b(Œª). Hence, for
each w ‚àà(0, ‚àû) there exists exactly one solution yŒª ‚àà(a(Œª), b(Œª)) of the equation
f (Œª, yŒª) = w.
Recall that [0, ‚àû] can be regarded as a compact topological space. To see that yŒª
depends continuously on Œª ‚àà, take a sequence Œªn ‚ÜíŒª and a subsequence (Œªnk)
such that the solutions yk = yŒªnk of f (Œªnk, y) = w converge to some limit y‚àû‚àà
[a(Œª), b(Œª)]. By continuity of f ,
f (Œª, y‚àû) = lim
k‚Üë‚àûf (Œªnk, yk) = w,
and so y‚àûmust coincide with yŒª.
(c): Recall that
XŒª
a = I +
a (Œª‚àí1
a œïŒª)
(3.52)
for any a ‚ààA. By feasibility,
W =

a‚ààA
XŒª
a = f (Œª, œïŒª).
Thus, œïŒªn converges P -a.s. to œïŒª as Œªn ‚ÜíŒª due to part (b), and so XŒªn converges P -
a.s. to XŒª due to (3.52). This completes the proof in (a) that the map g is continuous.

150
3 Optimality and equilibrium
Remark 3.58. In order to simplify the exposition, we have restricted the discussion
of equilibrium prices to contingent claims with payoff at time t = 1. We have argued
in terms of discounted payoffs, and so we have implicitly assumed that the interest
rate r has already been Ô¨Åxed. From an economic point of view, also the interest rate
should be determined by an equilibrium argument. This requires an intertemporal
extension of our setting, which distinguishes between deterministic payoffs y at time
t = 0 and nominal contingent payoffs Y at time t = 1. Thus, we replace X = L0
+ by
the space
Y :=

Y = (y, Y) | y ‚àà[0, ‚àû), Y ‚ààL0
+

.
A pricing rule is given by a linear functional on Y of the form
(Y) := œï0 ¬∑ y + E[ œï Y ],
where œï0 ‚àà(0, ‚àû) and œï is a price density as before. Any such price system speciÔ¨Åes
an interest rate for transferring income from time t = 0 to time t = 1. Indeed,
comparing the forward price c ¬∑ E[ œï ] for the Ô¨Åxed amount c to be delivered at time 1
with the spot price c ¬∑ œï0 for the amount c made available at time 0, we see that the
implicit interest rate is given by
1 + r = E[ œï ]
œï0
.
If we describe the preferences of agent a ‚ààA by a utility functional of the form
Ua(Y) = ua,0(y) + E[ua,1(Y)]
with smooth utility functions ua,0 and ua,1, then we can show along the lines of the
preceding discussion that anArrow‚ÄìDebreu equilibrium exists in this extended setting.
Thus, we obtain an equilibrium allocation (Y ‚àó
a)a‚ààA and an equilibrium price system
‚àó= (œï‚àó
0, œï‚àó) such that each Y ‚àó
a maximizes the functional Ua in the agent‚Äôs budget
set determined by an initial endowment in Y and by the pricing rule ‚àó. In particular,
we have then speciÔ¨Åed an equilibrium interest rate r‚àó. Normalizing the price system
to œï‚àó
0 = 1 and deÔ¨Åning P ‚àóas a probability measure with density œï‚àó/E[ œï‚àó], we see
that the price at time t = 0 of a contingent claim with nominal payoff Y ‚â•0 at time
t = 1 is given as the expectation
E‚àó

Y
1 + r‚àó

of the discounted claim with respect to the measure P ‚àó.
‚ô¶
Let us now extend the discussion to situations where agents are heterogeneous not
only in their utility functions but also in their expectations. Thus, we assume that the
preferences of agent a ‚ààA are described by a Savage functional of the form
Ua(X) := EQa[ ua(X) ],

3.4 Microeconomic equilibrium
151
where Qa is a probability measure on (, F ) which is equivalent to P . In addition
to our assumption
lim sup
x‚Üì0
x u‚Ä≤
a(x) < ‚àû,
a ‚ààA,
(3.53)
we assume that
EQa[ W ] < ‚àû
and
EQa

u‚Ä≤
a
 W
|A|
 
< ‚àû,
a ‚ààA,
(3.54)
As before, a feasible allocation (X‚àó
a)a‚ààA together with a price density œï‚àóis called
an Arrow‚ÄìDebreu equilibrium if each X‚àó
a maximizes the functional Ua on the budget
set of agent a ‚ààA, which is determined by œï‚àó.
Theorem 3.59. Under assumptions (3.35), (3.53), and (3.54), there exists an Arrow‚Äì
Debreu equilibrium.
Proof. For any Œª ‚àà, the general argument of Remark 3.37 yields the existence of
a Œª-efÔ¨Åcient allocation (XŒª
a)a‚ààA, i.e., of a feasible allocation which maximizes the
functional
UŒª(X) :=

a‚ààA
ŒªaUa(Xa)
over all feasible allocations X = (Xa)a‚ààA. Since
Ua(XŒª
a) = E[ œïa ua(XŒª
a) ],
(XŒª
a)a‚ààAcan be viewed as a Œª-efÔ¨Åcient allocation in the model where agents have
random utility functions of the form
ua(x, œâ) = ua(x) œïa(œâ),
while their expectations are homogeneous and given by P . In view of Corollary 3.43,
it follows as before that XŒª satisÔ¨Åes the Ô¨Årst order conditions
XŒª
a = I +
a (Œª‚àí1
a œï‚àí1
a
œïŒª),
a ‚ààA,
with
œïŒª = max
a‚ààA Œªa u‚Ä≤
a(XŒª
a) œïa,
and that XŒª
a satisÔ¨Åes
Ua(XŒª
a) ‚â•E[ ua(Ya) œïa ] ‚â•Ua(Ya)
for all Ya in the budget set of agent a ‚ààA. The remaining arguments are essentially
the same as in the proof of Theorem 3.55.

Chapter 4
Monetary measures of risk
In this chapter, we discuss the problem of quantifying the risk of a Ô¨Ånancial position.
As in Chapter 2, such a position will be described by the corresponding payoff proÔ¨Åle,
that is, by a real-valued function X on some set of possible scenarios. In a probabilistic
model, speciÔ¨Åed by a probability measure on scenarios, we could focus on the resulting
distribution of X and try to measure the risk in terms of moments or quantiles. Note
that a classical measure of risk such as the variance does not capture a basic asymmetry
in the Ô¨Ånancial interpretation of X: Here it is the downside risk that matters. This
asymmetry is taken into account by measures such as Value at Risk which are based
on quantiles for the lower tail of the distribution, see Section 4.4 below. Value at Risk,
however, fails to satisfy some natural consistency requirements. Such observations
have motivated the systematic investigation of measures of risk that satisfy certain
basic axioms.
From the point of view of an investor, we could simply turn around the discussion
of Chapter 2 and measure the risk of a position X in terms of the loss functional
L(X) = ‚àíU(X).
Here U is a utility functional representing a given preference relation ‚âªon Ô¨Ånancial
positions. Assuming robust preferences, we are led to the notion of robust shortfall
risk deÔ¨Åned by
L(X) = sup
Q‚ààQ
EQ[ ‚Ñì(‚àíX) ],
where ‚Ñì(x) := ‚àíu(‚àíx) is a convex increasing loss function and Q is a class of
probability measures. The results of Section 2.5 show how such loss functionals can
be characterized in terms of convexity and monotonicity properties of the preference
relation. In particular, a Ô¨Ånancial position could be viewed as being acceptable if the
robust shortfall risk of X does not exceed a given bound.
From the point of view of a supervising agency, however, a speciÔ¨Åc monetary
purpose comes into play. In this perspective a risk measure is viewed as a capital
requirement: We are looking for the minimal amount of capital which, if added to the
position and invested in a risk-free manner, makes the position acceptable. This mon-
etary interpretation is captured by an additional axiom of cash invariance. Together
with convexity and monotonicity, it singles out the class of convex measures of risk.
These measures can be represented in the form
œÅ(X) = sup
Q

EQ[ ‚àíX ] ‚àíŒ±(Q)

,
where Œ± is a penalty function deÔ¨Åned on probability measures on .
Under the
additional condition of positive homogeneity, we obtain the class of coherent risk

4.1 Risk measures and their acceptance sets
153
measures. Here we are back to the situation in Proposition 2.85, and the representation
takes the form
œÅ(X) = sup
Q‚ààQ
EQ[ ‚àíX ],
where Q is some class of probability measures on .
The axiomatic approach to such monetary risk measures was initiated by P.Artzner,
F. Delbaen, J. Eber, and D. Heath [11], and it will be developed in the Ô¨Årst three
sections. In Section 4.4 we discuss some coherent risk measures related to Value
at Risk.
These risk measures only involve the distribution of a position under a
given probability measure. In Section 4.5 we characterize the class of convex risk
measures which share this property of law-invariance. Section 4.6 discusses the role
of concave distortions, and in Section 4.7 the resulting risk measures are characterized
by a property of comonotonicity. In Section 4.8 we discuss measures of risk which
arise naturally in the context of a Ô¨Ånancial market model. In Section 4.9 we analyze
the structure of monetary measures of risk which are induced by our notion of robust
shortfall risk.
4.1 Risk measures and their acceptance sets
Let  be a Ô¨Åxed set of scenarios. A Ô¨Ånancial position is described by a mapping
X :  ‚àí‚ÜíR where X(œâ) is the discounted net worth of the position at the end of
the trading period if the scenario œâ ‚àà is realized. Our aim is to quantify the risk of
X by some number œÅ(X), where X belongs to a given class X of Ô¨Ånancial positions.
Throughout this section, X will be a linear space of bounded functions containing the
constants. We do not assume that a probability measure is given on .
DeÔ¨Ånition 4.1. A mapping œÅ : X ‚ÜíR is called a monetary measure of risk if it
satisÔ¨Åes the following conditions for all X, Y ‚ààX.
‚Ä¢ Monotonicity: If X ‚â§Y, then œÅ(X) ‚â•œÅ(Y).
‚Ä¢ Cash invariance: If m ‚ààR, then œÅ(X + m) = œÅ(X) ‚àím.
The Ô¨Ånancial meaning of monotonicity is clear: The downside risk of a position
is reduced if the payoff proÔ¨Åle is increased. Cash invariance is also called translation
invariance. It is motivated by the interpretation of œÅ(X) as a capital requirement,
i.e., œÅ(X) is the amount which should be added to the position X in order to make
it acceptable from the point of view of a supervising agency. Thus, if the amount m
is added to the position and invested in a risk-free manner, the capital requirement is
reduced by the same amount. In particular, cash invariance implies
œÅ

X + œÅ(X)

= 0,
(4.1)

154
4 Monetary measures of risk
and
œÅ(m) = œÅ(0) ‚àím
for all m ‚ààR.
For most purposes it would be no loss of generality to assume that a given monetary
risk measure satisÔ¨Åes the condition of
‚Ä¢ Normalization: œÅ(0) = 0.
In some situations, however, it will be convenient not to insist on normalization.
Remark 4.2. We are using the convention that X describes the worth of a Ô¨Ånancial
position after discounting.
For instance, the discounting factor can be chosen as
1/(1+r) where r is the return of a risk-free investment. Instead of measuring the risk
of the discounted position X, one could consider directly the nominal worth

X = (1 + r)X.
The corresponding risk measure œÅ(
X) := œÅ(X) is again monotone. Cash invariance
is replaced by the following property:
œÅ

X + (1 + r)m

= œÅ(
X) ‚àím,
(4.2)
i.e., the risk is reduced by m if an additional amount m is invested in a risk-free manner.
Conversely, any œÅ : X ‚ÜíR which is monotone and satisÔ¨Åes (4.2) deÔ¨Ånes a monetary
measure of risk via œÅ(X) := œÅ

(1 + r)X

.
‚ô¶
Lemma 4.3. Any monetary measure of risk œÅ is Lipschitz continuous with respect to
the supremum norm ‚à•¬∑ ‚à•:
|œÅ(X) ‚àíœÅ(Y)| ‚â§‚à•X ‚àíY‚à•.
Proof. Clearly, X ‚â§Y + ‚à•X ‚àíY‚à•, and so œÅ(Y) ‚àí‚à•X ‚àíY‚à•‚â§œÅ(X) by monotonicity
and cash invariance. Reversing the roles of X and Y yields the assertion.
From now on we concentrate on monetary measures of risk which have an addi-
tional convexity property.
DeÔ¨Ånition 4.4. A monetary risk measure œÅ : X ‚ÜíR is called a convex measure of
risk if it satisÔ¨Åes
‚Ä¢ Convexity: œÅ(ŒªX + (1 ‚àíŒª)Y) ‚â§ŒªœÅ(X) + (1 ‚àíŒª)œÅ(Y), for 0 ‚â§Œª ‚â§1.
Consider the collection of possible future outcomes that can be generated with the
resources available to an investor: One investment strategy leads to X, while a second
strategy leads to Y. If one diversiÔ¨Åes, spending only the fraction Œª of the resources on
the Ô¨Årst possibility and using the remaining part for the second alternative, one obtains
ŒªX + (1 ‚àíŒª)Y. Thus, the axiom of convexity gives a precise meaning to the idea that
diversiÔ¨Åcation should not increase the risk. If œÅ is convex and normalized, then
œÅ(ŒªX) ‚â§ŒªœÅ(X)
for 0 ‚â§Œª ‚â§1,
œÅ(ŒªX) ‚â•ŒªœÅ(X)
for Œª ‚â•1.

4.1 Risk measures and their acceptance sets
155
DeÔ¨Ånition 4.5. A convex measure of risk œÅ is called a coherent risk measure if it
satisÔ¨Åes
‚Ä¢ Positive Homogeneity: If Œª ‚â•0, then œÅ(ŒªX) = ŒªœÅ(X).
If a monetary measure of risk œÅ is positively homogeneous, then it is normalized,
i.e., œÅ(0) = 0. Under the assumption of positive homogeneity, convexity is equivalent
to
‚Ä¢ Subadditivity: œÅ(X + Y) ‚â§œÅ(X) + œÅ(Y).
This property allows to decentralize the task of managing the risk arising from a
collection of different positions: If separate risk limits are given to different ‚Äúdesks‚Äù,
then the risk of the aggregate position is bounded by the sum of the individual risk
limits.
In many situations, however, risk may grow in a non-linear way as the size of the
position increases. For this reason we will not insist on positive homogeneity. Instead,
our focus will be on convex measures of risk.
A monetary measure of risk œÅ induces the class
AœÅ := { X ‚ààX | œÅ(X) ‚â§0 }
of positions which are acceptable in the sense that they do not require additional capital.
The class AœÅ will be called the acceptance set of œÅ. The following two propositions
summarize the relations between monetary measures of risk and their acceptance sets.
Proposition 4.6. Suppose that œÅ is a monetary measure of risk with acceptance set
A := AœÅ.
(a) A is non-empty, and satisÔ¨Åes the following two conditions:
inf{ m ‚ààR | m ‚ààA } > ‚àí‚àû.
(4.3)
X ‚ààA, Y ‚ààX, Y ‚â•X
"‚áí
Y ‚ààA.
(4.4)
Moreover, A has the following closure property: For X ‚ààA and Y ‚ààX,

Œª ‚àà[0, 1] | ŒªX + (1 ‚àíŒª)Y ‚ààA

is closed in [0, 1].
(4.5)
(b) œÅ can be recovered from A:
œÅ(X) = inf{ m ‚ààR | m + X ‚ààA }.
(4.6)
(c) œÅ is a convex risk measure if and only if A is convex.
(d) œÅ is positively homogeneous if and only if A is a cone. In particular, œÅ is
coherent if and only if A is a convex cone.

156
4 Monetary measures of risk
Proof. The Ô¨Årst two properties in (a) are straightforward. As to (4.5), the function
Œª ‚ÜíœÅ(ŒªX + (1 ‚àíŒª)Y) is continuous by Lemma 4.3. Hence, the set of Œª ‚àà[0, 1]
such that œÅ(ŒªX + (1 ‚àíŒª)Y) ‚â§0 is closed.
(b): Cash invariance implies that for X ‚ààX,
inf{ m ‚ààR | m + X ‚ààAœÅ } = inf{ m ‚ààR | œÅ(m + X) ‚â§0 }
= inf{ m ‚ààR | œÅ(X) ‚â§m }
= œÅ(X).
(c): A is clearly convex if œÅ is a convex measure of risk. The converse will follow
from Proposition 4.7 together with (4.8).
(d): Clearly, positive homogeneity of œÅ implies that A is a cone. The converse
follows as in (c).
Conversely, one can take a given class A ‚äÇX of acceptable positions as the
primary object. For a position X ‚ààX, we can then deÔ¨Åne the capital requirement as
the minimal amount m for which m + X becomes acceptable:
œÅA(X) := inf{ m ‚ààR | m + X ‚ààA }.
(4.7)
Note that, with this notation, (4.6) takes the form
œÅAœÅ = œÅ.
(4.8)
Proposition 4.7. Assume that A is a non-empty subset of X which satisÔ¨Åes (4.3) and
(4.4). Then the functional œÅA has the following properties:
(a) œÅA is a monetary measure of risk.
(b) If A is a convex set, then œÅA is a convex measure of risk.
(c) If A is a cone, then œÅA is positively homogeneous. In particular, œÅA is a coherent
measure of risk if A is a convex cone.
(d) A is a subset of AœÅA. If A satisÔ¨Åes the closure property (4.5) then A = AœÅA.
Proof. (a): It is straightforward to verify that œÅA satisÔ¨Åes cash invariance and mono-
tonicity. We show next that œÅA takes only Ô¨Ånite values. To this end, Ô¨Åx some Y in the
non-empty set A. For X ‚ààX given, there exists a Ô¨Ånite number m with m + X > Y,
because X and Y are both bounded. Then
œÅA(X) ‚àím = œÅA(m + X) ‚â§œÅA(Y) ‚â§0,
and hence œÅA(X) ‚â§m < ‚àû. Note that (4.3) is equivalent to œÅA(0) > ‚àí‚àû. To
show that œÅA(X) > ‚àí‚àûfor arbitrary X ‚ààX, we take m‚Ä≤ such that X + m‚Ä≤ ‚â§0 and
conclude by monotonicity and cash invariance that œÅA(X) ‚â•œÅA(0) + m‚Ä≤ > ‚àí‚àû.

4.1 Risk measures and their acceptance sets
157
(b): Suppose that X1, X2 ‚ààX and that m1, m2 ‚ààR are such that mi +Xi ‚ààA. If
Œª ‚àà[0, 1], then the convexity of A implies that Œª(m1 +X1)+(1‚àíŒª)(m2 +X2) ‚ààA.
Thus, by the cash invariance of œÅA,
0 ‚â•œÅA

Œª(m1 + X1) + (1 ‚àíŒª)(m2 + X2)

= œÅA

ŒªX1 + (1 ‚àíŒª)X2

‚àí

Œªm1 + (1 ‚àíŒª)m2

,
and the convexity of œÅA follows.
(c): As in the proof of convexity, we obtain that œÅA(ŒªX) ‚â§ŒªœÅA(X) for Œª ‚â•0 if
A is a cone. To prove the converse inequality, let m < œÅA(X). Then m + X /‚ààA and
hence Œªm + ŒªX /‚ààA for Œª ‚â•0. Thus Œªm < œÅA(ŒªX), and (c) follows.
(d): The inclusion A ‚äÜAœÅA is obvious. Now assume that A satisÔ¨Åes (4.5). We
have to show that X /‚ààA implies that œÅA(X) > 0. To this end, take m > ‚à•X‚à•=
supœâ |X(œâ)|. By assumption, there exists an Œµ ‚àà(0, 1) such that Œµm+(1‚àíŒµ)X /‚ààA.
Thus,
0 ‚â§œÅA

Œµ m + (1 ‚àíŒµ)X

= œÅA

(1 ‚àíŒµ)X

‚àíŒµ m.
Since œÅA is a monetary measure of risk, Lemma 4.3 shows that
œÅA

(1 ‚àíŒµ)X

‚àíœÅA(X)
 ‚â§Œµ ‚à•X‚à•.
Hence,
œÅA(X) ‚â•œÅA

(1 ‚àíŒµ)X

‚àíŒµ ‚à•X‚à•‚â•Œµ

m ‚àí‚à•X‚à•

> 0.
In the following examples, we take X as the linear space of all bounded measurable
functions on some measurable space (, F ), and we denote by M1 = M1(, F ) the
class of all probability measures on (, F ).
Example 4.8. Consider the worst-case risk measure œÅmax deÔ¨Åned by
œÅmax(X) = ‚àíinf
œâ‚àà X(œâ)
for all X ‚ààX.
The value œÅmax(X) is the least upper bound for the potential loss which can occur in
any scenario. The corresponding acceptance set A is given by the convex cone of all
non-negative functions in X. Thus, œÅmax is a coherent measure of risk. It is the most
conservative measure of risk in the sense that any normalized monetary risk measure
œÅ on X satisÔ¨Åes
œÅ(X) ‚â§œÅ

inf
œâ‚àà X(œâ)

= œÅmax(X).
Note that œÅmax can be represented in the form
œÅmax(X) = sup
Q‚ààQ
EQ[ ‚àíX ],
(4.9)
where Q is the class M1 of all probability measures on (, F ).
‚ô¶

158
4 Monetary measures of risk
Example 4.9. Let Q be a set of probability measures on (, F ), and consider a
mapping Œ≥ : Q ‚ÜíR with supQ Œ≥ (Q) < ‚àû, which speciÔ¨Åes for each Q ‚ààQ some
‚ÄúÔ¨Çoor‚Äù Œ≥ (Q). Suppose that a position X is acceptable if
EQ[ X ] ‚â•Œ≥ (Q)
for all Q ‚ààQ.
The set A of such positions satisÔ¨Åes (4.3) and (4.4), and it is convex. Thus, the
associated monetary risk measure œÅ = œÅA is convex, and it takes the form
œÅ(X) = sup
Q‚ààQ
(Œ≥ (Q) ‚àíEQ[ X ]).
Alternatively, we can write
œÅ(X) = sup
Q‚ààM1

EQ[ ‚àíX ] ‚àíŒ±(Q)

,
(4.10)
where the penalty function Œ± : M1 ‚Üí(‚àí‚àû, ‚àû] is deÔ¨Åned by Œ±(Q) = ‚àíŒ≥ (Q)
for Q ‚ààQ and Œ±(Q) = +‚àûotherwise. Note that œÅ is a coherent risk measure if
Œ≥ (Q) = 0 for all Q ‚ààQ.
‚ô¶
Example 4.10. Consider a utility function u on R, a probability measure Q ‚ààM1,
and Ô¨Åx some threshold c ‚ààR. Let us call a position X acceptable if its certainty
equivalent is at least c, i.e., if its expected utility EQ[ u(X) ] is bounded from below
by u(c). Clearly, the set
A := { X ‚ààX | EQ[ u(X) ] ‚â•u(c) }.
is non-empty, convex, and satisÔ¨Åes (4.3) and (4.4). Thus, œÅA is a convex measure of
risk. As an obvious robust extension, we can deÔ¨Åne acceptability in terms of a whole
class Q of probability measures on (, F ), i.e.,
A :=

Q‚ààQ
{ X ‚ààX | EQ[ u(X) ] ‚â•u(cQ) },
with constants cQ such that supQ‚ààQ cQ < ‚àû. The corresponding risk measures will
be studied in more detail in Section 4.9.
‚ô¶
Example 4.11. Suppose now that we have speciÔ¨Åed a probabilistic model, i.e., a
probability measure P on (, F ). In this context, a position X is often considered to
be acceptable if the probability of a loss is bounded by a given level Œª ‚àà(0, 1), i.e., if
P [ X < 0 ] ‚â§Œª.
The corresponding monetary risk measure V@RŒª, deÔ¨Åned by
V@RŒª(X) = inf{ m ‚ààR | P [ m + X < 0 ] ‚â§Œª },

4.1 Risk measures and their acceptance sets
159
is called Value at Risk at level Œª. Note that it is well deÔ¨Åned on the space L0(, F , P )
of all random variables which are P -a.s. Ô¨Ånite, and that
V@RŒª(X) = E[ ‚àíX ] + ‚àí1(1 ‚àíŒª)œÉ(X),
(4.11)
if X is a Gaussian random variable with variance œÉ 2(X) and ‚àí1 denotes the inverse
of the distribution function  of N(0, 1). Clearly, V@RŒª is positively homogeneous,
but in general it is not convex, as shown by Example 4.41 below. In Section 4.4, Value
at Risk will be discussed in detail. In particular, we will study some closely related
coherent and convex measures of risk.
‚ô¶
Example 4.12. As in the preceding example, we Ô¨Åx a probability measure P on
(, F ). For an asset with payoff 
X ‚ààL2 = L2(, F , P ), price œÄ(
X), and variance
œÉ 2(
X) Ã∏= 0, the Sharpe ratio is deÔ¨Åned as
E[ 
X ] ‚àíœÄ(
X)(1 + r)
œÉ(
X)
= E[ X ]
œÉ(X) ,
where X := 
X(1 + r)‚àí1 ‚àíœÄ(
X) is the corresponding discounted net worth. Suppose
that we Ô¨Ånd the position X acceptable if the Sharpe ratio is bounded from below by
some constant c > 0. The resulting functional œÅc on L2 deÔ¨Åned by (4.7) for the class
Ac := { X ‚ààL2 | E[ X ] ‚â•c ¬∑ œÉ(X) }
is given by
œÅc(X) = E[ ‚àíX ] + c ¬∑ œÉ(X).
It is cash invariant and positively homogeneous, and it is convex since œÉ( ¬∑ ) is a convex
functional on L2. But œÅc is not a monetary risk measure, because it is not monotone.
Indeed, if X = eZ and Z is a random variable with normal distribution N(0, œÉ 2), then
X ‚â•0 but
œÅc(X) = ‚àíeœÉ 2/2 + ceœÉ 2/2&
eœÉ 2 ‚àí1
becomes positive for large enough œÉ. Note, however, that (4.11) shows that œÅc(X)
coincides with V@RŒª(X) if X is Gaussian and if c = ‚àí1(1 ‚àíŒª) with 0 < Œª ‚â§1/2.
Thus, both œÅc and V@RŒª have all the properties of a coherent risk measure if restricted
to a Gaussian subspace 
X of L2, i.e, a linear space consisting of normally distributed
random variables. But neither œÅc nor V@RŒª can be coherent on the full space L2,
since the existence of normal random variables on (, F , P ) implies that X will also
contain random variables as considered in Example 4.41.
‚ô¶
Example 4.13. Let c : F ‚Üí[0, 1] be any set function which is normalized and
monotone in the sense that c(‚àÖ) = 0, c() = 1, and c(A) ‚â§c(B) if A ‚äÇB. For
instance, c can be given by c(A) := œà(P[ A ]) for some probability measure P and
an increasing function œà : [0, 1] ‚Üí[0, 1] such that œà(0) = 0 and œà(1) = 1. The

160
4 Monetary measures of risk
Choquet integral of a bounded measurable function X ‚â•0 with respect to c is deÔ¨Åned
as

X dc :=
 ‚àû
0
c(X > x) dx.
If c is a probability measure, Fubini‚Äôs theorem implies that

X dc coincides with the
usual integral. In the general case, the Choquet integral is a nonlinear functional of X,
but we still have

ŒªX dc = Œª

X dc and

(X + m) dc =

X dc + m for constants
Œª, m ‚â•0. If X ‚ààX is arbitrary, we take m ‚ààR such that X + m ‚â•0 and get

(X + m) dc ‚àím =
 0
‚àím

c(X > x) ‚àí1

dx +
 ‚àû
0
c(X > x) dx.
The right-hand side is independent of m ‚â•‚àíinf X, and so it makes sense to extend
the deÔ¨Ånition of the Choquet integral by putting

X dc :=
 0
‚àí‚àû

c(X > x) ‚àí1

dx +
 ‚àû
0
c(X > x) dx
for all X ‚ààX. It follows that

ŒªX dc = Œª

X dc
and

(X + m) dc =

X dc + m
for all Œª ‚â•0 and m ‚ààR. Moreover, we have

Y dc ‚â•

X dc
for Y ‚â•X.
Thus, the Choquet integral of the loss,
œÅ(X) :=

(‚àíX) dc,
is a positively homogeneous monetary risk measure on X. In Section 4.7, we will
characterize these risk measures in terms of a property called ‚Äúcomonotonicity‚Äù. We
will also show that œÅ is convex, and hence coherent, if and only if c is submodular or
2-alternating, i.e.,
c(A ‚à©B) + c(A ‚à™B) ‚â§c(A) + c(B)
for A, B ‚ààF .
In this case, œÅ admits the representation
œÅ(X) = max
Q‚ààQc
EQ[ ‚àíX ],
(4.12)
where Qc is the core of c, deÔ¨Åned as the class of all Ô¨Ånitely additive and normalized set
functions Q : F ‚Üí[0, 1] such that Q[ A ] ‚â§c(A) for all A ‚ààF ; see Theorem 4.88.
‚ô¶
In the next two sections, we are going to show how representations of the form
(4.9), (4.12), or (4.10) for coherent or convex risk measures arise in a systematic
manner.

4.2 Robust representation of convex risk measures
161
4.2 Robust representation of convex risk measures
In this section, we consider the situation where X consists of all bounded measurable
functions on the measurable space (, F ). Recall that X is a Banach space if endowed
with the supremum norm ‚à•¬∑‚à•. As in Section 2.5, we denote by M1 := M1(, F ) the
set of all probability measures on (, F ) and by M1,f := M1,f (, F ) the set of all
Ô¨Ånitely additive set functions Q : F ‚Üí[0, 1] which are normalized to Q[  ] = 1.
By EQ[ X ] we denote the integral of X with respect to Q ‚ààM1,f ; see Appendix A.6.
We do not assume that a probability measure on (, F ) is given a priori.
If œÅ is a coherent measure of risk on X, then we are in the context of Proposi-
tion 2.85, i.e., the functional J deÔ¨Åned by J(X) := ‚àíœÅ(X) satisÔ¨Åes the four properties
listed in Proposition 2.84. Hence, we have the following result:
Proposition 4.14. A functional œÅ : X ‚ÜíR is a coherent measure of risk if and only
if there exists a subset Q of M1,f such that
œÅ(X) = sup
Q‚ààQ
EQ[ ‚àíX ],
X ‚ààX.
(4.13)
Moreover, Q can be chosen as a convex set for which the supremum in (4.13) is
attained.
Our Ô¨Årst goal in this section is to obtain an analogue of this result for convex
measures of risk. Applied to a coherent measure of risk, it will yield an alternative
proof of Proposition 4.14, which does not depend on the discussion in Chapter 2, and
it will provide a description of the maximal set Q in (4.13). Our second goal will be
to obtain criteria which guarantee that a measure of risk can be represented in terms
of œÉ-additive probability measures.
Let Œ± : M1,f ‚ÜíR ‚à™{+‚àû} be any functional such that
inf
Q‚ààM1,f
Œ±(Q) ‚ààR.
For each Q ‚ààM1,f the functional X ‚ÜíEQ[ ‚àíX ] ‚àíŒ±(Q) is convex, monotone,
and cash invariant on X, and these three properties are preserved when taking the
supremum over Q ‚ààM1,f . Hence,
œÅ(X) :=
sup
Q‚ààM1,f

EQ[ ‚àíX ] ‚àíŒ±(Q)

(4.14)
deÔ¨Ånes a convex measure of risk on X such that
œÅ(0) = ‚àí
inf
Q‚ààM1,f
Œ±(Q).
The functional Œ± will be called a penalty function for œÅ on M1,f , and we will say that
œÅ is represented by Œ± on M1,f .

162
4 Monetary measures of risk
Theorem 4.15. Any convex measure of risk œÅ on X is of the form
œÅ(X) =
max
Q‚ààM1,f

EQ[ ‚àíX ] ‚àíŒ±min(Q)

,
X ‚ààX,
(4.15)
where the penalty function Œ±min is given by
Œ±min(Q) := sup
X‚ààAœÅ
EQ[ ‚àíX ]
for Q ‚ààM1,f .
Moreover, Œ±min is the minimal penalty function which represents œÅ, i.e., any penalty
function Œ± for which (4.14) holds satisÔ¨Åes Œ±(Q) ‚â•Œ±min(Q) for all Q ‚ààM1,f .
Proof. In a Ô¨Årst step, we show that
œÅ(X) ‚â•
sup
Q‚ààM1,f

EQ[ ‚àíX ] ‚àíŒ±min(Q)

for all X ‚ààX.
To this end, recall that X‚Ä≤ := œÅ(X) + X ‚ààAœÅ by (4.1). Thus, for all Q ‚ààM1,f
Œ±min(Q) ‚â•EQ[ ‚àíX‚Ä≤ ] = EQ[ ‚àíX ] ‚àíœÅ(X).
From here, our claim follows.
For X given, we will now construct some QX ‚ààM1,f such that
œÅ(X) ‚â§EQX[ ‚àíX ] ‚àíŒ±min(QX),
which, in view of the previous step, will prove our representation (4.15). By cash
invariance it sufÔ¨Åces to prove this for X ‚ààX with œÅ(X) = 0. Moreover, we may
assume without loss of generality that œÅ(0) = 0. Then X is not contained in the
nonempty convex set
B := { Y ‚ààX | œÅ(Y) < 0 }.
Since B is open is open due to Lemma 4.3, we may apply the separation argument in
the form of Theorem A.54. It yields a non-zero continuous linear functional ‚Ñìon X
such that
‚Ñì(X) ‚â§inf
Y‚ààB ‚Ñì(Y) =: b.
We claim that ‚Ñì(Y) ‚â•0 if Y ‚â•0. Monotonicity and cash invariance of œÅ imply
that 1 + ŒªY ‚ààB for any Œª > 0. Hence,
‚Ñì(X) ‚â§‚Ñì(1 + ŒªY) = ‚Ñì(1) + Œª‚Ñì(Y)
for all Œª > 0,
which could not be true if ‚Ñì(Y) < 0.
Our next claim is that ‚Ñì(1) > 0. Since ‚Ñìdoes not vanish identically, there must
be some Y such that 0 < ‚Ñì(Y) = ‚Ñì(Y +) ‚àí‚Ñì(Y ‚àí). We may assume without loss of
generality that ‚à•Y‚à•< 1. Positivity of ‚Ñìimplies ‚Ñì(Y +) > 0 and ‚Ñì(1 ‚àíY +) ‚â•0.
Hence ‚Ñì(1) = ‚Ñì(1 ‚àíY +) + ‚Ñì(Y +) > 0.

4.2 Robust representation of convex risk measures
163
By the two preceding steps and Theorem A.50, we conclude that there exists some
QX ‚ààM1,f such that
EQX[ Y ] = ‚Ñì(Y)
‚Ñì(1)
for all Y ‚ààX.
Note that B ‚äÇAœÅ, and so
Œ±min(QX) = sup
Y‚ààAœÅ
EQX[ ‚àíY ] ‚â•sup
Y‚ààB
EQX[ ‚àíY ] = ‚àíb
‚Ñì(1).
On the other hand, Y + Œµ ‚ààB for any Y ‚ààAœÅ and each Œµ > 0. This shows that
Œ±min(QX) is in fact equal to ‚àíb/‚Ñì(1). It follows that
EQX[ ‚àíX ] ‚àíŒ±min(QX) =
1
‚Ñì(1)

b ‚àí‚Ñì(X)

‚â•0 = œÅ(X).
Thus, QX is as desired, and the proof of the representation (4.15) is complete.
Finally, let Œ± be any penalty function for œÅ. Then, for all Q ‚ààM1,f and X ‚ààX
œÅ(X) ‚â•EQ[ ‚àíX ] ‚àíŒ±(Q),
and hence
Œ±(Q) ‚â•sup
X‚ààX

EQ[ ‚àíX ] ‚àíœÅ(X)

‚â•sup
X‚ààAœÅ

EQ[ ‚àíX ] ‚àíœÅ(X)

(4.16)
‚â•Œ±min(Q).
Thus, Œ± dominates Œ±min.
Remark 4.16.
(a) If we take Œ± = Œ±min in (4.16), then all inequalities in (4.16) must
be identities. Thus, we obtain an alternative formula for the minimal penalty
function Œ±min:
Œ±min(Q) = sup
X‚ààX

EQ[ ‚àíX ] ‚àíœÅ(X)

.
(4.17)
(b) Note that Œ±min is convex and lower semicontinuous for the total variation dis-
tance on M1,f as deÔ¨Åned in DeÔ¨Ånition A.49, since it is the supremum of afÔ¨Åne
continuous functions on M1,f .
(c) Suppose œÅ is deÔ¨Åned via œÅ := œÅA for a given acceptance set A ‚äÇX. Then A
determines Œ±min:
Œ±min(Q) = sup
X‚ààA
EQ[ ‚àíX ]
for all Q ‚ààM1,f .
This follows from the fact that X ‚ààA implies Œµ + X ‚ààAœÅ for all Œµ > 0.
‚ô¶

164
4 Monetary measures of risk
Remark 4.17. Equation (4.17) shows that the penalty function Œ±min corresponds to
the Fenchel‚ÄìLegendre transform, or conjugate function, of the convex function œÅ on
the Banach space X. More precisely,
Œ±min(Q) = œÅ‚àó(‚ÑìQ),
(4.18)
where œÅ‚àó: X‚Ä≤ ‚ÜíR ‚à™{+‚àû} is deÔ¨Åned on the dual X‚Ä≤ of X by
œÅ‚àó(‚Ñì) = sup
X‚ààX

‚Ñì(X) ‚àíœÅ(X)

,
and where ‚ÑìQ ‚ààX‚Ä≤ is given by ‚ÑìQ(X) = EQ[ ‚àíX ] for Q ‚ààM1,f . This suggests
an alternative proof of Theorem 4.15. First note that, by Theorem A.50, X‚Ä≤ can
be identiÔ¨Åed with the space ba := ba(, F ) of Ô¨Ånitely additive set functions with
Ô¨Ånite total variation. Moreover, œÅ is lower semicontinuous with respect to the weak
topology œÉ(X, X‚Ä≤), since any set {œÅ ‚â§c} is convex, strongly closed due to Lemma 4.3,
and hence weakly closed by Theorem A.59. Thus, the general duality theorem for
conjugate functions as stated in Theorem A.61 yields
œÅ‚àó‚àó= œÅ,
where œÅ‚àó‚àódenotes the conjugate function of œÅ‚àó, i.e.,
œÅ(X) = sup
‚Ñì‚ààba

‚Ñì(X) ‚àíœÅ‚àó(‚Ñì)

.
(4.19)
In a second step, using the arguments in the second part of the proof of Theorem
4.15, we can now check that monotonicity and cash invariance of œÅ imply that ‚Ñì‚â§0
and ‚Ñì(1) = ‚àí1 for any ‚Ñì‚ààX‚Ä≤ = ba such that œÅ‚àó(‚Ñì) < ‚àû. Identifying ‚àí‚Ñìwith
Q ‚ààM1,f and using equation (4.18), we see that (4.19) reduces to the representation
œÅ(X) =
sup
Q‚ààM1,f

EQ[ ‚àíX ] ‚àíŒ±min(Q)

.
Moreover, the supremum is actually attained: M1,f is weak‚àócompact in X‚Ä≤ = ba
due to the Banach‚ÄìAlaoglu theorem stated in Theorem A.62, and so the upper semi-
continuous functional Q ‚ÜíEQ[ ‚àíX ] ‚àíŒ±min(Q) attains its maximum on M1,f . ‚ô¶
The representation
œÅ(X) = sup
Q‚ààQ
EQ[ ‚àíX ],
X ‚ààX,
(4.20)
of a coherent measure of risk œÅ via some set Q ‚äÇM1,f is a particular case of the
representation theorem for convex measures of risk, since it corresponds to the penalty
function
Œ±(Q) =

0
if Q ‚ààQ
+‚àû
otherwise.
The following corollary shows that the minimal penalty function of a coherent measure
of risk is always of this type.

4.2 Robust representation of convex risk measures
165
Corollary 4.18. The minimal penalty function Œ±min of a coherent measure of risk œÅ
takes only the values 0 and +‚àû. In particular,
œÅ(X) =
max
Q‚ààQmax
EQ[ ‚àíX ],
X ‚ààX,
for the convex set
Qmax := { Q ‚ààM1,f | Œ±min(Q) = 0 },
and Qmax is the largest set for which a representation of the form (4.20) holds.
Proof. Recall from Proposition 4.6 that the acceptance set AœÅ of a coherent measure
of risk is a cone. Thus, the minimal penalty function satisÔ¨Åes
Œ±min(Q) = sup
X‚ààAœÅ
EQ[ ‚àíX ] =
sup
ŒªX‚ààAœÅ
EQ[ ‚àíŒª X ] = Œª Œ±min(Q)
for all Q ‚ààM1,f and Œª > 0. Hence, Œ±min can take only the values 0 and +‚àû.
The penalty function Œ± arising in the representation (4.14) is not unique, and it is
often convenient to represent a convex measure of risk by a penalty function that is not
the minimal one. For instance, the minimal penalty function may be Ô¨Ånite for certain
Ô¨Ånitely additive set functions while another Œ± is concentrated only on probability
measures as in the case of Example 4.8. Another situation of this type occurs for risk
measures which are constructed as the supremum of a family of convex measures of
risk:
Proposition 4.19. Suppose that for every i in some index set I we are given a convex
measure of risk œÅi on X with associated penalty function Œ±i. If supi‚ààI œÅi(0) < ‚àû
then
œÅ(X) := sup
i‚ààI
œÅi(X),
X ‚ààX,
is a convex measure of risk that can be represented with the penalty function
Œ±(Q) := inf
i‚ààI Œ±i(Q),
Q ‚ààM1,f .
Proof. The condition œÅ(0) = supi‚ààI œÅi(0) < ‚àûimplies that œÅ takes only Ô¨Ånite values.
Moreover,
œÅ(X) = sup
i‚ààI
sup
Q‚ààM1,f

EQ[ ‚àíX ] ‚àíŒ±i(Q)

=
sup
Q‚ààM1,f

EQ[ ‚àíX ] ‚àíinf
i‚ààI Œ±i(Q)

,
and the assertion follows.
In the sequel, we are particularly interested in those convex measures of risk
which admit a representation in terms of œÉ-additive probability measures. Such a risk

166
4 Monetary measures of risk
measure œÅ can be represented by a penalty function Œ± which is inÔ¨Ånite outside the set
M1 := M1(, F ):
œÅ(X) = sup
Q‚ààM1

EQ[ ‚àíX ] ‚àíŒ±(Q)

.
(4.21)
In this case, one can no longer expect that the supremum above is attained. This is
illustrated by Example 4.8 if X does not take on its inÔ¨Åmum.
A representation (4.21) in terms of probability measures is closely related to certain
continuity properties of œÅ. We Ô¨Årst examine a necessary condition of ‚Äúcontinuity from
above‚Äù.
Lemma 4.20. A convex measure of risk œÅ which admits a representation (4.21) on
M1 is continuous from above in the sense that
Xn ‚ÜòX
"‚áí
œÅ(Xn) ‚ÜóœÅ(X).
(4.22)
Moreover, continuity from above is equivalent to lower semicontinuity with respect to
bounded pointwise convergence: If (Xn) is a bounded sequence in X which converges
pointwise to X ‚ààX, then
œÅ(X) ‚â§lim inf
n‚Üë‚àûœÅ(Xn).
(4.23)
Proof. First we show (4.23) under the assumption that œÅ has a representation in terms
of probability measures. Dominated convergence implies that EQ[ Xn ] ‚ÜíEQ[ X ]
for each Q ‚ààM1. Hence,
œÅ(X) = sup
Q‚ààM1

lim
n‚Üë‚àû
EQ[ ‚àíXn ] ‚àíŒ±(Q)

‚â§lim inf
n‚Üë‚àû
sup
Q‚ààM1

EQ[ ‚àíXn ] ‚àíŒ±(Q)

= lim inf
n‚Üë‚àûœÅ(Xn).
In order to show the equivalence of (4.23) and (4.22), let us Ô¨Årst assume (4.23). By
monotonicity, œÅ(Xn) ‚â§œÅ(X) for each n if Xn ‚ÜòX, and so œÅ(Xn) ‚ÜóœÅ(X) follows.
Now we assume continuity from above. Let (Xn) be a bounded sequence in X
which converges pointwise to X. DeÔ¨Åne Ym := supn‚â•m Xn ‚ààX. Then Ym decreases
P-a.s. to X. Since œÅ(Xn) ‚â•œÅ(Yn) by monotonicity, condition (4.22) yields that
lim inf
n‚Üë‚àûœÅ(Xn) ‚â•lim
n‚Üë‚àûœÅ(Yn) = œÅ(X).
The following proposition gives a strong sufÔ¨Åcient condition which guarantees
that any penalty function for œÅ is concentrated on the set M1 of probability measures.
This condition is ‚Äúcontinuity from below‚Äù rather than from above; we will see a class
of examples in Section 4.9.

4.2 Robust representation of convex risk measures
167
Proposition 4.21. Let œÅ be a convex measure of risk which is continuous from below
in the sense that
Xn ‚ÜóX
"‚áí
œÅ(Xn) ‚ÜòœÅ(X),
and suppose that Œ± is any penalty function on M1,f representing œÅ. Then Œ± is con-
centrated on the class M1 of probability measures, i.e.,
Œ±(Q) < ‚àû
"‚áí
Q is œÉ-additive.
Proof. Recall that Q is œÉ-additive if and only if Q[ An ] ‚Üó1 for any increasing
sequence of events An ‚ààF such that 
n An = . Thus, the assertion is implied by
Lemma 4.22 below if we take Xn := IAn.
Lemma 4.22. Let œÅ be a convex measure of risk on X which is represented by the
penalty function Œ± on M1,f , and consider the level sets
c := { Q ‚ààM1,f | Œ±(Q) ‚â§c },
for c > ‚àíœÅ(0) =
inf
Q‚ààM1,f
Œ±(Q).
For any sequence (Xn) in X such that 0 ‚â§Xn ‚â§1, the following two conditions are
equivalent:
(a) œÅ(ŒªXn) ‚àí‚ÜíœÅ(Œª) for each Œª ‚â•1.
(b)
inf
Q‚ààc
EQ[ Xn ] ‚àí‚Üí1 for all c > ‚àíœÅ(0).
Proof. (a) ‚áí(b): In a Ô¨Årst step, we show that for all Y ‚ààX
inf
Q‚ààc
EQ[ Y ] ‚â•‚àíc + œÅ(ŒªY)
Œª
for all Œª > 0.
(4.24)
Indeed, since Œ± represents œÅ, we have for Q ‚ààc
c ‚â•Œ±(Q) ‚â•EQ[ ‚àíŒªY ] ‚àíœÅ(ŒªY),
and dividing by ‚àíŒª yields (4.24).
Now consider a sequence (Xn) which satisÔ¨Åes (a). Then (4.24) shows that for all
Œª ‚â•1
lim inf
n‚Üë‚àû
inf
Q‚ààc
EQ[ Xn ] ‚â•‚àílim
n‚Üë‚àû
c + œÅ(ŒªXn)
Œª
= 1 ‚àíc + œÅ(0)
Œª
.
Taking Œª ‚Üë‚àûand assuming Xn ‚â§1 proves (b).
(b) ‚áí(a): Clearly, for all n
œÅ(Œª) ‚â§œÅ(ŒªXn) =
sup
Q‚ààM1,f

EQ[ ‚àíŒªXn ] ‚àíŒ±(Q)

.

168
4 Monetary measures of risk
Since EQ[ ‚àíŒªXn ] ‚â§0 for all Q, only those Q can contribute to the supremum on the
right-hand side for which
Œ±(Q) ‚â§1 ‚àíœÅ(Œª) = 1 + Œª ‚àíœÅ(0) =: c.
Hence, for all n
œÅ(ŒªXn) = sup
Q‚ààc

EQ[ ‚àíŒªXn ] ‚àíŒ±(Q)

.
But condition (b) implies that EQ[ ‚àíŒªXn ] converges to ‚àíŒª uniformly in Q ‚ààc,
and so (a) follows.
Remark 4.23. Let œÅ be a convex measure of risk which is continuous from below.
Then œÅ is also continuous from above, as can be seen by combining Proposition 4.21
and Lemma 4.20. Thus, a straightforward argument yields that œÅ(Xn) ‚àí‚ÜíœÅ(X)
whenever (Xn) is a bounded sequence in X which converges pointwise to X.
‚ô¶
Example 4.24. Let us consider a utility function u on R, a probability measure
Q ‚ààM1(, F ), and Ô¨Åx some threshold c ‚ààR. As in Example 4.10, we suppose
that a position X is acceptable if its expected utility EQ[ u(X) ] is bounded from below
by u(c).
Alternatively, we can introduce the convex increasing loss function
‚Ñì(x) = ‚àíu(‚àíx) and deÔ¨Åne the convex set of acceptable positions
A := { X ‚ààX | EQ[ ‚Ñì(‚àíX) ] ‚â§x0 },
where x0 := ‚àíu(c). Let œÅ := œÅA denote the convex measure of risk induced by A.
In Section 4.9, we will show that œÅ is continuous from below, and we will derive a
formula for its minimal penalty function.
‚ô¶
Let us now continue the discussion in a topological setting. More precisely, we
will assume for the rest of this section that  is a separable metric space and that F is
the œÉ-Ô¨Åeld of Borel sets. As before, X is the linear space of all bounded measurable
functions on (, F ). We denote by Cb() the subspace of bounded continuous
functions on , and we focus on the representation of convex risk measures viewed
as functionals on Cb().
Proposition 4.25. Let œÅ be a convex measure of risk on X such that
œÅ(Xn) ‚ÜòœÅ(Œª) for any sequence (Xn) in Cb() that increases to a constant Œª > 0.
(4.25)
Then there exists a penalty function Œ± on M1 such that
œÅ(X) = max
Q‚ààM1

EQ[ ‚àíX ] ‚àíŒ±(Q)

for X ‚ààCb().
(4.26)
In fact, one can take
Œ±(Q) := inf

Œ±min(
Q) | E
Q[ ¬∑ ] = EQ[ ¬∑ ] on Cb()

.
(4.27)

4.2 Robust representation of convex risk measures
169
Proof. Let Œ±min be the minimal penalty function of œÅ on M1,f . We show that for
any 
Q with Œ±min(
Q) < ‚àûthere exists Q ‚ààM1 such that E
Q[ X ] = EQ[ X ] for all
X ‚ààCb(). Take a sequence (Yn) in Cb() which increases to some Y ‚ààCb(),
and choose Œ¥ > 0 such that Xn := 1 + Œ¥(Yn ‚àíY) ‚â•0 for all n. Clearly, (Xn) satisÔ¨Åes
condition (a) of Lemma 4.22, and so E
Q[ Xn ] ‚Üí1, i.e.,
E
Q[ Yn ] ‚ÜóE
Q[ Y ].
This continuity property of the linear functional E
Q[ ¬∑ ] on Cb() implies, via the
Daniell‚ÄìStone representation theorem as stated in Appendix A.6, that it coincides on
Cb() with the integral with respect to a œÉ-additive measure Q. Taking Œ± as in (4.27)
gives the result.
Remark 4.26. If  is compact then any convex risk measure admits a representation
(4.26) on the space Cb() = C(). In order to see that condition (4.25) is veriÔ¨Åed,
recall Dini‚Äôs lemma: On a compact set, a sequence of continuous functions Xn in-
creasing to a continuous function X converges even uniformly. Indeed, the compact
sets Kn := {Xn ‚â•X ‚àíŒµ} satisfy 
n Kn = ‚àÖ, hence Kn0 = ‚àÖfor some n0. Since œÅ
is Lipschitz continuous on C() by Lemma 4.3, it satisÔ¨Åes condition (4.25).
Alternatively, we could argue as in Remark 4.17 and apply the general duality
theorem for the Fenchel‚ÄìLegendre transform to the convex functional œÅ on the Banach
space C(). Just note that any continuous functional ‚Ñìon C() which is positive and
normalized is of the form ‚Ñì(X) = EQ[ X ] for some probability measure Q ‚ààM1;
see Theorem A.47.
‚ô¶
DeÔ¨Ånition 4.27. A convex risk measure œÅ on X is called tight if there exists an
increasing sequence K1 ‚äÇK2 ‚äÇ¬∑ ¬∑ ¬∑ of compact subsets of  such that
œÅ(ŒªIKn) ‚àí‚ÜíœÅ(Œª)
for all Œª ‚â•1.
Note that every convex measure of risk is tight if  is compact.
Proposition 4.28. Suppose that the convex risk measure œÅ on X is tight. Then (4.25)
holds and the conclusion of Proposition 4.25 is valid. Moreover, if  is a Polish space
and Œ± is a penalty function on M1 such that
œÅ(X) = sup
Q‚ààM1

EQ[ ‚àíX ] ‚àíŒ±(Q)

for X ‚ààCb(),
then the level sets c = { Q ‚ààM1 | Œ±(Q) ‚â§c } are relatively compact for the weak
topology on M1.
Proof. First we show (4.25). Suppose Xn ‚ààCb() are such that Xn ‚ÜóŒª > 0.We may
assume without loss of generality that œÅ is normalized. Convexity and normalization
guarantee that condition (4.25) holds for all Œª > 0 as soon as it holds for all Œª ‚â•c
where c is an arbitrary constant larger than 1. Hence, the cash invariance of œÅ implies

170
4 Monetary measures of risk
that there is no loss of generality in assuming Xn ‚â•0 for all n. We must show that
œÅ(Xn) ‚â§œÅ(Œª) + 2Œµ eventually, where we take Œµ ‚àà(0, Œª ‚àí1).
By assumption, there exists a compact set KN such that
œÅ

(Œª ‚àíŒµ)IKN

‚â§œÅ(Œª ‚àíŒµ) + Œµ = œÅ(Œª) + 2Œµ.
By Dini‚Äôs lemma as recalled in Remark 4.26, there exists some n0 ‚ààN such that
Œª ‚àíŒµ ‚â§Xn on KN for all n ‚â•n0. Finally, monotonicity implies
œÅ(Xn) ‚â§œÅ

(Œª ‚àíŒµ)IKN

‚â§œÅ(Œª) + 2Œµ.
To prove the relative compactness of c, we will show that for any Œµ > 0 there
exists a compact set KŒµ ‚äÇ such that for all c > ‚àíœÅ(0)
inf
Q‚ààc
Q[ KŒµ ] ‚â•1 ‚àíŒµ(c + œÅ(0) + 1).
The relative compactness of c will then be an immediate consequence of Prohorov‚Äôs
characterization of weakly compact sets in M1, as stated in Theorem A.41. We Ô¨Åx a
countable dense set {œâ1, œâ2, . . . } ‚äÇ and a complete metric Œ¥ which generates the
topology of . For r > 0 we deÔ¨Åne continuous functions r
i on  by
r
i (œâ) := 1 ‚àíŒ¥(œâ, œâi) ‚àßr
r
.
The function r
i is dominated by the indicator function of the closed metric ball
Br(œâi) := { œâ ‚àà | Œ¥(œâ, œâi) ‚â§r }.
Let
Xr
n(œâ) := max
i‚â§n r
i (œâ).
Clearly, Xr
n is continuous and satisÔ¨Åes 0 ‚â§Xr
n ‚â§1 as well as Xr
n ‚Üó1 for n ‚Üë‚àû.
According to (4.24), we have for all Œª > 0
inf
Q‚ààc
Q
 
n

i=1
Br(œâi)
!
‚â•inf
Q‚ààc
EQ[ Xr
n ] ‚â•‚àíc + œÅ(ŒªXr
n)
Œª
.
Now we take Œªk := 2k/Œµ and rk := 1/k. The Ô¨Årst part of this proof and (4.25) yield
the existence of nk ‚ààN such that
œÅ

ŒªkXrknk

‚â§œÅ(Œªk) + 1 = ‚àíŒªk + 1,
and thus
sup
Q‚ààc
Q
 nk

i=1
\Brk(œâi)
!
‚â§c + 1
Œªk
= Œµ2‚àík(c + 1).

4.3 Convex risk measures on L‚àû
171
We let
KŒµ :=
‚àû

k=1
nk

i=1
Brk(œâi).
Then, for each Q ‚ààc
Q[ KŒµ ] = 1 ‚àíQ
 
‚àû

k=1
nk

i=1
\Brk(œâi)
!
‚â•1 ‚àí
‚àû

k=1
Œµ2‚àík(c + 1)
= 1 ‚àíŒµ(c + 1).
The reader may notice that KŒµ is closed, totally bounded and, hence, compact. A short
proof of this fact goes as follows: Let (xj) be a sequence in KŒµ. We must show that
(xj) has a convergent subsequence. Since KŒµ is covered by Brk(œâ1), . . . , Brk(œânk)
for each k, there exists some ik ‚â§nk such that inÔ¨Ånitely many xj are contained in
Brk(œâik). A diagonalization argument yields a single subsequence (xj‚Ä≤) which for
each k is contained in some Brk(œâik). Thus, (xj‚Ä≤) is a Cauchy sequence with respect
to the complete metric Œ¥ and, hence, converging to some element œâ ‚àà.
Remark 4.29. Note that the representation (4.26) does not necessarily extend from
Cb() to the space X of all bounded measurable functions. Suppose in fact that 
is compact but not Ô¨Ånite, so that condition (4.25) holds as explained in Remark 4.26.
There is a Ô¨Ånitely additive Q0 ‚ààM1,f which does not belong to M1; see Exam-
pleA.52. The proof of Proposition 4.25 shows that there is some 
Q ‚ààM1 such that the
coherent risk measure œÅ deÔ¨Åned by œÅ(X) := EQ0[ ‚àíX ] coincides with E
Q[ ‚àíX ] for
X ‚ààCb(). But œÅ does not admit a representation of the form
œÅ(X) = sup
Q‚ààM1

EQ[ ‚àíX ] ‚àíŒ±(Q)

for all X ‚ààX.
In fact, this would imply
Œ±(Q) ‚â•EQ0[ X ] ‚àíEQ[ X ]
for Q ‚ààM1 and any X ‚ààX, hence Œ±(Q) = ‚àûfor any Q ‚ààM1.
‚ô¶
4.3 Convex risk measures on L‚àû
For the rest of this chapter, we Ô¨Åx a probability measure P on (, F ) and consider
risk measures œÅ such that
œÅ(X) = œÅ(Y)
if X = Y P -a.s.
(4.28)
Note that only the nullsets of P will matter in this section.

172
4 Monetary measures of risk
Lemma 4.30. Let œÅ be a convex measure of risk that satisÔ¨Åes (4.28) and which
is represented by a penalty function Œ± as in (4.14). Then Œ±(Q) = +‚àûfor any
Q ‚ààM1,f (, F ) which is not absolutely continuous with respect to P .
Proof. If Q ‚ààM1,f (, F ) is not absolutely continuous with respect to P , then there
exists A ‚ààF such that Q[ A ] > 0 but P [ A ] = 0. Take any X ‚ààAœÅ, and deÔ¨Åne
Xn := X ‚àín IA. Then œÅ(Xn) = œÅ(X), i.e., Xn is again contained in AœÅ. Hence,
Œ±(Q) ‚â•Œ±min(Q) ‚â•EQ[ ‚àíXn ] = EQ[ ‚àíX ] + n Q[ A ] ‚àí‚Üí‚àû
as n ‚Üë‚àû.
In view of (4.28), we can identify X with the Banach space L‚àû:= L‚àû(, F , P ).
Let us denote by
M1(P ) := M1(, F , P )
the set of all probability measures on (, F ) which are absolutely continuous with
respect to P. The following theorem characterizes those convex risk measures on L‚àû
that can be represented by a penalty function concentrated on probability measures,
and hence on M1(P ), due to Lemma 4.30.
Theorem 4.31. Suppose œÅ : L‚àû‚ÜíR is a convex measure of risk. Then the following
conditions are equivalent.
(a) œÅ can be represented by some penalty function on M1(P ).
(b) œÅ can be represented by the restriction of the minimal penalty function Œ±min to
M1(P ):
œÅ(X) =
sup
Q‚ààM1(P )

EQ[ ‚àíX ] ‚àíŒ±min(Q)

,
X ‚ààL‚àû.
(4.29)
(c) œÅ is continuous from above: If Xn ‚ÜòX P -a.s. then œÅ(Xn) ‚ÜóœÅ(X).
(d) œÅ has the ‚ÄúFatou property‚Äù: For any bounded sequence (Xn) which converges
P-a.s. to some X,
œÅ(X) ‚â§lim inf
n‚Üë‚àûœÅ(Xn).
(e) œÅ is lower semicontinuous for the weak‚àótopology œÉ(L‚àû, L1).
(f) The acceptance set AœÅ of œÅ is weak‚àóclosed in L‚àû, i.e., AœÅ is closed with
respect to the topology œÉ(L‚àû, L1).
Proof. (f) ‚áí(b): We Ô¨Åx some X ‚ààX and let
m =
sup
Q‚ààM1(P )

EQ[ ‚àíX ] ‚àíŒ±min(Q)

.
(4.30)

4.3 Convex risk measures on L‚àû
173
In view of Theorem 4.15, we need to show that m ‚â•œÅ(X) or, equivalently, that
m + X ‚ààAœÅ. Suppose by way of contradiction that m + X /‚ààAœÅ. Since the non-
empty convex set AœÅ is weak‚àóclosed by assumption, we may apply Theorem A.56 in
the locally convex space (L‚àû, œÉ(L‚àû, L1)) with C := AœÅ and B := {m + X}. We
obtain a continuous linear functional ‚Ñìon (L‚àû, œÉ(L‚àû, L1)) such that
Œ≤ := inf
Y‚ààAœÅ
‚Ñì(Y) > ‚Ñì(m + X) =: Œ≥ > ‚àí‚àû.
(4.31)
By PropositionA.58, ‚Ñìis of the form ‚Ñì(Y) = E[ YZ ] for some Z ‚ààL1. In fact, Z ‚â•0.
To show this, Ô¨Åx Y ‚â•0 and note that œÅ(ŒªY) ‚â§œÅ(0) for Œª ‚â•0, by monotonicity.
Hence ŒªY + œÅ(0) ‚ààAœÅ for all Œª ‚â•0. It follows that
‚àí‚àû< Œ≥ < ‚Ñì

ŒªY + œÅ(0)

= Œª‚Ñì(Y) + ‚Ñì

œÅ(0)

.
Taking Œª ‚Üë‚àûyields that ‚Ñì(Y) ‚â•0 and in turn that Z ‚â•0. Moreover, P [ Z > 0 ] > 0
since ‚Ñìis non-zero. Thus,
dQ0
dP :=
Z
E[ Z ]
deÔ¨Ånes a probability measure Q0 ‚ààM1(P ). By (4.31), we see that
Œ±min(Q0) = sup
Y‚ààAœÅ
EQ0[ ‚àíY ] = ‚àí
Œ≤
E[ Z ].
However,
EQ0[ X ] + m = ‚Ñì(m + X)
E[ Z ]
=
Œ≥
E[ Z ] <
Œ≤
E[ Z ] = ‚àíŒ±min(Q0),
in contradiction to (4.30). Hence, m+X must be contained in AœÅ, and thus m ‚â•œÅ(X).
(b) ‚áí(a) is obvious, and (a) ‚áí(c)‚áî(d) follows as in Lemma 4.20, replacing point-
wise convergence by P -a.s. convergence.
(c) ‚áí(e): We have to show that C := {œÅ ‚â§c} is weak‚àóclosed for c ‚ààR. To
this end, let Cr := C ‚à©{ X ‚ààL‚àû| ‚à•X‚à•‚àû‚â§r } for r > 0. If (Xn) is a sequence
in Cr converging in L1 to some random variable X, then there is a subsequence that
converges P-a.s., and the Fatou property of œÅ implies that X ‚ààCr. Hence, Cr is
closed in L1, and Lemma A.64 implies that C := {œÅ ‚â§c} is weak‚àóclosed.
(e) ‚áí(f) is obvious.
DeÔ¨Ånition 4.32. A convex measure of risk œÅ on L‚àûis called sensitive with respect
to P if
œÅ(‚àíX) > œÅ(0)
for all X ‚ààL‚àû
+ such that P [ X > 0 ] > 0.

174
4 Monetary measures of risk
Sensitivity is also called relevance.
The theorem shows that any convex measure of risk of L‚àûthat is continuous
from above arises in the following manner. We consider any probabilistic model
Q ‚ààM1(P ), but these models are taken more or less seriously as described by the
penalty function. Thus, the value œÅ(X) is computed as the worst case, over all models
Q ‚ààM1(P ), of the expected loss EQ[ ‚àíX ], but reduced by Œ±(Q). In the following
example, the given model P is the one which is taken most seriously, and the penalty
function Œ±(Q) is proportional to the deviation of Q from P , measured by the relative
entropy.
Example 4.33. Consider the penalty function Œ± : M1(P ) ‚Üí(0, ‚àû] deÔ¨Åned by
Œ±(Q) := 1
Œ≤ H(Q|P ),
where Œ≤ > 0 is a given constant and
H(Q|P ) = EQ
 
log dQ
dP
!
is the relative entropy of Q ‚ààM1(P ) with respect to P ; see DeÔ¨Ånition 3.20. The
corresponding entropic risk measure œÅ is given by
œÅ(X) =
sup
Q‚ààM1(P )
	
EQ[ ‚àíX ] ‚àí1
Œ≤ H(Q|P )

.
The variational principle for the relative entropy as stated in Lemma 3.29 shows that
EQ[ ‚àíX ] ‚àí1
Œ≤ H(Q|P ) ‚â§1
Œ≤ log E[ e‚àíŒ≤X ],
and the upper bound is attained by the measure with the density e‚àíŒ≤X/E[ e‚àíŒ≤X ].
Thus, the entropic risk measure takes the form
œÅ(X) = 1
Œ≤ log E[ e‚àíŒ≤X ].
In particular, œÅ is sensitive with respect to P . Note that Œ± is in fact the minimal penalty
function representing œÅ, since Lemma 3.29 implies
Œ±min(Q) = sup
X‚ààL‚àû
	
EQ[ ‚àíX ] ‚àí1
Œ≤ log E[ e‚àíŒ≤X ]

= 1
Œ≤ H(Q|P ).
A Ô¨Ånancial interpretation of the entropic risk measure in terms of shortfall risk will be
discussed in Example 4.105.
‚ô¶
Theorem 4.31 takes the following form for coherent measures of risk; the proof is
the same as the one for Corollary 4.18.

4.3 Convex risk measures on L‚àû
175
Corollary 4.34. A coherent measure of risk on L‚àûcan be represented by a set Q ‚äÇ
M1(P ) if and only if the equivalent conditions of Theorem 4.31 are satisÔ¨Åed. In this
case, the maximal representing subset of M1(P ) is given by
Qmax := { Q ‚ààM1(P ) | Œ±min(Q) = 0 }.
Moreover, œÅ is sensitive if and only if Qmax ‚âàP in the sense that for any A ‚ààF
P [ A ] = 0
‚áê‚áí
Q[ A ] = 0
for all Q ‚ààQmax.
Let us also state a characterization of those coherent measures of risk on L‚àûwhich
are continuous from below.
Corollary 4.35. For a coherent measure of risk œÅ on L‚àûthe following properties are
equivalent:
(a) œÅ is continuous from below: Xn ‚ÜóX "‚áíœÅ(Xn) ‚ÜòœÅ(X).
(b) There exists a set Q ‚äÇM1(P ) representing œÅ such that the supremum is at-
tained:
œÅ(X) = max
Q‚ààQ EQ[ ‚àíX ]
for all X ‚ààX.
(c) There exists a set Q ‚äÇM1(P ) representing œÅ such that the set of densities
D :=
 dQ
dP
 Q ‚ààQ

is weakly compact in L1(, F , P).
Proof. (c) ‚áí(a): This follows from Dini‚Äôs lemma; see Remark 4.26.
(a) ‚áí(b) follows from Corollary 4.18 and Proposition 4.21.
(b) ‚áí(c): Without loss of generality, we can assume that D is weakly closed in
L1. For any X ‚ààL‚àû, the continuous linear functional JX on L1 deÔ¨Åned by
JX(Z) := E[ XZ ]
attains its inÔ¨Åmum on D. According to James‚Äô theorem as stated in Appendix A.7,
this implies weak compactness of D.
We now give examples of coherent measures of risk which will be studied in more
detail in Section 4.4.
Example 4.36. In our present context, where we require condition (4.28), the worst-
case risk measure takes the form
œÅmax(X) := ‚àíess inf X = inf

m ‚ààR | X + m ‚â•0 P -a.s.

.

176
4 Monetary measures of risk
One can easily check that œÅmax is coherent and satisÔ¨Åes the Fatou property. Moreover,
the acceptance set of œÅmax is equal to the positive cone L‚àû
+ in L‚àû, and this implies
Œ±min(Q) = 0 for any Q ‚ààM1(P ). Thus,
œÅmax(X) =
sup
Q‚ààM1(P )
EQ[ ‚àíX ].
Note however that the supremum on the right cannot be replaced by a maximum in
case (, F , P) cannot be reduced to a Ô¨Ånite model. Indeed, let X ‚ààL‚àûbe such that
X does not attain its essential inÔ¨Åmum. Then there can be no Q ‚ààM1(P ) such that
EQ[ X ] = ess inf X = ‚àíœÅmax(X). In this case, the preceding corollary shows that
œÅmax is not continuous from below.
‚ô¶
Example 4.37. Let QŒª be the class of all Q ‚ààM1(P ) whose density dQ/dP is
bounded by 1/Œª for some Ô¨Åxed parameter Œª ‚àà(0, 1). The corresponding coherent
risk measure
AV@RŒª(X) := sup
Q‚ààQŒª
EQ[ ‚àíX ]
(4.32)
will be called the Average Value at Risk at level Œª. This terminology will become
clear in Section 4.4, which contains a detailed study of AV@RŒª. Note that the set of
densities dQ/dP for Q ‚ààQŒª is weakly closed in L1. Moreover, it is weakly compact
due to the Dunford‚ÄìPettis theorem; see Theorem A.67. Thus, the supremum in (4.32)
is actually attained. An explicit construction of the maximizing measure will be given
in the proof of Theorem 4.47.
‚ô¶
Example 4.38. We take for Q the class of all conditional distributions P [ ¬∑ | A ] such
that A ‚ààF has P [ A ] > Œª for some Ô¨Åxed level Œª ‚àà(0, 1). The coherent measure of
risk induced by Q,
WCEŒª(X) := sup{ E[ ‚àíX | A ] | A ‚ààF , P [ A ] > Œª },
(4.33)
is called the worst conditional expectation at level Œª. We will show in Section 4.4
that it coincides with the Average Value at Risk of Example 4.37 if the underlying
probability space is rich enough.
‚ô¶
Remark 4.39. In analogy to Remark 4.17, the implication (e) ‚áí(a) in the Repre-
sentation Theorem 4.31 can be viewed as a special case of the general duality in
Theorem A.61 for the Fenchel‚ÄìLegendre transform of the convex function œÅ on L‚àû,
combined with the properties of a monetary risk measure. From this general point of
view, it is now clear how to state representation theorems for convex risk measures on
the Banach spaces Lp(, F , P) for 1 ‚â§p < ‚àû. More precisely, let q ‚àà(1, ‚àû] be
such that 1
p + 1
q = 1, and deÔ¨Åne
Mq
1(P ) :=
$
Q ‚ààM1(P )
 dQ
dP ‚ààLq %
.

4.4 Value at Risk
177
A convex risk measure œÅ on Lp is of the form
œÅ(X) =
sup
Q‚ààMq
1 (P )

EQ[ ‚àíX ] ‚àíŒ±(Q)

if and only if it is lower semicontinuous on Lp, i.e., the Fatou property holds in the
form
Xn ‚àí‚ÜíX in Lp
"‚áí
œÅ(X) ‚â§lim inf
n‚Üë‚àûœÅ(Xn).
‚ô¶
4.4 Value at Risk
A common approach to the problem of measuring the risk of a Ô¨Ånancial position X
consists in specifying a quantile of the distribution of X under the given probability
measure P. For Œª ‚àà(0, 1), a Œª-quantile of a random variable X on (, F , P ) is any
real number q with the property
P [ X ‚â§q ] ‚â•Œª
and
P [ X < q ] ‚â§Œª,
and the set of all Œª-quantiles of X is an interval [q‚àí
X(Œª), q+
X(Œª)], where
q‚àí
X(t) = sup{ x | P [ X < x ] < t } = inf{ x | P [ X ‚â§x ] ‚â•t }
is the lower and
q+
X(t) = inf{ x | P [ X ‚â§x ] > t } = sup{ x | P [ X < x ] ‚â§t }
is the upper quantile function of X; see Appendix A.3. In this section, we will focus
on the properties of q+
X(Œª), viewed as a functional on a space of Ô¨Ånancial positions X.
DeÔ¨Ånition 4.40. Fix some level Œª ‚àà(0, 1). For a Ô¨Ånancial position X, we deÔ¨Åne its
Value at Risk at level Œª as
V@RŒª(X) := ‚àíq+
X(Œª) = q‚àí
‚àíX(1 ‚àíŒª) = inf{ m | P [ X + m < 0 ] ‚â§Œª }.
(4.34)
In Ô¨Ånancial terms, V@RŒª(X) is the smallest amount of capital which, if added to
X and invested in the risk-free asset, keeps the probability of a negative outcome below
the level Œª. However, Value at Risk only controls the probability of a loss; it does not
capture the size of such a loss if it occurs. Clearly, V@RŒª is a monetary measure of
risk on X = L0, which is positively homogeneous. The following example shows
that the acceptance set of V@RŒª is typically not convex, and so V@RŒª is not a convex
measure of risk. Thus, V@RŒª may penalize diversiÔ¨Åcation instead of encouraging it.

178
4 Monetary measures of risk
Example 4.41. Consider an investment into two defaultable corporate bonds, each
with returnr > r, where r ‚â•0 is the return on a riskless investment. The discounted
net gain of an investment w > 0 in the ith bond is given by
Xi =
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
‚àíw
in case of default,
w(r ‚àír)
1 + r
otherwise.
If a default of the Ô¨Årst bond occurs with probability p ‚â§Œª, then
P
 
X1 ‚àíw(r ‚àír)
1 + r
< 0
!
= P [ 1
st bond defaults ] = p ‚â§Œª.
Hence,
V@RŒª(X1) = ‚àíw(r ‚àír)
1 + r
< 0.
This means that the position X1 is acceptable in the sense that is does not carry a
positive Value at Risk, regardless of the possible loss of the entire investment w.
Diversifying the portfolio by investing the amount w/2 into each of the two bonds
leads to the position Y := (X1 + X2)/2. Let us assume that the two bonds default
independently of each other, each of them with probability p. For realistic r, the
probability that Y is negative is equal to the probability that at least one of the two
bonds defaults: P [ Y < 0 ] = p(2 ‚àíp). If, for instance, p = 0.009 and Œª = 0.01
then we have p < Œª < p(2 ‚àíp), hence
V@RŒª(Y) = w
2 ¬∑

1 ‚àír ‚àír
1 + r

.
Typically, this value is close to one half of the invested capital w. In particular, the
acceptance set of V@RŒª is not convex. This example also shows that V@R may
strongly discourage diversiÔ¨Åcation: It penalizes quite drastically the increase of the
probability that something goes wrong, without rewarding the signiÔ¨Åcant reduction
of the expected loss conditional on the event of default. Thus, optimizing a portfolio
with respect to V@RŒª may lead to a concentration of the portfolio in one single asset
with a sufÔ¨Åciently small default probability, but with an exposure to large losses.
‚ô¶
In the remainder of this section, we will focus on monetary measures of risk which,
in contrast to V@RŒª, are convex or even coherent on X := L‚àû. In particular, we are
looking for convex risk measures which come close to V@RŒª. A Ô¨Årst guess might
be that one should take the smallest convex measure of risk, continuous from above,
which dominates V@RŒª. However, since V@RŒª itself is not convex, the following
proposition shows that such a smallest V@RŒª-dominating convex measure of risk
does not exist.
Proposition 4.42. For each X ‚ààX and each Œª ‚àà(0, 1),
V@RŒª(X) = min

œÅ(X) | œÅ is convex, continuous from above, and ‚â•V@RŒª

.

4.4 Value at Risk
179
Proof. Let q := ‚àíV@RŒª(X) = q+
X(Œª) so that P [ X < q ] ‚â§Œª. If A ‚ààF satisÔ¨Åes
P[ A ] > Œª, then P [ A ‚à©{X ‚â•q} ] > 0. Thus, we may deÔ¨Åne a measure QA by
QA := P [ ¬∑ | A ‚à©{X ‚â•q} ].
It follows that EQA[ ‚àíX ] ‚â§‚àíq = V@RŒª(X).
Let Q := { QA | P [ A ] > Œª }, and use this set to deÔ¨Åne a coherent measure of
risk œÅ via
œÅ(Y) := sup
Q‚ààQ
EQ[ ‚àíY ].
Then œÅ(X) ‚â§V@RŒª(X).
Hence, the assertion will follow if we can show that
œÅ(Y) ‚â•V@RŒª(Y) for each Y ‚ààX. Let Œµ > 0 and take A := { Y ‚â§‚àíV@RŒª(Y)+Œµ }.
Clearly P [ A ] > Œª, and so QA ‚ààQ. Moreover, QA[ A ] = 1, and we obtain
œÅ(Y) ‚â•EQA[ ‚àíY ] ‚â•V@RŒª(Y) ‚àíŒµ.
Since Œµ > 0 is arbitrary, the result follows.
For the rest of this section, we concentrate on the following risk measure which
is deÔ¨Åned in terms of Value at Risk, but does satisfy the axioms of a coherent risk
measure.
DeÔ¨Ånition 4.43. The Average Value at Risk at level Œª ‚àà(0, 1] of a position X ‚ààX is
given by
AV@RŒª(X) = 1
Œª
 Œª
0
V@RŒ≥ (X) dŒ≥.
Sometimes, theAverageValue at Risk is also called the ‚ÄúConditionalValue at Risk‚Äù
or the ‚Äúexpected shortfall‚Äù, and one writes CV@RŒª(X) or ESŒª(X). These terms are
motivated by formulas (4.37) and (4.35) below, but they are potentially misleading:
‚ÄúConditional Value at Risk‚Äù might also be used to denote the Value at Risk with
respect to a conditional distribution, and ‚Äúexpected shortfall‚Äù might be understood as
the expectation of the shortfall X‚àí. For these reasons, we prefer the term Average
Value at Risk. Note that
AV@RŒª(X) = ‚àí1
Œª
 Œª
0
qX(t) dt
by (4.34).
In particular, the deÔ¨Ånition of AV@RŒª(X) makes sense for any X ‚àà
L1(, F , P) and we have, in view of Lemma A.19,
AV@R1(X) = ‚àí
 1
0
q+
X(t) dt = E[ ‚àíX ].
Remark 4.44. Theorem 2.58 shows that the partial order ‚âΩuni on probability measures
on R with Ô¨Ånite mean can be characterized in terms of Average Value at Risk:
¬µ ‚âΩuni ŒΩ ‚áê‚áíAV@RŒª(X¬µ) ‚â§AV@RŒª(XŒΩ)
for all Œª ‚àà(0, 1],
where X¬µ and XŒΩ are random variables with distributions ¬µ and ŒΩ.
‚ô¶

180
4 Monetary measures of risk
Remark 4.45. For X ‚ààL‚àû, we have
lim
Œª‚Üì0 V@RŒª(X) = ‚àíess inf X = inf{ m | P [ X + m < 0 ] ‚â§0 }.
Hence, it makes sense to deÔ¨Åne
AV@R0(X) := V@R0(X) := ‚àíess inf X,
which is the worst-case risk measure on L‚àûintroduced in Example 4.36. Recall that
it is continuous from above but in general not from below.
‚ô¶
Lemma 4.46. For Œª ‚àà(0, 1) and any Œª-quantile q of X,
AV@RŒª(X) = 1
Œª E[ (q ‚àíX)+ ] ‚àíq = 1
Œª inf
r‚ààR

E[ (r ‚àíX)+ ] ‚àíŒªr

.
(4.35)
Proof. Let qX be a quantile function with qX(Œª) = q. By Lemma A.19,
1
Œª E[ (q‚àíX)+ ]‚àíq = 1
Œª
 1
0
(q‚àíqX(t))+ dt ‚àíq = ‚àí1
Œª
 Œª
0
qX(t) dt = AV@RŒª(X).
This proves the Ô¨Årst identity. The second one follows from Lemma A.22.
Theorem 4.47. For Œª ‚àà(0, 1], AV@RŒª is a coherent measure of risk which is con-
tinuous from below. It has the representation
AV@RŒª(X) = max
Q‚ààQŒª
EQ[ ‚àíX ],
X ‚ààX,
(4.36)
where QŒª is the set of all probability measures Q ‚â™P whose density dQ/dP is P -a.s.
bounded by 1/Œª. Moreover, QŒª is equal to the maximal set Qmax of Corollary 4.34.
Proof. Since Q1 = {P }, the assertion is obvious for Œª = 1. For 0 < Œª < 1, consider
the coherent risk measure œÅŒª(X) := supQ‚ààQŒª EQ[ ‚àíX ]. First we assume that we are
given some X < 0. We deÔ¨Åne a measure 
P ‚âàP by d 
P /dP = X/E[ X ]. Then
œÅŒª(X) = E[ ‚àíX ]
Œª
sup
 
E[ œï ] | 0 ‚â§œï ‚â§1, E[ œï ] = Œª

.
Clearly, the condition E[ œï ] = Œª on the right can be replaced by E[ œï ] ‚â§Œª. Thus,
we can apply the Neyman‚ÄìPearson lemma in the form of Theorem A.30 and conclude
that the supremum is attained by
œï0 = I{X<q} + Œ∫I{X=q}
for a Œª-quantile q of X and some Œ∫ ‚àà[0, 1] for which E[ œï0 ] = Œª. Hence,
œÅŒª(X) = E[ ‚àíX ]
Œª
¬∑ 
E[ œï0 ] = 1
ŒªE[ ‚àíXœï0 ],

4.4 Value at Risk
181
Since dQ0 = Œª‚àí1œï0 dP deÔ¨Ånes a probability measure in QŒª, we conclude that
œÅŒª(X) = max
Q‚ààQŒª
EQ[ ‚àíX ] = EQ0[ ‚àíX ]
= 1
Œª

E[ ‚àíX; X < q] ‚àíqŒª + qP [ X < q ]

= 1
Œª E[ (q ‚àíX)+ ] ‚àíq
= AV@RŒª(X),
where we have used (4.35) in the last step. This proves (4.36) for X < 0. For arbitrary
X ‚ààL‚àû, we use the cash invariance of both œÅŒª and AV@RŒª.
It remains to prove that QŒª is the maximal set of Corollary 4.34. To this end, we
show that
sup
X‚ààX

EQ[ ‚àíX ] ‚àíAV@RŒª(X)

= +‚àû
for Q /‚ààQŒª. We denote by œï the density dQ/dP . There exist Œª‚Ä≤ ‚àà(0, Œª) and
k > 1/Œª‚Ä≤ such that P [ œï ‚àßk ‚â•1/Œª‚Ä≤ ] > 0. For c > 0 deÔ¨Åne X(c) ‚ààX by
X(c) := ‚àíc(œï ‚àßk)I{œï‚â•1/Œª‚Ä≤}.
Since
P [ X(c) < 0 ] = P

œï ‚â•1
Œª‚Ä≤

‚â§Œª‚Ä≤ < Œª,
we have V@RŒª(X(c)) = 0, and (4.35) yields that
AV@RŒª(X(c)) = 1
ŒªE[ ‚àíX(c) ] = c
ŒªE

œï ‚àßk; œï ‚â•1
Œª‚Ä≤

.
On the other hand,
EQ[ ‚àíX(c) ] = c ¬∑ E

œï ¬∑ œï ‚àßk; œï ‚â•1
Œª‚Ä≤

‚â•c
Œª‚Ä≤ E

œï ‚àßk; œï ‚â•1
Œª‚Ä≤

.
Thus, the difference between EQ[ ‚àíX(c) ] and AV@RŒª(X(c)) becomes arbitrarily
large as c ‚Üë‚àû.
Remark 4.48. The proof shows that for Œª ‚àà(0, 1) the maximum in (4.36) is attained
by the measure Q0 ‚ààQŒª, whose density is given by
dQ0
dP = 1
Œª

I{X<q} + Œ∫I{X=q}

,
where q is a Œª-quantile of X, and where Œ∫ is deÔ¨Åned as
Œ∫ :=
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
0
if P [ X = q ] = 0,
Œª ‚àíP [ X < q ]
P [ X = q ]
otherwise.
‚ô¶

182
4 Monetary measures of risk
Corollary 4.49. For all X ‚ààX,
AV@RŒª(X) ‚â•WCEŒª(X)
‚â•E[ ‚àíX | ‚àíX ‚â•V@RŒª(X) ]
(4.37)
‚â•V@RŒª(X),
where WCEŒª is the coherent risk measure deÔ¨Åned in (4.33). Moreover, the Ô¨Årst two
inequalities are in fact identities if
P

X ‚â§q+
Œª (X)

= Œª,
(4.38)
which is the case if X has a continuous distribution.
Proof. If P[ A ] ‚â•Œª, then the density P [ ¬∑ | A ] with respect to P is bounded by 1/Œª.
Therefore, Theorem 4.47 implies that AV@RŒª dominates WCEŒª. Since
P

‚àíX ‚â•V@RŒª(X) ‚àíŒµ

> Œª,
we have
WCEŒª(X) ‚â•E

‚àíX | ‚àíX ‚â•V@RŒª(X) ‚àíŒµ

,
and the second inequality follows by taking the limit Œµ ‚Üì0. Moreover, (4.35) shows
that
AV@RŒª(X) = E

‚àíX | ‚àíX ‚â•V@RŒª(X)

as soon as (4.38) holds.
Remark 4.50. We will see in Corollary 4.62 that the two coherent risk measures
AV@RŒª and WCEŒª coincide if the underlying probability space is rich enough. If this
is not the case, then the Ô¨Årst inequality in (4.37) may be strict for some X; see [1].
Moreover, the functional
E[ ‚àíX | ‚àíX ‚â•V@RŒª(X) ]
does not deÔ¨Åne a convex measure of risk. Hence, the second inequality in (4.37)
cannot reduce to an identity in general.
‚ô¶
Remark 4.51. We have seen in Proposition 4.42 that there is no smallest convex risk
measure dominating V@RŒª. But if we restrict our attention to the class of convex
risk measures that dominate V@RŒª and only depend on the distribution of a random
variable, then the situation is different. In fact, we will see in Theorem 4.61 that
AV@RŒª is the smallest risk measure in this class, provided that the underlying prob-
ability space is rich enough. In this sense, Average Value at Risk can be regarded as
the best conservative approximation to Value at Risk.
‚ô¶

4.5 Law-invariant risk measures
183
4.5
Law-invariant risk measures
Clearly, V@RŒª and AV@RŒª only involve the distribution of a position under the given
probability measure P . In this section we study the class of all risk measures which
share this property of law-invariance.
DeÔ¨Ånition 4.52. A monetary measure of risk œÅ on X = L‚àû(, F , P ) is called
law-invariant if œÅ(X) = œÅ(Y) whenever X and Y have the same distribution under P .
Throughout this section, we assume that the probability space (, F , P ) is rich
enough in the sense that it supports a random variable with a continuous distribution.
This condition is satisÔ¨Åed if and only if (, F , P ) is atomless; see Proposition A.27.
Remark 4.53. Any law-invariant monetary risk measure œÅ is monotone with respect
to the partial order ‚âΩmon introduced in DeÔ¨Ånition 2.69. More precisely,
¬µ ‚âΩmon ŒΩ
"‚áí
œÅ(X¬µ) ‚â§œÅ(XŒΩ),
if X¬µ and XŒΩ are random variables with distributions ¬µ and ŒΩ. To prove this, let q¬µ
and qŒΩ be quantile functions for ¬µ and ŒΩ and take a random variable U with a uniform
distribution on (0, 1). Then 
X¬µ := q¬µ(U) ‚â•qŒΩ(U) =: 
XŒΩ by Theorem 2.70, and

X¬µ and 
XŒΩ have the same distribution as X¬µ and XŒΩ by Lemma A.19. Hence, law-
invariance and monotonicity of œÅ imply œÅ(X¬µ) = œÅ(
X¬µ) ‚â§œÅ(
XŒΩ) = œÅ(XŒΩ).
‚ô¶
We can now formulate our Ô¨Årst structure theorem for law-invariant convex risk
measures.
Theorem 4.54. Let œÅ be a convex measure of risk and suppose that œÅ is continuous
from above. Then œÅ is law-invariant if and only if its minimal penalty function Œ±min(Q)
depends only on the law of œïQ := dQ
dP under P when Q ‚ààM1(P ). In this case, œÅ has
the representation
œÅ(X) =
sup
Q‚ààM1(P )
	  1
0
q‚àíX(t)qœïQ(t) dt ‚àíŒ±min(Q)

,
and the minimal penalty function satisÔ¨Åes
Œ±min(Q) = sup
X‚ààAœÅ
 1
0
q‚àíX(t)qœïQ(t) dt
= sup
X‚ààL‚àû
	  1
0
q‚àíX(t)qœïQ(t) ‚àíœÅ(X)

.
(4.39)
For the proof, we will need the following lemma.
Lemma 4.55. For X ‚ààL‚àûand Y ‚ààL1,
 1
0
qX(t)qY (t) dt = sup

X‚àºX
E[ 
XY ],
where 
X ‚àºX indicates that 
X is a random variable with the same law as X.

184
4 Monetary measures of risk
Proof. The upper Hardy‚ÄìLittlewood inequality in TheoremA.24 yields ‚Äú‚â•‚Äù. To prove
the reverse inequality, let us Ô¨Årst assume that Y has a continuous distribution. Then
Lemma A.21 implies that U := FY (Y) has a uniform distribution and that P -a.s.
Y = qY (U). Since 
X := qX(U) ‚àºX by Lemma A.19, we obtain
E[ 
XY ] = E[ qX(U)qY (U) ] =
 1
0
qX(t)qY (t) dt,
and hence ‚Äú‚â§‚Äù.
In the general case, let D be the set of all y such that P [ Y = y ] > 0 and take
a random variable Z ‚ààL1
+ with a continuous distribution. Such a random variable
exists due to Proposition A.27. We claim that the law of
Yn := Y + 1
nZI{Y‚ààD}
is continuous. Indeed, for any y,
P [ Yn = y ] = P [ Y = y, Y /‚ààD ] +

x‚ààD
P [ Y = x, Z = n(y ‚àíx) ] = 0.
Thus, Un := FYn(Yn) has a uniform distribution on (0, 1), and Xn := qX(Un) has the
same distribution as X. By adding a suitable constant to X, we may assume without
loss of generality that X ‚â•0. Since Yn ‚â•Y we have qYn ‚â•qY a.e., and it follows
from the Ô¨Årst part of the proof that
 1
0
qX(t)qY (t) dt ‚â§lim inf
n‚Üë‚àû
 1
0
qX(t)qYn(t) dt
= lim inf
n‚Üë‚àû
sup

X‚àºX
E[ 
XYn ]
= sup

X‚àºX
E[ 
XY ],
where the last identity follows from the fact that
E[ 
XYn ] ‚àíE[ 
XY ]
 ‚â§1
n‚à•Z‚à•1‚à•X‚à•‚àû,
for all 
X ‚àºX.
Proof of Theorem 4.54. Suppose Ô¨Årst that œÅ is law-invariant. Then X ‚ààAœÅ implies
that 
X ‚ààAœÅ for all 
X ‚àºX. Hence,
Œ±min(Q) = sup
X‚ààAœÅ
E[ ‚àíXœïQ ] = sup
X‚ààAœÅ
sup

X‚àºX
E[ ‚àí
XœïQ ] = sup
X‚ààAœÅ
 1
0
q‚àíX(t)qœïQ(t) dt,

4.5 Law-invariant risk measures
185
where we have used Lemma 4.55 in the last step. It follows that Œ±min(Q) depends
only on the law of œïQ. In order to check the second identity in (4.39), note that

X := X + œÅ(X) belongs to AœÅ for any X ‚ààL‚àûand that q‚àíX ‚àíœÅ(X) is a quantile
function for ‚àí
X.
Conversely, let us assume that Œ±min(Q) depends only on the law of œïQ. Let us
write 
Q ‚àºQ to indicate that œïQ and œï
Q have the same law. Then Lemma 4.55 yields
œÅ(X) =
sup
Q‚ààM1(P )
	
EQ[ ‚àíX ] ‚àíŒ±min(Q)

=
sup
Q‚ààM1(P )
sup

Q‚àºQ
	
E[ ‚àíXœï
Q ] ‚àíŒ±min(Q)

=
sup
Q‚ààM1(P )
	  1
0
q‚àíX(t)qœïQ(t) dt ‚àíŒ±min(Q)

.
Example 4.56. Let u : R ‚ÜíR be an increasing concave function, and suppose that
a position X ‚ààL‚àûis acceptable if E[ u(X) ] ‚â•c, where c is a given constant in the
interior of u(R). We have seen in Example 4.10 that the corresponding acceptance set
induces a convex risk measure œÅ. Clearly, œÅ is law-invariant, and it will be shown in
Proposition 4.104 that œÅ is continuous from below and, hence, from above. Moreover,
the corresponding minimal penalty function can be computed as
Œ±min(Q) = inf
Œª>0
1
Œª

x0 +
 1
0
‚Ñì‚àó
Œª ¬∑ qœïQ(t)

dt

,
where
‚Ñì‚àó(y) = sup
x‚ààR

xy + u(‚àíx)

= sup
x‚ààR

xy ‚àí‚Ñì(x)

is the Fenchel‚ÄìLegendre transform of the convex increasing loss function ‚Ñì(x) :=
‚àíu(‚àíx); see Theorem 4.106.
‚ô¶
The following theorem clariÔ¨Åes the crucial role of the risk measures AV@RŒª: they
can be viewed as the building blocks for law-invariant convex measures of risk on L‚àû.
Recall that we assume that (, F , P) is atomless.
Theorem 4.57. A convex measure of risk œÅ is law-invariant and continuous from
above if and only if
œÅ(X) =
sup
¬µ‚ààM1((0,1])
	 
(0,1]
AV@RŒª(X) ¬µ(dŒª) ‚àíŒ≤min(¬µ)

,
(4.40)
where
Œ≤min(¬µ) = sup
X‚ààAœÅ

(0,1]
AV@RŒª(X) ¬µ(dŒª).

186
4 Monetary measures of risk
Proof. Clearly, the right-hand side of (4.40) deÔ¨Ånes a law-invariant convex risk mea-
sure that is continuous from above. Conversely, let œÅ be law-invariant and continuous
from above. We will show that for Q ‚ààM1(P ) there exists a measure ¬µ ‚ààM1((0, 1])
such that
 1
0
q‚àíX(t)qœï(t) dt =

(0,1]
AV@Rs(X) ¬µ(ds),
where œï := œïQ = dQ
dP . Then the assertion will follow from Theorem 4.54. Since
q‚àíX(t) = V@R1‚àít(X) and qœï(t) = q+
œï (t) for a.e. t ‚àà(0, 1),
 1
0
q‚àíX(t)qœï(t) dt =
 1
0
V@Rt(X)q+
œï (1 ‚àít) dt.
Since q+
œï is increasing and right-continuous, we can write q+
œï (t) = ŒΩ((1 ‚àít, 1]) for
some positive locally Ô¨Ånite measure ŒΩ on (0, 1]. Moreover, the measure ¬µ given by
¬µ(dt) = t ŒΩ(dt) is a probability measure on (0, 1]:

(0,1]
t ŒΩ(dt) =
 1
0
ŒΩ((s, 1]) ds =
 1
0
q+
œï (s) ds = E[ œï ] = 1.
Thus,
 1
0
q‚àíX(t)qœï(t) dt =
 1
0
V@Rt(X)

(t,1]
1
s ¬µ(ds) dt
=

(0,1]
1
s
 s
0
V@Rt(X) dt ¬µ(ds)
(4.41)
=

(0,1]
AV@Rs(X) ¬µ(ds).
Conversely, for any probability measure ¬µ on (0, 1], the function q deÔ¨Åned by q(t) :=

(1‚àít,1] s‚àí1 ¬µ(ds) can be viewed as the quantile function of the density œï := q(U)
of a measure Q ‚ààM1(P ), where U has a uniform distribution on (0, 1). Altogether,
we obtain a one-to-one correspondence between laws of densities œï and probability
measures ¬µ on (0, 1].
Theorem 4.57 takes the following form for coherent measures of risk.
Corollary 4.58. AcoherentriskmeasureœÅ iscontinuousfromaboveandlaw-invariant
if and only if
œÅ(X) = sup
¬µ‚ààM

(0,1]
AV@RŒª(X) ¬µ(dŒª)
for some set M ‚äÇM1((0, 1]).
Randomness of a position is reduced in terms of P if we replace the position by
its conditional expectation with respect to some œÉ-algebra G ‚äÇF . Such a reduction
of randomness is reÔ¨Çected by a convex risk measure if it is law-invariant:

4.5 Law-invariant risk measures
187
Corollary 4.59. Assume that œÅ is a convex risk measure which is continuous from
above and law-invariant. Then œÅ is monotone with respect to the binary relation ‚âΩuni
introduced in (3.27):
Y ‚âΩuni X
"‚áí
œÅ(Y) ‚â§œÅ(X),
for Y, X ‚ààX. In particular,
œÅ

E[ X | G ]

‚â§œÅ(X),
for X ‚ààX and any œÉ-algebra G ‚äÇF , and
œÅ

E[ X ]

= œÅ(0) ‚àíE[ X ] ‚â§œÅ(X).
Proof. The Ô¨Årst inequality follows from Theorem 4.57 combined with Remark 4.44.
The second inequality is a special case of the Ô¨Årst one, since E[ X |G ] ‚âΩuni X according
to Theorem 2.58. The third follows from the second by taking G = {‚àÖ, }.
Recall from Theorem 2.70 that ¬µ ‚âΩmon ŒΩ implies ¬µ ‚âΩuni ŒΩ. Thus, the preceding
conclusion for convex risk measures is stronger than the one of Remark 4.53 for
monetary risk measures.
Remark 4.60. If G1 ‚äÇG2 ‚äÇ¬∑ ¬∑ ¬∑ ‚äÇF are œÉ-algebras, then
œÅ

E[ X | Gn ]

‚àí‚ÜíœÅ

E[ X | G‚àû]

as n ‚Üë‚àû,
where œÅ is as in Corollary 4.59 and G‚àû= œÉ
 
n Gn

.
Indeed, Doob‚Äôs martin-
gale convergence theorem (see, e.g., Theorem 19.1 in [19]) states that E[ X | Gn ] ‚Üí
E[ X | G‚àû] P-a.s. as n ‚Üë‚àû. Hence, the Fatou property and Corollary 4.59 show
that
œÅ

E[ X | G‚àû]

= œÅ

lim
n‚Üë‚àûE[ X | Gn ]

‚â§lim inf
n‚Üë‚àûœÅ

E[ X | Gn ]

‚â§œÅ

E[ X | G‚àû]

.
‚ô¶
In contrast to Proposition 4.42, the following theorem shows that AV@RŒª is the
best conservative approximation to V@RŒª in the class of all law-invariant convex
measures of risk which are continuous from above.
Theorem 4.61. AV@RŒª is the smallest law-invariant convex measure of risk which
is continuous from above and dominates V@RŒª.
Proof. That AV@RŒª dominates V@RŒª was already stated in (4.37). Suppose now that
œÅ is another law-invariant convex risk measure which dominates V@RŒª and which is
continuous from above. We must show that for a given X ‚ààX
œÅ(X) ‚â•AV@RŒª(X).
(4.42)

188
4 Monetary measures of risk
Take Œµ > 0, and let A := { ‚àíX ‚â•V@RŒª(X) ‚àíŒµ } and
Y := E[ X | XIAc ] = X ¬∑ IAc + E[ X | A ] ¬∑ IA.
Since Y > q+
X(Œª) + Œµ ‚â•E[ X | A ] on Ac, we get P [ Y < E[ X | A ] ] = 0. On the
other hand, P[ Y ‚â§E[ X | A ] ] ‚â•P [ A ] > Œª, and this implies that V@RŒª(Y) =
E[ ‚àíX | A ]. Since œÅ dominates V@RŒª, we have œÅ(Y) ‚â•E[ ‚àíX | A ]. Thus,
œÅ(X) ‚â•œÅ(Y) = E[ ‚àíX | ‚àíX ‚â•V@RŒª(X) ‚àíŒµ ],
by Corollary 4.59. Taking Œµ ‚Üì0 yields
œÅ(X) ‚â•E[ ‚àíX | ‚àíX ‚â•V@RŒª(X) ].
If the distribution of X is continuous, Corollary 4.49 states that the conditional expec-
tation on the right equals AV@RŒª(X), and we obtain (4.42). If the distribution of X
is not continuous, we denote by D the set of all points x such that P [ X = x ] > 0
and take any bounded random variable Z ‚â•0 with a continuous distribution. Such a
random variable exists due to Proposition A.27. We have seen in the proof of Lemma
4.55 that Xn := X + 1
n ZI{X‚ààD} has a continuous distribution. Moreover, Xn de-
creases to X. The inequality (4.42) holds for each Xn and extends to X by continuity
from above.
Corollary 4.62. AV@RŒª and WCEŒª coincide under our assumption that the proba-
bility space is atomless.
Proof. We know from Corollary 4.49 that WCEŒª(X) = AV@RŒª(X) if X has a
continuous distribution. Repeating the approximation argument at the end of the
preceding proof yields WCEŒª(X) = AV@RŒª(X) for each X ‚ààX.
4.6
Concave distortions
Let us now have a closer look at the coherent risk measures
œÅ¬µ(X) :=

AV@RŒª(X) ¬µ(dŒª),
(4.43)
which appear in the Representation Theorem 4.57 for law-invariant convex risk mea-
sures. WearegoingtocharacterizetheseriskmeasuresœÅ¬µ intwoways, Ô¨ÅrstasChoquet
integrals with respect to some concave distortion of the underlying probability measure
P, and then, in the next section, by a property of comonotonicity.
Again, we will assume throughout this section that the underlying probability
space (, F , P) is atomless. Since AV@RŒª is coherent, continuous from below,

4.6 Concave distortions
189
and law-invariant, any mixture œÅ¬µ for some probability measure ¬µ on (0, 1] has the
same properties. According to Remark 4.45, we may set AV@R0(X) = ‚àíess inf X
so that we can extend the deÔ¨Ånition (4.43) to probability measures ¬µ on the closed
interval [0, 1]. However, œÅ¬µ will only be continuous from above and not from below
if ¬µ({0}) > 0, because AV@R0 is not continuous from below.
Our Ô¨Årst goal is to show that œÅ¬µ(X) can be identiÔ¨Åed with the Choquet integral
of the loss ‚àíX with respect to the set function cœà(A) := œà(P[ A ]), where œà is the
concave function deÔ¨Åned in the following lemma. Choquet integrals were introduced
in Remark ??. Recall that every concave function œà admits a right-continuous right-
hand derivative œà‚Ä≤
+; see Proposition A.4.
Lemma 4.63. The identity
œà‚Ä≤
+(t) =

(t,1]
s‚àí1 ¬µ(ds) ,
0 < t < 1,
(4.44)
deÔ¨Ånes a one-to-one correspondence between probability measures ¬µ on [0, 1] and
increasing concave functions œà : [0, 1] ‚Üí[0, 1] with œà(0) = 0 and œà(1) = 1.
Moreover, we have œà(0+) = ¬µ({0}).
Proof. Suppose Ô¨Årst that ¬µ is given and œà is deÔ¨Åned by œà(1) = 1 and (4.44). Then
œà is concave and increasing on (0, 1]. Moreover,
1 ‚àíœà(0+) =
 1
0
œà‚Ä≤(t) dt =

(0,1]
1
s
 1
0
I{t<s‚â§1} dt ¬µ(ds) = ¬µ((0, 1]) ‚â§1.
Hence, we may set œà(0) := 0 and obtain an increasing concave function on [0, 1].
Conversely, if œà is given, then œà‚Ä≤
+(t) is a decreasing right-continuous function on
(0, 1) and can be written as œà‚Ä≤
+(t) = ŒΩ((t, 1]) for some locally Ô¨Ånite positive measure
ŒΩ on (0, 1]. We Ô¨Årst deÔ¨Åne ¬µ on (0, 1] by ¬µ(dt) = t ŒΩ(dt). Then (4.44) holds and, by
Fubini‚Äôs theorem,
¬µ((0, 1]) =
 1
0

(0,1]
I{t<s} ŒΩ(ds) dt = 1 ‚àíœà(0+) ‚â§1.
Hence, setting ¬µ({0}) := œà(0+) deÔ¨Ånes a probability measure ¬µ on [0, 1].
Theorem 4.64. For a probability measure ¬µ on [0, 1], let œà be the concave function
deÔ¨Åned in Lemma 4.63. Then, for X ‚ààX,
œÅ¬µ(‚àíX) = œà(0+)AV@R0(‚àíX) +
 1
0
qX(t)œà‚Ä≤(1 ‚àít) dt
=
 0
‚àí‚àû

œà(P[ X > x ]) ‚àí1

dx +
 ‚àû
0
œà(P[ X > x ]) dx.

190
4 Monetary measures of risk
Proof. Using the fact that V@RŒª(‚àíX) = q‚àí
X(1 ‚àíŒª), we get as in (4.41) that

(0,1]
AV@RŒª(‚àíX) ¬µ(dŒª) =
 1
0
qX(t)œà‚Ä≤(1 ‚àít) dt.
Hence, we obtain the Ô¨Årst identity. For the second one, we will Ô¨Årst assume X ‚â•0.
Then
q+
X(t) = sup{ x ‚â•0 | FX(x) ‚â§t } =
 ‚àû
0
I{FX(x)‚â§t} dx,
where FX is the distribution function of X. Using Fubini‚Äôs theorem, we obtain
 1
0
qX(t)œà‚Ä≤(1 ‚àít) dt =
 ‚àû
0
 1
0
I{FX(x)‚â§1‚àít}œà‚Ä≤(t) dt dx
=
 ‚àû
0
œà(1 ‚àíFX(x)) dx ‚àíœà(0+) ess sup X,
since
 y
0 œà‚Ä≤(t) dt = (œà(y) ‚àíœà(0+))I{y>0}. This proves the second identity for
X ‚â•0, since œà(0+) = ¬µ({0}) and ess sup X = AV@R0(‚àíX). If X ‚ààL‚àûis
arbitrary, we consider X + C, where C := ‚àíess inf X. The cash invariance of œÅ¬µ
yields
C + œÅ¬µ(‚àíX) =
 ‚àû
0
œà(P[ X > x ‚àíC ]) dx
=
 0
‚àíC
œà(P[ X > x ]) dx +
 ‚àû
0
œà(P[ X > x ]) dx
= C +
 0
‚àí‚àû

œà(P[ X > x ]) ‚àí1

dx +
 ‚àû
0
œà(P[ X > x ]) dx.
Example 4.65. Clearly, the risk measure AV@RŒª is itself of the form œÅ¬µ where
¬µ = Œ¥Œª. For Œª > 0, the corresponding concave distortion function is given by
œà(t) =
	 t
Œª

‚àß1 = 1
Œª (t ‚àßŒª).
Thus, we obtain yet another representation of AV@RŒª:
AV@RŒª(‚àíX) = 1
Œª
 ‚àû
0
P [ X > x ] ‚àßŒª dx
for X ‚ààL‚àû
+ .
‚ô¶
Corollary 4.66. If ¬µ({0}) = 0 in Theorem 4.64, then
œÅ¬µ(X) = ‚àí
 1
0
qX(œï(t)) dt,
where œï is an inverse function of œà, taken in the sense of DeÔ¨Ånition A.14.

4.6 Concave distortions
191
Proof. Due to Lemma A.15, the distribution of œï under the Lebesgue measure has the
distribution function œà and hence the density œà‚Ä≤. Therefore
 1
0
qX(œï(t)) dt =
 1
0
qX(t)œà‚Ä≤(t) dt = ‚àí
 1
0
q‚àíX(1 ‚àít)œà‚Ä≤(t) dt,
where we have used Lemma A.23 in the last step. An application of Theorem 4.64
concludes the proof.
Let us continue with a brief discussion of the set function cœà(A) = œà(P[ A ]).
DeÔ¨Ånition 4.67. Let œà : [0, 1] ‚Üí[0, 1] be an increasing function such that œà(0) = 0
and œà(1) = 1. The set function
cœà(A) := œà(P[ A ]),
A ‚ààF ,
is called the distortion of the probability measure P with respect to the distortion
function œà.
DeÔ¨Ånition 4.68. A set function c : F ‚Üí[0, 1] is called monotone if
c(A) ‚â§c(B)
for A ‚äÇB
and normalized if
c(‚àÖ) = 0
and
c() = 1.
A monotone set function is called submodular or 2-alternating if
c(A ‚à™B) + c(A ‚à©B) ‚â§c(A) + c(B).
Clearly, any distortion cœà is normalized and monotone.
Proposition 4.69. Let cœà be the distortion of P with respect to the distortion function
œà. If œà is concave, then cœà is submodular. Moreover, if the underlying probability
space is atomless, then also the converse implication holds.
Proof. Suppose Ô¨Årst that œà is concave. Take A, B ‚ààF with P [ A ] ‚â§P [ B ]. We
must show that c := cœà satisÔ¨Åes
c(A) ‚àíc(A ‚à©B) ‚â•c(A ‚à™B) ‚àíc(B).
This is trivial if r = 0, where
r := P [ A ] ‚àíP [ A ‚à©B ] = P [ A ‚à™B ] ‚àíP [ B ].
For r > 0 the concavity of œà yields via (A.1) that
c(A) ‚àíc(A ‚à©B)
P [ A ] ‚àíP [ A ‚à©B ] ‚â•
c(A ‚à™B) ‚àíc(B)
P [ A ‚à™B ] ‚àíP [ B ].

192
4 Monetary measures of risk
Multiplying both sides with r gives the result.
Now suppose that c = cœà is submodular and assume that (, F , P ) is atomless.
We have to show that œà(y) ‚â•(œà(x) + œà(z))/2 whenever 0 ‚â§x ‚â§z ‚â§1 and
y = (x + z)/2. To this end, we will construct two sets A, B ‚äÇF such that P [ A ] =
P[ B ] = y, P[ A ‚à©B ] = x, and P [ A ‚à™B ] = z.
Submodularity then gives
œà(x) + œà(z) ‚â§2œà(y) and in turn the concavity of œà.
In order to construct the two sets A and B, take a random variable U with a uniform
distribution on [0, 1], which exists by Proposition A.27. Then
A := { 0 ‚â§U ‚â§y }
and
B := { z ‚àíy ‚â§U ‚â§z }
are as desired.
Let us now recall the notion of a Choquet integral, which was introduced in Ex-
ample 4.13.
DeÔ¨Ånition 4.70. Let c : F ‚Üí[0, 1] be any set function which is normalized and
monotone. The Choquet integral of a bounded measurable function X on (, F )
with respect to c is deÔ¨Åned as

X dc :=
 0
‚àí‚àû
(c(X > x) ‚àí1) dx +
 ‚àû
0
c(X > x) dx.
Note that the Choquet integral coincides with the usual integral as soon as c is a
œÉ-additive probability measure; see also Lemma 4.91 below.
With this deÔ¨Ånition, Theorem 4.64 allows us to identify the risk measure œÅ¬µ as the
Choquet integral of the loss with respect to a concave distortion cœà of the underlying
probability measure P :
Corollary 4.71. For a probability measure ¬µ on [0, 1], let œà be the concave distortion
function deÔ¨Åned in Lemma 4.63, and let cœà denote the distortion of P with respect
to œà. Then, for X ‚ààL‚àû,
œÅ¬µ(X) =

(‚àíX) dcœà.
Combining Corollary 4.71 with Theorem 4.57, we obtain the following character-
ization of law-invariant convex risk measures in terms of concave distortions:
Corollary 4.72. A convex risk measure œÅ is law-invariant and continuous from above
if and only if
œÅ(X) = sup
œà
	 
(‚àíX) dcœà ‚àíŒ≥min(œà)

,
where the supremum is taken over the class of all concave distortion functions œà and
Œ≥min(œà) := sup
X‚ààAœÅ

(‚àíX) dcœà.

4.6 Concave distortions
193
As another consequence of Theorem 4.64, we obtain an explicit description of the
maximal representing set Q¬µ ‚äÇM1(P ) for the coherent risk measure œÅ¬µ.
Theorem 4.73. Let ¬µ be a probability measure on [0, 1], and let œà be the correspond-
ing concave function deÔ¨Åned in Lemma 4.63. Then œÅ¬µ can be represented as
œÅ¬µ(X) = sup
Q‚ààQ¬µ
EQ[ ‚àíX ],
where the set Q¬µ is given by
Q¬µ :=
$
Q ‚ààM1(P )
 œï := dQ
dP satisÔ¨Åes
 1
t
qœï(s) ds ‚â§œà(1 ‚àít) for t ‚àà(0, 1)
%
.
Moreover, Q¬µ is the maximal subset of M1(P ) that represents œÅ¬µ.
Proof. The risk measure œÅ¬µ is coherent and continuous from above. By Corollary 4.34,
it can be represented by taking the supremum of expectations over the set Qmax =
{ Q ‚ààM1(P ) | Œ±min(Q) = 0 }. Using (4.39) and Theorem 4.64, we see that a measure
Q ‚ààM1(P ) with density œï = dQ/dP belongs to Qmax if and only if
 1
0
qX(s)qœï(s) ds ‚â§œÅ¬µ(‚àíX)
= œà(0+)AV@R0(‚àíX) +
 1
0
qX(s)œà‚Ä≤(1 ‚àís) ds
(4.45)
for all X ‚ààL‚àû. For constant random variables X ‚â°t, we have qX = I[t,1] a.e., and
so we obtain
 1
t
qœï(s) ds ‚â§œà(0+) +
 1
t
œà‚Ä≤(1 ‚àís) ds = œà(1 ‚àít)
for all t ‚àà(0, 1). Hence Qmax ‚äÇQ¬µ. For the proof of the converse inclusion, we show
that the density œï of a Ô¨Åxed measure Q ‚ààQ¬µ satisÔ¨Åes (4.45) for any given X ‚ààL‚àû.
To this end, let ŒΩ be the positive Ô¨Ånite measure on [0, 1] such that q+
X(s) = ŒΩ([0, s]).
Using Fubini‚Äôs theorem and the deÔ¨Ånition of Q¬µ, we get
 1
0
qX(s)qœï(s) ds =

[0,1]
 1
t
qœï(s) ds ŒΩ(dt)
‚â§

[0,1]
œà(1 ‚àít) ŒΩ(dt)
= œà(0+)ŒΩ([0, 1]) +
 1
0
œà‚Ä≤(1 ‚àís)

[0,s]
ŒΩ(dt) ds,
which coincides with the right-hand side of (4.45).

194
4 Monetary measures of risk
Corollary 4.74. In the context of Theorem 4.73, the following conditions are equiv-
alent.
(a) œÅ¬µ is continuous from below.
(b) ¬µ({0}) = 0.
(c) œÅ¬µ(X) = max
Q‚ààQ¬µ
EQ[ ‚àíX ] for all X ‚ààL‚àû.
If these equivalent conditions are satisÔ¨Åed, then the maximum in (c) is attained by
the measure QX ‚ààQ¬µ with density dQX/dP = f (X), where f is the decreasing
function deÔ¨Åned by
f (x) := œà‚Ä≤(FX(x))
if x is a continuity point of FX, and by
f (x) :=
1
FX(x) ‚àíFX(x‚àí)
 FX(x)
FX(x‚àí)
œà‚Ä≤(t) dt
otherwise. Moreover, with Œª denoting the Lebesgue measure on (0, 1),
Q¬µ =
$
Q ‚â™P
 P ‚ó¶
	dQ
dP

‚àí1
‚âΩuni Œª ‚ó¶(œà‚Ä≤)‚àí1 %
.
(4.46)
Proof. The equivalence of conditions (a) and (c) has already been proved in Corol-
lary 4.35.
If (b) holds, then œÅ¬µ is continuous from below, due to Theorem 4.47
and monotone convergence. Let us now show that condition (a) is not satisÔ¨Åed if
Œ¥ := ¬µ({0}) > 0. In this case, we can write
œÅ¬µ = Œ¥AV@R0 + (1 ‚àíŒ¥)œÅ¬µ‚Ä≤,
where ¬µ‚Ä≤ := ¬µ( ¬∑ |(0, 1]). Then œÅ¬µ‚Ä≤ is continuous from below since ¬µ‚Ä≤({0}) = 0, but
AV@R0 is not, and so œÅ¬µ does not satisfy (a); see Remark 4.45.
Let us now prove the remaining assertions.
Since œà(0+) = ¬µ({0}) = 0, a
measure Q with density œï = dQ/dP belongs to Q¬µ if and only if
 1
t qœï(s) ds ‚â§
 1
t œà‚Ä≤(1‚àís) ds for all t. Since œà‚Ä≤(1‚àít) is a quantile function for the law of œà‚Ä≤ under
Œª, part (e) of Theorem 2.58 implies (4.46). The problem of identifying the maximizing
measure QX is hence equivalent to minimizing E[ œïX ] under the constraint that œï
is a density function such that P ‚ó¶œï‚àí1 ‚âΩuni Œª ‚ó¶(œà‚Ä≤)‚àí1. Let us Ô¨Årst assume that
X ‚â•0. Then it follows from Theorem 3.44 that f (X) minimizes E[ YX ] among
all Y ‚ààL1
+ such that P ‚ó¶Y ‚àí1 ‚âΩuni Œª ‚ó¶(œà‚Ä≤)‚àí1. Moreover, Remark 3.46 shows that
E[ f (X) ] =
 1
0 œà‚Ä≤(t) dt = 1, and so œïX := f (X) ‚â•0 is the density of an optimal
probability measure QX ‚ààQ¬µ. If X is not positive, then we may take a constant
c such that X + c ‚â•0 and apply the preceding argument. The formula for f then
follows from the fact that FX+c(X + c) = FX(X).

4.7 Comonotonic risk measures
195
Remark 4.75. As long as we are interested in a law-invariant risk assessment, we can
represent a Ô¨Ånancial position X ‚ààL‚àûby its distribution function FX or, equivalently,
by the function
GX(t) := 1 ‚àíFX(t) = P [ X > t ].
If we only consider positions X with values in [0, 1] then their proxies GX vary in
the class of right-continuous decreasing functions G on [0, 1] such that G(1) = 0 and
G(0) ‚â§1. Due to Theorem 4.64, a law-invariant coherent risk measure œÅ¬µ induces a
functional U on the class of proxies via
U(GX) := œÅ¬µ(‚àíX) =
 1
0
œà(GX(t)) dt.
Since œà is increasing and concave, the functional U has the form of a von Neumann‚Äì
Morgenstern utility functional on the probability space given by Lebesgue measure on
the unit interval [0, 1]. As such, it can be characterized by the axioms in Section 2.3,
and this is the approach taken inYaari‚Äôs ‚Äúdual theory of choice‚Äù [198]. More generally,
we can introduce a utility function u on [0, 1] with u(0) = 0 and consider the functional
U(GX) :=
 1
0
œà(GX(t)) du(t)
introduced by Quiggin [161]. For u(x) = x this reduces to the ‚Äúdual theory‚Äù, for
œà(x) = x we recover the classical utility functionals
U(GX) =
 1
0
GX(t) du(t)
= ‚àí
 1
0
u(t) dGX(t)
= E[ u(X) ]
discussed in Section 2.3.
‚ô¶
4.7
Comonotonic risk measures
In many situations, the risk of a combined position X + Y will be strictly lower than
the sum of the individual risks, because one position serves as a hedge against adverse
changes in the other position. If, on the other hand, there is no way for X to work
as a hedge for Y then we may want the risk simply to add up. In order to make
this idea precise, we introduce the notion of comonotonicity. Our main goal in this
section is to characterize the class of all convex risk measures that share this property
of comonotonicity.
As in the Ô¨Årst two sections of this chapter, we will denote by X the linear space
of all bounded measurable functions on the measurable space (, F ).

196
4 Monetary measures of risk
DeÔ¨Ånition 4.76. TwomeasurablefunctionsX andY on(, F )arecalledcomonotone
if

X(œâ) ‚àíX(œâ‚Ä≤)

Y(œâ) ‚àíY(œâ‚Ä≤)

‚â•0
for all (œâ, œâ‚Ä≤) ‚àà √ó .
(4.47)
A monetary measure of risk œÅ on X is called comonotonic if
œÅ(X + Y) = œÅ(X) + œÅ(Y)
whenever X, Y ‚ààX are comonotone.
Lemma 4.77. If œÅ is a comonotonic monetary risk measure on X, then œÅ is positively
homogeneous.
Proof. Note that (X, X) is a comonotone pair. Hence œÅ(2X) = 2œÅ(X). An iteration
of this argument yields œÅ(rX) = rœÅ(X) for all rational numbers r ‚â•0. Positive
homogeneity now follows from the Lipschitz continuity of œÅ; see Lemma 4.3.
We will see below that every comonotonic monetary risk measure on X arises as
the Choquet integral with respect to a certain set function on (, F ). In the sequel,
c : F ‚Üí[0, 1] will always denote a set function that is normalized and monotone; see
DeÔ¨Ånition 4.68. Unless otherwise mentioned, we will not assume that c enjoys any
additivity properties. Recall from DeÔ¨Ånition 4.70 that the Choquet integral of X ‚ààX
with respect to c is deÔ¨Åned as

X dc =
 0
‚àí‚àû
(c(X > x) ‚àí1) dx +
 ‚àû
0
c(X > x) dx.
The proof of the following proposition was already given in Example 4.13.
Proposition 4.78. The Choquet integral of the loss,
œÅ(X) :=

(‚àíX) dc,
is a monetary risk measure on X which is positively homogeneous.
DeÔ¨Ånition 4.79. Let X be a measurable function on (, F ). An inverse function
rX : (0, 1) ‚ÜíR of the increasing function GX(x) := 1 ‚àíc(X > x), taken in the
sense of DeÔ¨Ånition A.14, is called a quantile function for X with respect to c.
If c is a probability measure, then GX(x) = c(X ‚â§x). Hence, the preceding
deÔ¨Ånition extends the notion of a quantile function given in DeÔ¨Ånition A.20. The
following proposition yields an alternative representation of the Choquet integral in
terms of quantile functions with respect to c.
Proposition 4.80. Let rX be a quantile function with respect to c for X ‚ààX. Then

X dc =
 1
0
rX(t) dt.

4.7 Comonotonic risk measures
197
Proof. We have

(X+m) dc =

X dc+m, and one easily checks that rX+m = rX+m
a.e. for all m ‚ààR and each quantile function rX+m of X + m. Thus, we may assume
without loss of generality that X ‚â•0. In this case, Remark A.16 and Lemma A.15
imply that the largest quantile function r+
X is given by
r+
X(t) = sup{ x ‚â•0 | GX(x) ‚â§t } =
 ‚àû
0
I{GX(x)‚â§t} dx.
Since rX = r+
X a.e. on (0, 1), Fubini‚Äôs theorem implies
 1
0
rX(t) dt =
 1
0
 ‚àû
0
I{GX(x)‚â§t} dx dt
=
 ‚àû
0
(1 ‚àíGX(x)) dx
=

X dc.
The preceding proposition yields the following generalization of Corollary 4.66
when applied to a continuous distortion of a probability measure as deÔ¨Åned in DeÔ¨Åni-
tion 4.67.
Corollary 4.81. Let cœà(A) = œà(P[ A ]) be the distortion of the probability measure
P with respect to the continuous distortion function œà. If œï is an inverse function for
the increasing function œà in the sense of DeÔ¨Ånition A.14, then the Choquet integral
with respect to cœà satisÔ¨Åes

X dcœà =
 1
0
qX

1 ‚àíœï(t)

dt,
where qX is a quantile function for X ‚ààX, taken with respect to P .
Proof. Due to the continuity of œà, we have œà(a) ‚â§t if and only if a ‚â§œï+(t) =
inf{x | œà(x) > t}. Thus, we can compute the lower quantile function of X with respect
to cœà:
r‚àí
X(t) = inf{ x ‚ààR | 1 ‚àícœà(X > x) ‚â•t}
= inf{ x ‚ààR | œà(P[ X > x ]) ‚â§1 ‚àít}
= inf{ x ‚ààR | P [ X > x ] ‚â§œï+(1 ‚àít)}
= q‚àí
X(1 ‚àíœï+(1 ‚àít)).
Next note that œï+(t) = œï(t) for a.e. t. Moreover, œï has the continuous distribution
function œà under the Lebesgue measure, and so we can replace q‚àí
X by the arbitrary
quantile function qX.

198
4 Monetary measures of risk
Theorem 4.82. A monetary risk measure œÅ on X is comonotonic if and only if there
exists a normalized monotone set function c on (, F ) such that
œÅ(X) =

(‚àíX) dc,
X ‚ààX.
In this case, c is given by c(A) = œÅ(‚àíIA).
The preceding theorem implies in view of Corollary 4.71 that all mixtures
œÅ¬µ =

[0,1]
AV@RŒª ¬µ(dŒª)
are comonotonic. We will see in Theorem 4.87 below that these are in fact all convex
risk measures that are law-invariant and comonotonic. The proof of Theorem 4.82
requires a further analysis of comonotone random variables.
Lemma 4.83. Two measurable functions X and Y on (, F ) are comonotone if and
only if there exists a third measurable function Z on (, F ) and increasing functions
f and g on R such that X = f (Z) and Y = g(Z).
Proof. Clearly, X := f (Z) and Y := g(Z) are comonotone for given Z, f , and g.
Conversely, suppose that X and Y are comonotone and deÔ¨Åne Z by Z := X + Y.
We show that z := Z(œâ) has a unique decomposition as z = x + y, where (x, y) =
(X(œâ‚Ä≤), Y(œâ‚Ä≤)) for some œâ‚Ä≤ ‚àà. Having established this, we can put f (z) := x
and g(z) := y. The existence of the decomposition as z = x + y follows by taking
x := X(œâ) and y := Y(œâ), so it remains to show that these are the only possible
values x and y. To this end, let us suppose that X(œâ) + Y(œâ) = z = X(œâ‚Ä≤) + Y(œâ‚Ä≤)
for some œâ‚Ä≤ ‚àà. Then
X(œâ) ‚àíX(œâ‚Ä≤) = ‚àí

Y(œâ) ‚àíY(œâ‚Ä≤)

,
and comonotonicity implies that this expression vanishes. Hence x = X(œâ‚Ä≤) and
y = Y(œâ‚Ä≤).
Next, we check that both f and g are increasing functions on Z(). So let us
suppose that
X(œâ1) + Y(œâ1) = z1 ‚â§z2 = X(œâ2) + Y(œâ2).
This implies
X(œâ1) ‚àíX(œâ2) ‚â§‚àí

Y(œâ1) ‚àíY(œâ2)

.
Comonotonicity thus yields that X(œâ1)‚àíX(œâ2) ‚â§0 and Y(œâ1)‚àíY(œâ2) ‚â§0, whence
f (z1) ‚â§f (z2) and g(z1) ‚â§g(z2). Thus, f and g are increasing on Z(), and it is
straightforward to extend them to increasing functions deÔ¨Åned on R.
Lemma 4.84. If X, Y ‚ààX is a pair of comonotone functions, and rX, rY , rX+Y are
quantile functions with respect to c, then
rX+Y (t) = rX(t) + rY (t)
for a.e. t.

4.7 Comonotonic risk measures
199
Proof. Write X = f (Z) and Y = g(Z) as in Lemma 4.83. The same argument as
in the proof of Lemma A.23 shows that f (rZ) and g(rZ) are quantile functions for
X and Y under c if rZ is a quantile function for Z. An identical argument applied to
the increasing function h := f + g shows that h(rZ) = f (rZ) + g(rZ) is a quantile
function for X +Y. The assertion now follows from the fact that all quantile functions
of a random variable coincide almost everywhere, due to Lemma A.15.
Remark 4.85. Applied to the special case of quantile function with respect to a prob-
ability measure, the preceding lemma yields that V@RŒª and AV@RŒª are comono-
tonic.
‚ô¶
Proof of Theorem 4.82. We already know from Proposition 4.78 that the Choquet
integral of the loss is a monetary risk measure. Comonotonicity follows by combining
Proposition 4.80 with Lemma 4.84.
Conversely, suppose now that œÅ is comonotonic. Then œÅ is coherent according to
Lemma 4.77. Thus, we obtain a normalized monotone set function by letting c(A) :=
œÅ(‚àíIA). Moreover, œÅc(X) :=

(‚àíX) dc is a comonotonic monetary risk measure on
X that coincides with œÅ on indicator functions: œÅ(‚àíIA) = c(A) = œÅc(‚àíIA). Let us
now show that œÅ and œÅc coincide on simple random variables of the form
X =
n

i=1
xiIAi ,
xi ‚ààR, Ai ‚ààF .
Since these random variables are dense in L‚àû, Lemma 4.3 will then imply that œÅ = œÅc.
In order to show that œÅc(X) = œÅ(X) for X as above, we may assume without loss of
generalitythatx1 ‚â•x2 ‚â•¬∑ ¬∑ ¬∑ ‚â•xn andthatthesetsAi aredisjoint. Bycashinvariance,
we may also assume X ‚â•0, i.e., xn ‚â•0. Thus, we can write X = n
i=1 biIBi , where
bi := xi ‚àíxi+1 ‚â•0, xn+1 := 0, and Bi := i
k=1 Ak. Note that biIBi and bkIBk is
a pair of comonotone functions. Hence, also k‚àí1
i=1 biIBi and bkIBk are comonotone,
and we get inductively
œÅ(‚àíX) =
n

i=1
biœÅ(‚àíIBi ) =
n

i=1
biœÅc(‚àíIBi ) = œÅc(‚àíX).
Remark 4.86. The argument at the end of the preceding proof shows that the Choquet
integral of a simple random variable
X =
n

i=1
xiIAi
with x1 ‚â•¬∑ ¬∑ ¬∑ ‚â•xn ‚â•xn+1 := 0
can be computed as

X dc =
n

i=1
(xi ‚àíxi+1)c(Bi) =
n

i=1
xi

c(Bi) ‚àíc(Bi‚àí1)

,
where B0 := ‚àÖand Bi := i
k=1 Ak for i = 1, . . . , n.
‚ô¶

200
4 Monetary measures of risk
So far, we have shown that comonotonic monetary risk measures can be identiÔ¨Åed
with Choquet integrals of normalized monotone set functions. Our next goal is to
characterize those set functions that induce risk measures with the additional property
of convexity. To this end, we will Ô¨Årst consider law-invariant risk measures. The
following result shows that the risk measures AV@RŒª may be viewed as the extreme
points in the convex class of all law-invariant convex risk measures on L‚àûthat are
comonotonic.
Theorem 4.87. On an atomless probability space, the class of risk measures
œÅ¬µ(X) :=

AV@RŒª(X) ¬µ(dŒª),
¬µ ‚ààM1([0, 1]),
is precisely the class of all law-invariant convex risk measures on L‚àûthat are comono-
tonic. In particular, any convex measure of risk that is law-invariant and comonotonic
is also coherent and continuous from above.
Proof. Comonotonicity of œÅ¬µ follows from Corollary 4.71 and Theorem 4.82. Con-
versely, let us assume that œÅ is a law-invariant convex measure of risk that is also
comonotonic. By Theorem 4.82, œÅ(X) =

(‚àíX) dc for c(A) := œÅ(‚àíIA). The
law-invariance of œÅ implies that c(A) is a function of the probability P [ A ], i.e.,
there exists an increasing function œà on [0, 1] such that œà(0) = 0, œà(1) = 1, and
c(A) = œà(P[ A ]). Note that IA‚à™B and IA‚à©B is a pair of comonotone functions for all
A, B ‚ààF . Hence, comonotonicity and subadditivity of œÅ imply
c(A ‚à©B) + c(A ‚à™B) = œÅ(‚àíIA‚à©B ) + œÅ(‚àíIA‚à™B ) = œÅ

‚àíIA‚à©B ‚àíIA‚à™B

= œÅ

‚àíIA ‚àíIB

(4.48)
‚â§c(A) + c(B).
Proposition 4.69 thus implies that œà is concave. Corollary 4.71 Ô¨Ånally shows that the
Choquet integral with respect to c can be identiÔ¨Åed with a risk measure œÅ¬µ, where ¬µ
is obtained from œà via Lemma 4.63.
Now we turn to the characterization of all comonotonic convex risk measures
on X. Recall that, for a positively homogeneous monetary risk measure, convexity is
equivalent to subadditivity. Also recall that M1,f := M1,f (, F ) denotes the set of
all Ô¨Ånitely additive normalized set functions Q : F ‚Üí[0, 1], and that EQ[ X ] denotes
the integral of X ‚ààX with respect to Q ‚ààM1,f , as constructed in Theorem A.50.
Theorem 4.88. For the Choquet integral with respect to a normalized monotone set
function c, the following conditions are equivalent.
(a) œÅ(X) :=

(‚àíX) dc is a convex risk measure on X.
(b) œÅ(X) :=

(‚àíX) dc is a coherent risk measure on X.

4.7 Comonotonic risk measures
201
(c) For Qc := {Q ‚ààM1,f | Q[ A ] ‚â§c(A) for all A ‚ààF },

X dc = max
Q‚ààQc
EQ[ X ]
for X ‚ààX.
(d) The set function c is submodular.
In this case, Qc is equal to the maximal representing set Qmax for œÅ.
Before giving the proof of this theorem, let us state the following corollary, which
gives a complete characterization of all comonotonic convex risk measures, and a
remark concerning the set Qc in part (c), which is usually called the core of c.
Corollary 4.89. A convex risk measure on X is comonotonic if and only if it arises
as the Choquet integral of the loss with respect to a submodular, normalized, and
monotone set function c. In this case, c is given by c(A) = œÅ(‚àíIA), and œÅ has the
representation
œÅ(X) = max
Q‚ààQc
EQ[ ‚àíX ],
where Qc = {Q ‚ààM1,f | Q[ A ] ‚â§c(A) for all A ‚ààF } is equal to the maximal
representing set Qmax.
Proof. Theorems 4.82 and 4.88 state that œÅ(X) :=

(‚àíX) dc is a comonotonic
coherent risk measure, which can be represented as in the assertion, as soon as c is a
submodular, normalized, and monotone set function. Conversely, any comonotonic
convex risk measure œÅ is coherent and arises as the Choquet integral of c(A) :=
œÅ(‚àíIA), due to Theorem 4.82. Theorem 4.88 then gives the submodularity of c.
Remark 4.90. Let c be a normalized monotone submodular set function.
Theo-
rem 4.88 implies in particular that the core Qc of c is non-empty. Moreover, c can be
recovered from Qc:
c(A) = max
Q‚ààQc
Q[ A ]
for all A ‚ààF .
If c has the additional continuity property that c(An) ‚Üí0 for any decreasing sequence
(An) of events such that 
n An = ‚àÖ, then this property is shared by any Q ‚ààQc, and it
follows that Q is œÉ-additive. Thus, the corresponding coherent risk measure œÅ(X) =

(‚àíX) dc admits a representation in terms of œÉ-additive probability measures. It
follows by Lemma 4.20 that œÅ is continuous from above.
‚ô¶
The proof of Theorem 4.88 requires some preparations. The assertion of the
following lemma is not entirely obvious, since Fubini‚Äôs theorem may fail if Q ‚ààM1,f
is not œÉ-additive.
Lemma 4.91. For X ‚ààX and Q ‚ààM1,f , the integral EQ[ X ] is equal to the Choquet
integral

X dQ.

202
4 Monetary measures of risk
Proof. It is enough to prove the result for X ‚â•0. Suppose Ô¨Årst that X = n
i=1 xiIAi
is as in Remark 4.86. Then

X dQ =
n

i=1
(xi ‚àíxi+1)Q
 
i
k=1
Ak
!
=
n

i=1
xiQ[ Ai ] = EQ[ X ].
The result for general X ‚ààX follows by approximating X uniformly with Xn which
take only Ô¨Ånitely many values, and by using the Lipschitz continuity of both EQ[ ¬∑ ]
and

¬∑ dQ with respect to the supremum norm.
Lemma 4.92. Let A1, . . . , An be a partition of  into disjoint measurable sets, and
suppose that the normalized monotone set function c is submodular. Let Q be the
probability measure on F0 := œÉ(A1, . . . , An) with weights
Q[ Ak ] := c(Bk) ‚àíc(Bk‚àí1)
for B0 := ‚àÖand Bk :=
k
j=1
Aj, k ‚â•1.
(4.49)
Then

X dc ‚â•EQ[ X ] for all bounded F0-measurable X = n
i=1 xiIAi , and equal-
ity holds if the values of X are arranged in decreasing order: x1 ‚â•¬∑ ¬∑ ¬∑ ‚â•xn.
Proof. Clearly, it sufÔ¨Åces to consider only the case X ‚â•0. Then Remark 4.86 implies

X dc = EQ[ X ] as soon as the values of X are arranged in decreasing order.
Now we prove

X dc ‚â•EQ[ X ] for arbitrary F0-measurable X. To this end,
note that any permutation œÉ of {1, . . . , n} induces a probability measure QœÉ on F0
by applying the deÔ¨Ånition of Q to the re-labeled partition AœÉ(1) . . . , AœÉ(n). If œÉ is a
permutation such that xœÉ(1) ‚â•¬∑ ¬∑ ¬∑ ‚â•xœÉ(n), then we have

X dc = EQœÉ [ X ], and so
the assertion will follow if we can prove that EQœÉ [ X ] ‚â•EQ[ X ]. To this end, it is
enough to show that EQœÑ [ X ] ‚â•EQ[ X ] if œÑ is the transposition of two indices i and
i + 1 which are such that xi < xi+1, because œÉ can be represented as a Ô¨Ånite product
of such transpositions.
Note next that
EQœÑ [ X ]‚àíEQ[ X ] = xi(QœÑ[ Ai ]‚àíQ[ Ai ])+xi+1(QœÑ[ Ai+1 ]‚àíQ[ Ai+1 ]). (4.50)
To compute the probabilities QœÑ[ Ak ], let us introduce
BœÑ
0 := ‚àÖ
and
BœÑ
k :=
k
j=1
AœÑ(j),
k = 1, . . . , n.
Then BœÑ
k = Bk for k Ã∏= i. Hence,
QœÑ[ Ai ] + QœÑ[ Ai+1 ] = QœÑ[ AœÑ(i) ] + QœÑ[ AœÑ(i+1) ] = c(BœÑ
i+1) ‚àíc(BœÑ
i‚àí1)
= c(Bi+1) ‚àíc(Bi‚àí1) = Q[ Ai ] + Q[ Ai+1 ].
(4.51)

4.8 Measures of risk in a Ô¨Ånancial market
203
Moreover, BœÑ
i ‚à©Bi = Bi‚àí1, BœÑ
i ‚à™Bi = Bi+1, and hence c(Bi‚àí1) + c(Bi+1) ‚â§
c(BœÑ
i ) + c(Bi), due to the submodularity of c. Thus,
Q[ Ai+1 ] = c(Bi+1) ‚àíc(Bi) ‚â§c(BœÑ
i ) ‚àíc(BœÑ
i‚àí1) = QœÑ[ AœÑ(i)] = QœÑ[ Ai+1].
Using (4.50), (4.51), and our assumption xi < xi+1 thus yields EQœÑ [ X ] ‚â•EQ[ X ].
Proof of Theorem 4.88.
(a)‚áî(b): According to Proposition 4.78, the property of
positive homogeneity is shared by all Choquet integrals, and the implication (b) ‚áí(a)
is obvious.
(b) ‚áí(c): By Corollary 4.18, œÅ(‚àíX) = maxQ‚ààQmax EQ[ X ], where Q ‚ààM1,f
belongs to Qmax if and only if
EQ[ X ] ‚â§œÅ(‚àíX) =

X dc
for all X ‚ààX.
(4.52)
We will now show that this set Qmax coincides with the set Qc. If Q ‚ààQmax then,
in particular, Q[ A ] ‚â§

IA dc = c(A) for all A ‚ààF . Hence Q ‚ààQc. Conversely,
suppose Q ‚ààQc. If X ‚â•0 then

X dc =
 ‚àû
0
c(X > x) dx ‚â•
 ‚àû
0
Q[ X > x ] dx = EQ[ X ],
where we have used Lemma 4.91. Cash invariance yields (4.52).
(c) ‚áí(b) is obvious.
(b) ‚áí(d): This follows precisely as in (4.48).
(d) ‚áí(a): We have to show that the Choquet integral is subadditive. By Lemma
4.3, it is again enough to prove this for random variables which only take Ô¨Ånitely many
values. Thus, let A1, . . . , An be a partition of  into Ô¨Ånitely many disjoint measurable
sets. Let us write X = 
i xiIAi , Y = 
i yiIAi , and let us assume that the indices
i = 1, . . . , n are arranged such that x1 + y1 ‚â•¬∑ ¬∑ ¬∑ ‚â•xn + yn. Then the probability
measure Q constructed in Lemma 4.92 is such that

(X + Y) dc = EQ[ X + Y ] = EQ[ X ] + EQ[ Y ] ‚â§

X dc +

Y dc.
But this is the required subadditivity of the Choquet integral.
4.8 Measures of risk in a Ô¨Ånancial market
In this section, we will consider risk measures which arise in the Ô¨Ånancial market
model of Section 1.1. In this model, d + 1 assets are priced at times t = 0 and t = 1.
Prices at time 1 are modelled as non-negative random variables S0, S1, . . . , Sd on

204
4 Monetary measures of risk
some probability space (, F , P), with S0 ‚â°1 + r. Prices at time 0 are given by
a vector œÄ = (1, œÄ), with œÄ = (œÄ1, . . . , œÄd). The discounted net gain of a trading
strategy Œæ = (Œæ0, Œæ) is given by Œæ ¬∑ Y, where the random vector Y = (Y 1, . . . , Y d) is
deÔ¨Åned by
Y i =
Si
1 + r ‚àíœÄi
for i = 1, . . . , d.
As in the previous two sections, risk measures will be deÔ¨Åned on the space
L‚àû= L‚àû(, F , P). A Ô¨Ånancial position X can be viewed as riskless if X ‚â•0
or, more generally, if X can be hedged without additional costs, i.e., if there exists a
trading strategy Œæ = (Œæ0, Œæ) such that œÄ ¬∑ Œæ = 0 and
X + Œæ ¬∑ S
1 + r = X + Œæ ¬∑ Y ‚â•0
P -a.s.
(4.53)
Thus, we deÔ¨Åne the following set of acceptable positions in L‚àû:
A0 :=

X ‚ààL‚àû| ‚àÉŒæ ‚ààRd with X + Œæ ¬∑ Y ‚â•0 P -a.s.

.
Proposition 4.93. Suppose that inf{m ‚ààRd | m ‚ààA0} > ‚àí‚àû. Then œÅ0 := œÅA0 is a
coherent measure of risk. Moreover, œÅ0 is sensitive in the sense of DeÔ¨Ånition 4.32 if and
only if the market model is arbitrage-free. In this case, œÅ0 is continuous from above
and can be represented in terms of the set P of equivalent risk-neutral measures:
œÅ0(X) = sup
P ‚àó‚ààP
E‚àó[ ‚àíX ].
(4.54)
Proof. The fact that œÅ0 is a coherent measure of risk follows from Proposition 4.7. If
the model is arbitrage-free, then Theorem 1.31 yields the representation (4.54), and it
follows that œÅ0 is sensitive and continuous from above.
Conversely, suppose that œÅ0 is sensitive, but the market model admits an arbitrage
opportunity. Then there are Œæ ‚ààRd and Œµ > 0 such that 0 ‚â§Œæ ¬∑ Y P -a.s. and
A := {Œæ ¬∑ Y ‚â•Œµ} satisÔ¨Åes P [ A ] > 0. It follows that Œæ ¬∑ Y ‚àíŒµIA ‚â•0, i.e., ‚àíŒµIA is
acceptable. However, the sensitivity of œÅ0 implies that
œÅ0(‚àíŒµIA) = ŒµœÅ0(‚àíIA) > œÅ0(0) = 0,
where we have used the coherence of œÅ0, which follows from fact that A0 is a cone.
Thus, we arrive at a contradiction.
There are several reasons why it may make sense to allow in (4.53) only strategies
Œæ that belong to a proper subset S of the class Rd of all strategies. For instance,
if the resources available to an investor are limited, only those strategies should be
considered for which the initial investment in risky assets is below a certain amount.
Such a restriction corresponds to an upper bound on Œæ ¬∑ œÄ. There may be other
constraints. For instance, short sales constraints are lower bounds on the number of

4.8 Measures of risk in a Ô¨Ånancial market
205
shares in the portfolio. In view of market illiquidity, the investor may also wish to
avoid holding too many shares of one single asset, since the market capacity may not
sufÔ¨Åce to resell the shares. Such constraints will be taken into account by assuming
throughout the remainder of this section that S has the following properties:
‚Ä¢ 0 ‚ààS.
‚Ä¢ S is convex.
‚Ä¢ Each Œæ ‚ààS is admissible in the sense that Œæ ¬∑ Y is P -a.s. bounded from below.
Under these conditions, the set
AS :=

X ‚ààL‚àû| ‚àÉŒæ ‚ààS with X + Œæ ¬∑ Y ‚â•0 P -a.s.

(4.55)
is non-empty, convex, and contains all X ‚ààX which dominate some Z ‚ààAS.
Moreover, we will assume from now on that
inf{ m ‚ààR | m ‚ààAS } > ‚àí‚àû.
(4.56)
Proposition 4.7 then guarantees that the induced risk measure
œÅS(X) := œÅAS(X) = inf{m ‚ààR | m + X ‚ààAS}
is a convex risk measure on L‚àû. Note that (4.56) holds, in particular, if S does not
contain arbitrage opportunities in the sense that Œæ ¬∑ Y ‚â•0 P -a.s. for Œæ ‚ààS implies
P[ Œæ ¬∑ Y = 0 ] = 1.
Remark 4.94. Admissibility of portfolios is a serious restriction; in particular, it pre-
vents unhedged short sales of any unbounded asset. Note, however, that it is consistent
with our notion of acceptability for bounded claims in (4.55), since X + Œæ ¬∑ Y ‚â•0
implies Œæ ¬∑ Y ‚â•‚àí‚à•X‚à•.
‚ô¶
Two questions arise: When is œÅS continuous from above, and thus admits a rep-
resentation (4.29) in terms of probability measures? And, if such a representation
exists, how can we identify the minimal penalty function Œ±S
min on M1(P )? In the case
S = Rd, both questions were addressed in Proposition 4.93. For general S, only the
second question has a straightforward answer, which will be given in Proposition 4.96.
As can be seen from the proof of Proposition 4.93, an analysis of the Ô¨Årst question
requires an extension of the arbitrage theory in Chapter 1 for the case of portfolio
constraints. Such a theory will be developed in Chapter 9 in a more general dynamic
setting, and we will address both questions for the corresponding risk measures in
Corollary 9.30. This result implies the following theorem for the simple one-period
model of the present section:
Theorem 4.95. In addition to the above assumptions, suppose that the market model
is non-redundant in the sense of DeÔ¨Ånition 1.13 and that S is a closed subset of Rd.

206
4 Monetary measures of risk
Then œÅS is sensitive if and only if S contains no arbitrage opportunities. In this case,
œÅS is continuous from above and admits the representation
œÅS(X) =
sup
Q‚ààM1(P )

EQ[ ‚àíX ] ‚àísup
Œæ‚ààS
EQ[ Œæ ¬∑ Y ]

.
(4.57)
In the following proposition, we will explain the speciÔ¨Åc form of the penalty func-
tion in (4.57). This result will not require the additional assumptions of Theorem 4.95.
Proposition 4.96. For Q ‚ààM1(P ), the minimal penalty function Œ±S
min of œÅS is given
by
Œ±S
min(Q) = sup
Œæ‚ààS
EQ[ Œæ ¬∑ Y ].
In particular, œÅS can be represented as in (4.57) if œÅS is continuous from above and,
especially, if S does not contain arbitrage opportunities.
Proof. Fix Q ‚ààM1(P ). Clearly, the expectation EQ[ Œæ ¬∑ Y ] is well deÔ¨Åned for each
Œæ ‚ààS by admissibility. If X ‚ààAS, there exists Œ∑ ‚ààS such that ‚àíX ‚â§Œ∑ ¬∑Y P -almost
surely. Thus,
EQ[ ‚àíX ] ‚â§EQ[ Œ∑ ¬∑ Y ] ‚â§sup
Œæ‚ààS
EQ[ Œæ ¬∑ Y ]
for any Q ‚ààM1(P ). Hence, the deÔ¨Ånition of the minimal penalty function yields
Œ±S
min(Q) ‚â§sup
Œæ‚ààS
EQ[ Œæ ¬∑ Y ].
To prove the converse inequality, take Œæ ‚ààS. Note that Xk := ‚àí((Œæ ¬∑ Y) ‚àßk) is
bounded since Œæ is admissible. Moreover,
Xk + Œæ ¬∑ Y = (Œæ ¬∑ Y ‚àík) I{Œæ¬∑Y‚â•k} ‚â•0,
so that Xk ‚ààAS. Hence,
Œ±S
min(Q) ‚â•EQ[ ‚àíXk ] = EQ[ (Œæ ¬∑ Y) ‚àßk ],
and so Œ±S
min(Q) ‚â•EQ[ Œæ ¬∑ Y ] by monotone convergence.
Remark 4.97. SupposethatS isacone. ThentheacceptancesetAS isalsoacone, and
œÅS is a coherent measure of risk. If œÅS is continuous from above, then Corollary 4.34
yields the representation
œÅS(X) =
sup
Q‚ààQSmax
EQ[ ‚àíX ]
in terms of the non-empty set QS
max = { Q ‚ààM1(P ) | Œ±S
min(Q) = 0 }. It follows from
Proposition 4.96 that for Q ‚ààM1(P )
Q ‚ààQS
max if and only if EQ[ Œæ ¬∑ Y ] ‚â§0 for all Œæ ‚ààS.

4.8 Measures of risk in a Ô¨Ånancial market
207
If œÅS is sensitive then the set S cannot contain any arbitrage opportunities, and QS
max
contains the set P of all equivalent martingale measures whenever such measures
exist. More precisely, QS
max can be described as the set of absolutely continuous
supermartingale measures with respect to S; this will be discussed in more detail in
the dynamical setting of Chapter 9.
‚ô¶
Let us now relax the condition of acceptability in (4.55). We no longer insist
that the Ô¨Ånal outcome of an acceptable position, suitably hedged, should always be
non-negative. Instead, we only require that the hedged position is acceptable in terms
of a given convex risk measure œÅA with acceptance set A. Thus, we deÔ¨Åne
¬ØA :=

X ‚ààL‚àû| ‚àÉŒæ ‚ààS, A ‚ààA with X + Œæ ¬∑ Y ‚â•A P -a.s.

.
(4.58)
Clearly, A ‚äÇ¬ØA and hence
œÅA ‚â•œÅ := œÅ ¬ØA.
From now on, we assume that
œÅ > ‚àí‚àû,
which implies our assumption (4.56) for AS.
Proposition 4.98. The minimal penalty function Œ±min for œÅ is given by
Œ±min(Q) = Œ±S
min(Q) + Œ±min(Q),
where Œ±S
min is the minimal penalty function for œÅS, and Œ±min is the minimal penalty
function for œÅA.
Proof. We claim that
¬ØA = { XS + A | XS ‚ààAS, A ‚ààA }.
(4.59)
If X ‚àà¬ØA, then there exists A ‚ààA and Œæ ‚ààS such that X + Œæ ¬∑ Y ‚â•A. Therefore
XS := X ‚àíA ‚ààAS. Conversely, if XS ‚ààAS then XS + Œæ ¬∑ Y ‚â•0 for some Œæ ‚ààS.
Hence, for any A ‚ààA, we get XS + A + Œæ ¬∑ Y ‚â•X ‚ààA, i.e., X := XS + A ‚àà¬ØA.
In view of (4.59), we have
Œ±min(Q) = sup
X‚àà¬ØA
EQ[ ‚àíX ]
=
sup
XS‚ààAS sup
A‚ààA
EQ[ ‚àíXS ‚àíA ]
= Œ±S
min(Q) + Œ±min(Q).
For the rest of this section, we consider the following case study, which is based
on [36]. Let us Ô¨Åx a Ô¨Ånite class
Q0 = {Q1, . . . , Qn}

208
4 Monetary measures of risk
of equivalent probability measures Qi ‚âàP such that |Y| ‚ààL1(Qi); as in [36], we
call the measures in Q0 valuation measures. DeÔ¨Åne the sets
B :=

X ‚ààL0 | EQi[ X ] exists and is ‚â•0, i = 1, . . . , n

(4.60)
and
B0 :=

X ‚ààB | EQi[ X ] = 0 for i = 1, . . . , n

.
Note that
B0 ‚à©L0
+ = {0},
(4.61)
since X = 0 P -a.s. as soon as X ‚â•0 P -a.s. and EQi[ X ] = 0, due to the equivalence
Qi ‚âàP.
As the initial acceptance set, we take the convex cone
A := B ‚à©L‚àû
(4.62)
The corresponding set ¬ØA of positions which become acceptable if combined with a
suitable hedge is deÔ¨Åned as in (4.58):
¬ØA :=

X ‚ààL‚àû| ‚àÉŒæ ‚ààRd with X + Œæ ¬∑ Y ‚ààB

.
Let us now introduce the following stronger version of the no-arbitrage condition
K ‚à©L0
+ = {0}, where K := { Œæ ¬∑ Y | Œæ ‚ààRd }:
K ‚à©B = K ‚à©B0.
(4.63)
In other words, there is no portfolio Œæ ‚ààRd such that the result satisÔ¨Åes the valuation
inequalities in (4.60) and is strictly favorable in the sense that at least one of the
inequalities is strict.
Note that (4.63) implies the absence of arbitrage opportunities:
K ‚à©L0
+ = K ‚à©B ‚à©L0
+ = K ‚à©B0 ‚à©L0
+ = {0},
where we have used (4.61) and B ‚à©L0
+ = L0
+. Thus, (4.63) implies, in particular, the
existence of an equivalent martingale measure, i.e., P Ã∏= ‚àÖ. The following proposition
may be viewed as an extension of the ‚Äúfundamental theorem of asset pricing‚Äù. Let us
denote by
R :=
$
n

i=1
ŒªiQi
 Œªi > 0,
n

i=1
Œªi = 1
%
the class of all ‚Äúrepresentative‚Äù models for the class Q0, i.e., all mixtures such that
each Q ‚ààQ0 appears with a positive weight.
Proposition 4.99. The following two properties are equivalent:
(a) K ‚à©B = K ‚à©B0.
(b) P ‚à©R Ã∏= ‚àÖ.

4.8 Measures of risk in a Ô¨Ånancial market
209
Proof. (b) ‚áí(a): For V ‚ààK ‚à©B and R ‚ààR, we have ER[ V ] ‚â•0. If we can
choose R ‚ààP ‚à©R then we get ER[ V ] = 0, hence V ‚ààB0.
(a) ‚áí(b): Consider the convex set
C := { ER[ Y ] | R ‚ààR } ‚äÇRd ;
we have to show that C contains the origin. If this is not the case then there exists
Œæ ‚ààRd such that
Œæ ¬∑ x ‚â•0
for x ‚ààC,
(4.64)
and
Œæ ¬∑ x‚àó> 0
for some x‚àó‚ààC ;
see Proposition A.1. DeÔ¨Åne V := Œæ ¬∑ Y ‚ààK. Condition (4.64) implies
ER[ V ] ‚â•0
for all R ‚ààR,
hence V ‚ààK ‚à©B. Let R‚àó‚ààR be such that x‚àó= ER‚àó[ Y ]. Then V satisÔ¨Åes
ER‚àó[ Y ] > 0, hence V /‚ààK ‚à©B0, in contradiction to our assumption (a).
We can now state a representation theorem for the coherent risk measure œÅ corre-
sponding to the convex cone ¬ØA. It is a special case of Theorem 4.102 which will be
proved below.
Theorem 4.100. Under assumption (4.63), the coherent risk measure œÅ := œÅ ¬ØA cor-
responding to the acceptance set ¬ØA is given by
œÅ(X) =
sup
P ‚àó‚ààP ‚à©R
E‚àó[ ‚àíX ].
Let us now introduce a second Ô¨Ånite set Q1 ‚äÇM1(P ) of probability measures
Q ‚â™P with |Y| ‚ààL1(Q); as in [36], we call them stress test measures. In addition
to the valuation inequalities in (4.60), we require that an admissible position passes a
stress test speciÔ¨Åed by a ‚ÄúÔ¨Çoor‚Äù
Œ≥ (Q) < 0
for each Q ‚ààQ1.
Thus, the convex cone A in (4.62) is reduced to the convex set
A1 := A ‚à©B1 = L‚àû‚à©

B ‚à©B1

,
where
B1 :=

X ‚ààL0 | EQ[ X ] ‚â•Œ≥ (Q) for Q ‚ààQ1

.
Let
¬ØA1 :=

X ‚ààL‚àû| ‚àÉŒæ ‚ààRd with X + Œæ ¬∑ Y ‚ààB ‚à©B1

denote the resulting acceptance set for positions combined with a suitable hedge.

210
4 Monetary measures of risk
Remark 4.101. The analogue
K ‚à©(B ‚à©B1) = K ‚à©B0
(4.65)
of our condition (4.63) looks weaker, but it is in fact equivalent to (4.63). Indeed, for
X ‚ààK ‚à©B we can Ô¨Ånd Œµ > 0 such that X1 := ŒµX satisÔ¨Åes the additional constraints
EQ[ X1 ] ‚â•Œ≥ (Q)
for Q ‚ààQ1.
Since X1 ‚ààK ‚à©B ‚à©B1, condition (4.65) implies X1 ‚ààK ‚à©B0, hence X = 1
ŒµX1 ‚àà
K ‚à©B0, since K ‚à©B0 is a cone.
‚ô¶
LetusnowidentifytheconvexmeasureofriskœÅ1 inducedbytheconvexacceptance
set ¬ØA1. DeÔ¨Åne
R1 :=
$ 
Q‚ààQ
Œª(Q) ¬∑ Q
 Œª(Q) ‚â•0,

Q‚ààQ
Œª(Q) = 1
%
‚äÉR
as the convex hull of Q := Q0 ‚à™Q1, and deÔ¨Åne
Œ≥ (R) :=

Q‚ààQ
Œª(Q)Œ≥ (Q)
for R = 
Q Œª(Q)Q ‚ààR with Œ≥ (Q) := 0 for Q ‚ààQ0.
Theorem 4.102. Under assumption (4.63), the convex risk measure œÅ1 induced by
the acceptance set ¬ØA1 is given by
œÅ1(X) =
sup
P ‚àó‚ààP ‚à©R1

E‚àó[ ‚àíX ] + Œ≥ (P ‚àó)

,
(4.66)
i.e., œÅ1 is determined by the penalty function
Œ±1(Q) :=

+‚àû
for Q Ã∏‚ààP ‚à©R1,
‚àíŒ≥ (Q)
for Q ‚ààP ‚à©R1.
Proof. Let œÅ‚àódenote the convex risk measure deÔ¨Åned by the right-hand side of (4.66),
and let A‚àódenote the corresponding acceptance set:
A‚àó:=

X ‚ààL‚àû| E‚àó[ X ] ‚â•Œ≥ (P ‚àó) for all P ‚àó‚ààP ‚à©R1

.
It is enough to show A‚àó= ¬ØA1.
(a): In order to show ¬ØA1 ‚äÇA‚àó, take X ‚àà¬ØA1 and P ‚àó‚ààP ‚à©R1. There exists
Œæ ‚ààRd and A1 ‚ààA1 such that X + Œæ ¬∑ Y ‚â•A1. Thus,
E‚àó[ X + Œæ ¬∑ Y ] ‚â•E‚àó[ A1 ] ‚â•Œ≥ (P ‚àó),

4.8 Measures of risk in a Ô¨Ånancial market
211
due to P ‚àó‚ààR1. Since E‚àó[ Œæ ¬∑ Y ] = 0 due to P ‚àó‚ààP , we obtain E‚àó[ X ] ‚â•Œ≥ (P ‚àó),
hence X ‚ààA‚àó.
(b): In order to show A‚àó‚äÇ¬ØA1, we take X ‚ààA‚àóand assume that X /‚àà¬ØA1. This
means that the vector x‚àó= (x‚àó
1, . . . , x‚àó
N) with components
x‚àó
i := EQi[ X ] ‚àíŒ≥ (Qi)
does not belong to the convex cone
C :=

(EQi[ Œæ ¬∑ Y ])i=1,...,N + y | Œæ ‚ààRd, y ‚ààRN
+

‚äÇRN,
where Q = Q0 ‚à™Q1 = {Q1, . . . , QN} with N ‚â•n. In part (c) of this proof we will
show that C is closed. Thus, there exists Œª ‚ààRN such that
Œª ¬∑ x‚àó< inf
x‚ààC Œª ¬∑ x ;
(4.67)
see Proposition A.1. Since C ‚äÉRN
+, we obtain Œªi ‚â•0 for i = 1, . . . , N, and we may
assume 
i Œªi = 1 since Œª Ã∏= 0. DeÔ¨Åne
R :=
N

i=1
ŒªiQi ‚ààR1.
Since C contains the linear space of vectors

EQi[ V ]

i=1,...,N with V ‚ààK, (4.67)
implies
ER[ V ] = 0
for V ‚ààK,
hence R ‚ààP . Moreover, the right-hand side of (4.67) must be zero, and the condition
Œª ¬∑ x‚àó< 0 translates into
ER[ X ] < Œ≥ (R),
contradicting our assumption X ‚ààA‚àó.
(c): It remains to show that C is closed. For Œæ ‚ààRd we deÔ¨Åne y(Œæ) as the vector
in RN with coordinates yi(Œæ) = EQi[ Œæ ¬∑ Y ]. Any x ‚ààC admits a representation
x = y(Œæ) + z
with z ‚ààRN
+ and Œæ ‚ààN‚ä•, where
N :=

Œ∑ ‚ààRd | EQi[ Œ∑ ¬∑ Y ] = 0 for i = 1, . . . , N

,
and
N‚ä•:=

Œæ ‚ààRd | Œæ ¬∑ Œ∑ = 0 for all Œ∑ ‚ààN

.
Take a sequence
xn = y(Œæn) + zn,
n = 1, 2, . . . ,

212
4 Monetary measures of risk
with Œæn ‚ààN‚ä•and zn ‚ààRN
+, such that xn converges to x ‚ààRN. If lim infn |Œæn| < ‚àû,
then we may assume, passing to a subsequence if necessary, that Œæn converges to
Œæ ‚ààRd. Inthiscase, zn mustconvergetosomez ‚ààRN
+, andwehavex = y(Œæ)+z ‚ààC.
Let us now show that the case limn |Œæn| = ‚àûis in fact excluded.
In that case,
Œ±n := (1 + |Œæn|)‚àí1 converges to 0, and the vectors Œ∂n := Œ±nŒæn stay bounded. Thus,
we may assume that Œ∂n converges to Œ∂ ‚ààN‚ä•. This implies
y(Œ∂) = lim
n‚Üë‚àûy(Œ∂n) = ‚àílim
n‚Üë‚àûŒ±nzn ‚àà‚àíRN
+.
Since Œ∂ ‚ààN‚ä•and |Œ∂| = limn |Œ∂n| = 1, we obtain y(Œ∂) Ã∏= 0. Thus, the inequality
EQi[ (‚àíŒ∂) ¬∑ Y ] = ‚àíyi(Œ∂) ‚â•0
holds for all i and is strict for some i, in contradiction to our assumption (4.63).
4.9 Shortfall risk
In this section, we will establish a connection between convex measures of risk and
the expected utility theory of Chapter 2.
Supposethatarisk-averseinvestorassessesthedownsideriskofaÔ¨Ånancialposition
X ‚ààX by taking the expected utility E[ u(‚àíX‚àí) ] derived from the shortfall X‚àí,
or by considering the expected utility E[ u(X) ] of the position itself. If the focus
is on the downside risk, then it is natural to change the sign and to replace u by the
function ‚Ñì(x) := ‚àíu(‚àíx). Then ‚Ñìis a strictly convex and increasing function, and
the maximization of expected utility is equivalent to minimizing the expected loss
E[ ‚Ñì(‚àíX) ] or the shortfall risk E[ ‚Ñì(X‚àí) ]. In order to unify the discussion of both
cases, we do not insist on strict convexity. In particular, ‚Ñìmay vanish on (‚àí‚àû, 0],
and in this case the shortfall risk takes the form
E[ ‚Ñì(X‚àí) ] = E[ ‚Ñì(‚àíX) ].
DeÔ¨Ånition 4.103. A function ‚Ñì: R ‚ÜíR is called a loss function if it is increasing
and not identically constant.
In this section, we will only consider convex loss functions. Let us return to the
setting where we consider risk measures deÔ¨Åned on the class X of all bounded mea-
surable functions on some given measurable space (, F ). First, we Ô¨Åx a probability
measure P on (, F ). For a given convex loss function ‚Ñìand an interior point x0 in
the range of ‚Ñì, we deÔ¨Åne the following acceptance set:
A := { X ‚ààX | E[ ‚Ñì(‚àíX) ] ‚â§x0 }.
(4.68)

4.9 Shortfall risk
213
Proposition 4.104. The acceptance set A deÔ¨Ånes a convex measure of risk œÅ := œÅA
which is continuous from below. Moreover, the minimal penalty function Œ±min for œÅ
is concentrated on M1(P ), and œÅ can be represented in the form
œÅ(X) =
max
Q‚ààM1(P )

EQ[ ‚àíX ] ‚àíŒ±min(Q)

.
(4.69)
Proof. Clearly, the convex set A satisÔ¨Åes the Ô¨Årst two properties of Proposition 4.6
(a), and so œÅ is a convex measure of risk. We have to show that œÅ is continuous from
below. Note Ô¨Årst that
œÅ(X) = inf

m ‚ààR | E[ ‚Ñì(‚àím ‚àíX)] ‚â§x0

is the unique solution to the equation
E[ ‚Ñì(‚àíz ‚àíX) ] = x0.
(4.70)
Indeed, that œÅ(X) solves (4.70) follows by dominated convergence, since the Ô¨Ånite
convex function ‚Ñìis continuous. The solution is unique, since ‚Ñìis strictly increasing
on (‚Ñì‚àí1(x0) ‚àíŒµ, ‚àû) for some Œµ > 0.
Suppose now that (Xn) is a sequence in X which increases pointwise to some
X ‚ààX. Then œÅ(Xn) decreases to some Ô¨Ånite limit R. Using the continuity of ‚Ñìand
dominated convergence, it follows that
E[ ‚Ñì(‚àíœÅ(Xn) ‚àíXn)] ‚àí‚ÜíE[ ‚Ñì(‚àíR ‚àíX) ].
But each of the approximating expectations equals x0, and so R is a solution to (4.70).
Hence R = œÅ(X), and this proves continuity from below. Since œÅ satisÔ¨Åes (4.28), the
representation (4.69) follows from Proposition 4.21 and Lemma 4.30.
Let us now compute the minimal penalty function Œ±min.
Example 4.105. For an exponential loss function ‚Ñì(x) = eŒ≤x, the minimal penalty
function can be described in terms of relative entropy, and the resulting risk measure
coincides, up to an additive constant, with the entropic risk measure introduced in
Example 4.33. In fact,
œÅ(X) = inf

m ‚ààR | E[ e‚àíŒ≤(m+X) ] ‚â§x0

= 1
Œ≤

log E[ e‚àíŒ≤X ] ‚àílog x0

.
In this special case, the general formula (4.17) for Œ±min reduces to the variational
formula for the relative entropy H(Q|P ) of Q with respect to P :
Œ±min(Q) = sup
X‚ààX

EQ[ ‚àíX ] ‚àí1
Œ≤ log E[ e‚àíŒ≤X ]

‚àílog x0
Œ≤
= 1
Œ≤

H(Q|P ) ‚àílog x0

;

214
4 Monetary measures of risk
see Lemma 3.29. Thus, the representation (4.69) of œÅ is equivalent to the following
dual variational identity:
log E[ eX ] =
max
Q‚ààM1(P )

EQ[ X ] ‚àíH(Q|P )

.
‚ô¶
In general, the minimal penalty function Œ±min on M1(P ) can be expressed in terms
of the Fenchel‚ÄìLegendre transform or conjugate function ‚Ñì‚àóof the convex function ‚Ñì
deÔ¨Åned by
‚Ñì‚àó(z) := sup
x‚ààR

zx ‚àí‚Ñì(x)

.
Theorem 4.106. For any convex loss function ‚Ñì, the minimal penalty function in the
representation (4.69) is given by
Œ±min(Q) = inf
Œª>0
1
Œª

x0 + E

‚Ñì‚àó

ŒªdQ
dP
 
,
Q ‚ààM1(P ).
(4.71)
To prepare the proof of Theorem 4.106, we summarize some properties of the
functions ‚Ñìand ‚Ñì‚àóas stated in Appendix A.1. First note that ‚Ñì‚àóis a proper convex
function, i.e., it is convex and takes some Ô¨Ånite value. We denote by J := (‚Ñì‚àó)‚Ä≤
+ its
right-continuous derivative. Then, for x, z ‚ààR,
xz ‚â§‚Ñì(x) + ‚Ñì‚àó(z)
with equality if x = J(z).
(4.72)
Lemma 4.107. Let (‚Ñìn) be a sequence of convex loss functions which decreases point-
wise to the convex loss function ‚Ñì. Then the corresponding conjugate functions ‚Ñì‚àó
n
increase pointwise to ‚Ñì‚àó.
Proof. It follows immediately from the deÔ¨Ånition of the Fenchel‚ÄìLegendre transform
that each ‚Ñì‚àó
n is dominated by ‚Ñì‚àó, and that ‚Ñì‚àó
n(z) increases to some limit ‚Ñì‚àó
‚àû(z). We
have to prove that ‚Ñì‚àó
‚àû= ‚Ñì‚àó.
The function z ‚Üí‚Ñì‚àó
‚àû(z) is a lower semicontinuous convex function as the in-
creasing limit of such functions. Moreover, ‚Ñì‚àó
‚àûis a proper convex function, since it
is dominated by the proper convex function ‚Ñì‚àó. Consider the conjugate function ‚Ñì‚àó‚àó
‚àû
of ‚Ñì‚àó
‚àû. Clearly, ‚Ñì‚àó‚àó
‚àû‚â•‚Ñì, since ‚Ñì‚àó
‚àû‚â§‚Ñì‚àóand since ‚Ñì‚àó‚àó= ‚Ñìby Proposition A.6. On
the other hand, we have by a similar argument that ‚Ñì‚àó‚àó
‚àû‚â§‚Ñìn for each n. By taking
n ‚Üë‚àû, this shows ‚Ñì‚àó‚àó
‚àû= ‚Ñì, which in turn gives ‚Ñì‚àó
‚àû= ‚Ñì‚àó.
Lemma 4.108. The functions ‚Ñìand ‚Ñì‚àóhave the following properties.
(a) ‚Ñì‚àó(0) = ‚àíinfx‚ààR ‚Ñì(x) and ‚Ñì‚àó(z) ‚â•‚àí‚Ñì(0) for all z.
(b) There exists some z1 ‚àà[0, ‚àû) such that
‚Ñì‚àó(z) = sup
x‚â•0

xz ‚àí‚Ñì(x)

for z ‚â•z1.
In particular, ‚Ñì‚àóis increasing on [z1, ‚àû).

4.9 Shortfall risk
215
(c) ‚Ñì‚àó(z)
z
‚àí‚Üí‚àûas z ‚Üë‚àû.
Proof. Part (a) is obvious.
(b): Let N := { z ‚ààR | ‚Ñì‚àó(z) = ‚àí‚Ñì(0) }. We show in a Ô¨Årst step that N Ã∏= ‚àÖ.
Note that convexity of ‚Ñìimplies that the set S of all z with zx ‚â§‚Ñì(x) ‚àí‚Ñì(0) for all
x ‚ààR is non-empty. For z ‚ààS we clearly have ‚Ñì‚àó(z) ‚â§‚àí‚Ñì(0). On the other hand,
‚Ñì‚àó(z) ‚â•‚àí‚Ñì(0) by (a).
Now we take z1 := sup N. It is clear that z1 ‚â•0. If z > z1 and x < 0, then
xz ‚àí‚Ñì(x) ‚â§xz1 ‚àí‚Ñì(x) ‚â§‚Ñì‚àó(z1) ‚â§‚àí‚Ñì(0),
where the last inequality follows from the lower semicontinuity of ‚Ñì‚àó. But ‚Ñì‚àó(z) >
‚àí‚Ñì(0), hence
sup
x<0

xz ‚àí‚Ñì(x)

< ‚Ñì‚àó(z).
(c): For z ‚â•z1,
‚Ñì‚àó(z)/z = sup
x‚â•0

x ‚àí‚Ñì(x)/z

by (b). Hence
‚Ñì‚àó(z)
z
‚â•xz ‚àí1,
where xz := sup{ x | ‚Ñì(x) ‚â§z }. Since ‚Ñìis convex, increasing, and takes only Ô¨Ånite
values, we have xz ‚Üí‚àûas z ‚Üë‚àû.
Proof of Theorem 4.106. Fix Q ‚ààM1(P ), and denote by œï := dQ/dP its density.
First, we show that it sufÔ¨Åces to prove the claim for x0 > ‚Ñì(0). Otherwise we can Ô¨Ånd
some a ‚ààR such that ‚Ñì(‚àía) < x0, since x0 was assumed to be an interior point of
‚Ñì(R). Let ‚Ñì(x) := ‚Ñì(x ‚àía), and

A :=
 
X ‚ààX | E[‚Ñì(‚àí
X) ] ‚â§x0

.
Then 
A = { X ‚àía | X ‚ààA }, and hence
sup

X‚àà
A
EQ[ ‚àí
X ] = sup
X‚ààA
EQ[ ‚àíX ] + a.
(4.73)
The convex loss function ‚ÑìsatisÔ¨Åes the requirement ‚Ñì(0) < x0. So if the assertion is
established in this case, we Ô¨Ånd that
sup

X‚àà
A
EQ[ ‚àí
X ] = inf
Œª>0
1
Œª(x0 + E[‚Ñì‚àó(Œªœï) ]) = inf
Œª>0
1
Œª(x0 + E[ ‚Ñì‚àó(Œªœï) ]) + a ;
here we have used the fact that the Fenchel‚ÄìLegendre transform ‚Ñì‚àóof ‚ÑìsatisÔ¨Åes
‚Ñì‚àó(z) = ‚Ñì‚àó(z) + az. Together with (4.73), this proves that the reduction to the case
‚Ñì(0) < x0 is indeed justiÔ¨Åed.

216
4 Monetary measures of risk
For any Œª > 0 and X ‚ààA, (4.72) implies
‚àíXœï = 1
Œª(‚àíX)(Œªœï) ‚â§1
Œª

‚Ñì(‚àíX) + ‚Ñì‚àó(Œªœï)

.
Hence, for any Œª > 0
Œ±min(Q) ‚â§sup
X‚ààA
1
Œª

E[ ‚Ñì(‚àíX) ] + E[ ‚Ñì‚àó(Œªœï)]

‚â§1
Œª

x0 + E[ ‚Ñì‚àó(Œªœï)]

Thus, it remains to prove that
Œ±min(Q) ‚â•inf
Œª>0
1
Œª

x0 + E[ ‚Ñì‚àó(Œªœï)]

(4.74)
in case where Œ±min(Q) < ‚àû.
This will be done Ô¨Årst under the following extra
conditions:
There exists Œ∫ ‚ààR such that ‚Ñì(x) = inf ‚Ñìfor all x ‚â§Œ∫.
(4.75)
‚Ñì‚àóis Ô¨Ånite on (0, ‚àû).
(4.76)
J is continuous on (0, ‚àû).
(4.77)
Notethattheseassumptionsimplythat‚Ñì‚àó(0) < ‚àûandthatJ(0+) ‚â•Œ∫. Moreover,
J(z) increases to +‚àûas z ‚Üë‚àû, and hence so does ‚Ñì(J(z)). Since
‚Ñì‚àó(z) ‚â•‚àí‚Ñì(0) > ‚àíx0
for all z,
(4.78)
it follows from (4.72) that
lim
z‚Üì0 ‚Ñì(J(z)) ‚àíx0 < lim
z‚Üì0

‚Ñì(J(z)) + ‚Ñì‚àó(z)

= lim
z‚Üì0 zJ(z) = 0.
These facts and the continuity of J imply that for large enough n there exists some
Œªn > 0 such that
E

‚Ñì

J(Œªnœï)I{œï‚â§n}
 
= x0.
Let us deÔ¨Åne
Xn := ‚àíJ(Œªnœï)I{œï‚â§n}.
Then Xn is bounded and belongs to A. Hence, it follows from (4.72) and (4.78) that
Œ±min(Q) ‚â•EQ[ ‚àíXn ]
= 1
Œªn
E

I{œï‚â§n}J(Œªnœï)(Œªnœï)

= 1
Œªn
E
 
‚Ñì(‚àíXn) + ‚Ñì‚àó(Œªnœï)

¬∑ I{œï‚â§n}

= 1
Œªn

x0 ‚àí‚Ñì(0) ¬∑ P [ œï > n ] + E

‚Ñì‚àó(Œªnœï)I{œï‚â§n}

‚â•x0 ‚àí‚Ñì(0)
Œªn
.

4.9 Shortfall risk
217
Since we assumed that Œ±min(Q) < ‚àû, the decreasing limit Œª‚àûof Œªn must be strictly
positive. The fact that ‚Ñì‚àóis bounded from below allows us to apply Fatou‚Äôs lemma:
Œ±min(Q) ‚â•lim inf
n‚Üë‚àû
1
Œªn

x0 ‚àí‚Ñì(0) ¬∑ P [ œï > n ] + E

‚Ñì‚àó(Œªnœï)I{œï‚â§n}

‚â•
1
Œª‚àû

x0 + E[ ‚Ñì‚àó(Œª‚àûœï) ]

.
This proves (4.74) under the assumptions (4.75), (4.76), and (4.77).
If (4.75) and (4.76) hold, but J is not continuous, then we can approximate the
upper semicontinuous function J from above with an increasing continuous function

J on [0, ‚àû) such that
‚Ñì‚àó(z) := ‚Ñì‚àó(0) +
 z
0

J(y) dy
satisÔ¨Åes
‚Ñì‚àó(z) ‚â§‚Ñì‚àó(z) ‚â§‚Ñì‚àó
(1 + Œµ)z

for z ‚â•0.
Let ‚Ñì:= ‚Ñì‚àó‚àódenote the Fenchel‚ÄìLegendre transform of ‚Ñì‚àó.
Since ‚Ñì‚àó‚àó= ‚Ñìby
Proposition A.6, it follows that
‚Ñì
	
x
1 + Œµ

‚â§‚Ñì(x) ‚â§‚Ñì(x).
Therefore,

A :=

X ‚ààX | E[‚Ñì(‚àíX) ] ‚â§x0

‚äÜ

(1 + Œµ)X | X ‚ààA

=: AŒµ.
Since we already know that the assertion holds for ‚Ñì, we get that
inf
Œª>0
1
Œª

x0 + E

‚Ñì‚àó

ŒªdQ
dP
 
‚â§inf
Œª>0
1
Œª

x0 + E

‚Ñì‚àó

ŒªdQ
dP
 
= sup
X‚àà
A
EQ[ ‚àíX ]
‚â§sup
X‚ààAŒµ
EQ[ ‚àíX ]
= (1 + Œµ)Œ±min(Q).
By letting Œµ ‚Üì0, we obtain (4.74).
Finally, we remove conditions (4.75) and (4.76). If ‚Ñì‚àó(z) = +‚àûfor some z,
then z must be an upper bound for the slope of ‚Ñì. So we will approximate ‚Ñìby a
sequence (‚Ñìn) of convex loss functions whose slope is unbounded. Simultaneously,
we can handle the case where ‚Ñìdoes not take on its inÔ¨Åmum. To this end, we choose
a sequence Œ∫n ‚Üìinf ‚Ñìsuch that Œ∫n ‚â§‚Ñì(0) < x0. We can deÔ¨Åne, for instance,
‚Ñìn(x) := ‚Ñì(x) ‚à®Œ∫n + 1
n(ex ‚àí1)+.

218
4 Monetary measures of risk
Then ‚Ñìn decreases pointwise to ‚Ñì. Each loss function ‚Ñìn satisÔ¨Åes (4.75) and (4.76).
Hence, for any Œµ > 0 there are ŒªŒµ
n such that
‚àû> Œ±min(Q) ‚â•Œ±n
min(Q) ‚â•1
ŒªŒµn

x0 + E[ ‚Ñì‚àó
n(ŒªŒµ
nœï) ]

‚àíŒµ
for each n,
where Œ±n
min(Q) is the penalty function arising from ‚Ñìn.
Note that ‚Ñì‚àó
n ‚Üó‚Ñì‚àóby
Lemma 4.107. Our assumption Œ±min(Q) < ‚àû, the fact that
inf
z‚ààR ‚Ñì‚àó
n(z) ‚â•‚àí‚Ñìn(0) = ‚àí‚Ñì(0) > ‚àíx0,
and part (c) of Lemma 4.108 show that the sequence (ŒªŒµ
n)n‚ààN must be bounded away
from zero and from inÔ¨Ånity. Therefore, we may assume that ŒªŒµ
n converges to some
ŒªŒµ ‚àà(0, ‚àû). Using again the fact that ‚Ñì‚àó
n(z) ‚â•‚àí‚Ñì(0) uniformly in n and z, Fatou‚Äôs
lemma yields
Œ±min(Q) + Œµ ‚â•lim inf
n‚Üë‚àû
1
ŒªŒµn

x0 + E[ ‚Ñì‚àó
n(ŒªŒµ
nœï) ]

‚â•1
ŒªŒµ

x0 + E[ ‚Ñì‚àó(ŒªŒµœï) ]

.
This completes the proof of the theorem.
Example 4.109. Take
‚Ñì(x) :=
 1
pxp
if x ‚â•0,
0
otherwise,
where p > 1. Then
‚Ñì‚àó(z) :=
 1
q zq
if z ‚â•0,
+‚àû
otherwise,
where q = p/(p ‚àí1) is the usual dual coefÔ¨Åcient. We may apply Theorem 4.106 for
any x0 > 0. Let Q ‚ààM1(P ) with density œï := dQ/dP . Clearly, Œ±min(Q) = +‚àûif
œï /‚ààLq(, F , P). Otherwise, the inÔ¨Åmum in (4.71) is attained for
ŒªQ =
 px0
E[ œïq ]
1/q
.
Hence, we can identify Œ±min(Q) for any Q ‚â™P as
Œ±p
min(Q) = (px0)1/p ¬∑ E
 dQ
dP
q 1/q
.
Taking the limit p ‚Üì1, we obtain the case ‚Ñì(x) = x+ where we measure the risk in
terms of the expected shortfall. Here we have
Œ±1
min(Q) = x0 ¬∑

dQ
dP

‚àû
.
‚ô¶

4.9 Shortfall risk
219
Together with Proposition 4.19, Theorem 4.106 yields the following result for risk
measures which are deÔ¨Åned in terms of a robust notion of bounded shortfall risk. Here
it is convenient to deÔ¨Åne ‚Ñì‚àó(‚àû) := ‚àû.
Corollary 4.110. Suppose that Q is a family of probability measures on (, F ), and
that ‚Ñì, ‚Ñì‚àó, and x0 are as in Theorem 4.106. We deÔ¨Åne a set of acceptable positions by
A :=

X ‚ààX | EP [ ‚Ñì(‚àíX) ] ‚â§x0 for all P ‚ààQ

.
Then the corresponding convex risk measure can be represented in terms of the penalty
function
Œ±(Q) = inf
Œª>0
1
Œª

x0 + inf
P ‚ààQ EP

‚Ñì‚àó

ŒªdQ
dP
 
,
Q ‚ààM1(, F ),
where dQ/dP is the density appearing in the Lebesgue decomposition of Q with
respect to P as in Theorem A.13.
Example 4.111. In the case of Example 4.105, the corresponding robust problem in
Corollary 4.110 leads to the following entropy minimization problem: For a given Q
and a set Q of probability measures, Ô¨Ånd
inf
P ‚ààQ H(Q|P ).
Note that this problem is different from the standard problem of minimizing H(Q|P )
with respect to the Ô¨Årst variable Q as it appears in Section 3.2.
‚ô¶
Example 4.112. Take x0 = 0 in (4.68) and ‚Ñì(x) := x. Then
‚Ñì‚àó(z) :=

0
if z = 1,
+‚àû
otherwise.
Therefore, Œ±(Q) = ‚àûif Q Ã∏= P , and œÅ(X) = E[ ‚àíX ]. If Q is a set of probability
measures, the ‚Äúrobust‚Äù risk measure œÅ of Corollary 4.110 is coherent, and it is given
by
œÅ(X) = sup
P ‚ààQ
EP [ ‚àíX ].
‚ô¶


Part II
Dynamic hedging


Chapter 5
Dynamic arbitrage theory
In this chapter we develop a dynamic version of the arbitrage theory of Chapter 1.
Here we will work in a multiperiod setting, where the stochastic price Ô¨Çuctuation of
a Ô¨Ånancial asset is described as a stochastic process in discrete time. Portfolios will
be successively readjusted, taking into account the information available at each time.
Market efÔ¨Åciency requires that such dynamic trading strategies do not create arbitrage
opportunities. In Section 5.2 we show that an arbitrage-free model is characterized
by the existence of an equivalent martingale measure. Under such a measure, the
discounted price processes of the traded assets are martingales, that is, they have the
mathematical structure of a fair game. In Section 5.3 we introduce European con-
tingent claims. These are Ô¨Ånancial instruments whose payoff at the expiration date
depends on the behavior of the underlying primary assets, and possibly on other fac-
tors. We discuss the problem of pricing such contingent claims in a manner which
does not create new arbitrage opportunities. The pricing problem is closely related to
the problem of hedging a given claim by using a dynamic trading strategy based on
the primary assets. An ideal situation occurs if any contingent claim can be perfectly
replicated by the Ô¨Ånal outcome of such a strategy. In such a complete model, the
equivalent martingale measure P ‚àóis unique, and derivatives are priced in a canon-
ical manner by taking the expectation of the discounted payoff with respect to the
measure P ‚àó. Section 5.5 contains a simple case study for completeness, the binomial
model introduced by Cox, Ross, and Rubinstein. In this context, it is possible to obtain
explicit pricing formulas for a number of exotic options, as explained in Section 5.6.
In Section 5.7 we pass to the limiting diffusion model of geometric Brownian motion.
Using a suitable version of the central limit theorem, we are led to the general Black‚Äì
Scholes formula for European contingent claims and to explicit pricing formulas for
some exotic options such as the up-and-in call.
The general structure of complete models is described in Section 5.4. There it will
become clear that completeness is the exception rather than the rule: Typical market
models in discrete time are incomplete.
5.1 The multi-period market model
Throughout this chapter, we consider a market model in which d + 1 assets are priced
at times t = 0, 1, . . . , T . The price of the ith asset at time t is modelled as a non-
negative random variable Si
t on a given probability space (, F , P ). The random
vector St = (S0
t , St) = (S0
t , S1
t , . . . , Sd
t ) is assumed to be measurable with respect

224
5 Dynamic arbitrage theory
to a œÉ-algebra Ft ‚äÇF . One should think of Ft as the class of all events which are
observable up to time t. Thus, it is natural to assume that
F0 ‚äÇF1 ‚äÇ¬∑ ¬∑ ¬∑ ‚äÇFT .
(5.1)
DeÔ¨Ånition 5.1. A family (Ft)t=0,...,T of œÉ-algebras satisfying (5.1) is called a Ô¨Åltra-
tion. In this case, (, F , (Ft)t=0,...,T , P) is also called a Ô¨Åltered probability space.
To simplify the presentation, we will assume that
F0 = {‚àÖ, }
and
F = FT .
(5.2)
Let (E, E) be a measurable space. A stochastic process with state space (E, E) is
given by a family of E-valued random variables on (, F , P ) indexed by time. In
our context, the typical parameter sets will be {0, . . . , T } or {1, . . . , T }, and the state
space will be some Euclidean space.
DeÔ¨Ånition 5.2. Let (, F , P) be a probability space and (Ft)t=0,...,T be a Ô¨Åltration.
(a) A stochastic process Y = (Yt)t=0,...,T is called adapted with respect to the
Ô¨Åltration (Ft)t=0,...,T if each Yt is Ft-measurable.
(b) A stochastic process Z = (Zt)t=1,...,T is called predictable with respect to
(Ft)t=0,...,T if each Zt is Ft‚àí1-measurable.
Note that in our deÔ¨Ånition predictable processes start at t = 1 while adapted
processes are also deÔ¨Åned at t = 0. In particular, the asset prices S = (St)t=0,...,T
form an adapted stochastic process with values in Rd+1.
DeÔ¨Ånition 5.3. A trading strategy is a predictable Rd+1-valued process Œæ = (Œæ0, Œæ) =
(Œæ0
t , Œæ1
t , . . . , Œæd
t )t=1,...,T .
The value Œæi
t of a trading strategy Œæ corresponds to the quantity of shares of the
ith asset held during the tth trading period between t ‚àí1 and t. Thus, Œæi
t Si
t‚àí1 is the
amount invested into the ith asset at time t ‚àí1, while Œæi
t Si
t is the resulting value at
time t. The total value of the portfolio Œæt at time t ‚àí1 is
Œæt ¬∑ St‚àí1 =
d

i=0
Œæi
t Si
t‚àí1.
By time t, the value of the portfolio Œæt has changed to
Œæt ¬∑ St =
d

i=0
Œæi
t Si
t .
The predictability of Œæ expresses the fact that investments must be allocated at the
beginning of each trading period, without anticipating future price increments.

5.1 The multi-period market model
225
DeÔ¨Ånition 5.4. A trading strategy Œæ is called self-Ô¨Ånancing if
Œæt ¬∑ St = Œæt+1 ¬∑ St
for t = 1, . . . , T ‚àí1.
(5.3)
Intuitively, (5.3) means that the portfolio is always rearranged in such a way that its
present value is preserved. It follows that the accumulated gains and losses resulting
from the asset price Ô¨Çuctuations are the only source of variations of the portfolio value:
Œæt+1 ¬∑ St+1 ‚àíŒæt ¬∑ St = Œæt+1 ¬∑ (St+1 ‚àíSt).
(5.4)
In fact, a trading strategy is self-Ô¨Ånancing if and only if (5.4) holds for t = 1, . . . , T ‚àí1.
It follows through summation over (5.4) that
Œæt ¬∑ St = Œæ1 ¬∑ S0 +
t
k=1
Œæk ¬∑ (Sk ‚àíSk‚àí1)
for t = 1, . . . , T .
Here, the constant Œæ1 ¬∑ S0 can be interpreted as the initial investment for the purchase
of the portfolio Œæ1.
Example 5.5. Often it is assumed that the 0th asset plays the role of a locally riskless
bond. In this case, one takes S0
0 ‚â°1 and one lets S0
t evolve according to a spot rate
rt ‚â•0: At time t, an investment x made at time t ‚àí1 yields the payoff x(1 + rt).
Thus, a unit investment at time 0 produces the value
S0
t =
t
k=1
(1 + rk)
at time t. An investment in S0 is ‚Äúlocally riskless‚Äù if the spot rate rt is known before-
hand at time t ‚àí1. This idea can be made precise by assuming that the process r is
predictable.
‚ô¶
Without assuming predictability as in the preceding example, we assume from
now on that
S0
t > 0
P -a.s. for all t.
This assumption allows us to use the 0th asset as a num√©raire and to form the discounted
price processes
Xi
t := Si
t
S0t
,
t = 0, . . . , T, i = 0, . . . , d.
Then X0
t ‚â°1, and Xt = (X1
t , . . . , Xd
t ) expresses the value of the remaining assets in
units of the num√©raire. As explained in Remark 1.9, discounting allows comparison
of asset prices which are quoted at different times.

226
5 Dynamic arbitrage theory
DeÔ¨Ånition 5.6. The (discounted) value process V = (Vt)t=0,...,T associated with a
trading strategy Œæ is given by
V0 := Œæ1 ¬∑ X0
and
Vt := Œæt ¬∑ Xt
for t = 1, . . . , T.
The gains process associated with Œæ is deÔ¨Åned as
G0 := 0
and
Gt :=
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1)
for t = 1, . . . , T .
Clearly,
Vt = Œæt ¬∑ Xt = Œæt ¬∑ St
S0t
,
so Vt can be interpreted as the portfolio value at the end of the tth trading period
expressed in units of the num√©raire asset. The gains process
Gt =
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1)
reÔ¨Çects, in terms of the num√©raire, the net gains which have accumulated through the
trading strategy Œæ up to time t. For a self-Ô¨Ånancing trading strategy Œæ, the identity
Œæt ¬∑ St = Œæ1 ¬∑ S0 +
t
k=1
Œæk ¬∑ (Sk ‚àíSk‚àí1)
(5.5)
remains true if all relevant quantities are computed in units of the num√©raire. This is
the content of the following simple proposition.
Proposition 5.7. For a trading strategy Œæ the following conditions are equivalent:
(a) Œæ is self-Ô¨Ånancing.
(b) Œæt ¬∑ Xt = Œæt+1 ¬∑ Xt for t = 1, . . . , T ‚àí1.
(c) Vt = V0 + Gt = Œæ1 ¬∑ X0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) for all t.
Proof. By dividing both sides of (5.3) by S0
t it is seen that condition (b) is a reformu-
lation of DeÔ¨Ånition 5.4. Moreover, (b) holds if and only if
Œæt+1 ¬∑ Xt+1 ‚àíŒæt ¬∑ Xt = Œæt+1 ¬∑ (Xt+1 ‚àíXt) = Œæt+1 ¬∑ (Xt+1 ‚àíXt)
for t = 1, . . . , T ‚àí1, and this identity is equivalent to (c).

5.2 Arbitrage opportunities and martingale measures
227
Remark 5.8. The num√©raire component of a self-Ô¨Ånancing trading strategy Œæ satisÔ¨Åes
Œæ0
t+1 ‚àíŒæ0
t = ‚àí(Œæt+1 ‚àíŒæt) ¬∑ Xt
for t = 1, . . . , T ‚àí1.
(5.6)
Since
Œæ0
1 = V0 ‚àíŒæ1 ¬∑ X0,
(5.7)
the entire process Œæ0 is determined by the initial investment V0 and the d-dimensional
process Œæ. Consequently, if a constant V0 and an arbitrary d-dimensional predictable
process Œæ are given, then we can use (5.7) and (5.6) as the deÔ¨Ånition of a predictable
process Œæ0, and this construction yields a self-Ô¨Ånancing trading strategy Œæ := (Œæ0, Œæ).
In dealing with self-Ô¨Ånancing strategies Œæ, it is thus sufÔ¨Åcient to focus on the initial
investment V0 and the d-dimensional processes X and Œæ.
‚ô¶
Remark 5.9. Different economic agents investing into the same market may choose
different num√©raires. For example, consider the following simple market model in
which prices are quoted in euros ( ‚Ç¨) as the domestic currency. Let S0 be a locally
riskless ‚Ç¨-bond with the predictable spot rate process r0, i.e.,
S0
t =
t
k=1
(1 + r0
k ),
and let S1 describe the price of a locally riskless investment into US dollars ($). Since
the price of this $-bond is quoted in ‚Ç¨, the asset S1 is modeled as
S1
t = Ut ¬∑
t
k=1
(1 + r1
k ),
where r1 is the spot rate for a $-investment, and Ut denotes the price of 1$ in terms
of ‚Ç¨, i.e., Ut is the exchange rate of the $ versus the ‚Ç¨. While it may be natural for
European investors to take S0 as their num√©raire, it may be reasonable for anAmerican
investor to choose S1. This simple example explains why it may be relevant to check
which concepts and results of our theory are invariant under a change of num√©raire;
see, e.g., the discussion at the end of Section 5.2.
‚ô¶
5.2 Arbitrage opportunities and martingale measures
Intuitively, an arbitrage opportunity is an investment strategy that yields a positive
proÔ¨Åt with positive probability but without any downside risk.
DeÔ¨Ånition 5.10. A self-Ô¨Ånancing trading strategy is called an arbitrage opportunity
if its value process V satisÔ¨Åes
V0 ‚â§0,
VT ‚â•0 P -a.s.,
and
P [ VT > 0 ] > 0.

228
5 Dynamic arbitrage theory
The existence of such an arbitrage opportunity may be regarded as a market in-
efÔ¨Åciency in the sense that certain assets are not priced in a reasonable way. In this
section, we will characterize those market models which do not allow for arbitrage
opportunities. Such models will be called arbitrage-free. The following proposition
shows that the market model is arbitrage-free if and only if there are no arbitrage
opportunities for each single trading period. Later on, this fact will allow us to apply
the results of Section 1.6 to our multi-period model.
Proposition 5.11. The market model admits an arbitrage opportunity if and only if
there exist t ‚àà{1, . . . , T } and Œ∑ ‚ààL0(, Ft‚àí1, P ; Rd) such that
Œ∑ ¬∑ (Xt ‚àíXt‚àí1) ‚â•0 P -a.s., and P [ Œ∑ ¬∑ (Xt ‚àíXt‚àí1) > 0 ] > 0.
(5.8)
Proof. To prove necessity, take an arbitrage opportunity Œæ = (Œæ0, Œæ) with value process
V , and let
t := min

k | Vk ‚â•0 P -a.s., and P [ Vk > 0 ] > 0

.
Then t ‚â§T by assumption, and either Vt‚àí1 = 0 P -a.s. or P [ Vt‚àí1 < 0 ] > 0. In the
Ô¨Årst case, it follows that
Œæt ¬∑ (Xt ‚àíXt‚àí1) = Vt ‚àíVt‚àí1 = Vt
P -a.s.
Thus, Œ∑ := Œæt satisÔ¨Åes (5.8). In the second case, we let Œ∑ := Œæt I{Vt‚àí1<0}. Then Œ∑ is
Ft‚àí1-measurable, and
Œ∑ ¬∑ (Xt ‚àíXt‚àí1) = (Vt ‚àíVt‚àí1) I{Vt‚àí1<0} ‚â•‚àíVt‚àí1 I{Vt‚àí1<0}.
The expression on the right-hand side is non-negative and strictly positive with a
positive probability, so (5.8) holds.
Now we prove sufÔ¨Åciency. For t and Œ∑ as in (b), deÔ¨Åne a d-dimensional predictable
process Œæ by
Œæs :=

Œ∑
if s = t,
0
otherwise.
Via (5.7) and (5.6), Œæ uniquely deÔ¨Ånes a self-Ô¨Ånancing trading strategy Œæ = (Œæ0, Œæ)
with initial investment V0 = 0.
Since the corresponding value process satisÔ¨Åes
VT = Œ∑ ¬∑ (Xt ‚àíXt‚àí1), the strategy Œæ is an arbitrage opportunity.
DeÔ¨Ånition 5.12. A stochastic process M = (Mt)t=0,...,T on a Ô¨Åltered probability
space (, F , (Ft), Q) is called a martingale if M is adapted, satisÔ¨Åes EQ[ |Mt| ] < ‚àû
for all t, and if
Ms = EQ[ Mt | Fs ]
for 0 ‚â§s ‚â§t ‚â§T .
(5.9)
A martingale can be regarded as the mathematical formalization of a ‚Äúfair game‚Äù:
For each time s and for each horizon t > s, the conditional expectation of the future
gain Mt ‚àíMs is zero, given the information available at s.

5.2 Arbitrage opportunities and martingale measures
229
Remark 5.13. Clearly, (5.9) is equivalent to the following condition:
Mt = EQ[ Mt+1 | Ft ]
for 0 ‚â§t ‚â§T ‚àí1.
Taking t = T in (5.9), we see that, in our context of a Ô¨Ånite time horizon, a process
M is a martingale if and only if it arises as a sequence of successive conditional
expectations EQ[ F | Ft ] for some F ‚ààL1(, FT , Q). Consider, for example, the
density process
Zt := d 
Q
dQ

Ft
,
t = 0, . . . , T,
of a probability measure 
Q that is absolutely continuous with respect to Q. It follows
from Proposition A.11 that Zt = EQ[ ZT | Ft ], so that Z is a martingale.
‚ô¶
Whether or not a given process M is a martingale depends on the underlying
probability measure Q. If we wish to emphasize the dependence of the martingale
property of M on a particular measure Q, we will say that M is a Q-martingale or
that M is a martingale under the measure Q.
DeÔ¨Ånition 5.14. A probability measure Q on (, FT ) is called a martingale measure
if the discounted price process X is a (d-dimensional) Q-martingale, i.e.,
EQ[ Xi
t ] < ‚àû
and
Xi
s = EQ[ Xi
t | Fs ],
0 ‚â§s ‚â§t ‚â§T, i = 1, . . . , d.
A martingale measure P ‚àóis called an equivalent martingale measure if it is equivalent
to the original measure P on FT . The set of all equivalent martingale measures is
denoted by P .
The following result is a version of Doob‚Äôs fundamental ‚Äúsystems theorem‚Äù for
martingales. It states that a fair game admits no realistic gambling system which
produces a positive expected gain. Here, Y ‚àídenotes the negative part ‚àíY ‚àß0 of a
random variable Y.
Theorem 5.15. For a probability measure Q, the following conditions are equivalent.
(a) Q is a martingale measure.
(b) If Œæ = (Œæ0, Œæ) is self-Ô¨Ånancing and Œæ is bounded, then the value process V of
Œæ is a Q-martingale.
(c) If Œæ = (Œæ0, Œæ) is self-Ô¨Ånancing and its value process V satisÔ¨Åes EQ[ V ‚àí
T ] < ‚àû,
then V is a Q-martingale.
(d) If Œæ = (Œæ0, Œæ) is self-Ô¨Ånancing and its value process V satisÔ¨Åes VT ‚â•0 Q-a.s.,
then EQ[ VT ] = V0.

230
5 Dynamic arbitrage theory
Proof. (a) ‚áí(b): Let V be the value process of a self-Ô¨Ånancing trading strategy
Œæ = (Œæ0, Œæ) such that |Œæ| is bounded by a constant c. Then
|Vt| ‚â§|V0| +
t
k=1
c

|Xk| + |Xk‚àí1|

.
Since each |Xk| belongs to L1(Q), we have EQ[ |Vt| ] < ‚àû. Moreover, for 0 ‚â§t ‚â§
T ‚àí1,
EQ[ Vt+1 | Ft ] = EQ

Vt + Œæt+1 ¬∑ (Xt+1 ‚àíXt) | Ft

= Vt + Œæt+1 ¬∑ EQ[ Xt+1 ‚àíXt | Ft ]
= Vt,
where we have used that Œæt+1 is Ft-measurable and bounded.
(b) ‚áí(c): We will show the following implication:
If EQ[ V ‚àí
t ] < ‚àûthen EQ[ Vt | Ft‚àí1 ] = Vt‚àí1.
(5.10)
Since EQ[ V ‚àí
T ] < ‚àûby assumption, we will then get
EQ[ V ‚àí
T ‚àí1 ] = EQ

EQ[ VT | FT ‚àí1 ]‚àí
‚â§EQ[ V ‚àí
T ] < ‚àû,
due to Jensen‚Äôs inequality for conditional expectations. Repeating this argument will
yield EQ[ V ‚àí
t ] < ‚àûand EQ[ Vt | Ft‚àí1 ] = Vt‚àí1 for all t. Since V0 is a Ô¨Ånite constant,
we will also get EQ[ Vt ] = V0, which together with the fact that EQ[ V ‚àí
t ] < ‚àû
implies Vt ‚ààL1(Q) for all t. Thus, the martingale property of V will follow.
To prove (5.10), note Ô¨Årst that EQ[ Vt | Ft‚àí1 ] is well deÔ¨Åned due to our assumption
EQ[ V ‚àí
t ] < ‚àû. Next, let Œæ(a)
t
:= Œæt I{|Œæt|‚â§a} for a > 0. Then Œæ(a)
t
¬∑ (Xt ‚àíXt‚àí1) is
a martingale increment by condition (b). In particular, Œæ(a)
t
¬∑ (Xt ‚àíXt‚àí1) ‚ààL1(Q)
and EQ[ Œæ(a)
t
¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ] = 0. Hence,
EQ[ Vt | Ft‚àí1 ] I{|Œæt|‚â§a} = EQ[ Vt I{|Œæt|‚â§a} | Ft‚àí1 ] ‚àíEQ[ Œæ(a)
t
¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ]
= EQ

Vt I{|Œæt|‚â§a} ‚àíŒæ(a)
t
¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1

= EQ

Vt‚àí1 I{|Œæt|‚â§a} | Ft‚àí1

= Vt‚àí1 I{|Œæt|‚â§a}.
By sending a ‚Üë‚àû, we obtain (5.10).
(c) ‚áí(d): By (5.2), every Q-martingale M satisÔ¨Åes
M0 = EQ[ MT | F0 ] = EQ[ MT ].
(d) ‚áí(a): To prove that Xi
t ‚ààL1(Q) for given i and t, consider the deterministic
process Œæ deÔ¨Åned by Œæi
s := I{s‚â§t} and Œæj
s := 0 for j Ã∏= i. By Remark 5.8, Œæ can be

5.2 Arbitrage opportunities and martingale measures
231
complemented with a predictable process Œæ0 such that Œæ = (Œæ0, Œæ) is a self-Ô¨Ånancing
strategy with initial investment V0 = Xi
0. The corresponding value process satisÔ¨Åes
VT = V0 +
T

s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1) = Xi
t ‚â•0.
From (d) we get
EQ[ Xi
t ] = EQ[ VT ] = V0 = Xi
0,
(5.11)
which yields Xi
t ‚ààL1(Q).
Condition (a) will follow if we can show that EQ[ Xi
t; A ] = EQ[ Xi
t‚àí1; A ] for
given t, i, and A ‚ààFt‚àí1. To this end, we deÔ¨Åne a d-dimensional predictable process Œ∑
by Œ∑i
s := I{s<t} + IAc I{s=t} and Œ∑j
s := 0 for j Ã∏= i. As above, we take a predictable
process Œ∑0 such that Œ∑ = (Œ∑0, Œ∑) is a self-Ô¨Ånancing strategy with initial investment

V0 = Xi
0. Its terminal value is given by

VT = 
V0 +
T

s=1
Œ∑s ¬∑ (Xs ‚àíXs‚àí1) = Xi
tIAc + Xi
t‚àí1IA ‚â•0.
Using (d) yields
Xi
0 = 
V0 = EQ[ 
VT ] = EQ[ Xi
t; Ac ] + EQ[ Xi
t‚àí1; A ].
Bycomparingthisidentitywith(5.11), weconcludethatEQ[Xi
t; A] = EQ[Xi
t‚àí1; A].
Remark 5.16. (a) Suppose that the ‚Äúobjective‚Äù measure P is itself a martingale mea-
sure, so that the Ô¨Çuctuation of prices may be viewed as a fair game. In this case, the
preceding proposition shows that there are no realistic self-Ô¨Ånancing strategies which
would generate a positive expected gain. Thus, the assumption P ‚ààP is a strong
version of the so-called efÔ¨Åcient market hypothesis. For a market model containing
a locally risk-less bond, this strong hypothesis would imply that risk-averse investors
would not be attracted towards investing into the risky assets if their expectations are
consistent with P ; see Example 2.43.
(b) The strong assumption P ‚ààP implies, in particular, that there is no arbitrage
opportunity, i.e., no self-Ô¨Ånancing strategy with positive expected gain and without
any downside risk. Indeed, Theorem 5.15 implies that the value process of any self-
Ô¨Ånancing strategy with V0 ‚â§0 and VT ‚â•0 satisÔ¨Åes E[ VT ] = V0, hence VT = 0 P -
almost surely. The assumption that the market model is arbitrage-free may be viewed
as a much milder and hence more Ô¨Çexible form of the efÔ¨Åcient market hypothesis. ‚ô¶
We can now state the following dynamic version of the ‚Äúfundamental theorem of
asset pricing‚Äù, which relates the absence of arbitrage opportunities to the existence of
equivalent martingale measures.

232
5 Dynamic arbitrage theory
Theorem 5.17. The market model is arbitrage-free if and only if the set P of all
equivalent martingale measures is non-empty. In this case, there exists a P ‚àó‚ààP
with bounded density dP ‚àó/dP.
Proof. Suppose Ô¨Årst that there exists an equivalent martingale measure P ‚àó. Then it
follows as in Remark 5.16 (b) that the market model in which the probability measure
P is replaced by P ‚àóis arbitrage-free. Since the notion of an arbitrage opportunity
depends on the underlying measure only through its null sets and since these are
common for the two equivalent measures P and P ‚àó, it follows that also the original
market model is arbitrage-free.
Let us turn to the proof of the converse assertion. For t ‚àà{1, . . . , T }, we deÔ¨Åne
Kt :=

Œ∑ ¬∑ (Xt ‚àíXt‚àí1) | Œ∑ ‚ààL0(, Ft‚àí1, P ; Rd)

.
(5.12)
By Proposition 5.11, the market model is arbitrage-free if and only if
Kt ‚à©L0
+(, Ft, P) = {0}
(5.13)
holds for all t. Note that (5.13) depends on the measure P only through its null sets.
Condition (5.13) allows us to apply Theorem 1.54 to the tth trading period. For
t = T we obtain a probability measure 
PT ‚âàP which has a bounded density d 
PT /dP
and which satisÔ¨Åes

ET [ XT ‚àíXT ‚àí1 | FT ‚àí1 ] = 0.
Now suppose that we already have a probability measure 
Pt+1 ‚âàP with a bounded
density d 
Pt+1/dP such that

Et+1[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] = 0
for t + 1 ‚â§k ‚â§T.
(5.14)
The equivalence of 
Pt+1 and P implies that (5.13) also holds with P replaced by 
Pt+1.
Applying Theorem 1.54 to the tth trading period yields a probability measure 
Pt with
a bounded Ft-measurable density Zt := d 
Pt/d 
Pt+1 > 0 such that

Et[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] = 0.
Clearly, 
Pt is equivalent to P and has a bounded density, since
d 
Pt
dP =
d 
Pt
d 
Pt+1
¬∑ d 
Pt+1
dP
is the product of two bounded densities. Moreover, if t +1 ‚â§k ‚â§T , PropositionA.12
and the Ft-measurability of Zt = d 
Pt/d 
Pt+1 imply

Et[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] =

Et+1[ (Xk ‚àíXk‚àí1)Zt | Fk‚àí1 ]

Et+1[ Zt | Fk‚àí1 ]
= 
Et+1[ Xk ‚àíXk‚àí1 | Fk‚àí1 ]
= 0.

5.2 Arbitrage opportunities and martingale measures
233
Hence, (5.14) carries over from 
Pt+1 to 
Pt. We can repeat this recursion until Ô¨Ånally
P ‚àó:= 
P1 yields the desired equivalent martingale measure.
Clearly, the absence of arbitrage in the market is independent of the choice of the
num√©raire, while the set P of equivalent martingale measures generally does depend
on the num√©raire. In order to investigate the structure of this dependence, suppose
that the Ô¨Årst asset S1 is P -a.s. strictly positive, so that it can serve as an alternative
num√©raire. The price process discounted by S1 is denoted by
Y t = (Y 0
t , Y 1
t , . . . , Y d
t ) :=
S0
t
S1t
, 1, S2
t
S1t
, . . . , Sd
t
S1t

= S0
t
S1t
Xt,
t = 0, . . . , T.
Let 
P be the set of equivalent martingale measures for Y. Then 
P Ã∏= ‚àÖif and only
if P Ã∏= ‚àÖ, according to Theorem 5.17 and the fact that the existence of arbitrage
opportunities is independent of the choice of the num√©raire.
Proposition 5.18. The two sets P and 
P are related via the identity

P =
$

P ‚àó d 
P ‚àó
dP ‚àó= X1
T
X1
0
for some P ‚àó‚ààP
%
.
Proof.
The process X1
t /X1
0 is a P ‚àó-martingale for any P ‚àó‚ààP .
In particular,
E‚àó[ X1
T /X1
0 ] = 1, and the formula
d 
P ‚àó
dP ‚àó= X1
T
X1
0
deÔ¨Ånes a probability measure 
P ‚àówhich is equivalent to P . Moreover, by Proposi-
tion A.12,

E‚àó[ Y t | Fs ] = 1
X1s
¬∑ E‚àó[ Y t ¬∑ X1
t |Fs ]
= 1
X1s
¬∑ E‚àó[ Xt | Fs ]
= Y s.
Hence, 
P ‚àóis an equivalent martingale measure for Y, and it follows that

P ‚äá
$

P ‚àó d 
P ‚àó
dP ‚àó= X1
T
X1
0
for some P ‚àó‚ààP
%
.
Reversing the roles of X and Y yields the identity of the two sets.
Remark 5.19. Unless X1
T is P -a.s. constant, the two sets P and 
P satisfy
P ‚à©
P = ‚àÖ.
This can be proved as in Remark 1.10.
‚ô¶

234
5 Dynamic arbitrage theory
5.3 European contingent claims
AkeytopicofmathematicalÔ¨Ånanceistheanalysisofderivativesecuritiesorcontingent
claims, i.e., of certain assets whose payoff depends on the behavior of the primary
assets S0, S1, . . . , Sd and, in some cases, also on other factors.
DeÔ¨Ånition 5.20. A non-negative random variable C on (, FT , P ) is called a Eu-
ropean contingent claim. A European contingent claim C is called a derivative of
the underlying assets S0, S1, . . . , Sd if C is measurable with respect to the œÉ-algebra
generated by the price process (St)t=0,...,T .
A European contingent claim has the interpretation of an asset which yields at
time T the amount C(œâ), depending on the scenario œâ of the market evolution. T is
called the expiration date or the maturity of C. Of course, maturities prior to the Ô¨Ånal
trading period T of our model are also possible, but unless it is otherwise mentioned,
we will assume that our European contingent claims expire at T . In Chapter 6, we will
meet another class of derivative securities, the so-called American contingent claims.
As long as there is no risk of confusion between European and American contingent
claims, we will use the term ‚Äúcontingent claim‚Äù to refer to a European contingent
claim.
Example 5.21. The owner of a European call option has the right, but not the obli-
gation, to buy an asset at time T for a Ô¨Åxed price K, called the strike price. This
corresponds to a contingent claim of the form
Ccall = (Si
T ‚àíK)+.
Conversely, a European put option gives the right, but not the obligation, to sell the
asset at time T for a strike price K. This corresponds to the contingent claim
Cput = (K ‚àíSi
T )+.
‚ô¶
Example 5.22. The payoff of an Asian option depends on the average price
Si
av := 1
|T|

t‚ààT
Si
t
of the underlying asset during a predetermined set of periods T ‚äÇ{0, . . . , T }. For
instance, an average price call with strike K corresponds to the contingent claim
Ccall
av := (Si
av ‚àíK)+,
and an average price put has the payoff
Cput
av := (K ‚àíSi
av)+.
Average price options can be used, for instance, to secure regular cash streams against
exchange rate Ô¨Çuctuations. For example, assume that an economic agent receives at

5.3 European contingent claims
235
each time t ‚ààT a Ô¨Åxed amount of a foreign currency with exchange rates Si
t . In
this case, an average price put option may be an efÔ¨Åcient instrument for securing the
incoming cash stream against the risk of unfavorable exchange rates.
An average strike call corresponds to the contingent claim
(Si
T ‚àíSi
av)+,
while an average strike put pays off the amount
(Si
av ‚àíSi
T )+.
An average strike put can be used, for example, to secure the risk from selling at time T
a quantity of an asset which was bought at successive times over the period T.
‚ô¶
Example 5.23. The payoff of a barrier option depends on whether the price of the
underlying asset reaches a certain level before maturity. Most barrier options are
either knock-out or knock-in options. A knock-in option pays off only if the barrier B
is reached. The simplest example is a digital option
Cdig :=
Ô£±
Ô£≤
Ô£≥
1
if max
0‚â§t‚â§T Si
t ‚â•B,
0
otherwise,
which has a unit payoff if the price processes reaches a given upper barrier B > Si
0.
Another example is the down-and-in put with strike price K and lower barrier 
B < Si
0
which pays off
Cput
d&i :=
Ô£±
Ô£≤
Ô£≥
(K ‚àíSi
T )+
if min
0‚â§t‚â§T Si
t ‚â§
B,
0
otherwise.
A knock-out barrier option has a zero payoff once the price of the underlying asset
reaches the predetermined barrier. For instance, an up-and-out call corresponds to the
contingent claim
Ccall
u&o :=
Ô£±
Ô£≤
Ô£≥
(Si
T ‚àíK)+
if max
0‚â§t‚â§T Si
t < B,
0
otherwise;
see Figure 5.1. Down-and-out and up-and-in options are deÔ¨Åned analogously.
‚ô¶
Example 5.24. Using a lookback option, one can trade the underlying asset at the
maximal or minimal price that occurred during the life of the option. A lookback call
has the payoff
Si
T ‚àímin
0‚â§t‚â§T Si
t ,
while a lookback put corresponds to the contingent claim
max
0‚â§t‚â§T Si
t ‚àíSi
T .
‚ô¶

236
5 Dynamic arbitrage theory
B
S1
0
K
T
Figure 5.1. In one scenario, the payoff of the up-and-out call becomes zero because the stock
price hits the barrier B before time T . In the other scenario, the payoff is given by (ST ‚àíK)+.
The discounted value of a contingent claim C when using the num√©raire S0 is
given by
H := C
S0
T
.
We will call H the discounted European claim or just the discounted claim associated
withC. Intheremainderofthistext, ‚ÄúH‚Äùwillbethegenericnotationforthediscounted
payoff of any type of contingent claim.
The reader may wonder why we work simultaneously with the notions of a con-
tingent claim and a discounted claim. From a purely mathematical point of view,
there would be no loss of generality in assuming that the num√©raire asset is identically
equal to one. In fact, the entire theory to be developed in Part II can be seen as a
discrete-time ‚Äústochastic analysis‚Äù for the d-dimensional process X = (X1, . . . , Xd)
and its ‚Äústochastic integrals‚Äù
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1)
of predictable d-dimensional processes Œæ. However, some of the economic intuition
would be lost if we would limit the discussion to this level. For instance, we have
already seen the economic relevance of the particular choice of the num√©raire, even
though this choice may be irrelevant from the mathematician‚Äôs point of view. As a com-
promise between the mathematician‚Äôs preference for conciseness and the economist‚Äôs

5.3 European contingent claims
237
concern for keeping track explicitly of economically relevant quantities, we develop
the mathematics on the level of discounted prices, but we will continue to discuss
deÔ¨Ånitions and results in terms of undiscounted prices whenever it seems appropriate.
From now on, we will assume that our market model is arbitrage-free or, equiva-
lently, that
P Ã∏= ‚àÖ.
DeÔ¨Ånition 5.25. A contingent claim C is called attainable (replicable, redundant) if
there exists a self-Ô¨Ånancing trading strategy Œæ whose terminal portfolio value coincides
with C, i.e.,
C = ŒæT ¬∑ ST
P -a.s.
Such a trading strategy Œæ is called a replicating strategy for C.
Clearly, a contingent claim C is attainable if and only if the corresponding dis-
counted claim H = C/S0
T is of the form
H = ŒæT ¬∑ XT = VT = V0 +
T

t=1
Œæt ¬∑ (Xt ‚àíXt‚àí1),
for a self-Ô¨Ånancing trading strategy Œæ = (Œæ0, Œæ) with value process V . In this case,
we will say that the discounted claim H is attainable, and we will call Œæ a replicating
strategy for H. The following theorem yields the surprising result that an attainable
discounted claim is automatically integrable with respect to every equivalent mar-
tingale measure. Note, however, that integrability may not hold for an attainable
contingent claim prior to discounting.
Theorem 5.26. Any attainable discounted claim H is integrable with respect to each
equivalent martingale measure, i.e.,
E‚àó[ H ] < ‚àû
for all P ‚àó‚ààP .
Moreover, for each P ‚àó‚ààP the value process of any replicating strategy satisÔ¨Åes
Vt = E‚àó[ H | Ft ]
P -a.s. for t = 0, . . . , T .
In particular, V is a non-negative P ‚àó-martingale.
Proof. This follows from VT = H ‚â•0 and the systems theorem in the form of
Theorem 5.15.
Remark 5.27. The identity
Vt = E‚àó[ H | Ft ],
t = 0, . . . , T,
appearing in Theorem 5.26 has two remarkable implications. Since its right-hand side
is independent of the particular replicating strategy, all such strategies must have the

238
5 Dynamic arbitrage theory
same value process. Moreover, the left-hand side does not depend on the choice of
P ‚àó‚ààP . Hence, Vt is a version of the conditional expectation E‚àó[ H | Ft ] for every
P ‚àó‚ààP . In particular, E‚àó[ H ] is the same for all P ‚àó‚ààP .
‚ô¶
Remark 5.28. When applied to an attainable contingent claim C prior to discounting,
Theorem 5.26 states that
Œæt ¬∑ St = S0
t E‚àó
 C
S0
T
 Ft

,
t = 0, . . . , T,
P-a.s. for all P ‚àó‚ààP and for every replicating strategy Œæ. In particular, the initial
investment which is needed for a replication of C is given by
Œæ1 ¬∑ S0 = S0
0E‚àó
 C
S0
T

.
‚ô¶
Let us now turn to the problem of pricing a contingent claim. Consider Ô¨Årst a
discounted claim H which is attainable. Then the (discounted) initial investment
Œæ1 ¬∑ X0 = V0 = E‚àó[ H ]
(5.15)
needed for the replication of H can be interpreted as the unique (discounted) ‚Äúfair
price‚Äù of H. In fact, a different price for H would create an arbitrage opportunity.
For instance, if H could be sold at time 0 for a price œÄ which is higher than (5.15),
then selling H and buying the replicating portfolio Œæ yields the proÔ¨Åt
œÄ ‚àíŒæ1 ¬∑ X0 > 0
at time 0, although the terminal portfolio value VT = ŒæT ¬∑ XT sufÔ¨Åces for settling the
claim H at maturity T . In order to make this idea precise, let us formalize the idea of
an ‚Äúarbitrage-free price‚Äù of a general discounted claim H.
DeÔ¨Ånition 5.29. A real number œÄH ‚â•0 is called an arbitrage-free price of a dis-
counted claim H, if there exists an adapted stochastic process Xd+1 such that
Xd+1
0
= œÄH,
Xd+1
t
‚â•0 for t = 1, . . . , T ‚àí1, and
(5.16)
Xd+1
T
= H,
and such that the enlarged market model with price process (X0, X1, . . . , Xd, Xd+1)
is arbitrage-free. The set of all arbitrage-free prices of H is denoted by (H). The
lower and upper bounds of (H) are denoted by
œÄinf(H) := inf (H)
and
œÄsup(H) := sup (H).

5.3 European contingent claims
239
Thus, an arbitrage-free price œÄH of a discounted claim H is by deÔ¨Ånition a price at
which H can be traded at time 0 without introducing arbitrage opportunities into the
market model: If H is sold for œÄH, then neither buyer nor seller can Ô¨Ånd an investment
strategy which both eliminates all the risk and yields an opportunity to make a positive
proÔ¨Åt. Our aim in this section is to characterize the set of all arbitrage-free prices of
a discounted claim H.
Note that an arbitrage-free price œÄH is quoted in units of the num√©raire asset. The
amount that corresponds to œÄH in terms of currency units prior to discounting is equal
to
œÄC := S0
0œÄH,
and œÄC is an (undiscounted) arbitrage-free price of the contingent claim C := S0
T H.
Theorem 5.30. The set of arbitrage-free prices of a discounted claim H is non-empty
and given by
(H) =

E‚àó[ H ] | P ‚àó‚ààP and E‚àó[ H ] < ‚àû

.
(5.17)
Moreover, the lower and upper bounds of (H) are given by
œÄinf(H) = inf
P ‚àó‚ààP
E‚àó[ H ]
and
œÄsup(H) = sup
P ‚àó‚ààP
E‚àó[ H ].
Proof. By Theorem 5.17, œÄH is an arbitrage-free price for H if and only if we can
Ô¨Ånd an equivalent martingale measure ÀÜP for the market model extended via (5.16).
ÀÜP must satisfy
Xi
t = ÀÜE[ Xi
T | Ft]
for t = 0, . . . , T and i = 1, . . . , d + 1.
In particular, ÀÜP belongs to P and satisÔ¨Åes œÄH = ÀÜE[ H ]. Thus, we obtain the inclusion
‚äÜin (5.17).
Conversely, if œÄH = E‚àó[ H ] for some P ‚àó‚ààP , then we can deÔ¨Åne the stochastic
process
Xd+1
t
:= E‚àó[ H | Ft],
t = 0, . . . , T,
which satisÔ¨Åes all the requirements of (5.16). Moreover, the same measure P ‚àóis
clearly an equivalent martingale measure for the extended market model, which hence
is arbitrage-free. Thus, we obtain the identity of the two sets in (5.17).
To show that (H) is non-empty, we Ô¨Årst Ô¨Åx some measure 
P ‚âàP such that

E[ H ] < ‚àû. For instance, we can take d 
P = c(1+H)‚àí1 dP , where c is the normal-
izing constant. Under 
P , the market model is arbitrage-free. Hence, Theorem 5.17
yields P ‚àó‚ààP such that dP ‚àó/d 
P is bounded. In particular, E‚àó[ H ] < ‚àûand hence
E‚àó[ H ] ‚àà(H).
The formula for œÄinf(H) follows immediately from (5.17) and the fact that
(H) Ã∏= ‚àÖ. The one for œÄsup(H) needs an additional argument. Suppose that P ‚àû‚ààP
is such that E‚àû[ H ] = ‚àû. We must show that for any c > 0 there exists some

240
5 Dynamic arbitrage theory
œÄ ‚àà(H) with œÄ > c. To this end, let n be such that œÄ := E‚àû[ H ‚àßn ] > c, and
deÔ¨Åne
Xd+1
t
:= E‚àû[ H ‚àßn | Ft ],
t = 0, . . . , T.
Then P ‚àûis an equivalent martingale measure for the extended market model
(X0, . . . , Xd, Xd+1), which hence is arbitrage-free.
Applying the already estab-
lished fact that the set of arbitrage-free prices of any contingent claim is nonempty
to the extended market model yields an equivalent martingale measure P ‚àófor
(X0, . . . , Xd, Xd+1) such that E‚àó[ H ] < ‚àû.
Since P ‚àóis also a martingale
measure for the original market model, the Ô¨Årst part of this proof implies that
œÄ := E‚àó[ H ] ‚àà(H). Finally, note that
œÄ = E‚àó[ H ] ‚â•E‚àó[ H ‚àßn ] = E‚àó[ Xd+1
T
] = Xd+1
0
= œÄ > c.
Hence, the formula for œÄsup(H) is proved.
Example 5.31. In an arbitrage-free market model, we consider a European call op-
tion Ccall = (S1
T ‚àíK)+ with strike K > 0 and with maturity T . We assume that the
num√©raire S0 is the predictable price process of a locally riskless bond as in Exam-
ple 5.5. Then S0
t is increasing in t and satisÔ¨Åes S0
0 ‚â°1. For any P ‚àó‚ààP , Theorem 5.30
yields an arbitrage-free price œÄcall of Ccall which is given by
œÄcall = E‚àó
 Ccall
S0
T

= E‚àó
 
X1
T ‚àíK
S0
T
+ 
.
Due to the convexity of the function x ‚Üíx+ = x ‚à®0 and our assumptions on S0,
œÄcall can be bounded below as follows:
œÄcall ‚â•

E‚àó

X1
T ‚àíK
S0
T
+
=

S1
0 ‚àíE‚àó
 K
S0
T
+
‚â•

S1
0 ‚àíK)+.
In Ô¨Ånancial language, this fact is usually expressed by saying that the value of the
option is higher than its ‚Äúintrinsic value‚Äù (S1
0 ‚àíK)+, i.e., the payoff if the option were
exercised immediately. The difference of the price œÄcall of an option and its intrinsic
value is often called the ‚Äútime-value‚Äù of the European call option; see Figure 5.2. ‚ô¶
Example 5.32. For a European put option Cput = (K ‚àíS1
T )+, the situation is more
complicated. If we consider the same situation as in Example 5.31, then the analogue
of (5.31) fails unless the num√©raire S0 is constant. In fact, as a consequence of the
put-call parity, the ‚Äútime value‚Äù of a put option whose intrinsic value is large (i.e., the
option is ‚Äúin the money‚Äù) usually becomes negative; see Figure 5.3.
‚ô¶

5.3 European contingent claims
241
K
S1
0
Figure 5.2. The typical price of a call option as a function of S1
0 is always above the option‚Äôs
intrinsic value (S1
0 ‚àíK)+.
K
S1
0
Figure 5.3. The typical price of a European put option as a function of S1
0 compared to the
option‚Äôs intrinsic value (K ‚àíS1
0)+.
Our next aim is to characterize the structure of the set of arbitrage-free prices of a
discounted claim H. It follows from Theorem 5.30 that every arbitrage-free price œÄH
of H must lie between the two numbers
œÄinf(H) = inf
P ‚àó‚ààP
E‚àó[ H ]
and
œÄsup(H) = sup
P ‚àó‚ààP
E‚àó[ H ].
We also know that œÄinf(H) and œÄsup(H) are equal if H is attainable. The following
theorem shows that also the converse implication holds, i.e., H is attainable if and
only if œÄinf(H) = œÄsup(H).

242
5 Dynamic arbitrage theory
Theorem 5.33. Let H be a discounted claim.
(a) If H is attainable, then the set (H) of arbitrage-free prices for H consists of
the single element V0, where V is the value process of any replicating strategy
for H.
(b) If H is not attainable, then œÄinf(H) < œÄsup(H) and
(H) =

œÄinf(H), œÄsup(H)

.
Proof. The Ô¨Årst assertion follows from Remark 5.27 and Theorem 5.30.
To prove (b), note Ô¨Årst that
(H) = { E‚àó[ H ] | P ‚àó‚ààP , E‚àó[ H ] < ‚àû}
is an interval because P is a convex set. We will show that (H) is open by construct-
ing for any œÄ ‚àà(H) two arbitrage-free prices ÀáœÄ and ÀÜœÄ for H such that ÀáœÄ < œÄ < ÀÜœÄ.
To this end, take P ‚àó‚ààP such that œÄ = E‚àó[ H ]. We will Ô¨Årst construct an equivalent
martingale measure ÀÜP ‚ààP such that ÀÜE[ H ] > E‚àó[ H ]. Let
Ut := E‚àó[ H | Ft ],
t = 0, . . . , T,
so that
H = U0 +
T

t=1
(Ut ‚àíUt‚àí1).
Since H is not attainable, there must be some t ‚àà{1, . . . , T } such that Ut ‚àíUt‚àí1 /‚àà
Kt ‚à©L1(P ‚àó), where
Kt :=

Œ∑ ¬∑ (Xt ‚àíXt‚àí1) | Œ∑ ‚ààL0(, Ft‚àí1, P ; Rd)

.
By Lemma 1.68, Kt ‚à©L1(P ‚àó) is a closed linear subspace of L1(, Ft, P ‚àó).
Therefore, Theorem A.56 applied with B := {Ut ‚àíUt‚àí1} and C := Kt ‚à©L1(P ‚àó)
yields some Z ‚ààL‚àû(, Ft, P ‚àó) such that
sup

E‚àó[ W Z ] | W ‚ààKt ‚à©L1(P ‚àó)

< E‚àó[ (Ut ‚àíUt‚àí1) Z ] < ‚àû.
From the linearity of Kt ‚à©L1(P ‚àó) we deduce that
E‚àó[ W Z ] = 0
for all W ‚ààKt ‚à©L1(P ‚àó),
(5.18)
and hence that
E‚àó[ (Ut ‚àíUt‚àí1) Z ] > 0.
(5.19)
There is no loss of generality in assuming that |Z| ‚â§1/3, so that
ÀÜZ := 1 + Z ‚àíE‚àó[ Z | Ft‚àí1 ]

5.3 European contingent claims
243
can be taken as the density d ÀÜP /dP ‚àó= ÀÜZ of a new probability measure ÀÜP ‚âàP . Since
Z is Ft-measurable, the expectation of H under ÀÜP satisÔ¨Åes
ÀÜE[ H ] = E‚àó[ H ÀÜZ ]
= E‚àó[ H ] + E‚àó
E‚àó[ H | Ft] Z

‚àíE‚àó
E‚àó[ H | Ft‚àí1] E‚àó[ Z | Ft‚àí1]

= E‚àó[ H ] + E‚àó[ Ut Z ] ‚àíE‚àó[ Ut‚àí1 Z ]
> E‚àó[ H ],
where we have used (5.19) in the last step. On the other hand, ÀÜE[ H ] ‚â§5
3E‚àó[ H ] <
‚àû. Thus, ÀÜœÄ := ÀÜE[ H ] will yield the desired arbitrage-free price larger than œÄ if we
have ÀÜP ‚ààP .
Let us prove that ÀÜP ‚ààP. For k > t, the Ft-measurability of ÀÜZ and Proposi-
tion A.12 yield that
ÀÜE[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] = E‚àó[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] = 0.
For k = t, (5.18) yields E‚àó[ (Xt ‚àíXt‚àí1) Z | Ft‚àí1 ] = 0. Thus, it follows from
E‚àó[ ÀÜZ | Ft‚àí1 ] = 1 that
ÀÜE[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
= E‚àó
(Xt ‚àíXt‚àí1)

1 ‚àíE‚àó[ Z | Ft‚àí1]

| Ft‚àí1

+ E‚àó[ (Xt ‚àíXt‚àí1)Z | Ft‚àí1 ]
= 0.
Finally, if k < t then P ‚àóand ÀÜP coincide on Fk. Hence
ÀÜE[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] = E‚àó[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] = 0,
and we may conclude that ÀÜP ‚ààP.
It remains to construct another equivalent martingale measure ÀáP such that
ÀáœÄ := ÀáE[ H ] < E‚àó[ H ] = œÄ.
(5.20)
But this is simply achieved by letting
d ÀáP
dP ‚àó:= 2 ‚àíd ÀÜP
dP ‚àó,
which deÔ¨Ånes a probability measure ÀáP ‚âàP , because the density d ÀÜP /dP ‚àóis bounded
above by 5/3 and below by 1/3. ÀáP ‚ààP is then obvious as is (5.20).
Remark 5.34. So far, we have assumed that a contingent claim is settled at the termi-
nal time T . A natural way of dealing with an FT0-measurable payoff C0 ‚â•0 maturing
at some time T0 < T is to apply our results to the corresponding discounted claim
H0 := C0
S0
T0

244
5 Dynamic arbitrage theory
in the market model with the restricted time horizon T0. Clearly, this restricted model
is arbitrage-free. An alternative approach is to invest the payoff C0 at time T0 into the
num√©raire asset S0. At time T , this yields the contingent claim
C := C0 ¬∑ S0
T
S0
T0
,
whose discounted claim
H = C
S0
T
= C0
S0
T0
is formally identical to H0. Moreover, our results can be directly applied to H. It is
intuitively clear that these two approaches for determining the arbitrage-free prices of
C0 should be equivalent. A formal proof must show that the set (H) is equal to the
set
(H0) :=

E‚àó
0[ H0 ] | P ‚àó
0 ‚ààP0 and E‚àó
0[ H0 ] < ‚àû

of arbitrage-free prices of H0 in the market model whose time horizon is T0. Here,
P0 denotes the set of measures P ‚àó
0 on (, FT0) which are equivalent to P on FT0 and
which are martingale measures for the restricted price process (Xt)t=0,...,T0. Clearly,
each P ‚àó‚ààP deÔ¨Ånes an element of P0 by restricting P ‚àóto the œÉ-algebra FT0. In fact,
Proposition 5.35 below shows that every element in P0 arises in this way. Thus, the
two sets of arbitrage-free prices for H and H0 coincide, i.e.,
(H) = (H0)
It follows, in particular, that H0 is attainable if and only if H is attainable.
‚ô¶
Proposition 5.35. Consider the situation described in Remark 5.34 and let P ‚àó
0 ‚ààP0
be given. Then there exists some P ‚àó‚ààP whose restriction to FT0 is equal to P ‚àó
0 .
Proof. Let ÀÜP ‚ààP be arbitrary, and denote by ZT0 the density of P ‚àó
0 with respect to
the restriction of ÀÜP to the œÉ-algebra FT0. Then ZT0 is FT0-measurable, and
dP ‚àó:= ZT0 d ÀÜP
deÔ¨Ånes a probability measure on F . Clearly, P ‚àóis equivalent to ÀÜP and to P , and it
coincides with P ‚àó
0 on FT0. To check that P ‚àó‚ààP , it sufÔ¨Åces to show that Xt ‚àíXt‚àí1
is a martingale increment under P ‚àófor t > T0. For these t, the density ZT0 is Ft‚àí1-
measurable, so Proposition A.12 implies that
E‚àó[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] = ÀÜE[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] = 0.
Example 5.36. Let us consider the situation of Example 5.31, where the num√©raire S0
is a locally riskless bond. Remark 5.34 allows us to compare the arbitrage-free prices
of two European call options C0 = (S1
T0 ‚àíK)+ and C = (S1
T ‚àíK)+ with the same

5.4 Complete markets
245
strikes and underlyings but with different maturities T0 < T . As in Example 5.31, we
get that for P ‚àó‚ààP
E‚àó
 C
S0
T
 FT0

‚â•
1
S0
T0

S1
T0 ‚àíK E‚àó
 S0
T0
S0
T
 FT0
+
(5.21)
‚â•C0
S0
T0
.
Hence, if P ‚àóis used to calculate arbitrage-free prices for C0 and C, the resulting price
of C0 is lower than the price of C:
E‚àó
 C
S0
T

‚â•E‚àó
 C0
S0
T0

.
This argument suggests that the price of a European call option should be an increasing
function of the maturity.
‚ô¶
5.4 Complete markets
We have seen in Theorem 5.33 that any attainable claim in an arbitrage-free market
model has a unique arbitrage-free price. Thus, the situation becomes particularly
transparent if all contingent claims are attainable.
DeÔ¨Ånition 5.37. Anarbitrage-freemarketmodeliscalledcompleteifeverycontingent
claim is attainable.
Complete market models are precisely those models in which every contingent
claim has a unique and unambiguous arbitrage-free price. However, in discrete time,
onlyaverylimitedclassofmodelsenjoysthisproperty. Thefollowingcharacterization
of market completeness is sometimes called the ‚Äúsecond fundamental theorem of asset
pricing‚Äù.
Theorem 5.38. An arbitrage-free market model is complete if and only if there exists
exactly one equivalent martingale measure. In this case, the number of atoms in
(, FT , P) is bounded above by (d + 1)T .
Proof. If the model is complete, then H := IA for A ‚ààFT is an attainable discounted
claim. It follows from the results of Section 5.3 that the mapping P ‚àó‚ÜíE‚àó[ H ] =
P ‚àó[ A ] is constant over the set P. Hence, there can be only one equivalent martingale
measure.
Conversely, if |P | = 1, then the set (H) of arbitrage-free prices of every dis-
counted claim H has exactly one element. Hence, Theorem 5.33 implies that H is
attainable.

246
5 Dynamic arbitrage theory
To prove the second assertion, note Ô¨Årst that the asserted bound on the number of
atoms in FT holds for T = 1 by Theorem 1.40 and Proposition 1.39. We proceed
by induction on T . Suppose that the assertion holds for T ‚àí1. By assumption, any
bounded FT -measurable random variable H ‚â•0 can be written as
H = VT ‚àí1 + ŒæT ¬∑ (XT ‚àíXT ‚àí1),
where both VT ‚àí1 and ŒæT are FT ‚àí1-measurable and hence constant on each atom A of
(, FT ‚àí1, P). It follows that the dimension of the linear space L‚àû(, FT , P [ ¬∑ |A])
is less than or equal to d + 1. Thus, Proposition 1.39 implies that (, FT , P [ ¬∑ |A])
has at most d + 1 atoms. Applying the induction hypothesis concludes the proof.
Below we state additional characterizations of market completeness. Denote by
Q the set of all martingale measures in the sense of DeÔ¨Ånition 5.14. Then both P and
Q are convex sets. Recall that an element of a convex set is called an extreme point
of this set if it cannot be written as a non-trivial convex combination of members of
this set.
Property (d) in the following theorem is usually called the predictable represen-
tation property, or the martingale representation property, of the P ‚àó-martingale X.
Theorem 5.39. For P ‚àó‚ààP the following conditions are equivalent:
(a) P = {P ‚àó}.
(b) P ‚àóis an extreme point of P
(c) P ‚àóis an extreme point of Q.
(d) Every P ‚àó-martingale M can be represented as a ‚Äústochastic integral‚Äù of a
d-dimensional predictable process Œæ:
Mt = M0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1)
for t = 0, . . . , T .
Proof. (a) ‚áí(c): If P ‚àócan be written as P ‚àó= Œ±Q1 + (1 ‚àíŒ±)Q2 for Œ± ‚àà(0, 1) and
Q1, Q2 ‚ààQ, then Q1 and Q2 are both absolutely continuous with respect to P ‚àó. By
deÔ¨Åning
Pi := 1
2(Qi + P ‚àó),
i = 1, 2,
we thus obtain two martingale measures P1 and P2 which are equivalent to P ‚àó. Hence,
P1 = P2 = P ‚àóand, in turn, Q1 = Q2 = P ‚àó.
(c) ‚áí(b): This is obvious since P ‚äÇQ.
(b) ‚áí(a): Suppose that there exists a ÀÜP ‚ààP which is different from P ‚àó. We
will show below that in this case ÀÜP can be chosen such that the density d ÀÜP /dP ‚àóis

5.4 Complete markets
247
bounded by some constant c > 0. Then, if Œµ > 0 is less than 1/c,
dP ‚Ä≤
dP ‚àó:= 1 + Œµ ‚àíŒµ d ÀÜP
dP ‚àó
deÔ¨Ånes another measure P ‚Ä≤ ‚ààP different from P ‚àó. Moreover, P ‚àócan be represented
as the convex combination
P ‚àó=
Œµ
1 + Œµ
ÀÜP +
1
1 + Œµ P ‚Ä≤,
which contradicts condition (b). Hence, P ‚àómust be the unique equivalent martingale
measure.
It remains to prove the existence of ÀÜP ‚ààP with a bounded density d ÀÜP /dP ‚àó
if there exists some 
P ‚ààP which is different from P ‚àó. Then there exists a set
A ‚ààFT such that P ‚àó[ A ] Ã∏= 
P [ A ]. We enlarge our market model by introducing the
additional asset
Xd+1
t
:= 
P [ A | Ft ],
t = 0, . . . , T,
and we take P ‚àóinstead of P as our reference measure. By deÔ¨Ånition, 
P is an equiv-
alent martingale measure for (X0, X1, . . . , Xd, Xd+1). Hence, the extended market
model is arbitrage-free, and Theorem 5.17 guarantees the existence of an equivalent
martingale measure ÀÜP such that the density d ÀÜP /dP ‚àóis bounded. Moreover, ÀÜP must
be different from P ‚àó, since P ‚àóis not a martingale measure for Xd+1:
Xd+1
0
= 
P [ A ] Ã∏= P ‚àó[ A ] = E‚àó[ Xd+1
T
].
(a) ‚áí(d): The terminal value MT of a P ‚àó-martingale M can be decomposed into
the difference of its positive and negative parts:
MT = M+
T ‚àíM‚àí
T .
M+
T and M‚àí
T can be regarded as two discounted claims, which are attainable by
Theorem 5.38. Hence, there exist two d-dimensional predictable process Œæ+ and Œæ‚àí
such that
M¬±
T = V ¬±
0 +
T

k=1
Œæ¬±
k ¬∑ (Xk ‚àíXk‚àí1)
P ‚àó-a.s.
for two non-negative constants V +
0 and V ‚àí
0 . Since the value processes
V ¬±
t
:= V ¬±
0 +
t
k=1
Œæ¬±
k ¬∑ (Xk ‚àíXk‚àí1)
are P ‚àó-martingales by Theorem 5.26, we get that
Mt = E‚àó[ M+
T ‚àíM‚àí
T | Ft ] = V +
t
‚àíV ‚àí
t .

248
5 Dynamic arbitrage theory
This proves that the desired representation of M holds in terms of the d-dimensional
predictable process Œæ := Œæ+ ‚àíŒæ‚àí.
(d) ‚áí(a): Applying our assumption to the martingale Mt := P ‚àó[ A | Ft ] shows
that H = IA is an attainable contingent claim. Hence, it follows from the results of
Section 5.3 that the mapping P ‚àó‚ÜíP ‚àó[ A ] is constant over the set P . Thus, there
can be only one equivalent martingale measure.
5.5 The binomial model
A complete Ô¨Ånancial market model with only one risky asset must have a binary tree
structure, as we have seen inTheorem 5.38. Under an additional homogeneity assump-
tion, this reduces to the following particularly simple model, which was introduced
by Cox, Ross, and Rubinstein in [42]. It involves the riskless bond
S0
t := (1 + r)t,
t = 0, . . . , T,
with r > ‚àí1 and one risky asset S1 = S, whose return
Rt := St ‚àíSt‚àí1
St‚àí1
in the tth trading period can only take two possible values a, b ‚ààR such that
‚àí1 < a < b.
Thus, the stock price jumps from St‚àí1 either to the higher value St = St‚àí1(1 + b) or
to the lower value St = St‚àí1(1 + a). In this context, we are going to derive explicit
formulas for the arbitrage-free prices and replicating strategies of various contingent
claims.
Let us construct the model on the sample space
 := {‚àí1, +1}T =

œâ = (y1, . . . , yT ) | yi ‚àà{‚àí1, +1}

.
Denote by
Yt(œâ) := yt
for œâ = (y1, . . . , yT )
(5.22)
the projection on the tth coordinate, and let
Rt(œâ) := a 1 ‚àíYt(œâ)
2
+ b 1 + Yt(œâ)
2
=

a
if Yt(œâ) = ‚àí1,
b
if Yt(œâ) = +1.
The price process of the risky asset is modeled as
St := S0
t
k=1
(1 + Rk),

5.5 The binomial model
249
where the initial value S0 > 0 is a given constant. The discounted price process takes
the form
Xt = St
S0t
= S0
t
k=1
1 + Rk
1 + r .
As Ô¨Åltration we take
Ft := œÉ(S0, . . . , St) = œÉ(X0, . . . , Xt),
t = 0, . . . , T.
Note that F0 = {‚àÖ, }, and
Ft = œÉ(Y1, . . . , Yt) = œÉ(R1, . . . , Rt)
for t = 1, . . . , T ;
F := FT coincides with the power set of . Let us Ô¨Åx any probability measure P on
(, F ) such that
P [ {œâ} ] > 0
for all œâ ‚àà.
(5.23)
Such a model will be called a binomial model or a CRR model. The following theorem
characterizes those parameter values a, b, r for which the model is arbitrage-free.
Theorem 5.40. The CRR model is arbitrage-free if and only if a < r < b. In this
case, the CRR model is complete, and there is a unique martingale measure P ‚àó. The
martingale measure is characterized by the fact that the random variables R1, . . . , RT
are independent under P ‚àówith common distribution
P ‚àó[ Rt = b ] = p‚àó:= r ‚àía
b ‚àía ,
t = 1, . . . , T.
Proof. A measure Q on (, F ) is a martingale measure if and only if the discounted
price process is a martingale under Q, i.e.,
Xt = EQ[ Xt+1 | Ft ] = Xt EQ
 1 + Rt+1
1 + r
 Ft

Q-a.s.
for all t ‚â§T ‚àí1. This identity is equivalent to the equation
r = EQ[ Rt+1 | Ft ] = b ¬∑ Q[ Rt+1 = b | Ft ] + a ¬∑

1 ‚àíQ[ Rt+1 = b | Ft ]

,
i.e., to the condition
Q[ Rt+1 = b | Ft ](œâ) = p‚àó= r ‚àía
b ‚àía
for Q-a.e. œâ ‚àà.
But this holds if and only if the random variables R1, . . . , RT are independent under
Q with common distribution Q[ Rt = b ] = p‚àó. In particular, there can be at most
one martingale measure for X.

250
5 Dynamic arbitrage theory
If the market model is arbitrage-free, then there exists an equivalent martingale
measure P ‚àó. The condition P ‚àó‚âàP implies
p‚àó= P ‚àó[ R1 = b ] ‚àà(0, 1),
which holds if and only if a < r < b.
Conversely, if a < r < b then we can deÔ¨Åne a measure P ‚àó‚âàP on (, F ) by
P ‚àó[ {œâ} ] := (p‚àó)k ¬∑ (1 ‚àíp‚àó)T ‚àík > 0
where k denotes the number of occurrences of +1 in œâ = (y1, . . . , yT ). Under P ‚àó,
Y1, . . . , YT , and hence R1, . . . , RT , are independent random variables with common
distribution P ‚àó[ Yt = 1 ] = P ‚àó[ Rt = b ] = p‚àó, and so P ‚àóis an equivalent martingale
measure.
From now on, we consider only CRR models which are arbitrage-free, and we
denote by P ‚àóthe unique equivalent martingale measure.
Remark 5.41. NotethattheuniquemartingalemeasureP ‚àó, andhencethevaluationof
any contingent claim, is completely independent of the initial choice of the ‚Äúobjective‚Äù
measure P within the class of measures satisfying (5.23).
‚ô¶
Let us now turn to the problem of pricing and hedging a given contingent claim C.
The discounted claim H = C/S0
T can be written as
H = h(S0, . . . , ST )
for a suitable function h.
Proposition 5.42. The value process
Vt = E‚àó[ H | Ft ],
t = 0, . . . , T,
of a replicating strategy for H is of the form
Vt(œâ) = vt

S0, S1(œâ), . . . , St(œâ)

,
where the function vt is given by
vt(x0, . . . , xt) = E‚àó

h

x0, . . . , xt, xt
S1
S0
, . . . , xt
ST ‚àít
S0
 
.
(5.24)
Proof. Clearly,
Vt = E‚àó

h

S0, S1, . . . , St, St
St+1
St
, . . . , St
ST
St
  Ft

.

5.5 The binomial model
251
Each quotient St+s/St is independent of Ft and has under P ‚àóthe same distribution as
Ss
S0
=
s
k=1
(1 + Rk).
Hence (5.24) follows from the standard properties of conditional expectations.
Since V is characterized by the recursion
VT := H
and
Vt = E‚àó[ Vt+1 | Ft ],
t = T ‚àí1, . . . , 0,
we obtain a recursive formula for the functions vt deÔ¨Åned in (5.24):
vT (x0, . . . , xT ) = h(x0, . . . , xT ),
(5.25)
vt(x0, . . . , xt) = p‚àó¬∑ vt+1(x0, . . . , xt, xt ÀÜb) + (1 ‚àíp‚àó) ¬∑ vt+1(x0, . . . , xt, xt ÀÜa),
where
ÀÜa := 1 + a
and
ÀÜb := 1 + b.
Example 5.43. If H = h(ST ) depends only on the terminal value ST of the stock
price, then Vt depends only on the value St of the current stock price:
Vt(œâ) = vt

St(œâ)

.
Moreover, the formula (5.24) for vt reduces to an expectation with respect to the
binomial distribution with parameter p‚àó:
vt(xt) =
T ‚àít

k=0
h

xt ÀÜaT ‚àít‚àík ÀÜbkT ‚àít
k

(p‚àó)k(1 ‚àíp‚àó)T ‚àít‚àík.
In particular, the unique arbitrage-free price of H is given by
œÄ(H) = v0(S0) =
T

k=0
h

S0 ÀÜaT ‚àík ÀÜbkT
k

(p‚àó)k(1 ‚àíp‚àó)T ‚àík.
For h(x) = (x ‚àíK)+/(1+r)T or h(x) = (K ‚àíx)+/(1+r)T , we obtain explicit for-
mulas for the arbitrage-free prices of European call or put options with strike price K.
For instance, the price of H call := (ST ‚àíK)+/(1 + r)T is given by
œÄ(H
call) =
1
(1 + r)T
T

k=0

S0 ÀÜaT ‚àík ÀÜbk ‚àíK
+
T
k

(p‚àó)k(1 ‚àíp‚àó)T ‚àík.
‚ô¶

252
5 Dynamic arbitrage theory
Example 5.44. Denote by
Mt := max
0‚â§s‚â§t Ss,
0 ‚â§t ‚â§T,
the running maximum of S, and consider a discounted claim with payoff H =
h(ST , MT ). For instance, H can be an up-and-in or up-and-out barrier option or
a lookback put. Then the value process of H is of the form
Vt = vt(St, Mt),
where
vt(xt, mt) = E‚àó

h

xt
ST ‚àít
S0
, mt ‚à®

xt
MT ‚àít
S0
 
.
This follows from (5.24) or directly from the fact that
MT = Mt ‚à®

St max
t‚â§u‚â§T
Su
St

,
where maxt‚â§u‚â§T Su/St is independent of Ft and has the same law as MT ‚àít/S0 under
P ‚àó. The same argument works for options that depend on the minimum of the stock
price such as lookback calls or down-and-in barrier options.
For an Asian option depending on the average price
Sav := 1
|T|

t‚ààT
St
during a predetermined set of periods T ‚äÇ{0, . . . , T }, one introduces the process
At :=

s‚ààT, s‚â§t
Ss.
Using a similar argument as above, one shows that the value process Vt of the Asian
option is a function of St, At, and t.
‚ô¶
Let us now derive a formula for the hedging strategy Œæ = (Œæ0, Œæ) of our discounted
claim H = h(S0, . . . , ST ).
Proposition 5.45. The hedging strategy is given by
Œæt(œâ) = t

S0, S1(œâ), . . . , St‚àí1(œâ)

,
where
t(x0, . . . , xt‚àí1) := (1 + r)t vt(x0, . . . , xt‚àí1, xt‚àí1 ÀÜb) ‚àívt(x0, . . . , xt‚àí1, xt‚àí1 ÀÜa)
xt‚àí1 ÀÜb ‚àíxt‚àí1 ÀÜa
.

5.6 Exotic derivatives
253
Proof. For each œâ = (y1, . . . , yT ), Œæt must satisfy
Œæt(œâ)

Xt(œâ) ‚àíXt‚àí1(œâ)

= Vt(œâ) ‚àíVt‚àí1(œâ).
(5.26)
In this equation, the random variables Œæt, Xt‚àí1, and Vt‚àí1 depend only on the Ô¨Årst t ‚àí1
components of œâ. For a Ô¨Åxed t, let us deÔ¨Åne œâ+ and œâ‚àíby
œâ¬± := (y1, . . . , yt‚àí1, ¬±1, yt+1, . . . , yT ).
Plugging œâ+ and œâ‚àíinto (5.26) shows
Œæt(œâ) ¬∑

Xt‚àí1(œâ) ÀÜb(1 + r)‚àí1 ‚àíXt‚àí1(œâ)

= Vt(œâ+) ‚àíVt‚àí1(œâ)
Œæt(œâ) ¬∑

Xt‚àí1(œâ) ÀÜa(1 + r)‚àí1 ‚àíXt‚àí1(œâ)

= Vt(œâ‚àí) ‚àíVt‚àí1(œâ).
Solving for Œæt(œâ) and using our formula (5.25) for Vt, we obtain
Œæt(œâ) = (1 + r)Vt(œâ+) ‚àíVt(œâ‚àí)
Xt‚àí1(œâ)(ÀÜb ‚àíÀÜa)
= t

S0, S1(œâ), . . . , St‚àí1(œâ)

.
Remark 5.46. The term t may be viewed as a discrete ‚Äúderivative‚Äù of the value
function vt with respect to the possible stock price changes. In Ô¨Ånancial language,
a hedging strategy based on a derivative of the value process is often called a Delta
hedge.
‚ô¶
Remark 5.47. Let H = h(ST ) be a discounted claim which depends on the terminal
value of S by way of an increasing function h. For instance, h can be the discounted
payoff function h(x) = (x ‚àíK)+/(1 + r)T of a European call option. Then
vt(x) = E‚àó[ h(x ST ‚àít/S0) ]
is also increasing in x, and so the hedging strategy satisÔ¨Åes
Œæt(œâ) = (1 + r)t vt

St‚àí1(œâ) ÀÜb

‚àívt

St‚àí1(œâ) ÀÜa

St‚àí1(œâ) ÀÜb ‚àíSt‚àí1(œâ) ÀÜa
‚â•0.
In other words, the hedging strategy for H does not involve short sales of the risky
asset.
‚ô¶
5.6
Exotic derivatives
The recursion formula (5.25) can be used for the numeric computation of the value
process of any contingent claim. For the value processes of certain exotic derivatives
which depend on the maximum of the stock price, it is even possible to obtain simple
closed-form solutions if we make the additional assumption that
ÀÜa = 1
ÀÜb
,

254
5 Dynamic arbitrage theory
where ÀÜa = 1 + a and ÀÜb = 1 + b. In this case, the price process of the risky asset is of
the form
St(œâ) = S0 ÀÜbZt(œâ)
where, for Yk as in (5.22),
Z0 := 0
and
Zt := Y1 + ¬∑ ¬∑ ¬∑ + Yt,
t = 1, . . . , T.
Let P denote the uniform distribution
P[ {œâ} ] :=
1
|| = 2‚àíT ,
œâ ‚àà.
Under the measure P, the random variables Yt are independent with common distri-
bution P[ Yt = +1 ] = 1
2. Thus, the stochastic process Z becomes a standard random
walk under P. Therefore,
P[ Zt = k ] =
Ô£±
Ô£≤
Ô£≥
2‚àít
 t
t+k
2

if t + k is even,
0
otherwise.
(5.27)
The following lemma is the key to numerous explicit results on the distribution of
Z under the measure P; see, e.g., Chapter III of [83]. For its statement, it will be
convenient to assume that the random walk Z is deÔ¨Åned up to time T + 1; this can
always be achieved by enlarging our probability space (, F ). We denote by
Mt := max
0‚â§s‚â§t Zs
the running maximum of Z.
Lemma 5.48 (ReÔ¨Çection principle). For all k ‚ààN and l ‚ààN0,
P

MT ‚â•k and ZT = k ‚àíl

= P[ ZT = k + l ],
and
P

MT = k and ZT = k ‚àíl

= 2k + l + 1
T + 1
P[ ZT +1 = 1 + k + l ].
Proof. Let
œÑ(œâ) := inf{ t ‚â•0 | Zt(œâ) = k } ‚àßT.
For œâ = (y1, . . . , yT ) ‚àà we deÔ¨Åne œÜ(œâ) by œÜ(œâ) = œâ if œÑ(œâ) = T and by
œÜ(œâ) =

y1, . . . , yœÑ(œâ), ‚àíyœÑ(œâ)+1, . . . , ‚àíyT

otherwise, i.e., if the level k is reached before the deadline T . Intuitively, the two
trajectories

Zt(œâ)

t=0,...,T and

Zt(œÜ(œâ)

t=0,...,T coincide up to œÑ(œâ), but from then

5.6 Exotic derivatives
255
œÑ
T
k ‚àíl
k
k + l
Figure 5.4. The reÔ¨Çection principle.
on the latter path is obtained by reÔ¨Çecting the original one on the horizontal axis at
level k; see Figure 5.4.
Let Ak,l denote the set of all œâ ‚àà such that ZT (œâ) = k ‚àíl and MT ‚â•k. Then
œÜ is a bijection from Ak,l to the set

MT ‚â•k and ZT = k + l

,
which coincides with {ZT = k + l}, due to our assumption l ‚â•0. Hence, the uniform
distribution P must assign the same probability to Ak,l and {ZT = k + l}, and we
obtain our Ô¨Årst formula.
The second formula is trivial in case T + k + l is not even. Otherwise, we let
j := (T + k + l)/2 and apply (5.27) together with part one of this lemma:
P

MT = k; ZT = k ‚àíl

= P

MT ‚â•k; ZT = k ‚àíl

‚àíP

MT ‚â•k + 1; ZT = k ‚àíl

= P[ ZT = k + l ] ‚àíP[ ZT = k + l + 2 ]
= 2‚àíT
T
j

‚àí2‚àíT
 T
j + 1

= 2‚àíT
T + 1
j + 1
 2j + 1 ‚àíT
T + 1
,
and this expression is equal to the right-hand side of our second formula.

256
5 Dynamic arbitrage theory
Formula (5.27) changes as follows if we replace the uniform distribution P by our
martingale measure P ‚àó, described in Theorem 5.40:
P ‚àó[ Zt = k ] =
Ô£±
Ô£≤
Ô£≥
(p‚àó)
t+k
2 (1 ‚àíp‚àó)
t‚àík
2
 t
t+k
2

if t + k is even,
0
otherwise.
Let us now show how the reÔ¨Çection principle carries over to P ‚àó.
Lemma 5.49 (ReÔ¨Çection principle for P ‚àó). For all k ‚ààN and l ‚ààN0,
P ‚àó
MT ‚â•k, ZT = k ‚àíl

=
	1 ‚àíp‚àó
p‚àó

l
P ‚àó[ ZT = k + l ]
=
	
p‚àó
1 ‚àíp‚àó

k
P ‚àó[ ZT = ‚àík ‚àíl ],
and
P ‚àó
MT = k, ZT = k ‚àíl

= 1
p‚àó¬∑
	1 ‚àíp‚àó
p‚àó

l
¬∑ k + l + 1
T + 1
P ‚àó[ ZT +1 = 1 + k + l ]
=
1
1 ‚àíp‚àó¬∑
	
p‚àó
1 ‚àíp‚àó

k
¬∑ k + l + 1
T + 1
P ‚àó[ ZT +1 = ‚àí1 ‚àík ‚àíl ].
Proof. We show Ô¨Årst that the density of P ‚àówith respect to P is given by
dP ‚àó
dP = 2T ¬∑ (p‚àó)
T +ZT
2
(1 ‚àíp‚àó)
T ‚àíZT
2
.
Indeed, P ‚àóputs the weight
P ‚àó[ {œâ} ] = (p‚àó)k(1 ‚àíp‚àó)T ‚àík
to each œâ = (y1, . . . , yT ) ‚àà which contains exactly k components with yi = +1.
But for such an œâ we have ZT (œâ) = k ‚àí(T ‚àík) = 2k ‚àíT , and our formula follows.
From the density formula, we get
P ‚àó
MT ‚â•k and ZT = k ‚àíl

= 2T (p‚àó)
T +k‚àíl
2
(1 ‚àíp‚àó)
T +l‚àík
2
P

MT ‚â•k and ZT = k ‚àíl

.
Applying the reÔ¨Çection principle and using again the density formula, we see that the
probability term on the right is equal to
P[ ZT = k + l ] = 2‚àíT (p‚àó)‚àíT +k+l
2
(1 ‚àíp‚àó)‚àíT ‚àík‚àíl
2
P ‚àó[ ZT = k + l ],
which gives the Ô¨Årst identity. The proof of the remaining ones is analogous.

5.6 Exotic derivatives
257
Example 5.50 (Up-and-in call option). Consider an up-and-in call option of the form
Ccall
u&i =
Ô£±
Ô£≤
Ô£≥
(ST ‚àíK)+
if max
0‚â§t‚â§T St ‚â•B,
0
otherwise,
where B > S0 ‚à®K denotes a given barrier, and where K > 0 is the strike price. Our
aim is to compute the arbitrage-free price
œÄ(Ccall
u&i) =
1
(1 + r)T E‚àó[ Ccall
u&i ].
Clearly,
E‚àó
Ccall
u&i

= E‚àó
(ST ‚àíK)+; max
0‚â§t‚â§T St ‚â•B

=E‚àó
(ST ‚àíK)+; ST ‚â•B

+ E‚àó
(ST ‚àíK)+; max
0‚â§t‚â§T St ‚â•B, ST < B

.
The Ô¨Årst expectation on the right can be computed explicitly in terms of the binomial
distribution. Thus, it remains to compute the second expectation, which we denote
by I. To this end, we may assume without loss of generality that B lies within the
range of possible asset prices, i.e., there exists some k ‚ààN such that B = S0 ÀÜbk. Then,
by Lemma 5.49,
I =

l‚â•1
E‚àó
(ST ‚àíK)+; MT ‚â•k, ZT = k ‚àíl

=

l‚â•1
(S0 ÀÜbk‚àíl ‚àíK)+P ‚àó[ MT ‚â•k, ZT = k ‚àíl ]
=

l‚â•1
(S0 ÀÜbk‚àíl ‚àíK)+	
p‚àó
1 ‚àíp‚àó

k
P ‚àó[ ZT = ‚àík ‚àíl ]
=
	
p‚àó
1 ‚àíp‚àó

k ÀÜb2k 
l‚â•1
(S0 ÀÜb‚àík‚àíl ‚àí
K)+P ‚àó[ ZT = ‚àík ‚àíl ]
=
	
p‚àó
1 ‚àíp‚àó

k	 B
S0

2
E‚àó
(ST ‚àí
K)+; ST < B

,
where

K = K ÀÜb‚àí2k = K
	S0
B

2
.
Hence, we obtain the formula
œÄ(Ccall
u&i) =
1
(1 + r)T

E‚àó
(ST ‚àíK)+; ST ‚â•B

+
	
p‚àó
1 ‚àíp‚àó

k	 B
S0

2
E‚àó
(ST ‚àí
K)+; ST < B

.

258
5 Dynamic arbitrage theory
Both expectations on the right now only involve the binomial distribution with param-
eters p‚àóand T . They can be computed as in Example 5.43, and so we get the explicit
formula
œÄ(Ccall
u&i) =
1
(1 + r)T
 nk

n=0
(S0 ÀÜbT ‚àí2n ‚àíK)+(p‚àó)T ‚àín(1 ‚àíp‚àó)n

T
T ‚àín

+
	
p‚àó
1 ‚àíp‚àó

k	 B
S0

2
T

n=nk+1
(S0 ÀÜbT ‚àí2n ‚àí
K)+(p‚àó)T ‚àín(1 ‚àíp‚àó)n

T
T ‚àín

,
where nk is the largest integer n such that T ‚àí2n ‚â•k.
‚ô¶
Example 5.51 (Up-and-out call option). Consider an up-and-out call option of the
form
Ccall
u&o =
Ô£±
Ô£≤
Ô£≥
0
if max
0‚â§t‚â§T St ‚â•B,
(ST ‚àíK)+
otherwise,
where K > 0 is the strike price and B > S0 ‚à®K is an upper barrier for the stock price.
As in the preceding example, we assume that B = S0(1 + b)k for some k ‚ààN. Let
Ccall := (ST ‚àíK)+
denote the corresponding ‚Äúplain vanilla call‚Äù, whose arbitrage-free price is given by
œÄ

Ccall
=
1
(1 + r)T E‚àó[ (ST ‚àíK)+ ].
Since Ccall = Ccall
u&o + Ccall
u&i, we get from Example 5.50 that
œÄ

Ccall
u&o

= œÄ

Ccall
‚àíœÄ

Ccall
u&i

=
1
(1 + r)T

E‚àó
(ST ‚àíK)+; ST < B

‚àí
	
p‚àó
1 ‚àíp‚àó

k	 B
S0

2
E‚àó
(ST ‚àí
K)+; ST < B

.
where 
K = KS2
0/B2. These expectations can be computed as in Example 5.50.
‚ô¶
Similarly, one obtains pricing formulas for barrier options with a lower stock
price barrier such as down-and-out put options or down-and-in calls. In the following
example, we compute the price of a lookback put option. Lookback call options are
handled in the same manner.
Example 5.52 (Lookback put option). A lookback put option corresponds to the con-
tingent claim
Cput
max := max
0‚â§t‚â§T St ‚àíST ;

5.7 Convergence to the Black‚ÄìScholes price
259
see Example 5.24. In the CRR model, the discounted arbitrage-free price of Cput
max is
given by
œÄ

Cput
max

=
1
(1 + r)T E‚àó
max
0‚â§t‚â§T St

‚àíS0.
The expectation of the maximum can be computed as
E‚àó
max
0‚â§t‚â§T St

= S0
T

k=0
ÀÜbk P ‚àó
MT = k

Lemma 5.49 yields
P ‚àó[ MT = k ] =

l‚â•0
P ‚àó[ MT = k, ZT = k ‚àíl ]
=

l‚â•0
1
1 ‚àíp‚àó
	
p‚àó
1 ‚àíp‚àó

k k + l + 1
T + 1 P ‚àó[ ZT +1 = ‚àí1 ‚àík ‚àíl ]
=
1
1 ‚àíp‚àó
	
p‚àó
1 ‚àíp‚àó

k
1
T + 1E‚àó[ ‚àíZT +1; ZT +1 ‚â§‚àí1 ‚àík ].
Thus, we arrive at the formula
œÄ

Cput
max

+ S0 =
S0
(1 + r)T (1 ‚àíp‚àó)(T + 1) ¬∑
¬∑
T

k=0
ÀÜbk	
p‚àó
1 ‚àíp‚àó

k
E‚àó[ ‚àíZT +1; ZT +1 ‚â§‚àí1 ‚àík ].
As before, one can give explicit formulas for the expectations occurring on the right. ‚ô¶
5.7 Convergence to the Black‚ÄìScholes price
In practice, a huge number of trading periods may occur between the current time
t = 0 and the maturity T of a European contingent claim. Thus, the computation
of option prices in terms of some martingale measure may become rather elaborate.
On the other hand, one can hope that the pricing formulas in discrete time converge
to a transparent limit as the number of intermediate trading periods grows larger and
larger. In this section, we will formulate conditions under which such a convergence
occurs.
Throughout this section, T will not denote the number of trading periods in a Ô¨Åxed
discrete-time market model but rather a physical date. The time interval [0, T ] will be
divided into N equidistant time steps T
N , 2T
N , . . . , NT
N , and the date kT
N will correspond
to the kth trading period of an arbitrage-free market model. For simplicity, we will

260
5 Dynamic arbitrage theory
assume that each market model contains a riskless bond and just one risky asset. In
the Nth approximation, the risky asset will be denoted by S(N), and the riskless bond
will be deÔ¨Åned by a constant interest rate rN > ‚àí1.
The question is whether the prices of contingent claims in the approximating
market models converge as N tends to inÔ¨Ånity.
Since the terminal values of the
riskless bonds should converge, we assume that
lim
N‚Üë‚àû(1 + rN)N = erT ,
where r is a Ô¨Ånite constant. This condition is in fact equivalent to the following one:
lim
N‚Üë‚àûN rN = r T.
Let us now consider the risky assets. We assume that the initial prices S(N)
0
do not
depend on N, i.e., S(N)
0
= S0 for some constant S0 > 0. The prices S(N)
k
are random
variables on some probability space (N, F (N), P ‚àó
N), where P ‚àó
N is a risk-neutral
measure for each approximating market model, i.e., the discounted price process
X(N)
k
:=
S(N)
k
(1 + rN)k ,
k = 0, . . . , N,
is a P ‚àó
N-martingale with respect to the Ô¨Åltration F (N)
k
:= œÉ(S(N)
1
, . . . , S(N)
k
). Our
remaining conditions will be stated in terms of the returns
R(N)
k
:= S(N)
k
‚àíS(N)
k‚àí1
S(N)
k‚àí1
,
k = 1, . . . , N.
First, we assume that, for each N, the random variables R(N)
1
, . . . , R(N)
N
are indepen-
dent under P ‚àó
N and satisfy
‚àí1 < Œ±N ‚â§R(N)
k
‚â§Œ≤N,
k = 1, . . . , N,
for constants Œ±N and Œ≤N such that
lim
N‚Üë‚àûŒ±N = lim
N‚Üë‚àûŒ≤N = 0.
Second, we assume that the variances varN

R(N)
k

under P ‚àó
N are such that
œÉ 2
N := 1
T
N

k=1
varN

R(N)
k

‚àí‚ÜíœÉ 2 ‚àà(0, ‚àû).
The following result can be regarded as a multiplicative version of the central limit
theorem.

5.7 Convergence to the Black‚ÄìScholes price
261
Theorem 5.53. Under the above assumptions, the distributions of S(N)
N
under P ‚àó
N
converge weakly to the log-normal distribution with parameters log S0 + rT ‚àí1
2 œÉ 2T
and œÉ
‚àö
T , i.e., to the distribution of
ST := S0 exp

œÉ WT +

r ‚àí1
2œÉ 2

T

,
(5.28)
where WT has a centered normal law N(0, T ) with variance T .
Proof. We may assume without loss of generality that S0 = 1. Consider the Taylor
expansion
log(1 + x) = x ‚àí1
2 x2 + œÅ(x) x2
(5.29)
where the remainder term œÅ is such that
|œÅ(x)| ‚â§Œ¥(Œ±, Œ≤)
for ‚àí1 < Œ± ‚â§x ‚â§Œ≤,
and where Œ¥(Œ±, Œ≤) ‚Üí0 for Œ±, Œ≤ ‚Üí0. Applied to
S(N)
N
=
N

k=1

1 + R(N)
k

,
this yields
log S(N)
N
=
N

k=1

R(N)
k
‚àí1
2

R(N)
k
2
+ N,
where
|N| ‚â§Œ¥(Œ±N, Œ≤N)
N

k=1

R(N)
k
2.
Since P ‚àó
N is a martingale measure, we have E‚àó
N[ R(N)
k
] = rN, and it follows that
E‚àó
N[ |N| ] ‚â§Œ¥(Œ±N, Œ≤N)
N

k=1

varN

R(N)
k

+ r2
N

‚àí‚Üí0.
In particular, N ‚Üí0 in probability, and the corresponding laws converge weakly
to the Dirac measure Œ¥0. Slutsky‚Äôs theorem, as stated in Appendix A.6, asserts that it
sufÔ¨Åces to show that the distributions of
ZN :=
N

k=1

R(N)
k
‚àí1
2

R(N)
k
2
=:
N

k=1
Y (N)
k
converge weakly to the normal law N(rT ‚àí1
2œÉ 2T, œÉ 2T ). To this end, we will check
that the conditions of the central limit theorem in the form of Theorem A.36 are
satisÔ¨Åed.

262
5 Dynamic arbitrage theory
Note that
max
1‚â§k‚â§N
Y (N)
k
 ‚â§Œ≥N + 1
2Œ≥ 2
N ‚àí‚Üí0
for Œ≥N := |Œ±N| ‚à®|Œ≤N|, and that
E‚àó
N[ ZN ] = NrN ‚àí1
2

œÉ 2
N T + Nr2
N

‚àí‚Üír T ‚àí1
2 œÉ 2 T.
Finally,
varN(ZN) ‚àí‚ÜíœÉ 2 T,
since for p > 2
N

k=1
E‚àó
N
R(N)
k
p
‚â§Œ≥ p‚àí2
N
N

k=1
E‚àó
N

R(N)
k
2
‚àí‚Üí0.
Thus, the conditions of Theorem A.36 are satisÔ¨Åed.
Remark 5.54. The assumption of independent returns in Theorem 5.53 can be re-
laxed. Instead of Theorem A.36, we can apply a central limit theorem for martingales
under suitable assumptions on the behavior of the conditional variances
varN( R(n)
k
| Fk‚àí1 ) ;
for details see, e.g., Section 9.3 of [39].
‚ô¶
Example 5.55. Suppose the approximating model in the Nth stage is a CRR model
with interest rate
rN = r T
N ,
and with returns R(N)
k
, which can take the two possible values aN and bN; see Sec-
tion 5.5. We assume that
ÀÜaN = 1 + aN = e‚àíœÉ‚àöT /N
and
ÀÜbN = 1 + bN = eœÉ‚àöT/N
for some given œÉ > 0. Since
‚àö
NrN ‚àí‚Üí0,
‚àö
NaN ‚àí‚Üí‚àíœÉ
‚àö
T ,
‚àö
NbN ‚àí‚ÜíœÉ
‚àö
T
as N ‚Üë‚àû,
(5.30)
we have aN < rN < bN for large enough N. Theorem 5.40 yields that the Nth model
is arbitrage-free and admits a unique equivalent martingale measure P ‚àó
N. The measure
P ‚àó
N is characterized by
P ‚àó
N[ R(N)
k
= bN] =: p‚àó
N = rN ‚àíaN
bN ‚àíaN
,

5.7 Convergence to the Black‚ÄìScholes price
263
and we obtain from (5.30) that
lim
N‚Üë‚àûp‚àó
N = 1
2.
Moreover, E‚àó
N[ R(N)
k
] = rN, and we get
N

k=1
varN

R(N)
k

= N

p‚àó
Nb2
N + (1 ‚àíp‚àó
N)a2
N ‚àír2
N

‚àí‚ÜíœÉ 2T
as N ‚Üë‚àû. Hence, the assumptions of Theorem 5.53 are satisÔ¨Åed.
‚ô¶
Let us consider a derivative which is deÔ¨Åned in terms of a function f ‚â•0 of
the risky asset‚Äôs terminal value. In each approximating model, this corresponds to a
contingent claim
C(N) = f

S(N)
N

.
Corollary 5.56. If f is bounded and continuous, the arbitrage-free prices of C(N)
calculated under P ‚àó
N converge to a discounted expectation with respect to a log-normal
distribution, which is often called the Black‚ÄìScholes price. More precisely,
lim
N‚Üë‚àûE‚àó
N

C(N)
(1 + rN)N

= e‚àírT E‚àó[ f (ST )]
= e‚àírT
‚àö
2œÄ
 ‚àû
‚àí‚àû
f

S0eœÉ
‚àö
T y+rT ‚àíœÉ 2T/2
e‚àíy2/2 dy,
(5.31)
where ST has the form (5.28) under P ‚àó.
This convergence result applies in particular to the choice f (x) = (K ‚àíx)+
corresponding to a European put option with strike K. Since the put-call parity
E‚àó
N
 (S(N)
N
‚àíK)+
(1 + rN)N

= E‚àó
N
 (K ‚àíS(N)
N )+
(1 + rN)N

+ S0 ‚àí
K
(1 + rN)N
holds for each N, the convergence (5.31) is also true for a European call option with
the unbounded payoff proÔ¨Åle f (x) = (x ‚àíK)+.
Example 5.57 (Black‚ÄìScholes formula for the price of a call option).
The limit of
the arbitrage-free prices of C(N) = (S(N)
N
‚àíK)+ is given by v(S0, T ), where
v(x, T ) = e‚àírT
 ‚àû
‚àí‚àû

xeœÉ
‚àö
T y+rT ‚àíœÉ 2T/2 ‚àíK
+e‚àíy2/2 dy.
The integrand on the right vanishes for
y ‚â§‚àílog x
K +

r ‚àí1
2œÉ 2
T
œÉ
‚àö
T
=: ‚àíd‚àí(x, T ) =: ‚àíd‚àí.

264
5 Dynamic arbitrage theory
Let us also deÔ¨Åne
d+ := d+(x, T ) := d‚àí(x, T ) + œÉ
‚àö
T = log x
K +

r + 1
2œÉ 2
T
œÉ
‚àö
T
,
and let us denote by (z) = (2œÄ)‚àí1  x
‚àí‚àûe‚àíy2/2 dy the distribution function of the
standard normal distribution. Then
v(x, T ) =
x
‚àö
2œÄ
 +‚àû
‚àíd‚àí
e‚àí(y‚àíœÉ
‚àö
T )2/2 dy ‚àíe‚àírT K

1 ‚àí(‚àíd‚àí)

,
and we arrive at the Black‚ÄìScholes formula for the price of a European call option
with strike K and maturity T :
v(x, T ) = x (d+(x, T )) ‚àíe‚àírT K(d‚àí(x, T )).
(5.32)
See Figure 5.5 for the plot of the function v(x, t).
‚ô¶
0
0
t
T
2K
K
Figure 5.5. The Black‚ÄìScholes price v(x, t) of a European call option (ST ‚àíK)+ plotted as a
function of the initial spot price x = S0 and the time to maturity t.
Remark 5.58. For Ô¨Åxed x and T , the Black‚ÄìScholes price of a European call option
increases to the upper arbitrage bound x as œÉ ‚Üë‚àû. In the limit œÉ ‚Üì0, we obtain the
lower arbitrage bound (x ‚àíe‚àírT K)+; see Remark 1.36.
‚ô¶
The following proposition gives a criterion for the convergence (5.31) in case f is
not necessarily bounded and continuous. It applies in particular to f (x) = (x ‚àíK)+,
and so we get an alternative proof for the convergence of call option prices to the
Black‚ÄìScholes price.

5.7 Convergence to the Black‚ÄìScholes price
265
Proposition 5.59. Let f : (0, ‚àû) ‚ÜíR be measurable, continuous a.e., and such
that |f (x)| ‚â§c (1 + x)q for some c ‚â•0 and 0 ‚â§q < 2. Then
E‚àó
N

f

S(N)
N
 
‚àí‚ÜíE‚àó
f (ST )

,
where ST has the form (5.28) under P ‚àó.
Proof. Let us note Ô¨Årst that by the Taylor expansion (5.29)
log E‚àó
N
 
S(N)
N
2 
= log
N

k=1

varN

1 + R(N)
k

+ E‚àó
N

1 + R(N)
k
2
=
N

k=1
log

varN

R(N)
k

+ (1 + rN)2
‚â§œÉ 2
NT + 2N rN + N r2
N +c
N

k=1

varN

R(N)
k

+ 2|rN| + r2
N
2
for a Ô¨Ånite constant c. Thus,
sup
N
E‚àó
N
 
S(N)
N
2 
< ‚àû.
With this property established, the assertion follows immediately from Theorem 5.53
and the Corollaries A.45 and A.46, but we also give the following more elementary
proof. To this end, we may assume that q > 0, and we deÔ¨Åne p := 2/q > 1. Then
sup
N
E‚àó
N
 f

S(N)
N
p 
‚â§cp sup
N
E‚àó
N
 
1 + S(N)
N
2 
< ‚àû,
and the assertion follows from Lemma 5.60 below.
Lemma 5.60. Suppose (¬µN)N‚ààN is a sequence of probability measures on R con-
verging weakly to ¬µ. If f is a measurable and ¬µ-a.e. continuous function on R such
that
c := sup
N‚ààN

|f |p d¬µN < ‚àû
for some p > 1,
then

f d¬µN ‚àí‚Üí

f d¬µ.
Proof. We may assume without loss of generality that f ‚â•0. Then fk := f ‚àßk is a
bounded and ¬µ-a.e. continuous function for each k > 0. Clearly,

f d¬µN =

fk d¬µN +

(f ‚àík)+ d¬µN.

266
5 Dynamic arbitrage theory
Due to part (e) of the portmanteau theorem in the form of Theorem A.38, the Ô¨Årst
integral on the right converges to

fk d¬µ as N ‚Üë‚àû. Let us consider the second term
on the right:

(f ‚àík)+ d¬µN ‚â§

{f >k}
f d¬µN ‚â§
1
kp‚àí1

f p‚àí1f d¬µN ‚â§
c
kp‚àí1 ,
uniformly in N. Hence,

fk d¬µ = lim
N‚Üë‚àû

fk d¬µN ‚â§lim inf
N‚Üë‚àû

f d¬µN
‚â§lim sup
N‚Üë‚àû

f d¬µN ‚â§

fk d¬µ +
c
kp‚àí1 .
Letting k ‚Üë‚àû, we have

fk d¬µ ‚Üó

f d¬µ, and convergence follows.
Let us now continue the discussion of the Black‚ÄìScholes price of a European call
option where f (x) = (x ‚àíK)+. We are particularly interested how it depends on the
various model parameters. The dependence on the spot price S0 = x can be analyzed
via the x-derivatives of the function v(t, x) appearing in the Black‚ÄìScholes formula
(5.32). The Ô¨Årst derivative
(x, t) := ‚àÇ
‚àÇx v(x, t) = 

d+(x, t)

is called the option‚Äôs Delta; see Figure 5.6. In analogy to the formula for the hedging
strategy in the binomial model obtained in Proposition (5.45), (x, t) determines the
‚ÄúDelta hedging portfolio‚Äù needed for a replication of the call option in continuous
time, as explained in (5.37) below.
The Gamma of the call option is given by
(x, t) := ‚àÇ
‚àÇx (x, t) = ‚àÇ2
‚àÇx2 v(x, t) = œï

d+(x, t)

1
xœÉ‚àöt ;
see Figure 5.7. Here œï(x) = ‚Ä≤(x) = e‚àíx2/2/
‚àö
2œÄ stands as usual for the density
of the standard normal distribution. Large Gamma values occur in regions where the
Delta changes rapidly, corresponding to the need for frequent readjustments of the
Delta hedging portfolio. Note that  is always strictly positive. It follows that v(x, t)
is a strictly convex function of its Ô¨Årst argument.

5.7 Convergence to the Black‚ÄìScholes price
267
0
1
0
2
t
T
K
K
Figure 5.6. The Delta (x, t) of the Black‚ÄìScholes price of a European call option.
0
0
2
t
T
K
K
Figure 5.7. The option‚Äôs Gamma (x, t).
Remark 5.61. On the one hand, 0 ‚â§(x, t) ‚â§1 implies that
|v(x, t) ‚àív(y, t)| ‚â§|x ‚àíy|.
Thus, the total change of the option values is always less than a corresponding change
in the asset prices. On the other hand, the strict convexity of x ‚Üív(x, t) together
with (A.1) yields that for t > 0 and z > y
v(z, t) ‚àív(y, t)
z ‚àíy
> v(y, t) ‚àív(0, t)
y ‚àí0
= v(y, t)
y

268
5 Dynamic arbitrage theory
and hence
v(z, t) ‚àív(y, t)
v(y, t)
> z ‚àíy
y
.
Similarly, one obtains
v(x, t) ‚àív(y, t)
v(y, t)
< x ‚àíy
y
for x < y. Thus, the relative change of option prices is larger in absolute value than
the relative change of asset values. This fact can be interpreted as the leverage effect
for call options; see also Example 1.41.
‚ô¶
Another important parameter is the Theta
(x, t) := ‚àÇ
‚àÇt v(x, t) = xœÉ
2‚àöt œï

d+(x, t)

+ Kr e‚àírt

d‚àí(x, t)

;
see Figure 5.8. The fact  > 0 corresponds to our general observation, made in Ex-
ample 5.36, that arbitrage-free prices of European call options are typically increasing
functions of the maturity.
0
0
2
t
T
K
K
Figure 5.8. The Theta (x, t).
Note that, for t > 0, the parameters , , and  are related by the equation
(x, t) = rx (x, t) + 1
2œÉ 2x2 (x, t) ‚àír v(x, t).
Thus, for (x, t) ‚àà(0, ‚àû) √ó (0, ‚àû), the function v solves the partial differential
equation
‚àÇv
‚àÇt = rx ‚àÇv
‚àÇx + 1
2œÉ 2x2 ‚àÇ2v
‚àÇx2 ‚àírv,
(5.33)

5.7 Convergence to the Black‚ÄìScholes price
269
often called the Black‚ÄìScholes equation. Since
v(x, t) ‚àí‚Üíf (x) = (x ‚àíK)+
as t ‚Üì0,
(5.34)
v(x, t) is a solution of the Cauchy problem deÔ¨Åned via (5.33) and (5.34). This fact is
not limited to call options, it remains valid for all reasonable payoff proÔ¨Åles f .
Proposition 5.62. Let f be a continuous function on (0, ‚àû) such that |f (x)| ‚â§
c(1 + x)p for some c, p ‚â•0, and deÔ¨Åne
u(x, t) := e‚àírtE‚àó[ f (St) ] = e‚àírt
‚àö
2œÄ
 ‚àû
‚àí‚àû
f

xeœÉ‚àöty+rt‚àíœÉ 2t/2
e‚àíy2/2 dy,
where St = x exp(œÉWt + rt ‚àíœÉ 2t/2) and Wt has law N(0, t) under P ‚àó. Then
u solves the Cauchy problem deÔ¨Åned by the Black‚ÄìScholes equation (5.33) and the
initial condition limt‚Üì0 u(x, t) = f (x), locally uniformly in x.
Proof. By using the formula (2.20) for the density of a log-normally distributed random
variable, we obtain
E‚àó[ f (St) ] =
 ‚àû
0
1
yœÉ‚àöt œï
	log y ‚àírt + œÉ 2t/2 ‚àílog x
œÉ‚àöt

f (y) dy,
where œï(x) = e‚àíx2/2/
‚àö
2œÄ. The validity of (5.33) can now be checked by differen-
tiating under the integral. The initial condition is veriÔ¨Åed via Lebesgue‚Äôs theorem.
Recall that the Black‚ÄìScholes price v(S0, T ) was obtained as the expectation of
the discounted payoff e‚àírT (ST ‚àíK)+ under the measure P ‚àó. Thus, at a Ô¨Årst glance,
it may come as a surprise that the Rho of the option,
œ±(x, t) := ‚àÇ
‚àÇr v(x, t) = Kt e‚àírt 

d‚àí(x, t)

,
is strictly positive, i.e., the price is increasing in r; see Figure 5.9. Note, however, that
the measure P ‚àódepends itself on the interest rate r, since E‚àó[ e‚àírT ST ] = S0. In a
simple one-period model, we have already seen this effect in Example 1.41.
The parameter œÉ is called the volatility. As we have seen, the Black‚ÄìScholes price
of a European call option is an increasing function of the volatility, and this is reÔ¨Çected
in the strict positivity of
V(x, t) := ‚àÇ
‚àÇœÉ v(x, t) = x
‚àö
t œï

d+(x, t)

;
(5.35)
see Figure 5.10. The function V is often called the Vega of the call option price, and
the functions , , , œ±, and V are usually called the Greeks (although ‚Äúvega‚Äù does
not correspond to a letter of the Greek alphabet).

270
5 Dynamic arbitrage theory
0
0
2
t
T
K
K
Figure 5.9. The Rho œ±(x, t) of a call option.
0
0
t
T
K
K
2
Figure 5.10. The Vega V(x, t).
Let us conclude this section with some informal comments on the dynamic picture
behind the convergence result in Theorem 5.53 and the pricing formulas in Exam-
ple 5.57 and Proposition 5.59. The constant r is viewed as the interest rate of a
riskfree savings account
S0
t = ert,
0 ‚â§t ‚â§T.
The prices of the risky asset in each discrete-time model are considered as a continuous
process S(N) =
S(N)
t

0‚â§t‚â§T , deÔ¨Åned as S(N)
t
:= S(N)
k
at the dates t = kT
N , and by
linear interpolation in between. Theorem 5.53 shows that the distributions of S(N)
t

5.7 Convergence to the Black‚ÄìScholes price
271
converge for each Ô¨Åxed t weakly to the distribution of
St = S0 exp
	
œÉ Wt +
	
r ‚àí1
2œÉ 2
t

,
(5.36)
where Wt has a centered normal distribution with variance t. In fact, one can prove
convergence in the much stronger sense of a functional central limit theorem:
The laws of the processes S(N), considered as C[0, T ]-valued random variables on
(N, F (N), P ‚àó
N), converge weakly to the law of a geometric Brownian motion S =
(St)0‚â§t‚â§T , where each St is of the form (5.36), and where the process W = (Wt)0‚â§t‚â§T
is a standard Brownian motion or Wiener process. A Wiener process is characterized
by the following properties:
‚Ä¢ W0 = 0 almost surely,
‚Ä¢ t ‚ÜíWt is continuous,
‚Ä¢ for each sequence 0 = t0 < t1 < ¬∑ ¬∑ ¬∑ < tn = T , the increments
Wt1 ‚àíWt0, . . . , Wtn ‚àíWtn‚àí1
are independent and have normal distributions N(0, ti ‚àíti‚àí1);
see, e.g., [129]. This multiplicative version of a functional central limit theorem fol-
lows as above if we replace the classical central limit theorem by Donsker‚Äôs invariance
principle; for details see, e.g., [73].
Geometric Brownian motion is the classical reference model in continuous-time
mathematical Ô¨Ånance. In order to describe the model more explicitly, we denote by
W = (Wt)0‚â§t‚â§T the coordinate process on the canonical path space  = C[0, T ],
deÔ¨Åned by Wt(œâ) = œâ(t), and furthermore by (Ft)0‚â§t‚â§T the Ô¨Åltration given by
Ft = œÉ(Ws; s ‚â§t). There is exactly one probability measure P on (, FT ) such
that W is a Wiener process under P, and it is called the Wiener measure. Let us now
model the price process of a risky asset as a geometric Brownian motion S deÔ¨Åned by
(5.36). The discounted price process
Xt := St
ert = S0eœÉWt‚àíœÉ 2t/2,
0 ‚â§t ‚â§T,
is a martingale under P, since
E[ Xt | Fs ] = XsE

eœÉ(Wt‚àíWs)‚àíœÉ 2(t‚àís)/2 
= Xs
for 0 ‚â§s ‚â§t ‚â§T . In fact, P is the only probability measure equivalent to P with
that property.
As in discrete time, uniqueness of the equivalent martingale measure implies com-
pleteness of the model. Let us sketch the construction of the replicating strategy for a
given European option with reasonable payoff proÔ¨Åle f (ST ), for example a call option

272
5 Dynamic arbitrage theory
with strike K. At time t the price of the asset is St(œâ), the remaining time to maturity
is T ‚àít, and the discounted price of the option is given by
Vt(œâ) = e‚àírtu(St(œâ), T ‚àít),
where u is the function deÔ¨Åned in Proposition 5.62. The process V = (Vt)0‚â§t‚â§T can
be viewed as the value process of the trading strategy Œæ = (Œæ0, Œæ) deÔ¨Åned by
Œæt = (St, T ‚àít),
Œæ0
t = e‚àírtu(St, T ‚àít) ‚àíŒæt Xt,
(5.37)
where  = ‚àÇu/‚àÇx is the option‚Äôs Delta. Indeed, if we view Œæ as the number of shares
in the risky asset S and Œæ0 as the number of shares in the riskfree savings account
S0
t = ert, then the value of the resulting portfolio in units of the num√©raire is given by
Vt = Œæt ¬∑ Xt + Œæ0
t = e‚àírt(Œæt ¬∑ St + Œæ0
t ¬∑ S0
t ).
The strategy replicates the option since
VT := lim
t‚ÜëT e‚àírtu(St, T ‚àít) = e‚àírT f (ST ) = f (ST )
S0
T
,
due to Proposition 5.62. Moreover, its initial cost is given by the Black‚ÄìScholes price
V0 = u(S0, T ) = e‚àírT E[ f (ST ) ] = e‚àírT
‚àö
2œÄ
 ‚àû
‚àí‚àû
f

xeœÉ
‚àö
T y+rT ‚àíœÉ 2T/2
e‚àíy2/2 dy.
It remains to show that the strategy is self-Ô¨Ånancing in the sense that changes in
the portfolio value are only due to price changes in the underlying assets and do not
require any additional capital. To this end, we use It√¥‚Äôs formula
dF(Wt, t) = ‚àÇF
‚àÇx (Wt, t) dWt +
	1
2
‚àÇ2F
‚àÇx2 + ‚àÇF
‚àÇt

(Wt, t) dt
for a smooth function F, see, e.g., [129] or, for a strictly pathwise approach, [87].
Applied to the function F(x, t) = exp(œÉx + rt ‚àíœÉ 2t/2), it shows that the price
process S satisÔ¨Åes the stochastic differential equation
dSt = œÉSt dWt + rSt dt.
(5.38)
Thus, the inÔ¨Ånitesimal return dSt/St is the sum of the safe return r dt and an additional
noise term with zero expectation under P ‚àó. The strength of the noise is measured by
the volatility parameter œÉ. Similarly, we obtain
dXt = œÉXt dWt = e‚àírt(dSt ‚àírSt dt).
(5.39)
Applying It√¥‚Äôs formula to the function
F(x, t) = e‚àírtu

exp(x + rt ‚àíœÉ 2t/2), T ‚àít


5.7 Convergence to the Black‚ÄìScholes price
273
and using (5.38), we obtain
dVt = e‚àírt ‚àÇu
‚àÇx (St, t) dSt + e‚àírt	1
2œÉ 2S2
t
‚àÇ2u
‚àÇx2 ‚àí‚àÇu
‚àÇt ‚àíru

(St, t) dt.
The Black‚ÄìScholes partial differential equation (5.33) shows that the term in paren-
thesis is equal to ‚àírSt‚àÇu/‚àÇx, and we obtain from (5.39) that
dVt = ‚àÇu
‚àÇx (St, t) dXt = Œæt dXt.
More precisely,
Vt = V0 +
 t
0
Œæs dXs,
where the integral with respect to X is deÔ¨Åned as an It√¥ integral, i.e., as the limit of
non-anticipating Riemann sums

ti‚ààDn, ti‚â§t
Œæti(Xti+1 ‚àíXti)
along an increasing sequence (Dn) of partitions of the interval [0, T ]; see, e.g., [87].
Thus, the It√¥ integral can be interpreted in Ô¨Ånancial terms as the cumulative net gain
generatedbydynamichedginginthediscountedriskyassetasdescribedbythehedging
strategy Œæ. This fact is an analogue of property (c) in Proposition 5.7, and in this sense
Œæ = (Œæ0, Œæ) is a self-Ô¨Ånancing trading strategy in continuous time. Similarly, we obtain
the following continuous-time analogue of (5.5), which describes the undiscounted
value of the portfolio as a result of dynamic trading both in the undiscounted risky
asset and the riskfree asset:
ertVt = V0 +
 t
0
Œæs dSs +
 t
0
Œæ0
s dS0
s .
Perfect replication also works for exotic options C(S) deÔ¨Åned by reasonable func-
tionals C on the path space C[0, T ], due to a general representation theorem for such
functionals as It√¥ integrals of the underlying Brownian motion W or, via (5.39), of
the process X. Weak convergence on path space implies, in analogy to Proposition
5.62, that the arbitrage-free prices of the options C(S(N)), computed as discounted
expectations under the measure P ‚àó
N, converge to the discounted expectation
e‚àírT E[ C(S) ]
under the Wiener measure P.
On the other hand, the discussion in Section 5.6 suggests that the prices of certain
exotic contingent claims, such as barrier options, can be computed in closed form as
the Black‚ÄìScholes price for some corresponding payoff proÔ¨Åle of the form f (ST ).
This is illustrated by the following example, where the price of an up-and-in call is
computed in terms of the distribution of the terminal stock price under the equivalent
martingale measure.

274
5 Dynamic arbitrage theory
Example 5.63 (Black‚ÄìScholes price of an up-and-in call option). Consider an up-
and-in call option
Ccall
u&i(S) =
Ô£±
Ô£≤
Ô£≥
(ST ‚àíK)+
if max
0‚â§t‚â§T St ‚â•B,
0
otherwise,
where B > S0 ‚à®K denotes a given barrier, and where K > 0 is the strike price. As
approximating models we choose the CRR models of Example 5.55. That is, we have
interest rates
rN = r T
N
and parameters aN and bN deÔ¨Åned by
ÀÜaN = 1 + aN = e‚àíœÉ‚àöT /N
and
ÀÜbN = 1 + bN = eœÉ‚àöT/N
for some given œÉ > 0. Applying the formula obtained in Example 5.50 yields
E‚àó
N

Ccall
u&i(S(N))

= E‚àó
N

(S(N)
N
‚àíK)+; S(N)
N
‚â•B

+
	
p‚àó
N
1 ‚àíp‚àó
N

kN 	BN
S0

2
E‚àó
N

(S(N)
N
‚àí
KN)+; S(N)
N
< B

,
where BN and 
KN are given by

KN = K ÀÜb‚àí2kN
N
= K
	 S0
BN

2
,
and where
kN =
" ‚àö
N
œÉ
‚àö
T
log B
S0
#
is the smallest integer k such that B ‚â§S0 ÀÜbk
N. Then we have
BN ‚ÜòB
and

KN ‚Üó
K = K
	S0
B

2
.
Since f (x) = (x ‚àíK)+I{x‚â•B} is continuous a.e., we obtain
E‚àó
N

(S(N)
N
‚àíK)+; S(N)
T
‚â•B

‚àí‚ÜíE

(ST ‚àíK)+; ST ‚â•B

,
due to Proposition 5.59. Combining the preceding argument with the fact that
P ‚àó
N[ 
KN ‚â§S(N)
N
‚â§
K ] ‚àí‚Üí0

5.7 Convergence to the Black‚ÄìScholes price
275
also gives the convergence of the second expectation:
E‚àó
N

(S(N)
N
‚àí
KN)+; S(N)
N
< B

‚àí‚ÜíE

(ST ‚àí
K)+; ST < B

.
Next we note that for constants c, d > 0
lim
x‚Üì0
1
x log cx2 + 1 ‚àíe‚àídx
edx ‚àí1 ‚àícx2 = 2c
d ‚àíd,
due to l‚ÄôH√¥pital‚Äôs rule. From this fact, one deduces that
	
p‚àó
N
1 ‚àíp‚àó
N

kN ‚àí‚Üí
	 B
S0

 2r
œÉ2 ‚àí1
.
Thus, we may conclude that the arbitrage-free prices
1
(1 + rN)N E‚àó
N

Ccall
u&i(S(N))

in the Nth approximating model converge to
e‚àírT

E

(ST ‚àí
K)+; ST < B

+
	 B
S0

 2r
œÉ2 +1
E

(ST ‚àí
K)+; ST < B

.
The expectations occurring in this formula are integrals with respect to a log-normal
distribution and can be explicitly computed as in Example 5.57. Moreover, our limit
is in fact equal to the Black‚ÄìScholes price of the up-and-in call option: The functional
Ccall
u&i( ¬∑ ) is continuous in each path in C[0, T ] whose maximum is different from
the value B, and one can show that these paths have full measure for the law of S
under P. Hence, Ccall
u&i( ¬∑ ) is continuous P ‚ó¶S‚àí1-a.e., and the functional version of
Proposition 5.59 yields
E‚àó
N

Ccall
u&i(S(N))

‚àí‚ÜíE

Ccall
u&i(S)

,
so that our limiting price must coincide with the discounted expectation on the right. ‚ô¶
Remark 5.64. Let us assume, more generally, that the price process S is deÔ¨Åned by
St = S0eœÉWt+Œ±t,
0 ‚â§t ‚â§T,
for some Œ± ‚ààR. Applying It√¥‚Äôs formula as in (5.38), we see that S is governed by the
stochastic differential equation
dSt = œÉSt dWt + bSt dt
with b = Œ± + 1
2œÉ 2. The discounted price process is given by
Xt = S0eœÉWt+(Œ±‚àír)t = S0eœÉW ‚àó
t ‚àíœÉ 2t/2

276
5 Dynamic arbitrage theory
with W ‚àó
t = Wt + Œªt for Œª = (b ‚àír)/œÉ. The process W ‚àóis a Wiener process under
the measure P ‚àó‚âàP deÔ¨Åned by the density
dP ‚àó
dP = e‚àíŒªWT ‚àíŒª2T/2.
In fact, P ‚àóis the unique equivalent martingale measure for X. We can now repeat the
arguments above to conclude that the cost of perfect replication for a contingent claim
C(S) is given by
e‚àírT E‚àó[ C(S) ].
‚ô¶
EveninthecontextofsimplediffusionmodelssuchasgeometricBrownianmotion,
however, completeness is lost as soon as the future behavior of the volatility parameter
œÉ is unknown. If, for instance, volatility itself is modeled as a stochastic process, we
are facing incompleteness. Thus, the problems of pricing and hedging in discrete-
time incomplete markets as discussed in this book reappear in continuous time. Other
versions of the invariance principle may lead to other classes of continuous-time
models with discontinuous paths, for instance to geometric Poisson or L√©vy processes.
Discontinuity of paths is another important source of incompleteness. In fact, this has
already been illustrated in this book, since discrete-time models can be regarded as
stochastic processes in continuous time, where jumps occur at predictable dates.

Chapter 6
American contingent claims
So far, we have studied European contingent claims whose payoff is due at a Ô¨Åxed
maturity date. In the case of American options, the buyer can claim the payoff at any
time up to the expiration of the contract.
First, we take the point of view of the seller, whose aim is to hedge against all pos-
sible claims of the buyer. In Section 6.1, this problem is solved under the assumption
of market completeness, using the Snell envelope of the contingent claim. The buyer
tries to choose the best date for exercising the claim, contingent on the information
available up to that time. Since future prices are usually unknown, a formulation of
this problem will typically involve subjective preferences. If preferences are expressed
in terms of expected utility, the choice of the best exercise date amounts to solving
an optimal stopping problem. In the special case of a complete market model, any
exercise strategy which maximizes the expected payoff under the unique equivalent
martingale measure turns out to be optimal even in an almost sure sense.
In Section 6.3, we characterize the set of all arbitrage-free prices of an American
contingent claim in an incomplete market model. This involves a lower Snell envelope
of the claim, which is analyzed in Section 6.5, using the fact that the class of equivalent
martingale measures is stable under pasting. This notion of stability under pasting
is discussed in Section 6.4 in a general context, and in Section 6.5 we explain its
connection with the time-consistency of dynamic risk measures. The results on lower
Snell envelopes can also be regarded as a solution to the buyer‚Äôs optimal stopping
problem in the case where preferences are described by robust Savage functionals.
Moreover, these results will be used in the theory of superhedging of Chapter 7.
6.1 Hedging strategies for the seller
We start this section by introducing the Doob decomposition of an adapted process
and the notion of a supermartingale.
Proposition 6.1. Let Q be a probability measure on (, FT ), and suppose that Y
is an adapted process such that Yt ‚ààL1(Q) for all t. Then there exists a unique
decomposition
Y = M ‚àíA,
(6.1)
where M is a Q-martingale and A is a process such that A0 = 0 and (At)t=1,...,T
is predictable. The decomposition (6.1) is called the Doob decomposition of Y with
respect to the probability measure Q.

278
6 American contingent claims
Proof. DeÔ¨Åne A by
At ‚àíAt‚àí1 := ‚àíEQ[ Yt ‚àíYt‚àí1 | Ft‚àí1 ]
for t = 1, . . . , T .
(6.2)
Then A is predictable and Mt := Yt + At is a Q-martingale. Clearly, any process A
with the required properties must satisfy (6.2), so the uniqueness of the decomposition
follows.
DeÔ¨Ånition 6.2. Let Q be a probability measure on (, FT ) and suppose that Y is an
adapted process such that Yt ‚ààL1(Q) for all t. Denote by Y = M ‚àíA the Doob
decomposition of Y.
(a) Y is called a Q-supermartingale if A is increasing.
(b) Y is called a Q-submartingale if A is decreasing.
Clearly, a process is a martingale if and only if it is both a supermartingale and a
submartingale, i.e., if and only if A ‚â°0. The following result gives equivalent char-
acterizations of the supermartingale property of a process Y. Its proof is elementary
and left to the reader.
Proposition 6.3. Let Y be an adapted process with Yt ‚ààL1(Q) for all t. Then the
following conditions are equivalent:
(a) Y is a Q-supermartingale.
(b) Ys ‚â•EQ[ Yt | Fs ] for 0 ‚â§s ‚â§t ‚â§T .
(c) Yt‚àí1 ‚â•EQ[ Yt | Ft‚àí1 ] for t = 1, . . . , T .
(d) ‚àíY is a Q-submartingale.
We now return to the market model introduced in Section 5.1. AnAmerican option,
or American contingent claim, corresponds to a contract which is issued at time 0 and
which obliges the seller to pay a certain amount CœÑ ‚â•0 if the buyer decides at time
œÑ to exercise the option. The choice of the exercise time œÑ is entirely up to the buyer,
except that the claim is automatically exercised at the ‚Äúexpiration date‚Äù of the claim.
TheAmerican contingent claim can be exercised only once: It becomes invalid as soon
as the payoff has been claimed by the buyer. This concept is formalized as follows:
DeÔ¨Ånition 6.4. An American contingent claim is a non-negative adapted process
C = (Ct)t=0,...,T on the Ô¨Åltered space (, (Ft)t=0,...,T ).
For each t, the random variable Ct is interpreted as the payoff of the American
contingent claim if the claim is exercised at time t. The time horizon T plays the role
of the expiration date of the claim. The possible exercise times for C are not limited to
Ô¨Åxed deterministic times t ‚àà{ 0. . . . , T }; the buyer may exercise the claim in a way
which depends on the scenario œâ ‚àà of the market evolution.

6.1 Hedging strategies for the seller
279
DeÔ¨Ånition 6.5. An exercise strategy for an American contingent claim C is an
FT -measurable random variable œÑ taking values in { 0, . . . , T }. The payoff obtained
by using œÑ is equal to
CœÑ(œâ) := CœÑ(œâ)(œâ),
œâ ‚àà.
Example 6.6. An American put option on the ith asset and with strike K > 0 pays
the amount
Cput
t
:= (K ‚àíSi
t )+
if it is exercised at time t. The payoff at time t of the corresponding American call
option is given by
Ccall
t
:= (Si
t ‚àíK)+.
Clearly, the American call option is ‚Äúout of the money‚Äù (i.e., has zero payoff) if
the corresponding American put is ‚Äúin the money‚Äù (i.e., has non-zero payoff). It
is therefore a priori clear that the respective owners of Cput and Ccall will usually
exercise their claims at different times. In particular, there will be no put-call parity
for American options.
‚ô¶
Similarly, one deÔ¨Ånes American versions of most options mentioned in the exam-
ples of Section 5.3. Clearly, the value of an American option is at least as high as the
value of the corresponding European option with maturity T .
Remark 6.7. It should be emphasized that the concept ofAmerican contingent claims
can be regarded as a generalization of European contingent claims: If CE is a European
contingent claim, then we can deÔ¨Åne a corresponding American claim CA by
CA
t =

0
if t < T ,
CE
if t = T .
(6.3)
‚ô¶
Example 6.8. A Bermuda option can be exercised by its buyer at each time of a
predetermined subset T ‚äÇ{0, . . . , T }. For instance, a Bermuda call option pays the
amount (Si
t ‚àíK)+ if it is exercised at some time t ‚ààT. Thus, a Bermuda option
is a Ô¨Ånancial instrument ‚Äúbetween‚Äù an American option with T = {0, . . . , T } and a
European option with T = {T }, just as Bermuda lies between America and Europe;
hence the name ‚ÄúBermuda option‚Äù. A Bermuda option can be regarded as a particular
American option C that pays the amount Ct = 0 for t /‚ààT.
‚ô¶
The process
Ht = Ct
S0t
,
t = 0, . . . , T,
of discounted payoffs of C will be called the discounted American claim associated
with C. As far as the mathematical theory is concerned, the discounted American
claim H will be the primary object. For certain examples it will be helpful to keep
track of the num√©raire and, thus, of the payoffs Ct prior to discounting.

280
6 American contingent claims
Inthissection, wewillanalyzethetheoryofhedgingAmericanclaimsinacomplete
market model. We will therefore assume throughout this section that the set P of
equivalent martingale measures consists of one single element P ‚àó:
P = { P ‚àó}.
Under this assumption, we will construct a suitable trading strategy that permits the
seller of an American claim to hedge against the buyer‚Äôs discounted claim HœÑ. Let us
Ô¨Årst try to characterize the minimal amount of capital Ut which will be needed at time
t ‚àà{0, . . . , T }. Since the choice of the exercise time œÑ is entirely up to the buyer, the
seller must be prepared to pay at any time t the current payoff Ht of the option. This
amounts to the condition Ut ‚â•Ht. Moreover, the amount Ut must sufÔ¨Åce to cover
the purchase of the hedging portfolio for the possible payoffs Hu for u > t. Since the
latter condition is void at maturity, we require
UT = HT .
At time T ‚àí1, our Ô¨Årst requirement on UT ‚àí1 reads UT ‚àí1 ‚â•HT ‚àí1. The second
requirement states that the amount UT ‚àí1 must sufÔ¨Åce for hedging the claim HT in
case the option is not exercised before time T . Due to our assumption of market
completeness, the latter amount equals
E‚àó[ HT | FT ‚àí1 ] = E‚àó[ UT | FT ‚àí1 ].
Thus,
UT ‚àí1 := HT ‚àí1 ‚à®E‚àó[ UT | FT ‚àí1 ]
is the minimal amount that fulÔ¨Ålls both requirements. Iterating this argument leads to
the following recursive scheme for Ut:
UT := HT ,
Ut := Ht ‚à®E‚àó[ Ut+1 | Ft ]
for t = T ‚àí1, . . . , 0.
(6.4)
DeÔ¨Ånition 6.9. The process UP ‚àó:= U deÔ¨Åned by the recursion (6.4) is called the
Snell envelope of the process H with respect to the measure P ‚àó.
Example 6.10. Let H E be a discounted European claim. Then the Snell envelope
with respect to P ‚àóof the discountedAmerican claim H A associated with H E via (6.3)
satisÔ¨Åes
UP ‚àó
t
= E‚àó[ H A
T | Ft ] = E‚àó[ H E | Ft ].
Thus, U is equal to the value process of a replicating strategy for H E.
‚ô¶
Clearly, a Snell envelope UQ can be deÔ¨Åned for any probability measure Q on
(, FT ) and for any adapted process H that satisÔ¨Åes the following integrability con-
dition:
Ht ‚ààL1(Q)
for t = 0, . . . , T .
(6.5)

6.1 Hedging strategies for the seller
281
In our Ô¨Ånite-time setting, this condition is equivalent to
EQ

max
t‚â§T |Ht|

< ‚àû.
For later applications, the following proposition is stated for a general measure Q.
Proposition 6.11. Let H be an adapted process such that (6.5) holds. Then the Snell
envelope UQ of H with respect to Q is the smallest Q-supermartingale dominating H:
If 
U is another Q-supermartingale such that 
Ut ‚â•Ht Q-a.s. for all t, then 
Ut ‚â•UQ
t
Q-a.s. for all t.
Proof. It follows immediately from the deÔ¨Ånition of UQ that UQ
t‚àí1 ‚â•EQ[ UQ
t
| Ft‚àí1 ]
so that UQ is indeed a supermartingale. If 
U is another supermartingale dominating
H, then 
UT ‚â•HT = UQ
T . We now proceed by backward induction on t. If we already
know that 
Ut ‚â•UQ
t , then

Ut‚àí1 ‚â•EQ[ 
Ut | Ft‚àí1 ] ‚â•EQ[ UQ
t
| Ft‚àí1 ].
Adding our assumption 
Ut‚àí1 ‚â•Ht‚àí1 yields that

Ut‚àí1 ‚â•Ht‚àí1 ‚à®EQ[ UQ
t
| Ft‚àí1 ] = UQ
t‚àí1,
and the result follows.
Proposition 6.11 illustrates how the seller can (super-) hedge a discounted Amer-
ican claim H by using the Doob decomposition
UP ‚àó
t
= Mt ‚àíAt,
t = 0, . . . , T,
of the Snell envelope UP ‚àówith respect to P ‚àó. Then M is a P ‚àó-martingale, A is
increasing, and (At)t=1,...,T is predictable. Since we assume the completeness of the
market model, Theorem 5.39 yields the representation of the martingale M as the
‚Äústochastic integral‚Äù of a suitable d-dimensional predictable process Œæ:
Mt = UP ‚àó
0
+
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1),
t = 0, . . . , T.
(6.6)
It follows that
Mt ‚â•UP ‚àó
t
‚â•Ht
for all t.
By adding a num√©raire component Œæ0 such that Œæ = (Œæ0, Œæ) becomes a self-Ô¨Ånancing
trading strategy with initial investment UP ‚àó
0 , we obtain a (super-) hedge for H, namely
a self-Ô¨Ånancing trading strategy whose value process V satisÔ¨Åes
Vt ‚â•Ht
for all t.
(6.7)

282
6 American contingent claims
Thus, UP ‚àó
t
may be viewed as the resulting capital at each time t if we use the self-
Ô¨Ånancing strategy Œæ, combined with a refunding scheme where we withdraw suc-
cessively the amounts deÔ¨Åned by the increments of A. In fact, UP ‚àó
t
is the minimal
investment at time t for which one can purchase a hedging strategy such that (6.7)
holds. This follows from our next result.
Theorem 6.12. Let H be a discountedAmerican claim with Snell envelope UP ‚àó. Then
there exists a d-dimensional predictable process Œæ such that
UP ‚àó
t
+
u

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•Hu
for all u ‚â•t.
(6.8)
Moreover, any Ft-measurable random variable 
Ut which, for some predictable Œæ,
satisÔ¨Åes (6.8) in place of UP ‚àó
t
is such that

Ut ‚â•UP ‚àó
t
P ‚àó-a.s.
Thus, UP ‚àó
t
is the minimal amount of capital which is necessary to hedge H from time t
up to maturity.
Proof. Clearly, UP ‚àósatisÔ¨Åes (6.8) for Œæ as in (6.6). Now suppose that 
Ut is Ft-
measurable, thatŒæ is predictable, and that
Vu := 
Ut +
u

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•Hu
for all u ‚â•t.
We show Vu ‚â•UP ‚àó
u
for all u ‚â•t by backward induction. VT ‚â•HT = UP ‚àó
T
holds
by assumption, so assume Vu+1 ‚â•UP ‚àó
u+1 for some u. Since our market model is
complete, Theorem 5.38 implies thatŒæ is bounded. Hence, we get
E‚àó[ Vu+1 ‚àíVu | Fu ] = E‚àó[Œæu+1 ¬∑ (Xu+1 ‚àíXu) | Fu ] = 0
P -a.s.
It follows that
Vu = E‚àó[ Vu+1 | Fu ] ‚â•Hu ‚à®E‚àó[ UP ‚àó
u+1 | Fu ] = UP ‚àó
u .
6.2 Stopping strategies for the buyer
In this section, we take the point of view of the buyer of an American contingent
claim. Thus, our aim is to optimize the exercise strategy. It is natural to assume that
the decision to exercise the claim at a particular time t depends only on the market
information which is available at t. This constraint can be formulated as follows:

6.2 Stopping strategies for the buyer
283
DeÔ¨Ånition 6.13. A function œÑ :  ‚Üí{ 0, 1, . . . , T } ‚à™{ +‚àû} is called a stopping
time if { œÑ = t } ‚ààFt for t = 0, . . . , T .
Inparticular, theconstantfunctionœÑ ‚â°t isastoppingtimeforÔ¨Åxedt ‚àà{0, . . . , T }.
Remark 6.14. A function œÑ :  ‚Üí{ 0, 1, . . . , T } ‚à™{ +‚àû} is a stopping time if and
only if { œÑ ‚â§t } ‚ààFt for each t. Moreover, if œÑ and œÉ are two stopping times, then
the following functions are also stopping times:
œÑ ‚àßœÉ,
œÑ ‚à®œÉ,
(œÑ + œÉ) ‚àßT.
The proof is easy and left to the reader.
‚ô¶
Example 6.15. A typical example of a non-trivial stopping time is the Ô¨Årst time at
which an adapted process Y exceeds a certain level c:
œÑ(œâ) := inf{ t ‚â•0 | Yt(œâ) ‚â•c }.
In fact,
{œÑ ‚â§t} =
t
s=0
{Ys ‚â•c} ‚ààFt
for t = 0, . . . , T . This example also illustrates the role of the value +‚àûin DeÔ¨Åni-
tion 6.13: We have œÑ(œâ) = +‚àûif, for this particular œâ, the criterion that triggers œÑ
is not met for any t ‚àà{ 0, . . . , T }.
‚ô¶
DeÔ¨Ånition 6.16. For any stochastic process Y and each stopping time œÑ we denote by
Y œÑ the process stopped in œÑ:
Y œÑ
t (œâ) := Yt‚àßœÑ(œâ)(œâ)
for œâ ‚àà and for all t ‚àà{0, . . . , T }.
It follows from the deÔ¨Ånition of a stopping time that Y œÑ is an adapted process if Y
is. Informally, the following basic theorem states that a martingale cannot be turned
into a favorable game by using a clever stopping strategy. This result is often called
Doob‚Äôs stopping theorem or the optional sampling theorem. Recall that we assume
F0 = {‚àÖ, }.
Theorem 6.17. Let M be an adapted process such that Mt ‚ààL1(Q) for each t. Then
the following conditions are equivalent:
(a) M is a Q-martingale.
(b) For any stopping time œÑ the stopped process MœÑ is a Q-martingale.
(c) EQ[ MœÑ‚àßT ] = M0 for any stopping time œÑ.

284
6 American contingent claims
Proof. (a) ‚áí(b): Note that
MœÑ
t+1 ‚àíMœÑ
t = (Mt+1 ‚àíMt) I{œÑ>t}.
Since {œÑ > t} ‚ààFt, we obtain that
EQ[ MœÑ
t+1 ‚àíMœÑ
t | Ft ] = EQ[ Mt+1 ‚àíMt | Ft ] ¬∑ I{œÑ>t} = 0.
(b) ‚áí(c): This follows simply from the fact that the expectation of MœÑ
t is constant
in t.
(c) ‚áí(a): We need to show that if t < T , then
EQ[ MT ; A ] = EQ[ Mt; A ]
(6.9)
for each A ‚ààFt. Fix such an A and deÔ¨Åne a stopping time œÑ as
œÑ(œâ) :=

t
if œâ ‚ààA,
T
if œâ /‚ààA.
We obtain that
M0 = EQ[ MT ‚àßœÑ ] = EQ[ Mt; A ] + EQ[ MT ; Ac ].
Using the constant stopping time T instead of œÑ yields that
M0 = EQ[ MT ] = EQ[ MT ; A ] + EQ[ MT ; Ac ].
Subtracting the latter identity from the previous one yields (6.9).
Corollary 6.18. Let U be an adapted process such that Ut ‚ààL1(Q) for each t. Then
the following conditions are equivalent:
(a) U is a Q-supermartingale.
(b) For any stopping time œÑ, the stopped process UœÑ is a Q-supermartingale.
Proof. If U = M ‚àíA is the Doob decomposition of U, then one checks that
UœÑ = MœÑ ‚àíAœÑ
(6.10)
is the Doob decomposition of UœÑ. This observation and Theorem 6.17 yield the
equivalence of (a) and (b).
Let us return to the problem of Ô¨Ånding an optimal exercise time œÑ for a discounted
American claim H. We assume that the buyer chooses the possible exercise times
from the set
T :=

œÑ | œÑ is a stopping time with œÑ ‚â§T


6.2 Stopping strategies for the buyer
285
of all stopping times which do not take the value +‚àû. Assume that the aim of the
buyer is to choose a payoff from the class { HœÑ | œÑ ‚ààT } which is optimal in the sense
that it has maximal expectation. Thus, the problem is:
Maximize E[ HœÑ ] among all œÑ ‚ààT .
(6.11)
The analysis of the optimal stopping problem (6.11) does not require any properties
of the underlying market model, not even the absence of arbitrage. We may also drop
the positivity assumption on H: All we have to assume is that H is an adapted process
which satisÔ¨Åes
Ht ‚ààL1(, Ft, P)
for all t.
(6.12)
This relaxed assumption will be useful in Chapter 9, and it allows us to include
the interpretation of the optimal stopping problem in terms of the following utility
maximization problem:
Remark 6.19. Suppose the buyer uses a preference relation on X := { HœÑ | œÑ ‚ààT }
which can be represented in terms of a Savage representation
U(HœÑ) = EQ[ u(HœÑ) ]
where Q is a probability measure on (, F ), and u is a measurable or continuous
function; see Section 2.5. Then a natural goal is to maximize the utility U(HœÑ)
among all œÑ ‚ààT . This is equivalent to the optimal stopping problem (6.11) for the
transformed process 
Ht := u(Ht), and with respect to the measure Q instead of P .
This utility maximization problem is covered by the discussion in this section as long
as 
Ht ‚ààL1(Q) for all t. In Remark 6.51 we will discuss the problem of maximizing
the more general utility functionals which appear in a robust Savage representation.
‚ô¶
Under the assumption (6.12), we can construct the Snell envelope U := UP of H
with respect to P , i.e., U is deÔ¨Åned via the recursive formula
UT := HT
and
Ut := Ht ‚à®E[ Ut+1 | Ft ],
t = T ‚àí1, . . . , 0.
Let us deÔ¨Åne a stopping time œÑmin by
œÑmin := min{ t ‚â•0 | Ut = Ht }.
Note that œÑmin ‚â§T since UT = HT . As we will see in the following theorem, œÑmin
maximizes the expectation of HœÑ among all œÑ ‚ààT . In other words, œÑmin is a solution
to our optimal stopping problem (6.11). Similarly, we let
œÑ (t)
min := min{ u ‚â•t | Uu = Hu},
which is a member of the set
Tt := { œÑ ‚ààT | œÑ ‚â•t }.

286
6 American contingent claims
Theorem 6.20. The Snell envelope U of H satisÔ¨Åes
Ut = E[ HœÑ (t)
min | Ft ] = ess sup
œÑ‚ààTt
E[ HœÑ | Ft ].
In particular,
U0 = E[ HœÑmin ] = sup
œÑ‚ààT
E[ HœÑ ].
Proof. Since U is a supermartingale under P , Corollary 6.18 shows that for œÑ ‚ààTt
Ut ‚â•E[ UœÑ | Ft ] ‚â•E[ HœÑ | Ft ].
Therefore,
Ut ‚â•ess sup
œÑ‚ààTt
E[ HœÑ | Ft ].
Hence, the theorem will be proved if we can show that Ut = E[ HœÑ (t)
min | Ft ], which is
in turn implied by the identity
Ut = E[ UœÑ (t)
min | Ft ].
(6.13)
In order to prove (6.13), let U(t) denote the stopped process
U(t)
s
:= Us‚àßœÑ (t)
min,
and Ô¨Åx some s between t and T . Then Us > Hs on {œÑ (t)
min > s}. Hence, P -a.s. on
{œÑ (t)
min > s}:
U(t)
s
= Us = Hs ‚à®E[ Us+1 | Fs ] = E[ Us+1 | Fs ] = E[ U(t)
s+1 | Fs ].
On the set {œÑ (t)
min ‚â§s} one has U(t)
s+1 = UœÑ (t)
min = U(t)
s , hence U(t)
s
= E[ U(t)
s+1 | Fs ].
Thus, U(t) is a martingale from time t on:
U(t)
s
= E[ U(t)
s+1 | Fs ]
for all s ‚àà{t, t + 1, . . . , T }.
It follows that
E[ UœÑ (t)
min | Ft ] = E[ U(t)
T
| Ft ] = U(t)
t
= Ut.
This proves the claim (6.13).
DeÔ¨Ånition 6.21. A stopping time œÑ ‚àó‚ààT is called optimal (with respect to P ) if
E[ HœÑ ‚àó] = sup
œÑ‚ààT
E[ HœÑ ].

6.2 Stopping strategies for the buyer
287
In particular, œÑmin is an optimal stopping time in the sense of this deÔ¨Ånition. The
following result implies that œÑmin is in fact the minimal optimal stopping time.
Proposition 6.22. A stopping time œÑ ‚ààT is optimal if and only if HœÑ = UœÑ P -a.s.,
and if the stopped process UœÑ is a martingale. In particular, any optimal stopping
time œÑ satisÔ¨Åes œÑ ‚â•œÑmin.
Proof. First note that œÑ ‚ààT is optimal if it satisÔ¨Åes the two conditions of the assertion,
because then Theorem 6.20 implies that
sup
œÉ‚ààT
E[ HœÉ ] = U0 = E[ UœÑ
T ] = E[ UœÑ ] = E[ HœÑ ].
For the converse implication, we apply the assumption of optimality, the fact that
HœÑ ‚â§UœÑ, and the stopping theorem for supermartingales to obtain that
U0 = E[ HœÑ ] ‚â§E[ UœÑ ] ‚â§U0,
so that all inequalities are in fact equalities. It follows in particular that HœÑ = UœÑ
P -almost surely. Moreover, the identity E[ UœÑ ] = U0 implies that the stopped process
UœÑ is a supermartingale with constant expectation U0, and hence is a martingale.
In general, there can be many different optimal stopping times. The largest optimal
stopping time admits an explicit description: It is the Ô¨Årst time before T for which the
Snell envelope U loses the martingale property:
œÑmax := inf

t ‚â•0 | E[ Ut+1 ‚àíUt | Ft ] Ã∏= 0

‚àßT
= inf{ t ‚â•0 | At+1 Ã∏= 0} ‚àßT.
Here, A denotes the increasing process obtained from the Doob decomposition of U
under P .
Theorem 6.23. The stopping time œÑmax is the largest optimal stopping time. Moreover,
a stopping time œÑ is optimal if and only if P -a.s. œÑ ‚â§œÑmax and UœÑ = HœÑ.
Proof. Let U = M ‚àíA be the Doob decomposition of U. Recall from (6.10) that
UœÑ = MœÑ ‚àíAœÑ is the Doob decomposition of UœÑ for any stopping time œÑ. Thus, UœÑ
is a martingale if and only if AœÑ = 0, because A is increasing. Therefore, UœÑ is a
martingale if and only if œÑ ‚â§œÑmax, and so the second part of the assertion follows from
Proposition 6.22. It remains to prove that œÑmax itself is optimal, i.e., that UœÑmax = HœÑmax.
This is clear on the set { œÑmax = T }. On the set { œÑmax = t } for t < T one has At = 0
and At+1 > 0. Hence,
E[ Ut+1 ‚àíUt | Ft ] = ‚àí(At+1 ‚àíAt) = ‚àíAt+1 < 0
on { œÑmax = t }.
Thus, Ut > E[ Ut+1 | Ft ] and the deÔ¨Ånition of the Snell envelope yields that Ut =
Ht ‚à®E[ Ut+1 | Ft ] = Ht on { œÑmax = t }.

288
6 American contingent claims
Let us now return to our complete Ô¨Ånancial market model, where Ht is the dis-
counted payoff of an American contingent claim. Thus, an optimal stopping strategy
for H maximizes the expected payoff E[ HœÑ ]. But a stopping time turns out to be the
best choice even in a pathwise sense, provided that it is optimal with respect to the
unique equivalent martingale measure P ‚àóin a complete market model. In order to
explain this fact, let us Ô¨Årst recall from Section 6.1 the construction of a perfect hedge
of H from the seller‚Äôs perspective. Let
UP ‚àó= M ‚àíA
denote the Doob decomposition of the Snell envelope UP ‚àóof H with respect to P ‚àó.
Since P ‚àóis the unique equivalent martingale measure in our model, the martingale M
has the representation
Mt = UP ‚àó
0
+
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1),
t = 0, . . . , T,
for a d-dimensional predictable process Œæ. Clearly, M is equal to the value process of
the self-Ô¨Ånancing strategy constructed from Œæ and the initial investment UP ‚àó
0 . Since
M dominates H, this yields a perfect hedge of H from the perspective of the seller: If
the buyer exercises the option at some stopping time œÑ, then the seller makes a proÔ¨Åt
MœÑ ‚àíHœÑ ‚â•0. The following corollary states that the buyer can in fact meet the
value of the seller‚Äôs hedging portfolio, and that this happens if and only if the option
is exercised at an optimal stopping time with respect to P ‚àó. In this sense, UP ‚àó
0
can be
regarded as the unique arbitrage-free price of the discounted American claim H.
Corollary 6.24. With the above notation,
HœÑ ‚â§MœÑ = UP ‚àó
0
+
œÑ

k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1),
P ‚àó-a.s. for all œÑ ‚ààT ,
and equality holds P ‚àó-almost surely if and only if œÑ is optimal with respect to P ‚àó.
Proof. At time œÑ,
HœÑ ‚â§UP ‚àó
œÑ
= MœÑ ‚àíAœÑ ‚â§MœÑ.
Moreover, by Theorem 6.23, both HœÑ = UP ‚àó
œÑ
and AœÑ = 0 hold P ‚àó-a.s. if and only if
œÑ is optimal with respect to P ‚àó.
Let us now compare a discounted American claim H to the corresponding dis-
counted European claim HT , i.e., to the contract which is obtained from H by restrict-
ing the exercise time to be T . In particular, we are interested in the relation between
American and European put or call options. Let
Vt := E‚àó[ HT | Ft ]

6.2 Stopping strategies for the buyer
289
denote the amount needed at time t to hedge HT . Since our market model is complete,
Vt can also be regarded as the unique arbitrage-free price of the discounted claim HT
at time t. From the seller‚Äôs perspective, UP ‚àó
t
plays a similar role for the American
option. It is intuitively clear that anAmerican claim should be more expensive than the
corresponding European one. This is made mathematically precise in the following
statement.
Proposition 6.25. With the above notation, UP ‚àó
t
‚â•Vt for all t. Moreover, if V
dominates H, then UP ‚àóand V coincide.
Proof. The Ô¨Årst statement follows immediately from the supermartingale property of
UP ‚àó:
UP ‚àó
t
‚â•E‚àó[ UP ‚àó
T
| Ft ] = E‚àó[ HT | Ft ] = Vt.
Next, if the P ‚àó-martingale V dominates H, then it also dominates the corresponding
Snell envelope UP ‚àóby Proposition 6.11. Thus V and UP ‚àómust coincide.
Remark 6.26. The situation in which V dominates H occurs, in particular, when the
process H is a P ‚àó-submartingale. This happens, for instance, if H is obtained by
applying a convex function f : Rd ‚Üí[0, ‚àû) to the discounted price process X.
Indeed, in this case, Jensen‚Äôs inequality for conditional expectations implies that
E‚àó[ f (Xt+1) | Ft ] ‚â•f

E‚àó[ Xt+1 | Ft ]

= f (Xt).
‚ô¶
Example 6.27. The discounted payoff of an American call option Ccall
t
= (S1
t ‚àíK)+
is given by
H call
t
=

X1
t ‚àíK
S0t
+
.
Under the hypothesis that S0
t is increasing in t, (5.21) states that
E‚àó[ H call
t+1 | Ft ] ‚â•H call
t
P ‚àó-a.s. for t = 0, . . . , T ‚àí1.
In other words, H call is a submartingale, and the Snell envelope UP ‚àóof H call coincides
with the value process
Vt = E‚àó
 
X1
T ‚àíK
S0
T
+  Ft

of the corresponding European call option with maturity T . In particular, we have
UP ‚àó
0
= V0, i.e., the unique arbitrage-free price of the American call option is equal to
its European counterpart. Moreover, Theorem 6.23 implies that the maximal optimal
stopping time with respect to P ‚àóis given by œÑmax ‚â°T . This suggests that, in a
complete model, an American call should not be exercised before maturity.
‚ô¶

290
6 American contingent claims
Example 6.28. For an American put option Cput
t
:= (K ‚àíS1
t )+ the situation is differ-
ent, because the argument in (5.21) fails unless S0 is decreasing. If S0 is an increasing
bond, then the time value
Wt := S0
t E‚àó
 (K ‚àíS1
T )+
S0
T
 Ft

‚àí(K ‚àíS1
t )+
of a European put (K ‚àíS1
T )+ typically becomes negative at a certain time t, corre-
sponding to an early exercise premium ‚àíWt; see Figure 5.3. Thus, the early exercise
premium is the surplus which an owner of the American put option would have over
the value of the European put (K ‚àíS1
T )+.
The relation between the price of a put option and its intrinsic value can be illus-
trated in the context of the CRR model. With the notation of Section 5.5, the price
process of the risky asset St = S1
t can be written as
St = S0 t
for
t :=
t
k=1
(1 + Rk)
and with the constant S0 ‚â•0. Recall that the returns Rk can take only two possible
values a and b with ‚àí1 < a < b, and that the market model is arbitrage-free if and
only if the riskless interest rate r satisÔ¨Åes a < r < b. In this case, the model is
complete, and the unique equivalent martingale measure P ‚àóis characterized by the
fact that it makes R1, . . . , RT independent with common distribution
P ‚àó[ Rk = b ] = p‚àó= r ‚àía
b ‚àía .
(6.14)
Let
œÄ(x) := sup
œÑ‚ààT
E‚àó
 (K ‚àíxœÑ)+
(1 + r)œÑ

denote the price of Cput regarded as a function of x := S0. Clearly, œÄ(x) is a convex
and decreasing function in x. Let us assume that r > 0 and that the parameter a is
strictly negative. A trivial situation occurs if the option is ‚Äúfar out of the money‚Äù in
the sense that
x ‚â•
K
(1 + a)T ,
because then St = xt ‚â•K for all t, and the payoff of Cput is always zero. In
particular, œÄ(x) = 0. If
x ‚â§
K
(1 + b)T
(6.15)
then St = xt ‚â§K for all t, and hence
œÄ(x) = sup
œÑ‚ààT

E‚àó

K
(1 + r)œÑ

‚àíx

= K ‚àíx.

6.2 Stopping strategies for the buyer
291
In this case, the price of theAmerican put option is equal to its intrinsic value (K ‚àíx)+
at time t = 0, and an optimal strategy for the owner would simply consist in exercising
the option immediately, i.e., there is no demand for the option in the regime (6.15).
Now consider the case
K ‚â§x <
K
(1 + a)T
of a put option which is ‚Äúat the money‚Äù or ‚Äúnot too far out of the money‚Äù. For large
enough t > 0, the probability P ‚àó[ Cput
t
> 0 ] of a non-zero payoff is strictly positive,
while the intrinsic value (K ‚àíx)+ vanishes. It follows that the price œÄ(x) is strictly
higher than the intrinsic value, and so it is not optimal for the buyer to exercise the
option immediately.
Summarizing our observations, we can say that there exists a value x‚àówith
K
(1 + b)T < x‚àó‚â§K
such that
œÄ(x) = (K ‚àíx)+
for x ‚â§x‚àó,
œÄ(x) > (K ‚àíx)+
for x‚àó< x < K/(1 + a)T , and
œÄ(x) = 0
for x ‚â•K/(1 + a)T ;
see Figure 6.1.
‚ô¶
 
K
S0
Figure 6.1. The price of an American put option as a function of S0 compared to the option‚Äôs
intrinsic value (K ‚àíS0)+.
Remark 6.29. In the context of an arbitrage-free CRR model, we consider a dis-
counted American claim H whose payoff is determined by a function of time and of

292
6 American contingent claims
the current spot price, i.e.,
Ht = ht(St)
for all t.
Clearly, this setting includes American call and put options as special cases. By using
the same arguments as in the derivation of (5.25), we get that the Snell envelope UP ‚àó
of H is of the form
UP ‚àó
t
= ut(St),
t = 0, . . . , T,
where the functions ut are determined by the recursion
uT (x) = hT (x)
and
ut(x) = ht(x) ‚à®

ut+1(x ÀÜb ) p‚àó+ ut+1(x ÀÜa) (1 ‚àíp‚àó)

.
Here p‚àóis deÔ¨Åned as in (6.14), and the parameters ÀÜa and ÀÜb are given by ÀÜa = 1 + a and
ÀÜb = 1 + b. Thus, the space [0, T ] √ó [0, ‚àû) can be decomposed into the two regions
Rc := { (t, x) | ut(x) > ht(x) }
and
Rs := { (t, x) | ut(x) = ht(x) },
and the minimal optimal stopping time œÑmin can be described as the Ô¨Årst exit time of
the space time process (t, St) from the continuation region Rc or, equivalently, as the
Ô¨Årst entrance time into the stopping region Rs:
œÑmin = min{ t ‚â•0 | (t, St) /‚ààRc } = min{ t ‚â•0 | (t, St) ‚ààRs }.
‚ô¶
6.3 Arbitrage-free prices
In this section, we drop the condition of market completeness, and we develop the
notion of an arbitrage-free price œÄ for a discounted American claim H in a general
incomplete framework. The basic idea consists in reducing the problem to the deter-
mination of the arbitrage-free price for the payoff HœÑ which arises from H by Ô¨Åxing
the exercise strategy œÑ. The following remark explains that HœÑ can be treated like the
discounted payoff of a European contingent claim, whose set of arbitrage-free prices
is given by
(HœÑ) =

E‚àó[ HœÑ ] | P ‚àó‚ààP , E‚àó[ HœÑ ] < ‚àû

.
(6.16)
Remark 6.30. As observed in Remark 5.34, a discounted payoff 
Ht which is received
at time t < T can be regarded as a discounted European claim 
H E maturing at T .

H E is obtained from 
Ht by investing at time t the payoff S0
t 
Ht into the num√©raire,
i.e., by buying 
Ht shares of the 0th asset, and by considering the discounted terminal
value of this investment:

H E = 1
S0
T
( S0
T 
Ht ) = 
Ht.

6.3 Arbitrage-free prices
293
In the case of our discounted American claim H which is payed off at the random
time œÑ, we can either apply this argument to each payoff

Ht := HœÑ I{œÑ=t} = Ht I{œÑ=t},
or directly use a stopping time version of this argument. We conclude that HœÑ can
be regarded as a discounted European claim, whose arbitrage-free prices are given by
(6.16).
‚ô¶
Now suppose that H is offered at time t = 0 for a price œÄ ‚â•0. From the buyer‚Äôs
point of view there should be at least one exercise strategy œÑ such that the proposed
price œÄ is not too high in the sense that œÄ ‚â§œÄ‚Ä≤ for some œÄ‚Ä≤ ‚àà(HœÑ). From the seller‚Äôs
point of view the situation looks different: There should be no exercise strategy œÑ ‚Ä≤
such that the proposed price œÄ is too low in the sense that œÄ < œÄ‚Ä≤ for all œÄ‚Ä≤ ‚àà(HœÑ ‚Ä≤).
By adding the assumption that the buyer only uses stopping times in exercising the
option, we obtain the following formal deÔ¨Ånition.
DeÔ¨Ånition 6.31. A real number œÄ is called an arbitrage-free price of a discounted
American claim H if the following two conditions are satisÔ¨Åed.
‚Ä¢ The price œÄ is not too high in the sense that there exists some œÑ ‚ààT and
œÄ‚Ä≤ ‚àà(HœÑ) such that œÄ ‚â§œÄ‚Ä≤.
‚Ä¢ The price œÄ is not too low in the sense that there exists no œÑ ‚Ä≤ ‚ààT such that
œÄ < œÄ‚Ä≤ for all œÄ‚Ä≤ ‚àà(HœÑ ‚Ä≤).
The set of all arbitrage-free prices of H is denoted (H), and we deÔ¨Åne
œÄinf(H) := inf (H)
and
œÄsup(H) := sup (H).
Recall from Remark 6.7 that every discounted European claim H E can be regarded
as a discountedAmerican claim H A whose payoff is zero if H A is exercised before T ,
and whose payoff at T equals H E. Clearly, the two sets (H E) and (H A) coincide,
and so the two DeÔ¨Ånitions 5.29 and 6.31 are consistent with each other.
Remark 6.32. It follows from the deÔ¨Ånition that any arbitrage-free price œÄ for H
must be an arbitrage-free price for some HœÑ. Hence, (6.16) implies that œÄ = E‚àó[ HœÑ ]
for some P ‚àó‚ààP . Similarly, we obtain from the second condition in DeÔ¨Ånition 6.31
that œÄ ‚â•infP ‚àó‚ààP E‚àó[ HœÑ ] for all œÑ ‚ààT . It follows that
sup
œÑ‚ààT
inf
P ‚àó‚ààP
E‚àó[ HœÑ ] ‚â§œÄ ‚â§sup
œÑ‚ààT
sup
P ‚àó‚ààP
E‚àó[ HœÑ ]
for all œÄ ‚àà(H).
(6.17)
In particular,
sup
œÑ‚ààT
E‚àó[ HœÑ ]
is the unique arbitrage-free price of H if P ‚àóis the unique equivalent martingale
measure in a complete market model, and so DeÔ¨Ånition 6.31 is consistent with the
results of the Section 6.1 and 6.2.
‚ô¶

294
6 American contingent claims
Our main goal in this section is to characterize the set (H), and to identify the
upper and lower bounds in (6.17) with the quantities œÄsup(H) and œÄinf(H). We will
work under the simplifying assumption that
Ht ‚ààL1(P ‚àó) for all t and each P ‚àó‚ààP .
(6.18)
Note that (6.18) implies the condition
inf
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] < ‚àû.
For each P ‚àó‚ààP we denote by UP ‚àóthe corresponding Snell envelope of H, i.e.,
UP ‚àó
t
= ess sup
œÑ‚ààTt
E‚àó[ HœÑ | Ft ].
With this notation, the right-hand bound in (6.17) can be written as
sup
œÑ‚ààT
sup
P ‚àó‚ààP
E‚àó[ HœÑ ] = sup
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] = sup
P ‚àó‚ààP
UP ‚àó
0 .
In fact, a similar relation also holds for the lower bound in (6.17):
sup
œÑ‚ààT
inf
P ‚àó‚ààP
E‚àó[ HœÑ ] = inf
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] = inf
P ‚àó‚ààP
UP ‚àó
0 .
(6.19)
The proof that the above interchange of inÔ¨Åmum and supremum is indeed justiÔ¨Åed
under assumption (6.18) is postponed to the next section; see Theorem 6.47.
Theorem 6.33. Under condition (6.18), the set of arbitrage-free prices for H is a real
interval with endpoints
œÄinf(H) = inf
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] = sup
œÑ‚ààT
inf
P ‚àó‚ààP
E‚àó[ HœÑ ]
and
œÄsup(H) = sup
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] = sup
œÑ‚ààT
sup
P ‚àó‚ààP
E‚àó[ HœÑ ].
Moreover, (H) either consists of one single point or does not contain its upper
endpoint œÄsup(H).
Proof. LetœÑ ‚àóbeastoppingtimewhichisoptimalwithrespecttoagivenP ‚àó‚ààP . Then
UP ‚àó
0
= E‚àó[ HœÑ ‚àó] = supœÑ ‚Ä≤‚ààT E‚àó[ HœÑ ‚Ä≤ ], and consequently UP ‚àó
0
‚àà(H). Together
with the a priori bounds (6.17), we obtain the inclusions
{ UP ‚àó
0
| P ‚àó‚ààP } ‚äÇ(H) ‚äÇ[a, b],
(6.20)
where
a := sup
œÑ‚ààT
inf
P ‚àó‚ààP
E‚àó[ HœÑ ]
and
b := sup
œÑ‚ààT
sup
P ‚àó‚ààP
E‚àó[ HœÑ ].

6.3 Arbitrage-free prices
295
Moreover, the minimax identity (6.19) shows that
a = inf
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] = inf
P ‚àó‚ààP UP ‚àó
0
and
b = sup
P ‚àó‚ààP
UP ‚àó
0 .
Together with (6.20), this yields the identiÔ¨Åcation of œÄinf(H) and œÄsup(H) as a and b.
Now we claim that { UP ‚àó
0
| P ‚àó‚ààP } is an interval, which, in view of the preceding
step, will prove that (H) is also an interval. Take P0, P1 ‚ààP and deÔ¨Åne PŒ± ‚ààP
by PŒ± := Œ±P1 + (1 ‚àíŒ±)P0 for 0 ‚â§Œ± ‚â§1. By Theorem 6.20, f (Œ±) := UPŒ±
0
is the
supremum of the afÔ¨Åne functions
Œ± ‚ÜíEŒ±[ HœÑ ] = Œ±E1[ HœÑ ] + (1 ‚àíŒ±)E0[ HœÑ ],
œÑ ‚ààT .
Thus, f is convex and lower semicontinuous on [0, 1], hence continuous; see part (a)
of Proposition A.4. Since P is convex, this proves our claim.
It remains to exclude the possibility that b belongs to (H) in case a < b. Suppose
by way of contradiction that b ‚àà(H). Then there exist ÀÜœÑ ‚ààT and ÀÜP ‚ààP such that
ÀÜE[ HÀÜœÑ ] = b = sup
œÑ‚ààT
sup
P ‚àó‚ààP
E‚àó[ HœÑ ].
In particular, ÀÜP attains the supremum of E‚àó[ HÀÜœÑ ] for P ‚àó‚ààP . Theorem 5.33 im-
plies that the discounted European claim HÀÜœÑ is attainable and that E‚àó[ HÀÜœÑ ] is in fact
independent of P ‚àó‚ààP. Hence,
b = ÀÜE[ HÀÜœÑ ] = inf
P ‚àó‚ààP E‚àó[ HÀÜœÑ ] ‚â§sup
œÑ‚ààT
inf
P ‚àó‚ààP E‚àó[ HœÑ ],
and we end up with the contradiction b ‚â§a. Thus, b cannot belong to (H).
Comparing the previous result with Theorem 5.33, one might wonder whether
(H) contains its lower bound if œÄinf(H) < œÄsup(H). At a Ô¨Årst glance, it may come
as a surprise that both cases
œÄinf(H) ‚àà(H)
and
œÄinf(H) /‚àà(H)
can occur, as is illustrated by the following simple example.
Example 6.34. Consider a complete market model with T = 2, deÔ¨Åned on some
probability space (0, F0, P0). This model will be enlarged by adding two external
states œâ+ and œâ‚àí, i.e., we deÔ¨Åne  := 0 √ó {œâ+, œâ‚àí} and
P [ {(œâ0, œâ¬±)} ] := 1
2 P0[ {œâ0} ],
œâ0 ‚àà0.
The enlarged Ô¨Ånancial market model will then be incomplete, and the corresponding
set P of equivalent martingale measures is given by
P = { P ‚àó
p | 0 < p < 1 },

296
6 American contingent claims
where P ‚àó
p is determined by P ‚àó
p [ 0 √ó {œâ+} ] = p. Consider the discounted American
claim H deÔ¨Åned as
H0 ‚â°0,
H1 ‚â°1,
and
H2(œâ) :=

2
if œâ = (œâ0, œâ+),
0
if œâ = (œâ0, œâ‚àí).
Clearly, œÑ2 ‚â°2 is an optimal stopping time for P ‚àó
p if p > 1
2, while œÑ1 ‚â°1 is optimal
for p ‚â§1
2. Hence,
(H) = [1, 2),
and the lower bound œÄinf(H) = 1 is an arbitrage-free price for H. Now consider the
discounted American claim 
H deÔ¨Åned by 
Ht = Ht for t = 0, 2 and by 
H1 ‚â°0. In
this case, we have
( 
H) = (0, 2).
‚ô¶
Theorem 6.33 suggests that anAmerican claim H which admits a unique arbitrage-
free price should be attainable in an appropriate sense. Corollary 6.24, our hedging
resultinthecaseofacompletemarket, suggeststhefollowingdeÔ¨Ånitionofattainability.
DeÔ¨Ånition 6.35. A discounted American claim H is called attainable if there exists
a stopping time œÑ ‚ààT and a self-Ô¨Ånancing trading strategy Œæ whose value process V
satisÔ¨Åes P-a.s.
Vt ‚â•Ht for all t, and VœÑ = HœÑ.
The trading strategy Œæ is called a hedging strategy for H.
If H is attainable, then a hedging strategy protects the seller not only against those
claims HœÑ which arise from stopping times œÑ. The seller is on the safe side even if the
buyer would have full knowledge of future prices and would exercise H at an arbitrary
FT -measurable random time œÉ. For instance, the buyer even could choose œÉ such that
HœÉ = max
0‚â§t‚â§T Ht.
In fact, we will see in Remark 7.12 that H is attainable in the sense of DeÔ¨Ånition 6.35
if and only if Vt ‚â•Ht for all t and VœÉ = HœÉ for some FT -measurable random time œÉ.
If the market model is complete, then every American claim H is attainable.
Moreover, Theorem 6.12 and Corollary 6.24 imply that the minimal initial investment
needed for the purchase of a hedging strategy for H is equal to the unique arbitrage-
free price of H. In a general market model, every attainable discounted American
claim H satisÔ¨Åes our integrability condition (6.18) and has a unique arbitrage-free
price which is equal to the initial investment of a hedging strategy for H. This follows
from Theorem 5.26. In fact, the converse implication is also true:
Theorem 6.36. For a discounted American claim H satisfying (6.18), the following
conditions are equivalent:

6.4 Stability under pasting
297
(a) H is attainable.
(b) H admits a unique arbitrage-free price œÄ(H), i.e., (H) = {œÄ(H)}.
(c) œÄsup(H) ‚àà(H).
Moreover, if H is attainable, then œÄ(H) is equal to the initial investment of any hedging
strategy for H.
The equivalence of (b) and (c) is an immediate consequence of Theorem 6.33.
The remainder of the proof of Theorem 6.36 is postponed to Remark 7.10 because it
requires the technique of superhedging, which will be introduced in Section 7.
6.4
Stability under pasting
In this section we deÔ¨Åne the pasting of two equivalent probability measures at a given
stopping time. This operation will play an important role in the analysis of lower
and upper Snell envelopes as developed in Section 6.5. In particular, we will prepare
for the proof of the minimax identity (6.17), which was used in the characterization
of arbitrage-free prices of an American contingent claim. Let us start with a few
preparations.
DeÔ¨Ånition 6.37. Let œÑ be a stopping time. The œÉ-algebra of events which are observ-
able up to time œÑ is deÔ¨Åned as
FœÑ :=

A ‚ààF | A ‚à©{œÑ ‚â§t} ‚ààFt for all t

.
It is straightforward to check that FœÑ is indeed a œÉ-algebra and that
FœÑ =

A ‚ààF | A ‚à©{œÑ = t} ‚ààFt for all t

.
In particular, FœÑ coincides with Ft if œÑ ‚â°t. Moreover, if œÉ is a stopping time with
œÉ(œâ) ‚â§œÑ(œâ) for all œâ ‚àà, then FœÉ ‚äÇFœÑ.
The following result is an addendum to Doob‚Äôs stopping theorem; see Theo-
rem 6.17:
Proposition 6.38. For an adapted process M in L1(Q) the following conditions are
equivalent:
(a) M is a Q-martingale.
(b) EQ[ MœÑ | FœÉ ] = MœÑ‚àßœÉ for all œÑ ‚ààT and all stopping times œÉ.

298
6 American contingent claims
Proof. (a) ‚áí(b): Take a set A ‚ààFœÉ and let us write
EQ[ MœÑ; A ] = EQ

MœÑ; A ‚à©{œÑ ‚â§œÉ}

+ EQ

MœÑ; A ‚à©{œÑ > œÉ}

.
Condition (b) will follow if we may replace MœÑ by MœÉ in the rightmost expectation.
To this end, note that
A ‚à©{œÉ = t} ‚à©{œÑ > œÉ} = A ‚à©{œÉ = t} ‚à©{œÑ > t} ‚ààFt.
Thus, since the stopped process MœÑ is a martingale by Theorem 6.17,
EQ

MœÑ; A ‚à©{œÑ > œÉ}

=
T

t=0
EQ

MœÑ
T ; A ‚à©{œÉ = t} ‚à©{œÑ > œÉ}

=
T

t=0
EQ

MœÑ
t ; A ‚à©{œÉ = t} ‚à©{œÑ > œÉ}

= EQ

MœÉ; A ‚à©{œÑ > œÉ}

.
(b) ‚áí(a): This follows by taking œÑ ‚â°t and œÉ ‚â°s ‚â§t.
Example 6.39. Let Z be the density process of a probability measure 
Q that is abso-
lutely continuous with respect to Q; see Remark 5.13. If œÉ is a stopping time, then
we have 
Q ‚â™Q on FœÉ, and Propositions A.11 and 6.38 show that the corresponding
density is given by
d 
Q
dQ

FœÉ
= EQ[ ZT | FœÉ ] = ZT ‚àßœÉ.
‚ô¶
We have also the following extension of Theorem 6.20. It provides the solution to
the optimal stopping problem posed at any stopping time œÑ ‚â§T .
Proposition 6.40. LetH beanadaptedprocessinL1(, F , Q), anddeÔ¨ÅneforœÑ ‚ààT
TœÑ := { œÉ ‚ààT | œÉ ‚â•œÑ }.
Then the Snell envelope UQ of H satisÔ¨Åes Q-a.s.
UQ
œÑ = ess sup
œÉ‚ààTœÑ
EQ[ HœÉ | FœÑ ],
and the essential supremum is attained for
œÉ (œÑ)
min := min{ t ‚â•œÑ | Ht = UQ
t }.
Proof. It is not difÔ¨Åcult to reduce the assertion to Theorem 6.20 by using the identity
EQ[ HœÉ | FœÑ ] = EQ[ HœÉ | Ft ]
Q-a.s. on {œÑ = t},
(6.21)
which is proved by checking the deÔ¨Åning properties of the conditional expectation.

6.4 Stability under pasting
299
DeÔ¨Ånition 6.41. Let Q1 and Q2 be two equivalent probability measures and take
œÉ ‚ààT . The probability measure

Q[ A ] := EQ1

Q2[ A | FœÉ ]

,
A ‚ààFT ,
is called the pasting of Q1 and Q2 in œÉ.
The monotone convergence theorem for conditional expectations guarantees that

Q is indeed a probability measure and that
E
Q[ Y ] = EQ1

EQ2[ Y | FœÉ ]

for all FT -measurable Y ‚â•0. Note that 
Q coincides with Q1 on FœÉ, i.e.,
E
Q[ Y ] = EQ1[ Y ]
for all FœÉ-measurable Y ‚â•0.
Lemma 6.42. For Q1 ‚âàQ2, their pasting in œÉ ‚ààT is equivalent to Q1 and satisÔ¨Åes
d 
Q
dQ1
= ZT
ZœÉ
,
where Z is the density process of Q2 with respect to Q1.
Proof. For Y ‚â•0,
E
Q[ Y ] = EQ1

EQ2[ Y | FœÉ ]

= EQ1
 1
ZœÉ
EQ1[ YZT | FœÉ ]
!
= EQ1
 ZT
ZœÉ
Y
!
,
where we have used the martingale property of Z and the fact that ZœÉ > 0 Q1-almost
surely. The equivalence of 
Q and Q1 follows from ZT > 0 Q1-almost surely.
Lemma 6.43. For Q1 ‚âàQ2, let 
Q be their pasting in œÉ ‚ààT . Then, for all stopping
times œÑ and FT -measurable Y ‚â•0,
E
Q[ Y | FœÑ ] = EQ1

EQ2[ Y | FœÉ‚à®œÑ ] | FœÑ

.
Proof. If œï ‚â•0 is FœÑ-measurable, then œïI{œÑ‚â§œÉ} is FœÉ ‚à©FœÑ-measurable. Hence,
E
Q[ Yœï; œÑ ‚â§œÉ ]
=
EQ1

EQ2[ Y | FœÉ ]œï; œÑ ‚â§œÉ

=
EQ1

EQ1

EQ2[ Y | FœÉ ] | FœÑ

œï; œÑ ‚â§œÉ

=
E
Q

EQ1

EQ2[ Y | FœÉ ] | FœÑ

œï; œÑ ‚â§œÉ

,

300
6 American contingent claims
where we have used the fact that 
Q coincides with Q1 on FœÉ. On the other hand,
E
Q[ Yœï; œÑ > œÉ ]
=
EQ1

EQ2

EQ2[ Y | FœÑ ]œï | FœÉ

; œÑ > œÉ

=
E
Q

EQ2[ Y | FœÑ ]œï; œÑ > œÉ

.
It follows that
E
Q[ Y | FœÑ ] = EQ1

EQ2[ Y | FœÉ ] | FœÑ

I{œÑ‚â§œÉ} + EQ2[ Y | FœÑ ] I{œÑ>œÉ},
and this coincides with the right-hand side of the asserted identity.
DeÔ¨Ånition 6.44. A set Q of equivalent probability measures on (, F ) is called stable
if, for any Q1, Q2 ‚ààQ and œÉ ‚ààT , also their pasting in œÉ is contained in Q.
The condition of stability in the preceding deÔ¨Ånition is sometimes also called fork
convexity, m-stability, or stability under pasting. For the purposes of this book, the
most important example of a stable set is the class P of all equivalent martingale
measures, but in Section 6.5 we will also discuss the connection between stable sets
and dynamic risk measures.
Proposition 6.45. P is stable.
Proof. Take P1, P2 ‚ààP and denote by 
P their pasting a given œÉ ‚ààT . Doob‚Äôs
stopping theorem in the form of Proposition 6.38 and Lemma 6.43 applied with
Y := Xi
t ‚â•0 and œÑ ‚â°s yield that

E[ Xt | Fs ] = E1

E2[ Xt | FœÉ‚à®s ] | Fs

= E1[ XœÉ‚à®s | Fs ] = Xs.
It follows in particular that each component Xi
t is in L1(
P ) since 
E[ Xi
t ] = Xi
0 < ‚àû,
concluding the proof of 
P ‚ààP .
6.5
Lower and upper Snell envelopes
Our main goal in this section is to provide a proof of the minimax identity (6.19),
that was used in the characterization of the set of arbitrage-free prices of an American
contingent claim. The techniques and results which we develop here will help to
characterize the time-consistency of dynamic coherent risk measures and they will
also be needed in Chapter 7. Moreover, they can be interpreted in terms of an optimal
stopping problem for general utility functionals which appear in a robust Savage
representation of preferences on payoff proÔ¨Åles. Let us now Ô¨Åx a set Q of equivalent
probability measures and an adapted process H such that
Ht ‚ààL1(Q) for all t and each Q ‚ààQ.

6.5 Lower and upper Snell envelopes
301
Recall that this condition implies
inf
Q‚ààQ
sup
œÑ‚ààT
EQ[ HœÑ ] = inf
Q‚ààQ
UQ
0 < ‚àû,
where UQ denotes the Snell envelope of H with respect to Q ‚ààQ. Let us also assume
that
Q is stable.
DeÔ¨Ånition 6.46. The lower Snell envelope of H is deÔ¨Åned as
U‚Üì
t := ess inf
Q‚ààQ
UQ
t
= ess inf
Q‚ààQ
ess sup
œÑ‚ààTt
EQ[ HœÑ | Ft ],
t = 0, . . . , T.
The upper Snell envelope of H is deÔ¨Åned as
U‚Üë
t := ess sup
Q‚ààQ
UQ
t
= ess sup
œÑ‚ààTt
ess sup
Q‚ààQ
EQ[ HœÑ | Ft ],
t = 0, . . . , T.
We will Ô¨Årst study the lower Snell envelope. The following ‚Äúminimax theorem‚Äù
states that the essential inÔ¨Åmum and the essential supremum occurring in the deÔ¨Ånition
of U‚Üìmay be interchanged if Q is stable. Applied at t = 0 and combined with
Proposition 6.45, this gives the identity (6.19), which was used in our characterization
of the arbitrage-free prices of H.
Theorem 6.47. The lower Snell envelope of H satisÔ¨Åes
U‚Üì
t = ess sup
œÑ‚ààTt
ess inf
Q‚ààQ
EQ[ HœÑ | Ft ]
for each t.
(6.22)
In particular,
U‚Üì
0 = inf
Q‚ààQ
sup
œÑ‚ààT
EQ[ HœÑ ] = sup
œÑ‚ààT
inf
Q‚ààQ
EQ[ HœÑ ].
The inequality ‚â•in (6.22) is obvious. Its converse is an immediate consequence
of the next theorem, which solves the following optimal stopping problem that is
formulated with respect to the nonadditive expectation operator infQ‚ààQ EQ[ ¬∑ ]:
maximize inf
Q‚ààQ EQ[ HœÑ ] among all œÑ ‚ààT .
Theorem 6.48. DeÔ¨Åne a stopping time œÑt ‚ààTt by
œÑt := min{ u ‚â•t | U‚Üì
u = Hu }.
Then, P -a.s.,
U‚Üì
t = ess inf
Q‚ààQ EQ[ HœÑt | Ft ].
(6.23)
In particular,
sup
œÑ‚ààT
inf
Q‚ààQ
EQ[ HœÑ ] = inf
Q‚ààQ
EQ[ HœÑ0 ] = U‚Üì
0 .

302
6 American contingent claims
For the proof of Theorem 6.48, we need some preparations.
Lemma 6.49. Suppose that we are given Q1, Q2 ‚ààQ, a stopping time œÑ ‚ààT , and a
set B ‚ààFœÑ. Let 
Q ‚ààQ be the pasting of Q1 and Q2 in the stopping time
œÉ := œÑ IB + T IBc .
Then the Snell envelopes associated with these three measures are related as follows:
U 
Q
œÑ = UQ2
œÑ
IB + UQ1
œÑ
IBc
P -a.s.
(6.24)
Proof. With Proposition 6.40 and its notation, we have
U 
Q
œÑ = ess sup
œÅ‚ààTœÑ
E
Q[ HœÅ | FœÑ ].
To compute the conditional expectation on the right, note Ô¨Årst that
EQ2[ HœÅ | FœÉ‚à®œÑ ] = EQ2[ HœÅ | FœÑ ] IB + HœÅ IBc .
Hence, Lemma 6.43 yields that
E
Q[ HœÅ | FœÑ ] = EQ2[ HœÅ | FœÑ ] IB + EQ1[ HœÅ | FœÑ ] IBc .
Moreover, whenever œÅ1, œÅ2 ‚ààTœÑ, then
œÅ := œÅ1 IB + œÅ2 IBc
is also a stopping time in TœÑ. Thus,
U 
Q
œÑ = ess sup
œÅ‚ààTœÑ
EQ2[ HœÅ | FœÑ ] IB + ess sup
œÅ‚ààTœÑ
EQ1[ HœÅ | FœÑ ] IBc ,
and (6.24) follows.
Lemma 6.50. For any Q ‚ààQ and œÑ ‚ààT there exist Qk ‚ààQ such that Qk = Q on
FœÑ and
UQk
œÑ
‚Üòess inf
ÀÜQ‚ààQ
U ÀÜQ
œÑ = U‚Üì
œÑ .
Similarly, there exist Qk ‚ààQ such that Qk = Q on FœÑ and
UQk
œÑ
‚Üóess sup
ÀÜQ‚ààQ
U ÀÜQ
œÑ =: U‚Üë
œÑ .
Proof. For Q1, Q2 ‚ààQ, B := { UQ1
œÑ
> UQ2
œÑ
}, take 
Q ‚ààQ as in Lemma 6.49. Then
U 
Q
œÑ = UQ1
œÑ
¬∑ IBc + UQ2
œÑ
¬∑ IB = UQ1
œÑ
‚àßUQ2
œÑ
.
(6.25)

6.5 Lower and upper Snell envelopes
303
Moreover, if Q1 = Q on FœÑ then also 
Q = Q on FœÑ. Hence, the set
 :=

U ÀÜQ
œÑ | ÀÜQ ‚ààQ and ÀÜQ = Q on FœÑ

is such that U‚Üì
œÑ = ess inf . Moreover, (6.25) implies that  is directed downwards,
and the second part of Theorem A.32 states the existence of the desired sequence
(Qk) ‚äÇQ. The proof for the essential supremum is analogous.
Proof of Theorem 6.48. To prove (6.23), observe Ô¨Årst that UQ
t
‚â•EQ[ HœÑt | Ft ] for
each Q ‚ààQ, so that ‚â•holds in (6.23). For the proof of the converse inequality, note
that
œÑt ‚â§min{ u ‚â•t | UQ
u = Hu } =: œÑ Q
t
for Q ‚ààQ.
It was shown in Theorem 6.20 that œÑ Q
t
is the minimal optimal stopping time after time
t and with respect to Q. It was also shown in the proof of Theorem 6.20 that the
stopped process (UQ)œÑ Q
t is a Q-martingale from time t on. In particular,
UQ
t
= EQ[ UQ
œÑt | Ft ]
for all Q ‚ààQ.
(6.26)
Let us now Ô¨Åx some Q ‚ààQ. Lemma 6.50 yields Qk ‚ààQ with Qk = Q on FœÑt
such that UQk
œÑt
decreases to U‚Üì
œÑt . We obtain
EQ[ HœÑt | Ft ] = EQ[ U‚Üì
œÑt | Ft ] = EQ

lim
k‚Üë‚àûUQk
œÑt
| Ft

= lim
k‚Üë‚àûEQ[ UQk
œÑt
| Ft ] = lim
k‚Üë‚àûEQk[ UQk
œÑt
| Ft ]
= lim
k‚Üë‚àûUQk
t
‚â•U‚Üì
t .
Here we have used the facts that HœÑt
‚â§UQk
œÑt
‚â§UQ1
œÑt
and EQ[ |UQ1
œÑt | ] =
EQ1[ |UQ1
œÑt | ] < ‚àûtogether with dominated convergence in the third step, the fact
that Qk = Q on FœÑt ‚äÉFt in the fourth, and (6.26) in the Ô¨Åfth identity.
Remark 6.51. Suppose the buyer of an American option uses a utility functional of
the form
inf
Q‚ààQ EQ[ u(Z) ],
where Q is a set of probability measures and u is a measurable function. This may be
viewed as a robust Savage representation of a preference relation on discounted asset
payoffs; see Section 2.5. Thus, the aim of the buyer is to maximize the utility
inf
Q‚ààQ EQ[ u(HœÑ) ]
of the discounted payoff HœÑ among all stopping times œÑ ‚ààT . This generalized
utility maximization problem can be solved with the results developed in this section,

304
6 American contingent claims
provided that the set Q is a stable set of equivalent probability measures. Indeed,
assume

Ht := u(Ht) ‚ààL1(Q)
for all t and each Q ‚ààQ,
and let UQ be the Snell envelope of 
Ht with respect to Q ‚ààQ. Theorem 6.48 states
that the generalized optimal stopping problem is solved by the stopping time
œÑ ‚àó:= min{ t ‚â•0 | ess inf
Q‚ààQ UQ
t
= 
Ht },
i.e.,
inf
Q‚ààQ
sup
œÑ‚ààT
EQ[ u(HœÑ) ] = U‚Üì
0 = inf
Q‚ààQ
EQ[ u(HœÑ ‚àó) ].
‚ô¶
Let us now turn to the analysis of the upper Snell envelope
U‚Üë
t := ess sup
Q‚ààQ
UQ
t
= ess sup
œÑ‚ààTt
ess sup
Q‚ààQ
EQ[ HœÑ | Ft ],
t = 0, . . . , T.
In order to simplify the presentation, we will assume from now on that
sup
Q‚ààQ
EQ[ |Ht| ] < ‚àû
for all t.
This condition implies that
U‚Üë
0 = sup
Q‚ààQ
UQ
0 ‚â§sup
œÑ‚ààT
sup
Q‚ààQ
EQ[ |HœÑ| ] < ‚àû.
Our main result on upper Snell envelopes states that, for stable sets Q, the upper
Snell envelope U‚ÜësatisÔ¨Åes a recursive scheme that is similar to the one for ordinary
Snell envelopes. In contrast to (6.4), however, it involves the nonadditive conditional
expectation operators ess supQ EQ[ ¬∑ | Ft ].
Theorem 6.52. U‚ÜësatisÔ¨Åes the following recursive scheme:
U‚Üë
T = HT and U‚Üë
t = Ht ‚à®ess sup
Q‚ààQ
EQ[ U‚Üë
t+1 | Ft ],
t = T ‚àí1 . . . , 0.
(6.27)
Proof. The deÔ¨Ånition of the Snell envelope UQ implies that
U‚Üë
t = ess sup
Q‚ààQ
UQ
t
= Ht ‚à®ess sup
Q‚ààQ
EQ[ UQ
t+1 | Ft ].
(6.28)
Next, we Ô¨Åx Q ‚ààQ and denote by Qt+1(Q) the set of all ÀÜQ ‚ààQ which coincide
with Q on Ft+1. According to Lemma 6.50, there are Qk ‚ààQt+1(Q) such that

6.5 Lower and upper Snell envelopes
305
UQk
t+1 ‚ÜóU‚Üë
t+1. The fact that EQ[ |UQ1
t+1| ] = EQ1[ |UQ1
t+1| ] < ‚àûcombined with
monotone convergence for conditional expectations shows that
ess sup
Q‚ààQ
EQ[ U‚Üë
t+1 | Ft ] ‚â•ess sup
Q‚ààQ
EQ[ UQ
t+1 | Ft ]
= ess sup
Q‚ààQ
ess sup
ÀÜQ‚ààQt+1(Q)
EQ[ U
ÀÜQ
t+1 | Ft ]
‚â•ess sup
Q‚ààQ
lim inf
k‚Üë‚àûEQ[ UQk
t+1 | Ft ]
= ess sup
Q‚ààQ
EQ[ U‚Üë
t+1 | Ft ].
(6.29)
In particular, all inequalities are in fact identities. Together with (6.28) we obtain the
recursive scheme for U‚Üë.
The following result shows that the nonadditive conditional expectation operators
ess supQ EQ[ ¬∑ | Ft ] associated with a stable set Q enjoy a consistency property that
is similar to the martingale property for ordinary conditional expectations.
Theorem 6.53. Let Q be a set of equivalent probability measures and
V ‚Üë
t := ess sup
Q‚ààQ
EQ[ H | Ft ],
t = 0, . . . , T,
for some FT -measurable H ‚â•0 such that V ‚Üë
0 < ‚àû. If Q is stable then
V ‚Üë
œÉ = ess sup
Q‚ààQ
EQ[ V ‚Üë
œÑ | FœÉ ]
for œÉ, œÑ ‚ààT with œÉ ‚â§œÑ.
If, in addition, Q is convex and the set of densities { dQ/dP | Q ‚ààQ } is closed in
L1(P ) for some equivalent reference measure P , then also the following converse
implication holds: if for all œÑ ‚ààT and H ‚ààL‚àû(P ),
sup
Q‚ààQ
EQ[ H ] = sup
Q‚ààQ
EQ

ess sup
Q‚Ä≤‚ààQ
EQ‚Ä≤[ H | FœÑ ]

,
(6.30)
then Q is stable.
Remark 6.54. Note that, for H as in the theorem and œÑ ‚ààT ,
V ‚Üë
œÑ =
T

t=0
ess sup
Q‚ààQ
EQ[ H | Ft ]I{œÑ=t}
=
T

t=0
ess sup
Q‚ààQ
EQ[ H | FœÑ ]I{œÑ=t}
= ess sup
Q‚ààQ
EQ[ H | FœÑ ],
where we have used (6.21) in the second identity.
‚ô¶

306
6 American contingent claims
Proof of Theorem 6.53. By Remark 6.54,
V ‚Üë
œÉ = ess sup
Q‚ààQ
EQ[ H | FœÉ ] = ess sup
Q‚ààQ
EQ

EQ[ H | FœÑ ]
 FœÉ

.
The proof that the right-hand side is equal to ess supQ‚ààQ EQ[ V ‚Üë
œÑ | FœÉ ] is done by
Ô¨Årst noting that V ‚Üëis equal to the upper Snell envelope of the process Ht given by
HT = H and Ht = 0 for t < T . Then the same argument as in (6.29) applies. All
one has to do is to replace t + 1 by œÑ.
To prove the converse implication, let us assume by way of contradiction that the
pasting 
Q of some measures Q1, Q2 ‚ààQ in a stopping time œÑ ‚ààT does not belong
to Q. By the Hahn‚ÄìBanach theorem, there exists some H ‚ààL‚àû(P ) such that
sup
Q‚ààQ
EQ[ H ] < E
Q[ H ].
(6.31)
Using the deÔ¨Ånition of 
Q and our assumption (6.30), we obtain
E
Q[ H ] = EQ1

EQ2[ H | FœÑ ]

‚â§EQ1

ess sup
Q‚Ä≤‚ààQ
EQ‚Ä≤[ H | FœÑ ]

‚â§sup
Q‚ààQ
EQ

ess sup
Q‚Ä≤‚ààQ
EQ‚Ä≤[ H | FœÑ ]

= sup
Q‚ààQ
EQ[ H ],
in contradiction to (6.31).
Let us conclude this section by pointing out the connection between stability under
pasting and the time-consistency of dynamic coherent risk measures. Let
œÅ(Y) := sup
Q‚ààQ
EQ[ ‚àíY ],
Y ‚ààL‚àû(P ),
be a coherent risk measure on L‚àû(P ) deÔ¨Åned in terms of a set Q of probability
measures equivalent to P . In the context of a dynamic Ô¨Ånancial market model, it is
natural to update the initial risk assessment at later times t > 0. If one continues to
use Q as a basis to compute the risk but takes into account the available information,
one is led to consider the conditional risk measures
œÅt(Y) = ess sup
Q‚ààQ
EQ[ ‚àíY | Ft ],
t = 0, . . . , T.
(6.32)
The sequence œÅ0 . . . , œÅT can be regarded as a dynamic coherent risk measure. Often,
such a dynamic risk measure is called time-consistent or dynamically consistent if
œÅs(‚àíœÅt(Y)) = œÅs(Y)
for 0 ‚â§s ‚â§t ‚â§T .
(6.33)

6.5 Lower and upper Snell envelopes
307
Corollary 6.55. Let Q be a set of equivalent probability measures. The dynamic risk
measure œÅ0, . . . , œÅT arising from Q via (6.32) is time-consistent as soon as Q is stable.
Conversely, stability of Q is necessary if time-consistency is required also for stopping
times and if Q coincides with Qmax, the maximal representing subset of M1(P ) for œÅ.
Proof. This follows from Theorem 6.53, since
$ dQ
dP
 Q ‚ààQmax
%
=

X‚ààAœÅ

œï ‚ààL1
+(P ) | E[ œïX ] ‚â•0, E[ œï ] = 1

is convex and closed in L1(P ).
If one requires time-consistency only in the weak form (6.33), one can show by
using the arguments in this section that it is necessary and sufÔ¨Åcient for Q to be stable
under pasting in stopping times that take at most one value different from T .

Chapter 7
Superhedging
The idea of superhedging is to Ô¨Ånd a self-Ô¨Ånancing trading strategy with minimal initial
investment which covers any possible future obligation resulting from the sale of a
contingent claim. If the contingent claim is not attainable, the proof of the existence
of such a ‚Äúsuperhedging strategy‚Äù requires new techniques, and in particular a new
uniform version of the Doob decomposition. We will develop this theory for general
American contingent claims. In doing so, we will also obtain new results for European
contingent claims. In the Ô¨Årst three sections of this chapter, we assume that our market
model is arbitrage-free or, equivalently, that the set of equivalent martingale measures
satisÔ¨Åes
P Ã∏= ‚àÖ.
In the Ô¨Ånal Section 7.4, we discuss liquid options in a setting where no probabilistic
model is Ô¨Åxed a priori. Such options may be used for the construction of speciÔ¨Åc
martingale measures, and also for the purpose of hedging illiquid exotic derivatives.
7.1 P-supermartingales
In this section, H denotes a discounted American claim with
sup
P ‚àó‚ààP
E‚àó[ Ht ] < ‚àû
for all t.
(7.1)
Our aim in this chapter is to Ô¨Ånd the minimal amount of capital Ut that will be needed
at time t in order to purchase a self-Ô¨Ånancing trading strategy whose value process
satisÔ¨Åes Vu ‚â•Hu for all u ‚â•t. In analogy to our derivation of the recursive scheme
(6.4), we will now heuristically derive a formula for Ut. At time T , the minimal
amount needed is clearly given by
UT = HT .
At time T ‚àí1, a Ô¨Årst requirement is to have UT ‚àí1 ‚â•HT ‚àí1. Moreover, the amount
UT ‚àí1 must sufÔ¨Åce to purchase an FT ‚àí1-measurable portfolio ŒæT such that ŒæT ¬∑ XT ‚â•
HT almost surely. An informal application of Theorem 1.31, conditional on FT ‚àí1,
shows that
UT ‚àí1 ‚â•ess sup
P ‚àó‚ààP
E‚àó[ HT | FT ‚àí1 ].

7.1 P-supermartingales
309
Hence, the minimal amount UT ‚àí1 is equal to the maximum of HT ‚àí1 and this essential
supremum. An iteration of this argument yields the recursive scheme
UT = HT
and
Ut = Ht ‚à®ess sup
P ‚àó‚ààP
E‚àó[ Ut+1 | Ft ]
for t = T ‚àí1, . . . , 0. By combining Proposition 6.45 and Theorem 6.52, we can
identify U as the upper Snell envelope
U‚Üë
t = ess sup
P ‚àó‚ààP
UP ‚àó
t
= ess sup
œÑ‚ààTt
ess sup
P ‚àó‚ààP
E‚àó[ HœÑ | Ft ]
of H with respect to the stable set P , where UP ‚àódenotes the Snell envelope of H
with respect to P ‚àó. In the Ô¨Årst three sections of this chapter, we will in particular give
a rigorous version of the heuristic argument above.
Note Ô¨Årst that condition (7.1) implies that
œÄsup(H) = sup
P ‚àó‚ààP
UP ‚àó
0
= sup
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] < ‚àû,
where we have used the identiÔ¨Åcation of the upper bound œÄsup(H) of the arbitrage-free
prices of H given in Theorem 6.33. It will turn out that the following deÔ¨Ånition applies
to the upper Snell envelope if we choose Q = P .
DeÔ¨Ånition 7.1. SupposethatQ isanon-emptysetofprobabilitymeasureson(, FT ).
An adapted process is called a Q-supermartingale if it is a supermartingale with respect
to each Q ‚ààQ. Analogously, we deÔ¨Åne the notions of a Q-submartingale and of a
Q-martingale.
In Theorem 5.26, we have already encountered an example of a P -martingale,
namely the value process of the replicating strategy of an attainable discounted Euro-
pean claim.
Theorem 7.2. The upper Snell envelope U‚Üëof H is the smallest P -supermartingale
that dominates H.
Proof. For each P ‚àó‚ààP the recursive scheme (6.27) implies that P ‚àó-a.s.
U‚Üë
t ‚â•Ht ‚à®E‚àó[ U‚Üë
t+1 | Ft ] ‚â•E‚àó[ U‚Üë
t+1 | Ft ].
Since U‚Üë
0 is a Ô¨Ånite constant due to our integrability assumption (7.1), induction on
t shows that U‚Üë
t is integrable with respect to each P ‚àó‚ààP and hence is a P -super-
martingale dominating H.
If 
U is another P -supermartingale which dominates H, then 
UT ‚â•HT = U‚Üë
T .
Moreover, if 
Ut+1 ‚â•U‚Üë
t+1 for some t, then

Ut ‚â•Ht ‚à®E‚àó[ 
Ut+1 | Ft ] ‚â•Ht ‚à®E‚àó[ U‚Üë
t+1 | Ft ].

310
7 Superhedging
Thus,

Ut ‚â•Ht ‚à®ess sup
P ‚àó‚ààP
E‚àó[ U‚Üë
t+1 | Ft ] = U‚Üë
t ,
and backward induction shows that 
U dominates U‚Üë.
For European claims, Theorem 7.2 takes the following form.
Corollary 7.3. Let H E be a discounted European claim such that
sup
P ‚àó‚ààP
E‚àó[ H E ] < ‚àû.
Then
V ‚Üë
t := ess sup
P ‚àó‚ààP
E‚àó[ H E | Ft ],
t = 0, . . . , T,
is the smallest P -supermartingale whose terminal value dominates H E.
Remark 7.4. Note that the proof of Theorem 7.2 did not use any special properties
of the set P . Thus, if Q is an arbitrary set of equivalent probability measures, the
process U deÔ¨Åned by the recursion
UT = HT
and
Ut = Ht ‚à®ess sup
Q‚ààQ
EQ[ Ut+1 | Ft ]
is the smallest Q-supermartingale dominating the adapted process H.
‚ô¶
7.2 Uniform Doob decomposition
The aim of this section is to give a complete characterization of all non-negative
P-supermartingales. It will turn out that an integrable and non-negative process U is a
P -supermartingale if and only if it can be written as the difference of a P -martingale
N and an increasing adapted process B satisfying B0 = 0. This decomposition
may be viewed as a uniform version of the Doob decomposition since it involves
simultaneously the whole class P . It will turn out that the P -martingale N has a
special structure: It can be written as a ‚Äústochastic integral‚Äù of the underlying process
X, which deÔ¨Ånes the class P. On the other hand, the increasing process B is only
adapted, notpredictableasintheDoobdecomposition withrespecttoasinglemeasure.
Theorem 7.5. For an adapted, non-negative process U, the following two statements
are equivalent.
(a) U is a P -supermartingale.

7.2 Uniform Doob decomposition
311
(b) There exists an adapted increasing process B with B0 = 0 and a d-dimensional
predictable process Œæ such that
Ut = U0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚àíBt
P -a.s. for all t.
Proof. First, we prove the easier implication (b) ‚áí(a). Fix P ‚àó‚ààP and note that
VT := U0 +
T

k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•UT ‚â•0.
Hence, V is a P-martingale by Theorem 5.15. It follows that Ut ‚ààL1(P ‚àó) for all t.
Moreover, for P ‚àó‚ààP
E‚àó[ Ut+1 | Ft ] = E‚àó[ Vt+1 ‚àíBt+1 | Ft ] ‚â§Vt ‚àíBt = Ut,
and so U is a P -supermartingale.
The proof of the implication (a) ‚áí(b) is similar to the proof of Theorem 5.33. We
must show that for any given t ‚àà{1, . . . , T }, there exist Œæt ‚ààL0(, Ft‚àí1, P ; Rd)
and Rt ‚ààL0
+(, Ft, P) such that
Ut ‚àíUt‚àí1 = Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚àíRt.
This condition can be written as
Ut ‚àíUt‚àí1 ‚ààKt ‚àíL0
+(, Ft, P ),
where Kt is as in (5.12). There is no loss of generality in assuming that P is itself
a martingale measure. In this case, Ut ‚àíUt‚àí1 is contained in L1(, Ft, P ) by the
deÔ¨Ånition of a P -supermartingale. Assume that
Ut ‚àíUt‚àí1 /‚ààC :=

Kt ‚àíL0
+(, Ft, P )

‚à©L1(P ).
Sinceourmodelisarbitrage-free, Lemma1.67impliesthatC isclosedinL1(, Ft, P ).
Hence, Theorem A.56 implies the existence of some Z ‚ààL‚àû(, Ft, P ) such that
Œ± := sup
W‚ààC
E[ Z W ] < E[ Z (Ut ‚àíUt‚àí1) ] =: Œ¥ < ‚àû.
(7.2)
Infact, wehaveŒ± = 0sinceC isaconecontainingtheconstantfunction0. Lemma1.57
implies that such a random variable Z must be non-negative and must satisfy
E[ (Xt ‚àíXt‚àí1) Z | Ft‚àí1] = 0.
(7.3)
In fact, we can always modify Z such that it is bounded below by some Œµ > 0 and
still satisÔ¨Åes (7.2). To see this, note Ô¨Årst that every W ‚ààC is dominated by a term of

312
7 Superhedging
the form Œæt ¬∑ (Xt ‚àíXt‚àí1). Hence, our assumption P ‚ààP , the integrability of W, and
an application of Fatou‚Äôs lemma as yield that
E[ W ] ‚â§E[ Œæt ¬∑ (Xt ‚àíXt‚àí1) ] ‚â§lim inf
c‚Üë‚àûE

I{|Œæt|‚â§c}Œæt ¬∑ (Xt ‚àíXt‚àí1)

‚â§0.
Thus, if we let ZŒµ := Œµ + Z, then ZŒµ also satisÔ¨Åes E[ ZŒµ W ] ‚â§0 for all W ‚ààC. If
we chose Œµ small enough, then E[ ZŒµ (Ut ‚àíUt‚àí1) ] is still larger than 0; i.e., ZŒµ also
satisÔ¨Åes (7.2) and in turn (7.3). Therefore, we may assume from now on that our Z
with (7.2) is bounded below by some constant Œµ > 0.
Let
Zt‚àí1 := E[ Z | Ft‚àí1 ],
and deÔ¨Åne a new measure 
P ‚âàP by
d 
P
dP :=
Z
Zt‚àí1
.
We claim that 
P ‚ààP . To prove this, note Ô¨Årst that Xk ‚ààL1(
P ) for all k, because the
density d 
P /dP is bounded. Next, let
œïk := E

Z
Zt‚àí1
 Fk

,
k = 0, . . . , T.
If k Ã∏= t, then œïk‚àí1 = œïk; this is clear for k > t, and for k < t it follows from
œïk = E
 E[ Z | Ft‚àí1 ]
Zt‚àí1
 Fk

= 1.
Thus, for k Ã∏= t

E[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] =
1
œïk‚àí1
E[ (Xk ‚àíXk‚àí1) œïk | Fk‚àí1 ]
= E[ Xk ‚àíXk‚àí1 | Fk‚àí1 ]
= 0.
If k = t, then (7.3) yields that

E[ Xk ‚àíXk‚àí1 | Fk‚àí1 ] =
1
Zt‚àí1
E[ (Xt ‚àíXt‚àí1) Z | Ft‚àí1 ] = 0.
Hence 
P ‚ààP .
Since 
P ‚ààP, we have 
E[ Ut ‚àíUt‚àí1 | Ft‚àí1 ] ‚â§0, and we get
0 ‚â•
E
 
E[ Ut ‚àíUt‚àí1 | Ft‚àí1 ] Zt‚àí1

= 
E[ (Ut ‚àíUt‚àí1) Zt‚àí1 ]
= E[ (Ut ‚àíUt‚àí1) Z ]
= Œ¥.
This, however, contradicts the fact that Œ¥ > 0.

7.3 Superhedging of American and European claims
313
Remark 7.6. The decomposition in part (b) of Theorem 7.5 is sometimes called the
optional decomposition of the P -supermartingale U. The existence of such a de-
composition was Ô¨Årst proved by El Karoui and Quenez [80] and D. Kramkov [135]
in a continuous-time framework where B is an ‚Äúoptional‚Äù process; this explains the
terminology.
‚ô¶
7.3 Superhedging of American and European claims
Let H be a discounted American claim such that
sup
P ‚àó‚ààP
E‚àó[ Ht ] < ‚àû
for all t,
which is equivalent to the condition that the upper bound of the arbitrage-free prices
of H is Ô¨Ånite:
œÄsup(H) = sup
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] < ‚àû.
Our aim in this section is to construct self-Ô¨Ånancing trading strategies such that the
seller of H stays on the safe side in the sense that the corresponding portfolio value is
always above H.
DeÔ¨Ånition 7.7. Any self-Ô¨Ånancing trading strategy Œæ whose value process V satisÔ¨Åes
Vt ‚â•Ht
P -a.s. for all t
is called a superhedging strategy for H.
Sometimes, a superhedging strategy is also called a superreplication strategy.
According to DeÔ¨Ånition 6.35, H is attainable if and only if there exist œÑ ‚ààT and a
superhedging strategy whose value process satisÔ¨Åes VœÑ = HœÑ P -almost surely.
Lemma 7.8. If H is not attainable, then the value process V of any superhedging
strategy satisÔ¨Åes
P [ Vt > Ht for all t ] > 0.
Proof. We introduce the stopping time
œÑ := inf{ t ‚â•0 | Ht = Vt }.
Then P[ œÑ = ‚àû] = P [ Vt > Ht for all t ]. Suppose that P [ œÑ = ‚àû] = 0. In this
case, VœÑ = HœÑ P -a.s so that we arrive at the contradiction that H must be an attainable
American claim.
Let us now turn to the question whether superhedging strategies exist. In Sec-
tion 6.1, we have already seen how one can use the Doob decomposition of the Snell

314
7 Superhedging
envelope UP ‚àóof H together with the martingale representation of Theorem 5.39 in
order to obtain a superhedging strategy for the price UP ‚àó
0 , where P ‚àódenotes the unique
equivalent martingale measure in a complete market model. We have also seen that
UP ‚àó
0
is the minimal amount for which such a superhedging strategy is available, and
that UP ‚àó
0
is the unique arbitrage-free price of H. The same is true of any attainable
American claim in an incomplete market model.
In the context of a non-attainable American claim H in an incomplete Ô¨Ånancial
market model, the P ‚àó-Snell envelope will be replaced with the upper Snell envelope
U‚Üëof H. The uniform Doob decomposition will take over the roles played by the
usual Doob decomposition and the martingale representation theorem. Since U‚Üëis a
P -supermartingale by Theorem 7.2, the uniform Doob decomposition states that U‚Üë
takes the form
U‚Üë
t = U‚Üë
0 +
t
s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1) ‚àíBt
(7.4)
‚â•Ht
forsomepredictableprocessŒæ andsomeincreasingprocessB. Thus, theself-Ô¨Ånancing
trading strategy Œæ = (Œæ0, Œæ) deÔ¨Åned by Œæ and the initial capital
Œæ1 ¬∑ X0 = U‚Üë
0 = œÄsup(H)
is a superhedging strategy for H. Moreover, if 
V is the value process of any super-
hedging strategy, then Lemma 7.8 implies that 
V0 > E‚àó[ HœÑ ] for all œÑ ‚ààT and each
P ‚àó‚ààP . In particular, 
V0 is larger than any arbitrage-free price for H, and it follows
that 
V0 ‚â•œÄsup(H). Thus, we have proved:
Corollary 7.9. There exists a superhedging strategy with initial investment œÄsup(H),
and this is the minimal amount needed to implement a superhedging strategy.
We will call œÄsup(H) the cost of superhedging of H. Sometimes, a superhedging
strategy is also called a superreplication strategy, and one says that œÄsup(H) is the cost
of superreplication or the upper hedging price of H. Recall, however, that œÄsup(H) is
typically not an arbitrage-free price for H. In particular, the seller cannot expect to
receive the amount œÄsup(H) for selling H.
On the other hand, the process B in the decomposition (7.4) can be interpreted
as a refunding scheme: Using the superhedging strategy Œæ, the seller may withdraw
successively the amounts deÔ¨Åned by the increments of B. With this capital Ô¨Çow, the
hedging portfolio at time t has the value U‚Üë
t ‚â•Ht. Thus, the seller is on the safe side
at no matter when the buyer decides to exercise the option. As we are going to show
in Theorem 7.13 below, this procedure is optimal in the sense that, if started at any
time t, it requires a minimal amount of capital.
Remark 7.10. Suppose œÄsup(H) belongs to the set (H) of arbitrage-free prices for
H. By Theorem 6.33, this holds if and only if œÄsup(H) is the only element of (H).

7.3 Superhedging of American and European claims
315
In this case, the deÔ¨Ånition of (H) yields a stopping time œÑ ‚ààT and some P ‚àó‚ààP
such that
œÄsup(H) = E‚àó[ HœÑ ].
Now let V be the value process of a superhedging strategy bought at V0 = œÄsup(H). It
follows that E‚àó[ VœÑ ] = œÄsup(H). Hence, VœÑ = HœÑ P -a.s., so that H is attainable in the
sense of DeÔ¨Ånition 6.35. This observation completes the proof of Theorem 6.36.
‚ô¶
Remark 7.11. If the American claim H is not attainable, then œÄsup(H) is not an
arbitrage-free price of H. Thus, one may expect the existence of arbitrage oppor-
tunities if H would be traded at the price œÄsup(H). Indeed, selling H for œÄsup(H) and
buying a superhedging strategy Œæ creates such an arbitrage opportunity: The balance
at t = 0 is zero, but Lemma 7.8 implies that the value process V of Œæ cannot be reached
by any exercise strategy œÉ, i.e., we always have
VœÉ ‚â•HœÉ
and
P [ VœÉ > HœÉ ] > 0.
(7.5)
Note that (7.5) is not limited to exercise strategies which are stopping times but holds
for arbitrary FT -measurable random times œÉ :  ‚Üí{0, . . . , T }. In other words,
œÄsup(H) is too expensive even if the buyer of H would have full information about the
future price evolution.
‚ô¶
Remark 7.12. The argument of Remark 7.11 implies that anAmerican claim H is at-
tainable if and only if there exists an FT -measurable random time œÉ :  ‚Üí{0, . . . , T }
such that HœÉ = VœÉ, where V the value process of a superhedging strategy. In other
words, the notion of attainability of American claims does not need the restriction to
stopping times.
‚ô¶
We already know that œÄsup(H) is the smallest amount for which one can buy a su-
perhedging strategy at time 0. The following ‚Äúsuperhedging duality theorem‚Äù extends
this result to times t > 0. To this end, denote by U‚Üë
t (H) the set of all Ft-measurable
random variables 
Ut ‚â•0 for which there exists a d-dimensional predictable process
Œæ such that

Ut +
u

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•Hu
for all u ‚â•t P -a.s.
(7.6)
Theorem 7.13. The upper Snell envelope U‚Üë
t of H is the minimal element of U‚Üë
t (H).
More precisely:
(a) U‚Üë
t ‚ààU‚Üë
t (H),
(b) U‚Üë
t = ess inf U‚Üë
t (H).

316
7 Superhedging
Proof. Assertion (a) follows immediately from the uniform Doob decomposition of the
P -supermartingale U‚Üë. As to part (b), we clearly get U‚Üë
t ‚â•ess inf U‚Üë
t (H) from (a).
For the proof of the converse inequality, take 
Ut ‚ààU‚Üë
t (H) and choose a predictable
processŒæ for which (7.6) holds. We must show that the set B := { U‚Üë
t ‚â§
Ut } satisÔ¨Åes
P[ B ] = 1. Let
ÀÜUt := U‚Üë
t ‚àß
Ut = U‚Üë
t ¬∑ IB + 
Ut ¬∑ IBc .
Then ÀÜUt ‚â§U‚Üë
t , and our claim will follow if we can show that U‚Üë
t
‚â§ÀÜUt. Let Œæ
denote the predictable process obtained from the uniform Doob decomposition of the
P -supermartingale U‚Üë, and deÔ¨Åne
ÀÜŒæs :=

Œæs
if s ‚â§t,
Œæs ¬∑ IB +Œæs ¬∑ IBc
if s > t.
With this choice, ÀÜUt satisÔ¨Åes (7.6), i.e., ÀÜUt ‚ààU‚Üë
t (H). Let
ÀÜVs := U‚Üë
0 +
s

k=1
ÀÜŒæk ¬∑ (Xk ‚àíXk‚àí1).
Then ÀÜVs ‚â•U‚Üë
s for all s ‚â§t. In particular ÀÜVt ‚â•ÀÜUt, and hence ÀÜVT ‚â•HT , which
implies that ÀÜV is a P -martingale; see Theorem 5.26. Hence, Doob‚Äôs stopping theorem
implies
U‚Üë
t = ess sup
P ‚àó‚ààP
ess sup
œÑ‚ààTt
E‚àó[ HœÑ | Ft ]
‚â§ess sup
P ‚àó‚ààP
ess sup
œÑ‚ààT
E‚àó 
ÀÜUt +
œÑ

k=t+1
ÀÜŒæk ¬∑ (Xk ‚àíXk‚àí1)
 Ft
!
= ÀÜUt,
which concludes the proof.
We now take the point of view of the buyer of the American claim H. The buyer
allocates an initial investment œÄ to purchase H, and then receives the amount HœÑ ‚â•0.
The objective is to Ô¨Ånd an exercise strategy and a self-Ô¨Ånancing trading strategy Œ∑
with initial investment ‚àíœÄ, such that the portfolio value is covered by the payoff of
the claim. In other words, Ô¨Ånd œÑ ‚ààT and a self-Ô¨Ånancing trading strategy with value
process V such that V0 = ‚àíœÄ and VœÑ + HœÑ ‚â•0. As shown below, the maximal œÄ for
which this is possible is equal to
œÄinf(H) = sup
œÑ‚ààT
inf
P ‚àó‚ààP
E‚àó[ HœÑ ] = inf
P ‚àó‚ààP
sup
œÑ‚ààT
E‚àó[ HœÑ ] = U‚Üì
0 ,

7.3 Superhedging of American and European claims
317
where
U‚Üì
t = ess inf
P ‚àó‚ààP
UP ‚àó
t
= ess inf
P ‚àó‚ààP
ess sup
œÑ‚ààTt
E‚àó[ HœÑ | Ft ]
= ess sup
œÑ‚ààTt
ess inf
P ‚àó‚ààP
E‚àó[ HœÑ | Ft ]
is the lower Snell envelope of H with respect to the stable set P . More generally,
we will consider the buyer‚Äôs problem for arbitrary t ‚â•0. To this end, denote by
U‚Üì
t (H) the set of all Ft-measurable random variables 
Ut ‚â•0 for which there exists
a d-dimensional predictable process Œ∑ and a stopping time œÉ ‚ààTt such that

Ut ‚àí
œÉ

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1) ‚â§HœÉ
P -a.s.
Theorem 7.14. U‚Üì
t is the maximal element of U‚Üì
t (H). More precisely:
(a) U‚Üì
t ‚ààU‚Üì
t (H),
(b) U‚Üì
t = ess sup U‚Üì
t (H).
Proof. (a): Let Œæ be a superhedging strategy for H with initial investment œÄsup(H),
and denote by V the value process of Œæ. The main idea of the proof is to use that
Vt ‚àíHt ‚â•0 can be regarded as a new discounted American claim, to which we
can apply Theorem 7.13. However, we must take care of the basic asymmetry of
the hedging problem for American options: The seller of H must hedge against all
possible exercise strategies, while the buyer must Ô¨Ånd only one suitable stopping time.
It will turn out that a suitable stopping time is given by œÑt := inf{u ‚â•t | U‚Üì
u = Hu}.
With this choice, let us deÔ¨Åne a modiÔ¨Åed discounted American claim 
H by

Hu = (Vu ‚àíHu) ¬∑ I{u=œÑt},
u = 0, . . . , T.
Clearly 
HœÉ ‚â§
HœÑt for all œÉ ‚ààTt. It follows that
ess sup
œÉ‚ààTt
ess sup
P ‚àó‚ààP
E‚àó[ 
HœÉ | Ft ] = ess sup
P ‚àó‚ààP
E‚àó[ 
HœÑt | Ft ]
= Vt ‚àíess inf
P ‚àó‚ààP E‚àó[ HœÑt | Ft ]
= Vt ‚àíU‚Üì
t ,
where we have used that V is a P -martingale in the second and Theorem 6.48 in
the third step. Thus, Vt ‚àíU‚Üì
t
is equal to the upper Snell envelope 
U‚Üëof 
H at

318
7 Superhedging
time t. Let Œæ be the d-dimensional predictable process obtained from the uniform
Doob decomposition of 
U‚Üë. Then, due to part (a) of Theorem 7.13,
Vt ‚àíU‚Üì
t +
u

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•
Hu = (Vu ‚àíHu) ¬∑ I{u=œÑt}
for all u ‚â•t.
Thus, Œ∑ := Œæ ‚àíŒæ is as desired.
(b): Part (a) implies the inequality ‚â§in (b). To prove its converse, take 
Ut ‚ààU‚Üì
t ,
a d-dimensional predictable process Œ∑, and œÉ ‚ààTt such that

Ut ‚àí
œÉ

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1) ‚â§HœÉ
P -a.s.
We will show below that
E‚àó 
œÉ

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1)
 Ft
!
= 0
for all P ‚àó‚ààP .
(7.7)
Given this fact, we obtain that

Ut ‚â§E‚àó[ HœÉ | Ft ] ‚â§ess sup
œÑ‚ààTt
E‚àó[ HœÑ | Ft ]
for all P ‚àó‚ààP . Taking the essential inÔ¨Åmum over P ‚àó‚ààP thus yields 
Ut ‚â§U‚Üì
t and
in turn (b).
To prove (7.7), let

Gs := I{s‚â•t+1}
s

k=t+1
I{k‚â§œÉ}Œ∑k ¬∑ (Xk ‚àíXk‚àí1),
s = 0, . . . , T.
Then 
GT ‚â•
Ut ‚àíHœÉ ‚â•‚àíHœÉ ‚ààL1(P ‚àó) for all P ‚àó, and Theorem 5.15 implies that

G is a P -martingale. Hence (7.7) follows.
We conclude this section by stating explicitly the corresponding results for Eu-
ropean claims. Recall from Remark 6.7 that every discounted European claim H E
can be regarded as the discounted American claim. Therefore, the results we have
obtained so far include the corresponding ‚ÄúEuropean‚Äù counterparts as special cases.
Corollary 7.15. For any discounted European claim H E such that
sup
P ‚àó‚ààP
E‚àó[ H E ] < ‚àû,

7.3 Superhedging of American and European claims
319
there exist two d-dimensional predictable processes Œæ and Œ∑ such that P -a.s.
ess sup
P ‚àó‚ààP
E‚àó[ H E | Ft ] +
T

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•H E,
(7.8)
ess inf
P ‚àó‚ààP E‚àó[ H E | Ft ] ‚àí
T

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1) ‚â§H E.
(7.9)
Remark 7.16. For t = 0, (7.8) takes the form
sup
P ‚àó‚ààP
E‚àó[ H E ] +
T

k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•H E
P -a.s.
Thus, the self-Ô¨Ånancing trading strategy Œæ arising from Œæ and the initial investment
Œæ1 ¬∑ X0 = supP ‚àó‚ààP E‚àó[ H E ] allows the seller to cover all possible obligations
without any downside risk.
Similarly, (7.9) yields an interpretation of the self-
Ô¨Ånancing trading strategy Œ∑ which arises from Œ∑ and the initial investment Œ∑1 ¬∑ X0 =
‚àíinfP ‚àó‚ààP E‚àó[ H E ]. The latter quantity corresponds to the largest loan the buyer can
take out and still be sure that, by using the trading strategy Œ∑, this debt will be covered
by the payoff H E.
‚ô¶
Remark 7.17. Let H be a discounted European claim such that
sup
P ‚àó‚ààP
E‚àó[ H E ] < ‚àû.
Suppose that ÀÜP ‚ààP is such that ÀÜE[ H ] = œÄsup(H). If Œæ = (Œæ0, Œæ) is a superhedging
strategy for H, then
ÀÜH := ÀÜE[ H ] +
T

k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1)
satisÔ¨Åes ÀÜH ‚â•H ‚â•0. Hence, ÀÜH is an attainable discounted claim, and it follows from
Theorem 5.26 that
ÀÜE[ ÀÜH ] = ÀÜE[ H ].
This shows that ÀÜH and H are identical and that H is attainable. We have thus obtained
another proof of Theorem 5.33.
‚ô¶
As the last result in this section, we formulate the following ‚Äúsuperhedging duality
theorem‚Äù, which states that the bounds in (7.8) and (7.9) are optimal.
Corollary 7.18. Suppose that H E is a discounted European claim with
sup
P ‚àó‚ààP
E‚àó[ H E ] < ‚àû.

320
7 Superhedging
Denote by U‚Üë
t (H E) the set of all Ft measurable random variables 
Ut for which there
exists a d-dimensional predictable processŒæ such that

Ut +
T

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•H E
P -a.s.
Then
ess sup
P ‚àó‚ààP
E‚àó[ H E | Ft ] = ess inf U‚Üë
t (H E).
By U‚Üì
t (H E) we denote the set of all Ft measurable random variables 
Ut for which
there exists a d-dimensional predictable process Œ∑ such that

Ut ‚àí
T

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1) ‚â§H E
P -a.s.
Then
ess inf
P ‚àó‚ààP E‚àó[ H E | Ft ] = ess sup U‚Üì
t (H E).
Remark 7.19. DeÔ¨Åne A as the set of Ô¨Ånancial positions Z ‚ààL‚àû(, FT , P ) which
are acceptable in the sense that there exists a d-dimensional predictable process Œæ such
that
Z +
T

k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚â•0
P -a.s.
As in Section 4.8, this set A induces a coherent measure of risk œÅ on L‚àû(, FT , P ):
œÅ(Z) = inf{ m ‚ààR | m + Z ‚ààA },
Z ‚ààL‚àû(, FT , P ).
Corollary 7.18 implies that œÅ can be represented as
œÅ(Z) = sup
P ‚àó‚ààP
E‚àó[ ‚àíZ ].
We therefore obtain a multiperiod version of Proposition 4.93.
‚ô¶
Remark 7.20. Often, the superhedging strategy in a given incomplete model can be
identiÔ¨Åed as the perfect hedge in an associated ‚Äúextremal‚Äù model. As an example,
consider a one-period model with d discounted risky assets given by bounded random
variables X1, . . . , Xd. Denote by ¬µ the distribution of X = (X1, . . . , Xd) and by
(¬µ) the convex hull of the support of ¬µ. The closure K := (¬µ) of (¬µ) is convex
and compact. We know from Section 1.5 that the model is arbitrage-free if and only if
the price system œÄ = (œÄ1, . . . , œÄd) is contained in the relative interior of (¬µ), and
the equivalent martingale measures can be identiÔ¨Åed with the measures ¬µ‚àó‚âà¬µ with

7.3 Superhedging of American and European claims
321
barycenter œÄ. Consider a derivative H = h(X) given by a convex function h on K.
The cost of superhedging is given by
sup
¬µ‚àó

h d¬µ‚àó= inf

Œ±(œÄ) | Œ± afÔ¨Åne on K, Œ± ‚â•h ¬µ-a.s.

,
which is a special case of the duality result of Theorem 1.31. Since {Œ± ‚â•h} is convex
and closed, the condition ¬µ(Œ± ‚â•h) = 1 implies Œ± ‚â•h on K. Denote by M(œÄ) the
class of all probability measures on K with barycenter œÄ. For any afÔ¨Åne function Œ±
with Œ± ‚â•h on K, and for any ¬µ ‚ààM(œÄ) we have

h d¬µ ‚â§

Œ± d¬µ = Œ±(œÄ).
Thus,
ÀÜh(œÄ) =
sup
¬µ‚ààM(œÄ)

h d¬µ
(7.10)
where we deÔ¨Åne for f ‚ààC(K)
ÀÜf := inf

Œ± | Œ± afÔ¨Åne on K, Œ± ‚â•f ¬µ-a.s.

.
The supremum in (7.10) is attained since M(œÄ) is weakly compact. More precisely,
it is attained by any measure ÀÜ¬µ ‚ààM(œÄ) on K which is maximal with respect to the
balayage order ‚âΩbal deÔ¨Åned for measures on K as in (2.18); see Th√©or√®me X. 41 in
[65]. But such a maximal measure is supported by the set of extreme points of the
convex compact set K, i.e., by the Choquet boundary of K. This follows from a
general integral representation theorem of Choquet; see, e.g., Th√©or√®me X. 43 of [65].
In our Ô¨Ånite-dimensional setting, ÀÜ¬µ can in fact be chosen to have a support consisting
of at most d + 1 points, due to a theorem of Carath√©odory and the representation of
K as the convex hull of its extreme points; see [166], Theorems 17.1 and 18.5. But
this means that ÀÜ¬µ can be identiÔ¨Åed with a complete model, due to Proposition 1.39.
Thus, the cost of superhedging ÀÜh(œÄ) can be identiÔ¨Åed with the canonical price
ÀÜœÄ :=

h d ÀÜ¬µ
of the derivative H, computed in the complete model ÀÜ¬µ. Note that ÀÜ¬µ sits on the Choquet
boundary of K = (¬µ), but typically it will no longer be equivalent or absolutely
continuous with respect to the original measure ¬µ. As a simple illustration, consider
a one-period model with one risky asset X1. If X1 is bounded, then the distribution
¬µ of X1 has bounded support, and (¬µ) is of the form [a, b]. In this case, the cost of
superhedging H = h(X1) for a convex function h is given by the price
p‚àóh(b) + (1 ‚àíp‚àó)h(a),
computed in the binary model in which X1 takes only the values a and b, and where
p‚àó‚àà(0, 1) is determined by
p‚àób + (1 ‚àíp‚àó)a = œÄ1.
‚ô¶

322
7 Superhedging
The following example illustrates that a superhedging strategy is typically too
expensive from a practical point of view. However, we will see in Chapter 8 how
superhedging strategies can be used in order to construct other hedging strategies
which are efÔ¨Åcient in terms of cost and shortfall risk.
Example 7.21. Consider a simple one-period model where S1
1 has under P a Poisson
distribution and where S0 ‚â°1. Let H := (S1
1 ‚àíK)+ be a call option with strike
K > 0. We have seen in Example 1.37 that œÄinf(H) and œÄsup(H) coincide with the
universal arbitrage bounds of Remark 1.36:
(S1
0 ‚àíK)+ = œÄinf(H)
and
œÄsup(H) = S1
0.
Thus, the superhedging strategy for the seller consists in the trivial hedge of buying
the asset at time 0, while the corresponding strategy for the buyer is a short-sale of the
asset in case the option is in the money, i.e., if S1
0 > K.
‚ô¶
7.4 Superhedging with liquid options
In practice, some derivatives such as put or call options are traded so frequently that
their prices are quoted just like those of the primary assets. The prices of such liquid
options can be regarded as an additional source of information on the expectations of
the market as to the future evolution of asset prices. This information can be exploited
in various ways. First, it serves to single out those martingale measures P ‚àówhich
are compatible with the observed options prices, in the sense that the observed prices
coincide with the expectations of the discounted payoff under P ‚àó. Second, liquid
options may be used as instruments for hedging more exotic options.
Our aim in this section is to illustrate these ideas in a simple setting. Assume that
there is only one risky asset S1 such that S1
0 is a positive constant, and that S0 is a
riskless bond with interest rate r = 0. Thus, the discounted price process of the risky
asset is given by Xt = S1
t ‚â•0 for t = 0, . . . , T . As the underlying space of scenarios,
we use the product space
 := [0, ‚àû)T .
We deÔ¨Åne Xt(œâ) = xt for œâ = (x1, . . . , xT ) ‚àà, and denote by Ft the œÉ-algebra
generated by X0, . . . , Xt; note that F0 = {‚àÖ, }. No probability measure P is given
a priori. Let us now introduce a linear space X of FT -measurable functions as the
smallest linear space such that the following conditions are satisÔ¨Åed:
(a) 1 ‚ààX.
(b) (Xt ‚àíXs) IA ‚ààX for 0 ‚â§s < t ‚â§T and A ‚ààFs.
(c) (Xt ‚àíK)+ ‚ààX for K ‚â•0 and t = 1, . . . , T .

7.4 Superhedging with liquid options
323
The functions in the space X will be interpreted as (discounted) payoffs of liquid
derivatives. The constant 1 in (a) corresponds to a unit investment into the riskless
bond. The function Xt ‚àíXs in (b) corresponds to the payoff of a forward contract on
the risky asset, issued at time s for the price Xs and expiring at time t. The decision
to buy such a forward contract at time s may depend on the market situation at time s;
this is taken into account by allowing for payoffs (Xt ‚àíXs) IA with A ‚ààFs. Linearity
of X together with conditions (a) and (b) implies that
Xt ‚ààX
for all t.
Finally, condition (c) states that call options with any possible strike and any maturity
up to time T can be used as liquid securities.
Suppose that a linear pricing rule  is given on X. The value (Y) will be
interpreted as the market price of the liquid security Y ‚ààX. The price of a liquid call
option with strike K and maturity t will be denoted by
Ct(K) := 

(Xt ‚àíK)+
.
Assumption 7.22. We assume that  : X ‚ÜíR is a linear functional which satisÔ¨Åes
the following conditions.
(a) (1) = 1.
(b) (Y) ‚â•0 if Y ‚â•0.
(c) 

(Xt ‚àíXs) IA

= 0 for all 0 ‚â§s < t ‚â§T and A ‚ààFs.
(d) Ct(K) = 

(Xt ‚àíK)+
‚Üí0 as K ‚Üë‚àûfor all t.
The Ô¨Årst two conditions must clearly be satisÔ¨Åed if the pricing rule  shall not
create arbitrage opportunities. Condition (c) states that Xs is the fair price for a forward
contract issued at time s. This condition is quite natural in view of Theorem 5.30.
In our present setting, it can also be justiÔ¨Åed by the following simple replication
argument. At time s, take out a loan Xs(œâ) and use it for buying the asset. At time t,
the asset is worth Xt(œâ) and the loan must be paid back, which results in a balance
Xt(œâ) ‚àíXs(œâ). Since this investment strategy requires zero initial capital, the price
of the corresponding payoff should also be zero. The continuity condition (d) is also
quite natural.
Our Ô¨Årst goal is to show that any such pricing rule  is compatible with the
paradigm that arbitrage-free prices can be identiÔ¨Åed as expectations with respect to
some martingale measure forX. More precisely, we are going to construct a martingale
measure P ‚àósuch that (Y) = E‚àó[ Y ] for all Y ‚ààX. On the one hand, this will imply
regularity properties of . On the other hand, this will yield an extension of our pricing
rule  to a larger space of payoffs including path-dependent exotic options. As a Ô¨Årst
step in this direction, we have the following result.

324
7 Superhedging
Lemma 7.23. For each t, there exists a unique probability measure ¬µt on [0, ‚àû) such
that for all K ‚â•0
Ct(K) = 

(Xt ‚àíK)+
=

(x ‚àíK)+ ¬µt(dx).
In particular, ¬µt has the mean

x ¬µt(dx) = X0.
Proof. Since K ‚Üí(Xt ‚àíK)+ is convex and decreasing, linearity and positivity of
 imply that the function œÜt(K) := 

(Xt ‚àíK)+
is convex and decreasing as well.
Hence, there exists a decreasing right-continuous function f : [0, ‚àû) ‚Üí[0, ‚àû) such
that
Ct(K) = Ct(0) ‚àí
 K
0
f (x) dx
= X0 ‚àí
 K
0
f (x) dx,
i.e., ‚àíf (K) is equal to the right-hand derivative of Ct(K) at K. Our fourth condition
on  yields
 ‚àû
0
f (x) dx = X0,
so that f (x) ‚Üò0 as x ‚Üë‚àû. Hence, there exists a positive measure ¬µt on (0, ‚àû)
such that
f (x) = ¬µt

(x, ‚àû)

for x > 0.
Fubini‚Äôs theorem implies

(0,‚àû)
x ¬µt(dx) =
 ‚àû
0
f (y) dy = X0
and
Ct(K) = X0 ‚àí
 K
0

(0,‚àû)
I{y<x} ¬µt(dx) dy
=

(0,‚àû)
(x ‚àíK)+ ¬µt(dx).
It remains to show that ¬µt can be extended to a probability measure on [0, ‚àû),
i.e., we must show that ¬µt

(0, ‚àû)

‚â§1. To this end, we will use the ‚Äúput-call parity‚Äù
Ct(K) = X0 ‚àíK + 

(K ‚àíXt)+
,

7.4 Superhedging with liquid options
325
which follows from our assumptions on . Thus,


(K ‚àíXt)+
=
 K
0
g(x) dx,
where g(x) = 1 ‚àíf (x). Since K ‚Üí

(K ‚àíXt)+
is increasing, g must be
non-negative, and we obtain 1 ‚â•f (0) = ¬µt

(0, ‚àû)

.
The following lemma shows that the measures ¬µt constructed in Lemma 7.23 are
related to each other by the balayage order ‚âΩbal, deÔ¨Åned by
¬µ ‚âΩbal ŒΩ
‚áê‚áí

f d¬µ ‚â•

f dŒΩ
for all convex functions f
for probability measures with Ô¨Ånite expectation; see Remark 2.65.
Lemma 7.24. The map t ‚Üí¬µt is increasing with respect to the balayage order ‚âΩbal:
¬µt+1 ‚âΩbal ¬µt
for all t.
Proof. Note that
(Xt+1 ‚àíK)+ ‚àí(Xt+1 ‚àíXt) I{Xt>K} ‚àí(Xt ‚àíK)+
= (Xt+1 ‚àíK)+ ‚àí(Xt+1 ‚àíK)+ I{Xt>K}
‚â•0.
Since the price of the forward contract (Xt+1‚àíXt) I{Xt>K} vanishes under our pricing
rule , we must have that for all K ‚â•0

(x ‚àíK)+ ¬µt+1 (dx) ‚àí

(x ‚àíK)+ ¬µt(dx)
= Ct+1(K) ‚àíCt(K)
‚â•0.
An application of Corollary 2.62 concludes the proof.
Let us introduce the class
P =

P ‚àó‚ààM1(, F ) | E‚àó[ Y ] = (Y) for all Y ‚ààX

of all probability measures P ‚àóon (, F ) which coincide with  on X. Note that for
any P ‚àó‚ààP,
E‚àó[ (Xt ‚àíXs) IA ] = 0
for s < t and A ‚ààFs,
so that P consists of martingale measures for X. Our Ô¨Årst main result in this section
can be regarded as a version of the ‚Äúfundamental theorem of asset pricing‚Äù without an
a priori measure P .

326
7 Superhedging
Theorem 7.25. Under Assumption 7.22, the class P is non-empty. Moreover, there
exists P ‚àó‚ààP with the Markov property: For 0 ‚â§s ‚â§t ‚â§T and each bounded
measurable function f ,
E‚àó[ f (Xt) | Fs ] = E‚àó[ f (Xt) | Xs ].
Proof. Since ¬µt+1 ‚âΩbal ¬µt, Corollary 2.62 yields the existence of stochastic kernel
Qt+1 such that

y Qt+1(x, dy) = x and ¬µt+1 = ¬µtQt+1. Let us deÔ¨Åne
P ‚àó:= ¬µ1 ‚äóQ2 ‚äó¬∑ ¬∑ ¬∑ ‚äóQT ,
i.e., for each measurable set A ‚äÇ = [0, ‚àû)T
P ‚àó[ A ] =

¬µ1(dx1)

Q2(x1, dx2) . . .

QT (xT ‚àí1, dxT ) IA(x1, x2, . . . , xT ).
Clearly, ¬µt is the law of Xt under P ‚àó. In particular, all call options are priced correctly
by calculating their expectation with respect to P ‚àó. Then one checks that
E‚àó[ f (Xt+1) | Ft ] =

f (y) Qt+1(Xt, dy) = E‚àó[ f (Xt+1) | Xt ]
P ‚àó-a.s.
(7.11)
The Ô¨Årst identity above implies E‚àó[ Xt+1 ‚àíXt | Ft ] = 0. In particular, P ‚àóis
a martingale measure, and the expectation of (Xt ‚àíXs) IA vanishes for s < t and
A ‚ààFs. It follows that E‚àó[ Y ] = (Y) for all Y ‚ààX. Finally, an induction argument
applied to (7.11) yields the Markov property.
So far, we have assumed that our space X of liquidly traded derivatives contains
call options with all possible strike prices and maturities. From now on, we will
simplify our setting by assuming that only call options with maturity T are liquidly
traded. Thus, we replace X by the smaller space XT which is deÔ¨Åned as the linear
hull of the constants, of all forward contracts
(Xt ‚àíXs) IA,
0 ‚â§s < t ‚â§T, A ‚ààFs,
and of all call options
(XT ‚àíK)+,
K ‚â•0,
with maturity T . The observed market prices of derivatives in XT are as before
modeled by a linear pricing rule
T : XT ‚ÜíR.
We assume that T satisÔ¨Åes Assumption 7.22 in the sense that condition (d) is only
required for t = T :
(d‚Ä≤) CT (K) := T

(XT ‚àíK)+
‚Üí0 as K ‚Üë‚àû.

7.4 Superhedging with liquid options
327
By
PT =

P ‚àó‚ààM1(, F ) | E‚àó[ Y ] = T (Y) for all Y ‚ààXT

we denote the class of all probability measures P ‚àóon (, F ) which coincide with T
onXT . Asbefore, itfollowsfromcondition(c)ofAssumption7.22thatanyP ‚àó‚ààPT
will be a martingale measure for the price process X. Obviously, any linear pricing
rule  which is deÔ¨Åned on the full space X and which satisÔ¨Åes Assumption 7.22 can
be restricted to XT , and this restriction satisÔ¨Åes the above assumptions. Thus, we
have PT ‚äÉP Ã∏= ‚àÖ.
Proposition 7.26. Under the above assumptions, PT is non-empty.
Proof. Let ¬µT be the measure constructed in Lemma 7.23 from the call prices with
maturity T . Now consider the measure 
P on (, F ) deÔ¨Åned as

P := Œ¥X0 ‚äó¬∑ ¬∑ ¬∑ ‚äóŒ¥X0 ‚äó¬µT ,
i.e., under 
P we have Xt = X0 
P -a.s. for t < T , and the law of XT is ¬µT . Clearly,
we have 
P ‚ààPT .
A measure P ‚àó‚ààPT can be regarded as an extension of the pricing rule T to
the larger space L1(P ‚àó), and the expectation E‚àó[ H ] of some European claim H ‚â•0
can be regarded as an arbitrage-free price for H. Our aim is to obtain upper and
lower bounds for E‚àó[ H ] which hold simultaneously for all P ‚àó‚ààP. We will derive
such bounds for various exotic options; this will amount to the construction of certain
superhedging strategies in terms of liquid securities.
As a Ô¨Årst example, we consider the following digital option
H dig :=
Ô£±
Ô£≤
Ô£≥
1
if max
0‚â§t‚â§T Xt ‚â•B
0
otherwise,
which has a unit payoff if the price processes reaches a given upper barrier B > X0.
If we denote by
œÑB := inf{ t ‚â•0 | Xt ‚â•B }
the Ô¨Årst hitting time of the barrier B, then the payoff of the digital option can also be
described as
H dig = I{œÑB‚â§T }.
For simplicity, we will assume from now on that
CT (B) > 0,
so that in particular ¬µT

(B, ‚àû)

> 0.

328
7 Superhedging
Theorem 7.27. The following upper bound on the arbitrage-free prices of the digital
option holds:
max
P ‚àó‚ààPT
E‚àó[ H dig ] =
min
0‚â§K<B
CT (K)
B ‚àíK .
(7.12)
Proof. For 0 ‚â§K < B, we have XœÑB ‚â•B. Hence,
H dig = I{œÑB‚â§T } ‚â§(XT ‚àíK)+
B ‚àíK
+ XœÑB ‚àíXT
B ‚àíK
I{œÑB‚â§T }.
Taking expectations with respect to some P ‚àó‚ààPT yields
E‚àó[ H dig ] ‚â§CT (K)
B ‚àíK +
1
B ‚àíK E‚àó[ (XœÑB ‚àíXT ) I{œÑB‚â§T } ].
Since P ‚àóis a martingale measure, the stopping theorem in the form of Proposition 6.38
implies
E‚àó[ XT I{œÑB‚â§T } ] = E‚àó[ XœÑB I{œÑB‚â§T } ].
This shows that
sup
P ‚àó‚ààPT
E‚àó[ H dig ] ‚â§
inf
0‚â§K<B
CT (K)
B ‚àíK .
The proof will be completed by Lemmas 7.28 and 7.29 below.
Lemma 7.28. If we let
Œª := 1 ‚àí
inf
0‚â§K<B
CT (K)
B ‚àíK ‚àà(0, 1),
then the inÔ¨Åmum on the right-hand side is attained in K if and only if K belongs to
the set of Œª-quantiles for ¬µT , i.e., if and only if
¬µT ([0, K)) ‚â§Œª ‚â§¬µT ([0, K]).
In particular, it is attained in
K‚àó:= inf

K | ¬µT ([0, K]) ‚â•Œª

.
Proof. The convex function CT has left- and right-hand derivatives
(CT )‚Ä≤
‚àí(K) = ‚àí¬µT

[K, ‚àû)

and
(CT )‚Ä≤
+(K) = ‚àí¬µT

(K, ‚àû)

;
see also PropositionA.4. Thus, the function g(K) := CT (K)/(B‚àíK) has a minimum
in K if and only if its left- and right-hand derivatives satisfy
g‚Ä≤
‚àí(K) ‚â§0
and
g‚Ä≤
+(K) ‚â•0.
By computing g‚Ä≤
‚àíand g‚Ä≤
+, one sees that these two conditions are equivalent to the
requirement that K is a Œª-quantile for ¬µT ; see Lemma A.15.

7.4 Superhedging with liquid options
329
Lemma 7.29. There exists a martingale measure ÀÜP ‚ààPT such that
ÀÜP [ œÑB ‚â§T ] =
min
0‚â§K<B
CT (K)
B ‚àíK .
Moreover, ÀÜP can be taken such that
œÑB = T ‚àí1
and
XœÑB = B
ÀÜP -a.s. on {œÑB ‚â§T }
and
{ XT > K‚àó} ‚äÇ{ œÑB ‚â§T } ‚äÇ{ XT ‚â•K‚àó}
modulo ÀÜP -nullsets,
where K‚àóis as in Lemma 7.28.
Proof. Let Œª be as in Lemma 7.28, and let
q(t) := q‚àí
¬µ (t) = inf

K | ¬µT ([0, K]) ‚â•t

be the lower quantile function for ¬µ; see A.3. We take an auxiliary probability space
(, 
F , 
P) supporting a random variable U which is uniformly distributed on (0, 1).
By Lemma A.19, 
XT := q(U) has distribution ¬µT under 
P . Let Œ≥ be such that
X0 = Œ≥ Œª + B(1 ‚àíŒª).
Since B > X0 we have 0 ‚â§Œ≥ < X0. We deÔ¨Åne 
XT ‚àí1 by

XT ‚àí1 := Œ≥ I{U‚â§Œª} + B I{U>Œª},
and we let 
Xt := X0 for 0 ‚â§t ‚â§T ‚àí2.
We now prove that 
X is a martingale with respect to its natural Ô¨Åltration 
Ft :=
œÉ(
X0, . . . , 
Xt). To this end, note Ô¨Årst that 
FT ‚àí2 = {‚àÖ, }, and hence

E[ 
XT ‚àí1 | 
FT ‚àí2 ] = 
E[ 
XT ‚àí1 ] = X0 = 
XT ‚àí2.
Furthermore, since K‚àó= q(Œª),

E[ 
XT ; 
XT ‚àí1 = B ] = 
E[ 
XT ; U > Œª ]
= 
E[ (
XT ‚àíK‚àó)+ ] + K‚àó
P [ U > Œª ]
= CT (K‚àó) + K‚àó(1 ‚àíŒª)
= (1 ‚àíŒª)(B ‚àíK‚àó) + K‚àó(1 ‚àíŒª)
= B ¬∑ 
P [ 
XT ‚àí1 = B ].
Hence,

E[ 
XT ; 
XT ‚àí1 = Œ≥ ] = 
E[ 
XT ] ‚àí
E[ 
XT ; 
XT ‚àí1 = B ]
= X0 ‚àíB ¬∑ 
P [ 
XT ‚àí1 = B ]
= Œ≥ 
P [ 
XT ‚àí1 = Œ≥ ],

330
7 Superhedging
It follows that

E[ 
XT | 
FT ‚àí1 ] = 
E[ 
XT | 
XT ‚àí1 ] = 
XT ‚àí1,
and so 
X is indeed a martingale.
As the next step, we note that
{ 
XT ‚â•B } ‚äÇ{ 
XT > K‚àó}
‚äÇ{ U > Œª } = { 
XT ‚àí1 = B }
‚äÇ{ U ‚â•Œª } ‚äÇ{ 
XT ‚â•K‚àó},
where we have used the fact that K‚àó= q(Œª). Hence, if we denote by œÑB := inf{ t ‚â•
0 | 
Xt ‚â•B } the Ô¨Årst time at which 
X hits the barrier B, then
{ 
XT > K‚àó} ‚äÇ

œÑB ‚â§T } = { 
XT ‚àí1 = B } ‚äÇ{ 
XT ‚â•K‚àó}.
Hence, {œÑB ‚â§T } = {œÑB = T ‚àí1} = {
XT ‚àí1 = B},

P[œÑB ‚â§T ] = 
P [ 
XT ‚àí1 = B ] = 1 ‚àíŒª =
min
0‚â§K<B
CT (K)
B ‚àíK ,
and the distribution ÀÜP of 
X under 
P is as desired.
Remark 7.30. The inequality
H dig ‚â§(XT ‚àíK)+
B ‚àíK
+ XœÑB ‚àíXT
B ‚àíK
I{œÑB‚â§T }
appearing in the proof of Theorem 7.27 can be interpreted in terms of a suitable
superhedging strategy for the claim H dig by using call options and forward contracts:
At time t = 0, we buy (B ‚àíK)‚àí1 call options with strike K, and at the Ô¨Årst time when
the price process passes the barrier B, we sell forward (B ‚àíK)‚àí1 shares of the asset.
This strategy will be optimal if the strike price K is such that it realizes the minimum
on the right-hand side of (7.12). By virtue of Lemma 7.28, such an optimal strike
price can be identiÔ¨Åed as the Value at Risk at level 1 ‚àíŒª of a short position ‚àíXT in
the asset.
‚ô¶
Let us now derive bounds on the arbitrage-free prices of barrier call options. More
precisely, we will consider an up-and-in call option
H call
u&i :=
Ô£±
Ô£≤
Ô£≥
(XT ‚àíK)+
if max
0‚â§t‚â§T Xt ‚â•B,
0
otherwise,
and the corresponding up-and-out call
H call
u&o :=
Ô£±
Ô£≤
Ô£≥
(XT ‚àíK)+
if max
0‚â§t‚â§T Xt < B,
0
otherwise.

7.4 Superhedging with liquid options
331
If the barrier B is below the strike price K, then the up-and-in call is identical to a
‚Äúplain vanilla call‚Äù (XT ‚àíK)+, and the payoff of the up-and-out call is zero. Thus,
we assume from now on that
K < B.
Recall that K‚àódenotes the minimizer of the function c ‚ÜíCT (c)/(B ‚àíc) as con-
structed in Lemma 7.28.
Theorem 7.31. For an up-and-in call option,
max
P ‚àó‚ààPT
E‚àó
H call
u&i

=
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
CT (K)
if K‚àó‚â§K,
B ‚àíK
B ‚àíK‚àóCT (K‚àó)
if K‚àó> K.
Proof. For any c with K ‚â§c < B,
H call
u&i ‚â§B ‚àíK
B ‚àíc (XT ‚àíc)+ + c ‚àíK
B ‚àíc (XœÑB ‚àíXT ) I{œÑB‚â§T }.
Indeed, on {XT ‚â§K} or on {œÑB > T } the payoff of H call
u&i is zero, and the right-
hand side is non-negative. On { XT ‚â•c, œÑB ‚â§T }, both sides are equal, and on
{ c > XT > K, œÑB ‚â§T } we may have a strict inequality. The expectation of the
right-hand side under a martingale measure P ‚àó‚ààPT is equal to
B ‚àíK
B ‚àíc CT (c) + c ‚àíK
B ‚àíc E‚àó
(XœÑB ‚àíXT ) I{œÑB‚â§T }

= B ‚àíK
B ‚àíc CT (c),
due to the stopping theorem. The minimum of this upper bound over all c ‚àà[K, B)
is attained in c = K ‚à®K‚àó, which shows ‚â§in the assertion.
Finally, let ÀÜP be the martingale measure constructed in Lemma 7.29. If K‚àó‚â§K
then
(XT ‚àíK)+ I{œÑB‚â§T } = (XT ‚àíK)+
ÀÜP -a.s.,
and so ÀÜE[ H call
u&i ] = CT (K). If K‚àó> K then ÀÜP -a.s.
B ‚àíK
B ‚àíK‚àó(XT ‚àíK‚àó)+ + K‚àó‚àíK
B ‚àíK‚àó(B ‚àíXT ) I{œÑB‚â§T } = H call
u&i.
Taking expectations with respect to ÀÜP concludes the proof.
Remark 7.32. The inequality
H call
u&i ‚â§B ‚àíK
B ‚àíc (XT ‚àíc)+ + c ‚àíK
B ‚àíc (XœÑB ‚àíXT ) I{œÑB‚â§T }
appearing in the preceding proof can be interpreted as a superhedging strategy for the
up-and-in call with liquid derivatives: At time t = 0, we purchase (B ‚àíK)/(B ‚àíc)
call options with strike c, and at the Ô¨Årst time when the stock price passes the barrier B,
we sell forward (c ‚àíK)/(B ‚àíc) shares of the asset. This strategy will be optimal for
c = K‚àó‚à®K.
‚ô¶

332
7 Superhedging
We now turn to the analysis of the up-and-out call option
H call
u&o = (XT ‚àíK)+ I{œÑB>T }.
Theorem 7.33. For an up-and-out call,
max
P ‚àó‚ààPT
E‚àó
H call
u&o

= CT (K) ‚àíCT (B) ‚àí(B ‚àíK) ¬µT

[B, ‚àû)

.
Proof. Clearly,
H call
u&o ‚â§(XT ‚àíK)+ I{XT <B}
(7.13)
= (XT ‚àíK)+ ‚àí(XT ‚àíB)+ ‚àí(B ‚àíK) I{XT ‚â•B}.
Taking expectations yields ‚â§in the assertion.
Now consider the measure 
P on (, F ) deÔ¨Åned as

P := Œ¥X0 ‚äó¬∑ ¬∑ ¬∑ ‚äóŒ¥X0 ‚äó¬µT ,
i.e., under 
P we have Xt = X0 
P -a.s. for t < T , and the law of XT is ¬µT . Clearly

P ‚ààPT , and (7.13) is 
P -a.s. an identity.
Using the identity
(XT ‚àíK)+ = H call
u&o + H call
u&i,
we get the following lower bounds as an immediate corollary.
Corollary 7.34. We have
min
P ‚àó‚ààPT
E‚àó
H call
u&i

= CT (B) + (B ‚àíK) ¬µT

[B, ‚àû)

,
and
min
P ‚àó‚ààPT
E‚àó
H call
u&o

=
Ô£±
Ô£≤
Ô£≥
0
if K‚àó‚â§K,
CT (K) ‚àíB ‚àíK
B ‚àíK‚àóCT (K‚àó)
if K‚àó> K.

Chapter 8
EfÔ¨Åcient hedging
In an incomplete Ô¨Ånancial market model, a contingent claim typically will not admit
a perfect hedge. Superhedging provides a method for staying on the safe side, but the
required cost is usually too high both from a theoretical and from a practical point of
view. It is thus natural to relax the requirements.
As a Ô¨Årst preliminary step, we consider strategies of quantile hedging which stay
on the safe side with high probability. In other words, we maximize the probability
for staying on the safe side under a given cost constraint. The main idea consists
in reducing the construction of such strategies for a given claim H to a problem of
superhedging for a modiÔ¨Åed claim 
H, which is the solution to a static optimization
problem of Neyman‚ÄìPearson type. Typically, 
H will have the form of a knock-out
option, that is, 
H = H ¬∑ IA. At this stage, we only focus on the probability that a
shortfall occurs; we do not take into account the size of the shortfall if it does occur.
In Section 8.2 we take a more comprehensive view of the downside risk. Our
discussion of risk measures in Section 4.8 suggests to quantify the downside risk in
terms of an acceptance set for suitably hedged positions. If acceptability is deÔ¨Åned
in terms of shortfall risk as in Section 4.9, we are led to the problem of constructing
efÔ¨Åcient strategies which minimize the shortfall risk under a given cost constraint.
As in the case of quantile hedging, this problem can be decomposed into a static
optimization problem and the construction of a superhedging strategy for a modiÔ¨Åed
payoff proÔ¨Åle 
H.
8.1 Quantile hedging
Let H be a discounted European claim in an arbitrage-free market model such that
œÄsup(H) = sup
P ‚àó‚ààP
E‚àó[ H ] < ‚àû.
We saw in Corollary 7.15 that there exists a self-Ô¨Ånancing trading strategy whose value
process V ‚ÜësatisÔ¨Åes
V ‚Üë
T ‚â•H
P -a.s.
By using such a superhedging strategy, the seller of H can cover almost any possible
obligation which may arise from the sale of H and thus eliminate completely the
corresponding risk. The smallest amount for which such a superhedging strategy is
available is given by œÄsup(H). This cost will often be too high from a practical point of
view, as illustrated by Example 7.21. Furthermore, if H is not attainable then œÄsup(H),

334
8 EfÔ¨Åcient hedging
viewed as a price for H, is too high from a theoretical point of view since it would
permit arbitrage. Even if H is attainable, a complete elimination of risk by using a
replicating strategy for H would consume the entire proceeds from the sale of H, and
any opportunity of making a proÔ¨Åt would be lost along with the risk.
Let us therefore suppose that the seller is unwilling to put up the initial amount
of capital required by a superhedge and is ready to accept some risk. What is the
optimal partial hedge which can be achieved with a given smaller amount of capital?
In order to make this question precise, we need a criterion expressing the seller‚Äôs
attitude towards risk. Several of such criteria will be studied in the following sections.
In this section, our aim is to construct a strategy which maximizes the probability of a
successful hedge given a constraint on the initial cost.
More precisely, let us Ô¨Åx an initial amount
v < œÄsup(H).
We are looking for a self-Ô¨Ånancing trading strategy whose value process maximizes
the probability
P [ VT ‚â•H ]
among all those strategies whose initial investment V0 is bounded by v and which
respect the bounds Vt ‚â•0 for t = 0, . . . , T . In view of Theorem 5.26, the second
restriction amounts to admissibility in the following sense:
DeÔ¨Ånition 8.1. A self-Ô¨Ånancing trading strategy is called an admissible strategy if its
value process satisÔ¨Åes VT ‚â•0.
The problem of quantile hedging consists in constructing an admissible strategy
Œæ‚àósuch that its value process V ‚àósatisÔ¨Åes
P [ V ‚àó
T ‚â•H ] = max P [ VT ‚â•H ]
(8.1)
where the maximum is taken over all value processes V of admissible strategies subject
to the constraint
V0 ‚â§v.
(8.2)
Note that this problem would not be well posed if considered without the constraint
of admissibility.
Let us emphasize that the idea of quantile hedging corresponds to a Value at Risk
criterion, and that it invites the same criticism: Only the probability of a shortfall is
taken into account, not the size of the loss if a shortfall occurs. This exclusive focus
on the shortfall probability may be reasonable in cases where a loss is to be avoided
by any means. But for most applications, other optimality criteria as considered in
the next section will usually be more appropriate from an economic point of view. In
view of the mathematical techniques, however, some key ideas already appear quite
clearly in our present context.

8.1 Quantile hedging
335
Let us Ô¨Årst consider the particularly transparent situation of a complete market
model before passing to the general incomplete case. The set
{ VT ‚â•H }
will be called the success set associated with the value process V of an admissible
strategy. As a Ô¨Årst step, we reduce our problem to the construction of a success set of
maximal probability.
Proposition 8.2. Let P ‚àódenote the unique equivalent martingale measure in a com-
plete market model, and assume that A‚àó‚ààFT maximizes the probability P [A] among
all sets A ‚ààFT satisfying the constraint
E‚àó[ H ¬∑ IA ] ‚â§v.
(8.3)
Then the replicating strategy Œæ‚àóof the knock-out option
H ‚àó:= H ¬∑ IA‚àó
solves the optimization problem deÔ¨Åned by (8.1) and (8.2), and A‚àócoincides up to
P-null sets with the success set of Œæ‚àó.
Proof. As a Ô¨Årst step, let V be the value process of any admissible strategy such that
V0 ‚â§v. We denote by A := {VT ‚â•H} the corresponding success set. Admissibility
yields that VT ‚â•H ¬∑ IA. Moreover, the results of Section 5.3 imply that V is a
P ‚àó-martingale. Hence, we obtain that
E‚àó[ H ¬∑ IA ] ‚â§E‚àó[ VT ] = V0 ‚â§v.
Therefore, A fulÔ¨Ålls the constraint (8.3) and it follows that
P [ A ] ‚â§P [ A‚àó].
As a second step, we consider the trading strategy Œæ‚àóand its value process V ‚àó.
Clearly, Œæ‚àóis admissible, and its success set satisÔ¨Åes
{ V ‚àó
T ‚â•H } = { H ¬∑ IA‚àó‚â•H } ‚äáA‚àó.
On the other hand, the Ô¨Årst part of the proof yields that
P [ V ‚àó
T ‚â•H ] ‚â§P [ A‚àó].
It follows that the two sets A‚àóand { V ‚àó
T ‚â•H } coincide up to P -null sets. In particular,
Œæ‚àóis an optimal strategy.
Our next goal is the construction of the optimal success set A‚àó, whose existence
was assumed in Proposition 8.2. This problem is solved by using the Neyman‚ÄìPearson
lemma. To this end, we introduce the measure Q‚àógiven by
dQ‚àó
dP ‚àó:=
H
E‚àó[ H ].
(8.4)

336
8 EfÔ¨Åcient hedging
The constraint (8.3) can be written as
Q‚àó[ A ] ‚â§Œ± :=
v
E‚àó[ H ].
(8.5)
Thus, an optimal success set must maximize the probability P [ A ] under the constraint
Q‚àó[ A ] ‚â§Œ±. We denote by dP/dQ‚àóthe generalized density of P with respect to Q‚àó
in the sense of the Lebesgue decomposition as constructed in Theorem A.13. Thus,
we may deÔ¨Åne the level
c‚àó:= inf

c ‚â•0
 Q‚àó
 dP
dQ‚àó> c ¬∑ E‚àó[ H ]

‚â§Œ±

,
(8.6)
and the set
A‚àó:=
 dP
dQ‚àó> c‚àó¬∑ E‚àó[ H ]

=
 dP
dP ‚àó> c‚àó¬∑ H

.
(8.7)
Proposition 8.3. If the set A‚àóin (8.7) satisÔ¨Åes
Q‚àó[ A‚àó] = Œ±,
then A‚àómaximizes the probability P [ A ] over all A ‚ààFT satisfying the constraint
E‚àó[ H ¬∑ IA ] ‚â§v.
Proof. The condition E‚àó[ H ¬∑IA ] ‚â§v is equivalent to Q‚àó[ A ] ‚â§Œ± = Q‚àó[ A‚àó]. Thus,
the particular form of the set A‚àóin (8.7) and the Neyman‚ÄìPearson lemma in the form
of Proposition A.28 imply that P [ A ] ‚â§P [ A‚àó].
By combining the two Propositions 8.2 and 8.3, we obtain the following result.
Corollary 8.4. Denote by P ‚àóthe unique equivalent martingale measure in a complete
market model, and assume that the set A‚àóof (8.7) satisÔ¨Åes
Q‚àó[ A‚àó] = Œ±.
Then the optimal strategy solving (8.1) and (8.2) is given by the replicating strategy
of the knock-out option H ‚àó= H ¬∑ IA‚àó.
Our solution to the optimization problem (8.1) and (8.2) still relies on the assump-
tion that the set A‚àóof (8.7) satisÔ¨Åes Q‚àó[ A‚àó] = Œ±. This condition is clearly satisÔ¨Åed
if
P
 dP
dP ‚àó= c‚àó¬∑ H

= 0.
However, it may not in general be possible to Ô¨Ånd any set A whose Q‚àó-probability
is exactly Œ±. In such a situation, the Neyman‚ÄìPearson theory suggests replacing the

8.1 Quantile hedging
337
indicator function IA‚àóof the ‚Äúcritical region‚Äù A‚àóby a randomized test, i.e., by an
FT -measurable [0, 1]-valued function œà. Let R denote the class of all randomized
tests, and consider the following optimization problem:
E[ œà‚àó] = max

E[ œà ] | œà ‚ààR and EQ‚àó[ œà ] ‚â§Œ±

,
where Q‚àóis the measure deÔ¨Åned in (8.4) and Œ± = v/E‚àó[ H ] as in (8.5). The gener-
alized Neyman‚ÄìPearson lemma in the form of Theorem A.30 states that the solution
is given by
œà‚àó= I
dP
dP ‚àó>c‚àó¬∑H
 + Œ≥ ¬∑ I
dP
dP‚àó=c‚àó¬∑H
,
(8.8)
where c‚àóis deÔ¨Åned through (8.6) and Œ≥ is chosen such that EQ‚àó[ œà‚àó] = Œ±, i.e.,
Œ≥ = Œ± ‚àíQ‚àó dP
dP ‚àó> c‚àó¬∑ H

Q‚àó dP
dP ‚àó= c‚àó¬∑ H

in case P
 dP
dP ‚àó= c‚àó¬∑ H

Ã∏= 0.
DeÔ¨Ånition 8.5. Let V be the value process of an admissible strategy Œæ. The success
ratio of Œæ is deÔ¨Åned as the randomized test
œàV = I{VT ‚â•H} + VT
H ¬∑ I{VT <H}.
Note that the set { œàV = 1 } coincides with the success set { VT ‚â•H } of V . In
the extended version of our original problem, we are now looking for a strategy which
maximizes the expected success ratio E[ œàV ] under the measure P under the cost
constraint V0 ‚â§v:
Theorem 8.6. Suppose that P ‚àóis the unique equivalent martingale measure in a
complete market model. Let œà‚àóbe given by (8.8), and denote by Œæ‚àóa replicating
strategy for the discounted claim H ‚àó= H ¬∑ œà‚àó. Then the success ratio œàV ‚àóof Œæ‚àó
maximizes the expected success ratio E[ œàV ] among all admissible strategies with
initial investment V0 ‚â§v. Moreover, the optimal success ratio œàV ‚àóis P -a.s. equal
to œà‚àó.
We do not prove this theorem here, as it is a special case of Theorem 8.7 below
and its proof is similar to the one of Corollary 8.4, once the optimal randomized test
œà‚àóhas been determined by the generalized Neyman‚ÄìPearson lemma. Note that the
condition
P
 dP
dP ‚àó= c‚àó¬∑ H

= 0
implies that œà‚àó= IA‚àówith A‚àóas in (8.7), so in this case the strategy Œæ‚àóreduces to
the one described in Corollary 8.4.

338
8 EfÔ¨Åcient hedging
Now we turn to the general case of an arbitrage-free but possibly incomplete market
model, i.e., we no longer assume that the set P of equivalent martingale measures
consists of a single element, but we assume only that
P Ã∏= ‚àÖ.
In this setting, our aim is to Ô¨Ånd an admissible strategy whose success ratio œàV ‚àó
satisÔ¨Åes
E[ œàV ‚àó] = max E[ œàV ],
(8.9)
where the maximum on the right-hand side is taken over all admissible strategies
whose initial investment satisÔ¨Åes the constraint
V0 ‚â§v.
(8.10)
Theorem 8.7. There exists a randomized test œà‚àósuch that
sup
P ‚àó‚ààP
E‚àó[ H ¬∑ œà‚àó] = v,
(8.11)
and which maximizes E[ œà ] among all œà ‚ààR subject to the constraints
E‚àó[ H ¬∑ œà ] ‚â§v
for all P ‚àó‚ààP .
(8.12)
Moreover, the superhedging strategy for the modiÔ¨Åed claim
H ‚àó= H ¬∑ œà‚àó
with initial investment œÄsup(H ‚àó) solves the problem (8.9) and (8.10).
Proof. Denote by R0 the set of all œà ‚ààR which satisfy the constraints (8.12), and
take a sequence œàn ‚ààR0 such that
E[ œàn ] ‚àí‚Üísup
œà‚ààR0
E[ œà ]
as n ‚Üë‚àû.
Lemma 1.69 yields a sequence of convex combinations 
œàn ‚ààconv{œàn, œàn+1, . . . }
converging P -a.s. to a function 
œà ‚ààR. Clearly, 
œàn ‚ààR0 for each n. Hence, Fatou‚Äôs
lemma yields that
E‚àó[ H 
œà ] ‚â§lim inf
n‚Üë‚àûE‚àó[ H 
œàn ] ‚â§v
for all P ‚àó‚ààP ,
and it follows that 
œà ‚ààR0. Moreover,
E[ 
œà ] = lim
n‚Üë‚àû
E[ 
œàn ] = lim
n‚Üë‚àû
E[ œàn ] = sup
œà‚ààR0
E[ œà ],
so œà‚àó:= 
œà is the desired maximizer.

8.2 Hedging with minimal shortfall risk
339
We must also show that (8.11) holds. To this end, note Ô¨Årst that P [ œà‚àó= 1 ] = 1 is
impossible due to our assumption v < œÄsup(H). Hence, if supP ‚àó‚ààP E‚àó[ H ¬∑ œà‚àó] < v,
then we can Ô¨Ånd some Œµ > 0 such that œàŒµ := Œµ+(1‚àíŒµ)œà‚àó‚ààR0, and the expectation
E[ œàŒµ ] must be strictly larger than E[ œà‚àó]. This, however, contradicts the maximality
of E[ œà‚àó].
Now let Œæ be any admissible strategy whose value process V satisÔ¨Åes V0 ‚â§v. If
œàV denotes the corresponding success ratio, then
H ¬∑ œàV = H ‚àßVT ‚â§VT .
The P -martingale property of V yields that for all P ‚àó‚ààP ,
E‚àó[ H ¬∑ œàV ] ‚â§E‚àó[ VT ] = V0 ‚â§v.
(8.13)
Therefore, œàV is contained in R0 and it follows that
E[ œàV ] ‚â§E[ œà‚àó].
(8.14)
Consider the superhedging strategy Œæ‚àóof H ‚àó= H ¬∑œà‚àóand denote by V ‚àóits value
process. Clearly, Œæ‚àóis an admissible strategy. Moreover,
V ‚àó
0 = œÄsup(H ‚àó) = sup
P ‚àó‚ààP
E‚àó[ H ¬∑ œà‚àó] = v.
Thus, (8.14) yields that œàV ‚àósatisÔ¨Åes
E[ œàV ‚àó] ‚â§E[ œà‚àó].
(8.15)
On the other hand, V ‚àó
T dominates H ‚àó, so
H ¬∑ œàV ‚àó= H ‚àßV ‚àó
T ‚â•H ‚àßH ‚àó= H ¬∑ œà‚àó.
Therefore, œàV ‚àódominates œà‚àóon the set { H > 0 }. Moreover, any success ratio is
equal to one on { H = 0 }, and we obtain that œàV ‚àó‚â•œà‚àóP -almost surely. According
to (8.15), this can only happen if the two randomized tests œàV ‚àóand œà‚àócoincide
P-almost everywhere. This proves that Œæ‚àósolves the hedging problem (8.9) and
(8.10).
8.2 Hedging with minimal shortfall risk
Our starting point in this section is the same as in the previous one: At time T , an
investor must pay the discounted random amount H ‚â•0. A complete elimination of
the corresponding risk would involve the cost
œÄsup(H) = sup
P ‚àó‚ààP
E‚àó[ H ]

340
8 EfÔ¨Åcient hedging
of superhedging H, but the investor is only willing to put up a smaller amount
v ‚àà

0, œÄsup(H)

.
This means that the investor is ready to take some risk: Any ‚Äúpartial‚Äù hedging strategy
whose value process V satisÔ¨Åes the capital constraint V0 ‚â§v will generate a non-trivial
shortfall
(H ‚àíVT )+.
In the previous section, we constructed trading strategies which minimize the shortfall
probability
P [ VT < H ]
among the class of trading strategies whose initial investment is bounded by v, and
which are admissible in the sense of DeÔ¨Ånition 8.1, i.e., their terminal value VT is
non-negative. In this section, we assess the shortfall in terms of a loss function, i.e.,
an increasing function ‚Ñì: R ‚ÜíR which is not identically constant. We assume
furthermore that
‚Ñì(x) = 0 for x ‚â§0
and
E[ ‚Ñì(H) ] < ‚àû.
A particular role will be played by convex loss functions, which correspond to risk
aversion in view of the shortfall; compare the discussion in Section 4.9.
DeÔ¨Ånition 8.8. Given a loss function ‚Ñìsatisfying the above assumptions, the shortfall
risk of an admissible strategy with value process V is deÔ¨Åned as the expectation
E

‚Ñì(H ‚àíVT )

= E

‚Ñì

(H ‚àíVT )+  
of the shortfall weighted by the loss function ‚Ñì.
Our aim is to minimize the shortfall risk among all admissible strategies satisfying
the capital constraint V0 ‚â§v. Alternatively, we could minimize the cost under a
given bound on the shortfall risk. In other words, the problem consists in constructing
strategies which are efÔ¨Åcient with respect to the trade-off between cost and shortfall
risk. This generalizes our discussion of quantile hedging in the previous Section 8.1,
whichcorrespondstoaminimizationoftheshortfallriskwithrespecttothenon-convex
loss function
‚Ñì(x) = I(0,‚àû)(x).
Remark 8.9. Recall our discussion of risk measures in Chapter 4. From this point of
view, it is natural to quantify the downside risk in terms of an acceptance set A for
hedged positions. As in Section 4.8, we denote by ¬ØA the class of all positions X such
that there exists an admissible strategy Œæ with value process V such that
V0 = 0
and
X + VT ‚â•A
P-a.s.

8.2 Hedging with minimal shortfall risk
341
for some A ‚ààA. Thus, the downside risk of the position ‚àíH takes the form
œÅ(‚àíH) = inf{ m ‚ààR | m ‚àíH ‚àà¬ØA }.
Suppose that the acceptance set A is deÔ¨Åned in terms of shortfall risk, i.e.,
A := { X ‚ààL‚àû| E[ ‚Ñì(X‚àí) ] ‚â§x0 },
where ‚Ñìis a convex loss function and x0 is a given threshold. Then œÅ(‚àíH) is the
smallest amount m such that there exists an admissible strategy Œæ whose value process
V satisÔ¨Åes V0 = m and
E

‚Ñì

(H ‚àíVT )+ 
‚â§x0.
For a given m, we are thus led to the problem of Ô¨Ånding a strategy Œæ which minimizes
the shortfall risk under the cost constraint V0 ‚â§m. In this way, the problem of
quantifying the downside risk of a contingent claim is reduced to the construction of
efÔ¨Åcient hedging strategies as discussed in this section.
‚ô¶
As in the preceding section, the construction of the optimal hedging strategy is
carried out in two steps. The Ô¨Årst one is to solve the ‚Äústatic‚Äù problem of minimizing
E[ ‚Ñì(H ‚àíY) ]
among all FT -measurable random variables Y ‚â•0 which satisfy the constraints
sup
P ‚àó‚ààP
E‚àó[ Y ] ‚â§v.
If Y ‚àósolves this problem, then so does Y := H ‚àßY ‚àó. Hence, we may assume that
0 ‚â§Y ‚àó‚â§H or, equivalently, that Y ‚àó= H œà‚àófor some randomized test œà‚àó, which
belongs to the set R of all FT -measurable random variables with values in [0, 1]. Thus,
the static problem can be reformulated as follows: Find a randomized test œà‚àó‚ààR
which minimizes the ‚Äúshortfall risk‚Äù
E

‚Ñì

H(1 ‚àíœà)

(8.16)
among all œà ‚ààR subject to the constraints
E‚àó[ H œà ] ‚â§v
for all P ‚àó‚ààP .
(8.17)
The next step is to Ô¨Åt the terminal value VT of an admissible strategy to the
optimal proÔ¨Åle H œà‚àó. It turns out that this step can be carried out without any further
assumptions on our loss function ‚Ñì. Thus, we assume at this point that the optimal œà‚àó
of step one is granted, and we construct the corresponding optimal strategy.
Theorem 8.10. Given a randomized test œà‚àówhich minimizes (8.16) subject to (8.17),
a superhedging strategy Œæ‚àófor the modiÔ¨Åed discounted claim
H ‚àó:= H œà‚àó
with initial investment œÄsup(H ‚àó) has minimal shortfall risk among all admissible strate-
gies Œæ which satisfy the capital constraint Œæ1 ¬∑ X0 ‚â§v.

342
8 EfÔ¨Åcient hedging
Proof. The proof extends the last argument in the proof of Theorem 8.7. As a Ô¨Årst
step, we take any admissible strategy Œæ such that the corresponding value process V
satisÔ¨Åes the capital constraint V0 ‚â§v. Denote by
œàV = I{VT ‚â•H} + VT
H ¬∑ I{VT <H}
the corresponding success ratio. It follows as in (8.13) that œàV satisÔ¨Åes the constraints
E‚àó[ H œàV

‚â§v
for all P ‚àó‚ààP .
Thus, the optimality of œà‚àóimplies the following lower bound on the shortfall risk
of Œæ:
E

‚Ñì

H ‚àíVT

= E

‚Ñì

H(1 ‚àíœàV )

‚â•E

‚Ñì

H(1 ‚àíœà‚àó)

.
In the second step, we consider the admissible strategy Œæ‚àóand its value process
V ‚àó. On the one hand,
V ‚àó
0 = œÄsup(H ‚àó) = sup
P ‚àó‚ààP
E‚àó[ H œà‚àó] ‚â§v,
so Œæ‚àósatisÔ¨Åes the capital constraint. Hence, the Ô¨Årst part of the proof yields
E

‚Ñì

H ‚àíV ‚àó
T

= E

‚Ñì

H(1 ‚àíœàV ‚àó)

‚â•E

‚Ñì

H(1 ‚àíœà‚àó)

.
(8.18)
On the other hand, V ‚àó
T ‚â•H ‚àó= H œà‚àó, and therefore
œàV ‚àó‚â•œà‚àó
P -a.s.
Hence, the inequality in (8.18) is in fact an equality, and the assertion follows.
Let us now return to the static problem deÔ¨Åned by (8.16) and (8.17). We start by
considering the special case of risk aversion in view of the shortfall.
Proposition 8.11. If the loss function ‚Ñìis convex, then there exists a randomized test
œà‚àó‚ààR which minimizes the shortfall risk
E

‚Ñì

H(1 ‚àíœà)

among all œà ‚ààR subject to the constraints
E‚àó[ H œà ] ‚â§v
for all P ‚àó‚ààP .
(8.19)
If ‚Ñìis strictly convex on [0, ‚àû), then œà‚àóis uniquely determined on {H > 0}.
Proof. The proof is similar to the one of Proposition 3.36. Let R0 denote the set of
all randomized tests which satisfy the constraints (8.19). Take œàn ‚ààR0 such that
E[‚Ñì( H(1‚àíœàn) )] converges to the inÔ¨Åmum of the shortfall risk, and use Lemma 1.69

8.2 Hedging with minimal shortfall risk
343
to select convex combinations 
œàn ‚ààconv{œàn, œàn+1, . . . } which converge P -a.s. to
some 
œà ‚ààR. Since ‚Ñìis continuous and increasing, Fatou‚Äôs lemma implies that
E

‚Ñì

H(1 ‚àí
œà)

‚â§lim inf
n‚Üë‚àûE

‚Ñì

H(1 ‚àí
œàn)

= inf
œà‚ààR0
E

‚Ñì

H(1 ‚àíœà)

,
where we have used the convexity of ‚Ñìto conclude that E[‚Ñì( H(1 ‚àí
œàn) )] tends to
the same limit as E[‚Ñì( H(1 ‚àíœàn) )].
Fatou‚Äôs lemma also yields that for all P ‚àó‚ààP
E‚àó[ H 
œà ] ‚â§lim inf
n‚Üë‚àûE‚àó[ H 
œàn ] ‚â§v.
Hence 
œà ‚ààR0, and we conclude that œà‚àó:= 
œà is the desired minimizer. The
uniqueness part is obvious.
Remark 8.12. The proof shows that the analogous existence result holds if we use a
robust version of the shortfall risk deÔ¨Åned as
sup
Q‚ààQ
EQ

‚Ñì

H(1 ‚àíœà)

,
where Q is a class of equivalent probability measures; see also Remark 3.37.
‚ô¶
Combining Proposition 8.11 and Theorem 8.10 yields existence and uniqueness
of an optimal hedging strategy under risk aversion in a general arbitrage-free market
model.
Corollary 8.13. Assume that the loss function ‚Ñìis strictly convex on [0, ‚àû). Then
there exists an admissible strategy which is optimal in the sense that it minimizes
the shortfall risk among all admissible strategies Œæ subject to the capital constraint
Œæ1 ¬∑ X0 ‚â§v. Moreover, any optimal strategy requires the exact initial investment v,
and its success ratio is P -a.s. equal to
œà‚àó¬∑ I{H>0} + I{H=0},
where œà‚àódenotes the solution of the static problem constructed in Proposition 8.11.
Proof. The existence of an optimal strategy follows by combining Proposition 8.11
and Theorem 8.10. Strict convexity of ‚Ñìimplies that œà‚àóis P -a.s. unique on {H > 0}.
Since ‚Ñìis strictly increasing on [0, ‚àû), œà‚àóand the success ratio œàV ‚àóof any optimal
strategy Œæ‚àómust coincide P -a.s. on {H > 0}. On {H = 0}, the success ratio œàV ‚àóis
equal to 1 by deÔ¨Ånition.
Since ‚Ñìis strictly increasing on [0, ‚àû), we must have that
sup
P ‚àó‚ààP
E‚àó[ H œà‚àó] = v,

344
8 EfÔ¨Åcient hedging
for otherwise we could Ô¨Ånd some Œµ > 0 such that œàŒµ := Œµ + (1 ‚àíŒµ)œà‚àówould also
satisfy the constraints (8.17). Since we have assumed that v < œÄsup(H), the constraints
(8.17) imply that œà‚àóÃ∏‚â°1 and hence that
E

‚Ñì

H(1 ‚àíœàŒµ)

< E

‚Ñì

H(1 ‚àíœà‚àó)

.
This, however, contradicts the optimality of œà‚àó.
Since the value process V ‚àóof an optimal strategy is a P -martingale, and since
V ‚àó
T ‚â•H œàV ‚àó= H œà‚àó,
we conclude from the above that
v ‚â•V ‚àó
0 = sup
P ‚àó‚ààP
E‚àó[ V ‚àó
T ] ‚â•sup
P ‚àó‚ààP
E‚àó[ H œà‚àó] = v.
Thus, V ‚àó
0 is equal to v.
Beyond the general existence statement of Proposition 8.11, it is possible to obtain
an explicit formula for the optimal solution of the static problem if the market model
is complete. Recall that we assume that the loss function ‚Ñì(x) vanishes for x ‚â§0. In
addition, we will also assume that
‚Ñìis strictly convex and continuously differentiable on (0, ‚àû).
Then the derivative ‚Ñì‚Ä≤ of ‚Ñìis strictly increasing on (0, ‚àû). Let J denote the inverse
function of ‚Ñì‚Ä≤ deÔ¨Åned on the range of ‚Ñì‚Ä≤, i.e., on the interval (a, b) where a :=
limx‚Üì0 ‚Ñì‚Ä≤(x) and b := limx‚Üë‚àû‚Ñì‚Ä≤(x). We extend J to a function J + : [0, ‚àû] ‚Üí[0, ‚àû]
by setting
J +(y) :=

+‚àû
for y ‚â•b,
0
for y ‚â§a.
From now on, we assume also that
P = {P ‚àó},
i.e., P ‚àóis the unique equivalent martingale measure in a complete market model. Its
density will be denoted by
œï‚àó:= dP ‚àó
dP .
Theorem 8.14. Under the above assumptions, the solution of the static optimization
problem of Proposition 8.11 is given by
œà‚àó= 1 ‚àíJ +(c œï‚àó)
H
‚àß1
P -a.s. on { H > 0 },
where the constant c is determined by the condition E‚àó[ H œà‚àó] = v.

8.2 Hedging with minimal shortfall risk
345
Proof. The problem is of the same type as those considered in Section 3.3. It can in
fact be reduced to Corollary 3.43 by considering the random utility function
u(x, œâ) := ‚àí‚Ñì(H(œâ) ‚àíx),
0 ‚â§x ‚â§H(œâ).
Just note that the shortfall risk E[ ‚Ñì(H ‚àíY) ] coincides with the negative expected
utility ‚àíE[u(Y, ¬∑) ] for any proÔ¨Åle Y such that 0 ‚â§Y ‚â§H. Moreover, since our
market model is complete, it has a Ô¨Ånite structure by Theorem 5.38, and so all inte-
grability conditions are automatically satisÔ¨Åed. Thus, Corollary 3.43 states that the
optimal proÔ¨Åle H ‚àó:= Y ‚àówhich maximizes the expected utility E[ u(Y, ¬∑) ] under the
constraints 0 ‚â§Y ‚â§H and E‚àó[ Y ] ‚â§v is given by
H ‚àó(œâ) = I +(c œï‚àó(œâ), œâ) ‚àßH(œâ) =

H(œâ) ‚àíJ +(c œï‚àó(œâ))
+.
Dividing by H yields the formula for the optimal randomized test œà‚àó.
Corollary 8.15. In the situation of Theorem 8.14, suppose that the objective proba-
bility measure P is equal to the martingale measure P ‚àó. Then the modiÔ¨Åed discounted
claim takes the simple form
H ‚àó= H œà‚àó=

H ‚àíJ +(c‚àó)
+.
Example 8.16. Consider the discounted payoff H of a European call option
(Si
T ‚àíK)+ with strike K under the assumption that the num√©raire S0 is a risk-
less bond, i.e., that S0
t = (1 + r)t for a certain constant r ‚â•0. If the assumptions
of Corollary 8.15 hold, then the modiÔ¨Åed proÔ¨Åle H ‚àóis the discounted value of the
European call option struck at 
K := K + J +(c‚àó) ¬∑ (1 + r)T , i.e.,
H ‚àó= (Si
T ‚àí
K)+
(1 + r)T
.
‚ô¶
Example 8.17. Consider an exponential loss function ‚Ñì(x) = (eŒ±x ‚àí1)+ for some
Œ± > 0. In this case,
J +(y) =
 1
Œ± log y
Œ±
+
,
y ‚â•0,
and the optimal proÔ¨Åle is given by
H ‚àó= H ‚àí
 1
Œ± log cœï‚àó
Œ±
+
‚àßH.
‚ô¶
Example 8.18. If ‚Ñìis the particular loss function
‚Ñì(x) = xp
p ,
x ‚â•0,

346
8 EfÔ¨Åcient hedging
for some p > 1, then the problem is to minimize a lower partial moment of the
difference VT ‚àíH. Theorem 8.14 implies that it is optimal to hedge the modiÔ¨Åed
claim
H œà‚àó
p = H ‚àí(cp ¬∑ œï‚àó)1/(p‚àí1) ‚àßH
(8.20)
where the constant cp is determined by E‚àó[ H œà‚àó
p

= v.
‚ô¶
Let us now consider the limit p ‚Üë‚àûin (8.20), corresponding to ever increasing
risk aversion with respect to large losses.
Proposition 8.19. Let us consider the loss functions
‚Ñìp(x) = xp
p ,
x ‚â•0,
for p > 1. As p ‚Üë‚àû, the modiÔ¨Åed claims H œà‚àó
p of (8.20) converge P -a.s. and in
L1(P ‚àó) to the discounted claim
(H ‚àíc‚àû)+
where the constant c‚àûis determined by
E‚àó[ (H ‚àíc‚àû)+ ] = v.
(8.21)
Proof. Let Œ≥ (p) be shorthand for 1/(p ‚àí1) and note that
(œï‚àó)Œ≥ (p) ‚àí‚Üí1
P -a.s. as p ‚Üë‚àû.
Hence, if (pn) is a sequence for which cŒ≥ (pn)
pn
converges to some c ‚àà[0, ‚àû], then
lim
n‚Üë‚àûH œà‚àó
pn = H ‚àíc ‚àßH = (H ‚àíc )+.
Hence,
E‚àó[ H œà‚àó
pn ] ‚àí‚ÜíE‚àó[ (H ‚àíc )+ ].
Since each term on the left-hand side equals v, we must have
E‚àó[ (H ‚àíc )+ ] = v,
which determines c uniquely as the constant c‚àûof (8.21).
Example 8.20. If the discounted claim H in Proposition 8.19 is the discounted payoff
of a call option with strike K, and the num√©raire is a riskless bond as in Example 8.16,
then the limiting proÔ¨Åle limp‚Üë‚àûH œà‚àó
p is equal to the discounted call with the higher
strike price K + c‚àû¬∑ S0
T .
‚ô¶
In the remainder of this section, we consider loss functions which are not convex
but which correspond to risk neutrality and to risk-seeking preferences. Let us Ô¨Årst
consider the risk-neutral case.

8.2 Hedging with minimal shortfall risk
347
Example 8.21. In the case of risk neutrality, the loss function is given by
‚Ñì(x) = x
for x ‚â•0.
Thus, the task is to minimize the expected shortfall
E[ (H ‚àíVT )+ ]
under the capital constraint V0 ‚â§v. Let P ‚àóbe the unique equivalent martingale
measure in a complete market model.
Then the static problem corresponding to
Proposition 8.11 is to maximize the expectation
E[ H œà ]
under the constraint that œà ‚ààR satisÔ¨Åes
E‚àó[ H œà ] ‚â§v.
For simplicity, we assume P [ H > 0 ] = 1. Then we can deÔ¨Åne two equivalent
measures Q and Q‚àóby
dQ
dP =
H
E[ H ]
and
dQ‚àó
dP ‚àó=
H
E‚àó[ H ].
The problem then becomes the hypothesis testing problem of maximizing EQ[ œà ]
under the side condition
EQ‚àó[ œà ] ‚â§Œ± :=
v
E‚àó[ H ].
Since the density dQ/dQ‚àóis proportional to the inverse of the density œï‚àó= dP ‚àó/dP ,
Theorem A.30 implies that the optimal test takes the form
œà‚àó
1 = I{œï‚àó<c1} + Œ≥ ¬∑ I{œï‚àó=c1}
where the constant c1 is given by
c1 = sup

c ‚ààR | E‚àó[ H; œï‚àó< c ] ‚â§v

,
and where the constant Œ≥ is chosen such that E‚àó[ H œà‚àó
1 ] = v.
‚ô¶
Assume now that the shortfall risk is assessed by an investor who, instead of being
risk-averse, is in fact inclined to take risk. In our context, this corresponds to a loss
function which is concave on [0, ‚àû) rather than convex. It is not difÔ¨Åcult to generalize
Theorem 8.14 so that it covers this situation. Here we limit ourselves to the following
explicit case study.

348
8 EfÔ¨Åcient hedging
Example 8.22. Consider the loss function
‚Ñì(x) = xq
q ,
x ‚â•0,
for some q ‚àà(0, 1). In order to solve our static optimization problem, one could
apply the results and techniques of Section 3.3. Here we will use an approach based
on the Neyman‚ÄìPearson lemma. Note Ô¨Årst that for œà ‚ààR
‚Ñì

H(1 ‚àíœà)

= (1 ‚àíœà)q ¬∑ ‚Ñì(H) ‚â•‚Ñì(H) ‚àíœà ¬∑ ‚Ñì(H).
Hence, we get a lower bound on the ‚Äúshortfall risk‚Äù of œà:
E

‚Ñì

H(1 ‚àíœà)
 
‚â•E

‚Ñì(H)

‚àíE

œà ¬∑ ‚Ñì(H)

.
(8.22)
The problem of Ô¨Ånding a minimizer of the right-hand side is equivalent to maximiz-
ing the expectation EQ[ œà ] under the constraint that EQ‚àó[ œà ] ‚â§v/E‚àó[ H ] for the
measures Q and Q‚àódeÔ¨Åned via
dQ
dP =
H q
E[ H q ]
and
dQ‚àó
dP ‚àó=
H
E‚àó[ H ],
if we assume again P [ H > 0 ] = 1. As in Example 8.21, we then conclude that the
optimal test must be of the form
I{1>c‚àó
qœï‚àóH 1‚àíq} + Œ≥ ¬∑ I{1=c‚àó
qœï‚àóH 1‚àíq}.
(8.23)
for certain constants c‚àó
q and Œ≥ . Under the simplifying assumption that
P [ 1 = c‚àó
qœï‚àóH 1‚àíq ] = 0,
(8.24)
the formula (8.23) reduces to
œà‚àó
q =

1
on { 1 > c‚àó
qœï‚àóH 1‚àíq },
0
otherwise.
(8.25)
By taking œà = œà‚àó
q we obtain an identity in (8.22), and so œà‚àó
q must be a minimizer for
E[ ‚Ñì(H(1 ‚àíœà)) ] under the constraint that E‚àó[ H œà ] ‚â§v.
‚ô¶
In our last result of this section, we recover the knock-out option
H ¬∑ I{1>c‚àó
0¬∑H œï‚àó},
which was obtained as the solution to the problem of quantile hedging by taking the
limit q ‚Üì0 in (8.25). Intuitively, decreasing q corresponds to an increasing appetite
for risk in view of the shortfall.

8.2 Hedging with minimal shortfall risk
349
Proposition 8.23. Let us assume for simplicity that (8.24) holds for all q ‚àà(0, 1),
that P [ H > 0 ] = 1, and that there exists a unique constant c‚àó
0 such that
E‚àó
H ¬∑ I{1>c‚àó
0¬∑H œï‚àó}

= v.
(8.26)
Then the solutions œà‚àó
q of (8.25) converge P -a.s. to the solution
œà‚àó
0 = I{1>c‚àó
0¬∑H œï‚àó}
of the corresponding problem of quantile hedging as constructed in Proposition 8.3.
Proof. Take any sequence qn ‚Üì0 such that (c‚àó
qn)1/(1‚àíqn) converges to somec ‚àà[0, ‚àû].
Then
lim
n‚Üë‚àûœà‚àó
qn = I{1>c¬∑H œï‚àó}.
Hence,
E‚àó[ H œà‚àó
qn ] ‚àí‚ÜíE‚àó
H ¬∑ I{1>c¬∑H œï‚àó}

.
Since we assumed (8.24) for all q ‚àà(0, 1), the left-hand terms are all equal to v, and
it follows from (8.26) that c = c‚àó
0. This establishes the desired convergence.

Chapter 9
Hedging under constraints
So far, we have focussed on frictionless market models, where asset transactions can
be carried out with no limitation. In this chapter, we study the impact of market
imperfections generated by convex trading constraints. Thus, we develop the theory
of dynamic hedging under the condition that only trading strategies from a given
class S may be used. In Section 9.1 we characterize those market models for which
S does not contain arbitrage opportunities. Then we take a direct approach to the
superhedging duality for American options. To this end, we Ô¨Årst derive a uniform
Doob decomposition under constraints in Section 9.2. The appropriate upper Snell
envelopes are analyzed in Section 9.3. In Section 9.4 we derive a superhedging duality
under constraints, and we explain its role in the analysis of convex risk measures in a
Ô¨Ånancial market model.
9.1 Absence of arbitrage opportunities
In practice, it may be reasonable to restrict the class of trading strategies which are
admissible for hedging purposes. As discussed in Section 4.8, there may be upper
bounds on the capital invested into risky assets, or upper and lower bounds on the
number of shares of an asset. Here we model such portfolio constraints by a set S of
d-dimensional predictable processes, viewed as admissible investment strategies into
risky assets. Throughout this chapter, we will assume that S satisÔ¨Åes the following
conditions:
(a) 0 ‚ààS.
(b) S is predictably convex: If Œæ, Œ∑ ‚ààS and h is a predictable process with
0 ‚â§h ‚â§1, then the process
ht Œæt + (1 ‚àíht) Œ∑t,
t = 1, . . . , T,
belongs to S.
(c) For each t ‚àà{1, . . . , T }, the set
St := { Œæt | Œæ ‚ààS }
is closed in L0(, Ft‚àí1, P; Rd).
(d) For all t, Œæt ‚ààSt implies Œæ‚ä•
t
‚ààSt.

9.1 Absence of arbitrage opportunities
351
In order to explain condition (d), let us recall from Lemma 1.65 that each Œæt ‚àà
L0(, Ft‚àí1, P ; Rd) can be uniquely decomposed as
Œæt = Œ∑t + Œæ‚ä•
t ,
where Œ∑t ‚ààNt and Œæ‚ä•
t
‚ààN‚ä•
t ,
and where
Nt =

Œ∑t ‚ààL0(, Ft‚àí1, P; Rd) | Œ∑t ¬∑ (Xt ‚àíXt‚àí1) = 0 P -a.s.

,
N‚ä•
t
=

Œæt ‚ààL0(, Ft‚àí1, P; Rd) | Œæt ¬∑ Œ∑t = 0 P -a.s. for all Œ∑t ‚ààNt

.
Remark 9.1. Under condition (d), we may replace Œæt ¬∑(Xt ‚àíXt‚àí1) by Œæ‚ä•
t ¬∑(Xt ‚àíXt‚àí1),
and Œæ‚ä•
t ¬∑ (Xt ‚àíXt‚àí1) = 0 P -a.s. implies Œæ‚ä•
t
= 0. Note that condition (d) holds if
the price increments satisfy the following non-redundance condition: For all t ‚àà
{1, . . . , T } and Œæt ‚ààL0(, Ft‚àí1, P; Rd),
Œæt ¬∑ (Xt ‚àíXt‚àí1) = 0 P -a.s.
"‚áí
Œæt = 0 P -a.s.
(9.1)
‚ô¶
Example 9.2. For each t let Ct be a closed convex subset of Rd such that 0 ‚ààCt. Take
S as the class of all d-dimensional predictable processes Œæ such that Œæt ‚ààCt P -a.s.
for all t. If the non-redundance condition (9.1) holds, then S satisÔ¨Åes conditions (a)
through (d). This case includes short sales constraints and restrictions on the size of
a long position.
‚ô¶
Example 9.3. Let a, b be two constants such that ‚àí‚àû‚â§a < 0 < b ‚â§‚àû, and take
S as the set of all d-dimensional predictable processes such that
a ‚â§Œæt ¬∑ Xt‚àí1 ‚â§b
P-a.s. for t = 1, . . . , T .
This class S corresponds to constraints on the capital invested into risky assets. If
we assume that the non-redundance condition (9.1) holds, then S satisÔ¨Åes conditions
(a) through (d). More generally, instead of the two constants a and b, one can take
dynamic margins deÔ¨Åned via two predictable processes (at) and (bt).
‚ô¶
Let S denote the set of all self-Ô¨Ånancing trading strategies Œæ = (Œæ0, Œæ) which arise
from an investment strategy Œæ ‚ààS, i.e.,
S =

Œæ = (Œæ0, Œæ) | Œæ is self-Ô¨Ånancing and Œæ ‚ààS

.
In this section, our goal is to characterize the absence of arbitrage opportunities in S.
The existence of an equivalent martingale measure P ‚àó‚ààP is clearly sufÔ¨Åcient. A
condition which is both necessary and sufÔ¨Åcient will involve a larger class PS ‚äÉP .
In order to introduce this condition, we need some preparation.

352
9 Hedging under constraints
DeÔ¨Ånition 9.4. An adapted stochastic process Z on (, F , (Ft), Q) is called a local
Q-martingale if there exists a sequence of stopping times (œÑn)n‚ààN ‚äÇT such that
œÑn ‚ÜóT Q-a.s., and such that the stopped processes ZœÑn are Q-martingales. The
sequence (œÑn)n‚ààN is called a localizing sequence for Z. In the same way, we deÔ¨Åne
local supermartingales and local submartingales.
Remark 9.5. If Q is a martingale measure for the discounted price process X, then
the value process V of each self-Ô¨Ånancing trading strategy Œæ = (Œæ0, Œæ) is a local
Q-martingale. To prove this, one can take the sequence
œÑn := inf

t ‚â•0 | |Œæt+1| > n

‚àßT
as a localizing sequence. With this choice, |Œæt| ‚â§n on {œÑn ‚â•t}, and the increments
V œÑn
t
‚àíV œÑn
t‚àí1 = I{œÑn‚â•t} Œæt ¬∑ (Xt ‚àíXt‚àí1),
t = 1, . . . , T,
of the stopped process V œÑn are Q-integrable and satisfy
EQ[ V œÑn
t
‚àíV œÑn
t‚àí1 | Ft‚àí1 ] = I{œÑn‚â•t} Œæt ¬∑ EQ[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] = 0.
‚ô¶
Thefollowingpropositionisageneralizationofanargumentwhichwehavealready
used in the proof of Theorem 5.26. Throughout this chapter, we will assume that
F0 = {‚àÖ, } and FT = F .
Proposition 9.6. A local Q-supermartingale Z whose negative part Z‚àí
t is integrable
for each t ‚àà{1, . . . , T } is a Q-supermartingale.
Proof. Let (œÑn) be a localizing sequence. Then
ZœÑn
t
‚â•‚àí
T

s=0
Z‚àí
s ‚ààL1(Q).
In view of limn ZœÑn
t
= Zt, Fatou‚Äôs lemma for conditional expectations implies that
Q-a.s.
EQ[ Zt | Ft‚àí1 ] ‚â§lim inf
n‚Üë‚àûEQ[ ZœÑn
t
| Ft‚àí1 ] ‚â§lim inf
n‚Üë‚àûZœÑn
t‚àí1 = Zt‚àí1.
We get in particular that EQ[ Zt ] ‚â§Z0 < ‚àû. Thus Zt ‚ààL1(Q), and the assertion
follows.
DeÔ¨Ånition 9.7. By PS we denote the class of all probability measures 
P ‚âàP such
that
Xt ‚ààL1(
P )
for all t,
(9.2)
andsuchthatthevalueprocessofanytradingstrategyinS isalocal 
P -supermartingale.

9.1 Absence of arbitrage opportunities
353
Remark 9.8. If S contains all self-Ô¨Ånancing trading strategies Œæ = (Œæ0, Œæ) with
bounded Œæ, then PS coincides with the class P of all equivalent martingale mea-
sures. To prove this, let 
P ‚ààPS, and note that the value process V of any such Œæ is a

P-supermartingale by (9.2) and by Proposition 9.6. The same applies to the strategy
‚àíŒæ, so V is in fact a 
P -martingale, and Theorem 5.15 shows that 
P is a martingale
measure for X.
‚ô¶
The following result extends the ‚Äúfundamental theorem of asset pricing‚Äù to our
present setting; see Theorem 5.17.
Theorem 9.9. There are no arbitrage opportunities in S if and only if PS is non-
empty. In this case, there exists a measure 
P ‚ààPS which has a bounded density
d 
P /dP .
We will Ô¨Årst show that the condition PS Ã∏= ‚àÖimplies the absence of arbitrage
opportunities in S:
Proof of sufÔ¨Åciency. Suppose 
P is a measure in PS, and V is the value process of
a trading strategy in S such that VT ‚â•0 P -almost surely. Combining Lemma 9.10
below with Proposition 9.6 shows that V is a 
P -supermartingale. Hence V0 ‚â•
E[ VT ],
so V cannot be the value process of an arbitrage opportunity.
Lemma 9.10. Suppose that PS Ã∏= ‚àÖand that V is the value process of a trading
strategy in S such that VT ‚â•0 P -almost surely. Then Vt ‚â•0 P -a.s. for all t.
Proof. The assertion will be proved by backward induction on t. We have VT ‚â•0
by assumption, so let us assume that Vt ‚â•0 P -a.s. for some t. For Œæ = (Œæ0, Œæ) ‚ààS
with value process V , we let Œæ(c)
s
:= Œæs I{|Œæs|‚â§c} for c > 0 and for all s. Then the value
process V (c) of Œæ(c) is a 
P -supermartingale for any Ô¨Åxed 
P ‚ààPS. Furthermore,
Vt‚àí1 I{|Œæt|‚â§c} = Vt I{|Œæt|‚â§c} ‚àíŒæ(c)
t
¬∑ (Xt ‚àíXt‚àí1)
‚â•‚àíŒæ(c)
t
¬∑ (Xt ‚àíXt‚àí1)
= V (c)
t‚àí1 ‚àíV (c)
t
.
The last term on the right belongs to L1(
P ), so we may take the conditional expectation

E[ ¬∑ | Ft‚àí1 ] on both sides of the inequality. We get
Vt‚àí1 I{|Œæt|‚â§c} ‚â•
E[ V (c)
t‚àí1 ‚àíV (c)
t
| Ft‚àí1 ] ‚â•0

P -a.s.
By letting c ‚Üë‚àû, we obtain Vt‚àí1 ‚â•0.
Let us now prepare for the proof that the condition PS Ã∏= ‚àÖis necessary. First we
show that the absence of arbitrage opportunities in S is equivalent to the absence of

354
9 Hedging under constraints
arbitrage opportunities in each of the embedded one-period models, i.e., to the non-
existence of Œæt ‚ààSt such that Œæt ¬∑ (Xt ‚àíXt‚àí1) amounts to a non-trivial positive gain.
This observation will allow us to apply the techniques of Section 1.6. Let us denote
S‚àû:= { Œæ ‚ààS | Œæ is bounded }.
Similarly, we deÔ¨Åne
S‚àû
t
:= { Œæt | Œæ ‚ààS‚àû} = St ‚à©L‚àû(, Ft‚àí1, P ; Rd).
Lemma 9.11. The following conditions are equivalent:
(a) There exists an arbitrage opportunity in S.
(b) There exist t ‚àà{1, . . . , T } and Œæt ‚ààSt such that
Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚â•0 P -a.s.,
and
P [ Œæt ¬∑ (Xt ‚àíXt‚àí1) > 0 ] > 0.
(9.3)
(c) There exist t ‚àà{1, . . . , T } and Œæt ‚ààS‚àû
t
which satisÔ¨Åes (9.3).
Proof. The proof is essentially the same as the one of Proposition 5.11.
In order to apply the results of Section 1.6, we introduce the convex sets
KS
t :=

Œæt ¬∑ (Xt ‚àíXt‚àí1) | Œæt ‚ààSt

,
for t ‚àà{1, . . . , T }. Lemma 9.11 shows that S contains no arbitrage opportunities if
and only if the condition
KS
t ‚à©L0
+ = {0}
(9.4)
holds for all t ‚àà{1, . . . , T }.
Lemma 9.12. Condition (9.4) implies that KS
t ‚àíL0
+(, Ft, P ) is a closed convex
subset of L0(, Ft, P).
Proof. The proof is essentially the same as the one of Lemma 1.67. Only the following
additional observation is required: If (Œæn) is sequence in St, and if Œ± and œÉ are two
Ft‚àí1-measurable random variables such that 0 ‚â§Œ± ‚â§1 and œÉ is integer-valued, then
Œ∂ := Œ±ŒæœÉ ‚ààSt. Indeed, predictable convexity of S implies that
Œ±
n

k=1
I{œÉ=k}Œæk ‚ààSt
for each n, and the closedness of St in L0(, Ft‚àí1, P ; Rd) yields
Œ∂ = Œ±
‚àû

k=1
I{œÉ=k}Œæk ‚ààSt.

9.1 Absence of arbitrage opportunities
355
From now on, we will assume that
E[ |Xs| ] < ‚àû
for all s.
(9.5)
For the purpose of provingTheorem 9.9, this can be assumed without loss of generality:
If (9.5) does not hold, then we replace P by an equivalent measure P ‚Ä≤ which has a
bounded density dP ‚Ä≤/dP and for which the price process X is integrable. For instance,
we can take
dP ‚Ä≤ = c exp
 
‚àí
T

s=1
|Xs|
!
dP,
where c denotes the normalizing constant. If there exist a measure 
P ‚âàP ‚Ä≤ such that
each value process for a strategy in S is a local 
P -supermartingale and such that the
density d 
P /dP ‚Ä≤ is bounded, then 
P ‚ààPS, and the density d 
P /dP is bounded as
well.
Lemma 9.13. If S contains no arbitrage opportunities, then for each t ‚àà{1, . . . , T }
there exists some Zt ‚ààL‚àû(, Ft, P) such that Zt > 0 P -a.s. and such that
E[ Zt Œæt ¬∑ (Xt ‚àíXt‚àí1) ] ‚â§0
for all Œæ ‚ààS‚àû.
(9.6)
Proof. Consider the positive cone
R := { Œª Œæ | Œæ ‚ààS, Œª ‚â•0 }
generated by S. Accordingly, we deÔ¨Åne the cones R, Rt, and KR
t . Clearly, R does
not contain arbitrage opportunities if and only if S is arbitrage-free. Hence, for each t
KR
t
‚à©L0
+(, Ft, P ) = {0}
(9.7)
by Lemma 9.11. Thus, Lemma 9.12 implies that each
CR
t
:=

KR
t
‚àíL0
+(, FT , P )

‚à©L1
is a closed convex cone in L1 which contains ‚àíL0
+(, Ft, P ). Furthermore, it follows
from (9.7) that CR
t
‚à©L0
+ = {0}, so CR
t
satisÔ¨Åes the assumptions of the Kreps‚Äì
Yan theorem, which is stated in Theorem 1.61. We conclude that there exist Zt ‚àà
L‚àû(, Ft, P) such that P [ Zt > 0 ] = 1, and such that E[ Zt W ] ‚â§0 for each
W ‚ààCR
t . As Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚ààCR
t
for each Œæ ‚ààS‚àû, Zt has property (9.6).
Now we can complete the proof of Theorem 9.9 by showing that the absence of
arbitrage opportunities in S implies the existence of a measure 
P that belongs to the
class PS and has a bounded density d 
P /dP.
Proof of necessity in Theorem 9.9. Suppose that S does not contain arbitrage opportu-
nities. We are going to construct the desired measure 
P via backward recursion. First

356
9 Hedging under constraints
we consider the case t = T . Take a bounded random variable ZT > 0 as constructed
in Lemma 9.13, and deÔ¨Åne a probability measure 
PT by
d 
PT
dP =
ZT
E[ ZT ].
Clearly, 
PT is equivalent to P , and Xt ‚ààL1(
PT ) for all t. We claim that

ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ] ‚â§0
for all Œæ ‚ààS‚àû.
(9.8)
To prove this claim, consider the family
 :=
 
ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ] | Œæ ‚ààS‚àû
.
For Œæ,Œæ ‚ààS‚àû, let
A :=
 
ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ] > 
ET [ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ]

,
and deÔ¨Åne Œæ‚Ä≤ by Œæ‚Ä≤
t = 0 for t < T and
Œæ‚Ä≤
T := ŒæT IA +ŒæT IAc .
The predictable convexity of S implies that Œæ‚Ä≤ ‚ààS‚àû. Furthermore, we have

ET [ Œæ‚Ä≤
T ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ]
= 
ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ] ‚à®
ET [ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ].
Hence, the family  is directed upwards in the sense of Theorem A.32. By virtue
of that theorem, ess sup  is the increasing limit of a sequence in . By monotone
convergence, we get

ET

ess sup
Œæ‚ààS‚àû

ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ]

= sup
Œæ‚ààS‚àû

ET
 
ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ]

=
1
E[ ZT ] sup
Œæ‚ààS‚àûE[ ŒæT ¬∑ (XT ‚àíXT ‚àí1) ZT ]
‚â§0,
(9.9)
where we have used (9.6) in the last step. Since S contains 0, it follows that
ess sup
Œæ‚ààS‚àû

ET [ ŒæT ¬∑ (XT ‚àíXT ‚àí1) | FT ‚àí1 ] = 0

PT -a.s.,
which yields our claim (9.8).

9.2 Uniform Doob decomposition
357
Now we apply the previous argument inductively: Suppose we already have a
probability measure 
Pt+1 ‚âàP with a bounded density d 
Pt+1/dP such that

Et+1[ |Xs| ] < ‚àû
for all s,
and such that

Et+1[ Œæk ¬∑ (Xk ‚àíXk‚àí1) | Fk‚àí1 ] ‚â§0
P -a.s. for k ‚â•t + 1 and Œæ ‚ààS‚àû.
(9.10)
Then we may apply Lemma 9.13 with P replaced by 
Pt+1, and we get some strictly
positive Zt ‚ààL‚àû(, Ft, 
Pt+1) satisfying (9.6) with 
Pt+1 in place of P . We now
proceed as in the Ô¨Årst step by deÔ¨Åning a probability measure 
Pt ‚âà
Pt+1 ‚âàP as
d 
Pt
d 
Pt+1
=
Zt

Et+1[ Zt ]
.
Then 
Pt has bounded densities with respect to both 
Pt+1 and P .
In particular,

Et[ |Xs| ] < ‚àûfor all s. Moreover, the Ft-measurability of d 
Pt/d 
Pt+1 implies
that (9.10) is satisÔ¨Åed for 
Pt replacing 
Pt+1. Repeating the arguments that led to (9.8)
yields

Et[ Œæt ¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ] ‚â§0
for all Œæ ‚ààS‚àû.
After T steps, we arrive at the desired measure 
P := 
P1 ‚ààPS.
9.2 Uniform Doob decomposition
The goal of this section is to characterize those non-negative adapted processes U
which can be decomposed as
Ut = U0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚àíBt,
(9.11)
where the predictable d-dimensional process Œæ belongs to S, and where B is an adapted
and increasing process such that B0 = 0. In the unconstrained case where S consists
of all strategies, we have seen in Section 7.2 that such a decomposition exists if and
only if U is a supermartingale under each equivalent martingale measure P ‚àó‚ààP . In
our present context, a Ô¨Årst guess might be that the role of P is now played by PS. Since
each value process of a strategy in S is a local 
P -supermartingale for each 
P ‚ààPS,
any process U which has a decomposition (9.11) is also a local 
P -supermartingale for

P ‚ààPS. Thus, one might suspect that the latter property would also be sufÔ¨Åcient for
the existence of a decomposition (9.11). This, however, is not the case, as is illustrated
by the following simple example.

358
9 Hedging under constraints
Example 9.14. Consider a one-period market model with the riskless bond S0
0 ‚â°
S0
1 ‚â°1 and with one risky asset S1. We assume that S1
0 ‚â°1 and that S1
1 takes the
values S1
1(œâ‚àí) = 1
2 and S1
1(œâ+) = 3
2 on  := {œâ‚àí, œâ+}. We choose any measure
P on  which assigns positive mass to both œâ+ and œâ‚àí. If we let S = [0, 1],
then a measure 
P belongs to PS if and only if 
P [ {œâ+} ] ‚àà

0, 1
2

. Thus, for any
positive initial value U0, the process deÔ¨Åned by U1(œâ‚àí) := 0 and U1(œâ+) := 2U0 is a
PS-supermartingale. If U can be decomposed according to (9.11), then we must be
able to write
2U0 = U1(œâ+) = U0 + Œæ ¬∑

S1
1(œâ+) ‚àíS1
0(œâ+)

‚àíB1(œâ+)
for some B1(œâ+) ‚â•0. This requirement is equivalent to U0 ‚â§Œæ/2. Hence the
decomposition (9.11) fails for U0 > 1/2.
‚ô¶
The reason for the failure of the decomposition (9.11) for certain PS-supermar-
tingales is that PS does not reÔ¨Çect the full structure of S; the deÔ¨Ånition of PS depends
only on the cone
{ Œª Œæ | Œª > 0, Œæ ‚ààS }
generated by S. In the approach we are going to present here, the structure of S will
be reÔ¨Çected by a stochastic process which we associate to any measure Q ‚â™P :
DeÔ¨Ånition 9.15. For a measure Q ‚â™P , the upper variation process for S is the
increasing process AQ deÔ¨Åned by
AQ
0 := 0
and
AQ
t+1 ‚àíAQ
t := ess sup
Œæ‚ààS

Œæt+1 ¬∑

EQ[ Xt+1 | Ft ] ‚àíXt

for t = 0, . . . , T ‚àí1. By QS we denote the set of all Q ‚âàP such that
EQ[ AQ
T ] < ‚àû
and such that
EQ[ |Xt+1 ‚àíXt| | Ft ] < ‚àû
P -a.s. for all t.
Clearly, the upper variation process of any measure Q ‚âàP satisÔ¨Åes
AQ
t+1 ‚àíAQ
t = ess sup
Œæ‚ààS‚àû

Œæt+1 ¬∑

EQ[ Xt+1 | Ft ] ‚àíXt

,
where S‚àûare the bounded processes in S. Hence for Q ‚ààQS and Œæ ‚ààS‚àû, the
condition EQ[ |Xt+1 ‚àíXt| | Ft ] < ‚àûguarantees that
Œæt+1 ¬∑

EQ[ Xt+1 | Ft ] ‚àíXt

= EQ[ Œæt+1 ¬∑ (Xt+1 ‚àíXt) | Ft ],
and it follows that
AQ
t+1 ‚àíAQ
t = ess sup
Œæ‚ààS‚àûEQ[ Œæt+1 ¬∑ (Xt+1 ‚àíXt) | Ft ]
for Q ‚ààQS.
(9.12)

9.2 Uniform Doob decomposition
359
In particular, we have
A
P
T = 0
for 
P ‚ààPS,
(9.13)
which implies the inclusion
P ‚äÇPS ‚äÇQS.
(9.14)
Proposition 9.16. If Q ‚ààQS, and V is the value process of a trading strategy in S,
then V ‚àíAQ is a local Q-supermartingale.
Proof. Let V be the value process of Œæ = (Œæ0, Œæ) ‚ààS. Denote by œÑn(œâ) the Ô¨Årst time
t at which
|Œæt+1(œâ)| > n
or
EQ

|Xt+1 ‚àíXt| | Ft

(œâ) > n.
If such a t does not exist, let œÑn(œâ) := T . Then œÑn is a stopping time. Since
|V œÑn
t+1 ‚àíV œÑn
t | ‚â§I{œÑn‚â•t+1}|Œæt+1| ¬∑ |Xt+1 ‚àíXt| ‚ààL1(Q),
V œÑn
t
belongs to L1(Q), and
EQ[ V œÑn
t+1 ‚àíV œÑn
t
| Ft ] = I{œÑn‚â•t+1}Œæt+1 ¬∑

EQ[ Xt+1 | Ft ] ‚àíXt

‚â§(AQ)œÑn
t+1 ‚àí(AQ)œÑn
t .
This proves that V œÑn ‚àí(AQ)œÑn is a Q-supermartingale.
Let us identify the class QS in some special cases.
Remark 9.17. IfS‚àûconsistsofallboundedpredictableprocessesŒæ withnon-negative
components, then QS = PS. To prove this, take Q ‚ààQS, and note Ô¨Årst that AQ ‚â°0,
due to (9.12) and the fact that S is a cone. Thus, value processes of strategies in S are
local Q-supermartingales by Proposition 9.16. By taking Œæ ‚ààS such that Œæi
t ‚â°1 and
Œæj
t ‚â°0 for j Ã∏= i, we get that Xi is a local Q-supermartingale, and Proposition 9.6
implies that Xi is a Q-supermartingale. In particular, Xi
t is Q-integrable, and we
conclude Q ‚ààPS.
‚ô¶
Remark 9.18. If S‚àûconsists of all bounded predictable processes Œæ, then QS = P .
This follows by combining Remarks 9.8 and 9.17.
‚ô¶
Example 9.19. Suppose our market model contains just one risky asset, and S consists
of all predictable processes Œæ such that
at ‚â§Œæt ‚â§bt
P -a.s. for all t,
where a and b are two given predictable processes with
‚àí‚àû< at ‚â§0 ‚â§bt < ‚àû
P -a.s.

360
9 Hedging under constraints
IfweassumeinadditionthatE[ |Xt+1‚àíXt| | Ft ] > 0P -a.s., thenthenon-redundance
condition (9.1) holds, and S satisÔ¨Åes the assumptions (a) through (d) stated at the
beginning of this chapter. If Q ‚âàP is any probability measure such that
EQ

|Xt+1 ‚àíXt| | Ft

< ‚àû
P -a.s. for all t,
(9.15)
then
ess sup
Œæ‚ààS‚àûEQ[ Œæt+1 ¬∑ (Xt+1 ‚àíXt) | Ft ]
= bt+1

EQ[ Xt+1 ‚àíXt | Ft ]
+ ‚àíat+1

EQ[ Xt+1 ‚àíXt | Ft ]
‚àí
< ‚àû
P -a.s.
Hence, QS consists of all measures Q ‚âàP with (9.15).
‚ô¶
We now state the uniform Doob decomposition under constraints, which is the
main result of this section.
Theorem 9.20. Suppose that PS is non-empty. Then for any adapted process U with
UT ‚â•0 P -a.s., the following conditions are equivalent.
(a) U ‚àíAQ is a Q-supermartingale for every Q ‚ààQS.
(b) There exists Œæ ‚ààS and an adapted increasing process B such that B0 = 0 and
Ut = U0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚àíBt
P -a.s. for all t.
Proof. (b) ‚áí(a): Fix Q ‚ààQS. According to Proposition 9.16, the process
MQ
t
:= U0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1) ‚àíAQ
t
is a local Q-supermartingale. Since MQ
T + AQ
T ‚â•UT ‚â•0 P -a.s., we get from
Lemma 9.10 that the negative part of MQ
t
is bounded below by ‚àíAQ
t
‚ààL1(Q). So
MQ is a Q-supermartingale by Proposition 9.6. Since
MQ
T ‚â•MQ
T ‚àíBT = UT ‚àíAQ
T ‚â•‚àíAQ
T
P -a.s.,
and since B is increasing, each Bt belongs to L1(Q), and M ‚àíB = U ‚àíAQ is a
Q-supermartingale.
(a) ‚áí(b): We must show that for any given t ‚àà{1, . . . , T } there exist some
Œæ ‚ààS and a non-negative random variable Rt playing the role of Bt ‚àíBt‚àí1 such that
Ut ‚àíUt‚àí1 = Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚àíRt, i.e.,
Ut ‚àíUt‚àí1 ‚ààKS
t ‚àíL0
+(, Ft, P ),

9.2 Uniform Doob decomposition
361
where
KS
t = { Œæt ¬∑ (Xt ‚àíXt‚àí1) | Œæ ‚ààS }.
The formulation of this problem does not change if we switch from P to any equivalent
probability measure, so we can assume without loss of generality that P ‚ààPS. In
this case AP ‚â°0, and U is a P -supermartingale. In particular, Us ‚ààL1(P ) for all s.
We assume by way of contradiction that
Ut ‚àíUt‚àí1 /‚ààCS
t =

KS
t ‚àíL0
+(, Ft, P )

‚à©L1(P ).
(9.16)
Recall that we have proved in Lemma 9.12 that CS
t is a closed convex subset of
L1(, Ft, P). The Hahn‚ÄìBanach separation theorem, Theorem A.56, now implies
the existence of a random variable Z ‚ààL‚àû(, Ft, P ) such that
Œ± := sup
W‚ààCS
t
E[ Z W ] < E[ Z (Ut ‚àíUt‚àí1) ] =: Œ≤ < ‚àû.
(9.17)
Note that the function ‚àíŒªI{Z<0} belongs to CS
t for all Œª ‚â•0. Thus
0 ‚â§(‚àíŒª) E

Z I{Z<0}

‚â§Œ±
for every Œª ‚â•0, and it follows that Z ‚â•0 P -almost surely.
In fact, we can always modify Z such that it is bounded below by some Œµ > 0 and
still satisÔ¨Åes (9.17). To see this, note Ô¨Årst that every W ‚ààCS
t is dominated by some
Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚ààKS
t with integrable negative part. Therefore
E[ W ] ‚â§E[ Œæt ¬∑ (Xt ‚àíXt‚àí1) ] ‚â§lim inf
c‚Üë‚àûE

Œæt ¬∑ (Xt ‚àíXt‚àí1)I{|Œæt|‚â§c}

‚â§0,
where we have used our assumption that P ‚ààPS. If we let ZŒµ := Œµ 1 + (1 ‚àíŒµ)Z,
then ZŒµ still satisÔ¨Åes E[ ZŒµ W ] ‚â§0 for all W ‚ààCS
t , and for Œµ small enough, the
expectation E[ ZŒµ (Ut ‚àíUt‚àí1) ] is still larger than Œ±. So ZŒµ also satisÔ¨Åes (9.17).
Therefore, we may assume from now on that our Z with (9.17) is bounded below by
some constant Œµ > 0.
For the next step, let Zt‚àí1 := E[ Z | Ft‚àí1 ] and
dQ
dP :=
Z
Zt‚àí1
.
Since this density is bounded and since P ‚ààPS, we get
EQ

|Xs ‚àíXs‚àí1| | Fs‚àí1

< ‚àû
P -a.s. for all s.
(9.18)
Moreover, it is not difÔ¨Åcult to check that
EQ[ Œæs¬∑(Xs‚àíXs‚àí1) | Fs‚àí1 ] = E[ Œæs¬∑(Xs‚àíXs‚àí1) | Fs‚àí1 ] ‚â§0
for s Ã∏= t; (9.19)

362
9 Hedging under constraints
see the proof of Theorem 7.5 for details. We now consider the case s = t. As we have
seen in the proof of Theorem 9.9, the family

EQ[ Œæt ¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ] | Œæ ‚ààS

is directed upwards. Therefore, we may conclude as in (9.9) that
EQ

Zt‚àí1 ess sup
Œæ‚ààS
EQ[ Œæt ¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ]

= sup
Œæ‚ààS
E[ Œæt ¬∑ (Xt ‚àíXt‚àí1) Z ]
(9.20)
‚â§Œ±.
Since Zt‚àí1 ‚â•Œµ, (9.20) implies that
EQ

AQ
t ‚àíAQ
t‚àí1

= EQ

ess sup
Œæ‚ààS
EQ[ Œæt ¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ]

‚â§Œ±
Œµ .
By (9.19) we may conclude that EQ[ AQ
T ] ‚â§Œ±/Œµ, and so (9.18) yields Q ‚ààQS.
As a Ô¨Ånal step, we show that U ‚àíAQ cannot be a Q-supermartingale, thus leading
our assumption (9.16) to a contradiction with our hypothesis (a). To this end, we use
again (9.20):
EQ

Zt‚àí1 EQ[ Ut ‚àíUt‚àí1 | Ft‚àí1 ]

= EQ[ Zt‚àí1 (Ut ‚àíUt‚àí1) ]
= E[ Z (Ut ‚àíUt‚àí1) ] = Œ≤
> Œ±
‚â•EQ

Zt‚àí1 ess sup
Œæ‚ààS
EQ[ Œæt ¬∑ (Xt ‚àíXt‚àí1) | Ft‚àí1 ]

= EQ

Zt‚àí1 (AQ
t ‚àíAQ
t‚àí1)

.
Thus, we cannot have
EQ[ Ut ‚àíUt‚àí1 | Ft‚àí1 ] ‚â§AQ
t ‚àíAQ
t‚àí1
P -a.s.,
so U ‚àíAQ cannot be a Q-supermartingale, in contradiction to our hypothesis (a).
9.3 Upper Snell envelopes
From now on, we assume that S does not contain arbitrage opportunities, which is
equivalent to the condition PS Ã∏= ‚àÖ. Let H be a discounted American claim. Our
goal is to construct a superhedging strategy for H that belongs to our class S of

9.3 Upper Snell envelopes
363
admissible strategies. The uniform Doob decomposition suggests that we should
Ô¨Ånd an adapted process U ‚â•H such that U ‚àíAQ is a Q-supermartingale for each
Q ‚ààQS. If we consider only one such Q, then the minimal process U which satisÔ¨Åes
these requirements is given by 
UQ + AQ, where

UQ
t
:= ess sup
œÑ‚ààTt
EQ[ HœÑ ‚àíAQ
œÑ | Ft ]
t = 0, . . . , T,
(9.21)
is the Snell envelope of H ‚àíAQ with respect to Q. Thus, one may guess that
ess sup
Q‚ààQS
(
UQ
t
+ AQ
t ),
t = 0, . . . , T,
is the minimal process U which dominates H and for which U ‚àíAQ is a Q-
supermartingale for each Q ‚ààQS. Let us assume that
sup
Q‚ààQS

UQ
0 = sup
Q‚ààQS
sup
œÑ‚ààT
EQ[ HœÑ ‚àíAQ
œÑ ] < ‚àû.
Note that this condition holds if H is bounded.
DeÔ¨Ånition 9.21. The process

U‚Üë
t := ess sup
Q‚ààQS

AQ
t + 
UQ
t

= ess sup
Q‚ààQS

AQ
t + ess sup
œÑ‚ààTt
EQ[ HœÑ ‚àíAQ
œÑ | Ft ]

,
t = 0, . . . , T,
will be called the upper QS-Snell envelope of H.
The main result of this section conÔ¨Årms our guess that 
U‚Üëis the process we are
looking for.
Theorem 9.22. The upper QS-Snell envelope of H is the smallest process U ‚â•H
such that U ‚àíAQ is a Q-supermartingale for each Q ‚ààQS.
For a European claim, we have the following additional result.
Proposition 9.23. For a discounted European claim H E with
sup
Q‚ààQS
EQ[ H E ‚àíAQ
T ] < ‚àû,
the upper QS-Snell envelope takes the form

U‚Üë
t = ess sup
Q‚ààQS

EQ[ H E ‚àíAQ
T | Ft ] + AQ
t

,
t = 0, . . . , T.

364
9 Hedging under constraints
Proposition 9.23 will follow from Lemma 9.28 below. The next result provides a
schemefortherecursivecalculationof 
U‚Üë. ItwillbeusedintheproofofTheorem9.22.
Proposition 9.24. For Ô¨Åxed Q0 ‚ààQS let Qt(Q0) denote the set of all Q ‚ààQS which
coincide with Q0 on Ft. Then 
U‚ÜësatisÔ¨Åes the following recursion formula:

U‚Üë
t ‚àíAQ0
t
= (Ht ‚àíAQ0
t
) ‚à®ess sup
Q‚ààQt(Q0)
EQ[ 
U‚Üë
t+1 ‚àíAQ
t+1 | Ft ],
t = 0, . . . , T ‚àí1.
The proofs of this proposition and of Theorem 9.22 will be given at the end of this
section. LetusrecallthefollowingconceptsfromSection6.4. Thepastingoftwoprob-
abilitymeasuresQ1 ‚âàQ2 inastoppingtimeœÑ ‚ààT = { œÉ | œÉ is a stopping time ‚â§T }
is the probability measure

Q[ A ] = EQ1

Q2[ A | FœÑ ]

,
A ‚ààF .
It was shown in Lemma 6.43 that, for all stopping times œÉ and FT -measurable Y ‚â•0,
E
Q[ Y | FœÉ ] = EQ1

EQ2[ Y | FœÑ‚à®œÉ ] | FœÉ

.
(9.22)
Recall also that a set Q of equivalent probability measures on (, F ) is called stable
if for any pair Q1, Q2 ‚ààQ and all œÑ ‚ààT the corresponding pasting also belongs
to Q. A technical inconvenience arises from the fact that our set QS may not be
stable. We must introduce a further condition on œÑ which guarantees that the pasting
of Q1, Q2 ‚ààQS in œÑ also belongs to QS.
Lemma 9.25. For œÑ ‚ààT , the pasting 
Q of Q1, Q2 ‚ààQS in œÑ satisÔ¨Åes
E
Q[ |Xt+1 ‚àíXt| | Ft ] < ‚àû
P -a.s.,
and its upper variation process is given by
A

Q
t = AQ1
t‚àßœÑ + (AQ2
t
‚àíAQ2
œÑ ) ¬∑ I{œÑ<t}.
Moreover, we have 
Q ‚ààQS under the condition that there exists Œµ > 0 such that
dQ2
dQ1

FœÑ
‚â•Œµ a.s. on {œÑ < T }.
(9.23)
Proof. The identity (9.22) yields
E
Q[ |Xt+1‚àíXt| | Ft ] = EQ1[ |Xt+1‚àíXt| | Ft ]I{œÑ>t}+EQ2[ |Xt+1‚àíXt| | Ft ]I{œÑ‚â§t},
and each of the two conditional expectations is Ô¨Ånite almost surely.
Now we will compute the upper variation process A
Q of 
Q. As above, (9.22)
yields
E
Q[ Œæt ¬∑ (Xt+1 ‚àíXt) | Ft ]
= EQ1[ Œæt ¬∑ (Xt+1 ‚àíXt) | Ft ]I{œÑ>t} + EQ2[ Œæt ¬∑ (Xt+1 ‚àíXt) | Ft ]I{œÑ‚â§t}.

9.3 Upper Snell envelopes
365
Taking the essential supremum over Œæt ‚ààS‚àû
t
gives
A

Q
t+1 ‚àíA

Q
t = (AQ1
t+1 ‚àíAQ1
t
)I{œÑ>t} + (AQ2
t+1 ‚àíAQ2
t
)I{œÑ‚â§t},
and from this our formula for A

Q
t follows.
In a Ô¨Ånal step, we show that 
Q belongs to QS under condition (9.23). We must
show that E
Q[ A

Q
T ] < ‚àû. Let Zt denote the density of Q2 with respect to Q1 on Ft.
Then, by our formula for A

Q
T ,
E
Q[ A

Q
T ] = E
Q[ AQ1
œÑ
+ AQ2
T
‚àíAQ2
œÑ
]
= EQ1[ AQ1
œÑ
+ EQ2[ AQ2
T
‚àíAQ2
œÑ
| FœÑ ] ]
‚â§EQ1[ AQ1
T
] + EQ1
 1
ZœÑ
EQ1[ (AQ2
T
‚àíAQ2
œÑ ) ZT | FœÑ ]
!
‚â§EQ1[ AQ1
T
] + 1
Œµ EQ2[ AQ2
T
],
which is Ô¨Ånite for Q1, Q2 ‚ààQS.
Lemma 9.26. Suppose we are given Q1, Q2 ‚ààQS, a stopping time œÑ ‚ààT , and a set
B ‚ààFœÑ such that dQ2/dQ1|FœÑ ‚â•Œµ a.s. on B. Let 
Q be the pasting of Q1 and Q2 in
the stopping time
œÉ := œÑIB + T IBc .
Then 
Q ‚ààQS, and the Snell envelopes associated with these three measures by (9.21)
are related as follows:

U 
Q
œÑ + A
Q
œÑ = (
UQ1
œÑ
+ AQ1
œÑ ) ¬∑ IBc + (
UQ2
œÑ
+ AQ2
œÑ ) ¬∑ IB
P -a.s.
(9.24)
Proof. We have dQ2/dQ1|FœÉ ‚â•Œµ, hence 
Q ‚ààQS follows from Lemma 9.25. Let
œÅ be a stopping time in the set TœÑ of all stopping times ‚â•œÑ. The formula for A
Q in
Lemma 9.25 yields
A
Q
œÅ = AQ1
œÑ
+ (AQ1
œÅ
‚àíAQ1
œÑ )IBc + (AQ2
œÅ
‚àíAQ2
œÑ )IB .
Moreover, (9.22) implies that
E
Q[ Y | FœÑ ] = EQ1[ Y | FœÑ ]IBc + EQ2[ Y | FœÑ ]IB
for all random variables Y such that all conditional expectations make sense. Hence,
E
Q[ HœÅ ‚àíA
Q
œÅ | FœÑ ] + A
Q
œÑ
=

EQ1[ HœÅ ‚àíAQ1
œÅ
| FœÑ ] + AQ1
œÑ

IBc +

EQ2[ HœÅ ‚àíAQ2
œÅ
| FœÑ ] + AQ2
œÑ

IB .

366
9 Hedging under constraints
Whenever œÅ1, œÅ2 are stopping times in TœÑ, then œÅ := œÅ1 IBc +œÅ2 IB is also a stopping
time in TœÑ. Conversely, every œÅ ‚ààTœÑ can be written in that way for stopping times
œÅ1 and œÅ2. Thus, taking the essential supremum over all œÅ1 and œÅ2 and applying
Proposition 6.38 yields (9.24).
In fact, we have A

Q
œÑ = AQ1
œÑ
in (9.24), as we will have AQk
œÑ
= AQ0
œÑ
in the following
lemma.
Lemma 9.27. For any Q0 ‚ààQS, œÑ ‚ààT , and Œ¥ > 0, there exist a set Œ¥ ‚ààFœÑ such
that Q0[ Œ¥ ] ‚â•1 ‚àíŒ¥ and measures Qk ‚ààQS such that Qk = Q0 on FœÑ and

UQk
œÑ
+ AQk
œÑ
‚Üóess sup
Q‚ààQS
(
UQ
œÑ + AQ
œÑ ) = 
U‚Üë
œÑ
P -a.s. on Œ¥.
Proof. By Theorem A.32 and its proof, there exists a sequence (Q0
n) ‚äÇQS such that
lim
k‚Üë‚àûmax
n‚â§k

UQ0
n
œÑ
+ AQ0
n
œÑ

= 
U‚Üë
œÑ
P -a.s.
We will recursively deÔ¨Åne measures Qk ‚ààQS and sets k
Œ¥ ‚ààFœÑ such that k
Œ¥ ‚äÇk‚àí1
Œ¥
,
Q0[ k
Œ¥ ] ‚â•1 ‚àí(1 ‚àí2‚àík)Œ¥, and

UQk
œÑ
+ AQk
œÑ
= max
n‚â§k

UQ0
n
œÑ
+ AQ0
n
œÑ

P -a.s. on k
Œ¥.
By letting Œ¥ := 
k k
Œ¥, this will imply the Ô¨Årst part of the assertion. We start this
recursion in k = 0 by taking Q0 and 0
Œ¥ := .
For Qk given, the equivalence of Qk and Q0
k+1 implies that there exists some
Œµ > 0 such that the set
D :=
 dQ0
k+1
dQk

FœÑ
‚â•Œµ

‚ààFœÑ
satisÔ¨Åes Q0[ D ] ‚â•1 ‚àí2‚àí(k+1) Œ¥. Thus, k+1
Œ¥
:= k
Œ¥ ‚à©D satisÔ¨Åes Q0[ k+1
Œ¥
] ‚â•
1 ‚àí(1 ‚àí2‚àí(k+1))Œ¥. We now deÔ¨Åne a set
B :=
$

U
Q0
k+1
œÑ
+ A
Q0
k+1
œÑ
> 
UQk
œÑ
+ AQk
œÑ
%
‚à©D,
and consider the pasting Qk+1 of Qk and Q0
k+1 in the stopping time œÉ := œÑIB +T IBc .
By Lemma 9.26, Qk+1 ‚ààQS and

UQk+1
œÑ
+ AQk+1
œÑ
=

UQk
œÑ
+ AQk
œÑ

¬∑ IBc +

U
Q0
k+1
œÑ
+ A
Q0
k+1
œÑ

¬∑ IB
P -a.s.
=

UQk
œÑ
+ AQk
œÑ

‚à®

U
Q0
k+1
œÑ
+ A
Q0
k+1
œÑ

P -a.s. on D
= max
n‚â§k+1

UQ0
n
œÑ
+ AQ0
n
œÑ

P -a.s. on k+1
Œ¥
.

9.3 Upper Snell envelopes
367
Now we can proceed to proving the main results in this section.
Proof of Proposition 9.24. For Q0 ‚ààQS and t ‚àà{t, . . . , T }, Qt(Q0) denotes the set
of all Q ‚ààQS which coincide with Q0 on Ft. By Lemma 9.27 and by the deÔ¨Ånition
of 
UQ as the Snell envelope of H ‚àíAQ,

U‚Üë
t ‚àíAQ0
t
= ess sup
Q‚ààQt(Q0)

UQ
t
= ess sup
Q‚ààQt(Q0)

(Ht ‚àíAQ
t ) ‚à®EQ[ 
UQ
t+1 | Ft ]

= (Ht ‚àíAQ0
t
) ‚à®ess sup
Q‚ààQt(Q0)
EQ[ 
UQ
t+1 | Ft ].
Since 
UQ
t+1 ‚â§
U‚Üë
t+1 ‚àíAQ
t+1, we get

U‚Üë
t ‚àíAQ0
t
‚â§(Ht ‚àíAQ0
t
) ‚à®ess sup
Q‚ààQt(Q0)
EQ[ 
U‚Üë
t+1 ‚àíAQ
t+1 | Ft ].
(9.25)
For the proof of the converse inequality, let us Ô¨Åx an arbitrary Q ‚ààQt(Q0). For
any Œ¥ > 0, Lemma 9.27 yields a set Œ¥ ‚ààFt+1 with measure Q[ Œ¥ ] ‚â•1 ‚àíŒ¥ and
Qk ‚ààQt+1(Q) such that 
UQk
t+1 ‚Üó
U‚Üë
t+1 ‚àíAQ
t+1 P -a.s. on Œ¥. Since Qk coincides
with Q on Ft+1, we have P -a.s. on Œ¥
EQ[ 
U‚Üë
t+1 ‚àíAQ
t+1 | Ft ] = lim
k‚Üë‚àûEQ[ 
UQk
t+1 | Ft ] = lim
k‚Üë‚àûEQk[ 
UQk
t+1 | Ft ]
‚â§lim sup
k‚Üë‚àû

UQk
t
‚â§
ess sup

Q‚ààQt+1(Q)

U

Q
t
‚â§ess sup

Q‚ààQt(Q)

U

Q
t
= 
U‚Üë
t ‚àíAQ
t
= 
U‚Üë
t ‚àíAQ0
t
By taking Œ¥ ‚Üì0 and by recalling 
U‚Üë
t ‚â•Ht, we arrive at the converse of the inequal-
ity (9.25).
Proof of Theorem 9.22.
Since Q0 ‚ààQS is obviously contained in Qt(Q0), the
recursion formula of Proposition 9.24 yields

U‚Üë
t ‚àíAQ0
t
‚â•(Ht ‚àíAQ0
t
) ‚à®EQ0[ 
U‚Üë
t+1 ‚àíAQ0
t+1 | Ft ] ‚â•EQ0[ 
U‚Üë
t+1 ‚àíAQ0
t+1 | Ft ],
i.e., 
U‚Üë
t ‚àíAQ0 is indeed a Q0-supermartingale for each Q0 ‚ààQS. We also know that

U‚Üëdominates H.
Let U be any process which dominates H and for which U ‚àíAQ is a Q-
supermartingale for each Q ‚ààQS. For Ô¨Åxed Q, the Q-supermartingale U ‚àíAQ

368
9 Hedging under constraints
dominates H ‚àíAQ and hence also 
UQ, since 
UQ is the smallest Q-supermartingale
dominating H ‚àíAQ by Proposition 6.11. It follows that
Ut ‚â•ess sup
Q‚ààQS

UQ
t
+ AQ
t

= 
U‚Üë
t
P -a.s. for all t.
Proposition 9.23 we will be implied by taking œÑ ‚àó‚â°T in the following lemma.
Lemma 9.28. Let H be a discounted American claim whose payoff is zero if it is not
exercised at a given stopping time œÑ ‚àó‚ààT , i.e., Ht(œâ) = 0 if t Ã∏= œÑ ‚àó(œâ). Then its
upper QS-Snell envelope is given by

U‚Üë
t = I{œÑ ‚àó‚â•t} ess sup
Q‚ààQS

EQ[ HœÑ ‚àó‚àíAQ
œÑ ‚àó| Ft ] + AQ
t

,
t = 0, . . . , T.
Proof. By deÔ¨Ånition,

U‚Üë
t = ess sup
œÑ‚ààTt
ess sup
Q‚ààQS

EQ[ HœÑ ‚àíAQ
œÑ | Ft ] + AQ
t

.
Since each process AQ is increasing, it is clearly optimal to take œÑ = t on {œÑ ‚àó‚â§t}.
Hence,

U‚Üë
t =

0
on {œÑ ‚àó< t},
Ht
on {œÑ ‚àó= t}.
So we have to show that choosing œÑ ‚â°œÑ ‚àóis optimal on {œÑ ‚àó> t}. If œÉ ‚ààTt is a
stopping time with P [ œÉ > œÑ ‚àó] > 0, then œÑ := œÉ ‚àßœÑ ‚àóis as least as good as œÉ, since
each process AQ is increasing. So it remains to exclude the case that there exists a
stopping time œÉ ‚ààTt with œÉ ‚â§œÑ ‚àóon {œÑ ‚àó> t} and P [ œÉ < œÑ ‚àó] > 0, such that œÉ
yields a strictly better result than œÑ ‚àó. In this case, there exists some Q1 ‚ààQS such
that
EQ1[ HœÉ ‚àíAQ1
œÉ
| Ft ] + AQ1
t
> ess sup
Q‚ààQS

EQ[ HœÑ ‚àó‚àíAQ
œÑ ‚àó| Ft ] + AQ
t

(9.26)
with strictly positive probability on {œÑ ‚àó> t}. Take any 
P ‚ààPS and Œµ > 0, and deÔ¨Åne
BŒµ :=
 d 
P
dQ1

FœÉ
‚â•Œµ

.
Now let QŒµ be the pasting Q1 and 
P in the stopping time œÉIBŒµ + T IBc
Œµ . Accord-
ing to Lemmas 9.25 and 9.26, QŒµ ‚ààQS, and its upper variation process satisÔ¨Åes
AQŒµ
t
= AQ1
t
and AQŒµ
œÉ
= AQ1
œÉ
as well as
AQŒµ
œÑ ‚àó= AQ1
œÑ ‚àóIBc
Œµ + AQ1
œÉ
IBŒµ
P -a.s. on {œÑ ‚àó> t}.

9.4 Superhedging and risk measures
369
By using our assumption that HœÉ ‚â§HœÑ ‚àó, we get
EQ1[ HœÉ ‚àíAQ1
œÉ
| Ft ] + AQ1
t
‚â§EQŒµ[ HœÑ ‚àó‚àíAQŒµ
œÑ ‚àó| Ft ] + AQŒµ
t
P -a.s. on BŒµ.
By letting Œµ ‚Üì0, the P -measure of BŒµ becomes arbitrarily close to 1, and we arrive at
a contradiction to (9.26).
9.4 Superhedging and risk measures
Let H be a discounted American claim such that

U‚Üë
0 = sup
Q‚ààQS

UQ
0 = sup
Q‚ààQS
sup
œÑ‚ààT
EQ[ HœÑ ‚àíAQ
œÑ ] < ‚àû.
Our aim in this section is to construct superhedging strategies for H which belong to
our set S of admissible trading strategies. Recall that a superhedging strategy for H
is any self-Ô¨Ånancing trading strategy whose value process dominates H. If applied
with t = 0, the following theorem shows that 
U‚Üë
0 is the minimal amount for which a
superhedging strategy is available.
Denote by 
U‚Üë
t (H) the set of all Ft-measurable random variables Ut ‚â•0 for which
there exists some Œ∑ ‚ààS such that
Ut +
u

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1) ‚â•Hu
for all u ‚â•t P -a.s.
(9.27)
Theorem 9.29. The upper QS-Snell envelope 
U‚Üë
t of H is the minimal element of

U‚Üë
t (H). More precisely,
(a) 
U‚Üë
t ‚àà
U‚Üë
t (H),
(b) 
U‚Üë
t = ess inf 
U‚Üë
t (H).
Proof. The uniform Doob decomposition in Section 9.2 combined with Theorem 9.22
yields an increasing adapted process B and some Œæ ‚ààS such that

U‚Üë
u = 
U‚Üë
t +
u

k=t+1
Œæk ¬∑ (Xk ‚àíXk‚àí1) + Bt ‚àíBu
P -a.s. for u ‚â•t.
So the fact that 
U‚Üëdominates H proves (a).
As to part (b), we Ô¨Årst get 
U‚Üë
t
‚â•ess inf 
U‚Üë
t (H) from (a). For the proof of the
converse inequality, take Ut ‚àà
U‚Üë
t (H) and choose a predictable process Œ∑ ‚ààS for

370
9 Hedging under constraints
which (9.27) holds. We must show that the set B := { 
U‚Üë
t ‚â§Ut } satisÔ¨Åes P [ B ] = 1.
Let
ÀÜUt := 
U‚Üë
t ‚àßUt = 
U‚Üë
t ¬∑ IB + Ut ¬∑ IBc .
Then ÀÜUt ‚â§
U‚Üë
t , and our claim will follow if we can show that U‚Üë
t
‚â§ÀÜUt. Let Œæ
denote the predictable process obtained from the uniform Doob decomposition of the
P -supermartingale 
U‚Üë, and deÔ¨Åne
ÀÜŒæs :=

Œæs
if s ‚â§t,
Œæs ¬∑ IB + Œ∑s ¬∑ IBc
if s > t.
With this choice, ÀÜŒæ ‚ààS by predictable convexity, and ÀÜUt satisÔ¨Åes (9.27), i.e.,
ÀÜUt ‚àà
U‚Üë
t (H). Let
ÀÜVs := 
U‚Üë
0 +
s

k=1
ÀÜŒæk ¬∑ (Xk ‚àíXk‚àí1).
Then ÀÜVs ‚â•Hs ‚â•0 for all s, and so ÀÜV ‚àíAQ is a Q-supermartingale for each Q ‚ààQS
by Propositions 9.16 and 9.6. Hence,

U‚Üë
t = ess sup
Q‚ààQS
ess sup
œÑ‚ààTt
EQ[ HœÑ ‚àíAQ
œÑ + AQ
t | Ft ]
‚â§ess sup
Q, œÑ
EQ
 
ÀÜUt +
œÑ

k=t+1
ÀÜŒæk ¬∑ (Xk ‚àíXk‚àí1) ‚àíAQ
œÑ + AQ
t
 Ft
!
‚â§ÀÜUt.
This proves 
U‚Üë
t ‚â§ess inf 
U‚Üë
t (H).
For European claims, the upper QS-Snell envelope takes the form

U‚Üë
t = ess sup
Q‚ààQS

EQ[ H E ‚àíAQ
T | Ft ] + AQ
t

,
t = 0, . . . , T.
By taking t = 0, it follows that

U‚Üë
0 = sup
Q‚ààQS

EQ[ H E ] ‚àíEQ[ AQ
T ]

(9.28)
is the smallest initial investment which sufÔ¨Åces for superhedging the claim H E. In
fact, the formula above can be regarded as a special case of the representation theorem
for convex measures of risk in our Ô¨Ånancial market model. This will be explained next.
Let us take L‚àû:= L‚àû(, F , P) as the space of all Ô¨Ånancial positions. A position
Y ‚ààL‚àûwill be regarded as acceptable if it can be hedged with a strategy in S at no
additional cost. Thus, we introduce the acceptance set
AS :=
$
Y ‚ààL‚àû ‚àÉŒæ ‚ààS : Y +
T

t=1
Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚â•0 P -a.s.
%
.

9.4 Superhedging and risk measures
371
Due to the convexity of S, this set AS is convex, and under the mild condition
inf{ m ‚ààR | m ‚ààAS } > ‚àí‚àû,
(9.29)
AS induces a convex measure of risk œÅS := œÅAS via
œÅS(Y) := inf{ m ‚ààR | m + Y ‚ààAS } ;
see Section 4.1. Note that condition (9.29) holds in particular if S does not contain
arbitrage opportunities. In this case, we have in fact
œÅS(0) = inf{ m ‚ààR | m ‚ààAS } = 0,
i.e., œÅS is normalized. The main results of this chapter can be restated in terms of œÅS:
Corollary 9.30. The following conditions are equivalent:
(a) œÅS is sensitive.
(b) S contains no arbitrage opportunities.
(c) PS Ã∏= ‚àÖ.
If these equivalent conditions hold, then
œÅS(Y) = sup
Q‚ààQS

EQ[ ‚àíY ] ‚àíEQ[ AQ
T ]

,
Y ‚ààL‚àû.
(9.30)
In other words, œÅS can be represented in terms of the penalty function
Œ±(Q) =

EQ[ AQ
T ]
if Q ‚ààQS,
+‚àû
otherwise.
Proof. That (a) implies (b) is obvious. The equivalence between (b) and (c) was shown
in Theorem 9.9. Since both sides of (9.30) are cash invariant, it sufÔ¨Åces to prove (9.30)
for Y ‚â§0. But then the representation for œÅS is just a special case of the superhedging
duality (9.28). Finally, (9.30) and (c) imply that œÅS(X) ‚â•sup
P ‚ààPS 
E[ ‚àíX ], and the
sensitivity of œÅS follows.

Chapter 10
Minimizing the hedging error
In this chapter, we present an alternative approach to the problem of hedging in an
incomplete market model. Instead of controlling the downside risk, we simply aim at
minimizing the quadratic hedging error. We begin with a local version of the minimiza-
tion problem, which may be viewed as a sequential regression procedure. Its solution
involves an orthogonal decomposition of a given contingent claim; this extends a
classical decomposition theorem for martingales known as the Kunita‚ÄìWatanabe de-
composition. Often, the value process generated by a locally risk-minimizing strategy
can be described as the martingale of conditional expectations of the given contin-
gent claim for a special choice of an equivalent martingale measure. Such ‚Äúminimal‚Äù
martingale measures will be studied in Section 10.2. In Section 10.3, we investigate
the connection between local risk minimization and the problem of variance-optimal
hedging where one tries to minimize the global quadratic hedging error. The local and
the global versions coincide if the underlying measure is itself a martingale measure.
10.1 Local quadratic risk
In this section, we no longer restrict our discussion to strategies which are self-
Ô¨Ånancing. Instead, we admit the possibility that the value of a position is readjusted
at the end of each period by an additional investment in the num√©raire asset. This
means that, in addition to the initial investment at time t = 0, we allow for a cash
Ô¨Çow throughout the trading periods up to the Ô¨Ånal time T . In particular, it will now
be possible to replicate any given European claim, simply by matching the difference
between the payoff of the claim and the value generated by the preceding strategy with
a Ô¨Ånal transfer at time T .
DeÔ¨Ånition 10.1. A generalized trading strategy is a pair of two stochastic process
(Œæ0, Œæ) such that Œæ0 = (Œæ0
t )t=0,...,T is adapted, and such that Œæ = (Œæt)t=1,...,T is a
d-dimensional predictable process. The (discounted) value process V of (Œæ0, Œæ) is
deÔ¨Åned as
V0 := Œæ0
0
and
Vt := Œæ0
t + Œæt ¬∑ Xt
for t ‚â•1.
For such a generalized trading strategy (Œæ0, Œæ), the gains and losses accumulated
up to time t by investing into the risky assets are given by the sum
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1).

10.1 Local quadratic risk
373
The value process V takes the form
V0 = Œæ0
1 + Œæ1 ¬∑ X0
and
Vt = V0 +
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1),
t = 1, . . . , T,
if and only if Œæ = (Œæ0
t , Œæt)t=1,...,T is a self-Ô¨Ånancing trading strategy with initial
investment V0 = Œæ0
0 = Œæ0
1 + Œæ1 ¬∑ X0. In this case, (Œæ0
t )t=1,...,T is a predictable process.
In general, however, the difference
Vt ‚àí
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1)
is now non-trivial, and it can be interpreted as the cumulative cost up to time t. This
motivates the following deÔ¨Ånition.
DeÔ¨Ånition 10.2. The gains process G of a generalized trading strategy (Œæ0, Œæ) is given
by
G0 := 0
and
Gt :=
t
k=1
Œæk ¬∑ (Xk ‚àíXk‚àí1),
t = 1, . . . , T.
The cost process C of (Œæ0, Œæ) is deÔ¨Åned by the difference
Ct := Vt ‚àíGt,
t = 0, . . . , T,
of the value process V and the gains process G.
In this and in the following sections, we will measure the risk of a strategy in terms
of quadratic criteria for the hedging error, based on the ‚Äúobjective‚Äù measure P . Our
aim will be to minimize such criteria within the class of those generalized strategies
(Œæ0, Œæ) which replicate a given discounted European claim H in the sense that their
value process satisÔ¨Åes
VT = H
P -a.s.
The claim H will be Ô¨Åxed for the remainder of this section. As usual we assume that
the œÉ-Ô¨Åeld F0 is trivial, i.e., F0 = {‚àÖ, }. In contrast to the previous sections of Part
II, however, our approach does not exclude a priori the existence of arbitrage opportu-
nities, even though the interesting cases will be those in which there exist equivalent
martingale measures. Since our approach is based on L2-techniques, another set of
hypotheses is needed:
Assumption 10.3. Throughout this section, we assume that the discounted claim H
and the discounted price process X of the risky assets are both square-integrable with
respect to the objective measure P :
(a) H ‚ààL2(, FT , P) =: L2(P ).
(b) Xt ‚ààL2(, Ft, P; Rd) for all t.

374
10 Minimizing the hedging error
In addition to these assumptions, the quadratic optimality criteria we have in mind
require the following integrability conditions for strategies.
DeÔ¨Ånition 10.4. An L2-admissible strategy for H is a generalized trading strategy
(Œæ0, Œæ) whose value process V satisÔ¨Åes
VT = H P-a.s.
and
Vt ‚ààL2(P ) for each t,
and whose gains process G is such that
Gt ‚ààL2(P )
for each t.
We can now introduce the local version of a quadratic criterion for the hedging
error of an L2-admissible strategy.
DeÔ¨Ånition 10.5. The local risk process of an L2-admissible strategy (Œæ0, Œæ) is the
process
Rloc
t (Œæ0, Œæ) := E[ (Ct+1 ‚àíCt)2 | Ft ],
t = 0, . . . , T ‚àí1.
An L2-admissible strategy (ÀÜŒæ0, ÀÜŒæ) is called a locally risk-minimizing strategy if, for
all t,
Rloc
t (ÀÜŒæ0, ÀÜŒæ) ‚â§Rloc
t (Œæ0, Œæ)
P -a.s.
for each L2-admissible strategy (Œæ0, Œæ) whose value process satisÔ¨Åes Vt+1 = ÀÜŒæ0
t+1 +
ÀÜŒæt+1 ¬∑ Xt+1 = ÀÜVt+1.
Remark 10.6. The reason for Ô¨Åxing the value Vt+1 = ÀÜVt+1 in the preceding def-
inition becomes clear when we try to construct a locally risk-minimizing strategy
(ÀÜŒæ0, ÀÜŒæ) backwards in time. At time T , we want to construct ÀÜŒæ0
T ‚àí1, ÀÜŒæ0
T , ÀÜŒæT ‚àí1, ÀÜŒæT as
a minimizer for the local risk Rloc
T ‚àí1(Œæ0, Œæ). Since the terminal value of every L2-
admissible strategy must be equal to H, this minimization requires the side condition
Œæ0
T + ŒæT ¬∑ XT = H = ÀÜVT . As we will see in the proof of Theorem 10.9 below, mini-
mality of Rloc
T ‚àí1(ÀÜŒæ0, ÀÜŒæ) completely determines ÀÜŒæ0
T and ÀÜŒæT and ÀÜVT ‚àí1, but one is still free
to choose ÀÜŒæ0
T ‚àí1 and ÀÜŒæT ‚àí1 among all Œæ0
T ‚àí1, ŒæT ‚àí1 with Œæ0
T ‚àí1 + ŒæT ‚àí1 ¬∑ XT ‚àí1 = ÀÜVT ‚àí1.
In the next step, it is therefore natural to minimize Rloc
T ‚àí2(Œæ0, Œæ) under the condition
that VT ‚àí1 is equal to the value ÀÜVT ‚àí1 obtained from the preceding step. Moreover, the
problem will now be of the same type as the previous one.
‚ô¶
Although locally risk-minimizing strategies are generally not self-Ô¨Ånancing, it will
turn out that they are ‚Äúself-Ô¨Ånancing on average‚Äù in the following sense:
DeÔ¨Ånition 10.7. An L2-admissible strategy is called mean self-Ô¨Ånancing if its cost
process C is a P -martingale, i.e., if
E[ Ct+1 ‚àíCt | Ft ] = 0
P -a.s. for all t.

10.1 Local quadratic risk
375
In order to formulate conditions for the existence of a locally risk-minimizing
strategy, let us Ô¨Årst introduce some notation. The conditional covariance of two
random variables W and Z with respect to P is deÔ¨Åned as
cov(W, Z | Ft ) := E[ W Z | Ft ] ‚àíE[ W | Ft ] E[ Z | Ft ]
provided that the conditional expectations and their difference make sense. Similarly,
we deÔ¨Åne the conditional variance of W under P :
var( W | Ft ) := E[ W 2 | Ft ] ‚àíE[ W | Ft ]2
= cov(W, W | Ft ).
DeÔ¨Ånition 10.8. Two adapted processes U and Y are called strongly orthogonal with
respect to P if the conditional covariances
cov( Ut+1 ‚àíUt, Yt+1 ‚àíYt | Ft ),
t = 0, . . . , T ‚àí1,
are well-deÔ¨Åned and vanish P -almost surely.
When we consider the strong orthogonality of two processes U and Y in the
sequel, then usually one of them will be a P -martingale. In this case, their conditional
covariance reduces to
cov( Ut+1 ‚àíUt, Yt+1 ‚àíYt | Ft ) = E

(Ut+1 ‚àíUt)(Yt+1 ‚àíYt) | Ft

.
After these preparations, we are now ready to state our Ô¨Årst result, namely the following
characterization of locally risk-minimizing strategies.
Theorem 10.9. An L2-admissible strategy is locally risk-minimizing if and only if it
is mean self-Ô¨Ånancing and its cost process is strongly orthogonal to X.
Proof. The local risk process of any L2-admissible strategy (Œæ0, Œæ) can be expressed
as a sum of two non-negative terms:
Rloc
t (Œæ0, Œæ) = var( Ct+1 ‚àíCt | Ft ) + E[ Ct+1 ‚àíCt | Ft ]2.
Since the conditional variance does not change if we add Ft-measurable random
variables to its argument, the Ô¨Årst term on the right-hand side takes the form
var( Ct+1 ‚àíCt | Ft ) = var

Vt+1 ‚àíŒæt+1 ¬∑ (Xt+1 ‚àíXt) | Ft

.
(10.1)
The second term satisÔ¨Åes
E[ Ct+1 ‚àíCt | Ft ]2 =

E[ Vt+1 | Ft ] ‚àíŒæt+1 ¬∑ E[ Xt+1 ‚àíXt | Ft ] ‚àíVt
2. (10.2)
In a second step, we Ô¨Åx t and Vt+1, and we consider Œæt+1 and Vt as parameters.
Our purpose is to derive necessary conditions for the minimality of Rloc
t (Œæ0, Œæ) with

376
10 Minimizing the hedging error
respect to variations of Œæt+1 and Vt. To this end, note Ô¨Årst that it is possible to change
the parameters Œæ0
t and Œæt in such a way that Vt takes any given value, that the modiÔ¨Åed
strategy is still an L2-admissible strategy for H, and that the values of Œæt+1 and
Vt+1 remain unchanged. In particular, the value in (10.1) is not affected by such a
modiÔ¨Åcation, and so it is necessary for the optimality of Rloc
t (Œæ0, Œæ) that Vt minimizes
(10.2). This is the case if and only if
Vt = E[ Vt+1 | Ft ] ‚àíŒæt+1 ¬∑ E[ Xt+1 ‚àíXt | Ft ].
(10.3)
The value of (10.1) is independent of Vt and a quadratic form in terms of the
Ft-measurable random vector Œæt+1. Thus, (10.1) is minimal if and only if Œæt+1 solves
the linear equation
0 = cov

Vt+1 ‚àíŒæt+1 ¬∑ ( Xt+1 ‚àíXt), Xt+1 ‚àíXt | Ft

.
(10.4)
Note that (10.3) is equivalent to
E[ Ct+1 ‚àíCt | Ft ] = E

Vt+1 ‚àíŒæt+1 ¬∑ (Xt+1 ‚àíXt) | Ft

‚àíVt = 0.
Moreover, given (10.3), the condition (10.4) holds if and only if
E

(Ct+1 ‚àíCt)(Xt+1 ‚àíXt) | Ft

= 0
where we have used the fact that the conditional covariance in (10.4) is not changed by
subtracting the Ft-measurable random variable Vt from the Ô¨Årst argument. Backward
induction on t concludes the proof.
The previous proof provides a recipe for a recursive construction of a locally
risk-minimizing strategy: If Vt+1 is already given, minimize
E

(Ct+1 ‚àíCt)2 | Ft

= E
 
Vt+1 ‚àí

Vt + Œæt+1 ¬∑ (Xt+1 ‚àíXt)
2 | Ft

with respect to Vt and Œæt+1. This is just a conditional version of the standard problem
of determining the linear regression of Vt+1 on the increment Xt+1 ‚àíXt. Let us now
consider the case
d = 1,
where our market model contains just one risky asset. Then the following recursive
scheme yields formally an explicit solution:
ÀÜVT := H,
ÀÜŒæt+1 := cov( ÀÜVt+1, Xt+1 ‚àíXt | Ft )
œÉ 2
t+1
¬∑ I{œÉt+1Ã∏=0},
(10.5)
ÀÜVt := E[ ÀÜVt+1 | Ft ] ‚àíÀÜŒæt+1 ¬∑ E[ Xt+1 ‚àíXt | Ft ].

10.1 Local quadratic risk
377
Here œÉ 2
t+1 is a shorthand notation for the conditional variance
œÉ 2
t+1 := var( Xt+1 ‚àíXt | Ft ).
DeÔ¨Åning ÀÜŒæ0
t := ÀÜVt ‚àíÀÜŒæt ¬∑ Xt, we obtain a generalized trading strategy (ÀÜŒæ0, ÀÜŒæ) whose
terminal portfolio value ÀÜVT coincides with H. However, an extra condition is needed
to conclude that this strategy is indeed L2-admissible.
Proposition 10.10. Consider a market model with a single risky asset and assume
that there exists a constant C such that

E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
2 ‚â§C ¬∑ œÉ 2
t
P -a.s. for all t.
(10.6)
Then the recursion (10.5) deÔ¨Ånes a locally risk-minimizing strategy (ÀÜŒæ0, ÀÜŒæ). Moreover,
any other locally risk-minimizing strategy coincides with (ÀÜŒæ0, ÀÜŒæ) up to modiÔ¨Åcations
of ÀÜŒæt on the set {œÉ 2
t = 0}.
Proof. We have to show that (ÀÜŒæ0, ÀÜŒæ) is L2-admissible. To this end, observe that the
recursion (10.5) and the condition (10.6) imply that
E
 ÀÜŒæt ¬∑ (Xt ‚àíXt‚àí1)
2 
= E
 cov( ÀÜVt, Xt ‚àíXt‚àí1 | Ft‚àí1 )2
œÉ 4t
¬∑ E[ (Xt ‚àíXt‚àí1)2 | Ft‚àí1 ] I{œÉ 2
t Ã∏=0}

‚â§(1 + C) ¬∑ E
 cov( ÀÜVt, Xt ‚àíXt‚àí1 | Ft‚àí1 )2
œÉ 2t

‚â§(1 + C) ¬∑ E

var( ÀÜVt | Ft‚àí1)

.
The last expectation is Ô¨Ånite if ÀÜVt is square-integrable. In this case, ÀÜŒæt ¬∑ (Xt ‚àíXt‚àí1) ‚àà
L2(P ) and in turn ÀÜVt‚àí1 ‚ààL2(P ). Hence, L2-admissibility of (ÀÜŒæ0, ÀÜŒæ) follows by
backward induction. The claim that (ÀÜŒæ0, ÀÜŒæ) is locally risk-minimizing as well as the
uniqueness assertion follow immediately from the construction.
Remark 10.11. The predictable process
t
s=1

E[ Xs ‚àíXs‚àí1 | Fs‚àí1 ]
2
var( Xs ‚àíXs‚àí1 | Fs‚àí1 ) ,
t = 1, . . . , T,
is called the mean-variance trade-off process of X, and condition (10.6) is known
as the assumption of bounded mean-variance trade-off. Intuitively, it states that the
forecast E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] of the price increment Xt ‚àíXt‚àí1 is of the same order
as the corresponding standard deviation œÉt.
‚ô¶

378
10 Minimizing the hedging error
Remark 10.12. The assumption of bounded mean-variance trade-off is equivalent to
the existence of some Œ¥ < 1 such that

E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
2 ‚â§Œ¥ ¬∑ E[ (Xt ‚àíXt‚àí1)2 | Ft‚àí1 ]
P -a.s. for all t.
(10.7)
Indeed, with Œ±t = E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ], the assumption of bounded mean-variance
trade-off is equivalent to
Œ±2
t ‚â§C

E[ (Xt ‚àíXt‚àí1)2 | Ft‚àí1 ] ‚àíŒ±2
t

,
which is seen to be equivalent to (10.7) by choosing Œ¥ = C/(1 + C).
‚ô¶
Example 10.13. Let us consider a market model consisting of a single risky asset S1
and a riskless bond
S0
t = (1 + r)t,
t = 0, . . . , T,
with constant return r > ‚àí1. We assume that S1
0 = 1, and that the returns
Rt := S1
t ‚àíS1
t‚àí1
S1
t‚àí1
,
t = 1, . . . , T,
of the risky asset are independent and identically distributed random variables in
L2(P ). Under these assumptions, the discounted price process X, deÔ¨Åned by
Xt =
t
s=1
1 + Rs
1 + r ,
t = 0, . . . , T,
is square-integrable. Denoting by 
m the mean of Rt and by œÉ 2 its variance, we get
E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] = Xt‚àí1 ¬∑ 
m ‚àír
1 + r ,
var( Xt ‚àíXt‚àí1 | Ft‚àí1 ) = X2
t‚àí1 ¬∑
œÉ 2
(1 + r)2 .
Thus, the condition of bounded mean-variance trade-off holds without any further as-
sumptions, and a locally risk-minimizing strategy exists. Moreover, P is a martingale
measure if and only if 
m = r.
‚ô¶
Let us return to our general market model with an arbitrary number of risky assets
X = (X1, . . . , Xd).
The following result characterizes the existence of locally risk-minimizing strategies
in terms of a decomposition of the claim H.

10.1 Local quadratic risk
379
Corollary 10.14. There exists a locally risk-minimizing strategy if and only if H
admits a decomposition
H = c +
T

t=1
Œæt ¬∑ (Xt ‚àíXt‚àí1) + LT
P -a.s.,
(10.8)
where c is a constant, Œæ is a d-dimensional predictable process such that
Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚ààL2(P )
for all t,
and where L is a square integrable P -martingale which is strongly orthogonal to X
and satisÔ¨Åes L0 = 0. In this case, the locally risk-minimizing strategy (ÀÜŒæ0, ÀÜŒæ) is given
by ÀÜŒæ = Œæ and by the adapted process ÀÜŒæ0 deÔ¨Åned via ÀÜŒæ0
0 = c and
ÀÜŒæ0
t = c +
t
s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1) + Lt ‚àíŒæt ¬∑ Xt,
t = 1, . . . , T.
Moreover, the decomposition (10.8) is unique in the sense that the constant c and the
martingale L are uniquely determined.
Proof. If (ÀÜŒæ0, ÀÜŒæ) is a given locally risk-minimizing strategy with cost process ÀÜC, then
Lt := ÀÜCt ‚àíÀÜC0 is a square-integrable P -martingale which is strongly orthogonal to
X by Theorem 10.9. Hence, we obtain a decomposition (10.8). Conversely, if such a
decomposition exists, then the strategy (ÀÜŒæ0, ÀÜŒæ) has the cost process ÀÜC = c + L, and
Theorem 10.9 implies that (ÀÜŒæ0, ÀÜŒæ) is locally risk-minimizing.
To show that L is uniquely determined, suppose that there exists another decom-
position of H in terms of c,Œæ, and L. Then
Nt := c ‚àíc + Lt ‚àíLt =
t
s=1
(Œæs ‚àíŒæs) ¬∑ (Xs ‚àíXs‚àí1)
is a square-integrable P -martingale which is strongly orthogonal to X and which can
be represented as a ‚Äústochastic integral‚Äù with respect to X. Strong orthogonality means
that
0 = E

(Œæt ‚àíŒæt) ¬∑ (Xt ‚àíXt‚àí1)(Xt ‚àíXt‚àí1) | Ft‚àí1

.
Multiplying this identity withŒæt ‚àíŒæt gives
0 = E
 
(Œæt ‚àíŒæt) ¬∑ (Xt ‚àíXt‚àí1)
2 | Ft‚àí1

,
and so Nt ‚àíNt‚àí1 = (Œæt ‚àíŒæt) ¬∑ (Xt ‚àíXt‚àí1) = 0 P -almost surely. In view of
L0 = L0 = 0, we thus get L = L and in turn c = c.
A decomposition of the form (10.8) will be called the orthogonal decomposition
of the contingent claim H with respect to the process X. If X is itself a P -martingale,
then the orthogonal decomposition reduces to the Kunita‚ÄìWatanabe decomposition,
which we will explain next. To this end, we will need some preparation.

380
10 Minimizing the hedging error
Lemma 10.15. For two square-integrable martingales M and N, the following two
conditions are equivalent:
(a) M and N are strongly orthogonal.
(b) The product MN is a martingale.
Proof. The martingale property of M and N gives
E[ (Mt+1 ‚àíMt)(Nt+1 ‚àíNt) | Ft ] = E[ Mt+1Nt+1 | Ft ] ‚àíMtNt,
and this expression vanishes if and only if MN is a martingale.
Let H2 denote the space of all square-integrable P -martingales. Via the iden-
tity Mt = E[ MT | Ft ], each M ‚ààH2 can be identiÔ¨Åed with its terminal value
MT ‚ààL2(P ). With the standard identiÔ¨Åcation of random variables which coincide
P -a.s., H2 becomes a Hilbert space isomorphic to L2(P ), if endowed with the inner
product
(M, N)H2 := E[ MT NT ],
M, N ‚ààH2.
Recall from DeÔ¨Ånition 6.16 that, for a stopping time œÑ, the stopped process MœÑ is
deÔ¨Åned as
MœÑ
t := MœÑ‚àßt,
t = 0, . . . , T.
DeÔ¨Ånition 10.16. A subspace S of H2 is called stable if MœÑ ‚ààS for each M ‚ààS
and every stopping time œÑ.
Proposition 10.17. For a stable subspace S of H2 and for L ‚ààH2 with L0 = 0, the
following conditions are equivalent.
(a) L is orthogonal to S, i.e.,
(L, M)H2 = 0
for all M ‚ààS.
(b) L is strongly orthogonal to S, i.e., for each M ‚ààS
E[ (Lt+1 ‚àíLt)(Mt+1 ‚àíMt) | Ft ] = 0
P -a.s. for all t.
(c) The product LM is a martingale for each M ‚ààS.
Proof. The equivalence of (b) and (c) follows from Lemma 10.15. To prove (a)‚áî(c),
we will show that LM is a martingale for Ô¨Åxed M ‚ààS if and only if (L, MœÑ)H2 = 0
for all stopping times œÑ ‚â§T . By the stopping theorem in the form of Proposition 6.38,
(L, MœÑ)H2 = E[ LT MœÑ ] = E[LœÑMœÑ].
Using the fact that L0M0 = 0 and applying the stopping theorem in the form of
Theorem 6.17, we conclude that (L, MœÑ)H2 = 0 for all stopping times œÑ ‚â§T if and
only if LM is a martingale.

10.1 Local quadratic risk
381
After these preparations, we can now state the existence theorem for the discrete-
time version of the Kunita‚ÄìWatanabe decomposition.
Theorem 10.18. If the process X is a square-integrable martingale under P , then
every martingale M ‚ààH2 is of the form
Mt = M0 +
t
s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1) + Lt
where Œæ is a d-dimensional predictable process such that Œæt ¬∑(Xt ‚àíXt‚àí1) ‚ààL2(P ) for
each t, and where L is a square-integrable P -martingale which is strongly orthogonal
to X and satisÔ¨Åes L0 = 0. Moreover, this decomposition is unique in the sense that L
is uniquely determined.
Proof. Denote by X the set of all d-dimensional predictable processes Œæ such that
Œæt ¬∑ (Xt ‚àíXt‚àí1) ‚ààL2(P ) for each t, and denote by
Gt(Œæ) :=
t
s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1),
t = 0, . . . , T,
the ‚Äústochastic integral‚Äù of Œæ ‚ààX with respect to X. Since for Œæ ‚ààX the process
G(Œæ) is a square-integrable P -martingale, the set G of all those martingales can be
regarded as a linear subspace of the Hilbert space H2. In fact, G is a closed subspace
of H2. To prove this claim, note that the martingale property of G(Œæ) implies that

G(Œæ), G(Œæ)

H2 = E
 
GT (Œæ)
2 
=
T

t=1
E
 
Œæt ¬∑ (Xt ‚àíXt‚àí1)
2 
.
Thus, if Œæ(n) is such that G(Œæ(n)) is a Cauchy sequence in H2, then Œæ(n)
t
¬∑ (Xt ‚àíXt‚àí1)
is a Cauchy sequence in L2(P ) for each t. Since P is a martingale measure, we
may apply Lemma 1.68 to conclude that any limit point of Œæ(n)
t
¬∑ (Xt ‚àíXt‚àí1) is of
the form Œæt ¬∑ (Xt ‚àíXt‚àí1) for some Œæt ‚ààL0(, Ft‚àí1, P ; Rd). Hence, G is closed
in H2. Moreover, G is stable. Indeed, if Œæ ‚ààX and œÑ is a stopping time, then
Gt‚àßœÑ(Œæ) = Gt(Œæ) where
Œæs := Œæs ¬∑ I{œÑ‚â•s},
s = 1, . . . , T.
Furthermore, we haveŒæ ‚ààX since
E
Œæt ¬∑ (Xt ‚àíXt‚àí1)
2
‚â§E

Œæt ¬∑ (Xt ‚àíXt‚àí1)
2
< ‚àû.
Since G is closed, the orthogonal projection N of M ‚àíM0 onto G is well-deÔ¨Åned by
standard Hilbert space techniques. The martingale N belongs to G, and the difference

382
10 Minimizing the hedging error
L := M ‚àíM0 ‚àíN is orthogonal to G. By Proposition 10.17, L is strongly orthogonal
to G and hence strongly orthogonal to X. Therefore, M = M0 + N + L is the desired
decomposition of M. The uniqueness of L follows as in the proof of Corollary 10.14.
Remark 10.19. In dimension d = 1, the assumption of bounded mean-variance
trade-off (10.6) is clearly satisÔ¨Åed if X is a square-integrable P -martingale. Com-
bining Proposition 10.10 with Corollary 10.14 then yields an alternative proof of
Theorem 10.18. Moreover, the recursion (10.5) identiÔ¨Åes the predictable process Œæ
appearing in the Kunita‚ÄìWatanabe decomposition of a martingale M:
Œæt = E[ (Mt ‚àíMt‚àí1)(Xt ‚àíXt‚àí1) | Ft‚àí1 ]
E[ (Xt ‚àíXt‚àí1)2 | Ft‚àí1 ]
¬∑ I{E[ (Xt‚àíXt‚àí1)2|Ft‚àí1 ]Ã∏=0}.
‚ô¶
10.2 Minimal martingale measures
If P is itself a martingale measure, Theorem 10.18 combined with Corollary 10.14
yields immediately a solution to our original problem of constructing locally risk-
minimizing strategies:
Corollary 10.20. If P is a martingale measure, then there exists a locally risk-
minimizing strategy. Moreover, this strategy is unique in the sense that its value
process ÀÜV is uniquely determined as
ÀÜVt = E[ H | Ft ],
t = 0, . . . , T,
(10.9)
and that its cost process is given by
ÀÜCt = ÀÜV0 + Lt,
t = 0, . . . , T,
where L is the strongly orthogonal P -martingale arising in the Kunita‚ÄìWatanabe
decomposition of ÀÜV .
The identity (10.9) allows for a time-consistent interpretation of ÀÜVt as an arbitrage-
free price for H at time t. In the general case in which X is not a martingale under
P, one may ask whether there exists an equivalent martingale measure ÀÜP such that
the value process ÀÜV of a locally risk-minimizing strategy can be obtained in a similar
manner as the martingale
ÀÜE[ H | Ft ],
t = 0, . . . , T.
(10.10)
DeÔ¨Ånition 10.21. An equivalent martingale measure ÀÜP ‚ààP is called a minimal mar-
tingale measure if
E
 d ÀÜP
dP
2 
< ‚àû,

10.2 Minimal martingale measures
383
and if every P-martingale M ‚ààH2 which is strongly orthogonal to X is also a
ÀÜP -martingale.
The following result shows that a minimal martingale measure provides the desired
representation (10.10) ‚Äì if such a minimal martingale measure exists.
Theorem 10.22. If ÀÜP is a minimal martingale measure, and if ÀÜV is the value process
of a locally risk-minimizing strategy, then
ÀÜVt = ÀÜE[ H | Ft ],
t = 0, . . . , T.
Proof. Denote by
H = c +
T

t=1
Œæt ¬∑ (Xt ‚àíXt‚àí1) + LT
an orthogonal decomposition of H as in Corollary 10.14. Then ÀÜV is given by
ÀÜVt = c +
t
s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1) + Lt.
The process L is a ÀÜP -martingale, because it is a square-integrable P -martingale
strongly orthogonal to X.
Moreover, Œæs ¬∑ (Xs ‚àíXs‚àí1) ‚ààL1( ÀÜP ), because both
Œæs ¬∑ (Xs ‚àíXs‚àí1) and d ÀÜP /dP are square-integrable with respect to P . It follows that
ÀÜV is a ÀÜP -martingale. In view of ÀÜVT = H, the assertion follows.
Our next goal is to derive a characterization of a minimal martingale measure and
to use it in order to obtain criteria for its existence. To this end, we have to analyze the
effect of an equivalent change of measure on the structure of martingales. The results
we will obtain in this direction are of independent interest, and their continuous-time
analogues have a wide range of applications in stochastic analysis.
Lemma 10.23. Let 
P be a probability measure equivalent to P . An adapted process

M is a 
P-martingale if and only if the process

Mt ¬∑ E
 d 
P
dP
 Ft

,
t = 0, . . . , T,
is a P-martingale.
Proof. Let us denote
Zt := E
 d 
P
dP
 Ft

.
Observe that 
Mt ‚ààL1(
P ) if and only if 
MtZt ‚ààL1(P ). Moreover, the process Z
is P-a.s. strictly positive by the equivalence of 
P and P . Hence, Proposition A.12
yields that
Zt ¬∑ 
E[ 
Mt+1 | Ft ] = E[ 
Mt+1Zt+1 | Ft ],

384
10 Minimizing the hedging error
and it follows that 
E[ 
Mt+1 | Ft ] = 
Mt if and only if E[ 
Mt+1Zt+1 | Ft ] = 
MtZt.
The following representation (10.12) of the density process may be viewed as the
discrete-time version of the Dol√©ans‚ÄìDade stochastic exponential in continuous-time
stochastic calculus.
Proposition 10.24. If 
P is a probability measure equivalent to P , then there exists a
P-martingale  such that
0 = 1
and
t+1 ‚àít > ‚àí1
P -a.s. for all t,
(10.11)
and such that the martingale
Zt := E
 d 
P
dP
 Ft

,
t = 0, . . . , T,
can be represented as
Zt =
t
s=1
(1 + s ‚àís‚àí1),
t = 0, . . . , T.
(10.12)
Conversely, if  is a P -martingale with (10.11) and such that (10.12) deÔ¨Ånes a
P-martingale Z, then
d 
P := ZT dP
deÔ¨Ånes a probability measure 
P ‚âàP .
Proof. For 
P ‚âàP given, deÔ¨Åne  by 0 = 1 and
t+1 := t + Zt+1 ‚àíZt
Zt
,
t = 0, . . . , T ‚àí1.
Clearly, (10.12) holds with this choice of . In particular,  satisÔ¨Åes (10.11), because
the equivalence of P and 
P implies that Zt is P -a.s. strictly positive for all t.
In the next step, we show by induction on t that t ‚ààL1(P ). For t = 0 this holds
by deÔ¨Ånition. Suppose that t ‚ààL1(P ). Since Z is non-negative, the conditional
expectation of Zt+1/Zt is well-deÔ¨Åned and satisÔ¨Åes P -a.s.
E
 Zt+1
Zt
 Ft

= 1
Zt
¬∑ E[ Zt+1 | Ft ] = 1.
It follows that Zt+1/Zt ‚ààL1(P ) and in turn that
t+1 = t ‚àí1 + Zt+1
Zt
‚ààL1(P ).

10.2 Minimal martingale measures
385
Now it is easy to derive the martingale property of : Since Zt is strictly positive,
we may divide both sides of the equation E[ Zt+1 | Ft ] = Zt by Zt, and we arrive at
E[ t+1 ‚àít | Ft ] = 0.
As for the second assertion, it is clear that E[ Zt ] = Z0 = 1 for all t, provided
that  is a P -martingale such that (10.11) holds and such that (10.12) deÔ¨Ånes a strictly
positive P-martingale Z.
The following theorem shows how a martingale M is affected by an equivalent
change of the underlying probability measure P. Typically, M will no longer be a mar-
tingale under the new measure 
P , and so a non-trivial predictable process (At)t=1,...,T
will appear in the Doob decomposition
M = 
M + A
of M under 
P. Alternatively, ‚àíA may be viewed as the predictable process arising in
the Doob decomposition of the 
P -martingale 
M under the measure P . The following
result, a discrete-time version of the Girsanov formula, describes A in terms of the
martingale  arising in the representation (10.12) of the successive densities.
Theorem 10.25. Let P and 
P be two equivalent probability measures, and let  de-
note the P -martingale arising in the representation (10.12) of the successive densities
Zt := E[ d 
P/dP | Ft ]. If 
M is a 
P -martingale such that 
Mt ‚ààL1(P ) for all t, then
Mt := 
Mt +
t
s=1
E

(s ‚àís‚àí1)( 
Ms ‚àí
Ms‚àí1) | Fs‚àí1

is a P-martingale.
Proof. Note Ô¨Årst that
(t ‚àít‚àí1)( 
Mt ‚àí
Mt‚àí1) =
1
Zt‚àí1

Zt( 
Mt ‚àí
Mt‚àí1)

‚àí( 
Mt ‚àí
Mt‚àí1) .
(10.13)
According to Lemma 10.23, Zt( 
Mt ‚àí
Mt‚àí1) is a martingale increment, and hence
belongs to L1(P ). If we let
œÑn := inf{ t | Zt < 1/n } ‚àßT,
n = 2, 3, . . . ,
it follows that
(t ‚àít‚àí1)( 
Mt ‚àí
Mt‚àí1) I{œÑn‚â•t} ‚ààL1(P ) .
In particular, the conditional expectations appearing in the statement of the theorem
are P-a.s. well-deÔ¨Åned. Moreover, the identity (10.13) implies that P -a.s. on {œÑn ‚â•t}
E[ 
Mt ‚àí
Mt‚àí1 | Ft‚àí1 ]
=
1
Zt‚àí1
E

Zt( 
Mt ‚àí
Mt‚àí1) | Ft‚àí1

‚àíE[ (t ‚àít‚àí1)( 
Mt ‚àí
Mt‚àí1) | Ft‚àí1 ]
= ‚àíE

(t ‚àít‚àí1)( 
Mt ‚àí
Mt‚àí1) | Ft‚àí1

.

386
10 Minimizing the hedging error
Thus, we have identiÔ¨Åed the Doob decomposition of 
M under P .
TheprecedingtheoremallowsustocharacterizethoseequivalentmeasuresP ‚àó‚âàP
which are martingale measures. Let
X = Y + B
(10.14)
denote the Doob decomposition of X under P , where Y is a d-dimensional
P-martingale, and (Bt)t=1,...,T is a d-dimensional predictable process.
Corollary 10.26. Let P ‚àó‚âàP be such that E‚àó[ |Xt| ] < ‚àûfor each t, and denote by
 the P-martingale arising in the representation (10.12) of the successive densities
Zt := E[ dP ‚àó/dP | Ft ]. Then P ‚àóis an equivalent martingale measure if and only if
the predictable process B in the Doob decomposition (10.14) satisÔ¨Åes
Bt = ‚àí
t
s=1
E

(s ‚àís‚àí1)(Ys ‚àíYs‚àí1) | Fs‚àí1

= ‚àí
t
s=1
E

(s ‚àís‚àí1)(Xs ‚àíXs‚àí1) | Fs‚àí1

P-a.s. for t = 1, . . . , T .
Proof.
If P ‚àóis an equivalent martingale measure, then our formula for B is an
immediate consequence of Theorem 10.25. For the proof of the converse direction,
we denote by
X = Y ‚àó+ B‚àó
the Doob decomposition of X under P ‚àó. Then Y ‚àóis a P ‚àó-martingale. Using Theo-
rem 10.25, we see that Y ‚àó:= Y ‚àó+ 
B‚àóis a P -martingale where

B‚àó
t =
t
s=1
E

(s ‚àís‚àí1)(Y ‚àó
s ‚àíY ‚àó
s‚àí1) | Fs

= ‚àíBt.
On the other hand, Y = X ‚àíB = Y ‚àó+ (B‚àó‚àíB) is a P -martingale. It follows that
the Doob decomposition of Y ‚àóunder P is given by Y ‚àó= Y + (B ‚àíB‚àó). Hence,
Y + (B ‚àíB‚àó) = Y ‚àó= Y ‚àó‚àí
B‚àó= Y ‚àó+ B.
The uniqueness of the Doob decomposition implies B‚àó‚â°0, so X is a P ‚àó-martingale.
We can now return to our initial task of characterizing a minimal martingale mea-
sure.

10.2 Minimal martingale measures
387
Theorem 10.27. Let ÀÜP ‚ààP be an equivalent martingale measure whose density
d ÀÜP /dP is square-integrable. Then ÀÜP is a minimal martingale measure if and only
if the P-martingale  of (10.12) admits a representation as a ‚Äústochastic integral‚Äù
with respect to the P -martingale Y arising in the Doob decomposition of X:
t = 1 +
t
s=1
Œªs ¬∑ (Ys ‚àíYs‚àí1),
t = 0, . . . , T,
(10.15)
for some d-dimensional predictable process Œª.
Proof. To prove sufÔ¨Åciency of (10.15), we have to show that if M ‚ààH2 is strongly
orthogonal to X, then M is a ÀÜP -martingale. By Lemma 10.23 this follows if we can
show that MZ is a P -martingale where
Zt := E
 d ÀÜP
dP
 Ft

.
Clearly, MtZt ‚ààL1(P ) since M and Z are both square-integrable.
For the next step, we introduce the stopping times
œÑn := inf

t ‚â•0 | |Œªt+1| > n

.
By stopping the martingale  at œÑn, we obtain the P -martingale œÑn. Since X is
square-integrable, an application of Jensen‚Äôs inequality yields that E[ |Yt|2 ] < ‚àûfor
all t. In particular, MœÑn is integrable. Furthermore, Lemma 10.15 shows that the
strong orthogonality of M and Y implies that MY is a d-dimensional P -martingale.
Hence,
E

Mt+1(œÑn
t+1 ‚àíœÑn
t ) | Ft

= I{t+1‚â§œÑn}Œªt+1 ¬∑

E[ Mt+1Yt+1 | Ft ] ‚àíE[ Mt+1 | Ft ]Yt

= 0.
Noting that
ZœÑn
t
=
t
s=1
(1 + œÑn
s ‚àíœÑn
s‚àí1),
and that ZœÑn is square-integrable, we conclude that
E[ Mt+1ZœÑn
t+1 | Ft ] = ZœÑn
t E

Mt+1(1 + œÑn
t+1 ‚àíœÑn
t ) | Ft

= ZœÑn
t Mt.
Thus, ZœÑnM is a P -martingale for each n. By Doob‚Äôs stopping theorem, the process
(ZœÑnM)œÑn = (ZM)œÑn
is also a P -martingale. Since œÑn ‚ÜóT P-a.s. and
MœÑn
t+1ZœÑn
t+1
 ‚â§
T

s=0
MsZs
 ‚ààL1(P ),

388
10 Minimizing the hedging error
we may apply the dominated convergence theorem for conditional expectations to
obtain the desired martingale property of MZ:
E[ Mt+1Zt+1 | Ft ] = lim
n‚Üë‚àûE[ MœÑn
t+1ZœÑn
t+1 | Ft ] = lim
n‚Üë‚àûMœÑn
t ZœÑn
t
= MtZt.
Thus, ÀÜP is a minimal martingale measure.
For the proof of the converse assertion of the theorem, denote by
Zt = 1 +
t
s=1
Œ∑s ¬∑ (Ys ‚àíYs‚àí1) + Lt
the Kunita‚ÄìWatanabe decomposition of the density process Z with respect to the
measure P and the square-integrable martingale Y, as explained in Theorem 10.18.
The process L is a square-integrable P -martingale strongly orthogonal to Y, and hence
to X. Thus, the assumption that ÀÜP is a minimal martingale measure implies that L is
also a ÀÜP -martingale. Applying Lemma 10.23, it follows that
LtZt = Lt + Lt
t
s=1
Œ∑s ¬∑ (Ys ‚àíYs‚àí1) + L2
t
is a P-martingale. According to Lemma 10.15, the strong orthogonality of L and Y
yields that
Lt
t
s=1
Œ∑s ¬∑ (Ys ‚àíYs‚àí1)
is a P-martingale; recall that Œ∑s ¬∑ (Ys ‚àíYs‚àí1) ‚ààL2(P ) for all s. But then (L2
t ) must
also be a martingale. In particular, the expectation of L2
t is independent of t and so
E[ L2
t ] = L2
0 = 0
from which we get that L vanishes P -almost surely. Hence, Z is equal to the ‚Äústochas-
tic integral‚Äù of Œ∑ with respect to Y, and we conclude that
t+1 ‚àít = Zt+1 ‚àíZt
Zt
= 1
Zt
Œ∑t+1 ¬∑ (Yt+1 ‚àíYt),
so that (10.15) holds with Œªt := Œ∑t/Zt‚àí1.
Corollary 10.28. There exists at most one minimal martingale measure.
Proof. Let ÀÜP and ÀÜP ‚Ä≤ be two minimal martingale measures, and denote the martingales
in the representation (10.12) by  and ‚Ä≤, respectively. On the one hand, it follows
from Corollary 10.26 that the martingale N := ‚àí‚Ä≤ is strongly orthogonal to Y. On

10.2 Minimal martingale measures
389
the other hand, Theorem 10.27 implies that N admits a representation as a ‚Äústochastic
integral‚Äù with respect to the P -martingale Y:
Nt =
t
s=1
(Œªs ‚àíŒª‚Ä≤
s) ¬∑ (Ys ‚àíYs‚àí1),
t = 0, . . . , T.
Let œÑn := inf{t | |Œªt+1 ‚àíŒª‚Ä≤
t+1| > n}, so that NœÑn is in L2(P ). Then it follows as
in the proof of Corollary 10.14 that NœÑn vanishes P -almost surely. Hence the densities
of ÀÜP and ÀÜP ‚Ä≤ coincide.
Recall that, for d = 1, we denote by
œÉ 2
t = var( Xt ‚àíXt‚àí1 | Ft‚àí1 )
the conditional variance of the increments of X.
Corollary 10.29. In dimension d = 1, the following two conditions are implied by
the existence of a minimal martingale measure ÀÜP :
(a) The predictable process Œª arising in the representation formula (10.15) is of the
form
Œªt = ‚àíE[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
œÉ 2t
P -a.s. on { œÉ 2
t Ã∏= 0 }.
(10.16)
(b) For each t, P -a.s. on {œÉ 2
t Ã∏= 0},
(Xt ‚àíXt‚àí1) ¬∑ E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] < E[ (Xt ‚àíXt‚àí1)2 | Ft‚àí1 ].
Proof. (a): Denote by X = Y + B the Doob decomposition of X with respect to P .
According to Corollary 10.26, the P -martingale  arising in the representation (10.12)
of the density d ÀÜP /dP must satisfy
Bt ‚àíBt‚àí1 = ‚àíE

(t ‚àít‚àí1)(Yt ‚àíYt‚àí1) | Ft‚àí1

.
Using that œÉ 2
t = E[ (Yt ‚àíYt‚àí1)2 | Ft‚àí1 ] and that Bt ‚àíBt‚àí1 = E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
yields our formula for Œªt.
(b): By Proposition 10.24, the P -martingale  must be such that
t ‚àít‚àí1 = Œªt ¬∑ (Yt ‚àíYt‚àí1) > ‚àí1
P -a.s. for all t.
Given (a), this condition is equivalent to (b).
Note that condition (b) of Corollary 10.29 is rather restrictive as it imposes
an almost-sure bound on the Ft-measurable increment Xt ‚àíXt‚àí1 in terms of
Ft‚àí1-measurable quantities.

390
10 Minimizing the hedging error
Theorem 10.30. Consider a market model with a single risky asset satisfying condi-
tion (b) of Corollary 10.29 and the assumption

E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
2 ‚â§C ¬∑ œÉ 2
t ,
P -a.s. for all t ‚â•1,
of bounded mean-variance trade-off. Then there exists a unique minimal martingale
measure ÀÜP whose density d ÀÜP /dP = ZT is given via (10.16), (10.15), and (10.12).
Proof. Denote by X = Y + B the Doob decomposition of X under P . For Œªt deÔ¨Åned
via (10.16), the assumption of bounded mean-variance trade-off yields that
E
 
Œªt ¬∑ (Yt ‚àíYt‚àí1)
2 | Ft‚àí1

‚â§C
P -a.s.
(10.17)
Hence, t deÔ¨Åned according to (10.15) is a square-integrable P -martingale. As ob-
served in the second part of the proof of Corollary 10.29, its condition (b) holds if and
only if t ‚àít‚àí1 > ‚àí1 for all t, so that Z deÔ¨Åned by
Zt =
t
s=1
(1 + s ‚àís‚àí1) =
t
s=1

1 + Œªs ¬∑ (Ys ‚àíYs‚àí1)

is P-a.s. strictly positive. Moreover, the bound (10.17) guarantees that Z is a square-
integrable P-martingale. We may thus conclude from Proposition 10.24 that Z is
the density process of a probability measure ÀÜP ‚âàP with a square-integrable density
d ÀÜP /dP . In particular, Xt is ÀÜP -integrable for all t. Our choice of Œª implies that
E

(t ‚àít‚àí1)(Yt ‚àíYt‚àí1) | Ft‚àí1

= ‚àíE[ Xt ‚àíXt‚àí1 | Ft‚àí1 ]
= ‚àí(Bt ‚àíBt‚àí1),
and so ÀÜP is an equivalent martingale measure by Corollary 10.26. Finally, The-
orem 10.27 states that ÀÜP is a minimal martingale measure, while uniqueness was
already established in Corollary 10.28.
Example 10.31. Let us consider again the market model of Example 10.13 with in-
dependent and identically distributed returns Rt ‚ààL2(P ). We have seen that the
condition of bounded mean-variance trade-off is satisÔ¨Åed without further assump-
tions. Let 
m := E[ R1 ] and œÉ 2 := var(R1). A short calculation using the formulas
for E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ] and var( Xt ‚àíXt‚àí1 | Ft‚àí1 ) obtained in Example 10.13
shows that the crucial condition (b) of Corollary 10.29 is equivalent to
(
m ‚àír)R1 < œÉ 2 + 
m(
m ‚àír)
P -a.s.
(10.18)
Hence, (10.18) is equivalent to the existence of the minimal martingale measure. For

m > r the condition (10.18) is an upper bound on R1, while we obtain a lower bound

10.2 Minimal martingale measures
391
for 
m < r. In the case 
m = r, the measure P is itself the minimal martingale measure,
and the condition (10.18) is void. If the distribution of R1 is given, and if
a ‚â§R1 ‚â§b
P -a.s.
for certain constants a > ‚àí1 and b < ‚àû, then (10.18) is satisÔ¨Åed for all r in a certain
neighborhood of 
m.
‚ô¶
Remark 10.32. The purpose of condition (b) of Corollary 10.29 is to ensure that the
density Z deÔ¨Åned via
Zt =
t
s=1

1 + Œªs ¬∑ (Ys ‚àíYs‚àí1)

is strictly positive. In cases where this condition is violated, Z may still be a square-
integrable P-martingale and can be regarded as the density of a signed measure
d ÀÜP = ZT dP,
whichsharessomepropertieswiththeminimalmartingalemeasureofDeÔ¨Ånition10.21;
see, e.g., [186].
‚ô¶
In the remainder of this section, we consider brieÔ¨Çy another quadratic criterion for
the risk of an L2-admissible strategy.
DeÔ¨Ånition 10.33. Theremainingconditionalrisk ofanL2-admissiblestrategy(Œæ0, Œæ)
with cost process C is given by the process
Rrem
t
(Œæ0, Œæ) := E[ (CT ‚àíCt)2 | Ft ],
t = 0, . . . , T.
We say that an L2-admissible strategy (Œæ0, Œæ) minimizes the remaining conditional
risk if
Rrem
t
(Œæ0, Œæ) ‚â§Rrem
t
(Œ∑0, Œ∑)
P -a.s.
for all t and for each L2-admissible strategy (Œ∑0, Œ∑) which coincides with (Œæ0, Œæ) up
to time t.
The next result shows that minimizing the remaining conditional risk for a mar-
tingale measure is the same as minimizing the local risk. In this case, Corollary 10.20
yields formulas for the value process and the cost process of a minimizing strategy.
Proposition 10.34. For P ‚ààP, an L2-admissible strategy minimizes the remaining
conditional risk if and only if it is locally risk minimizing.

392
10 Minimizing the hedging error
Proof.
Let (ÀÜŒæ0, ÀÜŒæ) be a locally risk-minimizing strategy, which exists by Corol-
lary 10.20, and write ÀÜV and ÀÜC for its value and cost processes. Take another L2-
admissible strategy (Œ∑0, Œ∑) whose value and cost processes are denoted by V and C.
Since ÀÜVT = H = VT , the cost process C satisÔ¨Åes
CT ‚àíCt = VT ‚àíVt ‚àí
T

k=t+1
Œ∑k ¬∑ (Xk ‚àíXk‚àí1)
= ÀÜVt ‚àíVt +
T

k=t+1
(ÀÜŒæk ‚àíŒ∑k) ¬∑ (Xk ‚àíXk‚àí1) + ÀÜCT ‚àíÀÜCt.
Since X and ÀÜC are strongly orthogonal martingales, the remaining conditional risk of
(Œ∑0, Œ∑) satisÔ¨Åes
Rrem
t
(Œ∑0, Œ∑)
= ( ÀÜVt ‚àíVt)2 + E
 
T

k=t+1
(ÀÜŒæk ‚àíŒ∑k)2 (Xk ‚àíXk‚àí1)2  Ft
!
+ E[ ( ÀÜCT ‚àíÀÜCt)2 | Ft ],
and this expression is minimal if and only if Vt = 
Vt and Œ∑k = ÀÜŒæk for all k ‚â•t + 1
P-almost surely.
In general, however, an L2-admissible strategy minimizing the remaining condi-
tional risk does not exist, as will be shown in the following Section 10.3.
10.3 Variance-optimal hedging
Let H ‚ààL2(P ) be a square-integrable discounted claim. Throughout this section,
we assume that the discounted price process X of the risky asset is square-integrable
with respect to P :
E[ |Xt|2
< ‚àû
for all t.
As in the previous section, there is no need to exclude the existence of arbitrage
opportunities, even though the cases of interest will of course be arbitrage-free.
Informally, the problem of variance-minimal hedging is to minimize the quadratic
hedging error deÔ¨Åned as the squared L2(P )-distance
‚à•H ‚àíVT ‚à•2
2 = E[ (H ‚àíVT )2 ]
between H and the terminal value of the value process V of a self-Ô¨Ånancing trading
strategy.

10.3 Variance-optimal hedging
393
Remark 10.35. Mean-variance hedging is closely related to the discussion in the pre-
ceding sections, where we considered the problems of minimizing the local conditional
risk or the remaining conditional risk within the class of L2-admissible strategies for
H. To see this, let (Œæ0, Œæ) be an L2-admissible strategy for H in the sense of DeÔ¨Åni-
tion 10.4, and denote by V , G, and C the resulting value, gains, and cost processes.
The quantity
R(Œæ0, Œæ) := E

(CT ‚àíC0)2 
may be called the ‚Äúglobal quadratic risk‚Äù of (Œæ0, Œæ). It coincides with the initial value
of the process Rrem
0 (Œæ0, Œæ) of the remaining conditional risk introduced in DeÔ¨Åni-
tion 10.33. Note that
R(Œæ0, Œæ) = E

(H ‚àíV0 ‚àíGT )2 
is independent of the values of the num√©raire component Œæ0 at the times t = 1, . . . , T .
Thus, the global quadratic risk of the generalized trading strategy (Œæ0, Œæ) coincides
with the quadratic hedging error
E

(H ‚àí
VT )2 
where 
V is the value process of the self-Ô¨Ånancing trading strategy arising from the
d-dimensional predictable process Œæ and the initial investment 
V0 = V0 = Œæ0
0 .
‚ô¶
Let us rephrase the problem of mean-variance hedging in a form which can be
interpreted both within the class of self-Ô¨Ånancing trading strategies and within the
context of Section 10.1. For a d-dimensional predictable process Œæ we denote by
G(Œæ) the gains process
Gt(Œæ) =
t
s=1
Œæs ¬∑ (Xs ‚àíXs‚àí1),
t = 0, . . . , T,
associated with Œæ. Let us introduce the class
S :=

Œæ | Œæ is predictable and Gt(Œæ) ‚ààL2(P ) for all t

.
DeÔ¨Ånition 10.36. A pair (V ‚àó
0 , Œæ‚àó) where V ‚àó
0 ‚ààR and Œæ‚àó‚ààS is called a variance-
optimal strategy for the discounted claim H if
E
 
H ‚àíV ‚àó
0 ‚àíGT (Œæ‚àó)
2 
‚â§E
 
H ‚àíV0 ‚àíGT (Œæ)
2 
for all V0 ‚ààR and all Œæ ‚ààS.
Our Ô¨Årst result identiÔ¨Åes a variance-optimal strategy in the case P ‚ààP .
Proposition 10.37. Assume that P ‚ààP, and let (ÀÜŒæ0, ÀÜŒæ) be a locally risk-minimizing
L2-admissible strategy as constructed in Corollary 10.20. Then (V ‚àó
0 , Œæ‚àó) := (ÀÜŒæ0
0 , ÀÜŒæ)
is a variance-optimal strategy.

394
10 Minimizing the hedging error
Proof. Recall from Remark 10.35 that if (Œæ0, Œæ) is an L2-admissible strategy for H
with value process V , then the expression
E
 
H ‚àíV0 ‚àíGT (Œæ)
2 
is equal to the initial value Rrem
0 (Œæ0, Œæ) of the remaining conditional risk process of
(Œæ0, Œæ). But according to Proposition 10.34, Rrem
0
is minimized by (ÀÜŒæ0, ÀÜŒæ).
The general case where X is not a P -martingale will be studied under the simpli-
fying assumption that the market model contains only one risky asset. We will Ô¨Årst
derive a general existence result, and then determine an explicit solution in a special
setting. The key idea for showing the existence of a variance-optimal strategy is to
minimize the functional
S ‚àãŒæ ‚àí‚ÜíE
 
H ‚àíV0 ‚àíGT (Œæ)
2 
,
Ô¨Årst for Ô¨Åxed V0, and then to vary the parameter V0. The Ô¨Årst step will be accomplished
by projecting H ‚àíV0 onto the space of ‚Äústochastic integrals‚Äù
GT :=

GT (Œæ) | Œæ ‚ààS

.
Clearly, GT is a linear subspace of L2(P ). Thus, we can obtain the optimal Œæ = Œæ(V0)
by using the orthogonal projection of H ‚àíV0 on GT as soon as we know that GT is
closed in L2(P ). In order to formulate a criterion for the closedness on GT , we denote
by
œÉ 2
t := var( Xt ‚àíXt‚àí1 | Ft‚àí1 ),
t = 1, . . . , T,
the conditional variance, and by
Œ±t := E[ Xt ‚àíXt‚àí1 | Ft‚àí1 ],
t = 1, . . . , T,
the conditional mean of the increments of X.
Proposition 10.38. Suppose that d = 1, and assume the condition of bounded mean-
variance trade-off
Œ±2
t ‚â§C ¬∑ œÉ 2
t
P -a.s. for all t.
(10.19)
Then GT is a closed linear subspace of L2(P ).
Proof. Let X = M + A be the Doob decomposition of X into a P -martingale M and
a process A such that A0 = 0 and (At)t=1,...,T is predictable. Since
œÉ 2
T = var( XT ‚àíXT ‚àí1 | FT ‚àí1 ) = E

(MT ‚àíMT ‚àí1)2 | FT ‚àí1

,
we get for Œæ ‚ààS
E

GT (Œæ)2 
= E

GT ‚àí1(Œæ) + ŒæT ¬∑ (XT ‚àíXT ‚àí1)
2 
= E

GT ‚àí1(Œæ) + ŒæT ¬∑ (AT ‚àíAT ‚àí1)
2 
+ E

ŒæT ¬∑ (MT ‚àíMT ‚àí1)
2 
‚â•E

Œæ2
T ¬∑ œÉ 2
T

.
(10.20)

10.3 Variance-optimal hedging
395
Suppose now that Œæn is a sequence in S such that GT (Œæn) converges in L2(P ) to some
Y. Applying the inequality (10.20) to GT (Œæn) ‚àíGT (Œæm) = GT (Œæn ‚àíŒæm), we Ô¨Ånd
that œÜn := Œæn
T ¬∑ œÉT is a Cauchy sequence in L2(P ). Denote œÜ := limn œÜn, and let
ŒæT := I{œÉT >0}
œÜ
œÉT
.
By using our assumption (10.19), we obtain
E
 
Œæn
T ¬∑ (XT ‚àíXT ‚àí1) ‚àíŒæT ¬∑ (XT ‚àíXT ‚àí1)
2 
= E

(Œæn
T ‚àíŒæT )2 ¬∑ E[ (XT ‚àíXT ‚àí1)2 | FT ‚àí1 ]

= E

(Œæn
T ‚àíŒæT )2 ¬∑ (œÉ 2
T + Œ±2
T )

‚â§(1 + C) E[ (Œæn
T œÉT ‚àíŒæT œÉT )2 ]
= (1 + C) E[ (œÜn ‚àíœÜ)2 ].
Since the latter term converges to 0, it follows that
GT ‚àí1(Œæn) = GT (Œæn) ‚àíŒæn
T ¬∑ (XT ‚àíXT ‚àí1) ‚àí‚ÜíY ‚àíŒæT ¬∑ (XT ‚àíXT ‚àí1)
in L2(P ). A backward iteration of this argument yields a predictable process Œæ ‚ààS
such that Y = GT (Œæ). Hence, GT is closed in L2(P ).
Theorem 10.39. Indimensiond = 1, thecondition(10.19)ofboundedmean-variance
trade-off guarantees the existence of a variance-optimal strategy (V ‚àó
0 , Œæ‚àó). Such a
strategy is P-a.s. unique up to modiÔ¨Åcations of Œæ‚àó
t on {œÉt = 0}.
Proof.
Let p : L2(P ) ‚ÜíGT denote the orthogonal projection onto the closed
subspace GT of the Hilbert space L2(P ), i.e., p : L2(P ) ‚ÜíGT is a linear operator
such that
E
 
Y ‚àíp(Y)
2 
= min
Z‚ààGT
E

(Y ‚àíZ)2 
(10.21)
for all Y ‚ààL2(P ).
For any V0 ‚ààR we choose some Œæ(V0) ‚ààS such that GT

Œæ(V0)

= p(H ‚àíV0).
The identity (10.21) shows that Œæ(V0) minimizes the functional
E
 
H ‚àíV0 ‚àíGT (Œæ)
2
among all Œæ ‚ààS. Note that
V0 ‚ÜíGT

Œæ(V0)

= p(H ‚àíV0) = p(H) ‚àíV0 ¬∑ p(1)
is an afÔ¨Åne mapping. Hence,
E
 
H ‚àíV0 ‚àíGT

Œæ(V0)
2

396
10 Minimizing the hedging error
is a quadratic function of V0 and there exists a minimizer V ‚àó
0 . For any V0 ‚ààR and
Œæ ‚ààS we clearly have
E
 
H ‚àíV0 ‚àíGT (Œæ)
2
‚â•E
 
H ‚àíV0 ‚àíGT

Œæ(V0)
2
‚â•E
 
H ‚àíV ‚àó
0 ‚àíGT

Œæ(V ‚àó
0 )
2
.
Hence (V ‚àó
0 , Œæ‚àó) := (V ‚àó
0 , Œæ(V ‚àó
0 )) is a variance-optimal strategy. Uniqueness follows
from (10.20) and an induction argument.
Under the additional assumption that
Œ±2
t
œÉ 2t
is deterministic for each t
(10.22)
(here we use the convention 0
0 := 0), the variance-optimal strategy (Œæ‚àó, V ‚àó
0 ) can be
determined explicitly. It turns out that (Œæ‚àó, V ‚àó
0 ) is closely related to the locally risk-
minimizing strategy (ÀÜŒæ0, ÀÜŒæ) for the discounted claim H. Recall from Proposition 10.10
that (ÀÜŒæ0, ÀÜŒæ) and its value process ÀÜV are determined by the following recursion:
ÀÜVT = H,
ÀÜŒæt+1 = cov( ÀÜVt+1, Xt+1 ‚àíXt | Ft )
œÉ 2
t+1
¬∑ I{œÉt+1Ã∏=0},
ÀÜVt = E[ ÀÜVt+1 | Ft ] ‚àíÀÜŒæt+1 ¬∑ E[ Xt+1 ‚àíXt | Ft ] ;
the num√©raire component ÀÜŒæ0 is given by ÀÜŒæ0
t := ÀÜVt ‚àíÀÜŒæt ¬∑ Xt.
Theorem 10.40. Under condition (10.22), V ‚àó
0 := ÀÜV0 and
Œæ‚àó
t := ÀÜŒæt +
Œ±t
Œ±2t + œÉ 2t
 ÀÜVt‚àí1 ‚àíÀÜV0 ‚àíGt‚àí1(Œæ‚àó)

,
t = 1, . . . , T,
deÔ¨Ånes a variance-optimal strategy (Œæ‚àó, V ‚àó
0 ). Moreover,
E
 
H ‚àíV ‚àó
0 + GT (Œæ‚àó)
2
=
T

t=1
Œ≥t ¬∑ E

( ÀÜCt ‚àíÀÜCt‚àí1)2 
,
where ÀÜC denotes the cost process of ( ÀÜŒæ0, ÀÜŒæ ), and Œ≥t is given by
Œ≥t :=
T
k=t+1
œÉ 2
k
œÉ 2
k + Œ±2
k
.

10.3 Variance-optimal hedging
397
Proof. We prove the assertion by induction on T . For T = 1 the problem is just a
particular case of Proposition 10.10, which yields Œæ‚àó
1 = ÀÜŒæ1 and V ‚àó
0 = ÀÜV0.
For T > 1 we use the orthogonal decomposition
H = ÀÜVT = ÀÜV0 +
T

t=1
ÀÜŒæt ¬∑ (Xt ‚àíXt‚àí1) + ÀÜCT ‚àíÀÜC0,
(10.23)
ofthediscountedclaimH asconstructedinCorollary10.14. Supposethattheassertion
is proved for T ‚àí1. Let us consider the minimization of
ŒæT ‚ÜíE
  ÀÜVT ‚àíVT ‚àí1 ‚àíŒæT ¬∑ (XT ‚àíXT ‚àí1)
2
,
(10.24)
where VT ‚àí1 is any random variable in L2(, FT ‚àí1, P ).
By (10.23) and Theo-
rem 10.9, we may write ÀÜVT as
ÀÜVT = ÀÜVT ‚àí1 + ÀÜŒæT ¬∑ (XT ‚àíXT ‚àí1) + ÀÜCT ‚àíÀÜCT ‚àí1,
where ÀÜC is a P-martingale strongly orthogonal to X. Thus,
E
  ÀÜVT ‚àíVT ‚àí1 ‚àíŒæT ¬∑ (XT ‚àíXT ‚àí1)
2
= E
  ÀÜVT ‚àí1 ‚àíVT ‚àí1 + ( ÀÜŒæT ‚àíŒæT ) ¬∑ (XT ‚àíXT ‚àí1) + ÀÜCT ‚àíÀÜCT ‚àí1
2
.
The expectation conditional on FT ‚àí1 of the integrand on the right-hand side is equal
to
( ÀÜVT ‚àí1 ‚àíVT ‚àí1)2 + 2( ÀÜVT ‚àí1 ‚àíVT ‚àí1)( ÀÜŒæT ‚àíŒæT ) ¬∑ Œ±T
+ ( ÀÜŒæT ‚àíŒæT )2(œÉ 2
T + Œ±2
T ) + E

( ÀÜCT ‚àíÀÜCT ‚àí1)2 | FT ‚àí1

.
(10.25)
This expression is minimized by
ŒæT (VT ‚àí1) := ÀÜŒæT +
Œ±T
Œ±2
T + œÉ 2
T
( ÀÜVT ‚àí1 ‚àíVT ‚àí1),
(10.26)
which must also be the minimizer in (10.24). The minimal value in (10.25) is given
by
( ÀÜVT ‚àí1 ‚àíVT ‚àí1)2
1
1 + Œ±2
T /œÉ 2
T
+ E

( ÀÜCT ‚àíÀÜCT ‚àí1)2 | FT ‚àí1

.
Using our assumption (10.22) that Œ±2
T /œÉ 2
T is constant, we can compute the expectation
of the latter expression, and we arrive at the following identity:
E
  ÀÜVT ‚àíVT ‚àí1 ‚àíŒæT (VT ‚àí1) ¬∑ (XT ‚àíXT ‚àí1)
2
= E

( ÀÜVT ‚àí1 ‚àíVT ‚àí1)2 
¬∑
œÉ 2
T
œÉ 2
T + Œ±2
T
+ E

( ÀÜCT ‚àíÀÜCT ‚àí1)2
.
(10.27)

398
10 Minimizing the hedging error
So far, we have not speciÔ¨Åed VT ‚àí1. Let us now consider the minimization of
E
  ÀÜVT ‚àíVT ‚àí1 ‚àíŒæT (VT ‚àí1) ¬∑ (XT ‚àíXT ‚àí1)
2
with respect to VT ‚àí1, when VT ‚àí1 is of the form VT ‚àí1 = V0 + GT ‚àí1(Œæ) for Œæ ‚ààS
and V0 ‚ààR. According to our identity (10.27), this problem is equivalent to the
minimization of
(V0, Œæ) ‚àí‚ÜíE
 
HT ‚àí1 ‚àíV0 + GT ‚àí1(Œæ)
2
,
where HT ‚àí1 := ÀÜVT ‚àí1. By the induction hypotheses, this problem is solved by V ‚àó
0
and (Œæ‚àó
t )t=1,...,T ‚àí1 as deÔ¨Åned in the assertion.
Inserting our formula (10.26) for
ŒæT

V ‚àó
0 + GT ‚àí1(Œæ‚àó)

completes the induction argument.
Remark 10.41. The martingale property of ÀÜC implies
E

( ÀÜCT ‚àíÀÜC0)2 
=
T

t=1
E

( ÀÜCt ‚àíÀÜCt‚àí1)2 
.
If ÀÜC Ã∏‚â°ÀÜC0 and if Œ≥1 < 1, then E[ ( ÀÜCT ‚àíÀÜC0)2 ] must be strictly larger than the minimal
global risk
E
 
H ‚àí(V ‚àó
0 + GT (Œæ‚àó))
2
=
T

t=1
Œ≥t ¬∑ E

( ÀÜCt ‚àíÀÜCt‚àí1)2 
.
‚ô¶
Remark 10.42. If follows from Theorem 10.40 as well as from the preceding remark
that the component ÀÜŒæ of a variance-optimal strategy (ÀÜŒæ0, ÀÜŒæ) will differ from the corre-
sponding Œæ‚àóof a locally risk-minimizing strategy, if Œ±t does not vanish for all t, i.e.,
if P is not a martingale measure. This explains why there may be no strategy which
minimizes the remaining conditional risk in the sense of DeÔ¨Ånition 10.33: For the
minimality of
Rrem
0 (Œæ0, Œæ) = E

(CT ‚àíC0)2 
= E

(H ‚àíŒæ0
0 ‚àíGT (Œæ))2 
we need that Œæ = Œæ‚àó, while the minimality of
Rrem
T ‚àí1(Œæ0, Œæ) = E

(CT ‚àíCT ‚àí1)2 | FT ‚àí1

= Rloc
T ‚àí1(Œæ0, Œæ)
requires ŒæT = ÀÜŒæT . Hence, the two minimality requirements are in general incom-
patible.
‚ô¶

Appendix
A.1 Convexity
This section contains a few basic facts on convex functions and on convex sets in
Euclidean space. Denote by
|x| := ‚àöx ¬∑ x
the Euclidean norm of x ‚ààRn.
Proposition A.1. Suppose that C ‚äÇRn is a non-empty convex set with 0 /‚ààC. Then
there exists Œ∑ ‚ààRn with Œ∑ ¬∑ x ‚â•0 for all x ‚ààC, and with Œ∑ ¬∑ x0 > 0 for at least one
x0 ‚ààC. Moreover, if infx‚ààC |x| > 0, then one can Ô¨Ånd Œ∑ ‚ààRn with infx‚ààC Œ∑ ¬∑ x > 0.
Proof. First we consider the case in which infx‚ààC |x| > 0. This inÔ¨Åmum is attained
by some y in the closure C of C. Since the set C is also convex, |y +Œ±(x ‚àíy)|2 ‚â•|y|2
for each x ‚ààC and all Œ± ‚àà[0, 1]. Thus
2Œ± y ¬∑ (x ‚àíy) + Œ±2 |x ‚àíy|2 ‚â•0.
For Œ± ‚Üì0 we obtain y ¬∑ x ‚â•y ¬∑ y > 0, and so we can take Œ∑ := y.
Now let C be any non-empty convex subset of Rn such that 0 /‚ààC. In a Ô¨Årst step,
we will show that C is a proper subset of Rn. To this end, let {e1, . . . , ek} be a maximal
collection of linearly independent vectors in C. Then each x ‚ààC can be expressed as
a linear combination of e1, . . . , ek. We claim that
z := ‚àí
k

i=1
ei
is not contained in C. We assume by way of contradiction that z ‚ààC. Then there are
zn ‚ààC converging to z. If we write zn = k
i=1 Œªi
nei, then zn ‚Üíz is equivalent to
the convergence Œªi
n ‚Üí‚àí1 for all i. It follows that for some n0 ‚ààN all coefÔ¨Åcients
Œªi
n0 are strictly negative. Let
Œ±0 :=
1
1 ‚àík
i=1 Œªin0
and
Œ±j :=
‚àíŒªj
n0
1 ‚àík
i=1 Œªin0
for j = 1, . . . , k.
Then the Œ±j‚Äôs are non-negative and sum up to 1. Thus, the convexity of C implies that
0 = Œ±0zn0 + Œ±1e1 + ¬∑ ¬∑ ¬∑ + Œ±kek ‚ààC,
which is a contradiction. Hence, z is not contained in C.

400
Appendix
Now we are in a position to prove the existence of a separating Œ∑ in the case in
which 0 is a boundary point of C, and thus infx‚ààC |x| = 0. We may assume without
loss of generality that the linear hull of C is the full space Rn. Since we already
know that C is not dense in Rn, we may choose a sequence (zm) ‚äÇRn such that
infx‚ààC |x ‚àízm| > 0 and zm ‚Üí0. Then Cm := C ‚àízm satisÔ¨Åes infx‚ààCm |x| > 0,
and the Ô¨Årst part of the proof yields corresponding vectors Œ∑m. We may assume that
|Œ∑m| = 1 for all m. By compactness of the (n ‚àí1)-dimensional unit sphere, there
exists a convergent subsequence (Œ∑mk) with limit Œ∑, which satisÔ¨Åes
Œ∑ ¬∑ x = lim
k‚Üë‚àûŒ∑mk ¬∑ x = lim
k‚Üë‚àûŒ∑mk ¬∑ (x ‚àízmk) ‚â•0
for all x ‚ààC. Since Œ∑ is also a unit vector and C is not contained in a proper linear
subspace of Rn, the case Œ∑ ¬∑ x = 0 for all x ‚ààC cannot occur, and so there must be
some x0 ‚ààC with Œ∑ ¬∑ x0 > 0.
DeÔ¨Ånition A.2. Let A be any subset of a linear space E. The convex hull of A is
deÔ¨Åned as
conv A =
$
n

i=1
Œ±ixi
 xi ‚ààA, Œ±i ‚â•0,
n

i=1
Œ±i = 1, n ‚ààN
%
.
It is straightforward to check that conv A is the smallest convex set containing A.
Let us now turn to convex functions on R.
DeÔ¨Ånition A.3. A function f : R ‚ÜíR ‚à™{+‚àû} is called a proper convex function if
f (x) < ‚àûfor some x ‚ààR and if
f

Œ±x + (1 ‚àíŒ±)y

‚â§Œ± f (x) + (1 ‚àíŒ±) f (y)
for x, y ‚ààR and Œ± ‚àà[0, 1]. The effective domain of f , denoted by dom f , consists
of all x ‚ààR such that f (x) < ‚àû.
Clearly, the effective domain of a proper convex function f is a real interval
S = dom f . If considered as a function f : S ‚ÜíR, the function f is convex in
the usual sense. Conversely, any convex function f : S ‚ÜíR deÔ¨Åned on some non-
empty interval S may be viewed as a proper convex function deÔ¨Åned by f (x) := +‚àû
for x ‚ààR\S. The following proposition summarizes continuity and differentiability
properties of a proper convex function on its effective domain.
Proposition A.4. Let f be a proper convex function, and denote by D the interior of
dom f .
(a) f is upper semicontinuous on dom f and locally Lipschitz continuous on D.
(b) f admits left- and right-hand derivatives
f ‚Ä≤
‚àí(y) := lim
x‚Üëy
f (x) ‚àíf (y)
x ‚àíy
and
f ‚Ä≤
+(y) := lim
z‚Üìy
f (z) ‚àíf (y)
z ‚àíy
at each y ‚ààD. Both f ‚Ä≤
+ and f ‚Ä≤
‚àíare increasing functions and satisfy f ‚Ä≤
‚àí‚â§f ‚Ä≤
+.

A.1 Convexity
401
(c) The right-hand derivative f ‚Ä≤
+ is right-continuous, the left-hand derivative f ‚Ä≤
‚àíis
left-continuous.
(d) f is differentiable a.e. in D, and for any x0 ‚ààD
f (x) = f (x0) +
 x
x0
f ‚Ä≤
+(y) dy = f (x0) +
 x
x0
f ‚Ä≤
‚àí(y) dy,
x ‚ààD.
Proof. We Ô¨Årst prove part (b). For x, y, z ‚ààD with x < y < z, we take Œ± ‚àà(0, 1)
such that y = Œ±z + (1 ‚àíŒ±)x. Using the convexity of f , one gets
f (y) ‚àíf (x)
y ‚àíx
‚â§f (z) ‚àíf (x)
z ‚àíx
‚â§f (z) ‚àíf (y)
z ‚àíy
.
(A.1)
Thus, the difference quotient
f (x) ‚àíf (y)
x ‚àíy
is an increasing function of x, which shows the existence of the left- and right-hand
derivatives. Moreover, we get f ‚Ä≤
‚àí(y) ‚â§f ‚Ä≤
+(y) ‚â§f ‚Ä≤
‚àí(z) for y < z.
(a): Let z ‚ààdom f , and take a sequence (xn) ‚äÇdom f such that xn ‚Üíz.
Without loss of generality, we may assume that xn ‚Üìz or xn ‚Üëz. In either case,
xn = Œ¥n x1 + (1 ‚àíŒ¥n)z, where Œ¥n ‚Üì0. Convexity of f yields
lim sup
n‚Üë‚àû
f (xn) ‚â§lim sup
n‚Üë‚àû

Œ¥n f (x1) + (1 ‚àíŒ¥n) f (z)

= f (z),
and so f is upper semicontinuous. To prove local Lipschitz continuity, take a ‚â§x <
y ‚â§b such that [a, b] ‚äÇD. We get from part (b) that
f ‚Ä≤
+(a) ‚â§f ‚Ä≤
+(x) ‚â§f (x) ‚àíf (y)
x ‚àíy
‚â§f ‚Ä≤
‚àí(y) ‚â§f ‚Ä≤
+(b).
Hence, f is Lipschitz continuous on [a, b] with Lipschitz constant L := |f ‚Ä≤
+(a)| ‚à®
|f ‚Ä≤
‚àí(b)|.
(c): Continuity of f shows that for x < z
f (z) ‚àíf (x)
z ‚àíx
= lim
y‚Üìx
f (z) ‚àíf (y)
z ‚àíy
‚â•lim sup
y‚Üìx
f ‚Ä≤
+(y).
Taking z ‚Üìx yields f ‚Ä≤
+(x) ‚â•lim supy‚Üìx f ‚Ä≤
+(y). Since f ‚Ä≤
+ is increasing, we must in
fact have f ‚Ä≤
+(y) ‚Üíf ‚Ä≤
+(x) as y ‚Üìx. In the same way, one shows left-continuity of f ‚Ä≤
‚àí.
(d): Since the function f is Lipschitz continuous, it is absolutely continuous. By
Lebesgue‚Äôs differentiation theorem, f is hence a.e. differentiable and equal to the
integral of its derivative, which is equal to f ‚Ä≤
‚àí(x) = f ‚Ä≤
+(x) for a.e. x ‚ààD.

402
Appendix
DeÔ¨Ånition A.5. The Fenchel‚ÄìLegendre transform of a function f : R ‚ÜíR ‚à™{+‚àû}
is deÔ¨Åned as
f ‚àó(y) := sup
x‚ààR

y x ‚àíf (x)

,
y ‚ààR.
If f Ã∏‚â°+‚àû, then f ‚àóis a convex and lower semicontinuous as the supremum of
the afÔ¨Åne functions y ‚Üíy x ‚àíf (x). In particular, f ‚àóis a proper convex function
which is continuous on its effective domain. If f is itself a proper convex function,
then f ‚àóis also called the conjugate function of f .
Proposition A.6. Let f be a proper convex function.
(a) For all x, y ‚ààR,
xy ‚â§f (x) + f ‚àó(y)
(A.2)
with equality if x belongs to the interior of dom f and if y ‚àà[f ‚Ä≤
‚àí(x), f ‚Ä≤
+(x)].
(b) If f is lower semicontinuous, then f ‚àó‚àó= f , i.e.,
f (x) = sup
y‚ààR

x y ‚àíf ‚àó(y)

,
x ‚ààR.
Proof. (a): The inequality (A.2) is obvious. Now suppose that x0 belongs to the
interior of dom f . Proposition A.4 yields f (x) ‚â•f (x0) + f ‚Ä≤
¬±(x0)(x ‚àíx0) for all
x in the interior of dom f and, by upper semi-continuity, for all x ‚ààR. Hence,
f (x) ‚â•f (x0) + y0 (x ‚àíx0) whenever y0 ‚àà[f ‚Ä≤
‚àí(x0), f ‚Ä≤
+(x0)]. This shows that
x y0 ‚àíf (x) ‚â§x0 y0 ‚àíf (x0) for all x ‚ààR, i.e.,
x0 y0 ‚àíf (x0) = sup
x‚ààR

x y0 ‚àíf (x)

= f ‚àó(y0).
(b): We Ô¨Årst show the following auxiliary claim: If Œ≤ < f (x0), then there exists
an afÔ¨Åne function h such that h(x0) = Œ≤ and h(x) < f (x) for all x. For the proof of
this claim let
C := { (x, a) ‚ààR2 | f (x) ‚â§a }.
C is usually called the epigraph of f . Lower semicontinuity of f implies that C is
closed. The point (x0, Œ≤) does not belong to C, and Proposition A.1 thus yields some
Œ∑ = (Œ∑1, Œ∑2) ‚ààR2 such that
inf
x‚ààdom f(Œ∑1x + Œ∑2f (x)) ‚â•Œ¥ :=
inf
(x,a)‚ààC(Œ∑1x + Œ∑2a) > Œ∑1x0 + Œ∑2Œ≤.
If f (x0) < ‚àû, we get Œ∑1x0 + Œ∑2f (x0) > Œ∑1x0 + Œ∑2Œ≤. Hence Œ∑2 > 0, and one checks
that
h(x) := ‚àíŒ∑1
Œ∑2
(x ‚àíx0) + Œ≤
is as desired. If f (x0) = ‚àûand Œ∑2 > 0, then the same deÔ¨Ånition works. Now
assume that f (x0) = ‚àûand Œ∑2 = 0. Letting h(x) := Œ¥ ‚àíŒ∑1x we have h(x0) > 0

A.2 Absolutely continuous probability measures
403
and h(x) ‚â§0 for x ‚ààdom f . Since f is proper, the Ô¨Årst step of the proof of our
claim allows us to construct an afÔ¨Åne function g with g < f . If g(x0) ‚â•Œ≤, then
h := g + Œ≤ ‚àíg(x0) is as desired. Otherwise, we let h(x) := g(x) + Œªh(x) for
Œª := (Œ≤ ‚àíg(x0))/h(x0). This concludes the proof of our auxiliary claim.
Now we can prove part (b) of the assertion. It is clear from the deÔ¨Ånition that
f ‚â•f ‚àó‚àó. Suppose there exists a point x0 such that f (x0) > f ‚àó‚àó(x0). Take Œ≤ strictly
between f ‚àó‚àó(x0) and f (x0). By the auxiliary claim, there exists an afÔ¨Åne function
h < f such that h(x0) = Œ≤. Let us write h(x) = y0x + Œ±. Then it follows that
f ‚àó(y0) < ‚àíŒ± and hence
f ‚àó‚àó(x0) ‚â•y0x0 ‚àíf ‚àó(y0) > h(x0) = Œ≤,
which is a contradiction.
A.2 Absolutely continuous probability measures
Suppose that P and Q are two probability measures on a measurable space (, F ).
DeÔ¨Ånition A.7. Q is said to be absolutely continuous with respect to P on the
œÉ-algebra F , and we write Q ‚â™P , if for all A ‚ààF ,
P [ A ] = 0
"‚áí
Q[ A ] = 0.
If both Q ‚â™P and P ‚â™Q hold, we will say that Q and P are equivalent, and we
will write Q ‚âàP .
The following characterization of absolute continuity is known as the Radon‚Äì
Nikodym theorem:
Theorem A.8 (Radon‚ÄìNikodym). Q is absolutely continuous with respect to P on
F if and only if there exists an F -measurable function œï ‚â•0 such that

F dQ =

Fœï dP
for all F -measurable functions F ‚â•0.
(A.3)
Proof. See, e.g., ¬ß17 of [20].
The function œï is called the density or Radon‚ÄìNikodym derivative of Q with respect
to P , and we will write
dQ
dP := œï.
Clearly, the Radon‚ÄìNikodym derivative is uniquely determined through (A.3).

404
Appendix
Corollary A.9. If Q ‚â™P on F , then
Q ‚âàP
‚áê‚áí
dQ
dP > 0 P -a.s.
In this case, the density of P with respect to Q is given by
dP
dQ =
 dQ
dP
‚àí1
.
Proof. Suppose that Q ‚â™P , let œï := dQ/dP . Take an F -measurable function
F ‚â•0. Then

F dQ =

{œï>0}
Fœï dP =

{œï>0}
F dQ.
In particular, Q[ œï = 0 ] = 0. Replacing F with Fœï‚àí1 yields

Fœï‚àí1 dQ =

{œï>0}
Fœï‚àí1 dQ =

{œï>0}
Fœï‚àí1œï dP.
Note that the term on the right-hand side equals

F dP for all F if and only if
P[ œï = 0 ] = 0. This proves the result.
Remark A.10. Let us stress that absolute continuity depends on the underlying œÉ-
Ô¨Åeld F . For example, let P be the Lebesgue measure on  := [0, 1). Then every
probability measure Q is absolutely continuous with respect to P on a œÉ-algebra F0
which is generated by Ô¨Ånitely many intervals [ai‚àí1, ai) with 0 = a0 < a1 < ¬∑ ¬∑ ¬∑ <
an = 1. However, if we take for F the Borel œÉ-algebra on , then for instance a
Dirac point mass Q = Œ¥x is clearly not absolutely continuous with respect to P on F .
‚ô¶
While the preceding example shows that, in general, absolute continuity is not
preserved under an enlargement of the underlying œÉ-algebra, the next proposition
states that it is safe to take smaller œÉ-algebras. This proposition involves the notion
of a conditional expectation
E[ F | F0 ]
of an F -measurable function F ‚â•0 with respect to a probability measure P and a
œÉ-algebra F0 ‚äÇF . Recall that E[ F | F0 ] may be deÔ¨Åned as the P -a.s. unique
F0-measurable random variable F0 such that
E[ F ; A0 ] = E[ F0 ; A0 ]
for all A0 ‚ààF0;
(A.4)
see, e.g., ¬ß15 of [19]. Note also our shorthand convention of writing
E[ F ; A0 ] := E[ F IA0 ].
Clearly, we can replace in (A.4) the class of all indicator functions of sets in F0 by
the class of all bounded F0-measurable functions or by the class of all non-negative
F0-measurable functions.

A.2 Absolutely continuous probability measures
405
Proposition A.11. Suppose that Q and P are two probability measures on the mea-
surable space (, F ) and that Q ‚â™P on F with density œï. If F0 is a œÉ-algebra
contained in F , then Q ‚â™P on F0, and the corresponding density is given by
dQ
dP

F0
= E[ œï | F0 ]
P -a.s.
Proof. Q ‚â™P on F0 follows immediately from the deÔ¨Ånition of absolute continuity.
Since œï is the density on F ‚äáF0, it follows for A ‚ààF0 that
Q[ A ] =

A
œï dP =

A
E[ œï | F0 ] dP.
Therefore the F0-measurable random variable E[ œï | F0 ] must coincide with the
density on F0.
Now we prove a formula for computing a conditional expectation EQ[ F | F0 ]
underameasureQintermsofconditionalexpectationswithrespecttoanothermeasure
P with Q ‚â™P.
Proposition A.12. Suppose that Q ‚â™P on F with density œï, and that F0 ‚äÜF is
another œÉ-algebra. Then, for any F -measurable F ‚â•0,
EQ[ F | F0 ] =
1
E[ œï | F0 ] ¬∑ E[ Fœï | F0 ]
Q-a.s.
Proof. Suppose that G0 ‚â•0 is F0-measurable. Then
EQ[ G0F ] = E[ G0Fœï ] = E

G0 ¬∑ E[ Fœï
F0 ]

.
Let œï0 := E[œï | F0]. Proposition A.11 implies that œï0 > 0 Q-almost surely. Hence,
we may assume that G0 = 0 P -a.s. on {œï0 = 0}, and Corollary A.9 yields
E

G0 ¬∑ E[ Fœï
F0 ]

= EQ

G0 ¬∑
1
E[ œï | F0 ]E[ Fœï | F0 ]

.
This proves the assertion.
If neither Q ‚â™P nor P ‚â™Q holds, one can use the following Lebesgue decom-
position of P with respect to Q.
Theorem A.13. For any two probability measures Q and P on (, F ), there exists
a set N ‚ààF with Q[ N ] = 0 and a F -measurable function œï ‚â•0 such that
P [ A ] = P [ A ‚à©N ] +

A
œï dQ
for all A ‚ààF .
One writes
dP
dQ :=

œï
on Nc,
+‚àû
on N.

406
Appendix
Proof. Let R := 1
2(Q + P ). Then both Q and P are absolutely continuous with
respect to R with respective densities dQ/dR and dP/dR. Let
N :=
 dQ
dR = 0

.
Then Q[ N ] = 0. We deÔ¨Åne
dP
dQ := œï :=
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
dP
dR ¬∑
dQ
dR
‚àí1
on Nc,
+‚àû
on N.
Then, for F -measurable f ‚â•0,

f dP =

N
f dP +

Nc f dP
dR dR
=

N
f dP +

Nc f dP
dR ¬∑
dQ
dR
‚àí1
dQ
=

N
f dP +

f œï dQ,
where we have used the fact that Q[ N ] = 0 in the last step.
A.3
Quantile functions
Suppose that F : (a, b) ‚ÜíR is an increasing function which is not necessarily strictly
increasing. Let
c := lim
x‚Üìa F(x)
and
d := lim
x‚Üëb F(x).
DeÔ¨Ånition A.14. A function q : (c, d) ‚Üí(a, b) is called an inverse function for F if
F

q(s)‚àí

‚â§s ‚â§F

q(s)+

for all s ‚àà(c, d).
The functions
q‚àí(s) := sup{ x ‚ààR | F(x) < s }
and
q+(s) := inf{ x ‚ààR | F(x) > s }
are called the left- and right-continuous inverse functions.
The following lemma explains the reason for calling q‚àíand q+ the left- and
right-continuous inverse functions of F.

A.3 Quantile functions
407
Lemma A.15. A function q : (c, d) ‚Üí(a, b) is an inverse function for F if and only
if
q‚àí(s) ‚â§q(s) ‚â§q+(s)
for all s ‚àà(c, d).
In particular, q‚àíand q+ are inverse functions. Moreover, q‚àíis left-continuous,
q+ is right-continuous, and every inverse function q is increasing and satisÔ¨Åes
q(s‚àí) = q‚àí(s) and q(s+) = q+(s) for all s ‚àà(c, d). In particular, any two
inverse functions coincide a.e. on (c, d).
Proof. We have q‚àí‚â§q+, and any inverse function q satisÔ¨Åes q‚àí‚â§q ‚â§q+, due to
the deÔ¨Ånitions of q‚àíand q+. Hence, the Ô¨Årst part of the assertion follows if we can
show that F(q+(s)‚àí) ‚â§s ‚â§F(q‚àí(s)+) for all s. But x < q+(s) implies F(x) ‚â§s
and y > q‚àí(s) implies F(y) ‚â•s, which gives the result.
Next, the set { x | F(x) > s } is the union of the sets { x | F(x) > s + Œµ } for Œµ < 0,
and so q+ is right-continuous. An analogous argument shows the left-continuity of
q‚àí. It is clear that both q‚àíand q+ are increasing, so that the second part of the
assertion follows.
Remark A.16. The left- and right-continuous inverse functions can also be repre-
sented as
q‚àí(s) = inf{ x ‚ààR | F(x) ‚â•s }
and
q+(s) = sup{ x ‚ààR | F(x) ‚â§s }.
To see this, note Ô¨Årst that q‚àí(s) is clearly dominated by the inÔ¨Åmum on the right.
On the other hand, y > q‚àí(s) implies F(y) ‚â•s, and we get q‚àí(s) ‚â•inf{ x ‚ààR |
F(x) ‚â•s }. The proof for q+ is analogous.
‚ô¶
Lemma A.17. Let q be an inverse function for F. Then F is an inverse function for q.
In particular,
F(x+) = inf{ s ‚àà(c, d) | q(s) > x }
for x with F(x) < d.
(A.5)
Proof. If s > F(x) then q(s) ‚â•q‚àí(s) ‚â•x, and hence q(F(x)+) ‚â•x. Conversely,
s < F(x) implies q(s) ‚â§q+(s) ‚â§x, and thus q(F(x)‚àí) ‚â§x. This proves that F is
an inverse function for q.
Remark A.18. By deÔ¨Åning q(d) := b we can extend (A.5) to
F(x+) = inf{ s ‚àà(c, d] | q(s) > x }
for all x ‚àà(a, b).
‚ô¶
From now on we will assume that
F : R ‚àí‚Üí[0, 1] is increasing and right-continuous
and that F is normalized in the sense that c = 0 and d = 1. This assumption always
holds if F is the distribution function of a random variable X on some probability

408
Appendix
space (, F , P), i.e., F is given by F(x) = P [ X ‚â§x ]. The following lemma
shows in particular that also the converse is true: any normalized increasing right-
continuous functions F : R ‚Üí[0, 1] is the distribution function of some random
variable. By considering the laws of random variables, we also obtain the one-to-one
correspondence F(x) = ¬µ((‚àí‚àû, x]) between all Borel probability measures ¬µ on R
and all normalized increasing right-continuous functions F : R ‚Üí[0, 1].
Lemma A.19. Let U be a random variable on a probability space (, F , P ) with a
uniform distribution on (0, 1), i.e., P [ U ‚â§s ] = s for all s ‚àà(0, 1). If q is an inverse
function of a normalized increasing right-continuous function F : R ‚Üí[0, 1], then
X(œâ) := q

U(œâ)

has the distribution function F.
Proof. First note that any inverse function for F is measurable because it coincides with
the measurable function q+ outside the countable set { s ‚àà(0, 1) | q‚àí(s) < q+(s) }.
Since q(F(x)‚àí) ‚â§x, we have q(s) ‚â§x for s < F(x). Moreover, Lemma A.17
shows that q(s) ‚â§x implies F(x) ‚â•F(q(s)) = F(q(s)+) ‚â•s. It follows that
(0, F(x)) ‚äÜ{ s ‚àà(0, 1) | q(s) ‚â§x } ‚äÜ(0, F(x)].
Hence,
F(x) = P

U ‚àà

0, F(x)
 
‚â§P

U ‚àà{ s | q(s) ‚â§x }

‚â§P

U ‚àà(0, F(x)]

= F(x).
The assertion now follows from the identity P [U ‚àà{ s | q(s) ‚â§x }] = P [X ‚â§x ].
DeÔ¨Ånition A.20. An inverse function q : (0, 1) ‚ÜíR of a distribution function F is
called a quantile function. That is, q is a function with
F

q(s)‚àí

‚â§s ‚â§F

q(s)

for all s ‚àà(0, 1).
The left- and rightcontinuous inverses,
q‚àí(s) = sup{ x ‚ààR | F(x) < s }
and
q+(s) = inf{ x ‚ààR | F(x) > s },
are called the lower and upper quantile functions.
We will often use the generic notation FX for the distribution function of a random
variable X. When the emphasis is on the law ¬µ of X, we will also write F¬µ. In
the same manner, we will write qX or q¬µ for the corresponding quantile functions.
The value qX(Œª) of a quantile function at a given level Œª ‚àà(0, 1) is often called a
Œª-quantile of X.
The following result complements LemmaA.19. It implies that a probability space
supports a random variable with uniform distribution on (0, 1) if and only if it supports
any non-constant random variable X with a continuous distribution.

A.3 Quantile functions
409
Lemma A.21. Let X be a random variable with a continuous distribution function
FX and with quantile function qX. Then U := FX(X) is uniformly distributed on
(0, 1), and X = qX(U) P-almost surely.
Proof. Let (, 
F, 
P ) be a probability space that supports a random variable 
U with a
uniform distribution on (0, 1). Then 
X := qX(
U) has the same distribution as X due
to Lemma A.19. Hence, FX(X) and FX(
X) also have the same distribution. On the
other hand, if FX is continuous, then FX

qX(s)

= s and thus FX(
X) = 
U.
To show that X = qX(U) P -a.s., note Ô¨Årst that q+
X(F(t)) ‚â•t and hence qX(U) =
q+
X(U) ‚â•X P-almostsurely. Nowletf : R ‚Üí(0, 1)beastrictlyincreasingfunction.
Since qX(U) and X have the same law, we have E[ f (qX(U)) ] = E[ f (X) ] and get
P[ qX(U) > X ] = 0.
The following lemma uses the concept of the Fenchel‚ÄìLegendre transform of a
convex function as introduced in DeÔ¨Ånition A.5.
Lemma A.22. Let X be a random variable with distribution function FX and quantile
function qX such that E[ |X| ] < ‚àû. Then the Fenchel‚ÄìLegendre transform of the
convex function
(x) :=
 x
‚àí‚àû
FX(z) dz = E[ (x ‚àíX)+ ]
is given by
‚àó(y) = sup
x‚ààR
(xy ‚àí(x)) =
Ô£±
Ô£≤
Ô£≥
 y
0
qX(t) dt
if 0 ‚â§y ‚â§1,
+‚àû
otherwise.
Moreover, for 0 < y < 1, the supremum above is attained in x if and only if x is a
y-quantile of X.
Proof. Note Ô¨Årst that, by Fubini‚Äôs theorem and Lemma A.19,
(x) = E
  x
‚àí‚àû
I{X‚â§z} dz
!
= E[ (x ‚àíX)+ ] =
 1
0
(x ‚àíqX(t))+ dt.
(A.6)
It follows that ‚àó(y) = +‚àûfor y < 0, ‚àó(0) = ‚àíinfx (x) = 0,
‚àó(1) = sup
x‚ààR
(x ‚àí(x)) = lim
x‚Üë‚àû
 1
0
x ‚àí(x ‚àíqX(t))+ dt =
 1
0
qX(t) dt,
and ‚àó(y) = ‚àûfor y > 1. To prove our formula for 0 < y < 1, note that the
right-hand and left-hand derivatives of the concave function f (x) = xy ‚àí(x) are
given by f ‚Ä≤
+(x) = y ‚àíFX(x) and f ‚Ä≤
‚àí(x) = y ‚àíFX(x‚àí). A point x is a maximizer of

410
Appendix
f if f ‚Ä≤
+(x) ‚â§0 and f ‚Ä≤
‚àí(x) ‚â•0, which is equivalent to x being a y-quantile. Taking
x = qX(y) and using (A.6) gives
(x) =
 y
0
(x ‚àíqX(t)) dt = xy ‚àí
 y
0
qX(t) dt,
and our formula follows.
Lemma A.23. If X = f (Y) for an increasing function f and qY is a quantile function
for Y, then f (qY (t)) is a quantile function for X. In particular,
qX(t) = qf (Y)(t) = f (qY (t))
for a.e. t ‚àà(0, 1),
for any quantile function qX of X.
If f is decreasing, then f (qY (1 ‚àít)) is a quantile function for X. In particular,
qX(t) = qf (Y)(t) = f (qY (1 ‚àít))
for a.e. t ‚àà(0, 1).
Proof. If f is decreasing, then q(t) := f (qY (1 ‚àít)) satisÔ¨Åes
FX(q(t)) = P

f (Y) ‚â§f

qY (1 ‚àít)
 
‚â•P [ Y ‚â•qY (1 ‚àít) ]
‚â•t
‚â•P [ Y > qY (1 ‚àít) ]
‚â•FX(q(t)‚àí),
since FY (qY (1 ‚àít)‚àí) ‚â§1 ‚àít ‚â§FY (qY (1 ‚àít)) by deÔ¨Ånition. Hence q(t) =
f (qY (1 ‚àít)) is a quantile function. A similar argument applies to an increasing
function f .
The following theorem is a version of the Hardy‚ÄìLittlewood inequalities. They
estimate the expectation E[ XY ] in terms of quantile functions qX and qY .
Theorem A.24. Let X and Y be two random variables on (, F , P ) with quantile
functions qX and qY . Then,
 1
0
qX(1 ‚àís)qY (s) ds ‚â§E[ XY ] ‚â§
 1
0
qX(s)qY (s) ds,
provided that all integrals are well deÔ¨Åned. If X = f (Y) and the lower (upper) bound
is Ô¨Ånite, then the lower (upper) bound is attained if and only if f can be chosen as a
decreasing (increasing) function.

A.3 Quantile functions
411
Proof. We Ô¨Årst prove the result for X, Y ‚â•0. By Fubini‚Äôs theorem,
E[ XY ] = E
  ‚àû
0
I{X>x} dx
 ‚àû
0
I{Y>y} dy
!
=
 ‚àû
0
 ‚àû
0
P [ X > x, Y > y ] dx dy.
Since
P [ X > x, Y > y ] ‚â•(P[ X > x ] ‚àíP [ Y ‚â§y ] )+
=
 1
0
I{FY (y)‚â§s} I{s‚â§1‚àíFX(x)} ds,
and since
q+
Z (s) = sup{ x ‚â•0 | FZ(x) ‚â§s } =
 ‚àû
0
I{FZ(x)‚â§s} dx
for any random variable Z ‚â•0, another application of Fubini‚Äôs theorem yields
E[ XY ] ‚â•
 1
0
q+
X(1 ‚àís) q+
Y (s) ds =
 1
0
qX(1 ‚àís) qY (s) ds.
In the same way, the upper estimate follows from the inequality
P [ X > x, Y > y ] ‚â§P [ X > x ] ‚àßP [ Y > y ]
=
 1
0
I{FX(x)‚â§s} I{FY (y)‚â§s} ds.
For X = f (Y),
E[ XY ] = E[ f (Y)Y ] =
 1
0
f (qY (t))qY (t) dt,
(A.7)
due to Lemma A.19, and so Lemma A.23 implies that the upper and lower bounds are
attained for increasing and decreasing functions, respectively.
Conversely, assume that X = f (Y), and that the upper bound is attained and Ô¨Ånite:
E[ f (Y)Y ] =
 1
0
qX(t)qY (t) dt < ‚àû.
(A.8)
Our aim is to show that
X = f (Y) = 
f (Y)
P -a.s.,
where 
f is the increasing function on [0, ‚àû) deÔ¨Åned by

f (x) := qX(FY (x))

412
Appendix
if x is a continuity point of FY , and by

f (x) :=
1
FY (x) ‚àíFY (x‚àí)
 FY (x)
FY (x‚àí)
qX(t) dt
otherwise. Note that

f (qY ) = EŒª[ qX | qY ],
(A.9)
where EŒª[ ¬∑ | qY ] denotes the conditional expectation with respect to qY under the
Lebesgue measure Œª on (0, 1). Hence, (A.8) takes the form
‚àû>
 1
0
f

qY (t)

qY (t) dt =
 1
0

f

qY (t)

qY (t) dt,
(A.10)
where we have used Lemma A.19. Let ŒΩ denote the distribution of Y. By introducing
the positive measures d¬µ = f dŒΩ and d¬µ = 
f dŒΩ, (A.10) can be written as
 ‚àû
0
¬µ([y, ‚àû)) dy =

x ¬µ(dx) =

x ¬µ(dx) =
 ‚àû
0
¬µ([y, ‚àû)) dy.
(A.11)
On the other hand, with g denoting the increasing function I[y,‚àû), the upper Hardy‚Äì
Littlewood inequality, Lemma A.23, and (A.9) yield
¬µ([y, ‚àû)) = E[ g(Y)f (Y) ]
‚â§
 1
0
qg(Y)(t)qX(t) dt
=
 1
0
g

qY (t)
 
f

qY (t)

dt
= ¬µ([y, ‚àû)).
In view of (A.11), we obtain ¬µ = ¬µ, hence f = 
f ŒΩ-a.s. and X = 
f (Y) P -almost
surely. An analogous argument applies to the lower bound, and the proof for X, Y ‚â•0
is concluded.
The result for general X and Y is reduced to the case of non-negative random
variables by separately considering the positive and negative parts of X and Y:
E[ XY ] = E[ X+Y + ] ‚àíE[ X+Y ‚àí] ‚àíE[ X‚àíY + ] + E[ X‚àíY ‚àí]
‚â§
 1
0
qX+(t)qY +(t) dt ‚àí
 1
0
qX+(t)qY ‚àí(1 ‚àít) dt
‚àí
 1
0
qX‚àí(1 ‚àít)qY +(t) dt +
 1
0
qX‚àí(t)qY ‚àí(t) dt,
(A.12)
where we have used the upper Hardy‚ÄìLittlewood inequality on the positive terms
and the lower one on the negative terms. Since qZ+(t) = (qZ(t))+ and qZ‚àí(t) =

A.3 Quantile functions
413
(qZ(1 ‚àít))‚àífor all random variables due to Lemma A.23, one checks that the right-
hand side of (A.12) is equal to
 1
0 qX(t)qY (t) dt, and we obtain the general form of
the upper Hardy‚ÄìLittlewood inequality. The same argument also works for the lower
one.
Now suppose that X = f (Y). We Ô¨Årst note that (A.7) still holds, and so Lemma
A.23 implies that the upper and lower bounds are attained for increasing and decreasing
functions, respectively. Conversely, let us assume that the upper Hardy‚ÄìLittlewood
inequality is an identity. Then all four inequalities used in (A.12) must also be equal-
ities. Using the fact that XY + = f (Y +)Y + and XY ‚àí= f (‚àíY ‚àí)Y ‚àí, the assertion
is reduced to the case of non-negative random variables, and one checks that f can
be chosen as an increasing function. The same argument applies if the lower Hardy‚Äì
Littlewood inequality is attained.
Remark A.25. ForindicatorfunctionsoftwosetsAandB inF , theHardy‚ÄìLittlewood
inequalities reduce to the elementary inequalities

P [ A ] + P [ B ] ‚àí1
+ ‚â§P [ A ‚à©B ] ‚â§P [ A ] ‚àßP [ B ];
(A.13)
note that these estimates were used in the preceding proof. Applied to the sets {X ‚â§x}
and {Y ‚â§y}, where X and Y are random variables with distribution functions FX and
FY and joint distribution function FX,Y deÔ¨Åned by FX,Y (x, y) = P [ X ‚â§x, Y ‚â§y ],
they take the form

FX(x) + FY (y) ‚àí1
+ ‚â§FX,Y (x, y) ‚â§FX(X) ‚àßFY (y).
(A.14)
The estimates (A.13) and (A.14) are often called Fr√©chet bounds, and the Hardy‚Äì
Littlewoodinequalitiesprovidetheirnaturalextensionfromsetstorandomvariables.‚ô¶
DeÔ¨Ånition A.26. A probability space (, .F , P ) is called atomless if it contains no
atoms. That is, there is no set A ‚ààF such that P [ A ] > 0 and P [ B ] = 0 or
P[ B ] = P [ A ] whenever B ‚ààF is a subset of A.
Proposition A.27. For any probability space, the following conditions are equivalent.
(a) (, F , P) is atomless.
(b) There exists an i.i.d. sequence X1, X2, . . . of random variables with Bernoulli
distribution
P [ X1 = 1 ] = P [ X1 = 0 ] = 1
2.
(c) For any ¬µ ‚ààM1(R) there exist i.i.d. random variables Y1, Y2, . . . with common
distribution ¬µ.
(d) (, F , P) supports a random variable with a continuous distribution.

414
Appendix
Proof.
(a) ‚áí(b): We need the following intuitive fact from measure theory: If
(, F , P) is atomless, then for every A ‚ààF and all Œ¥ with 0 ‚â§Œ¥ ‚â§P [ A ] there
exists a measurable set B ‚äÇA such that P [ B ] = Œ¥; see Theorem 9.51 of [2]. Thus,
we may take a set A ‚ààF such that P [ A ] = 1/2 and deÔ¨Åne X1 := 1 on A and
X1 := 0 on Ac. Now suppose that X1, . . . , Xn have already been constructed. Then
P [ X1 = x1, . . . , Xn = xn ] = 2‚àín
for all x1, . . . , xn ‚àà{0, 1}, and this property is equivalent to X1, . . . , Xn being inde-
pendent with the desired symmetric Bernoulli distribution. For all x1, . . . , xn ‚àà{0, 1}
we may choose a set
B ‚äÇ{X1 = x1, . . . , Xn = xn}
such that P[ B ] = 2‚àí(n+1) and deÔ¨Åne Xn+1 := 1 on B and Xn+1 := 0 on Bc. Clearly,
the collection X1, . . . , Xn+1 is again i.i.d. with a symmetric Bernoulli distribution.
(b) ‚áí(c): By relabeling the sequence X1, X2, . . . , we may obtain a double-
indexed sequence (Xi,j)i,j‚ààN of independent Bernoulli-distributed random variables.
If we let
Ui :=
‚àû

n=1
2‚àínXi,n,
then it is straightforward to check that Ui has a uniform distribution. Let q be a quantile
function for ¬µ. LemmaA.19 shows that the i.i.d. sequence Yi := q(Ui), i = 1, 2, . . . ,
has common distribution ¬µ.
The proofs of the implications (c) ‚áí(d) and (d) ‚áí(a) are straightforward.
A.4 The Neyman‚ÄìPearson lemma
Suppose that P and Q are two probability measures on (, F ), and denote by
P [ A ] = P [ A ‚à©N ] +

A
dP
dQ dQ,
A ‚ààF ,
the Lebesgue decomposition of P with respect to Q as in Theorem A.13. For Ô¨Åxed
c ‚â•0, we let
A0 :=
 dP
dQ > c

,
where we make use of the convention that dP/dQ = ‚àûon N.
Proposition A.28 (Neyman‚ÄìPearson lemma). IfA ‚ààF issuchthatQ[A] ‚â§Q[A0 ],
then P [A] ‚â§P [A0 ].

A.4 The Neyman‚ÄìPearson lemma
415
Proof. Let F := IA0 ‚àíIA. Then F ‚â•0 on N, and F ¬∑ (dP /dQ ‚àíc) ‚â•0. Hence
P [ A0 ] ‚àíP [ A ] =

F dP
=

N
F dP +

F ¬∑ dP
dQ dQ
‚â•c

F dQ
= c(Q[ A0 ] ‚àíQ[ A ]).
This proves the proposition.
Remark A.29. In statistical test theory, A0 is interpreted as the likelihood quotient
test of the null hypothesis Q against the alternative hypothesis P : If the outcome œâ
of a statistical experiment is in A0, then the null hypothesis is rejected. There are two
possible kinds of error which can occur in such a test. A type 1 error occurs if the
null hypotheses is rejected despite the fact that Q is the ‚Äútrue‚Äù probability. Similarly,
a type 2 error occurs when the null hypothesis is not rejected, although Q is not
the ‚Äútrue‚Äù probability. The probability of a type 1 error is given by Q[ A0 ]. This
quantity is usually called the size or the signiÔ¨Åcance level of the statistical test A0.
A type 2 error occurs with probability P [ (A0)c ]. The complementary probability
P[ A0 ] = 1 ‚àíP [ (A0)c ] is called the power of the test A0. In this setting, the set A
of Proposition A.28 can be regarded as another statistical test to which our likelihood
quotient test is compared. The proposition can thus be restated as follows: A likelihood
quotient test has maximal power on its signiÔ¨Åcance level.
‚ô¶
Indicator functions of sets take only the values 0 and 1.
We now generalize
Proposition A.28 by considering F -measurable functions œà :  ‚Üí[0, 1]; let R
denote the set of all such functions.
Theorem A.30. Let  := 1
2(P + Q), and deÔ¨Åne the density œï := dP/dQ as above.
(a) Take c ‚â•0, and suppose that œà0 ‚ààR satisÔ¨Åes -a.s.
œà0 =
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
1
on { œï > c },
0
on { œï < c }.
(A.15)
Then, for any œà ‚ààR,

œà dQ ‚â§

œà0 dQ
"‚áí

œà dP ‚â§

œà0 dP.
(A.16)

416
Appendix
(b) For any Œ±0 ‚àà(0, 1) there is some œà0 ‚ààR of the form (A.15) such that

œà0 dQ = Œ±0. More precisely, if c is an (1 ‚àíŒ±0)-quantile of œï under Q,
we can deÔ¨Åne œà0 by
œà0 = I{œï>c} + Œ∫I{œï=c},
where Œ∫ is deÔ¨Åned as
Œ∫ :=
Ô£±
Ô£≤
Ô£≥
0
if Q[ œï = c ] = 0,
Œ±0 ‚àíQ[ œï > c ]
Q[ œï = c ]
otherwise.
(c) Any œà0 ‚ààR satisfying (A.16) is of the form (A.15) for some c ‚â•0.
Proof. (a): Take F := œà0 ‚àíœà and repeat the proof of Proposition A.28.
(b): Let F denote the distribution function of œï under Q. Then Q[ œï > c ] =
1 ‚àíF(c) ‚â§Œ±0 and
Q[ œï = c ] = F(c) ‚àíF(c‚àí)
‚â•F(c) ‚àí1 + Œ±0
= Œ±0 ‚àíQ[ œï > c ].
Hence 0 ‚â§Œ∫ ‚â§1 and œà0 belongs to R. The fact that

œà0 dQ = Œ±0 is obvious.
(c): Suppose that œà‚àósatisÔ¨Åes

œà dQ ‚â§

œà‚àódQ
"‚áí

œà dP ‚â§

œà‚àódP.
The cases in which Œ±0 :=

œà‚àódQ equals 0 or 1 are trivial. For 0 < Œ±0 < 1, we
can take œà0 as in part (b). Then Œ±0 =

œà‚àódQ =

œà0 dQ. One also has that

œà‚àódP =

œà0 dP , as can be seen by applying (A.16) to both œà‚àóand œà0 with
reversed roles. Hence, for f := œà0 ‚àíœà‚àóand N = {œï = ‚àû},
0 =

f dP ‚àíc

f dQ =

N
f dP +

f ¬∑ (œï ‚àíc) dQ.
But (A.15) implies that both f ‚â•0 P -a.s. on N, and f ¬∑ (œï ‚àíc) ‚â•0 Q-a.s. Hence
f vanishes -a.s. on {œï Ã∏= c}.
Remark A.31. In the context of Remark A.29, an element œà of R is interpreted as a
randomized statistical test: If œâ is the outcome of a statistical experiment and p :=
œà(œâ), then the null hypothesis is rejected with probability p, i.e., after performing
an independent random coin toss with success probability p. SigniÔ¨Åcance level and
power of a randomized test are deÔ¨Åned as above, and a test of the form (A.15) is called
a generalized likelihood quotient test. Thus, the general Neyman‚ÄìPearson lemma in
the form of Theorem A.30 can be stated as follows: A randomized test has maximal
power on its signiÔ¨Åcance level, if and only if it is a generalized likelihood quotient
test.
‚ô¶

A.5 The essential supremum of a family of random variables
417
A.5 The essential supremum of a family of random variables
In this section, we discuss the essential supremum of an arbitrary family  of random
variables on a given probability space (, F , P ). Consider Ô¨Årst the case in which the
set  is countable. Then œï‚àó(œâ) := supœï‚àà œï(œâ) will also be a random variable, i.e., œï‚àó
is measurable. Measurability of the pointwise supremum, however, is not guaranteed
if  is uncountable. Even if the pointwise supremum is measurable, it may not be
the right concept, when we focus on almost sure properties. This can be illustrated by
taking P as the Lebesgue measure on  := [0, 1] and  := {I{x} | 0 ‚â§x ‚â§1}. Then
supœï‚àà œï(x) ‚â°1 whereas œï = 0 P -a.s. for each single œï ‚àà. This suggests the
following notion of an essential supremum deÔ¨Åned in terms of almost sure inequalities.
Theorem A.32. Let  be any set of random variables on (, F , P ).
(a) There exists a random variable œï‚àósuch that
œï‚àó‚â•œï P -a.s. for all œï ‚àà.
(A.17)
Moreover, œï‚àóis almost surely unique in the following sense: Any other random vari-
able œà with property (A.17) satisÔ¨Åes œà ‚â•œï‚àóP -almost surely.
(b) Suppose that  is directed upwards, i.e., for œï, œï ‚àà there exists œà ‚àà with
œà ‚â•œï ‚à®œï. Then there exists an increasing sequence œï1 ‚â§œï2 ‚â§¬∑ ¬∑ ¬∑ in  such that
œï‚àó= limn œïn P-almost surely.
DeÔ¨Ånition A.33. The random variable œï‚àóin Theorem A.32 is called the essential
supremum of  with respect to P , and we write
ess sup  = ess sup
œï‚àà
œï := œï‚àó.
The essential inÔ¨Åmum of  with respect to P is deÔ¨Åned as
ess inf  = ess inf
œï‚àà
œï := ‚àíess sup
œï‚àà
(‚àíœï).
Proof of Theorem A.32. Without loss of generality, we may assume that each œï ‚àà
takes values in [0, 1]; otherwise we may consider  := { f ‚ó¶œï | œï ‚àà } with
f : R ‚Üí[0, 1] strictly increasing.
If  ‚äÇ is countable, let œï(œâ) := supœï‚àà œï(œâ). Then œï is measurable. We
claim that the upper bound
c := sup{ E[ œï ] |  ‚äÇ countable }
is attained by some countable ‚àó‚äÇ. To see this, take n with E[ œïn ] ‚Üíc and
let ‚àó:= 
n n. Then ‚àóis countable and E[ œï‚àó] = c.
We now show that œï‚àó:= œï‚àósatisÔ¨Åes (A.17). Suppose that (A.17) does not hold.
Then there exists œï ‚àà such that P [ œï > œï‚àó] > 0. Hence ‚Ä≤ := ‚àó‚à™{œï} satisÔ¨Åes
E[ œï‚Ä≤ ] > E[ œï‚àó] = c,

418
Appendix
in contradiction to the deÔ¨Ånition of c. Furthermore, if œà is any other random variable
satisfying (A.17), then obviously œà ‚â•œï‚àó.
Finally, the construction shows that œï‚àócan be approximated by an increasing
sequence if  is directed upwards.
Remark A.34. For a given random variable X let  be the set of all constants c such
that P[ X > c ] > 0. The number
ess sup X := ess sup 
is the smallest constant c ‚â§+‚àûsuch that X ‚â§c P -a.s. and called the essential
supremum of X with respect to P . The essential inÔ¨Åmum of X is deÔ¨Åned as
ess inf X := ess sup(‚àíX).
‚ô¶
A.6 Spaces of measures
Let S be a topological space. S is called metrizable if there exists a metric d on S
which generates the topology of S. That is, the open d-balls
BŒµ(x) := { y ‚ààS | d(x, y) < Œµ },
x ‚ààS, Œµ > 0,
form a base for the topology of S in the sense that a set U ‚äÇS is open if and only if it
can be written as a union of such d-balls. A convenient feature of metrizable spaces
is that their topological properties can be characterized via convergent sequences.
For instance, a subset A of the metrizable space S is closed if and only if for every
convergent sequence in A its limit point is also contained in A. Moreover, a function
f : S ‚ÜíR is continuous at y ‚ààS if and only if f (yn) converges to f (y) for every
sequence (yn) converging to y. We write
Cb(S)
for the set of all bounded and continuous functions on S.
The metrizable space S is called separable if there exists a countable dense subset
{ x1, x2, . . . } of S. In this case, the Borel œÉ-algebra S of S is generated by the open
d-balls BŒµ(x) with radii Œµ > 0, Œµ ‚ààQ, and centered in x ‚àà{ x1, x2, . . . }. In what
follows, we will always assume that S is separable and metrizable. If, moreover, the
metric d can be chosen to be complete, i.e., if every Cauchy sequence with respect to
d converges to some point in S, then S is called a Polish space. Clearly, Rd with the
Euclidean distance is a complete and separable metric space, hence a Polish space.
Let us denote by
M(S) := M(S, S)

A.6 Spaces of measures
419
the set of all non-negative Ô¨Ånite measures on (S, S). Every ¬µ ‚ààM(S) is of the
form ¬µ = Œ± ŒΩ for some factor Œ± ‚àà[0, ‚àû) and some probability measure ŒΩ on the
measurable space (S, S). The space of all probability measures on (S, S) is denoted
by
M1(S) = M1(S, S).
DeÔ¨Ånition A.35. The weak topology on M(S) is the coarsest topology for which all
mappings
M(S) ‚àã¬µ ‚Üí

f d¬µ,
f ‚ààCb(S),
are continuous.
It follows from this deÔ¨Ånition that the sets
UŒµ

¬µ; f1, . . . , fn

:=
n

i=1
$
ŒΩ ‚ààM(S)



fi dŒΩ ‚àí

fi d¬µ
 < Œµ
%
(A.18)
for ¬µ ‚ààM(S), Œµ > 0, n ‚ààN, and f1, . . . , fn ‚ààCb(S) form a base for the weak
topology on M(S); for details see, e.g., Section 2.13 of [2].
Since the constant
function 1 is continuous,
M1(S) =
$
¬µ ‚ààM(S)
 ¬µ(S) =

1 d¬µ = 1
%
is a closed subset of M(S). A well-known example for weak convergence of proba-
bility measures is the classical central limit theorem; the following version is needed
in Section 5.7.
Theorem A.36. Suppose that for each N ‚ààN we are given N independent random
variables Y (N)
1
, . . . , Y (N)
N
on (N, FN, PN) which satisfy the following conditions:
‚Ä¢ There are constants Œ≥N such that Œ≥N ‚Üí0 and |Y (N)
k
| ‚â§Œ≥N PN-a.s.
‚Ä¢
N

k=1
EN[ Y (N)
k
] ‚àí‚Üím.
‚Ä¢
N

k=1
varN

Y (N)
k

‚àí‚ÜíœÉ 2, where varN denotes the variance with respect to PN.
Then the distributions of
ZN :=
N

k=1
Y (N)
k
,
N = 1, 2, . . . ,
converge weakly to the normal distribution with mean m and variance œÉ 2.

420
Appendix
Proof. See, for instance, the corollary to Theorem 7.1.2 of [40].
The following theorem allows us to examine the weak topology in terms of weakly
converging sequences of measures.
Theorem A.37. The space M(S) is separable and metrizable for the weak topology.
If S is Polish, then so is M(S). Moreover, if S0 is a dense subset of S, then the set
$
n

i=1
Œ±iŒ¥xi
 Œ±i ‚ààQ+, xi ‚ààS0, n ‚ààN
%
of simple measures on S0 with rational weights is dense in M(S) for the weak topology.
Proof. In most textbooks on measure theory, the previous result is proved for M1(S)
instead of M(S); see, e.g., Theorem 14.12 of [2]. The general case requires only
minor modiÔ¨Åcations. It is treated in full generality in Chapter IX, ¬ß5, of [27].
The following characterization of weak convergence in M(S) is known as the
‚Äúportmanteau theorem‚Äù.
Theorem A.38. For any sequence ¬µ, ¬µ1, ¬µ2, . . . of measures in M(S), the following
conditions are equivalent:
(a) The sequence (¬µn)n‚ààN converges weakly to ¬µ.
(b) ¬µn(S) ‚Üí¬µ(S) and
lim sup
n‚Üë‚àû
¬µn(A) ‚â§¬µ(A)
for every closed set A ‚äÇS.
(c) ¬µn(S) ‚Üí¬µ(S) and
lim inf
n‚Üë‚àû¬µn(U) ‚â•¬µ(U)
for every open set U ‚äÇS.
(d) ¬µn(B) ‚Üí¬µ(B) for every Borel set B whose boundary ‚àÇB is not charged by ¬µ
in the sense that ¬µ(‚àÇB) = 0.
(e)

f d¬µn ‚Üí

f d¬µ for every bounded measurable function f which is ¬µ-a.e.
continuous.
(f)

f d¬µn ‚Üí

f d¬µ for every bounded and uniformly continuous function f .
Proof. The result is proved for M1(S) in [2], Theorem 14.3. The general case requires
only minor modiÔ¨Åcations; see Chapter IX of [27].

A.6 Spaces of measures
421
Remark A.39. It follows from the portmanteau theorem that, on S = R, weak con-
vergence of ¬µn to ¬µ is equivalent to the condition
F(x‚àí) ‚â§lim inf
n‚Üë‚àûFn(x) ‚â§lim sup
n‚Üë‚àû
Fn(x) ‚â§F(x)
for the corresponding distribution functions (Fn) and F, or to the pointwise conver-
gence of Fn(x) to F(x) in any continuity point of F. It is also equivalent to the
condition
q‚àí
¬µ (t) ‚â§lim inf
n‚Üë‚àûqn(t) ‚â§lim sup
n‚Üë‚àû
qn(t) ‚â§q+
¬µ (t)
for any choice of the quantile functions qn of ¬µn, or to the pointwise convergence of
qn(t) to q+
¬µ (t) in any continuity point of q+
¬µ .
‚ô¶
The next theorem can be regarded as a stability result for weak convergence.
Theorem A.40 (Slutsky). Suppose that, for n ‚ààN, Xn and Yn are real-valued random
variables on (n, Fn, Pn) such that the laws of Xn converge weakly to the law of X,
and the laws of Yn converge weakly to Œ¥y for some y ‚ààR. Then:
(a) The laws of Xn + Yn converge weakly to the law of X + y.
(b) The laws of Xn ¬∑ Yn converge weakly to the law of X ¬∑ y.
Proof. See, for instance, Section 8.1 of [39].
We turn now to the fundamental characterization of the relative compact subsets
of M(S) known as Prohorov‚Äôs theorem.
Theorem A.41 (Prohorov). Let S be a Polish space. A subset M of M(S) is relatively
compact for the weak topology if and only if
sup
¬µ‚ààM
¬µ(S) < ‚àû
and if M is tight, i.e., if for every Œµ > 0 there exists a compact subset K of S such that
sup
¬µ‚ààM
¬µ(Kc) ‚â§Œµ.
In particular, M1(S) is weakly compact if S is a compact metric space.
Proof. For a proof in the context of probability measures, see for instance Theorem 1
in ¬ßIII.2 of [187]. The general case requires only minor modiÔ¨Åcations; see Chapter IX
of [27].

422
Appendix
Example A.42. Take for S the positive half axis [0, ‚àû) and deÔ¨Åne
¬µn := n ‚àí1
n
Œ¥0 + 1
n Œ¥n
and
¬µ := Œ¥0,
where Œ¥x denotes the Dirac point mass in x ‚ààS, i.e., Œ¥x(A) = IA(x). Clearly,

f d¬µn ‚àí‚Üí

f d¬µ
for all f ‚ààCb(S)
so that ¬µn converges weakly to ¬µ. However, if we take the continuous but unbounded
function f (x) = x, then

f d¬µn = 1 for all n so that
lim
n‚Üë‚àû

f d¬µn = 1 Ã∏=

f d¬µ.
‚ô¶
The preceding example shows that the weak topology is not an appropriate topol-
ogy for ensuring the convergence of integrals against unbounded test functions. Let
us introduce a suitable transformation of the weak topology which will allow us to
deal with certain classes of unbounded functions.
We Ô¨Åx a continuous function
œà : S ‚Üí[1, ‚àû)
which will serve as a gauge function, and we denote by
Cœà(S)
the linear space of all continuous functions f on S for which there exists a constant c
such that
|f (x)| ‚â§c ¬∑ œà(x)
for all x ‚ààS.
Furthermore, we denote by
Mœà(S)
the set of all measures ¬µ ‚ààM(S) such that

œà d¬µ < ‚àû.
DeÔ¨Ånition A.43. The œà-weak topology on Mœà(S) is the coarsest topology for which
all mappings
Mœà(S) ‚àã¬µ ‚Üí

f d¬µ,
f ‚ààCœà(S),
are continuous.
Since the gauge function œà takes values in [1, ‚àû), every bounded continuous
function f belongs to Cœà(S). It follows that all mappings
Mœà(S) ‚àã¬µ ‚Üí

f d¬µ,
f ‚ààCb(S),

A.6 Spaces of measures
423
are continuous. In particular, the set
Mœà
1 (S) :=

¬µ ‚ààMœà(S) | ¬µ(S) = 1

of all Borel probability measures in Mœà(S) is closed for the œà-weak topology.
As in the case of the weak topology, it follows that the sets
Uœà
Œµ

¬µ; f1, . . . , fn

:=
n

i=1
$
ŒΩ ‚ààMœà(S)



fi dŒΩ ‚àí

fi d¬µ
 < Œµ
%
for ¬µ ‚ààMœà(S), Œµ > 0, n ‚ààN, and f1, . . . , fn ‚ààCœà(S) form a base for the œà-weak
topology on Mœà(S).
Let us deÔ¨Åne a mapping
 : M(S) ‚àí‚ÜíMœà(S)
by
d(¬µ) := 1
œà d¬µ,
¬µ ‚ààM(S).
Clearly,  is a bijective mapping between the two sets M(S) and Mœà(S). Moreover,
if we apply  to an open neighborhood for the weak topology as in (A.18), we get


UŒµ(¬µ; f1, . . . , fn)

= Uœà
Œµ

(¬µ); f1œà, . . . , fnœà

.
Since f œà ‚ààCœà(S) for each bounded and continuous function f , and since every
function in Cœà(S) arises in this way, we conclude that a subset U of M(S) is weakly
open if and only if (U) is open for the œà-weak topology. Hence,  is a homeomor-
phism. This observation allows us to translate statements for the weak topology into
results for the œà-weak topology:
Corollary A.44. For separable and metrizable S, the space Mœà(S) is separable and
metrizable for the œà-weak topology. If S is Polish, then so is Mœà(S). Moreover, if S0
is a dense subset of S, then the set
$
n

i=1
Œ±iŒ¥xi
 Œ±i ‚ààQ+, xi ‚ààS0, n ‚ààN
%
of simple measures on S0 with rational weights is dense in Mœà(S) for the œà-weak
topology.
The preceding corollary implies in particular that it sufÔ¨Åces to consider œà-weakly
converging sequences when studying the œà-weak topology. The following corollary
is implied by the portmanteau theorem.

424
Appendix
Corollary A.45. A sequence (¬µn)n‚ààN in Mœà(S) converges œà-weakly to ¬µ if and only
if

f d¬µn ‚àí‚Üí

f d¬µ
for every measurable function f which is ¬µ-a.e. continuous and for which exists a
constant c such that |f | ‚â§c ¬∑ œà ¬µ-almost everywhere.
Prohorov‚Äôs theorem translates as follows to our present setting:
Corollary A.46. Let S be a Polish space and M be a subset of Mœà(S). The following
conditions are equivalent:
(a) M is relatively compact for the œà-weak topology.
(b) We have
sup
¬µ‚ààM

œà d¬µ < ‚àû,
and for every Œµ > 0 there exists a compact subset K of S such that
sup
¬µ‚ààM

Kc œà d¬µ ‚â§Œµ .
(c) There exists a measurable function œÜ : S ‚Üí[1, ‚àû] such that each set
{ x ‚ààS | œÜ(x) ‚â§n œà(x) } ,
n ‚ààN ,
is relatively compact in S, and such that
sup
¬µ‚ààM

œÜ d¬µ < ‚àû.
Proof. (a)‚áî(b): This follows immediately from Theorem A.41 and the fact that  is
a homeomorphism.
(b) ‚áí(c): Take an increasing sequence K1 ‚äÇK2 ‚äÇ¬∑ ¬∑ ¬∑ of compact sets in S such
that
sup
¬µ‚ààM

Kcn
œà d¬µ ‚â§2‚àín,
and deÔ¨Åne œÜ by
œÜ(x) := œà(x) +
‚àû

n=1
IKc
n (x)œà(x).
Then {œÜ ‚â§nœà} ‚äÇKn. Moreover,
sup
¬µ‚ààM

œÜ d¬µ ‚â§sup
¬µ‚ààM

œà d¬µ + 1 < ‚àû.

A.6 Spaces of measures
425
(c) ‚áí(b): Since {œÜ ‚â§œà} is relatively compact, we have that
c := sup{ œà(x) | x ‚ààS, œÜ(x) ‚â§œà(x) } < ‚àû,
and hence
sup
¬µ‚ààM

œà d¬µ ‚â§(1 + c) sup
¬µ‚ààM

œÜ d¬µ < ‚àû.
Moreover, for n ‚â•Œµ‚àí1 sup¬µ‚ààM

œÜ d¬µ, the relatively compact set K := {œÜ ‚â§nœà}
satisÔ¨Åes
sup
¬µ‚ààM

Kc œà d¬µ ‚â§1
n sup
¬µ‚ààM

Kcn
œÜ d¬µ ‚â§Œµ,
and so condition (b) is satisÔ¨Åed.
We turn now to the task of identifying a linear functional on a space of functions
as the integral with respect to a suitable measure.
Theorem A.47 (Riesz). Let  be a compact metric space and suppose that I is a
linear functional on C() that is non-negative in the sense that f ‚â•0 everywhere on
 implies I(f ) ‚â•0. Then there exists a unique positive Borel measure ¬µ on  such
that
I(f ) =

f d¬µ
for all f ‚ààC().
To state a general version of the preceding theorem, we need the notion of a vector
lattice of real-valued functions on an arbitrary set . This is a linear space L that
is stable under the operation of taking the pointwise maximum: for f, g ‚ààL also
f ‚à®g ‚ààL. One example is the space of all bounded measurable functions on (, F ).
Another one is the space Cb() of all bounded continuous functions on a separable
metric space . In this case, the œÉ-algebra œÉ(L) generated by L coincides with the
Borel œÉ-algebra of the underlying metric space. Note that Theorem A.47 is implied
by the following result, together with Dini‚Äôs lemma as recalled in Remark 4.26.
Theorem A.48 (Daniell‚ÄìStone). Let I be a linear functional on a vector lattice L of
functions on  such that the following conditions hold:
(a) I is non-negative in the sense that f ‚â•0 everywhere on  implies I(f ) ‚â•0.
(b) If (fn) is a sequence in L such that fn ‚Üò0, then I(fn) ‚Üò0.
Then there exists a unique positive measure ¬µ on the measurable space

, œÉ(L)

such that
I(f ) =

f d¬µ
for all f ‚ààL.

426
Appendix
Proof. See, e.g., Theorem 4.5.2 of [72] or Satz 40.5 in [18].
Without the continuity assumption (b), the preceding result takes a different form,
as we will discuss now.
DeÔ¨Ånition A.49. Let (, F ) be a measurable space. A mapping ¬µ : F ‚ÜíR is
called a Ô¨Ånitely additive set function if ¬µ(‚àÖ) = 0, and if for any Ô¨Ånite collection
A1, . . . , An ‚ààF of mutually disjoint sets
¬µ
	 n

i=1
Ai

=
n

i=1
¬µ(Ai).
We denote by M1,f := M1,f (, F ) the set of all those Ô¨Ånitely additive set functions
¬µ : F ‚Üí[0, 1] which are normalized to ¬µ() = 1. The total variation of a Ô¨Ånitely
additive set function ¬µ is deÔ¨Åned as
‚à•¬µ‚à•var := sup
$
n

i=1
|¬µ(Ai)|
 A1, . . . , An disjoint sets in F , n ‚ààN
%
.
The space of all Ô¨Ånitely additive measures ¬µ whose total variation is Ô¨Ånite is denoted
by ba(, F ).
We will now give a brief outline of the integration theory with respect to a measure
¬µ ‚ààba := ba(, F ); for details we refer to Chapter III in [76]. The space X of
all bounded measurable functions on (, F ) is a Banach space if endowed with the
supremum norm,
‚à•F‚à•:= sup
œâ‚àà
F(œâ)
,
F ‚ààX.
Let X0 denote the linear subspace of all Ô¨Ånitely valued step functions which can be
represented in the form
F =
n

i=1
Œ±i IAi ,
for some n ‚ààN, Œ±i ‚ààR, and disjoint sets A1, . . . , An ‚ààF . For this F we deÔ¨Åne

F d¬µ :=
n

i=1
Œ±i ¬µ(Ai),
and one can check that this deÔ¨Ånition is independent of the particular representation
of F. Moreover,


F d¬µ
 ‚â§‚à•F‚à•¬∑ ‚à•¬µ‚à•var.
(A.19)
Since X0 is dense in X with respect to ‚à•¬∑ ‚à•, this inequality allows us to deÔ¨Åne
the integral on the full space X as the extension of the continuous linear functional

A.6 Spaces of measures
427
X0 ‚àãF ‚Üí

F d¬µ. Clearly, M1,f is contained in ba, and we will denote the integral
of a function F ‚ààX with respect to Q ‚ààM1,f by
EQ[ F ] :=

F dQ.
Theorem A.50. The integral
‚Ñì(F) =

F d¬µ,
F ‚ààX,
deÔ¨Ånes a one-to-one correspondence between continuous linear functionals ‚Ñìon X
and Ô¨Ånitely additive set functions ¬µ ‚ààba.
Proof. By deÔ¨Ånition of the integral and by (A.19), it is clear that any ¬µ ‚ààba deÔ¨Ånes a
continuous linear functional on X. Conversely, if a continuous linear functional ‚Ñìis
given, then we can deÔ¨Åne a Ô¨Ånitely additive set function ¬µ on (, F ) by
¬µ(A) := ‚Ñì(IA),
A ‚ààF .
If L ‚â•0 is such that ‚Ñì(F) ‚â§L for ‚à•F‚à•‚â§1, then ‚à•¬µ‚à•var ‚â§L, and so ¬µ ‚ààba. One
then checks that the integral with respect to ¬µ coincides with ‚Ñìon X0. Since X0 is
dense in X, we see that

Fd¬µ and ‚Ñì(F) coincide for all F ‚ààX.
Remark A.51. Theorem A.50 yields in particular a one-to-one correspondence be-
tween set functions Q ‚ààM1,f and continuous linear functionals ‚Ñìon X such that
‚Ñì(1) = 1 and ‚Ñì(X) ‚â•0 for X ‚â•0.
‚ô¶
Example A.52. Clearly, the set M1,f coincides with the set M1 := M1(, F ) of all
œÉ-additive probability measures if (, F ) can be reduced to a Ô¨Ånite set, in the sense
that F is generated by a Ô¨Ånite partition of . Otherwise, M1,f is strictly larger than
M1. Suppose in fact that there are inÔ¨Ånitely many disjoint sets A1, A2, . . . ‚ààF , take
œân ‚ààAn, and deÔ¨Åne
‚Ñìn(X) := 1
n
n

i=1
X(œâi),
n = 1, 2, . . .
The continuous linear functionals ‚Ñìn on X belong to the unit ball B1 in the dual Banach
space X‚Ä≤. By Theorem A.62, there exists a cluster point ‚Ñìof (‚Ñìn). For any X ‚ààX
there is a subsequence (nk) such that ‚Ñìnk(X) ‚Üí‚Ñì(X). This implies that ‚Ñì(X) ‚â•0
for X ‚â•0 and ‚Ñì(1) = 1. Hence, Theorem A.50 allows us to write ‚Ñì(X) = EQ[ X ]
for some Q ‚ààM1,f . But Q is not œÉ-additive, since Q[ An ] = ‚Ñì(IAn) = 0 and
Q
 
n An

= 1.
‚ô¶

428
Appendix
A.7 Some functional analysis
Numerous arguments in this book involve inÔ¨Ånite-dimensional vector spaces. Typical
examples are the spaces Lp for 0 ‚â§p ‚â§‚àû, which we will introduce below. To this
end, we Ô¨Årst take p ‚àà(0, ‚àû] and denote by Lp(, F , P ) the set of all F -measurable
functions Z on (, F , P) such that ‚à•Z‚à•p < ‚àû, where
‚à•Z‚à•p :=
Ô£±
Ô£¥Ô£≤
Ô£¥Ô£≥
E[ |Z|p ]1/p,
if 0 < p < ‚àû,
inf

c ‚â•0 | P [ |Z| > c ] = 0

,
if p = ‚àû.
(A.20)
Let us also introduce the space L0(, F , P), deÔ¨Åned as the set of all P -a.s. Ô¨Ånite
random variables. If no ambiguity with respect to œÉ-algebra and measure can arise, we
may sometimes write Lp(P ) or just Lp instead of Lp(, F , P ). For p ‚àà[0, ‚àû], the
space Lp(, F , P), or just Lp, is obtained from Lp by identifying random variables
which coincide up to a P -null set. Thus, Lp consists of all equivalence classes with
respect to the equivalence relation
Z ‚àºZ
: ‚áê‚áí
Z = Z P -a.s.
(A.21)
If p ‚àà[1, ‚àû] then the vector space Lp is a Banach space with respect to the norm
‚à•¬∑‚à•p deÔ¨Åned in (A.20), i.e., every Cauchy sequence with respect to ‚à•¬∑ ‚à•p converges to
some element in Lp. In principle, one should distinguish between a random variable
Z ‚ààLp and its associated equivalence class [Z] ‚ààLp, of which Z is a representative
element.
In order to keep things simple, we will follow the usual convention of
identifying Z with its equivalence class, i.e., we will just write Z ‚ààLp.
On the space L0, we use the topology of convergence in P -measure. This topology
is generated by the metric
d(X, Y) := E[ |X ‚àíY| ‚àß1 ],
X, Y ‚ààL0.
(A.22)
Note, however, that d is not a norm.
DeÔ¨Ånition A.53. A linear space E which carries a topology is called a topological
vector space if every singleton {x} for x ‚ààE is a closed set, and if the vector space
operations are continuous in the following sense:
(x, y) ‚àí‚Üíx + y
is a continuous mapping from E √ó E into E, and
(Œ±, x) ‚àí‚ÜíŒ±x
is a continuous mapping from R √ó E into E.

A.7 Some functional analysis
429
Clearly, every Banach space is a topological vector space. The following result is a
generalization of the separation argument in PropositionA.1 to an inÔ¨Ånite-dimensional
setting.
Theorem A.54. In a topological vector space E, any two disjoint convex sets B and
C, one of which has an interior point, can be separated by a non-zero continuous
linear functional ‚Ñìon E, i.e.,
‚Ñì(x) ‚â§‚Ñì(y)
for all x ‚ààC and all y ‚ààB.
(A.23)
Proof. See [76], Theorem V.2.8.
If one wishes to strictly separate two convex sets by a linear functional in the sense
that one has a strict inequality in (A.23), then one needs additional conditions both on
the convex sets and on the underlying space E.
DeÔ¨Ånition A.55. A topological vector space E is called a locally convex space if its
topology has a base consisting of convex sets.
If E is a Banach space with norm ‚à•¬∑ ‚à•, then the open balls
{ y ‚ààE | ‚à•y ‚àíx‚à•< r },
x ‚ààE, r > 0,
form by deÔ¨Ånition a base for the topology of E. Since such balls are convex sets,
any Banach space is locally convex. The space L0(, F , P ) with the topology of
convergence in P -measure, however, is not locally convex if (, F , P ) has no atoms;
see, e.g., Theorem 12.41 of [2].
The following theorem is one variant of the classical Hahn‚ÄìBanach theorem on
the existence of ‚Äúseparating hyperplanes‚Äù.
Theorem A.56 (Hahn‚ÄìBanach). Suppose that B and C are two non-empty, disjoint,
and convex subsets of a locally convex space E. Then, if B is compact and C is closed,
there exists a continuous linear functional ‚Ñìon E such that
sup
x‚ààC
‚Ñì(x) < inf
y‚ààB
‚Ñì(y).
Proof. See, for instance, [178], p. 65, or [76], Theorem V.2.10.
One corollary of the preceding result is that, on a locally convex space E, the
collection
E‚Ä≤ := { ‚Ñì: E ‚ÜíR | ‚Ñìis continuous and linear }
separates the points of E, i.e., for any two distinct points x, y ‚ààE there exists some
‚Ñì‚ààE‚Ä≤ such that ‚Ñì(x) Ã∏= ‚Ñì(y). The space E‚Ä≤ is called the dual or the dual space of E.
For instance, if p ‚àà[1, ‚àû) it is well-known that the dual of Lp(, F , P ) is given by
Lq(, F , P), where 1
p + 1
q = 1. The following deÔ¨Ånition describes a natural way in
which locally convex topologies often arise.

430
Appendix
DeÔ¨Ånition A.57. Let E be linear space, and suppose that F is a linear class of linear
functionals on E which separates the points of E. The F-topology on E, denoted by
œÉ(E, F), is the topology on E which is obtained by taking as a base all sets of the
form
{ y ‚ààE | |‚Ñìi(y) ‚àí‚Ñìi(x)| < r, i = 1, . . . , n },
where n ‚ààN, x ‚ààE, ‚Ñìi ‚ààF, and r > 0. If E already carries a locally convex
topology, then the E‚Ä≤-topology œÉ(E, E‚Ä≤) is called the weak topology on E.
IfE isinÔ¨Ånite-dimensional, thenE istypicallynot metrizableintheF-topology. In
this case, it may not sufÔ¨Åce to consider converging sequences when making topological
assertions; see, however, TheoremA.65 below. The following proposition summarizes
a few elementary properties of the F-topology.
Proposition A.58. Consider the situation of the preceding deÔ¨Ånition. Then:
(a) E is a locally convex space for the F-topology.
(b) The F-topology is the coarsest topology on E for which every ‚Ñì‚ààF is contin-
uous.
(c) The dual of E for the F-topology is equal to F.
Proof. See, e.g., Section V.3 of [76].
Theorem A.59. Suppose that E is a locally convex space and that C is a convex subset
of E. Then C is weakly closed if and only if C is closed in the original topology of E.
Proof. If the convex set C is closed in the original topology then, by Theorem A.56,
it is the intersection of the halfspaces H = {‚Ñì‚â§c} such that H ‚äÉC, and thus closed
in the weak topology œÉ(E, E‚Ä≤). The converse is clear.
For a given locally convex space E we can turn things around and consider E as
a set of linear functionals on the dual space E‚Ä≤ by letting x(‚Ñì) := ‚Ñì(x) for ‚Ñì‚ààE‚Ä≤ and
x ‚ààE. The E-topology œÉ(E‚Ä≤, E) obtained in this way is called the weak‚àótopology
on E‚Ä≤. According to part (c) of Proposition A.58, E is then the topological dual of
(E‚Ä≤, œÉ(E‚Ä≤, E)). For example, the Banach space L‚àû:= L‚àû(, F , P ) is the dual of
L1, but the converse is generally not true. However, L1 becomes the dual of L‚àûif
we endow L‚àûwith the weak‚àótopology œÉ(L‚àû, L1).
The mutual duality between E and E‚Ä≤ allows us to state a general version of part (b)
of Proposition A.6. As in the one-dimensional situation of DeÔ¨Ånition A.3, a convex
function f : E ‚ÜíR ‚à™{+‚àû} is called a proper convex function if f (x) < ‚àûfor
some x ‚ààR.
DeÔ¨Ånition A.60. The Fenchel‚ÄìLegendre transform of a function f : E ‚ÜíR‚à™{+‚àû}
is the function f ‚àóon E‚Ä≤ deÔ¨Åned by
f ‚àó(‚Ñì) := sup
x‚ààE

‚Ñì(x) ‚àíf (x)

.

A.7 Some functional analysis
431
If f Ã∏‚â°+‚àû, then f ‚àóis a proper convex and lower semicontinuous function as the
supremum of afÔ¨Åne functions. If f is itself a proper convex function, then f ‚àóis also
called the conjugate function of f .
Theorem A.61. Let f be a proper convex function on a locally convex space E. If f
is lower semicontinuous with respect to œÉ(E, E‚Ä≤), then f = f ‚àó‚àó.
It is straightforward to adapt the proof we gave in the one-dimensional case of
Proposition A.6 to the inÔ¨Ånite-dimensional situation of Theorem A.61; all one has
to do is to replace the separating hyperplane lemma by the Hahn‚ÄìBanach separation
theorem in the form of Theorem A.56.
One of the reasons for considering the weak topology on a Banach space or, more
generally, on a locally convex space is that typically more sets are compact for the
weak topology than for the original topology. The following result shows that the
unit ball in the dual of a Banach space is weak‚àócompact. Here we use the fact that a
Banach space (E, ‚à•¬∑ ‚à•E) deÔ¨Ånes the following norm on its dual E‚Ä≤:
‚à•‚Ñì‚à•E‚Ä≤ :=
sup
‚à•x‚à•E‚â§1
‚Ñì(x),
‚Ñì‚ààE‚Ä≤.
Theorem A.62 (Banach‚ÄìAlaoglu). Let E be a Banach space with dual E‚Ä≤. Then
{ x ‚ààE‚Ä≤ | ‚à•x‚à•E‚Ä≤ ‚â§r } is weak‚àócompact for every r ‚â•0.
Proof. See, e.g., Theorem IV.21 in [164].
Theorem A.63 (Krein‚Äì≈†mulian). Let E be a Banach space and suppose that C is a
convex subset of the dual space E‚Ä≤. Then C is weak‚àóclosed if and only if
C ‚à©{ x ‚ààE‚Ä≤ | ‚à•x‚à•E‚Ä≤ ‚â§r }
is weak‚àóclosed for each r > 0.
Proof. See Theorem V.5.7 in [76].
The preceding theorem implies the following characterization of weak‚àóclosed sets
in L‚àû.
Lemma A.64. A convex subset C of L‚àûis weak‚àóclosed if for every r > 0
Cr := C ‚à©{ X ‚ààL‚àû| ‚à•X‚à•‚àû‚â§r }
is closed in L1.
Proof. Since Cr is convex and closed in L1, it is weakly closed in L1 by TheoremA.59.
Since the natural injection

L‚àû, œÉ(L‚àû, L1)

‚àí‚Üí

L1, œÉ(L1, L‚àû)


432
Appendix
is continuous, Cr is œÉ(L‚àû, L1)-closed in L‚àû. Thus, C is weak‚àóclosed due to the
Krein‚Äì≈†mulian theorem.
Finally, we state a few fundamental results on weakly compact sets.
Theorem A.65 (Eberlein‚Äì≈†mulian). For any subset A of a Banach space E, the fol-
lowing conditions are equivalent:
(a) A is weakly sequentially compact, i.e., any sequence in A has a subsequence
which converges weakly in E.
(b) A is weakly relatively compact, i.e., the weak closure of A is weakly compact.
Proof. See [76], Theorem V.6.1.
Theorem A.66 (James). In a Banach space E, a bounded and weakly closed convex
subset A is weakly compact if and only if every continuous linear functional attains
its supremum on A.
Proof. See, for instance, [86].
The following result characterizes the weakly relatively compact subsets of the
Banach space L1 := L1(, F , P). It implies, in particular, that a set of the form
{ f ‚ààL1 | |f | ‚â§g } with given g ‚ààL1 is weakly compact in L1.
Theorem A.67 (Dunford‚ÄìPettis). A subset A of L1 is weakly relatively compact if
and only if it is bounded and uniformly integrable.
Proof. See, e.g., Theorem IV.8.9 or Corollary IV.8.11 in [76].

Notes
In these notes, we do not make any attempt to give a systematic account of all the
sources which have been relevant for the development of the Ô¨Åeld. We simply mention
a number of references which had a direct inÔ¨Çuence on our decisions how to present
the topics discussed in this book. A more comprehensive list of references can be
found, e.g., in [129].
Chapter 1: The proof of Theorem 1.6 is based on Dalang, Morton, andWillinger [51].
Remark 1.17 and Example 1.18 are taken from Schachermayer [175]. Section 1.6
is mainly based on [175], with the exception of Lemma 1.63, which is taken from
Kabanov and Stricker [122]. Our proof of Lemma 1.67 combines ideas from [122]
with the original argument in [175], as suggested to us by Irina Penner. For a historical
overview of the development of arbitrage pricing and for an outlook to continuous-time
developments, we refer to Schachermayer [177]. For some mathematical connections
between superhedging of call options as discussed in Section 1.3 and bounds on stop-
loss premiums in insurance see Chapter 5 of Goovaerts et al. [105].
Chapter 2: The results on the structure of preferences developed in this chapter are,
to a large extent, standard topics in mathematical economics. We refer to textbooks
on expected utility theory such as Fishburn [84], [85], Kreps [138], or Savage [174],
and to the survey articles in [10], [17]. The ideas and results of Section 2.1 go back to
classical references such as Debreu [57], Eilenberg [78], Milgram [151], and Rader
[163]. The theory of afÔ¨Åne numerical representations in Section 2.2 was initiated by
von Neumann and Morgenstern [155] and further developed by Herstein and Milnor
[112]. The drastic consequences of the assumption that a favorable bet is rejected at
any level of wealth, as explained in Lemma 2.50, were stressed by Rabin [162]. The
discussion of the partial orders ‚âΩuni, ‚âΩmon, and ‚âΩbal in Sections 2.4 and 2.6 has a long
history. A Ô¨Årst version of Theorem 2.58 is already contained in Hardy, Littlewood, and
Polya [107]. A complete treatment was given by Strassen [191]; this paper is also the
source for Section 2.6. The economic interpretation ofTheorem 2.58 was developed by
Rothschild and Stiglitz [170], [171]. The analysis of robust preferences in Section 2.5
is mainly based on the ideas of Savage [174], Anscombe and Aumann [5], and Gilboa
and Schmeidler [104]. See Gilboa [103] for an alternative axiomatic approach to
the characterization in part (b) of Theorem 2.80, and [131] for a survey of related
developments. In the context of robust statistics, a special case of Proposition 2.85
appears in Huber [114].
Chapter 3: Given a preference relation of von Neumann‚ÄìMorgenstern type, the
analysis of optimal portfolios in Section 3.1 or, more generally, of optimal asset proÔ¨Åles
in Section 3.3 is a standard exercise, both in microeconomic theory and in convex

434
Notes
optimization. Section 3.1 shows that the existence of a solution is equivalent to the
absence to arbitrage; here we follow Rogers [168]. In the special case of exponential
utility, the construction of the optimal portfolio is equivalent to the minimization of
relative entropy as discussed in Section 3.2. This may be viewed as the Ô¨Ånancial
interpretation of general results on entropy minimization in Csiszar [43], [44]. The
methods for characterizing optimal asset proÔ¨Åles in Section 3.3 in terms of ‚ÄúÔ¨Årst-order
conditions‚Äù are well-known; see, for example, [79] or [129], where they are developed
in greater generality. The optimization problem in Theorem 3.44, which is formulated
in terms of the partial order ‚âΩuni and involves the Hardy‚ÄìLittlewood inequalities of
Theorem A.24, is less standard. Our discussion is based on Dybvig [77], Jouini and
Kallal [120] and on a proof of Dana and Meilijson, and we are obliged to Rose-
Anne Dana for introducing us to this topic; see [53] for further developments. As
to the existence of Arrow‚ÄìDebreu equilibria discussed in Section 3.4, we refer to the
classical version in Debreu [56] and to the survey articles in [10]. In our Ô¨Ånancial
context, equilibrium allocations do no longer involve commodity bundles in Euclidean
space as in [56] but asset proÔ¨Åles described by random variables on a probability space.
This formulation of the equilibrium problem goes back to Borch [26], where it was
motivated by the problem of risk exchange in a reinsurance market. The systematic
analysis of the equilibrium problem in an inÔ¨Ånite-dimensional setting was developed
by Bewley, Mas-Colell, and others; see [23] and, for example, [147], [148], [3].
In our introductory approach, the existence proof is reduced to an application of
Brouwer‚Äôs Ô¨Åxed point theorem. Here we beneÔ¨Åtted from discussions with Peter Bank;
see also Dana [52]. Examples 3.51 and Example 3.52 are based on B√ºhlmann [31];
see also [32]. As mentioned in Remark 3.58, the equilibrium discussion of interest
rates requires an intertemporal setting; for a systematic discussion see, e.g., DufÔ¨Åe
[73] and, in a different conceptual framework, Bank and Riedel [16].
Chapter 4: The axiomatic approach to coherent measures of risk and their acceptance
sets was initiated by Artzner, Delbaen, Eber, and Heath [11], and most results of
Section 4.1 are based on this seminal paper. The extension to convex measures of risk
was given independently by Heath [110], Heath and Ku [111], F√∂llmer and Schied
[93], and Frittelli and Rosazza Gianin [100]. The robust representation theorems in
Section 4.2 are taken from [94]; the discussion of convex risk measures on a space
of continuous functions corrects an error in [94] and in the Ô¨Årst edition of this book;
see also Kr√§tschmer [134] for a further analysis. The representation theory on L‚àûas
presented in Section 4.3 was developed by Delbaen [58], [59]; for the connection to
the general duality theory as explained in Remarks 4.17 and 4.39 see [58], [59], [100],
[101]. Among the results onValue at Risk and its various modiÔ¨Åcations in Section 4.4,
Proposition 4.42 andTheorem 4.61 are taken from [11] and [58]. AverageValue at Risk
is discussed, e.g., byAcerbi andTasche [1], Delbaen [58], and Rockafellar and Uryasev
[167]. Remark 4.44 was pointed out to us by Ruszczynski; see [157]. The notation
V@R is taken from PÔ¨Çug and Ruszczynski [158]. The representations of law-invariant
risk measures given in Section 4.5 were Ô¨Årst obtained in the coherent case by Kusuoka

Notes
435
[141]; see also Kunze [140] and Frittelli and Rosazza Gianin [101] for the extension
to the general convex case. Theorem 4.64 in Section 4.6 was Ô¨Årst proved in [141]. The
representations of the core of a concave distortion in Theorem 4.73 and Corollary 4.74
are due to Carlier and Dana [34]. See also [35] for further applications. The study
of Choquet integrals with respect to general set functions as used in Section 4.7 was
started by Choquet [38]. The connections with coherent risk measures were observed
by Delbaen [58], [59]. The two directions in Theorem 4.82 are due to Dellacherie
[64] and Schmeidler [182], respectively. The proof via Lemma 4.83, which we give
here, is taken from Denneberg [67]. Theorem 4.87 is due to Kusuoka [141]. The
equivalence between (b) and (d) in Theorem 4.88 was Ô¨Årst proved in [38], item (c)
was added in [182]. The proof given here is based on [67]. The Ô¨Årst part of Section 4.8
is based on [93], the second on Carr, Geman, and Madan [36]. Section 4.9 is taken
from [93]. Theorem 4.106 is an extension of a classical result for Orlicz spaces; see
Krasnoselskii and Rutickii [136]. For some mathematical connections between risk
measures and premium principles in insurance see, e.g., Denneberg [68] and Wang
and Dhaene [196]. Market equilibria in terms of risk measures are studied in Heath
and Ku [111].
Chapter 5: Martingales in Finance have a long history; see, e.g., Samuelson [172].
In the context of dynamic arbitrage theory, martingales and martingale measures are
playing a central role, both in discrete and continuous time; for a historical overview
we refer again to Schachermayer [177]. The Ô¨Årst four sections of this chapter are
based on Harrison and Kreps [108], Kreps [137], Harrison and Pliska [109], Dalang,
Morton, andWillinger [51], Stricker [193], Schachermayer [175], Jacka [117], Rogers
[168], Ansel and Stricker [9], and Kabanov and Kramkov [121]. The binomial model
of Section 5.5 was introduced by Cox, Ross, and Rubinstein in [42]. Geometric
Brownian motion, which appears in Section 5.7 as the diffusion limit of binomial
models, was proposed since the late 1950s by Samuelson and others as a model
for price Ô¨Çuctuations in continuous time, following the re-discovery of the linear
Brownian motion model of Bachelier [15]; see Samuelson [173] and Cootner [41].
The corresponding dynamic theory of arbitrage pricing in continuous time goes back
to Black and Scholes [24] and Merton [150]. A Black‚ÄìScholes type formula for option
pricing appears in Sprenkle [190] in an ad hoc manner, without the arbitrage argument
introduced by Black and Scholes. The approximation of Black‚ÄìScholes prices for
various options by arbitrage-free prices in binomial models goes back to Cox, Ross,
and Rubinstein [42]. A functional version of Theorem 5.53, based on Donsker‚Äôs
invariance principle, can be found in [73].
Chapter 6: The dynamic arbitrage theory for American options begins with Ben-
soussan [21] and Karatzas [124]. A survey is given in Myeni [154]. The theory of
optimal stopping problems as presented in Sections 6.1 and 6.2 was initiated by Snell
[189]; see [156] for a systematic introduction. Stability under pasting as discussed in
Section 6.4 has appeared under several names in various contexts; see Delbaen [60]
for a number of references and for an extension to continuous time. Our discussion

436
Notes
of upper and lower Snell envelopes in Section 6.5 uses ideas from Karatzas and Kou
[127] and standard techniques from dynamic programming. The application to the
time consistency of dynamic coherent risk measures recovers results by Artzner et al.
[12], [13], [14] and Riedel [165]; see also Delbaen [60].
Chapter 7: Optional decompositions, or uniform Doob decompositions as we call
them, and the resulting construction of superhedging strategies were Ô¨Årst obtained
by El Karoui and Quenez [80] in a jump-diffusion model. In a general semimartin-
gale setting, the theory was developed by Kramkov [135] and F√∂llmer and Kabanov
[89]. From a mathematical point of view, the existence of martingale measures with
marginals determined by given option prices in Theorem 7.25 is a corollary of Strassen
[191]; continuous-time analoga were proved by Doob [70] and Kellerer [132]. For
the economic interpretation, see, e.g., Breeden and Litzenberger [28]. The results on
superhedging of exotic derivatives by means of plain vanilla options stated in Theo-
rems 7.27, 7.31, 7.33, and Corollary 7.34 are due to Hobson [113] and Brown, Hobson,
and Rogers [29]; they are related to martingale inequalities of Dubins and Gilat [71].
Chapter 8: The analysis of quantile hedging was triggered by a talk of D. Heath
in March 1995 at the Isaac Newton Institute on the results in Kulldorf [139], where
an optimization problem for Brownian motion with drift is reduced to the Neyman‚Äì
Pearson lemma. Section 8.1 is based on F√∂llmer and Leukert [91]; see also Karatzas
[125], Cvitanic and Spivak [50], Cvitanic and Karatzas [49], and Browne [30]. The
results in Section 8.2 on minimizing the shortfall risk are taken from F√∂llmer and
Leukert [92]; see also Leukert [145], Cvitanic and Karatzas [48], Cvitanic [45], and
Pham [159].
Chapter 9: In continuous-time models, dynamic arbitrage pricing with portfolio
constraints was considered by Cvitanic and Karatzas [46], [47]. In a discrete-time
model with convex constraints, absence of arbitrage was characterized by Carrassus,
Pham, and Touzi [33]. In a general semimartingale setting, F√∂llmer and Kramkov
[90] proved a uniform Doob decomposition and superhedging duality theorems for a
predictably convex set of admissible trading strategies and for American contingent
claims; see also Karatzas and Kou [127].
Chapter 10: The idea of quadratic risk minimization for hedging strategies goes back
to F√∂llmer and Sondermann [97], where the optimality criterion was formulated with
respect to a martingale measure. Extensions to the general case and the construc-
tion of minimal martingale measures were developed by F√∂llmer and Schweizer [96]
and Schweizer; see, e.g., [183], [184]. Our exposition also uses arguments from
F√∂llmer and Schweizer [95], Sch√§l [179], and Li and Xia [146]. Variance-optimal
hedging was introduced by DufÔ¨Åe and Richardson [75] and further developed by
Schweizer and others; the discrete-time theory as presented in Section 10.3 is based
on Schweizer [185]. Melnikov and Nechaev [149] give an explicit formula for a

Notes
437
variance-optimal strategy without condition (10.22); in fact, they show that their for-
mula always deÔ¨Ånes a variance-optimal strategy if one does not insist on the square-
integrability of the gains process at intermediate times. For a survey on related results,
we refer to [186].


Bibliography
[1] Acerbi, C., Tasche, D., On the coherence of expected shortfall. J. Banking & Finance
26 (7), 2002, 1487‚Äì1503.
[2] Aliprantis, C. D., Border, K. C., InÔ¨Ånite dimensionalAnalysis.A hitchhiker‚Äôs guide, 2nd
edition. Springer-Verlag, Berlin, 1999.
[3] Aliprantis, C., Brown, D., Burkinshaw, O., Existence and optimality of competitive
equilibria. Springer-Verlag, Berlin, 1989.
[4] Allais, M., Le comportement de l‚Äôhomme rationell devant de risque: Critique des pos-
tulats et axiomes de l‚Äô√©cole Am√©ricaine. Econometrica 21 (1953), 503‚Äì546 .
[5] Anscombe, F. J., Aumann, R. J., A deÔ¨Ånition of subjective probability. Ann. Math.
Statistics 34 (1963), 199‚Äì205.
[6] Ansel, J.-P., Stricker, C., Quelques remarques sur un th√©or√®me de Yan. S√©minaire de
probabilit√©s XXIV, 1988/89 (J. Az√©ma, P. Andr√© and M. Yor, eds.), Lecture Notes in
Math. 1426, Springer-Verlag, Berlin, 1990, 266‚Äì274.
[7] Ansel, J.-P., Stricker, C., Lois de martingale, densit√©s et d√©composition de F√∂llmer-
Schweizer. Ann. Inst. H. Poincar√© Probab. Statist. 28 (1992), 375‚Äì392.
[8] Ansel, J.-P., Stricker, C., Unicit√© et existence de la loi minimale. In: S√©minaire de prob-
abilit√©s XXVII (J. Az√©ma et al., eds.). Lecture Notes in Math. 1557, Springer-Verlag,
Berlin, 1993, 22‚Äì29.
[9] Ansel, J.-P., Stricker, C., Couverture des actifs contingents et prix maximum. Ann. Inst.
H. Poincar√© Probab. Statist. 30 (1994), 303‚Äì315.
[10] Arrow, K., Hildebrandt,W., Intriligator, D., Sonnenschein, H. (eds.), Handbook of Math-
ematical Economics, Vol. I‚ÄìIV, Elsevier Science Publishers, Amsterdam, 1991.
[11] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Coherent measures of risk. Math. Finance
9 (1999), 203‚Äì228.
[12] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Ku, H., Coherent multiperiod risk ad-
justed values and Bellman‚Äôs priciple. Preprint, ETH Z√ºrich (2003).
[13] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Ku, H., Coherent multiperiod risk mea-
surement. Preprint, ETH Z√ºrich (2003).
[14] Artzner, P., Delbaen, F., Eber, J.-M., Heath, D., Ku, H., Multiperiod risk and coherent
multiperiod risk measurement. Preprint, ETH Z√ºrich (2003).
[15] Bachelier, L., Th√©orie de la sp√©culation. Ann. Sci. √âcole Norm. Sup. 17 (1900), 21‚Äì86.
[16] Bank, P., Riedel. F., Existence and Structure of Stochastic Equilibria with Intertemporal
Substitution. Finance Stoch. 5 (2001), 487‚Äì509.
[17] Barbera, S., Hammond, P. J., Seidl, C. (eds.), Handbook of Utility Theory, Vol. 1:
Principles, Kluwer Academic Publishers, 1998.
[18] Bauer, H., Wahrscheinlichkeitstheorie und Grundz√ºge der Ma√ütheorie. Third edition.
Walter de Gruyter, Berlin‚ÄìNew York, 1978.

440
Bibliography
[19] Bauer, H., Probability theory. De Gruyter Stud. Math. 23,Walter de Gruyter, Berlin‚ÄìNew
York, 1996.
[20] Bauer, H., Measure and integration theory. De Gruyter Stud. Math. 26,Walter de Gruyter,
Berlin‚ÄìNew York, 2001.
[21] Bensoussan, A., On the theory of option pricing. Acta Appl. Math. 2 (1984), 139‚Äì158.
[22] Bernoulli, D., Specimen theoriae novae de mensura sortis. Commentarii Academiae
Scientiarum Imperialis Petropolitanae 5 (1738), 175‚Äì192. Translated by L. Sommer:
Econometrica 22 (1954), 23‚Äì36.
[23] Bewley, T., Existence of equilibria in economies with inÔ¨Ånitely many commodities.
J. Econom. Theory 43 (1972), 514‚Äì540.
[24] Black, F., Scholes, M., The pricing of options and corporate liabilities. J. Polit. Econom.
81 (1973), 637‚Äì654.
[25] Blackwell, D., Dubins, L., A Converse to the dominated convergence theorem. Illinois
J. Math. 7 (1963), 508‚Äì514.
[26] Borch, K., Equilibrium in a re-insurance market. Econometrica 30 (1962), 424‚Äì444.
[27] Bourbaki, N., Int√©gration. Hermann, Paris, 1969.
[28] Breeden, D., Litzenberger, R., Prices of state-contingent claims implicit in option prices.
J. Business 51 (1978), 621‚Äì651.
[29] Brown, H., Hobson, D., Rogers, L. C. G., Robust hedging of barrier options. Math.
Finance 11 (2001), 285‚Äì314.
[30] Browne, S., The risks and rewards of minimizing shortfall probability. J. Portfolio Man-
agement 25 (1999), 76‚Äì85.
[31] B√ºhlmann, H.,The general economic premium priciple.Astin Bulletin 14 (1984), 13‚Äì21.
[32] B√ºhlmann, H., Jewell, S., Optimal risk exchanges. Astin Bulletin 10 (1979), 243‚Äì262.
[33] Carassus, L., Pham, H., Touzi, N., No-arbitrage in discrete-time under portfolio con-
straints. Math. Finance 11 (2001), 315‚Äì329.
[34] Carlier, G., Dana, R. A., Core of convex distortions of a probability. J. Econom. Theory
113 (2) (2003), 199‚Äì222.
[35] Carlier, G., Dana, R.A., Insurance contracts with deductibles and upper limits. Preprint,
Ceremade, Universit√© Paris Dauphine (2002).
[36] Carr, P., Geman, H., Madan, D., Pricing and hedging in incomplete markets. J. Financial
Econom. 62 (2001), 131‚Äì167.
[37] Cheridito, P., Delbaen, F., Kupper, M., Coherent and convex monetary risk measures
for bounded c√†dl√†g processes. Stochastic Process. Appl. 112 (1) (2004), 1‚Äì22.
[38] Choquet, G., Theory of capacities. Ann. Inst. Fourier 5 (1953/54), 131‚Äì295.
[39] Chow,Y. S., Teicher, H., Probability Theory: Independence, interchangeability, martin-
gales. Springer-Verlag, New York‚ÄìHeidelberg‚ÄìBerlin, 1978.
[40] Chung, K.-L., A course in probability theory. 2nd ed. Academic Press, New York‚Äì
London, 1974.

Bibliography
441
[41] Cootner,P.H.(ed.),Therandomcharacterofstockmarketprices.MITPress,Cambridge,
MA, 1964.
[42] Cox, J., Ross, S., Rubinstein, M., Option pricing: a simpliÔ¨Åed approach. J. Financial
Econom. 7 (1979), 229‚Äì263.
[43] Csis¬¥zar, I., I-divergence geometry of probability distributions and minimization prob-
lems. Ann. Probab. 3 (1975), 146‚Äì158.
[44] Csisz√°r, I., Sanov property, generalized I-projection and a conditional limit theorem.
Ann. Probab. 12 (1984), 768‚Äì793.
[45] Cvitanic, J., Minimizing expected loss of hedging in incomplete and constrained mar-
kets. SIAM J. Control Optim. 38 (2000), 1050‚Äì1066.
[46] Cvitanic, J., Karatzas, I., Convex duality in constrained portfolio optimization. Ann.
Appl. Probab. 2 (1992), 767‚Äì818.
[47] Cvitanic, J., Karatzas, I., Hedging contingent claims with constrained portfolios. Ann.
Appl. Probab. 3 (1993), 652‚Äì681.
[48] Cvitanic, J., Karatzas, I., On dynamic measures of risk. Finance Stoch. 3 (1999),
451‚Äì482.
[49] Cvitanic, J., Karatzas, I., Generalized Neyman-Pearson lemma via convex duality.
Bernoulli 7 (2001), 79‚Äì97.
[50] Cvitanic, J., Spivak, G., Maximizing the probability of perfect hedge.Ann.Appl. Probab.
9 (1999), 1303‚Äì1328.
[51] Dalang, R., Morton,A., Willinger, W., Equivalent martingale measures and no-arbitrage
in stochastic securities market models. Stochastics Stochastics Rep. 29 (1990), 185‚Äì201.
[52] Dana, R.-A., Existence and uniqueness of equilibria when preferences are additively
separable and gross substitute. Econometrica 61 (1993), 953‚Äì957.
[53] Dana, R.-A., Stochastic dominance, individual decision making, and equilibrium asset
pricing. Preprint, Ceremade, Universit√© Paris Dauphine (2002).
[54] Dana, R.-A., Jeanblanc-Piqu√©, M., March√©s Ô¨Ånanciers en temps continu. Economica
(1994), Paris.
[55] Davis, M. H. A., Option pricing in incomplete markets. In: Mathematics of derivative
securities (Dempster, M.A. H. and Pliska, S. R., eds.), Publ. Newton Inst. 15, Cambridge
University Press, Cambridge, 1997, 216‚Äì226.
[56] Debreu, G., Theory of value: an axiomatic analysis of economic equilibrium. Cowles
Foundation for Research in Economics at Yale University, Monograph 17, John Wiley
& Sons, Inc., New York; Chapman & Hall, Ltd., London, 1959.
[57] Debreu, G., Continuity properties of paretian utility. International Econ. Rev. 5 (1964),
285‚Äì293.
[58] Delbaen, F., Coherent risk measures on general probability spaces. In: Advances in
Finance and Stochastics. Essays in Honour of Dieter Sondermann, Springer-Verlag,
Berlin, 2002, 1‚Äì37.
[59] Delbaen, F., Coherent risk measures. Cattedra Galileiana. Scuola Normale Superiore,
Classe di Scienze, Pisa, 2000.

442
Bibliography
[60] Delbaen, F., The structure of m-stable sets and in particular of the set of riskneutral
measures. Preprint, ETH Z√ºrich (2003).
[61] Delbaen, F., Grandits, P., Rheinl√§nder, T., Samperi, D., Schweizer, M. and Stricker, C.,
Exponential Hedging and Entropic Penalties. Math. Finance 12 (2002), 99‚Äì123.
[62] Delbaen, F., Schachermayer, W., A general version of the fundamental theorem of asset
pricing. Math. Ann. 300 (1994), 463‚Äì520.
[63] Delbaen, F., Schachermayer, W., The fundamental theorem of asset pricing for un-
bounded stochastic processes. Math. Ann. 312 (1998), 215‚Äì250.
[64] Dellacherie, C., Quelques commentaires sur les prolongements de capacit√©s. S√©minaire
Probabilit√©s V, Sttrasbourg, Lecture Notes in Math. 191, Springer-Verlag, Berlin, 1970.
[65] Dellacherie, C., Meyer, P.-A., Probabilit√©s et potentiel. Chapitres IX √† XI. Th√©orie
discr√®te du potential. Revised edition. Publications de l‚ÄôInstitut de Math√©matiques de
l‚ÄôUniversit√© de Strasbourg, XVIII. Actualit√©s Sci. Indust. 1410, Hermann, Paris, 1983
[66] Dembo, A., Zeitouni, O., Large deviations techniques and applications. Second edition.
Appl. Math. 38. Springer-Verlag, New York, 1998.
[67] Denneberg, D., Non-additive measure and integral. Theory Decis. Lib. Ser. B Math.
Statist. Meth. 27, Kluwer Academic Publishers, Dordrecht, 1994.
[68] Denneberg, D., Distorted probabilities and insurance premium. Methods Operations
Research 52 (1990), 21‚Äì42.
[69] Deuschel, J.-D., Stroock, D., Large deviations. Pure Appl. Math. 137, Academic Press,
Inc., Boston, MA, 1989.
[70] Doob, J., Generalized sweeping-out and probability. J. Funct. Anal. (1968), 207‚Äì225.
[71] Dubins, L., Gilat, D., On the distribution of maxima of martingales. Proc. Amer. Math.
Soc. 68 (1978), 337‚Äì338.
[72] Dudley, R., Real analysis and probability. Wadsworth & Brooks/Cole, PaciÔ¨Åc Grove,
CA, 1989.
[73] DufÔ¨Åe, D., Security markets. Econom. Theory Econometrics Math. Econom.,Academic
Press, Boston, MA, 1988.
[74] DufÔ¨Åe, D., Dynamic asset pricing theory. 2nd ed. Princeton University Press, Princeton,
NJ, 1996.
[75] DufÔ¨Åe, D., Richardson, H. R., Mean-variance hedging in continuous time. Ann. Appl.
Probab. 1 (1991), 1‚Äì15.
[76] Dunford, N., Schwartz, J., Linear Operators. Part I: General Theory. Interscience Pub-
lishers, New York, 1958.
[77] Dybvig, P., Distributional analysis of portfolio choice. J. Business 61 (1988), 369‚Äì393.
[78] Eilenberg, S., Ordered topological spaces. Amer. J. Math. LXIII (1941), 39‚Äì45.
[79] Ekeland, I., Temam, R., Convex analysis and variational problems. Stud. Math. Appl. 1,
North-Holland Publishing Co.,Amsterdam‚ÄìOxford;American Elsevier Publishing Co.,
Inc., New York, 1976.
[80] El Karoui, N., Quenez, M.-C., Dynamic programming and pricing of contingent claims
in an incomplete market. SIAM J. Control Optim. 33 (1995), 29‚Äì66.

Bibliography
443
[81] Elliott, R., F√∂llmer, H., Orthogonal martingale representation. In: Stochastic analysis.
Liber amicorum for Moshe Zakai, Academic Press, Boston, MA, 1991, 139‚Äì152.
[82] Elliott, R., Kopp, P., Mathematics of Ô¨Ånancial markets. Springer Finance, Springer-
Verlag, New York, 1999.
[83] Feller, W., An introduction to probability theory and its applications. 3rd edition. John
Wiley & Sons, New York, 1968.
[84] Fishburn, P., Utility theory for decision making. Publ. Operations Res. 18, John Wiley,
New York, 1970.
[85] Fishburn, P. C., Nonlinear preference and utility theory. The John Hopkins University
Press, Baltimore, MD, 1988.
[86] Floret, K., Weakly compact sets. Lecture Notes in Math. 801, Springer-Verlag, Berlin,
1980.
[87] F√∂llmer, H., Calcul d‚ÄôIto sans probabilit√©s. Seminaire de probabilites XV, Univ. Stras-
bourg 1979/80, Lect. Notes Math. 850 (1981), 143-150.
[88] F√∂llmer, H., Probabilistic Aspects of Financial Risk. Plenary Lecture at the Third Euro-
pean Congress of Mathematics. Proceedings of the European Congress of Mathematics,
Barcelona 2000, Birkh√§user, Basel, 2001.
[89] F√∂llmer, H., Kabanov, Yu. M., Optional decomposition and Lagrange multipliers. Fi-
nance Stoch. 2 (1998), 69‚Äì81.
[90] F√∂llmer, H., Kramkov, D., Optional decompositions under constraints. Probab. Theory
Related Fields 109 (1997), 1‚Äì25.
[91] F√∂llmer, H., Leukert, P., Quantile hedging. Finance Stoch. 3 (1999), 251‚Äì273.
[92] F√∂llmer, H., Leukert, P., EfÔ¨Åcient hedging: cost versus shortfall risk. Finance Stoch. 4
(2000), 117‚Äì146.
[93] F√∂llmer, H., Schied,A., Convex measures of risk and trading constraints. Finance Stoch.
6 (4) (2002).
[94] F√∂llmer, H., Schied, A., Robust representation of convex measures of risk. In: Advances
in Finance and Stochastics. Essays in Honour of Dieter Sondermann, Springer-Verlag,
Berlin, 2002, 39‚Äì56.
[95] F√∂llmer, H., Schweizer, M., Hedging by sequential regression: An introduction to the
mathematics of option trading. Astin Bulletin 18 (1989), 147‚Äì160.
[96] F√∂llmer,H.,Schweizer,M.,Hedgingofcontingentclaimsunderincompleteinformation.
Applied stochastic analysis, London, Stochastic Monogr. 5 (1990), 389‚Äì414.
[97] F√∂llmer, H., Sondermann, D., Hedging of non-redundant contingent claims. Contribu-
tions to mathematical economics, Hon. G. Debreu, 206‚Äì223 (1986).
[98] Frittelli, M., Introduction to a theory of value coherent with the no arbitrage principle,
Finance Stoch. 4 (3) (2000), 275‚Äì297.
[99] Frittelli, M., The minimal entropy martingale measure and the valuation problem in
incomplete markets, Math. Finance 10 (2000), 39‚Äì52.
[100] Frittelli, M., Rosazza Gianin, E., Putting order in risk measures. J. Banking & Finance
26 (2002), 1473‚Äì1486.

444
Bibliography
[101] Frittelli, M., Rosazza Gianin, E., Dynamic convex risk measures. In: New Risk Measures
in Investment and Regulation, G. Szeg√∂ ed., John Wiley & Sons, New York, 2003.
[102] Frittelli, M., Scandolo, G., Risk measures and capital requirements for processes.
Preprint, Universit√† di Firenze (2004).
[103] Gilboa, I., Expected utility with purely subjective non-additive probabilities. J. Math.
Econom. 16 (1987), 65‚Äì88.
[104] Gilboa, I., Schmeidler, D., Maxmin expected utility with non-unique prior. J. Math.
Econom. 18 (1989), 141‚Äì153.
[105] Goovaerts, M. J., De Vylder, F., Haezendonck, J., Insurance premiums. Theory and
applications. North-Holland Publishing Co., Amsterdam, 1984.
[106] Halmos, P., Savage, L., Application of the Radon-Nikodym theorem to the theory of
sufÔ¨Åcient statistics. Ann. Math. Stat. 20 (1949), 225‚Äì241.
[107] Hardy, G. H., Littlewood, J. E., P√≥lya, G., Inequalities. 2nd edition, Cambridge Univer-
sity Press, Cambridge, 1952.
[108] Harrison, J., Kreps, D., Martingales and arbitrage in multiperiod securities markets.
J. Econom. Theory 20 (1979), 381‚Äì408.
[109] Harrison, J., Pliska, S., Martingales and stochastic integrals in the theory of continuous
trading. Stochastic Process. Appl. 11 (1981), 215‚Äì260.
[110] Heath, D., Back to the future. Plenary lecture, First World Congress of the Bachelier
Finance Society, Paris, 2000.
[111] Heath, D., Ku, H., Pareto equilibria with coherent measures of risk. Math. Finance 14
(2) (2004), 163‚Äì172.
[112] Herstein, I. N., Milnor J., An axiomatic approach to measurable utility. Econometrica
21 (1953), 291‚Äì297.
[113] Hobson, D., Robust hedging of the loockback option. Finance Stoch. 2 (1998), 329‚Äì347.
[114] Huber, P., Robust statistics. Wiley Ser. Probab. Math. Statist., Wiley, New York, 1981.
[115] Huber, P., Strassen, V., Minimax tests and the Neyman-Pearson lemma for capacities.
Ann. Statist. 1 (1973), 251‚Äì263.
[116] Hull, J., Options, futures, and other derivatives. 4th edition. Prentice Hall, London, 2000.
[117] Jacka, S., A martingale representation result and an application to incomplete Ô¨Ånancial
markets. Math. Finance 2 (1992), 239‚Äì250.
[118] Jaschke, S., K√ºchler, U., Coherent Risk Measures and Good-Deal Bounds. Finance
Stoch. 5 (2) (2001), 181‚Äì200
[119] Jouini, E., Kallal, H., Arbitrage in securities markets with short-sales constraints. Math.
Finance 3 (1995), 197‚Äì232.
[120] Jouini, E., Kallal, H., EfÔ¨Åcient trading strategies in the presence of market frictions. The
Review of Financial Studies 14 (2001), 343‚Äì369.
[121] Kabanov, Yu. M., Kramkov, D. O., No-arbitrage and equivalent martingale measures:
An elementary proof of the Harrison-Pliska theorem. Theory Probab. Appl. 39 (1994),
523‚Äì527.

Bibliography
445
[122] Kabanov, Yu. M., Stricker, C., A teacher‚Äôs note on no-arbitrage criteria. S√©m. Probab.
35, Lecture Notes in Math. 1755, Springer-Verlag, 2001, Berlin, 149‚Äì152.
[123] Kahneman, D., Tversky, A., Prospect theory: An analysis of decision under risk. Econo-
metrica 47 (1979), 263‚Äì291.
[124] Karatzas, I., On the pricing of American options. App. Math. Optimization 17 (1988),
37‚Äì60.
[125] Karatzas, I., Lectures on the mathematics of Ô¨Ånance. CRM Monogr. Ser. 8, American
Mathematical Society, Providence, RI, 1996.
[126] Karatzas, I., Kou, S. G., On the pricing of contingent claims under constraints. Ann.
Appl. Probab. 6 (1996), 321‚Äì369.
[127] Karatzas, I., Kou, S. G., HedgingAmerican contingent claims with constraint portfolios.
Finance Stoch. 2 (1998), 215‚Äì258.
[128] Karatzas, I., Shreve, S., Brownian motion and stochastic calculus. Grad. Texts in Math.
113, Springer-Verlag, New York, 1991.
[129] Karatzas, I., Shreve, S., Methods of mathematical Ô¨Ånance.Appl. Math., Springer-Verlag,
Berlin, 1998.
[130] Karni, E., Schmeidler, D., Vind, K., On state-dependent preferences and subjective
probabilities. Econometrica 51 (1983), 1021‚Äì1031.
[131] Karni, E., Schmeidler, D., Utility theory with uncertainty. In: Handbook of Mathemat-
ical Economics, Vol. IV (W. Hildebrandt and H. Sonnenschein, eds.), Elsevier Science
Publishers, Amsterdam, 1991, 1763‚Äì1831.
[132] Kellerer, H., Markov-Komposition und eine Anwendung auf Martingale. Math. Ann.
198 (1972), 99‚Äì122.
[133] Komlos, J., A generalization of a problem of Steinhaus. Acta Math. Acad. Sci. Hung.
18 (1967), 217‚Äì229.
[134] Kr√§tschmer, V., Robust representation of convex risk measures by probability. Preprint,
Universit√§t des Saarlandes (2004).
[135] Kramkov, D. O., Optional decomposition of supermartingales and hedging contingent
claims in incomplete security markets. Probab. Theory Related Fields 105 (1996),
459‚Äì479.
[136] Krasnosel‚Äôskii, M., Rutickii, Ya., Convex functions and Orlicz spaces. Gordon and
Breach Science Publishers, 1961.
[137] Kreps, D., Arbitrage and equilibrium in economies with inÔ¨Ånitely many commodities.
J. Math. Econom. 8 (1981) 15‚Äì35.
[138] Kreps, D., Notes on the theory of choice. Westview Press, Boulder, CO, 1988.
[139] Kulldorff, M., Optimal control of favorable games with a time limit. SIAM J. Control
Optim. 31 (1993), 52‚Äì69.
[140] Kunze, M., Verteilungsinvariante konvexe Risikoma√üe. Diplomarbeit, Humboldt-Uni-
versit√§t zu Berlin, 2003.
[141] Kusuoka, S., On law invariant coherent risk measures.Adv. Math. Econ. 3 (2001), 83‚Äì95.

446
Bibliography
[142] Lamberton, D., Lapeyre, B., Introduction to stochastic calculus applied to Ô¨Ånance. Chap-
man & Hall, London, 1995.
[143] Lamberton, D., Lapeyre, B., Introduction au calcul stochastique appliqu√© √† la Ô¨Ånance.
2√®me √©d. Ellipses, Paris, 1997.
[144] Leland, H., Who should buy portolio insurance? J. Finance 35 (1980), 581‚Äì594.
[145] Leukert, P., Absicherungsstrategien zur Minimierung des Verlustrisikos. Dissertation,
Humboldt-Universit√§t zu Berlin (1999).
[146] Li, P., Xia, J., Minimal martingale measures in discrete time. Acta Math. Appl. Sinica
(2002).
[147] Mas-Colell,A.,Thetheoryofgeneralequilibrium:Adifferentiableapproach.Cambridge
University Press, Cambridge, 1985.
[148] Mas-Colell, A., Zame, W., Equilibrium theory in inÔ¨Ånite dimensional spaces. In: Hand-
book of Mathematical Economics IV (W. Hildebrandt and H. Sonnenschein, eds.), El-
sevier Science Publishers, Amsterdam, 1991, 1835‚Äì1898.
[149] Melnikov, A. V., Nechaev, M. L., On the mean-variance hedging problem. Theory
Probab. Appl. 43 (1998), 588‚Äì603; translation from Teor. Veroyatnost. i Primenen. 43
(1998), 672‚Äì691.
[150] Merton, R., Theory of rational option pricing. Bell J. Econom. Manag. Sci. 4 (1973),
141‚Äì183.
[151] Milgram,A. N., Partially ordered sets, separating systems and inductiveness. Rep. Math.
Colloq. II Ser. 1, University of Notre Dame, 1939, 18‚Äì30.
[152] Monat, P., Stricker, C., F√∂llmer-Schweizer decomposition and mean-variance hedging
for general claims. Ann. Probab. 23 (1995), 605‚Äì628.
[153] Musiela, M., Rutkowski, M., Martingale methods in Ô¨Ånancial modelling. Appl. Math.,
Springer-Verlag, Berlin, 1997.
[154] Myeni, R., The pricing of the American option. Ann. Appl. Probab. 2 (1992), 1‚Äì23.
[155] von Neumann, J., Morgenstern, O., Theory of games and economic behavior. 2nd. Ed.
Princeton University Press, Princeton, NJ, 1947.
[156] Neveu, J., Discrete-parameter martingales. North-Holland, Amsterdam‚ÄìOxford, 1975.
[157] Ogryczak, W., Ruszczynski, A., Dual stochastic dominance and related mean-risk mod-
els. SIAM J. Optim. 13 (1) (2002), 60‚Äì78.
[158] PÔ¨Çug, G., Ruszczynski, A., Risk measures for income streams. Preprint, Universit√§t
Wien (2001).
[159] Pham,H.,DynamicLp-hedgingindiscretetimeunderconeconstraints.SIAMJ.Control
Optim. 38 (2000), 665‚Äì682.
[160] Pliska, S., Introduction to Mathematical Finance. Blackwell Publishers, 1997.
[161] Quiggin, J., A Theory of Anticipated Utility. J. Economic Behavior and Organization 3
(1982), 225‚Äì243.
[162] Rabin, M., Risk aversion and expected-utility theory:A calibration theorem. Economet-
rica 68 (5) (2000), 1281‚Äì1292.

Bibliography
447
[163] Rader, J., The existence of a utility function to represent preferences. Rev. Econom.
Stud. 30 (1963), 229‚Äì232.
[164] Reed, M., Simon, B., Methods of modern mathematical physics. Vol. 1: Functional
analysis. Academic Press, New York‚ÄìLondon, 1972.
[165] Riedel, F., Dynamic coherent risk measures. Stoch. Proc.Appl. 112 (2) (2004), 185‚Äì200.
[166] Rockafellar, R. T., Convex analysis. Princeton University Press, Princeton, NJ, 1970.
[167] Rockafellar, R. T., Uryasev, S., Conditional value-at-risk for general loss distributions.
Research report 2001-5, ISE Dept., University of Florida, 2001.
[168] Rogers, L. C. G., Equivalent martingale measures and no-arbitrage. Stochastics Stochas-
tics Rep. 51 (1994), 41‚Äì49.
[169] Ross, S. A., The arbitrage theory of capital asset pricing. J. Econom. Theory 13 (1976),
341‚Äì360.
[170] Rothschild, M., Stiglitz, J., Increasing risk: I. A deÔ¨Ånition. J. Econom. Theory 2 (1970),
225‚Äì243.
[171] Rothschild, M., Stiglitz, J., Increasing risk: II. Its economic consequences. J. Econom.
Theory 3 (1971), 66‚Äì84.
[172] Samuelson, P. A., Proof that properly anticipated prices Ô¨Çuctuate randomly. Industrial
Management Rev. 4 (1965), 41‚Äì50.
[173] Samuelson, P. A., Rational theory of warrant pricing. Industrial Management Rev. 6
(1965), 13‚Äì31.
[174] Savage, L. J., The foundations of statistics. Wiley Publ. Stat., John Wiley and Sons, New
York, 1954.
[175] Schachermayer, W., A Hilbert space proof of the fundamental theorem of asset pricing
in Ô¨Ånite discrete time. Insurance Math. Econom. 11 (1992), 249‚Äì257.
[176] Schachermayer, W., Optimal Investment in Incomplete Financial Markets. Proceedings
of the Ô¨ÅrstWorld Congress of the Bachelier Society, Paris 2000, Springer-Verlag, Berlin,
2001.
[177] Schachermayer, W., Introduction to the mathematics of Ô¨Ånancial markets. In: Lectures
on probability theory and statistics (Saint-Flour, 2000) , Lecture Notes in Math. 1816,
Springer-Verlag, Berlin, 107‚Äì179.
[178] Schaefer, H., Topological vector spaces. Grad. Texts in Math. 3, Springer-Verlag, New
York, 1971.
[179] Sch√§l, M., On quadratic cost criteria for option hedging. Math. Oper. Research 19 (1994),
121‚Äì131.
[180] Schied,A., On the Neyman-Pearson problem for law-invariant risk measures and robust
utility functionals. Ann. Appl. Probab. 14 (2004), 1398‚Äì1423.
[181] Schied,A.,Optimalinvestmentsforrobustutilityfunctionalsincompletemarketmodels.
To appear in Math. Oper. Research.
[182] Schmeidler, D., Integral representation without additivity. Proc. Amer. Math. Soc. 97
(2) (1986), 255‚Äì261.

448
Bibliography
[183] Schweizer, M., Hedging of options in a general semimartingale model. Diss. ETH Z√ºrich
No. 8615 (1988).
[184] Schweizer, M., Risk-minimality and orthogonality of martingales. Stochastics Stochas-
tics Rep. 30 (1990), 123‚Äì131.
[185] Schweizer, M., Variance-optimal hedging in discrete time. Math. Oper. Res. 20 (1995)
1‚Äì32.
[186] Schweizer, M., A Guided Tour through Quadratic Hedging Approaches. In: Option
pricing, interest rates, and risk management (Jouini, E., Musiela, M., Cvitanic, J., eds.).
Cambridge University Press, Cambridge, 2001, 538‚Äì574.
[187] Shiryaev, A. N., Probability. 2nd ed. Grad. Texts in Math. 95, Springer-Verlag, New
York, 1995.
[188] Shiryaev, A. N., Essentials of stochastic Ô¨Ånance. Adv. Ser. Stat. Sci. Appl. Probab. 3,
World ScientiÔ¨Åc, Singapore, 1999.
[189] Snell, L., Applications of the martingale systems theorem. Trans. Amer. Math. Soc. 73
(1952), 293‚Äì312.
[190] Sprenkle, C., Warrant prices as indicators of expectations and preferences. Yale Eco-
nomic Essays 1 (1964), 178‚Äì231.
[191] Strassen, V., The existence of probability measures with given marginals. Ann. Math.
Stat. 36 (1965), 423‚Äì439.
[192] Staum, J., Fundamental theorems of asset pricing for good deal bounds. Math. Finance
14 (2) (2004), 141‚Äì161.
[193] Stricker, C., Arbitrage et lois de martingale. Ann. Inst. H. Poincar√© Probab. Statist. 26
(1990), 451‚Äì460.
[194] Tversky, A., Kahneman, D., Advances in prospect theory: Cumulative representation of
uncertainty. J. Risk Uncertainty 5 (1992), 297‚Äì323.
[195] von Weizs√§cker, H., Can one drop L1-boundedness in Koml√≥s‚ÄôSubsequence Theorem?
American Math. Monthly 111 (2004), 900‚Äì903.
[196] Wang, S., Dhaene, J., Comonotonicity, correlation order and premium principles. Insur-
ance Math. Econom. 22 (1998), 235‚Äì242.
[197] Weber, S., Distribution-invariant dynamic risk measures. Preprint, Humboldt-Univer-
sit√§t zu Berlin (2004).
[198] Yaari, M., The dual theory of choice under risk. Econometrica 55 (1987), 95‚Äì116.
[199] Yan, J.-A., Caract√©risation d‚Äôune classe d‚Äôensembles convexes de L1 ou H 1. Seminaire
de probabilit√©s XIV, 1978/79 (J. Az√©ma and M. Yor, eds.), Lecture Notes in Math. 784,
Springer-Verlag, Berlin, 1980, 220‚Äì222.

List of symbols
‚âª, 45
‚àº, 45
‚™∞, 45
‚âΩbal, 82
‚âΩcon, 82
‚âΩuni, 75
‚âΩmon, 84
‚à•¬∑ ‚à•, 426
‚à•¬∑ ‚à•p, 428
‚à•¬∑ ‚à•‚àû, 428
‚à•¬∑ ‚à•var, 426
AQ, 358
AV@R, 179
ba(, F ), 426
Cb(S), 418
conv A, 400
cov(¬∑ | F0), 375
Cœà(S), 422
Ct(K), 323
E[ F ; A0 ], 404
E[ F | F0 ], 404
ess inf X, 418
ess sup X, 418
ess inf , 417
ess sup , 417
F¬µ, 408
FX, 408
Ft, 224
FœÑ, 297
(¬µ), 28
H(Q|P), 119
H2, 380
I +, 130
Lp(, F , P ), 428
Lp(, F , P ), 428
¬µQ, 76
M(S, S), 418
Mœà(S), 422
Mb(S), 58
M1(P ), 172
M1(S, S), 51, 92, 419
M1,f , 91, 426
M1,f (, F ), 426
Mœà
1 (S), 99, 423
M(¬µ), 27
Mb(¬µ), 27
N(m, œÉ 2), 79
N‚ä•, 39, 351
œÄ, 3
œÄinf(C), 19
œÄinf(H), 238, 293
œÄsup(C), 19
œÄsup(H), 238, 293
œÄ(V ), 10
(C), 18
(H), 238, 293
P , 6, 229
P, 325
PT , 327
PS, 352
QS, 358
R(V ), 11
œÉ(E, F), 430
œÉ(L‚àû, L1), 430
S, 204, 350, 393
S‚àû, 354
S‚àû
t , 354

450
List of symbols
St, 350
supp ¬µ, 28
T , 284
Tt, 285
TœÑ, 298
UP ‚àó, 280
UQ, 280
U‚Üì, 301
U‚Üë, 301, 363
V@R, 158, 177
var(¬∑ | F0), 375
var(¬µ), 81
|x|, 399

X ‚àºX, 183

Index
absolute risk aversion, 67
absolutely continuous measure, 403
acceptanceset,155,172,204,219,320,
340, 370
adapted process, 224
admissible strategy, 205, 334
afÔ¨Åne hull of a convex set, 29
afÔ¨Åne numerical representation, 51
Allais paradox, 60, 88
American claim
arbitrage-free price of, 288, 293
attainable, 296
hedging strategy, 296
American option, 277
call, 279
put, 279, 290
arbitrage bounds, 19
arbitrage opportunity, 5, 32, 206, 227,
323
arbitrage-free price
of a European claim, 238
of a contingent claim, 18
of American claim, 288, 293
universal bounds, 22, 327
Archimedean axiom, 52, 91
Arrow‚ÄìDebreu equilibrium, 138
and interest rate, 150
w.r.t. general utility functionals,
151
Arrow‚ÄìPratt coefÔ¨Åcient, 67
Asian option, 234, 252
asymmetric relation, 45
at-the-money option, 22
atom of a probability space, 24, 183,
413
atomless probability space, 183, 413
attainable
American claim, 296
European claim, 237
payoff, 10
average
price option, 234
strike option, 235
Average Value at Risk, 179
comonotonicity, 198, 199
balayage order, 82, 321, 325
Banach space, 428
Banach‚ÄìAlaoglu theorem, 431
barrier option, 235, 252
Black‚ÄìScholes price of, 274
up-and-in call, 257, 330
up-and-out call, 258, 330, 332
barycenter of a measure, 27
basket call option, 132
basket option, 15
Bermuda option, 279
Bernoulli, Daniel, 44, 64
Bernoulli, Nicholas, 64
binomial model, 249, 262, 290
Black‚ÄìScholes formula, 264, 266
Black‚ÄìScholes p.d.e., 269, 273
Black‚ÄìScholes price, 263
of a European call option, 264,
266
Bolzano‚ÄìWeierstra√ü theorem
randomized version, 38
boundedly supported measures, 58
Brownian motion, 271
butterÔ¨Çy spread, 15
call option, 14, 132, 322
American, 279, 289
Asian, 234
Bermuda, 279
Black‚ÄìScholes price, 264, 266
European, 234, 244, 289, 345
universal bounds on price, 22

452
Index
with barrier, 235, 330
call-put parity, 15
cap, 17
CARA utility, 67, 73, 110, 116, 128,
132
cash invariance, 94, 153
catastrophe bond, 17
central limit theorem, 419
functional, 271
multiplicative, 260
certainty equivalent, 63, 93
as reservation price, 137
certainty independence, 90
Choquet boundary, 321
Choquet integral, 160, 192, 196
coherent measure of risk, 155
and superhedging, 320
representation theorem, 165, 175
coherent risk measure
conditional, 306
dynamic, 306
dynamically consistent, 306
time-consistent, 306
comonotone random variables, 196
comonotonicity, 91
complete
market, 23, 245
relation, 45
compound lottery, 52
concave stochastic order, 82
conditional coherent risk measure, 306
conditional expectation, 33, 404
Conditional Value at Risk, 179
conjugate function, 214, 402, 431
of a convex risk measure, 164,
176
connected topological space, 49
constant absolute risk aversion, 67
constant relative risk aversion, 68
contingent claim, 17
American, 278
arbitrage-free price of, 18
attainable, 21
European, 234
redundant, 21
replicable, 21
continuation region, 292
continuity axiom, 52, 91
continuity from above, 99, 166, 172
continuityfrombelow,92,99,167,213
convex function
duality theory, 430
proper, 400, 430
convex hull, 400
of the support of a measure, 28
convex measure of risk, 154
acceptance set of, 155
continuous from above, 166, 172
continuous from below, 167, 213
in Ô¨Ånancial market, 203, 340, 370
law-invariant, 183
penalty function for, 161, 165,
172, 213, 219
relevant, 174
representation theorem, 161, 172
sensitive, 173, 371
tight, 169
convex stochastic order, 82, 321, 325
core of a set function, 201
cost of superhedging, 314
cost process, 373
countably convex set, 36
Cox‚ÄìRoss‚ÄìRubinstein model, 249,
262, 290
CRR model, 249, 262, 290
CRRA utility, 68
decline of a favorable bet, 69
Delta hedging, 253, 266, 272
Delta of a call option, 266
density function, 403
density process, 229, 298
derivative securities, 18, 234
digital option, 235, 327
Dini‚Äôs lemma, 169
Dirac measure, 422

Index
453
discount certiÔ¨Åcate, 17
discounted American claim, 279
discounted claim, 236
discounting, 9, 150
distortion function, 191
distortionofaprobabilitymeasure,191
distribution
log-normal, 82, 261
normal, 78
Poisson, 22
distribution function, 407
and stochastic dominance, 85
and stochastic order, 76
diversiÔ¨Åcation, 154
Dol√©ans‚ÄìDade exponential, 384
Donsker‚Äôs invariance principle, 271
Doob decomposition, 277, 310, 385
uniform, 310, 360
Doob‚Äôs stopping theorem, 283, 297
Doob‚Äôs systems theorem, 229
down-and-in option, 235, 252
down-and-out option, 235
dual space, 429
dualitytheoryofconvexfunctions,430
Dunford‚ÄìPettis theorem, 432
dynamic coherent risk measure, 306
dynamicconsistencyofariskmeasure,
306
early exercise premium, 290
Eberlein‚Äì≈†mulian theorem, 432
efÔ¨Åcient market hypothesis, 231
Ellsberg paradox, 88
entropic risk measure, 174, 213
entropy of a measure, 120
entropy-minimizing risk-neutral
measure, 121, 132
epigraph of a convex function, 402
equivalent martingale measure, 6, 229
equivalent measure, 403
Esscher transform, 121
essential inÔ¨Åmum, 417
of a random variable, 418
essential supremum, 417
of a random variable, 418
European call option, 244, 289, 322
Black‚ÄìScholes price, 264, 266
efÔ¨Åcient hedging of, 345
intrinsic value of, 240
time value of, 240
European contingent claim, 234
arbitrage-free price, 238
attainable, 237, 242
redundant, 237
replicable, 237
European put option, 263
exercise strategy for American claim,
279
expected shortfall, 179, 218, 347
expiration date of a contingent claim,
234
exponential family, 117
exponentialutilityfunction,67,73,132
extreme point
in the set of comonotonic convex
risk measures, 200
of a convex set, 246
fair premium, 61
fair price, 61
Fatou property, 172
on Lp, 177
favorable bet
decline of, 69
feasible allocation, 137
Fenchel‚ÄìLegendretransform,122,124,
214, 402, 409, 430
of a convex risk measure, 164,
176
Ô¨Åltered probability space, 224
Ô¨Åltration, 224
Ô¨Ånancial position, 153
Ô¨Ånitely additive set function, 92, 161,
426
Ô¨Årst order stochastic dominance, 84,
106

454
Index
fork convex sets, 300
forward contract, 14, 323
Fr√©chet bounds, 413
FTAP, 6, 231
under portfolio constraints, 353
fundamental theorem of asset pricing
for multi-period market, 231
geometric form, 29
in one period, 6
second, 245
under portfolio constraints, 353
with contingent initial data, 33
without a priori measure, 325
gains process, 226, 373
Gamma of a call option, 266
gauge function, 59, 99, 422
generalizedlikelihoodquotienttest,416
generalized trading strategy, 372
mean self-Ô¨Ånancing, 374
geometric Brownian motion, 271
Girsanov formula, 385
global quadratic risk, 393
Greeks, 269
Hahn‚ÄìBanach theorem, 429
Halmos‚ÄìSavage theorem, 37
HARA utility, 68, 73, 110, 132
Hardy‚ÄìLittlewoodinequality,136,410
Hausdorff space, 48
hedging strategy for American claim,
296
hyperbolic absolute risk aversion, 68
in-the-money option, 22
independence axiom, 51, 87, 90, 92
indifference relation, 45
inequality
Hardy‚ÄìLittlewood, 136, 410
insurance, 17, 66, 71
interest rate, 150
intrinsic value, 22, 240
inverse function, 406
left-continuous, 406
right-continuous, 406
It√¥ integral, 273
It√¥‚Äôs formula, 272
James‚Äô theorem, 432
knock-in option, 235, 331
knock-out option, 235, 335
Kolmogorov‚Äôs law of large numbers,
43, 72, 74
Krein‚Äì≈†mulian theorem, 431
Kreps‚ÄìYan theorem, 37, 355
Kunita‚ÄìWatanabe decomposition, 381
L2-admissible strategy, 374
Œª-efÔ¨Åcient allocation, 145
Œª-quantile, 177
Œª-quantile, 408
law of large numbers, 72, 74
strong, 43
law of one price, 10, 21
Lebesgue decomposition, 405
left-continuous inverse, 406
Legendre transform, 409
leverage effect, 26
intheBlack‚ÄìScholesformula,268
lexicographical order, 47, 48
likelihood quotient test, 415
liquid option, 322
local martingale, 352
local risk process, 374
locally convex space, 429
locally risk-minimizing strategy, 374
locally riskless bond, 225
log-normal distribution, 82, 261
lookback call, 252
lookback option, 235, 258
lookback put, 252
loss function, 212, 340
lottery, 44, 51
variance of, 81
lower quantile function, 408
lower Snell envelope, 301, 317

Index
455
m-stable sets, 300
market clearing condition, 137
market portfolio, 137
Markov property, 326
martingale, 33, 228
convergence theorem, 74
local, 352
of successive densities, 229, 298
reverse, 74
strongly orthogonal, 375
martingale measure, 6, 33, 229
as extension of a pricing rule, 325
minimal, 382
martingalerepresentationproperty,246
maturity of a contingent claim, 234
mean self-Ô¨Ånancing strategy, 374
mean-preserving spread, 80, 105, 106
mean-variance trade-off process, 377,
394
measure
absolutely continuous, 403
entropy of, 120
equivalent, 403
simple, 420, 423
support of, 28
measure of risk
cash invariant, 153
coherent, 155, 320
comonotonic, 196
continuous from above, 166, 172
continuous from below, 167
convex, 154
in Ô¨Ånancial market, 203, 340, 370
monetary, 153
monotone, 153
normalized, 154
penalty function for, 161
positive homogeneous, 155
relevant, 174
representation theorem, 161
sensitive, 173, 371
subadditive, 155
translation invariant, 153
metric space, 418
minimal martingale measure, 382
mixture space, 56
model uncertainty, 92
moment generating function, 116
monetary measure of risk, 153
monotone preference relation
on distributions, 61
on assets, 86
monotone set function, 191
negative transitive relation, 45
Neyman‚ÄìPearson lemma, 336, 414,
415
generalized, 415
non-redundance condition, 11, 351
normal distribution, 78, 82, 118, 120
normalized set function, 191
num√©raire, 9, 32, 225
change of, 227, 233
numerical representation, 46, 49
afÔ¨Åne, 51
of robust Savage form, 303
of Savage form, 86, 285
of von Neumann‚ÄìMorgenstern
form, 51, 57, 59, 61, 92
optimal stopping problem, 285
continuation region, 292
stopping region, 292
option
Black‚ÄìScholes price, 263
optional decomposition, 313
theorem, 310
under constraints, 360
optional sampling theorem, 283, 297
order dense set, 46
orthogonal decomposition
of a contingent claim, 379
out-of-the-money option, 22
paradox
Allais, 60, 88
Ellsberg, 88

456
Index
St. Petersburg, 63
partial order, 75
pasting of two probability measures,
299, 364
penalty function, 161
Poisson distribution, 22, 118
Polish space, 418
portfolio, 4
portfolio insurance, 16
portmanteau theorem, 420
positive afÔ¨Åne transformations, 52
power of a statistical test, 415, 416
predictable process, 224
predictablerepresentationproperty,246
predictably convex set, 350
preference order, 45
preference relation, 45
monotone, 61
asymmetry of, 45
continuous, 48
continuous from above, 99
continuous from below, 99
lexicographical, 47, 48
monotone, 86
negative transitivity of, 45
numerical representation of, 46,
49, 51, 57, 59, 61
random, 134
risk averse, 61
weak, 45
price density, 138
price system, 4
pricing measure, 6
probability measure
absolutely continuous, 403
equivalent, 403
Prohorov‚Äôs theorem, 421
for œà-weak topology, 424
proper convex function, 400, 430
œà-weak topology, 59, 100, 422
put option, 15
Asian, 234
European, 234, 263
universal bounds on price, 22
with barrier, 235
American, 290
put-call parity, 15
Q-martingale, 309
QS-Snell envelope
upper, 369
Q-submartingale, 309
Q-supermartingale, 309
quadratic risk
global, 393
local, 374
remaining, 393
quantile, 328
quantile function, 177, 408
and stochastic order, 76
fornon-additivesetfunctions,196
quantile hedging, 348
Radon‚ÄìNikodym
derivative, 403
theorem, 403
random walk, 254
randomized test, 337, 341, 416
reference portfolio, 39
reÔ¨Çection principle, 254
regular conditional distribution, 40, 78
relation
antisymmetric, 75
asymmetric, 45
complete, 45
equivalence, 45
indifference, 45
negative transitive, 45
reÔ¨Çexive, 75
transitive, 45, 75
relative entropy, 119, 213
relative interior of a convex set, 29
relative risk aversion, 68
relevant risk measure, 174
remaining conditional risk, 391
replicating
portfolio, 21

Index
457
strategy, 237
representation theorem for risk
measures, 161
on L‚àû, 172
reservation price, 136
return, 11
reverse convertible bond, 16
reverse martingale, 74
Rho of a call option, 269
right-continuous inverse, 406
risk aversion, 61, 75, 89, 109, 340
absolute, 67
relative, 68
risk measure, 320
cash invariant, 153
coherent, 155
comonotonic, 196
conditional, 306
continuous from above, 166, 172
continuous from below, 167, 213
convex, 154
dynamic, 306
dynamically consistent, 306
entropic, 174, 213
in Ô¨Ånancial market, 203, 340, 370
monetary, 153
monotone, 153
normalized, 154
penalty function for, 161
positive homogeneous, 155
relevant, 174
representation theorem, 161
sensitive, 173, 371
subadditive, 155
tight, 169
time-consistent, 306
translation invariant, 153
risk neutrality, 68
risk premium, 63
risk transfer, 17
risk-neutral measure, 6, 33
entropy-minimizing, 121, 132
robust Savage representation, 92, 98,
303
robust shortfall risk, 219
running maximum, 252, 254
Savage representation, 86, 285
robust, 92, 98, 303
second fundamental theorem of asset
pricing, 245
secondorderstochasticdominance,75,
103, 105
self-Ô¨Ånancing strategy, 225
in continuous time, 273
sensitive risk measure, 173, 371
separable metric space, 418
separating hyperplane theorem, 399
separation theorems, 429
set function
core of, 201
Ô¨Ånitely additive, 92, 161, 426
monotone, 191, 196
normalized, 191, 196
submodular, 160, 191, 201
2-alternating, 160, 191, 201
Sharpe ratio, 159
short sales, 5
constraints, 204, 351
shortfall, 212
shortfall risk, 212, 340
robust, 219
signiÔ¨Åcance level of a statistical test,
415, 416
simple measure, 420, 423
simple probability distribution, 53
size of a statistical test, 415
Snell envelope, 280, 285, 363
lower, 301
upper, 301, 309, 314, 315
upper QS-, 363
space of reference portfolios, 39
St. Petersburg paradox, 63
stability under pasting, 300
stable set of measures, 300, 364

458
Index
stable subspace of H2, 380
standard normal distribution, 78
statistical test, 415
randomized, 337, 341, 416
stochastic differential equation, 272
stochastic dominance, 84
Ô¨Årst order, 84, 106
second order, 75, 103, 134
stochastic kernel, 75, 89
stochastic order
concave, 82, 105
convex, 82, 325
monotone, 84, 106
stochastic process, 224
adapted, 224
predictable, 224
stop-loss contract, 67
stopping region, 292
stopping theorem, 283, 297
stopping time, 283
straddle, 15
strategy
L2-admissible, 374
locally risk-minimizing, 374
mean self-Ô¨Ånancing, 374
self-Ô¨Ånancing, 225
self-Ô¨Ånancing in continuous time,
273
stress test measures, 209
strike price, 14, 234
strong law of large numbers, 43, 72, 74
strong orthogonality, 375
submartingale, 278
local, 352
submodular set function, 160, 191, 201
substitution axiom, 52
success ratio, 337
success set, 335
superhedging, 20, 282
duality, 315, 319, 369
strategy, 313, 369
supermartingale, 278
local, 352
superreplication strategy, 313, 314
support of a measure, 28
supremum norm, 426
sure-thing principle, 59
systems theorem, 229
theorem
Doob‚Äôs systems theorem, 229
Dunford‚ÄìPettis, 432
Eberlein‚Äì≈†mulian, 432
Hahn‚ÄìBanach, 429
Halmos‚ÄìSavage, 37
James‚Äô, 432
Krein‚Äì≈†mulian, 431
Kreps‚ÄìYan, 37, 355
optional decomposition, 310
portmanteau, 420
Radon‚ÄìNikodym, 403
randomizedBolzano‚ÄìWeierstra√ü,
38
separating hyperplane, 399
separation, 429
stopping, 283, 297
superhedging duality, 315
optional sampling, 283
Theta of a call option, 268
tightness
of a set of measures, 421
of risk measure, 169
timeconsistencyofariskmeasure,306
time value, 22, 240
of a European call option, 240
topological space
connected, 49
Hausdorff, 48
topological vector space, 428
locally convex, 429
topology
weak, 430
weak‚àó, 430
total variation, 163, 426
trading strategy, 224
generalized, 372

Index
459
replicating, 237
self-Ô¨Ånancing, 225
L2-admissible, 374
transitive relation, 45
translation invariance, 153
2-alternatingsetfunction,160,191,201
type 2 error, 415
type 1 error, 415
uncertainty aversion, 90
Uniform Doob decomposition, 310
uniform Doob decomposition
under constraints, 360
universal arbitrage bounds, 22, 322
up-and-in call, 330
up-and-in option, 252, 257
Black‚ÄìScholes price of, 274
up-and-out call, 330, 332
up-and-out option, 235, 252, 258
upper QS-Snell envelope, 363
characterization of, 369
upper hedging price, 314
upper quantile function, 408
upper Snell envelope, 301, 309
characterization of, 315
optional decomposition of, 314
utility function, 62, 75, 109
CARA, 67, 73, 110, 116, 128, 132
CRRA, 68
decreasingly risk averse, 72
exponential,67,73,110,116,128,
132
HARA, 68, 110, 132
random, 134, 345
Value at Risk, 152, 159, 177, 178, 187,
330, 334
comonotonicity, 199
value process, 226
variance, 81
variance-optimal strategy, 393
vector lattice, 425
Vega of a call option, 269
volatility, 269, 272
von Neumann‚ÄìMorgenstern represen-
tation, 51, 57, 59, 61, 92
weak preference order, 45
weak topology
on a Banach space, 430
on a locally convex space, 430
weak topology for measures, 419
weak‚àótopology, 430
weakly compact set, 432
Wiener measure, 271
Wiener process, 271
worstconditionalexpectation,176,188
worst-case risk measure, 157
on L‚àû, 175, 180



