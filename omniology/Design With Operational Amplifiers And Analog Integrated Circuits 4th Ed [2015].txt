
DESIGN WITH OPERATIONAL AMPLIFIERS AND
ANALOG INTEGRATED CIRCUITS

This page intentionally left blank

DESIGN WITH OPERATIONAL
AMPLIFIERS AND ANALOG
INTEGRATED CIRCUITS
FOURTH EDITION
Sergio Franco
San Francisco State University

DESIGN WITH OPERATIONAL AMPLIFIERS AND ANALOG INTEGRATED CIRCUITS, FOURTH EDITION
Published by McGraw-Hill Education, 2 Penn Plaza, New York, NY 10121. Copyright ©2015 by
McGraw-Hill Education. All rights reserved. Printed in the United States of America. Previous
editions ©2002, 1998, and 1988. No part of this publication may be reproduced or distributed in
any form or by any means, or stored in a database or retrieval system, without the prior written
consent of McGraw-Hill Education, including, but not limited to, in any network or other electronic
storage or transmission, or broadcast for distance learning.
Some ancillaries, including electronic and print components, may not be available to customers
outside the United States.
This book is printed on acid-free paper.
1 2 3 4 5 6 7 8 9 0 DOC/DOC 1 0 9 8 7 6 5 4
ISBN 978-0-07-802816-8
MHID 0-07-802816-7
Senior Vice President, Products & Markets: Kurt L. Strand
Vice President, General Manager, Products & Markets: Marty Lange
Vice President, Content Production & Technology Services: Kimberly Meriwether David
Managing Director: Thomas Timp
Global Publisher: Raghu Srinivasan
Marketing Manager: Nick McFadden
Director, Content Production: Terri Schiesl
Lead Project Manager: Jane Mohr
Buyer: Laura Fuller
Cover Designer: Studio Montage, St. Louis, MO.
Compositor: MPS Limited
Typeface: 10.5/12 Times
Printer: R. R. Donnelley
All credits appearing on page or at the end of the book are considered to be an extension
of the copyright page.
Library of Congress Cataloging-in-Publication Data
Franco, Sergio.
Design with operational ampliﬁers and analog integrated circuits / Sergio
Franco, San Francisco State University. – Fourth edition.
pages cm. – (McGraw-Hill series in electrical and computer engineering)
ISBN 978-0-07-802816-8 (alk. paper)
1. Linear integrated circuits. 2. Operational ampliﬁers. I. Title.
TK7874.F677 2002
621.3815–dc23
2013036158
The Internet addresses listed in the text were accurate at the time of publication. The inclusion
of a website does not indicate an endorsement by the authors or McGraw-Hill Education,
and McGraw-Hill Education does not guarantee the accuracy of the information presented at
these sites.
www.mhhe.com

ABOUT THE AUTHOR
Sergio Franco was born in Friuli, Italy, and earned his Ph.D. from the Univer-
sity of Illinois at Urbana-Champaign. After working in industry, both in the United
States and Italy, he joined San Francisco State University in 1980, where he has
contributed to the formation of many hundreds of successful analog engineers gain-
fully employed in Silicon Valley. Dr. Franco is the author of the textbook Analog
Circuit Design—Discrete & Integrated, also by McGraw-Hill. More information can
be found in the author’s website at http://online.sfsu.edu/sfranco/.
v

This page intentionally left blank

CONTENTS
Preface
xi
1
Operational Ampliﬁer Fundamentals
1
1.1
Ampliﬁer Fundamentals
3
1.2
The Operational Ampliﬁer
6
1.3
Basic Op Amp Conﬁgurations
9
1.4
Ideal Op Amp Circuit Analysis
16
1.5
Negative Feedback
24
1.6
Feedback in Op Amp Circuits
30
1.7
The Return Ratio and Blackman’s Formula
38
1.8
Op Amp Powering
46
Problems
52
References
65
Appendix 1A
Standard Resistance Values
65
2
Circuits with Resistive Feedback
67
2.1
Current-to-Voltage Converters
68
2.2
Voltage-to-Current Converters
71
2.3
Current Ampliﬁers
79
2.4
Difference Ampliﬁers
80
2.5
Instrumentation Ampliﬁers
87
2.6
Instrumentation Applications
93
2.7
Transducer Bridge Ampliﬁers
99
Problems
105
References
113
3
Active Filters: Part I
114
3.1
The Transfer Function
118
3.2
First-Order Active Filters
123
3.3
Audio Filter Applications
130
3.4
Standard Second-Order Responses
135
3.5
KRC Filters
142
3.6
Multiple-Feedback Filters
149
3.7
State-Variable and Biquad Filters
154
3.8
Sensitivity
160
Problems
163
References
170
4
Active Filters: Part II
171
4.1
Filter Approximations
172
4.2
Cascade Design
178
4.3
Generalized Impedance Converters
185
vii

viii
Contents
4.4
Direct Design
191
4.5
The Switched Capacitor
197
4.6
Switched-Capacitor Filters
202
4.7
Universal SC Filters
208
Problems
214
References
220
5
Static Op Amp Limitations
221
5.1
Simpliﬁed Op Amp Circuit Diagrams
223
5.2
Input Bias and Offset Currents
229
5.3
Low-Input-Bias-Current Op Amps
234
5.4
Input Offset Voltage
238
5.5
Low-Input-Offset-Voltage Op Amps
243
5.6
Input Offset Error and Compensation Techniques
248
5.7
Input Voltage Range/Output Voltage Swing
253
5.8
Maximum Ratings
259
Problems
261
References
267
Appendix 5A
Data Sheets of the μA741 Op Amp
268
6
Dynamic Op Amp Limitations
277
6.1
Open-Loop Frequency Response
278
6.2
Closed-Loop Frequency Response
283
6.3
Input and Output Impedances
290
6.4
Transient Response
294
6.5
Effect of Finite GBP on Integrator Circuits
301
6.6
Effect of Finite GBP on Filters
310
6.7
Current-Feedback Ampliﬁers
315
Problems
324
References
331
7
Noise
333
7.1
Noise Properties
335
7.2
Noise Dynamics
340
7.3
Sources of Noise
344
7.4
Op Amp Noise
350
7.5
Noise in Photodiode Ampliﬁers
357
7.6
Low-Noise Op Amps
361
Problems
365
References
369
8
Stability
371
8.1
The Stability Problem
372
8.2
Phase and Gain Margin Measurements
382
8.3
Frequency Compensation of Op Amps
388
8.4
Op Amps Circuits with a Feedback Pole
400
8.5
Input-Lag and Feedback-Lead Compensation
409
8.6
Stability in CFA Circuits
414

ix
Contents
8.7
Composite Ampliﬁers
418
Problems
423
References
433
9
Nonlinear Circuits
434
9.1
Voltage Comparators
435
9.2
Comparator Applications
443
9.3
Schmitt Triggers
450
9.4
Precision Rectiﬁers
456
9.5
Analog Switches
462
9.6
Peak Detectors
467
9.7
Sample-and-Hold Ampliﬁers
471
Problems
477
References
482
10 Signal Generators
483
10.1
Sine Wave Generators
485
10.2
Multivibrators
491
10.3
Monolithic Timers
499
10.4
Triangular Wave Generators
505
10.5
Sawtooth Wave Generators
510
10.6
Monolithic Waveform Generators
512
10.7
V-F and F-V Converters
520
Problems
526
References
532
11 Voltage References and Regulators
534
11.1
Performance Speciﬁcations
536
11.2
Voltage References
541
11.3
Voltage-Reference Applications
548
11.4
Linear Regulators
553
11.5
Linear-Regulator Applications
558
11.6
Switching Regulators
566
11.7
The Error Ampliﬁer
574
11.8
Voltage Mode Control
577
11.9
Peak Current Mode Control
582
11.10 PCMC of Boost Converters
594
Problems
600
References
607
12 D-A and A-D Converters
608
12.1
Performance Speciﬁcations
610
12.2
D-A Conversion Techniques
616
12.3
Multiplying DAC Applications
629
12.4
A-D Conversion Techniques
634
12.5
Oversampling Converters
644
Problems
652
References
655

x
Contents
13 Nonlinear Ampliﬁers and Phase-Locked Loops
657
13.1
Log/Antilog Ampliﬁers
658
13.2
Analog Multipliers
665
13.3
Operational Transconductance Ampliﬁers
670
13.4
Phase-Locked Loops
678
13.5
Monolithic PLLS
686
Problems
693
References
696
Index
699

PREFACE
During the last decades much has been prophesized that there will be little need
for analog circuitry in the future because digital electronics is taking over. Far from
having proven true, this contention has provoked controversial rebuttals, as epito-
mized by statements such as “If you cannot do it in digital, it’s got to be done in
analog.” Add to this the common misconception that analog design, compared to
digital design, seems to be more of a whimsical art than a systematic science, and
what is the confused student to make of this controversy? Is it worth pursuing some
coursework in analog electronics, or is it better to focus just on digital?
There is no doubt that many functions that were traditionally the domain of
analog electronics are nowadays implemented in digital form, a popular example
being offered by digital audio. Here, the analog signals produced by microphones
and other acoustic transducers are suitably conditioned by means of ampliﬁers and
ﬁlters, and are then converted to digital form for further processing, such as mixing,
editing, and the creation of special effects, as well as for the more mundane but no less
important tasks of transmission, storage, and retrieval. Finally, digital information is
converted back to analog signals for playing through loudspeakers. One of the main
reasons why it is desirable to perform as many functions as possible digitally is the
generally superior reliability and ﬂexibility of digital circuitry. However, the physical
world is inherently analog, indicating that there will always be a need for analog
circuitry to condition physical signals such as those associated with transducers, as
well as to convert information from analog to digital for processing, and from digital
back to analog for reuse in the physical world. Moreover, new applications continue
to emerge, where considerations of speed and power make it more advantageous to
use analog front ends; wireless communications provide a good example.
Indeed many applications today are best addressed by mixed-mode integrated
circuits (mixed-mode ICs) and systems, which rely on analog circuitry to interface
with the physical world, and digital circuitry for processing and control. Even though
the analog circuitry may constitute only a small portion of the total chip area, it is
often the most challenging part to design as well as the limiting factor on the perfor-
mance of the entire system. In this respect, it is usually the analog designer who is
called to devise ingenious solutions to the task of realizing analog functions in decid-
edly digital technologies; switched-capacitor techniques in ﬁltering and sigma-delta
techniques in data conversion are popular examples. In light of the above, the need
for competent analog designers will continue to remain very strong. Even purely
digital circuits, when pushed to their operational limits, exhibit analog behavior.
Consequently, a solid grasp of analog design principles and techniques is a valuable
asset in the design of any IC, not just purely digital or purely analog ICs.
THE BOOK
The goal of this book is the illustration of general analog principles and design
methodologies using practical devices and applications. The book is intended as a
xi

xii
Preface
textbook for undergraduate and graduate courses in design and applications with
analog integrated circuits (analog ICs), as well as a reference book for practicing
engineers. The reader is expected to have had an introductory course in electronics,
to be conversant in frequency-domain analysis techniques, and to possess basic skills
in the use of SPICE. Though the book contains enough material for a two-semester
course, it can also serve as the basis for a one-semester course after suitable selection
of topics. The selection process is facilitated by the fact that the book as well as its
individual chapters have generally been designed to proceed from the elementary to
the complex.
At San Francisco State University we have been using the book for a sequence of
two one-semester courses, one at the senior and the other at the graduate level. In the
senior course we cover Chapters 1–3, Chapters 5 and 6, and most of Chapters 9 and
10; in the graduate course we cover all the rest. The senior course is taken concur-
rently with a course in analog IC fabrication and design. For an effective utilization
of analog ICs, it is important that the user be cognizant of their internal workings,
at least qualitatively. To serve this need, the book provides intuitive explanations of
the technological and circuital factors intervening in a design decision.
NEW TO THE FOURTH EDITION
The key features of the new edition are: (a) a complete revision of negative feedback,
(b) much enhanced treatment of op amp dynamics and frequency compensation,
(c) expanded coverage of switching regulators, (d) a more balanced presentation of
bipolar and CMOS technologies, (e) a substantial increase of in-text PSpice usage,
and (f) redesigned examples and about 25% new end-of-chapter problems to reﬂect
the revisions.
While previous editions addressed negative feedback from the specialized view-
point of the op amp user, the fourth edition offers a much broader perspective that will
prove useful also in other areas like switching regulators and phase-locked loops. The
new edition presents both two-port analysis and return-ratio analysis, emphasizing
similarities but also differences, in an attempt at dispelling the persisting confusion
between the two (to keep the distinction, the loop gain and the feedback factor are
denoted as L and b in two-port analysis, and as T and β in return-ratio analysis).
Of necessity, the feedback revision is accompanied by an extensive rewriting of
op amp dynamics and frequency compensation. In this connection, the fourth edition
makes generous use of the voltage/current injection techniques pioneered by R. D.
Middlebrook for loop-gain measurements.
In view of the importance of portable-power management in today’s analog
electronics, this edition offers an expanded coverage of switching regulators. Much
greater attention is devoted to current control and slope compensation, along with
stability issues such as the effect of the right-half plane zero and error-ampliﬁer
design.
The book makes abundant use of SPICE (schematic capture instead of the netlists
of the previous editions), both to verify calculations and to investigate higher-order
effects that would be too complex for paper and pencil analysis. SPICE is nowa-
days available in a variety of versions undergoing constant revision, so rather than
committing to a particular version, I have decided to keep the examples simple

xiii
Preface
enough for students to quickly redraw them and run them in the SPICE version of
their choice.
As in the previous editions, the presentation is enhanced by carefully thought-
out examples and end-of-chapter problems emphasizing intuition, physical insight,
and problem-solving methodologies of the type engineers exercise daily on the job.
The desire to address general and lasting principles in a manner that transcends
the latest technological trend has motivated the choice of well-established and widely
documented devices as vehicles. However, when necessary, students are made aware
of more recent alternatives, which they are encouraged to look up online.
THE CONTENTS AT A GLANCE
Although not explicitly indicated, the book consists of three parts. The ﬁrst part
(Chapters 1–4) introduces fundamental concepts and applications based on the op
amp as a predominantly ideal device. It is felt that the student needs to develop
sufﬁcient conﬁdence with ideal (or near-ideal) op amp situations before tackling
and assessing the consequences of practical device limitations. Limitations are the
subject of the second part (Chapters 5–8), which covers the topic in more systematic
detail than previous editions. Finally, the third part (Chapters 9–13) exploits the
maturity and judgment developed by the reader in the ﬁrst two parts to address
a variety of design-oriented applications. Following is a brief chapter-by-chapter
description of the material covered.
Chapter 1 reviews basic ampliﬁer concepts, including negative feedback. Much
emphasis is placed on the loop gain as a gauge of circuit performance. The loop
gain is treated via both two-port analysis and return-ratio analysis, with due atten-
tion to similarities as well as differences between the two approaches. The student
is introduced to simple PSpice models, which will become more sophisticated as
we progress through the book. Those instructors who ﬁnd the loop-gain treatment
overwhelming this early in the book may skip it and return to it at a more suitable
time. Coverage rearrangements of this sort are facilitated by the fact that individual
sections and chapters have been designed to be as independent as possible from each
other; moreover, the end-of-chapter problems are grouped by section.
Chapter 2 deals with I-V , V -I, and I-I converters, along with various instru-
mentation and transducer ampliﬁers. The chapter places much emphasis on feedback
topologies and the role of the loop gain T .
Chapter 3 covers ﬁrst-order ﬁlters, audio ﬁlters, and popular second-order ﬁlters
such as the KRC, multiple-feedback, state-variable, and biquad topologies. The
chapter emphasizes complex-plane systems concepts and concludes with ﬁlter
sensitivities.
The reader who wants to go deeper into the subject of ﬁlters will ﬁnd Chapter 4
useful. This chapter covers higher-order ﬁlter synthesis using both the cascade and
the direct approaches. Moreover, these approaches are presented for both the case
of active RC ﬁlters and the case of switched-capacitor (SC) ﬁlters.
Chapter 5 addresses input-referrable op amp errors such as VOS, IB, IOS, CMRR,
PSRR, and drift, along with operating limits. The student is introduced to data-
sheet interpretation, PSpice macromodels, and also to different technologies and
topologies.

xiv
Preface
Chapter6addressesdynamiclimitationsinboththefrequencyandtimedomains,
and investigates their effect on the resistive circuits and the ﬁlters that were studied
in the ﬁrst part using mainly ideal op amp models. Voltage feedback and current
feedback are compared in detail, and PSpice is used extensively to visualize both
the frequency and transient responses of representative circuit examples. Having
mastered the material of the ﬁrst four chapters using ideal or nearly ideal op amps,
the student is now in a better position to appreciate and evaluate the consequences
of practical device limitations.
The subject of ac noise, covered in Chapter 7, follows naturally since it combines
the principles learned in both Chapters 5 and 6. Noise calculations and estimation
represent another area in which PSpice proves a most useful tool.
The second part concludes with the subject of stability in Chapter 8. The en-
hancedcoverageofnegativefeedbackhasrequiredanextensiverevisionoffrequency
compensation, both internal and external to the op amp. The fourth edition makes
generous use of the voltage/current injection techniques pioneered by R. D. Middle-
brook for loop-gain measurements. Again, PSpice is used profusely to visualize the
effect of the different frequency-compensation techniques presented.
The third part begins with nonlinear applications, which are discussed in
Chapter 9. Here, nonlinear behavior stems from either the lack of feedback (voltage
comparators), or the presence of feedback, but of the positive type (Schmitt triggers),
or the presence of negative feedback, but using nonlinear elements such as diodes
and switches (precision rectiﬁers, peak detectors, track-and-hold ampliﬁers).
Chapter 10 covers signal generators, including Wien-bridge and quadrature
oscillators, multivibrators, timers, function generators, and V -F and F-V converters.
Chapter 11 addresses regulation. It starts with voltage references, proceeds to
linear voltage regulators, and concludes with a much-expanded coverage of switch-
ing regulators. Great attention is devoted to current control and slope compensation,
along with stability issues such as error-ampliﬁer design and the effect of the right-
half plane zero in boost converters.
Chapter 12 deals with data conversion. Data-converter speciﬁcations are treated
in systematic fashion, and various applications with multiplying DACs are presented.
The chapter concludes with oversampling-conversion principles and sigma-delta
converters. Much has been written about this subject, so this chapter of necessity
exposes the student only to the fundamentals.
Chapter 13 concludes the book with a variety of nonlinear circuits, such as
log/antilog ampliﬁers, analog multipliers, and operational transconductance ampli-
ﬁers with a brief exposure to gm-C ﬁlters. The chapter culminates with an introduc-
tion to phase-locked loops, a subject that combines important materials addressed
at various points in the preceding chapters.
WEBSITE
The book is accompanied by a Website (http://www.mhhe.com/franco) containing
information about the book and a collection of useful resources for the instructor.
Among the Instructor Resources are a Solutions Manual, a set of PowerPoint Lecture
Slides, and a link to the Errata.

xv
Preface
This
text
is
available
as
an
eBook
at
www.CourseSmart.com. At CourseSmart you
can take advantage of signiﬁcant savings off
the cost of a print textbook, reduce their impact on the environment, and gain access
to powerful web tools for learning. CourseSmart eBooks can be viewed online or
downloaded to a computer. The eBooks allow readers to do full text searches, add
highlighting and notes, and share notes with others. CourseSmart has the largest
selection of eBooks available anywhere. Visit www.CourseSmart.com to learn more
and to try a sample chapter.
ACKNOWLEDGMENTS
Some of the changes in the fourth edition were made in response to feedback received
from a number of readers in both industry and academia, and I am grateful to all who
took the time to e-mail me. In addition, the following reviewers provided detailed
commentaries on the previous edition as well as valuable suggestions for the current
revision. All suggestions have been examined in detail, and if only a portion of them
has been honored, it was not out of callousness, but because of production constraints
or personal philosophy. To all reviewers, my sincere thanks: Aydin Karsilayan, Texas
A&M University; Paul T. Kolen, San Diego State University; Jih-Sheng (Jason) Lai,
Virginia Tech; Andrew Rusek, Oakland University; Ashok Srivastava, Louisiana
State University; S. Yuvarajan, North Dakota State University.
Iremaingratefultothereviewersofthepreviouseditions:StanleyG.Burns,Iowa
State University; Michael M. Cirovic, California Polytechnic State University-San
Luis Obispo; J. Alvin Connelly, Georgia Institute of Technology; William J. Eccles,
Rose-Hulman Institute of Technology; Amir Farhat, Northeastern University; Ward
J. Helms, University of Washington; Frank H. Hielscher, Lehigh University; Richard
C. Jaeger, Auburn University; Franco Maddaleno, Politecnico di Torino,
Italy; Dragan Maksimovic, University of Colorado-Boulder; Philip C. Munro,
Youngstown State University; Thomas G.Owen, University of North Carolina-
Charlotte; Dr. Guillermo Rico, New Mexico State University; Mahmoud F. Wagdy,
California State University-Long Beach; Arthur B. Williams, Coherent Communica-
tions Systems Corporation; and Subbaraya Yuvarajan, North Dakota State
University. Finally, I wish to express my gratitude to Diana May, my wife, for
her encouragement and steadfast support.
Sergio Franco
San Francisco, California, 2014

This page intentionally left blank

1
OPERATIONAL AMPLIFIER
FUNDAMENTALS
1.1 Ampliﬁer Fundamentals
1.2 The Operational Ampliﬁer
1.3 Basic Op Amp Conﬁgurations
1.4 Ideal Op Amp Circuit Analysis
1.5 Negative Feedback
1.6 Feedback in Op Amp Circuits
1.7 The Return Ratio and Blackman’s Formula
1.8 Op Amp Powering
Problems
References
Appendix 1A Standard Resistance Values
The term operational ampliﬁer, or op amp for short, was coined in 1947 by John R.
Ragazzini to denote a special type of ampliﬁer that, by proper selection of its external
components, could be conﬁgured for a variety of operations such as ampliﬁcation,
addition, subtraction, differentiation, and integration. The ﬁrst applications of op
amps were in analog computers. The ability to perform mathematical operations
was the result of combining high gain with negative feedback.
Early op amps were implemented with vacuum tubes, so they were bulky, power-
hungry, and expensive. The ﬁrst dramatic miniaturization of the op amp came with
the advent of the bipolar junction transistor (BJT), which led to a whole generation
of op amp modules implemented with discrete BJTs. However, the real breakthrough
occurred with the development of the integrated circuit (IC) op amp, whose elements
are fabricated in monolithic form on a silicon chip the size of a pinhead. The ﬁrst such
device was developed by Robert J. Widlar at Fairchild Semiconductor Corporation
in the early 1960s. In 1968 Fairchild introduced the op amp that was to become the
industry standard, the popular μA741. Since then the number of op amp families and
manufacturers has swollen considerably. Nevertheless, the 741 is undoubtedly the
1

2
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
most widely documented op amp. Building blocks pioneered by the 741 continue to
be in widespread use today, and current literature still refers to classic 741 articles,
so it pays to study this device both from a historical perspective and a pedagogical
standpoint.
Op amps have made lasting inroads into virtually every area of analog and mixed
analog-digital electronics.1 Such widespread use has been aided by dramatic price
drops. Today, the cost of an op amp that is purchased in volume quantities can be
comparable to that of more traditional and less sophisticated components such as
trimmers, quality capacitors, and precision resistors. In fact, the prevailing attitude is
to regard the op amp as just another component, a viewpoint that has had a profound
impact on the way we think of analog circuits and design them today.
The internal circuit diagram of the 741 op amp is shown in Fig. 5A.2 of the
Appendix at the end of Chapter 5. The circuit may be intimidating, especially if you
haven’t been exposed to BJTs in sufﬁcient depth. Be reassured, however, that it is
possible to design a great number of op amp circuits without a detailed knowledge of
the op amp’s inner workings. Indeed, in spite of its internal complexity, the op amp
lends itself to a black-box representation with a very simple relationship between
output and input. We shall see that this simpliﬁed schematization is adequate for a
great variety of situations. When it is not, we shall turn to the data sheets and predict
circuit performance from speciﬁed data, again avoiding a detailed consideration of
the inner workings.
To promote their products, op amp manufacturers maintain applications de-
partments with the purpose of identifying areas of application for their products
and publicizing them by means of application notes and articles in trade mag-
azines. Nowadays much of this information is available on the web, which you
are encouraged to browse in your spare time to familiarize yourself with analog-
products data sheets and application notes. You can even sign up for online seminars,
or “webinars.”
This study of op amp principles should be corroborated by practical experimen-
tation. You can either assemble your circuits on a protoboard and try them out in
the lab, or you can simulate them with a personal computer using any of the various
CAD/CAE packages available, such as SPICE. For best results, you may wish to
do both.
Chapter Highlights
After reviewing basic ampliﬁer concepts, the chapter introduces the op amp and
presents analytical techniques suitable for investigating a variety of basic op amp
circuits such as inverting/non-inverting ampliﬁers, buffers, summing/difference am-
pliﬁers, differentiators/integrators, and negative-resistance converters.
Central to the operation of op amp circuits is the concept of negative feed-
back, which is investigated next. Both two-port analysis and return-ratio analysis
are presented, and with a concerted effort at dispelling notorious confusion between
the two approaches. (To differentiate between the two, the loop gain and the feed-
back factor are denoted as L and b in the two-port approach, and as T and β in
the return-ratio approach). The beneﬁts of negative feedback are illustrated with a
generous amount of examples and SPICE simulations.

3
SECTION 1.1
Ampliﬁer
Fundamentals
The chapter concludes with practical considerations such as op amp power-
ing, internal power dissipation, and output saturation. (Practical limitations will be
taken up again and in far greater detail in Chapters 5 and 6.) The chapter makes
abundant use of SPICE, both as a validation tool for hand calculations, and as a ped-
agogical tool to confer more immediacy to concepts and principles as they are ﬁrst
introduced.
1.1
AMPLIFIER FUNDAMENTALS
Before embarking on the study of the operational ampliﬁer, it is worth reviewing
the fundamental concepts of ampliﬁcation and loading. Recall that an ampliﬁer is a
two-port device that accepts an externally applied signal, called input, and generates
a signal called output such that output = gain × input, where gain is a suitable
proportionality constant. A device conforming to this deﬁnition is called a linear
ampliﬁer to distinguish it from devices with nonlinear input-output relationships,
such as quadratic and log/antilog ampliﬁers. Unless stated to the contrary, the term
ampliﬁer will here signify linear ampliﬁer.
An ampliﬁer receives its input from a source upstream and delivers its output
to a load downstream. Depending on the nature of the input and output signals, we
have different ampliﬁer types. The most common is the voltage ampliﬁer, whose
input vI and output vO are voltages. Each port of the ampliﬁer can be modeled with
a Th´evenin equivalent, consisting of a voltage source and a series resistance. The
input port usually plays a purely passive role, so we model it with just a resistance
Ri, called the input resistance of the ampliﬁer. The output port is modeled with
a voltage-controlled voltage source (VCVS) to signify the dependence of vO on
vI , along with a series resistance Ro called the output resistance. The situation is
depicted in Fig. 1.1, where Aoc is called the voltage gain factor and is expressed in
volts per volt. Note that the input source is also modeled with a Th´evenin equivalent
consisting of the source vS and an internal series resistance Rs; the output load,
playing a passive role, is modeled with a mere resistance RL.
We now wish to derive an expression for vO in terms of vS. Applying the voltage
divider formula at the output port yields
vO =
RL
Ro + RL
AocvI
(1.1)
RL
Ro
Rs
Ri
AocvI
Source
Voltage amplifier
Load
+
+
vS
+
–
vO
+
–
vI
FIGURE 1.1
Voltage ampliﬁer.

4
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
We note that in the absence of any load (RL = ∞) we would have vO = AocvI .
Hence, Aoc is called the unloaded,oropen-circuit,voltagegain.Applyingthevoltage
divider formula at the input port yields
vI =
Ri
Rs + Ri
vS
(1.2)
Eliminating vI and rearranging, we obtain the source-to-load gain,
vO
vS
=
Ri
Rs + Ri
Aoc
RL
Ro + RL
(1.3)
As the signal progresses from source to load, it undergoes ﬁrst some attenuation at
the input port, then magniﬁcation by Aoc inside the ampliﬁer, and ﬁnally additional
attenuation at the output port. These attenuations are referred to as loading. It is
apparent that because of loading, Eq. (1.3) gives |vO/vS| ≤|Aoc|.
EXAMPLE 1.1.
(a) An ampliﬁer with Ri = 100 k, Aoc = 100 V/V, and Ro = 1  is
driven by a source with Rs = 25 k and drives a load RL = 3 . Calculate the overall
gain as well as the amount of input and output loading. (b) Repeat, but for a source with
Rs = 50 k and a load RL = 4 . Compare.
Solution.
(a) By Eq. (1.3), the overall gain is vO/vS = [100/(25 + 100)] × 100 × 3/(1 + 3) =
0.80 × 100 × 0.75 = 60 V/V, which is less than 100 V/V because of loading.
Input loading causes the source voltage to drop to 80% of its unloaded value; output
loading introduces an additional drop to 75%.
(b) By the same equation, vO/vS = 0.67×100×0.80 = 53.3 V/V. We now have more
loading at the input but less loading at the output. Moreover, the overall gain has
changed from 60 V/V to 53.3 V/V.
Loading is generally undesirable because it makes the overall gain dependent
on the particular input source and output load, not to mention gain reduction. The
origin of loading is obvious: when the ampliﬁer is connected to the input source,
Ri draws current and causes Rs to drop some voltage. It is precisely this drop that,
once subtracted from vS, leads to a reduced voltage vI . Likewise, at the output port
the magnitude of vO is less than the dependent-source voltage AocvI because of the
voltage drop across Ro.
If loading could be eliminated altogether, we would have vO/vS = Aoc regard-
less of the input source and the output load. To achieve this condition, the voltage
drops across Rs and Ro must be zero regardless of Rs and RL. The only way to
achieve this is by requiring that our voltage ampliﬁer have Ri = ∞and Ro = 0. For
obvious reasons such an ampliﬁer is termed ideal. Though these conditions cannot
be met in practice, an ampliﬁer designer will strive to approximate them as closely
as possible by ensuring that Ri ≫Rs and Ro ≪RL for all input sources and output
loads that the ampliﬁer is likely to be connected to.
Another popular ampliﬁer is the current ampliﬁer. Since we are now dealing
with currents, we model the input source and the ampliﬁer with Norton equivalents,
as in Fig. 1.2. The parameter Asc of the current-controlled current source (CCCS)

5
SECTION 1.1
Ampliﬁer
Fundamentals
RL
iS
Rs
iI
Ri
AsciI
Ro
Source
Current amplifier
Load
iO
FIGURE 1.2
Current ampliﬁer.
is called the unloaded, or short-circuit, current gain. Applying the current divider
formula twice yields the source-to-load gain,
iO
iS
=
Rs
Rs + Ri
Asc
Ro
Ro + RL
(1.4)
We again witness loading both at the input port, where part of iS is lost through Rs,
making iI less than iS, and at the output port, where part of AsciI is lost through
Ro. Consequently, we always have |iO/iS| ≤|Asc|. To eliminate loading, an ideal
current ampliﬁer has Ri = 0 and Ro = ∞, exactly the opposite of the ideal voltage
ampliﬁer.
An ampliﬁer whose input is a voltage vI and whose output is a current iO
is called a transconductance ampliﬁer because its gain is in amperes per volt, the
dimensions of conductance. The situation at the input port is the same as that of
the voltage ampliﬁer of Fig. 1.1; the situation at the output port is similar to that of
the current ampliﬁer of Fig. 1.2, except that the dependent source is now a voltage-
controlled current source (VCCS) of value AgvI , with Ag in amperes per volt. To
avoid loading, an ideal transconductance ampliﬁer has Ri = ∞and Ro = ∞.
Finally, an ampliﬁer whose input is a current iI and whose output is a voltage
vO is called a transresistance ampliﬁer, and its gain is in volts per ampere. The input
port appears as in Fig. 1.2, and the output port as in Fig. 1.1, except that we now
have a current-controlled voltage source (CCVS) of value AriI , with Ar in volts
per ampere. Ideally, such an ampliﬁer has Ri = 0 and Ro = 0, the opposite of the
transconductance ampliﬁer.
The four basic ampliﬁer types, along with their ideal input and output resis-
tances, are summarized in Table 1.1.
TABLE 1.1
Basic ampliﬁers and their ideal terminal resistances
Input
Output
Ampliﬁer type
Gain
Ri
Ro
vI
vO
Voltage
V/V
∞
0
iI
iO
Current
A/A
0
∞
vI
iO
Transconductance
A/V
∞
∞
iI
vO
Transresistance
V/A
0
0

6
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
1.2
THE OPERATIONAL AMPLIFIER
The operational ampliﬁer is a voltage ampliﬁer with extremely high gain. For exam-
ple, the popular 741 op amp has a typical gain of 200,000 V/V, also expressed
as 200 V/mV. Gain is also expressed in decibels (dB) as 20 log10 200,000 =
106 dB. The OP77, a more recent type, has a gain of 12 million, or 12 V/μV,
or 20 log10(12 × 106) = 141.6 dB. In fact, what distinguishes op amps from all
other voltage ampliﬁers is the size of their gain. In the next sections we shall see
that the higher the gain the better, or that an op amp would ideally have an inﬁnitely
large gain. Why one would want gain to be extremely large, let alone inﬁnite, will
become clearer as soon as we start analyzing our ﬁrst op amp circuits.
Figure 1.3a shows the symbol of the op amp and the power-supply connections
to make it work. The inputs, identiﬁed by the “−” and “+” symbols, are designated
inverting and noninverting. Their voltages with respect to ground are denoted vN
and vP, and the output voltage as vO. The arrowhead signiﬁes signal ﬂow from the
inputs to the output.
Op amps do not have a 0-V ground terminal. Ground reference is established
externally by the power-supply common. The supply voltages are denoted VCC and
VE E in the case of bipolar devices, and VDD and VSS in the case of CMOS devices.
The typical dual-supply values of ±15 V of the 741 days have been gradually reduced
by over a decade, to the point that nowadays supplies of ±1.25 V, or +1.25 V and
0 V, are not uncommon, especially in portable equipment. As we proceed, we shall
use a variety of power-supply values, keeping in mind that most principles and
applications you are about to learn are not critically dependent on the particular
supplies in use. To minimize cluttering in circuit diagrams, it is customary not to
show the power-supply connections. However, when we try out an op amp in the
lab, we must remember to apply power to make it function.
Figure 1.3b shows the equivalent circuit of a properly powered op amp. Though
the op amp itself does not have a ground pin, the ground symbol inside its equivalent
circuitmodelsthepower-supplycommonofFig.1.3a.Theequivalentcircuitincludes
the differential input resistance rd, the voltage gain a, and the output resistance ro.
For reasons that will become clear in the next sections, rd, a, and ro are referred to
ro
vN
vP
vO
vO
vN
VCC
VEE
vP
+
–
+
rd
+
–
vD
avD
+
–
(a)
(b)
+
+
FIGURE 1.3
(a) Op amp symbol and power-supply connections. (b) Equiva-
lent circuit of a powered op amp. (The 741 op amp has typically
rd = 2 M, a = 200 V/mV, and ro = 75 .)

7
SECTION 1.2
The Operational
Ampliﬁer
as open-loop parameters and are symbolized by lowercase letters. The difference
vD = vP −vN
(1.5)
is called the differential input voltage, and gain a is also called the unloaded gain
because in the absence of output loading we have
vO = avD = a(vP −vN)
(1.6)
Since both input terminals are allowed to attain independent potentials with respect
to ground, the input port is said to be of the double-ended type. Contrast this with the
output port, which is of the single-ended type. Equation (1.6) indicates that the op
amp responds only to the difference between its input voltages, not to their individual
values. Consequently, op amps are also called difference ampliﬁers.
Reversing Eq. (1.6), we obtain
vD = vO
a
(1.7)
which allows us to ﬁnd the voltage vD causing a given vO. We again observe that
this equation yields only the difference vD, not the values of vN and vP themselves.
Because of the large gain a in the denominator, vD is bound to be very small. For
instance, to sustain vO = 6 V, an unloaded 741 op amp needs vD = 6/200,000 =
30 μV, quite a small voltage. An unloaded OP77 would need vD = 6/(12 × 106) =
0.5 μV, an even smaller value!
The Ideal Op Amp
We know that to minimize loading, a well-designed voltage ampliﬁer must draw
negligible (ideally zero) current from the input source and must present negligible
(ideally zero) resistance to the output load. Op amps are no exception, so we deﬁne
the ideal op amp as an ideal voltage ampliﬁer with inﬁnite open-loop gain:
a →∞
(1.8a)
Its ideal terminal conditions are
rd = ∞
(1.8b)
ro = 0
(1.8c)
iP = iN = 0
(1.8d)
where iP and iN are the currents drawn by the noninverting and inverting inputs.
The ideal op amp model is shown in Fig. 1.4.
We observe that in the limit a →∞, we obtain vD →vO/∞→0! This result is
often a source of puzzlement because it makes one wonder how an ampliﬁer with zero
input can sustain a nonzero output. Shouldn’t the output also be zero by Eq. (1.6)?
The answer lies in the fact that as gain a approaches inﬁnity, vD does indeed approach
zero, but in such a way as to maintain the product avD nonzero and equal to vO.
Real-life op amps depart somewhat from the ideal, so the model of Fig. 1.4 is
only a conceptualization. But during our initiation into the realm of op amp circuits,
we shall use this model because it relieves us from worrying about loading effects

8
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
+
–
+
vD
vN
vO
vP
avD
∞
a
iN = 0
iP = 0
FIGURE 1.4
Ideal op amp model.
so that we can concentrate on the role of the op amp itself. Once we have developed
enough understanding and conﬁdence, we shall backtrack and use the more realistic
model of Fig. 1.3b to assess the validity of our results. We shall ﬁnd that the results
obtained with the ideal and with the real-life models are in much closer agreement
than we might have suspected, corroborating the claim that the ideal model, though
a conceptualization, is not that academic after all.
SPICE Simulation
Circuit simulation by computer has become a powerful and indispensable tool in both
analysis and design. In this book we shall use SPICE, both to verify our calculations
and to investigate higher-order effects that would be too complex for paper-and-
pencil analysis. The reader is assumed to be conversant with the SPICE basics
covered in prerequisite courses. SPICE is available in a wide variety of versions
under continuous revision. Though the circuit examples of this book were created
using the Student Version of Cadence’s PSpice, the reader can easily redraw and
rerun them in the version of SPICE in his/her possession.
We begin with the basic model of Fig. 1.5, which reﬂects 741 data. The circuit
usesavoltage-controlledvoltagesource(VCVS)tomodelvoltagegain,andaresistor
pair to model the terminal resistances (by PSpice convention, the “+” input is shown
at the top and the “−” input at the bottom, just the opposite of op amp convention).
If a pseudo-ideal model is desired, then rd is left open, ro is shorted out, and
the source value is increased from 200 kV/V to some huge value, say, 1 GV/V.
(However, the reader is cautioned that too large a value may cause convergence
problems.)
ro
P
O
N
rd
2 MΩ
75 Ω
0
200 V/mV
EOA
+
–
+
–
FIGURE 1.5
BasicSPICEmodelofthe741opamp.

9
SECTION 1.3
Basic Op Amp
Conﬁgurations
1.3
BASIC OP AMP CONFIGURATIONS
By connecting external components around an op amp, we obtain what we shall
henceforthrefertoasan opampcircuit. Itiscrucialthatyouunderstandthedifference
between an op amp circuit and a plain op amp. Think of the latter as a component
of the former, just as the external components are. The most basic op amp circuits
are the inverting, noninverting, and buffer ampliﬁers.
The Noninverting Ampliﬁer
The circuit of Fig. 1.6a consists of an op amp and two external resistors. To under-
stand its function, we need to ﬁnd a relationship between vO and vI . To this end we
redraw it as in Fig. 1.6b, where the op amp has been replaced by its equivalent model
and the resistive network has been rearranged to emphasize its role in the circuit.
We can ﬁnd vO via Eq. (1.6); however, we must ﬁrst derive expressions for vP and
vN. By inspection,
vP = vI
(1.9)
Using the voltage divider formula yields vN = [R1/(R1 + R2)]vO, or
vN =
1
1 + R2/R1
vO
(1.10)
The voltage vN represents the fraction of vO that is being fed back to the invert-
ing input. Consequently, the function of the resistive network is to create negative
feedback around the op amp. Letting vO = a(vP −vN), we get
vO = a

vI −
1
1 + R2/R1
vO

(1.11)
+
–
+
–
+
+
+
R1
R2
R1
R2
vI
vI
vP
vN
vD
avD
vO
vO
(a)
(b)
Feedback
network
Amplifier
FIGURE 1.6
Noninverting ampliﬁer and circuit model for its analysis.

10
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
Collecting terms and solving for the ratio vO/vI , which we shall designate as A,
yields, after minor rearrangement,
A = vO
vI
=

1 + R2
R1

1
1 + (1 + R2/R1)/a
(1.12)
This result reveals that the circuit of Fig. 1.6a, consisting of an op amp plus a resistor
pair, is itself an ampliﬁer, and that its gain is A. Since A is positive, the polarity of
vO is the same as that of vI —hence the name noninverting ampliﬁer.
The gain A of the op amp circuit and the gain a of the basic op amp are quite
different. This is not surprising, as the two ampliﬁers, while sharing the same output
vO, have different inputs, namely, vI for the former and vD for the latter. To under-
score this difference, a is referred to as the open-loop gain, and A as the closed-loop
gain, the latter designation stemming from the fact that the op amp circuit contains a
loop. In fact, starting from the inverting input in Fig. 1.6b, we can trace a clockwise
loop through the op amp and then through the resistive network, which brings us
back to the starting point.
EXAMPLE 1.2.
In the circuit of Fig. 1.6a, let vI = 1 V, R1 = 2 k, and R2 = 18 k.
Find vO if (a) a = 102 V/V, (b) a = 104 V/V, (c) a = 106 V/V. Comment on your
ﬁndings.
Solution. Equation(1.12)givesvO/1 = (1 + 18/2)/(1 + 10/a),orvO = 10/(1 + 10/a).
So
(a) vO = 10/(1 + 10/102) = 9.091 V,
(b) vO = 9.990 V,
(c) vO = 9.9999 V.
The higher the gain a, the closer vO is to 10.0 V.
Ideal Noninverting Ampliﬁer Characteristics
Letting a →∞in Eq. (1.12) yields a closed-loop gain that we refer to as ideal:
Aideal = lim
a→∞A = 1 + R2
R1
(1.13)
In this limit A becomes independent of a, and its value is set exclusively by the
external resistance ratio, R2/R1. We can now appreciate the reason for wanting
a →∞. Indeed, a circuit whose closed-loop gain depends only on a resistance ratio
offers tremendous advantages for the designer since it makes it easy to tailor gain
to the application at hand. For instance, suppose you need an ampliﬁer with a gain
of 2 V/V. Then, by Eq. (1.13), pick R2/R1 = A −1 = 2 −1 = 1; for example,
pick R1 = R2 = 100 k. Do you want A = 10 V/V? Then pick R2/R1 = 9; for
example, R1 = 20 k and R2 = 180 k. Do you want an ampliﬁer with variable
gain? Then make R1 or R2 variable by means of a potentiometer (pot). For example,
if R1 is a ﬁxed 10-k resistor and R2 is a 100-k pot conﬁgured as a variable
resistance from 0  to 100 k, then Eq. (1.13) indicates that the gain can be varied
over the range 1 V/V ≤A ≤11 V/V. No wonder it is desirable that a →∞. It
leads to the simpler expression of Eq. (1.13), and it makes op amp circuit design a
real snap!

11
SECTION 1.3
Basic Op Amp
Conﬁgurations
Another advantage of Eq. (1.13) is that gain A can be made as accurate and stable
as needed by using resistors of suitable quality. Actually it is not even necessary that
the individual resistors be of high quality; it only sufﬁces that their ratio be so.
For example, using two resistances that track each other with temperature so as
to maintain a constant ratio will make gain A temperature-independent. Contrast
this with gain a, which depends on the characteristics of the resistors, diodes, and
transistors inside the op amp, and is therefore sensitive to thermal drift, aging,
and production variations. This is a prime example of one of the most fascinating
aspects of electronics, namely, the ability to implement high-performance circuits
using inferior components!
The advantages afforded by Eq. (1.13) do not come for free. The price is the size
of gain a needed to make this equation acceptable within a given degree of accuracy
(more on this will follow). It is often said that we are in effect throwing away a good
deal of open-loop gain for the sake of stabilizing the closed-loop gain. Considering
the beneﬁts, the price is well worth paying, especially with IC technology, which,
in mass production, makes it possible to achieve high open-loop gains at extremely
low cost.
Since the op amp circuit of Fig. 1.6 has proven to be an ampliﬁer itself, besides
gain A it must also present input and output resistances, which we shall designate
as Ri and Ro and call the closed-loop input and output resistances. You may have
noticed that to keep the distinction between the parameters of the basic op amp
and those of the op amp circuit, we are using lowercase letters for the former and
uppercase letters for the latter.
Though we shall have more to say about Ri and Ro from the viewpoint of neg-
ative feedback in Section 1.6, we presently use the simpliﬁed model of Fig. 1.6b
to state that Ri = ∞because the noninverting input terminal appears as an open
circuit, and Ro = 0 because the output comes directly from the source avD.
In summary,
Ri = ∞
Ro = 0
(1.14)
which, according to Table 1.1, represent the ideal terminal charactistics of a voltage
ampliﬁer. The equivalent circuit of the ideal noninverting ampliﬁer is shown in
Fig. 1.7.
⇒
+
R2
R1
1 +(
)vI
vO
+
–
R1
R2
vO
vI
vI
(a)
(b)
FIGURE 1.7
Noninverting ampliﬁer and its ideal equivalent circuit.

12
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
⇒
+
1vI
vO
+
–
vO
vI
vI
(a)
(b)
FIGURE 1.8
Voltage follower and its ideal equivalent circuit.
The Voltage Follower
Letting R1 = ∞and R2 = 0 in the noninverting ampliﬁer turns it into the unity-gain
ampliﬁer, or voltage follower, of Fig. 1.8a. Note that the circuit consists of the op amp
and a wire to feed the entire output back to the input. The closed-loop parameters
are
A = 1 V/V
Ri = ∞
Ro = 0
(1.15)
and the equivalent circuit is shown in Fig. 1.8b. As a voltage ampliﬁer, the follower
is not much of an achiever since its gain is only unity. Its specialty, however, is to
act as a resistance transformer, since looking into its input we see an open circuit,
but looking into its output we see a short circuit to a source of value vO = vI .
To appreciate this feature, consider a source vS whose voltage we wish to apply
across a load RL. If the source were ideal, all we would need would be a plain wire
to connect the two. However, if the source has nonzero output resistance Rs, as in
Fig. 1.9a, then Rs and RL will form a voltage divider and the magnitude of vL will
be less than that of vS because of the voltage drop across Rs. Let us now replace
the wire by a voltage follower as in Fig. 1.9b. Since the follower has Ri = ∞, there
is no loading at the input, so vI = vS. Moreover, since the follower has Ro = 0,
loading is absent also from the output, so vL = vI = vS, indicating that RL now
receives the full source voltage with no losses. The role of the follower is thus to act
as a buffer between source and load.
We also observe that now the source delivers no current and hence no power,
while in the circuit of Fig. 1.9a, it did. The current and power drawn by RL are
now supplied by the op amp, which in turn takes them from its power supplies,
+
–
Rs
RL
+
vS
vL
RL
vL
vI
Rs
+
vS
+
–
+
–
(a)
(b)
FIGURE 1.9
Source and load connected (a) directly, and (b) via a voltage follower to
eliminate loading.

13
SECTION 1.3
Basic Op Amp
Conﬁgurations
not explicitly shown in the ﬁgure. Thus, besides restoring vL to the full value of
vS, the follower relieves the source vS from supplying any power. The need for a
buffer arises so often in electronic design that special circuits are available whose
performance has been optimized for this function. The BUF03 is a popular example.
The Inverting Ampliﬁer
Together with the noninverting ampliﬁer, the inverting conﬁguration of Fig. 1.10a
constitutes a cornerstone of op amp applications. The inverting ampliﬁer was in-
vented before the noninverting ampliﬁer because in their early days op amps had only
one input, namely, the inverting one. Referring to the equivalent circuit of Fig. 1.10b,
we have
vP = 0
(1.16)
Applying
the
superposition
principle
yields
vN = [R2/(R1 + R2)]vI +
[R1/(R1 + R2)]vO, or
vN =
1
1 + R1/R2
vI +
1
1 + R2/R1
vO
(1.17)
Letting vO = a(vP −vN) yields
vO = a

−
1
1 + R1/R2
vI −
1
1 + R2/R1
vO

(1.18)
Comparing with Eq. (1.11), we observe that the resistive network still feeds the
portion 1/(1 + R2/R1) of vO back to the inverting input, thus providing the same
amount of negative feedback. Solving for the ratio vO/vI and rearranging, we obtain
A = vO
vI
=

−R2
R1

1
1 + (1 + R2/R1)/a
(1.19)
Our circuit is again an ampliﬁer. However, the gain A is now negative, indicating
that the polarity of vO will be opposite to that of vI . This is not surprising, because
we are now applying vI to the inverting side of the op amp. Hence, the circuit is
called an inverting ampliﬁer. If the input is a sine wave, the circuit will introduce a
phase reversal, or, equivalently, a 180◦phase shift.
+
–
R1
R2
vO
+
–
+
vP
vN
vD
avD
vO
(a)
(b)
R1
R2
+
vI
+
vI
FIGURE 1.10
Inverting ampliﬁer and circuit model for its analysis.

14
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
Ideal Inverting Ampliﬁer Characteristics
Letting a →∞in Eq. (1.19), we obtain
Aideal = lim
a→∞A = −R2
R1
(1.20)
That is, the closed-loop gain again depends only on an external resistance ratio,
yielding well-known advantages for the circuit designer. For instance, if we need
an ampliﬁer with a gain of −5 V/V, we pick two resistances in a 5:1 ratio, such as
R1 = 20 k and R2 = 100 k. If, on the other hand, R1 is a ﬁxed 20-k resistor
and R2 is a 100-k pot conﬁgured as a variable resistance, then the closed-loop gain
can be varied anywhere over the range −5 V/V ≤A ≤0. Note in particular that the
magnitude of A can now be controlled all the way down to zero.
We now turn to the task of determining the closed-loop input and output resis-
tances Ri and Ro. Since vD = vO/a is vanishingly small because of the large size
of a, it follows that vN is very close to vP, which is zero. In fact, in the limit a →∞,
vN would be zero exactly, and would be referred to as virtual ground because to an
outside observer, things appear as if the inverting input were permanently grounded.
We conclude that the effective resistance seen by the input source is just R1. More-
over, since the output comes directly from the source avD, we have Ro = 0. In
summary,
Ri = R1
Ro = 0
(1.21)
The equivalent circuit of the inverting ampliﬁer is shown in Fig. 1.11.
+
–
R1
vI
R2
vO
R1
vI
vO
(a)
(b)
+
R2
R1
–( )vI
⇒
FIGURE 1.11
Inverting ampliﬁer and its ideal equivalent circuit.
EXAMPLE 1.3.
(a) Using the basic 741 model of Fig. 1.4, direct PSpice to ﬁnd the
closed-loop parameters of an inverting ampliﬁer implemented with R1 = 1.0 k and
R2 = 100 k. Compare with the ideal case and comment. (b) What happens if you raise
a to 1 G V/V? Lower a to 1 kV/V?
Solution.
(a) After creating the circuit of Fig. 1.12, we direct PSpice to calculate the small-signal
gain (TF) from the input source V(I) to the output variable V(O). This yields
the following output ﬁle:
V(O)/V(I) = -9.995E+01
INPUT RESISTANCE AT V(I) = 1.001E+03
OUTPUT RESISTANCE AT V(O) = 3.787E-02

15
SECTION 1.3
Basic Op Amp
Conﬁgurations
ro
vO
R1
vI
P
I
O
N
rd
2 MΩ
1.0 kΩ
75 Ω
200 V/mV
EOA
+
–
+
–
+
–
0
R2
100 kΩ
0
0
FIGURE 1.12
SPICE circuit for Example 1.3.
It is apparent that the data are quite close to the ideal values A = −100 V/V,
Ri = 1.0 k, and Ro →0.
(b) Rerunning PSpice after increasing the dependent-source gain from 200 kV/V to
1 G V/V we ﬁnd that A and Ri match the ideal values (within PSpice’s resolution)
and Ro drops to micro-ohms, which is very close to 0. Lowering the gain to 1 kV/V
gives A = −90.82 V/V, Ri = 1.100 k, and Ro = 6.883 , indicating a more
pronounced departure from the ideal.
Unlike its noninverting counterpart, the inverting ampliﬁer will load down the
input source if the source is nonideal. This is depicted in Fig. 1.13. Since in the limit
a →∞, the op amp keeps vN →0 V (virtual ground), we can apply the voltage
divider formula and write
vI =
R1
Rs + R1
vS
(1.22)
indicating that |vI | ≤|vS|. Applying Eq. (1.20), vL/vI = −R2/R1. Eliminating
vI , we obtain
vL
vS
= −
R2
Rs + R1
(1.23)
Because of loading at the input, the magnitude of the overall gain, R2/(Rs + R1),
is less than that of the ampliﬁer alone, R2/R1. The amount of loading depends on
the relative magnitudes of Rs and R1, and only if Rs ≪R1 can loading be ignored.
We can look at the above circuit also from another viewpoint. Namely, to ﬁnd
the gain vL/vS, we can still apply Eq. (1.20), provided, however, that we regard Rs
+
–
R2
R1
Rs
vL
vI
vS
RL
0 V
+
FIGURE 1.13
Input loading by the inverting ampliﬁer.

16
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
and R1 as a single resistance of value Rs + R1. Thus, vL/vS = −R2/(Rs + R1),
the same as above.
1.4
IDEAL OP AMP CIRCUIT ANALYSIS
Considering the simplicity of the ideal closed-loop results of the previous section,
we wonder whether there is not a simpler technique to derive them, bypassing some
of the tedious algebra. Such a technique exists and is based on the fact that when
the op amp is operated with negative feedback, in the limit a →∞its input voltage
vD = vO/a approaches zero,
lim
a→∞vD = 0
(1.24)
or, since vN = vP −vD = vP −vO/a, vN approaches vP,
lim
a→∞vN = vP
(1.25)
This property, referred to as the input voltage constraint, makes the input terminals
appear as if they were shorted together, though in fact they are not. We also know that
an ideal op amp draws no current at its input terminals, so this apparent short carries
no current, a property referred to as the input current constraint. In other words, for
voltage purposes the input port appears as a short circuit, but for current purposes it
appears as an open circuit! Hence the designation virtual short. Summarizing, when
operated with negative feedback, an ideal op amp will output whatever voltage and
current it takes to drive vD to zero or, equivalently, to force vN to track vP, but
without drawing any current at either input terminal.
Note that it is vN that tracks vP, not the other way around. The op amp controls
vN via the external feedback network. Without feedback, the op amp would be
unable to inﬂuence vN and the above equations would no longer hold.
To better understand the action of the op amp, consider the simple circuit of
Fig. 1.14a, where we have, by inspection, i = 0, v1 = 0, v2 = 6 V, and v3 = 6 V.
If we now connect an op amp as in Fig. 1.14b, what will happen? As we know, the
op amp will drive v3 to whatever it takes to make v2 = v1. To ﬁnd these voltages,
+
v2 = v1
v3
v1
6 V
0
0
30 kΩ
20 kΩ
10 kΩ
(b)
+
v2
v3
v1
i
6 V
30 kΩ
20 kΩ
10 kΩ
(a)
i
i
i
i
+
–
FIGURE 1.14
The effect of an op amp in a circuit.

17
SECTION 1.4
Ideal Op Amp
Circuit Analysis
we equate the current entering the 6-V source to that exiting it; or
0 −v1
10
= (v1 + 6) −v2
30
Letting v2 = v1 and solving yields v1 = −2 V. The current is
i = 0 −v1
10
= 2
10 = 0.2 mA
and the output voltage is
v3 = v2 −20i = −2 −20 × 0.2 = −6 V
Summarizing, as the op amp is inserted in the circuit, it swings v3 from 6 V to −6 V
because this is the voltage that makes v2 = v1. Consequently, v1 is changed from
0 V to −2 V, and v2 from 6 V to −2 V. The op amp also sinks a current of 0.2 mA
at its output terminal, but without drawing any current at either input.
The Basic Ampliﬁers Revisited
It is instructive to derive the noninverting and inverting ampliﬁer gains using the
concept of the virtual short. In the circuit of Fig. 1.15a we exploit this concept to
label the inverting-input voltage as vI . Applying the voltage divider formula, we
have vI = vO/(1 + R2/R1), which is readily turned around to yield the familiar
relationship vO = (1 + R2/R1)vI . In words, the noninverting ampliﬁer provides
the inverse function of the voltage divider: the divider attenuates vO to yield vI ,
whereas the ampliﬁer magniﬁes vI by the inverse amount to yield vO. This action
can be visualized via the lever analog depicted above the ampliﬁer in the ﬁgure. The
lever pivots around a point corresponding to ground. The lever segments correspond
to resistances, and the swings correspond to voltages.
–
R2
R2
R1
R1
vI
vI
vO
vO
vI
+
–
R2
R2
R1
R1
vI
vI
vO
vO
0 V
+
+
+
(a)
(b)
FIGURE 1.15
Mechanical analogies of the noninverting and the inverting
ampliﬁers.

18
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
In the circuit of Fig. 1.15b we again exploit the virtual-short concept to label the
inverting input as a virtual ground, or 0 V. Applying Kirchhoff’s current low (KCL),
we have (vI −0)/R1 = (0 −vO)/R2, which is readily solved for vO to yield the
familiar relationship vO = (−R2/R1)vI . This can be visualized via the mechanical
analog shown above the ampliﬁer. An upswing (downswing) at the input produces
a downswing (upswing) at the output. By contrast, in Fig. 1.15a the output swings
in the same direction as the input.
So far, we have only studied the basic op amp conﬁgurations. It is time to
familiarize ourselves with other op amp circuits. These we shall study using the
virtual-short concept.
The Summing Ampliﬁer
The summing ampliﬁer has two or more inputs and one output. Though the example
of Fig. 1.16 has three inputs, v1, v2, and v3, the following analysis can readily be
generalized to an arbitrary number of them. To obtain a relationship between output
and inputs, we impose that the total current entering the virtual-ground node equal
that exiting it, or
i1 + i2 + i3 = iF
For obvious reasons, this node is also referred to as a summing junction. Using Ohm’s
law, (v1 −0)/R1 + (v2 −0)/R2 + (v3 −0)/R3 = (0 −vO)/RF, or
v1
R1
+ v2
R2
+ v3
R3
= −vO
RF
We observe that thanks to the virtual ground, the input currents are linearly propor-
tionaltothecorrespondingsourcevoltages.Moreover,thesourcesarepreventedfrom
interacting with each other—a very desirable feature should any of these sources be
+
–
R1
Summing junction (0 V)
Ri1
RF
+
v1
i1
iF
R2
Ri2
+
v2
vO
Ro
i2
R3
Ri3
+
v3
i3
FIGURE 1.16
Summing ampliﬁer.

19
SECTION 1.4
Ideal Op Amp
Circuit Analysis
disconnected from the circuit. Solving for vO yields
vO = −
 RF
R1
v1 + RF
R2
v2 + RF
R3
v3

(1.26)
indicating that the output is a weighted sum of the inputs (hence the name sum-
ming ampliﬁer), with the weights being established by resistance ratios. A popular
application of summing ampliﬁers is audio mixing.
Since the output comes directly from the dependent source inside the op amp,
we have Ro = 0. Moreover, because of the virtual ground, the input resistance
Rik (k = 1, 2, 3) seen by source vk equals the corresponding resistance Rk. In
summary,
Rik = Rk
k = 1, 2, 3
(1.27)
Ro = 0
If the input sources are nonideal, the circuit will load them down, as in the case of
the inverting ampliﬁer. Equation (1.26) is still applicable provided we replace Rk by
Rsk + Rk in the denominators, where Rsk is the output resistance of the kth input
source.
EXAMPLE 1.4.
Using standard 5% resistances, design a circuit such that vO =
−2(3v1 + 4v2 + 2v3).
Solution.
By Eq. (1.26) we have RF/R1 = 6, RF/R2 = 8, RF/R3 = 4. One possible
standard resistance set satisfying the above conditions is R1 = 20 k, R2 = 15 k,
R3 = 30 k, and RF = 120 k.
EXAMPLE 1.5.
In the design of function generators and data converters, the need
arises to offset as well as amplify a given voltage vI to obtain a voltage of the type
vO = AvI + VO, where VO is the desired amount of offset. An offsetting ampliﬁer can
be implemented with a summing ampliﬁer in which one of the inputs is vI and the other
is either VCC or VE E, the regulated supply voltages used to power the op amp. Using
standard 5% resistances, design a circuit such that vO = −10vI + 2.5 V. Assume ±5-V
supplies.
Solution. The circuit is shown in Fig. 1.17. Imposing vO = −(RF/R1)vI −(RF/R2)×
(−5) = −10vI + 2.5, we ﬁnd that a possible resistance set is R1 = 10 k, R2 = 200 k,
and RF = 100 k, as shown.
vO
5 V
5 V
5 V
5 V
+
–
+
vI
200 kΩ
R1
R2
10 kΩ
RF
100 kΩ
+
–
+
+
FIGURE 1.17
A dc-offsetting ampliﬁer.

20
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
If R3 = R2 = R1, then Eq. (1.26) yields
vO = −RF
R1
(v1 + v2 + v3)
(1.28)
that is, vO is proportional to the true sum of the inputs. The proportionality constant
−RF/R1 can be varied all the way down to zero by implementing RF with a variable
resistance. If all resistances are equal, the circuit yields the (inverted) sum of its
inputs, vO = −(v1 + v2 + v3).
The Difference Ampliﬁer
As shown in Fig. 1.18, the difference ampliﬁer has one output and two inputs, one
of which is applied to the inverting side, the other to the noninverting side. We can
ﬁnd vO via the superposition principle as vO = vO1 + vO2, where vO1 is the value
of vO with v2 set to zero, and vO2 that with v1 set to zero.
Letting v2 = 0 yields vP = 0, making the circuit act as an inverting ampliﬁer
with respect to v1. So vO1 = −(R2/R1)v1 and Ri1 = R1, where Ri1 is the input
resistance seen by the source v1.
Letting v1 = 0 makes the circuit act as a noninverting ampliﬁer with re-
spect to vP. So vO2 = (1 + R2/R1)vP = (1 + R2/R1) × [R4/(R3 + R4)]v2 and
Ri2 = R3 + R4, where Ri2 is the input resistance seen by the source v2. Letting
vO = vO1 + vO2 and rearranging yields
vO = R2
R1
1 + R1/R2
1 + R3/R4
v2 −v1

(1.29)
Moreover,
Ri1 = R1
Ri2 = R3 + R4
Ro = 0
(1.30)
The output is again a linear combination of the inputs, but with coefﬁcients of
opposite polarity because one input is applied to the inverting side and the other
to the noninverting side of the op amp. Moreover, the resistances seen by the input
sources are ﬁnite and, in general, different from each other. If these sources are
nonideal, the circuit will load them down, generally by different amounts. Let the
v2
+
–
R2
R1
R4
R3
Ri1
Ri2
Ro
v1
vO
+
+
FIGURE 1.18
Difference ampliﬁer.

21
SECTION 1.4
Ideal Op Amp
Circuit Analysis
sources have output resistances Rs1 and Rs2. Then Eq. (1.29) is still applicable
provided we replace R1 by Rs1 + R1 and R3 by Rs2 + R3.
EXAMPLE 1.6.
Design a circuit such that vO = v2 −3v1 and Ri1 = Ri2 = 100 k.
Solution.
By Eq. (1.30) we must have R1 = Ri1 = 100 k. By Eq. (1.29) we must
have R2/R1 = 3, so R2 = 300 k. By Eq. (1.30) R3 + R4 = Ri2 = 100 k. By
Eq. (1.29), 3[(1 + 1/3)/(1 + R3/R4)] = 1. Solving the last two equations for their two
unknowns yields R3 = 75 k and R4 = 25 k.
An interesting case arises when the resistance pairs in Fig. 1.18 are in equal
ratios:
R3
R4
= R1
R2
(1.31)
When this condition is met, the resistances are said to form a balanced bridge, and
Eq. (1.29) simpliﬁes to
vO = R2
R1
(v2 −v1)
(1.32)
The output is now proportional to the true difference of the inputs—hence the name
of the circuit. A popular application of the true difference ampliﬁer is as a building
block of instrumentation ampliﬁers, to be studied in the next chapter.
The Differentiator
To ﬁnd the input-output relationship for the circuit of Fig. 1.19, we start out by
imposing iC = iR. Using the capacitance law and Ohm’s law, this becomes
Cd(vI −0)/dt = (0 −vO)/R, or
vO(t) = −RC dvI (t)
dt
(1.33)
The circuit yields an output that is proportional to the time derivative of the input—
hence the name. The proportionality constant is set by R and C, and its units are
seconds (s).
If you try out the differentiator circuit in the lab, you will ﬁnd that it tends to
oscillate. Its stability problems stem from the open-loop gain rolloff with frequency,
an issue that will be addressed in Chapter 8. Sufﬁce it to say here that the circuit
is usually stabilized by placing a suitable resistance Rs in series with C. After this
+
–
R
C
vI
iR
vO
0 V
+
iC
FIGURE 1.19
The op amp differentiator.

22
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
+
–
R
C
vI
Ri
Ro
vO
+
FIGURE 1.20
The op amp integrator.
modiﬁcation the circuit will still provide the differentiation function, but only over
a limited frequency range.
The Integrator
The analysis of the circuit of Fig. 1.20 mirrors that of Fig. 1.19. Imposing iR = iC,
we now get (vI −0)/R = C d(0 −vO)/dt, or dvO(t) = (−1/RC)vI (t) dt. Chang-
ing t to the dummy integration variable ξ and then integrating both sides from
0 to t yields
vO(t) = −1
RC
 t
0
vI (ξ) dξ + vO(0)
(1.34)
where vO(0) is the value of the output at t = 0. This value depends on the charge ini-
tially stored in the capacitor. Equation (1.34) indicates that the output is proportional
to the time integral of the input—hence the name. The proportionality constant is
set by R and C, but its units are now s−1. Mirroring the analysis of the inverting
ampliﬁer, you can readily verify that
Ri = R
Ro = 0
(1.35)
Thus, if the driving source has an output resistance Rs, in order to apply Eq. (1.34)
we must replace R with Rs + R.
The op amp integrator, also called a precision integrator because of the high
degree of accuracy with which it can implement Eq. (1.34), is a workhorse of
electronics. It ﬁnds wide application in function generators (triangle and sawtooth
wave generators), active ﬁlters (state-variable and biquad ﬁlters, switched-capacitor
ﬁlters), analog-to-digital converters (dual-slope converters, quantized-feedback con-
verters), and analog controllers (PID controllers).
If vI (t) = 0, Eq. (1.34) predicts that vO(t) = vO(0) = constant. In practice,
when the integrator circuit is tried out in the lab, it is found that its output will drift
until it saturates at a value close to one of the supply voltages, even with vI grounded.
This is due to the so-called input offset error of the op amp, an issue to be discussed
in Chapter 5. Sufﬁce it to say here that a crude method of preventing saturation is
to place a suitable resistance Rp in parallel with C. The resulting circuit, called a
lossy integrator, will still provide the integration function, but only over a limited
frequency range. Fortunately, in most applications integrators are placed inside a
control loop designed to automatically keep the circuit away from saturation, at least

23
SECTION 1.4
Ideal Op Amp
Circuit Analysis
under proper operating conditions, thus eliminating the need for the aforementioned
parallel resistance.
The Negative-Resistance Converter (NIC)
We conclude by demonstrating another important op amp application besides signal
processing, namely, impedance transformation. To illustrate, consider the plain re-
sistance of Fig. 1.21a. To ﬁnd its value experimentally, we apply a test source v, we
measure the current i out of the source’s positive terminal, and then we let Req = v/i,
where Req is the value of the resistance as seen by the source. Clearly, in this simple
case Req = R. Moreover, the test source releases power and the resistance absorbs
power.
Suppose we now lift the lower terminal of R off ground and drive it with a
noninverting ampliﬁer with the input tied to the other terminal of R, as shown in
Fig. 1.21b. The current is now i = [v −(1+ R2/R1)v]/R = −R2v/(R1R). Letting
Req = v/i yields
Req = −R1
R2
R
(1.36)
indicating that the circuit simulates a negative resistance. The meaning of the
negative sign is that current is now actually ﬂowing into the test source’s positive
terminal, causing the source to absorb power. Consequently, a negative resistance
releases power.
If R1 = R2, then Req = −R. In this case the test voltage v is ampliﬁed to 2v by
the op amp, making R experience a net voltage v, positive at the right. Consequently,
i = −v/R = v/(−R).
Negative resistances can be used to neutralize unwanted ordinary resistances,
as in the design of current sources, or to control pole location, as in the design of
active ﬁlters and oscillators.
Looking back at the circuits covered so far, note that by interconnecting suit-
able components around a high-gain ampliﬁer we can conﬁgure it for a variety of
operations: multiplication by a constant, summation, subtraction, differentiation,
integration, and resistance conversion. This explains why it is called operational!
+
–
R1
R
i
Req
+
v
R
R2
Req
i
+
v
(a)
(b)
R1
R2
(1 +      )v
(
)
FIGURE 1.21
(a) Positive resistance: Req = R. (b) Negative-resistance
converter: Req = −(R1/R2)R.

24
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
1.5
NEGATIVE FEEDBACK
Section 1.3 informally introduced the concept of negative feedback. Since the ma-
jority of op amp circuits employ this type of feedback, we shall now discuss it in a
more systematic fashion.
Figure 1.22 shows the basic structure of a negative-feedback circuit. The arrows
indicate signal ﬂow, and the generic symbol x stands for either a voltage or a current
signal. Besides the source and load, we identify the following basic blocks:
1. An ampliﬁer called the error ampliﬁer, which accepts a signal xε called the error
signal, and yields the output signal
xo = aεxε
(1.37)
where aε is called the open-loop gain.
2. A feedback network, which samples xo and produces the feedback signal
x f = bxo
(1.38)
where b is the gain of the feedback network and is called the feedback factor.
3. A summing network, denoted as , which sums the negative of x f to the input
signal xi to yield the difference
xε = xi −x f
(1.39)
The designation negative feedback stems from the fact that we are in effect feeding
a portion b of xo back to the error ampliﬁer’s input, where it is subtracted from xi
to yield a reduced signal xε. Were it added instead, feedback would be positive. For
reasons that will become clearer as we move along, negative feedback is also said
to be degenerative, and positive feedback regenerative.
Substituting Eq. (1.38) into Eq. (1.39), and then into Eq. (1.37), we get
A = xo
xi
=
aε
1 + aεb
(1.40)
where A is called the closed-loop gain (not to be confused with the open-loop
gain aε = xo/xε). Note that for feedback to be negative we must have aεb > 0.
Consequently, A will be smaller than aε by the amount 1 + aεb, which is called
the amount of feedback. (Should there be no feedback, we would have b = 0 and
A →a, a situation referred to as open-loop operation.)
xo
xi
x
xf
a
b
+
–
Feedback network
Error amplifier
Σ
Source
Load
FIGURE 1.22
Block diagram of a negative-feedback
system.

25
SECTION 1.5
Negative
Feedback
As a signal propagates around the loop consisting of the error ampliﬁer, feedback
network, and summer, it experiences an overall gain of aε × b × (−1), or −aεb. Its
negative shall be denoted as the loop gain L,
L = aεb
(1.41)
This gain allows us to express Eq. (1.40) in the more insightful form A = (1/b) ×
L/(1 + L) = (1/b)/(1 + 1/L). Letting L →∞yields the ideal situation
Aideal = lim
L→∞A = 1
b
(1.42)
that is, A becomes independent of aε and is set exclusively by the feedback network,
regardless of the error ampliﬁer in use. By proper choice of the topology and com-
ponents of the feedback network, we can tailor the circuit to a variety of different
applications. For instance, specifying b < 1 so that 1/b > 1, will cause xo to be a
magniﬁed replica of xi. Or, implementing the feedback network with reactive ele-
ments such as capacitors will yield a frequency-dependent circuit with the transfer
function H(s) = 1/b(s), where s is the complex frequency. Filters and oscillators
are two popular examples.
Henceforth we shall express the closed-loop gain in the insightful form
A = Aideal
1
1 + 1/L
(1.43)
Rearranging as
A = Aideal

1 −
1
1 + L

(1.44)
indicates that the fractional departure of the actual gain A from the ideal gain Aideal
is inversely proportional to the amount of feedback 1 + L. This departure is more
commonly expressed via the gain error
GE(%) = 100 A −Aideal
Aideal
=
1
1 + L
(1.45)
EXAMPLE 1.7.
(a) Find the loop gain needed for GE ≤0.1%. (b) Find aε to achieve
A = 50 with the above GE. (c) What is the actual value of A? How would you change
b to make A = 50.0 exactly?
Solution.
(a) Use Eq. (1.45) to impose 100/(1 + L) ≤0.1, or L ≥999 (use L ≥103).
(b) Use Eq. (1.42) to impose 50 = 1/b, or b = 0.02. Then, L ≥103 ⇒aεb ≥103 ⇒
aε ≥103/0.02 = 5 × 104.
(c) With L = 103 we have, by Eq. (1.43), A = 49.95. To make A = 50.0, use Eq. (1.40)
to impose 50 = 5 × 104/(1 + 5 × 104b), or b = 0.01998.
This example evidences the price for a low gain error, namely, the need to start
out with aε ≫A so that, once we close the loop around the error ampliﬁer, we
are in effect throwing away a good deal of open-loop gain, namely, the amount of
feedback 1+ L. It is also apparent that for a given aε, the smaller the desired gain A,
the higher the feedback factor b, and thus the higher the loop gain L and the lower
the gain error.

26
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
It is instructive to investigate the effect of negative feedback on the signals xε
and x f . Writing xε = xo/aε = (Axi)/aε = (A/aε)xi, we get
xε =
xi
1 + L
(1.46)
Moreover, writing x f = bxo = b(Axi) and using Eq. (1.40), we get
x f =
xi
1 + 1/L
(1.47)
As L →∞, the error signal xε will approach zero, and the feedback signal xf will
track the input signal xi. This forms the basis of the already-familiar virtual-short
concept.
Gain Desensitivity
We wish to investigate how variations in the open-loop gain aε affect the closed-loop
gain A. Differentiating Eq. (1.40) with respect to aε gives d A/daε = 1/(1 + aεb)2.
Substituting 1 + aεb = aε/A and rearranging,
d A
A =
1
1 + L
daε
aε
Replacing differentials with ﬁnite differences and multiplying both sides by 100, we
approximate as
100A
A
∼=
1
1 + L

100aε
aε

(1.48)
In words, the impact of a given percentage variation in aε upon A is reduced by the
amount of feedback 1 + L. So long as L is sufﬁciently large, even a gross variation
in aε will cause an insigniﬁcant variation in A. We say that negative feedback
desensitizes gain, this being the reason why the amount of feedback 1 + L is also
called the desensitivity factor. The stabilization of A is highly desirable because the
gain aε of a real-life ampliﬁer is ill-deﬁned because of fabrication process variations,
thermal drift, and aging.
Whataboutthesensitivityof A tovariationsinb?AgaindifferentiatingEq.(1.40),
but with respect to b, we get
100A
A
∼= 100b
b
(1.49)
indicating that negative feedback does not stabilize A against variations in b. If we
want a stable A, we need to implement the feedback network with components of
adequate quality.
EXAMPLE 1.8.
A negative-feedback circuit has aε = 105 and b = 10−3. (a) Estimate
the percentage change in A brought about by a ±10% change in a. (b) Repeat if b = 1.
Solution.
(a) The desensitivity factor is 1 + L = 1 + 105 × 10−3 = 101. Thus, a ±10% change
in aε will cause a percentage change in A 101 times as small; that is, A changes by
±10/101 ∼= ±0.1%.
(b) Now the desensitivity increases to 1+105 ×1 ∼= 105. The percentage change in A is
now ±10/105 = 0.0001%, or one part per million (1 ppm). We note that for a given
aε, the lower the value of A, the higher the desensitivity because 1 + L = aε/A.

27
SECTION 1.5
Negative
Feedback
vD
N
P IN+
IN−
OUT+
OUT−
+
–
0
Eamp
VALUE {10*((exp(2E4*V(P,0))-1)/(exp(2E4*V(P,0))+1))}
vO
O
RL
10 kΩ
0
0
0
FIGURE 1.23
PSpice ampliﬁer with a nonlinear voltage transfer
curve (nonlinear VTC).
Nonlinear Distortion Reduction
A convenient way of visualizing the transfer characteristic of the error ampliﬁer is
by means of its transfer curve, that is, the plot of the output xO versus the input xE.
The transfer curve of Eq. (1.37) is a straight line with slope aε. However, the transfer
curve of a real-life ampliﬁer is generally nonlinear. As an example, let us use the
PSpice circuit of Fig. 1.23 to display the function
vO = Vo tanh vE
Vd
= Vo
exp(2vE/Vε) −1
exp(2vE/Vε) + 1
(1.50)
which mimics qualitatively a real-life voltage transfer curve (VTC). Using Vo =
10 V and Vε = 100 μV, and directing PSpice to perform a dc sweep, we obtain the
VTC of Fig. 1.24a, top. The voltage gain aε, visualized as the slope of the VTC,
Output vO (V)
Input vE (μV)
(a)
(b)
a
10
VTC
 0
−10
−200
200
Input vE (μV)
vE
200
0
−200
0
0.5
1.0
1.5
2.0
Open-loop gain (V/V)
a
100 k
50 k
0
−200
200
0
Output vO (V)
vO
10
0
−10
0
0.5
1.0
Time t (ms)
1.5
2.0
FIGURE 1.24
(a) Open-loop characteristics (VTC and gain aε) of the ampliﬁer of Fig. 1.23. (b) The response
vO to a triangular input vE.

28
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
vI
N
vF
vE
P
O
IN+
IN−
OUT+
OUT−
+
–
+
–
0
Eb
Eamp
VALUE {10*((exp(2E4*V(P,0))-1)/(exp(2E4*V(P,0))+1))}
0
vO
RL
10 kΩ
0.1
+
–
+
–
FIGURE 1.25
Applying negative feedback (b = 0.1) around the
ampliﬁer of Fig. 1.23.
is plotted by PSpice as the function D(V(O)). The result, shown at the bottom of
Fig. 1.24a, indicates that aε is maximum at the origin, but decreases as we move
away from the origin, and eventually drops to zero at the periphery, where the VTC
saturates at ±10 V.
An obvious consequence of nonlinear gain is distortion, as depicted in Fig. 1.24b
for the case of a triangular input. So long as we keep vE sufﬁciently small (say,
±10 μV or less), vO will be a relatively undistorted, ampliﬁed version of vE. How-
ever, increasing vE increases the amount of output distortion, as exempliﬁed in the
picture. Increasing vE further would lead to severe output clipping and thus even
greater distortion.
What are we to make of an ampliﬁer with the above nonlinearity/distortion
shortcomings? Enter negative feedback, as depicted in Fig. 1.25, where we use the
dependent source Eb to sample the output-port voltage vO, attenuate it to 1/10 to
create the feedback signal vF, and present vF to the input port of the ampliﬁer,
where the latter subtracts it from vI to create the error signal vE (note that the
operation of input summation is performed inherently by the ampliﬁer itself). The
results of the simulation, displayed in Fig. 1.26, reveal a dramatic linearization of
the closed-loop VTC: the gain A is fairly constant (A ∼= 1/b = 10 V/V), and it
is so over a much wider output range than the highly nonlinear gain aε; moreover,
vO is a fairly undistorted, ampliﬁed version of vI . This, of course, holds over the
voltage range for which aε is sufﬁciently large to make the loop gain L ≫1, as per
Eqs. (1.42) and (1.43). As we approach the regions of open-loop saturation, where
aε falls, the linearizing effect of negative feedback no longer applies because of the
lack of sufﬁcient loop gain (L = aεb) there, so A itself falls.
Given the highly nonlinear VTC of Fig. 1.24a, how does the ampliﬁer manage
to yield the undistorted waveform vO of Fig. 1.26b? The answer is provided by the
error signal vE, also shown in Fig. 1.26b, which illustrates how negative feedback
forces the ampliﬁer to predistort (via the feedback network) its own input vE in such
a way as to yield the undistorted output vO. In fact, it was the desire to reduce output
distortion that motivated the negative-feedback concept in the ﬁrst place!

29
SECTION 1.5
Negative
Feedback
Output vO (V)
Input vI (V)
(a)
(b)
A
10
VTC
vO
vI
vE
0
−10
−1
1
0
Closed-loop gain (V/V)
A
10
5
0
−1
1
0
Waveforms (V)
Time t (ms)
10
0
−10
Error voltage vE (μV)
200
0
−200
0.5
0
2.0
1.0
1.5
0.5
0
2.0
1.0
1.5
FIGURE 1.26
(a) Closed-loop characteristics (VTC and gain A) of the ampliﬁer of Fig. 1.24. (b) Input vI,
undistorted output vO, and predistorted error signal vE.
Effect of Feedback on Disturbances and Noise
Negative feedback provides a means also for reducing circuit sensitivity to certain
types of disturbances. Figure 1.27 illustrates three types of disturbances: x1, entering
the circuit at the input, might represent unwanted signals such as input offset errors
and input noise, both of which will be covered in later chapters; x2, entering the
circuit at some intermediate point, might represent power-supply hum; x3, entering
the circuit at the output, might represent output load changes.
To accommodate x2, we break the ampliﬁer into two stages with individual gains
aε1 and aε2, as shown. The overall forward gain is then aε = aε1aε2. The output is
+
+
+
+
+
+
–
Σ
Σ
a1
Σ
a2
x1
x2
x3
xo
xi
b
FIGURE 1.27
Investigating the effect of negative feedback on
disturbances and noise.

30
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
found as xo = x3 + aε2[x2 + aε1(xi −bxo + x1)], or
xo =
aε1aε2
1 + aε1aε2b

xi + x1 + x2
aε1
+
x3
aε1aε2

We observe that x1 undergoes no attenuation relative to xi. However, x2 and x3
are attenuated by the forward gains from the input to the points of entry of the
disturbances themselves. This feature is widely exploited in the design of audio
ampliﬁers. The output stage of such an ampliﬁer is a power stage that is usually
afﬂicted by an intolerable amount of hum. Preceding such a stage by a high-gain,
low-noise preampliﬁer stage and then closing a proper feedback loop around the
composite ampliﬁer reduces hum by the ﬁrst-stage gain.
For aε1aε2b ≫1, the above expression simpliﬁes to
xo ∼= 1
b

xi + x1 + x2
aε1
+
x3
aε1aε2

(1.51)
indicating that 1/b represents the gain by which the negative-feedback system am-
pliﬁes the input noise component x1. Hence, the reason why 1/b is often referred to
as the noise gain.
1.6
FEEDBACK IN OP AMP CIRCUITS
We now wish to relate the concepts of the previous section to circuits based on op
amps. Even though the op amp is strictly speaking a voltage ampliﬁer, with negative
feedback we can operate it as any of the four ampliﬁer types discussed in Section 1.1,
giving further credence to its versatility. Accordingly, we have four basic feedback
topologies, which pretty much form the basis of all op amp circuits. Our strategy
here is to express the signals of each topology in the form
xO = aε(xI −bxO)
(1.52)
so as to identify the gain aε and the feedback factor b. In so doing we shall see that
the gain aε of the feedback circuit may not necessarily coincide with the gain a of the
op amp. Once we know aε and b, we easily ﬁnd the loop gain L and the closed-loop
gain A via Eqs. (1.41) through (1.43). To help the reader develop an intuitive feel,
we start out with the basic op amp model of Fig. 1.4, having rd →∞, ro →0 and
a large gain a.
The Series-Shunt and Shunt-Shunt Topologies
The circuit of Fig. 1.28a uses the voltage divider R1-R2 to sample vO and produce
the feedback voltage vF. The op amp then sums −vF to vI to produce the error
voltage vD. Since the input-port voltages are summed in series, and the output-port
voltage is sampled in parallel (or shunt), this topology is said to be of the series-shunt
type. By inspection,
vO = avD = a (vI −vF) = a

vI −
R1
R1 + R2
vF


31
SECTION 1.6
Feedback in Op
Amp Circuits
(a)
(b)
–
R2
R1
vI
vD
vF
vO
RL
a
+
+
–
–
+
+
–
R
iI
iD
iF
a
vN
vO
RL
FIGURE 1.28
The (a) series-shunt and (b) shunt-shunt topologies.
This relationship is of the type of Eq. (1.52), provided
aε = a
b =
R1
R1 + R2
=
1
1 + R2/R1
(1.53)
Consequently, the loop gain is
L = aεb =
a
1 + R2/R1
(1.54a)
Moreover, by Eqs. (1.42) and (1.43), the closed-loop voltage gain takes on the form
Av = vO
vI
= 1
b
1
1 + 1/L =

1 + R2
R1

1
1 + 1/L
(1.54b)
These are familiar noninverting-ampliﬁer expressions, but derived from a negative-
feedback perspective. As we know, when used as a unity-gain voltage follower, the
circuit has b = 1, so L = a.
The circuit of Fig. 1.28b uses the resistance R to sample vO and to establish
the feedback current iF, whose negative is then summed to iI to produce the error
current iD. Since the input-port currents are summed in parallel (or shunt), and the
output-port voltage is sampled also in parallel, this topology is said to be of the
shunt-shunt type. Using the superposition principle,
vO = −avN = −a (RiI + vO) = −aR

iI −−1
R vO

This relationship is of the type of Eq. (1.52), provided
aε = −aR
b = −1
R
(1.55)
Note that the open-loop gain aε(̸= a) is now in V/A, and the feedback factor b is
in A/V. Both parameters are negative, and their dimensions are reciprocal of each
other, so the loop gain
L = aεb = a
(1.56a)
comes out positive and dimensionless, as it should be (you can exploit this fact
to perform a dimensional check on your future derivations). The closed-loop

32
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
+
–
+
–
R1
R2
vI
a
vO
+
–
R1
R2
iI
(vI/R1)
a
vO
vN
⇒
FIGURE 1.29
Performing a source transformation to put the inverting ampliﬁer in shunt-shunt form.
transresistance gain is, by Eqs. (1.42) and (1.43)
Ar = vO
iI
= 1
b
1
1 + 1/L = −R
1
1 + 1/L
(1.56b)
This gain too is in V/A.
The shunt-shunt topology is at the basis of the popular inverting voltage ampli-
ﬁer. This becomes clearer if we perform the input source transformation of Fig. 1.29
by letting
iI = vI
R1
(1.57)
Then, using the superposition principle, we write
vO = −avN = −a

(R1//R2) iI +
R1
R1 + R2
vO

= −a (R1//R2)

iI −
1
−R2
vO

This relationship is of the type of Eq. (1.52), provided
aε = −a (R1//R2)
b = −1
R2
(1.58)
(note that we have again aε ̸= a). Consequently, the expression for L changes from
that of Eq. (1.56a) to
L = aεb =

−a
R1R2
R1 + R2

×

−1
R2

=
a
1 + R2/R1
(1.59a)
Moreover, the closed-loop transresistance gain is, by Eqs. (1.42) and (1.43),
Ar = vO
iI
= 1
b
1
1 + 1/L = −R2
1
1 + 1/L
whereas the closed-loop voltage gain is
Av = vO
vI
= vO
iI
× iI
vI
= vO
iI
× 1
R1
=

−R2
R1

1
1 + 1/L
(1.59b)
It is interesting that while the ideal closed-loop voltage gains of the inverting
and the noninverting conﬁgurations are so different, the loop gain L is the same, as
per Eqs. (1.54a) and (1.59a). This is so because L is an inherent circuit characteristic
established solely by the ampliﬁer and its feedback network.

33
SECTION 1.6
Feedback in Op
Amp Circuits
The Series-Series and Shunt-Series Topologies
The circuit of Fig. 1.30a uses the resistance R in series with the load RL to sample
the output-port current iO and generate the feedback voltage vF, whose negative
is then summed to vI to produce the error voltage vD. For obvious reasons, this
topology is said to be of the series-series type. By inspection,
vO = avD = a(vI −vF) = −a (vI −RiO)
Substituting vO = (R + RL)iO and rearranging, we get
iO =
a
R + RL
(vI −RiO)
This relationship is of the type of Eq. (1.52), provided
aε =
a
R + RL
b = R
(1.60)
Note that aε(̸= a) is now in A/V and b in V/A, so the loop gain is dimensionless, as
it should be,
L = aεb =
a
1 + RL/R
(1.61a)
Finally, the closed-loop transconductance gain, also in A/V, is
Ag = iO
vI
= 1
b
1
1 + 1/L = 1
R
1
1 + 1/L
(1.61b)
The circuit of Fig. 1.30b is similar to that of Fig. 1.28b at the input port, and to
that of Fig. 1.30a at the output port, so it is said to be of the shunt-series type. It is
left as an exercise (see Problem 1.53) to prove that for a ≫1 we have
aε ∼= −a 1 + R2/R1
1 + RL/R1
b ∼= −
1
1 + R2/R1
(1.62)
Consequently, the loop gain and the closed-loop current gain are, respectively,
L ∼=
a
1 + RL/R1
Ai = iO
iI
= 1
b
1
1 + 1/L
∼= −

1 + R2
R1

1
1 + 1/L
(1.63)
–
+
R
(a)
(b)
RL
vI
vD
vF
iO
vO
a
+
–
+
–
–
+
RL
R2
R1
iI
vN
iO
vO
a
iD
iF
FIGURE 1.30
The (a) series-series and (b) shunt-series topologies.

34
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
(It is interesting that in both circuits, L depends on the particular load RL in use.
Can you justify intuitively why L decreases as RL is increased?)
EXAMPLE 1.9.
In the shunt-series circuit of Fig. 1.30b let R2 = 2R1 = 20 k and let
the op amp have a = 100 V/V. (a) Calculate aε, b, L, and Ai if RL = 10 k. (b) Repeat
if RL = 0 and comment.
Solution.
(a) We have aε = −100 × (1 + 20/10)/(1 + 10/10) = −150 A/A, b = −1/(1 +
20/10) = −(1/3) A/A, L = 150/3 = 50, Aideal = 1/b = 3.0 A/A, Ai =
−3/(1 + 1/50) = −2.9412 A/A.
(b) Now aε = −100 × (1 + 20/10)/(1 + 0/10) = −300 A/A, b = −(1/3) A/A,
L = 100, Ai = −3/(1 + 1/100) = −2.9703 A/A. While b remains the same, aε
increases because of the reduced output swing required of the op amp, causing L to
double and thus make Ai closer to ideal.
Closed-Loop Input/Output Resistances
Negative feedback has a dramatic effect not only on gain but also on the terminal
resistances (in Chapter 6 we shall see that it affects also the frequency/time responses,
and in Chapter 8 the circuit stability).
Turning ﬁrst to the series-input topology of Fig. 1.31a, we observe that owing
to feedback, the voltage vd arising in response to a test voltage vi is bound to be
very small. In fact, Eq. (1.46) gives
ii = vd
rd
=
vi
(1 + L)rd
so the closed-loop input resistance, obtained as Ri = vi/ii, is
Ri ∼= rd(1 + L)
(1.64)
(note the use of uppercase letters to distinguish closed-loop parameters from the
lowercase-lettered open-loop parameters). In words, negative feedback takes the
input resistance rd, already high in a well-designed op amp, and raises it further
by the amount of feedback 1 + L, which is also large. Clearly, Ri is bound to be
much higher than the other resistances in the circuit, so we feel justiﬁed assuming
Ri →∞, at least so long as the amount of feedback is sufﬁciently large.
+
–
avd
ro
+–
(b)
vi
R
ii
+
–
vd
ii
vi
Ri
Ri
vf
–
+
rd
vd
(a)
+
–
+
–
FIGURE 1.31
Finding the closed-loop resistances of the (a) series-input and (b) shunt-input
topologies.

35
SECTION 1.6
Feedback in Op
Amp Circuits
In the shunt-input topology of Fig. 1.31b we omit showing rd because the small
voltage vd across it renders its current insigniﬁcant. We feel conﬁdent in assuming
that the input test current ii ﬂows entirely into the feedback resistance R, so
ii = vi −avd
R + ro
= vi −a(−vi)
R + ro
Taking again the ratio Ri = vi/ii we get
Ri ∼= R + ro
1 + a = R + ro
1 + L
(1.65)
where Eq. (1.56a) has been used. In a well-designed op amp circuit we usually have
ro ≪R, so it is common to approximate Ri ∼= R/(1 + a). In words, the feedback
resistance R, reﬂected to the input, gets divided by 1+a, which in this case coincides
with the amount of feedback. This transformation, known as the Miller effect, holds
for any feedback impedance, such as capacitive impedances, as we shall see in
Chapter 8. With a high gain a we expect Ri ≪R. In fact, in the limit a →∞we
would get Ri →0, the condition for a perfect virtual ground, as we already know.
Looking back at the inverting voltage ampliﬁer of Fig. 1.29, we readily ﬁnd that the
resistance seen by the driving source is vi/ii = R1 + (R2 +ro)/(1 + a) ∼= R1, thus
conﬁrming an already familiar result.
We now turn to the closed-loop output resistances, which we ﬁnd by setting the
input source to zero and subjecting the output port to a test signal. With vi set to 0 V
the circuit of Fig. 1.32a could have been an inverting or a noninverting ampliﬁer, or
it could even be the equivalent circuit of a summing ampliﬁer, a difference ampliﬁer,
or a transresistance ampliﬁer. Therefore, the result we are about to derive is going to
be quite general. Assume for a moment that io ﬂows entirely into ro, an assumption
whose validity we shall verify shortly. We then have, by Kirchhoff’s voltage law
(KVL) and Ohm’s law,
vo ∼= avd + roio = a

−
R1
R1 + R2
vo

+ roio
Collecting and letting Ro = vo/io we get
Ro ∼=
ro
1 + L
L =
a
1 + R2/R1
(1.66)
–
+
avd
ro
+–
(b)
–
+
vd
(a)
R1
R2
Ro
+
–
vd
vo
io
vo
io
Ro
R2
R1
+
–
+
–
avd
ro
+–
FIGURE 1.32
Finding the closed-loop resistances of the (a) shunt-output and (b) series-output topologies.

36
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
Negative feedback takes the output resistance ro, already low in a well-designed op
amp, and lowers it further by the amount of feedback 1 + L, which is large. Clearly,
Ro is bound to be much lower than the other resistances in the circuit, so we feel
justiﬁed assuming Ro →0, at least so long as L is sufﬁciently large. This also
validates our initial assumption that io ﬂows almost entirely into the op amp, where
it encounters a much smaller resistance than that presented by the feedback network.
Finally, we use the circuit of Fig. 1.32b to ﬁnd the output resistance of a series-
output port. With ii set to 0 V, this circuit could have been the current ampliﬁer
of Fig. 1.30b, or (with R2 = 0) the transconductance ampliﬁer of Fig. 1.30a, or it
could be the equivalent circuit of other variants that we shall encounter in the future.
Therefore, the forthcoming result is bound to be quite general. Applying the loop
method,
avd + roio −vo + R1io = 0
−vd + R1io = 0
Eliminating vd, collecting, and letting Ro = vo/io we get
Ro = R1(1 + a) + ro ∼= R1(1 + L)
(1.67)
where we have used Eq. (1.63) with RL →0. Clearly, negative feedback increases
the output resistance of a series-output port, making the port approach ideal current-
source behavior.
EXAMPLE 1.10.
(a) A 741-type op amp is conﬁgured as a noninverting ampliﬁer with
R1 = 1.0 k and R2 = 999 k. Predict Ri, Av, and Ro, verify with PSpice, and compare
with the ideal case. (b) Repeat, but with R1 = ∞and R2 = 0, and comment.
Solution.
(a) We have Aideal = 1 + 999/1 = 103 V/V and L = 200,000/103 = 200, so Ri ∼=
(1 + 200) × 2 × 106 = 402 M, Av = 103/(1 + 1/200) = 995 V/V, and Ro =
75/(1 + 200) = 0.373 . These values match those provided by PSpice’s small-
signal analysis of the circuit of Fig. 1.33. For practical purposes they are fairly close
to the ideal values Ri = ∞, Av = 103 V/V, and Ro = 0.
(b) The circuit is now a unity-gain voltage follower with L = a = 2 × 105, pushing the
closed-loop parameters even closer to ideal. Proceeding in similar fashion, we get
Ri = 400 G, Av = 0.999995 V/V, and Ro = 0.375 m, again all in agreement
with PSpice.
ro
vO
R1
1.0 kΩ
vI
P
I
O
N
rd
2 MΩ
75 Ω
0
200 V/mV
EOA
+
–
+
–
+
–
0
0
R2
999 kΩ
FIGURE 1.33
SPICE circuit for Example 1.10.

37
SECTION 1.6
Feedback in Op
Amp Circuits
Concluding Remarks
It is apparent that the loop gain L plays a vital role in a negative-feedback circuit
(we’ll have much more to say about this in Chapters 6 and 8). First, L provides a
measure of the closed-loop gain’s departure from the ideal via Eq. (1.43), repeated
here for convenience,
A = xo
xi
= Aideal
1
1 + 1/L
(1.68a)
where
Aideal = lim
T →∞
xo
xi
(1.68b)
(In the case of op amp circuits, we derive Aideal using the the input virtual-short
concept.) Second, the amount of feedback 1 + L represents the amount by which
negative feedback raises the resistance of a series-type port as per Eqs. (1.64) and
(1.67), or lowers the resistance of a shunt-type port as per Eqs. (1.65) and (1.66).
We summarize the input/output resistance transformations as
R = r0(1 + L)±1
(1.69)
where r0 is the resistance presented by the port in the limit L →0 (achieved in the
limit a →0), R is the ensuing closed-loop resistance, and we use +1 for series-
type ports, −1 for shunt-type ports. The above resistance transformations are highly
beneﬁcial in terms of reducing input/output loading. Moreover, they tend to facilitate
circuit analysis when the transformed resistances are dramatically larger or smaller
than the other resistances in the circuit. The higher L, the closer the closed-loop
characteristics to ideal. Put another way, if you had to choose between an op amp
with poor rd and ro but excellent a, and one with excellent rd and ro but poor
a, go for the former as the ensuing high L will make up for its poor rd and ro
characteristics (see Problem 1.60). To stress the importance of L, it is instructive to
express a negative-feedback system in terms of L and Aideal rather than in terms of
aε and b. We do this by letting b →1/Aideal and aε →aεb/b = L/b = L Aideal,
so the block diagram of Fig. 1.22 becomes as shown in Fig. 1.34.
xo
Ro
xi
LAideal
1/Aideal
+
–
Ri
Σ
Source
Load
FIGURE 1.34
Negative-feedback
system
representation
in
terms of Aideal and the loop gain L.

38
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
1.7
THE RETURN RATIO AND BLACKMAN’S FORMULA
The derivations of the previous section postulate (a) forward signal transmission ex-
clusively through the error ampliﬁer and (b) reverse signal transmission exclusively
through the feedback network (the arrowheads of Fig. 1.22 convey explicitly this
directionality). Such an ampliﬁer and feedback network are said to be unilateral.
However, while most op amps do approach unilateral behavior, feedback networks
are generally bilateral. To develop an intuitive feel for the ensuing implications,
we reexamine the familiar inverting and noninverting voltage ampliﬁers, using the
full-blown op amp model of Fig. 1.3b.
Summing currents into the nodes labeled vN and vO in Fig. 1.35a we get
vI −vN
rd
−vN
R1
+ vO −vN
R2
= 0
vN −vO
R2
+ a(vI −vN) −vO
ro
= 0
where vD = vI −vN has been used. Eliminating vN, collecting, and solving for the
ratio vO/vI gives
Anoninv =
1 + R2/R1
1 + 1
a

1 + R2
R1 + R1+ro
rd
+ ro
R1
+
ro/rd
a +

1 + R2
R1 + R1+ro
rd
+ ro
R1
 (1.70)
Proceeding in similar fashion with the circuit of Fig. 1.36a, we get
Ainv =
−R2/R1
1 + 1
a

1 + R2
R1 + R1+ro
rd
+ ro
R1
 +
ro/R1
a +

1 + R2
R1 + R1+ro
rd
+ ro
R1

(1.71)
Both gains can be expressed in the common form5
A =
Aideal
1 + 1/T +
aft
1 + T
(1.72)
where
Aideal = lim
a→∞
vO
vI
(1.73)
+
–
avD
ro
rd
+–
R1
vN
R2
R1
R2
+
–
vI
(a)
(b)
vO
vO
rd
ro
vI
+
–
vD
+
–
FIGURE 1.35
(a) Noninverting ampliﬁer and (b) feedthrough signal transmission.

39
SECTION 1.7
The Return Ratio
and Blackman’s
Formula
+
–
avD
ro
rd
+–
R1
vN
R2
R1
R2
(a)
(b)
vO
vO
rd
ro
+
–
vD
vI
+
–
vI
+
–
FIGURE 1.36
(a) Inverting ampliﬁer and (b) feedthrough signal transmission.
is the ideal closed-loop gain, calculated via the input virtual-short concept, and
aft = lim
a→0
vO
vI
(1.74)
is the feedthrough gain, stemming from forward signal transmission around the
source avD, that is, with this source set to zero as in Figs. 1.35b and 1.36b. You can
readily verify that
aft(noninv) =
ro/rd
1 + R2/R1 + (R1 + ro)/rd + ro/R1
(1.75a)
aft(inv) =
ro/R1
1 + R2/R1 + (R1 + ro) /rd + ro/R1
(1.75b)
Finally, the quantity
T =
a
1 + R2/R1 + (R1 + ro)/rd + ro/R1
(1.76)
is an important parameter that, for reasons that will be explained below, we shall call
the return-ratio loop gain (this, to distinguish T from the parameter L of the previous
section, which shall henceforth be referred to as the two-port loop gain). We visualize
Eq. (1.72) as in Fig. 1.37, which you are encouraged to compare with Fig. 1.34 for
similarities as well as differences. We wish to make a number of observations:
(a) For each circuit aft is proportional to ro, so for ro →0 both gains vanish as the
feedthroughsignalgetsshuntedtothedependentsource.Notealsothataft(noninv)
has the same polarity as Aideal whereas aft(inv) has the opposite polarity.
(b) Since vI propagates via rd in the noninverting case and via R1 in the inverting
case, the feedthrough gains are inversely proportional to these resistances. For
large rd we have aft(noninv) << aft(inv).
(c) For rd →∞and ro →0, Eq. (1.76) predicts
T →
a
1 + R2/R1
= L
(1.77)
for both circuits. In a good-quality op amp rd is large and ro is small, so for the
present circuits T will be somewhat lower than L (though presumably not by much),
and aft will not be that large, indicating that by the time aft gets divided by 1 + T ,
its contribution to A is likely to be negligible for large T .

40
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
xo
Ro
xi
TAideal
1/Aideal
+
++
–
aft
Ri
Σ
Σ
Source
Load
FIGURE 1.37
Negative-feedback system representation in terms of Aideal,
T , and aft.
The Return Ratio of an Op Amp
Though Eq. (1.76) was a by-product of the foregoing analysis, T can be calculated
directly as follows2,3: (a) set the input source (or sources in multiple-input circuits
such as summing or difference ampliﬁers) to zero, (b) break the circuit right at the
dependent source’s output, (c) inject a test voltage vT downstream of the source,
(d) ﬁnd the voltage avD returned by the source, and (e) obtain T as the negative of
the ratio of the returned voltage to the applied test voltage (hence the designation
return ratio)
T = −avD
vT
(1.78)
(In Chapter 8 we shall discuss how to measure T .) A few examples will better
illustrate the procedure.
EXAMPLE 1.11.
Repeat Example 1.9, but using return-ratio analysis. Compare and
comment.
Solution.
(a) The circuit is shown in Fig. 1.38a. Setting iI to zero, breaking the circuit right at
the dependent source’s output, and injecting a test voltage vT yields Fig. 1.38b. By
inspection,
avD = −a
R1
R1 + RL
vT
T = −avD
vT
=
a
1 + RL/R1
= L =
100
1 + 10/10 = 50
Setting the dependent source to zero leads us to Fig. 1.38c, where the current divider
formula gives
aft = iO
iI
= −
R1
R1 + RL
= −0.5 A/A
indicating that this circuit has aft ̸= 0 even though ro = 0 has been assumed. As we
already know, Aideal = −(1 + R2/R1) = −3 A/A, so Eq. (1.72) gives
Ai =
−3
1 + 1/50 + −0.5
1 + 50 = −2.9412 −0.0098 = −2.9510 A/A
indicating a contribution by aft of 0.0098/2.9510 = 0.33%.

41
SECTION 1.7
The Return Ratio
and Blackman’s
Formula
+
–
–
+
+–
R1
R2
vT
RL
vD
avD
RL
a
(a)
(b)
(c)
+
–
R1
R2
iI
R1
RL
R2
iI
iO
iO
FIGURE 1.38
(a) Circuit of Example 1.11. Circuits to ﬁnd (b) T and (c) aft.
(b) For RL = 0 we get T = 100 and aft = −1 A/A, so
Ai =
−3
1 + 1/100 +
−1
1 + 100 = −2.9703 −0.0099 = −2.9802 A/A
For RL = 0 both T and aft double, so the percentage contribution due to aft remains
about the same. Compared to the two-port analysis of Example 1.9, return-ratio
analysis provides a 0.33% gain correction stemming from the bilateral nature of the
feedback network (this, even though rd →∞and ro →0 are assumed). Note also
that T and L coincide in this particular example.
EXERCISE 1.1.
Use return-ratio analysis to verify Eq. (1.76).
EXAMPLE 1.12.
(a) Perform the return-ratio analysis of the noninverting ampliﬁer of
Fig. 1.39a, shown in a more general setting that includes also a source resistance Rs
and a load resistance RL. (b) Assuming an (mediocre) ampliﬁer with a = 1000 V/V,
rd = 10 k, and ro = 1.0 k, ﬁnd the overall source-to-load voltage gain vL/vS if
R1 = 1.0 k, R2 = 9.0 k, Rs = 15 k, and RL = 3.0 k.
Solution.
(a) Turning ﬁrst to Fig. 1.39b, we start out at the left and work our way toward the right
via repeated application of the voltage divider formula to get
avD = a
−rd
Rs + rd
×
(Rs + rd)//R1
(Rs + rd)//R1 + R2
×
[(Rs + rd)//R1 + R2]//RL
[(Rs + rd)//R1 + R2]//RL + ro
vT
Applying Eq. (1.78), we get, after minor algebra
T = a ×
1
1 + Rs
rd
×
1
1 +
R2
(Rs +rd)//R1
×
1
1 +
ro
[(Rs +rd)//R1 + R2]//RL
Next, we start at the right of Fig. 1.39c and apply the voltage divider formula twice,
vL =
ro//RL
R2 + ro//RL
×
R1//(R2 + ro//RL)
Rs + rd + R1//(R2 + ro//RL)vS

42
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
or
aft = vL
vS
=
1
1 +
R2
ro//RL
×
1
1 +
Rs + rd
R1//(R2 + ro//RL)
(b) Plugging in the given data we get
T = 103× 1
2.5×
1
10.36×
1
1.434 = 26.93
aft = 1
13×
1
28.56 = 2.693×10−3 V/V
Also, Aideal = 1 + R2/R1 = 1 + 9/1 = 10 V/V, so Eq. (1.72) ﬁnally gives,
vL
vS
=
10
1 + 1/26.93 + 2.693 × 10−3
1 + 26.93
= 9.642 + 9.64 × 10−5 = 9.642 V/V
Evidently aft has a negligible effect in this case. Note that in this example return-ratio
analysis has taken automatically into account both Rs and RL.
R2
ro
R1
+–
rd
avD
+
–
RL
Rs
vT
+
–
vD
+
–
R1
R2
(c)
(b)
vL
rd
Rs
ro
RL
vS
+
–
–
R2
R1
vS
vL
Rs
Ri
a
+
(a)
+
–
RL
Ro
FIGURE 1.39
(a) Circuit of Example 1.12. Circuits to ﬁnd (b) T and (c) aft.
Blackman’s Impedance Formula
The return ratio provides a powerful tool also for the calculation of the closed-loop
resistance R between any pair of nodes of a negative-feedback circuit—not just the
nodes of the input and output ports. Such a resistance is found via the Blackman’s
impedance formula6 as
R = r0
1 + Tsc
1 + Toc
(1.79a)
where
r0 = lim
a→0 R
(1.79b)
is the resistance between the given node pair with the dependent source avD set to
zero, and Tsc and Toc are the return ratios with the two nodes short-circuited and
open-circuited, respectively. Blackman’s formula holds regardless of the feedback
topology in use.2 Typically, either Tsc or Toc is zero, indicating a series topology if
Toc = 0, and a shunt topology if Tsc = 0.

43
SECTION 1.7
The Return Ratio
and Blackman’s
Formula
R2
ro
R1
+–
rd
avD
+
–
RL
vT
+
–
vD
+
–
(b)
R1
R2
(a)
rd
r0i
ro
RL
FIGURE 1.40
Circuits to ﬁnd the noninverting ampliﬁer’s input resistance Ri via
Blackman’s formula.
EXAMPLE 1.13.
For the noninverting ampliﬁer of Example 1.12, use Blackman’s for-
mula to ﬁnd (a) the resistance Ri presented to the input source and (b) the resistance Ro
presented to the output load.
Solution.
(a) Theinput-portresistancewiththedependentsourcesettozeroisshowninFig.1.40a,
where
r0i = rd + R1// (R2 + ro + RL)
With the input port open-circuited as in Fig. 1.40b, no current ﬂows through rD, so
vD = 0 and thus Toc = 0. Short-circuiting the input port turns the circuit into that
of Fig. 1.39b, but with Rs = 0. Recalculating,
Tsc = a×
1
1 +
R2
rd//R1
×
1
1 +
ro
(rd//R1 + R2)//RL
Ri = r0i
1 + Tsc
1 + 0 = r0i(1 + Tsc)
R2
ro
R1
+–
rd
avD
+
–
Rs
vT
+
–
vD
+
–
(b)
R1
R2
(a)
rd
Rs
r0o
ro
FIGURE 1.41
Circuits to ﬁnd the noninverting ampliﬁer’s output resistance Ro via Blackman’s
formula.

44
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
(b) Theoutput-portresistancewiththedependentsourcesettozeroisshowninFig.1.41a,
where
r0o = ro//[R2 + R1//(rd + Rs)]
With the output port open-circuited as in Fig. 1.41b, the circuit reduces to that of
Fig. 1.39b but with RL = ∞. Recycling, and using the fact that short-circuiting the
output port gives vD = 0 and thus Tsc = 0, we get
Toc = a ×
1
1 +
R2
rd//R1
×
1
1 +
ro
rd//R1 + R2
Ro = r0o
1 + 0
1 + Toc
=
r0o
1 + Toc
EXAMPLE 1.14.
The inverting ampliﬁer of Fig. 1.42a utilizes a T network in its feed-
back loop to achieve a high gain while using a relatively large resistance R1 to ensure
high input resistance. (a) Assuming an op amp with a = 105 V/V, rd = 1.0 M, and
ro = 100 , ﬁnd Aideal, T , and A if R1 = R2 = 1.0 M, R3 = 100 k, and R4 = 1.0 k.
Can you ignore feedthrough in this case? (b) Use Blackman’s formula to estimate the
input and output resistances Ri and Ro. Verify with PSpice.
Solution.
(a) In the ideal case we have vN = 0, and the voltage at the node common to R2, R3, and
R4 is, by the inverting-ampliﬁer formula, vX = −(R2/R1)vI. Summing currents at
vX gives (0 −vX)/R2 + (0 −vX)/R4 + (vO −vX)/R3 = 0. Eliminating vX and
solving for the ratio vO/vI gives
Aideal = −R2
R1

1 + R3
R2
+ R3
R4

= −101.1 V/V
Turning to Fig. 1.42b, we apply the voltage divider formula twice to write
vD = −
R1//rd
R1//rd + R2
×
[R1//rd + R2]//R4
[R1//rd + R2]//R4 + R3 + ro
vT = −vT
303.5
so Eqs. (1.78) and (1.72) give
T = −
105
−303.5 = 329.5
A ∼=
Aideal
1 + 1/T =
−101.1
1 + 1/329.5 = −100.8 V/V
Feedthrough around the op amp takes place via the high-resistance path R1–R2, gets
shunted by the comparatively low resistance R4, and what’s left continues via the
high-resistance path R3, to get shunted once again by the low resistance ro, so we
can indeed ignore the term aft/(1 + T ) in this example.
(b) To ﬁnd Ri, note that the resistance presented by the input port in the limit
avD →0 is
r0i = R1 + rd//[R2 + R4//(R3 + ro)] = 1.5002 M
With the input port short-circuited, we have Tsc = T = 329.5. With the input port
open-circuited, we have Toc = T (R1 = ∞), so recalculating we get Toc = 494.3.
By Blackman’s formula,
Ri = 1.50021 + 329.5
1 + 494.3 = 1.001 M

45
SECTION 1.7
The Return Ratio
and Blackman’s
Formula
(a)
+
–
R1
R2
R4
R3
+
–
vO
a
vI
Ri
Ro
R1
R2
R4
(b)
vD
rd
ro
R3
vT
+
–
–
+
FIGURE 1.42
(a) Inverting ampliﬁer with T network, and (b) circuit to ﬁnd its return ratio ℜ.
To ﬁnd Ro, note that the resistance presented by the output port in the limit avD →0
is
r0o = ro//(R3 + · · ·) ∼= ro = 100 
In this case Tsc = 0 and Toc = T = 329.5, so
Ro = 100
1 + 0
1 + 329.5 = 0.302 
A PSpice simulation conﬁrms all the above calculations.
Comparing T and L
Though T and L may seem deceptively similar, they are generally different. Because
of feedthrough, T and L contribute differently to the closed-loop gain A, as depicted
in Figs. 1.37 and 1.34. Even when T = L, as it was the case in Example 1.11 because
of the assumptions rd = ∞and ro = 0, the contributions to A still differ because of
aft. Compared to the analysis based on L, that based on T is more insightful because
it splits A into two separate components, both stemming from forward transmission,
but one through the error ampliﬁer and the other through the feedback network. The
analysis based on L, instead, lumps all forward transmission exclusively through the
error ampliﬁer so as to conform to the simpler diagram of Fig. 1.34. As such, it gives
only approximate results compared to the exact results of return-ratio analysis,2
though the difference may be very slight if T and L are sufﬁciently large.
It is apparent from Eq. (1.72) that if the condition
| aft |≪| T Aideal |
(1.80)
is met, we can ignore the feedthrough component in Eq. (1.72), after which Eq. (1.72)
becomes formally identical to Eq. (1.68a), though T and L may still differ and thus
give slightly different values of A. It is instructive to view the signal component
aftvI that manages to creep to the output as a form of output noise. Reﬂected to
the input, this noise gets divided by the gain TAideal, thus resulting in the equivalent
input noise aftvI /(TAideal). As long as Eq. (1.80) is met, this component will be

46
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
much smaller than vI , so the fact that the feedback network is not unilateral is of
little consequence in this case.
In Chapter 6 we will see that the gain a of an op amp rolls off with frequency,
in turn causing both T and L to decrease at high frequencies. Moreover, because
of reactive parasitics, rd turns capacitive at high frequencies, and ro may exhibit
inductive behavior, further accentuating the difference between L and T , and also
causing aft to increase with frequency, at least up to a point. Combine this with the
frequency rolloff of T , and we have good reason to expect the component of A due
to aft in Eq. (1.72) to become more relevant at high frequencies.
But, there are additional reasons for us to favor return-ratio analysis. The deriva-
tion of L in the examples of the previous section required that we ﬁrst identify the
feedback topology by examining the type of summing and sampling, and then that
we derive aε and b separately to ﬁnally ﬁnd L = aεb. By contrast, the derivation
of T is a one-shot affair, regardless of the topology. (For topology identiﬁcation we
can always enlist Blackman’s formula, which indicates a series type if Tsc prevails,
a shunt type if Toc prevails.) So, why bother with L at all? Fact is, there is a large
body of literature, known as two-port analysis,2,3 which derives L by dissecting a
feedback circuit into a feedback block with b depending exclusively on the com-
ponents of the feedback network, and an ampliﬁer block with aε lumping together
both ampliﬁcation and loading by the feedback network. By contrast (we shall see
in greater detail in Chapter 6), return-ratio analysis shifts loading from the ampliﬁer
to the feedback network to establish an alternative form of feedback factor that we
shall denote as β to distinguish it from the factor b of two-port analysis. Although
introduced by H. W. Bode4 in the mid-nineteen forties, the return-ratio viewpoint
has gained increasing prominence only more recently.5,7,8
1.8
OP AMP POWERING
In order to function, op amps need to be externally powered. Powering serves the
twofold purpose of biasing the internal transistors and providing the power that the
op amp must in turn supply to the output load and the feedback network. Figure 1.43
shows a recommended way of powering ops amps (though the ﬁgure shows the
bipolar supplies VCC and VE E, the present considerations hold also for the CMOS
supplies VDD and VSS). To prevent the ac noise usually present on the supply lines
from interfering with the op amps, the supply pins of each IC must be bypassed
to ground by means of low-inductance capacitors (0.1-μF ceramic capacitors are
usually adequate). These decoupling capacitors also help neutralize any spurious
feedback loops arising from the nonzero impedances of the supply and ground lines,
or busses, which might pose stability problems. For this cure to be effective, the
leads must be kept short to minimize their distributed inductance, which rises at the
rate of about 1 nH/mm, and the capacitors must be mounted as close as possible to
the op amp pins. A well-constructed circuit board will also include 10-μF polarized
capacitors at the points of entry of the supply voltages to provide board-level bypass.
Moreover, using wide ground traces will help maintain an electrically clean ground
reference.

47
SECTION 1.8
Op Amp Powering
+
–
+
–
+
+
GND
VCC
VEE
15 V
15 V
10 μF
10 μF
0.1 μF
0.1 μF
0.1 μF
0.1 μF
+
+
FIGURE 1.43
Op amp powering with bypass capacitors.
Typically, op amps are powered by means of a dual regulated power supply.
Though the ±15-V values shown in Fig. 1.43 have long been the standard in analog
systems, today’s mixed-mode products incorporating both digital and analog func-
tions on the same chip call for a single, lower-valued supply such as VCC = 5 V and
VE E = 0, or VDD = 3.3 V and VSS = 0, or, in more recent devices, VDD = 0.8 V
and VSS = 0. To reduce cluttering, the power supplies are normally omitted from
circuit diagrams.
Current Flow and Power Dissipation
Since virtually no current ﬂows in or out of the input pins of an op amp, the only
current-carrying terminals are the output and the supply pins. We shall designate
their currents as iO, iCC, and iE E. Since VCC is the most positive and VE E the most
negative voltage in the circuit, under proper operation iCC will always ﬂow into and
iE E always out of the op amp. However, iO may ﬂow either out of or into the op
amp, depending on circuit conditions. In the former case the op amp is said to be
sourcing current, and in the latter it is sinking current. At all times, the three currents
must satisfy KCL. So for an op amp sourcing current we have iCC = iE E +iO, and
for an op amp sinking current we have iE E = iCC + iO.
In the special case in which iO = 0, we have iCC = iE E = IQ, where IQ
is called the quiescent supply current. This is the current that biases the internal
transistors to keep them electrically alive. Its magnitude depends on the op amp type
and, to a certain extent, on the supply voltages; typically, IQ is in the milliampere
range. Op amps intended for portable equipment applications may have IQ in the
microampere range and are therefore called micropower op amps.
Figure 1.44 shows current ﬂow in the noninverting and inverting circuits, both
for the case of a positive and a negative input. Trace each circuit in detail until you
are fully convinced that the various currents ﬂow as shown. Note that the output
current consists of two components, one to feed the load and the other to feed the
feedback network. Moreover, the ﬂow of currents IQ and iO through the op amp
causes internal power dissipation. This dissipation must never exceed the maximum
rating speciﬁed in the data sheets.

48
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
+
+
–
R1
RL
vO
VEE
VCC
R2
IQ
iO
+
+
–
R1
RL
vO
VEE
VCC
R2
IQ
iO
+
–
R1
RL
vO
VEE
VCC
R2
IQ
iO
+
–
R1
RL
vO
VEE
VCC
R2
IQ
iO
vI > 0
vI < 0
vI > 0
vI < 0
+
+
(a)
(b)
(c)
(d)
FIGURE 1.44
Current ﬂow for the noninverting [(a) and (b)] and the inverting [(c) and (d)] ampliﬁers.
EXAMPLE 1.15.
An inverting ampliﬁer with R1 = 10 k, R2 = 20 k, and vI = 3 V
drives a 2-k load. (a) Assuming ±15-V supplies and IQ = 0.5 mA, ﬁnd iCC, iE E, and
iO. (b) Find the power dissipated inside the op amp.
Solution.
(a) With reference to Fig. 1.44c, we have vO = −(20/10)3 = −6 V. Denoting the
currents through RL, R2, and R1 as iL, i2, and i1, we have iL = 6/2 = 3 mA, and i2 =
i1 = 3/10 = 0.3 mA. Thus, iO = i2 + iL = 0.3 + 3 = 3.3 mA; iCC = IQ = 0.5 mA;
iE E = iCC + iO = 0.5 + 3.3 = 3.8 mA.
(b) Whenever a current i experiences a voltage drop v, the corresponding power is p =
vi. Thus, pO A = (VCC −VE E)IQ + (vO −VE E)iO = 30 × 0.5 + [−6 −(−15)] ×
3.3 = 44.7 mW.
EXAMPLE 1.16.
When experimenting with op amps, it is handy to have a variable
source over the range −10 V ≤vS ≤10 V. (a) Design one such source using a 741 op
amp and a 100-k potentiometer. (b) If vS is set to 10 V, how much does it change when
we connect a 1-k load to the source?
Solution.
(a) We ﬁrst design a resistive network to produce an adjustable voltage over the range
−10 V to +10 V. As shown in Fig. 1.45, where we use a concise notation for the
supply voltages, this network consists of the potentiometer and two 25-k resistors

49
SECTION 1.8
Op Amp Powering
+
–
RL
vS
vW
741
A
B
25 kΩ
25 kΩ
100 kΩ
–15 V
+15 V
FIGURE 1.45
Variable source from −10 V to +10 V.
to drop 5 V each, so that vA = 10 V and vB = −10 V. By turning the wiper, we
can vary vW over the range −10 V ≤vW ≤10 V. However, if a load is connected
directly to the wiper, vW will change signiﬁcantly because of the loading effect. For
this reason we interpose a unity-gain buffer, as shown.
(b) Connecting a 1-k load will draw a current iL = 10/1 = 10 mA. The output
resistance is Ro =ro/(1 + T ) = 75/(1 + 200,000) = 0.375 m. The source change
is thus vS = RoiL = 0.375 × 10−3 × 10 × 10−3 = 3.75 μV—quite a small
change! This demonstrates a most important op amp application, namely, regulation
against changes in the load conditions.
Output Saturation
The supply voltages VCC and VE E set upper and lower bounds on the output swing
capability of the op amp. This is best visualized in terms of the VTC of Fig. 1.46,
which reveals three different regions of operation.
In the linear region the curve is approximately straight and its slope represents
the open-loop gain a. With a as large as the 741s 200,000 V/V, the curve is so steep
that it practically coalesces with the vertical axis, unless we use different scales
for the two axes. If we express vO in volts and vD in microvolts, as shown, then
the slope becomes 0.2 V/μV. As we know, op amp behavior within this region is
modeled with a dependent source of value avD.
As vD is increased, vO increases in proportion until a point is reached where
internal transistor saturation effects take place that cause the VTC to ﬂatten out. This
is the positive saturation region, where vO no longer depends on vD but remains
ﬁxed, making the op amp behave as an independent source of value VOH. Similar
considerations hold for the negative saturation region, where the op amp acts as an
independent source of value VOL. Note that in saturation vD is no longer necessarily
in the microvolt range!
The 741 data sheets, reproduced at the end of Chapter 5, indicate that with
±15-V supplies and with a typical output load of 2 k, the 741 saturates at ±Vsat ∼=
±13 V, that is, within 2 V of the supply rails. The output voltage swing, deﬁned as
OVS = VO H −VOL, is in this case OVS ∼= 13 −(−13) = 26 V, also expressed
as OVS ∼= ±13 V. Moreover, since 13/200,000 = 65 μV, the input voltage range
corresponding to the linear region is thus −65 μV ≤vD ≤+65 μV.

50
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
+
+
–
–
+
vD
vO
vO
vO
vO (V)
vD  (μV)
avD
+
+
–
–
vD
VOH
VOH
VOL
VOL/a
VOH/a
VOL
+
+
–
–
vD
a
Linear region
Upper saturation region
Lower saturation region
+
+
FIGURE 1.46
Regions of operation and approximate op amp models.
If the supplies are other than ±15 V, the 741 saturation voltages will change
accordingly. For instance, a 741 powered from a single 9-V battery and driving a
2-k load can be assumed to saturate at VO H ∼= 9 −2 = 7 V and VOL ∼= 0 + 2 =
2 V, so now OVS ∼= 7 −2 = 5 V.
In single-supply systems, such as mixed digital-analog systems with VCC = 5 V
and VEE = 0 V, signals are usually constrained within the range of 0 V to 5 V. The
need arises for a reference voltage at (1/2)VCC = 2.5 V for termination of all analog
sources and loads, and thus allow for symmetric voltage swings about this common
reference. In Fig. 1.47 this voltage is synthesized by the R-R voltage divider, and is
then buffered by OA1 to provide a low-resistance drive. To maximize the dynamic
range of signals, OA2 is typically a device with rail-to-rail output capabilities, or
VOH ∼= 5 V and VOL ∼= 0 V. The TLE2426 Rail Splitter is a 3-terminal chip containing
+
–
R1
R2
R
R
vI
vO
RL
OA1
2.5 V
VCC (5 V)
+
–
OA2
+
+
–
FIGURE 1.47
Synthesis of a 2.5-V common reference voltage in a 5-V
single-supply system.

51
SECTION 1.8
Op Amp Powering
all circuitry needed for the synthesis of a precision 2.5-V common reference with a
7.5-m output resistance.
When an op amp is used in the negative-feedback mode, its operation must be
conﬁned within the linear region because only there is the op amp capable of inﬂu-
encing its own input. If the device is inadvertently pushed into saturation, vO will
remain ﬁxed and the op amp will no longer be able to inﬂuence vD, thus resulting
in completely different behavior.
SPICE Simulation
The basic 741 SPICE model of Fig. 1.5 does not saturate. To simulate saturation, we
use the limiter block available in the PSpice library. The PSpice circuit of Fig. 1.48a
(a)
ro
vO
R1
vI
I
O
N
rd
2 MΩ
10 kΩ
75 Ω
0
200 V/mV
EOA
+
–
+
–
+
–
0
R2
20 kΩ
–13 V
13 V
0
0
–20 V
–10 V
0
10 V
20 V
0.25
0.5
0.75
1.0
1.25
1.5
0
–2.33 V
0
2.33 V
0.25
0.5
0.75
Time t (ms)
(b)
1.0
1.25
1.5
vN
vO
vI
FIGURE 1.48
(a) Inverting ampliﬁer and (b) waveforms
when the op amp is driven in saturation.

52
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
uses a ±13 V limiter to simulate a 741 op amp operating as an inverting ampliﬁer
with a gain of A = −20/10 = −2 V/V.
If we drive the circuit with a triangular wave of, say,±5-V peak values, the output
will be an (inverted) triangular wave of ∓10-V peak values, which are well within the
permissible output range of ±13 V. Moreover, the inverting input vN = −vO/a will
also be a triangular wave of ±10/200,000 = ±50-μV peak values, small enough
for vN to be considered fairly close to a virtual ground. However, if we overdrive the
circuit with a triangular wave of ±10-V peak values as shown, we cannot expect it to
yield an (inverted) wave of ∓20-V peak values because they exceed the permissible
output range. The circuit will give vO = −2vI only so long as the op amp is allowed
to operate within its linear region, −13 V ≤vO ≤+13 V, in turn corresponding to
−6.5 V ≤vI ≤+6.5 V. As soon as vI exceeds this range, vO will saturate at ±13 V,
resulting in the clipped waveform shown in Fig. 1.48b.
It is instructive to observe also the waveform vN, which is close to a virtual
groundonlysolongastheopampiswithinitslinearregion.Oncedriveninsaturation,
the op amp is deprived of its ability to inﬂuence vN via the feedback network, so
vN will no longer approximate a virtual ground. In saturation we have, by the
superposition principle,
vN(sat) =
R2
R1 + R2
vI +
R1
R1 + R2
(±Vsat) = 2
3vI + 1
3(±13) = 2vI ± 13 V
3
In particular, when vI peaks at 10 V, vN(sat) peaks at (2 × 10 −13)/3 = 2.33 V,
as shown in the ﬁgure (by symmetry, vN(sat) peaks at −2.33 V when vI peaks at
−10 V).
Clipping is a form of distortion because the output waveform of a linear ampliﬁer
is expected to have the same shape as the input. Clipping is generally undesirable,
though there are situations in which it is exploited on purpose to achieve speciﬁc
effects. To avoid clipping, we must either keep vI below a suitable level, or suitably
lower the ampliﬁer’s gain A.
PROBLEMS
1.1 Ampliﬁer fundamentals
1.1 A voltage ampliﬁer of the type of Fig. 1.1 is fed by a 200-mV source and drives a 10-
load. Voltmeter measurements give vI = 150 mV and vO = 10 V. If disconnecting
the load causes vO to rise to 12 V, and then connecting a 30-k resistor across the
input-port terminals causes vO to drop from 12 V to 9.6 V, ﬁnd Rs, Ri, Aoc, and Ro.
1.2 A source vS with a 1-k internal resistance is fed to a current ampliﬁer of the type of
Fig. 1.2 having Ri = 200 , Asc = 180 A/A, and Ro = 10 k. The ampliﬁer in turn
drives a load RL = 2 k, whose voltage is denoted as vL. Sketch and label the circuit,
and ﬁnd the voltage gain vL/vS as well as the power gain pL/pS, where pS is the power
released by the source vS and pL is that absorbed by the load RL.
1.3 Sketch and label a transresistance ampliﬁer being driven by a source iS = 3 μA with
internal resistance Rs = 100 k. Given that the voltage across the input port is 50 mV,

53
Problems
and the output-port open-circuit voltage and short-circuit current are, respectively, 10 V
and 20 mA, ﬁnd Ri, Aoc, and Ro, as well as the gain vO/iS, if the ampliﬁer is terminated
on a 1.5-k load.
1.4 Sketch and label a transconductance ampliﬁer that is driven by a source vS = 150 mV
having a 100-k internal resistance, and drives a load RL. Given that vI = 125 mV,
iL = 230 mA for RL = 40 , and iL = 220 mA for RL = 60 , ﬁnd Ri, Aoc and Ro.
What is its short-circuit output current with vS = 100 mV?
1.5 A transresistance ampliﬁer with Ri1 = 100 , Aoc1 = 0.2 V/mA, and Ro1 = 100 ,
is driven by a source iS having internal resistance Rs = 1 k, and drives in turn a
transconductance ampliﬁer having Ri2 = 1 k, Asc2 = 100 mA/V, and Ro2 = 100 k.
The latter, in turn, drives a 25-k load. Sketch and label the circuit, and ﬁnd the source-
to-load current gain iL/iS as well as the power gain pL/pS, where pS is the power
released by the source vS and pL is that absorbed by the load RL.
1.2 The operational ampliﬁer
1.6 Given an op amp withrd ∼= ∞,a = 104 V/V, andro ∼= 0, ﬁnd (a) vO if vP = 750.25 mV
and vN = 751.50 mV, (b) vN if vO = −5 V and vP = 0, (c) vP if vN = vO = 5 V, and
(d) vN if vP = −vO = 1 V.
1.7 An op amp with rd = 1 M, a = 100 V/mV, and ro = 100  is driving a 2-k load
and is part of a circuit such that vP = −2.0 mV and vO = −10 V. Sketch the circuit,
and ﬁnd the voltages across and the currents through rd and ro (make sure you indicate
voltage polarities and current directions). What is the value of vN?
1.3 Basic op amp conﬁgurations
1.8 (a) Find the minimum value of a needed to ensure that the gain of the voltage follower
of Fig. 1.8a does not depart from +1.0 V/V by more than 0.01%. (b) Repeat, but for
the case of the inverting ampliﬁer of Fig. 1.10a conﬁgured for a gain of −1.0 V/V with
R1 = R2. Why the difference?
1.9 (a) Design a noninverting ampliﬁer whose gain is variable over the range 1 V/V ≤A ≤
5 V/V by means of a 100-k pot. (b) Repeat (a) for 0.5 V/V ≤A ≤2 V/V. Hint: To
achieve A ≤1 V/V, you need an input voltage divider.
1.10 (a) A noninverting ampliﬁer is implemented with two 10-k resistances having 5%
tolerance. What is the range of possible values for the gain A? How would you
modify the circuit for the exact calibration of A? (b) Repeat, but for the inverting
ampliﬁer.
1.11 In the inverting ampliﬁer of Fig. 1.10a, let vI = 0.1 V, R1 = 10 k, and R2 = 100 k.
Find vO and vN if (a) a = 102 V/V, (b) a = 104 V/V, and (c) a = 106 V/V. Comment
on your ﬁndings.
1.12 (a) Design an inverting ampliﬁer whose gain is variable over the range −10 V/V
≤A ≤0 by means of a 100-k pot. (b) Repeat, but for −10 V/V ≤A ≤−1 V/V.
Hint: To prevent A from reaching zero, you must use a suitable resistor in series with
the pot.

54
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
1.13 (a) A source vS = 2 V with Rs = 10 k is to drive a gain-of-ﬁve inverting ampliﬁer
implemented with R1 = 20 k and R2 = 100 k. Find the ampliﬁer output voltage
and verify that because of loading its magnitude is less than 2 × 5 = 10 V. (b) Find the
value to which R2 must be changed if we want to compensate for loading and obtain a
full output magnitude of 10 V.
1.14 (a) A source vS = 10 V is fed to a voltage divider implemented with RA = 120 k and
RB = 30 k, and the voltage across RB is fed, in turn, to a gain-of-ﬁve noninverting
ampliﬁer having R1 = 30 k and R2 = 120 k. Sketch the circuit, and predict the
ampliﬁer output voltage vO. (b) Repeat (a) for a gain-of-ﬁve inverting ampliﬁer having
R1 = 30 k and R2 = 150 k. Compare and comment on the differences.
1.4 Ideal op amp circuit analysis
1.15 Find vN, vP, and vO in the circuit of Fig. P1.15, as well as the power released by the
4-V source; devise a method to check your results.
+
+
–
10 kΩ
30 kΩ
20 kΩ
vN
vO
vP
4 V
FIGURE P1.15
1.16 (a) Find vN, vP, and vO in the circuit of Fig. P1.16. (b) Repeat (a) with a 5-k resistance
connected between A and B.
vO
vN
vP
2 kΩ
4 kΩ
3 kΩ
1 kΩ
+
–
B
A
1 mA
FIGURE P1.16
1.17 (a) Find vN, vP, and vO in the circuit of Fig. P1.17 if vS = 9 V. (b) Find the resistance
R that, if connected between the inverting-input pin of the op amp and ground, causes
vO to double. Verify with PSpice.

55
Problems
+
–
+
vS
vN
vP
vO
20 kΩ
50 kΩ
40 kΩ
10 kΩ
FIGURE P1.17
1.18 (a) Find vN, vP, and vO in the circuit of Fig. P1.18. (b) Repeat (a) with a 40-k
resistance in parallel with the 0.3-mA source.
+
–
vN
vP
vO
10 kΩ
30 kΩ
20 kΩ
0.3 mA
FIGURE P1.18
1.19 (a) Find vN, vP, and vO in the circuit of Fig. P1.19 if iS = 1 mA. (b) Find a resis-
tance R that when connected in parallel with the 1-mA source will cause vO to drop to
half the value found in (a).
+
–
iS
vN
vP
vO
4 kΩ
3 kΩ
1 kΩ
2 kΩ
FIGURE P1.19
1.20 (a) Find the equivalent resistance seen by the current source in Fig. P1.16. Hint: Find
the voltage across the source, and then obtain the resistance as the ratio of voltage over
current. (b) Repeat for Fig. P1.18. (c) Repeat for Fig. P1.19.
1.21 (a) If the current source of Fig. P1.16 is replaced by a voltage source vS, ﬁnd the
magnitude and polarity of vS so that vO = 10 V. (b) If the wire connecting the 4-V
source to node vO in Fig. P1.15 is cut and a 5-k resistance is inserted in series between
the two, to what value must the source be changed to yield vO = 10 V?
1.22 In the circuit of Fig. P1.22 the switch is designed to provide gain-polarity control.
(a) Verify that A = +1 V/V when the switch is open, and A = −R2/R1 when the

56
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
switch is closed, so that making R1 = R2 yields A = ±1 V/V. (b) To accommodate
gains greater than unity, connect an additional resistance R4 from the inverting-input
pin of the op amp to ground. Derive separate expressions for A in terms of R1 through R4
with the switch open and with the switch closed. (c) Specify resistance values suitable
for achieving A = ±2 V/V.
+
–
R2
R1
R3
+
vI
vO
Switch
FIGURE P1.22
1.23 (a) Find the equivalent resistance seen by the voltage source of Fig. P1.15. Hint: Find
the current through the source, and then obtain the resistance as the ratio of voltage over
current. (b) Repeat for Fig. P1.17. (c) Repeat for Fig. P1.22 (consider both the case of
the switch open and closed).
1.24 In the circuit of Fig. P1.24 the pot is used to control gain magnitude as well as polarity.
(a) Letting k denote the fraction of R3 between the wiper and ground, show that varying
the wiper from bottom to top varies the gain over the range −R2/R1 ≤A ≤1 V/V,
so that making R1 = R2 yields −1 V/V ≤A ≤+1 V/V. (b) To accommodate gains
greater than unity, connect an additional resistance R4 from the op amp’s inverting-input
pin to ground. Derive an expression for A in terms of R1, R2, R4, and k. (c) Specify
resistance values suitable for achieving −5 V/V ≤A ≤+5 V/V.
+
–
R1
R3
kR3
+
vI
vO
R2
}
FIGURE P1.24
1.25 Consider the following statements about the input resistance Ri of the noninverting am-
pliﬁer of Fig. 1.15a: (a) Since we are looking straight into the noninverting-input pin,
which is an open circuit, we have Ri = ∞; (b) since the input pins are virtually
shorted together, we have Ri = 0 + (R1 ∥R2) = R1 ∥R2; (c) since the noninverting-
input pin is virtually shorted to the inverting-input pin, which is in turn a virtual-ground
node, we have Ri = 0 + 0 = 0. Which statement is correct? How would you refute the
other two?
1.26 (a) Show that the circuit of Fig. P1.26 has Ri = ∞and A = −(1 + R3/R4)R1/R2.
(b) Specify suitable components to make A variable over the range −100 V/V ≤A ≤0
by means of a 100-k pot. Try minimizing the number of resistors you use.

57
Problems
+
–
+
–
R3
R4
R1
+
vI
vO
R2
OA1
OA2
FIGURE P1.26
1.27 The audio panpot circuit of Fig. P1.27 is used to continuously vary the position of
signal vI between the left and the right stereo channels. (a) Discuss circuit operation.
(b) Specify R1 and R2 so that vL/vI = −1 V/V when the wiper is fully down, vR/vI =
−1 V/V when the wiper is fully up, and vL/vI = vR/vI = −1/
√
2 when the wiper is
halfway.
+
–
+
–
R2
R1
R2
R1
+
vI
vL
vR
10 kΩ
10 kΩ
10 kΩ
OA1
OA2
FIGURE P1.27
1.28 (a) Using standard 5% resistances in the kilohm range, design a circuit to yield vO =
−100(4v1 + 3v2 + 2v3 + v4). (b) If v1 = 20 mV, v2 = −50 mV, and v4 = 100 mV,
ﬁnd v3 for vO = 0 V.
1.29 (a) Using standard 5% resistances, design a circuit to give (a) vO = −10(vI + 1 V);
(b) vO = −vI + VO, where VO is variable over the range −5 V ≤VO ≤+5 V by
means of a 100-k pot. Hint: Connect the pot between the ±15-V supplies and use the
wiper voltage as one of the inputs to your circuit.
1.30 In the circuit of Fig. 1.18 let R1 = R3 = R4 = 10 k and R2 = 30 k. (a) If v1 = 3 V,
ﬁnd v2 for vO = 10 V. (b) If v2 = 6 V, ﬁnd v1 for vO = 0 V. (c) If v1 = 1 V, ﬁnd the
range of values for v2 for which −10 V ≤vO ≤+10 V.
1.31 You can readily verify that if we put the output in the form vO = A2v2 −A1v1 in the
circuit of Fig. 1.18, then A2 ≤A1 + 1. Applications requiring A2 ≥A1 + 1 can be
accommodated by connecting an additional resistance R5 from the node common to R1
and R2 to ground. (a) Sketch the modiﬁed circuit and derive a relationship between its

58
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
output and inputs. (b) Specify standard resistances to achieve vO = 5(2v2 −v1). Try
to minimize the number of resistors you use.
1.32 (a) In the difference ampliﬁer of Fig. 1.18 let R1 = R3 = 10 k and R2 = R4 = 100
k. Find vO if v1 = 10 cos(2π60t) −0.5 cos(2π103t) V, and v2 = 10 cos(2π60t) +
0.5 cos(2π103t) V. (b) Repeat if R4 is changed to 101 k. Comment on your ﬁndings.
1.33 Show that if all resistances in Fig. P1.33 are equal, then vO = v2 + v4 + v6 −v1 −
v3 −v5.
+
–
R2
R4
RP
RN
v1
v3
v5
vO
v2
v4
v6
R6
R1
R3
R5
FIGURE P1.33
1.34 Using a topology of the type of Fig. P1.33, design a four-input ampliﬁer such that
vO = 4vA −3vB + 2vC −vD. Try minimizing the number of resistors you use.
1.35 Using just one op amp powered from ±12-V regulated supplies, design a circuit to
yield: (a) vO = 10vI + 5 V; (b) vO = 10(v2 −v1) −5 V.
1.36 Using just one op amp powered from ±15-V supply voltages, design a circuit that
accepts an ac input vi and yields vO = vi + 5 V, under the constraint that the resistance
seen by the ac source be 100 k.
1.37 Design a two-input, two-output circuit that yields the sum and the difference of its
inputs: vS = vI1 + vI2, and vD = vI1 −vI2. Try minimizing the component count.
1.38 Obtain a relationship between vO and vI if the differentiator of Fig. 1.19 includes also
a resistance Rs in series with C. Discuss the extreme cases of vI changing very slowly
and very rapidly.
1.39 Obtain a relationship between vO and vI if the integrator of Fig. 1.20 includes also a
resistance Rp in parallel with C. Discuss the extreme cases of vI changing very rapidly
and very slowly.
1.40 In the differentiator of Fig. 1.19 let C = 10 nF and R = 100 k, and let vI be a periodic
signal alternating between 0 V and 2 V with a frequency of 100 Hz. Sketch and label
vI and vO versus time if vI is (a) a sine wave; (b) a triangular wave.
1.41 In the integrator of Fig. 1.20 let R = 100 k and C = 10 nF. Sketch and label vI(t)
and vO(t) if (a) vI = 5 sin(2π100t) V and vO(0) = 0; (b) vI = 5[u(t)−u(t −2 ms)] V

59
Problems
and vO(0) = 5 V, where u(t −t0) is the unit step function deﬁned as u = 0 for
t < t0, and u = 1 for t > t0.
1.42 Suppose the integrator of Fig. 1.20 has R = 100 k and C = 10 nF, and includes
also a 300-k resistance in parallel with C. (a) Assuming C is initially discharged,
sketch and label vO(t) if vI is changed from 0 V to +1 V at t = 0. Hint: The voltage
across the capacitor can be expressed as v(t ≥0) = v∞+ (v0 −v∞)exp[−t/(ReqC)],
where v0 is the initial voltage, v∞is the steady-state value to which v tends in the limit
t →∞(when C acts as an open circuit), and Req is the equivalent resistance seen by
C during the transient (to ﬁnd Req, use the test method). (b) Sketch and label vO(t) if
vI is changed to −0.5 V at the instant in which vO reaches −2 V.
1.43 Suppose the circuit of Fig. 1.42a uses 20-k resistances throughout, and includes also
a capacitance C = 10 nF between the output node and the inverting input node of the
op amp. Assuming C is initially discharged, sketch and label vO(t) if vI is changed
from 0 V to +1 V at t = 0 (use the hint of Problem 1.42).
1.44 Show that if the op amp of Fig. 1.21b has a ﬁnite gain a, then Req = (−R1R/R2)×
[1 + (1 + R2/R1)/a]/[1 −(1 + R1/R2)/a].
1.45 Find an expression for Ri in Fig. P1.45; discuss its behavior as R is varied over the
range 0 ≤R ≤2R1.
+
–
R2
R1
R2
R1
R
Ri
FIGURE P1.45
1.46 The circuit of Fig. P1.46 can be used to control the input resistance of the inverting
ampliﬁer based on OA1. (a) Show that Ri = R1/(1 −R1/R3). (b) Specify resistances
suitable for achieving A = −10 V/V with Ri = ∞.
+
–
+
–
2R1
R1
R2
R2
R3
OA1
OA2
+
vI
Ri
vO
FIGURE P1.46

60
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
1.5 Negative feedback
1.47 (a) Find the feeback factor b of a negative-feedback system with aε = 103 and A = 102.
(b) Find A exactly via Eq. (1.40), and approximately via Eq. (1.49) if aε drops by 10%.
(c) Repeat (b) for a 50% drop in aε; compare with (b) and comment.
1.48 You are asked to design an ampliﬁer with a gain A of 102 V/V that is accurate
to within ±0.1%, or A = 102 V/V ± 0.1%. All you have available are ampliﬁer
stages with aε = 104 V/V ± 25% each. Your ampliﬁer can be implemented using
a cascade of basic stages, each employing a suitable amount of negative feedback.
What is the minimum number of stages required? What is the feedback factor b of
each stage?
1.49 A certain op amp has been conﬁgured as an inverting ampliﬁer with two identical
10-k resistors, and is driven by a 1-kHz sinusoidal wave having ±5-V peak values.
Unfortunately, because of a fabrication error, the device exhibits a = 10 V/mV for
vO > 0, but only a = 2.5 V/mV for vO < 0. Sketch and label vI, vO, and vN versus
time, and explain whether the device can still be used for the intended application.
1.50 The open-loop VTC of a certain op amp has a slope of 5 V/mV for |vO| ≤2 V, and
2 V/mV for |vO| > 2 V. The op amp is used as a unity-gain voltage buffer, and is driven
by a triangular wave with peak values of +4 V and −1 V, respectively. Sketch and label
the open-loop VTC as well as the plots of vI, vO, and vD versus time.
1.51 A crude BJT power ampliﬁer of the class B (push-pull) type exhibits the VTC of
Fig. P1.51b. The dead band occurring for −0.7 V ≤v1 ≤+0.7 V causes a crossover
distortion at the output that can be reduced by preceding the power stage with a pream-
pliﬁer stage and then using negative feedback to reduce the dead band. This is shown
in Fig. P1.51a for the case of a difference preampliﬁer with gain a1 and b = 1 V/V.
(a) Sketch and label the closed-loop VTC if a1 = 102 V/V. (b) Sketch vI, v1, and vO
versus time if vI is a 100-Hz triangular wave with peak values of ±1 V.
+
–
+
vI
a1
v1
vO
vO (V)
v1 (V)
VCC
VEE
RL
–0.7
0.7
1
1
(a)
(b)
FIGURE P1.51
1.52 A certain audio power ampliﬁer with a signal gain of 10 V/V is found to produce a 2-V
peak-to-peak 120-Hz hum. We wish to reduce the output hum to less than 1 mV without
changing the signal gain. To this end, we precede the power stage with a preampliﬁer
stage with gain a1 and then apply negative feedback around the composite ampliﬁer.
What are the required values of a1 and b?

61
Problems
1.6 Feedback in op amp circuits
1.53 (a) Develop an expression of the type of Eq. (1.52) for the shunt-series circuit
of Fig. 1.30b. Then, extract exact expressions for aε and b, and show that for aε ≫1 the
expressions reduce to those of Eq. (1.62). (b) Repeat the calculations of Example 1.9,
but using the exact expressions, and compare with the results of the example.
1.54 In the series-series circuit of Fig. P1.54 let a = 104 V/V, R1 = 1 k, R2 = 2 k, and
R3 = 3 k. Use direct analysis to obtain an expression of the type iO = AgvI −vL/Ro.
What are the values of Ag and Ro?
–
+
R2
R1
R3
vI
a
+
–
+
– LD
iO
vL
FIGURE P1.54
1.55 In the analysis leading to Eq. (1.65) we deliberately omitted rd for simplicity. If we
include rd, then Eq. (1.65) changes to Ri = rd//[(R + ro)/(1 + a)]. Alternatively, we
can adapt Eq. (1.69) and write Ri = r0/(1 + L). Find r0 and L, and prove that the two
methods provide the same result, as it should be.
1.56 Using the op amp model of Fig. 1.4 with a = 104 V/V, ﬁnd the resistance seen by the
source vI and that seen by the source iI in Fig. 1.29 if R1 = 1.0 k and R2 = 100 k.
Why the difference?
1.57 In the series-series circuit of Fig. 1.30a let a = 103 V/V and R = 1.0 k. (a) Assuming
the load is a voltage source vL (positive at the top), calculate aε, b, L, Ag and the
resistance Ro seen by the load. (b) Assuming vI = 1.0 V, ﬁnd iO for vL = 0, vL = 5.0 V,
and vL = −4.0 V.
1.58 Use direct analysis on the noninverting ampliﬁer of Fig. 1.35a to show that its input
and output resistances admit the exact expressions
Ri = rd

1 +
a
1 + (R2 + ro)/R1

+ [R1//(R2 + ro)]
Ro =
ro
1 + [a + ro/(R1//rd)]/[1 + R2/(R1//rd)]
How do these expressions simplify for a well-designed inverting ampliﬁer?
1.59 Use direct analysis on the inverting ampliﬁer of Fig. 1.36a to show that its input and
output resistances admit the exact expressions
Ri = R1+
R2 + ro
1 + a + (R2 + ro) /rd
Ro =
ro
1 + [a + ro/(R1//rd)]/[1 + R2/(R1//rd)]
How do these expressions simplify for a well-designed inverting ampliﬁer?

62
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
1.60 Let a voltage follower be implemented with an op amp having rd = 1 k, ro = 20 k,
and a = 106 V/V (poor resistances, but excellent gain). Find A, Ri, and Ro, and comment
on your ﬁndings.
1.7 The return ratio and Blackman’s formula
1.61 Assuming op amps with rd ∼= ∞, a = 103 V/V, and ro ∼= 0, ﬁnd the return ratio T for
each of the circuits of Figs. P1.15 through P1.19.
1.62 Repeat Problem 1.61 if each source is replaced by a 10-k resistor.
1.63 Let the difference ampliﬁer of Fig. 1.18 be implemented with four matched 10-k
resistances and an op amp having rd ∼= ∞, a = 102 V/V, and ro = 100 .
(a) Writing vO = A2v2 −A1v1, use return-ratio analysis to ﬁnd A1 and A2(A1 ̸= A2
because of feedthrough). (b) A ﬁgure of merit of a difference ampliﬁer is the common-
mode rejection ratio, which in this case we deﬁne as CMRR = 20 log |A/A|, where
A = (A1 + A2)/2 and A = A1 −A2. What is the CMRR of this circuit? What
happens if a is raised to 103 V/V?
1.64 (a) Assuming the op amp of Fig. P1.64 has rd ∼= ∞, a = 103 V/V, and ro ∼= 0, and
all resistances are identical, ﬁnd Aideal as well as the gain error GE. (b) Find amin for
GE ≤0.1 %.
+
–
R1
R2
R4
R6
R3
R5
+
vI
vO
FIGURE P1.64
1.65 Let the op amp of Fig. P1.65 have rd ∼= ∞, a = 104 V/V, and ro ∼= 0. Assuming
R1 = R3 = R5 = 10 k and R2 = R4 = 20 k, use return-ratio analysis to ﬁnd the
gain Ar = vO/iI and the resistance Ri seen by the iI source.
+
–
R1
R3
R5
R2
R4
iI
vO
FIGURE P1.65
1.66 In the circuit8 of Fig. P1.66 let rd = 50 k, gm = 1 mA/V, and ro = 1 M. Use
return-ratio analysis to ﬁnd the closed-loop gain Ar = vo/is if Rs = 200 k and
RF = 100 k. Verify with PSpice. What is the percentage contribution to Ar due to
feedthrough? Hint: Suppress the sources, apply a test current it out of the output node,
and obtain the return ratio as −gmvd/it.

63
Problems
is
vo
Rs
RF
rd
ro
gmvd
vd
+
–
FIGURE P1.66
1.67 With reference to the circuit of Fig. P1.66, use Blackman’s formula to ﬁnd the resistance
Ri between the input node and ground, and the resistance Ro between the output node
and ground, and verify with PSpice. Assume the data of Problem 1.66, and use the hint
provided there.
1.68 In the circuit of Fig. 1.42a let X denote the node shared by R2, R3, and R4. (a) Assuming
the data of Example 1.14, use Blackman’s formula to ﬁnd the resistance RX between
node X and ground. Is it large or small? Justify intuitively. (b) Use intuitive reasoning
(no formulas) to estimate the resistance RX N between node X and the inverting-input
node, and the resistance RX O between node X and the output node. Hint: What happens
if you apply a test voltage between the nodes under consideration?
1.69 Redraw the circuit of Fig. P1.64, but with R6 replaced by a load box LD as in Fig. P1.54,
and let the output be the load current iO ﬂowing from left to right. Assuming rd ∼= ∞,
a = 5,000 V/V, and ro ∼= 0, along with R1 = R2 = 200 k, R3 = 100 k, R4 = 120 k,
and R5 = 1.0 k, use return-ratio analysis to estimate the gain Ag = iO/vI if the load
LD is a short circuit. What is the resistance Ro seen by the load?
1.70 InthecircuitofFig.P1.51a leta1 = 3000V/Vand RL = 2k,andsupposeanadditional
10-k resistor is connected from node v1 to node vO. (a) Sketch and label the open-
loop VTC of the overall circuit, that is, the plot of vO versus the input difference vD =
vP −vN. (b) Sketch and label the loop gain T versus vI over the range −0.3 V ≤vI ≤
0.3 V. (c) Sketch and label, versus time, vI, vO, v1, and vD if vI is a triangular wave
with ±0.3-V peak values.
1.8 Op amp powering
1.71 Repeat Example 1.15, but with vI = −5 V.
1.72 Assuming IQ = 1.5 mA in the circuit of Fig. P1.72, calculate all currents and voltages,
as well as the power dissipated inside the op amp, if (a) vI = +2 V; (b) vI = −2 V.
1.73 (a) Assuming ±15-V power supplies, design a variable voltage source over the range
0 V ≤vS ≤10 V. (b) Assuming a 1-k grounded load and IQ = 1.5 mA, ﬁnd the
maximum internal power dissipation of your op amp.
1.74 (a) Assuming IQ = 50 μA and a grounded load of 100 k at the output of the dc-
offsetting ampliﬁer of Fig. 1.17, ﬁnd the values of vI for which the op amp dissipates
the maximum power. Show all corresponding voltages and currents. (b) Assuming

64
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
+
–
15 V
–15 V
+
vI
vO
10 kΩ
10 kΩ
30 kΩ
2 kΩ
140 kΩ
741
FIGURE P1.72
±Vsat = ±12 V, ﬁnd the range of values of vI for which the op amp still operates
within the linear region.
1.75 In the ampliﬁer of Fig. 1.18 let R1 = 30 k, R2 = 120 k, R3 = 20 k, and R4 =
30 k, and let the op amp be a 741-type powered from ±15 V. (a) If v2 = 2 sin ωt V,
ﬁnd the range of values of v1 for which the ampliﬁer still operates in the linear region.
(b) If v1 = Vm sin ωt and v2 = −1 V, ﬁnd the maximum value of Vm for which the op
amp still operates in the linear region. (c) Repeat (a) and (b) for the case in which the
power supplies are lowered to ±12 V.
1.76 Redraw the circuit of Fig. P1.16, but with the source iS replaced by a voltage source vS,
positive at the top. (a) How is vO related to vS when the op amp operates in the linear
region? Assuming the op amp saturates at ±10 V, ﬁnd vN, vP, and vO if (b) vS = 5 V,
and (c) vS = 15 V.
1.77 Assuming the op amp of Fig. P1.17 saturates at ±10 V, sketch and label vN, vP, and
vO versus time if vS is a sinusoidal wave of ±9-V peak values.
1.78 The noninverting ampliﬁer of Fig. 1.15a is implemented with R1 = 10 k and R2 =
15 k, and a 741 op amp powered from ±12-V supplies. If the circuit includes also a
third 30-k resistor connected between the inverting input and the 12-V supply, ﬁnd
vO and vN if (a) vI = 4 V, and (b) vI = −2 V.
1.79 Suppose the circuit of Fig. 1.42a uses 10-k resistances throughout, and the op amp
has a = 104 V/V and saturates at ±5 V. Assuming a sinusoidal input vI = Vim sin(ωt),
and letting vX denote the voltage at the node common to R2, R3, and R4, sketch and
label vI, vN, vO, and vX versus time for the following cases: (a) Vim = 1.0 V and
(b) Vim = 2.0 V.
1.80 Suppose the integrator of Fig. 1.20 uses R = 30 k, C = 20 nF, and an op amp that
saturates at ±5 V. (a) Assuming C is initially discharged, ﬁnd the time at which the
op amp reaches saturation if vI is changed from 0 V to 3 V at t = 0 (use the hint of
Problem 1.42). (b) Sketch and label vN both before and after saturation, and comment.
1.81 The circuit of Fig. P1.81, called a bridge ampliﬁer, allows one to double the linear
output range as compared with a single op amp. (a) Show that if the resistances are in
the ratios shown, then vO/vI = 2A. (b) If the individual op amps saturate at ±13 V,
what is the maximum peak-to-peak output voltage that the circuit can provide without
distortion?

65
Appendix 1A
Standard Resistor
Values
+
–
+
–
R
R
OA1
OA2
(A – 1) R
AR
+
vI
Load
+
–
vO
FIGURE P1.81
1.82 For the circuit of Fig. P1.72 sketch and label vI, vN, and vO versus time if vI is a
triangular wave with ±5-V peak values.
REFERENCES
1. W. Jung, Op Amp Applications Handbook (Analog Devices Series), Elsevier/Newnes,
New York, 2005, ISBN 0-7506-7844-5.
2. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009, ISBN 978-0-470-
24599-6.
3. S. Franco, Analog Circuit Design—Discrete and Integrated, McGraw-Hill, New York,
2014.
4. H. W. Bode, Network Analysis and Feedback Ampliﬁer Design, Van Nostrand, New
York, 1945.
5. R. D. Middlebrook, “The General Feedback Theorem: A Final Solution for Feedback
Systems,” IEEE Microwave Magazine, April 2006, pp. 50–63.
6. R. B. Blackman, “Effect of Feedback on Impedance,” Bell Sys. Tech. J., Vol. 23, October
1943, pp. 269–277.
7. S. Rosenstark, Feedback Ampliﬁer Principles, MacMillan, New York, 1986, ISBN 978-
0672225451.
8. P. J. Hurst, “A Comparison of Two Approaches to Feedback Circuit Analysis,” IEEE
Trans. on Education, Vol. 35, No. 3, August 1992, pp. 253–261.
APPENDIX 1A
STANDARD RESISTANCE VALUES
As a good work habit, always specify standard resistance values for the circuits you
design (see Table 1A.1). In many applications 5% resistors are adequate; however,
when higher precision is required, 1% resistors should be used. When even this
tolerance is insufﬁcient, the alternatives are either 0.1% (or better) resistors, or less
precise resistors in conjunction with variable ones (trim pots) to allow for exact
adjustments.
The numbers in the table are multipliers. For instance, if the calculations yield
a resistance of 3.1415 k, the closest 5% value is 3.0 k and the closest 1% value

66
CHAPTER 1
Operational
Ampliﬁer
Fundamentals
is 3.16 k. In the design of low-power circuits, the best resistance range is usually
between 1 k and 1 M. Try to avoid excessively high resistances (e.g., above
10 M), because the stray resistance of the surrounding medium tends to decrease
the effective value of your resistance, particularly in the presence of moisture and
salinity. Low resistances, on the other hand, cause unnecessarily high-power dissi-
pation.
TABLE 1A.1
Standard resistance values
5% resistor values
1% resistor values
10
100
178
316
562
11
102
182
324
576
12
105
187
332
590
13
107
191
340
604
15
110
196
348
619
16
113
200
357
634
18
115
205
365
649
20
118
210
374
665
22
121
215
383
681
24
124
221
392
698
27
127
226
402
715
30
130
232
412
732
33
133
237
422
750
36
137
243
432
768
39
140
249
442
787
43
143
255
453
806
47
147
261
464
825
51
150
267
475
845
56
154
274
487
866
62
158
280
499
887
68
162
287
511
909
75
165
294
523
931
82
169
301
536
953
91
174
309
549
976

2
CIRCUITS WITH RESISTIVE FEEDBACK
2.1 Current-to-Voltage Converters
2.2 Voltage-to-Current Converters
2.3 Current Ampliﬁers
2.4 Difference Ampliﬁers
2.5 Instrumentation Ampliﬁers
2.6 Instrumentation Applications
2.7 Transducer Bridge Ampliﬁers
Problems
References
In this chapter we investigate additional op amp circuits, this time with greater
emphasis on practical applications. The circuits to be examined are designed to
exhibit linear, frequency-independent transfer characteristics. Linear circuits that
are deliberately intended for frequency-dependent behavior are more properly called
ﬁlters and will be studied in Chapters 3 and 4. Finally, nonlinear op amp circuits
will be studied in Chapters 9 and 13.
To get a feel for what a given circuit does, we ﬁrst analyze it using the ideal op
amp model. Then, in the spirit of Sections 1.6 and 1.7, we take a closer look at how
op amp nonidealities, particularly the ﬁnite open-loop gain, affect its closed-loop
parameters. A more systematic investigation of op amp nonidealities, such as static
and dynamic errors, will be carried out in Chapters 5 and 6, after we have developed
enough conﬁdence with op amp circuits, emphasizing the simpler op amp model.
The circuits of the present and other chapters that are most directly affected by such
limitations will be reexamined in greater detail then.
67

68
CHAPTER 2
Circuits with
Resistive
Feedback
Chapter Highlights
The ﬁrst half of the chapter revisits the four feedback topologies of Section 1.6
to investigate a number of practical applications. Though intrinsically an ampliﬁer
of the voltage type, the op amp can be operated just as well as a transresistance
ampliﬁer or I-V converter, as a transconductance ampliﬁer or V -I converter, and
as a current ampliﬁer. This exceptional versatility stems from the negative-feedback
ability to modify the closed-loop resistances as well as stabilize gain. The judicious
application of this ability allows us to approach the ideal ampliﬁer conditions of
Table 1.1 to a highly satisfactory degree.
The second part of the chapter addresses instrumentation concepts and ap-
plications. The circuits examined include difference ampliﬁers, instrumentation
ampliﬁers, and transducer-bridge ampliﬁers, which are the workhorses of today’s
automatic test, measurement, and control instrumentation.
2.1
CURRENT-TO-VOLTAGE CONVERTERS
A current-to-voltage converter (I-V converter), also called a transresistance ampli-
ﬁer, accepts an input current iI and yields an output voltage of the type vO = AiI ,
where A is the gain of the circuit in volts per ampere. Referring to Fig. 2.1, assume
ﬁrst that the op amp is ideal. Summing currents at the virtual-ground node gives
iI + (vO −0)/R = 0, or
vO = −RiI
(2.1)
The gain is −R and is negative because of the choice of the reference direction of
iI ; inverting this direction gives vO = RiI . The magnitude of the gain is also called
the sensitivity of the converter because it gives the amount of output voltage change
for a given input current change. For instance, for a sensitivity of 1 V/mA we need
R = 1 k, for a sensitivity of 1 V/μA we need R = 1 M, and so on. If desired,
gain can be made variable by implementing R with a potentiometer. Note that the
feedback element need not necessarily be limited to a resistance. In the more general
case in which it is an impedance Z(s), where s is the complex frequency, Eq. (2.1)
takes on the Laplace-transform form Vo(s) = −Z(s)Ii(s), and the circuit is called
a transimpedance ampliﬁer.
We observe that the op amp eliminates loading both at the input and at the
output. In fact, should the input source exhibit some ﬁnite parallel resistance Rs, the
+
–
R
Ro
vO
Ri
iI
FIGURE 2.1
Basic I-V converter.

69
SECTION 2.1
Current-to-Voltage
Converters
op amp eliminates any current loss through it by forcing 0 V across it. Also, the op
amp delivers vO to an output load RL with zero output resistance.
Closed-Loop Parameters
Let us now investigate the departure from ideal if a practical op amp is used. Com-
paring with Fig. 1.28b, we recognize the shunt-shunt topology. We can thus apply
the techniques of Section 1.7 and write
T =
ard
rd + R + ro
(2.2)
A = −R
1
1 + 1/T
Ri = rd ∥(R + ro)
1 + T
Ro ∼=
ro
1 + T
(2.3)
EXAMPLE 2.1.
Find the closed-loop parameters of the circuit of Fig. 2.1 if it is imple-
mented with a 741 op amp and R = 1 M.
Solution.
Substituting the given component values, we get T = 133,330, A =
−0.999993 V/μA, Ri = 5 , and Ro ∼= 56 m.
High-Sensitivity I-V Converters
It is apparent that high-sensitivity applications may require unrealistically large
resistances. Unless proper circuit fabrication measures are adopted, the resistance
of the surrounding medium, being in parallel with R, will decrease the net feedback
resistance and degrade the accuracy of the circuit. Figure 2.2 shows a widely used
technique to avoid this drawback. The circuit utilizes a T-network to achieve high
sensitivity without requiring unrealistically large resistances.
Summing currents at node v1 yields −v1/R −v1/R1 + (vO −v1)/R2 = 0. But
v1 = −RiI , by Eq. (2.1). Eliminating v1 yields
vO = −kRiI
(2.4a)
k = 1 + R2
R1
+ R2
R
(2.4b)
The circuit in effect increases R by the multiplicative factor k. We can thus achieve
a high sensitivity by starting out with a reasonable value of R and then multiplying
it by the needed amount k.
+
–
R
R1
vO
v1
R2
iI
FIGURE 2.2
High-sensitivity I-V converter.

70
CHAPTER 2
Circuits with
Resistive
Feedback
EXAMPLE 2.2.
In the circuit of Fig 2.2 specify suitable component values to achieve
a sensitivity of 0.1 V/nA.
Solution.
We have kR = 0.1/10−9 = 100 M, a fairly large value. Start out with
R = 1 M and then multiply it by 100 to meet the speciﬁcations. Thus, 1 + R2/R1 +
R2/106 = 100. Since we have one equation but two unknowns, ﬁx one unknown;
for example, let R1 = 1 k. Then, imposing 1 + R2/103 + R2/106 = 100 yields
R2 ∼= 99 k (use 100 k, the closest standard). If desired, R2 can be made variable for
the exact adjustment of kR.
Real-life op amps do draw a small current at their input terminals. Called the
input bias current, it may degrade the performance of high-sensitivity I-V converters,
in which iI itself is quite small. This drawback can be avoided by using op amps
speciﬁcally rated for low-input bias current, such as JFET-input and MOSFET-input
op amps.
Photodetector Ampliﬁers
One of the most frequent I-V converter applications is in connection with current-
type photodetectors such as photodiodes and photomultipliers.1 Another common
application, I-V conversion of current-output digital-to-analog converters, will be
discussed in Chapter 12.
Photodetectors are transducers that produce electrical current in response to
incident light or other forms of radiation, such as X-rays. A transresistance ampliﬁer
is then used to convert this current to a voltage, as well as eliminate possible loading
both at the input and at the output.
One of the most widely used photodetectors is the silicon photodiode. The rea-
sons for its popularity are its solid-state reliability, low cost, small size, and low
power dissipation.1 The device can be used either with a reverse bias voltage, in the
photoconductive mode, shown in Fig. 2.3a, or with zero bias, in the photovoltaic
mode, shown in Fig. 2.3b. The photoconductive mode offers higher speed; it is there-
fore better suited to the detection of high-speed light pulses and to high-frequency
light-beam modulation applications. The photovoltaic mode offers lower noise and
is therefore better suited to measurement and instrumentation applications. The cir-
cuit of Fig. 2.3b can be used as a light meter by calibrating its output directly in units
of light intensity.
+
–
R
–VBIAS
iS
vO
(a)
+
–
R
iS
vO
(b)
FIGURE 2.3
(a) Photoconductive and (b) photovoltaic detectors.

71
SECTION 2.2
Voltage-to-Current
Converters
2.2
VOLTAGE-TO-CURRENT CONVERTERS
A voltage-to-current converter (V-I converter), also called a transconductance
ampliﬁer, accepts an input voltage vI and yields an output current of the type
iO = AvI , where A is the gain, or sensitivity, of the circuit, in amperes per volt. For
a practical converter, the characteristic takes on the more realistic form
iO = AvI −1
Ro
vL
(2.5a)
where vL is the voltage developed by the output load in response to iO, and Ro is the
converter’s output resistance as seen by the load. For true V-I conversion, iO must
be independent of vL; that is, we must have
Ro = ∞
(2.5b)
Since it outputs a current, the circuit needs a load in order to work; leaving the
output port open would result in circuit malfunction as iO would have no path in
which to ﬂow. The voltage compliance is the range of permissible values of vL for
which the circuit still works properly, before the onset of any saturation effects on
the part of the op amp.
If both terminals of the load are uncommitted, the load is said to be of the ﬂoating
type. Frequently, however, one of the terminals is already committed to ground or to
another potential. The load is then said to be of the grounded type, and the current
from the converter must be fed to the uncommitted terminal.
Floating-Load Converters
Figure 2.4 shows two basic implementations, both of which use the load itself as the
feedback element; if one of the load terminals were already committed, it would of
course not be possible to use the load as the feedback element.
In the circuit of Fig. 2.4a the op amp outputs whatever current iO it takes to make
the inverting-input voltage follow vI , or to make RiO = vI . Solving for iO yields
iO = 1
R vI
(2.6)
+
–
R
+
vI
iO
Load
+
– vL
+
–
R
iO
+
–
vL
+
vI
(a)
(b)
Load
FIGURE 2.4
Floating-load V-I converters.

72
CHAPTER 2
Circuits with
Resistive
Feedback
This expression holds regardless of the type of load: it can be linear, as for a re-
sistive transducer; it can be nonlinear, as for a diode; it can have time-dependent
characteristics, as for a capacitor. No matter what the load, the op amp will force it
to carry the current of Eq. (2.6), which depends on the control voltage vI and the
current-setting resistance R, but not on the load voltage vL. To achieve this goal, the
op amp must swing its output to the value vO = vI + vL, something it will readily
do as long as VOL < vO < VOH. Consequently, the voltage compliance of the circuit
is (VOL −vI ) < vL < (VOH −vI ).
In the circuit of Fig. 2.4b the op amp keeps its inverting input at 0 V. Con-
sequently, its output terminal must draw the current iO = (vI −0)/R, and it must
swing to the voltage vO = −vL. Apart from the polarity reversal, the current is the
same as in Eq. (2.6); however, the voltage compliance is now VOL < vL < VOH.
We observe that Eq. (2.6) holds for both circuits regardless of the polarity of vI .
The arrows of Fig. 2.4 show current direction for vI > 0; making vI < 0 will simply
reverse the direction. The two converters are thus said to be bidirectional.
Of special importance is the case in which the load is a capacitor, so that the
circuit is the familiar integrator. If vI is kept constant, the circuit will force a constant
current through the capacitor, causing it to charge or discharge, depending on the
polarity of vI , at a constant rate. This forms the basis of waveform generators such
as sawtooth and triangular waveform generators, V-F and F-V converters, and dual-
ramp A-D converters.
A drawback of the converter of Fig. 2.4b is that iO must come from the source
vI itself, whereas in Fig. 2.4a the source sees a virtually inﬁnite input resistance.
This advantage, however, is offset by a more restricted voltage compliance. The
maximum current either circuit can deliver to the load depends on the op amp. For
the 741, this is typically 25 mA. If larger currents are required, one can either use a
power op amp or a low-power op amp with an output current booster.
EXAMPLE 2.3. Let both circuits of Fig. 2.4 have vI = 5 V, R = 10 k, ±Vsat = ±13 V,
and a resistive load RL. For both circuits ﬁnd (a) iO; (b) the voltage compliance; (c) the
maximum permissible value of RL.
Solution.
(a) iO = 5/10 = 0.5 mA, ﬂowing from right to left in the circuit of Fig. 2.4a and from
left to right in that of Fig. 2.4b.
(b) For the circuit of Fig. 2.4a, −18 V < vL < 8 V; for the circuit of Fig. 2.4b, −13 V <
vL < 13 V.
(c) With a purely resistive load, vL will always be positive. For the circuit of Fig. 2.4a,
RL < 8/0.5 = 16 k; for the circuit of Fig. 2.4b, RL < 13/0.5 = 26 k.
Practical Op Amp Limitations
We now wish to investigate the effect of using a practical op amp. After the op amp
is replaced with its practical model, the circuit of Fig. 2.4a becomes as in Fig. 2.5.
Summing voltages, we get vI −vD + vL + roiO −avD = 0. Summing currents,
iO + vD/rd −(vI −vD)/R = 0. Eliminating vD and rearranging, we can put iO

73
SECTION 2.2
Voltage-to-Current
Converters
ro
R
avD
+
+
–
–
vD
vL
vI
iO
rd
Load
+
+
FIGURE 2.5
Investigating the effect of using a
practical op amp.
in the form of Eq. (2.5a) with
A = 1
R
a −R/rd
1 + a + ro/R + ro/rd
Ro = (R ∥rd)(1 + a) + ro
(2.7)
It is apparent that as a →∞, we get the ideal results A →1/R and Ro →∞.
However, for a ﬁnite gain a, A will exhibit some error, and Ro, though large, will
not be inﬁnite, indicating a weak dependence of iO on vL. Similar considerations
hold for the circuit of Fig. 2.4b.
Grounded-Load Converters
When one of its terminals is already committed, the load can no longer be placed
within the feedback loop of the op amp. Figure 2.6a shows a converter suitable for
groundedloads.ReferredtoastheHowlandcurrentpumpafteritsinventor,thecircuit
consists of an input source vI with series resistance R1, and a negative-resistance
converter synthesizing a grounded resistance of value −R2R3/R4. The circuit seen
by the load admits the Norton equivalent of Fig. 2.6b, whose i-v characteristic is
given by Eq. (2.5a). We wish to ﬁnd the overall output resistance Ro seen by the load.
+
–
R4
R3
R1
R1
R2
+
vI
vI
+
–
vL
vO
Ro
+
–
vL
Load
iO
iO
Load
(a)
(b)
FIGURE 2.6
Howland current pump and its Norton equivalent.

74
CHAPTER 2
Circuits with
Resistive
Feedback
R1
R2
R3
R4
Ro
v1
R1
iO
Load
–
+
–
vL
FIGURE 2.7
Using a negative resistance to control Ro.
To this end, we ﬁrst perform a source transformation on the input source vI and
its resistance R1, and then we connect the negative resistance in parallel, as depicted
in Fig. 2.7. We have 1/Ro = 1/R1 + 1/(−R2R3/R4). Expanding and rearranging,
we get
Ro =
R2
R2/R1 −R4/R3
(2.8)
As we know, for true current-source behavior we must have Ro = ∞. To achieve
this condition, the four resistances must form a balanced bridge:
R4
R3
= R2
R1
(2.9)
When this condition is met, the output becomes independent of vL:
iO = 1
R1
vI
(2.10)
Clearly, the gain of the converter is 1/R1. For vI > 0 the circuit will source
current to the load, and for vI < 0 it will sink current. Since vL = vO R3/(R3 +
R4) = vO R1/(R1 + R2), the voltage compliance is, assuming symmetric output
saturation,
|vL| ≤
R1
R1 + R2
Vsat
(2.11)
For the purpose of extending the compliance, it is thus desirable to keep R2 sufﬁ-
ciently smaller than R1 (e.g., R2 ∼= 0.1R1).
EXAMPLE 2.4.
The Howland pump of Fig. 2.8 uses a 2-V voltage reference to source
a stable current of 1.0 mA. Assuming a rail-to-rail op amp (±Vsat = ±9 V), prepare
a table showing all voltages and currents for vL = 0, 1, 2, 3, 4, 5, −2, −4, and −6 V,
and give a word description of circuit behavior. What is the voltage compliance of this
pump?
Solution. So long as −9 V ≤vOA ≤+9 V, the op amp will operate in the linear region
to give vOA = 2vL. The voltage compliance is thus −4.5 V ≤vL ≤+4.5 V. By KCL
we have iO = i1 + i2, where
i1 = VREF −vL
R1
i2 = vO A −vL
R2
= 2vL −vL
R2
= vL
R2

75
SECTION 2.2
Voltage-to-Current
Converters
R3 (2 kΩ)
R1 (2 kΩ)
VREF
2 V
R2 (2 kΩ)
i2
R4 (2 kΩ)
vL
+
–
`
+9 V
–9 V
+
–
+
– LD
iO
vOA
i1
vL
i1
vO A
i2
iO
0
1
0
0
1
1
0.5
2
0.5
1
2
0
4
1
1
3
−0.5
6
1.5
1
4
−1
8
2
1
5
−1.5
9
2
0.5
−2
2
−4
−1
1
−4
3
−8
−2
1
−6
4
−9
−1.5
2.5
FIGURE 2.8
CurrentsourceofExample2.4,anddistributionofvoltages/currentsfordifferentloadvoltages
(voltages are in V, currents in mA).
so, for linear-region operation, i1 + i2 = VREF/R1. Plugging in the given vL values
we readily ﬁll in the ﬁrst ﬁve data rows of the table of Fig. 2.8. Thus, for vL = 0, iO
comes entirely from VREF, but as the voltage vL developed by the load increases, the
contribution by VREF decreases while that by vOA increases in such a way as to add up
to iO = 1 mA regardless of vL. (Note that for vL > VREF, i1 actually changes polarity!)
However, for vL > 9/2 = 4.5 V, the op amp saturates, ceasing to provide the required
regulation (indeed, for vL = 5 V, iO drops to 0.5 mA).
For vL < 0, vOA becomes negative, pulling current out of the load node (i2 < 0) so
as to compensate for the fact that now i1 > 1 mA. For vL < −9/2 = −4.5 V, the op amp
again saturates and stops regulating. It is fascinating how the op amp tries to provide
whatever voltage and current it takes to ensure iO = 1 mA regardless of vL (this, of
course, so long as it manages to stay out of saturation).
We observe that the Howland pump comprises both a negative and a posi-
tive feedback path. Denoting the load resistance as RL, we ﬁnd the loop gain via
Eq. (1.78) as
T = a(vN −vP)
vT
= a

R3
R3 + R4
−
R1//RL
R1//RL + R2

= a

1
1 + R2/R1
−
1
1 + R2/R1 + R2/RL

where Eq. (2.9) has been used. It is apparent that as long as the circuit is terminated
on some ﬁnite load 0 ≤RL < ∞, we have T > 0, indicating that negative feedback
prevails over positive feedback, thus ensuring a stable circuit.
Effect of Resistance Mismatches
In a practical circuit the resistive bridge is likely to be unbalanced because of resis-
tance tolerances. This will inevitably degrade Ro, which should be inﬁnite for true

76
CHAPTER 2
Circuits with
Resistive
Feedback
current-source behavior. It is therefore of interest to estimate the worst-case value
of Ro for given resistance-tolerance speciﬁcations.
An unbalanced bridge implies unequal resistance ratios in Eq. (2.9), a condition
that we can express in terms of the imbalance factor ϵ as
R4
R3
= R2
R1
(1 −ϵ)
(2.12)
Substituting in Eq. (2.8) and simplifying, we obtain
Ro = R1
ϵ
(2.13)
As expected, the smaller the imbalance, the larger Ro. In the limit of perfect balance,
or as ϵ →0, we would of course have Ro →∞. We observe that ϵ and therefore Ro
can be either positive or negative, depending on the direction in which the bridge is
unbalanced. By Eq. (2.5a), −1/Ro represents the slope of the iO versus vL charac-
teristic. Consequently, Ro = ∞implies a perfectly horizontal characteristic, Ro > 0
implies a tilt toward the right, and Ro < 0 implies a tilt toward the left.
EXAMPLE 2.5.
(a) Discuss the implications of using 1% resistances in the circuit of
Example 2.4. (b) Repeat for 0.1% resistances. (c) Find the resistance tolerance needed
for |Ro| ≥10 M.
Solution.
The worst-case bridge imbalance occurs when, for instance, the ratio R2/R1
is maximized and R4/R3 is minimized, that is, when R2 and R3 are maximized and
R1 and R4 are minimized. Denoting the percentage tolerance of the resistances as p so
that, for instance, for 1% resistances we have p = 0.01, we observe that to achieve the
balanced condition of Eq. (2.9), the minimized resistances must be multiplied by 1 + p,
and the maximized ones by 1 −p, thus giving
R4(1 + p)
R3(1 −p) = R2(1 −p)
R1(1 + p)
Rearranging, we get
R4
R3
= R2(1 −p)2
R1(1 + p)2 ∼= R2
R1
(1 −p)2(1 −p)2 ∼= R2
R1
(1 −4p)
where we have exploited the fact that for p ≪1 we can approximate 1/(1 + p) ∼= 1 – p
and we can ignore terms in pn, n ≥2. Comparison with Eq. (2.12) indicates that we can
write
|ϵ|max ∼= 4p
(a) For 1% resistances we have |ϵ|max ∼= 4 × 0.01 = 0.04, indicating a resistance
ratio mismatch as large as 4%. Thus, |Ro|min = R1/|ϵ|max ∼= 2/0.04 = 50 k,
indicating that with 1% resistances we can expect Ro to be anywhere in the range
|Ro| ≥50 k.
(b) Improving the tolerance by an order of magnitude increases |Ro|min by the same
amount, so |Ro| ≥500 k.
(c) Since 0.1% resistances give |Ro|min = 0.5 M, it follows that for |Ro|min = 10 M
we need to improve the tolerance by a factor of 10/0.5 = 20. Consequently, p =
0.1/20 = 0.005%, implying highly precise resistors!
An alternative to highly precise resistors is to make provision for resistance
trimming. However, a good designer will strive to avoid trimmers whenever possible
becausetheyaremechanicallyandthermallyunstable,theyhaveﬁniteresolution,and

77
SECTION 2.2
Voltage-to-Current
Converters
+
+
–
Rpot
Rs
R4
R3
A
R1
R2
5 V
FIGURE 2.9
Howland circuit calibration.
theyarebulkierthanordinaryresistors.Moreover,thecalibrationprocedureincreases
production costs. There are, nonetheless, situations in which, after a careful analysis
of cost, complexity, and other pertinent factors, trimming still proves preferable.
Figure 2.9 shows a setup for the calibration of the Howland circuit. The input
is grounded, and the load is replaced by a sensitive ammeter initially connected
to ground. In this state the ammeter reading should be zero; however, because of
op amp nonidealities such as the input bias current and the input offset voltage, to
be discussed in Chapter 5, the reading will generally be nonzero, albeit small. To
calibrate the circuit for Ro = ∞, we ﬂip the ammeter to some other voltage, such
as 5 V, and we adjust the wiper for the same ammeter reading as when the ammeter
is connected to ground.
EXAMPLE 2.6.
In the circuit of Example 2.4 specify a suitable trimmer/resistor re-
placement for R3 to allow bridge balancing in the case of 1% resistances.
Solution.
Since 4pR1 = 4 × 0.01 × 2 × 103 = 80 , the series resistance Rs must be
less than 2.0 k by at least 80 . To be on the safe side, pick Rs = 1.91 k, 1%. Then,
Rpot = 2(2 −1.91)103 = 180  (pick a 200- pot).
Effect of Finite Open-Loop Gain
We now investigate the effect of a ﬁnite open-loop gain on the transfer characteristic
of the Howland circuit. To evidence the effect of the op amp alone, we assume the
resistances to form a perfectly balanced bridge. With reference to Fig. 2.6a, we
have, by KCL, iO = (vI −vL)/R1 + (vO −vL)/R2. The circuit can be viewed as a
noninverting ampliﬁer that ampliﬁes vL to yield vO = vLa/[1 + aR3/(R3 + R4)].
Using Eq. (2.9), this can be written as vO = vLa/[1+aR1/(R1 + R2)]. Eliminating
vO and rearranging gives
iO = 1
R1
vI −1
Ro
vL
Ro = (R1//R2)

1 +
a
1 + R2/R1

(2.14)
(Note that Ro could have been derived also via Blackman’s formula.) It is interesting
that the effect of ﬁnite open-loop gain a is to lower Ro from ∞, but without changing
the sensitivity (A = 1/R1).

78
CHAPTER 2
Circuits with
Resistive
Feedback
ro
P
N
rd
1 MΩ
R3
2.0 kΩ
R4
2.0 kΩ
R2
2.0 kΩ
R1
I
2.0 kΩ
100 Ω
1 µA
0
100 kV/V
EOA
+
–
+
–
0
0
FIGURE 2.10
PSpice circuit for Example 2.7.
EXAMPLE 2.7.
(a) Calculate Ro for the Howland pump of Example 2.4 if the op amp
has a = 105 V/V, rd = ∞, and ro = 0, and verify with PSpice. (b) What happens if you
include the more realistic values rd = 1 M and ro = 100 ?
Solution.
(a) By Eq. (2.14) we have Ro = (2//2)103[1 + 105/(1 + 2/2)] = 50 M. To verify
with PSpice, apply a 1-μA test current to the P node, as shown in Fig. 2.10 (note
that by PSpice convention for VCVSs, the “+” input is shown at top and the “-” input
at bottom). Directing PSpice to perform the dc analysis with rd = ∞and ro = 0,
we get V(P) = 49.999 V, so Ro = (49.999)/(10−6) ∼= 50 M, in agreement with
hand calculation.
(b) Rerunning PSpice with rd = 1 M  and ro = 100 , we get Ro = 47.523 M, a
slightly lower value because of the loop-gain reduction brought about by loading,
especially at the op amp’s output.
Improved Howland Current Pump
Depending on circuit conditions, the Howland circuit can be unnecessarily wasteful
of power. As an example, let vI = 1 V, R1 = R3 = 1 k, and R2 = R4 = 100 ,
and suppose the load is such that vL = 10 V. By Eq. (2.10), iO = 1 mA. Note,
however, that the current through R1 toward the left is i1 = (vL −vI )/R1 =
(10 −1)/1 = 9 mA, indicating that the op amp will have to waste 9 mA through R1
to deliver only 1 mA to the load under the given conditions. This inefﬁcient use of
power can be avoided with the modiﬁcation of Fig. 2.11, in which the resistance R2
has been split into two parts, R2A and R2B, such that the balanced condition is now
R4
R3
= R2A + R2B
R1
(2.15a)
It is left as an exercise (see Problem 2.16) to prove that when this condition is met,
the load still sees Ro = ∞, but the transfer characteristic is now
iO = R2/R1
R2B
vI
(2.15b)

79
SECTION 2.3
Current Ampliﬁers
+
–
R3 (= R1)
R4 (= R2)
R1
R2B
R2 = R2A + R2B
+
vI
+
–
vL Load
iO
R2A
FIGURE 2.11
Improved Howland circuit.
Aside from the gain term R2/R1, the sensitivity is now set by R2B, indicating that
R2B can be made as small as needed while the remaining resistances are kept high
in order to conserve power. For instance, letting R2B = 1 k, R1 = R3 = R4 =
100 k, and R2A = 100 −1 = 99 k, we still get iO = 1 mA with vI = 1 V.
However, even with vL = 10 V, very little power is now wasted in the large 100-k
resistances. The voltage compliance is approximately |vL| ≤|Vsat| −R2B|iO|. By
Eq. (2.15b), this can be written as |vL| ≤|Vsat| −(R2/R1)|vI |.
Since Howland circuits employ both positive and negative feedback, they may
become oscillatory under certain conditions. Two small capacitors (typically on the
order of 10 pF) in parallel with R4 and R1 are usually adequate to make negative feed-
back prevail over positive feedback at high frequencies and thus stabilize the circuit.
2.3
CURRENT AMPLIFIERS
Even though op amps are voltage ampliﬁers, they can also be conﬁgured for current
ampliﬁcation.Thetransfercharacteristicofapracticalcurrentampliﬁerisofthetype
iO = AiI −1
Ro
vL
(2.16a)
where A is the gain in amperes per ampere, vL is the output load voltage, and Ro is
the output resistance as seen by the load. To make iO independent of vL, a current
ampliﬁer must have
Ro = ∞
(2.16b)
Current-mode ampliﬁers are used in applications in which information is more con-
veniently represented in terms of current than in terms of voltage, for example, in
two-wire remote sensing instrumentation, photodetector output conditioning, and
V -F converter input conditioning.
Figure 2.12a shows a current ampliﬁer with a ﬂoating load. Assume ﬁrst that
the op amp is ideal. By KCL, iO is the sum of the currents coming from R1 and R2,
or iO = iI + (R2iI )/R1, or iO = AiI , where
A = 1 + R2
R1
(2.17)

80
CHAPTER 2
Circuits with
Resistive
Feedback
+
–
R2
R1
(a)
(b)
iI
vOA
iO
Ro
Load
vL
+
–
iO
Ro
Load
vL
+
–
+
–
Rs
R2
R1
iS
vOA
FIGURE 2.12
Current ampliﬁers: (a) ﬂoating-load type, and (b) grounded-load type.
This holds regardless of vL, indicating that the circuit yields Ro = ∞. If the op amp
has a ﬁnite gain a, one can prove (see Problem 2.24) that
A = 1 + R2/R1
1 + 1/a
Ro = R1(1 + a)
(2.18)
indicating a gain error as well as a ﬁnite output resistance. One can readily verify
that the voltage compliance is −(VOH + R2iI ) ≤vL ≤−(VOL + R2iI ).
Figure 2.12b shows a grounded-load current ampliﬁer. Because of the virtual
short, the voltage across the input source is vL, so the current entering R2 from the left
is iS −vL/Rs. By KVL, we have vOA = vL −R2(iS −vL/Rs). By KCL and Ohm’s
law, iO = (vOA−vL)/R1. Eliminating vOA gives iO = AiS −(1/Ro)vL, where
A = −R2
R1
Ro = −R1
R2
Rs
(2.19)
The negative gain indicates that the actual direction of iO is opposite to that
shown. Consequently, sourcing current to (or sinking current from) the circuit will
cause it to sink current from (or source current to) the load. If R1 = R2, then
A = −1 A/A and the circuit functions as a current reverser, or current mirror.
We observe that Ro is negative, something we could have anticipated by compar-
ing our ampliﬁer with the negative-resistance converter of Fig. 1.21b. The fact that
Ro is ﬁnite indicates that iO is not independent of vL. To avoid this shortcoming, the
circuit is used primarily in connection with loads of the virtual-ground type (vL = 0),
as in certain types of current-to-frequency converters and logarithmic ampliﬁers.
2.4
DIFFERENCE AMPLIFIERS
The difference ampliﬁer was introduced in Section 1.4, but since it forms the basis
of other important circuits, such as instrumentation and bridge ampliﬁers, we now
wish to analyze it in greater detail. Referring to Fig. 2.13a, we recall that as long as

81
SECTION 2.4
Difference
Ampliﬁers
R1
R2
+
–
+
vO
vCM
+
v1
v2
v1
v2
R3 (= R1)
R4 (= R2)
R1
R2
+
–
+
+
vO
+
R3 (= R1)
R4 (= R2)
vDM
2
vDM
2
(a)
(b)
FIGURE 2.13
(a) Difference ampliﬁer. (b) Expressing the inputs in terms of the common-mode and
differential-mode components vCM and vDM.
the resistances satisfy the balanced-bridge condition
R4
R3
= R2
R1
(2.20a)
the circuit is a true difference ampliﬁer, that is, its output is linearly proportional to
the difference of its inputs,
vO = R2
R1
(v2 −v1)
(2.20b)
The unique characteristics of the difference ampliﬁer are better appreciated if we
introduce the differential-mode and the common-mode input components, deﬁned as
vDM = v2 −v1
(2.21a)
vCM = v1 + v2
2
(2.21b)
Inverting these equations, we can express the actual inputs in terms of the newly
deﬁned components:
v1 = vCM −vDM
2
(2.22a)
v2 = vCM + vDM
2
(2.22b)
This allows us to redraw the circuit in the form of Fig. 2.13b. We can now concisely
deﬁne a true difference ampliﬁer as a circuit that responds only to the differential-
mode component vDM, completely ignoring the common-mode component vCM. In
particular, if we tie the inputs together to make vDM = 0, and we apply a common
voltage vCM ̸= 0, a true difference ampliﬁer will yield vO = 0 regardless of the
magnitude and polarity of vCM. Conversely, this can serve as a test for ﬁnding how
close a practical difference ampliﬁer is to ideal. The smaller the output variation is
because of a given variation of vCM, the closer the ampliﬁer is to ideal.
The decomposition of v1 and v2 into the components vDM and vCM not only
is a matter of mathematical convenience but also reﬂects a situation quite common
in practice, that of a low-level differential signal riding on a high common-mode
signal, as in the case of transducer signals. The useful signal is the differential one;

82
CHAPTER 2
Circuits with
Resistive
Feedback
R1
R2
R1
R2
R1
R2
+
–
R1
R2
+
–
Ric
Rid
(a)
(b)
FIGURE 2.14
Differential-mode and common-mode input resistances.
extracting it from the high common-mode environment and then amplifying it can
be a challenging task. Difference-type ampliﬁers are the natural candidates to meet
this challenge.
Figure 2.14 illustrates the differential-mode and common-mode input resis-
tances. It is readily seen (see Problem 2.30) that
Rid = 2R1
Ric = R1 + R2
2
(2.23)
Effect of Resistance Mismatches
A difference ampliﬁer will be insensitive to vCM only as long as the op amp is ideal
and the resistors satisfy the balanced-bridge condition of Eq. (2.20a). The effect of
op amp nonidealities will be investigated in Chapters 5 and 6; here we shall assume
ideal op amps and explore only the effect of resistance mismatches. In general, it
can be said that if the bridge is unbalanced, the circuit will respond not only to vDM
but also to vCM.
EXAMPLE 2.8.
In the circuit of Fig. 2.13a let R1 = R3 = 10 k and R2 = R4 =
100 k. (a) Assuming perfectly matched resistors, ﬁnd vO for each of the following input
voltage pairs: (v1, v2) = (−0.1 V, + 0.1 V), (4.9 V, 5.1 V), (9.9 V, 10.1 V). (b) Repeat
(a) with the resistors mismatched as follows: R1 = 10 k, R2 = 98 k, R3 = 9.9 k,
and R4 = 103 k. Comment.
Solution.
(a) vO = (100/10)(v2 −v1) = 10(v2 −v1). Since v2 −v1 = 0.2 V in each of the three
cases, we get vO = 10 × 0.2 = 2 V regardless of the common-mode component,
which is, in order, vCM = 0 V, 5 V, and 10 V for the three input voltage pairs.
(b) By the superposition principle, vO = A2v2 −A1v1, where A2 = (1 + R2/R1)/
(1 + R3/R4) = (1 + 98/10)/(1 + 9.9/103) = 9.853 V/V, and A1 = R2/R1 =
98/10 = 9.8 V/V. Thus, for (v1, v2) = (−0.1 V, + 0.1 V) we obtain vO = 9.853
(0.1) −9.8(−0.1) = 1.965 V. Likewise, for (v1, v2) = (4.9 V, 5.1 V) we get
vO = 2.230 V, and for (v1, v2) = (9.9 V, 10.1 V) we get vO = 2.495 V. As a
consequence of mismatched resistors, not only do we have vO ̸= 2 V, but vO also
changes with the common-mode component. Clearly the circuit is no longer a true
difference ampliﬁer.

83
SECTION 2.4
Difference
Ampliﬁers
R1
R1
R2
+
–
+
+
vO
+
R2 (1– )
vCM
vDM
2
vDM
2
∋
FIGURE 2.15
Investigating the effect of resistance
mismatches.
The effect of bridge imbalance can be investigated more systematically by intro-
ducing the imbalance factor ϵ, in the manner of the Howland circuit of Section 2.2.
With reference to Fig. 2.15 we conveniently assume that three of the resistances
possess their nominal values while the fourth is expressed as R2(1 −ϵ) to account
for the imbalance. Applying the superposition principle,
vO = −R2(1 −ϵ)
R1

vCM −vDM
2

+ R1 + R2(1 −ϵ)
R1
×
R2
R1 + R2

vCM + vDM
2

Multiplying out and collecting terms, we can put vO in the insightful form
vO = AdmvDM + AcmvCM
(2.24a)
Adm = R2
R1

1 −R1 + 2R2
R1 + R2
ϵ
2

(2.24b)
Acm =
R2
R1 + R2
ϵ
(2.24c)
As expected, Eq. (2.24a) states that with an unbalanced bridge, the circuit responds
not only to vDM but also to vCM. For obvious reasons Adm and Acm are called,
respectively, the differential-mode gain and the common-mode gain. Only in the
limit ϵ →0 do we obtain the ideal results Adm = R2/R1 and Acm = 0.
The ratio Adm/Acm represents a ﬁgure of merit of the circuit and is called the
common-mode rejection ratio (CMRR). Its value is expressed in decibels (dB) as
CMRRdB = 20 log10

Adm
Acm

(2.25)
For a true difference ampliﬁer, Acm →0 and thus CMRRdB →∞. For a sufﬁciently
small imbalance factor ϵ, the second term within parentheses in Eq. (2.24b) can be ig-
noredincomparisonwithunity,andwecanwrite Adm/Acm ∼= (R2/R1)/[R2ϵ/(R1+
R2)], or
CMRRdB ∼= 20 log10

1 + R2/R1
ϵ

(2.26)

84
CHAPTER 2
Circuits with
Resistive
Feedback
The reason for using the absolute value is that ϵ can be positive or negative, depending
on the direction of the imbalance. Note that for a given ϵ, the larger the differential
gain R2/R1, the higher the CMRR of the circuit.
EXAMPLE 2.9.
In Fig. 2.13a let R1 = R3 = 10 k and R2 = R4 = 100 k.
(a) Discuss the implications of using 1% resistors. (b) Illustrate the case in which the
inputs are tied together and are driven by a common 10-V source. (c) Estimate the
resistance tolerance needed for a guaranteed CMRR of 80 dB.
Solution.
(a) Proceeding along lines similar to those in Example 2.5, we can write |ϵ|max ∼= 4p,
where p isthepercentagetolerance.With p = 1% = 0.01,weget|ϵ|max ∼= 0.04.The
worst-case scenario corresponds to Adm(min) ∼= (100/10)[1−(210/110)×0.04/2] =
9.62 V/V ̸= 10 V/V, and Acm(max) ∼= (100/110) × 0.04 = 0.0364 ̸= 0. Thus,
CMRRmin = 20 log10(9.62/0.0364) = 48.4 dB.
(b) With vDM = 0 and vCM = 10 V, the output error can be as large as vO = Acm(max) ×
vCM = 0.0364 × 10 = 0.364 V ̸= 0.
(c) To achieve a higher CMRR, we need to further decrease ϵ. By Eq. (2.26), 80 ∼=
20 log10[(1 + 10)/|ϵ|max], or |ϵ|max = 1.1 × 10−3. Then p = |ϵ|max/4 = 0.0275%.
It is apparent that for high CMRRs the resistors must be very tightly matched.
TheINA105isageneral-purposemonolithicdifferenceampliﬁer4 withfouridentical
resistors that are matched within 0.002%. In that case, Eq. (2.26) yields CMRRdB =
100 dB.
The CMRR of a practical ampliﬁer can be maximized by adjusting one of its
resistors, usually R4. This is shown in Fig. 2.16. The selection of the series resistance
Rs and Rpot follows the lines of the Howland circuit of Example 2.6. Calibration
is done with the inputs tied together to eliminate vDM and evidence only vCM. The
latter is then ﬂipped back and forth between two predetermined values, such as −5 V
and +5 V, and the wiper is adjusted for a minimum variation at the output. To pre-
serve bridge balance with temperature and aging, it is advisable to use a metal-ﬁlm
resistor array.
So far we have assumed ideal op amps. When studying their practical limitations
in Chapter 5, we shall see that op amps are themselves sensitive to vCM, so the
CMRR of a practical difference ampliﬁer is actually the result of two effects: bridge
imbalance and op amp nonideality. The two effects are interrelated so that it is
possible to unbalance the bridge in such a way as to approximately cancel out the
R1
R3
R2
Rpot
R4
+
–
vO
Rs
–5 V
+5 V
vCM
FIGURE 2.16
Difference-ampliﬁer calibration.

85
SECTION 2.4
Difference
Ampliﬁers
R1
R1
R2
R2
R2
R2
+
–
+
vO
RG
+
v1
v2
FIGURE 2.17
Difference ampliﬁer with variable gain.
effect of the op amp. Indeed, this is what we do when we seek the minimum output
variation during the calibration routine.
Variable Gain
Equation (2.20b) might leave the impression that gain can be varied by varying just
one resistor, say, R2. Since we must also satisfy Eq. (2.20a), two resistors rather
than one would have to be varied, and in such a way as to maintain a very tight
matching. This awkward task is avoided with the modiﬁcation of Fig. 2.17, which
makes it possible to vary the gain without disturbing bridge balance. It is left as an
exercise (see Problem 2.31) to prove that if the various resistances are in the ratios
shown, then
vO = 2R2
R1

1 + R2
RG

(v2 −v1)
(2.27)
so that gain can be varied by varying the single resistor RG.
It is often desirable that gain vary linearly with the adjusting potentiometer to
facilitate gain readings from potentiometer settings. Unfortunately, the circuit of
Fig. 2.17 exhibits a nonlinear relationship between gain and RG. This drawback is
avoided by using an additional op amp, as in Fig. 2.18. As long as the closed-loop
R1
R1
R2
R3
R2
+
vO
RG
+
v1
v2
+
–
OA2
+
–
OA1
FIGURE 2.18
Difference ampliﬁer with linear gain control.

86
CHAPTER 2
Circuits with
Resistive
Feedback
output resistance of OA2 is negligible, bridge balance will be unaffected. Moreover,
since OA2 provides phase reversal, the feedback signal must now be applied to the
noninverting input of OA1. One can readily prove (see Problem 2.32) that
vO = R2RG
R1R3
(v2 −v1)
(2.28)
so that the gain is linearly proportional to RG.
Ground-Loop Interference Elimination
In practical installations source and ampliﬁer are often far apart and share the com-
mon ground bus with a variety of other circuits. Far from being a perfect conductor,
the ground bus has a small distributed resistance, inductance, and capacitance and
thus behaves as a distributed impedance. Under the effect of the various currents
ﬂowing on the bus, this impedance will develop a small voltage drop, causing differ-
ent points on the bus to be at slightly different potentials. In Fig. 2.19, Zg denotes the
ground-bus impedance between the input signal common Ni and the output signal
common No, and vg is the corresponding voltage drop. Ideally, vg should have no
effect on circuit performance.
Consider the arrangement of Fig. 2.19a, where vi is to be ampliﬁed by an
ordinary inverting ampliﬁer. Unfortunately, the ampliﬁer sees vi and vg in series, so
vo = −R2
R1
(vi + vg)
(2.29)
The presence of the vg term, generally referred to as ground-loop interference or also
cross-talkforcommonreturnimpedance, maydegradethequalityoftheoutputsignal
appreciably, especially if vi happens to be a low-level signal of magnitude compa-
rable to vg, as is often the case with transducer signals in industrial environments.
We can get rid of the vg term by regarding vi as a differential signal and vg
as a common-mode signal. Doing so requires changing the original ampliﬁer to a
difference-type ampliﬁer and using an additional wire for direct access to the input
+
R1
R2
+
–
Ni
vi
No
+
–
vo
–
+ vg
Zg
+
R1
R2
+
–
Ni
vi
No
+
–
vo
–
+ vg
Zg
R1
R2
(a)
(b)
FIGURE 2.19
Using a difference ampliﬁer to eliminate ground-loop interference.

87
SECTION 2.5
Instrumentation
Ampliﬁers
signal common, in the manner shown in Fig. 2.19b. By inspection, we now have
vo = −R2
R1
vi
(2.30)
The price we are paying in increased circuit complexity and wiring is certainly worth
the beneﬁts derived from the elimination of the vg term.
2.5
INSTRUMENTATION AMPLIFIERS
An instrumentation ampliﬁer (IA) is a difference ampliﬁer meeting the following
speciﬁcations: (a) extremely high (ideally inﬁnite) common-mode and differential-
mode input impedances; (b) very low (ideally zero) output impedance; (c) accurate
and stable gain, typically in the range of 1 V/V to 103 V/V; and (d) extremely high
common-mode rejection ratio. The IA is used to accurately amplify a low-level signal
in the presence of a large common-mode component, such as a transducer output in
process control and biomedicine. For this reason, IAs ﬁnd widespread application
in test and measurement instrumentation—hence the name.
With proper trimming, the difference ampliﬁer of Fig. 2.13 can be made to meet
the last three speciﬁcations satisfactorily. However, by Eq. (2.23), it fails to meet
the ﬁrst speciﬁcation because both its differential-mode and its common-mode input
resistances are ﬁnite; consequently, it will generally load down the circuit supplying
the voltages v1 and v2, not to mention the ensuing degradation in the CMRR. These
drawbacks are eliminated by preceding it with two high-input-impedance buffers.
The result is a classic circuit known as the triple-op-amp IA.
Triple-Op-Amp IAs
In Fig. 2.20 OA1 and OA2 form what is often referred to as the input or ﬁrst stage, and
OA3 forms the output or second stage. By the input voltage constraint, the voltage
R1
v2
v1
R2
R1
R2
R3
R3
+
RG
vO1
vO2
+
vO
+
–
OA1
+
–
OA2
+
–
OA3
FIGURE 2.20
Triple-op-amp instrumentation ampliﬁer.

88
CHAPTER 2
Circuits with
Resistive
Feedback
across RG is v1 −v2. By the input current constraint, the resistances denoted R3
carry the same current as RG. Applying Ohm’s law yields vO1 −vO2 = (R3 +
RG + R3)(v1 −v2)/RG, or
vO1 −vO2 =

1 + 2R3
RG

(v1 −v2)
Forobviousreasonstheinputstageisalsoreferredtoasa difference-input,difference-
output ampliﬁer. Next, we observe that OA3 is a difference ampliﬁer, and thus
vO = R2
R1
(vO2 −vO1)
Combining the last two equations gives
vO = A(v2 −v1)
(2.31a)
A = AI × AII =

1 + 2 R3
RG

×
 R2
R1

(2.31b)
indicating that the overall gain A is the product of the ﬁrst- and second-stage gains
AI and AII .
The gain depends on external resistance ratios, so it can be made quite accurate
and stable by using resistors of suitable quality. Since OA1 and OA2 are operated
in the noninverting conﬁguration, their closed-loop input resistances are extremely
high. Likewise, the closed-loop output resistance of OA3 is quite low. Finally, the
CMRR can be maximized by proper trimming of one of the second-stage resistances.
We conclude that the circuit meets all the IA requisites listed earlier.
Equation (2.31b) points the way to go if variable gain is desired. To avoid
perturbing bridge balance, we leave the second stage undisturbed and we vary gain
by varying the single resistance RG. If linear gain control is desired, we can use an
arrangement of the type of Fig. 2.18.
EXAMPLE 2.10.
(a) Design an IA whose gain can be varied over the range 1 V/V ≤
A ≤103 V/V by means of a 100-k pot. (b) Make provisions for a trimmer to optimize
its CMRR. (c) Outline a procedure for calibrating the trimmer.
Solution.
(a) Connectthe100-kpotasavariableresistor,anduseaseriesresistance R4 toprevent
RG from going to zero. Since AI > 1 V/V, we require AII < 1 V/V in order to allow
A to go all the way down to 1 V/V. Arbitrarily impose AII = R2/R1 = 0.5 V/V, and
use R1 = 100 k and R2 = 49.9 k, both 1%. By Eq. (2.31b), AI must be variable
from 2 V/V to 2000 V/V. At these extremes we have 2 = 1 + 2R3/(R4 + 100 k)
and 2000 = 1 + 2R3/(R4 + 0). Solving, we obtain R4 = 50  and R3 = 50 k.
Use R4 = 49.9  and R3 = 49.9 k, both 1%.
(b) Following Example 2.6, 4pR2 = 4 × 0.01 × 49.9 k = 2 k. To be on the safe
side, use a 47.5-k, 1% resistor in series with a 5-k pot. A suitable op amp is the
OP-27 precision op amp (Analog Devices). The circuit is shown in Fig. 2.21.
(c) To calibrate the circuit, tie the inputs together and set the 100-k pot for the max-
imum gain (wiper all the way up). Then, while switching the common inputs back
and forth between −5 V and +5 V, adjust the 5-k pot for the minimum change at
the output.

89
SECTION 2.5
Instrumentation
Ampliﬁers
+
–
R3
v1
R1
100 kΩ
R2
49.9 kΩ
R1
100 kΩ
R6
47.5 kΩ
49.9 kΩ
R4
49.9 Ω
R3
49.9 kΩ
R7
5 kΩ
R5
100 kΩ
OP-227
+
–
OP-227
+
–
OP-27
v2
vO
FIGURE 2.21
IA of Example 2.10.
The triple-op-amp IA conﬁguration is available in IC form from various manu-
facturers. Familiar examples are the AD522 and INA101. These devices contain all
components except for RG, which is supplied externally by the user to set the gain,
usually from 1 V/V to 103 V/V. Figure 2.22 shows a frequently used circuit symbol
for the IA, along with its interconnection for remote sensing. In this arrangement,
the sense and reference voltages are sensed right at the load terminals, so the effect
of any signal losses in the long wires is eliminated by including these losses within
the feedback loop. The accessibility to these terminals affords additional ﬂexibility,
such as the inclusion of an output power booster to drive high-current loads, or the
offsetting of the output with respect to ground potential.
+
–
+
–
+
–
v2
v1
RG
+
–
Load
Sense
Reference
Output
FIGURE 2.22
Standard IA symbol and connection for remote sensing.

90
CHAPTER 2
Circuits with
Resistive
Feedback
R4 (= R2)
R3 (= R1)
R1
v1
R2
v2
v3
+
vO
+
+
–
OA1
+
–
OA2 
FIGURE 2.23
Dual-op-amp instrumentation ampliﬁer.
Dual-Op-Amp IAs
When high-quality, costlier op amps are used to achieve superior performance, it is of
interest to minimize the number of devices in the circuit. Shown in Fig. 2.23 is an IA
that uses only two op amps. OA1 is a noninverting ampliﬁer, so v3 = (1+ R3/R4)v1.
By the superposition principle, vO = −(R2/R1)v3 + (1 + R2/R1)v2. Eliminating
v3, we can put vO in the form
vO =

1 + R2
R1

×

v2 −1 + R3/R4
1 + R1/R2
v1

(2.32)
For true difference operation we require 1 + R3/R4 = 1 + R1/R2, or
R3
R4
= R1
R2
(2.33)
When this condition is met, we have
vO =

1 + R2
R1

(v2 −v1)
(2.34)
Moreover, the circuit enjoys high input resistances and low output resistance. To
maximize the CMRR, one of the resistors, say, R4, should be trimmed. The adjust-
ment of the trimmer proceeds as in the triple-op-amp case.
Adding a variable resistance between the inverting inputs of the two op amps
as in Fig. 2.24 makes the gain adjustable. It can be shown (see Problem 2.45) that
+
–
OA1
+
–
OA2
R1
R1
v1
R2
R2
v2
v3
+
vO
RG
+
FIGURE 2.24
Dual-op-amp IA with variable gain.

91
SECTION 2.5
Instrumentation
Ampliﬁers
vO = A(v2 −v1), where
A = 1 + R2
R1
+ 2R2
RG
(2.35)
Compared with the triple-op-amp conﬁguration, the dual-op-amp version offers
the obvious advantage of requiring fewer resistors as well as one fewer op amp.
The conﬁguration is suited for realization with a dual-op-amp package, such as the
OP227. The tighter matching usually available with dual op amps offers a signiﬁcant
boost in performance. A drawback of the dual-op-amp conﬁguration is that it treats
the inputs asymmetrically because v1 has to propagate through OA1 before catching
up with v2. Because of this additional delay, the common-mode components of the
two signals will no longer cancel each other out as frequency is increased, leading
to a premature degradation of the CMRR with frequency. Conversely, the triple-op-
amp conﬁguration enjoys a higher degree of symmetry and usually maintains high
CMRR performance over a broader frequency range. The factors limiting the CMRR
here are mismatches in the delays through the ﬁrst-stage op amps, as well as bridge
imbalance and common-mode limitations of the second-stage op amp.
Monolithic IAs
The need for instrumentation ampliﬁcation arises so often that it justiﬁes the man-
ufacture of special ICs to perform just this function.2 Compared with realizations
built using general-purpose op amps, this approach allows better optimization of the
parameters that are critical to this application, particularly the CMRR, gain linearity,
and noise.
The task of ﬁrst-stage difference ampliﬁcation as well as common-mode rejec-
tion is delegated to highly matched transistor pairs. A transistor pair is faster than a
pair of full-ﬂedged op amps and can be made to be less sensitive to common-mode
signals, thus relaxing the need for very tightly matched resistances. Examples of
dedicated IC IAs are the AD521/524/624/625 and the AMP01 and AMP05.
Figure 2.25 shows a simpliﬁed circuit diagram of the AMP01, and Fig. 2.26
shows the basic interconnection to make it work with gains ranging from 0.1 V/V
to 104 V/V. As shown, the gain is set by the ratio of two user-supplied resistors RS
and RG as
A = 20 RS
RG
(2.36)
With this arrangement one can achieve highly stable gains by using a pair of
temperature-tracking resistors.
Referring to Fig. 2.25 and the connection of Fig. 2.26, we can describe circuit
operation as follows. Applying a differential signal between the inputs unbalances
the currents through Q1 and Q2. A1 reacts to this by unbalancing Q1 and Q2 in
the opposite direction in order to restore the balanced condition vN = vP at its
own inputs. A1 achieves this by applying a suitable drive to the bottom transistor
pair via A3. The amount of drive needed depends on the ratio RS/RG as well as on
the magnitude of the input difference. This drive forms the output of the IA.
Searching the web for the AMP01 data sheets, you will ﬁnd that CMRRdB = 140 dB
at A = 104 V/V.

92
CHAPTER 2
Circuits with
Resistive
Feedback
FIGURE 2.25
Simpliﬁed circuit diagram of the AMP01 low-noise precision IA. (Courtesy of Analog
Devices.)
FIGURE 2.26
Basic AMP01 connection for gains from 0.1 V/V to 10 V/mV.
(Courtesy of Analog Devices.)
Flying-Capacitor Techniques
A popular alternative for achieving high CMRRs is the ﬂying-capacitor technique,
so called because it ﬂips a capacitor back and forth between source and ampliﬁer. As
exempliﬁed3 in Fig. 2.27, ﬂipping the switches to the left charges C1 to the voltage
difference v2 −v1, and ﬂipping the switches to the right transfers charge from C1
to C2. Continuous switch clocking causes C2 to charge up until the equilibrium

93
SECTION 2.6
Instrumentation
Applications
+
–
R2
R1
v1
v2
C1
C2
C3
C4
+
+
vO
12
13
14
4
16
17
11
7
8
1 μF
1 μF
1 μF
5 V
5 V
–5 V
10 nF
LT1013
LTC1043
–5 V
FIGURE 2.27
Flying-capacitor IA. (Courtesy of Linear Technology.)
condition is reached in which the voltage across C2 becomes equal to that across
C1. This voltage is magniﬁed by the noninverting ampliﬁer to give
vO =

1 + R2
R1

(v2 −v1)
(2.37)
To achieve high performance, the circuit shown uses the LTC1043 precision
instrumentation switched-capacitor building block and the LT1013 precision op
amp. The former includes an on-chip clock generator to operate the switches at a
frequency set by C4. With C4 = 10 nF, this frequency is 500 Hz. The function of
C3 is to provide low-pass ﬁltering to ensure a clean output. Thanks to the ﬂying-
capacitor technique, the circuit completely ignores common-mode input signals to
achieve a high CMRR, typically3 in excess of 120 dB at 60 Hz.
2.6
INSTRUMENTATION APPLICATIONS
In this section we examine some issues arising in the application of instrumentational
ampliﬁers.2,4 Additional applications will be discussed in the next section.
Active Guard Drive
In applications such as the monitoring of hazardous industrial conditions, source
and ampliﬁer may be located far apart from each other. To help reduce the effect of
noise pickup as well as ground-loop interference, the input signal is transmitted in
double-ended form over a pair of shielded wires and then processed with a difference

94
CHAPTER 2
Circuits with
Resistive
Feedback
RG
+
vCM
vO
v1
v2
+
–
Rs1
Rs2
C1
C2
IA
Sense
Reference
FIGURE 2.28
Model of nonzero source resistance and distributed cable
capacitance.
ampliﬁer, such as an IA. The advantage of double-ended over single-ended trans-
mission is that since the two wires tend to pick up identical noise, this noise will
appear as a common-mode component and will thus be rejected by the IA. For this
reason, double-ended transmission is also referred to as balanced transmission. The
purpose of shielding is to help reduce differential-mode noise pickup.
Unfortunately, because of the distributed capacitance of the cable, another prob-
lem arises, namely, CMRR degradation with frequency. To investigate this aspect,
refer to Fig. 2.28, where the source resistances and cable capacitances have been
shown explicitly. Since the differential-mode component has been assumed to be
zero, we expect the output of the IA to be likewise zero. In practice, since the time
constants Rs1C1 and Rs2C2 are likely to be different, any variation in vCM will
produce uneven signal variations downstream of the RC networks, or v1 ̸= v2, thus
resulting in a differential error signal that the IA will then amplify and reproduce at
the output. The effect of RC imbalance is therefore a nonzero output signal in spite
of the absence of any differential-mode component at the source. This represents a
degradation in the CMRR.
The CMRR due to RC imbalance is
CMRRdB ∼= 20 log10
1
2π f RdmCcm
(2.38)
where Rdm = |Rs1 −Rs2| is the source resistance imbalance, Ccm = (C1 + C2)/2
is the common-mode capacitance between each wire and the grounded shield, and
f is the frequency of the common-mode input component. For instance, at 60 Hz,
a source resistance imbalance of 1 k in conjunction with a 100-foot cable having
a distributed capacitance of 1 nF would degrade the CMRR to 20 log10[1/(2π60 ×
103 × 10−9)] = 68.5 dB, even with an IA having inﬁnite CMRR.
The effect of Ccm can, to a ﬁrst approximation, be neutralized by driving the
shield with the common-mode voltage itself so as to reduce the common-mode
swing across Ccm to zero. Figure 2.29 shows a popular way of achieving this goal.
By op amp action, the voltages at the top and bottom nodes of RG are v1 and
v2. Denoting the voltage across R3 as v3, we can write vCM = (v1 + v2)/2 =
(v1 + v3 + v2 −v3)/2 = (vO1 + vO2)/2, indicating that vCM can be extracted by
computing the mean of vO1 and vO2. This mean is found via the two 20-k resistors
and is then buffered to the shield by OA4.

95
SECTION 2.6
Instrumentation
Applications
RG
+
+
vCM
vCM
vDM
vO
v2
v1
vO1
vO2
R1
R2
R1
R2
+
–
OA1
+
–
OA1
+
–
+
–
OA2
OA4
+
–
OA3
R3
20 kΩ
20 kΩ
R3
+
2
vDM
2
Cable
Shield
vCM
FIGURE 2.29
IA with active guard drive.
Digitally Programmable Gain
In automatic instrumentation, such as data acquisition systems, it is often desirable
to program the gain of the IA electronically, usually by means of JFET or MOSFET
switches. The method depicted in Fig. 2.30 programs the ﬁrst-stage gain AI by using
a string of symmetrically valued resistors, and a string of simultaneously activated
switch pairs to select the tap pair corresponding to a given gain. At any given time,
only one switch pair is closed and all others are open. By Eq. (2.31b), AI can be put
in the form
AI = 1 + Routside
Rinside
(2.39)
where Rinside is the sum of the resistances located between the two selected switches
and Routside is the sum of all remaining resistances. For the case shown, the selected
switch pair is SW1, so Routside = 2R1 and Rinside = 2(R2 + R3 +· · ·+ Rn)+ Rn+1.
Selecting SW2 gives Routside = 2(R1+ R2) and Rinside = 2(R3+· · ·+ Rn)+ Rn+1.
It is apparent that changing to a different switch pair increases (or decreases) Routside
at the expense of an equal decrease (or increase) in Rinside, thus yielding a different
resistance ratio and, hence, a different gain.
The advantage of this topology is that the current ﬂowing through any closed
switch is the negligible input current of the corresponding op amp. This is particularly
important when the switches are implemented with FETs because FETs have a
nonzero on-resistance, and the ensuing voltage drop could degrade the accuracy of
the IA. With zero current this drop is also zero, in spite of the nonideality of the
switch.
The two groups of switches in Fig. 2.30 can easily be implemented with
CMOS analog multiplexers/demultiplexers, such as the CD4051 or CD4052.

96
CHAPTER 2
Circuits with
Resistive
Feedback
+
–
OA1
+
–
OA2
vO
v2
v1
R
R
+
–
OA3
R2
R1
R1
R2
Rn + 1
R
R
SW0
SW1
SW2
SWn
SWn
SW2
SW1
SW0
FIGURE 2.30
Digitally programmable IA.
Digitally programmable IAs, containing all the necessary resistors, analog switches,
and TTL-compatible decoder and switch-driver circuitry, are also available in IC
form. Consult the manufacturer catalogs for more information.
Output-Offsetting
There are applications that call for a prescribed amount of offset at the output of
an IA, as when an IA is fed to a voltage-to-frequency converter, which requires
that its input range be of only one polarity. Since the IA output is usually bipolar,
it must be suitably offset to ensure a unipolar range. In the circuit of Fig. 2.31 the
reference node is driven by voltage VREF. This voltage, in turn, is obtained from
the wiper of a pot and is buffered by OA4, whose low output resistance prevents
disturbance of the bridge balance. Applying the superposition principle, we obtain
vO = A(v2 −v1) + (1 + R2/R1) × [R1/(R1 + R2)]VREF, or
vO = A(v2 −v1) + VREF
(2.40)

97
SECTION 2.6
Instrumentation
Applications
+
–
+
–
+
–
+
–
v2
v1
R2
R1
R2
OA2
OA1
OA3
OA4
VREF
R1
R3
R3
vO
RG
24 kΩ
100 kΩ
24 kΩ
+15 V
–15 V
FIGURE 2.31
IA with output offset control.
where A is given by Eq. (2.31b). With the component values shown, VREF is variable
from −10 V to +10 V.
Current-Output IAs
By turning the second stage into a Howland circuit, in the manner depicted in
Fig. 2.32, we can conﬁgure the triple-op-amp IA for current-output operation. This
type of operation is desirable when transmitting signals over long wires since the
stray wire resistance does not degrade current signals. Combining the results of
Problem 2.13 with Eq. (2.31b), we readily obtain
iO = 1 + 2R3/RG
R1
(v2 −v1)
(2.41)
The gain can be adjusted via RG, as usual. For efﬁcient operation, the Howland stage
can be improved with the modiﬁcation of Fig. 2.11. For high CMRR, the top left
resistance should be trimmed.
+
–
+
–
+
–
v2
v1
R2
R1
R2
OA2
OA1
OA3
R1
R3
R3
RG
+
–
vL
Load
iO
FIGURE 2.32
Current-output IA.

98
CHAPTER 2
Circuits with
Resistive
Feedback
+
–
+
–
OA2
OA1
R4
R3
R1
v1
R5
R2
v2
+
+
+
–
vL
Load
iO
FIGURE 2.33
Dual-op-amp IA with current output.
The dual-op-amp IA is conﬁgured for current-output operation by the bootstrap-
ping technique of Fig. 2.33. It is left as an exercise (see Problem 2.52) to prove that
the transfer characteristic of the circuit is of the type
iO = 1
R (v2 −v1) −1
Ro
vL
(2.42a)
Ro =
R2/R1
R5/R4 −(R2 + R3)/R1
R3
(2.42b)
so that imposing R2 + R3 = R1R5/R4 yields Ro = ∞. If adjustable gain is desired,
it is readily obtained by connecting a variable resistance RG between the inverting
input pins of the two op amps, in the manner of Fig. 2.24.
Besides offering difference-input operation with high input resistances, the cir-
cuit enjoys the efﬁciency advantages of the improved Howland circuit because R2
can be kept as small as needed while all remaining resistances can be made relatively
large to conserve power. When this constraint is imposed, the voltage compliance is
approximately |vL| ≤Vsat −R2|iO| = Vsat −2|v2 −v1|.
Current-Input IA
In current-loop instrumentation the need arises for sensing a ﬂoating current and
converting it to a voltage. To avoid perturbing the characteristics of the loop, it is
desirable that the circuit downstream appear as a virtual short. An IA can once again
be suitably modiﬁed to meet this requirement. In Fig. 2.34 we observe that OA1 and
OA2 force the voltages at their input pins to track vCM, thus ensuring 0 V across the
input source. By KVL and Ohm’s law, vO2 = vCM −R3iI and vO1 = vCM + R3iI .
But vO = (R2/R1) × (vO2 −vO1). Combining, we get
vO = −2R2
R1
R3iI
(2.43)
If variable gain is desired, this can be obtained by modifying the difference stage
as in Fig. 2.17 or 2.18. If, on the other hand, the difference stage is modiﬁed as in
Fig. 2.32, the circuit becomes a ﬂoating-input current ampliﬁer.

99
SECTION 2.7
Transducer Bridge
Ampliﬁers
+
–
OA3
+
–
OA1
+
–
OA2
R4
R3
iI
R3
R4
R2
R2
vO1
vO
vO2
R1
R1
+
–
vCM
FIGURE 2.34
Current-input IA.
2.7
TRANSDUCER BRIDGE AMPLIFIERS
Resistive transducers are devices whose resistance varies as a consequence of some
environmental condition, such as temperature (thermistors; resistance temperature
detectors, or RTDs), light (photoresistors), strain (strain gauges), and pressure
(piezoresistive transducers). By making these devices part of a circuit, it is pos-
sible to produce an electric signal that, after suitable conditioning, can be used to
monitor as well as control the physical process affecting the transducer.5 In general
it is desirable that the relationship between the ﬁnal signal and the original physical
variable be linear, so that the former can directly be calibrated in the physical units
of the latter. Transducers play such an important role in measurement and control
instrumentation that it is worth studying transducer circuits in some detail.
Transducer Resistance Deviation
Transducer resistances are expressed in the form R + R, where R is the resistance
at some reference condition, such as 0◦C in the case of temperature transducers, or
the absence of strain in the case of strain gauges, and R represents the deviation
from the reference value as a consequence of a change in the physical condition
affecting the transducer. Transducer resistances are also expressed in the alternative
form R(1 + δ), where δ = R/R represents the fractional deviation. Multiplying
δ by 100 yields the percentage deviation.
EXAMPLE 2.11.
Platinum resistance temperature detectors (Pt RTDs) have a temper-
ature coefﬁcient6 α = 0.00392/ ◦C. A popular Pt RTD reference value at T = 0 ◦C
is 100 . (a) Write an expression for the resistance as a function of T . (b) Compute
R(T ) for T = 25 ◦C, 100 ◦C, −15 ◦C. (c) Calculate R and δ for a temperature change
T = 10 ◦C.

100
CHAPTER 2
Circuits with
Resistive
Feedback
Solution.
(a) R(T ) = R(0 ◦C)(1 + αT ) = 100(1 + 0.00392T ) .
(b) R(25 ◦C) = 100(1 + 0.00392 × 25) = 109.8 . Likewise, R(100 ◦C) = 139.2 
and R(−15 ◦C) = 94.12 .
(c) R + R = 100 + 100αT = 100 + 100 × 0.00392 × 10 = 100  + 3.92 ;
δ = αT = 0.00392 × 10 = 0.0392. This corresponds to a change of 0.0392 ×
100 = 3.92%.
The Transducer Bridge
To measure resistance deviation, we must ﬁnd a method to convert R to a voltage
variation V . The simplest technique is to make the transducer part of a voltage
divider, as shown in Fig. 2.35. The transducer voltage is v1 = VREFR(1 + δ)/
[R1 + R(1 + δ)], which can be put in the insightful form
v1 =
R
R1 + R VREF +
δVREF
2 + R1/R + R/R1 + (1 + R/R1)δ
(2.44)
where δ = R/R. We observe that v1 consists of a ﬁxed term plus a term controlled
by δ = R/R. It is precisely the latter that interests us, so we must ﬁnd a means for
amplifying it while ignoring the former. This is achieved by using a second voltage
divider to synthesize the term
v2 =
R
R1 + R VREF
(2.45)
and then using an IA to take the difference v1 −v2. Denoting the IA gain as A, we
get vO = A(v1 −v2), or
vO = AVREF
δ
1 + R1/R + (1 + R/R1)(1 + δ)
(2.46)
Thefour-resistorstructureisthefamiliarresistivebridge,andthetwovoltagedividers
are referred to as the bridge legs.
It is apparent that vO is a nonlinear function of δ. In microprocessor-based
systems, a nonlinear function can easily be linearized in the software. Quite often,
however, we have δ ≪1, so
vO ∼=
AVREF
2 + R1/R + R/R1
δ
(2.47)
RG  
R1
R1
v1
v2
R
vO      
+
–
Reference
Sense
VREF
R(1 +  )
δ
IA
+
FIGURE 2.35
Transducer bridge and IA.

101
SECTION 2.7
Transducer Bridge
Ampliﬁers
indicating a linear dependence of vO on δ. Many bridges are designed with R1 = R,
in which case Eqs. (2.46) and (2.47) become
vO = AVREF
4
δ
1 + δ/2
(2.48)
vO ∼= AVREF
4
δ
(2.49)
EXAMPLE 2.12.
Let the tranducer of Fig. 2.35 be the Pt RTD of Example 2.11, and let
VREF = 15 V. (a) Specify values for R1 and A suitable for achieving an output sensitivity
of 0.1 V/◦C near 0 ◦C. To avoid self-heating in the RTD, limit its power dissipation to
less than 0.2 mW. (b) Compute vO(100 ◦C) and estimate the equivalent error, in degrees
Celsius, in making the approximation of Eq. (2.47).
Solution.
(a) Denoting the transducer current as i, we have PRTD = Ri2. Thus, i2 ≤PRTD(max)/R =
0.2 × 10−3/100, or i = 1.41 mA. To be on the safe side, impose i ∼= 1 mA, or
R1 = 15 k. For T = 1 ◦C we have δ = α × 1 = 0.00392, and we want
vO = 0.1 V. By Eq. (2.47) we need 0.1 = A×15×0.00392/(2+15/0.1+0.1/15),
or A = 258.5 V/V.
(b) For T = 100 ◦C we have δ = αT = 0.392. Inserting into Eq. (2.46), we get
vO(100 ◦C) = 9.974 V. Equation (2.47) predicts that vO(100 ◦C) = 10.0 V, which
exceeds the actual value by 10−9.974 = 0.026 V. Since 0.1 V corresponds to 1 ◦C,
0.026 V corresponds to 0.026/0.1 = 0.26 ◦C. Therefore, in using the approximated
expression, we cause, at 100 ◦C, an error of about one-quarter of a degree Celsius.
Bridge Calibration
With R = 0, a transducer bridge should be balanced and yield a zero voltage
difference between its taps. In practice, because of resistance tolerances, including
the tolerance of the transducer’s reference value, the bridge is likely to be unbalanced
and a trimmer should be included to balance it. Moreover, the tolerances in the values
of the resistances and of VREF will affect the bridge sensitivity (v1 −v2)/δ, thus
creating the need for adjustment of this parameter as well.
Figure 2.36 shows a circuit that allows for both adjustments. Varying R2’s wiper
from its midway position will assign more resistance to one leg and less to the other,
R
R(1 + )
R1
R2
R1
δ
RG
vO
+
–
IA
Sense
Reference
R3
VREF
+
FIGURE 2.36
Bridge calibration.

102
CHAPTER 2
Circuits with
Resistive
Feedback
thus allowing the compensation of their inherent mismatches. Varying R3 changes
the bridge current and hence the magnitude of the voltage variation produced by the
transducer, thus allowing the adjustment of the sensitivity.
EXAMPLE 2.13. Let all resistors in Example 2.12 have a 1% tolerance, and let VREF have
a 5% tolerance. (a) Design a circuit to calibrate the bridge. (b) Outline the calibration
procedure.
Solution.
(a) A 5% tolerance in VREF means that its actual value can deviate from its nominal
value by as much as ±0.05 × 15 = ±0.75 V. To be on the safe side and to also
include the effect of 1% resistance tolerance, assume a maximum deviation of ±1 V,
and thus design for 14 V ± 1 V at R2’s wiper. To ensure a current of 1 mA at
each leg, we need R3 = 2/(1 + 1) = 1 k and R + R1 + R2/2 = 14/1 =
14 k. Since R2 must compensate for up to a 1% variation on each leg, we need
R2 = 2 × 0.01 × 14 k = 280 . To be on the safe side, pick R2 = 500 .
Then R1 = 14 k −100  −500/2  = 13.65 k (use 13.7 k, 1%). The
IA gain A must be recomputed via Eq. (2.47), but with VREF = 14 V and with
13.7 k + 500/2  = 13.95 k in place of R1. This yields A = 257.8 V/V.
Summarizing, we need R1 = 13.7 k, 1%; R2 = 500 ; R3 = 1 k; and A =
257.8 V/V.
(b) To calibrate, ﬁrst set T = 0 ◦C and adjust R2 for vO = 0 V. Then set T = 100 ◦C
and adjust R3 for vO = 10.0 V.
Strain-Gauge Bridges
The resistance of a wire having resistivity ρ, cross-sectional area S, and length ℓ
is R = ρℓ/S. Straining the wire changes its length to ℓ+ ℓ, its area to S −S,
and its resistance to R + R = ρ(ℓ+ ℓ)/(S −S). Since its volume must
remain constant, we have (ℓ+ ℓ) × (S −S) = Sℓ. Eliminating S −S, we get
R = R(ℓ/ℓ)(2 + ℓ/ℓ). But ℓ/ℓ≪2, so
R = 2R ℓ
ℓ
(2.50)
where R is the unstrained resistance and ℓ/ℓis the fractional elongation. A strain
gauge is fabricated by depositing resistive material on a ﬂexible backing according
to a pattern designed to maximize its fractional elongation for a given strain. Since
strain gauges are sensitive also to temperature, special precautions must be taken to
mask out temperature-induced variations. A common solution is to work with gauge
pairs designed to compensate for each other’s temperature variations.
The strain-gauge arrangement of Fig. 2.37 is referred to as a load cell. Denoting
the bridge voltage as VB and ignoring R1 for a moment, the voltage divider formula
yields v1 = VB(R + R)/(R + R + R −R) = VB(R + R)/2R, v2 =
VB(R −R)/2R, and v1 −v2 = VBR/R = VBδ, so
vO = AVREFδ
(2.51)
The sensitivity is now four times as large as that given in Eq. (2.49), thus relaxing
the demands upon the IA. Furthermore, the dependence of vO on δ is now perfectly
linear—another advantage of working with gauge pairs. To achieve the +R and

103
SECTION 2.7
Transducer Bridge
Ampliﬁers
v1
v2
RG
vO
+
–
IA
Sense
Reference
R – ΔR
R + ΔR
R – ΔR
R + ΔR
R1
R2
R4
R3
+
VREF
VB
FIGURE 2.37
Strain-gauge bridge and IA.
−R variations, two of the gauges will be bonded to one side of the structure
under strain, and the other two to the opposite side. Even in installations in which
only one side is accessible, it pays to work with four gauges because two can be
used as dummy gauges to provide temperature compensation for the active ones.
Piezoresistive pressure sensors also use this arrangement.
Figure 2.37 also illustrates an alternative technique for balancing the bridge.
In the absence of strain, each tap voltage should be VB/2. In practice there will be
deviations due to the initial tolerances of the four gauges. By varying R2’s wiper,
wecanforceanadjustableamountofcurrentthrough R1 thatwillincreaseordecrease
the corresponding tap voltage until the bridge is nulled. Resistors R3 and R4 drop
VREF to VB, and R3 adjusts the sensitivity.
EXAMPLE 2.14.
Let the strain gauges of Fig. 2.37 be 120-, ±1% types, and let their
maximum current be limited to 20 mA to avoid excessive self-heating. (a) Assuming
that VREF = 15 V ± 5%, specify suitable values for R1 through R4. (b) Outline the
calibration procedure.
Solution.
(a) By Ohm’s law, VB = 2 × 120 × 20 × 10−3 = 4.8 V. In the absence of strain, the
tap voltages are nominally VB/2 = 2.4 V. Their actual values may deviate from
VB/2 by as much as ±1% of 2.4 V, that is, by as much as ±0.024 V. Consider
the case in which v1 = 2.424 V and v2 = 2.376 V. By moving R2’s wiper to
ground, we must be able to lower v1 to 2.376 V, that is, to change v1 by 0.048 V.
To achieve this, R1 must sink a current i = 0.048/(120 ∥120) = 0.8 mA, so
R1 ∼= 2.4/0.8 = 3 k (to be on the safe side, use R1 = 2.37 k, 1%). To prevent
excessive loading of R2’s wiper by R1, use R2 = 1 k. Under nominal conditions
we have iR3 = iR4 = 2 × 20 × 10−3 + 4.8/103 ∼= 45 mA. Following Example 2.13,
we wish R3 to drop a maximum of 2 V. So R3 = 2/45 = 44  (use R3 = 50 ). With
R3’s wiper halfway we have R4 = (15−25×45×10−3−4.8)/(45×10−3) = 202 
(use200).Summarizing, R1 = 2.37k, R2 = 1k, R3 = 50,and R4 = 200.
(b) To calibrate, ﬁrst adjust R2 so that with no strain we get vO = 0 V. Then apply
a known strain, preferably near the full scale, and adjust R3 for the desired value
of vO.

104
CHAPTER 2
Circuits with
Resistive
Feedback
+
–
R2
R
R1
R1
R2
+
R(1 + )
δ
VREF
vO
FIGURE 2.38
Single-op-amp bridge ampliﬁer.
Single-Op-Amp Ampliﬁer
For reasons of cost it is sometimes desirable to use a simpler ampliﬁer than the
full-ﬂedged IA. Figure 2.38 shows a bridge ampliﬁer implemented with a single op
amp. After applying Th´evenin’s theorem to the two legs of the bridge, we end up
with the familiar difference ampliﬁer. One can then show (see Problem 2.57) that
vO = R2
R VREF
δ
R1/R + (1 + R1/R2)(1 + δ)
(2.52)
For δ ≪1 this simpliﬁes to
vO ∼= R2
R VREF
δ
1 + R1/R + R1/R2
(2.53)
That is, vO depends linearly on δ. To adjust the sensitivity and to null the effect of
resistance mismatches, we can use a scheme of the type of Fig. 2.36.
Bridge Linearization
With the exception of the strain-gauge circuit of Fig. 2.37, all bridge circuits dis-
cussed so far suffer from the fact that the response is reasonably linear only as long as
δ ≪1. It is therefore of interest to seek circuit solutions capable of a linear response
regardless of the magnitude of δ.
The design of Fig. 2.39 linearizes the bridge by driving it with a constant
current.7 This is achieved by placing the entire bridge within the feedback loop
+
–
R
R
R1
R(1 + )
δ
R(1 +
)
δ
+
–
IA
OA
  
vO
v2
v1
VREF
RG
+
Sense
Reference
FIGURE 2.39
Bridge linearization by constant-current drive.

105
Problems
+
–
R2
R
R1
R1
+
R(1 + )
δ
vO
+
–
VREF
OA2
OA1
FIGURE 2.40
Single-transducer circuit with linear response.
of a ﬂoating-load V -I converter. The bridge current is IB = VREF/R1. By using
a transducer pair as shown, IB will split equally between the two legs. Since OA
keeps the bottom node of the bridge at VREF, we have v1 = VREF + R(1 + δ)IB/2,
v2 = VREF + RIB/2, and v1 −v2 = RδIB/2, so
vO = ARVREF
2R1
δ
(2.54)
The alternative design of Fig. 2.40 uses a single-transducer element and a pair
of inverting-type op amps.7 The response is again linearized by placing the bridge
within the feedback loop of the V -I converter OA1. It is left as an exercise (see
Problem 2.57) to show that
vO = R2VREF
R1
δ
(2.55)
For additional bridge circuit examples, see references 5, 7, and 8 and the end-of-
chapter problems.
PROBLEMS
2.1 Current-to-voltage converters
2.1 (a) Using an op amp powered from ±10-V regulated supplies, design a circuit that
accepts a source iS having parallel resistance Rs, and yields an output voltage vO
such that as iS is varied from 0 to +1 mA (ﬂowing into your circuit), vO varies from
+5 V to −5 V. Hint: You need to offset the output. (b) Find the minimum gain a for
a closed-loop gain deviation from the ideal by less than 0.01% for Rs = ∞. (c) Find
the minimum value of Rs for a closed-loop gain departure from the ideal by less than
0.025% with the minimum value of a found in (b).
2.2 (a) Using two op amps, design a circuit that accepts two input sources iS1 and iS2, both
ﬂowing into your circuit, and having parallel resistance Rs1 and Rs2, and gives, for
a →∞, vO = A1iS1 −A2iS2, where A1 = A2 = (10 V/mA). (b) How are A1 and A2
affected if Rs1 = Rs2 = 30 k and the op amps have a = 103 V/V?
2.3 Design a circuit to convert a 4-mA-to-20-mA input current to a 0-V-to-8-V output
voltage. The reference direction of the input source is from ground into your circuit,
and the circuit is powered from ±10-V regulated supplies.

106
CHAPTER 2
Circuits with
Resistive
Feedback
2.4 Estimate the closed-loop parameters if the circuit of Example 2.2 is implemented with
a 741 op amp.
2.5 (a) Using an op amp powered from ±5-V regulated supplies, design a photodetector
ampliﬁer such that as the photodiode current varies from 0 to 10 μA, vO varies from
−4 V to +4 V, under the constraint that no resistance greater than 100 k be used.
(b) Find the minimum gain a for a less than 0.1% closed-loop gain deviation from the
ideal.
2.6 (a) Let the op amp of Fig. P1.65 have a = 104 V/V, and let R1 = R3 = R5 = 20 k
and R2 = R4 = 10 k. Find vO/iI as well as the resistance Ri seen by the input source.
2.2 Voltage-to-current converters
2.7 (a) Show that the ﬂoating-load V -I converter of Fig. P2.7 yields iO = vI/(R1/k),
k = 1 + R2/R3. (b) Specify standard 5% resistances for a sensitivity of 2 mA/V and
Ri = 1 M, where Ri is the resistance seen by the input source. (c) If ±Vsat = ±10 V,
what is the voltage compliance of your circuit?
+
–
+
–
R2
R1
+
vI
vL
iO
R3
Load
FIGURE P2.7
2.8 (a) Except for a ﬁnite gain of a = 103 V/V, the op amp of Fig. P2.7 is ideal. If
R1 = R2 = 100 k, ﬁnd R3 for a sensitivity of 1 mA/V. What are the element values
of the Norton equivalent seen by the load? (b) If vI = 2.0 V, what is the value of iO for
vL = 5 V? For vL = −4 V?
2.9 Consider the following statements about the resistance Ro seen by the load in the V -I
converter of Fig. 2.4b, where the op amp is assumed ideal: (a) Looking toward the left,
the load sees R ∥rd = R ∥∞= R, and looking to the right, it sees ro = 0; hence,
Ro = R + 0 = R. (b) Looking toward the left, the load sees a virtual-ground node
with zero resistance, and looking to the right, it sees ro = 0; hence, Ro = 0 + 0 = 0.
(c) Ro = ∞because of negative feedback. Which statement is correct? How would
you refute the other two?
2.10 (a) Assuming ideal op amp in the Howland pump of Fig. 2.6a, show that under the
condition of Eq. (2.9), the resistance Ri seen by the source vI can be positive, negative,
or even inﬁnite, depending on the load resistance RL. (b) Justify physically for the
simpliﬁed case R1 = R2 = R3 = R4.
2.11 (a) Use Blackman’s formula to verify the expression for Ro of Eq. (2.14). (b) Suppose
a Howland pump is implemented with four 1.0-k matched resistors and an op amp
having a = 104 V/V. If vI = −1.0 V, what is iO for vL = 0? For vL = +5 V? For
vL = −2.5 V?
2.12 Using a 741 powered from ±15-V regulated supplies, design a Howland pump that will
sink (rather than source) 1.5 mA from a grounded load with a voltage compliance of

107
Problems
±10 V. To make the circuit self-contained, use the −15-V supply voltage as the input
vI. Then ﬁnd the current through R1 and R2 if the load is (a) a 2-k resistor; (b) a
6-k resistor; (c) a 5-V Zener diode with the cathode at ground; (d) a short circuit; (e)
a 10-k resistor. In (e), is iO still 1.5 mA? Explain.
2.13 Suppose in the Howland circuit of Fig. 2.6a we lift the left terminal of R3 off ground
and simultaneously apply an input v1 via R3 and an input v2 via R1. Show that the
circuit is a difference V -I converter with iO = (1/R1)(v2 −v1) −(1/Ro)vL, where Ro
is given by Eq. (2.8).
2.14 Design a grounded-load V -I converter that converts a 0-V to 10-V input to a 4-mA to
20-mA output. The circuit is to be powered from ±15-V regulated supplies.
2.15 Design a grounded-load current generator meeting the following speciﬁcations: iO is to
bevariableovertherange−2mA ≤iO ≤+2mAbymeansofa100-k pot;thevoltage
compliance must be 10 V; the circuit is to be powered from ±15-V regulated supplies.
2.16 (a) Prove Eq. (2.15). (b) Using a 741 op amp powered from ±15-V supplies, design an
improved Howland circuit with a sensitivity of 1 mA/V for −10 V ≤vI ≤10 V. Your
circuit must work properly over the range −10 V ≤vL ≤+10 V.
2.17 Suppose the improved Howland pump of Fig. 2.11 is implemented with R1 = R3 =
R4 = 20.0 k, R2A = R2B = 10.0 k, and an op amp with a = 104 V/V. Find Ro via
the test method, and check your result via Blackman’s formula.
2.18 Suppose the Howland pump of Example 2.4 drives a 0.1-μF load. (a) Assuming the
capacitance is initially discharged, sketch and label vO(t ≥0), and ﬁnd the time it takes
for the op amp to reach saturation. (b) Repeat if R4 is decreased by 10%.
2.19 Sketch and label vO(t ≥0) if the Howland pump of Example 2.4 drives an initially
discharged 1-μF capacitor, and R4 is increased by 10%.
2.20 Design an improved Howland circuit whose sensitivity is variable from 0.1 mA/V to
1 mA/V by means of a 100-k pot.
2.21 (a) Given that the circuit of Fig. P2.21 yields iO = A(v2 −v1)−(1/Ro)vL, ﬁnd expres-
sions for A and Ro, as well as the condition among the resistances that yields Ro = ∞.
(b) Discuss the effect of using 1% resistances.
R1
R2
R3
R4
v1
iO
+
v2
R5
Load
+
+
–
vL
+
–
–
+
OA1
OA2
FIGURE P2.21

108
CHAPTER 2
Circuits with
Resistive
Feedback
2.22 (a) Given that the circuit of Fig. P2.22 yields iO = AvI – (1/Ro)vL, ﬁnd expressions
for A and Ro, as well as the condition among its resistances that yields Ro = ∞.
(b) Discuss the effect of using 1% resistances.
R4
R3
R2
R1
R5
+
vI
+
–
vL Load
iO
+
–
OA1
+
–
OA2
FIGURE P2.22
2.23 Repeat Problem 2.22 for the circuit of Fig. P2.23.
+
+
–
–
R1
R3
iO
OA2
+
–
R1
R1
OA1
vI
vL
R1
+
R2
Load
FIGURE P2.23
2.3 Current ampliﬁers
2.24 (a) Prove Eq. (2.18). (b) Assuming a 741 op amp in Fig. 2.12a, specify resistances for
A = 10 A/A; estimate the gain error as well as the output resistance of the circuit.
2.25 Find the gain as well as the output impedance of the current ampliﬁer of Fig. P2.25.
R1
R2
Rs
iO
iS
Load
+
–
+
–
vL
FIGURE P2.25
2.26 Show that if Rs = ∞and a ̸= ∞in the current ampliﬁer of Fig. 2.12b, then Eq. (2.18)
holds.
2.27 A grounded-load current ampliﬁer can be implemented by cascading an I-V and a
V -I converter. Using resistances no greater than 1 M, design a current ampliﬁer with
Ri = 0, A = 105 A/A, Ro = ∞, and a full-scale input of 100 nA. Assuming ±10-V
saturation voltages, the voltage compliance must be 5 V.
2.28 Suitably modify the circuit of Fig. P2.23 so that it becomes a current ampliﬁer with
Ri = 0, A = 100 A/A, and Ro = ∞. Assume ideal op amps.

109
Problems
2.29 In Fig. P2.29 the odd-numbered inputs are fed to OA2’s summing junction directly, and
the even-numbered inputs are fed via a current reverser. Obtain a relationship between
vO and the various inputs. What happens if any of the inputs are left ﬂoating? Will it
affect the contribution from the other inputs? What is an important advantage of this
circuit compared to that of Problem 1.33?
+
–
R
R2
R
+
–
R4
RF
OA2
OA1
R1
R3
vO
v3
v1
v4
v2
FIGURE P2.29
2.4 Difference ampliﬁers
2.30 Derive Eq. (2.23).
2.31 (a) Derive Eq. (2.27). (b) Using a 100-k pot, specify suitable resistances such that
varying the wiper from end to end varies the gain from 10 V/V to 100 V/V.
2.32 (a) Derive Eq. (2.28). (b) Specify suitable component values such that gain can be
varied from 1 V/V to 100 V/V.
2.33 (a) A difference ampliﬁer has v1 = 10 cos(2π60t) V −5 cos(2π103t) mV, and v2 =
10 cos(2π60t) V+5 cos(2π103t) mV. If vO = 100 cos(2π60t) mV+2 cos(2π103t) V,
ﬁnd Adm, Acm, and CMRRdB. (b) Repeat (a) with v1 = 10.01 cos(2π60t) V −5 cos
(2π103t) mV, v2 = 10.00 cos(2π60t) V + 5 cos(2π103t) mV, and vO = 0.5 cos
(2π60t) V + 2.5 cos(2π103t) V.
2.34 IftheactualresistancevaluesinFig.2.13a arefoundtobe R1 = 1.01k, R2 = 99.7k,
R3 = 0.995 k, and R4 = 102 k, estimate Adm, Acm, and CMRRdB.
2.35 If the difference ampliﬁer of Fig. 2.13a has a differential-mode gain of 60 dB and
CMRRdB = 100 dB, ﬁnd vO if v1 = 4.001 V and v2 = 3.999 V. What is the percentage
error of the output due to ﬁnite CMRR?
2.36 If the resistance pairs are perfectly balanced and the op amp is ideal in the difference am-
pliﬁer of Fig. 2.13a, then we have CMRRdB = ∞. But what if the open-loop gain a is
ﬁnite, everything else being ideal? Is the CMRR still inﬁnite? Justify your ﬁnding
intuitively.

110
CHAPTER 2
Circuits with
Resistive
Feedback
2.37 A student is trying out the difference ampliﬁer of Fig. 2.13a in the lab. The student uses
two pairs of perfectly matched resistances, R3 = R1 = 1.0 k and R4 = R2 = 100 k,
thus expecting CMRR = ∞. (a) A peer decides to play a prank by installing an addi-
tional 1-M resistor between nodes v1 and vP. How is the CMRR affected? (b) Repeat,
if the 1-M resistor is installed between node vN and ground. (c) Repeat, if the 1-M
resistor is installed between nodes vO and vP.
2.38 Suppose the circuit of Fig. P2.29 is used with only the v1 and v2 inputs, and is imple-
mented with 10-k resistors throughout to give vO = v2 – v1 with CMRR = ∞. (a)
Investigate the effect on the CMRR if we use 0.1% resistors and otherwise ideal op
amps. (b) Investigate the effect of using perfectly matched resistors but op amps with
gains of a = 104 V/V.
2.39 If implemented with R1 = R2 = R3 = R4 and ideal op amps, the circuit of Fig. P2.21
gives iO = (v2 – v1)/R5 regardless of the load. As such, it is a difference ampliﬁer,
and therefore prone to CMRR limitations if the resistances are mismatched and
op amps have a ̸= ∞. For the present circuit we deﬁne Adm = iDM(SC)/vDM and
Acm = iCM(SC)/vCM, where iDM(SC) and iCM(SC) are, respectively, the short-circuit
differential-mode and common-mode output currents, and vDM and vCM are as de-
ﬁned in Eq. (2.21). (a) Investigate the effect on the CMRR if we use 1% resistors and
otherwise ideal op amps. (b) Investigate the effect of using perfectly matched resistors
but op amps with gains of a = 103 V/V.
2.5 Instrumentation ampliﬁers
2.40 In the IA of Fig. 2.20 let R3 = 1 M, RG = 2 k, and R1 = R2 = 100 k. If vDM is
an ac voltage with a peak amplitude of 10 mV and vCM is a dc voltage of 5 V, ﬁnd all
node voltages in the circuit.
2.41 Show that if OA1 and OA2 in Fig. 2.20 have the same open-loop gain a, together they
form a negative-feedback system with input vI = v1 −v2, output vO = vO1 −vO2,
open-loop gain a, and feedback factor β = RG/(RG + 2R3).
2.42 A triple-op-amp IA is to be implemented with A = AI × AII = 50 × 20 = 103 V/V.
Assuming matched input-stage op amps, ﬁnd the minimum open-loop gain required of
each op amp for a 0.1% maximum deviation of A from the ideal.
2.43 Compared with the classical triple-op-amp IA, the IA of Fig. P2.43 (see EDN, Oct. 1,
1992, p. 115) uses fewer resistances. The wiper, nominally positioned halfway, is used
to maximize the CMRR. Show that vO = (1 + 2R2/R1)(v2 −v1).
–
+
R2
OA3
–
+OA1
+
–OA2
20 kΩ
R1
1 kΩ
R2
20 kΩ
R3
30 kΩ
v2
vO
v1
FIGURE P2.43

111
Problems
2.44 (a) To investigate the effect of mismatched resistances in the IA of Fig. 2.23, assume
that R3/R4 = (R1/R2)(1 −ϵ). Show that vO = AdmvDM + AcmvCM, where Adm =
1 + R2/R1 −ϵ/2 and Acm = ϵ. (b) Discuss the implications of using 1% resistors
without trimming for the case A = 102 V/V.
2.45 (a) Derive Eq. (2.35). (b) Specify suitable components such that A can be varied over
the range 10 V/V ≤A ≤100 V/V by means of a 10-k pot.
2.46 The gain of the dual-op-amp IA of Fig. P2.46 (see EDN, Feb. 20, 1986, pp. 241–242) is
adjustable by means of a single resistor RG. (a) Show that vO = 2(1+ R/RG)(v2 −v1).
(b) Specify suitable components to make A variable from 10 V/V to 100 V/V by means
of a 10-k pot.
+
–
+
–
R
RG
vO
R
R
v2
v1
R
OA1
OA2
FIGURE P2.46
2.47 The dual-op-amp IA of Fig. P2.47 (see Signals and Noise, EDN, May 29, 1986) offers
the advantage that by proper adjustment of the pot, a fairly high CMRR can be achieved
and maintained well into the kilohertz range. Show that vO = (1 + R2/R1)(v2 −v1).
+
–
+
–
R1
vO
Rpot
R2
R2
v2
R1
v1
OA1
OA2
50 pF
FIGURE P2.47
2.48 Assuming perfectly matched resistances as well as perfectly matched op amps in the
dual-op-amp IA of Fig. 2.23, investigate the effect of ﬁnite open-loop op amp gain a
upon the CMRR of the circuit (except for their ﬁnite gain, both op amps are ideal).
Assuming a = 105 V/V, ﬁnd CMRRdB if A = 103 V/V. Repeat, but if A = 10 V/V,
and comment on your ﬁndings.

112
CHAPTER 2
Circuits with
Resistive
Feedback
2.49 A technician is assembling the dual-op amp IA of Fig. 2.23 using two pairs of perfectly
matched resistances, R3 = R1 = 2.0 k and R4 = R2 = 18 k. (a) If he inadvertently
installs an additional 1-M resistor between OA2’s inverting input vN2 and ground,
how is the CMRR affected? (b) What if the same resistor is connected between vN2 and
v1 instead?
2.6 Instrumentation applications
2.50 Design a digitally programmable IA having an overall gain of 1 V/V, 10 V/V, 100 V/V,
and 1000 V/V. Show the ﬁnal design.
2.51 Assuming ±15-V regulated power supplies, design a programmable IA with two op-
erating modes: in the ﬁrst mode the gain is 100 V/V and the output offset is 0 V; in the
second mode the gain is 200 V/V and the output offset is −5 V.
2.52 (a) Derive Eq. (2.42). (b) In the current-output IA of Fig. 2.33 specify suitable compo-
nents for a sensitivity of 1 mA/V. (c) Investigate the effect of using 0.1% resistances.
2.53 In the circuit of Fig. 2.33 let R1 = R4 = R5 = 10 k, R2 = 1 k, and R3 = 9 k. If
an additional resistance RG is connected between the inverting input nodes of the two
op amps, ﬁnd the gain as a function of RG.
2.54 (a) Design a current-output IA whose sensitivity can be varied from 1 mA/V to
100 mA/V by means of a 100-k pot. The circuit must have a voltage compliance of
at least 5 V with ±15-V supplies, and it must have provision for CMRR optimization
by means of a suitable trimmer. (b) Outline the procedure for calibrating the trimmer.
2.55 Design a current-input, voltage-output IA with a gain of 10 V/mA.
2.7 Transducer bridge ampliﬁers
2.56 Repeat Example 2.12 using the single-op-amp conﬁguration of Fig. 2.38. Show the
ﬁnal circuit.
2.57 (a) Derive Eqs. (2.52) and (2.53). (b) Derive Eq. (2.55).
2.58 Assuming that VREF = 2.5 V in Fig. 2.39, specify suitable component values for an
output sensitivity of 0.1 V/◦C with a Pt RTD.
2.59 (a) Assuming that VREF = 15 V in Fig. 2.40, specify suitable component values for an
output sensitivity of 0.1 V/◦C with a Pt RTD. (b) Assuming the same tolerances as in
Example 2.13, make provisions for bridge calibration.
2.60 Show that the linearized bridge circuit of Fig. P2.60 yields vO = −RVREFδ/
(R1 + R). Name a disadvantage of this circuit.
+
–
R
R(1+ )
δ
R1
R1
+
VREF
vO
FIGURE P2.60

113
References
2.61 Using the circuit of Fig. P2.60 with VREF = 2.5 V and an additional gain stage, design
an RTD ampliﬁer circuit with a sensitivity of 0.1 V/◦C. The circuit is to have provisions
for bridge calibration. Outline the calibration procedure.
2.62 Show that the linearized bridge circuit7 of Fig. P2.62 (U.S. Patent 4,229,692) yields
vO = R2VREFδ/R1. Discuss how you would make provisions for calibrating the circuit.
+
–
+
–
R1
R
R1
R(1 +    )
+
R2
VREF
OA1
OA2
vO
δ   
FIGURE P2.62
REFERENCES
1. J. Graeme, “Photodiode Ampliﬁers–Op Amp Solutions, McGraw-Hill, New York, 1996,
ISBN-10-007024247X.
2. C. Kitchin and L. Counts, A Designer’s Guide to Instrumentation Ampliﬁers, 3d ed.,
Analog Devices, Norwood, MA, 2006, http://www.analog.com/static/imported-ﬁles/
design handbooks/5812756674312778737Complete In Amp.pdf.
3. J. Williams, “Applications for a Switched-Capacitor Instrumentation Building Block,”
Linear Technology Application Note AN-3, http://cds.linear.com/docs/en/application-
note/an03f.pdf.
4. N. P. Albaugh, “The Instrumentation Ampliﬁer Handbook, Including Applications,”
http://www.cypress.com/?docID=38317.
5. Analog Devices Engineering Staff, Practical Design Techniques for Sensor Signal
Conditioning, Analog Devices, Norwood, MA, 1999, ISBN-0-916550-20-6.
6. “Practical Temperature Measurements,” Application Note 290, Hewlett-Packard, Palo
Alto, CA, 1980.
7. J. Graeme, “Tame Transducer Bridge Errors with Op Amp Feedback Control,” EDN,
May 26, 1982, pp. 173–176.
8. J. Williams, “Good Bridge-Circuit Design Satisﬁes Gain and Balance Criteria,” EDN,
Oct. 25, 1990, pp. 161–174.

3
ACTIVE FILTERS: PART I
3.1 The Transfer Function
3.2 First-Order Active Filters
3.3 Audio Filter Applications
3.4 Standard Second-Order Responses
3.5 KRC Filters
3.6 Multiple-Feedback Filters
3.7 State-Variable and Biquad Filters
3.8 Sensitivity
Problems
References
A ﬁlter is a circuit that processes signals on a frequency-dependent basis. The manner
in which its behavior varies with frequency is called the frequency response and is
expressed in terms of the transfer function H( jω), where ω = 2π f is the angular
frequency, in radians per second (rad/s), and j is the imaginary unit ( j2 = −1). This
response is further specialized as the magnitude response |H( jω)| and the phase
response H( jω), giving, respectively, the gain and phase shift experienced by an
ac signal in going through the ﬁlter.
Common Frequency Responses
On the basis of magnitude response, ﬁlters are classiﬁed as low-pass, high-pass,
band-pass, and band-reject (or notch) ﬁlters. A ﬁfth category is provided by all-pass
ﬁlters, which process phase but leave magnitude constant. With reference to Fig. 3.1,
we ideally deﬁne these responses as follows.
The low-pass response is characterized by a frequency ωc, called the cutoff
frequency, such that |H| = 1 for ω < ωc and |H| = 0 for ω > ωc, indicating that input
114

115
CHAPTER 3
Active Filters:
Part I
ÔH( jω)Ô
0
1
ω
ωc
0
1
ωc
0
1
ω
ω
ωH
L
ωH
ωL
0
–t0
1
ω
ω
ω
(a)
(b)
(c)
(d)
0
1
ω
<) H( jω)
0
0
(e)
(f)
ω
ω
ω
ω
ω
ω
ÔH( jω)Ô
ω
ÔH( jω)Ô
ω
ÔH( jω)Ô
ω
ÔH( jω)Ô
ω
FIGURE 3.1
Idealized ﬁlter responses: (a) low-pass, (b) high-pass, (c) band-pass,
(d) band-reject, and (e), ( f ) all-pass.
signals with frequency less than ωc go through the ﬁlter with unchanged amplitude,
while signals with ω > ωc undergo complete attentuation. A common low-pass ﬁlter
application is the removal of high-frequency noise from a signal.
The high-pass response is complementary to the low-pass response. Signals with
frequency greater than the cutoff frequency ωc emerge from the ﬁlter unattenuated,
and signals with ω < ωc are completely blocked out.
The band-pass response is characterized by a frequency band ωL < ω < ωH,
called the passband, such that input signals within this band emerge unattenuated,
while signals with ω < ωL or ω > ωH are cut off. A familiar band-pass ﬁlter is the
tuning circuitry of a radio, which allows the user to select a particular station and
block out all others.
The band-reject response is complementary to the band-pass response because it
blocks out frequency components within the stopband ωL < ω < ωH, while passing
all the others. When the stopband is sufﬁciently narrow, the response is called a
notch response. An application of notch ﬁlters is the elimination of unwanted 60-Hz
pickup in medical equipment.
The all-pass response is characterized by |H| = 1 regardless of frequency, and
H = −t0ω, where t0 is a suitable proportionality constant, in seconds. This ﬁlter

116
CHAPTER 3
Active Filters:
Part I
FIGURE 3.2
Effect of ﬁltering in the frequency domain (left) and in the time domain
(right).
passes an ac signal without affecting its amplitude, but it delays it in proportion to its
frequency ω. For obvious reasons, all-pass ﬁlters are also called delay ﬁlters. Delay
equalizers and wideband 90◦phase-shift networks are examples of all-pass ﬁlters.
Figure 3.2 illustrates the effects of the ﬁrst four ideal ﬁlter types using the input
voltage
vI (t) = 0.8 sin ω0t + 0.5 sin 4ω0t + 0.2 sin 16ω0t V
as an example. Shown at the left are the spectra that we would observe with a
spectrum analyzer; shown at the right are the waveforms that we would observe
with an oscilloscope. The spectrum and waveform at the top pertain to the input
signal, and those below pertain, respectively, to the low-pass, high-pass, band-pass,
and band-reject outputs. For instance, if we send vI (t) through a low-pass ﬁlter with
ωc somewhere between 4ω0 and 16ω0, the ﬁrst two components are multiplied by
1 and thus passed, but the third component is multiplied by 0 and is thus blocked:
the result is vO(t) = 0.8 sin ω0t + 0.5 sin 4ω0t V.
As we proceed, we shall see that the practical ﬁlters provide only approximations
to the idealized brick-wall magnitudes shown in the ﬁgure and also that they affect
phase.

117
CHAPTER 3
Active Filters:
Part I
Active Filters
Filter theory is a vast discipline, and it is documented in a number of textbooks ded-
icated only to it.1−4 Filters can be built solely from resistors, inductors and capacitors
(RLC ﬁlters), which are passive components. However, after the emergence of the
feedback concept, it was realized that incorporating an ampliﬁer in a ﬁlter circuit
made it possible to achieve virtually any response, but without the use of inductors.
This is a great advantage because inductors are the least ideal among the basic circuit
elements, and are also bulky, heavy, and expensive—they do not lend themselves to
IC-type mass production.
How ampliﬁers manage to displace inductors is an intriguing issue that we shall
address. Here, we intuitively justify how by noting that an ampliﬁer can take energy
from its power supplies and inject it into the surrounding circuitry to make up for
energy losses in the resistors. Inductors and capacitors are nondissipative elements
that can store energy during part of a cycle and release it during the rest of the cycle.
An ampliﬁer, backed by its power supply, can do the same and more because, unlike
inductors and capacitors, it can be made to release more energy than is actually
absorbed by the resistors. Ampliﬁers are said to be active elements because of this,
and ﬁlters incorporating ampliﬁers are called active ﬁlters. These ﬁlters provide one
of the most fertile areas of application for op amps.
An active ﬁlter will work properly only to the extent that the op amp will.
The most serious op amp limitation is the open-loop gain rolloff with frequency,
an issue addressed at length in Chapter 6. This limitation generally restricts active-
ﬁlter applications below 100 MHz or so. This includes the audio and instrumentation
ranges, where op amp ﬁlters ﬁnd their widest application and where inductors would
be too bulky to compete with the miniaturization available with ICs. Beyond the
frequency reach of op amps, inductors take over again, so high-frequency ﬁlters are
still implemented with passive RLC components. In these ﬁlters, inductor sizes and
weights are more manageable as inductance and capacitance values decrease with
the operating frequency range.
Chapter Highlights
In the present chapter we study ﬁrst-order and second-order active ﬁlters (higher-
order ﬁlters and switched-capacitor ﬁlters are covered in Chapter 4). After an intro-
duction to general ﬁlter concepts, the chapter turns to ﬁrst-order ﬁlters and common
applications thereof, such as audio applications. Next, it turns to second-order ac-
tive ﬁlters in common use today, such as KRC ﬁlters, multiple-feedback ﬁlters, and
state-variable/biquad ﬁlters. The chapter concludes with an introduction to ﬁlter
sensitivities. The chapter makes generous use of SPICE to plot ﬁlter responses and
perform measurements as when using the oscilloscope in the lab.
The subject of ﬁlters is quite vast (entire books are devoted to just this one
subject), so here we must of necessity limit ourselves to the most popular ﬁlter
types. Also, the study of active ﬁlters can be overwhelming, at least for the beginner,
so to keep things manageable we deliberately assume ideal op amps. It is felt that
only after having mastered ﬁlter concepts can we broaden our scope by turning to
the effect of op amp nonidealities. This issue is deferred to Chapters 5 and 6.

118
CHAPTER 3
Active Filters:
Part I
3.1
THE TRANSFER FUNCTION
Filters are implemented with devices exhibiting frequency-dependent characteris-
tics, such as capacitors and inductors. When subjected to ac signals, these elements
oppose current ﬂow in a frequency-dependent manner and also introduce a 90◦phase
shift between voltage and current. To account for this behavior, we use the complex
impedances ZL = sL and ZC = 1/sC, where s = σ + jω is the complex frequency,
in complex nepers per second (complex Np/s). Here, σ is the neper frequency, in
nepers per second (Np/s) and ω is the angular frequency, in radians per second
(rad/s).
The behavior of a circuit is uniquely characterized by its transfer function H(s).
To ﬁnd this function, we ﬁrst derive an expression for the output Xo in terms of
the input Xi (Xo and Xi can be voltages or currents) using familiar tools such as
Ohm’s law V = Z(s)I, KVL, KCL, the voltage and current divider formulas, and
the superposition principle. Then, we solve for the ratio
H(s) = Xo
Xi
(3.1)
Once H(s) is known, the response xo(t) to a given input xi(t) can be found as
xo(t) = +−1{H(s)Xi(s)}
(3.2)
where +−1 denotes the inverse Laplace transform, and Xi(s) is the Laplace trans-
form of xi(t).
Transfer functions turn out to be rational functions of s,
H(s) = N(s)
D(s) = amsm + am−1sm−1 + · · · + a1s + a0
bnsn + bn−1sn−1 + · · · + b1s + b0
(3.3)
where N(s) and D(s) are suitable polynomials of s with real coefﬁcients and
with degrees m and n. The degree of the denominator determines the order of
the ﬁlter (ﬁrst-order, second-order, etc.). The roots of the equations N(s) = 0 and
D(s) = 0 are called, respectively, the zeros and the poles of H(s), and are denoted
as z1, z2, . . . , zm, and p1, p2, . . . , pn. Factoring out N(s) and D(s) in terms of their
respective roots, we can write
H(s) = H0
(s −z1)(s −z2) · · · (s −zm)
(s −p1)(s −p2) · · · (s −pn)
(3.4)
where H0 = am/bn is called the scaling factor. Aside from H0, H(s) is uniquely
determined once its zeros and poles are known. Roots are also referred to as critical
or characteristic frequencies because they depend solely on the circuit, that is, on its
elements and the way they are interconnected, irrespective of its signals or the energy
stored in its reactive elements. In fact, essential circuit speciﬁcations are often given
in terms of the roots.
Roots can be real or complex. When zeros or poles are complex, they occur in
conjugate pairs. For instance, if pk = σk + jωk is a pole, then p∗
k = σk −jωk is also
apole.Rootsareconvenientlyvisualizedaspointsinthecomplexplane,orsplane:σk
is plotted against the horizontal, or real, axis, which is calibrated in nepers per second
(Np/s); ωk is plotted against the vertical, or imaginary, axis, which is calibrated in

119
SECTION 3.1
The Transfer
Function
R
+
vi (t)
vo (t)
+
+
+
–
L
C
10 Ω
5 mH
40 μF
(a)
(b)
2
1
–1
–2
Re (kNp/s)
Im (krad/s)
–1
FIGURE 3.3
Circuit of Example 3.1 and its pole-zero plot.
radians per second (rad/s). In these plots a zero is represented as “o” and a pole
as “×”. Just by looking at the pole-zero pattern of a circuit, a designer can predict
important characteristics, such as stability and frequency response. Because these
characteristics will arise frequently as we proceed, we wish to give them a deﬁnitive
review.
EXAMPLE 3.1.
Find the pole-zero plot of the circuit of Fig. 3.3a.
Solution. Using the generalized voltage divider formula, Vo = [R/(sL+1/sC+R)]Vi.
Rearranging,
H(s) = Vo
Vi
=
RCs
LCs2 + RCs + 1 = R
L ×
s
s2 + (R/L)s + 1/LC
Substituting the given component values and factoring out,
H(s) = 2 × 103 ×
s
[s −(−1 + j2)103] × [s −(−1 −j2)103]
This function has H0 = 2 × 103 V/V, a zero at the origin, and a conjugate pole pair at
−1 ± j2 complex kNp/s. Its pole-zero plot is shown in Fig 3.3b.
H(s) and Stability
Acircuitissaidtobestableifitproducesaboundedoutputinresponsetoanybounded
input. One way to assess whether a circuit is stable or not is to inject some energy
into one or more of its reactive elements and then observe how the circuit does on its
own, in the absence of any applied sources. The circuit response is in this case called
the source-free, or natural, response. A convenient method of injecting energy is to
apply an impulsive input, whose Laplace transform is unity. By Eq. (3.2), the ensuing
response, or impulse response, is then h(t) = +−1{H(s)}. Interestingly enough, this
response is determined by the poles. We identify two representative cases:
1. H(s) has a real pole at s = σk ± j0 = σk. Using well-known Laplace-transform
techniques,5 one can prove that H(s) contains the term Ak/(s −σk), where Ak is
called the residue of H(s) at that pole, and is found as Ak = (s −σk)H(s)|s=σk.

120
CHAPTER 3
Active Filters:
Part I
From the Laplace-transform tables we ﬁnd
+−1

Ak
s −σk

= Akeσktu(t)
(3.5)
where u(t) is the unit step function (u = 0 for t < 0, u = 1 for t > 0). A real pole
contributes an exponential component to the response xo(t), and this component
decays if σk < 0, remains constant if σk = 0, and diverges if σk > 0.
2. H(s) has a complex pole pair at s = σk ± jωk. In this case H(s) contains the
complex term Ak/[s −(σk + jωk)] as well as its conjugate, and the residue is
found as Ak = [s −(σk + jωk)]H(s)|s=σk+ jωk. The inverse Laplace transform
of their combination is
+−1

Ak
s −(σk + jωk) +
A∗
k
s −(σk −jωk)

= 2|Ak|eσktu(t) cos (ωkt + Ak)
(3.6)
This component represents a damped sinusoid if σk < 0, a constant-amplitude,
or sustained, sinusoid if σk = 0, and a growing sinusoid if σk > 0.
It is apparent that for a circuit to be stable, all poles must lie in the left half of
the s plane (LHP), where σ < 0. Passive RLC circuits, such as that of Example 3.1,
meet this constraint and are thus stable. However, if a circuit contains dependent
sources such as op amps, its poles may spill into the right half-plane and thus lead to
instability. Its output will grow until the saturation limits of the op amp are reached.
If the circuit has a complex pole pair, the outcome of this is a sustained oscilla-
tion. Instability is generally undesirable, and stabilization techniques are covered
in Chapter 8. There are nevertheless situations in which instability is exploited on
purpose. A common example is the design of sine wave oscillators, to be addressed
in Chapter 10.
EXAMPLE 3.2.
Find the impulse response of the circuit of Example 3.1.
Solution.
We have A1 = [s −(−1 + j2)103]H(s)|s=(−1+ j2)103 = 1000 + j500 =
500
√
5/26.57◦. So, vo(t) = 103√
5e−103tu(t) cos(2 × 103t + 26.57◦) V.
H(s) and the Frequency Response
In the study of ﬁlters we are interested in the response to an ac input of the type
xi(t) = Xim cos(ωt + θi)
where Xim is the amplitude, ω the angular frequency, and θi the phase angle. In
general, the complete response xo(t) of Eq. (3.2) consists of two components,5
namely, a transient component functionally similar to the natural response, and a
steady-state component having the same frequency as the input, but differing in
amplitude and phase. If all poles are in the LHP, the transient component will die
out, leaving only the steady-state component,
xo(t) = Xom cos(ωt + θo)
This is illustrated in Fig. 3.4. Since we are narrowing our scope to this component
alone, we wonder whether we can simplify our math, bypassing the general Laplace

121
SECTION 3.1
The Transfer
Function
ωt
xi(t)
xo(t)
Xim
Xom
θi
θo
ω
FIGURE 3.4
In general, a ﬁlter affects both amplitude and phase.
approach of Eq. (3.2). Such a simpliﬁcation is possible, and it merely requires that we
compute H(s) on the imaginary axis. We do this by letting s →jω (or s →j2π f
when working with the cyclical frequency f, in hertz). Then, the output parameters
are found as
Xom = |H( jω)| × Xim
(3.7a)
θo = H( jω) + θi
(3.7b)
In the course of complex-number manipulations, we shall often use the following
important properties: Let
H = |H|/H = Hr + j Hi
(3.8)
where |H| is the modulus or magnitude of H, H its argument or phase angle, and
Hr and Hi the real and imaginary parts. Then,
|H| =

H2r + H2
i
(3.9a)
H = tan−1(Hi/Hr)
if Hr > 0
(3.9b)
H = 180◦−tan−1(Hi/Hr)
if Hr < 0
(3.9c)
|H1 × H2| = |H1| × |H2|
(3.10a)
(H1 × H2) = H1 + H2
(3.10b)
|H1/H2| = |H1|/|H2|
(3.11a)
(H1/H2) = H1 −H2
(3.11b)

122
CHAPTER 3
Active Filters:
Part I
EXAMPLE 3.3. Find the steady-state response of the circuit of Example 3.1 to the signal
vi(t) = 10 cos(103t + 45◦) V.
Solution.
Letting s →j103 rad/s in Example 3.1 we get H( j103) = j1/(2 + j1) =
(1/
√
5)//63.43◦V/V. So Vom = 10/
√
5 V, θo = 63.43◦+ 45◦= 108.43◦, and vo(t) =
√
20 cos(103t + 108.43◦) V.
There are various viewpoints we can take in regard to H( jω). Presented with
the circuit diagram of a ﬁlter, we may wish to ﬁnd H(s) analytically, and then
plot |H( jω)| and H( jω) versus ω (or f) for a visual display of the frequency
response. These plots, referred to as Bode plots, can be generated by hand or via
PSpice.
Conversely, given H( jω), we may want to let jω →s to obtain H(s), ﬁnd its
roots, and construct the pole-zero plot.
Alternatively, H( jω) may be given to us, either analytically or in graphical form
or in terms of ﬁlter speciﬁcations, and we may be asked to design a circuit realizing
this function. The idealized brick-wall responses of Fig. 3.1 cannot be achieved in
practice but can be approximated via rational functions of s. The degree n of D(s)
determines the order of the ﬁlter (ﬁrst-order, second-order, etc.). As a general rule, the
higher n, the greater the ﬂexibility in the choice of the polynomial coefﬁcients best
suited to a given frequency-response proﬁle. However, circuit complexity increases
with n, indicating a trade-off between how close to ideal we want to be and the price
we are willing to pay.
Yet another viewpoint is one in which a ﬁlter is given to us in black-box form and
we are asked to ﬁnd H( jω) experimentally. By Eq. (3.7), the magnitude and phase
are |H( jω)| = Xom/Xim and H( jω) = θo −θi. To ﬁnd H( jω) experimentally,
we apply an ac input and measure the amplitude and phase of the output relative to the
input at different frequencies. We then plot measured data versus frequency point-
by-point and obtain the experimental proﬁles of |H( jω)| and H( jω). If desired,
measured data can be processed with suitable curve-ﬁtting algorithms to obtain an
analytical expression for H( jω) in terms of its critical frequencies. In the case of
voltage signals, the measurements are easily done with a dual-trace oscilloscope. To
simplify the calculations, it is convenient to set Vim = 1 V and to adjust the trigger
so that θi = 0. Then we have |H( jω)| = Vom and H( jω) = θo.
Bode Plots
The magnitude and frequency range of a ﬁlter can be quite wide. For instance, in
audio ﬁlters the frequency range is typically from 20 Hz to 20 kHz, which rep-
resents a 1000:1 range. In order to visualize small as well as large details with
the same degree of clarity, |H| and H are plotted on logarithmic and semiloga-
rithmic scales, respectively. That is, frequency intervals are expressed in decades
(. . . , 0.01, 0.1, 1, 10, 100, . . .) or in octaves (. . . , 1
8, 1
4, 1
2, 1, 2, 4, 8, . . .), and |H|
is expressed in decibels (dB) as
|H|dB = 20 log10 |H|
(3.12)

123
SECTION 3.2
First-Order Active
Filters
The Bode plots are plots of decibels and degrees versus decades (or octaves). Another
advantage of these plots is that the following useful properties hold:
|H1 × H2|dB = |H1|dB + |H2|dB
(3.13a)
|H1/H2|dB = |H1|dB −|H2|dB
(3.13b)
|1/H|dB = −|H|dB
(3.13c)
To speed up the hand generation of these plots, it is often convenient to effect
asymptotic approximations. To this end, the following properties are useful:
H ∼= Hr
if |Hr| ≫|Hi|
(3.14a)
H ∼= j Hi
if |Hi| ≫|Hr|
(3.14b)
Keep Eqs. (3.13) and (3.14) in mind because we shall use them frequently.
3.2
FIRST-ORDER ACTIVE FILTERS
The simplest active ﬁlters are obtained from the basic op amp conﬁgurations by using
a capacitance as one of its external components. Since ZC = 1/sC = 1/jωC, the
result is a gain with frequency-dependent magnitude and phase. As you study ﬁlters,
it is important that you try justifying your mathematical ﬁndings using physical
insight. In this respect, a most valuable tool is asymptotic veriﬁcation, which is
based on the following properties:
lim
ω →0 ZC = ∞
(3.15a)
lim
ω →∞ZC = 0
(3.15b)
In words, at low frequencies a capacitance tends to behave as an open circuit com-
pared with the surrounding elements, and at high frequencies it tends to behave as a
short circuit.
The Differentiator
In the inverting conﬁguration of Fig. 3.5a we have Vo = (−R/ZC)Vi = −RCsVi.
By a well-known Laplace-transform property, multiplication by s in the frequency
domain is equivalent to differentiation in the time domain. This conﬁrms the desig-
nation differentiator for the circuit. Solving for the ratio Vo/Vi gives
H(s) = −RCs
(3.16)
indicating a zero at the origin.
Letting s →jω and introducing the scaling frequency
ω0 =
1
RC
(3.17)

124
CHAPTER 3
Active Filters:
Part I
+
–
R
C
+
Vi
Vo
20 dB/dec
20
0
0.1
1
10
–20
ω
ω0
(dec)
|H| (dB)
(a)
(b)
ω
FIGURE 3.5
The differentiator and its magnitude Bode plot.
we can express H( jω) in the normalized form
H( jω) = −jω/ω0 = (ω/ω0) /−90◦
(3.18)
Considering that |H|dB = 20 log10(ω/ω0), the plot of |H|dB versus log10(ω/ω0)
is a straight line of the type y = 20x. As shown in Fig. 3.5b, its slope is 20 dB/dec,
indicating that for every decade increase (or decrease) in frequency, magnitude
increases(ordecreases)by20dB.Equation(3.18)indicatesthatthecircuitintroduces
a 90◦phase lag and ampliﬁes in proportion to frequency. Physically, we observe
that at low frequencies, where |ZC| > R, the circuit provides attenuation (negative
decibels); at high frequencies, where |ZC| < R, it provides magniﬁcation (positive
decibels); at ω = ω0, where |ZC| = R, it provides unity gain (0 db). Consequently,
ω0 is called the unity-gain frequency.
Integrators
Also called a Miller integrator because the capacitor is in the feedback path, the
circuit of Fig. 3.6a gives Vo = (−ZC/R)Vi = −(1/RCs)Vi. The fact that division
by s in the frequency domain corresponds to integration in the time domain conﬁrms
the designation integrator. Its transfer function
H(s) = −
1
RCs
(3.19)
+
–
R
C
+
Vi
Vo
20
0
0.1
1
10
–20
ω
ω0
(dec)
|H| (dB)
(a)
(b)
ω
–20 dB/dec
FIGURE 3.6
The integrator and its magnitude Bode plot.

125
SECTION 3.2
First-Order Active
Filters
+
–
R
R
2C
+
Vi
Vo
R
R
FIGURE 3.7
Noninverting, or Deboo, integrator.
has a pole at the origin. Letting s →jω, we can write
H( jω) = −
1
jω/ω0
=
1
ω/ω0
/ + 90◦
(3.20)
where ω0 = 1/RC, as in Eq. (3.17). Observing that the transfer function is the
reciprocal of that of the differentiator, we can apply Eq. (3.13c) and construct the
integratormagnitudeplotsimplybyreﬂectingthatofthedifferentiatoraboutthe0-dB
axis. The result, shown in Fig. 3.6b, is a straight line with a slope of −20 dB/dec and
with ω0 as the unity-gain frequency. Moreover, the circuit introduces a 90◦phase
lead.
Because of the extremely high gain at low frequencies, where |ZC| ≫R, a
practical integrator circuit is seldom used alone as it tends to saturate. As mentioned
in Chapter 1, an integrator is usually placed inside a control loop designed to keep the
op amp within the linear region. We shall see examples when studying state-variable
and biquad ﬁlters in Section 3.7 and sine wave oscillators in Section 10.1.
Because of the negative sign in Eq. (3.19), the Miller integrator is also said to
be an inverting integrator. The circuit of Fig. 3.7, called the Deboo integrator, for
its inventor, uses a Howland current pump with a capacitance as load to achieve
noninverting integration. As we know, the pump forces a current I = Vi/R into the
capacitance, resulting in a noninverting-input voltage Vp = (1/s2C)I = Vi/2sRC.
The op amp then ampliﬁes this voltage to give Vo = (1 + R/R)Vp = Vi/sRC, so
H(s) =
1
RCs
(3.21)
The magnitude plot is the same as for the inverting integrator. However, the phase
angle is now −90◦, rather than +90◦.
It is instructive to investigate the circuit from the more general viewpoint of
Fig. 3.8a, where we identify two blocks: the RC network shown at the bottom and
the rest of the circuit forming a negative resistance converter. The converter provides
a variable resistance −R(R/kR) = −R/k, k ≥0, so the net resistance seen by C
is R ∥(−R/k) = R/(1 −k), indicating the pole
p = −1 −k
RC
(3.22)

126
CHAPTER 3
Active Filters:
Part I
+
–
kR
R
C
+
Vi
Vo
R
R
+
+
+
(b)
(a)
k < 1
k > 1
k = 1
s plane
Re 
Im 
FIGURE 3.8
Varying k varies pole location.
The natural response is then
vO(t) = vO(0)e−t(1−k)/RCu(t)
(3.23)
We identify three important cases: (a) For k < 1, positive resistance prevails, indi-
cating a negative pole and an exponentially decaying response. The decay is due
to dissipation of the energy stored in the capacitance by the net resistance. (b) For
k = 1, the energy supplied by the negative resistance balances the energy dissipated
by the positive resistance, yielding a constant response. The net resistance is now
inﬁnite, and the pole is right at the origin. (c) For k > 1, the negative resistance sup-
plies more energy than the positive resistance can dissipate, causing an exponential
buildup. Negative resistance prevails, the pole is now in the right half plane, and the
response diverges. Figure 3.8b shows the root locus as k is increased.
Low-Pass Filter with Gain
Placing a resistor in parallel with the feedback capacitor, as in Fig. 3.9a, turns the
integrator into a low-pass ﬁlter with gain. Letting 1/Z2 = 1/R2 + 1/(1/sC) =
(R2Cs + 1)/R2 gives H(s) = −Z2/R1, or
H(s) = −R2
R1
1
R2Cs + 1
(3.24)
indicating a real pole at s = −1/R2C. Letting s →jω, we can express H(s) in the
normalized form
H( jω) = H0
1
1 + jω/ω0
(3.25a)
H0 = −R2
R1
ω0 =
1
R2C
(3.25b)
Physically, the circuit works as follows. At sufﬁciently low frequencies, where
|ZC| ≫R2, we can ignore ZC compared with R2 and thus regard the circuit as an
inverting ampliﬁer with gain H ∼= −R2/R1 = H0. For obvious reasons, H0 is called
the dc gain. As shown in Fig. 3.9b, the low-frequency asymptote of the magnitude
Bode plot is a horizontal line positioned at |H0|dB.

127
SECTION 3.2
First-Order Active
Filters
Vo
+
–
R2
R1
C
+
Vi
0
ω (dec)
|H| (dB)
|H0|
ω
ω
ω
0
1
–20 dB/dec
(a)
(b)
FIGURE 3.9
Low-pass ﬁlter with gain.
At sufﬁciently high frequencies, where |ZC| ≪R2, we can ignore R2 compared
with ZC and thus regard the circuit as an integrator. As we know, its high-frequency
asymptote is a line with a slope of −20 dB/dec and passing through the unity-gain
frequency ω1 = 1/R1C. Since the circuit approximates integrator behavior over only
a limited frequency range, it is also called a lossy integrator.
The borderline between ampliﬁer and integrator behavior occurs at the fre-
quency that makes |ZC| = R2, or 1/ωC = R2. Clearly, this is the frequency ω0 of
Eq. (3.25b). For ω/ω0 = 1, Eq. (3.25a) predicts |H| = |H0/(1 + j1)| = |H0|/
√
2,
or, equivalently, |H|dB = |H0|dB −3 dB. Hence, ω0 is called the −3-dB frequency.
The magnitude proﬁle indicates that this is a low-pass ﬁlter with H0 as dc gain
and with ω0 as cutoff frequency. Signals with ω < ω0 are passed with gain close to
H0, but signals with ω > ω0 are progressively attenuated, or cut. For every decade
increase in ω, |H| decreases by 20 dB. Clearly, this is only a crude approximation
to the brick-wall proﬁle of Fig. 3.1b.
EXAMPLE 3.4.
(a) In the circuit of Fig. 3.9a, specify suitable components to achieve
a −3-dB frequency of 1 kHz with a dc gain of 20 dB and an input resistance of at least
10 k. (b) At what frequency does gain drop to 0 dB? What is the phase there?
Solution.
(a) Since 20 dB corresponds to 1020/20 = 10 V/V, we need R2 = 10R1. To ensure
Ri > 10 k, try R1 = 20 k. Then, R2 = 200 k, and C = 1/ω0R2 = 1/(2π ×
103 × 200 × 103) = 0.796 nF. Use C = 1 nF, which is a more readily available
value. Then, scale the resistances as R2 = 200 × 0.796 = 158 k and R1 = 15.8 k,
both 1%.
(b) Imposing |H| = 10/

12 + ( f/103)2 = 1 and solving yields f = 103√
102 −1 =
9.950 kHz. Moreover, H = 180◦−tan−1 9950/103 = 95.7◦.
High-Pass Filter with Gain
Placing a capacitor in series with the input resistor as in Fig. 3.10a turns the differen-
tiator into a high-pass ﬁlter with gain. Letting Z1 = R1 + 1/sC = (R1Cs + 1)/sC
and H(s) = −R2/Z1 gives
H(s) = −R2
R1
R1Cs
R1Cs + 1
(3.26)

128
CHAPTER 3
Active Filters:
Part I
Vo
+
–
R2
R1
C
+
Vi
0
ω (dec)
 (dB)
H0
ω
ω
ω
0
1
20 dB/dec
(a)
(b)
H
FIGURE 3.10
High-pass ﬁlter with gain.
indicating a zero at the origin and a real pole at s = −1/R1C. Letting s →jω, we
can express H(s) in the normalized form
H( jω) = H0
jω/ω0
1 + jω/ω0
(3.27a)
H0 = −R2
R1
ω0 =
1
R1C
(3.27b)
where H0 is called the high-frequency gain and ω0 is again the −3-dB frequency. As
shown in Fig. 3.10b, which you are encouraged to justify asymptotically, the circuit
is a high-pass ﬁlter.
Wideband Band-Pass Filter
The last two circuits can be merged as in Fig. 3.11a to give a band-pass response.
Letting Z1 = (R1C1s + 1)/C1s and Z2 = R2/(R2C2s + 1),weget H(s) =−Z2/Z1,
or
H(s) = −R2
R1
R1C1s
R1C1s + 1
1
R2C2s + 1
(3.28)
Vo
+
–
R2
R1
C2
C1
+
Vi
0
ω (dec)
ω
ω
ω
L
H
(a)
(b)
 (dB)
H0
H
FIGURE 3.11
Wideband band-pass ﬁlter.

129
SECTION 3.2
First-Order Active
Filters
indicating a zero at the origin and two real poles at −1/R1C1 and −1/R2C2. Though
this is a second-order ﬁlter, we have chosen to discuss it here to demonstrate the
use of lower-order building blocks to synthetize higher-order ﬁlters. Letting s →jω
yields
H( jω) = H0
jω/ωL
(1 + jω/ωL)(1 + jω/ωH)
(3.29a)
H0 = −R2
R1
ωL =
1
R1C1
ωH =
1
R2C2
(3.29b)
where H0 is called the midfrequency gain. The ﬁlter is useful with ωL ≪ωH, in
which case ωL and ωH are called the low and high −3-dB frequencies. This circuit
is used especially in audio applications, where it is desired to amplify signals within
the audio range while blocking out subaudio components, such as dc, as well as
noise above the audio range.
EXAMPLE 3.5.
In the circuit of Fig. 3.11a specify suitable component values for a
band-pass response with a gain of 20 dB over the audio range.
Solution. For a gain of 20 dB we need R2/R1 = 10. Try R1 = 10 k and R2 = 100 k.
Then, for ωL = 2π ×20 rad/s we need C1 = 1/(2π ×20×10×103) = 0.7958 μF. Use
1 μF, and rescale the resistances as R1 = 104 × 0.7958 ∼= 7.87 k and R2 = 78.7 k.
For ωH = 2π × 20 krad/s, use C2 = 1/(2π × 20 × 103 × 78.7 × 103) ∼= 100 pF.
Phase Shifters
In Fig. 3.12a the noninverting-input voltage Vp is related to Vi by the low-pass
function as Vp = Vi/(RCs+1). Moreover, Vo = −(R2/R1)Vi +(1+ R2/R1)Vp =
2Vp −Vi. Eliminating Vp yields
H(s) = −RCs + 1
RCs + 1
(3.30)
indicating a zero at s = 1/RC and a pole at s = −1/RC. Letting s →jω yields
H( jω) = 1 −jω/ω0
1 + jω/ω0
= 1
−2 tan−1(ω/ω0)
(3.31)
+
–
+
R1
R
C
0
0.1
1
10
–90°
–180°
R2 (= R1)
Vi
Vo
<) H
ω
ω0  (dec)
(a)
(b)
ω
FIGURE 3.12
Phase shifter.

130
CHAPTER 3
Active Filters:
Part I
With a gain of 1 V/V, this circuit passes all signals without altering their amplitude.
However, as shown in Fig. 3.12b, it introduces a variable phase lag from from
0◦to −180◦, with a value of −90◦at ω = ω0. Can you justify using physical
insight?
Effect of Finite Open-Loop Gain
As mentioned in the chapter highlights, in this chapter we deliberately assume ideal
op amps so we can focus exclusively on ﬁlter functions. Though the impact of op amp
nonidealities will be investigated in Chapters 5 and 6, we wish to take a quick look
at the effect of a noninﬁnite open-loop gain a to avoid leaving the false impression
that op amps do not count. Speciﬁcally, we examine the two most basic ﬁlters, the
integrator and the differentiator (to simplify things further, we assume rd = ∞and
ro = 0).
Viewing the integrator of Fig. 3.6a as a V -I converter with C as its load,
we adapt Eq. (2.7) to say that C sees an equivalent resistance Req = (1 + a)R.
Consequently, the integrator acts as a low-pass ﬁlter of the type of Fig. 3.9a, with
R2 = (1 + a)R1(∼= aR1 for large a). Its unity-gain frequency is still established by
R1 and C; however, Eq. (3.25) indicates also a pole frequency due to aR1 and C,
as well as a dc gain of −aR1/R1 = −a. (Physically, this makes sense because at
sufﬁciently low frequencies C acts as an open circuit, letting the op amp operate in
the open-loop mode).
Turning next to the differentiator of Fig. 3.5a, we adapt Eqs. (2.2) and (2.3)
to say that C sees an I-V converter with an equivalent input resistance Req =
R/(1 + a). Consequently, the differentiator acts as a high-pass ﬁlter of the
type of Fig. 3.10a, with R1 = R2/(1 + a)(∼= R2/a for large a). Its unity-gain
frequency is still established by R2 and C; however, Eq. (3.27) indicates also
a pole frequency due to R2/a and C, as well as a high-frequency gain of −R2/
(R2/a) = −a.
It is apparent that a noninﬁnite gain does have an impact on ﬁlters. This will
be more evident in Chapter 6, where we’ll see that the gain a itself is frequency
dependent and, as such, it increases the complexity of a ﬁlter. But until then, we
shall continue assuming ideal op amps for simplicity.
3.3
AUDIO FILTER APPLICATIONS
Audio signal processing provides a multitude of uses for active ﬁlters. Common
functions required in high-quality audio systems are equalized preampliﬁers, active
tone control, and graphic equalizers.6 Equalized preampliﬁers are used to compen-
sate for the varying levels at which different parts of the audio spectrum are recorded
commercially. Tone control and graphic equalization refer to response adjustments
that the listener can effect to compensate for nonideal loudspeaker response, to match
apparent room acoustics, or simply to suit one’s taste.

131
SECTION 3.3
Audio Filter
Applications
Phono Preampliﬁer
The function of a phono preampliﬁer is to provide ampliﬁcation as well as ampli-
tude equalization for the signal from a moving-magnet or a moving-coil cartridge.
The response must conform to the standard RIAA (Record Industry Association of
America) curve of Fig. 3.13a.
Preampliﬁer gains are usually speciﬁed at 1 kHz. The required amount of gain
is typically 30 to 40 dB for moving-magnet cartridges, and 50 to 60 dB for moving-
coil types. Since the RIAA curve is normalized for unity gain, the actual preamp
response will be shifted upward by an amount equal to its gain.
Figure 3.13b shows one7 of several topologies commonly used to approximate
the RIAA response. The input-shunting network provides impedance matching for
the source, while C1 provides a low-frequency breakpoint (usually below 20 Hz) to
block out dc and any subaudio frequency components. Since |ZC1| ≪R1 over
the frequency range of interest, the transfer function can be found as H ∼= 1 +
Z f /R1, where Z f is the impedance of the feedback network. The result is (see
Problem 3.20)
H( jf ) ∼= 1 + R2 + R3
R1
1 + jf/f1
(1 + jf/f2)(1 + jf/f3)
(3.32)
f1 =
1
2π(R2 ∥R3)(C2 + C3)
f2 =
1
2π R2C2
f3 =
1
2π R3C3
(3.33)
As long as the circuit is conﬁgured for substantially high gain, the unity term in
Eq. (3.32) can be ignored, indicating that H( jf ) approximates the standard RIAA
curve over the audio range.
+
–
R2
R3
C1
R1
C2
C3
+
Vi
Cp
Vo
0
–20
20
Gain (dB)
1 k
100
10 k
f1 = 500 Hz
f2
f1
f3
f2 = 50 Hz
f3 = 2122 Hz
f (Hz)
(a)
(b)
47 kΩ
1
2 LM 833
FIGURE 3.13
RIAA playback equalization curve and phono preampliﬁer.

132
CHAPTER 3
Active Filters:
Part I
EXAMPLE 3.6.
Design a 40-dB gain, RIAA phono ampliﬁer.
Solution.
The RIAA curve must be shifted upward by 40 dB, so the gain below f2
must be 40 + 20 = 60 dB = 103 V/V. Thus, (R2 + R3)/R1 ∼= 103. The expressions for
f1 through f3 provide three equations in four unknowns. Fix one, say, let C2 = 10 nF.
Then, Eq. (3.33) gives R2 = 1/(2π × 50 × 10 × 10−9) = 318 k (use 316 k). We
also have 1/R2 + 1/R3 = 2π f1(C2 + C3) and 1/R3 = 2π f3C3. Eliminating 1/R3 gives
C3 = 2.77 nF (use 2.7 nF). Back substituting gives R3 = 27.7 k (use 28.0 k). Finally,
R1 = (316 + 28)/103 = 344  (use 340 ) and C1 = 1/(2π × 340 × 20) = 23 μF
(use 33 μF). Summarizing, R1 = 340 , R2 = 316 k, R3 = 28.0 k, C1 = 33 μF,
C2 = 10 nF, and C3 = 2.7 nF.
Tape Preampliﬁer
A tape preampliﬁer must provide gain as well as amplitude and phase equalizations
for the signal from a tape head. The response is governed by the standard NAB
(National Association of Broadcasters) curve of Fig. 3.14a. A circuit7 to approx-
imate this response is shown in Fig. 3.14b. As long as |ZC1| ≪R1, we have (see
Problem 3.18)
H( jf ) ∼= 1 + R3
R1
1 + jf/f1
1 + jf/f2
(3.34)
f1 =
1
2π R2C2
f2 =
1
2π(R2 + R3)C2
(3.35)
Active Tone Control
The most common form of tone control is bass and treble control, which allow the
independent adjustment of gain over the lower (bass) and higher (treble) portions
+
–
R2
R3
C1
R1
C2
+
Vi
Vo
0
20
60
40
Gain (dB)
1 k
100
10 k
f1 = 3183 Hz
f1
f2
f3
f2 = 50 Hz
f (Hz)
(a)
(b)
1
2    LM 833
FIGURE 3.14
NAB equalization curve and tape preampliﬁer.

133
SECTION 3.3
Audio Filter
Applications
+
–
R1
R1
C1
C2
R4
R3
R3
R5
+
Vi
Vo
Bass
Treble
1
2 LM 833
(a)
(b)
0
Gain (dB)
fB
fT
AT (max)
AB (max)
AB (min)
AT (min)
f 
R2
FIGURE 3.15
Bass and treble control.
of the audio range. Figure 3.15 shows one of several circuits in common use and
illustrates the effect of tone control on the frequency response.
At the low end of the audio range, or f < fB, the capacitors act as open circuits,
so the only effective feedback consists of R1 and R2. The op amp acts as an inverting
ampliﬁer whose gain magnitude AB is variable over the range
R1
R1 + R2
≤AB ≤R1 + R2
R1
(3.36a)
by means of the bass pot. The upper limit is referred to as maximum boost, the
lower limit as maximum cut. For instance, with R1 = 11 k and R2 = 100 k, these
limits are ±20 dB. Setting the wiper in the middle gives AB = 0 dB, or a ﬂat bass
response.
As frequency is increased, C1 gradually bypasses the effect of R2 until the
latter is eventually shorted out and has no effect on the response. The frequency
fB at which C1 begins to be effective in the case of maximum bass boost or cut is
approximately
fB =
1
2π R2C1
(3.36b)

134
CHAPTER 3
Active Filters:
Part I
Above this frequency the response approaches the ﬂat curve with a slope of about
±6 dB/oct, depending on whether the pot is set for maximum cut or boost.
At the high end of the audio range, or f > fT , the capacitors act as short circuits,
so the gain is now controlled by the treble pot. (The bass pot is ineffectual since it is
being shorted out by C1.) It can be proven that if the condition R4 ≫(R1+R3+2R5)
is met, the range of variability of the treble gain AT is
R3
R1 + R3 + 2R5
≤AT ≤R1 + R3 + 2R5
R3
(3.37a)
and the frequency fT below which the treble control gradually ceases to affect the
response is approximately
fT =
1
2π R3C2
(3.37b)
EXAMPLE 3.7.
Design a bass/treble control with fB = 30 Hz, fT = 10 kHz, and
±20 dB maximum boost/cut at both ends.
Solution.
Since 20 dB corresponds to 10 V/V, we must have (R1 + R2)/R1 = 10 and
(R1 + R3 + 2R5)/R3 = 10. Let R2 be a 100-k pot so that R1 = 11 k. Arbitrarily
impose R5 = R1 = 11 k. Then R3 = 3.67 k (use 3.6 k). To meet the condition
R4 ≫(R1+R3+2R5) ∼= 37 k, let R4 be a 500-k pot. Then C1 = 1/2π R2 fB = 53 nF
(use 51 nF), and C2 = 1/2π R3 fT = 4.4 nF (use 5.1 nF). Summarizing, R1 = 11 k,
R2 = 100 k, R3 = 3.6 k, R4 = 500 k, R5 = 11 k, C1 = 51 nF, and C2 = 5.1 nF.
Graphic Equalizers
The function of a graphic equalizer is to provide boost and cut control not just at the
bass and treble extremes, but also within intermediate frequency bands. Equalizers
are implemented with arrays of narrow-band ﬁlters whose individual responses are
adjusted by vertical slide pots arranged side by side to provide a graphic visualization
of the equalized response (hence the name).
Figure 3.16 shows a familiar realization of one of the equalizer sections. The
circuit is designed so that over a speciﬁed frequency band, C1 acts as an open circuit
while C2 acts as a short, thus allowing for boost or cut control, depending on whether
the wiper position is to the left or to the right, respectively. Outside the band the circuit
+
–
R3
R3
R1
R2
R1
C1
C2
+
Vi
Vo
Gain (dB)
0
f
(a)
(b)
FIGURE 3.16
Section of a graphic equalizer.

135
SECTION 3.4
Standard
Second-Order
Responses
provides unity gain, regardless of the wiper position. This stems from the fact that C2
acts as an open circuit at low frequencies, and C1 acts as a short at high frequencies.
The result is a ﬂat response, but with a peak or a dip over the speciﬁed band.
It can be proven8 that if the component values are chosen so that
R3 ≫R1
R3 = 10R2
C1 = 10C2
(3.38)
then the center of the band is
f0 =
√2 + R2/R1
20π R2C2
(3.39a)
and the gain magnitude A0 at this frequency is variable over the range
3R1
3R1 + R2
≤A0 ≤3R1 + R2
3R1
(3.39b)
An n-band equalizer is implemented by paralleling n sections and summing
the individual outputs with the input in a 1:(n −1) ratio.8 This is done with an
ordinary summing ampliﬁer. Common choices for the resistances of each section
are R1 = 10 k, R2 = 100 k, and R3 = 1 M. The capacitances are calculated
using Eqs. (3.38) and (3.39a). An equalizer having one section for each octave of
the audio spectrum is aptly called an octave equalizer.
3.4
STANDARD SECOND-ORDER RESPONSES
Second-order ﬁlters are important in their own right and are building blocks of
higher-order ﬁlters as well, so we investigate their responses in detail before turning
to actual circuits.
Looking back at the low-pass, high-pass, and all-pass responses of Section 3.2,
we observe that they have the same denominator D( jω) = 1 + jω/ω0 and that
it is the numerator N( jω) that determines the type of response. With N( jω) = 1
we get the low-pass, with N( jω) = jω/ω0 the high-pass, and with N( jω) = 1 −
jω/ω0 = D( jω) the all-pass response. Moreover, the presence of a scaling factor
H0 does not change the response type; it only shifts its magnitude plot up or down,
depending on whether |H0| > 1 or |H0| < 1.
Similar considerations hold for second-order responses. However, since the
degree of the denominator is now 2, we have an additional ﬁlter parameter besides
ω0. All second-order functions can be put in the standard form
H(s) =
N(s)
(s/ω0)2 + 2ζ(s/ω0) + 1
(3.40)
where N(s) is a polynomial in s of degree m ≤2; ω0 is called the undamped natural
frequency, in radians per second; and ζ (zeta) is a dimensionless parameter called
the damping ratio. This function has two poles, p1,2 = (−ζ ±

ζ 2 −1)ω0, whose
location in the s plane is controlled by ζ as follows:
1. For ζ > 1, the poles are real and negative. The natural response consists of two
decaying exponentials and is said to be overdamped.
2. For 0 < ζ < 1, the poles are complex conjugate and can be expressed as
p1,2 = −ζω0 ± jω0

1 −ζ 2
(3.41)

136
CHAPTER 3
Active Filters:
Part I
0 <  < 1
0 <  < 1
ζ
 < 0
ζ
 > 1
ζ
 > 1
ζ
 < 0
ζ
ζ
 = 0
ζ
 = 0
ζ
 = 1
ζ
σ
jω
FIGURE 3.17
Root locus for a second-order transfer function.
These poles lie in the left half plane, and the natural response, now called under-
damped, is the damped sinusoid xo(t) = 2|A|e−ζω0t cos(ω0

1 −ζ 2 t + A),
where A is the residue at the upper pole.
3. For ζ = 0, Eq. (3.41) yields p1,2 = ± jω0, indicating that the poles lie right on
the imaginary axis. The natural response is a sustained, or undamped, sinusoid
with frequency ω0; hence the name for ω0.
4. For ζ < 0, the poles lie in the right half plane, thus causing a diverging response
because the exponent in the term e−ζω0t is now positive. Filters must have ζ > 0
in order to be stable.
The system of trajectories described by the roots as a function of ζ is the root locus
depicted in Fig. 3.17. Note that for ζ = 1 the poles are real and coincident.
Letting s →jω yields the frequency response, which we shall express in terms
of the alternative dimensionless parameter Q as
H( jω) =
N( jω)
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.42)
Q = 1
2ζ
(3.43)
The meaning of Q will become clear as we proceed.
The Low-Pass Response HLP
All second-order low-pass functions can be put in the standard form H( jω) =
H0LPHLP( jω), where H0LP is a suitable constant referred to as the dc gain, and
HLP( jω) =
1
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.44)
A convenient means for visualizing the frequency plot of HLP (or, for that matter, of
any transfer function) is offered by PSpice’s Laplace block of Fig. 3.18. The result

137
SECTION 3.4
Standard
Second-Order
Responses
Vi
IN+
IN−
OUT+
OUT−
+
–
ELAPLACE
LAPLACE {v(I,0)} = {1/(1+(s/6.283)**2+(s/6.283)/Q)}
O
0
0
0
I
Vo
FIGURE 3.18
Using the PSpice’s Laplace block to plot
|HLP( jω/ω0)|dB for different values of Q.
is the magnitude plot of Fig. 3.19a, with respect to which we make the following
considerations:
1. For ω/ω0 ≪1, the second and third denominator terms can be ignored in com-
parison with unity, so HLP →1. The low-frequency asymptote is thus
|HLP|dB = 0
(ω/ω0 ≪1)
(3.45a)
2. For ω/ω0 ≫1, the second denominator term dominates over the other two,
so HLP →−1/(ω/ω0)2. The high-frequency asymptote is |HLP|dB = 20 log10
[1/(ω/ω0)2], or
|HLP|dB = −40 log10(ω/ω0)
(ω/ω0 ≫1)
(3.45b)
Thisequationisofthetype y = −40x,orastraightlinewithaslopeof−40dB/dec.
Compared to the ﬁrst-order response, which has a slope of only −20 dB/dec, the
second-order response is closer to the idealized brick-wall proﬁle.
3. For ω/ω0 = 1, the two asymptotes meet since letting ω/ω0 = 1 in Eq. (3.45b)
gives Eq. (3.45a). Moreover, the ﬁrst and second denominator terms cancel each
other out to give HLP = −j Q, or
|HLP|dB = QdB
(ω/ω0 = 1)
(3.45c)
Inthefrequencyregionnearω/ω0 = 1wenowhaveafamilyofcurves,depending
on the value of Q. Contrast this with the ﬁrst-order case, where only one curve
was possible.
/0
(a)
20 dB
0
−40 dB
−20 dB
0.1
10
1
/0
(b)
20 dB
Q = 10
Q = 2
Q = 10
Q = 2
Q = 4
Q = 1
Q = 0.707
Q = 0.4
Q = 4
0
−40 dB
−20 dB
0.1
10
1
Q = 1
Q = 0.707
Q = 0.4
FIGURE 3.19
Magnitude plots for the standard functions (a) HLP and (b) HHP for different values of Q.

138
CHAPTER 3
Active Filters:
Part I
The second-order response, besides providing a high-frequency asymptotic
slope twice as steep, offers an additional degree of freedom in specifying the magni-
tude proﬁle in the vicinity of ω/ω0 = 1. In actual applications, Q may range from as
low as 0.5 to as high as 100, with values near unity being by far the most common.
Note that for low Qs the transition from one asymptote to the other is very gradual,
while for high Qs there is a range of frequencies in the vicinity of ω/ω0 = 1 where
|HLP| > 1, a phenomenon referred to as peaking.
One can prove that the largest Q before the onset of peaking is Q = 1/
√
2 =
0.707. The corresponding curve is said to be maximally ﬂat and is also referred to as
the Butterworth response. This curve is the closest to the brick-wall model, hence
its widespread use. By Eq. (3.45c), |HLP|dB = (1/
√
2)dB = −3 dB. The meaning
of ω0 for the Butterworth response is the same as for the ﬁrst-order case, that is, ω0
represents the −3-dB frequency, also called the cutoff frequency.
It can be proven5 that in the case of peaked responses, or Q > 1/
√
2, the fre-
quency at which |HLP| is maximized and the corresponding maximum are
ω/ω0 =

1 −1/2Q2
(3.46a)
|HLP|max =
Q

1 −1/4Q2
(3.46b)
For sufﬁciently large Qs, say, Q > 5, we have ω/ω0 ∼= 1 and |HLP|max ∼= Q.
Of course, in the absence of peaking, or Q < 1/
√
2, the maximum is reached at
ω/ω0 = 0, that is, at dc. Peaked responses are useful in the cascade synthesis of
higher-order ﬁlters, to be covered in Chapter 4.
The High-Pass Response HHP
The standard form of all second-order high-pass functions is H( jω) = H0HPHHP
( jω), where H0HP is called the high-frequency gain, and
HHP( jω) =
−(ω/ω0)2
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.47)
(Note that the negative sign in the numerator is part of the deﬁnition.) Letting jω →s
reveals that H(s), besides the pole pair, has a double zero at the origin. To plot
|HHP( jω/ω0)| we use again the Laplace block of Fig. 3.18, but with the quadratic
term in s at the numerator. The result, shown in Fig. 3.19b, is the mirror image
of that of HLP. This symmetry stems from the (readily veriﬁable) fact that the
function HHP( jω/ω0) can be obtained from HLP( jω/ω0) by replacing ( jω/ω0)
with 1/( jω/ω0).
The Band-Pass Response HBP
The standard form of all second-order band-pass functions is H( jω) = H0BPHBP
( jω), where H0BP is the called the resonance gain, and
HBP( jω) =
( jω/ω0)/Q
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.48)

139
SECTION 3.4
Standard
Second-Order
Responses
/0
(a)
0
−40 dB
−20 dB
0.1
10
1

(b)
0
Q = 2
Q = 1
Q = 4
Q = 10
−3 dB
0
L
H
BW
FIGURE 3.20
(a) Magnitude plots of the standard function HBP for different values of Q. (b) Visualizing
the −3-dB bandwidth BW.
(Note that Q in the numerator is part of the deﬁnition.) Besides the pole pair, this
function has a zero at the origin. To plot |HBP( jω/ω0)|, we use again the Laplace
block of Fig. 3.18, but with the term (s/6.283)/Q as the numerator. The result is
shown in Fig. 3.20a, with respect to which we make the following considerations:
1. For ω/ω0 ≪1, we can ignore the second and third denominator terms and
write HBP →( jω/ω0)/Q. The low-frequency asymptote is thus |HBP|dB =
20 log10[(ω/ω0)/Q], or
|HBP|dB = 20 log10(ω/ω0) −QdB
(ω/ω0 ≪1)
(3.49a)
This equation is of the type y = 20x −QdB, indicating a straight line with a slope
of +20 dB/dec, but shifted by −QdB with respect to the 0-dB axis at ω/ω0 = 1.
2. For ω/ω0 ≫1, the second term dominates in the denominator, so HBP →
−j1/(ω/ω0)Q. The high-frequency asymptote is thus
|HBP|dB = −20 log10(ω/ω0) −QdB
(ω/ω0 ≫1)
(3.49b)
This is a straight line with the same amount of downshift as before, but with a
slope of −20 dB/dec.
3. For ω/ω0 = 1, we get HBP = 1, or
|HBP|dB = 0
(ω/ω0 = 1)
(3.49c)
One can prove that |HBP| peaks at ω/ω0 = 1 regardless of Q, this being the reason
why ω0 is called the peak, or resonance, frequency.
Figure 3.20a indicates that all curves peak at 0 dB. Those corresponding to low
Qs are broad, but those corresponding to high Qs are narrow, indicating a higher
degree of selectivity. In the vicinity of ω/ω0 = 1 the high-selectivity curves are
much steeper than ±20 dB/dec, though away from resonance they roll off at the
same ultimate rate of ±20 dB/dec.

140
CHAPTER 3
Active Filters:
Part I
To express selectivity quantitatively, we introduce the bandwidth
BW = ωH −ωL
(3.50)
where ωL and ωH are the −3-dB frequencies, that is, the frequencies at which the
response is 3 dB below its maximum, as depicted in Fig. 3.20b. One can prove5 that
ωL = ω0

1 + 1/4Q2 −1/2Q

(3.51a)
ωH = ω0

1 + 1/4Q2 + 1/2Q

(3.51b)
ω0 = √ωLωH
(3.52)
The resonance frequency ω0 is the geometric mean of ωL and ωH, indicating that on
a logarithmic scale ω0 appears halfway between ωL and ωH. It is apparent that the
narrower the bandwidth, the more selective the ﬁlter. However, selectivity depends
also on ω0, since a ﬁlter with BW = 10 rad/s and ω0 = 1 krad/s is certainly more
selective than one with BW = 10 rad/s but ω0 = 100 rad/s. A proper measure of
selectivity is the ratio ω0/BW. Subtracting Eq. (3.51a) from Eq. (3.51b) and taking
the reciprocal, we get
Q = ω0
BW
(3.53)
that is, Q is the selectivity. We now have a more concrete interpretation for this
parameter.
The Notch Response HN
The most common form for the notch function is H( jω) = H0NHN( jω), where
H0N is an appropriate gain constant, and
HN( jω) =
1 −(ω/ω0)2
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.54)
(In Section 3.7 we shall see that other notch functions are possible, in which ω0 in
the numerator has not necessarily the same value as ω0 in the denominator.) Letting
jω →s reveals that H(s), besides the pole pair, has a zero pair on the imaginary
axis, or z1,2 = ± jω0. We observe that at sufﬁciently low and high frequencies,
HN →1. However, for ω/ω0 = 1 we get HN →0, or |HN|dB →−∞. To plot
|HN( jω/ω0)| we use again the Laplace block of Fig. 3.18, but with 1+(s/6.283)∗∗2
as the numerator. The result, shown in Fig. 3.21a, indicates that the higher the Q
the narrower the notch. For obvious reasons, ω0 is called the notch frequency. In
a practical circuit, because of component nonidealities, an inﬁnitely deep notch is
unrealizable.
It is interesting to note that
HN = HLP + HHP = 1 −HBP
(3.55)
indicating alternative ways of synthesizing the notch response once the other re-
sponses are available.

141
SECTION 3.4
Standard
Second-Order
Responses
/0
(a)
0
−100 dB
−50 dB
0.1
10
1
/0
(b)
0°
Q = 2
Q = 10
Q = 0.5
−360°
−180°
−90°
−270°
0.1
10
1
Q = 5
Q = 0.2
Q = 1
FIGURE 3.21
(a) Magnitude plot of HN and (b) phase plot of HAP, for different values of Q.
The All-Pass Response HAP
Its general form is H( jω) = H0APHAP( jω), where H0AP is the usual gain term,
and
HAP( jω) = 1 −(ω/ω0)2 −( jω/ω0)/Q
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.56)
This function has two poles and two zeros. For Q > 0.5, the zeros and poles are
complex and are symmetrical about the jω axis. Since N( jω) = D( jω), we have
|HAP| = 1, or |HAP|dB = 0 dB, regardless of frequency. The argument is
HAP = −2 tan−1 (ω/ω0)/Q
1 −(ω/ω0)2
for ω/ω0 < 1
(3.57a)
HAP = −360◦−2 tan−1 (ω/ω0)/Q
1 −(ω/ω0)2
for ω/ω0 > 1
(3.57b)
indicating that as ω/ω0 is swept from 0 to ∞, the argument changes from 0◦, through
−180◦, to −360◦. This is shown in Fig. 3.21b. The all-pass function can also be
synthesized as
HAP = HLP −HBP + HHP = 1 −2HBP
(3.58)
Filter Measurements
Because of component tolerances and other nonidealities, the parameters of a prac-
tical ﬁlter are likely to deviate from their design values. We thus need to measure
them and, if necessary, to tune them via suitable potentiometers.
For a low-pass ﬁlter we have HLP( j0) = H0LP and HLP( jω0) = −j H0LPQ.
To measure ω0, we look for the frequency at which the output is shifted by 90◦with
respect to the input, and to measure Q, we take the ratio Q = |HLP( jω0)|/|H0LP|.

142
CHAPTER 3
Active Filters:
Part I
For a band-pass ﬁlter we have HBP( jω0) = H0BP, HBP( jωL) = H0BP−45◦,
and HBP( jωH) = H0BP −135◦. Thus, ω0 is measured as the frequency at
which the output is in phase with the input if H0BP > 0, or 180◦out of phase if
H0BP < 0. To ﬁnd Q, we measure the frequencies ωL and ωH at which the out-
put is shifted by ±45◦with respect to the input. Then, Q = ω0/(ωH −ωL).
The reader can apply similar considerations to measure the parameters of the other
responses.
3.5
KRC FILTERS
Since an R-C stage provides a ﬁrst-order low-pass response, cascading two such
stages as in Fig. 3.22a ought to provide a second-order response, and without using
any inductances. Indeed, at low frequencies the capacitors act as open circuits, thus
letting the input signal pass through with H →1 V/V. At high frequencies the
incoming signal will be shunted to ground ﬁrst by C1 and then by C2, thus providing
a two-step attenuation; hence the designation second-order. Since at high frequencies
a single R-C stage gives H →1/( jω/ω0), the cascade combination of two stages
gives H →[1/( jω/ω1)] × [1/( jω/ω2)] = −1/(ω/ω0)2, ω0 = √ω1ω2, indicating
an asymptotic slope of −40 dB/dec. The ﬁlter of Fig. 3.22a does meet the asymptotic
criteria for a second-order low-pass response; however, it does not offer sufﬁcient
ﬂexibility for controlling the magnitude proﬁle in the vicinity of ω/ω0 = 1. In fact,
one can prove5 that this all-passive ﬁlter yields Q < 0.5.
If we wish to increase Q above 0.5, we must bolster the magnitude response
near ω = ω0. One way to achieve this is by providing a controlled amount of positive
feedback. In Fig. 3.22b the output of the R2–C2 stage is magniﬁed by an ampliﬁer
with gain K, and then is fed back to the interstage node via C1, whose bottom
terminal has been lifted off ground to create the positive feedback path. This feedback
must be effective only in the vicinity of ω = ω0, where bolstering is speciﬁcally
needed. We can use physical insight to verify the band-pass nature of the feedback:
for ω/ω0 ≪1 the impedance of C1 is simply too large to feed back much signal,
whereas for ω/ω0 ≫1, the shunting action by C2 makes Vo too small to do much
good. However, near ω/ω0 = 1 there will be feedback, which we can adjust for the
desired amount of peaking by acting on K. Filters of the type of Fig. 3.22b are aptly
called KRC ﬁlters—or also Sallen-Key ﬁlters, for their inventors.
R1
C1
C2
R2
+
Vi
+
–
Vo
R1
C1
C2
R2
+
Vi
+
–
Vo
K
(a)
(b)
FIGURE 3.22
(a) Passive and (b) active realization of a second-order low-pass ﬁlter.

143
SECTION 3.5
KRC Filters
Low-Pass KRC Filters
In Fig. 3.23 the gain block is implemented with an op amp operating as a noninverting
ampliﬁer, and
K = 1 + RB
RA
(3.59)
Note that Vo is obtained from the output node of the op amp to take advantage of its
low impedance. By inspection,
Vo = K
1
R2C2s + 1V1
Summing currents at node V1,
Vi −V1
R1
+ Vo/K −V1
R2
+ Vo −V1
1/C1s
= 0
Eliminating V1 and collecting, we get
H(s) = Vo
Vi
=
K
R1C1R2C2s2 + [(1 −K)R1C1 + R1C2 + R2C2]s + 1
Letting s →jω yields
H( jω) = K
1
1 −ω2R1C1R2C2 + jω[(1 −K)R1C1 + R1C2 + R2C2]
Next, we put this function in the standard form H( jω) = H0LPHLP( jω), with HLP
( jω) as in Eq. (3.44). To do so, we equate the coefﬁcients pairwise. By inspection,
H0LP = K
(3.60a)
Letting ω2R1C1R2C2 = (ω/ω0)2 gives
ω0 =
1
√R1C1R2C2
(3.60b)
indicating that ω0 is the geometric mean of the individual-stage frequencies ω1=
1/R1C1 and ω2 = 1/R2C2. Finally, letting jω[(1 −K)R1C1 + R1C2 + R2C2] =
+
–
+
Vi
V1
Vo
Vo / K
RB
RA
R2
C1
C2
R1
FIGURE 3.23
Low-pass KRC ﬁlter.

144
CHAPTER 3
Active Filters:
Part I
( jω/ω0)/Q gives
Q =
1
(1 −K)√R1C1/R2C2 + √R1C2/R2C1 + √R2C2/R1C1
(3.60c)
We observe that K and Q depend on component ratios, while ω0 depends on
component products. Because of component tolerances and op amp nonidealities,
the parameters of an actual ﬁlter are likely to depart from their intended values. Our
ﬁlter can be tuned as follows: (a) adjust R1 for the desired ω0 (this adjustment varies
Q also); (b) once ω0 has been tuned, adjust RB for the desired Q (this leaves ω0
unchanged; however, it varies K, but this is of little concern because it does not affect
the frequency behavior).
Since we have ﬁve parameters (K, R1, C1, R2, and C2) but only three equations,
we have the choice of ﬁxing two so we can specify design equations for the remaining
three. Two common designs are the equal-component and the unity-gain designs
(other designs are discussed in the end-of-chapter problems).
Equal-Component KRC Circuit
Imposing R1 = R2 = R and C1 = C2 = C simpliﬁes inventory and reduces Eq. (3.60)
to
H0LP = K
ω0 =
1
RC
Q =
1
3 −K
(3.61)
The design equations are then
RC = 1/ω0
K = 3 −1/Q
RB = (K −1)RA
(3.62)
EXAMPLE 3.8. Using the equal-component design, specify elements for a second-order
low-pass ﬁlter with f0 = 1 kHz and Q = 5. What is its dc gain?
Solution.
Arbitrarily select C = 10 nF, which is an easily available value. Then,
R = 1/(ω0C) = 1/(2π103 × 10 × 10−9) = 15.92 k (use 15.8 k, 1%). More-
over, K = 3 −1/5 = 2.80, and RB/RA = 2.80 −1 = 1.80. Let RA = 10.0 k, 1%;
then, RB = 17.8 k, 1%. The circuit, shown in Fig. 3.24a, has a dc gain of 2.78 V/V.
EXAMPLE 3.9.
Modify the circuit of Example 3.8 for a dc gain of 0 dB.
Solution.
This situation arises often enough to merit a detailed treatment. To reduce
gain from an existing value Aold to a different value Anew, apply Th´evenin’s theorem and
replace R1 with a voltage divider R1A and R1B such that
Anew =
R1B
R1A + R1B
Aold
R1A ∥R1B = R1
where the second constraint ensures that ω0 is unaffected by the replacement. Solving,
we get
R1A = R1
Aold
Anew
R1B =
R1
1 −Anew/Aold
(3.63)
In our case, Aold = 2.8 V/V and Anew = 1 V/V. So, R1A = 15.92 × 2.8/1 = 44.56 k
(use 44.2 k, 1%) and R1B = 15.92/(1 −1/2.8) = 24.76 k (use 24.9 k, 1%). The
circuit is shown in Fig. 3.24b.

145
SECTION 3.5
KRC Filters
+
–
R1
RB
15.8 kΩ
R2
15.8 kΩ
17.8 kΩ
RA
10 kΩ
Vo
+
Vi
C2
10 nF
C1
10 nF
+
–
R1A
RB
44.2 kΩ
R2
15.8 kΩ
17.8 kΩ
RA
10 kΩ
Vo
+
Vi
C2
10 nF
C1
10 nF
R1B
24.9 kΩ
(a)
(b)
FIGURE 3.24
Filter realizations of Examples 3.8 and 3.9.
Unity-Gain KRC Circuit
Imposing K = 1 minimizes the number of components and also maximizes the
bandwidth of the op amp, an issue that will be studied in Chapter 6. To simplify the
math, we relabel the components as R2 = R, C2 = C, R1 = mR, and C1 = nC.
Then, Eq. (3.60) reduces to
H0LP = 1 V/V
ω0 =
1
√mnRC
Q =
√mn
m + 1
(3.64)
You can verify that for a given n, Q is maximized when m = 1, that is, when the
resistances are equal. With m = 1, Eq. (3.64) gives n = 4Q2. In practice, one starts
out with two easily available capacitances in a ratio n ≥4Q2; then m is found as
m = k +

k2 −1, where k = n/2Q2 −1.
EXAMPLE 3.10.
(a) Using the unity-gain option, design a low-pass ﬁlter with f0 =
10 kHz and Q = 2. (b) Use PSpice to visualize its frequency response, both magnitude
and phase.
Solution.
(a) Arbitrarily pick C = 1 nF. Since 4Q2 = 4 × 22 = 16, let n = 20. Then, nC = 20 nF,
k = 20/(2 × 22) −1 = 1.5, m = 1.5 +
√
1.52 −1 = 2.618, R = 1/(√mnω0C) =
1/(√2.618 × 20 × 2π104 × 10−9) = 2.199 k (use 2.21 k, 1%), and mR =
5.758 k (use 5.76 k, 1%). The ﬁlter is shown in Fig. 3.25.
(b) Using the PSpice circuit of Fig. 3.25a, we generate the Bode plots of Fig. 3.25b.
EXAMPLE 3.11.
(a) Design a second-order low-pass Butterworth ﬁlter with a −3-dB
frequency of 10 kHz. (b) If vi(t) = 10 cos (4π104t + 90◦) V, ﬁnd vo(t).

146
CHAPTER 3
Active Filters:
Part I
mR
5.76 kΩ
R
2.21 kΩ
Vo
Vi
C
1 nF
nC
20 nF
+
–
0
0
0
1 GV/V
EOA
+
–
+
–
(b)
(a)
Frequency f (Hz)
10
0
−50
−20
−30
−10
−40
103
Gain (dB)
Phase
104
105
−180°
−150°
−120°
−90°
−60°
−30°
0°
|H|
<) H
FIGURE 3.25
(a) PSpice circuit for the low-pass ﬁlter of Exam-
ple 3.10, and (b) its Bode plots.
Solution.
(a) The Butterworth response, for which Q = 1/
√
2, is implemented with m = 1 and
n = 2. Letting C = 1 nF, we get nC = 2 nF and mR = R = 11.25 k (use 11.3 k,
1%).
(b) Since ω/ω0 = 2, we have H( j4π104) = 1/[1 −22 + j2/(1/
√
2)] = (1/
√
17)
/−136.69◦V/V. So, Vom = 10/
√
17 = 2.426 V, θo = −136.69◦+90◦= −46.69◦,
and vo(t) = 2.426 cos (4π104t −46.69◦) V.
The advantages of the unity-gain design are offset by a quadratic increase of
the capacitance spread n with Q. Moreover, the circuit does not enjoy the tuning
advantages of the equal-component design because the adjustments of ω0 and Q
interfere with each other, as revealed by Eq. (3.64). On the other hand, at high Qs
the equal-component design becomes too sensitive to the tolerances of RB and RA,
when their ratio is very close to 2. A slight mismatch may cause an intolerable
departure of Q from the desired value. Should this ratio reach (or even surpass) 2,
Q will become inﬁnite (or even negative), causing the ﬁlter to oscillate. For these
reasons, KRC ﬁlters are used for Qs below 10. Section 3.7 presents ﬁlter topologies
suited to high Qs.

147
SECTION 3.5
KRC Filters
+
–
RB
RA
Vo
+
Vi
C2
C1
R1
R2
FIGURE 3.26
High-pass KRC ﬁlter.
High-Pass KRC Filters
Interchanging the components of a low-pass R-C stage with each other turns it into
a high-pass C-R stage. Interchanging resistances and capacitances in the low-pass
ﬁlter of Fig. 3.23 leads to the ﬁlter of Fig. 3.26, which you can readily classify as
a high-pass type using physical insight. By similar analysis, we ﬁnd that Vo/Vi =
H0HPHHP, where HHP is given in Eq. (3.47), and
H0HP = K
ω0 =
1
√R1C1R2C2
(3.65a)
Q =
1
(1 −K)√R2C2/R1C1 + √R1C2/R2C1 + √R1C1/R2C2
(3.65b)
As in the low-pass case, two interesting options available to the designer are the
equal-component and the unity-gain designs.
EXERCISE 3.1.
Derive Eq. (3.65).
EXAMPLE 3.12. Design a second-order high-pass ﬁlter with f0 = 200 Hz and Q = 1.5.
Solution.
To minimize the component count, choose the unity-gain option, for which
RA = ∞and RB = 0. Letting C1 = nC2 and R1 = mR2 in Eq. (3.65) gives ω0 =
1/√mnRC and Q = (√n/m)/(n + 1). Let C1 = C2 = 0.1 μF, so that n = 1. Imposing
1.5 = (√1/m)/2 gives m = 1/9, and imposing 2π200 = 1/(√1/9R2 × 107) gives
R2 = 23.87 k and R1 = mR2 = 2.653 k.
Band-Pass KRC Filters
The circuit of Fig. 3.27 consists of an R-C stage followed by a C-R stage to synthe-
size a band-pass block, and a gain block to provide positive feedback via R3. This
feedback is designed to bolster the response near ω/ω0 = 1. The ac analysis of the
ﬁlter yields Vo/Vi = H0BPHBP, where HBP is given in Eq. (3.48), and
H0BP =
K
1 + (1 −K)R1/R3 + (1 + C1/C2)R1/R2
ω0 =
√1 + R1/R3
√R1C1R2C2
(3.66a)

148
CHAPTER 3
Active Filters:
Part I
+
–
RB
RA
Vo
+
Vi
C2
C1
R3
R2
R1
FIGURE 3.27
Band-pass KRC ﬁlter.
Q =
√1 + R1/R3
[1 + (1 −K)R1/R3]√R2C2/R1C1 + √R1C2/R2C1 + √R1C1/R2C2
(3.66b)
We again note that one can vary R1 to tune ω0 and RB to adjust Q.
If Q >
√
2/3, a convenient choice is R1 = R2 = R3 = R and C1 = C2 = C,
in which case the above expressions reduce to
H0BP =
K
4 −K
ω0 =
√
2
RC
Q =
√
2
4 −K
(3.67)
The corresponding design equations are
RC =
√
2/ω0
K = 4 −
√
2/Q
RB = (K −1)RA
(3.68)
EXERCISE 3.2.
Derive Eqs. (3.66) through (3.68).
EXAMPLE 3.13.
(a) Design a second-order band-pass ﬁlter with f0 = 1 kHz and
BW = 100 Hz. What is its resonance gain? (b) Modify the circuit for a resonance gain
of 20 dB.
Solution.
(a) Use the equal-component option with C1 = C2 = 10 nF and R1 = R2 = R3 =
√
2/(2π103 × 10−8) = 22.5 k (use 22.6 k, 1%). We need Q = f0/BW = 10,
so K = 4 −
√
2/10 = 3.858. Pick RA = 10.0 k, 1%. Then, RB = (K −1)RA =
28.58 k (use 28.7 k, 1%). The resonance gain is K/(4 −K) = 27.28 V/V.
(b) Replace R1 with two resistances R1A and R1B, in the manner of Example 3.9, whose
values are found via Eq. (3.63) with Aold = 27.28 V/V and Anew = 1020/20 =
10 V/V. This gives R1A = 61.9 k, 1%, and R1B = 35.7 k, 1%.
Band-Reject KRC Filters
The circuit of Fig. 3.28 consists of a twin-T-network and a gain block to provide pos-
itive feedback via the top capacitance. The T-networks provide alternative forward
paths through which Vi can reach the ampliﬁer’s input: the low-frequency path R-R,
and the high-frequency path C-C, indicating H →K at the frequency extremes.
At intermediate frequencies, however, the two paths provide opposing phase angles,

149
SECTION 3.6
Multiple-
Feedback
Filters
+
–
R
RB
R
RA
2C
Vo
+
Vi
C
C
R
2
FIGURE 3.28
Band-reject KRC ﬁlter.
indicating a tendency of the two forward signals to cancel each other out at the
ampliﬁer’s input. We thus anticipate a notch response. The ac analysis of the circuit
gives Vo/Vi = H0NHN, where HN is given in Eq. (3.54), and
H0N = K
ω0 =
1
RC
Q =
1
4 −2K
(3.69)
EXERCISE 3.3.
Derive Eq. (3.69).
EXAMPLE 3.14. (a) Using standard 1% components, design a notch ﬁlter having f0 =
60 Hz and BW = 5 Hz. (b) Use PSpice to measure the actual notch frequency and depth
of the notch, and comment.
Solution.
(a) Let C = 100 nF and 2C = 200 nF. Then, R = 1/(2π60×10−7) = 26.5258 k (use
26.7 k, 1%), and R/2 = 13.2629 k (use 13.3 k, 1%). Since Q = 60/5 = 12,
we get K = 4 −1/12 = 47/24, or RB/RA = 23/24. Use RA = 10.0 k and
RB = 9.53 k, both 1%.
(b) Using the circuit of Fig. 3.29a we get the magnitude plot of Fig. 3.29b. Cur-
sor measurements give a notch frequency of f0 = 59.665 Hz and a depth of
|HN(min)(jf 0)| = −28.4 dB. The departure from ideality is due primarily to the
usage of 1% component values. Rerunning PSpice with the calculated (as opposed
to 1%) component values, we get f0 = 60.000 Hz and |HN(min)( j f0)| = −75 dB.
3.6
MULTIPLE-FEEDBACK FILTERS
Multiple-feedback ﬁlters utilize more than one feedback path. Unlike their KRC
counterparts, which conﬁgure the op amp for a ﬁnite gain K, multiple-feedback
ﬁlters exploit the full open-loop gain and are also referred to as inﬁnite-gain ﬁlters.
Together with KRC ﬁlters, they are the most popular single-op-amp realizations of
the second-order responses.

150
CHAPTER 3
Active Filters:
Part I
R1
R2
C1
C2
RB
R3
13.3 kΩ
26.7 kΩ
26.7 kΩ
100 nF
100 nF
Vo
Vi
C3
9.53 kΩ
200 nF
+
–
0
0
0
0
1 GV/V
EOA
+
–
+
–
(b)
(a)
Frequency f (Hz)
10
0
−30
−20
−10
Gain (dB)
70
60
50
RA
10.0 kΩ
FIGURE 3.29
(a) PSpice circuit for the notch ﬁlter of Example 3.14,
and (b) its magnitude response.
Band-Pass Filters
In the circuit of Fig. 3.30, also called the Delyiannis-Friend ﬁlter, named after its
inventors, the op amp acts as a differentiator with respect to V1, so we write
Vo = −sR2C2V1
+
–
V1
Vo
+
Vi
C2
C1
R2
R1
FIGURE 3.30
Multiple-feedback band-pass ﬁlter.

151
SECTION 3.6
Multiple-
Feedback
Filters
Summing currents at node V1,
Vi −V1
R1
+ Vo −V1
1/sC1
+ 0 −V1
1/sC2
= 0
Eliminating V1, letting s →jω, and rearranging,
H( jω) = Vo
Vi
=
−jωR2C2
1 −ω2R1R2C1C2 + jωR1(C1 + C2)
To put this function in the standard form H( jω) = H0BPHBP( jω), we impose
ω2R1R2C1C2 = (ω/ω0)2 to get
ω0 =
1
√R1R2C1C2
(3.70a)
and jωR1(C1 + C2) = ( jω/ω0)/Q to get
Q =
√R2/R1
√C1/C2 + √C2/C1
(3.70b)
Finally, we impose −jωR2C2 = H0BP × ( jω/ω0)/Q to get
H0BP =
−R2/R1
1 + C1/C2
(3.70c)
Clearly, this ﬁlter is of the inverting type. It is customary to impose C1 = C2 = C,
after which the above expressions simplify to
ω0 =
1
√R1R2C
Q = 0.5

R2/R1
H0BP = −2Q2
(3.71)
The corresponding design equations are
R1 = 1/2ω0QC
R2 = 2Q/ω0C
(3.72)
Denoting resonance-gain magnitude as H0 = |H0BP| for simplicity, we ob-
serve that it increases quadratically with Q. If we want H0 < 2Q2, we must replace
R1 with a voltage divider in the manner of Example 3.9. The design equations
are then
R1A = Q/H0ω0C
R1B = R1A/(2Q2/H0 −1)
(3.73)
EXAMPLE 3.15. Design a multiple-feedback band-pass ﬁlter with f0 = 1 kHz, Q = 10,
and H0 = 20 dB. Check with PSpice.
Solution.
Let C1 = C2 = 10 nF. Then, R2 = 2 × 10/(2π103 × 10−8) = 318.3 k
(use 316 k, 1%). Since 20 dB implies H0 = 10 V/V, which is less than 2Q2 = 200,
we need an input attenuator. Thus, R1A = 10/(10 × 2π103 × 10−8) = 15.92 k (use
15.8 k, 1%), and R1B = 15.92/(200/10 −1) = 837.7  (use 845 , 1%). Using the
circuit of Fig. 3.31a, we get the magnitude plot of Fig. 3.31b. Cursor measurements give
|H0BP| = 20.0 dB, f0 = 999.7 Hz, and 20 −3 = 17-dB frequencies of 950.6 Hz and
1051.3 Hz, so Q = 999.7/(1051.3 −950.6) = 10.0. (It is interesting to compare the
phase plot with that of Fig. 3.25b. Can you justify the difference?)

152
CHAPTER 3
Active Filters:
Part I
R1A
R1B
15.8 kΩ
845 Ω
316 kΩ
C2
10 nF
Vo
Vi
C1
R2
10 nF
+
–
0
0
0
1 GV/V
EOA
+
–
+
–
(b)
(a)
Frequency f (Hz)
20
0
−40
−20
102
Gain (dB)
Phase
104
105
103
10
−270°
−225°
−180°
−135°
−90°
|H|
<) H
0
FIGURE 3.31
(a) PSpice circuit for the band-pass ﬁlter of
Example 3.15, and (b) its Bode plots.
Low-Pass Filters
The circuit of Fig. 3.32 consists of the low-pass stage R1-C1 followed by the integra-
tor stage made up of R2, C2, and the op amp, so we anticipate a low-pass response.
Moreover, the presence of positive feedback via R3 should allow for Q control. The
+
–
Vo
+
Vi
R2
R3
C2
C1
R1
FIGURE 3.32
Multiple-feedback low-pass ﬁlter.

153
SECTION 3.6
Multiple-
Feedback
Filters
ac analysis of the circuit gives Vo/Vi = H0LPHLP, where
H0LP = −R3
R1
ω0 =
1
√R2R3C1C2
(3.74)
Q =
√C1/C2

R2R3/R2
1 + √R3/R2 + √R2/R3
These expressions indicate that we can vary R3 to adjust ω0, and R1 to adjust Q.
EXERCISE 3.4.
Derive Eq. (3.74).
Apossibledesignprocedure2 istochooseaconvenientvalueforC2 andcalculate
C1 = nC2, where n is the capacitance spread,
n ≥4Q2(1 + H0)
(3.75)
H0 being the desired dc-gain magnitude. The resistances are then found as
R3 = 1 +

1 −4Q2(1 + H0)/n
2ω0QC2
R1 = R3
H0
R2 =
1
ω2
0R3C1C2
(3.76)
AdisadvantageofthisﬁlteristhatthehighertheQand H0,thegreaterthecapacitance
spread.
EXAMPLE 3.16.
Design a multiple-feedback low-pass ﬁlter with H0 = 2 V/V, f0 =
10 kHz, and Q = 4.
Solution.
Substituting the given values yields n ≥192. Let n = 200. Start out with
C2 = 1 nF. Then, C1 = 0.2 μF, R3 = 2.387 k (use 2.37 k, 1%), R1 = 1.194 k
(use 1.18 k, 1%), and R3 = 530.5  (use 536 , 1%).
Notch Filters
The circuit of Fig. 3.33 exploits Eq. (3.55) to synthesize the notch response using the
band-pass response. By inspection, Vo = −(R5/R3)(−H0HBP)Vi −(R5/R4)Vi =
−(R5/R4)[1 −(H0R4/R3)HBP]Vi. It is apparent that imposing H0R4/R3 = 1
leads to a mutual cancellation of the ( jω/ω0)/Q terms in the numerator, giving
Vo/Vi = H0NHN, H0N = −R5/R4.
+
–
+
–
R3
R5
R4
R1A
R1B
R2
–VBP
OA1
OA2
C2
C1
+
Vi
Vo
FIGURE 3.33
Synthesis of HN using HBP.

154
CHAPTER 3
Active Filters:
Part I
EXAMPLE 3.17.
Design a notch ﬁlter with f0 = 1 kHz, Q = 10, and H0N = 0 dB.
Solution. First, implement a band-pass stage with f0 = 1 kHz, Q = 10, and H0 = 1 V/V.
UsingC1 =C2 =10nF,thisrequires R2 = 318.3k, R1A =159.2k,and R1B =799.8.
Then, use R3 = R4 = R5 = 10.00 k.
3.7
STATE-VARIABLE AND BIQUAD FILTERS
The second-order ﬁlters investigated so far use a single op amp with a minimum
or near-minimum number of external components. Simplicity, however, does not
come without a price. Drawbacks such as wide component spreads, awkward tuning
capabilities, and high sensitivity to component variations, particularly to the gain of
the ampliﬁer, generally limit these ﬁlters to Q ≤10.
Component minimization, especially minimization of the number of op amps,
was of concern when these devices were expensive. Nowadays, multiple-op-amp
packages such as duals and quads are cost-competitive with precision passive com-
ponents. The question then arises whether ﬁlter performance and versatility can
be improved by shifting the burden from passive to active devices. The answer is
provided by multiple-op-amp ﬁlters, such as the state-variable and biquad types,
which, though using more components, are generally easier to tune, are less sen-
sitive to passive component variations, and do not require extravagant component
spreads. Since they provide more than one response simultaneously, they are also
referred to as universal ﬁlters.
State-Variable (SV) Filters
The SV ﬁlter—also known as the KHN ﬁlter for inventors W. J. Kerwin, L. P.
Huelsman, and R. W. Newcomb, who ﬁrst reported it in 1967—uses two integra-
tors and a summing ampliﬁer to provide the second-order low-pass, band-pass, and
high-pass responses. A fourth op amp can be used to combine the existing responses
and synthesize the notch or the all-pass responses. The circuit realizes a second-order
differential equation, hence its name.
In the SV version of Fig. 3.34, OA1 forms a linear combination of the in-
put and the outputs of the remaining op amps. Using the superposition principle,
we write
VHP = −R5
R3
Vi −R5
R4
VLP +
	
1 +
R5
R3 ∥R4

R1
R1 + R2
VBP
= −R5
R3
Vi −R5
R4
VLP + 1 + R5/R3 + R5/R4
1 + R2/R1
VBP
(3.77)
Since OA2 and OA3 are integrators, we have
VBP =
−1
R6C1s VHP
VLP =
−1
R7C2s VBP
(3.78)

155
SECTION 3.7
State-Variable and
Biquad Filters
+
–
+
–
+
–
R5
R3
R7
VHP
VBP
VLP
R6
C1
OA1
OA2
OA3
C2
+
Vi
R4
R1
R2
FIGURE 3.34
State-variable ﬁlter (inverting).
or VLP = (1/R6C1R7C2s2)VHP. Substituting VBP and VLP into Eq. (3.77) and col-
lecting, we get
VHP
Vi
= −R5
R3
R4R6C1R7C2
R5
s2
R4R6C1R7C2
R5
s2 + R4R7C2(1 + R5/R3 + R5/R4)
R5(1 + R2/R1)
s + 1
Putting this expression in the standard form VHP/Vi = H0HPHHP allows us to ﬁnd
H0HP = −R5/R3 and
ω0 =
√R5/R4
√R6C1R7C2
Q = (1 + R2/R1)√R5R6C1/R4R7C2
1 + R5/R3 + R5/R4
(3.79)
Using VBP/Vi = (−1/R6C1s)VHP/Vi indicates that VBP/Vi = H0BPHBP and
also allows us to ﬁnd H0BP. We similarly ﬁnd VLP/Vi = (−1/R7C2s)VBP/Vi =
H0LPHLP. The results are
H0HP = −R5
R3
H0BP =
1 + R2/R1
1 + R3/R4 + R3/R5
H0LP = −R4
R3
(3.80)
The above derivations reveal some interesting properties: ﬁrst, the band-pass
response is generated by integrating the high-pass response, and the low-pass is in
turn generated by integrating the band-pass; second, since the product of two transfer
functions corresponds to the addition of their decibel plots, and since the integrator
plot has a constant slope of −20 dB/dec, the band-pass decibel plot is obtained by
rotating the high-pass decibel plot clockwise by 20 dB/dec and the low-pass plot by
a similar rotation of the band-pass plot.
We observe that Q is no longer the result of a cancellation, as in the case of
KRC ﬁlters, but depends on the resistor ratio R2/R1 in a straightforward manner.
We therefore expect Q to be much less sensitive to resistance tolerances and drift.
Indeed, with proper component selection and circuit construction, the SV ﬁlter can
easily yield dependable Qs in the range of hundreds. For best results, use metal-ﬁlm
resistors and polystyrene or polycarbonate capacitors, and properly bypass the op
amp supplies.

156
CHAPTER 3
Active Filters:
Part I
The SV ﬁlter is usually implemented with R5 = R4 = R3, R6 = R7 = R, and
C1 = C2 = C, so the earlier expressions simplify to
ω0 = 1/RC
Q = 1
3(1 + R2/R1)
(3.81a)
H0HP = −1
H0BP = Q
H0LP = −1
(3.81b)
The ﬁlter is tuned as follows: (a) adjust R3 for the desired magnitude of the response
of interest; (b) adjust R6 (or R7) to tune ω0; (c) adjust the ratio R2/R1 to tune Q.
EXAMPLE 3.18.
In the circuit of Fig 3.34 specify component values for a band-pass
response with a bandwidth of 10 Hz centered at 1 kHz. What is the resonance gain?
Solution. Pick the convenient values C1 = C2 = 10 nF. Then, R = 1/(2π103×10−8) =
15.92 k (use 15.8 k, 1%). By deﬁnition, Q = f0/BW = 103/10 = 100. Imposing
(1 + R2/R1)/3 = 100 gives R2/R1 = 299. Pick R1 = 1.00 k, 1%, and R2 = 301 k,
1%. To simplify inventory, let also R3 = R4 = R5 = 15.8 k, 1%. The gain at resonance
is H0BP = 100 V/V.
Equation (3.81b) indicates that at ω = ω0 all three responses exhibit a magnitude
of Q V/V. In high-Q situations this may cause the op amps to saturate, unless the
input signal level is kept suitably low. Low-input levels can be obtained by replacing
R3 with a suitable voltage divider, in the manner of Example 3.9 (see Problem 3.42).
Moving the input signal from the inverting to the noninverting side of OA1 results
in the circuit of Fig. 3.35, which represents another popular form of the SV ﬁlter. It
can be proved (see Problem 3.43) that with the components shown, we now have
ω0 = 1/RC
Q = 1 + R2/2R1
(3.82a)
H0HP = 1/Q
H0BP = −1
H0LP = 1/Q
(3.82b)
indicating that for ω = ω0 all three responses now exhibit 0-dB magnitudes. The
band-pass plot is as in Fig. 3.20a; the low- and high-pass plots are as in Fig. 3.19,
but shifted downward by QdB.
+
–
+
–
+
–
R3
R2
R
VHP
VBP
VLP
R
C
OA1
OA2
OA3
C
+
Vi
R3
R2
R1
FIGURE 3.35
State-variable ﬁlter (noninverting).

157
SECTION 3.7
State-Variable and
Biquad Filters
+
–
+
–
+
–
C1
R2
R3
VBP
VLP
–VLP
R4
R1
C2
OA1
OA2
OA3
R3
+
Vi
R5
FIGURE 3.36
Biquad ﬁlter.
The Biquad Filter
Also known as the Tow-Thomas ﬁlter, for its inventors, the circuit of Fig. 3.36 consists
of two integrators, one of which is of the lossy type. The third op amp is a unity-
gain inverting ampliﬁer whose sole purpose is to provide polarity reversal. If one of
the integrators is allowed to be of the noninverting type, the inverting ampliﬁer is
omitted and only two op amps are required.
To analyze the circuit, we sum currents at the inverting-input node of OA1,
Vi
R1
+ −VLP
R5
+ VBP
R2
+
VBP
1/sC1
= 0
Letting VLP = (−1/R4C2s)VBP and collecting gives VBP/Vi = H0BPHBP and
VLP/Vi = (−1/R4C2s)VBP/Vi = H0LPHLP, with
H0BP = −R2
R1
H0LP = R5
R1
ω0 =
1
√R4R5C1C2
Q =
R2
√C1
√R4R5C2
(3.83)
We observe that unlike the SV ﬁlter, the biquad yields only two signiﬁcant responses.
However, since all its op amps are operated in the inverting mode, the circuit is
immune from common-mode limitations, an issue to be studied in Chapter 5.
The biquad ﬁlter is usually implemented with R4 = R5 = R and C1 = C2 = C,
after which the above expressions simplify as
H0BP = −R2
R1
H0LP = R
R1
ω0 =
1
RC
Q = R2
R
(3.84)
The ﬁlter is tuned as follows: (a) adjust R4 (or R5) to tune ω0; (b) adjust R2 to tune
Q; (c) adjust R1 for the desired value of H0BP or of H0LP.
EXAMPLE 3.19.
Design a biquad ﬁlter with f0 = 8 kHz, BW = 200 Hz, and a 20-dB
resonance gain. What is the value of H0LP?
Solution.
Let C1 = C2 = 1 nF. Then, R4 = R5 = 1/(2π × 8 × 103 × 10−9) =
19.89 k (use 20.0 k, 1%); Q = 8 × 103/200 = 40; R2 = 40 × 19.89 = 795.8 k
(use 787 k, 1%); R1 = R2/1020/20 = 78.7 k, 1%; H0LP = 20.0/78.7 = 0.254 V/V,
or −11.9 dB.

158
CHAPTER 3
Active Filters:
Part I
The Notch Response
With the help of a fourth op amp and a few resistors, both the biquad and the SV
circuits can be conﬁgured for the notch response, which explains why these ﬁlters are
also called universal. With a quad package, the fourth op amp is already available,
so it only takes a few resistors to synthesize a notch.
The ﬁlter of Fig. 3.37 uses the biquad circuit to generate the notch response as
VN = −[(R5/R2)(Vi −VBP) ± (R5/R4)VLP], where the ± sign depends on the
switch position, as indicated. It can be shown (see Exercise 3.5) that
VN
Vi
= −R5ω2z
R2ω2
0
×
1 −(ω/ωz)2
1 −(ω/ω0)2 + ( jω/ω0)/Q
(3.85a)
ω0 =
1
RC
Q = R1
R
ωz = ω0

1 ± R2/R4Q
(3.85b)
This response presents a notch at ω = ωz. We identify three cases:
1. R4 is absent, or R4 = ∞. By Eq. (3.85), we have
ωz = ω0
H0N = −R5
R2
(3.86)
This is the familiar symmetric notch shown in Fig. 3.38b for the case |H0N| =
0dB.Itisobtainedbysubtracting VBP from Vi,inthemannerdepictedinFig.3.33.
2. The switch is in the left position, so also a low-pass term is now being added
to the existing combination of Vi and −VBP. The result is a low-pass notch. By
+
–
+
+
–
–
+
–
C
R1
R1
R3
R4
R5
–HBPVi
HLPVi
–HLPVi
R
C
OA1
OA2
OA3
R3
+
Vi
VN
+
–
OA4
R
R2
R2
FIGURE 3.37
Synthesizing notch responses.

159
SECTION 3.7
State-Variable and
Biquad Filters
|HN| (dB)
0
ω
|HN| (dB)
0
ω
ω
|HN| (dB)
0
ω
z          
ω0
ωz ω0
ωz
ω0
=
(a)
(b)
(c)
FIGURE 3.38
Notch responses: (a) low-pass notch, (b) symmetric notch, and (c) high-pass notch.
Eq. (3.85), we now have
ωz = ω0

1 + R2/R4Q
H0LP = −R5ω2z
R2ω2
0
(3.87)
indicating ωz > ω0. The scaling term is called the dc gain H0LP. The low-pass
notch is shown in Fig. 3.38a for the case |H0LP| = 0 dB. By Eq. (3.85a), the
high-frequency gain is H0HP = H0LP(1/ω2z)/(1/ω2
0) = −R5/R2.
3. The switch is in the right position, so the low-pass term is now being subtracted.
The result is a high-pass notch with
ωz = ω0

1 −R2/R4Q
H0HP = −R5
R2
(3.88)
We now have ωz < ω0, and the scaling factor is called the high-frequency gain
H0HP. This notch is shown in Fig. 3.38c for the case |H0HP| = 0 dB. The dc gain
is H0LP = −R5ω2z/R2ω2
0.
EXERCISE 3.5.
Derive Eq. (3.85).
In Chapter 4 we shall use low- and high-pass notches to synthesize a class of
higher-order ﬁlters known as elliptic ﬁlters. The above expressions can be turned
around to yield the design equations:
R =
1
ω0C
R1 = QR
R4 = R2
Q
ω2
0
|ω2
0 −ω2z|
(3.89a)
R5 = R2
	ω0
ωz

2
for ωz > ω0
R5 = R2
for ωz < ω0
(3.89b)
where R2 and R3 are arbitrary and R5 has been speciﬁed for H0LP and H0HP of
0 dB. These gains can be raised or lowered by changing R5 in proportion.
EXAMPLE 3.20.
Specify the components of Fig. 3.37 for a low-pass notch with f0 =
1 kHz, fz = 2 kHz, Q = 10, and 0-dB dc gain. Verify with PSpice.
Solution.
Let C = 10 nF; then R = 1/ω0C = 15.9 k (use 15.8 k); R1 = QR =
158 k; let R2 = 100 k; then R4 = (100/10) × 12/|12 −22| = 3.333 k (use
3.32 k, 1%); R5 = 100×(1/2)2 = 25 k (use 24.9 k, 1%). Using the PSpice circuit
of Fig. 3.39 (top) we get the magnitude plot of Fig. 3.39 (bottom). Cursor measurements
give fz = 2.0177 kHz and a notch depth of −105 dB.

160
CHAPTER 3
Active Filters:
Part I
R3B
Vo
C2
Frequency f (Hz)
20
0
−40
−20
103
Gain (dB)
104
102
100 kΩ
0
1 GV/V
EOA3
+
–
+
–
0
R5
24.9 kΩ
0
1 GV/V
EOA4
+
–
+
–
0
10 nF
0
1 GV/V
EOA2
+
–
+
–
0
C1
10 nF
0
1 GV/V
EOA1
+
–
+
–
0
R3A
100 kΩ
RB
15.8 kΩ
R1A
R2A
100 kΩ
158 kΩ
R2B
100 kΩ
R1B
158 kΩ
RA
15.8 kΩ
Vi
+
–
0
R4
3.32 kΩ
FIGURE 3.39
PSpice circuit for the low-pass notch ﬁlter of Example 3.20, and its frequency response.
3.8
SENSITIVITY
Because of component tolerances and op amp nonidealities, the response of a prac-
tical ﬁlter is likely to deviate from that predicted by theory. Even if some of the
components are made adjustable to allow for ﬁne tuning, deviations will still arise
because of component aging and thermal drift. It is therefore of interest to know
how sensitive a given ﬁlter is to component variations. For instance, the designer of
a second-order band-pass ﬁlter may want to know the extent to which a 1% variation
in a given resistance or capacitance affects ω0 and BW.
Given a ﬁlter parameter y such as ω0 and Q, and given a ﬁlter component x
such as a resistance R or a capacitance C, the classical sensitivity function Sy
x is
deﬁned as
Sy
x = ∂y/y
∂x/x = x
y
∂y
∂x
(3.90)

161
SECTION 3.8
Sensitivity
where we use partial derivatives to account for the fact that ﬁlter parameters usually
depend on more than just one component. For small changes, we can approximate
	y
y
∼= Sy
x
	x
x
(3.91)
This allows us to estimate the fractional parameter change 	y/y caused by the frac-
tional component change 	x/x. Multiplying both sides by 100 gives a relationship
between percentage changes. The sensitivity function satisﬁes the following useful
properties:
Sy
1/x = S1/y
x
= −Sy
x
(3.92a)
Sy1y2
x
= Sy1
x + Sy2
x
(3.92b)
Sy1/y2
x
= Sy1
x −Sy2
x
(3.92c)
Sxn
x = n
(3.92d)
Sy
x1 = Sy
x2Sx2
x1
(3.92e)
(See Problem 3.49 for the derivations.) To gain an understanding of sensitivity, we
examine some popular ﬁlter conﬁgurations.
KRC Filter Sensitivities
With reference to the low-pass KRC ﬁlter of Fig. 3.23, we have, by Eq. (3.60b),
ω0 = R−1/2
1
C−1/2
1
R−1/2
2
C−1/2
2
. Consequently, Eq. (3.92d) gives
Sω0
R1 = Sω0
C1 = Sω0
R2 = Sω0
C2 = −1
2
(3.93)
Applying Eqs. (3.90) and (3.92) to the expression for Q given in Eq. (3.60c), we
obtain
SQ
R1 = −SQ
R2 = Q

R2C2/R1C1 −1
2
(3.94a)
SQ
C1 = −SQ
C2 = Q(

R2C2/R1C1) +

R1C2/R2C1) −1
2
(3.94b)
SQ
K = QK

R1C1/R2C2
(3.94c)
SQ
RA = −SQ
RB = Q(1 −K)

R1C1/R2C2
(3.94d)
For the equal-component design, the Q sensitivities simplify to
SQ
R1 = −SQ
R2 = Q −1
2
SQ
C1 = −SQ
C2 = 2Q −1
2
(3.95a)
SQ
K = 3Q −1
SQ
RA = −SQ
RB = 1 −2Q
(3.95b)
and for the unity-gain design, they simplify to
SQ
R1 = −SQ
R2 =
1 −R1/R2
2(1 + R1/R2)
SQ
C1 = −SQ
C2 = 1
2
(3.96)

162
CHAPTER 3
Active Filters:
Part I
Since the Q sensitivities of the equal-component design increase with Q, they
may become unacceptable at high Qs. As we already know, SQ
K is of particular
concern at high Qs because a slight mismatch in the RB/RA ratio may drive Q to
inﬁnity or even make it negative, thus leading to oscillatory behavior. By contrast, the
unity-gain design offers much lower sensitivities. It is apparent that the designer must
carefully weigh a number of conﬂicting factors before choosing a particular ﬁlter
design for the given application. These include circuit simplicity, cost, component
spread, tunability, and sensitivity.
EXAMPLE 3.21.
Investigate the effect of a 1% variation of each component in the
low-pass ﬁlter of (a) Example 3.8 and (b) Example 3.10.
Solution.
By Eq. (3.93), a 1% increase (decrease) in any of R1, C1, R2, and C2 causes
a 0.5% decrease (increase) in ω0 in either circuit.
(a) By Eq. (3.95), a 1% increase (decrease) in R1 increases (decreases) Q by approxi-
mately 5 −0.5 = 4.5% (the opposite holds for R2). Similarly, 1% capacitance vari-
ations result in Q variations of about 9.5%. Finally, since 1 −2Q = 1 −2 × 5 =−9,
it follows that 1% variations in RA or in RB result in Q variations of about 9%.
(b) With R1/R2 = 5.76/2.21, Eq. (3.96) gives SQ
R1 =−SQ
R2 ∼=−0.22. Thus, 1% resis-
tance and 1% capacitance variations result in Q variations of 0.22% and 0.5%,
respectively.
Multiple-Feedback Filter Sensitivities
The sensitivities of the multiple-feedback band-pass ﬁlter of Fig. 3.30 are found
from Eq. (3.70), and they are
Sω0
R1 = Sω0
C1 = Sω0
R2 = Sω0
C2 = −1
2
(3.97a)
SQ
R1 = −SQ
R2 = −1
2
SQ
C1 = −SQ
C2 = 1
2
C2 −C1
C2 + C1
(3.97b)
Note that the equal-capacitance design results in SQ
C1 = SQ
C2 = 0. The sensitivities
of the multiple-feedback low-pass ﬁlter of Fig. 3.32 can be computed likewise, and
they are found to be2
Sω0
R2 = Sω0
C1 = Sω0
R3 = Sω0
C2 = −1
2
(3.98a)
SQ
R1
 < 1
SQ
R2
 < 1
2
SQ
R3
 < 1
2
SQ
C1 = −SQ
C2 = 1
2
(3.98b)
It is apparent that multiple-feedback conﬁgurations enjoy low sensitivities and are
therefore popular.
Multiple-Op-Amp Filter Sensitivities
The sensitivities of the biquad ﬁlter of Fig. 3.36 are found from Eq. (3.83), and the
results are
Sω0
R4 = Sω0
R5 = Sω0
C1 = Sω0
C2 = −1
2
(3.99a)
SQ
R2 = 1
SQ
R4 = SQ
R5 = −SQ
C1 = SQ
C2 = 1
2
(3.99b)

163
Problems
These sensitivities are fairly low and are similar to those of a passive RLC ﬁlter
yielding the same responses. The sensitivities of state-variable ﬁlters are similarly
low (see Problem 3.52). Considering also the advantages of tuning, low parameter
spread, and multiple simultaneous responses, we now appreciate why these ﬁlters
are widely used.
PROBLEMS
3.1 The transfer function
3.1 Use PSpice to plot the impulse response of Example 3.2, compare with the calculated
response, and comment. Hint: You can approximate an impulse by means of a pulse
having much shorter width than the lowest time constant of the circuit and sufﬁcient
amplitude to ensure unity area. Presently, a 1-μs, 1 MV pulse will do. Also, make sure
to impose zero initial conditions for L and C.
3.2 A transfer function with H0 = 1 has a zero at s = +1 kNp/s and a pole pair at −1 ± j1
complex kNp/s. (a) Find its impulse response. (b) Find its steady-state response to an
ac input with unity amplitude, zero phase, and ω = 1 krad/s.
3.3 Suppose we lower R to 4  in the circuit of Fig. 3.3a, and we take the output vo(t)
across C (positive at left). (a) Use PSpice with zero initial conditions for L and C
to display the response vo(t) to a 1-V input step. How long does it take for the re-
sponse to settle reasonably close to its ﬁnal dc steady-state value? (b) Now display
the response to a 10-V, 2-kHz sinusoidal input. How long does it take for the re-
sponse to settle reasonably close to its ﬁnal ac steady-state? Compare with (a), and
comment.
3.2 First-order active ﬁlters
3.4 The circuit of Fig. P3.4 is a noninverting differentiator. (a) Derive its transfer function.
(b) Specify component values for a unity-gain frequency of 100 Hz.
+
–
R1
C
C
R1
R
+
Vi
Vo
FIGURE P3.4
3.5 If R1C1 = R2C2, the circuit of Fig. P3.5 is a noninverting integrator. (a) Find its transfer
function. (b) Specify component values for a gain of 20 dB at 100 Hz.

164
CHAPTER 3
Active Filters:
Part I
+
–
R1
R2
C1
C2
+
Vi
Vo
FIGURE P3.5
3.6 (a) Specify suitable component values for a unity-gain frequency of 1 kHz in the Deboo
integrator of Fig. 3.7. (b) What happens if the upper-right resistance is 1% less than its
nominal value? Illustrate via the magnitude plot. Hint: Replace the Howland current
pump with its Norton equivalent.
3.7 Suppose the time constants in the circuit of Fig. P3.5 are mismatched, say, R1C1 = R2C2
(1 −ϵ). (a) Investigate the effect of the mismatch and illustrate via the magnitude
plot. (b) Devise a method for balancing out the mismatch, and outline the calibration
procedure.
3.8 Inserting a resistance R3 in series with C in the low-pass ﬁlter of Fig. 3.9a turns it into
a circuit known as a pole-zero circuit, which ﬁnds application in control. (a) Sketch the
modiﬁed circuit, and ﬁnd its transfer function to justify its name. (b) Specify component
values for a pole frequency of 1 kHz, a zero frequency of 10 kHz, and a dc gain of 0
dB; sketch its magnitude plot.
3.9 Inserting a resistance R3 in parallel with C in the high-pass ﬁlter of Fig 3.10a turns
it into a circuit known as a zero-pole circuit, which ﬁnds application in control.
(a) Sketch the modiﬁed circuit, and ﬁnd its transfer function to justify its name.
(b) Specify component values for a zero frequency of 100 Hz, a pole frequency of
1 kHz, and a high-frequency gain of 0 dB; sketch its magnitude plot.
3.10 Redraw the phase shifter of Fig 3.12a, but with R and C interchanged with each other;
derive its transfer function and sketch its Bode plots. What is the main difference
between the responses of the original and the modiﬁed circuit? Name a possible disad-
vantage of the modiﬁed circuit.
3.11 (a) Sketch the Bode plots of the circuit of Fig 3.12a if R2 = 10R1. (b) Repeat, but with
R1 = 10R2.
3.12 Using two phase shifters with 0.1-μF capacitors, design a circuit that accepts a voltage
va = 1.20
√
2 cos(2π60t)V,andgeneratesthevoltagesvb = 1.20
√
2 cos(2π60t–120◦)V
and vc = 1.20
√
2 cos(2π60t + 120◦) V. Such a circuit simulates the voltages used in
three-phase power transmission systems, scaled to 1/100 of their actual values.
3.13 In the noninverting ampliﬁer of Fig. 1.7 let R1 = 2 k and R2 = 18 k. Sketch and
label the magnitude Bode plot of its gain if the circuit also contains a 10-nF capacitance
in parallel with R2.
3.14 Suppose the inverting ampliﬁer of Fig. 1.11 also has a capacitance C1 in parallel with R1
and a capacitance C2 in parallel with R2. Derive its transfer function, sketch and label

165
Problems
the magnitude Bode plot, and specify suitable component values for a low-frequency
gain of 40 dB, a high-frequency gain of 0 dB, and so that the geometric mean of its
pole and zero frequencies ( f p fz)1/2 is 1 kHz.
3.15 Sketch and label the linearized magnitude Bode plot for the circuit of Fig. P3.5 if:
(a) R2C2 = 1 ms and R1C1 = 0.1 ms. (b) Repeat, but with R1C1 = 10 ms.
3.16 In the wideband band-pass ﬁlter of Fig. 3.11a let R1 = R2 = R and C1 = C2 = C.
(a) Find the output vo(t) if the input is vi(t) = 1 cos(t/RC) V. (b) Repeat, but for
vi(t) = 1 cos(t/2RC) V. (c) Repeat, but for vi(t) = 1 cos(t/0.5RC) V.
3.17 The circuit of Fig. P3.17 is a capacitance multiplier. (a) Show that Ceq = (1+R2/R1)C.
(b) Using a 0.1-μF capacitance, specify component values to simulate a variable ca-
pacitance from 0.1 μF to 100 μF by means of a 1-M pot. Hint: In part (a), apply a
test voltage V, ﬁnd the resulting current I, and obtain Ceq as 1/sCeq = V/I.
+
–
+
–
R1
C
Ceq
OA1
OA2
R2
FIGURE P3.17
3.18 ThecircuitofFig.P3.18isacapacitancesimulator.(a)ShowthatCeq = (R2R3/R1R4)C.
(b) Using a 1-nF capacitance, specify component values to simulate a 1-mF capaci-
tance. List a possible application of such a large capacitance. Hint: See Problem 3.17.
+
–
+
–
R2
C
Ceq
OA1
OA2
R4
R3
R1
FIGURE P3.18
3.19 In the Deboo integrator of Fig. 3.7 let R = 16 k and 2C = 2 nF. Find the transfer
function if the op amp has a = 103 V/V, rd = ∞, and ro = 0, and verify with PSpice.
Compare with the ideal op amp case, and comment.
3.3 Audio ﬁlter applications
3.20 Derive Eqs. (3.32) and (3.33).
3.21 (a) Derive Eqs. (3.34) and (3.35). (b) Specify component values to approximate the
NAB curve with a 30-dB gain at 1 kHz. Show the ﬁnal circuit.

166
CHAPTER 3
Active Filters:
Part I
3.22 Using standard component values, design an octave equalizer with center frequencies
at approximately f0 = 32 Hz, 64 Hz, 125 Hz, 250 Hz, 500 Hz, 1 kHz, 2 kHz, 4 kHz,
8 kHz, and 16 kHz. Show the ﬁnal circuit.
3.4 Standard second-order responses
3.23 (a) By proper manipulation, put the wideband band-pass function of Eq. (3.29a) in the
standard form H( jω) = H0BPHBP. (b) Show that no matter how you select ωL and ωH,
the Q of that ﬁlter can never exceed 1
2. This is why the ﬁlter is called wideband.
3.24 Construct the phase plots of HLP, HHP, HBP, and HN for Q = 0.2, 1, and 10.
3.25 (a) Use PSpice to plot the transfer function |Vo/Vi| for the circuit of Fig. 3.3a, and
justify using physical insight. (b) Repeat, but for the case in which the output is taken
across C. (c) Repeat, but for the case in which the output is taken across L. (d) Repeat,
but for the case in which the output is taken across the L-C combination.
3.26 Suppose vi(t) in the circuit of Fig. 3.3a consists of three ac components, vi(t) =
1 sin(0.1ω0t) + 1 sin(ω0t) + 1 sin(10ω0t) V, where ω0 = 1/
√
LC . (a) Use PSpice to
plot both vi(t) and vo(t), compare, and comment. (b) Repeat, but for the case in which
vo(t) is taken across C. (c) Repeat, but for the case in which vo(t) is taken across L.
(d) Repeat, but for the case in which vo(t) is taken across the L-C combination.
3.5 KRC ﬁlters
3.27 An alternative design procedure for the low-pass KRC ﬁlter of Fig. 3.23 is RA = RB
and R2/R1 = C1/C2 = Q. (a) Develop design equations for this option. (b) Hence,
use it to redesign the ﬁlter of Example 3.8.
3.28 An alternative design procedure for the low-pass KRC ﬁlter of Fig. 3.23 that allows us to
specify also H0LP, H0LP > 2 V/V, is C1 = C2 = C. (a) Show that the design equations
for this option are R2 = [1 +

1 + 4Q2(H0LP −2)]/2ω0QC and R1 = 1/ω2
0 R2C2.
(b) Use this option to redesign the ﬁlter of Example 3.8, but with H0LP = 10 V/V.
3.29 (a) Design a high-pass KRC ﬁlter with f0 = 100 Hz and Q variable from 0.5 to 5
by means of a 100-k potentiometer. (b) If the input is a 60-Hz, 5-V (rms) ac wave
with a dc component of 3 V, what comes out of the ﬁlter with the wiper at either
extreme?
3.30 An alternative design procedure for the high-pass KRC ﬁlter of Fig. 3.26 that allows us
to specify also H0HP, H0HP > 1, is C1 = C2 = C. (a) Show that the design equations are
then R1 = [1 +

1 + 8Q2(H0HP −1)]/4ω0QC and R2 = 1/ω2
0 R1C2. (b) Use this op-
tiontoimplementahigh-passButterworthresponsewith H0HP =10V/Vand f0 =1kHz.
3.31 An alternative design procedure for the band-pass KRC ﬁlter of Fig. 3.27 is RA = RB
and C1 = C2 = C. Develop design equations for this option. Hence, use it to design a
band-pass ﬁlter with H0BP = 0 dB, f0 = 1 kHz, and Q = 5.
3.32 The low-pass ﬁlter of Fig. P3.32 is referred to as a −KRC ﬁlter (“minus” KRC ﬁlter)
because the op amp is operated as an inverting ampliﬁer with a gain of −K. (a) Find
H0LP, ω0, and Q for the case C1 = C2 = C and R1 = R2 = R3 = R4 = R. (b) Design
a −KRC low-pass ﬁlter with f0 = 2 kHz, Q = 5, and 0-dB dc gain.

167
Problems
+
–
KR4
R4
R3
R2
R1
C1
C2
+
Vi
Vo
FIGURE P3.32
3.33 The band-pass ﬁlter of Fig. P3.33 is referred to as a −KRC ﬁlter (“minus” KRC ﬁlter)
because the op amp is operated as an inverting ampliﬁer with a gain of −K. (a) Find
H0BP, ω0, and Q for the case C1 = C2 = C and R1 = R2 = R. (b) Design a −KRC
band-pass ﬁlter with f0 = 1 kHz, Q = 10, and unity-resonance gain.
+
–
KR2
R2
R1
C2
C1
+
Vi
Vo
FIGURE P3.33
3.34 The notch ﬁlter of Fig. P3.34 allows Q tuning via the ratio R2/R1. (a) Show that
Vo/Vi = HN with ω0 = 1/RC and Q = (1+ R1/R2)/4. (b) Specify component values
for f0 = 60 Hz and Q = 25.
+
–
+
–
R
R
R
2C
C
C
R1
R2
OA2
OA1
+
Vi
Vo
1
2
FIGURE P3.34
3.6 Multiple-feedback ﬁlters
3.35 An alternative design procedure for the multiple-feedback low-pass ﬁlter of Fig. 3.32 is
R1 = R2 = R3 = R. Find expressions for H0LP, ω0, and Q. Hence, develop the design
equations.

168
CHAPTER 3
Active Filters:
Part I
3.36 In the circuit of Fig. 3.33 let R3 = R4 = R, and R5 = K R. (a) Show that if H0BP =
−2 V/V, the circuit gives the all-pass response with gain −K. (b) Specify component
values for f0 = 1 kHz, Q = 5, and a gain of 20 dB.
3.37 Show that the circuit of Fig. P3.37 realizes the all-pass function with H0AP = 1/3,
ω0 =
√
2/RC, and Q = 1/
√
2.
+
–
Vo
+
Vi
C
C
R
1.5R
0.5R
3R
FIGURE P3.37
3.38 The circuit of Fig P3.38, known as a Q multiplier, uses a summing ampliﬁer OA1
and a band-pass stage OA2 to increase the Q of the band-pass stage without changing
ω0. This allows for high Qs without unduly taxing OA2. (a) Show that the gain and Q
of the composite circuit are related to those of the basic band-pass stage as Qcomp =
Q/[1−(R5/R4)|H0BP|], and H0BP(comp) = (R5/R3)(Qcomp/Q)H0BP. (b) Specify com-
ponent values for f0 = 3600 Hz, Qcomp = 60, and H0BP(comp) = 2 V/V, starting
with Q = 10.
+
–
Vo
C
C
+
–
+
OA1
OA2
R4
R3
R5
R1A
R1B
R2
Vi
FIGURE P3.38
3.39 With reference to the multiple-feedback low-pass ﬁlter of Fig. 3.32, show that the circuit
consisting of R2, R3, C2, and the op amp acts as a resistance Req = R2 ∥R3 and an
inductance Leq = R2R3C2, both in parallel with C1. Hence, explain circuit operation
in terms of the above equivalence.
3.40 Let the circuit of Fig. 3.30 have C1 = C2 = 10 nF, R1 = 10 k, and R2 = 160 k.
Find V1/Vi, and calculate H0, ω0, and Q.
3.41 The multiple-feedback circuit of Fig. P3.41 uses positive feedback to control the Q
without upsetting f0 (see EDN, May 11, 1989, p. 200). Show that Q = 1/(2−R1/R2).
What are the expressions for f0 and H0BP? Under what condition is Q →∞? Q < 0?
What are the s-plane locations of the poles?

169
Problems
+
–
Vo
Vi
C
C
R
R2
R1
R
+
–
FIGURE P3.41
3.7 State-variable and biquad ﬁlters
3.42 Suitably modify the ﬁlter of Example 3.18 so that H0BP = 1 V/V. Show your ﬁnal
design.
3.43 (a) Derive Eqs. (3.82a) and (3.82b). (b) Specify suitable component values to achieve
a band-pass response with fL = 594 Hz and fH = 606 Hz. (c) What is the dc gain of
the low-pass response?
3.44 The simpliﬁed state-variable ﬁlter of Fig. P3.44 provides the low-pass and band-pass
responses using only two op amps. (a) Show that H0BP = −n, H0LP = m/(m + 1),
Q = √n(1 + 1/m), and ω0 = Q/nRC. (b) Specify component values for a band-pass
response with f0 = 2 kHz and Q = 10. (c) What is the resonance gain of your circuit?
What is the most serious drawback of this circuit?
+
–
+
–
R
C
C
VBP
VLP
OA1
OA2
+
Vi
mR
nR
FIGURE P3.44
3.45 Use the noninverting state-variable ﬁlter with an additional op amp adder to synthesize
the low-pass notch of Example 3.20. Hint: Obtain the notch response as VN = ALVLP+
AH VHP, where AL and AH are suitable coefﬁcients.
3.46 Consider the dual-op-amp biquad obtained from the standard biquad of Fig. 3.36 by
replacing OA2 and OA3 with the Deboo integrator of Fig. 3.7. Find its responses; specify
component values for a low-pass response with f0 = 10 kHz, Q = 5, and H0LP = 0 dB.
3.47 Using the state-variable ﬁlter, along with a fourth op amp adder, design an all-pass
circuit with f0 = 1 kHz and Q = 1. Hint: Apply Eq. (3.58).
3.48 Consider the biquad of Fig. 3.36 with R2 removed. If the op amps are ideal, the circuit
will give Q →∞, but what if the op amps have ﬁnite gains? Assuming equal capacitors

170
CHAPTER 3
Active Filters:
Part I
and equal resistors throughout, ﬁnd Q if the op amps have a = 100 V/V, rd = ∞, and
ro = 0. Verify with PSpice.
3.8 Sensitivity
3.49 Prove Eq. (3.92).
3.50 Show that any second-order KRC ﬁlter, in which K appears only in the s-term in the
denominator, has always SQ
K > 2Q −1.
3.51 An alternative design procedure for the multiple-feedback low-pass ﬁlter of Fig. 3.32 is
R1 = R2 = R3 = R. (a) Find simpliﬁed expressions for ω0 and Q. (b) Find the sensitivity
functions.
3.52 Calculate the sensitivities of the state-variable ﬁlter of Example 3.18.
3.53 Let the circuit of Fig. P3.41 be implemented with R = 1.59 k, C = 1 nF, and
R1 = R2 = 10 k. Use PSpice to ﬁnd how a 10% change in each component, one
component at a time, affects the resonant frequency f0. Is this a good circuit in terms
of sensitivities?
REFERENCES
1. M. E. Van Valkenburg, Analog Filter Design, Holt, Rinehart and Winston, Orlando, FL,
1982.
2. L.P.Huelsman,ActiveandPassiveAnalogFilterDesign:AnIntroduction,McGraw-Hill,
New York, 1993.
3. F. W. Stephenson, RC Active Filter Design Handbook, John Wiley & Sons, New York,
1985.
4. A. B. Williams and F. J. Taylor, Electronic Filter Design Handbook: LC, Active, and
Digital Filters, 2d ed., McGraw-Hill, New York, 1988.
5. S. Franco, Electric Circuits Fundamentals, Oxford University Press, New York, 1995.
6. W. G. Jung, Audio IC Op Amp Applications, 3d ed., Howard W. Sams, Carmel, IN, 1987.
7. K. Lacanette, “High Performance Audio Applications of the LM833,” Application Note
AN-346, Linear Applications Handbook, National Semiconductor, Santa Clara, CA,
1994.
8. R. A. Greiner and M. Schoessow, “Design Aspects of Graphic Equalizers,” J. Audio Eng.
Soc., Vol. 31, No. 6, June 1983, pp. 394–407.

4
ACTIVE FILTERS: PART II
4.1 Filter Approximations
4.2 Cascade Design
4.3 Generalized Impedance Converters
4.4 Direct Design
4.5 The Switched Capacitor
4.6 Switched-Capacitor Filters
4.7 Universal SC Filters
Problems
References
Having studied ﬁrst-order and second-order ﬁlters, we now turn to higher-order
ﬁlters, which are required when the cutoff characteristics of the lower-order types
are not sufﬁciently sharp to meet the demands of the given application. Among the
various methods of realizing higher-order active ﬁlters, the ones that have gained
prominence are the cascade design approach and the direct synthesis approach.
The cascade approach realizes the desired response by cascading second-order ﬁl-
ter stages (and possibly a ﬁrst-order stage) of the types studied in Chapter 3. The
direct approach uses active impedance converters, such as gyrators and frequency-
dependent negative resistances, to simulate a passive RLC ﬁlter prototype meeting
the given speciﬁcations.
Regardless of the complexity of their responses, the above ﬁlters, also known
as continuous-time ﬁlters, do not lend themselves to monolithic fabrication due to
the large sizes of the capacitances involved and the stringent requirements on the
accuracy and stability of the RC products controlling characteristic frequencies. On
the other hand, today’s very large scale integration (VLSI) applications often call for
digital as well as analog functions on the same chip. To meet this requirement in the
area of ﬁltering and other traditional analog areas, switched-capacitor techniques
have been developed, which use MOS op amps, capacitors, and switches, but no
171

172
CHAPTER 4
Active Filters:
Part II
resistors, to realize fairly stable ﬁlter functions—if over comparatively limited fre-
quency ranges. Switched capacitor (SC) circuits belong to the category of sampled-
data systems, where information is processed at discrete time intervals rather than
continuously. This generally limits their usage to voice-band applications.
Chapter Highlights
The ﬁrst part of the chapter, after reviewing ﬁlter approximations in common use,
discusses popular ﬁlter designs using both the cascade and the direct-synthesis ap-
proach. The second part, after an introduction to switched-capacitor techniques,
investigates switched-capacitor ﬁlters, addressing both applications and limitations
thereof. As in Chapter 3, we deliberately assume ideal op amps so we can focus
exclusively on ﬁlter concepts without having to worry about the additional level of
complexity caused by op amp nonidealities (the effect of limited op amp dynam-
ics is left for Chapter 6). As in Chapter 3, SPICE offers an invaluable tool for the
visualization of ﬁlter responses as well as oscilloscope-like ﬁlter measurements.
4.1
FILTER APPROXIMATIONS
If the signals to be rejected are very close in frequency to those that must be passed,
the cutoff characteristics of a second-order ﬁlter may not prove sufﬁciently sharp, so
a higher-order ﬁlter may be needed. Actual ﬁlters can only approximate the brick-
wall responses of Fig. 3.1. In general, the closer the desired approximation, the
higher the order of the ﬁlter.
The departure of a practical ﬁlter from its brick-wall model is visualized in
terms of a shaded area,1 as shown in Fig. 4.1a for the low-pass case. Introducing the
attenuation A(ω) as
A(ω) = −20 log10 |H( jω)|
(4.1)
we observe that the range of frequencies that are passed with little or no attenuation
deﬁnes the passband. For a low-pass ﬁlter, this band extends from dc to some
frequency ωc, called the cutoff frequency. Gain is not necessarily constant within the
|H|
|H|
Amax
Amax
Amin
Amin
1
0
0
1
0
0
s
c
ω
c
ω
ω
s
ω
ω
ω
(a)
(b)
FIGURE 4.1
Magnitude limits for (a) the low-pass and (b) the high-pass responses.

173
SECTION 4.1
Filter
Approximations
|H|
|H|
Amax
Amax
Amin
Amin
1
0
0
1
0
0
cL
sL
ω
ω
sH
cH
ω
ω
sL
cL
ω
ω
cH
sH
ω
ω
ω
ω
(a)
(b)
FIGURE 4.2
Magnitude limits for (a) the band-pass and (b) the band-reject responses.
passband but is allowed a maximum variation Amax, such as Amax = 1 dB. Gain
may exhibit ripple within the passband, in which case Amax is called the maximum
passband ripple and the passband is called the ripple band. In this case ωc represents
the frequency at which the response departs from the ripple band.
Past ωc the magnitude drops off to the stopband, or the frequency region of
substantial attenuation. This band is speciﬁed in terms of some minimum allowable
attenuation, such as Amin = 60 dB. The frequency at which the stopband begins
is denoted as ωs. The ratio ωs/ωc is called the selectivity factor because it gives a
measure of the sharpness of the response. The frequency region between ωc and ωs
is called the transition band, or skirt. Certain ﬁlter approximations maximize the
rate of descent within this band at the expense of ripples within the other bands.
The terminology developed for the low-pass case is readily extended to the high-
pass case depicted in Fig. 4.1b, and to the band-pass and band-reject cases depicted
in Fig. 4.2.
As the order n of a transfer function is increased, additional parameters are
brought into play in the form of the higher-order polynomial coefﬁcients. These co-
efﬁcients provide the designer with additional freedom in specifying the frequency
proﬁles of magnitude or phase, thus allowing for an increased degree of optimiza-
tion. Among the various approximations, some have been found to be consistently
satisfactory to justify the tabulation of their coefﬁcients in ﬁlter handbooks. These
include the Butterworth, Chebyshev, Cauer, and Bessel approximations.
Filter tables list the denominator polynomial coefﬁcients of the various ap-
proximations for a cutoff frequency of 1 rad/s. As an example, the coefﬁcients of
the ﬁfth-order Butterworth response are2 b0 = b5 = 1, b2 = b4 = 3.236, and
b3 = 5.236, so
H(s) =
1
s5 + 3.236s4 + 5.236s3 + 5.236s2 + 3.236s + 1
(4.2)
An alternative approach is to factor out H(s) into the product of terms of order ≤2
and tabulate the coefﬁcients of these terms instead. Expressed in this form, the above
function becomes
H(s) =
1
s2 + 0.6180s + 1 ×
1
s2 + 1.6180s + 1 ×
1
s + 1
(4.3)

174
CHAPTER 4
Active Filters:
Part II
The design of a higher-order ﬁlter begins with the selection of the approximation
best suited to the given application, followed by the speciﬁcation of ωc, ωs, Amax,
and Amin. The latter are then used as keys to ﬁlter handbooks or computer programs
to ﬁnd the required order n. Once n is known, various alternatives are available to
the active-ﬁlter designer, the most popular ones being the cascade approach and
the RLC ladder simulation approach. The cascade approach realizes the desired
response by cascading lower-order stages of the type investigated in Chapter 3. The
laddersimulationapproachutilizesactiveimpedanceconverters,suchasgyratorsand
frequency-dependent negative resistors, to simulate a passive RLC ﬁlter prototype
meeting the desired speciﬁcations.
Once an approach has been chosen, one must ﬁnd the individual-stage values
of ω0 and Q (and possibly ωz) in the case of cascade design, or the individual
values of R, L, and C in the case of ladder simulation. These data are again found
with the help of ﬁlter tables or computer programs. To promote their products,
analog companies offer a variety of ﬁlter-design tools that the user can download
for free from the web (in this respect, you are encouraged to perform a web search
for “ﬁlter design software” and secure your own ﬁlter program). In the following
discussions we shall continue to use FILDES, one of the earliest cascade-design
programs developed for personal computers, which has proven helpful in previous
editions of this book, and which the reader can download from this book’s website,
http://www.mhhe.com/franco.
Plotting H( jf ) Using PSpice
As already seen in Chapter 3, a convenient means for generating the Bode plots
of a ﬁlter function H(s) is PSpice’s Laplace block. As an example, Fig. 4.3 shows
a PSpice circuit to plot the magnitude of the ﬁfth-order Butterworth response of
Eq. (4.3). Magnitude is plotted in Fig. 4.4 using linear as well as logarithmic scales,
so we can better appreciate similarities and differences (the linear plot is preferable in
relation to Fig. 4.1, whereas the logarithmic plot affords a much better visualization
of high- and low-frequency details that get far too compressed in the linear plot).
Note, in the logarithmic plot, the rapid descent from 0 dB to –100 dB within a single
decade, as expected of a ﬁfth-order ﬁlter.
LAPLACE1 {v(I,0)} = {1/((s/6.283)**2+0.618*s/6.283+1)}
LAPLACE2 {v(O1,0)} = {1/((s/6.283)**2+1.618*s/6.283+1)}
LAPLACE3 {v(O2,0)} = {1/(s/6.283+1)}
Vi
IN+
IN−
OUT+
OUT−
+
–
ELAPL1
O1
0
0
0
I
IN+
IN−
OUT+
OUT−
ELAPL2
O2
0
IN+
IN−
OUT+
OUT−
ELAPL3
O
0
Vo
FIGURE 4.3
PSpice circuit to plot the ﬁfth-order Butterworth low-pass function
normalized to 1 Hz.

175
SECTION 4.1
Filter
Approximations
Frequency f (Hz)
(a)
(b)
1 V/V
0
0.5 V/V
0
1
2
3
|H|1in
Frequency f (Hz)
0
−100 dB
−75 dB
−50 dB
−25 dB
0.1
1
10
|H|dB
FIGURE 4.4
Magnitude plots of the ﬁfth-order Butterworth low-pass function normalized to 1 Hz.
(a) Linear scale and (b) logarithmic scale.
Butterworth Approximation
The gain of the Butterworth approximation is3
|H( jω)| =
1

1 + ϵ2(ω/ωc)2n
(4.4)
where n is the order of the ﬁlter, ωc is the cutoff frequency, and ϵ is a constant
that determines the maximum passband variation as
Amax = A(ωc) = 20 ×
log10

1 + ϵ2 = 10 log10(1 + ϵ2). The ﬁrst 2n −1 derivatives of |H( jω)| are zero
at ω = 0, indicating a curve as ﬂat as possible at ω = 0. Aptly referred to as max-
imally ﬂat, a Butterworth curve becomes somewhat rounded near ωc and rolls off
at an ultimate rate of −20n dB/dec in the stopband. As shown in Fig. 4.5a for
ϵ = 1, the higher the order n, then the closer the response is to the brick-wall
model.
Frequency f (Hz)
(a)
1 V/V
0
0.5 V/V
0
0.5
1
1.5
2
Frequency f (Hz)
(b)
1 V/V
0
0.5 V/V
0
0.5
1
1.5
2
n = 2
n = 5
n = 4
n = 2
n = 8
n = 1
FIGURE 4.5
(a) Butterworth and (b) 1-dB Chebyshev responses.

176
CHAPTER 4
Active Filters:
Part II
EXAMPLE 4.1.
Find n for a low-pass Butterworth response with fc = 1 kHz, fs =
2 kHz, Amax = 1 dB, and Amin = 40 dB.
Solution.
Letting Amax = A(ωc) = 20 log10
√
1 + ϵ2 = 1 dB gives ϵ = 0.5088. Letting
A(ωs) = 10 log10[1+ϵ2(2/1)2n] = 40 dB, we ﬁnd that n = 7 gives A(ωs) = 36.3 dB and
n = 8 gives A(ωs) = 42.2 dB. For Amin = 40 dB we thus select n = 8.
Chebyshev Approximation
There are applications where sharp cutoff is more important than maximal ﬂatness.
Chebyshev ﬁlters maximize the transition-band cutoff rate at the price of introducing
passband ripples, as shown in Fig. 4.5b. As a general rule, the higher Amax, the
narrower the transition band for a given Amin. The gain of an nth-order Chebyshev
approximation with cutoff frequency ωc and Amax = 10 log10(1 + ϵ2) is3
|H( jω)| =
1

1 + ϵ2C2n(ω/ωc)
(4.5)
where Cn(ω/ωc) is the Chebyshev polynomial of order n, deﬁned as
Cn(ω/ωc ≤1) = cos[n cos−1(ω/ωc)]
(4.6a)
Cn(ω/ωc ≥1) = cosh[n cosh−1(ω/ωc)]
(4.6b)
We observe that C2n(ω/ωc ≤1) ≤1, and C2n(ω/ωc ≥1) ≥1. Moreover, within the
passband |H( jω)| exhibits peak values of 1 and valley values of 1/

1 + ϵ2 at the
frequencies that make the cosine term zero and unity, respectively. The number of
these peaks or valleys, including the one at the origin, is n.
Compared to the Butterworth approximation, which exhibits appreciable de-
parture from its dc value only at the upper end of the passband, the Chebyshev
approximation improves the transition-band characteristic by spreading its equal-
sized ripples throughout the passband. At dc, the decibel value of a Chebyshev
response is 0 if n is odd, and 0 −Amax if n is even. A Chebyshev ﬁlter can achieve
a given transition-band cutoff rate with a lower order than a Butterworth ﬁlter,
thus reducing circuit complexity and cost. Past the transition band, however, the
Chebyshev response rolls off at an ultimate rate of −20n dB/dec, just like a Butter-
worth response of the same order.
Cauer Approximation
Cauer ﬁlters, also calledelliptic ﬁlters,carry the Chebyshev approach one step further
by trading ripples in both the passband and the stopband for an even sharper charac-
teristic in the transition band. Consequently, they can provide a given transition-band
cutoff rate with an even lower order n than Chebyshev ﬁlters. The idea is to follow
an existing low-pass response with a notch just above ωc to further sharpen the
response. To be effective, the notch must be narrow, indicating that the curve will
come back up just past this notch. At this point another notch is created to press
the curve back down, and the process is repeated until the overall proﬁle within the
stopband is pushed below the level speciﬁed by Amin. The various approximations
are compared in Fig. 4.6 for n = 5 and Amax = 3 dB.

177
SECTION 4.1
Filter
Approximations
Frequency f (Hz)
0
−20 dB
−40 dB
−60 dB
0.01
0.1
1
10
0
−3 dB
Bu
Be
Ch
Ca
Be
Ca
Ch
Bu
FIGURE 4.6
Fifth-order ﬁlter responses comparison: Bessel (Be), Butter-
worth (Bu), Chebyshev (Ch) and Cauer (Ca). Shown at the
top is an expanded view of the 3-dB passband.
Bessel Approximation
In general, ﬁlters introduce a frequency-dependent phase shift. If this shift varies
linearly with frequency, its effect is simply to delay the signal by a constant amount.
However, if phase varies nonlinearly, different input frequency components will
experience different delays, so nonsinusoidal signals may experience signiﬁcant
phasedistortioninpropagatingthroughtheﬁlter.Ingeneral,thesteeperthetransition-
band magnitude characteristic, the higher the distortion.1
Bessel ﬁlters, also called Thomson ﬁlters, maximize the passband delay just as
Butterworth ﬁlters maximize the passband magnitude. The result is a nearly linear
phase characteristic within the passband, if at the price of a less sharp magnitude
characteristic in the transition band. Figure 4.7 shows that a pulse emerges fairly
undistorted from a Bessel ﬁlter, but exhibits appreciable overshoot and ringing when
processed with a Chebyshev ﬁlter, whose phase response is less linear than Bessel’s.
Frequency f (Hz)
(a)
0°
−360°
−180°
−90°
−270°
0.01
0.1
1
10
100
Be
Ch
Time (s)
(b)
0.5 V
1 V
0
0
5
10
Ch
Be
FIGURE 4.7
Comparing the (a) phase and (b) pulse responses of fourth-order Bessel (Be) and 1-dB
Chebyshev (Ch) ﬁlters.

178
CHAPTER 4
Active Filters:
Part II
4.2
CASCADE DESIGN
This approach is based on the factorization of a transfer function H(s) into the
product of lower-order terms. If the order n is even, the decomposition consists of
n/2 second-order terms,
H(s) = H1(s) × H2(s) × · · · × Hn/2(s)
(4.7)
If n is odd, the factorization includes also a ﬁrst-order term. Sometimes this term
is combined with one of the second-order terms to create a third-order ﬁlter stage.
The ﬁrst-order term, if any, can be implemented with a plain RC or C R network,
so all we need to know is its required frequency ω0. The second-order terms can be
implemented with any of the ﬁlters of Sections 3.5 through 3.7. For each of these
stages we need to know ω0 and Q, and ωz if the stage is a notch stage. As mentioned,
these data are tabulated in ﬁlter handbooks3 or can be calculated by computer.4
The cascade approach offers a number of advantages. The design of each sec-
tion is relatively simple, and the component count is usually low. The low-output
impedance of the individual sections eliminates interstage loading, so each section
can be regarded as isolated from the others and can be tuned independently, if
needed. The inherent modularity of this approach is also attractive from the eco-
nomic standpoint, since one can use a few standardized blocks to design a variety
of more complex ﬁlters.
Mathematically, the order in which the various sections are cascaded is irrele-
vant. In practice, to avoid loss of dynamic range and ﬁlter accuracy due to possible
signal clipping in the high-Q sections, the sections are cascaded in order of ascend-
ing Qs, with the low-Q stages ﬁrst in the signal path. This ordering, however, does
not take into account internal noise, which may be of concern in the high-Q stages,
where any noise component falling under the resonance peak may be ampliﬁed
signiﬁcantly. So, to minimize noise, high-Q stages should go ﬁrst in the cascade. In
general, the optimum ordering depends on the input spectrum, the ﬁlter type, and
the noise characteristics of its components.5
Low-Pass Filter Design
Table4.1givesexamplesoftabulateddataforcascadedesign.ButterworthandBessel
data are tabulated for different values of n, Chebyshev data for different values of n
and Amax (shown in the table are the data for Amax = 0.1 dB and Amax = 1.0 dB),
and Cauer data (not shown in the table) for different values of n, Amax, and Amin.
Frequency data are expressed in normalized form for a cutoff frequency of 1 Hz. In
the Butterworth and Bessel cases this frequency coincides with the −3-dB frequency,
while in the Chebyshev and Cauer cases it represents the frequency at which gain
departs from the ripple band. To convert from normalized to actual frequencies, we
simply multiply the tabulated values by the cutoff frequency fc of the ﬁlter being
designed, or
f0 = f0(table) × fc
(4.8a)
In the case of Cauer ﬁlters, the tables include not only pole frequencies but also zero
frequencies. The latter are converted as
fz = fz(table) × fc
(4.8b)

179
SECTION 4.2
Cascade Design
TABLE 4.1
Examples of normalized (1 Hz) low-pass ﬁlter tables
Butterworth low-pass ﬁlter
n
f01
Q1
f02
Q2
f03
Q3
f04
Q4
f05
Q5
Att (dB) at 2fc
2
1
0.707
1
12.30
3
1
1.000
1
18.13
4
1
0.541
1
1.306
24.10
5
1
0.618
1
1.620
1
30.11
6
1
0.518
1
0.707
1
1.932
36.12
7
1
0.555
1
0.802
1
2.247
1
42.14
8
1
0.510
1
0.601
1
0.900
1
2.563
48.16
9
1
0.532
1
0.653
1
1.000
1
2.879
1
54.19
10
1
0.506
1
0.561
1
0.707
1
1.101
1
3.196
60.21
Bessel low-pass ﬁlter
n
f01
Q1
f02
Q2
f03
Q3
f04
Q4
f05
Q5
2
1.274
0.577
3
1.453
0.691
1.327
4
1.419
0.522
1.591
0.806
5
1.561
0.564
1.760
0.917
1.507
6
1.606
0.510
1.691
0.611
1.907
1.023
7
1.719
0.533
1.824
0.661
2.051
1.127
1.685
8
1.784
0.506
1.838
0.560
1.958
0.711
2.196
1.226
9
1.880
0.520
1.949
0.589
2.081
0.760
2.324
1.322
1.858
10
1.949
0.504
1.987
0.538
2.068
0.620
2.211
0.810
2.485
1.415
0.10-dB ripple Chebyshev low-pass ﬁlter
n
f01
Q1
f02
Q2
f03
Q3
f04
Q4
f05
Q5
Att (dB) at 2fc
2
1.820
0.767
3.31
3
1.300
1.341
0.969
12.24
4
1.153
2.183
0.789
0.619
23.43
5
1.093
3.282
0.797
0.915
0.539
34.85
6
1.063
4.633
0.834
1.332
0.513
0.599
46.29
7
1.045
6.233
0.868
1.847
0.575
0.846
0.377
57.72
8
1.034
8.082
0.894
2.453
0.645
1.183
0.382
0.593
69.16
9
1.027
10.178
0.913
3.145
0.705
1.585
0.449
0.822
0.290
80.60
10
1.022
12.522
0.928
3.921
0.754
2.044
0.524
1.127
0.304
0.590
92.04
1.00-dB ripple Chebyshev low-pass ﬁlter
n
f01
Q1
f02
Q2
f03
Q3
f04
Q4
f05
Q5
Att (dB) at 2fc
2
1.050
0.957
11.36
3
0.997
2.018
0.494
22.46
4
0.993
3.559
0.529
0.785
33.87
5
0.994
5.556
0.655
1.399
0.289
45.31
6
0.995
8.004
0.747
2.198
0.353
0.761
56.74
7
0.996
10.899
0.808
3.156
0.480
1.297
0.205
68.18
8
0.997
14.240
0.851
4.266
0.584
1.956
0.265
0.753
79.62
9
0.998
18.029
0.881
5.527
0.662
2.713
0.377
1.260
0.159
91.06
10
0.998
22.263
0.902
6.937
0.721
3.561
0.476
1.864
0.212
0.749
102.50

180
CHAPTER 4
Active Filters:
Part II
A common application of low-pass ﬁlters is in connection with analog-to-digital
(A-D) and digital-to-analog (D-A) conversion. By the well-known sampling theo-
rem, the input signal to an A-D converter must be band limited to less than half
the sampling frequency in order to avoid aliasing. Likewise, the output signal of a
D-A converter must be properly smoothed in order to avoid the effects of discrete
quantization and time sampling. Both tasks are accomplished with sharp low-pass
ﬁlters designed to provide adequate attenuation at half the sampling frequency.
EXAMPLE 4.2.
The output of a D-A converter with a sampling rate of 40 kHz is to be
smoothed with a sixth-order 1.0-dB Chebyshev low-pass ﬁlter providing an attenuation
of 40 dB at half the sampling frequency, or 20 kHz. This attenuation requirement is met
by letting fc = 13.0 kHz. (a) Design such a ﬁlter. (b) Verify with PSpice.
Solution.
(a) From Table 4.1 we ﬁnd that a 1.0-dB Chebyshev ﬁlter with n = 6 requires three
second-order stages with
f01 = 0.995 fc = 12.9 kHz
Q1 = 8.00
f02 = 0.747 fc = 9.71 kHz
Q2 = 2.20
f03 = 0.353 fc = 4.59 kHz
Q3 = 0.761
Use three unity-gain Sallen-Key sections and cascade them in order of ascending
Qs. Retracing the design steps of Example 3.10, we ﬁnd the component values
shown in Fig. 4.8(top), where the resistances have been rounded off to the nearest
1% standard values.
Frequency f (Hz)
Gain (dB)
20
−80
−40
0
103
104
105
2nd
1st
Vo
62 nF
R23
C13
2.49 kΩ
R13
4.64 kΩ
0
1 GV/V
O3
EOA3
+
–
+
–
0
C23
220 pF
10 nF
R22
C12
6.49 kΩ
0
1 GV/V
O2
EOA2
+
–
+
–
0
C22
510 pF
R12
8.25 kΩ
5.1 nF
R21
C11
10.2 kΩ
R11
I
10.7 kΩ
0
1 GV/V
O1
EOA1
+
–
+
–
0
C21
2.2 nF
Vi
+
–
0
3rd
FIGURE 4.8
Top: Sixth-order Chebyshev low-pass ﬁlter of Example 4.2. Bottom: Magnitude plot of its overall response
H = Vo/Vi, along with the responses of its individual stages.

181
SECTION 4.2
Cascade Design
Figure 4.8 (bottom) shows the overall response as well as the individual-stage
responses. It is interesting to observe how the latter combine to create the ripple and
cutoff characteristics of the overall response.
EXAMPLE 4.3.
Design a Cauer low-pass ﬁlter with fc = 1 kHz, fs = 1.3 kHz, Amax =
0.1 dB, Amin = 40 dB, and dc gain H0 = 0 dB.
Solution. Using the aforementioned ﬁlter design program FILDES (check our website
for information on how to download this program), we ﬁnd that a sixth-order implemen-
tation is required, with the following individual-stage parameters:
f01 = 648.8 Hz
fz1 = 4130.2 Hz
Q1 = 0.625
f02 = 916.5 Hz
fz2 = 1664.3 Hz
Q2 = 1.789
f03 = 1041.3 Hz
fz3 = 1329.0 Hz
Q3 = 7.880
Moreover, the program indicates that the actual attenuation at 1.3 kHz is 47 dB, and the
−3-dB frequency is 1.055 kHz.
We shall implement the ﬁlter with three low-pass notch sections of the biquad type
of Fig. 3.37. Using Eq. (3.89) and retracing the steps of Example 3.20, we ﬁnd the
component values shown in Fig. 4.9, where the resistances have been rounded off to
the nearest 1% standard values. The entire ﬁlter can be built with three quad-op-amp
packages.
High-Pass Filter Design
Owing to the fact that a high-pass transfer function can be obtained from a low-pass
function via the substitution s/ω0 →1/(s/ω0), the normalized frequency data of
Table 4.1 can also be used in the cascade design of high-pass ﬁlters, provided actual
frequencies are obtained from tabulated frequencies as
f0 = fc/f0(table)
(4.9a)
fz = fc/fz(table)
(4.9b)
where fc is the cutoff frequency of the ﬁlter being designed.
EXAMPLE 4.4.
Design a third-order, 0.1-dB Chebyshev high-pass ﬁlter with fc =
100 Hz and high-frequency gain H0 = 20 dB.
Solution.
Table 4.1 indicates that we need a second-order high-pass section with
f01 = 100/1.300 = 76.92 Hz and Q1 = 1.341, and a ﬁrst-order high-pass section with
f02 = 100/0.969 = 103.2 Hz. As shown in Fig. 4.10, we implement the ﬁlter with a
second-order unity-gain Sallen-Key high-pass stage, followed by a ﬁrst-order high-pass
stage with a high-frequency gain of 10 V/V.
Band-Pass Filter Design
EXAMPLE 4.5. Design a Butterworth band-pass ﬁlter with center frequency f0 = 1 kHz,
BW = 100 Hz, A( f0/2) = A(2 f0) ≥60 dB, and resonance gain H0 = 0 dB.
Solution.
Using the aforementioned FILDES program, we ﬁnd that the given spec-
iﬁcations can be met with a sixth-order ﬁlter having the following individual-stage

182
CHAPTER 4
Active Filters:
Part II
+
–
+
–
69.8 kΩ
110 kΩ
2.2 nF
2.2 nF
100 kΩ
2.49 kΩ
+
Vi
+
–
110 kΩ
69.8 kΩ
100 kΩ
+
–
100 kΩ
100 kΩ
4.02 kΩ
+
–
+
–
140 kΩ
78.7 kΩ
2.2 nF
2.2 nF
100 kΩ
30.1 kΩ
+
–
78.7 kΩ
140 kΩ
100 kΩ
+
–
100 kΩ
100 kΩ
24.3 kΩ
+
–
+
–
549 kΩ
69.8 kΩ
2.2 nF
2.2 nF
100 kΩ
61.9 kΩ
+
–
69.8 kΩ
549 kΩ
100 kΩ
+
–
100 kΩ
100 kΩ
20.0 kΩ
Vo
0
– 6
–12
–18
–24
–30
–36
– 42
– 48
– 54
0.01
0.1
1
10
Gain (dB)
Frequency (kHz)
FIGURE 4.9
Sixth-order 0.1/40-dB elliptic low-pass ﬁlter of Example 4.3.

183
SECTION 4.2
Cascade Design
+
–
+
–OA2
OA1
Vo
Vi
+
15.4 kΩ
54.9 kΩ
7.68 kΩ
154 kΩ
100 nF
100 nF
100 nF
FIGURE 4.10
Third-order 0.1-dB Chebyshev high-pass ﬁlter of Example 4.4.
parameters:
f01 = 957.6 Hz
Q1 = 20.02
f02 = 1044.3 Hz
Q2 = 20.02
f03 = 1000.0 Hz
Q3 = 10.0
Furthermore, the actual attenuation at 500 Hz and 2 kHz is 70.5 dB, and the midband gain
is −12 dB, that is, 0.25 V/V. To raise it to 0 dB, we shall impose H0BP1 = H0BP2 = 2 V/V,
and H0BP3 = 1 V/V.
We shall implement the ﬁlter with three multiple-feedback band-pass sections
equipped with input resistance attenuators. Retracing the steps of Example 3.15 we
ﬁnd the components of Fig. 4.11, where the resistances have been rounded off to 1%
standard values, and the second leg of each attenuator has been made variable for tuning
purposes. To tune a given section, apply an ac input at the desired resonance frequency
of that section, and adjust its pot until the Lissajous ﬁgure changes from an ellipse to a
straight segment.
EXAMPLE 4.6.
Design an elliptic band-pass ﬁlter with f0 = 1 kHz, passband =
200 Hz, stopband = 500 Hz, Amax = 1 dB, Amin = 40 dB, and H0 = 20 dB.
Solution. The above-mentioned FILDES program indicates that we need a sixth-order
ﬁlter with the following individual-stage parameters:
f01 = 907.14 Hz
fz1 = 754.36 Hz
Q1 = 21.97
f02 = 1102.36 Hz
fz2 = 1325.6 Hz
Q2 = 21.97
f03 = 1000.0 Hz
Q3 = 9.587
+
–
158 kΩ
10 nF
10 nF
316 kΩ
Vi
698 Ω
200 Ω
VO
+
+
–
154 kΩ
10 nF
10 nF
604 kΩ
332 Ω
100 Ω
+
–
165 kΩ
10 nF
10 nF
665 kΩ
365 Ω
100 Ω
FIGURE 4.11
Sixth-order Butterworth band-pass ﬁlter of Example 4.5.

184
CHAPTER 4
Active Filters:
Part II
Moreover, the actual attenuation at the stopband edges is 41 dB, and the midband gain is
18.2 dB. We shall implement the ﬁlter with a high-pass notch biquad stage, a low-pass
notch biquad stage, and a multiple-feedback band-pass stage. To bolster the midband
gain from 18.2 dB to 20 dB, we impose H0BP3 = 1.23 V/V, and to simplify inventory
we use 10-nF capacitances throughout.
Using Eq. (3.89) we ﬁnd, for the high-pass notch, R = 1/(2π × 907.14 × 10−8) =
17.54k, R1 = 21.97×17.54 = 385.4k, R2 = R3 = 100k, R4 = (100/21.97)907.
142/(907.142−754.362) = 14.755 k, and R5 = 100 k. Proceeding in like manner for
the other two sections, we end up with the circuit of Fig. 4.12, where the resistances have
been rounded off to 1% standard values, and provisions have been made for frequency
and Q tuning.
+
–
+
–
383 kΩ
17.4 kΩ
10 nF
10 nF
100 kΩ
100 kΩ
+
Vi
+
–
14.7 kΩ
332 kΩ
100 kΩ
100 kΩ
100 kΩ
+
–
100 kΩ
100 kΩ
14.7 kΩ
+
–
+
–
316 kΩ
14.3 kΩ
10 nF
10 nF
100 kΩ
69.8 kΩ
+
–
11.8 kΩ
267 kΩ
100 kΩ
+
–
100 kΩ
100 kΩ
10.2 kΩ
124 kΩ
10 nF
732 Ω
200 Ω
10 nF
+
–
309 kΩ
Vo
20
0
–20
0.5
1
2
5 kΩ
5 kΩ
Gain (dB)
Frequency (kHz)
FIGURE 4.12
Sixth-order 1.0/40-dB elliptic band-pass ﬁlter of Example 4.6.

185
SECTION 4.3
Generalized
Impedance
Converters
Band-Reject Filter Design
EXAMPLE 4.7.
A 0.1-dB Chebyshev band-reject ﬁlter is to be designed with notch
frequency fz = 3600 Hz, passband = 400 Hz, stopband = 60 Hz, Amax = 0.1 dB, and
Amin = 40 dB. The circuit must have provision for frequency tuning of its individual
stages.
Solution.
The aforementioned FILDES program indicates that we need a sixth-order
ﬁlter with the following individual-stage parameters:
f01 = 3460.05 Hz
fz1 = 3600 Hz
Q1 = 31.4
f02 = 3745.0 Hz
fz2 = 3600 Hz
Q2 = 31.4
f03 = 3600.0 Hz
fz3 = 3600 Hz
Q3 = 8.72
Moreover, the actual stopband attenuation is 45 dB. This ﬁlter is readily designed using
three biquad sections, namely, a high-pass notch, followed by a low-pass notch, followed
by a symmetric notch (see Problem 4.13).
4.3
GENERALIZED IMPEDANCE CONVERTERS
Impedance converters are active RC circuits designed to simulate frequency-
dependent elements such as inductances for use in active ﬁlter synthesis. Among the
various conﬁgurations, one that has gained prominence is the generalized impedance
converter (GIC) of Fig. 4.13, which can be used not only to simulate inductances,
but also to synthesize frequency-dependent resistances.
⇒
+
–OA2
+
–
OA1
Z = Z1Z3Z5
Z2Z4
Z1
Z2
Z3
Z4
Z5
Z
A
A
FIGURE 4.13
Generalized impedance converter (GIC).

186
CHAPTER 4
Active Filters:
Part II
+
–OA2
+
–
OA1
Z1
Z2
Z3
Z4
Z5
+
V
V
V
V
V
V2
V1
I
FIGURE 4.14
Finding the equivalent impedance
of a GIC toward ground.
To ﬁnd the equivalent impedance Z seen looking into node A, we apply a test
voltage V as in Fig. 4.14, we ﬁnd the resulting current I, and then we let Z = V/I.
Exploiting the fact that each op amp keeps Vn = Vp, we have labeled the voltages
at the input nodes of both op amps as V. By Ohm’s law, we have
I = V −V1
Z1
Summing currents at the node common to Z2 and Z3 and at the node common to
Z4 and Z5 we obtain, respectively,
V1 −V
Z2
+ V2 −V
Z3
= 0
V2 −V
Z4
+ 0 −V
Z5
= 0
Eliminating V1 and V2, and solving for the ratio Z = V/I, we get
Z = Z1Z3Z5
Z2Z4
(4.10)
Depending on the type of components we use for Z1 through Z5, we can conﬁgure
the circuit for various impedance types. The most interesting and useful ones are as
follows:
1. All Zs are resistances, except Z2 (or Z4), which is a capacitance. Letting Z2 =
1/jωC2 in Eq. (4.10) gives
Z =
R1R3R5
(1/jωC2)R4
= jωL
(4.11a)

187
SECTION 4.3
Generalized
Impedance
Converters
⇒
⇒
R5
R1
+
–
OA2
+
–
OA1
L
D
R4
R3
C2
C1
R2
R4
C5
R3
+
–
OA2
+
–
OA1
R1R3R5C2
R4
R2R4C1C5
R3
A
A
A
A
(a)
(b)
L =
D =
FIGURE 4.15
(a) Inductance simulator and (b) D-element realization.
L = R1R3R5C2
R4
(4.11b)
indicating that the circuit simulates a grounded inductance. This is depicted in
Fig. 4.15a. If desired, this inductance can be adjusted by varying one of the
resistances, say, R5.
2. All Zs are resistances, except for Z1 and Z5, which are capacitances. Letting
Z1 = 1/jωC1 and Z5 = 1/jωC5 in Eq. (4.10) gives
Z = (1/jωC1)R3(1/jωC5)
R2R4
= −
1
ω2D
(4.12a)
D = R2R4C1C5
R3
(4.12b)
The circuit now simulates a grounded frequency-dependent negative resistance
(grounded FDNR). Since a capacitance produces a voltage proportional to the
integral of the current, the FDNR (or D element, as it is often called) can be
viewed as an element that integrates current twice. Its GIC realization and circuit
symbol are shown in Fig. 4.15b, and its application will be illustrated shortly.
The D element can be adjusted by varying one of the resistances.
Figure 4.16 shows another popular realization of the D element (see Prob-
lem 4.19). Needless to say, the simulated impedances can be no better than the
resistances, capacitances, and op amps utilized in their simulation. For good results,
use metal-ﬁlm resistors and NPO ceramic capacitors for temperature stability and
polypropylene capacitors for high-Q performance. And use a dual op amp with
sufﬁciently fast dynamics (see Section 6.6).

188
CHAPTER 4
Active Filters:
Part II
R2
C1
R5
+
–
OA1
R4
C3
+
–
OA2
⇒
D
C1R2C3R4
R5
A
A
D =
FIGURE 4.16
Alternative D-element realization.
Synthesis Using Grounded Inductances
A popular GIC application is the realization of inductorless ﬁlters starting from pas-
sive RLC ﬁlter prototypes. To this end we ﬁrst design an RLC ﬁlter meeting the given
speciﬁcations; then we replace its inductances with synthetic inductances realized
with GICs. Note, however, that this direct one-to-one replacement is applicable only
if the inductances in the prototype are of the grounded type.
A classic example is offered by the band-pass prototype of Fig. 4.17a. This is
a band-pass ﬁlter because low-frequency signals are shunted by L, high-frequency
signals are shunted by C, and intermediate-frequency signals are passed because
of resonance. Once the ﬁlter speciﬁcations are known, we ﬁrst ﬁnd a set of RLC
values meeting the speciﬁcation; then we replace the original inductance with a
GIC inductance simulator to end up with a circuit containing only resistances and
capacitances. The result is the dual-ampliﬁer band-pass (DABP) ﬁlter of Fig. 4.17b.
EXAMPLE 4.8.
In the circuits of Fig. 4.17 specify component values for a band-pass
response with f0 = 100 kHz and Q = 25.
Solution.
The
RLC
prototype
gives
Vo/Vi = (ZC ∥ZL)/(R + ZC ∥ZL), ZC =
1/( jωC), ZL = jωL. Expanding and collecting gives Vo/Vi = HBP, with
ω0 = 1/
√
LC
Q = R

C/L
Let C = 1.0 nF, so L = 1/[(2π f0)2C] = 1/[(2π105)2 × 10−9] = 2.533 mH and R =
Q(L/C)1/2 = 25(2.533 × 10−3/10−9)1/2 = 39.79 k. Next, specify the components
for the GIC. To simplify inventory, use equal capacitances and equal resistances. Thus,
C2 = 1.0 nF. Moreover, using Eq. (4.11b), we get R1 = R3 = R4 = R5 = (L/C2)1/2 =
(2.533 × 10−3/10−9)1/2 = 1.592 k.

189
SECTION 4.3
Generalized
Impedance
Converters
R
R
R1
R3
R4
R4
R5
R5
+
Vi
L
C
+
Vi
C
C2
Vo
Vo
+
–
OA2
OA1
+
–
+
–
Vo
1 +      
(a)
(b)
FIGURE 4.17
(a) Passive band-pass ﬁlter prototype and (b) active realization using an inductance simulator.
We observe that the node designated as Vo in Fig. 4.17b is prone to external
loading. This can be avoided by using the response from the low-impedance output
of OA2, where it is available with a gain of 1 + R4/R5. With equal resistances, this
gain is 2 V/V. If unity gain is desired, replace R with a voltage divider, in the manner
of Example 3.9.
Using L as given in Eq. (4.11b), we have ω0 = √R4/R1R3R5C2C and Q =
R√R4C/R1R3R5C2, so the sensitivities are
Sω0
R1 = Sω0
C2 = Sω0
R3 = −Sω0
R4 = Sω0
R5 = Sω0
C = −1/2
SQ
R = 1
SQ
R1 = SQ
C2 = SQ
R3 = −SQ
R4 = SQ
R5 = −SQ
C = −1/2
These fairly low values are typical of ﬁlters based on the ladder simulation approach.
If the circuit is implemented with C2 = C and R5 = R4 = R3 = R1, then ω0 = 1/RC
and Q = R/R1. This resistance spread compares quite favorably with that of the
multiple-feedback band-pass ﬁlter, which is 4Q2. Moreover, the DABP ﬁlter is easily
tuned since R1 (or R3) adjusts ω0, and R adjusts Q. Even though the circuit uses
two op amps instead of one, it has been proved6 that if their open-loop frequency
characteristics are matched, as is usually the case with dual packages, the op amps
tend to compensate for each other’s deﬁciencies, resulting in fairly small deviations
of Q and ω0 from their design values. Owing to these advantages, the DABP ﬁlter
is a highly recommended conﬁguration.
Synthesis Using FDNRs
As an example of active ﬁlter synthesis using FDNRs, consider the RLC ﬁlter of
Fig. 4.18a. Low-frequency signals make L a short circuit and C an open, so these

190
CHAPTER 4
Active Filters:
Part II
R
+
Vi
L
C
+
–
Vo
(a)
R–1
+
Vi
D
L
+
–
Vo
(b)
⇒
FIGURE 4.18
Low-pass RLC ﬁlter prototype and its CRD equivalent.
signals are passed. High-frequency signals make L an open and C a short, so they
are rejected twice, indicating a second-order low-pass response. Since L is not a
grounded inductance, we cannot replace it with a simulated one. This obstacle is
avoided by the artiﬁce7 of dividing each element value in the original network by
jω. This transforms resistances into capacitances, inductances into resistances, and
capacitances into D elements as
R
jω →
1
jωR−1
(capacitance of value R−1)
(4.13a)
jωL
jω →L
(resistance of value L)
(4.13b)
1/jωC
jω
→−
1
ω2C
(D element of value C)
(4.13c)
The transformed network is shown in Fig. 4.18b. It can be proven3 that dividing
all the impedances of a network by the same factor yields a modiﬁed network with
the same transfer function as the original one. Consequently, the modiﬁed circuit
of Fig. 4.18b not only retains the original response, but is also realizable with a
GIC since the transformation has eliminated the ﬂoating inductance while creating
a grounded D element, which is amenable to GIC simulation.
EXAMPLE 4.9.
Using the RLC circuit of Fig. 4.18a as a prototype, design a GIC
low-pass ﬁlter with f0 = 1 kHz and Q = 5.
Solution.
The transformed circuit of Fig 4.18b gives, by the voltage divider for-
mula, Vo/Vi = (−1/ω2C)/(1/jωR−1 + L −1/ω2C) = 1/(1−ω2LC + jωRC) = HLP,
where
ω0 = 1/
√
LC
Q =

L/C/R
Let the capacitance denoted as R−1 be 100 nF. Since Qω0 = 1/RC, the value of the
D element is R−1/Qω0 = (100 × 10−9)/(5 × 2π × 103) = 10−11/π s2/. Finally,
the resistance denoted as L is 1/ω2
0C = 1/[(2π × 103)2 × 10−11/π] = 7.958 k (use
8.06 k, 1%).
Next, specify the components of the GIC, using equal components to simplify
inventory. Let C1 = C2 = 10 nF. By Eq. (4.12b), R2 = R3 = R4 = D/C2C5 = (10−11/π)/
(10−8)2 = 31.83 k (use 31.6 k, 1%). The circuit is shown in Fig. 4.19.

191
SECTION 4.4
Direct Design
1 MΩ
31.6 kΩ
8.06 kΩ
31.6 kΩ
31.6 kΩ
10 nF
10 nF
0.1 μF
+
Vi
Vo
+
–
OA2
OA1
+
–
FIGURE 4.19
Low-pass ﬁlter using an FDNR.
Remark. In order to provide a dc path for the tiny inverting-input bias current of OA2, a
resistive termination is required. This is performed by the 1-M resistance, whose large
value will have little effect on ﬁlter performance over the frequency range of interest.
A good choice for the op amps is a FET-input dual op amp. To avoid output loading, a
buffer can be used.
4.4
DIRECT DESIGN
The interstage isolation properties of cascaded ﬁlters, while desirable from the view-
point of modularity, render the overall response particularly sensitive to individual-
stage parameter variations stemming from tolerance, thermal drift, and aging. Of
special concern are the high-Q stages, where even a small component variation in
a single stage may drastically alter the response of the entire cascade. On the other
hand, it has long been recognized that RLC ﬁlters of the doubly terminated ladder
type enjoy the lowest sensitivities to component variations. The ladder structure is a
tightly coupled system in which sensitivity is spread out over its elements as a group
rather than being conﬁned to speciﬁc ones. Sensitivity considerations, together with
the wealth of knowledge available in the area of passive RLC network synthesis,
provide the motivation for the ladder simulation approach.
The starting point is a passive RLC ladder prototype, which is designed using
suitable ﬁlter tables or computer programs. The ﬁlter is then realized in active form
by replacing its inductors with simulated ones, that is, with active circuits speciﬁcally
designed to simulate inductance behavior. The resulting active network retains the
low-sensitivity advantages of its RLC prototype, a feature that makes it suited to
applications with stringent speciﬁcations.
Figure 4.20 shows the general form of a doubly terminated, series-resonant
RLC ladder, one of the most frequently used RLC prototypes in active ﬁlter synthe-
sis. Physically, its behavior is explained as follows. At low frequencies, where the

192
CHAPTER 4
Active Filters:
Part II
R
+
+
–
Vo
L1
L3
L5
L7
L8
C8
L6
C6
L4
C4
L2
Vi
C2
Ln
R
FIGURE 4.20
Doubly terminated series-resonant RLC ladder.
inductances act as shorts and the capacitances as opens, the ladder provides a direct
signal path from input to output. Low-frequency signals are thus passed, and the dc
gain is R/(R + R) = 1/2 V/V.
At high frequencies, where the capacitances act as shorts, the ladder becomes
predominantly inductive and, as such, it presents considerable impedance to signal
propagation. Thus, high-frequency signals are attenuated.
At intermediate frequencies, due to the series resonance of the LC elements in
each leg, the response exhibits a series of notches, one for each leg. Consequently, the
ladder provides a low-pass response with notches, or an elliptic low-pass response.
The order n of the response is twice the number of legs plus 1, that is, n is odd. If the
rightmost inductance is eliminated, then n is decreased by 1 and becomes even. Sup-
pressing the inductances in the ladder legs eliminates the resonances and therefore
the stopband notches. This reduced ladder version, referred to as all-pole ladder, can
then be used to synthesize the Butterworth, Chebyshev, or Bessel responses.
The individual element values are tabulated in ﬁlter handbooks8 or can be cal-
culated by computer.9 Table 4.2 shows an example of tabulated data. Element values
are normalized for a cutoff frequency of 1 rad/s and 1 ; however, they are readily
adapted to actual frequencies by dividing all reactive elements by the desired cutoff
frequency ωc of the ﬁlter.
Low-Pass Filter Design
As is, the ladder of Fig. 4.20 is not amenable to GIC simulation because it contains
ﬂoating inductances. This obstacle is overcome by applying the 1/jω transformation
discussed in Section 4.3, after which the resistances are changed to capacitances, the
inductances to resistances, and the capacitances to D elements. The resulting CRD
structure is then simulated with grounded FDNRs.
In addition to applying the 1/jω transformation, we must also frequency-
scale the normalized ladder elements to achieve the desired cutoff frequency, and
impedance-scale the resulting elements to obtain practical values in the ﬁnal circuit.
The three steps can be carried out at once via the following transformations:3
Cnew = 1/kz Rold
(4.14a)
R j(new) = (kz/ωc)L j(old)
(4.14b)
D j(new) = (1/kzωc)C j(old)
(4.14c)
where j = 1, 2, . . . , n. Here the element values of the RLC prototype are referred
to as old, those of the transformed RCD network as new, ωc is the desired cutoff

193
SECTION 4.4
Direct Design
TABLE 4.2
Element values for doubly terminated Butterworth and Chebyshev low-pass ﬁlters
Butterworth low-pass element values (1-rad/s bandwidth)
n
L1
C2
L3
C4
L5
C6
L7
C8
L9
C10
2
1.414
1.414
3
1.000
2.000
1.000
4
0.7654
1.848
1.848
0.7654
5
0.6180
1.618
2.000
1.618
0.6180
6
0.5176
1.414
1.932
1.932
1.414
0.5176
7
0.4450
1.247
1.802
2.000
1.802
1.247
0.4450
8
0.3902
1.111
1.663
1.962
1.962
1.663
1.111
0.3902
9
0.3473
1.000
1.532
1.879
2.000
1.879
1.532
1.000
0.3473
10
0.3129
0.9080
1.414
1.782
1.975
1.975
1.782
1.414
0.9080
0.3129
Chebyshev low-pass element values (1-rad/s bandwidth)
n
L1
C2
L3
C4
L5
C6
L7
C8
R2
0.1-dB ripple
2
0.84304
0.62201
0.73781
3
1.03156
1.14740
1.03156
1.00000
4
1.10879
1.30618
1.77035
0.81807
0.73781
5
1.14681
1.37121
1.97500
1.37121
1.14681
1.00000
6
1.16811
1.40397
2.05621
1.51709
1.90280
0.86184
0.73781
7
1.18118
1.42281
2.09667
1.57340
2.09667
1.42281
1.18118
1.00000
8
1.18975
1.43465
2.11990
1.60101
2.16995
1.58408
1.94447
0.87781
0.73781
0.5-dB ripple
3
1.5963
1.0967
1.5963
1.0000
5
1.7058
1.2296
2.5408
1.2296
1.7058
1.0000
7
1.7373
1.2582
2.6383
1.3443
2.6383
1.2582
1.7373
1.0000
1.0-dB ripple
3
2.0236
0.9941
2.0236
1.0000
5
2.1349
1.0911
3.0009
1.0911
2.1349
1.0000
7
2.1666
1.1115
3.0936
1.1735
3.0936
1.1115
2.1666
1.0000
frequency, and kz is an appropriate impedance-scaling factor to be chosen on the
basis of the desired impedance levels in the ﬁnal circuit.
EXAMPLE 4.10. Figure 4.21 (top) shows a ladder prototype suitable for the GIC realiza-
tion of a sharp-cutoff smoothing ﬁlter for audio D/A converters.10 The ladder provides
a seventh-order Cauer low-pass response with Amax = 0.28 dB and Amin = 60 dB at
fs = 1.252 fc. Design an FDNR implementation with fc = 15 kHz.
Solution.
First convert the normalized RLC prototype to a CRD network. Let us ar-
bitrarily decide to use 1-nF capacitances throughout. Since the 1- resistances must
change to 1-nF capacitances, Eq. (4.14a) gives kz = 1/10−9 = 109.
By Eq. (4.14b), R1(new) = L1(old) × 109/(2π × 15 × 103) = 1.367 × 10,610 =
14.5 k, and R2(new) = 0.1449 × 10,610 = 1.54 k; by Eq. (4.14c), D2(new) = C2(old)/
(109 × 2π × 15 × 103) = 1.207 × 1.061 × 10−14 = 1.281 × 10−14 s2/. Applying
similar transformations to the other elements, we end up with the CRD network of
Fig. 4.21 (center).

194
CHAPTER 4
Active Filters:
Part II
16.9 kΩ
11.5 kΩ
R
Vi
L2
0.1449 H
C2
1.207 F 
1 Ω
C
1 nF 
1 nF 
L4
0.7231 H
C4
0.8560 F 
L6
0.5055 H
C6
0.9143 F 
R
1 Ω
L1
1.367 H
L3
1.785 H
L5
1.579 H
L7
1.096 H
+
+
–
Vo
R1
Vi
14,504 Ω
14.3 kΩ
18.7 kΩ
1 MΩ
R3
18,939 Ω
R5
16,753 Ω
C
1 nF
+
+
–
Vo
Vo
R7
11,629 Ω
R2
1,537 Ω
D2
1.281 × 10–14
R4
7,672 Ω
D4
9.082 × 10–15
R6
5,364 Ω
D6
9.7 × 10–15
Vi
+
+
–
1 nF 
1.54 kΩ
12.7 kΩ
+
–
1 nF 
10 kΩ
10 kΩ
+
–
1 nF 
1 nF 
7.68 kΩ
9.09 kΩ
+
–
1 nF 
10 kΩ
10 kΩ
+
–
1 nF 
5.36 kΩ
1.06 MΩ
9.76 kΩ
+
–
1 nF 
10 kΩ
10 kΩ
+
–
FIGURE 4.21
Seventh-order 0.28/60-dB elliptic low-pass ﬁlter of Example 4.10. Top: normalized RLC
prototype; center: CRD equivalent, with D-element values in square seconds per ohm; and
bottom: active realization using FDNRs.

195
SECTION 4.4
Direct Design
Finally, we ﬁnd the elements in the FDNRs. Let us use the FDNRs of Fig. 4.16 with
R4 = R5 = 10 k. Then, Eq. (4.12b) gives, for the leftmost FDNR, R2 = D/C2 =
1.281 × 10−14/(10−9)2 = 12.81 k (use 12.7 k, 1%). We similarly calculate the
remaining FDNRs and end up with the realization of Fig. 4.21 (bottom), where the
resistances have been rounded off to 1% standard values.
Note again the use of the 1-M resistance at the input end to provide a dc path for
the op amps. To ensure a dc gain of 1
2 V/V, this resistance must be counterbalanced by a
1.061-M resistance at the output. To avoid loading problems, an output buffer is used.
The FDNRs can be implemented with dual FET-input op amps. If desired, each FDNR
can be tuned by adjusting one of its resistances.
High-Pass Filter Design
The ladder network of Fig. 4.20, though of the low-pass type, can also serve as a
prototypeforhigh-passﬁltersprovidedwereplacetheinductanceswithcapacitances,
the capacitances with inductances, and use reciprocal element values to maintain
frequency normalization at 1 rad/s. The transformed network provides a response
with characteristics reciprocal to the original one, that is, a Cauer high-pass response
with a cutoff frequency of 1 rad/s and with notches located at reciprocal positions of
the low-pass prototype. Suppressing the capacitances in the legs of the transformed
ladder eliminates the stopband notches. This reduced ladder can then be used to
synthesize the Butterworth, Chebyshev, or Bessel responses.
In either case, the inductances of the transformed ladder are of the grounded
type and as such can be simulated with GICs. After the low-pass to high-pass trans-
formation, the elements must be frequency-scaled to the desired cutoff frequency
and impedance-scaled to practical impedance levels. The three steps can be carried
out at once via the following transformations:3
Rnew = kz/Rold
(4.15a)
C j(new) = 1/(kzωcL j(old))
(4.15b)
L j(new) = kz/(ωcC j(old))
(4.15c)
where the meaning of the notation is similar to Eq. (4.14).
EXAMPLE 4.11.
Design an elliptic high-pass ﬁlter with fc = 300 Hz, fs = 150 Hz,
Amax = 0.1 dB, and Amin = 40 dB.
Solution.
Using standard ﬁlter tables8 or ﬁlter-design computer programs,9 it is found
that the speciﬁcations can be met with a ﬁfth-order ﬁlter whose low-pass prototype has
the element values of Fig. 4.22 (top). The actual attenuation at the edge of the stopband
is A( fs) = 43.4 dB.
Let us arbitrarily impose Rnew = 100 k, so kz = 105, by Eq. (4.15a). Using
Eq. (4.15b), C1(new) = 1/(105 × 2π × 300 × 1.02789) = 5.161 nF. Using Eq. (4.15c),
L2(new) = 105/(2π × 300 × 1.21517) = 43.658 H. Applying similar transformations to
the other elements, we end up with the high-pass ladder of Fig. 4.22 (center).
Finally, we ﬁnd the elements in the GICs. Let C = 10 nF and impose equal resis-
tances. Then, Eq. (4.11) requires, for the leftmost GIC, R1 = R3 = R4 =R5 = √L/C =

43.658/10−8 = 66.07 k. Likewise, the resistances for the other GIC are found to be
75.32k.TheﬁnalcircuitisshowninFig.4.22(bottom),wheretheresistanceshavebeen
rounded off to 1% standard values. To avoid output loading, a voltage buffer can be used.

196
CHAPTER 4
Active Filters:
Part II
R
Vi
L2
0.15134 H
C2
1.21517 F 
1 Ω
L4
0.44083 H
C4
0.93525 F 
R
1 Ω
L1
1.02789 H
+
+
–
Vo
L3
1.63179 H
L5
0.81549 H
R
Vi
L2
43.658 H
C2
35.05 nF 
100 kΩ
L4
56.724 H
C4
12.03 nF 
R
100 kΩ
+
+
–
Vo
Vo
C3
3.251 nF
C1
5.161 nF
Vi
5.161 nF
+
6.505 nF
3.251 nF
C5
6.505 nF
100 kΩ
66.5 kΩ
100 kΩ
66.5 kΩ
66.5 kΩ
66.5 kΩ
10 nF
35.05 nF
+
–
+
–
75.0 kΩ
75.0 kΩ
75.0 kΩ
75.0 kΩ
10 nF
12.03 nF
+
–
+
–
FIGURE 4.22
Fifth-order 0.1/40-dB elliptic high-pass ﬁlter of Example 4.11. Top: normalized RLC proto-
type; center: high-pass equivalent; and bottom: active realization using simulated inductances.

197
SECTION 4.5
The Switched
Capacitor
4.5
THE SWITCHED CAPACITOR
The ﬁlters investigated so far, known as continuous-time ﬁlters, are characterized by
the fact that H0 and Q are usually controlled by component ratios and ω0 is controlled
bycomponentproducts.Thoughratioscaneasilybemaintainedwithtemperatureand
time by using devices with adequate tracking capabilities, products are inherently
more difﬁcult to control. Moreover, IC processes do not lend themselves to the
fabrication of resistances and capacitances with the magnitudes (103 to 106  and
10−9 to 10−6 F) and accuracies (1% or better) typically required in audio and
instrumentation applications.
If ﬁlter functions are to coexist with digital functions on the same chip, ﬁlters
must be realized with the components that are most natural to VLSI processes,
namely, MOS transistors and small MOS capacitors. This constraint has led to the
development of switched-capacitor (SC) ﬁlters,11–13 which simulate resistors by
periodically operating MOS capacitors with MOSFET switches, and produce time
constants that depend on capacitance ratios rather than R-C products.
To illustrate, let us start with the basic MOSFET-capacitor arrangement of
Fig. 4.23a. The transistors are n-channel enhancement types, characterized by a
low channel resistance (typically <103 ) when the gate voltage is high, and a
high resistance (typically >1012 ) when the gate voltage is low. With an off/on
ratio this high, a MOSFET can be regarded for all practical purposes as a switch.
If the gates are driven with nonoverlapping out-of-phase clock signals of the type
in Fig. 4.23b, the transistors will conduct on alternate half cycles, thus providing a
single-pole double-throw (SPDT) switch function with break-before-make charac-
teristics.
Referring to the symbolic switch representation of Fig. 4.24a and assuming
V1 > V2, we observe that ﬂipping the switch to the left charges C to V1, and ﬂipping
it to the right discharges C to V2. The net charge transfer from V1 to V2 is Q =
C(V1 −V2). If the switch is ﬂipped back and forth at a rate of fCK cycles per
second, the charge transferred in 1 second from V1 to V2 deﬁnes an average current
Iavg = fCK × Q, or
Iavg = C fCK(V1 −V2)
(4.16)
+
V1
C
V2
+
φ
φ
φ
φ
t
t
(a)
(b)
FIGURE 4.23
Switched capacitor using a MOSFET SPDT switch, and clock
drive for the MOSFETs.

198
CHAPTER 4
Active Filters:
Part II
⇒
Req
+
V1
C
V2
+
+
V1
V2
+
Iavg
(a)
(b)
FIGURE 4.24
Resistance simulation using a switched capacitor.
Note that charge is ﬂowing in packets rather than continuously. However, if fCK is
made sufﬁciently higher than the highest-frequency components of V1 and V2, the
process can be regarded as continuous, and the switch-capacitor combination can be
modeled with an equivalent resistance
Req = V1 −V2
Iavg
=
1
C fCK
(4.17)
The model is depicted in Fig. 4.24b. Let us investigate how such a resistance can
be used to implement, what by now has proved to be the workhorse of active ﬁlters,
namely, the integrator.
SC Integrators
As we know, the RC integrator of Fig. 4.25a yields H( jω) = −1/( jω/ω0), where
the unity-gain frequency is given by
ω0 =
1
R1C2
(4.18)
Replacing R1 by an SC resistance gives the SC integrator of Fig. 4.25b. If the input
frequency ω is such that
ω ≪ωCK
(4.19)
⇒
+
Vi
(a)
(b)
+
–
Vo
+
Vi
C1
C2
C2
R1
+
–
Vo
FIGURE 4.25
Converting an RC integrator to an SC integrator.

199
SECTION 4.5
The Switched
Capacitor
where ωCK = 2π fCK, then current ﬂow from Vi to the summing node can be regarded
as continuous, and ω0 is found by substituting Req into Eq. (4.18),
ω0 = C1
C2
fCK
(4.20)
This expression reveals three important features that hold for SC ﬁlters in general,
not just for SC integrators:
1. There are no resistors. This is highly desirable from the viewpoint of IC fabrica-
tion, since monolithic resistors are plagued by large tolerances and thermal drift,
and also take up precious chip area. Switches, on the other hand, are implemented
with MOSFETs, which are the basic ingredients of VLSI technology and occupy
very little chip area.
2. The characteristic frequency ω0 depends on capacitance ratios, which are much
easier to control and maintain with temperature and time than R-C products. With
present technology, ratio tolerances as low as 0.1% are readily achievable.
3. The characteristic frequency ω0 is proportional to the clock frequency fCK, indi-
cating that SC ﬁlters are inherently of the programmable type. Varying fCK will
shift the response up or down the frequency spectrum. If, on the other hand, a
ﬁxed and stable characteristic frequency is desired, fCK can be generated with a
quartz crystal oscillator.
Equation (4.20) also shows that by judicious choice of the values of fCK and the
C1/C2 ratio, it is possible to avoid undesirably large capacitances even when low val-
ues of ω0 are desired. For instance, with fCK = 1 kHz, C1 = 1 pF, and C2 = 15.9 pF,
the SC integrator gives f0 = (1/2π)(1/15.9)103 = 10 Hz. An RC integrator with the
same f0 could be implemented, for instance, with R1 = 1.59 M and C2 = 10 nF.
Fabricating these components monolithically and maintaining the value of their
product within 0.1% would be unrealistic. Current SC ﬁlters use capacitances in the
range of 0.1 pF to 100 pF, with the 1-pF to 10-pF range being the most common. The
upper limit is dictated by die area considerations, and the lower limit by parasitic
capacitances of the SC structure.
To minimize the effect of parasitic capacitances and also increase circuit ver-
satility, practical SC integrators are implemented with SPDT switch pairs, in the
manner of Fig. 4.26. In Fig. 4.26a, ﬂipping the switches down discharges C1 to
zero, and ﬂipping the switches up charges C1 to Vi. Current will thus ﬂow into the
summing junction of the op amp if Vi > 0, and out if Vi < 0, indicating that the
integrator is of the inverting type.
+
–
+
Vi
Vo
C1
C2
(a)
+
–
+
Vi
Vo
C1
C2
(b)
FIGURE 4.26
Inverting and noninverting SC integrators.

200
CHAPTER 4
Active Filters:
Part II
Changing the phase of one of the switches yields the circuit of Fig. 4.26b. With
the switches in the positions shown, the left plate of C1 is at Vi and the right plate at
0 V. Commutating both switches will discharge C1 to 0 V, thus pulling charge out of
the summing junction if Vi > 0, and pushing current into the junction if Vi < 0. A
simple phase rewiring of the two MOSFETs making up one of the switches inverts
the direction of Iavg, resulting in an SC integrator of the noninverting type. We shall
exploit the availability of this type of integrator in the next sections.
Practical Limitations of SC Filters
There are some important limitations that we need be aware of when applying
SC ﬁlters.11 First, there are limits on the permissible range of fCK. The upper
limit is dictated by the quality of the MOS switches and the speed of the op amps.
Taking 10 pF as a typical switched capacitance and 1 k as a typical resistance of
a closed MOS switch, we observe that the time constant is on the order of 103 ×
10−11 = 10 ns. Considering that to charge a capacitance to within 0.1% of its ﬁnal
voltage takes about seven time constants (e−7 ∼= 10−3), it follows that the minimum
time interval between consecutive switch commutations is on the order of 102 ns.
This also happens to be the typical time it takes for the step response of a MOS op
amp to settle within 0.1% of its ﬁnal value. Consequently, the upper limit for fCK
is in the megahertz range.
The lower practical limit for fCK is dictated by the leakage of open MOS
switches and the input bias currents of op amps, both of which tend to discharge the
capacitors and, hence, to destroy the accumulated information. At room temperature
these currents are in the picoampere range. Assuming a maximum acceptable droop
of 1 mV across a capacitor of 10 pF, we have fCK ≥(1 pA)/[(10 pF) × (1 mV)] =
102 Hz.Insummary,thepermissibleclockrangeistypically102 Hz < fCK < 106 Hz.
The other important limitation of SC ﬁlters stems from their discrete-time rather
than continuous-time operation. This is evidenced in Fig. 4.27, which shows the
vo
0TCK
1TCK
2TCK
3TCK
t
vi
t
t
φ
t
φ
FIGURE 4.27
Noninverting SC integrator waveforms.

201
SECTION 4.5
The Switched
Capacitor
input and output waveforms for the noninverting integrator of Fig. 4.26a. Time has
been divided into equal intervals according to the clock period TCK. Referring to
the actual circuit, we observe that φ pulses charge C1 to vi, while ¯φ pulses pull
the charge accumulated in C1 out of C2, causing a step increase in vo. Because of
nonzero switch resistance, this step is gradual.
Letting n denote an arbitrary clock period, we have vo[nTCK] = vo[(n −1)
TCK] + Q[(n −1)TCK]/C2, or
vo[nTCK] = vo[(n −1)TCK] + C1
C2
vi[(n −1)TCK]
(4.21)
where Q[(n −1)TCK] = C1vi[(n −1)TCK] denotes the charge accumulated by
C1 during the previous φ pulse. Equation (4.21) represents a discrete time sequence
relating input and output values, which have been emphasized with dots. A well-
known Fourier transform property states that delaying a signal by one clock period
TCK is equivalent to multiplying its Fourier transform by exp(−jωTCK). Taking the
Fourier transforms of both sides of Eq. (4.21) gives
Vo( jω) = Vo( jω)e−jωTCK + C1
C2
Vi( jω)e−jωTCK
(4.22)
Collecting, solving for the ratio H( jω) = Vo( jω)/Vi( jω), and using Euler’s iden-
tity sin α = (eα −e−α)/2 j, we ﬁnally obtain the exact transfer function of the SC
noninverting integrator,
H( jω) =
1
jω/ω0
×
πω/ωCK
sin(πω/ωCK) × e−jπω/ωCK
(4.23)
where ω0 = (C1/C2) fCK and ωCK = 2π/TCK = 2π fCK.
We observe that in the limit ω/ωCK →0 we obtain the familiar integrator
function H( jω) = 1/( jω/ω0), conﬁrming that as long as ωCK ≫ω, the SC process
can be regarded as a continuous-time process. Writing H( jω) = [1/( jω/ω)]×ϵm ×
exp(−jϵφ) indicates that in general the SC process introduces a magnitude error
ϵm = (πω/ωCK)/[sin(πω/ωCK)] and a phase error ϵφ = −πω/ωCK. The effect of
these errors is illustrated in the linear plots of Fig. 4.28 for a noninverting integrator
with ω0 = ωCK/10.
The ideal magnitude and phase responses are |H| = 1/(ω/ω0) and <)H = −90◦.
The SC integrator deviation increases with ω until, for ω = ωCK, the magnitude
error becomes inﬁnite and phase undergoes polarity reversal. These results are con-
sistent with well-known sampled-data principles, stating that the effect of sampling a
function of time at the rate of fCK samples per second is a replication of its frequency
spectrum at integral multiples of fCK.
For ω ≪ωCK, the effect of the magnitude error is similar to the effect of
component tolerance or drift in ordinary RC integrators. As such, it may not be
detrimental, especially if the performance requirements are not stringent. To contain
this error within tolerable limits, the useful frequency range is limited to a couple of
decades below ωCK.
The effect of the phase error, however, is critical since it may cause Q enhance-
ment or even instability. One method of compensating for this error is by alternating
the clock phasing of consecutive integrators,11 as we shall see in Section 4.6.

202
CHAPTER 4
Active Filters:
Part II
|H|
<) H
0
1
2
0
.1
.2
.3
.4
.5
SC integrator
.6
.7
.8
.9
1.0
Ideal integrator
–180°
–270°
–90°
0°
Noninverting
SC integrator
Ideal
noninverting
integrator
.1
.2
.3
.4
.5
.6
.7
.8
.9
1.0
ω/ωCK
ω
ω
ω/ωCK
ω
ω
FIGURE 4.28
Magnitude and phase responses of a noninverting SC integra-
tor for the case ω0 = ωCK/10.
4.6
SWITCHED-CAPACITOR FILTERS
Switched-capacitor ﬁlters are based on the integrator conﬁgurations of the previous
section. As in the case of continuous-time ﬁlters, two popular approaches to SC ﬁlter
synthesis are the cascade approach and the ladder simulation approach.
Dual-Integrator-Loop Filters
A dual-integrator-loop SC ﬁlter can be synthesized by replacing the resistors of
a continuous-time prototype with SC equivalents. Figure 4.29 shows the SC im-
plementation of the popular biquad topology of Fig. 3.36. Here OA2 is a lossless
noninverting integrator, a function that requires only one op amp when implemented
in SC form. We thus have, for ω ≪ωCK,
VLP =
1
jω/ω0
VBP
where ω0 = (C1/C2) fCK, by Eq. (4.20). The op amp OA1 forms a lossy inverting
integrator, whose equivalent feedback resistance, simulated by C3 and the associated
switch, sets the value of Q. By Eq. (4.17), this resistance is RQ = 1/(C3 fCK). With
the input switches in the position shown, the leftmost capacitance C1 is charged to
VLP −Vi. Flipping the switches down transfers the charge Q = C1(VLP −Vi)

203
SECTION 4.6
Switched-
Capacitor
Filters
Vi
VBP
VLP
C1
C2
C3
+
C1
C2
+
–
OA1
+
–
OA2
FIGURE 4.29
SC biquad ﬁlter.
into the summing junction of OA1, so the corresponding average current is I1 =
C1 fCK(VLP −Vi). Summing currents at this junction gives, for ω ≪ωCK,
C1 fCK(VLP −Vi) + C3 fCKVBP + jωC2VBP = 0
Substituting VLP = VBP/( jω/ω0) and collecting gives VBP/Vi = H0BPHBP and
VLP/Vi = H0LPHLP, where HLP and HBP are the standard second-order low-pass
and band-pass responses, and
ω0 = C1
C2
fCK
Q = C1
C3
H0BP = Q
H0LP = 1 V/V
(4.24)
EXAMPLE 4.12.
Assuming fCK = 100 kHz in the circuit of Fig. 4.29, specify suitable
capacitances for a Butterworth low-pass response with f0 =1 kHz and a total capacitance
of 100 pF or less.
Solution.
We have C2/C1 = fCK/(2π f0) = 15.9 and C3/C1 = 1/Q =
√
2. Choose
C1 = 1 pF, C2 = 15.9 pF, and C3 = 1.41 pF.
The realization of Fig. 4.29 is by no means unique, nor is it necessarily the
best. In fact (see Problem 4.30), its capacitance spread increases with Q to the point
of making this arrangement unfeasible. Figure 4.30 shows an SC realization with
Vi
+
–
OA1
VHP
VBP
C1
C3
C2
C3
C2
C1
+
–
OA2
+
FIGURE 4.30
SC biquad ﬁlter with improved capacitance spread.

204
CHAPTER 4
Active Filters:
Part II
improved capacitance ratios. The circuit uses an integrator/summer and a noninvert-
ing integrator to provide the band-pass and high-pass responses. It can be proved
(see Problem 4.31) that
ω0 = C3
C2
fCK
Q = C2
C1
H0BP = −1 V/V
H0HP = −1
Q
(4.25)
In the next section we investigate the cascade design of higher-order ﬁlters using
dual-integrator loops, an approach that is particularly attractive when ﬁlter speciﬁ-
cations are not too stringent. For low-sensitivity applications, the direct synthesis
methods discussed next are preferable.
Ladder Simulation
Direct SC ﬁlter synthesis uses SC integrators to simulate passive RLC ladders. Since
it retains the low-sensitivity advantages of ladders, this approach is preferable when
ﬁlter speciﬁcations are more stringent. One of the most frequently used structures
is the doubly terminated all-pole ladder of Fig. 4.31, which can be conﬁgured for
Butterworth, Chebyshev, or Bessel responses, the order n coinciding with the num-
ber of reactive elements present. As we know, the required component values are
tabulated in ﬁlter handbooks or can be calculated by computer.
We observe that the ladder is a repetitive structure of LC pairs of the type of
Fig. 4.32a. The inductance current is
Ik−1 = Vk−1 −Vk
jωLk−1
SC integrators are inherently voltage-processing blocks, so to make the above func-
tion amenable to SC implementation, we use the artiﬁce of multiplying both sides by
a scaling resistance Rs, which converts the current Ik−1 to a voltage V ′
k−1 = Rs Ik−1,
or
V ′
k−1 =
1
jω/ωLk−1
(Vk−1 −Vk)
ωLk−1 =
1
Lk−1/Rs
This integration is implemented with an L-integrator of the type also shown in
Fig. 4.32b. By Eq. (4.20), its capacitances must satisfy C0/CLk−1 = ωLk−1, or
CLk−1/C0 = (Lk−1/Rs) fCK
(4.26)
Next consider the capacitance Ck, whose voltage is
Vk =
1
jωCk
(Ik−1 −Ik)
Ro
C3
C1
C5
+
Vi
Ri
L2
L4
+
–
Vo
FIGURE 4.31
Doubly terminated all-pole RLC ladder.

205
SECTION 4.6
Switched-
Capacitor
Filters
+
–
+
–
Ik–1
Ik
Ck
Ik–1– Ik
Vk–1
Vk–1
V'k–1
V'k
Vk
Vk
Lk–1
L
C
CLk–1
C0
CCk
C0
(a)
(b)
FIGURE 4.32
LC ladder section and its realization in SC form.
Multiplying numerator and denominator by Rs to convert the currents Ik−1 and Ik
to the voltages V ′
k−1 = Rs Ik−1 and V ′
k = Rs Ik, we obtain
Vk =
1
jω/ωCk
(V ′
k−1 −V ′
k)
ωCk =
1
RsCk
This integration is implemented with a C-integrator of the type also shown in
Fig. 4.32b. By Eq. (4.20), its capacitances must satisfy C0/CCk = ωCk, or
CCk/C0 = RsCk fCK
(4.27)
We thus conclude that if the conditions of Eqs. (4.26) and (4.27) are met, the SC
integrators of Fig. 4.32b will simulate the LC pair of Fig. 4.32a. The by-product
variables V ′
k−1 and V ′
k need not concern us as they are internal to the circuit.
To complete the ladder simulation, we also need SC equivalents of the termi-
nating resistors. This is readily achieved by making the ﬁrst and last SC integrators
of the lossy type. Denoting the capacitances simulating these resistances as CRi and
CRo, we have
CRi/C0 = Ri/Rs
CRo/C0 = Ro/Rs
(4.28)
For simplicity we can let Ri = Ro = Rs = 1 , after which we get CRi = CRo = C0.
Asanexample,Fig.4.33showsaﬁfth-orderlow-passSCﬁlter.Sincetheleftmost
reactive element in the ladder prototype is a capacitance, the leftmost integrator is
a C-integrator. The rightmost integrator is either a C-integrator or an L-integrator,
depending on whether the order n of the ﬁlter is odd (as in the example) or even.
Moreover, the leftmost and rightmost integrators must be of the lossy type to simulate
the terminating resistances. Note also the alternation in the switch phases of adjacent
integrators in order to minimize the effects of sampling delays, as mentioned at the
end of the previous section.

206
CHAPTER 4
Active Filters:
Part II
+
Vi
Vo
+
–
+
–
C1
CC1
CL2
CRi
C0
C0
L2
+
–
+
–
C3
CC3
CL4
C0
C0
L4
+
–
C5
CC5
CRo
C0
FIGURE 4.33
Fifth-order SC low-pass ﬁlter.
Direct Synthesis of Low-Pass Filters
Although the element values of Table 4.2 refer to all-pole ladders with an inductance
astheleftmostreactiveelement,theyarereadilyadaptedtoladderswithacapacitance
as the leftmost reactive element, provided we change the column headings from L1,
C2, L3, C4, . . . to C1, L2, C3, L4, . . . . Since the tabulated RLC values are normalized
for a cutoff frequency of 1 rad/s, they must be frequency-scaled before Eqs. (4.26)
and (4.27) can be applied. As discussed in Section 4.4, this requires dividing all
reactive values by the cutoff frequency ωc. Assuming Rs = 1 , the above equations
become
CCk/C0 = (Ck/ωc) fCK
CLk/C0 = (Lk/ωc) fCK
(4.29)
where Ck and Lk represent the kth normalized reactive element values of the ﬁlter
prototype.
EXAMPLE 4.13.
In the circuit of Fig. 4.33, specify capacitances for a ﬁfth-order But-
terworth low-pass response with fc = 1 kHz and fCK = 100 kHz.
Solution.
From Table 4.2 we ﬁnd the following normalized element values: C1 =
C5 = 0.618, C3 = 2.000, and L2 = L4 = 1.618. Using Eq. (4.29), we obtain CC1/C0 =
0.618 × 105/(2π103) = 9.836, CL2/C0 = 1.618 × 105/(2π103) = 25.75, etc., and CRi /
C0 = CRo/C0 = 1. A set of capacitances meeting the above constraints is CRi = CRo =
C0 = 1 pF, CC1 = CC5 = 9.84 pF, CL2 = CL4 = 25.75 pF, and CC3 = 31.83 pF.
Direct Synthesis of Band-Pass Filters
The low-pass ladder of Fig. 4.31 can also serve as the prototype for other responses.
For example, replacing each capacitance by an inductance and vice versa, and using
reciprocal element values, the ladder becomes of the high-pass type. Replacing each
inductance in the original ladder by a parallel LC pair yields a low-pass response
with notches, that is, an elliptic low-pass response. Replacing each capacitance in
the original ladder by a parallel LC pair and each inductance by a series LC pair

207
SECTION 4.6
Switched-
Capacitor
Filters
yields a band-pass response. Replacing each capacitance in the original ladder by
a series LC pair and each inductance by a parallel LC pair yields a band-reject
response.
Once the ladder has been transformed, we write circuit equations for each node
and branch, and use resistance scaling to convert currents to voltages to render
the equations amenable to SC simulation. We shall illustrate the procedure for the
band-pass case.
The ladder of Fig. 4.34 (top) is a second-order low-pass prototype. If we replace
its capacitance by a parallel LC pair and its inductance by a series LC pair, we end
up with the fourth-order band-pass ladder of Fig. 4.34 (center). RLC ﬁlter theory
states3 that to achieve a center frequency of 1 rad/s with a normalized bandwidth
BW, the element values of the transformed ladder must be related to those of the
low-pass prototype as
C1(new) = C1(old)/BW
L1(new) = BW/C1(old)
(4.30a)
C2(new) = BW/L2(old)
L2(new) = L2(old)/BW
(4.30b)
where the low-pass elements are referred to as old, and the band-pass ones as new.
The former are tabulated in ﬁlter handbooks.
+
–
+
Vi
+
–
C2
+
–
C1
CC1
CL1
CL2
CRo
Vo
CC2
C0
C0
C1
CRi
C0
C0
L2
+
–
L1
Ri
Ro
+
Vi
+
–
Vo
+
–
V2
+
–
V1
I1
Ii
I3
I2
L2
L1
C1
C2
Ri
Ro
+
Vi
+
–
Vo
L2
FIGURE 4.34
Fourth-order band-pass ﬁlter. Top: second-order RLC prototype; center: fourth-order RLC
equivalent; and bottom: SC realization.

208
CHAPTER 4
Active Filters:
Part II
Let us now develop the necessary circuit equations. By KCL, V1 = (1/jωC1)×
(Ii −I2 −I3). Multiplying numerator and denominator by the scaling resistance Rs
to convert currents to voltages as V ′
i = Rs Ii, V ′
2 = Rs I2, and V ′
3 = Rs I3, we obtain
V1 =
1
jω/ωC1
(V ′
i −V ′
2 −V ′
3)
ωC1 =
1
RsC1
By Ohm’s law, I2 = V1/jωL1. Multiplying both sides by Rs gives
V ′
2 =
1
jω/ωL1
V1
ωL1 =
1
L1/Rs
By Ohm’s law, I3 = (V1 −V2)/jωL2, or
V ′
3 =
1
jω/ωL2
(V1 −V2)
ωL2 =
1
L2/Rs
By KVL, V2 = Vo + I3/( jωC2), or
V2 = Vo +
1
jω/ωC2
V ′
3
ωC2 =
1
RsC2
All equations are realizable with the SC integrators of Section 4.5. An actual imple-
mentation is shown in Fig. 4.34 (bottom). The SC capacitance ratios are found via
Eq. (4.29) with ωc replaced by the desired center frequency ω0.
EXAMPLE 4.14.
Specify capacitances in Fig. 4.34 (bottom) for a fourth-order 0.1-dB
Chebyshev band-pass response with f0 = 1 kHz, BW = 600 Hz, and fCK = 100 kHz.
Solution.
From Table 4.2 we ﬁnd the following low-pass prototype element values:
C1 = 0.84304 and L2 = 0.62201. The normalized bandwidth is BW = 600/1000 = 0.6,
so the normalized band-pass ladder elements are C1 = 0.84304/0.6 = 1.405, L1 = 0.6/
0.84304 = 0.712, L2 = 0.62201/0.6 = 1.037, and C2 = 0.6/0.62201 = 0.9646.
Using Ri = Ro = Rs = 1 , and CRi = CRo = C0 = 1 pF, we ﬁnd CC1 = 105C1/
(2π103) = 15.92, C1 = 15.92 × 1.405 = 22.36 pF, CL1 = 15.92 × 0.712 = 11.33 pF,
CL2 = 16.51 pF, and CC2 = 14.81 pF.
Switched-capacitor ladder ﬁlters are available in a variety of conﬁgurations,
both in stand-alone form and as part of complex systems such as Codecs. Stand-
alone ﬁlters are usually preconﬁgured for commonly used responses, such as the
eighth-order Butterworth, Cauer, and Bessel responses provided by the SC ﬁlters of
the LTC1064 series.
4.7
UNIVERSAL SC FILTERS
Universal SC ﬁlters use the dual-integrator-loop conﬁguration to provide the basic
second-order responses. These responses can then be cascaded to implement higher-
order ﬁlters. Two popular and well-documented examples are the LTC1060 and the
MF10.

209
SECTION 4.7
Universal SC
Filters
The MF10 Universal SC Filter
The MF10 ﬁlter, whose block diagram is shown in Fig. 4.35, consists of two dual-
integrator-loop sections, each equipped with an uncommitted op amp to add versa-
tility and facilitate cascading. Each section can be conﬁgured independently for the
low-pass, band-pass, high-pass, notch, and all-pass responses by means of external
resistances. Though these resistances could have been synthesized on-chip using SC
techniques, placing them under the control of the user increases the versatility of
the circuit. Furthermore, ﬁlter parameters are made to depend on resistance ratios,
rather than on absolute values, to take advantage of component tracking.
The integrators are of the noninverting type, with the transfer function
H( jf ) =
1
jf/f1
(4.31)
NON OVERL
CLOCK
LEVEL
SHIFT
16
CLKA
4
INVA
6
SAB
3
N/AP/HPA
5
SlA
7
15
AGND
NON OVERL
CLOCK
LEVEL
SHIFT
11
CLKB
17
INVB
TO AGND
9
L Sh
CONTROL
12
50/100/CL
–
–
+
2
BPA
1
LPA
+
–
8
18
16
14
19
20
13
N/AP/HPB
SlB
BPB
LPB
–
–
+
+
–
VD
–
VA
–
VA
+
VD
+
+∫
+∫
+∫
+∫
FIGURE 4.35
Block diagram of the MF10 universal monolithic dual SC ﬁlter. (Courtesy of Texas Instru-
ments.)

210
CHAPTER 4
Active Filters:
Part II
where f1 is the integration unity-gain frequency, and
f1 = fCK
100
or
fCK
50
(4.32)
depending on the voltage level applied at the 50/100/CL frequency-ratio program-
ming pin: tying it to ground enables the 100 ratio, and tying it to the positive supply
enables the 50 ratio.
In general, the characteristic frequency f0 of a section coincides with the unity-
gain frequency f1 of its integrators; however, connecting an external resistance
between the LP and INV pins shifts f0 away from f1 by an amount controlled
by an external resistance ratio. This feature is useful in cascade design, where the
resonance frequency of each stage must be set independently while all sections are
controlled by the same clock frequency fCK.
For additional ﬂexibility, an internal programming switch is provided, whose
position is user-programmable by means of the SAB control pin. Tying this pin to
the positive (negative) supply positions the switch to the right (left). Whereas the
integrators provide the band-pass and low-pass responses, the input ampliﬁer can be
made to provide the high-pass, notch, or all-pass response, depending on the external
resistance connections and the internal switch position.
Modes of Operation
Each section can be conﬁgured for a variety of different modes. The following
are some of the most signiﬁcant ones; others can be found in the data sheets and
application notes.4
The circuit of Fig. 4.36 provides the notch, band-pass, and low-pass responses.
Since the summing ampliﬁer is outside the two-integrator loop, this mode is faster
and allows for a wider range of operating frequencies. Assuming f ≪fCK, we have
VN = −R2
R1
Vi −R2
R3
VBP
VBP = VN −VLP
j f/f1
VLP = VBP
j f/f1
where f1 is given by Eq. (4.32). Eliminating VLP and VBP yields VN/Vi = H0NHN,
VBP/Vi = H0BPHBP, and VLP/Vi = H0LPHLP, where
fz = f0 = f1
Q = R3/R2
(4.33a)
H0N = H0LP = −R2/R1
H0BP = −R3/R1
(4.33b)
∫
∫
+
–
R3
+
Vi
R2
R1
–
–
+
N
S1
BP
LP
FIGURE 4.36
Basic MF10 connection for the notch, band-pass, and low-pass responses.

211
SECTION 4.7
Universal SC
Filters
∫
∫
+
–
R3
+
Vi
R2
R4
R1
–
–
+
HP
S1
BP
LP
FIGURE 4.37
State-variable conﬁguration using the MF10.
Note that in this mode both fz and f0 coincide with the integration unity-gain
frequency f1 = fCK/100(50).
EXAMPLE 4.15.
In the circuit of Fig. 4.36, specify suitable resistances for a band-pass
response with f0 = 1 kHz, BW = 50 Hz, and H0BP = 20 dB.
Solution.
Impose R3/R2 = Q = f0/BW = 103/50 = 20, and R3/R1 = |H0BP| =
1020/20 = 10. Pick R1 = 20 k, R2 = 10 k, R3 = 200 k, fCK = 100 kHz, and tie
the 50/100/CL pin to ground to make f1 = fCK/100.
The mode of Fig. 4.37 is referred to as the state-variable mode because it
provides the high-pass, band-pass, and low-pass responses by direct consecutive
integrations. One can readily show (see Problem 4.33) that, if f ≪fCK, the circuit
gives VHP/Vi = H0HPHHP, VBP/Vi = H0BPHBP, and VLP/Vi = H0LPHLP, where
f0 = f1

R2/R4
Q = (R3/R2)

R2/R4
(4.34a)
H0HP = −R2/R1
H0BP = −R3/R1
H0LP = −R4/R1
(4.34b)
A distinctive feature of this mode is that f0 can be tuned independently of the
integration unity-gain frequency f1 = fCK/100(50) by means of the ratio R2/R4,
a feature we shall exploit in cascade design. Since the summing ampliﬁer is now
inside the integrator loop, the frequency limitations of its open-loop gain are likely to
cause Q enhancement, a subject that will be addressed in Chapter 6. Sufﬁce it to say
here that this enhancement can be compensated by placing a phase-lead capacitance
on the order of 10 pF to 100 pF in parallel with R4.
By combining the high-pass and low-pass responses with an external summing
ampliﬁer, in the familiar manner of Fig. 4.38, the notch response is synthesized. One
can readily show (see Problem 4.33) that, if f ≪fCK, the circuit gives
Vo
Vi
= H0N
1 −( f/fz)2
1 −( f/f0)2 + ( j f/f0)/Q
f0 = f1

R2/R4
fz = f1

RH/RL
Q = R3/R2

R2/R4
(4.35a)
H0N = RG R4
RL R1
H0HP = −R2
R1
H0BP = −R3
R1
H0LP = −R4
R1
(4.35b)

212
CHAPTER 4
Active Filters:
Part II
∫
∫
+
–
R3
+
Vi
Vo
R2
R4
R1
–
–
+
HP
S1
BP
LP
RL
RG
RH
+
–
FIGURE 4.38
MF10 with an external op amp to provide the notch response.
Depending on how one speciﬁes the various resistances, the notch can be of the high-
pass or low-pass type, and it can be utilized in the synthesis of Cauer ﬁlters. When
cascading, the high-pass and low-pass outputs of a given section can be combined
by means of the input ampliﬁer of the following section, thus reducing the number
of external op amps to one, that of the last section.
Cascade Design
Dual-integrator-loop sections can be cascaded to synthesize higher-order ﬁlters. If
we drive all sections with the same clock, the overall ﬁlter will be programmable,
since varying fCK will translate all responses up or down the frequency spectrum
without affecting their Qs or gains. The resonance frequencies of the individual
sections may require shifting with respect to the characteristic frequency of the
overall ﬁlter. This is accomplished by means of R4, as demonstrated by Eqs. (4.34a)
and (4.35a). Following are a few cascade-design examples; others can be found in
the manufacturer’s literature.4
EXAMPLE 4.16.
Using the MF10 ﬁlter, design a fourth-order 1.0-dB Chebyshev low-
pass ﬁlter with fc = 2 kHz and 0-dB dc gain.
Solution.
Let fCK = 100 fc = 200 kHz. From Table 4.1 we ﬁnd that the following
individual-stage parameters are needed: f01 = 0.993 fc, Q1 = 3.559, f02 = 0.529 fc, and
Q2 = 0.785. Let section A be the low-Q stage, and section B the high-Q stage, and let
us cascade them in this order to maximize ﬁlter dynamics. Since both sections require
frequency shifting with respect to fc, we use the conﬁguration of Fig. 4.37.
By Eq. (4.34), √R2A/R4A = 0.529, or R2A/R4A = 0.2798; R3A/R2A =Q A/
√R2A/R4A = 0.785/0.529 = 1.484; R4A/R1A = |H0LPA| = 1. Let R1A = R4A = 20 k.
Then, R2A = 5.60 k and R3A = 8.30 k. Likewise, we ﬁnd R1B = R4B = 20 k,

213
SECTION 4.7
Universal SC
Filters
20 kΩ
20 kΩ
20 kΩ
20 kΩ
19.6 kΩ
69.8 kΩ
8.25 kΩ
5.62 kΩ
–5 V
–5 V
Vi
+5 V
+
20
19
18
17
15
14
13
12
11
16
1
2
3
4
5
6
7
8
9
10
fCK = 200 kHz
LPA
LPB
BPA
BPB
N/AP/HPA
N/AP/HPB
INVA
INVB
S1A
S1B
SAB
AGND
L Sh
50/100/CL
CLKA
CLKB
Vo
VD
+
VA
+
VD
–
VA 
–
MF10
FIGURE 4.39
Fourth-order, 1-dB, 2-kHz Chebyshev low-pass ﬁlter of Example 4.16.
R2B = 19.7 k, and R3B = 70.7 k. The ﬁnal circuit is shown in Fig. 4.39, where the
resistances have been rounded off to 1% standard values. For optimum performance,
bypass the power supplies with 0.1-μF disk capacitors right at the supply pins.
EXAMPLE 4.17. Design an elliptic low-pass ﬁlter meeting the following speciﬁcations:
fc = 1 kHz, fs = 2 kHz, Amax = 1.0 dB, Amin = 50 dB, and 0-dB dc gain.
Solution.
The aforementioned FILDES program indicates that we need a fourth-order
ﬁlter with the following individual-stage parameters:
f01 = 0.5650 kHz
fz1 = 2.1432 kHz
Q1 = 0.8042
f02 = 0.9966 kHz
fz2 = 4.9221 kHz
Q2 = 4.1020
Moreover, the actual attenuation at 2 kHz is 51.9 dB.
Use the notch conﬁguration of Fig. 4.38 with fCK = 100 fc = 100 kHz. Design
section A ﬁrst. Let R1A = 20 k. Imposing |H0LPA| = 1 V/V gives R4A = R1A = 20 k.
To achieve the given f01, we need R2A/R4A = 0.56502, or R2A = 6.384 k. To achieve
the given Q1, we need R3A = R2AQ1/√R2A/R4A = 6.384×0.8042/0.5650 = 9.087 k.
Let RL A = 20 k, so that to achieve the given fz1 we need RHA/RL A = 2.14322, or
RHA = 91.87 k.
Now design section B using the input ampliﬁer of section B to combine the high-pass
and low-pass responses of section A. Imposing |H0LPB| = 1 V/V gives R4B = RL A =
20 k. Repeating similar calculations, we obtain R2B = 19.86 k, R3B = 81.76 k,
RL B = 20 k, and RH B = 484.5 k. The last notch requires an external op amp with
RG = RL B = 20 k to ensure a 0-dB dc gain. The ﬁnal circuit is shown in Fig. 4.40,
where the resistances have been rounded off to 1% standard values.

214
CHAPTER 4
Active Filters:
Part II
Vo
20 kΩ
20 kΩ
20 kΩ
20 kΩ
20 kΩ
20 kΩ
20 kΩ
487 kΩ
82.5 kΩ
90.9 kΩ
9.09 kΩ
6.34 kΩ
+
–
–5 V
–5 V
Vi
+5 V
+
20
19
18
17
15
14
13
12
11
16
1
2
3
4
5
6
7
8
9
10
fCK = 100 kHz
LPA
LPB
BPA
BPB
N/AP/HPA
N/AP/HPB
INVA
INVB
S1A
S1B
SAB
AGND
L Sh
50/100/CL
CLKA
CLKB
VD
+
VA
+
VD
–
VA 
–
MF10
LM358
1
2
FIGURE 4.40
Fourth-order, 1-dB, 1-kHz elliptic low-pass ﬁlter of Example 4.17.
PROBLEMS
4.1 Filter approximations
4.1 (a) Find n for a low-pass Butterworth ﬁlter with Amax = 1 dB, Amin = 20 dB, and
ωs/ωc = 1.2. (b) Find the actual value of A(ωs). (c) Find Amax so that A(ωs) = 20 dB
exactly.
4.2 Using Eq. (4.5), ﬁnd n for a low-pass Chebyshev response with the same speciﬁcations
as the Butterworth response of Example 4.1.
4.3 Using Eq. (4.6), ﬁnd the passband frequencies at which the gain of a seventh-order
0.5-dB Chebyshev ﬁlter exhibits its peaks and valleys, as well as the gain at 2ωc, 10ωc.
4.4 (a) Sketch the magnitude plots of the Butterworth and Chebyshev responses for n = 5
and Amax = 1 dB. (b) Compare the attenuations provided at ω = 2ωc.
4.5 The normalized third-order Butterworth low-pass response is H(s) = 1/(s3 + 2s2 +
2s + 1). (a) Verify that it satisﬁes Eq. (4.4) with ϵ = 1. (b) Show that if k1 =
0.14537 and k2 = 2.5468, the single-op-amp ﬁlter of Fig. P4.5 implements the third-
order Butterworth response with ωc = 1/RC(k1k2)1/3. (c) Specify components for
fc = 1 kHz.

215
Problems
R
R
C
R
k2C
k1C
+
–
+
Vi
Vo
FIGURE P4.5
4.2 Cascade design
4.6 The normalized fourth-order Butterworth low-pass response can be factored as H(s) =
[s2 + s(2 −21/2)1/2 + 1]−1 × [s2 + s(2 + 21/2)1/2 + 1]−1. (a) Verify that it satisﬁes
the condition of Eq. (4.4) with ϵ = 1. (b) Design a fourth-order Butterworth low-pass
ﬁlter with fc = 880 Hz and H0 = 0 dB.
4.7 A drawback of the implementation of Fig. 4.7 is its high capacitance spread, especially
in the high-Q stage. This can be avoided by using K > 1. Redesign the ﬁlter so that
the capacitance spread is kept below 10 while still ensuring 0-dB dc gain.
4.8 The smoothing ﬁlter of Fig. 4.7 is adequate for moderate performance requirements.
Ultra-high ﬁdelity audio applications require lower passband ripple and even sharper
cutoff characteristics. For a 40-kHz sampling rate, these demands can be met9 with
a tenth-order 0.25-dB Chebyshev low-pass ﬁlter having fc = 15 kHz. Such a ﬁlter
provides A(20 kHz) = 50.5 dB with a −3-dB frequency of 15.35 kHz. The individual-
stage parameters are: f01 = 3.972 kHz, Q1 = 0.627, f02 = 7.526 kHz, Q2 = 1.318,
f03 = 11.080 Hz, Q3 = 2.444, f04 = 13.744 kHz, Q4 = 4.723, f05 = 15.158 kHz,
and Q5 = 15.120. Design such a ﬁlter and show your ﬁnal circuit.
4.9 Using equal-component KRC sections, design a ﬁfth-order Bessel low-pass ﬁlter with
fc = 1 kHz and H0 = 0 dB.
4.10 Using KRC sections with C1 = C2 and RA = RB, design a seventh-order Butterworth
low-pass ﬁlter with fc = 1 kHz and H0 = 20 dB.
4.11 Design a ﬁfth-order 1.0-dB Chebyshev high-pass ﬁlter with fc = 360 Hz and high-
frequency gain H0 adjustable from 0 to 20 dB. Use equal capacitances throughout.
4.12 A band-pass ﬁlter is to be designed with center frequency f0 = 300 Hz, A(300 ±
10 Hz) = 3 dB, A(300 ± 40 Hz) ≥25 dB, and resonance gain H0 = 12 dB. These
speciﬁcations3 can be met with a sixth-order cascade ﬁlter having the following
individual-stage parameters: f01 = 288.0 Hz, Q1 = 15.60, H0BP1 = 2.567 V/V; f02 =
312.5 Hz, Q2 = 15.60, H0BP2 = 2.567 V/V; f03 = 300.0 Hz, Q3 = 15.34, H0BP3 =
1.585 V/V. Design such a ﬁlter using three individually tunable multiple-feedback
stages.
4.13 Complete the design of Example 4.7, and show the ﬁnal circuit.
4.14 Using the cascade-design approach, along with the FILDES program, design a 0.5-dB
Chebyshev low-pass ﬁlter with a cutoff frequency of 10 kHz, a stopband frequency
of 20 kHz, a minimum stopband attenuation of 60 dB, and a dc gain of 12 dB. Then,
run a PSpice simulation of your circuit, showing the magnitude Bode plots of the
individual-stage responses as well as the overall response.

216
CHAPTER 4
Active Filters:
Part II
4.15 Recalculate the component values of the sixth-order band-pass ﬁlter of Fig. 4.11 (the
values shown have been rounded off to 1% standard values). Then (a) use PSpice,
along with pseudo-ideal op amps, to plot the ac response of the circuit, measure the
ﬁlter parameters with the cursor, and compare with the intended values. (b) Repeat, but
using 741 op amps. This will expose you to the effect of limited op amp dynamics upon
ﬁlters, a subject to be addressed in Chapter 6.
4.3 Generalized impedance converters
4.16 In both circuits of Fig. 4.15 let all resistances be 1 k and all capacitances be 1 nF. Use
PSpice to display the Bode plots of both impedances (call them ZL and Z D). Compare
slopes and phases, and justify. Predict the frequency at which |ZL| = |Z D|, measure it
with the cursor, and compare.
4.17 (a) Using the DABP ﬁlter of Fig. 4.17b, along with a summing ampliﬁer, design a
second-order notch ﬁlter with fz = 120 Hz and Q = 20. (b) Suitably modify the circuit
of part (a) for a second-order all-pass ﬁlter with a gain of 20 dB.
4.18 It is desired to design a band-pass ﬁlter with f0 = 1 kHz, A( f0 ± 10 Hz) = 3 dB, and
A( f0 ± 40 Hz) ≥20 dB. Such a ﬁlter3 can be implemented by cascading two second-
order band-pass stages with f01 = 993.0 Hz, f02 = 1007 Hz, and Q1 = Q2 = 70.7.
Design an implementation using the DABP ﬁlter of Fig. 4.17b. Make provision for
frequency tuning of the individual stages.
4.19 (a) Show that Eq. (4.12) holds also for the D element of Fig. 4.16. (b) Using this element,
along with the RLC prototype of Fig. 4.18a, design a low-pass ﬁlter with f0 = 800 Hz
and Q = 4.
4.20 Provided R = √2L/C, the circuit of Fig. P4.20 yields a third-order, high-pass Butter-
worth response with −3-dB frequency ωc = 1/
√
2LC. (a) Specify suitable components
for fc = 1 kHz. (b) Convert the circuit to a GIC realization.
R
C
C
+
Vi
R
L
+
–
Vo
FIGURE P4.20
4.21 Show that the circuit of Fig. P4.21 simulates a grounded inductance L = R1R3R4C/R2.
R1
R4
Leq
R2
R3
C
+
–
OA1
+
–
OA2
FIGURE P4.21

217
Problems
4.22 The circuit of Fig. P4.22 simulates an impedance Z1 proportional to the reciprocal of
Z2. Called a gyrator, it ﬁnds application as an inductance by letting Z2 be a capacitance.
(a) Show that Z1 = R2/Z2. (b) Using this circuit, design a second-order band-pass
ﬁlter with f0 = 1 Hz, Q = 10, and zero output impedance. What is the resonance gain
of your circuit?
R1
R1
R
Z1
Z2
R
R1
R1
R
+
–
OA1
+
–
OA2
FIGURE P4.22
4.23 Let all resistances in the circuit of Fig. P4.22 be 1 k. (a) Use PSpice, along with
pseudo-ideal op amps, to plot |Z1| if Z2 is a 1-nF capacitance. (b) Repeat, if Z2 is a
100-μH inductance. Compare and comment. (c) Repeat, but using 741 op amps. Based
on what you see, specify the range of frequencies over which each of the 741-based
circuits performs reasonably close to the ideal.
4.4 Direct design
4.24 It is desired to design a seventh-order 0.5-dB Chebyshev low-pass ﬁlter with a −3-dB
frequency of 10 kHz. From Table 4.2 we ﬁnd the RLC element values shown in
Fig. P4.24. Using this ladder as a prototype, design an FDNR implementation.
R
R
1 Ω
L1
L3
L5
L7
–
+
Vi
+
1.7373 H
2.6383 H
2.6383 H
1.7373 H
1.2582 F
C2
1.3443 F
C4
1.2582 F
C6
Vo
1Ω
FIGURE P4.24
4.25 Using GICs and the information of Table 4.2, design a seventh-order 1-dB Chebyshev
high-pass ﬁlter with fc = 500 Hz.
4.26 Use PSpice, along with pseudo-ideal op amps, to plot the ac response of the seventh-
order low-pass ﬁlter of Fig. 4.21. Measure the ﬁlter parameters with the cursor, and
compare with the intended values.
4.5 The switched capacitor
4.27 Find a relationship beween Vo and V1 and V2 in the circuits of Fig. P4.27 for f ≪fCK,
and give the circuits’ descriptive names.

218
CHAPTER 4
Active Filters:
Part II
+
–
C2
+
V2
C1
C3
+
V1
Vo
(a)
+
–
+
V2
C1
C2
+
V1
Vo
(b)
FIGURE P4.27
4.28 Find the transfer function of the circuits of Fig. P4.28 for f ≪fCK, and give the
circuits’ descriptive names.
+
–
+
V2
+
V3
C1
C2
+
V1
Vo
(a)
+
–
C1
Vi
C2
C3
Vo
(b)
+
–
FIGURE P4.28
4.29 (a) Assuming f ≪fCK, show that the circuit of Fig. P4.29 gives the notch response.
(b) Assuming fCK = 100 kHz, specify capacitances for a 1-kHz notch with Q = 10.
C2
+
–
OA1
OA2
C2
C1
C0
+
Vi
Vo
+
–
C2
C0
FIGURE P4.29

219
Problems
4.6 Switched-capacitor ﬁlters
4.30 (a) Assuming fCK = 250 kHz in the circuit of Fig. 4.29, specify capacitances for a band-
pass response with f0 = 2 kHz and BW = 1 kHz. (b) Repeat, but for BW = 100 Hz.
What do you conclude about the capacitance spread as a function of Q?
4.31 (a) Derive Eq. (4.25). (b) Assuming fCK = 200 kHz, specify capacitances in the circuit
of Fig. 4.30 for f0 = 1 kHz and Q = 10. (c) Repeat, but for Q = 100. Comment on
the capacitance spread.
4.32 Using Table 4.2, but with C1, L2, C3, . . . as column headings, design a ﬁfth-order
0.1-dB Chebyshev low-pass SC ladder ﬁlter with fc = 3.4 kHz and fCK = 128 kHz.
4.7 Universal SC ﬁlters
4.33 Derive Eqs. (4.34) and (4.35).
4.34 Consider the circuit obtained from that of Fig. 4.36 by removing R1, lifting the S1 pin
off ground, and applying Vi to S1, so that only two resistances are used. (a) Sketch the
modiﬁed circuit and show that VBP/Vi = −QHBP and VLP/Vi = −HLP, with f0 and
Q given by Eq. (4.33a). (b) Specify resistances for f0 = 500 Hz and Q = 10.
4.35 The MF10 conﬁguration of Fig. P4.35 provides the notch, band-pass, and low-pass
responses, with the notch frequency fz and the resonance frequency f0 independently
tunable by means of the resistance ratio R2/R4. Find expressions for f0, fz, Q, and the
low-frequency gain.
∫
∫
+
–
R3
+
Vi
R2
R4
R1
–
–
+
N
S1
BP
LP
FIGURE P4.35
4.36 If in the circuit of Fig. P4.35 we lift the S1 input off ground and we connect it to Vi, with
everything else remaining the same, then the output of the leftmost op amp changes from
the notch to the all-pass response, with the numerator and denominator Qs separately ad-
justable. Assuming f ≪fCK, ﬁnd f0, the numerator and denominator Qs, and the gain.
4.37 Using the MF10 in the conﬁguration of Problem 4.34, design a minimum-component
fourth-order Butterworth low-pass ﬁlter with fc = 1 kHz and 20-dB dc gain.
4.38 A fourth-order 0.5-dB Chebyshev band-pass ﬁlter is to be designed with f0 = 2 kHz
and BW = 1 kHz. Using the FILDES program, it is found that the cascade realization

220
CHAPTER 4
Active Filters:
Part II
requires the following individual-stage parameters: f01 = 1554.2 Hz, f02 = 2473.6 Hz,
and Q1 = Q2 = 2.8955. Design such a ﬁlter using the MF10.
4.39 A fourth-order 1.0-dB Chebyshev notch ﬁlter with f0 = 1 kHz is to be implemented
by cascading two second-order sections with f01 = 1.0414 f0, f02 = 0.9602 f0, fz1 =
fz2 = f0, and Q1 = Q2 = 20.1. Design such a ﬁlter using the MF10.
4.40 It is desired to design a 0.5-dB elliptic band-pass ﬁlter with a center frequency f0 =
2 kHz, a passband of 100 Hz, a stopband of 300 Hz, and a minimum stopband attenu-
ation of 20 dB. Using the FILDES program, it is found that this ﬁlter requires a fourth-
order implementation with the following individual-stage parameters: f01 = 1.948 kHz,
fz1 = 1.802 kHz, f02 = 2.053 kHz, fz2 = 2.220 kHz, and Q1 = Q2 = 29.48. More-
over, the actual attenuation at the stopband edges is 21.5 dB. Design such a ﬁlter using
the MF10 and an external op amp.
4.41 Using two MF10s, design an eighth-order 0.1-dB Chebyshev high-pass ﬁlter with
fc = 500 Hz and 0-dB high-frequency gain.
REFERENCES
1. L.P.Huelsman,ActiveandPassiveAnalogFilterDesign:AnIntroduction,McGraw-Hill,
New York, 1993.
2. K. Lacanette, “A Basic Introduction to Filters: Active, Passive, and Switched-Capacitor,”
Application Note AN-779, Linear Applications Handbook, National Semiconductor,
Santa Clara, CA, 1994.
3. A. B. Williams and F. J. Taylor, Electronic Filter Design Handbook: LC, Active, and
Digital Filters, 2d ed., McGraw-Hill, New York, 1988.
4. K. Lacanette, ed., Switched Capacitor Filter Handbook, National Semiconductor, Santa
Clara, CA, 1985.
5. M. Steffes, “Advanced Considerations for Gain and Q Sequencing in Multistage Low-
pass Active Filters,” EDN, Oct. 4, 2010 (downloadable from www.edn.com).
6. A. S. Sedra and J. L. Espinoza, “Sensitivity and Frequency Limitations of Biquadratic
Active Filters,” IEEE Trans. Circuits and Systems, Vol. CAS-22, No. 2, Feb. 1975.
7. L. T. Bruton and D. Treleaven, “Active Filter Design Using Generalized Impedance
Converters,” EDN, Feb. 5, 1973, pp. 68–75.
8. L. Weinberg, Network Analysis and Synthesis, McGraw-Hill, New York, 1962.
9. D. J. M. Baezlopez, Sensitivity and Synthesis of Elliptic Functions, Ph.D. Dissertation,
University of Arizona, 1978.
10. H. Chamberlin, Musical Applications of Microprocessors, 2d ed., Hayden Book Com-
pany, Hasbrouck Heights, NJ, 1985.
11. A. B. Grebene, Bipolar and MOS Analog Integrated Circuit Design, John Wiley & Sons,
New York, 1984.
12. P. E. Allen and E. Sanchez-Sinencio, Switched Capacitor Circuits, Van Nostrand Rein-
hold, New York, 1984.
13. R. Gregorian and G. C. Temes, Analog MOS Integrated Circuits for Signal Processing,
John Wiley & Sons, New York, 1986.

5
STATIC OP AMP LIMITATIONS
5.1 Simpliﬁed Op Amp Circuit Diagrams
5.2 Input Bias and Offset Currents
5.3 Low-Input-Bias-Current Op Amps
5.4 Input Offset Voltage
5.5 Low-Input-Offset-Voltage Op Amps
5.6 Input Offset Error and Compensation Techniques
5.7 Input Voltage Range/Output Voltage Swing
5.8 Maximum Ratings
Problems
References
Appendix 5A Data Sheets of the μA741 Op Amp
If you have had the opportunity to experiment with the op amp circuits covered so
far, you may have noted that as long as the op amps are operated at moderate fre-
quencies and moderate closed-loop gains, there is generally a remarkable agreement
between actual behavior and behavior predicted by the ideal op amp model. Increas-
ing frequency and/or gain, however, is accompanied by a progressive degradation in
both the frequency and transient responses of the circuit. The frequency-domain and
time-domain behavior of an op amp, collectively referred to as op amp dynamics,
will be investigated in Chapter 6.
Even if the operating frequencies are kept suitably low, other limitations come
into play. Generally designated as input-referred errors, they are particularly notice-
able in high-dc-gain applications. The most common ones are the input bias current
IB, the input offset current IOS, the input offset voltage VOS, and the ac noise densities
en and in. Related topics are the thermal drift, the common-mode and the power-
supply rejection ratios CMRR and PSRR, and gain nonlinearity. These nonidealities
are generally impervious to the curative properties of negative feedback, and their
effects must be alleviated on a one-to-one basis by other means. Finally, in order for
221

222
CHAPTER 5
Static Op Amp
Limitations
an op amp to function properly, certain operating limits must be respected. These
include the maximum operating temperature, supply voltage, and power dissipation,
the input common-mode voltage range, and the output short-circuit current. Except
for ac noise, which will be covered in Chapter 7, all these limitations are addressed
in the present chapter.
However discouraging all this may sound, you should by no means relinquish
your conﬁdence in the ideal op amp model, for it still is a powerful tool for a
preliminary understanding of most circuits. Only in the course of a second, more
reﬁned analysis does the user examine the impact of practical limitations in order to
identify the offenders and apply corrective measures, if needed.
To facilitate our study, we shall concentrate on one limitation at a time, assuming
the op amp to be otherwise ideal. In practice, all limitations are present simultane-
ously; however, assessing their effects individually will allow us to better weigh their
relative importance and identify the most critical ones for the application at hand.
In principle, each limitation can be estimated either by calculation or by com-
puter simulation once the op amp’s internal circuit schematic and process parameters
are known. An alternative approach is to regard the device as a black box and utilize
the information available in the data sheets to model it and then predict its behav-
ior. If the actual performance does not meet the objectives, the designer will either
change the circuit approach or select a different device, or a combination of both,
until a satisfactory solution is found.
Proper interpretation of data sheet information is critical for the successful appli-
cation of analog circuits. This procedure will be illustrated using the 741 data sheets,
which are reproduced in Appendix 5A at the end of this chapter. Considerations of
space do not permit the inclusion of the data sheets of other devices here. Mercifully,
nowadays one can ﬁnd virtually any data sheets online by launching a web search
using the desired part number as a key, such as “741”, “OP77”, and so on.
Chapter Highlights
The chapter begins with a glance at the internal circuit schematics of representative
op amp technologies, namely, bipolar, JFET, and CMOS. For an effective device
selection and utilization, the user needs a basic understanding of how the inner
workings affect the various limitations of a real-life device.
Next, the chapter addresses input bias currents and the kinds of errors they
introduce in a circuit. To help the user in the device selection process, the chapter
discusses common topological and technological techniques for input bias-current
minimization.
The chapter then turns to the input offset voltage, a fairly complex parameter
that nevertheless simpliﬁes the modeling of a number of nonidealities, such as inter-
nal component mismatches, thermal drift, sensitivity to power-supply and common-
mode input voltage variations, and noninﬁnite gain. To help the user in the device
selection process, the chapter discusses topological and technological techniques for
input offset-voltage minimization.
The input bias currents and input offset voltage conspire together to generate
an overall input error, so the next task is to illustrate common techniques for nulling
this error when critical.

223
SECTION 5.1
Simpliﬁed Op
Amp Circuit
Diagrams
The chapter concludes with maximum ratings, output short-circuit protection,
and the concepts of input voltage range, output voltage swing, and rail-to-rail perfor-
mance, which are particularly critical in today’s low-voltage power-supply systems.
5.1
SIMPLIFIED OP AMP CIRCUIT DIAGRAMS
Even though the data sheets provide all the information the user needs to know, a
basic familiarity with op amp technologies/topologies will help select the optimal
device for a given application. Based on technology, op amps come in three broad
categories: (a) bipolar op amps, (b) JFET-input op amps, also called biFET op
amps, and (c) CMOS op amps (some products combine the best of both bipolar and
CMOS on the same chip and are thus called biCMOS op amps). Based on topology,
two main categories are prevalent: (a) voltage-feedback op amps (VFAs), by far the
most popular, and current-feedback op amps (CFAs), a more recent and generally
faster category that will be covered in Chapter 6. Other, more specialized topologies
are available, such as Norton ampliﬁers and operational transconductance ampliﬁers
(OTAs), but will not be addressed here.
WebeginwiththesimpliﬁedbipolardiagramofFig.5.1,inspiredbytheindustry-
standard 741 and encountered, in variant forms, in a multitude of other VFAs (in
this connection you are urged to search the web for the classic tutorial study by
J. E. Solomon,1 probably the most widely read article on the subject). The diagram
shows three basic building blocks, namely, the ﬁrst or input stage, the second or
intermediate stage, and the third or output stage.
vN
vP
VCC
IC
Cc
IA
vO
VEE
Q4
Q5
Q6
D1
D2
Q3
Q2
Q1
Q8
Q7
R1
Input
stage
Second
stage
Output
stage
FIGURE 5.1
Simpliﬁed circuit diagram of a typical bipolar op amp.

224
CHAPTER 5
Static Op Amp
Limitations
The Input Stage
This stage senses any imbalance between the inverting and noninverting input volt-
ages vN and vP, and converts it to a single-ended output current iO1 according to
iO1 = gm1(vP −vN)
(5.1)
where gm1 is the input-stage transconductance. This stage is designed to also pro-
vide high input impedance and draw negligible input currents. As shown again in
Fig. 5.2a, the input stage consists of two matched transistor pairs, namely, the dif-
ferential pair Q1 and Q2, and the current mirror Q3 and Q4.
The input-stage bias current IA splits between Q1 and Q2. Ignoring transistor
base currents and applying KCL, we have
iC1 + iC2 = IA
(5.2)
For a pnp transistor, the collector current iC is related to its emitter-base voltage
drop vEB by the well-known exponential law,
iC = Is exp(vEB/VT )
(5.3)
where Is is the collector saturation current and VT the thermal voltage (VT ∼= 26 mV
at room temperature). Assuming matched BJTs (Is1 = Is2), we can write
iC1
iC2
= exp
vEB1 −vEB2
VT

= exp
vP −vN
VT

(5.4)
where we have used vEB1−vEB2 = vE1−vB1−(vE2−vB2) = vB2−vB1 = vP−vN.
Q3
Q1
Q2
Q4
VCC
IA
+IA
–IA
–2VT
–4VT
4VT
2VT
VEE
vN
vP
vP – vN
iC1
iO1
gm1
iC3
iC4
iC2
iO1
(a)
(b)
FIGURE 5.2
Input stage and its transfer characteristic.

225
SECTION 5.1
Simpliﬁed Op
Amp Circuit
Diagrams
In response to iC1, Q3 develops a certain base-emitter voltage drop vBE3. Since
vBE4 = vBE3, Q4 is forced to draw the same current as Q3, or iC4 = iC3; hence the
designation current mirror. But, iC3 = iC1, so the ﬁrst-stage output current is, by
KCL, iO1 = iC4 −iC2 = iC1 −iC2. Solving Eqs. (5.2) and (5.4) for iC1 and iC2,
and then taking their difference, we get
iO1 = IA tanh vP −vN
2VT
(5.5)
This function is plotted in Fig. 5.2b.
We observe that under the balanced condition vP = vN, IA splits equally be-
tween Q1 and Q2, thus yielding iO1 = 0. However, any imbalance between vP and
vN willdivertmoreof IA through Q1 andlessthrough Q2,orviceversa,thusyielding
iO1 ̸= 0. For sufﬁciently small imbalances, also referred to as small-signal condi-
tions, the transfer characteristic is approximately linear and is expressed by Eq. (5.1).
The slope, or transconductance, is found as gm1 = diO1/d(vP −vN)|vP=vN . The
result is
gm1 =
IA
2VT
(5.6)
Overdriving the input stage will eventually force all of IA through Q1 and none
through Q2, or vice versa, thus causing iO1 to saturate at ±IA. The overdrive con-
ditions are referred to as large-signal conditions. From the ﬁgure we see that the
onset of saturation occurs for vP −vN ∼= ±4VT ∼= ±100 mV. As we know, an
op amp with negative feedback normally forces vN to closely track vP, indicating
small-signal operation.
The Second Stage
This stage is made up of the Darlington pair Q5 and Q6, and the frequency-
compensation capacitance Cc. The Darlington pair is designed to provide additional
gain as well as a wider signal swing. The capacitance is designed to stabilize the op
amp against unwanted oscillations in negative-feedback applications, a subject to
be addressed in Chapter 8. Since Cc is fabricated on-chip, the op amp is said to be
internally compensated. By contrast, uncompensated op amps require that the com-
pensation network be supplied externally by the user. The 741 op amp is internally
compensated. A popular uncompensated contemporary is the 301 op amp.
The Output Stage
This stage, based on the emitter followers Q7 and Q8, is designed to provide low
output impedance. Though its voltage gain is only approximately unity, its current
gain is fairly high, indicating that this stage acts as a power booster for the second-
stage output.
Transistors Q7 and Q8 are referred to as a push-pull pair because in the presence
of a grounded output load, Q7 will source (or push) current to the load during positive
output voltage swings, whereas Q8 will sink (or pull) current from the load during
negative swings. The function of the diodes D1 and D2 is to develop a pair of

226
CHAPTER 5
Static Op Amp
Limitations
pn-junction voltage drops suitable for biasing Q7 and Q8 in the forward-active
region and thus minimize crossover distortion at the output.
JFET-Input Op Amps
A potential drawback of bipolar-input op amps are the base currents at the vP and
vN inputs. The op amp forces these currents automatically through the surrounding
circuitry, creating voltage drops that may be unacceptable in certain precision ap-
plications (more on this in the next section). One way of alleviating this drawback
is by implementing the differential input pair with junction ﬁeld-effect transistors
(JFETs), as shown in Fig. 5.3.
The transfer characteristic of the input stage is still qualitatively similar to that of
Fig. 5.2b, although gm1 is typically much lower because the quadratic characteristic
of an FET is less steep than the exponential characteristic of an equally biased BJT.
However, the currents at the vP and vN inputs are now the gate currents of the JFETs,
which at room temperature are orders of magnitude lower than the base currents of
BJTs. (The gate current of a JFET is the leakage current of the reverse-biased pn
junction formed by the gate and channel regions.)
The present rendition also shows an alternative second stage implementation,
which consists of another differential pair (Q3-Q4), along with the corresponding
current mirror (Q5-Q6). Also shown is an alternative output-stage implementation,
which uses the complementary Darlington-like pairs Q7-Q10 and Q8-Q9 to provide
the required push-pull action at the output while presenting high input resistance so
as to limit loading of the second stage. The op amp is frequency compensated by
means of Cc.
Cc
VEE
VCC
vP
vN
vO
Q3
Q5
Q6
Q7
Q2
Q1
J1
I1
I2
I4
I3
J2
Q4
Q9
Q8
Q10
FIGURE 5.3
Simpliﬁed circuit diagram of a JFET-input op amp.

227
SECTION 5.1
Simpliﬁed Op
Amp Circuit
Diagrams
CMOS Op Amps
The emergence of CMOS technology in digital electronics, in the early to mid-1970s,
along with the drive to combine digital as well as analog functions on the same chip,
has provided a strong motivation for recasting traditionally bipolar analog functions
in forms amenable to CMOS implementation (we have already seen an example in
switched-capacitor ﬁlters). A transistor’s ability to amplify voltages is expressed via
a ﬁgure of merit known as the intrinsic voltage gain gmro, where gm and ro are,
respectively, the transistor’s transconductance and output resistance. Compared to
BJTs, which are capable of intrinsic gains in the thousands, FETs are notorious for
their much lower intrinsic gains, not an encouraging sign if we want to use them
to build op amps. However, the MOSFET offers three important advantages: (a) it
presents virtually inﬁnite input resistance at its gate, essentially eliminating input
loading; (b) using a technique known as cascoding,3,4 we can raise its effective ro
dramatically to make up for its poor gm; (c) it takes up much less chip area than a
BJT, thus allowing for much denser integration. These advantages, combined with
clever advances in design and fabrication, have made CMOS op amps competitive
with their bipolar counterparts in a number of areas. Shown in Fig. 5.4 are two
popular CMOS topologies.
The topology of Fig. 5.4a is a CMOS replica of the ﬁrst two stages of Fig. 5.1.
The input stage, consisting of the differential pair M1-M2 and current mirror
M3-M4, provides a transfer characteristic of the type of Fig. 5.2b, though typi-
cally with a much lower gm1. Moreover, we can exploit the virtually inﬁnite gate
resistance of MOSFETs to implement the second stage with a single transistor, M5.
The M6-M7-M8 triplet forms a dual-output current mirror for biasing the M1-M2
pair and the M5 stage. The op amp is frequency compensated by means of the Rc-Cc
network.
Cc
Rc
VDD
vP
VSS
(a)
(b)
vO
vO
VSS
VDD
M7
M6
M1
M2
M8
vN
M3
M4
M5
Cc
M6
M7
M5
M8
IREF
IBIAS
VBIAS
IBIAS
ISS
+
–
M3
M4
vN
M1
M2
vP
FIGURE 5.4
Two popular CMOS op amp topologies: (a) the two-stage and (b) the folded-cascode.

228
CHAPTER 5
Static Op Amp
Limitations
Conspicuously absent from the ﬁgure is a dedicated output stage. This reﬂects
the fact that nowadays CMOS op amps are most frequently used as subcircuits
of larger IC systems, where the output load is known and usually light enough
not to warrant a dedicated output stage. (On the contrary, a general-purpose op
amp does require a dedicated output stage to confront a wide variety of a priori
unknown loads. CMOS op amps with dedicated output stages will be addressed in
Section 5.7.)
The topology of Fig. 5.4b is said to be of the single-stage type because its core
is just the differential pair M1-M2 and the current mirror M3-M4. The remaining
FETs serve only the ancillary purpose of raising the intrinsic gain of this basic stage
via a technique known as the cascoding technique.3,4 Speciﬁcally, M8 raises ro4 and
M6 raises ro2 so as to ensure a high overall output resistance Ro and thus maximize
the gain, which for this type of op amp is a = gm1Ro.
The M1-M2 pair senses any imbalance between its gate voltages and con-
verts to an imbalance between its drain currents. The drain-current imbalance is
then rerouted upward by the M5-M6 pair in folded fashion (hence the name), a
technique that allows for much wider output voltage swings.3,4 (In Chapter 8 we
shall see that capacitive loads tend to destabilize op amps. Not so in the folded-
cascode case, because the load capacitance Cc actually improves stability, a fea-
ture that makes folded-cascode op amps particularly suited to switched-capacitor
applications.)
SPICE Models
There are various levels at which an op amp can be simulated. In IC design, op
amps are simulated at the transistor level,2 also called the micromodel level. Such
a simulation requires a detailed knowledge of both the circuit schematic and the
fabrication process parameters. However, this proprietary information is not easily
accessible to the user. Even so, the level of detail may require excessive compu-
tation time or may even cause convergence problems, especially in more complex
circuit systems.
To cope with these difﬁculties, simulations by the user are usually carried out at
the macromodel level. A macromodel uses a much reduced set of circuit elements
to closely match the measured behavior of the ﬁnished device while saving con-
siderable simulation time. Like any model, a macromodel comes with limitations,
and the user need be aware of the parameters the particular macromodel fails to
simulate. Macromodels are available online from virtually every manufacturer. The
student version of PSpice used in this book includes a 741 macromodel based on
the so-called Boyle model5 of Fig. 5.5.
At times we may wish to focus on just one particular op amp feature and thus
develop an even simpler model on our own. A typical example is offered by the
frequency response, to be studied in Chapter 6. Regardless of the model used, a
circuit must eventually be breadboarded and tried out in the lab, where its behavior
is evaluated in the presence of parasitics and other factors related to actual cir-
cuit construction, which computer simulation, unless properly instructed, fails to
account for.

229
SECTION 5.2
Input Bias and
Offset Currents
D4
D3
vO
D1
D2
R2
Ro2
RE
RP
Re1
gcmvE
gavC
gbvB
gcvO
Re2
Rc1
C1
Q2
Q1
C2
CE
IEE
(VCC)
(VEE)
Rc2
Ro1
–
+
3
1
0
0
4
12
14
10
11
13
(+)
2
6
16
14
5
15
7
(–)
+
– vC
vE
vB
VC
VE
Input stage
Second stage
Output stage
+
+
FIGURE 5.5
741 op amp macromodel.
5.2
INPUT BIAS AND OFFSET CURRENTS
Let us now investigate how the input-pin currents affect the performance of an op
amp circuit. We shall use the 741 as a vehicle, so we need to take a closer look at the
input-stage portion of Fig. 5A.2, which is reproduced in Fig. 5.6 for convenience.
The process used to fabricate the 741 optimizes npn BJTs at the expense of pnp BJTs,
which therefore come out with inferior characteristics, such as a much lower current
gain βFp. Had the input stage been fabricated in the simpliﬁed form of Fig. 5.1,
the pnp transistors would have presented intolerably high currents at the vP and vN
terminals. As seen in Fig. 5.6, the 741 overcomes this limitation by operating the
Q3-Q4 pnp transistors as a common-base pair, and by driving this pair with the high-
beta npn emitter followers Q1-Q2. By this ingenious artiﬁce, the composite structure
Q1-Q2-Q3-Q4 appears as pnp-type to the current mirror Q5-Q6, but as npn-type to
nodes vP and vN. The addition of the emitter followers halves the transconductance
of Eq. (5.6) to gm1 = IA/(4VT ), but it also results in much lower input currents
IP ∼= IN ∼= (IA/2)/βFn, owing to the much higher value of βFn. As we move along,
we shall use the following 741 working values:
IA = 19.5 μA
gm1 = 189 μA/V
(5.7)

230
CHAPTER 5
Static Op Amp
Limitations
Q8
Q2
Q1
Q3
Q9
vN
vP
VCC
VCC
iO1
Q4
Q7
Q6
Q5
IN
IA
VEE
IA
IP
50 kΩ
10 kΩ
1 kΩ
1 kΩ
R1
R2
FIGURE 5.6
Detailed diagram of the input stage of the 741 op amp.
As we place the 741 in a circuit, its input transistors will draw IP and IN
automatically from the surrounding elements. In fact, for the op amp to function,
each input terminal must be provided with a series dc path through which current
can ﬂow (we have seen an example in connection with the GIC of Chapter 4). In
the case of purely capacitive termination, the input current will charge or discharge
the capacitor, making a periodic reinitialization necessary. Barring exceptions to be
addressed in the next section, IP and IN ﬂow into the op amp if its input transistors
are npn BJTs or p-channel JFETs, and out of the op amp for pnp BJTs or n-channel
JFETs.
Because of unavoidable mismatches between the two halves of the input stage,
particularly between the βFs of Q1 and Q2, IP and IN will themselves be mis-
matched. The average of the two currents is called the input bias current,
IB = IP + IN
2
(5.8)
and their difference is called the input offset current,
IOS = IP −IN
(5.9)

231
SECTION 5.2
Input Bias and
Offset Currents
Usually IOS is an order of magnitude smaller than IB. While the polarity of IB
depends on the type of input transistors, that of IOS depends on the direction of
mismatch, so some samples of a given op amp family will have IOS > 0, and others
IOS < 0.
Depending on the op amp type, IB may range from nanoamperes to femtoam-
peres. The data sheets report typical as well as maximum values. For the 741C,
which is the commercial version of the 741 family, the room-temperature ratings
are: IB = 80 nA typical, 500 nA maximum; IOS = 20 nA typical, 200 nA max-
imum. For the 741E, which is the improved commercial version, IB = 30 nA
typical, 80 nA maximum; IOS = 3 nA typical, 30 nA maximum. Both IB and
IOS are temperature dependent, and these dependences are shown in Figs. 5A.8
and 5A.9, of Appendix 5A. The industry-standard OP77 op amp mentioned in Sec-
tion 1.2, has IB = 1.2 nA typical, 2.0 nA maximum; IOS = 0.3 nA typical, 1.5 nA
maximum.
Errors Caused by IB and IOS
A straightforward way of assessing the effect of the input currents is to ﬁnd the
output with all input signals set to zero. We shall illustrate two representative cases,
namely, the cases of resistive and capacitive feedback shown in Fig. 5.7. Once we
understand these cases, we can readily generalize to other circuits. Our analysis
assumes that the op amp, aside from the presence of IP and IN, is ideal.
There are many circuits that, once their active inputs are set to zero, reduce to an
equivalent circuit of the type of Fig. 5.7a, including the inverting and noninverting
ampliﬁers, the summing and difference ampliﬁers, I-V converters, and others. By
Ohm’s law, the voltage at the noninverting input is VP = −RpIP. Using the superpo-
sition principle, we have vO = (1+R2/R1)VP+R2IN = R2IN −(1+R2/R1)RpIP,
or vO = EO, where
EO =

1 + R2
R1

[(R1 ∥R2)IN −RpIP]
(5.10)
+
–
R1
Rp
R2
IP
IN
vO
(a)
(b)
+
–
R
Rp
C
IP
IN
IC
vO
FIGURE 5.7
Estimating the output error due to the input bias currents for the
case of (a) resistive, and (b) capacitive feedback.

232
CHAPTER 5
Static Op Amp
Limitations
This insightful form elicits a number of observations. First, in spite of the absence
of any input signal, the circuit yields some output EO. We regard this unwanted
output as an error or, more properly, as output dc noise. Second, the circuit produces
EO by taking an input error, or input dc noise, and amplifying it by (1 + R2/R1),
which is aptly called the dc noise gain (recall that this gain is the reciprocal of the
feedback factor β, hence the reason for calling 1/β the noise gain). Third, the input
error consists of two terms, namely, the voltage drop –RpIP due to IP ﬂowing out
of Rp, and the term (R1∥R2)IN arising as if IN ﬂew out of the parallel combination
R1∥R2 (R1 and R2 are not in parallel per se, but they only appear as such as they
conspire with IN to create the corresponding error term). Fourth, the two terms tend
to compensate for each other since they have opposite polarities.
Depending on the application, the error EO may be unacceptable and one
must devise suitable means to reduce it to a tolerable level. Putting Eq. (5.10) in
the form
EO =

1 + R2
R1

{[(R1 ∥R2) −Rp]IB −[(R1 ∥R2) + Rp]IOS/2}
reveals that if we install a dummy resistance Rp, as shown, and we impose
Rp = R1 ∥R2
(5.11)
then the term involving IB will be eliminated, leaving
EO =

1 + R2
R1

(−R1 ∥R2)IOS
(5.12)
The error is now proportional to IOS, which is typically an order of magnitude smaller
than either IP or IN.
EO can be reduced further by scaling down all resistances. For instance, re-
ducing all resistance by a factor of 10 will leave gain unaffected, but will cause a
tenfold reduction in the input error −(R1 ∥R2)IOS. Reducing resistances, however,
increases power dissipation, so a compromise will have to be reached. If EO is still
unacceptable, selecting an op amp type with a lower IOS rating is the next logical
step. Other techniques for reducing EO will be discussed in Section 5.6.
EXAMPLE 5.1.
In the circuit of Fig. 5.7a let R1 = 22 k and R2 = 2.2 M, and let
the op amp ratings be IB = 80 nA and IOS = 20 nA. (a) Calculate EO for the case
Rp = 0. (b) Repeat, but with Rp = R1 ∥R2 in place. (c) Repeat part (b), but with all
resistances simultaneously reduced by a factor of 10. (d) Repeat part (c), but with the
op amp replaced by one with IOS = 3 nA. Comment.
Solution.
(a) The dc noise gain is 1 + R2/R1 = 101V/V; moreover, (R1 ∥R2) ∼= 22 k. With
Rp = 0, we have EO = 101 × (R1 ∥R2)IN ∼= 101 × (R1 ∥R2)IB ∼= 101 × 22 ×
103 × 80 × 10−9 ∼= 175 mV.
(b) With Rp = R1 ∥R2 ∼= 22 k in place, EO ∼= 101 × 22 × 103 × (±20 × 10−9) =
±44 mV, where we write “±” to reﬂect the fact that IOS may be of either polarity.
(c) With R1 = 2.2 k, R2 = 220 k, and Rp = 2.2 k, we get EO = 101 × 2.2 ×
103 × (±20 × 10−9) ∼= ±4.4 mV.
(d) EO = 101×2.2×103 ×(±3×10−9) ∼= ±0.7 mV. Summarizing, with Rp in place,
EO is reduced by 4; scaling the resistances reduces EO by an additional factor of
10; ﬁnally, using a better op amp reduces it by yet another factor of 7.

233
SECTION 5.2
Input Bias and
Offset Currents
Turning next to the circuit of Fig. 5.7b, we note that we still have VN = VP =
−RpIP. Summing currents at the inverting-input node yields VN/R+ IN −IC = 0.
Eliminating VN, we get
IC = 1
R (RIN −RpIP) = 1
R [(R −Rp)IB −(R + Rp)IOS/2]
Applying the capacitance law v = (1/C)
 i dt, we readily get
vO(t) = EO(t) + vO(0)
(5.13)
EO(t) =
1
RC
 t
0
[(R −Rp)IB −(R + Rp)IOS/2] dξ
(5.14)
where vO(0) is the initial value of vO. In the absence of any input signal, we expect
the circuit to yield a constant output, or vO(t) = vO(0). In practice, besides vO(0),
it yields the output error EO(t), which is the result of integrating the input error
[(R −Rp)IB −(R + Rp)IOS/2] over time. Since IB and IOS are relatively constant,
we can write EO(t) = [(R −Rp)IB −(R + Rp)IOS/2]t/RC. The error is thus a
voltage ramp, whose tendency is to drive the op amp into saturation.
It is apparent that installing a dummy resistance Rp such that
Rp = R
(5.15)
will reduce the error to
EO(t) =
1
RC
 t
0
−RIOS dξ
(5.16)
This error can be reduced further by component scaling, or by using an op amp with
a lower IOS rating.
EXAMPLE 5.2. In the circuit of Fig. 5.7b let R = 100 k, C = 1 nF, and vO(0) = 0 V.
Assuming an op amp with IB = 80 nA, IOS = 20 nA, and ±Vsat = ±13 V, ﬁnd how
long it takes for the op amp to enter saturation if (a) Rp = 0, and (b) Rp = R.
Solution.
(a) Theinputerroris RIN ∼= RIB = 105 × 80 × 10−9 = 8mV.So,vO(t) =(RIN/RC)t =
80t, which represents a positive voltage ramp. Imposing 13 = 80t yields t =
13/80 = 0.1625 s.
(b) The input error is now −RIOS = ±2 mV, indicating that the op amp may saturate at
either rail. The time it takes to saturate is now extended in proportion to 0.1625 ×
80/20 = 0.65 s.
Summarizing, to minimize the errors due to IB and IOS, adhere to the following
rules whenever possible: (a) modify the circuit so that the resistances seen by IP and
IN with all sources suppressed are equal, that is, impose Rp = R1 ∥R2 in Fig. 5.7a
and Rp = R in Fig. 5.7b; (b) keep resistances as low as the application will allow;
(c) use op amps with adequately low IOS ratings.

234
CHAPTER 5
Static Op Amp
Limitations
5.3
LOW-INPUT-BIAS-CURRENT OP AMPS
Op amp designers strive to keep IB and IOS as small as other design constraints
allow. Following are the most common techniques.
Superbeta-Input Op Amps
One way of achieving low IBs is by using input BJTs with extremely high current
gains. Known as superbeta transistors, these BJTs achieve βFs in excess of 103
A/A by utilizing very thin base regions to minimize the recombination component3
of the base current. This technique was pioneered with the LM308 op amp, whose
input stage is shown in Fig. 5.8a. The heart of the circuit is the superbeta differential
pair Q1 and Q2. These BJTs are connected in cascode with the standard-beta BJTs
Q3 and Q4 to form a composite structure with high current gain as well as high
breakdown voltage. Q5 and Q6 provide a bootstrapping function to bias Q1 and
Q2 at zero base-collector voltage regardless of the input common-mode voltage.
This avoids the low-breakdown limitations of the superbeta BJTs and also reduces
collector-base leakage. Superbeta op amps have typically IB ∼= 1 nA or less.
To
second
stage
To
second
stage
Inputs
Inputs
R2
R2
R1
R1
R4
R3
I1
I1
15
μA
Q3
Q5
Q3
Q4
Q2
Q1
Q6
Q1
Q2
Q6
Q5
Q4
6
μA
–
–
+
+
D5
D6
D1
D3
D4
D2
D7
D8
D9
VEE
VCC
VEE
VCC
(a)
(b)
FIGURE 5.8
(a) Superbeta input stage, and (b) input-bias-current cancellation.

235
SECTION 5.3
Low-Input-Bias-
Current Op
Amps
Input-Bias-Current Cancellation
Another popular technique for achieving low IBs is current cancellation.3 Special
circuitry anticipates the base currents needed to bias the input transistors, then itself
supplies these currents internally, making the op amp appear to an outsider as if it
were capable of operating without any input bias current.
Figure 5.8b shows the cancellation scheme utilized by the OP07 op amp. Once
again, the heart of the circuit is the differential pair Q1 and Q2. The base currents
of Q1 and Q2 are duplicated at the bases of common-base transistors Q3 and Q4,
where they are sensed by current mirrors Q5-D5 and Q6-D6. The mirrors reﬂect
these currents and then reinject them into the bases of Q1 and Q2, thus providing
input-bias-current cancellation.
In practice, because of device mismatches, cancellation is not perfect, so the
input pins will still draw residual currents. However, since these currents are now
the result of a mismatch, they are typically an order of magnitude less than the actual
base currents. We observe that IP and IN may ﬂow either into or out of the op amp,
depending on the direction of the mismatch. Moreover, IOS is of the same order of
magnitude as IB, so there is no use installing a dummy resistance Rp in op amps with
input-current cancellation. The OP07 ratings are IB = ±1 nA and IOS = 0.4 nA.
FET-Input Op Amps
As mentioned in Section 5.1, FET-input op amps generally exhibit much lower input
bias currents than BJTs. We now wish to address this issue in more detail.
Consider ﬁrst MOSFET op amps. The gate of a MOSFET forms a tiny capacitor
with the body, so the gate of a well-fabricated MOSFET draws virtually no dc current.
However, if the inputs are meant to be connected to external circuitry as in the case
of general-purpose op amps, the fragile gates of the input FETs must be protected
against electrostatic discharge (ESD) and electrical overstress (EOS). As depicted
in Fig. 5.9a, the protective circuitry comprises internal diode clamps designed to
prevent the gate voltages from raising a diode drop (0.7 V) above VDD (DH diodes)
VDD
ISS
VSS
(a)
IP
DHp
DHn
DLp
DLn
vN
vP
IN
M1
M2
VCC
ISS
VEE
(b)
IP
DHp
DHn
DLp
DLn
vN
vP
IN
J1
J2
FIGURE 5.9
Input protection diodes for (a) CMOS op amps and (b) JFET-input op amp.

236
CHAPTER 5
Static Op Amp
Limitations
or dropping 0.7 V below VSS (DL diodes). In normal operation all diodes are reverse-
biased, so each conducts a small reverse current IR, which, at room temperature, is
typically on the order of a few picoamperes. The data sheets usually give the input
bias current with the common-mode input voltage vC M = (vP + vN)/2 halfway
between VDD and VSS. On average, this is a favorable situation because if the DH
and DL diodes associated with the same input are matched, their IRs will cancel
out, making IP and IN approach zero. However, raising vC M above the cancellation
level increases IP and IN because the amount of reverse bias increases for the DL
diodes and decreases for the DH, making the IR of the DL bottom diodes prevail
over that of the DH diodes. Conversely, lowering vC M below the cancellation level
causes the IR of the DH diodes prevail over that of the DL diodes, reversing the
direction of IP and IN, whose magnitudes increase as vC M is lowered further.
Figure 5.9b shows a similar diode network to protect the gates of the JFETs.
However, in addition to protective-diode leakage, we now have also the leakage
currents of the reverse-biased gate-channel junctions of the JFETs. These junctions
are fabricated with signiﬁcantly larger areas than the protective-diode junctions, so
JFET leakage will prevail over diode leakage. The result is that IP and IN will
ﬂow into the op amp in the case of p-channel JFETs, as depicted in Fig. 5.9b,
but out of the op amp if the differential input pair is implemented with n-channel
JFETs.
To limit cluttering, the diode clamps were not shown explicitly in the circuits
of Figs. 5.3 and 5.4. However, we need to be aware of their presence if we try to
push vP and/or vN outside the supply voltages, for then the clamp diodes that will
become conductive will cause IP and/or IN to shoot up exponentially.
Input-Bias-Current Drift
Figure 5.10 compares typical input-bias-current characteristics for different input-
stage arrangements and technologies. We observe that in BJT-input devices, IB tends
to decrease with temperature, owing to the fact that βF increases with temperature.
However, for FET-input op amps, IB increases exponentially with temperature. This
is due to the fact that IP and IN are made up of IRs, and IR doubles for about
every 10◦C of temperature increase. Extending this rule to IB allows us to state that
once we know IB at some reference temperature T0, we can estimate it at any other
temperature T using
IB(T ) ∼= IB(T0) × 2(T −T0)/10
(5.17)
It is apparent from Fig. 5.10 that the low-input-bias-current advantages of FET-
input op amps over their BJT-input counterparts tend to disappear at higher tem-
peratures. Knowledge of the intended operating temperature range is an important
factor when selecting the optimal device.
EXAMPLE 5.3.
A certain FET-input op amp is rated at IB = 1 pA at 25 ◦C. Estimate
IB at 100 ◦C.
Solution.
IB(100 ◦C) ∼= 10−12 × 2(100−25)/10 = 0.18 nA.

237
SECTION 5.3
Low-Input-Bias-
Current Op
Amps
100 nA
10 nA
1 nA
100 pA
10 pA
1 pA
0
25
50
75
100
125
General-purpose
Cancellation
Superbeta
JFET
CMOS
Temperature (°C)
Input bias current IB
  
FIGURE 5.10
Typical input-bias-current characteristics.
Input Guarding
When applying op amps with ultralow input bias current, special attention must
be paid to wiring and circuit construction in order to fully realize the capabilities
of these devices. Data sheets usually provide helpful guidelines in this respect. Of
special concern are leakage currents across the printed-circuit board. They can easily
exceed IB itself and thus defeat what has been so painstakingly achieved in terms
of circuit design.
The effect of leakage can be reduced signiﬁcantly by using guard rings around
the input pins. As shown in Fig. 5.11, a guard consists of a conductive pattern held
at the same potential as vP and vN. This pattern will absorb any leakages from other
points on the board and thus prevent them from reaching the input pins. Guard rings
also act as shields against noise pickup. For best results, board surfaces should be
kept clean and moisture-free. If sockets are required, best results are obtained by
using Teﬂon sockets or standoffs.
FIGURE 5.11
Guard-ring layout and connections.

238
CHAPTER 5
Static Op Amp
Limitations
5.4
INPUT OFFSET VOLTAGE
Shorting together the inputs of an op amp should yield vO = a(vP −vN) = a ×
0 = 0 V. However, because of inherent mismatches between the input-stage halves
processing vP and vN, a practical op amp will generally yield vO ̸= 0. To force vO
to zero, a suitable correction voltage must be applied between the input pins. This is
tantamount to saying that the open-loop VTC does not go through the origin, but is
shifted either to the left or to the right, depending on the direction of the mismatch.
This shift is called the input offset voltage VOS. As shown in Fig. 5.12, we can model
a practical op amp with an ideal or offsetless op amp having a tiny source VOS in
series with one of its inputs. The VTC is now
vO = a[vP + VOS −vN]
(5.18)
To drive the output to zero, we need vP + VOS −vN = 0, or
vN = vP + VOS
(5.19)
Note that because of VOS, we now have vN ̸= vP.
As in the case of IOS, the magnitude and polarity of VOS varies from one sample
to another of the same op amp family. Depending on the family, VOS may range from
millivolts to microvolts. The 741 data sheets give the following room-temperature
ratings: for the 741C, VOS = 2 mV typical, 6 mV maximum; and for the 741E,
VOS = 0.8 mV typical, 3 mV maximum. The OP77 ultralow offset voltage op amp
has VOS = 10 μV typical, 50 μV maximum.
Errors Caused by VOS
As in Section 5.2, we shall examine the effect of VOS for the resistive-feedback
and capacitive-feedback cases of Fig. 5.13. Note that we are omitting the dummy
resistance RP since the present analysis deliberately ignores IB and IOS to focus on
VOS alone. In Section 5.6 we shall address the general case in which IB, IOS, and
VOS are present simultaneously.
vO
VOS
vN
VOL
vP
+
–
Practical op amp
Ideal op amp
(a)
(b)
0
0
VOS
vP – vN
VOH
vO
a
+
FIGURE 5.12
VTC and circuit model of an op amp with input offset voltage VOS.

239
SECTION 5.4
Input Offset
Voltage
+
–
R1
R2
vO
VOS
(a)
(b)
+
–
R
C
IR
IC
vO
VOS
VOS
VOS
Ideal op amp
Ideal op amp
+
+
FIGURE 5.13
Estimating the output error due to VOS for the case of (a) resistive,
and (b) capacitive feedback.
In Fig. 5.13a, the offset-free op amp acts as a noninverting ampliﬁer with respect
to VOS, so vO = EO, where
EO =

1 + R2
R1

VOS
(5.20)
is the output error, and (1 + R2/R1) is again the dc noise gain. Clearly, the larger
the noise gain, the larger the error. For instance, with R1 = R2, a 741C op amp
yields EO = (1+1)×(±2 mV) = ±4 mV typical, (1+1)×(±6 mV) = ±12 mV
maximum. However, with R2 = 103R1, it yields EO = (1 + 103) × (±2 mV) ∼=
±2 V typical, ±6 V maximum—quite an error! Conversely, we can use the present
circuit to measure VOS. For instance, let R1 = 10  and R2 = 10 k, so that
the dc noise gain is 1001 V/V and the combination R1 ∥R2 is sufﬁciently small to
make the effect of IN negligible. Suppose we measure the output and ﬁnd EO =
−0.5 V. Then, VOS ∼= EO/1001 ∼= −0.5 mV, a negative offset in this speciﬁc
example.
In the circuit of Fig. 5.13b we note that since the offset-free op amp keeps
VN = VOS, we have IC = IR = VOS/R. Using again the capacitance law, we get
vO(t) = EO(t) + vO(0), where the output error is now
EO(t) =
1
RC
 t
0
VOS dξ
(5.21)
or EO(t) = (VOS/RC)t. This voltage ramp, resulting from the integration of VOS
over time, tends, as we know, to drive the op amp into saturation.
Thermal Drift
Like most other parameters, VOS is temperature-dependent, a feature expressed in
terms of the temperature coefﬁcient
TC(VOS) = ∂VOS
∂T
(5.22)
where T is absolute temperature, in kelvins, and TC(VOS) is in microvolts per degree
Celsius. For low-cost, general-purpose op amps such as the 741, TC(VOS) is typically

240
CHAPTER 5
Static Op Amp
Limitations
on the order of 5 μV/◦C. Thermal drift stems from inherent mismatches as well as
thermal gradients across the two halves of the input stage. Op amps speciﬁcally
designed for low-input offset also tend to exhibit lower thermal drifts, thanks to
superior matching and thermal tracking at the input stage. The OP77 has TC(VOS) =
0.1 μV/◦C typical, 0.3 μV/◦C maximum.
Using the average value of the temperature coefﬁcient, one can estimate VOS at
a temperature other than 25 ◦C as
VOS(T ) ∼= VOS(25 ◦C) + TC(VOS)avg × (T −25 ◦C)
(5.23)
For instance, an op amp with VOS(25 ◦C) = 1 mV and TC(VOS)avg = 5 μV/◦C
would have VOS(70 ◦C) = 1 mV + (5 μV) × (70 −25) = 1.225 mV.
Common-Mode Rejection Ratio (CMRR)
In the absence of input offset, an op amp should respond only to the voltage difference
between its inputs, or vO = a(vP −vN). A practical op amp is somewhat sensitive
also to the common-mode input voltage vCM = (vP +vN)/2. Its transfer character-
istic is thus vO = a(vP −vN)+acmvCM, where a is the differential-mode gain, and
acm is the common-mode gain. Rewriting as vO = a[vP −vN + (acm/a)vCM],
and recalling that the ratio a/acm is the common-mode rejection ratio CMRR,
we have
vO = a

vP +
vCM
CMRR −vN

Comparison with Eq. (5.18) indicates that the sensitivity to vCM can be modeled
with an input-offset-voltage term of value vCM/CMRR. The common-mode sensi-
tivity stems from the fact that a change in vCM will alter the operating points of the
input-stage transistors and cause a change at the output. It is comforting to know
that such a complex phenomenon can be reﬂected to the input in the form of a mere
offset error! We thus redeﬁne the CMRR as
1
CMRR = ∂VOS
∂vCM
(5.24)
and interpret it as the change in VOS brought about by a 1-V change in vCM.
We express 1/CMRR in microvolts per volt. Because of stray capacitances, the
CMRR deteriorates with frequency. Typically, it is high from dc to a few tens
or a few hundreds of hertz, after which it rolls off with frequency at the rate of
−20 dB/dec.
Data sheets usually give CMRR in decibels. As we know, the conversion to
microvolts per volt is readily accomplished via
1
CMRR = 10−CMRRdB/20
(5.25)
where CMRRdB represents the decibel value of CMRR. From Fig. 5A.4, the dc
ratingsforthe741opampareCMRRdB = 90dBtypical,70dBminimum,indicating
that VOS changes with vCM at the rate of 1/CMRR = 10−90/20 = 31.6 μV/V typical,

241
SECTION 5.4
Input Offset
Voltage
and 10−70/20 = 316 μV/V maximum. The OP77 op amp has 1/CMRR = 0.1μ V/V
typical, 1 μV/V maximum. Figure 5A.6 shows that the CMRR of the 741 starts to
roll off just above 100 Hz.
Since op amps keep vN fairly close to vP, we can write vCM ∼= vP. The CMRR
is of no concern in inverting applications, where vP = 0. However, it may pose
problems when vP is allowed to swing, as in an instrumentation ampliﬁer.
EXAMPLE 5.4. The difference ampliﬁer of Fig. 2.13a uses a 741 op amp and a perfectly
matched resistance set with R1 = 10 k and R2 = 100 k. Suppose the inputs are tied
together and driven with a common signal vI. Estimate the typical change in vO if (a) vI
is slowly changed from 0 to 10 V, and (b) vI is a 10-kHz, 10-V peak-to-peak sine
wave.
Solution.
(a) At dc we have 1/CMRR = 10−90/20 = 31.6 μV/V, typical. The common-mode
change at the op amp input pins is vP = [R2/(R1 + R2)]vI = [100/(10 +
100)]10 = 9.09 V. Thus, VOS = (1/CMRR)vP = 31.6 × 9.09 = 287 μV. The dc
noise gain is 1 + R2/R1 = 11 V/V. Hence, vO = 11 × 287 = 3.16 mV.
(b) From the CMRR curve of Fig. 5A.6 we ﬁnd CMRRdB(10 kHz) ∼= 57 dB. So,
1/CMRR = 10−57/20 = 1.41 mV/V, VOS = 1.41 × 9.09 = 12.8 mV (peak-
to-peak), and vO = 11 × 12.8 = 0.141 V (peak-to-peak). The output error at
10 kHz is much worse than at dc.
Power-Supply Rejection Ratio (PSRR)
If we change one of the op amp supply voltages VS by a given amount VS, the
operating points of the internal transistors will be altered, generally causing a small
change in vO. By analogy with the CMRR, we model this phenomenon with a change
in the input offset voltage, which we express in terms of the power-supply rejection
ratio (PSRR) as (1/PSRR) × VS. The parameter
1
PSRR = ∂VOS
∂VS
(5.26)
represents the change in VOS brought about by a 1-V change in VS, and is expressed
in microvolts per volt. Like the CMRR, the PSRR deteriorates with frequency.
Some data sheets give separate PSRR ratings, one for changes in VCC and the
other for changes in VEE. Others specify the PSRR for VCC and VEE changing
symmetrically. The PSRRdB ratings of most op amps fall in the range of 80 dB to
120 dB. The devices of superior matching usually offer the highest PSRRs. From
Fig. 5A.4, the 1/PSRR ratings for the 741C, which are given for symmetric supply
changes, are 30 μV/V typical, 150 μV/V maximum. This means that changing, for
instance,thesupplyvoltagesfrom±15Vto±12VyieldsVOS = (1/PSRR)VS =
(30 μV)(15 −12) = ±90 μV typical, ±450 μV maximum. The OP77 op amp has
1/PSRR = 0.7 μV/V typical, 3 μV/V maximum.
When the op amp is powered from well-regulated and properly bypassed sup-
plies, the effect of the PSRR is usually negligible. Otherwise, any variation on the
supply busses will induce a corresponding variation in VOS, which in turn is ampli-
ﬁed by the noise gain. A classic example is offered by audio preampliﬁers, where
the residual 60 Hz (or 120 Hz) ripple on the supply rails may cause intolerable hum

242
CHAPTER 5
Static Op Amp
Limitations
at the output. Another case in point is offered by switchmode power supplies, whose
high-frequency ripple is usually inadequately rejected by op amps, indicating that
these supplies are unsuited to high-precision analog circuitry.
EXAMPLE 5.5.
A 741 op amp is connected as in Fig. 5.13a with R1 = 100  and
R2 = 100 k. Predict the typical as well as the maximum ripple at the output for a
power-supply ripple of 0.1 V (peak-to-peak) at 120 Hz.
Solution. The 741 data sheets do not show the PSRR rolloff with frequency, so let us use
the ratings given at dc, keeping in mind that the results will be optimistic. The induced
ripple at the input is VOS = (30 μV)0.1 = 3 μV typical, 15 μV maximum (peak-
to-peak). The noise gain is 1 + R2/R1 ∼= 1000 V/V, so the output ripple is vO =
3 mV typical, 15 mV maximum (peak-to-peak).
Change of VOS with the Output Swing
In a practical op amp the open-loop gain a is ﬁnite, so the difference vP −vN changes
also with the output swing vO by the amount vO/a. This effect can conveniently
be regarded as an effective offset voltage change VOS = vO/a. Even an op amp
with VOS = 0 for vO = 0 will exhibit some input offset for vO ̸= 0. To illustrate
with a numerical example, consider the inverting ampliﬁer of Fig. 5.14a, designed to
provide a closed-loop gain of −18/2 = −9 V/V using an op amp with a = 104 V/V.
This circuit has β = 0.1, T = 103, and A = −9/(1 + 1/103) = −8.991 V/V. With
vI = 1.0 V the op amp gives vO = AvI = −8.991 V, and to sustain this voltage
it needs vN = −vO/a = +0.8991 mV. Alternatively, we can regard the op amp as
ideal (a = ∞) but afﬂicted by an input offset voltage VOS = 0.8991 mV to account
for the closed-loop gain error due to ﬁnite a. This alternative viewpoint is depicted
in Fig. 5.14b. The two viewpoints are contrasted mathematically as
vO = Aideal
1
1 + 1/(aβ)vI
vO = AidealvI + 1
β VOS
Note how the second viewpoint differentiates between the signal gain Aideal and the
noise gain 1/β. It also provides yet another insightful interpretation of the gain error,
namely, a form of input noise VOS.
+
–
R1
R2
104
vO
(a)
vI
2.0 kΩ
1.0 V
18 kΩ
−8.991 V
0.8991 mV
+
–
+
–
R1
R2
`
vO
(b)
vI
2.0 kΩ
1.0 V
+
–
18 kΩ
−8.991 V
0.8991 mV
0.8991 mV
+
–
FIGURE 5.14
Using the input offset voltage to model the effect of ﬁnite open-loop gain a.

243
SECTION 5.5
Low-Input-Offset-
Voltage Op
Amps
Complete Expression for the Input Offset Voltage VOS
We summarize this section with a comprehensive expression for VOS,
VOS = VOS0 + TC(VOS)T + vP
CMRR + VS
PSRR + vO
a
(5.27)
where VOS0, the initial input offset voltage, is the value of VOS at some reference
operating point, such as ambient temperature, nominal supply voltages, and vp and
vO halfway between the supply voltages. This parameter itself drifts with time. As an
example, the OP77 has a long-term stability of 0.2 μV/month. In error-budget anal-
ysis, the various offset changes are combined additively when we wish to estimate
the worst-case change, and in root-sum-square (rss) fashion when we are interested
in the most probable change. Looking back at Eq. (5.27), we ﬁnd it remarkable that
all the op amp imperfections considered thus far lend themselves to be modeled via
mere VOS components regardless of their complexity. Also, by reducing them to
a common form, we can easily compare them against each other, and decide what
measures to take if we wish to reduce the intolerably large ones.
EXAMPLE 5.6.
An op amp has the following ratings: a = 105 V/V typical, 104 V/V
minimum, TC(VOS)avg = 3 μV/◦C, and CMRRdB = PSRRdB = 100 dB typical, 80 dB
minimum. Estimate the worst-case as well as the most probable change in VOS over the
following range of operating conditions: 0 ◦C ≤T ≤70 ◦C, VS = ±7.5 V ± 10%,
−1 V ≤vP ≤+1 V, and −5 V ≤vO ≤+5 V.
Solution.
The thermal change from room temperature is VOS1 = (3 μV/◦C)(70 −
25)◦C = 135 μV. With 1/CMRR = 1/PSRR = 10−100/20 = 10 μV/V typical, 100 μV/V
maximum, the changes with vP and VS are VOS2 = (±1 V)/CMRR = ±10 μV
typical, ±100 μV maximum; VOS3 = 2 × (±0.75 V)/PSRR = ±15 μV typical,
±150 μV maximum. Finally, the change with vO is VOS4 = (±5 V)/a = ±50 μV typi-
cal, ±500 μV maximum. The worst-case change in VOS is ±(135 + 100 + 150 + 500) =
±885 μV. The most probable change is ±(1352 + 102 + 152 + 502)1/2 = ±145 μV.
5.5
LOW-INPUT-OFFSET-VOLTAGE OP AMPS
The initial input offset voltage of an op amp is due primarily to mismatches in the
transistors of its input stage. Here we shall consider two representative cases, the
bipolar op amp of Fig. 5.1 and the CMOS op amp of Fig. 5.4a, but without dwelling
on the detailed derivations, which are beyond our scope here.
Bipolar Input Offset Voltage
Mismatches are random phenomena, so we are interested in the most probable input
offset voltage of the Q1-Q2-Q3-Q4 structure of Fig. 5.1. This takes on the form3
VOS(BJT) ∼= VT




	
Isp
Isp

2
+
Isn
Isn
2
(5.28)

244
CHAPTER 5
Static Op Amp
Limitations
where VT = kT/q is the thermal voltage, proportional to absolute temperature
T (VT ∼= 26 mV at room temperature); Isn and Isp are the collector saturation
currents appearing in the BJT i-v characteristics, IC(npn) = Isn exp(VBE/VT ) and
IC(pnp) = Isp exp(VEB/VT ); the ratios Isp/Isp and Isn/Isn represent fractional
variation of Isp and Is. BJT saturation currents take on the common form4
Is = q DB
NB
× n2
i (T ) × AE
WB
(5.29)
where DB and NB are the minority-carrier diffusion constant and doping concentra-
tion in the base region, n2
i (T ) is the intrinsic carrier concentration, a strong function
of T , and AE and WB are the emitter-junction area and the base-region width. It
is apparent that in the case of perfectly matched BJT pairs we have Isn = 0 and
Isp = 0, so VOS = 0. On the other hand, with typical mismatches of, say, 5%
we have VOS = (26 mV)(0.052 + 0.052)1/2 = 1.84 mV at room temperature. The
thermal drift is TC(VOS) = ∂VOS/∂T = k/q, or
TC(VOS) = VOS
T
(5.30)
indicating that at room temperature (T = 300 K) the bipolar structure exhibits a
TC(VOS) of 3.3 μV/◦C for every millivolt of offset voltage.
CMOS Offset Voltage
The most probable input offset voltage of the M1-M2-M3-M4 stage of Fig. 5.4a
takes on the form4
VOS(CMOS) ∼= VOVp
2




kn
kn
2
+
	
kp
kp

2
+
	
Vtn
0.5VOV p

2
+
	
Vtp
0.5VOV p

2
(5.31)
where VOVp is the overdrive voltage of the pMOSFETs; Vtn and Vtp are the threshold
voltages of the nMOSFETs and pMOSFETs; kn and kp are the device transconduc-
tance parameters appearing in the MOSFET i-v characteristics, ID(nMOSFET) =
(kn/2)V 2
OVn and ID(pMOSFET) = (kp/2)V 2
OV p. These parameters are
kn = μn
εox
tox
Wn
Ln
kp = μp
εox
tox
Wp
L p
(5.32)
Here, μn and μp are the electron and hole mobilities, εox and tox are the permittivity
and the thickness of the gate-body oxide layer, and Wn/Ln and Wp/L p are the
channel width/length ratios of the nMOSFET and the pMOSFET.
Matching Considerations
Mismatches in integrated circuits stem from ﬂuctuations in doping and device di-
mensions, as well as mechanical stress and others. Doping ﬂuctuations affect Isn and

245
SECTION 5.5
Low-Input-Offset-
Voltage Op
Amps
B1
B2
Q1B
Q1A
Q1A
Q2A
Q1B
Q2B
C1
C2
Q2A
E
Q2B
(a)
(b)
B
B
B
B
E
E
E
E
C
C
C
C
FIGURE 5.15
Common-centroid topology: (a) layout and (b) interconnections.
Isp (via NB), and Vtn and Vtp. Dimension ﬂuctuations affect AE/WB ratios, W/L
ratios, and the oxide thickness tox. A common way of reducing the sensitivity to dop-
ing irregularities and edge resolution is by fabricating input-stage BJTs with large
emitter areas AE, and input-stage MOSFETs with large channel dimensions W and
L (in CMOS op amps, large transistor sizes result also in better noise performance,
a topic addressed in Chapter 7).
Another important form of mismatch stems from thermal gradients across the
chip, which affect VBE and VE B in BJTs, and Vtn and Vtp in MOSFETs. It is worth
remembering the following thermal coefﬁcients:
TC(VBE) ∼= TC(VE B) ∼= −2 mV/◦C
TC(Vtp) ∼= −TC(Vtn) ∼= +2 mV/◦C
This means that a temperature difference of just 1◦C between the transistors of
a differential pair would contribute 2 mV to VOS! The input-stage sensitivity to
thermal gradients is reduced by a symmetrical device placement technique known
as common-centroid layout.2,3 As exempliﬁed in Fig. 5.15 for the case of a bipolar
input pair, each transistor is made up of two identical halves connected in parallel,
but laid out diagonally opposite to each other. The resulting quad structure pro-
vides a multifold symmetry that tends to cancel out the effects of gradient-induced
mismatches.
Offset Voltage Trimming
Op amp manufacturers reduce VOS further via on-chip trimming techniques.2
A popular class involves the physical modiﬁcation of one of the two halves
making up the input stage, either by means of a laser trim, or by selectively shorting
or opening suitable trimming links. The concept is illustrated in Fig. 5.16 for the case
of the industry-standard OP07 op amp, which pioneered this technique (for more
details, search “OP07” on the web). Each collector resistor is made up of a ﬁxed
part Rc in series with a string of smaller, binary-weighted resistors, each having a
reverse-biased junction in parallel with it. During the wafer-probing stage the inputs
are shorted together, the output is measured, and a suitable algorithm speciﬁes which

246
CHAPTER 5
Static Op Amp
Limitations
4R
2R
4R
2R
R
R
VCC
VEE
IA
Rc
VC1
VC2
Rc
Q1
Q2
To
second
stage
Inputs
FIGURE 5.16
On-chip VOS trimming using shortable links.
links must be closed to drive the output close to zero. For instance, if a mismatch
between Q1 and Q2 results in VC1 < VC2, we need to selectively short some of
Q1’s resistors in order to raise VC1 until it approaches VC2, giving the appearance of
offsetless behavior. A switch is closed by passing a large reverse current through the
corresponding diode, which then becomes a short circuit. Thanks to this technique,
also known as zener zapping, the OP07E version offers VOS = 30 μV and TC(VOS)
= 0.3 μV/◦C.
A variant of this scheme uses aluminum fuse links to form initially closed
switches. During the trim phase the switches are selectively opened via suitable
current pulses.
Another class of trimming schemes, popular especially with CMOS op amps,
uses on-chip nonvolatile memory to store trim data that are then converted to suitable
adjustment currents via on-chip D/A converters.2
Autozero and Chopper-Stabilized Op Amps
On-chip trimming nulls VOS at a speciﬁc set of environmental and operating condi-
tions. As these conditions change, so does VOS. To meet the stringent requirements

247
SECTION 5.5
Low-Input-Offset-
Voltage Op
Amps
vO
+
–
OA1
vN
vP
+
–
OA2
C2
C1
S
S
A
A
Null
Null
FIGURE 5.17
Chopper-stabilized op amp (CSOA).
of high-precision applications, special techniques have been developed to effectively
reduce the input offset as well as low-frequency noise even further. Two popular such
methods are the autozero (AZ) and chopper stabilization (CS) techniques. The AZ
technique is a sampling technique6 that samples the offset and low-frequency noise
and then subtracts it from the contaminated signal to give offset-free appearance.
The CS technique is a modulation technique6 that modulates the input signal to a
higher frequency where there is no dc offset or low-frequency noise, and then de-
modulates the ampliﬁed signal thus stripped of offset and low-frequency errors back
to the baseband.
Figure 5.17 illustrates the AZ principle for the case of the ICL7650S op amp,
the ﬁrst popular op amp to realize this technique in monolithic form. The heart of the
device is OA1, a conventional, high-speed ampliﬁer referred to as the main ampliﬁer.
A second ampliﬁer, called the nulling ampliﬁer and denoted as OA2, continuously
monitors OA1’s input offset error VOS1 and drives it to zero by applying a suitable
correcting voltage at OA1’s null pin. This mode of operation is called the sampling
mode.
Note, however, that OA2 too has an input offset VOS2, so it must correct its own
error before attempting to improve OA2’s error. This is achieved by momentarily
disconnecting OA2 from the main ampliﬁer, shorting its inputs together, and coupling
its output to its own null pin. This mode, referred to as the autozero mode, is activated
by ﬂipping the MOS switches from the S (sampling) position to the A (autozero)
position. During the autozero mode, the correction voltage for OA1 is momentarily
held by C1, which therefore acts as an analog memory for this voltage. Similarly,
C2 holds the correction voltage for OA2 during the sampling mode.
Alternation between the two modes takes place at a typical rate of a few hundred
cyclespersecond,andiscontrolledbyanon-chiposcillator,makingtheAZoperation
transparent to the user. The error-holding capacitors (0.1 μF for the aforementioned
ICL7650S) are supplied off-chip by the user. The room-temperature rating for the
ICL7650S is VOS = ±0.7 μV.
Like AZ op amps, CS op amps also utilize a pair of capacitors to realize the mod-
ulation/demodulation function. In some devices these capacitors are encapsulated

248
CHAPTER 5
Static Op Amp
Limitations
in the IC package itself to save space. Examples of this type of CS op amp are
the LTC1050 with VOS = 0.5 μV and TC(VOS) = 0.01 μV/◦C typical, and the
MAX420 with VOS = 1 μV and TC(VOS) = 0.02 μV/◦C.
The impressive dc speciﬁcations of AZ and CS op amps do not come for free,
however. Since the nulling circuit is a sampled-data system, clock-feedthrough noise
and frequency aliasing problems arise, which need be taken into consideration when
selecting the device best suited to the application.
AZ and CS op amps can be used either alone or as part of composite ampli-
ﬁers to improve existing input speciﬁcations.7 To fully realize these speciﬁcations,
considerable attention must be paid to circuit board layout and construction.7 Of
particular concern are input leakage currents and thermocouple effects arising at the
junction of dissimilar metals. They can grossly degrade the input speciﬁcations of
the device and completely defeat what has been so painstakingly achieved in terms
of circuit design. Consult the data sheets for valuable hints in this regard.
5.6
INPUT OFFSET ERROR AND COMPENSATION TECHNIQUES
We are now ready to investigate the effect of IOS and VOS acting simultaneously.
We begin with the familiar ampliﬁers of Fig. 5.18 (ignore the 10-k potentiometers
for the time being).
Using Eqs. (5.12) and (5.20), along with the superposition principle, it is readily
seen that both circuits yield
vO = AsvI + EO
(5.33a)
EO =

1 + R2
R1

[VOS −(R1 ∥R2)IOS] = 1
β EI
(5.33b)
where As = −R2/R1 for the inverting ampliﬁer, and As = 1 + R2/R1 for the non-
inverting one. We call As the signal gain to distinguish it from the dc noise gain,
which is 1/β = 1 + R2/R1 for both circuits. Moreover, EI = VOS −(R1 ∥R2)IOS
is the total offset error referred to the input, and EO the total offset error re-
ferred to the output. The negative sign does not necessarily imply a tendency by
+
–
R1
R2
vO
vI
(a)
(b)
+
–
vO
+
R2
R1
R1   R2
R1   R2
741
741
10 kΩ
2
2
3
3
6
vI
+
5
5
6
10 kΩ
1
1
–15 V
–15 V
FIGURE 5.18
(a) Inverting, and (b) noninverting ampliﬁers with internal offset-error nulling.

249
SECTION 5.6
Input Offset Error
and Compensation
Techniques
+
–
R
C
vO
Rp = R
741
2
3
6
vI
5
10 kΩ
1
–15 V
+
FIGURE 5.19
Integrator with internal offset-error
nulling.
the two terms to compensate for each other, since VOS and IOS may be of either
polarity. A prudent designer will take a conservative viewpoint and combine them
additively.
The presence of the output error EO may or may not be a drawback, depending
on the application. In audio applications, where dc voltages are usually blocked out
through capacitive coupling, offset voltages are seldom of major concern. Not so
in low-level signal detection, such as thermocouple or strain-gauge ampliﬁcation,
or in wide dynamic-range applications, such as logarithmic compression and high-
resolution data conversion. Here vI may be of comparable magnitude to EI , so its
information content may easily be obliterated. The problem then arises of reducing
EI below a tolerable level.
Turning next to the integrator of Fig. 5.19, we use Eqs. (5.16) and (5.21) and
the superposition principle to write
vO(t) = −1
RC
 t
0
[vI (ξ) + EI ] dξ + vO(0)
(5.34a)
EI = RIOS −VOS
(5.34b)
Now the effect of VOS and IOS is to offset vI by the error EI . Even with vI = 0, the
output will ramp up or down until saturation is reached.
The input-referred error EI in Eqs. (5.33b) and (5.34b) can be nulled by means
of a suitable trimmer, as we are about to see. However, as we know, trimmers
increase production costs and drift with temperature and time. A wise designer will
try minimizing EI by a combination of circuit tricks, such as resistance scaling and
op amp selection. Only as a last resort should one turn to trimmers. Offset nulling
techniques are classiﬁed as internal and external.
Internal Offset Nulling
Internal nulling is based on the deliberate unbalancing of the input stage to make up
for inherent mismatches and drive the error to zero. This imbalance is introduced by

250
CHAPTER 5
Static Op Amp
Limitations
means of an external trimmer, as recommended in the data sheets. Figure 5.6 shows
the trimmer connection for the internal nulling for the 741 op amp. The input stage
consists of two nominally identical halves: the Q1-Q3-Q5-R1 half to process vP
and the Q2-Q4-Q6-R2 half to process vN. Varying the wiper away from its center
position will place more resistance in parallel with one side and less with the other,
thus unbalancing the circuit. To calibrate the ampliﬁers of Fig. 5.18, we set vI = 0
and we adjust the wiper for vO = 0. To calibrate the integrator of Fig. 5.19, we
set vI = 0 and we adjust the wiper for vO as steady as possible in the vicinity
of 0 V.
From the 741C data sheets of Fig. 5A.3, we note that the offset-voltage adjust-
ment range is typically ±15 mV, indicating that for this compensating scheme to
succeed we must have |EI | < 15 mV. Since the 741C has VOS = 6 mV maximum,
this leaves 9 mV for the offset term due to IOS. If this term exceeds 9 mV, we
must either scale down the external resistances or resort to external nulling, to be
discussed below.
EXAMPLE 5.7.
A 741C op amp is to be used in the circuit of Fig. 5.18a to yield
As = −10 V/V. Specify suitable resistances that will maximize the input resistance Ri
of the circuit.
Solution. Since Ri = R1, we need to maximize R1. Imposing R2 = 10R1, and VOS(max)+
(R1 ∥R2)IOS(max) ≤15 mV, we get R1 ∥R2 ≤(15 mV −6 mV)/(200 nA) = 45 k, or
1/R1 + 1/(10R1) ≥1/(45 k). Solving yields R1 ≤49.5 k. Use the standard values
R1 = 47 k, R2 = 470 k, and Rp = 43 k.
Internal offset nulling can be applied to any of the circuits studied so far. In
general, the nulling scheme varies from one op amp family to another. To ﬁnd
the recommended nulling scheme for a given device, consult the data sheets. We
observe that dual- and quad-op-amp packages usually do not have provisions for
internal nulling due to lack of available pins.
External Offset Nulling
External nulling is based on the injection of an adjustable voltage or current into
the circuit to compensate for its offset error. This scheme does not introduce any
additional imbalances in the input stage, so there is no degradation in drift, CMRR,
or PSRR.
The most convenient point of injection of the correcting signal depends on the
particular circuit. For inverting-type conﬁgurations like the ampliﬁer and integrator
of Fig. 5.20, we simply lift Rp off ground and return it to an adjustable voltage VX.
By the superposition principle, we now have an apparent input error of EI + VX,
and we can always adjust VX to neutralize EI . VX is obtained from a dual reference
source, such as the supply voltages if they are adequately regulated and ﬁltered. In
the circuits shown, we impose RB ≫RC to avoid excessive loading at the wiper,
and RA ≪Rp to avoid perturbing the existing resistance levels. The calibration
procedure is similar to that for internal nulling.

251
SECTION 5.6
Input Offset Error
and Compensation
Techniques
+
–
R1
RC
RA (small)
RA (small)
Rp
RB
R2
vO
(a)
(b)
vI
VX
+
VCC
VEE
+
–
R
RC
Rp
RB
C
vO
vI
VX
+
VCC
VEE
FIGURE 5.20
External offset-error nulling for (a) the inverting ampliﬁer,
and (b) the integrator.
EXAMPLE 5.8.
A 741C op amp is to be used in the circuit of Fig. 5.20a to yield As =
−5 V/V and Ri = 30 k. Specify suitable resistances.
Solution.
R1 = 30 k, R2 = 5R1 = 150 k, and Rp = R1 ∥R2 = 25 k. Use the
standard value Rp = 24 k, and impose RA = 1 k to make up for the difference. We
have EI (max) = VOS(max) + (R1 ∥R2)IOS(max) = 6 mV + (25 k) × (200 nA) = 11 mV.
To be on the safe side, impose −15 mV ≤VX ≤15 mV. Thus, with the wiper all the
way up, we want RA/(RA + RB) = (15 mV)/(15 V), or RB ∼= 103RA = 1 M. Finally,
choose RC = 100 k.
In principle, the foregoing scheme can be applied to any circuit that comes with
a dc return to ground. In the circuit of Fig. 5.21, R1 has been lifted off ground and
returned to the adjustable voltage VX. To avoid upsetting the signal gain, we must
impose Req ≪R1, where Req is the equivalent resistance of the nulling network as
seen by R1 (for RA ≪RB we have Req ∼= RA.) Alternatively, we must decrease R1
to the value R1 −Req.
+
–
R1
RA 
Rp
R2
vO
VX
RC
RB
Req
vI
+
VCC
VEE
(small)
FIGURE 5.21
External offset-error nulling for the noninverting ampliﬁer.

252
CHAPTER 5
Static Op Amp
Limitations
EXAMPLE 5.9.
Assuming a 741C op amp in Fig. 5.21, specify suitable resistances for
(a) As = 5 V/V, and (b) As = 100 V/V.
Solution.
(a) We want As = 1 + R2/R1 = 5, or R2 = 4R1. Pick R1 = 25.5 k, 1%, and R2 =
102 k, 1%. Then Rp ∼= 20 k. Moreover, EO(max) = (1/β)EI (max) = 5[6 mV +
(20 k)×(200 nA)] = 50 mV. To balance this out, we need VX = EO(max)/(−R2/
R1) = 50/(−4) = −12.5 mV. Pick a range of ±15 mV to make sure. To avoid
upsetting As, choose RA ≪R1, say, RA = 100 . Then, imposing RA/(RA+RB) =
(15 mV)/(15 V) yields RB ∼= 103RA = 100 k. Finally, let RC = 100 k.
(b) Now 1 + R2/R1 = 100, or R2 = 99R1. Let R2 = 100 k, so R1 = 1010 . If we
were to use RA = 100  as before, RA would no longer be negligible compared
to R1. So let R1 = 909 , 1%, and RA = 1010 −909 = 101  (use 102 ,
1%), so that the series (R1 + RA) still ensures As = 100 V/V. Moreover, let Rp ∼=
1 k. Then, EO(max) = 100[6 mV + (1 k) × (200 nA)] = 620 mV, and VX =
EO(max)/(−R2/R1) = 620/(−105/909) = −5.6 mV. Pick a range of ±7.5 mV to
make sure. Imposing RA/(RA + RB) = (7.5 mV)/(15 V) gives RB ∼= 2000RA ∼=
200 k. Finally, let RC = 100 k.
In multiple-op amp circuits it is worth seeking ways of nulling the cumulative
offset error with just one adjustment. A classic example is offered by the triple-op
amp IA, where other critical parameters may also need adjustment, such as gain and
CMRR.
InthecircuitofFig.5.22,thevoltage VX isbufferedbythelow-output-impedance
follower OA4 to avoid upsetting bridge balance. The overall CMRR is the combined
result of resistance mismatches and ﬁnite CMRRs of the individual op amps. At dc,
where C1 acts as an open circuit and R9 has thus no effect, we adjust R10 to optimize
R10
RA
R9
499 Ω
VCC
VEE
R4
R1
v2
v1
C1
499 Ω
4.99 kΩ
R3
4.99 kΩ
R2
365 Ω
R8
100 Ω
100 kΩ
100 pF
R6
R5
19.6 kΩ
1 kΩ
R7
20.0 kΩ
–
+
OA1
–
+
OA2
vO
RB
RC
VX
+
–
OA3
+
–
OA4
FIGURE 5.22
Instrumentation ampliﬁer with A = 1 V/mV. (OA1, OA2, and OA3: OP37C; OA4: OP27;
ﬁxed resistances are 0.1%.)

253
SECTION 5.7
Input Voltage
Range/Output
Voltage Swing
the dc CMRR. At some high frequency, where C1 provides a conductive path from
R9’s wiper to ground, we adjust R9 to deliberately unbalance the second stage and
thus optimize the ac CMRR. The circuit is calibrated as follows:
1. With v1 and v2 grounded, adjust RC for vO = 0.
2. Adjust R8 for the desired gain of 1000 V/V.
3. With the inputs tied together to a common source vI , adjust R10 for the minimum
change in vO as vI is switched from −10 V dc to +10 V dc.
4. With vI a 10-kHz, 20-V peak-to-peak sine wave, adjust R9 for the minimum ac
component at the output.
EXAMPLE 5.10.
Specify RA, RB, and RC in Fig. 5.22, given the following maximum
ratings for the OP37C low-noise precision high-speed op amp at T = 25 ◦C: IB = 75 nA,
IOS = ±80 nA, and VOS = 100 μV. Assume ±15-V supplies.
Solution.
EI1 = EI2 = VOS + [R1 ∥(R2 + R8/2)]IB = 10−4 + (5000 ∥208)75 ×
10−9 ∼= 115 μV; EI3 = 10−4 + (500 ∥20,000)80 × 10−9 ∼= 139 μV; EO = A(EI1 +
EI2)+(1/β3)EI3 = 103 ×2×115+(1+20/0.5)139 ∼= 230 mV+5.7 mV = 236 mV.
According to Eq. (2.40) we need −236 mV ≤VX ≤+236 mV. Use 300 mV to make
sure. Then, RA = 2 k, RB = 100 k, RC = 100 k.
Whether internal or external, nulling compensates only for the initial offset
error VOS0. As the operating conditions change, the error will reemerge, and if it
rises above an intolerable level, it must be nulled periodically. The use of AZ or CS
op amps may then be a preferable alternative.
5.7
INPUT VOLTAGE RANGE/OUTPUT VOLTAGE SWING
The input voltage range (IVR) of an op amp is the range of values of vP and vN over
whichtheinputstagewillfunctionproperly,withalltransistorsoperatingintheactive
region, between the extremes of the edge of conduction and the edge of saturation.
Similarly, the output voltage swing (OVS) is the range of values of vO over which
the output stage will function properly, with all transistors operating in the active
region. Pushing vO outside this range will cause it to saturate at VOH or VOL. So
long as an op amp is operated within its IVR and OVS, and within its output current
drive capability, it will force vN to closely track vP and give vO = a(vP −vN).
Since the common-mode input voltage is vIC = (vP −vN)/2 ∼= vP, the IVR is also
called the common-mode IVR. Even though the IVR and OVS are given in the data
sheets, a basic understanding of their origin will better help the user select a device
for a given application. In the following discussion we investigate two representative
cases, the bipolar 741 op amp and the two-stage CMOS op amp.
Input Voltage Range (IVR)
To ﬁnd the IVR of the 741 op amp, refer to the input stage of Fig. 5.6, and use Fig. 5.23
(a) and (b) to visualize the subcircuits responsible for the IVR (note that R1 has
been ignored as it drops only about 10 mV). The upper limit of the IVR is the voltage

254
CHAPTER 5
Static Op Amp
Limitations
VCC
Q8
(a)
(b)
(c)
(d)
Q1
Q5
VCE1(EOS)
VEB8(on)
+
+
+
–
–
–
vP(max)
VBE1(on)
VDD
M7
M1
Q1
Q3
VEC3(EOS)
VEE
VOV7
VSG1
+
+
+
+
–
VBE5(on)
+
–
VBE7(on)
+
–
–
–
–
vP(min)
vN(max)
VBE1(on)
Q7
VSS
M1
M3
VOV1
VGS3
VSG1
+
+
–
+
–
–
vN(min)
FIGURE 5.23
Subcircuits to ﬁnd the IVR of the 741 op amp and of the two-stage CMOS op amp.
vP(max) that brings Q1 to the edge of saturation (EOS). Raising vP further will drive
Q1 insaturationandsubsequentlyturnoffdiode-connected Q8,causingmalfunction.
By KVL, vP(max) = VCC −VEB8(on) −VCE1(EOS) + VBE1(on) ∼= VCC −VCE1(sat),
where identical base-emitter voltage drops have been assumed. The lower limit is
the voltage vP(min) that brings Q3 to the EOS. Lowering vP further will drive Q3 in
saturation and subsequently turn off Q1, causing malfunction. By KVL, vP(min) =
VEE +VBE5(on)+VBE7(on)+VEC3(EOS)+VBE1(on) = VEE +3VBE(on)+VEC3(EOS).
Summarizing,
vP(max) ∼= VCC−VCE1(EOS)
vP(min) ∼= VEE+3VBE(on)+VEC3(EOS)
(5.35)
Next, let us turn to the two-stage CMOS op amp of Fig. 5.4a, and use the
subcircuits of Fig. 5.23 (c) and (d). Working with vN, which in normal operation
tracks vP, we observe that the upper limit of the IVR is the voltage vN(max) that
brings M7 to the EOS, where VSD7 = VOV 7, VOV 7 being M7’s overdrive voltage.
Raising vN further will drive M7 in the triode region and then turn off M1, causing
malfunction. The lower limit is the voltage vN(min) that brings M1 to the EOS
where VSD1 = VOV 1. Lowering vN further will drive M1 in the triode region
and then turn off diode-connected M3, causing malfunction. KVL gives vN(max) =
VDD−VOV 7−VSG1 and vN(min) = VSS+VGS3+VOV 1−VSG1. But, by deﬁnition,
VSG1 = |Vtp| + VOV 1, where Vtp is the threshold voltage of the p-MOSFETs, and
VGS3 = Vtn + VOV 3, where Vtn is the threshold voltage of the n-MOSFETs.
Consequently,
vN(max) = VDD −VOV 7 −|Vtp| −VOV 1
vN(min) = VSS + Vtn + VOV 3 −|Vtp|
(5.36)

255
SECTION 5.7
Input Voltage
Range/Output
Voltage Swing
EXAMPLE 5.11. (a) Find the IVR of the 741 op amp, assuming ±15-V supplies, 0.7-V
base-emitter voltage drops, and 0.2-V EOS voltages. (b) Repeat, but for the CMOS op
amp. Assume ±5-V supplies, 0.75-V threshold voltages, and 0.25-V overdrive voltages
throughout.
Solution.
(a) Applying Eq. (5.35) we get vP(max) ∼= 15 −0.2 = 14.8 V, vP(min) ∼= −15 + 3 ×
0.7 + 0.2 = −12.7 V, so the IVR can be expressed as −12.7 V ≤vC M ≤14.8 V.
(b) Applying Eq. (5.36) we get vN(max) = 5 −0.25 −0.75 −0.25 = 3.75 V, vN(min) =
−5 + 0.75 + 0.25 −0.75 = −4.75 V, so the IVR is −4.75 V ≤vC M ≤3.75 V.
Output Voltage Swing (OVS)
The OVS of the 741 op amp is speciﬁed for a typical load RL = 2 k. With reference
to the complete circuit schematic of Fig. 5A.2, we observe that vO swings positive
by the pull-up action by Q14, as depicted in the subcircuit Fig. 5.24a, and vO swings
negative by the pull-down action by Q20, as depicted in the subcircuit of Fig 5.24b.
The upper limit of the OVS occurs when Q13 is driven to the EOS. Since R6 ≪
RL, we approximate vO(max) ∼= VE14(max) = VCC −VEC13(EOS) −VBE14(on).
If Q13 is driven into full saturation, then vO itself saturates at VO H ∼= VCC −
VEC13(sat) −VBE14(on). The lower limit occurs when Q17 is driven to the EOS,
so vO(min) ∼= VE20 = VE E + VC E17(EOS) + VE B22(on) + VE B20(on). If Q17 is
driven into full saturation, then vO itself saturates at VOL ∼= VE E + VC E17(sat) +
VE B22(on) + VE B20(on). Assuming the data of Example 5.11a, along with 0.1-V
collector-emitter saturation voltages, the 741 has vO(max) ∼= 14.1 V, VO H ∼= 14.2 V,
vO(min) ∼= −13.4 V, and VOL ∼= −13.5 V.
(b)
(a)
VEE
VEC13(EOS)
VBE14(on)
VE14(max)
vO(max)
RL
+
+
–
–
VCC
Q17
+
+
+
–
VCE17(EOS)
–
VEB22(on)
Q14
R6
27 Ω
2 kΩ
Q13
Q22
Q20
–
VEB20(on)
vO(min)
R7
22 Ω
FIGURE 5.24
Subcircuits for the calculations of the OVS of the 741 op amp.

256
CHAPTER 5
Static Op Amp
Limitations
(d)
(c)
(b)
(a)
rDS8
ID8
VDD
vO(max)
RL
M8
VOV8
+
–
VDD
VOH
RL
VSS
RL
M5
VOV5
+
–
vO(min)
VSS
VDD
RL
rDS5
VOL
FIGURE 5.25
Subcircuits to ﬁnd the OVS and saturation voltages of the two-stage CMOS op amp.
To ﬁnd the OVS and saturation voltages of the two-stage CMOS op amp of
Fig. 5.4a, refer to the subcircuits of Fig. 5.25. Positive swings of vO occur under
the pull-up action by M8, so vO(max) = VDD −VOV 8 (see Fig. 5.25a). Pushing vO
above vO(max) will force M8 into its triode region, where it acts as a resistor with a
resistance4 rDS8 = 1/(k8VOV 8). This resistance is ﬁxed because VOV 8 = VOV 6,
which is also ﬁxed. As shown in Fig. 5.25b, RL forms a voltage divider with rDS8,
and only in the limit RL →∞will vO swing all the way to the positive supply rail
to give VO H →VDD.
Negative swings of vO occur under the pull-up action by M5, so vO(min) =
VSS + VOV 5 (see Fig. 5.25c). Pushing vO below vO(min) will force M5 into its
triode region, leading to the situation of Fig. 5.25d. Note that in the limit RL →∞
we have VOL →VSS + rDS5ID5 ̸= VSS, indicating this circuit’s inability to swing
vO all the way to the negative supply rail.
Rail-to-Rail Op Amps
A combination of technological advances and innovative applications has resulted,
over the years, in a progressive reduction of the power-supply voltages, especially in
mixed-mode and portable systems (dual-supply or even single-supply voltages of just
1-2 V are becoming more and more common). In a low supply-voltage system it is
imperative that the dynamic range of analog voltages be maximized, or, equivalently,
that both the IVR and the OVR extend from rail to rail (or even a bit beyond the
rails, if possible). The rail-to-rail concept is illustrated in Fig. 5.26.
Let us examine the IVR ﬁrst. Figure 5.23 and Example 5.11 indicate that the
IVR of the npn input pair extends almost all the way up to the positive supply,
whereas that of a p-channel input pair extends almost all the way down to the
negative supply. However, at the opposite supply side, the IVR is poor because of
the headroom needed to keep the transistors in the forward-active region. In fact, we
can generalize by stating that differential pairs made up of npn BJTs or nMOSFETs
(call them n-type pairs) work well over the upper portion of the signal range, whereas
their complementary pairs, made up of pnp BJTs or pMOSFETs (call them p-type
pairs), work well over the lower portion. As we shall see shortly, an ingenious

257
SECTION 5.7
Input Voltage
Range/Output
Voltage Swing
vO
vI
VCC
VEE
VEE
VCC
vI
vO
+
–
VEE
VCC
FIGURE 5.26
Waveforms for a voltage follower with rail-to-rail input and output capa-
bilities.
solution is to utilize an n-type pair and a p-type pair in parallel to get the best of
both.
Turning next to the OVS, we observe that both Fig. 5.24 and Fig. 5.25 refer
to push-pull stages. However, the stage of Fig. 5.24, known as a common-source
(CS) push-pull, offers better OVS characteristics than that of Fig. 5.23, in turn
known as common-collector (CC) push-pull. This suggests operating the bipolar
stage similarly, that is, as a common-emitter (CE) push-pull.
Figure 5.27 shows a bipolar implementation of the above concepts. When vP
and vN are near VCC, the p-pair Q3-Q4 is inactive, while the n-pair Q1-Q2 gives
vP(max) = VCC −V1 −VC E1(EOS) + VBE1(on). It is apparent that if the IC designer
speciﬁes the bias voltage VB56 so that V1 = VBE1(on) −VC E1(EOS)(∼= 0.7 −
0.2 = 0.5 V), then vP(max) = VCC. The dual situation occurs when vP and vN
are near VE E, in which case the n-pair Q1-Q2 is inactive, while the p-pair Q3-Q4
vO
VCC
R3
IE12
V3
+
–
V1
+
–
vN
vP
VEE
R4
Q7
Q8
VB56
Q3
Q4
Q1
Q2
Class
AB
Driver
Q10
Q9
Q6
R2
Q5
R1
IE34
FIGURE 5.27
Simpliﬁed circuit diagram of a bipolar rail-to-rail op amp.

258
CHAPTER 5
Static Op Amp
Limitations
gives vP(min) = VE E + V3 + VEC3(EOS) −VE B3(on). Again, if V3 = VE B3(on) −
VEC3(EOS)(∼= 0.7 −0.2 = 0.5 V), then vP(min) = VE E, that is, we have a rail-to
rail IVR!
With the CE push-pull output stage shown, the OVS limits are vO(max) =
VCC −VEC9(EOS) and vO(min) = VE E + VC E10(EOS), typically within 0.2-V of
the supply rails. Moreover, the saturation voltages are VO H = VCC −VEC9(sat) and
VOL = VE E + VC E10(sat), typically within 0.1-V of the rails. The OVS superiority
of the CC push-pull comes at the price of a high output resistance (compared with the
very low output resistance of the CC push-pull). This renders the open-loop voltage
gain strongly dependent on the output load.
In the CMOS version of Fig. 5.28, the bias voltages VG56 and VG78 are assumed
to keep the M13-M14 and M9-M10 mirrors at the edge of saturation. Consequently,
vP(max) = VDD −VOV 13 −VOV 1 + VGS1 = VDD −VOV 13 −VOV 1 + (Vtn +
VOV 1) = VDD+Vtn−VOV 13. To get an idea, if Vtn = 0.75 V and VOV 13 = 0.25 V,
then vP(max) = VDD + 0.5 V, that is, the IVR extends a bit above the VDD rail!
Similarly, vP(min) = VSS + VOV 9 −|Vtp|. Assuming likewise |Vtp| = 0.75 V and
VOV 9 = 0.25 V gives vP(min) = VSS −0.5 V, a bit below the VSS rail!
For the OVS and output saturation voltages, the considerations made in connec-
tion with Fig. 5.25 still hold, except that in true push-pull operation M11 is off at the
lower end of the OVS, so in the limit RL →∞we have not only VO H →VDD,
but also VOL →VSS, that is, true rail-to-rail performance!
The user needs to be aware of certain inherent limitations of the above circuits.
As we sweep the common-mode input vC M from the negative supply rail to the
vO
VDD
IS12
VOV9
+
–
VG78
VG56
VOV13
+
–
vN
vP
VG1314
VSS
M10
M9
M7
M8
M3
M4
M1
M2
Class
AB
Driver
M12
M11
M6
M5
M13
M14
IS34
FIGURE 5.28
Simpliﬁed circuit diagram of a CMOS rail-to-rail op amp.

259
SECTION 5.8
Maximum Ratings
positive supply rail, the input stage goes through three modes of operation: near
the low end the p-type pair is on and the n-type pair is off, in the middle region
both pairs are simultaneously on, and near the high end the p-type pair is off and
the n-type pair is on. Accordingly, we witness a change in the input offset voltage
VOS, a change in the input bias/offset currents IB/IOS, and a change in the overall
input-stage gm, which in turn affects the gain as well as the dynamics. For more
details on these variations, along with clever optimization techniques, the reader is
encouraged to consult the literature.8
5.8
MAXIMUM RATINGS
Like all electronic devices, op amps require that the user respect certain electrical
and environmental limits. Exceeding these limits will generally result in malfunction
or even damage. The range of operating temperatures over which op amp ratings are
given are the commercial range (0 ◦C to + 70 ◦C), the industrial range (−25 ◦C to
+85 ◦C), and the military range (−55 ◦C to +125 ◦C).
Absolute Maximum Ratings
These are the ratings that, if exceeded, are likely to cause permanent damage. The
most important ones are the maximum supply voltages, the maximum differential-
mode and common-mode input voltages, and the maximum internal power dissipa-
tion Pmax.
Figure 5A.1 indicates that for the 741C the maximum voltage ratings are, re-
spectively, ±18 V, ±30 V, and ±15 V. (The large differential-mode rating of the
741 is made possible by the lateral pnp BJTs Q3 and Q4.) Exceeding these limits
may trigger internal reverse-breakdown phenomena and other forms of electrical
stress, whose consequences are usually detrimental, such as irreversible degradation
of gain, input bias and offset currents, and noise, or permanent damage to the in-
put stage. It is the user’s responsibility to ensure that the device operates below its
maximum ratings under all possible circuit and signal conditions.
Exceeding Pmax will raise the chip temperature to intolerable levels and cause
internal component damage. The value of Pmax depends on the package type as well
as the ambient temperature. The popular mini DIP package has Pmax = 310 mW
up to 70 ◦C of ambient temperature, and derates linearly by 5.6 mW/◦C beyond
70 ◦C.
EXAMPLE 5.12. What is the maximum current that a mini DIP 741C op amp is allowed
to source at 0 V if T ≤70 ◦C? If T = 100 ◦C?
Solution.
From Fig. 5A.3 we ﬁnd the supply current to be IQ = 2.8 mA maximum.
Recall from Section 1.8 that an op amp sourcing current dissipates P = (VCC−VEE)IQ+
(VCC −VO)IO = 30 × 2.8 + (15 −VO)IO. Imposing P ≤310 mV gives IO(VO =
0) ≤(310 −84)/15 ∼= 15 mA for T ≤70 ◦C. For T = 100 ◦C we have Pmax =
310 −(100 −70)5.6 = 142 mW, so now IO(VO = 0) = (142 −84)/15 ∼= 3.9 mA.

260
CHAPTER 5
Static Op Amp
Limitations
Overload Protection
To prevent excessive power dissipation in case of output overload, op amps are
equipped with protective circuitry designed to limit the output current below a
safety level called the output short-circuit current Isc. The 741C has typically
Isc ∼= 25 mA.
In the 741 diagram of Fig. 5A.2, overload protection is provided by the watchdog
BJTs Q15 and Q21 and the current-sensing resistors R6 and R7. Under normal
conditions these BJTs are off. However, should an output overload condition arise,
such as an accidental short circuit, the resistance sensing the overload current will
develop enough voltage to turn on the corresponding watchdog BJT; this, in turn,
will limit the current through the corresponding output-stage BJT.
To illustrate with an example, suppose the op amp is designed to output a positive
voltage, but an inadvertent output short forces vO to 0 V, as depicted in Fig. 5.29. In
response to this short, the second stage of the op amp will drive vB22 as positive as it
can in a futile attempt to raise vO. Consequently, Q22 will go off and let the entire bias
current of 0.18 mA ﬂow toward the base of Q14. Were it not for the presence of Q15,
Q14 would amplify this current by β14 while sustaining VCE = VCC; the resulting
power dissipation would most likely destroy it. However, with Q15 in place, only
the current iB14(max) = iC14(max)/β14 ∼= [VBE15(on)/R6]/β14 is allowed to reach
the base of Q14, the remainder being diverted to the output short via Q15; hence,
Q14 is protected.
With reference to Fig. 5A.2, we observe that just like Q15 protects Q14 when the
op amp is sourcing current, Q21 protects Q20 during current sinking. However, since
the base of Q20 is a low-impedance node because it is driven by emitter-follower
Q22, the action of Q21 is applied further upstream, via Q23.
iC14
vB22
iB14
iC15
Isc
Q22
Q19
Q18
Q13
R6
0.18 mA
VEE
vO
VCC
Q15
Q14
FIGURE 5.29
Partial illustration of overload protection circuitry for the
741 op amp.

261
Problems
EXAMPLE 5.13. Find all currents in the circuit of Fig. 5.29 if R6 = 27 , β14 = β15 =
250, and VBE15(on) = 0.7 V.
Solution.
Q14 is limited to IC14 = α14IE14 = α14[IR6 + IB15] ∼= IR6 = VBE15(on)/R6 =
0.7/27 ∼= 26 mA. The current reaching the base of Q14 is IB14 = IC14/β14 = 26/250 ∼=
0.104 mA; the remainder, IC15 = 0.18−0.104 ∼= 76 μA, is diverted to the short. Hence,
Isc ∼= IC14 + IC15 ∼= 26 mA.
It is important to realize that during overload the actual output voltage is not what
it should be: the protection circuitry prevents the op amp from properly inﬂuencing
vN, so during overload we generally have vN ̸= vP.
Op amp types are available with much higher output current capabilities than the
741. Aptly referred to as power op amps, they are similar to their low-power coun-
terparts except for the presence of heftier output stages and proper power packaging
to handle the increased dissipation of heat. These op amps usually require heatsink
mounting. Examples of power op amps are the PA04 and the OPA501, with peak
output-current capabilities of 20 A and 10 A, respectively.
PROBLEMS
5.1 Simpliﬁed op amp circuit diagrams
5.1 SupposetheinputstageofFig.5.2a hasitsinputterminalsandoutputterminalconnected
to ground. Moreover, let IA = 20 μA and βFp = 50, and let βFn be so large that we
can ignore the base currents of Q3 and Q4. (a) Assuming perfectly matched transistor
pairs, ﬁnd the input-pin currents IP and IN and the output-pin current IO1. (b) Repeat
if Is2 = 1.1Is1 and Is4 = Is3. (c) Find the voltage VP that needs to be applied in order
to drive IO1 to zero. What are the resulting values of IP and IN?
5.2 Input bias and offset currents
5.2 The circuit of Fig. 5.7a is to be used as an inverting ampliﬁer with a gain of 10 V/V
and is to employ the μA741C op amp. Specify suitable component values to ensure a
maximum output error of 10 mV with minimum power dissipation in the resistors.
5.3 (a) Investigate the effect of IB on the performance of the inverting ampliﬁer of Fig. P1.64
if IB = 10 nA and all resistances are 100 k. (b) What dummy resistance Rp must be
installed in series with the noninverting input to minimize EO?
5.4 Investigate the effect of IB and IOS on the performance of the circuit of Fig. P1.17 if
IB = 100 nA ﬂowing out of the op amp’s input pins, and IOS = 10 nA.
5.5 (a) Assuming the circuit of Fig. P1.65 has R1 = R3 = R5 = 10 k and R2 =
R4 = 20 k, ﬁnd a dummy resistance that, inserted between the noninverting input
and ground, will drive the output error EO to zero for IOS = 0. (b) What is EO if
IOS = 10 nA?
5.6 The circuit of Fig. P5.6 exploits the matching properties of dual op amps to minimize
the overall input current II. (a) Find the condition between R2 and R1 that yields II = 0
when the op amps are perfectly matched. (b) What if there is a 10% mismatch between
the IBs of the op amps?

262
CHAPTER 5
Static Op Amp
Limitations
+
–
vO
+
–
R2
R1
II
vI
+
OA2
OA1
FIGURE P5.6
5.7 (a) Investigate the effect of IOS on the performance of the Deboo integrator. (b) As-
suming C = 1 nF and 100-k resistances throughout, ﬁnd vO(t) if IOS = ±1 nA and
vO(0) = 1 V.
5.8 Investigate the effect of using an op amp with IB = 1 nA and IOS = 0.1 nA in the high-
sensitivity I-V converter of Example 2.2. What dummy resistance Rp would you install
in series with the noninverting input?
5.9 If R4/R3 = R2/R1,thecircuitofFig.P2.21isatrueV-IconverterwithiO = (R2/R1R5)×
(v2 −v1) and Ro = ∞. What if the op amps have input bias currents IB1 and IB2, and
input offset currents IOS1 and IOS2? Is iO affected? Is Ro affected? How would you
modify the circuit to optimize its dc performance?
5.10 Investigate the effect of IB and IOS in the current ampliﬁer of Fig. 2.12a. How would
you modify the circuit to minimize its dc error?
5.11 Assuming the multiple-feedback low-pass ﬁlter of Fig. 3.32 is in dc steady state (i.e.,
all transients have died out), investigate the effect of IB = 50 nA if all resistances are
100 k. What dummy resistor would you use to optimize the dc performance of the
circuit? Hint: Set Vi →0.
5.12 (a) Assuming the low-pass ﬁlter of Example 3.9 is in dc steady state so all capacitors
act as open circuits, ﬁnd the output error EO if IB = 50 nA. Hint: Set Vi →0. (b) How
would you modify the circuit so that EO = 0 for IOS = 0, without adding any extra
circuit elements?
5.3 Low-input-bias-current op amps
5.13 A student is trying to ﬁgure out the technology of a certain unmarked op amp sample
using the circuit of Fig. P5.13. Starting out with C completely discharged, the student
monitors vO with a digital voltmeter and ﬁnds that it takes 1 minute for vO to rise
from 0 V to 1 V. Moreover, after a sufﬁciently long time, vO settles to 4 V. (a) What
conclusions can the student draw? (b) How might the plot of the input bias current IB
over the range −0.5 V ≤vP ≤10.5 V look like?
5.4 Input offset voltage
5.14 A FET-input op amp is connected as in Fig. 5.13a with R1 = 100  and R2 = 33 k,
and gives vO = −0.5 V. The same op amp is then moved to the circuit of Fig. 5.13b with

263
Problems
+
–
10 V
C
100 pF
vO
FIGURE P5.13
R = 100 k and C = 1 nF. Assuming vO(0) = 0 and symmetric saturation voltages
of ±10 V, ﬁnd the time it takes for the output to saturate.
5.15 If R4/R3 = R2/R1, the circuit of Fig. P2.22 is a true V-I converter with iO = R2vI/
(R1R5) and Ro = ∞. What if the op amps have input offset voltages VOS1 and VOS2,
but are otherwise ideal? Is iO affected? Is Ro affected?
5.16 In the circuit of Fig. 5.13a let R1 = 10  and R2 = 100 k, and let the op amp have an
offset drift of 5 μV/◦C. (a) If the op amp has been trimmed for vO(25 ◦C) = 0, estimate
vO(0 ◦C) and vO(70 ◦C). What do you expect their relative polarities to be? (b) If the
same op amp is moved to the circuit of Fig. 5.13b with R = 100 k and C = 1 nF, ﬁnd
vO(t) both at 0 ◦C and at 70 ◦C.
5.17 Investigate the effect of using an op amp with CMRRdB = 100 dB on the output resis-
tance of a Howland current pump made up of four perfectly matched 10-k resistances.
Except for CMRR, the op amp is ideal.
5.18 Investigate the effect of using an op amp with VOS0 = 100 μV and CMRRdB = 100 dB
in a Deboo integrator that uses four perfectly matched 100-k resistances and a 1-nF
capacitance (assume a = ∞). Hint: Find the Norton equivalent seen by the capacitance
for vI = 0.
5.19 Suppose the difference ampliﬁer of Fig. 2.13a is implemented with a JFET op amp and
two perfectly matched resistor pairs R3 = R1 = 1.0 k and R4 = R2 = 100.0 k.
The inputs v1 and v2 are tied together and driven by a common voltage vIC. (a) If it
is found that with vIC = 0 V the circuit gives vO = 5.0 mV, and with vIC = 2.0 V it
gives vO = −1.0 mV, what is the CMRR? (b) If it is found that lowering the supply
voltages by 0.5 V with vIC still at 2.0 V results in vO = +1.0 mV, what is the PSRR?
5.20 Suppose the I-V converter of Fig. 2.2 is implemented with R = 500 k, R1 = 1.0 k,
and R2 = 99 k, and a FET-input op amp. The op amp has a = 100 dB, PSRR = 80 dB,
and VOS0 = 0, and is powered from dual supplies ±VS = ±[5 + 1 sin(2πt)] V. (a)
Sketch and label the circuit, and following the reasoning in connection with Fig. 5.14,
convert it to an equivalent circuit that uses an op amp with a = ∞but with a suitable
input offset voltage VOS to account for the ﬁnite a and ﬁnite PSRR. (b) If we write
vO = AidealiI + EO, what are Aideal and EO?
5.21 Assuming perfectly matched resistances in the difference ampliﬁer of Fig. 2.13a, show
that if we deﬁne the CMRR of the op amp as 1/CMRROA = ∂VOS/∂vCM(OA) and that
of the difference ampliﬁer as 1/CMRRDA = Acm/Adm, where Acm = ∂vO/∂vCM(DA)
and Adm = R2/R1, we then have CMRRDA = CMRROA.

264
CHAPTER 5
Static Op Amp
Limitations
5.22 The difference ampliﬁer of Problem 5.21 uses a 741 op amp with R1 = 1 k and
R2 = 100 k. Find the worst-case CMRR of the circuit for the case of (a) perfectly
matched resistances, and (b) 1% resistances. Comment.
5.23 In the difference ampliﬁer of Problem 5.22 the inputs are tied together and are driven
by vCM = 1 sin(2π ft) V. Using the CMRR plot of Fig. 5A.6, predict the output at f =
1 Hz, 1 kHz, and 10 kHz.
5.24 (a) Assuming perfectly matched op amps and resistances in the dual-op-amp IA of
Fig. 2.23, show that if we deﬁne the CMRR of each op amp as 1/CMRROA = ∂VOS/
∂vCM(OA) and that of the IA as 1/CMRRIA = Acm/Adm, where Acm = ∂vO/∂vCM(DA)
and Adm = 1 + R2/R1, then we have CMRRIA(min) = 0.5 × CMRROA(min). (b) If
an IA with a gain of 100 V/V is implemented with perfectly matched resistances
and a dual OP227A op amp (CMRRdB = 126 dB typical, 114 dB minimum), ﬁnd
the worst-case output change for a 10-V common-mode input change. What is the
corresponding Acm?
5.25 Assuming perfectly matched op amps and resistances in the triple-op amp IA of
Fig. 2.20, derive a relationship between CMRRIA(min) and CMRROA(min), where
1/CMRROA = ∂VOS/∂vCM(OA), and 1/CMRRIA = Acm/Adm.
5.26 In the inverting integrator of Fig. 1.20 let R = 100 k, C = 10 nF, and vI = 0, and
let the capacitor be initially charged such that vO(t = 0) = 10 V. Except for a ﬁnite
open-loop gain of 105 V/V, the op amp is ideal. Find vO(t > 0).
5.27 An op amp with amin = 104 V/V, VOS0(max) = 2 mV, and CMRRdB(min) = PSRRdB(min) =
74 dB is conﬁgured as a voltage follower. (a) Estimate the worst-case departure of vO
from the ideal for vI = 0 V. (b) Repeat with vI = 10 V. (c) Repeat if the supply voltages
are lowered from ±15 V to ±12 V.
5.5 Low-input-offset-voltage op amps
5.28 (a) With reference to the input stage of Fig. 5.2a, show that in case of mismatches in
the Q1-Q2 and Q3-Q4 pairs, the voltage VOS needed to drive iO1 to zero is
VOS = VT ln
 Is1
Is2
Is4
Is3

Hint: Use vN = vP + VOS. (b) Assuming VT = 26 mV, calculate VOS for the follow-
ing 10% mismatch cases: (Is1/Is2)(Is4/Is3) = (1.1)(1.1), (1/1.1)(1.1), (1.1)(1/1.1),
(1/1.1)(1/1.1). Compare with Eq. (5.28) and comment.
5.29 Suppose both the BJTs and the corresponding collector resistance strings in the circuit
of Fig. 5.16 are mismatched. If IA = 100 μA, and Q1’s emitter area is 7.5% larger than
Q2’s, and if it is found that VC1 −VC2 = −15 mV, which resistor string needs to be
trimmed to drive the difference VC1 −VC2 to zero, and by how many ohms?
5.6 Input offset error and compensation techniques
5.30 Consider the circuit obtained from that of Fig. 1.42a by letting vI = 0 and replacing
R3 with a 10-nF capacitor. (a) If R1 = R2 = R4 = 10 k, and the op amp has
VOS = 1.0 mV and IB = 50 nA ﬂowing into the device, obtain an expression for
vO(t). (b) Assuming the capacitor is initially discharged, and the op amp saturates at

265
Problems
±10 V, ﬁnd the time it takes for the op amp to reach saturation. (c) Assuming the op
amp allows for internal offset trimming, how would you proceed to compensate it?
5.31 Repeat Example 5.8, but for the integrator of Fig. 5.20b for the case R = 100 k.
5.32 In the noninverting ampliﬁer of Fig. 1.15a let R1 = 10 , R2 = 10 k, and vI = 0.
The output vO is monitored with a voltmeter and is found to be 0.480 V. If inserting
a 1-M resistor in series with the noninverting input pin gives vO = 0.780 V, but
inserting it in series with the inverting input pin gives vO = 0.230 V, ﬁnd IB, IOS, and
VOS. What is the direction of IB?
5.33 Figure P5.33 shows a widely used test ﬁxture to characterize the op amp referred to
as device under test (DUT). The purpose of OA2, which is assumed ideal, is to keep
DUT’s output near 0 V, or in the middle of the linear region. Find VOS0, IP, IN, IB,
IOS, and the gain a for the DUT, given the following measurements: (a) v2 = −0.75 V
with SW1 and SW2 closed and v1 = 0 V; (b) v2 = +0.30 V with SW1 closed, SW2
open, and v1 = 0 V; (c) v2 = −1.70 V with SW1 open, SW2 closed, and v1 = 0 V;
(d) v2 = −0.25 V with SW1 and SW2 closed, and v1 = −10 V.
+
–
C
v2
v1
100 kΩ
100 kΩ
100 kΩ
49.9 kΩ
100 Ω
100 Ω
100 kΩ
OA2
+
DUT
SW2
SW1
+
–
FIGURE P5.33
5.34 (a) In the circuit of Fig. P1.15 obtain an expression for the output error EO as a function
of IP, IN, and VOS. (b) Repeat, but for the circuit of Fig. P1.16. Hint: In each case set
the independent source to zero.
5.35 Repeat Problem 5.34, but for the circuits of Figs. P1.18 and P1.19.
5.36 (a) Find output error EO for the I-V converter of Fig. 2.1. (b) Repeat if the noninverting
input pin is returned to ground via a dummy resistance Rp = R. (c) Devise a scheme
for the external nulling of EO if R = 1 M, IOS = 1 nA maximum, and VOS = 1 mV
maximum.
5.37 What input-stage technology would you choose for the op amp of the high-sensitivity
I-V converter of Example 2.2? How would you modify the circuit for a minimum output
error EO? How would you make provision for the external nulling of EO?
5.38 Using the OP227A dual-precision op amp (VOS(max) = 80 μV, IB(max) = ±40 nA,
IOS(max) = 35 nA, and CMRRdB(min) = 114 dB), design a dual-op amp IA with a gain
of 100 V/V. Assuming perfectly matched resistances, what is the maximum output error
for v1 = v2 = 0? For v1 = v2 = 10 V?

266
CHAPTER 5
Static Op Amp
Limitations
5.39 If R2 + R3 = R1, the circuit of Fig. P2.33 is a true V-I converter with iO = vI/R3
and Ro = ∞. What if the op amps have nonzero input bias and offset currents and
offset voltages? Is iO affected? Is Ro affected? How would you make provisions for
minimizing the total error? For externally nulling it?
5.40 (a) Investigate the effect of the offset voltages VOS1 and VOS2 on the performance of the
dual-op-amp transducer ampliﬁer of Fig. 2.40 for the case δ = 0. (b) Devise a scheme
to externally null the output offset error, and illustrate how it works.
5.41 Repeat Problem 5.40, but for the transducer ampliﬁer of Fig. P2.62.
5.42 An I-V converter with a sensitivity of 1 V/μA is to be designed using an op amp with
VOS(max) = 1 mV and IOS(max) = 2 nA. Two alternatives are being evaluated, namely,
the circuit of Fig. 2.1 with R = 1 M, and the circuit of Fig. 2.2 with R = 100 k,
R1 = 2.26 k, and R2 = 20 k; both circuits use an appropriate dummy resistance
Rp to minimize the error due to IB. Which circuit is preferable from the viewpoint of
minimizing the untrimmed output error? What is the main reason?
5.43 Assuming the multiple-feedback band-pass ﬁlter of Example 3.15 is in dc steady state
(i.e., all transients have died out), investigate the effect of IB = 50 nA, IOS = 5 nA,
and VOS = 1 mV upon the circuit’s performance. How would you modify the circuit to
minimize the output error? To null it? Hint: Assume a zero input.
5.44 Repeat Problem 5.43, but for the low-pass KRC ﬁlter of Example 3.8.
5.45 Repeat Problem 5.43, but for the band-bass and band-reject KRC ﬁlters of Exam-
ples 3.13 and 3.14.
5.46 The biquad ﬁlter of Example 3.19 is implemented with FET-input op amps having
maximum input offset voltages of 5 mV. Investigate the effect on circuit performance
and devise a method to trim the output dc error for the low-pass output.
5.7 Input voltage range/output voltage swing
5.47 Find the IVR and OVS of the folded-cascode CMOS op amp of Fig. 5.4b. Assume
±5-V supplies, 0.75-V threshold voltages, and 0.25-V overdrive voltages through-
out. Also, assume the ISS source is generated by a current mirror similar to the M6-
M7 mirror of Fig. 5.4a, and VBIAS is such that the IBIAS current sinks drop 0.25-V
each.
5.48 Suppose OA2 in Fig. 1.47 is a true rail-to-rail op amp conﬁgured for a closed-loop gain
of −2 V/V. (a) Sketch and label vI, vO, and vD if vI = (1.0 V) sin(2π103t). (b) Repeat
if vI = (1.5 V) sin(2π103t). (c) What is the maximum sinusoidal input that will still
result in an undistorted output?
5.8 Maximum ratings
5.49 A 741 op amp is connected as a voltage follower and programmed to give vO = 10 V.
Using the simpliﬁed circuit of Fig. 5.29 with R6 = 27 , βFs of 250, and base-
emitter junction drops of 0.7 V, ﬁnd vB22, iC14, iC15, PQ14, and vO if the output load is
(a) RL = 2 k, and (b) RL = 200 .

267
References
REFERENCES
1. J. E. Solomon, “The Monolithic Operational Ampliﬁer: A Tutorial Study,” IEEE J.
Solid-State Circuits, Vol. SC-9, December 1974, pp. 314–332.
2. W. Jung, Op Amp Applications Handbook (Analog Devices Series), Elsevier/Newnes,
Oxford, UK, 2005.
3. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009.
4. S. Franco, Analog Circuit Design—Discrete and Integrated, McGraw-Hill, New York,
2014.
5. G. R. Boyle, B. M. Cohn, D. O. Pederson, and J. E. Solomon, “Macromodeling of
Integrated Circuit Operational Ampliﬁers,” IEEE J. Solid-State Circuits, Vol. SC-9,
December 1974, pp. 353–363.
6. C. C. Enz and G. C. Temes, “Circuit Techniques for Reducing the Effects of Op-Amp
Imperfections: Autozeroing, Correlated Double Sampling, and Chopper Stabilization,”
IEEE Proceedings, Vol. 84, No. 11, November 1996, pp. 1584–1614.
7. J. Williams, “Chopper-Stabilized Monolithic Op Amp Suits Diverse Uses,” EDN,
Feb. 21, 1985, pp. 305–312; and “Chopper Ampliﬁer Improves Operation of Diverse
Circuits,” EDN, Mar. 7, 1985, pp. 189–207.
8. J. Huijsing, Operational Ampliﬁers—Theory and Design, 2nd ed., Springer, Dordrecht,
2011.

268
CHAPTER 5
Static Op Amp
Limitations
APPENDIX 5A
DATA SHEETS OF THE μA741 OP AMP∗
FIGURE 5A.1
∗Copyright, Fairchild Semiconductor Corporation, 1987. Used by permission.

269
APPENDIX 5A
Data Sheets of the
μA741 Op Amp
FIGURE 5A.2

270
CHAPTER 5
Static Op Amp
Limitations
FIGURE 5A.3

271
APPENDIX 5A
Data Sheets of the
μA741 Op Amp
FIGURE 5A.4

272
CHAPTER 5
Static Op Amp
Limitations
FIGURE 5A.5

273
APPENDIX 5A
Data Sheets of the
μA741 Op Amp
FIGURE 5A.6

274
CHAPTER 5
Static Op Amp
Limitations
FIGURE 5A.7

275
APPENDIX 5A
Data Sheets of the
μA741 Op Amp
FIGURE 5A.8

276
CHAPTER 5
Static Op Amp
Limitations
FIGURE 5A.9

6
DYNAMIC OP AMP LIMITATIONS
6.1 Open-Loop Frequency Response
6.2 Closed-Loop Frequency Response
6.3 Input and Output Impedances
6.4 Transient Response
6.5 Effect of Finite GBP on Integrator Circuits
6.6 Effect of Finite GBP on Filters
6.7 Current-Feedback Ampliﬁers
Problems
References
Uptonowwehaveassumedopampswithextremelyhighopen-loopgains,regardless
of frequency. A practical op amp provides high gain only from dc up to a given
frequency,beyondwhichgaindecreaseswithfrequencyandtheoutputisalsodelayed
with respect to the input. These limitations have a profound impact on the closed-loop
characteristics of a circuit: they affect both its frequency and transient responses,
and also its input and output impedances. In this chapter we study the unity-gain
frequency ft, the gain-bandwidth product (GBP), the closed-loop bandwidth fB, the
full-power bandwidth (FPB), the rise time tR, the slew rate (SR), and the settling time
tS, as well as the impact on the responses and the terminal impedances of familiar
circuits such as the four ampliﬁer types, and ﬁlters. We also take the opportunity to
discuss current-feedback ampliﬁers (CFAs), a class of op amps designed speciﬁcally
for high-speed applications.
Since data sheets show frequency responses in terms of the cyclical frequency f,
we shall work with this frequency rather than with the angular frequency ω. One can
readily convert from one frequency to the other via ω ↔2π f . Moreover, a frequency
response H( j f ) is readily converted to the s-domain by letting j f →s/2π.
The open-loop response a( j f ) of an op amp can be quite complex and will be
investigated in general terms in Chapter 8. In the present chapter we limit ourselves
277

278
CHAPTER 6
Dynamic Op Amp
Limitations
to the particular but most common case of internally compensated op amps, that
is, op amps incorporating on-chip components to stabilize their behavior against
unwanted oscillations. Most op amps are compensated so that a( j f ) is dominated
by a single low-frequency pole.
Chapter Highlights
The chapter begins with the open-loop frequency response of internally compensated
op amps and how it affects the loop gain, and, hence, all closed-loop parameters.
The chapter provides convenient graphical techniques to facilitate the visualization
of the loop gain as well as the closed-loop gain and input/output impedances of the
four feedback topologies discussed in Chapter 1.
The chapter proceeds to investigate the transient response of resistive op amp
circuits, both for the small-signal case, when the circuit still behaves linearly, and for
the large-signal case, when behavior turns nonlinear and leads to slew-rate limiting.
The chapter makes abundant use of PSpice to display both frequency and transient
responses.
Next, we undertake a detailed investigation of the integrator, which by now has
proved to be a workhorse of electronics. Particular attention is devoted to gain and
phase errors, which in applications such as state-variable and biquad ﬁlters may lead
to instability. At this juncture, the concepts of passive as well as active compensation
are introduced.
The integrator paves the way for the investigation of more complex ﬁlters, start-
ing with ﬁrst-order types, and proceeding to second-order types and to ﬁlter building
blocks such as generalized impedance converters. Although ﬁlter performance can
be deeply affected by the open-loop gain rolloff, it is often possible to meet the
desired speciﬁcation via suitable predistortion techniques. PSpice proves again to
be a most powerful tool for the visualization of ﬁlter departures from ideality as well
as predistortion cures.
The chapter concludes with current-feedback ampliﬁers, whose introduction
has been delayed until now because we need this chapter’s analytical tools to fully
appreciate the inherently fast dynamics of this class of ampliﬁers.
6.1
OPEN-LOOP FREQUENCY RESPONSE
The most common open-loop response is the dominant-pole response, a popular
example of which is the 741 response displayed in Fig. 6.1. As we shall see in
great detail in Chapter 8, this type of response is designed to prevent oscillation in
negative-feedback operation. To understand the basis of the dominant-pole response,
refer to Fig. 6.2, which provides a block diagram of the three-stage op amp circuit
of Fig. 5.1. Here gm1 is the transconductance gain of the ﬁrst stage, and −a2 is the
voltage gain of the second stage, which is an inverting stage. Moreover, Req and Ceq
represent the net equivalent resistance and capacitance between the node common
to the ﬁrst and second stage, and ground.

279
SECTION 6.1
Open-Loop
Frequency
Response
+
–
(a)
+
Vi
I
O
Vo
RL
2.0 kΩ
2
3
4
6
7
0
µA741
–
VCC (15 V)
VEE (−15 V)
0
0
(b)
<) a
Frequency f (Hz)
Gain magnitude (V/V)
102
103
104
105
106
107
0.1
1
0.1
1
10
102
103
104
105
106
10
Phase angle
0°
−140°
−120°
−100°
−80°
−60°
−30°
−20°
|a|
FIGURE 6.1
(a) Using the 741 macromodel to plot (b) the open-loop frequency response of the 741 op
amp. Gain magnitude is plotted as V(O)/V(I), and is in V/V as marked at the left; phase
angle is plotted as P(V(O)/V(I)), and is in degrees as marked at the right.
At low frequencies, where Cc acts as an open circuit, we have vO = 1×(−a2)×
(−ReqiO1) = gm1Reqa2(vP −vN). The low-frequency gain, called the dc gain and
denoted as a0, is thus
a0 = gm1Reqa2
(6.1)
As we know, this is a fairly large number. For the 741 op amp we shall assume the
following working values: gm1 = 189 μA/V, Req = 1.95 M, and a2 = 544 V/V.
SubstitutingintoEq.(6.1)yieldsthefamiliartypicalvaluea0 = 200V/mV,or106dB.
Increasing the operating frequency will bring the impedance of Ceq into play,
causing gain to roll off with frequency because of the low-pass ﬁlter action provided
by Req and Ceq. Gain starts to roll off at the frequency fb that makes |ZCeq| = Req,
or 1/(2π fbCeq) = Req. This frequency, called the dominant-pole frequency, is thus
fb =
1
2π ReqCeq
(6.2)
From the data sheets we ﬁnd that the 741 op amp has typically fb = 5 Hz, indicating
a dominant pole at s = −2π fb = −10π Np/s. Such a low-frequency pole requires
Cc
vP
vN
+
–
gm1
–a2
vO
Ceq
Req
1
iO1
FIGURE 6.2
Simpliﬁed op-amp block diagram.

280
CHAPTER 6
Dynamic Op Amp
Limitations
that for a given Req, Ceq be suitably large. For the 741 op amp Ceq = 1/(2π fbReq) =
1/(2π5×1.95×106) = 16.3 nF. The on-chip fabrication of such a large capacitance
would be prohibitive in terms of the chip area needed. This drawback is ingeniously
avoided by starting out with an acceptable value for Cc, and then exploiting the
multiplicative property of the Miller effect to increase its effective value to Ceq =
(1 + a2)Cc. The 741 uses Cc = 30 pF to achieve Ceq = (1 + 544)30 = 16.3 nF.
Closer inspection of Fig. 6.1b reveals the presence of additional high-frequency
poles because of the steeper rate of magnitude descent and greater phase shift at high
frequencies (see Problem 6.1). Should this shift reach −180◦, feedback would turn
from negative to positive, posing the risk of unwanted oscillations. The reason for
positioning the dominant pole frequency at such a low value (5 Hz for the 741 op
amp) is precisely to ensure that at the frequency of −180◦phase shift the gain
has dropped well below unity so as to render the op amp incapable of sustaining
oscillations (more on this in Chapter 8).
Single-Pole Open-Loop Gain
As we proceed, we shall make the simplifying assumption that the open-loop gain
a(s) possesses just a single pole; this, both to facilitate our mathematical manip-
ulation and to help us develop a basic feel for the effect of the gain rolloff on the
closed-loop parameters. Such a gain shall be expressed in the form
a(s) =
a0
1 + s/ωb
(6.3a)
where s is the complex frequency, a0 is the open-loop dc gain, and −ωb is the s-plane
pole location. Alternatively, we express gain in terms of the frequency f as
a( j f ) =
a0
1 + j f/fb
(6.3b)
where j is the imaginary unit ( j2 = −1), and fb = ωb/(2π) is the open-loop –3-dB
frequency, also called the open-loop bandwidth. We calculate gain magnitude and
phase as
|a( j f )| = mag a( j f ) =
a0

1 + ( f/fb)2
(6.4a)
 a( j f ) = ph a( j f ) = −tan−1( f/fb)
(6.4b)
Magnitude is plotted in Fig. 6.3a. Shown in Fig. 6.3b is an op amp model suitable
for basic PSpice simulations. The model uses PSpice’s Laplace block to simulate
Eq. (6.3a) with a0 = 105 V/V and ωb = 2π(10 Hz), as well as rd = 1 M and
ro = 100 . Once we have gained sufﬁcient insight using this model, we can always
replace it with the macromodel of the op amp we intend to use, and thus investigate
any higher-order effects (compared to a macromodel, the simpliﬁed model offers
the advantage that we can easily alter its parameters as needed).
The gain is high and approximately constant only from dc up to fb. Past fb it
rolls off at the rate of −20 dB/dec, until it drops to 0 dB (or 1 V/V) at f = ft.
This frequency is called the unity-gain frequency, or also the transition frequency,

281
SECTION 6.1
Open-Loop
Frequency
Response
0
a0
fb
f (dec)
(a)
(b)
|a( jf )| (dB)
3 dB
−20 dB/dec
ft
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(P,N)} = {100k/(1+s/62.832)}
0
P
N
O
ro
rd
1 MΩ
FIGURE 6.3
(a) Single-pole open-loop gain, and (b) basic PSpice model to simulate an op amp having
a0 = 105 V/V, fb = 10 Hz, ft = 1 MHz, rd = 1 M, and ro = 100 .
because it marks the transition from ampliﬁcation (positive decibels) to attenuation
(negative decibels). Imposing 1 = a0/

1 + ( ft/fb)2 in Eq. (6.4a) and using the
fact that ft ≫fb, we get
ft = a0 fb
(6.5)
The 741 op amp has typically ft = 200,000 × 5 = 1 MHz. We wish to emphasize
the following special cases:
a( j f )
 f ≪fb →a0 /0◦
(6.6a)
a( j f )
 f = fb = a0
√
2
/−45◦
(6.6b)
a( j f )
 f ≫fb →ft
f /−90◦
(6.6c)
We observe that over the frequency region f ≫fb the op amp behaves as an
integrator, and that its gain-bandwidth product, deﬁned as GBP = |a( j f )| × f , is
constant
GBP = ft
(6.7)
For this reason, op amps with dominant-pole compensation are also referred to as
constant-GBP op amps: increasing (or decreasing) f by a given amount in the region
of integrator behavior will decrease (or increase) |a| by the same amount. This can be
exploited to estimate gain at any frequency above fb. Thus, at f = 100 Hz, the 741
has |a| = ft/f = 106/102 = 10,000 V/V; at f = 1 kHz, it has |a| = 1000 V/V; at
f = 10 kHz, it has |a| = 100 V/V; at f = 100 kHz, it has |a| = 10 V/V, and so forth
(see Fig. 6.1b). Browsing through the manufacturers’ websites will reveal quite a few
op amp families with a gain response of the type of Fig. 6.1b. Most general-purpose
types tend to have GBPs between 500 kHz and 20 MHz, with 1 MHz being one
of the most frequent values. However, for wideband applications, op amp types are
available with much higher GBPs. Current-feedback ampliﬁers, to be discussed in
Section 6.7, are an example.
Thougha0 and fb maybeusefulformathematicalmanipulations,inpracticethey
are ill-deﬁned parameters because so are Req and a2, due to manufacturing process

282
CHAPTER 6
Dynamic Op Amp
Limitations
variations. We shall instead focus on the unity-gain frequency ft, which turns out to
beamorepredictableparameter.Tojustifythisclaim,wenotethatathighfrequencies
the circuit of Fig. 6.2 yields Vo ∼= 1 × ZCc Io1 = [1/( j2π f Cc)]gm1 × (Vp −Vn),
or a = gm1/( j2π f Cc). Comparing with Eq. (6.6c) gives
ft = gm1
2πCc
(6.8a)
As discussed in connection with Eq. (5.7), gm1 = IA/(4VT ). Substituting into
Eq. (6.8a) gives, for the 741 op amp, the alternative expression
ft =
IA
8πVT Cc
(6.8b)
It is possible to design for reasonably stable and predictable values of IA and Cc,
thus resulting in a dependable value for ft. For the 741, ft = (19.6 × 10−6)/(8π ×
0.026 × 30 × 10−12) = 1 MHz.
Graphical Visualization of the Loop Gain T
In Chapter 1 we learned that even though the op amp is a voltage ampliﬁer, through
negative feedback it can function also as a current, transresistance, and transcon-
ductance ampliﬁer. Yet, the op amp responds to voltage, regardless of the feedback
topology in use. In fact, the loop gain T is obtained as the return ratio of voltages,
and T is an intrinsic loop parameter that is independent of the type and location of
the input and output signals. The frequency plot of a( j f ) is usually available from
the data sheets, so we seek a way to visualize also the frequency plot of T ( j f ) in
relation to that of a( j f ). To this end, we express the loop gain in the form
T ( j f ) = a( j f )β( j f )
(6.9)
where β( j f ) is found by (a) setting all input sources to zero, (b) breaking the loop at
the output of the op amp’s dependent source a( j f )Vd, (c) applying an ac test voltage
Vt downstream of the dependent source, (d) ﬁnding Vd, and (e) ﬁnally letting
β( j f ) = −Vd
Vt
(6.10)
(Alternatively, β can be found merely as β = T/a.) Just as T should not be confused
with L of Section 1.6, β should not be confused with b, though the two parameters
may coincide in some cases. In particular, while it is always true that Aideal = 1/b,
in general Aideal ̸= 1/β. (To prevent confusion, avoid using Aideal = 1/b, and
always calculate Aideal as the ratio of the output signal to the input signal in the
limit a →∞.) When necessary to distinguish between the two parameters, we shall
refer to β as the return-ratio feedback factor, and to b as the two-port feedback
factor.
Rewriting Eq. (6.9) as T = a/(1/β) allows us to write |T |dB = 20 log10 |T | =
20 log10 |a| −20 log10(1/β), or
|T |dB = |a|dB −|1/β|dB
(6.11a)
T = a −(1/β)
(6.11b)

283
SECTION 6.2
Closed-Loop
Frequency
Response
a0
1/β0
β
1/β∞
β
0
dB
f  (dec)
ft
a0 β0
β
0
dB
fx
f  (dec)
fb
fx
1/β
a
β
T
T
FIGURE 6.4
In a Bode plot, the loop gain |T | is the
difference between the |a| and |1/β|
curves.
indicating that the Bode plots of T can be found graphically as the difference between
the individual plots of a and 1/β.
Figure 6.4 depicts the magnitude plot. To construct it, we ﬁrst obtain the open-
loop curve from the data sheets. Next, we ﬁnd β using the techniques of Section 1.7,
take its reciprocal 1/β, and then plot |1/β|. Since usually |β| ≤1 V/V, or |β| ≤0 dB,
it follows that |1/β| ≥1 V/V, or |1/β| ≥0 dB; that is, the |1/β| curve extends
above the 0-dB axis. This curve will generally have some breakpoints, though in
many cases it is ﬂat. As shown, its low-frequency and high-frequency asymptotes
are denoted as |1/β0| and |1/β∞|. Finally, we visualize |T | as the difference between
the |a| and |1/β| curves. The |T | curve is shown explicitly at the bottom, but you
should learn to visualize it directly from the diagram at the top.
The frequency fx at which the two curves meet is called the crossover frequency.
Clearly, |T ( j fx)|dB = 0 dB, or |T ( j fx)| = 1. In the example shown, for f ≪fx
we have |T | ≫1, indicating a closed-loop behavior nearly ideal there. However, for
f > fx we have |T |dB < 0 dB, or |T | < 1, indicating a signiﬁcant departure from
the ideal. Thus, the useful frequency range for the op amp circuit is to the left of
fx. In Chapter 8 we shall ﬁnd that T ( j fx), the phase angle of T at fx, determines
whether a circuit is stable as opposed to oscillatory.
6.2
CLOSED-LOOP FREQUENCY RESPONSE
The fact that the loop gain T is frequency-dependent will make the closed-loop
response A depend on frequency even when Aideal is designed to be frequency-
independent, as in the case of purely resistive feedback. To stress this fact, we

284
CHAPTER 6
Dynamic Op Amp
Limitations
rewrite Eq. (1.72) as
A( j f ) =
Aideal
1 + 1/T ( j f ) +
aft
1 + T ( j f )
(6.12)
To develop an initial feel, let us assume the feedthrough component to be negligible,
and let us express A(if) in the insightful form
A( j f ) ∼= AidealD( j f )
(6.13a)
where
D( j f ) =
1
1 + 1/T ( j f )
(6.13b)
is called the discrepancy function because it gives a measure of how close the gain
A( j f ) is to ideal. The deviation of D( j f ) from 1 /0◦is now speciﬁed in terms of
two parameters, namely, the magnitude error
ϵm =

1
1 + 1/T ( j f )
 −1
(6.14a)
and the phase error
ϵφ = −[1 + 1/T ( j f )]
(6.14b)
Using Eqs. (6.3) and (6.9), expanding and simplifying, we get
D( j f ) =
1
1 + 1 + j f/fb
a0β
=
1
1 +
1
a0β
×
1
1 +
j f
(1 + a0β) fb
that is, the discrepancy function is a low-pass function
D( j f ) =
D0
1 + j f/fB
(6.15a)
with a dc value of
D0 =
1
1 + 1/(a0β)
∼= 1
(6.15b)
and a –3-db frequency of
fB = (1 + a0β) fb ∼= a0β fb = β ft
(6.15c)
where Eq. (6.5) has been used. Combining Eqs. (6.13) and (6.15), we put the closed-
loop gain in the generalized form
A( j f ) ∼= A0
1
1 + j f/fB
(6.16a)
where
A0 = AidealD0 ∼= Aideal
fB ∼= β ft
(6.16b)
We make the important observation that negative feedback, while reducing gain from
a0 toA0 by the amount of feedback 1 + a0β, also expands the frequency bandwidth
by the same amount, from fb to fB. This gain-bandwidth tradeoff is yet another
important beneﬁt of negative feedback!

285
SECTION 6.2
Closed-Loop
Frequency
Response
Plotting the Closed-Loop Response |A( jf )|
By the constancy of the gain-bandwidth product, the crossover frequency in Fig. 6.4
must be such that (1/β) × fx = 1 × ft, or fx = β ft, so fx and fB coincide,
by Eq. (6.16b). This offers us a graphical means for constructing the Bode plot of
|A( j f )|: ﬁrst, plot the |1/β| curve on the plot of |a| supplied by the manufacturer
and read out fB as the crossover frequency between the two curves; then, sketch
the low-frequency plot of |Aideal|, and impose a pole breakpoint at f = fB. Let us
illustrate with some examples.
The Noninverting and Inverting Ampliﬁers
The noninverting ampliﬁer of Fig. 6.5a admits the loop gain of Eq. (1.76), which
we recycle to get the feedback factor as β = T/a, or
β =
1
1 + R2/R1 + (R1 + ro) /rd + ro/R1
(6.17a)
In a well-designed circuit the feedback resistances are much lower than rd and much
higher than ro, so we approximate the above expression as
β ∼=
1
1 + R2/R1
(6.17b)
It is now an easy task to draw the Bode plot of Fig. 6.5b with A0 ∼= 1 + R2/R1 and
fB ∼= ft/(1 + R2/R1).
EXAMPLE 6.1. A 741 op amp is conﬁgured as a noninverting ampliﬁer with R1 = 2 k
and R2 = 18 k. Find (a) the 1% magnitude error and (b) the 5◦phase error bandwidths,
deﬁned, respectively, as the frequency ranges over which |ϵm| ≤0.01 and |ϵφ| ≤5◦.
Solution.
(a) Wehaveβ = 0.1V/V,so fB = β ft = 100kHz.ByEq.(6.14a),ϵm = 1/

1 + ( f/fB)2
−1. Imposing |ϵm| ≤0.01 yields 1/

1 + ( f/105)2 ≥0.99, or f ≤14.2 kHz.
(b) By Eq. (6.14b), ϵφ = −tan−1( f/fB). Imposing |ϵφ| ≤5◦gives tan−1( f/105) ≤5◦,
or f ≤8.75 kHz.
dB 
fb 
fB
ft
f (dec)
0
a0
A0
1 + R2 /R1
a
A
+
–
+
R1
R2
Vi
Vo
(b)
(a)
a
FIGURE 6.5
(a) The noninverting ampliﬁer and (b) its frequency response.

286
CHAPTER 6
Dynamic Op Amp
Limitations
Thegain-bandwidthproductforthenoninvertingampliﬁerisGBP = A0× fB,or
GBPnoninv ∼= ft
(6.18)
indicating a gain-bandwidth tradeoff. For instance, a 741 op amp conﬁgured for
A0 = 1000 V/V will have fB = ft/A0 = 106/103 = 1 kHz. Reducing A0 by a
decade, to 100 V/V, will increase fB also by a decade, to 10 kHz. The ampliﬁer
with the lowest gain has also the widest bandwidth: this is the voltage follower, for
which A0 = 1 V/V and fB = ft = 1 MHz. It is apparent that ft represents a ﬁgure
of merit for op amps. The gain-bandwidth tradeoff can be exploited to meet speciﬁc
bandwidth requirements, as illustrated in the following example.
EXAMPLE 6.2. (a) Using 741 op amps, design an audio ampliﬁer with a gain of 60 dB.
(b) Sketch its magnitude plot. (c) Find its actual bandwidth.
Solution.
(a) Since 1060/20 = 103, the design calls for an ampliﬁer with A0 = 103 V/V and fB ≥
20 kHz. A single 741 op amp will not do, because it would have fB = 106/103 =
1 kHz. Let us try cascading two noninverting stages with lesser individual gains
but wider bandwidths, as depicted in Fig. 6.6a. Denoting the individual gains as
A1 and A2, the overall gain is then A = A1 × A2. One can easily prove that the
widest bandwidth for A is achieved when A1 and A2 are made equal, or A10 = A20 =
√
1000 = 31.62 V/V, or 30 dB. Then, fB1 = fB2 = 106/31.62 = 31.62 kHz.
(b)
Frequency f (Hz)
Gain magnitude (V/V)
102
103
104
105
106
0.1
1
1
10
102
103
104
105
10
|a|
|A|
|A1| 5 |A2|
fB
(a)
+
R1
R2
Vi
R1
R2
Vo
+
–
OA2
+
–
OA1
1 kΩ
30.9 kΩ
30.9 kΩ
1 kΩ
FIGURE 6.6
Cascading two ampliﬁers and the resulting frequency
response |A|.

287
SECTION 6.2
Closed-Loop
Frequency
Response
(b) To construct the magnitude plot, refer to Fig. 6.1b and note that since A = A2
1,
we have |A|dB = 2|A1|dB, indicating that the magnitude plot of A is obtained by
multiplying that of A1 by 2, point by point. The plot of |A1| is in turn obtained via
the graphical technique of Fig. 6.5b. The ﬁnal result is shown in Fig. 6.6b.
(c) Note that at 31.62 kHz both |A1| and |A2| are 3 dB below their dc values, making |A|
in turn 6 dB below its dc value. The −3-dB frequency fB is such that |A( j fB)| =
103/
√
2. But, |A( j f )| = |A1( j f )|2 = 31.622/[1 + ( f/fB)2]. We thus impose
103
√
2
=
31.622
1 + [ fB/(31.62 × 103)]2
to obtain fB = 31.62
√
2 −1 = 20.35 kHz, which indeed meets the audio
bandwidth requirement.
The inverting ampliﬁer of Fig. 6.7a admits the same β as its noninverting coun-
terpart, so Eqs. (6.17) still hold. As depicted in Fig. 6.7b, fB still coincides with the
crossover frequency of the |a| and |1/β| curves, so fB ∼= ft/(1+ R2/R1). However,
we now have A0 ∼= −R2/R1, whose magnitude is less than that of 1 + R2/R1, so
the |A| curve will be shifted downward somewhat.
It is readily seen that the inverting conﬁguration admits
GBPinv ∼= (1 −β) ft
(6.19)
The biggest difference between the two ampliﬁer types occurs when they are both
conﬁgured for unity gain: in the noninverting case we use R1 = ∞and R2 = 0, so
β = 1 and fB ∼= ft, whereas in the inverting case we use R1 = R2, so β = 1/2 and
fB ∼= 0.5 ft. For high closed-loop gains, β is very small, so the difference between
the two GBPs becomes negligible.
The I-V and V-I Converters
Using Eq. (6.10) we readily ﬁnd the feedback factor of the I-V converter of Fig. 6.8a
to be
β =
rd
rd + R + ro
(6.20)
which we use in connection with the plot of |a| to obtain fB(= β ft) as in Fig. 6.8b
(top). As we know, A0 ∼= −R V/A, so we plot the closed-loop response |A| as shown
at the bottom (note that the units of A are different from those of a, thus mandating
separate plots).
A0
dB 
fb 
fB 
ft
f (dec)
0
a0
1 + R2 /R1
a
A
(a)
(b)
+
–
R1
R2
Vo
+
Vi
a
FIGURE 6.7
(a) The inverting ampliﬁer and (b) its frequency response |A|.

288
CHAPTER 6
Dynamic Op Amp
Limitations
a0
fb
fB
fB
ft
0
dB
f (dec)
f (dec)
1/
|a|
|A|
(a)
(b)
+
–
R
Ii
Vo
a
R
V/A (dec)
FIGURE 6.8
(a) The I-V converter and (b) its frequency response.
The feedback factor of the V -I converter of Fig. 6.9a is
β =
rd∥R
rd∥R + RL + ro
(6.21)
Moreover, A0 ∼= 1/R A/V, so the required plots are as in Fig. 6.9b.
Before concluding this section, let us take a closer look at the approximations
made above. Let us start with the approximation leading to Eq. (6.17b), which we
examine in the following example.
EXAMPLE 6.3.
(a) Suppose the op amp of Fig. 6.3b is conﬁgured as a noninverting
ampliﬁer with R1 = R2 = 10 k. Find A0 and fB. (b) Repeat, but with R1 = R2 =
1.0 M. Compare with (a) and comment.
a0
fb
fB
fB
ft
0
dB
f (dec)
f (dec)
1/
|a|
|A|
(a)
(b)
–
+
Vi
a
1/R
A/V (dec)
+
–
R
Io
RL
FIGURE 6.9
(a) The V -I converter and (b) its frequency response.

289
SECTION 6.2
Closed-Loop
Frequency
Response
Solution.
(a) We have A0 ∼= Aideal = 1 + R2/R1 = 2.0 V/V. Plugging the given data into
Eq. (6.17a) gives β = 0.495, which is only slightly lower than the value of 0.5
given by Eq. (6.17b). The op amp has ft = a0 fb = 105 × 10 = 1 MHz, so fB =
β ft = 495 kHz (∼= 500 kHz).
(b) We still have Aideal = 2.0 V/V. However, Eq. (6.17a) now gives β = 0.333, so
fB = 333 kHz. Because of the much larger resistances used, we can no longer ignore
loading by rd. While the low-frequency asymptote remains virtually unchanged at
A0 ∼= 2.0 V/V, the 1/β curve is shifted upward, in turn decreasing the crossover
frequency and, hence, the value of fB. Note that the two-port feedback factor is
b = 0.5(= 1/Aideal) in both cases, whereas the return-ratio feedback factor β
essentially coincides with b in (a), but decreases to 0.333 in (b). This example
should help the reader appreciate similarities and differences between b and β.
Finally, let us examine the impact of ignoring the feedthrough component in
Eq. (6.12). This is certainly acceptable in the case of the noninverting ampliﬁer
because feedthrough occurs via rd, which is large. Not necessarily so in the inverting
case, where feedthrough occurs via the usually much smaller resistances of the
feedback network. The following example will give an idea.
EXAMPLE 6.4. Suppose the op amp of Fig. 6.3b is conﬁgured as an inverting ampliﬁer
with R1 = R2 = 500 . Use PSpice to display the magnitude Bode plots of a, 1/β, and
A. Discuss all salient features (asymptotic values, breakpoints), and conﬁrm via hand
calculations.
Solution. The circuit and the plots are shown in Fig. 6.10. Clearly, Aideal = −R2/R1 =
−1.0 V/V, yielding the low-frequency asymptote |A0| ∼= 1 V/V = 0 dB. The values of R1
and R2 have been chosen deliberately low both to load down ro and to cause noticeable
feedthrough. Equation (6.17a) gives β = 0.4544, so fB = β ft ∼= 454 kHz, which is
(b)
Frequency f (Hz)
Gain a (dB)
106
107
108
104
−20
−10
0
10
20
105
|a|
|A|
fB
aft
fz
1/
(a)
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(0,N)} = {100k/(1+s/62.81)}
0
0
0
0
0
Vo
OA
O
ro
500 Ω
R2
500 Ω
R1
N
I
T
rd
500 Ω
R1b
R2b
500 Ω
Nb
rob
100 Ω
1 MΩ
rdb
Vtest
Vi
1 MΩ
+
–
+
–
FIGURE 6.10
(a) The inverting ampliﬁer of Example 6.4 and (b) its frequency response. The feedback network for plotting 1/β
is repeated at the bottom of (a), with its elements identiﬁed by subscript b. The |A| trace is plotted as DB(V(O)/
V(I)), the |a| trace as DB(V(OA)/(-V(N))), and the 1/β trace as DB(V(T)/V(Nb)).

290
CHAPTER 6
Dynamic Op Amp
Limitations
less than 500 kHz as given by Eq. (6.17b). Because of feedthrough, |A| exhibits a high-
frequency asymptote of aft. By Eq. (1.75b) we can write aft = β(ro/R1) = 0.0909
V/V = −20.8 dB. Beside the pole frequency fB, A( j f ) exhibits also a zero frequency
fz. Exploiting the constancy of the GBP, we write A0 × fB = aft × fz, which gives
fz = A0 fB/aft ∼= 5 MHz. All calculated data match the PSpice data, which were
measured directly on the traces using PSpice’s cursor.
6.3
INPUT AND OUTPUT IMPEDANCES
As we know, the closed-loop input/output characteristics of an op amp circuit are
governed by the loop gain via Blackman’s formula. Since the loop gain is frequency-
dependent, so are the terminal characteristics, which we shall henceforth refer to as
impedances. We thus rephrase Eq. (1.79) as
Z = z0
1 + Tsc
1 + Toc
z0 = lim
a→0Z
(6.22)
The examples of Section 1.7 have revealed that series-type ports tend to have Toc = 0
and Tsc = T , so
Zse = z0(1 + T )
(6.23a)
whereas shunt-type ports tend to have Tsc = 0 and Toc = T , so
Zsh =
z0
1 + T
(6.23b)
If both z0 and β are frequency-independent, we can expedite the construction
of the Bode plots of |Zse( j f )| and |Zsh( j f )| via the graphical techniques depicted
in Fig. 6.11a. To this end, we ﬁrst draw the 1/β curve on the plot of |a( j f )| and
read out the value of fB. Next, on a separate graph with the vertical axis scaled
logarithmically in ohms, we draw the low-frequency asymptotes Zse0 and Zsh0,
examples of which were calculated in Section 1.6. These asymptotes hold only up to
fb. For f > fb, the loop gain |T | rolls off with frequency, causing in turn |Zse( j f )|
to fall and |Zsh( j f )| to rise. The fall/rise continues up to fB. For f > fB, the loop
gain |T | becomes negligible compared to unity, in turn causing the impedances to
settle at their high-frequency asymptotic values Zse∞and Zsh∞. These values are
given by Eq. (1.79b). Evidently, the dramatic resistance transformations investigated
in Chapter 1 hold only at low frequencies, where the amount of feedback is high. As
the gain a( j f ) rolls off, the beneﬁts of negative feedback gradually decrease, until
they evaporate altogether above fB.
For calculation purposes, we can express the impedances mathematically as
Zse( j f ) = Zse0
1 + j f/fB
1 + j f/fb
Zsh( j f ) = Zsh0
1 + j f/fb
1 + j f/fB
(6.24)
We observe that series impedances tend to behave capacitively, and shunt
impedances inductively. In fact, it is good practice to visualize them in terms
of their equivalents of Fig. 6.11b. At low frequencies Ceq acts as an open cir-
cuit, so Zse →Zse0, whereas at high frequencies Ceq acts as a short circuit, so
Zse →Zse0∥Zse∞∼= Zse∞because Zse∞≪Zse0. By dual reasoning, at high

291
SECTION 6.3
Input and Output
Impedances
a0
fb
fB
ft
0
dB
f (dec)
1/
|a|
Zse0
fb
fB
Zse`
Ω (dec)
f (dec)
|Zse|
Zsh0
fb
fB
Zsh`
Ω (dec)
f (dec)
(a)
(b)
|Zsh|
Zse0
Ceq
Zse`
Zsh`
Leq
Zsh0
Zse
Zsh
FIGURE 6.11
(a) Graphical technique for drawing the Bode plots of series/shunt
impedances. (b) Approximate equivalent circuits of a series impedance
(top) and a shunt impedance (bottom).
frequencies Leq acts as an open circuit, so Zsh →Zse∞, whereas at low frequencies
Leq acts as a short circuit, so Zsh →Zsh∞∥Zsh0 ∼= Zsh0 because Zsh0 ≪Zsh∞.
Let us use physical insight to derive expressions for Ceq and Leq. The effect
of Ceq starts to be felt as f is raised to fb, where its impedance becomes equal in
magnitude to Zse0, so 1/(2π fbCeq) = Zse0. By dual reasoning, Leq starts to be felt
as f is lowered to fB, where its impedance becomes equal in magnitude to Zsh∞,
so 2π fB Leq = Zsh∞. Solving for Ceq and Leq we get
Ceq =
1
2π fbZse0
Leq = Zsh∞
2π fB
(6.25)
In Chapter 8 we shall see that the inductive behavior of shunt-type ports may
cause instability when the port is terminated on a capacitance, whether intentional
or parasitic: such a capacitance tends to form a resonant circuit with Leq, possi-
bly causing intolerable peaking and ringing, or even unwanted oscillation, unless
the circuit is properly damped. A familiar example is the stray capacitance of the
inverting-input terminal, which tends to destabilize I-V and I-I converters and in-
verting voltage ampliﬁers. Another example is the load capacitance arising when a
shunt-output ampliﬁer drives a long cable. (Circuit stabilization techniques, called
frequency compensation, are addressed in Chapter 8.)

292
CHAPTER 6
Dynamic Op Amp
Limitations
EXAMPLE 6.5.
Suppose the op amp of Fig. 6.3b is conﬁgured as a noninverting am-
pliﬁer with R1 = 2.0 k and R2 = 18 k. (a) Find the asymptotic values and the
break frequencies of the magnitude Bode plot of its input impedance Zi( j f ). What are
the element values of its equivalent circuit? (b) Repeat, but for the output impedance
Zo( j f ).
Solution.
(a) We have β ∼= 1/10, so fB = β ft ∼= 100 kHz. The input port is of the series type, so
Zi0 ∼= rd(1+a0β) = 106(1+105/10) = 10 G. By inspection, Zi∞∼= rd = 1 M.
Finally, Ceq = 1/(2π × 10 × 1010) = 1.59 pF. The equivalent circuit consists of 10
G in parallel with the series combination of 1 M and 1.59 pF.
(b) The output port is of the shunt type, so Zo0 ∼= ro/(1+a0β) = 10 m. By inspection,
Zo∞∼= ro = 100. Finally, Leq = Zo∞/(2π × 105) = 159 μH. The equivalent
circuit consists of 100  in parallel with the series combination of 10 m and
159 μH.
EXAMPLE 6.6.
The op amp of Fig. 6.3b is conﬁgured for current ampliﬁcation as in
Fig. 1.30b with R1 = 1.0 k and R2 = 99 k. Use PSpice to display the magnitude
Bode plots of a, 1/β, the closed-loop gain Ai, and the input and output impedances
Zi and Zo for the case of a short-circuit load. Discuss all salient features (asymptotic
values, breakpoints), and verify via hand calculations.
Solution.
With reference to Fig. 6.12a, we ﬁrst use the circuit at the top to plot a,
1/β, Ai = Io/Ii, and Zi = Vn/Ii. Then, we suppress the input source and apply a test
(b)
1/
Frequency f (Hz)
Impedance (Ω)
103
104
105
106
108
107
1
10
1
104
102
106
108
102
Gain (dB)
103
104
105
106
108
107
1
10
−20
40
20
0
60
80
100
102
|Ai|
|Zo|
|Zi|
|a|
(a)
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(0,N)} = {100k/(1+s/62.832)}
0
0
0
OA
O
ro
Vo
Io
99 kΩ
R2
N
rd
1 MΩ
R1
1.0 kΩ
+
–
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(0,I)} = {100k/(1+s/62.832)}
0
0
0
0
OA
O
ro
Ii
99 kΩ
R2
I
rd
1 MΩ
R1
1.0 kΩ
+
–
Io
VL
0 V
FIGURE 6.12
(a) PSpice circuits for the current ampliﬁer of Example 6.6 and (b) its Bode plots. The |Zi| trace
is plotted on a log scale as V(I)/I(Ii), and the |Zo| trace as V1(Vo)/I(Vo).

293
SECTION 6.3
Input and Output
Impedances
voltage as in the bottom circuit, and let Zo = Vo/Io. Equation (1.63) predicts Ai(ideal) =
−100 A/A. Moreover, Eq. (6.10) gives
β =
rd
rd + R2
×
(rd + R2) ∥R1
(rd + R2) ∥R1 + ro
= 0.827
so 1/β = 1.65 dB and fB = β ft = 827 kHz. By inspection, Zi∞= rd∥(R2 + R1∥ro) ∼=
90 k, and Zo∞= ro + R1∥(R2 + rd) ∼= 1.1 k. Finally, Zi0 = Zi∞( fb/fB) ∼= 1.0,
and Zo0 = Zo∞( fB/fb) ∼= 91 M. All calculated data match PSpice’s data. As a ﬁnal
note we observe that because of feedthrough, Ai exhibits a high-frequency asymptote
just a bit below 0 dB.
Practical Considerations
The above analysis assumed the open-loop input and output impedances to be purely
resistive, zd = rd and zo = ro. However, closer inspection of Fig. 5A.7 indicates
that at high frequencies zd tends to behave capacitively and zo tends to behave
inductively. This behavior is typical of most op amps, and is due primarily to
the stray capacitances of the input transistors and to the frequency limitations of
the output transistors. Moreover, if the inputs of a practical op amp are tied to-
gether and the impedance to ground is measured, the result is the common-mode
input impedance zc. In the op amp model of Fig. 6.13, zc has been split equally
between the two inputs in order to yield (2zc) ∥(2zc) = zc when they are tied
together.
Data sheets usually specify only the resistive portion of these impedances,
namely, rd, rc, and ro. For BJT-input op amps, rd and rc are typically in the megaohm
and gigaohm range, respectively. Since rc ≫rd, the speciﬁcation of rc is often omit-
ted, and only rd is given. For FET-input devices, rd and rc are of the same order of
magnitude and in the range of 100 G or higher.
A few manufacturers specify the reactive portions of zd and zc, namely, the
differential input capacitance Cd, and the common-mode input capacitance Cc. For
example, the AD705 op amp has typically zd = rd ∥Cd = (40 M) ∥(2 pF)
and zc = rc ∥Cc = (300 G) ∥(2 pF). In general, it is safe to assume val-
ues on the order of few picofarads for both Cd and Cc. Though irrelevant at low
Vn
Vo
Vd
zd
zo
2zc
2zc
Vp
+
+
–
aVd
FIGURE 6.13
Modeling the input and output impedances
of a practical op amp.

294
CHAPTER 6
Dynamic Op Amp
Limitations
frequencies, these capacitances may cause signiﬁcant degradation at high frequen-
cies. For instance, at dc the AD705 op amp has zc = rc = 300 G; however,
at 1 kHz, where ZCc = 1/( j2π × 103 × 2 × 10−12) ∼= −j80 M, it has zc =
(300 G) ∥(−j80 M) ∼= −j80 M, a drastically reduced magnitude.
It is apparent that the assumptions zd = rd and zo = ro, while a good starting
point as we develop a feel for the effects of gain rolloff, may fail to account for
certain high-frequency effects. Taking also the reactive components of zd and zo
into consideration may prove too arduous for hand analysis, so computer simulation
using adequate macromodels becomes a necessity in this case.
6.4
TRANSIENT RESPONSE
So far we have investigated the effect of the open-loop dominant pole in the frequency
domain. We now turn to the time domain by examining the transient response, that is,
the response to an input step as a function of time. This response, like its frequency-
domain counterpart, varies with the amount of feedback applied. In the data sheets it
is usually speciﬁed for unity feedback, that is, for the voltage follower conﬁguration;
however, the results can readily be generalized to other feedback factors.
The Rise Time tR
As we know, the small-signal bandwidth of the voltage follower is ft, so its frequency
response can be written as
A( j f ) =
1
1 + j f/ft
(6.26)
indicating a pole at s = −2π ft. Subjecting the voltage follower of Fig. 6.14a to an
input voltage step of sufﬁciently small amplitude Vm will result in the well-known
exponential response
vO(t) = Vm(1 −e−t/τ)
(6.27)
τ =
1
2π ft
(6.28)
+
vI
vI
vO
Vm
Volts
vO
+
–
a
t
τ
0
(b)
(a)
0
FIGURE 6.14
Voltage follower and its small-signal step response.

295
SECTION 6.4
Transient
Response
+
–
(a)
+
vI
vO
RL
2 kΩ
2
3
4
6
7
0
µA741
–
VCC (15 V)
VEE (−15 V)
0
(b)
Time (µs)
(mV)
0.4
0.6
0.8
1.0
1.2
1.4
0
0
2
4
6
8
10
12
0.2
vI
vO
FIGURE 6.15
(a) PSpice circuit to display 741 transient responses. (b) Small-signal step response.
The time tR it takes for vO to swing from 10% to 90% of Vm is called the rise time,
and it provides an indication of how rapid the exponential swing is. We easily ﬁnd
tR = τ(ln 0.9 −ln 0.1), or
tR = 0.35
ft
(6.29)
This provides a link between the frequency-domain parameter ft and the time-
domain parameter tR; clearly, the higher ft, the lower tR.
The 741 op amp has τ = 1/(2π106) ∼= 159 ns and tR ∼= 350 ns. Its tran-
sient response, shown in Fig. 5A.6 of Appendix 5.A, is repeated for convenience in
Fig. 6.15 using PSpice’s 741 macromodel. The small amount of ringing is due to
the aforementioned presence of higher-order poles, which we have ignored in our
single-pole approximation.
Slew-Rate Limiting
The rate at which vO changes with time is highest at the beginning of the exponential
transition. Using Eq. (6.27), we ﬁnd dvO/dt|t=0 = Vm/τ, which is also illustrated
in Fig. 6.14b. If we increase Vm, the rate at which the output slews will have to
increase accordingly in order to complete the 10%-to-90% transition within the
time tR. In practice it is observed that above a certain step amplitude the output
slope saturates at a constant value called the slew rate (SR). The output waveform,
rather than an exponential curve, is now a ramp. (As we shall see in greater detail
shortly, slew-rate limiting is a nonlinear effect that stems from the limited ability
by the internal circuitry to charge or discharge the frequency-compensation capa-
citance Cc.)
The SR is expressed in volts per microsecond. The data sheets give SR =
0.5 V/μs for the 741C op amp version and SR = 0.7 V/μs for the 741E version.
This means that to complete a 1-V output swing, a 741C voltage follower takes
approximately (1 V)/(0.5 V/μs) = 2μs. This is conﬁrmed by Fig. 6.16a, generated
via the PSpice circuit of Fig. 6.15a.

296
CHAPTER 6
Dynamic Op Amp
Limitations
(a)
Time (µs)
(V)
5
10
15
0
SR
0
0.5
1.0
vO
vI
(b)
Time (µs)
(V)
50
100
0
SR
−10
0
10
vO
vI
FIGURE 6.16
Slew-rate limited responses of the 741 follower of Fig. 6.15a to (a) a pulse and (b) a sinusoid.
We stress that SR is a nonlinear large-signal parameter, while tR is a linear small-
signal parameter. The critical output-step magnitude corresponding to the onset of
slew-rate limiting is such that Vom(crit)/τ = SR. Using Eq. (6.28), this gives
Vom(crit) = SR
2π ft
(6.30)
For the 741C, Vom(crit) = 0.5 × 106/(2π × 106) = 80 mV. This means that as
long as the input step is less than 80 mV, a 741C voltage follower responds with
an approximately exponential transition governed by τ = 159 ns. However, for a
greater input step, the output slews at a constant rate of 0.5 V/μs until it comes within
80 mV of the ﬁnal value, after which it performs the remainder of the transition in
approximately exponential fashion. The above results can be generalized to circuits
with β < 1 by replacing ft with β ft.
EXAMPLE 6.7.
Suppose a 741 op amp is conﬁgured as an inverting ampliﬁer with
R1 = 10 k and R2 = 20 k. Use PSpice to display vO(t) and vN(t) if vI(t) is
a 0-to-1-V step. Discuss the salient features of each waveform, and verify via hand
calculations.
Solution. With reference to Fig. 6.17, we observe that with a gain of −2 V/V, the circuit
responds to the 0-to-1 V input step with an output transition from 0 to −2 V. Initially, this
transition is slew-rate limited, and only at the end does it become exponential. The slew-
rate limited portion takes close to 2/0.5 = 4 μs to complete. During slew-rate limiting
the op amp is unable to inﬂuence vN with all its might, so we use the superposition
principle to ﬁnd
vN = 2
3vI + 1
3v0 = 1
3v0 + 0.667 V
The greatest departure of vN from virtual-ground behavior occurs right at the beginning
of the output transition, when vO is still 0 and vN thus jumps from 0 to 0.667 V. Only after
the op amp stops slew-rate limiting will vN approach virtual-ground behavior. The ﬁnal,
exponential portion is governed by the time constant τ = 1/(2πβ ft). With β ∼= 1/3,
we get τ = 477 ns. Moreover, since SR/(2πβ ft) = 239 mV, it follows that slew-rate
limiting occurs until vO comes within 0.239 V of its ﬁnal value of −2.0 V, the remainder
of the transition becoming approximately exponential.

297
SECTION 6.4
Transient
Response
(b)
Time (µs)
(V)
2
7
6
5
4
3
1
0
−2.0
−1.0
0
vO
(V)
2
7
6
5
4
3
1
0
0
0.5
1.0
vN
(V)
2
7
6
5
4
3
1
0
0
1.0
vI
(a)
+
vO
R2
N
20 kΩ
2
3
4
6
7
µA741
–
VCC (15 V)
VEE (−15 V)
vI
0
0
R1
10 kΩ
+
–
FIGURE 6.17
(a) PSpice circuit of Example 6.7, and (b) its step responses.
Full-Power Bandwidth
The effect of slew-rate limiting is to distort the output signal whenever an attempt
is made to exceed the SR capabilities of the op amp. This is illustrated in Fig. 6.16b
for a sinusoidal signal. In the absence of slew-rate limiting, the output would be
vO = Vom sin(2πft). Its rate of change is dvO/dt = 2π f Vom cos(2πft), whose
maximum is 2π f Vom. To prevent distortion, we must require (dvO/dt)max ≤SR,
or
f Vom ≤SR/(2π)
(6.31)
indicating a tradeoff between frequency and amplitude. If we want to operate at high
frequencies, then we must keep Vom suitably small to avoid slew-rate distortion.
In particular, if we want to exploit the full small-signal bandwidth ft of a 741C
voltage follower, then we must keep Vom ≤SR/(2π ft) ∼= 80 mV. Conversely, if
we want to ensure an undistorted output with Vom > Vom(crit), then we must keep
f ≤SR/(2πVom). For instance, for an undistorted ac output with Vom = 1 V, a
741C follower must be operated below 0.5 × 106/(2π1) = 80 kHz, which is way
below ft = 1 MHz.
The full-power bandwidth (FPB) is the maximum frequency at which the op
amp will yield an undistorted ac output with the largest possible amplitude. This
amplitude depends on the particular op amp as well as its power supplies. Assuming

298
CHAPTER 6
Dynamic Op Amp
Limitations
symmetric output saturation values of ±Vsat, we can write
FPB =
SR
2πVsat
(6.32)
Thus, a 741C with Vsat = 13 V has FPB = 0.5×106/(2π13) = 6.1 kHz. Exceeding
this frequency will yield a distorted as well as reduced output. When applying
an ampliﬁer we must make sure that neither its slew-rate limit SR nor its −3-dB
frequency fB is exceeded.
EXAMPLE 6.8.
A 741C op amp with ±15-V supplies is conﬁgured as a noninverting
ampliﬁer with a gain of 10 V/V. (a) If the ac input amplitude is Vim = 0.5 V, what is the
maximum frequency before the output distorts? (b) If f = 10 kHz, what is the maximum
value of Vim before the output distorts? (c) If Vim = 40 mV, what is the useful frequency
range of operation? (d) If f = 2 kHz, what is the useful input amplitude range?
Solution.
(a) Vom = AVim = 10 × 0.5 = 5 V; fmax = SR/(2πVom) = 0.5 × 106/(2π5) ∼= 16 kHz.
(b) Vom(max) = SR/(2π f ) = 0.5 × 106/(2π104) = 7.96 V; Vim(max) = Vom(max)/A =
7.96/10 = 0.796 V.
(c) To avoid slew-rate limiting, keep f ≤0.5×106/(2π ×10×40×10−3) ∼= 200 kHz.
Note, however, that fB = ft/A0 = 106/10 = 100 kHz. The useful range is thus
f ≤100 kHz, and is dictated by small-signal considerations, rather than slew-rate
limiting.
(d) Vom(max) = 0.5 × 106/(2π × 2 × 103) = 39.8 V. Since this is greater than Vsat,
or 13 V, the limiting factor is in this case output saturation. Thus, the useful input
amplitude range is Vim ≤Vsat/A = 13/10 = 1.3 V.
The Settling Time tS
The rise time tR and slew rate SR give an indication of how rapidly the output
changes, respectively, under small-signal and large-signal conditions. The parame-
ter of greatest concern in many applications is the settling time tS, deﬁned as the
time it takes for the response to a large input step to settle and remain within a spec-
iﬁed errorband, usually symmetric about its ﬁnal value. Settling times are typically
speciﬁed to accuracies of 0.1% and 0.01% of a 10-V input step. As an example, the
AD843 op amp has typically tS = 135 ns to 0.01% of a 10-V step.
As shown in Fig. 6.18a, tS is comprised of an initial propagation delay due to
higher-order poles, followed by an SR-limited transition to the vicinity of the ﬁnal
value, followed by a period to recover from the overload conditon associated with the
SR, and ﬁnally settle toward the ﬁnal equilibrium value. The settling time depends
on both linear and nonlinear factors, and is generally a complex phenomenon.3,4 A
fast tR or a high SR does not necessarily guarantee a fast tS. For instance, an op amp
may settle quickly within 0.1%, but may take considerably longer to settle within
0.01% due to excessively long ringing.
Figure 6.18b shows a popular test circuit5 for the measurement of tS. The device
under test (DUT) is conﬁgured as a unity-gain inverting ampliﬁer, while the equal-
valued resistors R3 and R4 synthesize what is commonly referred to as a false ground.
Since vFG = 1
2(vI +vO), with vO = −vI we expect vFG = 0 V. In practice, because

299
SECTION 6.4
Transient
Response
R1
D1
D2
R4
+
vI
2 kΩ
R2
vFG
2 kΩ
2 kΩ
R3
2 kΩ
vO
tS
t
vO
+
–
DUT
Error band
Final
value
0
SR
0
(a)
(b)
FIGURE 6.18
Settling time tS, and circuit to measure tS. (D1 and D2 are HP2835
Schottky diodes.)
of the transient due to the op amp, vFG will momentarily deviate from zero and we
can observe this deviation to measure tS. For an error band of ±0.01% of a 10-V
step, vFG will have to settle within ±0.5 mV of its ﬁnal value. The purpose of
the Schottky diodes is to prevent overloading the oscilloscope’s input ampliﬁer. To
avoid loading by the probe’s stray capacitance, vFG can be buffered by means of a
JFET source-follower. Consult the data sheets for the recommended test circuit to
measure tS.
In order to fully realize the settling-time capabilities of the op amp, one must
pay proper attention to component selection, layout, and grounding; otherwise,
the painstaking process of ampliﬁer design can easily be defeated.5 This includes
keeping component leads extremely short, using metal-ﬁlm resistors, orienting com-
ponents so as to minimize stray capacitances and connection inductances, properly
bypassing the power supplies, and providing separate ground returns for the input,
the load, and the feedback network. Fast settling times are particularly desirable in
high-speed, high-accuracy D-A converters, sample-and-hold ampliﬁers, and multi-
plexed ampliﬁers.

300
CHAPTER 6
Dynamic Op Amp
Limitations
Slew-Rate Limiting: Causes and Cures
It is instructive to investigate the causes of slew-rate limiting since even a qualitative
understanding can better help the user in the op amp selection process. Referring to
the block diagram1 of Fig. 6.19, we observe that as long as the input step amplitude
Vm is sufﬁciently small, the input stage will respond in proportion and yield iO1 =
gm1Vm. By the capacitance law, dvO/dt = iO1/Cc = gm1Vm/Cc, thus conﬁrming
that the output rate of change is also propotional to Vm. However, if we overdrive the
input stage, iO1 will saturate at ±IA, as depicted in Fig. 5.2b. The capacitor Cc will
become current-starved, and (dvO/dt)max = IA/Cc. This is precisely the slew rate,
SR = IA
Cc
(6.33)
Using the 741 op amp working values of Section 5.1, namely, IA = 19.6 μA and
Cc = 30 pF, we estimate SR = 0.653 V/μs, in reasonable agreement with the data
sheets.
It is important to realize that during slew-rate limiting vN may depart from
vP signiﬁcantly because of the drastic drop in the open-loop gain brought about by
input-stage saturation. During limiting the circuit is insensitive to any high-frequency
components at the input. In particular, the virtual-ground condition of the inverting
conﬁguration does not hold during limiting. This is conﬁrmed by the shape of vN in
Fig. 6.17.
We can gain additional insight by relating large-signal and small-signal
behavior.1,6 In Eq. (6.8a) it was found that ft = gm1/(2πCc). Solving for Cc and
substituting into Eq. (6.33) gives
SR = 2π IA ft
gm1
(6.34)
This expression points to three different ways of increasing the SR, namely, (a) by
increasing ft, (b) by reducing gm1, or (c) by increasing IA.
+
vI
IA
1
iO1
Cc
vO
Q3
Q1
VCC
VEE
Q2
–a2
Q4
FIGURE 6.19
Op amp model to investigate slew-rate limiting.

301
SECTION 6.5
Effect of Finite
GBP on Integrator
Circuits
Ingeneral,anopampwithahigh ft tendstoexhibitalsoahighSR.ByEq.(6.8a),
ft can be increased by reducing Cc. This is especially useful in the case of uncom-
pensated op amps, for then the user can specify a compensation network that will
also maximize the SR. A popular example is offered by the 301 and 748 op amps,
which, when used in high-gain conﬁgurations, can be compensated with a smaller
Cc value to achieve a higher ft as well as a higher SR. Even in low-gain applications,
frequency-compensation schemes other than the dominant pole are possible, which
may improve the SR signiﬁcantly. Popular examples are the so-called input-lag and
feedforward compensation methods, to be addressed in Chapter 8. For instance, with
dominant-pole compensation, the 301 op amp offers dynamic characteristics similar
to those of the 741; however, with feedforward compensation, it achieves ft = 10
MHz and SR = 10 V/μs.
The second method of increasing the SR is by reducing the input-stage transcon-
ductance gm1. For BJT input stages, gm1 can be reduced via emitter degeneration,
which is obtained by including suitable resistances in series with the emitters in the
differential input pair to deliberately reduce, or degenerate, transconductance. The
LM318 op amp utilizes this technique to achieve SR = 70 V/μs with ft = 15 MHz.
Alternatively, gm1 can be reduced by implementing the differential input pair with
FETs, whose transconductance is notoriously lower than that of BJTs for similar bi-
asing conditions. For instance, the TL080 op amp, which is similar to the 741 except
for the replacement of the input BJT pair with a JFET pair, offers SR = 13 V/μs
at ft = 3 MHz. We are now able to appreciate two good reasons for having a JFET
input stage: one is to achieve very low input bias and offset currents, and the other
is to enhance the slew rate.
The third method of increasing the SR is by increasing IA. This is especially
important in the case of programmable op amps, so called because their internal
operating currents can be programmed by the user via an external current ISET.
(This current is usually set by connecting a suitable external resistor, as speciﬁed
in the data sheets.) The internal currents, including the quiescent supply current IQ
and the input-stage bias current IA, are related to ISET in current-mirror fashion, and
are thus programmable over a wide range of values. By Eqs. (6.8b) and (6.33), both
ft and SR are proportional to IA, which in turn is proportional to ISET, indicating
that the op amp dynamics are also programmable.
6.5
EFFECT OF FINITE GBP ON INTEGRATOR CIRCUITS
Having investigated the frequency response of purely resistive circuits, we now turn
to circuits whose feedback networks contain capacitors and thus exhibit frequency-
dependent feedback factors. The most popular circuit is the inverting integrator of
Fig. 3.6, which serves as a building block not only for ﬁlters, but also for signal
generators and data converters, to be studied in later chapters. As we know, the ideal
inverting-integrator transfer function is
Hideal( j f ) =
−1
j f/f0(ideal)
(6.35a)

302
CHAPTER 6
Dynamic Op Amp
Limitations
Because of the op amp’s gain rolloff with frequency, we expect the actual transfer
function H( j f ) to depart from the ideal. We visualize this departure by means of
the PSpice circuit of Fig. 6.20a, which uses a 1-MHz GBP op amp with a0 = 103
V/V, and has been designed for a unity-gain frequency of
f0(ideal) =
1
2π RC =
1
2π105 × 15.9155 × 10−12 = 100 kHz
(6.35b)
Figure 6.20b indicates that H( j f ) approaches Hideal( j f ) only over a limited fre-
quency range, say, from 102 to 106 Hz, and with a unity-gain frequency (measured
with PSpice’s cursor) of f0 = 89.74 kHz.
For a more detailed investigation, we start out with the feedback factor, which
is easily seen to be a high-pass function of the type
β( j f ) = β∞
j f/f1
1 + j f/f1
(6.36a)
where β∞is the high-frequency asymptotic value of β, obtained by letting C be-
come a short circuit, and f1 is the break frequency formed by C and the equivalent
resistance seen by C itself,
β∞=
R ∥rd
ro + R ∥rd
= 0.9989
f1 =
1
2π(R ∥rd + ro)C = 109.88 kHz
(6.36b)
The loop gain |T |, visualized as the difference between the |a| and |1/β| curves,
gives a measure of how close the actual transfer function H( j f ) is to ideal. We
make the following observations:
1. From fb to f0 the loop gain |T | is maximum and approximately frequency-
independent.
(b)
Frequency f (Hz)
Gain (dB)
109
1
−60
−40
−20
0
40
20
60
102
10
103
104
105
106
107
108
|a|
|T|
|H|
|H0|
(a)
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(0,N)} = {1k/(1+s/6283.2)}
0
0
0
0
0
Vo
OA
O
ro
15.9155 pF
C
100 kΩ
R
I
N
T
rd
100 kΩ
Rb
Cb
15.9155 pF
Nb
rob
100 Ω
1 MΩ
rdb
Vtest
Vi
1 MΩ
+
–
+
–
fb
ft
f0
|1/|
aft
FIGURE 6.20
(a) PSpice integrator and (b) its frequency characteristics. The feedback network for plotting 1/β is repeated at
the bottom of (a), with its elements identiﬁed by subscript b. The |H| trace is plotted as DB(V(O)/V(I)), the |a|
trace as DB(V(OA)/(-V(N))), and the |1/β| trace as DB(V(T)/V(Nb)).

303
SECTION 6.5
Effect of Finite
GBP on Integrator
Circuits
2. Below fb, |T | decreases with frequency until it drops to unity at the intercept
of the two curves. Below this intercept, C becomes an open circuit, so the op
amp will amplify with its full open-loop gain, giving H0 = [rd/(R + rd)]a0 =
90.9 × 103 = 909 V/V = 59.2 dB.
3. Above f0, |T | decreases again until it drops to unity at the second intercept, in the
vicinity of ft. Above this intercept, the slope of |H| doubles to −40 dB/dec, of
which −20 dB/dec are due to the integrator itself, and the additional −20 dB/dec
are due to the discrepancy function D = 1/(1 + 1/T ).
4. At very high frequencies, C becomes a short circuit, resulting in a feedthrough
gain of aft ∼= ro/R = 10−3 V/V = −60 dB. For its magnitude curve to ﬂatten
out, H( j f ) must contain a zero pair to neutralize the combined slope due to the
pole pair (see Problem 6.43).
5. It is apparent that, at least up to ft, the integrator behaves like a constant GBP
ampliﬁer with GBP ∼= f0, a dc gain of H0, and a −3-dB frequency of about
f0/H0.
Magnitude and Phase Errors
Ignoring feedthrough because it occurs way above the integrator’s useful frequency
range, we adapt Eq. (6.13) to the present circuit and approximate
H( j f ) ∼=
−1
j f/f0(ideal)
×
1
1 + 1/T ( j f )
(6.37)
indicating that H( j f ) exhibits both a magnitude error and a phase error, as per
Eq. (6.14). We are particularly interested in the frequency range fb ≪f ≪f1 over
which the loop gain is maximum and
T = aβ ∼=
a0
j f/fb
× β∞( j f/f1) = β∞
ft
f1
(6.38a)
Substituting into Eq. (6.37) gives the insightful result
H( j f ) ∼=
−1
j f/
 f0(ideal)/(1 + 1/T )

(6.38b)
indicating that the effect of the op amp’s gain rolloff is to downshift the integrator’s
unity-gain frequency from f0(ideal) to about f0 = f0(ideal)/(1+1/T ). In the present
case we have T = 0.9989 × 106/(109.88 × 103) = 9.09, so the downshift is from
100 kHz to about 100/(1+1/9.09) = 90.09 kHz (in fair agreement with the PSpice
value of 89.74 kHz).
This downshift is not necessarily bad per se, for we can always predistort the
value of f0(ideal) so that, by the time it gets divided by 1 + 1/T , it attains the
desired value. In the present circuit, this would require designing for 1/(2πRC) =
(100 kHz)×(1+1/9.09) = 111 kHz, which can be achieved by lowering R from 100
k to 100/111 = 90.09 (88.65 k according to PSpice). In practice, predistortion
for low values of T may not be advisable as ft in Eq. (6.38a) is subject to production
variations, drift, and aging. A better bet is to use an op amp with a higher ft relative
to the desired f0(∼= f1), since this would raise the value of T and thus reduce the

304
CHAPTER 6
Dynamic Op Amp
Limitations
effect of variations in ft. A higher ft will also expand the upper end of the useful
frequency range, just like a higher a0 will expand the lower end of the useful range
(see Problem 6.45).
According to Eq. (6.35a), the integrator should provide a phase shift of 90◦. In
practice, because of the two breakpoints, the shift will depart from 90◦at both the
lower and upper regions of the useful frequency range. We shall soon see that the
latter is a source of concern in integrator-based ﬁlters such as dual-integrator loops.
To investigate further, let us assume rd = ∞and ro = 0, so β∞= 1 and the second
intercept is right at ft. Under these conditions we can approximate the integrator
response in the upper region of the useful frequency range as
H( j f ) ∼=
−1
j f/f0(ideal)
1
1 + j f/ft
(6.39)
indicating a phase error of ϵφ = −tan−1 ( f/ft). We are particularly interested in
ϵφ in the vicinity of f0. Since a well-designed integrator has f0(ideal) ≪ft, we can
approximate, for f ≪ft,
ϵφ ∼= −f/ft
(6.40)
We can reduce ϵφ by introducing a suitable amount of phase lead to counteract the
phase lag due to the pole frequency ft. This process is called phase-error compen-
sation.
Passive Compensation of Integrators
The integrator of Fig. 6.21a is compensated by means of an input parallel capacitance
Cc. If we specify its value so that |ZCc( j ft)| = R, or 1/(2π ftCc) = R, then the
phase lead due to the high-pass action by Cc will compensate for the phase lag
due to the low-pass term 1/(1 + j f/ft), thus expanding the frequency range of
negligible phase error. This technique, also referred to as zero-pole cancellation,
requires that
Cc = 1/(2π R ft)
(6.41)
a
Vo
Cc
Vi
+
–
(a)
(b)
C
R
+
a
Vo
Vi
Rc
+
–
C
R – Rc
+
FIGURE 6.21
Passive compensation of the integrator: (a) capacitive, and (b) resistive.

305
SECTION 6.5
Effect of Finite
GBP on Integrator
Circuits
The scheme of Fig. 6.21b achieves a similar result, but by using a feedback
series resistance Rc and by decreasing the input resistance from R to R −Rc. This
method offers better trimming capabilities than capacitive compensation. It can be
shown (see Problem 6.50) that letting
Rc = 1/(2πC ft)
(6.42)
will make H( j f ) →Hideal, provided the components are scaled such that the open-
loop output impedance zo is negligible compared to Rc.
Because of manufacturing process variations, the value of ft is not known
precisely, so Cc or Rc must be trimmed for each individual op amp. Even so,
compensation is difﬁcult to maintain because ft is sensitive to temperature and
power-supply variations.
Active Compensation of Integrators
The drawbacks of passive compensation are ingeniously avoided with active com-
pensation,7 so called because it exploits the matching and tracking properties of
dual op amps to compensate for the frequency limitations of one device using the
very same limitations of the other. Although this technique is general and will be
readdressed in Section 8.7, here we focus on compensation of integrators according
to the two popular schemes depicted in Fig. 6.22.
With reference to the scheme of Fig. 6.22a, we apply the superposition principle
to write
Vo = −a1

1
1 + j f/f0
Vi +
j f/f0
1 + j f/f0
A2Vo

A2 =
1
1 + j f/ft2
where f0 = 1/(2π RC). To ﬁnd H = Vo/Vi, we eliminate A2, substitute a1 ∼=
ft1/j f , and let ft2 = ft1 = ft to reﬂect matching. This gives H( j f ) = Hideal × 1/
(1 + 1/T ), where
1
1 + 1/T =
1 + j f/ft
1 + j f/ft −( f/ft)2 =
1 −j( f/ft)3
1 −( f/ft)2 + ( f/ft)4
(6.43)
Vo
+
–
(a)
(b)
C
R
Vi
+
+
–
Vo
+
–
C
R
R1
Vi
+
+
–
OA2
OA1
OA2
OA1
R1
FIGURE 6.22
Active compensation of the integrator: (a) ϵφ = −( f/ft)3, and (b) ϵφ = + f/ft.

306
CHAPTER 6
Dynamic Op Amp
Limitations
The last step reveals an interesting property: the rationalization process leads to the
mutual cancellation of the ﬁrst- and second-order terms in f/ft in the numerator,
leaving only the third-order term. We thus approximate, for f ≪ft,
ϵφ ∼= −( f/ft)3
(6.44)
indicatingamuchsmallererrorthanthatofEq.(6.40).Theeffectofthecompensation
scheme of Fig. 6.22a is illustrated in Fig. 6.23 by means of PSpice.
Turning next to the scheme of Fig. 6.22b, we observe that OA1 contains the
inverting op amp OA2 in its feedback path, so its input polarities have been inter-
changed to keep feedback negative. One can prove (see Problem 6.51) that
1
1 + 1/T =
1 + j f/0.5 ft
1 −j f/ft −( f/0.5 ft)2 ∼=
1 + j f/ft
1 −3( f/ft)2
where we have ignored higher-order terms in f/ft. We now have
ϵφ ∼= + f/ft
(6.45)
Though not as small as in Eq. (6.44), this phase error has the advantage of being
positive, a feature we shall exploit shortly.
(b)
Frequency f (Hz)
Phase
105
106
107
103
0°
45°
90°
104
105
106
107
103
104
Gain (dB)
−60
0
−20
−40
20
(a)
Comp
Uncomp
Comp
Uncomp
10 kΩ
IN+
IN−
OUT+
OUT−
EOA1
LAPLACE {v(P,N)} = {100k/(1+s/62.832)}
0
IN+
IN−
OUT+
OUT−
EOA2
0
0
0
O2
O1
Vi
1.5915 nF
C
R
N1
I
Vo
+
–
FIGURE 6.23
(a) PSpice integrator with active compensation, and (b) its Bode plots. For comparison, also shown are
the uncompensated plots, obtained with the capacitor’s right plate connected directly to Vo.

307
SECTION 6.5
Effect of Finite
GBP on Integrator
Circuits
Q-Enhancement Compensation
It has been found that the effect of nonideal op amps on dual-integrator-loop ﬁlters
such as the state-variable and biquad varieties is to raise the actual value of Q above
the design value predicted under ideal op amp assumptions. This effect, aptly referred
to as Q enhancement, has been analyzed8 for the case of the biquad conﬁguration in
terms of the phase errors introduced by the two integrators and the third ampliﬁer.
The result is
Qactual ∼=
Q
1 −4Q f0/ft
(6.46)
where f0 is the integrator unity-gain frequency, ft is the op amp transition frequency,
and Q is the quality factor in the ideal op amp limit ft →∞. As pictured in Fig. 6.24
for a design value of Q = 25 and op amps with ft = 1 MHz, Qactual increases with
f0 until it becomes inﬁnite for f0 ∼= ft/(4Q) = 106/100 = 10 kHz. At this point
the circuit becomes oscillatory.
Besides Q enhancement, the ﬁnite GBP of the op amps causes also a shift in the
characteristic frequency f0 of the ﬁlter,9
	f0
f0
∼= −( f0/ft)
(6.47)
For small Q deviations, Eq. (6.46) gives
	Q
Q
∼= 4Q f0/ft
(6.48)
Together, these equations indicate the GBP that is needed to contain 	f0/f0 and
	Q/Q within speciﬁed limits.
EXAMPLE 6.9. Specify suitable components in the biquad ﬁlter of Fig. 3.36 to achieve
f0 = 10 kHz, Q = 25, and H0BP = 0 dB, under the constraint that the deviations of f0
and Q from their design values because of ﬁnite GBPs be within 1%.
55
50
45
40
35
102
103
104
30
25
f0  (Hz)
Qactual
FIGURE 6.24
Q enhancement.

308
CHAPTER 6
Dynamic Op Amp
Limitations
Solution. Use R1 = R2 = R5 = R6 = 10 k, R3 = R4 = 250 k, andC1 = C2 = 5/π nF.
To meet the f0 and Q speciﬁcations, we need, respectively, ft ≥f0/(	f0/f0) =
104/0.01 = 1 MHz, and ft ≥4 × 25 × 104/0.01 = 100 MHz. The Q speciﬁcation is
the most demanding, so we need GBP ≥100 MHz.
The onerous GBP requirements imposed by the Q speciﬁcation can be relaxed
dramatically if we use phase-error compensation to eliminate the Q-enhancement
effect. An actual example will better illustrate.
EXAMPLE 6.10.
(a) Use PSpice to display the band-bass response of the biquad ﬁlter
of Example 6.9 for the case of op amps with GBP = 1 MHz (use Laplace blocks of
the type of Fig. 6.23). (b) Calculate the capacitance Cc that, when connected across R1,
will provide passive compensation for all three op amp blocks. Show the compensated
response. (c) Predistort the values of C1 and C2 for a resonant frequency of 10.0 kHz.
(d) Repeat, but using active compensation. Compare the two circuit implementations,
and comment.
Solution.
(a) The circuit is shown in Fig. 6.25. The band-pass response without Cc is shown in
Fig. 6.26a as the “Uncomp” curve. Evidently, the uncompensated circuit suffers from
signiﬁcant Q enhancement.
(b) To compensate for the two integrating op amps as well as the unity-gain inverting op
amp, whose pole frequency is fB = ft/2, we use a single capacitance but four times as
large as that predicted by Eq. (6.41), orCc = 4/(2π R1 ft) = 2/(π104×106) ∼= 64 pF.
The response with Cc in place is shown in Fig. 6.26a as the “Comp” curve. Although
the effect of Q enhancement has been neutralized, the response still exhibits the
frequency shift of Eq. (6.47).
(c) To compensate for the frequency shift, we predistort the values of C1 and C2 by
lowering them by 100 × f0/ft = 1%, that is, by lowering them from 1.5915 nF
to 1.5756 nF. The ensuing response is shown in Fig. 6.26b. Using PSpice’s cursor
facility, we measure the resonant frequency as 10.0 kHz, and the −3-dB frequencies
as fL = 9.802 kHz and fH = 10.202 kHz, thus conﬁrming Q = 25.
250 kΩ
IN+
IN−
OUT+
OUT−
EOA1
LAPLACE {v(P,N)} = {100k/(1+s/62.832)}
0
0
0
O1
Vi
1.5915 nF
C1
R3
250 kΩ
R4
N1
I
Vo
+
–
64 pF
Cc
10 kΩ
R1
10 kΩ
R2
IN+
IN−
OUT+
OUT−
EOA2
0
0
O2
1.5915 nF
C2
N2
10 kΩ
R5
IN+
IN−
OUT+
OUT−
EOA3
0
0
O3
10 kΩ
R6
N3
FIGURE 6.25
PSpice realization of the biquad of Example 6.10 using passive compensation.

309
SECTION 6.5
Effect of Finite
GBP on Integrator
Circuits
(a)
Frequency f (kHz)
Gain (dB)
11
10
9.1
−15
−10
−5
0
5
Uncomp
Comp
(b)
fL
Frequency f (kHz)
Gain (dB)
10.3
fH
10.0
9.7
−3
0
FIGURE 6.26
(a) Band-pass responses of the biquad of Fig. 6.25 with (“Comp”) and without
(“Uncomp”) the compensating capactance Cc in place. (b) The response after predistortion
of C1 and C2.
(d) For active compensation we rewire the inverting ampliﬁer as in Fig. 6.27. According
to Eq. (6.45) the combined phase error of the second integrator and the inverting
ampliﬁerispositiveandoppositetothatoftheﬁrstintegrator,sotheoverallphaseerror
is neutralized thanks to a mere rewiring of the inverting ampliﬁer! PSpice indicates
that there is no frequency shift in this circuit, so C1 and C2 are left unchanged.
However, there is degradation in the value of Q. Empirically, it is found that raising
R4 to 504 k restores Q to 25.
Before concluding, we wish to point out the above compensation schemes as-
sume single-pole op amps. As seen in Fig. 6.1b for the 741, real-life op amps
exhibit additional high-frequency roots whose effect is to further increase the phase
error. Consequently, the schemes discussed above must be taken only as starting
points, in the sense that a practical circuit may require further tweaking of Cc in
the case of passive compensation, or other compensation measures to be discussed
in Chapter 8.
250 kΩ
IN+
IN−
OUT+
OUT−
EOA1
LAPLACE {v(P,N)} = {100k/(1+s/62.832)}
0
0
0
O1
Vi
1.5915 nF
C
R3
504 kΩ
R4
N1
I
Vo
+
–
10 kΩ
R1
10 kΩ
R2
IN+
IN−
OUT+
OUT−
EOA2
0
0
O2
1.5915 nF
C2
N2
10 kΩ
R5
IN+
IN−
OUT+
OUT−
EOA3
0
0
O3
10 kΩ
R6
N3
FIGURE 6.27
PSpice realization of the biquad of Example 6.10 using active compensation.

310
CHAPTER 6
Dynamic Op Amp
Limitations
6.6
EFFECT OF FINITE GBP ON FILTERS
In our study of active ﬁlters in Chapters 3 and 4, we assumed ideal op amps so
we could focus on ﬁlter responses alone, without having to worry about op amp
idiosyncrasies. We now wish to investigate the effect of op amp gain rolloff with
frequency. Unlike circuits with purely resistive feedback, ﬁlters exhibit a frequency-
dependent feedback factor β( j f ), so the loop gain T ( j f ) = a( j f ) × β( j f )| =
a( j f )/(1/β( j f ), besides admitting the same poles/zeros as a( j f ), will also include
the poles/zeros of β( j f ), which are, respectively, the zeros/poles of 1/β( j f ). As we
are about to see, the increased number of roots tends to complicate the calculation
of the discrepancy function D( j f ) = 1/[1 + 1/T ( j f )] and, hence, the transfer
function H( j f ). Mercifully, when hand analysis becomes prohibitive, we can turn
to computer simulation such as SPICE.
First-Order Filters
We start with the low-pass ﬁlter of Fig. 3.9a, repeated in PSpice form in Fig. 6.28a but
using the 1-MHz op amp of Fig. 6.3b. The circuit has been designed for H0(ideal) =
−R2/R1 = −10 V/V and f0(ideal) = 1/(2π R2C) = 20 kHz. The actual response,
shown in Fig. 6.28b, approaches the idealized response only up to the intercept of
the |a( j f )| and |1/β( j f )| curves, in the vicinity of ft. Cursor measurements give
H0 = −9.999 V/V and f0 = 16.584 kHz. Above the intercept, the slope of |H|
changes from −20 dB/dec to −40 dB/dec. Further up in frequency, where C acts as
a short, we have |H| →aft ∼= ro/R1 = 0.01 V/V (= −40 dB).
(a)
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(0,N)} = {100k/(1+s/62.832)}
0
0
0
0
0
Vo
OA
O
ro
100 kΩ
R2
10 kΩ
R1
I
N
T
rd
10 kΩ
R1b
R2b
Cb
100 kΩ
Nb
rob
100 Ω
80 pF
80 pF
1 MΩ
rdb
1 MΩ
Vtest
Vi
+
–
+
–
C
(b)
Frequency f (Hz)
Gain (dB)
105
106
108
107
103
−40
−20
0
20
104
|a|
|H|
|1/|
FIGURE 6.28
(a) First-order low-pass ﬁlter and (b) its frequency characteristics.

311
SECTION 6.6
Effect of Finite
GBP on Filters
Adapting Eq. (6.12), we write
H( j f ) = Vo
Vi
∼=
−10
1 + j f/(20 × 103) ×
1
1 + 1/T ( j f ) +
0.01
1 + T ( j f )
(6.49)
The open-loop gain a( j f ) has a pole frequency at 10 Hz, and the feedback factor
β( j f ) has a zero frequency near 20 kHz and a pole frequency near 200 kHz (see
Problem 6.55), so T ( j f ) has two pole frequencies at 10 Hz and 200 kHz, and a zero
frequency at 20 kHz. So long as |T ( j f )| ≫1, these roots have a limited impact
on H( j f ). Not so above the intercept, where H( j f ) departs signiﬁcantly from the
ideal, at ﬁrst because of the pole frequency at the intercept itself, and subsequently
because of the zero-frequency pair (in the vicinity of 10 MHz) needed to allow
for the high-frequency asymptote |H( j f )| →−40 dB (not surprisingly, the high-
frequency portion of the response is qualitatively similar to that of Fig. 6.20b because
at high frequencies C dominates over R2 in Fig. 6.28a, making the circuit act as an
integrator).
Next, we turn to the high-pass ﬁlter of Fig. 3.10a, repeated in PSpice form in
Fig. 6.29a but using the 1-MHz op amp of Fig. 6.3b. The circuit has been designed
for H0(ideal) = −R2/R1 = −10 V/V and f0(ideal) = 1/(2π R1C) = 1 kHz. The
actual response, shown in Fig. 6.28b, approaches the idealized response only up to
the intercept of the |a( j f )| and |1/β( j f )| curves, in the vicinity of 100 kHz, with
measured values of H0 = −9.987 V/V and f0 = 990 Hz. Above the intercept the
response changes to a low-pass type. Since feedthrough is more than a decade lower
than in Fig. 6.28a, we ignore it in the present case and adapt Eq. (6.12) to write
H( j f ) = Vo
Vi
∼= −10
f/103
1 + j f/103 ×
1
1 + 1/T ( j f )
(6.50)
Presently, β( j f ) has a pole frequency near 100 Hz and a zero frequency at 1 kHz
(see Problem 6.57), so T ( j f ) has two pole frequencies at 10 Hz and 100 Hz, and a
zero frequency at 1 kHz. So long as |T ( j f )| ≫1, these roots have little impact on
(a)
Vo
Vtest
(b)
Frequency f (Hz)
Gain (dB)
103
105
104
107
106
10
−20
0
20
102
|1/|
IN+
IN−
OUT+
OUT−
EOA
100 Ω
LAPLACE {v(0,N)} = {100k/(1+s/62.832)}
0
0
0
0
0
OA
O
ro
100 kΩ
R2
10 kΩ
R1
I
N
T
rd
10 kΩ
R1b
R2b
100 kΩ
Nb
rob
100 Ω
15.92 nF
1 MΩ
rdb
1 MΩ
Vi
+
–
+
–
C
15.92 nF
Cb
|H|
|a|
FIGURE 6.29
(a) First-order high-pass circuit and (b) its frequency response.

312
CHAPTER 6
Dynamic Op Amp
Limitations
Vo
a(s)
+
–
R3
R1
R2
C
+
Vi
C
FIGURE 6.30
The multiple-feedback band-pass ﬁlter.
H( j f ). Not so above the intercept, due to the pole frequency at the intercept itself. In
fact, the overall response is that of a wideband band-pass ﬁlter (see Problem 6.58).
Second-Order Filters
We now turn to the multiple-feedback conﬁguration of Fig. 6.30 as a popular second-
order ﬁlter representative. It can be shown (see Exercise 6.1) that for the case of an
op amp with gain a(s),rd = ∞, and ro = 0, the circuit admits the transfer function
H(s) = H0BP
(s/ω0)/Q
s2
ω2
0
+ 1
Q
s
ω0
+ 1 +
1
a(s)

s2
ω2
0
+ 2Q2 + 1
Q
s
ω0
+ 1
	
(6.51)
where H0BP, ω0, and Q are as in Eq. (3.71). It is apparent that as long as a(s) is
very large, the effect of the denominator block within parentheses will be negligible,
resulting in H(s) →H0BPHBP(s). But, as a(s) rolls off with frequency, the block
within parentheses becomes increasingly relevant, leading to a shift in all three ﬁlter
parameters. Moreover, the additional pole frequency arising at ft will make H(s)
roll off with an ultimate slope of −40 dB/dec instead of −20 dB/dec.
EXERCISE 6.1.
Derive Eq. (6.51).
We are primarily interested in the deviations of the resonance frequency and
the −3-dB bandwidth from their design values. It has been shown9 that as long as
Qf 0 ≪ft, we have
	f0
f0
∼= −	Q
Q
∼= −Q f0/ft
(6.52)
Evidently the product Q × f0 provides an indication of how demanding the ﬁlter
speciﬁcations are in terms of the GBP.
EXAMPLE 6.11.
Using 10-nF capacitances, specify suitable components in the circuit
of Fig. 6.30 for H0BP = 0 dB, f0 = 10 kHz, Q = 10, and a BW deviation from its design
value due to ﬁnite GBP of 1% or less.
Solution. Using Eqs. (3.72) and (3.73), we get R1 = 15.92 k, R2 = 79.98 , and R3 =
31.83 k. Since BW = f0/Q, Eq. (6.52) gives 	BW/BW ∼= −2Q f0/ft. Consequently,
GBP ≥2 × 10 × 104/0.01 = 20 MHz.

313
SECTION 6.6
Effect of Finite
GBP on Filters
(b)
(a)
10
102
103
104
105
106
107
Gain (dB)
Gain (dB)
104
 −100
 −80
 −3
 0
 −60
 −40
−20
 0
Predist
Frequency f (Hz)
W/o predist
LAPLACE {v(0,N)} = {100k/(1+s/62.832)}
15.92 kΩ
(13.25 kΩ)
R1
R2
79.98 Ω
(78.34 Ω)
I
IN+
IN−
OUT+
OUT−
EOA
0
0
O
31.83 kΩ
(27.0 kΩ)
10 nF
R3
N
C1
Vo
10 nF
C2
0
Vi
0
+
–
FIGURE 6.31
(a) Multiple-feedback band-pass ﬁlter (predistorted values shown inside parentheses), and
(b) expanded view of the frequency response before predistortion (top) and with and without
predistortion (bottom).
An alternative to using high-GBP op amps is to predistort the ﬁlter parameters
so as to make the actual values coincide with those given in the speciﬁcations. In this
respect, PSpice simulation provides an invaluable tool in determining the amount of
predistortion required for a given value of ft.
EXAMPLE 6.12.
Design a ﬁlter meeting the speciﬁcations of Example 6.11 with a
1-MHz op amp.
Solution. With ft = 1 MHz we get Q f0/ft = 0.1, so by Eq. (6.52) we expect a decrease
in f0 and an increase in Q on the order of 10%. For more accurate estimates we use
the PSpice circuit of Fig. 6.31a, whose overall response, shown at the top of Fig. 6.31b,
conﬁrms a frequency downshift as well as a high-frequency rolloff of −40 dB/dec instead
of −20 dB/dec. Cursor measurements on the expanded plot shown at the bottom give
H0BP = 0.981 V/V = −0.166 dB, fL = 8.73 kHz, fH = 9.55 kHz, and f0 = 9.13 kHz,
so Q = 9.13/(9.55 −8.73) = 11.3.
To achieve the desired parameter values, we redesign the circuit for the predis-
torted values of f0 = 10(10/9.13) = 10.95 kHz, Q = 10(10/11.3) = 8.85, and
H0BP = 1/0.981 = 1.02 V/V. Using again Eqs. (3.72) and (3.73), we ﬁnd the resistance
values shown within parentheses in Fig. 6.31a. Cursor measurements on the predistorted
response at the bottom of Fig. 6.31b give f0 = 10.0 kHz and Q = 10.
EXAMPLE 6.13.
Use PSpice to investigate the effect of implementing the DABP ﬁlter
of Example 4.8 with op amps having a0 = 80 dB and GBP = 1 MHz. Discuss your
ﬁndings.

314
CHAPTER 6
Dynamic Op Amp
Limitations
(b)
1
107
102
Impedance (Ω)
103
104
105
106
10
Frequency f (Hz)
1
10
102
103
104
105
106
105
104
Gain (dB)
−50
−25
0
|H|
|ZL|
(a)
OUT+
OUT−
IN+
IN−
EOA1
LAPLACE {v(P,N)} = {10k/(1+s/628.32)}
IN+
IN−
OUT+
OUT−
EOA2
0
0
0
0
0
Vi
R3
1.592 kΩ
C2
1 nF
Vo
R
O
C
1 nF
+
–
R4
1.592 kΩ
R1
1.592 kΩ
39.79 kΩ
R5
1.592 kΩ
FIGURE 6.32
(a) DABP ﬁlter of Example 6.13. (b) Frequency response |H| (top) and synthetic inductor
impedance |ZL| (bottom). (Thin traces show the responses for the case of ideal op amps.)
Solution.
Using the PSpice circuit of Fig. 6.32a, we get the response of Fig. 6.32b
(top), indicating that the effect of nonideal op amps is a decrease in f0, Q, and H0.
To gain better insight, it is convenient to plot also the impedance ZL of the synthetic
inductor, obtained by removing R and C, subjecting the synthetic inductor circuitry
to a test currrent It, and then letting ZL = Vo/It. It is apparent that the effect of the
gain rolloff of the op amps is to raise the effective value of L, causing it even to peak
between 105 and 106 Hz, and then to approach the high-frequency asymptote ZL →R1.
Fortunately, above 105 Hz, C takes over to ensure the eventual −20-dB rolloff of |H|. We
can signiﬁcantly improve the response by using faster op amps. For instance, rerunning
PSpice after raising their GBP from 1 MHz to 10 MHz, we get a response much closer
to ideal.
Concluding Remarks
Looking back at the integrator as well as the ﬁlter examples of the current section, we
conclude that the open-loop gain rolloff with frequency tends to cause a downshift
in the frequency characteristics of the ﬁlter as well as a steeper rate of descent at high
frequencies, at least up to the point at which feedthrough takes over. The interested
reader is referred to the literature9 for detailed studies of the effect of ﬁnite GBP on
ﬁlters. Within the scope of this book, we limit ourself to ﬁnding the actual response
via computer simulation, using the more realistic SPICE macromodels provided by
the manufacturers, and then applying predistortion in the manner of Examples 6.10
and 6.12. As rule of thumb, one should select an op amp with a GBP at least an order
of magnitude higher than the ﬁlter product Q f0 in order to reduce the effect of GBP
variations due to environmental and manufacturing process variations.

315
SECTION 6.7
Current-Feedback
Ampliﬁers
6.7
CURRENT-FEEDBACK AMPLIFIERS10
The op amps considered so far are also referred to as voltage-feedback ampliﬁers
(VFAs) because they respond to voltages. As we know, their dynamics are limited
by the gain-bandwidth product and the slew rate. By contrast, current-feedback
ampliﬁers (CFAs) exploit a circuit topology that emphasizes current-mode operation,
which is inherently much faster than voltage-mode operation because it is less prone
to the effect of stray node-capacitances. Fabricated using high-speed complementary
bipolar processes, CFAs can be orders of magnitude faster than VFAs.
As shown in the simpliﬁed diagram of Fig. 6.33, a CFA consists of three stages:
(a) a unity-gain input buffer, (b) a pair of current mirrors, and (c) an output buffer.
The input buffer is based on the push-pull pair Q1 and Q2, whose purpose is to
provide very low impedance at its output node vN, which also acts as the in-
verting input of the CFA. In the presence of an external network, the push-pull
pair can easily source or sink a substantial current iN, though we shall see that
in steady state iN approaches zero. Q1 and Q2 are driven by the emitter follow-
ers Q3 and Q4, whose purpose is to raise the impedance and lower the bias cur-
rent at the noninverting input vP. The followers also provide suitable pn-junction
voltage drops to bias Q1 and Q2 in the forward-active region and thus reduce
crossover distortion. By design, the input buffer forces vN to track vP. This is
similar to ordinary VFAs, except that the latter force vN to track vP via negative
feedback.
Any current drawn at node vN by the external network causes an imbalance
between the currents of the push-pull pair,
i1 −i2 = iN
(6.53)
Q6
Q1
Q5
Q3
Q2
Q8
Q7
Q4
Q9
Q10
Q11
Q12
IA1
IA2
IA1
vP
vN
vO
VEE
VCC
IA2
iN
iN
i1
i1
i2
i2
Gain
node
z
Input
buffer
Output
buffer
Current
mirrors
FIGURE 6.33
Simpliﬁed circuit diagram of a current-feedback ampliﬁer.

316
CHAPTER 6
Dynamic Op Amp
Limitations
vO
+
vI
vP
vN
VEE
i1
VCC
Req
Ceq
R1
R2
1i1
iN
iN
i2
1i2
1
1
Gain
node
FIGURE 6.34
Block diagram of a CFA conﬁgured as a noninverting ampliﬁer.
The current mirrors Q5-Q6 and Q7-Q8 replicate i1 and i2 and sum them at a
common node called the gain node. The voltage of this node is buffered to the
outside by another unity-gain buffer made up of Q9 through Q12. Ignoring the input
bias current of this buffer, we can write, by Ohm’s law,
Vo = z( j f )In
(6.54)
where z( j f ), the net equivalent impedance of the gain node toward ground, is called
the open-loop transimpedance gain. This transfer characteristic is similar to that of
a VFA, except that the error signal iN is a current rather than a voltage, and the gain
z( j f ) is in volts per ampere rather than volts per volt. For this reason CFAs are also
called transimpedance ampliﬁers.
The relevant CFA features are summarized in the block diagram of Fig. 6.34,
where z has been decomposed into the transresistance component Req and trans-
capacitance component Ceq. Letting z( j f ) = Req ∥[1/( j2π f Ceq)] and expanding,
we get
z( j f ) =
z0
1 + j f/fb
(6.55)
fb =
1
2π ReqCeq
(6.56)
where z0 = Req is the dc value of z( j f ). The gain z( j f ) is approximately constant
from dc to fb; thereafter it rolls off with frequency at the rate of −1 dec/dec.
Typically, Req is on the order of 106  (which makes z0 on the order of 1 V/μA),
Ceq on the order of 10−12 F, and fb on the order of 105 Hz.
EXAMPLE 6.14.
The CLC401 CFA has z0 ∼= 0.71 V/μA and fb ∼= 350 kHz. (a) Find
Ceq. (b) Find iN for vO = 5 V (dc).
Solution.
(a) Req ∼= 710 k, so Ceq = 1/(2π Req fb) ∼= 0.64 pF.
(b) iN = vO/Req ∼= 7.04 μA.

317
SECTION 6.7
Current-Feedback
Ampliﬁers
Closed-Loop Gain
Figure 6.35a shows a simpliﬁed CFA model, along with a negative-feedback net-
work. Whenever an external signal Vi tries to unbalance the CFA inputs, the input
buffer begins sourcing (or sinking) an imbalance current In. By Eq. (6.54), this
current causes Vo to swing in the positive (or negative) direction until the original
imbalance is neutralized via the negative-feedback loop, thus conﬁrming the role of
In as error signal.
Applying the superposition principle, we can write
In =
Vi
R1 ∥R2
−Vo
R2
(6.57)
Clearly, the feedback signal Vo/R2 is a current, and the feedback factor β = 1/R2
is now in amperes per volt. Substituting into Eq. (6.54) and collecting gives the
closed-loop gain
A( j f ) = Vo
Vi
=

1 + R2
R1

1
1 + 1/T ( j f )
(6.58)
T ( j f ) = z( j f )
R2
(6.59)
where T ( j f ) is called the loop gain. This name stems from the fact that a current
ﬂowing around the loop is ﬁrst multiplied by z( j f ) to be converted to a voltage, and
then divided by R2 to be converted back to a current, thus experiencing an overall
gain of T ( j f ) = z( j f )/R2. In the decade plot of |z| and |1/β| of Fig. 6.35b we can
visualize the decade value of |T | as the decade difference between the two curves.
For instance, if at a given frequency |z| = 105 V/A and |1/β| = 103 V/A, then
|T | = 105−3 = 102.
In their effort to maximize T ( j f ) and thus reduce the gain error, manufacturers
strive to maximize z( j f ) relative to R2. Consequently, the inverting-input current
In = Vo/z will be very small, even though this is the low-impedance output node
fb 
ft
f (dec)
z0
R2
V/A (dec)
+
Vi
+
–
+
zIn
R1
R2
In
Vo
1
(a)
(b)
T
z
1/ββ
FIGURE 6.35
Noninverting CFA ampliﬁer, and graphical method to visualize the loop gain |T |.

318
CHAPTER 6
Dynamic Op Amp
Limitations
of a buffer. In the limit z →∞we obtain In →0, indicating that a CFA will
ideally provide whatever output is needed to drive In to zero. Thus, the input voltage
constraint
Vn →Vp
(6.60a)
and the input current constraints
Ip →0
In →0
(6.60b)
hold also for CFAs, though for different reasons than for VFAs. Equation (6.60a)
holdsbydesigninaCFA,andbynegative-feedbackactioninaVFA;Eq.(6.60b)holds
by negative-feedback action in a CFA, and by design in a VFA. We can apply these
constraints to the analysis of CFA circuits, very much like in the analysis of conven-
tional VFAs.11
CFA Dynamics
To investigate the dynamics of the CFA of Fig. 6.34, we substitute Eq. (6.55) into
Eq. (6.59), and then into Eq. (6.58). This gives, for z0/R2 ≫1,
A( j f ) = A0 ×
1
1 + j f/ft
(6.61)
A0 = 1 + R2
R1
ft =
1
2π R2Ceq
(6.62)
where A0 and ft are, respectively, the closed-loop dc gain and bandwidth. With R2
in the kiloohm range and Ceq in the picofarad range, ft is typically in the range of
108 Hz. We observe that for a given CFA, the closed-loop bandwidth depends on
only R2. We can thus use R2 to set ft, and then adjust R1 to set A0. The ability
to control gain independently of bandwidth constitutes the ﬁrst major advantage of
CFAs over conventional op amps. Bandwidth constancy is illustrated in Fig. 6.36a.
100
f  (dec)
f  (dec)
10
0.1 ft
0.1 ft
 ft
 ft
 f1
 f10
 f100
1
100
10
GBP =  ft
1
(a)
(b)
 A   (V/V)
 A   (V/V)
FIGURE 6.36
Closed-loop bandwidth as a function of gain for (a) an ideal CFA and (b) a practical
CFA.

319
SECTION 6.7
Current-Feedback
Ampliﬁers
Next, we investigate the transient response. Applying a step vI = Vimu(t) to the
circuit of Fig. 6.35a will, by Eq. (6.57), result in the current iN = Vim/(R1 ∥R2) −
vO/R2. With reference to Fig. 6.34, we can also write iN = vO/Req +CeqdvO/dt.
Eliminating iN, we get, for R2 ≪Req,
R2Ceq
dvO
dt
+ vO = A0Vim
whose solution is vO = A0Vim[1 −exp(t/τ)]u(t),
τ = R2Ceq
(6.63)
The response is an exponential transient regardless of the input step magnitude,
and the time constant governing it is set by R2 regardless of A0. For instance, a
CLC401 op amp with R2 = 1.5 k has τ = 1.5 × 103 × 0.64 × 10−12 ∼= 1 ns. The
rise time is tR = 2.2τ ∼= 2.2 ns, and the settling time within 0.1% of the ﬁnal value
is tS ∼= 7τ ∼= 7 ns, in reasonable agreement with the data-sheet values tR = 2.5 ns
and tS = 10 ns.
Since R2 controls the closed-loop dynamics, data sheets usually recommend an
optimum value, typically in the range of 103 . For voltage follower operation R1
is removed, but R2 must be left in place to set the dynamics of the device.
Higher-Order Effects
According to the above analysis, once R2 has been set, the dynamics appear to be
unaffected by the closed-loop gain setting. However, the bandwidth and rise time of
a practical CFA do vary with A0 somewhat, though not as drastically as in VFAs. The
main reason is the nonzero output resistance rn of the input buffer, whose effect is to
reduce the loop gain somewhat, degrading the closed-loop dynamics in proportion.
Using the more realistic CFA model of Fig. 6.37a we get, by the superposition
principle, In = Vi/[rn + (R1 ∥R2)] −βVo, where the feedback factor β is found
V/A (dec)
fb 
R2 + rn
fB 
ft
f  (dec)
R2
z0
(1 + R2 /R1)
(b)
z
T
1/ββ
+
Vi
+
–
+
zIn
R1
R2
In
Vo
1
(a)
rn
FIGURE 6.37
Effect of the output impedance rn of the input buffer.

320
CHAPTER 6
Dynamic Op Amp
Limitations
using the current-divider formula and Ohm’s law,
β =
R1
R1 + rn
×
1
R2 + (rn ∥R1) =
1
R2 + rn(1 + R2/R1)
(6.64)
Clearly, the effect of rn is to shift the |1/β| curve upward, from R2 to R2 + rn(1 +
R2/R1). As pictured in Fig. 6.37b, this causes a decrease in the crossover frequency,
which we shall now denote as fB. This frequency is obtained by letting ft →fB
and R2 →R2 + rn(1 + R2/R1) in Eq. (6.62). The result can be put in the form
fB =
ft
1 + rn/(R1 ∥R2)
(6.65)
where now ft is the extrapolated value of fB in the limit rn →0.
EXAMPLE 6.15.
A certain CFA has ft = 100 MHz for 1/β = 1.5 V/mA. If R2 =
1.5 k and rn = 50 , ﬁnd R1, fB, and tR for A0 = 1 V/V, 10 V/V, and 100 V/V.
Comment on your results.
Solution.
By Eqs. (6.62) and (6.65), we can write, for the present circuit,
R1 = R2/(A0 −1)
fB = 108/(1 + A0/30)
Moreover, tR ∼= 2.2/2π fB. For A0 = 1, 10, and 100 V/V we get, respectively, R1 = ∞,
166.7 , and 15.15 ; fB = 96.8 MHz, 75.0 MHz, and 23.1 MHz; tR = 2.2/(2π ×
96.8 × 106) = 3.6 ns, 4.7 ns, and 15.2 ns. The bandwidth reductions, depicted in
Fig. 6.36b, still compare favorably with those of a VFA, whose bandwidth would be
reduced, respectively, by 1, 10, and 100.
The values of R1 and R2 can be predistorted to compensate for bandwidth reduc-
tion. We ﬁrst ﬁnd R2 for a given fB at a given A0; then we ﬁnd R1 for the given A0.
EXAMPLE 6.16. (a) Redesign the ampliﬁer of Example 6.15 so that with A0 = 10 V/V
it has fB = 100 MHz rather than 75 MHz. (b) Assuming z0 = 0.75 V/μA, ﬁnd the dc
gain error.
Solution.
(a) For fB = 100 MHz we need R2 +rn(1 + R2/R1) = 1.5 V/mA, or R2 = 1500 −
50 × 10 = 1 k. Then, R1 = R2/(A0 −1) = 103/(10 −1) = 111 .
(b) T0 = βz0 = (1/1500)0.75×106 = 500.Thedcgainerrorisϵ ∼= −100/T0 = −0.2%.
It is apparent that the presence of rn tends to degrade CFA dynamics. More
recent CFA architectures exploit internal negative feedback around the input buffer to
reduce its effective output resistance signiﬁcantly. One example is the OPA684 CFA
(look up its data sheets online), which, with an effective inverting-input resistance
of 2.5 , allows for the gain-setting element to be set with considerable freedom
from bandwidth interaction.
Applying CFAs
Though we have focused on the noninverting ampliﬁer, we can conﬁgure a CFA
for other familiar topologies.11 For instance, if we lift R1 off ground in Fig. 6.35a,
and apply Vi via R1 with the noninverting input at ground, we obtain the familiar

321
SECTION 6.7
Current-Feedback
Ampliﬁers
vO
vP
vN
rn
iN
Ceq
Req
0
0
0
1 V/V
Eo
+
–
+
–
1 A/A
F
1 V/V
Ei
+
–
+
–
FIGURE 6.38
Simpliﬁed PSpice model of a CFA, using VCVSs Ei and Eo, and
CCCS F.
inverting ampliﬁer. Its dc gain is A0 = −R2/R1, and its bandwidth is given by
Eq. (6.65). Likewise, we can conﬁgure CFAs as summing or difference ampliﬁers,
I-V converters, and so forth. Except for its much faster dynamics, a CFA works much
like a VFA, but with one notorious exception that will be explained in Chapter 8: it
must never include a direct capacitance between its output and inverting-input pins,
since this tends to make the circuit oscillatory. In fact, stable ampliﬁer operation
requires that 1/β ≥(1/β)min, where (1/β)min is also given in the data sheets.
Compared to VFAs, CFAs generally suffer from poorer input-offset-voltage and
input-bias-current characteristics. Moreover, they afford lower dc loop gains, usually
on the order of 103 or less. Finally, having much wider bandwidths, they tend to be
noisier. CFAs are suited to moderately accurate but very high-speed applications.
PSpice Models
CFA manufacturers provide macromodels to facilitate the application of their prod-
ucts. Alternatively, the user can create simpliﬁed models for a quick test of such
characteristics as noise and stability. Figure 6.38 shows one such model.
EXAMPLE 6.17. Use PSpice to display the (a) frequency and (b) transient responses of
the ampliﬁer of Example 6.15. For the frequency response show the magnitude plots of
z( j f ), 1/β, and A( j f ), and measure the dc gain error. For the transient response show
vO(t) and iN(t) if vI(t) is a 1-V step. Comment on the various plots.
Solution.
(a) Using the circuit of Fig. 6.39, we generate the frequency plots of Fig. 6.40a. Mea-
suring the dc gain with the cursor, we get A0 = 9.981 V/V, indicating a dc error of
100(9.981 −10)/10 = −0.19%, in agreement with Example 6.15b.
(b) Next, we change the ac input source Vi of Fig. 6.39 to a 1-V step and perform
the transient analysis, whose results are depicted in Fig. 6.40b. Since the crossover
frequency in Fig. 6.40a is 100 MHz, the time constant governing the transient is
τ = 1/(2π108) = 1.59 ns. Note also the current spike through rn, which starts at
the fairly high value iN(0) = vI(0)/(rn + R1∥R2) = 1/(50 + 111.1∥1, 000) =
6.7 mA, but as the transient dies out, it drops to the much smaller value iN(∞) =
vO(∞)/Req ∼= 10/(750 k) = 13.3 μA.

322
CHAPTER 6
Dynamic Op Amp
Limitations
+
–
Vo
N
50 Ω
111.1 Ω
rn
Ceq
1.061 pF
Req
750 kΩ
R2
R1
0
0
0
0
Nb
T
50 Ω
111.1 Ω
rnb
R1b
1.0 kΩ
R2b
0
0
0
1 V/V
Eo
+
–
+
–
1 A/A
F
1 V/V
Ei
I
+
–
Vi
0
Vtest
+
–
+
–
1.0 kΩ
FIGURE 6.39
PSpice circuit to plot the frequency and transient responses of the CFA circuit of
Example 6.15. The |z| trace is plotted on a logarithmic scale as V(O)/(-I(rn)),
the |1/β| trace as V(T)/I(rnb), and the |A| trace as DB(V(O)/V(I)).
High-Speed Voltage-Feedback Ampliﬁers
The availability of high-speed complementary bipolar processes and the emergence
of applications requiring increased speeds have led to the development of faster
(a)
(b)
104
105
106
107
108
109
V/A
102
103
104
105
106
104
105
106
107
108
109
Gain A (dB)
0
Frequency f (Hz)
Time (ns)
5
10
15
20
0
5
10
vO (V)
0
5
10
0
5
10
iN (mA)
0
4
8
|A|
|z|
1/
iN
vO
FIGURE 6.40
(a) Frequency response and (b) step response of the circuit of Fig. 6.39.

323
SECTION 6.7
Current-Feedback
Ampliﬁers
Q11
Q6
Q12
Q16
Q15
Q14
Q13
Q1
Q4
Q5
Q2
Q3
Q7
Q8
Q9
Q10
IA2
IA2
IA1
IA1
IA1
IA1
vP
vO
vN
Gain
node
z
VEE
VCC
R
         
FIGURE 6.41
Simpliﬁed circuit diagram of a CFA-derived VFA.
voltage-feedback ampliﬁers (VFAs),12 alongside the current-feedback ampliﬁers
(CFAs) just discussed. Though the borderline between standard and high-speed
VFAs keeps changing, at the time of writing we can take a high-speed VFA as one
having13 GBP > 50 MHz and SR > 100 V/μs. Two of the most popular high-speed
VFA architectures in current use are illustrated in Figs. 6.41 and 6.42.
The VFA of Fig. 6.41 is similar to the CFA of Fig. 6.33, except for the addition
of a unity-gain buffer (Q13 through Q16) to raise the input impedance at node vN,
and the fact that the dynamics-controlling resistor R is now driven by the two input
buffers. Since the current available to charge/discharge the gain-node capacitance
Ceq is proportional to the magnitude of the input voltage difference as (vP −vN)/R,
this VFA retains the slewing characteristics of a CFA. However, in all other respects
Q3
Q2
Q1
Q5
Q6
Q4
vP
vN
VA
vO
Gain node
VCC
Ceq
VEE
R
R
2I
2I
2I
I
+
1
I
FIGURE 6.42
Simpliﬁed circuit diagram of a folded cascode bipolar VFA.

324
CHAPTER 6
Dynamic Op Amp
Limitations
this architecture exhibits the characteristics of a VFA, namely, high input impedance
at both nodes vP and vN, a decreasing closed-loop bandwidth with increasing closed-
loop gain, and better dc characteristics than CFAs as the dc errors of the two matched
input buffers tend to cancel each other out. This architecture can be used in all
traditional VFA conﬁgurations, including inverting integrators. An example of a
VFA using this architecture is the LT1363 70-MHz, 1000-V/μs op amp.
The trend toward high speed as well as low-power-supply voltages has inspired
the folded cascode architecture, which ﬁnds wide use both in complementary bipo-
lar processes and CMOS processes. In the bipolar illustration14 of Fig. 6.42, any
imbalance between vP and vN will cause an imbalance in the collector currents of
the common-emitter npn pair Q1 and Q2, and this current imbalance is in turn fed
to the emitters of the common-base pnp pair Q3 and Q4 (hence the term folded
cascode). The latter pair is actively loaded by the current mirror Q5 and Q6 to
provide high voltage gain at the gain node, whence the signal is buffered to the
outside via a suitable unity-gain stage. Product examples utilizing this architec-
ture are the EL2044C low-power/low-voltage 120-MHz unity-gain stable op amp,
and the THS4401 high-speed VFA offering a unity-gain bandwidth of 300 MHz,
SR = 400 V/μs, and tS = 30 ns to 0.1%.
PROBLEMS
6.1 Open-loop frequency response
6.1 Cursor measurements on the 741 response of Fig. 6.1b give a0 = 185, 200 V/V, fb =
5.26 Hz, ft = 870.1 kHz, and ph a( j ft) = −116.7◦. (a) Assuming all higher-order
roots can be modeled with a single-pole frequency f p( f p > ft), estimate f p so as to
match the value of ph a( j870.1 kHz). (b) Find the new values of ft and ph a( j f t), and
comment.
6.2 Given that the gain of a constant-GBP op amp has a magnitude of 80 dB at f = 10 Hz
and a phase angle of −58◦at f = 320 Hz, estimate a0, fb, and ft.
6.3 (a) Because of manufacturing process variations, the second-stage gain of a certain
741 op amp version is −a2 = −544 V/V ±20%. How does this affect a0, fb, and ft?
(b) Repeat, but for Cc = 30 pF ±10%.
6.4 Given that a constant-GBP op amp has |a( j100 Hz)| = 1 V/mV and |a( j1 MHz)| =
10 V/V, ﬁnd (a) the frequency at which a = −60◦, and (b) the frequency at which
|a| = 2 V/V. Hint: Start out with the linearized magnitude plot.
6.2 Closed-loop frequency response
6.5 Show that the circuit of Example 6.2 yields A( j f ) = H0LP × HLP. What are the values
of H0LP, f0, and Q?
6.6 (a) Show that cascading n identical noninverting ampliﬁers with individual dc gains
A0 yields a composite ampliﬁer with the overall bandwidth fB = ( ft/A0)
√
21/n −1.
(b) Develop a similar expression for the case of n inverting ampliﬁers with individual
dc gains −A0.

325
Problems
6.7 (a) Repeat Example 6.2, but for a cascade of three 741 noninverting ampliﬁers with
individual dc gains of 10 V/V. (b) Compare the −3-dB bandwidths of the one-op amp,
two-op amp, and three-op amp designs, and comment.
6.8 (a) Consider the cascade connection of a noninverting ampliﬁer with A0 = 2 V/V,
and an inverting ampliﬁer with A0 = −2 V/V. If both ampliﬁers use op amps with
GBP = 5 MHz, ﬁnd the −3-dB frequency of the composite ampliﬁer. (b) Find the 1%
magnitude error and the 5◦phase-error bandwidths.
6.9 (a) Find the closed-loop GBP of the inverting ampliﬁer of Fig. P1.64 if R1 =
R2 = · · · = R6 = R, rd ≫R, ro ≪R, and ft = 4 MHz. (b) Repeat if the source
vI is applied at the noninverting input and the left terminal of R1 is connected to
ground. (c) Repeat part (b), but with the left terminal of R1 left ﬂoating. Comment.
6.10 (a) Using a 10-MHz op amp, design a two-input summing ampliﬁer such that vO =
−10(v1 +v2); hence, ﬁnd its −3-dB frequency. (b) Repeat, but for ﬁve inputs, or vO =
−10(v1 + · · · + v5). Compare with the ampliﬁer of part (a) and comment.
6.11 Assuming 741 op amps, ﬁnd the −3-dB frequency of the circuits of (a) Fig. P1.17,
(b) Fig. P1.19, (c) Fig. P1.22, and (d) Fig. P1.72.
6.12 Find the −3-dB frequency of the triple-op-amp IA of Fig. 2.21, given that all op amps
have GBP = 8 MHz. Calculate with the wiper all the way down and all the way up.
6.13 In the dual-op amp IA of Fig. 2.23 let R3 = R1 = 1 k, R4 = R2 = 9 k, and
ft1 = ft2 = 1 MHz. Find the −3-dB frequency with which the IA processes V2, and
that with which it processes V1.
6.14 Sketch and label the frequency plot of the CMRRdB of the IA of Problem 6.13.
Except for the ﬁnite ft, the op amps are ideal and the resistance ratios are perfectly
matched.
6.15 A triple-op amp instrumentation ampliﬁer with A = 10 V/V is to be designed using
three constant-GBP, JFET-input op amps of the same family. Letting A = AI × AII,
how would you choose AI and AII in order to minimize the worst-case output dc error
E0? Maximize the overall −3-dB bandwidth?
6.16 Three signals v1, v2, and v3 are to be summed using the topology of Fig. P1.33, and
two alternatives are being considered: vO = v1 + v2 + v3 and vO = −(v1 + v2 + v3).
Which option is most desirable from the viewpoint of minimizing the untrimmed dc
output error EO? Maximizing the −3-dB frequency?
6.17 A unity-gain buffer is needed and the following options are being considered, each
offering advantages and disadvantages in the event that the circuit must subsequently be
altered: (a) a voltage follower, (b) a noninverting ampliﬁer with A0 = 2 V/V followed
by a 2:1 voltage divider, and (c) a cascade of two unity-gain inverting ampliﬁers.
Assuming constant-GBP op amps, compare the advantages and disadvantages of the
three alternatives.
6.18 Find the closed-loop GBP of the inverting ampliﬁer of Fig. 1.42a, given that R1 =
10 k, R2 = 20 k, R3 = 120 k, R4 = 30 k, and ft = 27 MHz. Except for its
ﬁnite ft, the op amp can be considered ideal.

326
CHAPTER 6
Dynamic Op Amp
Limitations
6.19 Findtheclosed-loopgainandbandwidthofthehigh-sensitivity I-V converterofFig.2.2
if R = 200 k, R1 = R2 = 100 k, and the input source has a 200-k parallel resistance
toward ground. The op amp is ideal, except for a constant GBP such that at 1.8 kHz the
open-loop gain is 80 dB.
6.20 The circuit of Fig. P1.22 is implemented with three 10-k resistances and an op amp
with a0 = 50 V/mV, IB = 50 nA, IOS = 10 nA, VOS = 0.75 mV, CMRRdB = 100 dB,
and ft = 1 MHz. Assuming vI = 5 V, ﬁnd the maximum dc output error as well as the
small-signal bandwidth with both the switch open and the switch closed.
6.3 Input and output impedances
6.21 If the ﬂoating-load V-I converter of Fig. 2.4a is implemented with an op amp having
a0 = 105 V/V, fb = 10 Hz, rd ≫R, ro ≪R, and R = 10 k, sketch and label the
magnitude Bode plot of the impedance Zo( j f ) seen by the load; hence, ﬁnd the element
values of its equivalent circuit.
6.22 Find the impedance Zo( j f ) seen by the load in the V-I converter of Fig. P2.7 if the
op amp has a0 = 105 V/V, ft = 1 MHz, rd = ∞, ro = 0, R1 = R2 = 18 k, and
R3 = 2 k.
6.23 If the Howland current pump of Fig. 2.6a is implemented with four 10-k resistances
and an op amp having a0 = 105 V/V, ft = 1 MHz, rd = ∞, and ro = 0, sketch and label
the magnitude plot of the impedance Zo seen by the load. Justify using physical insight.
6.24 The negative-resistance converter of Fig. 1.21b is implemented with three 10-k re-
sistances and an op amp with GBP = 1 MHz. Find its impedance Zeq. How does it
change as f is swept from 0 to ∞?
6.25 The grounded-load current ampliﬁer of Fig. 2.12b is implemented with R1 = R2 =
10 k and an op amp having ft = 10 MHz, rd = ∞, and ro = 0. If the ampliﬁer is
driven by a source with a parallel resistance of 30 k and drives a load of 2 k, sketch
and label the magnitude plots of the gain, the impedance seen by the source, and the
impedance seen by the load.
6.26 A constant-GBP JFET-input op amp with a0 = 105 V/V, ft = 4 MHz, and ro = 100 
is conﬁgured as an inverting ampliﬁer with R1 = 10 k and R2 = 20 k. What is the
frequency at which resonance with a 0.1-μF load capacitance will occur? What is the
value of Q?
6.27 In the circuit of Fig. 1.42a let R1 = R2 = R3 = 30 k, R4 = ∞, and let the op amp
have a0 = 300 V/mV and fb = 10 Hz. Assuming rd = ∞and ro = 0, sketch and label
the magnitude plot of the impedance Z( j f ) between the node common to R2 and R3,
and ground; use log-log scales.
6.28 In the circuit of Fig. 1.14b let both the 10-k and 30-k resistances be changed to
1 k, and let the 20-k resistance be changed to 18 k. Assuming rd = ∞, ro = 0,
and ft = 1 MHz, sketch and label the magnitude plot of the impedance Z( j f ) seen by
the input source; use log-log scales.
6.29 The op amp of Fig. 6.3b is conﬁgured as a unity-gain inverting ampliﬁer via two
identical 10-k resistances. (a) Find the asymptotic values and the break frequencies

327
Problems
of the magnitude Bode plot of its output impedance Zo( j f ). What are the element
values of its equivalent circuit? (b) Repeat, but for the input impedance Zi( j f ).
6.4 Transient response
6.30 Investigate the response of the high-sensitivity I-V converter of Example 2.2 to an input
step of 10 nA. Except for ft = 1 MHz and SR = 5 V/μs, the op amp is ideal.
6.31 Investigate the response of a Howland current pump to an input step of 1 V. The circuit
is implemented with four 10-k resistances and a 1-MHz op amp, and it drives a 2-k
load.
6.32 (a) Using a 741C op amp powered from ±15-V regulated supplies, design a circuit that
gives vO = −(vI +5 V) with the maximum small-signal bandwidth possible. (b) What
is this bandwidth? What is the FPB?
6.33 An inverting ampliﬁer with A0 = −2 V/V is driven with a square wave of peak values
±Vim and frequency f. With Vim = 2.5 V, it is observed that the output turns from
trapezoidal to triangular when f is raised to 250 kHz; with f = 100 kHz, it is found
that slew-rate limiting ceases when Vim is lowered to 0.4 V. If the input is changed to a
3.5-V (rms) ac signal, what is the useful bandwidth of the circuit? Is it small-signal or
large-signal limited?
6.34 Find the response of the cascaded ampliﬁer of Example 6.2 to a 1-mV input step.
6.35 A cascaded ampliﬁer consists of an op amp OA1, operating as a noninverting ampliﬁer
with A0 = +20 V/V, followed by an op amp OA2, operating as an inverting ampliﬁer
with A0 = −10 V/V. Sketch the circuit; then ﬁnd the minimum values of ft1, SR1, ft2,
and SR2 needed to ensure an overall bandwidth of 100 kHz with a full-power output
signal of 5 V (rms).
6.36 In the dual-op-amp IA of Fig. 2.23 let R3 = R1 = 1 k, R4 = R2 = 9 k, and ft1 = ft2 =
1 MHz. Find the small-signal step response if (a) v1 = 0 and the step is applied at v2,
(b) v2 = 0 and the step is applied at v1, and (c) the step is applied at v1 and v2 tied
together.
6.37 (a) Using the LF353 dual JFET-input op amp, whose ratings are VOS(max) = 10 mV,
GBP = 4 MHz, and SR = 13 V/μs, design a cascaded ampliﬁer having an overall gain
of 100 V/V as well as provision for overall offset-error nulling. (b) Find the small-signal
bandwidth as well as the FPB. (c) If the circuit is to operate with a 50-mV (rms) ac
input, what is its useful frequency range of operation? Is it small-signal or large-signal
limited?
6.38 A JFET-input op amp is conﬁgured as an inverting ampliﬁer with A0 = −10 V/V and
is driven by a 1-V (peak-to-peak) ac signal. Assuming a0 = 200 V/mV, ft = 3 MHz,
and SR = 13 V/μs, estimate the peak-to-peak amplitude of the inverting input voltage
vN for f = 1 Hz, 10 Hz, . . . , 10 MHz. Comment.
6.39 In the high-sensitivity I-V converter of Fig. 2.2 let R = 100 k, R1 = 10 k, R2 =
30 k, and let the op amp have ft = 4 MHz and SR = 15 V/μs. Except for these
limitations, the op amp can be considered ideal. If iI = 20 sin(2π f t) μA, what is the
useful bandwidth of the circuit? Is it small-signal or large-signal limited?

328
CHAPTER 6
Dynamic Op Amp
Limitations
6.40 Equation (6.30) indicates that if we want to avoid slew-rate limiting in a voltage follower
implemented with an op amp having SR = 0.5 V/μs and ft = 1 MHz, we must limit
the input step magnitude below about 80 mV. What is the maximum allowed input step
if the same op amp is conﬁgured as: (a) An inverting ampliﬁer with a gain of −1 V/V?
(b) A noninverting ampliﬁer with a gain of +2 V/V? (c) An inverting ampliﬁer with a
gain of −2 V/V?
6.41 Assuming equal resistors in the circuit of Fig. P1.64, ﬁnd the minimum values of SR
and ft required for a useful bandwidth of 1 MHz for a sinusoidal input with a peak
amplitude of 1 V.
6.42 The wideband band-pass ﬁlter of Example 3.5 is to be implemented with a constant
GBP op amp. Find the minimum ft and SR for an undistorted full-power output
with a magnitude error of less than 1% over the entire audio range (that is, 20 Hz to
20 kHz).
6.5 Effect of ﬁnite GBP on integrator circuits
6.43 (a) Apply Eq. (6.13) to the integrator of Fig. 6.20a to calculate the zero pair of H(s).
Where are the two zeros located in the s-plane? Hint: In the frequency region of the
zeros you can approximate a(s) ∼= ωt/s and T (s) = a(s)β∞∼= a(s). (b) Find a
transfer function Hm( j f ) that will match as closely as possible the response H( j f ) of
the integrator of Fig. 6.20a. Start out with initial pole-frequency estimates of 100 Hz
and 1 MHz, and zero-frequency estimates of 10 MHz each, and ﬁddle with their values
until the PSpice plot of |Hm(jf)| matches that of |H(jf)| (you may wish to superimpose
the respective plots to show how well they match).
6.44 Predict the transient response of the integrator of Fig. 6.20a to a 10-mV input step and
compare with the integrator response in the limit a →∞.
6.45 Discuss the implications of replacing the op amp of Fig. 6.20a with a better unit having
(a) ft = 100 MHz, and (b)a0 = 104 V/V. Sketch and label the magnitude plots of a,
1/β,and H,andestimatetheintegrator’sunity-gainfrequency.ComparewithFig.6.20b
and comment.
6.46 The integrator of Fig. 3.6 is implemented with a JFET-input op amp having a0 =
50 V/mV, ft = 4 MHz, and ro = 100. If R = 15.8 k and C = 1 nF, sketch and
label the magnitude Bode plot of its output impedance Zo( j f ). Hint: Use Eq. (6.23b).
6.47 ADeboointegratorisimplementedwithfour10-kresistances,a3.183-nFcapacitance,
and a 1-MHz op amp having a0 = 106 dB, rd = ∞, and ro = 0. (a) Sketch and label
the magnitude Bode plots of a( j f ), 1/β( j f ), and H( j f ). (b) Estimate the downshift in
the unity-gain frequency.
6.48 A Deboo integrator is implemented with four 10-k resistances, a 1-nF capacitance,
and a 1-MHz op amp having a0 = 1 V/mV, rd = ∞, and ro = 0. Predict its transient
response to a 10-mV input step and compare with the integrator response in the limit
a →∞.
6.49 (a) Assuming rd = ∞, ro = 0, and a( j f ) ∼= ft/j f , ﬁnd H( j f ) for the compensated
integrator of Fig. 6.21a. (b) Show that letting Cc = C/( ft/f0 −1) makes H ∼= Hideal.
(c) Specify suitable components for f0 = 10 kHz, and verify with PSpice for ft =
1 MHz.

329
Problems
6.50 (a) Assuming rd = ∞, ro = 0, and a( j f ) ∼= ft/j f , ﬁnd H( j f ) for the compensated
integrator of Fig. 6.21b. (b) Show that letting Rc = 1/(2πC ft) makes H = Hideal.
(c) Specify suitable components for f0 = 10 kHz if ro = 100 , and verify with
PSpice for ft = 1 MHz.
6.51 (a) Find H( j f ) for the circuit of Fig. 6.22b, rationalize it, and discard higher-order terms
to show that ϵφ = + f/ft for f ≪ft. (b) Verify with PSpice for the case f0 = 10 kHz
and ft = 1 MHz.
6.52 (a) Find an expression for the phase error of the Deboo integrator of Problem 6.47.
(b) Find a suitable resistance Rc that, when placed in series with the capacitance, will
provide phase-error compensation.
6.53 TheactivecompensationschemeofFig.P6.53(seeElectronicsandWirelessWorld,May
1987) is a generalization of that of Fig. 6.22a, in that it allows for phase-error control.
Verify that the error function of this circuit is (1+ j f/β2 ft2)/(1+ j f/ft1−f 2/β2 ft1 ft2),
β2 = R1/(R1 + R2). What happens if the op amps are matched and R1 = R2? Would
you have any use for this circuit?
R
C
R1
R2
+
Vi
Vo
+
–
a1
+
–
a2
FIGURE P6.53
6.54 The active compensation method of Problem 6.53 can also be applied to the
Deboo integrator, as shown in Fig. P6.54 (see Proceedings of the IEEE, February 1979,
pp. 324–325). Show that for matched op amps and f ≪ft we have ϵφ ∼= −( f/0.5 ft)3.
R
R
2C
R1
R2
R
+
Vi
Vo
+
–
a1
+
–
a2
R
FIGURE P6.54

330
CHAPTER 6
Dynamic Op Amp
Limitations
6.6 Effect of ﬁnite GBP on ﬁlters
6.55 Obtain an expression for the feedback factor β( j f ) of the low-pass circuit of Fig. 6.28a.
What are the values of its pole and zero frequencies?
6.56 Sketch and label the magnitude plot of the output impedance Zo( j f ) of the low-pass
ﬁlter of Fig. 6.28a.
6.57 Obtain an expression for the feedback factor β( j f ) of the high-pass circuit of Fig.
6.29a. What are the values of its pole and zero frequencies?
6.58 Because of the op amp’s ﬁnite GBP, the response of the high-pass ﬁlter of Fig. 6.29a is
actually a band-pass, or H( j f ) = H0BPHBP( j f ). (a) Assuming rd = ∞and ro = 0,
expand Eq. (6.50) to ﬁnd expressions for H0B P, Q, and the resonance frequency. (b)
Calculate the lower −3-dB frequency of the band-pass response, compare it with the
intended −3-dB frequency of the high-pass response, and comment.
6.59 Calculate the new values of H0BP, Q, and f0 if the circuit of Example 6.11 is imple-
mented with an op amp having a low dc gain of a0 = 10/V/V but extremely high
bandwidth ( ft →∞). Comment on how the various parameters are affected.
6.60 Investigate the effect of a constant GBP op amp on the phase shifter of Fig. 3.12. What
are the magnitude and phase errors at f0 if f0 = 10 kHz and GBP = 1 MHz?
6.61 (a) Specify suitable component values for the D element of Fig. 4.15b for a FDNR of
–1 k at 1 kHz. (b) Use PSpice to plot the FDNR versus frequency, both for the case
of ideal op amps, and for the case of op amps with GBP = 1 MHz and dc open-loop
gain of 100 dB (use log scales). What is the useful frequency range of the FDNR in the
latter case?
6.62 Obtain an expression of the type of Eq. (6.51) for the low-pass KRC ﬁlter of Fig. 3.23.
6.63 Use the μA741 macromodel of PSpice to assess the departure from ideality of the
band-pass response of the state-variable ﬁlter of Example 3.18. If needed, compensate
and predistort to improve accuracy.
6.64 Investigate the effect of using an op amp with GBP = 1 MHz in the notch ﬁlter of
Example 3.14.
6.65 The effect of ﬁnite GBP on the unity-gain KRC ﬁlter of Fig. 3.25 can be compensated for
by placing a suitable resistance Rc in series with C and decreasing R to R−Rc. (a) Show
that compensation is achieved for Rc = 1/(2πC ft). (b) Show the compensated circuit
of Example 3.10 if the op amp is a 741 type.
6.7 Current-feedback ampliﬁers
6.66 In this and the following problems, assume a CFA with z0 = 0.5 V/μA, Ceq =
1.59 pF, rn = 25 , IP = 1 μA, IN = 2 μA, and (1/β)min = 1 V/mA. Moreover,
assume the input buffer has an offset voltage VOS = 1 mV. (a) Using this CFA, design
an inverting ampliﬁer with A0 = −2 V/V and the maximum possible bandwidth. What
is this bandwidth? The dc loop gain? (b) Repeat, but for A0 = −10 V/V and the same
bandwidth as in part (a). (c) Repeat (a), but for a difference ampliﬁer with a dc gain of
1 V/V.

331
References
6.67 (a) Using the CFA of Problem 6.66, design a voltage follower with the widest possible
bandwidth. (b) Repeat, but for a unity-gain inverting ampliﬁer. How do the closed-loop
GBPs compare? (c) Modify both circuits so that the closed-loop bandwidth is reduced
in half. (d) How do the maximum dc output errors compare in the various circuits?
6.68 (a) Using the CFA of Problem 6.66, provide two designs for an I-V converter with a dc
sensitivity of −10 V/mA. (b) How do the closed-loop bandwidths compare? How do
the maximum output errors compare?
6.69 The data sheets recommend the circuit of Fig. P6.69 to adjust the closed-loop dynamics.
Assuming the CFA data of Problem 6.66, estimate the closed-loop bandwidth and rise
time as the wiper is varied from end to end.
+
Vi
1 kΩ
1 kΩ
110 Ω
Vo
+
–
CFA
FIGURE P6.69
6.70 Using the CFA of Problem 6.66, design a second-order 10-MHz low-pass ﬁlter with
Q = 5.
6.71 (a) Sketch a block diagram of the type of Fig. 6.34, but for the CFA-derived VFA
of Fig. 6.41. Hence, denoting the output resistance of each input buffer as ro, obtain
expressions for the open-loop gain a( j f ) and the slew-rate SR. (b) Assuming z( j f ) can
be modeled with a 1-M resistance in parallel with a 2-pF capacitance, and R = 500 
and ro = 25 , ﬁnd a0, fb, ft, β, T0, A0, and fB, if R1 = R2 = 1 k. (c) What is the
SR for the case of a 1-V input step?
REFERENCES
1. J. E. Solomon, “The Monolithic Operational Ampliﬁer: A Tutorial Study,” IEEE J.
Solid-State Circuits, Vol. SC-9, December 1974, pp. 314–332.
2. S. Franco, Electric Circuits Fundamentals, Oxford University Press, New York, 1995.
3. R. I. Demrow, “Settling Time of Operational Ampliﬁers,” Application Note AN-359,
Applications Reference Manual, Analog Devices, Norwood, MA, 1993.
4. C. T. Chuang, “Analysis of the Settling Behavior of an Operational Ampliﬁer,” IEEE J.
Solid-State Circuits, Vol. SC-17, February 1982, pp. 74–80.
5. J. Williams, “Settling Time Measurements Demand Precise Test Circuitry,” EDN,
Nov. 15, 1984, p. 307.
6. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009, ISBN 978-0-470-
24599-6.
7. P. O. Brackett and A. S. Sedra, “Active Compensation for High-Frequency Effects in
Op Amp Circuits with Applications to Active RC Filters,” IEEE Trans. Circuits Syst.,
Vol. CAS-23, February 1976, pp. 68–72.

332
CHAPTER 6
Dynamic Op Amp
Limitations
8. L. C. Thomas, “The Biquad: Part I—Some Practical Design Considerations,”
and “Part II—A Multipurpose Active Filtering System,” IEEE Trans. Circuit Theory,
Vol. CT-18, May 1971, pp. 350–361.
9. A. Budak, Passive and Active Network Analysis and Synthesis, Waveland Press, Prospect
Heights, IL, 1991.
10. Based on the author’s article “Current-Feedback Ampliﬁers Beneﬁt High-Speed
Designs,” EDN, Jan. 5, 1989, pp. 161–172. c⃝Cahners Publishing Company, a Division
of Reed Elsevier Inc., Boston, 1997.
11. R.Mancini,“ConvertingfromVoltage-FeedbacktoCurrent-FeedbackAmpliﬁers,”Elec-
tronic Design Special Analog Issue, June 26, 1995, pp. 37–46.
12. D. Smith, M. Koen, and A. F. Witulski, “Evolution of High-Speed Operational Ampliﬁer
Architectures,” IEEE J. Solid-State Circuits, Vol. SC-29, October 1994, pp. 1166–1179.
13. Texas Instruments Staff, DSP/Analog Technologies, 1998 Seminar Series, Texas Instru-
ments, Dallas, TX, 1998.
14. W.Kester,“HighSpeedOperationalAmpliﬁers,”HighSpeedDesignTechniques,Analog
Devices, Norwood, MA, 1996.
15. W. Jung, Op Amp Applications Handbook (Analog Devices Series), Elsevier/Newnes,
Burlington, MA, 2005, ISBN 0-7506-7844-5.

7
NOISE
7.1 Noise Properties
7.2 Noise Dynamics
7.3 Sources of Noise
7.4 Op Amp Noise
7.5 Noise in Photodiode Ampliﬁers
7.6 Low-Noise Op Amps
Problems
References
Any unwanted disturbance that obscures or interferes with a signal of interest is
generally referred to as noise.1,2 The offset error due to the input bias current and
input offset voltage is a familiar example of noise, dc noise in this case. However,
there are many other forms of noise, particularly ac noise, which can signiﬁcantly
degrade the performance of a circuit unless proper noise reduction measures are
taken. Depending on its origin, ac noise is classiﬁed as external, or interference,
noise, and internal, or inherent, noise.
Interference Noise
This type of noise is caused by unwanted interaction between the circuit and the
outside, or even between different parts of the circuit itself. This interaction can be
electric, magnetic, electromagnetic, or even electromechanical, such as microphonic
and piezoelectric noise. Electric and magnetic interaction takes place through the
parasitic capacitances and mutual inductances between adjacent circuits or adjacent
parts of the same circuit. Electromagnetic interference stems from the fact that each
wire and trace constitutes a potential antenna. External noise can inadvertently be
injected into a circuit also via the ground and power-supply busses.
333

334
CHAPTER 7
Noise
Interference noise can be periodic, intermittent, or completely random. Usually
it is reduced or forestalled by minimizing electrostatic and electromagnetic pickup
from line frequency and its harmonics, radio stations, mechanical switch arching,
reactive component voltage spikes, etc. These precautions may include ﬁltering,
decoupling, guarding, electrostatic and electromagnetic shielding, physical reorien-
tation of components and leads, use of snubber networks, ground-loop elimination,
and use of low-noise power supplies. Though often misconceived as “black magic,”
interference noise can be explained and dealt with in a rational manner.3,4
Inherent Noise
Even if we manage to remove all interference noise, a circuit will still exhibit inherent
noise. This form of noise is random in nature and is due to random phenomena,
such as the thermal agitation of electrons in resistors and the random generation
and recombination of electron-hole pairs in semiconductors. Because of thermal
agitation, each vibrating electron inside a resistor constitutes a minuscule current.
These currents add up algebraically to originate a net current and, hence, a net
voltage that, though zero on average, is constantly ﬂuctuating because of the random
distributionof theinstantaneous magnitudes and directionsof theindividualcurrents.
These ﬂuctuations occur even if the resistor is sitting in a drawer. Thus, it is quite
appropriate to assume that each node voltage and each branch current in a circuit
are constantly ﬂuctuating around their desired values.
Signal-to-Noise Ratio
The presence of noise degrades the quality of a signal and poses the ultimate limit on
the size of signals that can be successfully detected, measured, and interpreted. The
quality of a signal in the presence of noise is speciﬁed by means of the signal-to-noise
ratio (SNR)
SNR = 10 log10
X2s
X2n
(7.1)
where Xs is the rms value of the signal, and Xn is that of its noise component. The
poorer the SNR, the more difﬁcult it is to rescue the useful signal from noise. Even
though a signal buried in noise can be rescued by suitable signal processing, such as
signal averaging, it always pays to keep the SNR as high as other design constraints
allow.
Thedegreetowhichcircuitdesignersshouldbeconcernedaboutnoiseultimately
depends on the performance requirements of the application. With the tremendous
improvements in op amp input offset-error characteristics, as well A-D and D-A
converter resolution, noise is an increasingly important factor in the error budget
analysis of high-performance systems. Taking a 12-bit system as an example, we
note that with a 10-V full scale, 1
2 LSB corresponds to 10/213 = 1.22 mV, which
by itself may pose problems in converter design. In the real world, the signal may
be produced by a transducer and require considerable ampliﬁcation to achieve a
10-V full scale. Taking 10 mV as a typical full-scale transducer output, 1
2 LSB now

335
SECTION 7.1
Noise Properties
corresponds to 1.22 μV. If the ampliﬁer generates only 1 μV of input-referred noise,
the LSB resolution would be invalidated!
To take full advantage of sophisticated devices and systems, the designer must be
able to understand noise mechanisms; perform noise calculations, simulations, and
measurements; and minimize noise as required. These are the topics to be addressed
in this chapter.
Chapter Highlights
The chapter begins with an introduction to noise concepts, calculations, measure-
ments,andspectra.Thisisfollowedbyadiscussionofnoisedynamics,withemphasis
onpracticaltoolssuchaspiecewisegraphicalintegration,thepink-noisetangentprin-
ciple, and PSpice simulation. Next, the chapter addresses the most common sources
of noise, followed by noise models for diodes, BJTs, JFETs, and MOSFETs. The
above material is then applied to the investigation of the noise performance of op
amp circuits involving both voltage-feedback ampliﬁers and current-feedback am-
pliﬁers. As an example of an op amp circuit in which noise is crucial, the photodiode
ampliﬁer is examined in detail, with graphical noise calculations and noise ﬁltering.
The chapter concludes with low-noise op amps.
Noise is a vast subject in itself, with entire books1,2 devoted to just this one
topic. Here we are of necessity restricting our scope by focusing on concepts and
procedures that are of concern primarily to the op amp user.
7.1
NOISE PROPERTIES
Since noise is a random process, the instantaneous value of a noise variable is
unpredictable. However, we can deal with noise on a statistical basis. This requires
introducing special terminology as well as special calculation and measurement.
Rms Value and Crest Factor
Using subscript n to denote noise quantities, we deﬁne the root-mean-square (rms)
value Xn of a noise voltage or current xn(t) as
Xn =

1
T
 T
0
x2
n(t) dt
1/2
(7.2)
where T is a suitable averaging time interval. The square of the rms value, or X2n, is
called the mean square value. Physically, X2n represents the average power dissipated
by xn(t) in a 1- resistor.
In voltage-comparator applications, such as A-D converters and precision mul-
tivibrators, accuracy and resolution are affected by the instantaneous rather than the
rms value of noise. In these situations, expected peak values of noise are of more
concern. Most noise has a Gaussian, or normal, distribution as shown in Fig. 7.1, so it
is possible to predict instantaneous values in terms of probabilities. The crest factor

336
CHAPTER 7
Noise
FIGURE 7.1
Voltage noise (right), and Gaussian distribution of amplitude.
(CF) is deﬁned as the ratio of the peak value to the rms value of noise. Though all
CF values are possible in principle, the likelihood of xn(t) exceeding a given value X
decreases very rapidly with X, as indicated by the residual area under the distribution
curve. Suitable calculations6 reveal that for Gaussian noise the probability of CF
exceeding 1 is 32%, that of exceeding 2 is 4.6%, that of exceeding 3 is 0.27%, that
of exceeding 3.3 is 0.1%, and that of exceeding 4 is 0.0063%. It is common practice
to take the peak-to-peak value of Gaussian noise to be 6.6 times the rms value, since
the instantaneous value is within this range 99.9% of the time, which is close to
100%.
Noise Observation and Measurement
Voltage noise can readily be observed with an oscilloscope of adequate sensitivity.
An advantage of this instrument is that it allows us to actually see the signal and thus
make sure it is internal noise and not externally induced noise, such as 60-Hz pickup.
One way of estimating the rms value is by observing the maximum peak-to-peak
ﬂuctuation, and then dividing by 6.6. A less subjective alternative7 is to observe
noise with two equally calibrated channels, and adjust the offset of one channel until
the two noisy traces just merge; if we then remove both noise sources and measure
the difference between the two clean traces, the result is approximately twice the
rms value.
Noise can be measured with a multimeter. Ac meters fall into two categories:
true rms meters and averaging-type meters. The former yield the correct rms value
regardless of the waveform, provided that the CF speciﬁcations of the instrument are
not exceeded. The latter are calibrated to give the rms value of a sine wave. They ﬁrst
rectify the signal and compute its average, which for ac signals is 2/π times the peak
value; then they synthesize the rms value, which for ac signals is 1/
√
2 times the
peak value, by amplifying the average value by (1/
√
2)/(2/π) = 1.11. For Gaussian
noise the rms value is √π/2 = 1.25 times the average value,2 so the noise reading
provided by an averaging-type meter must be multiplied by 1.25/1.11 = 1.13, or,
equivalently, it must be increased by 20 log10 1.13 ∼= 1 dB to obtain the correct
value.

337
SECTION 7.1
Noise Properties
Noise Summation
In noise analysis one often needs to ﬁnd the rms value of noise voltages in series
or noise currents in parallel. Given two noise sources xn1(t) and xn2(t), the mean
square value of their sum is
X2
n = 1
T
 T
0
[xn1(t) + xn2(t)]2 dt = X2
n1 + X2
n2 + 2
T
 T
0
xn1(t)xn2(t) dt
If the two signals are uncorrelated, as is usually the case, the average of their product
vanishes, so the rms values add up in Pythagorean fashion,
Xn =

X2
n1 + X2
n2
(7.3)
This indicates that if the sources are of uneven strengths, minimization efforts should
be directed primarily at the strongest one. For instance, two noise sources with rms
values of 10 μV and 5 μV combine to give an overall rms value of

102 + 52 =
11.2 μV, which is only 12% higher than that of the dominant source. It is readily
seen that reducing the dominant source by 13.4% has the same effect as eliminating
the weaker source altogether!
As mentioned, the dc error referred to the input is also a form of noise, so
when performing budget-error analysis we must add dc noise and rms ac noise
quadratically.
Noise Spectra
Since X2n represents the average power dissipated by xn(t) in a 1- resistor, the phys-
ical meaning of mean square value is the same as for ordinary ac signals. However,
unlike an ac signal, whose power is concentrated at just one frequency, noise power
is usually spread all over the frequency spectrum because of the random nature of
noise. Thus, when referring to rms noise, we must always specify the frequency band
over which we are making our observations, measurements, or calculations.
In general, noise power depends on both the width of the frequency band and the
band’s location within the frequency spectrum. The rate of change of noise power
with frequency is called the noise power density, and is denoted as e2n( f ) in the case
of voltage noise, and i2n( f ) in the case of current noise. We have
e2
n( f ) = dE2n
d f
i2
n( f ) = dI 2n
d f
(7.4)
where E2n and I 2n are the mean square values of voltage noise and current noise.
Note that the units of e2n( f ) and i2n( f ) are volts squared per hertz (V2/Hz) and
amperes squared per hertz (A2/Hz). Physically, noise power density represents the
average noise power over a 1-Hz bandwidth as a function of frequency. When plotted
versus frequency, it provides a visual indication of how power is distributed over the
frequency spectrum. In integrated circuits, the two most common forms of power
density distribution are white noise and 1/f noise.
The quantities en( f ) and in( f ) are called the spectral noise densities, and
are expressed in volts per square root of hertz (V/
√
Hz) and amperes per square

338
CHAPTER 7
Noise
root of hertz (A/
√
Hz). Some manufacturers specify noise in terms of noise power
densities, others in terms of spectral noise densities. Conversion between the two is
accomplished by squaring or by extracting the square root.
Multiplying both sides in Eq. (7.4) by d f and integrating from fL to fH, the
lower and upper limits of the frequency band of interest, allows us to ﬁnd the rms
values in terms of the power densities,
En =
 fH
fL
e2
n( f ) d f
1/2
In =
 fH
fL
i2
n( f ) d f
1/2
(7.5)
Once again it is stressed that the concept of rms cannot be separated from that of
frequency band: in order to ﬁnd the rms value, we need to know the lower and upper
limits of the band as well as the density within the band.
White Noise and 1/f Noise
White noise is characterized by a uniform spectral density, or en = enw andin = inw,
where enw and inw are suitable constants. It is so called by analogy with white light,
which consists of all visible frequencies in equal amounts. When played through a
loudspeaker, it produces a waterfall sound. Applying Eq. (7.5) we get
En = enw

fH −fL
In = inw

fH −fL
(7.6)
indicating that the rms value of white noise increases with the square root of
the frequency band. For fH ≥10 fL we can approximate as En ∼= enw
√fH and
In ∼= inw
√fH at the risk of an error of about 5% or less.
Squaring both sides in Eq. (7.6) yields E2n = e2nw( fH −fL) and I 2n = i2nw
( fH −fL), indicating that white-noise power is proportional to the bandwidth,
regardless of the band’s location within the frequency spectrum. Thus, the noise
power within the 10-Hz band between 20 Hz and 30 Hz is the same as that within
the band between 990 Hz and 1 kHz.
The other common form of noise is 1/f noise, so called because its power den-
sity varies with frequency as e2n( f ) = K 2v/f and i2n( f ) = K 2
i /f , where Kv and Ki
are suitable constants. The spectral densities are en = Kv/√f and in = Ki/√f ,
indicating that when plotted versus frequency on logarithmic scales, power densi-
ties have a slope of −1 dec/dec, and spectral densities a slope of −0.5 dec/dec.
Substituting into Eq. (7.5) and integrating yields
En = Kv

ln( fH/fL)
In = Ki

ln( fH/fL)
(7.7)
Squaring both sides in Eq. (7.7) yields E2n = K 2v ln( fH/fL) and I 2n =
K 2
i ln( fH/fL), indicating that 1/f -noise power is proportional to the log ratio of
the frequency band extremes, regardless of the band’s location within the frequency
spectrum. Consequently, 1/f noise is said to have the same power content in each
frequency decade (or octave). Once the noise rms of a particular decade (or octave)
is known, the noise rms over m decades (or octaves) is obtained by multiplying the
former by √m. For example, if the rms value within the decade 1 Hz ≤f ≤10 Hz
is 1 μV, then the noise rms in the 9-decade span below 1 Hz, that is, down to about
1 cycle per 32 years, is
√
9 × 1 μV = 3 μV.

339
SECTION 7.1
Noise Properties
nV/√Hz
en (log)
f  (log)
enw
fce
–0.5 dec/dec
pA/√Hz
in (log)
f  (log)
inw
fci
–0.5 dec/dec
(a)
(b)
FIGURE 7.2
Typical IC noise densities.
Integrated-Circuit Noise
Integrated-circuit noise is a mixture of white and 1/f noise, as shown in Fig. 7.2. At
high frequencies, noise is predominantly white, while at low frequencies 1/f noise
dominates. The borderline frequency, or corner frequency, is found graphically as
the intercept of the 1/f asymptote and the white-noise ﬂoor. Power densities are
expressed analytically as
e2
n = e2
nw
 fce
f
+ 1

i2
n = i2
nw
 fci
f
+ 1

(7.8)
where enw and inw are the white-noise ﬂoors, and fce and fci the corner frequen-
cies. The μA741 data sheets of Fig. 5A.8 indicate enw ∼= 20 nV/
√
Hz, fce ∼= 200 Hz,
inw ∼= 0.5 pA/
√
Hz, and fci ∼= 2 kHz. Inserting Eq. (7.8) into Eq. (7.5) and
integrating, we get
En = enw

fce ln( fH/fL) + fH −fL
(7.9a)
In = inw

fci ln( fH/fL) + fH −fL
(7.9b)
EXAMPLE 7.1.
Estimate the rms input voltage noise of the 741 op amp over the
following frequency bands: (a) 0.1 Hz to 100 Hz (instrumentation range), (b) 20 Hz to
20 kHz (audio range), and (c) 0.1 Hz to 1 MHz (wideband range).
Solution.
(a) Equation
(7.9a)
gives
En = 20 × 10−9
200 ln(102/0.1) + 102 −0.1 = 20 ×
10−9√1382 + 98.9 = 0.770 μV
(b) En = 20 × 10−9√1382 + 19,980 = 2.92 μV
(c) En = 20 × 10−9√
3224 + 106 = 20.0 μV
We observe that 1/f noise dominates at low frequencies, white noise dominates
at high frequencies—and the wider the frequency band, the higher the noise. Con-
sequently, to minimize noise one should limit the bandwidth to the strict minimum
required.

340
CHAPTER 7
Noise
7.2
NOISE DYNAMICS
A common task in noise analysis is ﬁnding the total rms noise at the output of
a circuit, given the noise density at its input as well as its frequency response. A
typical example is offered by the voltage ampliﬁer. The noise density at the output is
eno( f ) = |An( j f )|eni( f ), where eni( f ) is the noise density at the input and An( j f )
is the noise gain. The total output rms noise above fL is then E2no =
	 ∞
fL e2no( f ) d f ,
or
E2
no =
 ∞
fL
|An( j f )|e2
ni( f ) d f
1/2
(7.10a)
Another common example is offered by the transimpedance ampliﬁer. Denoting its
input noise density as in( f ) and its transimpedance noise gain as Zn(i f ), we have
in this case
E2
no =
 ∞
fL
|Zn( j f )|i2
ni( f ) d f
1/2
(7.10b)
(You can readily extend the above concepts to the other ampliﬁer types, namely,
current ampliﬁers and transadmittance ampliﬁers.) In the case of white noise, it is
often convenient to let fL →0 to simplify the math.
Noise Equivalent Bandwidth (NEB)
AsanapplicationexampleofEq.(7.10),considerthecaseofwhitenoisewithspectral
density enw going through a simple RC ﬁlter as in Fig. 7.3a. Since |An|2 = 1/[1 +
( f/f0)2], where f0 is the −3-dB frequency, Eq. (7.10a) gives (see Problem 7.3)
Eno = enw
 ∞
fL
d f
1 + ( f/f0)2
1/2
= enw
√
NEB
where
NEB = f0
π
2 −f0 tan−1 fL
f0
(7.11a)
R
Gain
0
Brick-wall
equivalent
C
eni
eno
+
–
f
1.57f0
f0
fL
1
1
2
(a)
(b)
FIGURE 7.3
Noise equivalent bandwidth (NEB).

341
SECTION 7.2
Noise Dynamics
is called the white-noise equivalent bandwidth. We visualize it as the bandwidth
of a brick-wall band-pass ﬁlter having a lower cutoff frequency of flower =
f0 tan−1( fL/f0), and an upper cutoff frequency of fhigher = f0π/2 = 1.57 f0. Most
cases of practical interest are such that fL ≪f0, so using the fact that tan−1 x ∼= x
for x ≪1, we approximate flower ∼= f0 fL/f0 = fL. Rewriting as
NEB ∼= 1.57 f0 −fL
(7.11b)
and using Fig. 7.3b as reference, we observe that the fraction of 0.57 accounts for
the transmitted noise above f0 as a consequence of the gradual rolloff, or skirt. This
property holds for all ﬁrst-order low-pass functions, not just for RC networks. As
we know, the closed-loop response of many ampliﬁers is a ﬁrst-order function with
fB = βft as the −3-dB frequency. These ampliﬁers pass white noise with a cutoff
frequency of 1.57 fB.
More generally, the NEB of a circuit with noise gain An( j f ) is deﬁned, for
fL = 0, as2
NEB =
1
A2
n(max)
 ∞
0


An( j f )


2 d f
(7.12)
where An(max) is the peak magnitude of the noise gain. The NEB represents the
frequency span of a brick-wall power gain response having the same area as the
power gain response of the original circuit.
The NEB can be computed analytically for higher-order responses. For instance,
for an nth-order maximally ﬂat low-pass response we have, for fL = 0,
NEBMF =
 ∞
0
d f
1 + ( f/f0)2n
(7.13a)
The results are2 NEBMF = 1.57 f0 for n = 1, 1.11 f0 for n = 2, 1.05 f0 for n = 3,
and 1.025 f0 for n = 4, indicating that NEBMF rapidly approaches f0 as n is
increased.
Likewise, it can be proven5 that the noise equivalent bandwidths of the standard
second-order low-pass and band-pass functions HLP and HBP deﬁned in Section 3.4
are, respectively,
NEBLP = Q2NEBBP = Qπ f0/2
(7.13b)
When the NEB cannot be calculated analytically, it can be estimated by piece-
wise graphical integration, or it can be found by computer via numerical integration.
EXAMPLE 7.2. UsingPSpice,ﬁndtheNEBofthe741circuitofFig.7.4a for fL = 1Hz.
Solution.
The gain plot of Fig. 7.4b (top) indicates that |A| peaks at 51 V/V. Then,
to ﬁnd the NEB, we use PSpice’s “s” function to calculate the squared area under the
|A| curve, and we divide the result by 512 = 2601, in accordance with the deﬁnition of
Eq. (7.12). The result is shown in Fig. 7.4b (bottom). Using PSpice’s cursor facility, we
measure fH = 1052 Hz, so NEB = 1052 −1 = 1051 Hz.

342
CHAPTER 7
Noise
(b)
(a)
1
102
102
10
103
 10−3
 10−2
 10−1
1
10
104 105 106 107 108
1
102
10
103 104 105 106 107 108
Gain (V/V)
Frequency f (Hz)
0
500
103
Area (Hz)
fH
+
Vo
2
3
4
6
O
7
0
0
µA741
1.0 µF
10 nF
1.0 kΩ
–
VCC (10 V)
VEE (−10 V)
C1
R1
C2
R2
Vi +
–
100 kΩ
|An|
51 V/V
FIGURE 7.4
(a) PSpice circuit of Example 7.2 and (b) its voltage gain |A| (top). To ﬁnd the NEB, we
direct PSpice to plot the function (S(Vm(O)*Vm(O))/2601 (bottom).
Upper-Brick-Wall Frequency for 1/f Noise
By analogy with white noise, we seek an expression for fH when we pass 1/f noise
through a ﬁrst-order low-pass ﬁlter having f0 as its −3-dB frequency. Expressing
power density as e2
ni( f ) = K 2v/f , we adapt Eq. (7.10a) to ﬁnd (see Problem 7.3)
the total output rms noise above fL as
Eno = Kv
 ∞
fL
d f
f
1 + ( f/f0)2
1/2
= Kv

ln fH
fL
where
fH = f0

1 + ( fL/f0)2
(7.14a)
is the upper-cutoff frequency of a brick-wall band-pass ﬁlter having a lower-cutoff
frequency of fL. Most cases of practical interest are such that fL << f0, so hence-
forth we shall simply let
fH ∼= f0
(7.14b)
Piecewise Graphical Integration
Noise densities and noise gains are often available only in graphical form. When this
is the case, Eno is estimated by graphical integration, as illustrated in the following
example.

343
SECTION 7.2
Noise Dynamics
EXAMPLE 7.3. Estimate the total rmsoutput noise above 1 Hz for noise with the spectral
density of Fig. 7.5 (top) going through an ampliﬁer with the noise-gain characteristic of
Fig. 7.5 (center).
Solution.
To ﬁnd the output density eno, we multiply out the two curves point by
point and obtain the curve of Fig. 7.5 (bottom). Clearly, the use of linearized Bode plots
simpliﬁes graphical multiplications considerably. Next, we integrate e2
no from fL = 1 Hz
to fH = ∞. To facilitate our task, we break down the integration interval into three parts,
as follows.
For 1 Hz ≤f ≤1 kHz we can apply Eq. (7.9a) with enw = 20 nV/
√
Hz, fce =
100 Hz, fL = 1 Hz, and fH = 1 kHz. The result is Eno1 = 0.822 μV.
For 1 kHz ≤f ≤10 kHz the density eno increases with f at the rate of +1 dec/dec,
so we can write eno( f ) = (20 nV/
√
Hz) × ( f/103) = 2 × 10−11 f V/
√
Hz. Then,
Eno2 = 2 × 10−11
 104
103
f 2 d f
1/2
= 2 × 10−11

1
3 f 3


104
103
1/2
= 11.5 μV
20
2 1
102
103
104
105
106
107
10
f  (Hz)
(nV/ Hz )
10
1 1
102
103
104
105
106
107
10
f  (Hz)
200
eno  
(nV/ Hz )
eni 
20
2 1
102
103
104
105
106
107
10
f  (Hz)
200
|An| (V/V)
Pink-noise tangent
FIGURE 7.5
Noise spectra of Example 7.3.

344
CHAPTER 7
Noise
For 10 kHz ≤f ≤∞we have white noise with enw = 200 nV/
√
Hz going through
a low-pass ﬁlter with f0 = 100 kHz. By Eq. (7.13b), Eno3 = 200 × 10−9(1.57 × 105 −
104)1/2 = 76.7 μV.
Finally,
we
add
up
all
components
in
rms
fashion
to
obtain
Eno =

E2
no1 + E2
no2 + E2
no3 =
√
0.822 + 11.52 + 76.72 = 77.5 μV.
The Pink-Noise Tangent Principle
Looking at the result of the foregoing example, we note that the largest contribution
comes from Eno3, which represents noise above 10 kHz. We wonder if there is a
quick method of predicting this, without having to go through all calculations. Such
a method exists; it is offered by the pink-noise tangent principle.6
The pink-noise curve is the locus of points contributing equal-per-decade (or
equal-per-octave) noise power. Its noise density slope is −0.5 dec/dec. The pink-
noise principle states that if we lower the pink-noise curve until it becomes tangent
to the noise curve eno( f ), then the main contribution to Eno will come from the
portions of the noise curve in the immediate vicinity of the tangent. In the example
of Fig. 7.6 (bottom), the portions closest to the tangent are those leading to Eno3.
We could have set Eno ∼= Eno3 = 76.7 μV without bothering to calculate Eno1 and
Eno2. The error caused by this approximation is insigniﬁcant, especially in light of
the spread in noise data due to production variations. As we proceed, we shall make
frequent use of this principle.
7.3
SOURCES OF NOISE
For an effective selection and utilization of integrated circuits, the system designer
needs to be familiar with the basic noise-generating mechanisms in semiconductor
devices. A brief discussion of these mechanisms follows.
Thermal Noise
Thermal noise, also called Johnson noise, is present in all passive resistive elements,
including the stray series resistances of practical inductors and capacitors. Thermal
noise is due to the random thermal motion of electrons (or holes, in the case of
p-type semiconductor resistors). It is unaffected by dc current, so a resistor generates
thermal noise even when sitting in a drawer.
As shown in Fig. 7.6a, thermal noise is modeled by a noise voltage of spectral
density eR in series with an otherwise noiseless resistor. Its power density is
e2
R = 4kT R
(7.15a)
where k = 1.38×10−23 J/K is Boltzmann’s constant, and T is absolute temperature,
in kelvins. At 25 ◦C, 4kT = 1.65 × 10−20 W/Hz. An easy ﬁgure to remember is
that at 25 ◦C, eR ∼= 4
√
R nV/
√
Hz, R in kilo-ohms. For instance, e100  = 4
√
0.1 =
1.26 nV/
√
Hz, and e10 k = 12.6 nV/
√
Hz.

345
SECTION 7.3
Sources of Noise
eR
iR
R
(noiseless)
R
(noiseless)
(a)
(b)
FIGURE 7.6
Thermal noise models.
Converting from Th´evenin to Norton, we can model thermal noise also with a
noise currentiR in parallel with an otherwise noiseless resistor, as shown in Fig. 7.6b.
We have i2
R = e2
R/R2, or
i2
R = 4kT/R
(7.15b)
The preceding equations indicate that thermal noise is of the white type. Purely
reactive elements are free from thermal noise.
EXAMPLE 7.4.
Consider a 10-k resistor at room temperature. Find (a) its voltage
and (b) current spectral densities, and (c) its rms noise voltage over the audio range.
Solution.
(a) eR =
√
4kT R =
√
1.65 × 10−20 × 104 = 12.8 nV/
√
Hz
(b) iR = eR/R = 1.28 pA/
√
Hz
(c) ER = eR
√fH −fL = 12.8 × 10−9 ×
√
20 × 103 −20 = 1.81 μV
Shot Noise
This type of noise arises whenever charges cross a potential barrier, such as in diodes
or transistors. Barrier crossing is a purely random event and the dc current we observe
microscopically is actually the sum of many random elementary current pulses. Shot
noise has a uniform power density,
i2
n = 2qI
(7.16)
where q = 1.602 × 10−19 C is the electron charge, and I is the dc current through
the barrier. Shot noise is present in BJT base currents as well as in current-output
D-A converters.
EXAMPLE 7.5. Find the signal-to-noise ratio for diode current over a 1-MHz bandwidth
if (a) ID = 1 μA and (b) ID = 1 nA.
Solution.
(a) In = √2qID fH =
√
2 × 1.62 × 10−19 × 10−6 × 106 = 0.57 nA (rms). Thus, SNR =
20 log10[(1 μA)/(0.57 nA)] = 64.9 dB.
(b) By similar procedure, SNR = 34.9 dB. We observe that the SNR deteriorates as the
operating current is lowered.

346
CHAPTER 7
Noise
Flicker Noise
Flicker noise, also called 1/f noise, or contact noise, is present in all active as well as
in some passive devices and has various origins, depending on device type. In active
devices it is due to traps, which, when current ﬂows, capture and release charge
carriers randomly, thus causing random ﬂuctuations in the current itself. In BJTs
these traps are associated with contamination and crystal defects at the base-emitter
junction. In MOSFETs they are associated with extra electron energy states at the
boundary between silicon and silicon dioxide. Among active devices, MOSFETs
suffer the most, and this can be a source of concern in low-noise MOS applications.
Flicker noise is always associated with a dc current, and its power density is of
the type
i2
n = K I a
f
(7.17)
where K is a device constant, I is the dc current, and a is another device constant in
the range 1
2 to 2.
Flicker noise is also found in some passive devices, such as carbon composition
resistors, in which case it is called excess noise because it appears in addition to the
thermal noise already there. However, while thermal noise is also present without a
dc current, ﬂicker noise requires a dc current in order to exist. Resistors of the wire-
wound type are the quietest in terms of 1/f noise, while the carbon composition
types can be noisier by as much as an order of magnitude, depending on operating
conditions. Carbon-ﬁlm and metal-ﬁlm types fall in between. However, if the appli-
cation requires that a given resistor carry a fairly small current, thermal noise will
predominate and it will make little difference which resistor type one uses.
Avalanche Noise
This form of noise is found in pn junctions operated in the reverse breakdown mode.
Avalanche breakdown occurs when electrons, under the inﬂuence of the strong elec-
tric ﬁeld inside the space-charge layer, acquire enough kinetic energy to create addi-
tional electron-hole pairs by collision against the atoms of the crystal lattice. These
additional pairs can, in turn, create other pairs in avalanche fashion. The resulting
current consists of randomly distributed noise spikes ﬂowing through the reverse
biased junction. Like shot noise, avalanche noise requires current ﬂow. However,
avalanche noise is usually much more intense than shot noise, making Zener diodes
notoriously noisy. This is one of the reasons why voltage references of the bandgap
type are preferable to Zener-diode references.
Noise Models of Semiconductor Devices
Wenowwishtoexaminethenoisemechanismsinterveninginsemiconductordevices
so as to help the reader develop a basic feel for the noise characteristics of op amps.
As a rule, we model each device with a noiseless version, but equipped with suitable
noise sources en and in, in the manner already seen for the resistor in Fig. 7.6. The
results are summarized in Table 7.1.

347
SECTION 7.3
Sources of Noise
TABLE 7.1
Noise models and noise power densities for semiconductor devices (the
devices in the models are assumed noiseless and noise is accounted for by
suitable noise sources, as shown)
e2n = 4kTrS
A
D
C
en
in
i2n = 2qID + K I a
D
f
e2n = 4kT

rb +
1
2gm

B
E
C
en
in
i2n = 2q

IB + K1
I a
B
f +
IC


β0(i f )


2

e2n = 4kT

2
3gm
+ K2
I a
D/g2m
f

G
D
S
en
in
i2n = 2qIG +
2π f Cgs
gm
2 
4kT 2
3 gm + K3
I a
D
f

e2n = 4kT 2
3
1
gm
+ K4
1
W L f
G
S
en
in
D
i2n = 2qIG
A pn junction generates both shot and ﬂicker noise, so we model it with a
noiseless diode but having a parallel noise current in, as depicted in Table 7.1. Also
shown is a series noise voltage en modeling the thermal noise of the diode’s bulk
resistance rS. The power densities of these source are8
i2
n = 2qID + K I a
D
f
(7.18a)
e2
n = 4kTrS
(7.18b)

348
CHAPTER 7
Noise
The noise power densities of BJTs are8
e2
n = 4kT

rb +
1
2gm

(7.19a)
i2
n = 2q

IB + K1
I a
B
f +
IC
|β( j f )|2

(7.19b)
where rb is the intrinsic base resistance, IB and IC are the dc base and collector
currents, gm = qIC/(kT ) is the transconductance, K1 and a are appropriate device
constants,andβ( j f )istheforwardcurrentgain,whichdecreasesathighfrequencies.
In the expression for e2n, the ﬁrst term represents thermal noise from rb, and the
second term represents the effect of collector-current shot noise referred to the input.
In the expression for i2n, the ﬁrst two terms represent base-current shot and ﬂicker
noise, and the last term represents collector-current shot noise reﬂected to the input.
To achieve a high β, the base region of a BJT is doped lightly and fabricated
very thin. This, however, increases the intrinsic base resistance rb. Moreover, the
transconductance gm and the base current IB are directly proportional to IC. Thus,
what works to minimize voltage noise (low rb and high IC) is the opposite of what
is good for low current noise (high β and low IC). This represents a fundamental
tradeoff in bipolar-op-amp design.
The noise power densities of JFETs are8
e2
n = 4kT

2
3gm
+ K2
I a
D/g2m
f

(7.20a)
i2
n = 2qIG +
2π f Cgs
gm
2 
4kT 2
3gm + K3
I a
D
f

(7.20b)
where gm is the transconductance; ID is the dc drain current; IG is the gate leakage
current; K2, K3, and a are appropriate device constants; and Cgs is the gate-to-source
capacitance.
In the expression for e2n, the ﬁrst term represents thermal noise in the channel,
and the second represents drain-current ﬂicker noise. At room temperature and at
moderate frequencies, all terms in the expression for i2n are negligible, making JFETs
virtually free of input current noise. Recall, however, that gate leakage increases very
rapidly with temperature, so i2n may no longer be neglected at higher temperatures.
Compared to BJTs, FETs have notoriously low gm values, indicating that FET-
input op amps tend to exhibit higher voltage noise than BJT-input types for sim-
ilar operating conditions. Moreover, e2n in the JFET contains ﬂicker noise. These
disadvantages are offset by better current noise performance, at least near room
temperature.
The noise power densities of MOSFETs are8
e2
n = 4kT
2
3gm
+ K4
1
W L f
(7.21a)
i2
n = 2qIG
(7.21b)

349
SECTION 7.3
Sources of Noise
where gm is the transconductance, K4 is a device constant, and W and L are the
channel width and length. As in the JFET case, i2n is negligible at room temperature,
but increases with temperature.
In the expression for e2n, the ﬁrst term represents thermal noise from the channel
resistanceandthesecondrepresentsﬂickernoise.Itisthelatterthatisofmostconcern
in MOSFET-input op amps. Flicker noise is inversely proportional to the transistor
area W × L, so this type of noise is reduced by using input-stage transistors with
large geometries. As discussed in Chapter 5, when large geometries are combined
with common-centroid layout techniques, the input offset voltage and offset drift
characteristics are also improved signiﬁcantly.
Noise Modeling in PSpice
When performing noise analysis, SPICE calculates the thermal-noise density for
each resistor in the circuit, as well as the shot-noise and ﬂicker-noise densities
for each diode and transistor. When using op amp macromodels, the need arises
for noise sources with spectral densities of the type of Fig. 7.2. We shall synthesize
these sources2 by exploiting the fact that SPICE calculates the noise current of a
diode according to
i2
d = KF I AF
D
f
+ 2qID = 2qID

KF × I AF−1
D
/2q
f
+ 1

where ID is the diode bias current, q the electron charge, and KF and AF are
parameters that can be speciﬁed by the user. This is a power density with white-noise
ﬂoor i2w = 2qID and corner frequency fc = KF × I AF−1
D
/2q. If we let AF = 1 for
mathematical convenience, then the required ID and KF for given i2w and fc are
ID = i2
w/2q
KF = 2q fc
Once we have a source of current noise, we can readily convert it to a source of
voltage noise via a CCVS.
EXAMPLE 7.6.
Verify Example 7.1 using PSpice.
Solution.
We need to create a source en with enw = 20 nV/
√
Hz and fce = 200 Hz.
First we create a noise current source with iw = 1 pA/
√
Hz and fc = 200 Hz, then we
use an H-type source of value 20 nV/pA to convert to en. As shown in Fig. 7.7a, we bias
the diode with ID = (1 × 10−12)2/(2 × 1.602 × 10−19) = 3.12 μA, and we impose
KF = 2 × 1.602 × 10−19 × 200 = 6.41 × 10−17 A. The 1-GF capacitor couples the ac
noise current generated by the diode to the CCVS denoted as H. The PSpice model for
the diode is
.model Dnoise D(KF=6.41E-17,AF=1)
The results of the simulation are shown in Fig. 7.7b. Using PSpice’s cursor facility
to measure speciﬁc values, we ﬁnd that for 0.1 Hz ≤f ≤100 Hz, En ∼= 0.77 μV; for
20 Hz ≤f ≤20 kHz, En ∼= 3 μV; and for 0.1 Hz ≤f ≤1 MHz, En = 20 μV. This
corroborates the results of the hand calculations of Example 7.1.

350
CHAPTER 7
Noise
(b)
(a)
Frequency f (Hz)
0
10
20
Total rms noise (μV)
102
10–1
103
102
10
1
103
10
104
105
106
102
10–1
10
1
103
104
105
106
en
En
Voltage noise (nV/√Hz)
O
20 nV/pA
H
+
–
ID
3.12 μA
0
C
1 GF
Dnoise
D
FIGURE 7.7
(a) Using a diode to synthesize a PSpice source of voltage noise. (b) Its spectral density en
(top) is plotted as V(ONOISE), and the total rms noise En (bottom) as SQRT(S(V(ONOISE)*
V(ONOISE))).
7.4
OP AMP NOISE
Op amp noise is characterized by three equivalent noise sources: a voltage source
with spectral density en, and two current sources with densities inp and inn. As shown
in Fig. 7.8, a practical op amp can be regarded as a noiseless op amp equipped with
these sources at the input. This model is similar to that used to account for the input
offset voltage VOS and the input bias currents IP and IN. This is not surprising
Vn
en
Vp
Vo
+
–
inn
inp
Noiseless
FIGURE 7.8
Op amp noise model.

351
SECTION 7.4
Op Amp Noise
since these parameters are themselves special forms of noise, namely, dc noise.
Note, however, that the magnitudes and directions of en(t), inp(t), and inn(t) are
constantly changing due to the random nature of noise and that noise terms must be
added up in rms rather than algebraic fashion.
Noise densities are given in the data sheets and have the typical forms of Fig. 7.2.
For devices with symmetric input circuitry, such as voltage-mode op amps (VFAs),
inp and inn are given as a single density in, even though inp and inn are uncor-
related. To avoid losing track of their identities, we shall use separate symbols
until the end of our calculations, when we shall substitute in for both inp and inn.
For current-feedback ampliﬁers (CFAs), the inputs are asymmetric due to the pres-
ence of the input buffer. Consequently, inp and inn are different and are graphed
separately.
Just as in precision dc applications it is important to know the dc output error
EO caused by VOS, IP, and IN, in low-noise applications it is of interest to know
the total rms output noise Eno. Once Eno is known, we can refer it back to the input
and compare it against the useful signal to determine the signal-to-noise ratio SNR
and, hence, the ultimate resolution of the circuit. We shall illustrate for the familiar
resistive-feedback circuit of Fig. 7.9a, which forms the basis of the inverting and
noninverting ampliﬁers, the difference and summing ampliﬁers, and a variety of
others. It is important to keep in mind that the resistances shown in the diagram must
include also the external source resistances, if any. For instance, if we lift node A
off ground and drive it with a source vS having internal resistance Rs, then we must
replace R1 with the sum Rs + R1 in our calculations.
To analyze the circuit, we redraw it as in Fig. 7.9b with all pertinent noise sources
in place, including the thermal noise sources of the resistors. As we know, resistor
noise can be modeled with either a series voltage source or a parallel current source.
The reason for choosing the latter will become apparent shortly.
en
+
–
inn
inp
iR1
iR2
iR3
Noiseless
R2
R3
R1
R3
R2
R1
Eno
Eno
A
B
+
–
(a)
(b)
FIGURE 7.9
Resistive-feedback op amp circuit and its noise model.

352
CHAPTER 7
Noise
Overall Input Spectral Density
The ﬁrst task is to ﬁnd the overall spectral density eni referred to the input of the
op amp. We can apply the superposition principle as when we calculate the overall
input error EI due to VOS, IP, and IN, except that now the individual terms must
be added up in rms fashion. Thus, the noise voltage en contributes the term e2n. The
noise currents inp and iR3 are ﬂowing through R3, so their combined contribution
is, by Eq. (7.15), (R3inp)2 + (R3iR3)2 = R2
3i2np + 4kTR3. Following the line of
reasoning that led to Eq. (5.10), we can say that the noise currents inn, iR1, and iR2
conspire with the combination R1//R2 to contribute (R1∥R2)2(i2nn + i2
R1 + i2
R2) =
(R1∥R2)2i2nn + 4kT (R1∥R2). Combining all terms gives the overall input spectral
density
e2
ni = e2
n + R2
3i2
np + (R1∥R2)2i2
nn + 4kT [R3 + (R1∥R2)]
(7.22)
For op amps with symmetric inputs and uncorrelated noise currents, we have inp =
inn = in, where in is the noise current density given in the data sheets.
To gain better insight into the relative weights of the various terms, consider the
special but familiar case in which R3 = R1//R2. Under this constraint, Eq. (7.22)
simpliﬁes as
e2
ni = e2
n + 2R2i2
n + 8kTR
(7.23a)
R = R1//R2 = R3
(7.23b)
Figure 7.10 shows eni as well as its three individual components as a function of R.
While the voltage term en is independent of R, the current term
√
2Rin increases
with R at the rate of 1 dec/dec, and the thermal term
√
8kTR increases at the rate of
0.5 dec/dec.
We observe that for R sufﬁciently small, voltage noise dominates. In the limit
R →0 we get eni →en, so en is aptly called the short-circuit noise: this is the
noise produced by the internal components of the op amp, regardless of the external
circuitry. For R sufﬁciently large, current noise dominates. In the limit R →∞we
get eni →
√
2Rin, so in is aptly called the open-circuit noise. This form of noise stems
from input-bias-current ﬂow through the external resistors. For intermediate values
of R, thermal noise may also come into play, depending on the relative magnitudes
√8kTR
√2Rin
nV/√Hz
en
en
eni
R (log)
eni (log)
C
B
A
Ω
FIGURE 7.10
Op amp input spectral noise eni as a function of R of
Eq. (7.23b).

353
SECTION 7.4
Op Amp Noise
of the other two terms. In the example pictured, point A is where thermal noise
overtakes voltage noise, point B where current noise overtakes voltage noise, and
point C where current noise overtakes thermal noise. The relative positions of A,
B, and C vary from one op amp to another, and can be used to compare different
devices.
We note that while it is desirable to install a dummy resistance R3 = R1 ∥R2 in
order to provide bias-current compensation, in terms of noise it is preferable to have
R3 = 0 since this resistor only contributes additional noise. When the presence of
R3 is mandatory, the corresponding thermal noise can be ﬁltered out by connecting
a suitably large capacitance in parallel with R3. This will also suppress any external
noise that might be accidentally injected into the noninverting input pin.
Rms Output Noise
Like offsets and drift, eni is ampliﬁed by the noise gain of the circuit. This gain is
not necessarily the same as the signal gain, so we shall denote signal gain as As( j f )
and noise gain as An( j f ) to avoid confusion. Recall that the dc value of An( j f ) is
An0 = 1/β = 1 + R2/R1. Moreover, for a constant-GBP op amp, the closed-loop
bandwidth of An( j f ) is fB = β ft = ft/(1 + R2/R1), where ft is the unity-gain
frequency of the op amp. The output spectral density can thus be expressed as
eno =
1 + R2/R1

1 + ( f/fB)2 eni
(7.24)
Noise is observed or measured over a ﬁnite time interval Tobs. The total rms output
noise is found by integrating e2no from fL = 1/Tobs to fH = ∞. Using Eqs. (7.9),
(7.11b), (7.14b), and (7.22) we get
Eno =

1 + R2
R1

×

e2
nw

fce ln fB
fL
+ 1.57 fB −fL

+ R2
3i2
npw

fcip ln fB
fL
+ 1.57 fB −fL

+ (R1 ∥R2)2i2
nnw

fcin ln fB
fL
+ 1.57 fB −fL

+ 4kT (R3 + R1 ∥R2)(1.57 fB −fL)
1/2
(7.25)
This expression indicates the considerations in low-noise design: (a) select op amps
with low-noise ﬂoors enw and inw as well as low corner frequencies fce and fci;
(b) keep the external resistances sufﬁciently small to make current noise and thermal
noise negligible compared to voltage noise (if possible, make R3 = 0); (c) limit the
noise-gain bandwidth to the strict minimum required.
The industry standard OP77 op amp has been speciﬁcally designed for low-noise
applications. Its characteristics are ft = 8 MHz, enw = 3 nV/
√
Hz, fce = 2.7 Hz,
inw = 0.4 pA/
√
Hz, and fci = 140 Hz.

354
CHAPTER 7
Noise
EXAMPLE 7.7. A 741 op amp is conﬁgured as an inverting ampliﬁer with R1 = 100 k,
R2 = 200 k, and R3 = 68 k. (a) Assuming enw = 20 nV/
√
Hz, fce = 200 Hz,
inw = 0.5 pA/
√
Hz, and fci = 2 kHz, ﬁnd the total output noise above 0.1 Hz, both rms
and peak-to-peak. (b) Verify with PSpice.
Solution.
(a) Wehave R1 ∥R2 = 100 ∥200 ∼= 67k, An0 = 1+R2/R1 = 3V/V,and fB = 106/3 =
333 kHz. The noise voltage component is Enoe = 3 × 20 × 10−9[200 ln(333 ×
103/0.1) + 1.57 × 333 × 103 −0.1]1/2 = 43.5 μV. The current noise component
is Enoi = 3[(68 × 103)2 + (67 × 103)2]1/2 × 0.5 × 10−12 × [2 × 103 ln(333 ×
104) + 523 × 103]1/2 = 106.5 μV. The thermal noise component is EnoR =
3[1.65 × 10−20(68 + 67) × 103 × 523 × 103]1/2 = 102.4 μV. Finally,
Eno =

E2noe + E2
noi + E2
noR =

43.52 + 106.52 + 102.42 = 154 μV (rms)
or 6.6 × 154 = 1.02 mV (peak-to-peak).
(b) The 741 macromodel available with the student version of PSpice does not model
noise properly. Consequently, we use a Laplace block to simulate a noiseless op
amp having the same open-loop response as the 741, along with three noise sources
of the type of Fig 7.7a to simulate en, inn, and inp (the sources must be separate
in order to ensure statistical independence). The circuit, shown in Fig. 7.11, uses
diodes with the same PSpice model of Fig. 7.7a,
.model Dnoise D(KF=6.41E-17,AF=1)
The plot of Fig. 7.12b conﬁrms the hand calculation of Eno = 154 μV. In
hindsight, we could have estimated Eno using just the pink-noise tangent principle!
Indeed, Fig. 7.12a indicates that most of the noise comes from the noise ﬂoor of
210 nV/√Hz preceding the pole frequency of 333 kHz, so Eno ∼= (210 nV)×(1.57×
333 kHz)1/2 = 152 μV (rms), quite close to the actual vale of 154 μV (rms)!
Vo
R2
R1
He
Ce
De
1 GF
Dnoise
IDe
3.12 μA
0
20 nV/pA
+
–
Fp
Cp
Dp
1 GF
Dnoise
IDp
3.12 μA
0
0.5 A/A
Fn
Cn
Dn
1 GF
Dnoise
IDn
3.12 μA
0
0.5 A/A
IN+
IN−
OUT+
OUT−
EOA
LAPLACE {v(P,N)} = {200k/(1+s/31.42)}
P
N
O
200 kΩ
100 kΩ
0
0
R3
68 kΩ
0
FIGURE 7.11
PSpice circuit to measure the noise of a 741-like op amp circuit.

355
SECTION 7.4
Op Amp Noise
1
108
106
103
Frequency f (Hz)
1
10
102
103
104
105
eno
Voltage noise (nV/√Hz)
1
108
106
103
Frequency f (Hz)
(b)
(a)
0
50
100
150
Eno
Total rms noise (μV)
FIGURE 7.12
(a) Plotting the output spectral density eno of the circuit of Fig. 7.11 as V(ONOISE), and
(b) plotting the total rms output noise Eno as SQRT(S(V(ONOISE)*V(ONOISE))).
In terms of noise, the circuit of Example 7.7 is poorly designed because Enoi
and EnoR far exceed Enoe. This can be improved by scaling down all resistances.
A good rule of thumb is to impose E2
noi + E2
noR ≤E2noe/32, since this raises Eno
only by about 5%, or less, above Enoe.
EXAMPLE 7.8. Scale the resistances of the circuit of Example 7.7 so that Eno = 50 μV.
Solution.
We want E2
noi + E2
noR = E2
no −E2
noe = 502 −43.52 = (24.6 μV)2. Letting
R = R3 + R1 ∥R2, we have E2
noi = 32 × R2(0.5 × 10−12)2 × [2 × 103 ln(333 × 104) +
523 × 103] = 1.24 × 10−18R2, andx E2
noR = 32 × 1.65 × 10−20 × R × 523 × 103 =
7.77 × 10−14R. We want 1.24 × 10−18R2 + 7.77 × 10−14R = (24.6 μV)2, which
gives R = 7 k. Thus, R3 = R/2 = 3.5 k, and 1/R1 + 1/R2 = 1/(3.5 k). Since
R2 = 2R1, this yields R1 = 5.25 k and R2 = 10.5 k.
Signal-to-Noise Ratio
Dividing Eno by the dc signal gain |As0| yields the total rms input noise,
Eni = Eno
|As0|
(7.26)
We again stress that the signal gain As may be different from the noise gain An,
the inverting ampliﬁer being a familiar example. Knowing Eni allows us to ﬁnd the
input signal-to-noise ratio,
SNR = 20 log10
Vi(rms)
Eni
(7.27)
where Vi(rms) is the rms value of the input voltage. The SNR establishes the ultimate
resolution of the circuit. For an ampliﬁer of the transimpedance type, the total rms
input noise is Ini = Eno/|Rs0|, where |Rs0| is the dc transimpedance signal gain.
Then, SNR = 20 log10(Ii(rms)/Ini).

356
CHAPTER 7
Noise
EXAMPLE 7.9.
Find the SNR of the circuit of Example 7.7 if the input is an ac signal
with a peak amplitude of 0.5 V.
Solution.
Since As0 = −2 V/V, we have Eni = 154/2 = 77 μV. Moreover, Vi(rms) =
0.5/
√
2 = 0.354 V. So, SNR = 20 log10[0.354/(77 × 10−6)] = 73.2 dB.
Noise in CFAs
The above equations apply also to CFAs.9 As mentioned, the presence of the input
buffer makes the inputs asymmetric, so inp and inn are different. Moreover, since
CFAs are wideband ampliﬁers, they generally tend to be noisier than conventional
op amps.10
EXAMPLE 7.10.
The data sheets of the CLC401 CFA (Comlinear) give z0 ∼= 710 k,
fb ∼= 350 kHz, rn ∼= 50 , enw ∼= 2.4 nV/
√
Hz, fce ∼= 50 kHz, inpw ∼= 3.8 pA/
√
Hz, fcip ∼=
100 kHz, innw ∼= 20 pA/
√
Hz, and fcin ∼= 100 kHz. Find the total rms output noise above
0.1 Hz if the CFA is conﬁgured as a noninverting ampliﬁer with R1 = 166.7  and
R2 = 1.5 k, and is driven by a source with an internal resistance of 100 .
Solution.
Since ft = z0 fb/R2 = 166 MHz, we have fB = ft/[1 + rn/(R1 ∥R2)] =
124 MHz. Applying Eq. (7.25) gives Eno = 10[(33.5 μV)2 +(3.6 μV)2 +(35.6 μV)2 +
(28.4 μV)2]1/2 ∼= 566 μV (rms), or 6.6 × 566 ∼= 3.7 mV (peak-to-peak).
Noise Filtering
Since broadband noise increases with the square root of the noise-gain bandwidth,
noise can be reduced through narrowbanding. The most common technique is to
pass the signal through a simple R-C network with R small enough to avoid adding
appreciably to the existing noise. This ﬁlter is susceptible to output loading, so we
may want to buffer it with a voltage follower. However, this would add the noise of
the follower, whose equivalent bandwidth NEB = (π/2) ft is quite wide.
The topology11 of Fig. 7.13 places the op amp upstream of the R-C network so
that the noise of the op amp itself is ﬁltered. Moreover, R is placed within the feed-
back loop to reduce its effective value by 1 + T and thus reduce output loading
R
C
+
Vi
Vo
Ii
nC
mR
+
–
FIGURE 7.13
Low-pass noise ﬁlter. Input may be either a current
or a voltage.

357
SECTION 7.5
Noise in
Photodiode
Ampliﬁers
signiﬁcantly. Even though T decreases with frequency, the presence of C helps
maintain a low output impedance well into the upper frequency range. The purpose of
mR and nC is to provide frequency compensation, an issue addressed in Section 8.4.
Sufﬁce it to say here that the circuit exhibits a good tolerance to capacitive loads.
The circuit lends itself to ﬁltering both voltages and currents. It can be shown
(see Problem 7.31) that
Vo = HLPmRIi + (HLP + HBP)Vi
(7.28)
f0 =
1
2π√mnRC
Q =
√m/n
m + 1
(7.29)
where HLP and HBP are the standard second-order low-pass and band-pass func-
tions deﬁned in Section 3.3. This ﬁlter ﬁnds application in voltage-reference and
photodiode-ampliﬁer noise reduction.
7.5
NOISE IN PHOTODIODE AMPLIFIERS
An area in which noise is of concern is low-level signal detection, such as instru-
mentation applications and high-sensitivity I-V conversion. In particular, photodiode
ampliﬁers have been at the center of considerable attention,12 so we examine this
class of ampliﬁers in some detail.
The photodiode of Fig. 7.14a responds to incident light with a current iS that
the op amp subsequently converts to a voltage vO. For a realistic analysis we use
the model of Fig. 7.14b, where R1 and C1 represent the combined resistance and
capacitance toward ground of the diode and the inverting-input pin of the op amp,
and C2 represents the stray capacitance of R2. With careful printed-circuit board
layout, C2 can be kept in the range of 1 pF or less. Usually C1 ≫C2 and R1 ≫R2.
We are interested in the signal gain As = Vo/Is as well as the noise gain
An = eno/eni. To this end, we need to ﬁnd the feedback factor β = Z1/(Z1 + Z2),
C2
R2
R2
C1
vO
iS
in
+
–
R1
Is
Vo
en
+
–
a
iR2
(a)
(b)
FIGURE 7.14
Photodiode ampliﬁer and its noise model.

358
CHAPTER 7
Noise
f (dec)
f (dec)
V/V (dec)
V/A (dec)
1/ 0
1/ ∞
|An|
|As|
|a|
fz
fp
fp
fx
fx
ft
R2
(a)
(b)
β
β
FIGURE 7.15
Noise gain An and signal gain As for the photodiode ampliﬁer.
Z1 = R1 ∥[1/( j2π f C1)], Z2 = R2 ∥[1/( j2π f C2)]. Expanding gives
1
β =

1 + R2
R1
 1 + j f /fz
1 + j f /f p
(7.30a)
fz =
1
2π(R1 ∥R2)(C1 + C2)
f p =
1
2π R2C2
(7.30b)
The 1/β function has the low-frequency asymptote 1/β0 = 1 + R2/R1, the high-
frequency asymptote 1/β∞= 1 + C1/C2, and two breakpoints at fz and f p. As
shown in Fig. 7.15a, the crossover frequency is fx = β∞ft, so the noise gain is
An = (1/β)/(1 + jf/fx), or
An =

1 + R2
R1

1 + j f /fz
(1 + j f /f p)(1 + j f /fx)
(7.31)
We also observe that for a →∞we have As(ideal) = R2/(1 + jf/f p), so the signal
gain is
As =
R2
(1 + jf/f p)(1 + jf/fx)
(7.32)
and is shown in Fig. 7.15b. With C1 ≫C2, the noise-gain curve exhibits signiﬁ-
cant peaking, a notorious feature of photodiode ampliﬁers. This can be reduced by
adding a capacitance in parallel with R2; however, this also reduces the signal-gain
bandwidth f p.
EXAMPLE 7.11.
In the circuit12 of Fig. 7.14 let the op amp be the OPA627 JFET-input
op amp, for which ft = 16 MHz, enw = 4.5 nV/
√
Hz, fce = 100 Hz, and IB = 1 pA.
Estimate the total output noise Eno above 0.01 Hz if R1 = 100 G, C1 = 45 pF,
R2 = 10 M, and C2 = 0.5 pF.
Solution.
With the above data we have 1/β0 ∼= 1 V/V, 1/β∞= 91 V/V, fz = 350 Hz,
f p = 31.8 kHz, and fx = 176 kHz. Moreover, by Eqs. (7.15b) and (7.16), iR2 =
40.6 fA/
√
Hz and in = 0.566 fA/
√
Hz. We observe that the noise gain for en is An,
whereas the noise gains for in and iR2 coincide with the signal gain As. The output densi-
ties, obtained as enoe = |An|en, enoi = |As|in, and enoR = |As|iR2, are plotted in Fig. 7.16.

359
SECTION 7.5
Noise in
Photodiode
Ampliﬁers
√
fz
fp
fx
103
102
102
103
104
105
106
10
406
5.66
409
10
1
enoe
enoR
enoi
eno
f  (Hz)
(nV/        )
Hz
FIGURE 7.16
Output spectral densities of the photodiode ampliﬁer of Exam-
ple 7.11.
The pink-noise tangent principle reveals that the dominant components are the
voltage noise enoe in the vicinity of fx, and the thermal noise enoR in the vicinity
of f p. Current noise is negligible because we are using a JFET-input op amp. Thus,
Enoe ∼= (1/β∞)en

(π/2) fx −f p = 91 × 4.5 × 10−9
(1.57 × 176 −31.8)103 =
202 μV (rms), and EnoR ∼= R2iR2 ×
(π/2) f p ∼= 91 μV. Finally, Eno ∼=
√
2022 + 912 =
222 μV (rms). A PSpice simulation (see Problem 7.35) gives Eno = 230 μV (rms),
indicating that our hand-calculation approximations are quite reasonable.
Noise Filtering
The modiﬁed photodiode ampliﬁer of Fig. 7.17 incorporates the current-ﬁltering
option of Fig. 7.13 to reduce noise. In choosing the ﬁlter cutoff frequency f0, we must
be careful that the signal-gain bandwidth is not reduced unnecessarily. Moreover,
the optimum value of Q is the result of a compromise between noise and response
characteristics such as peaking and ringing. A reasonable approach is to start with
C2
R2
R3
C3
Vo
Is
Cc
+
–
FIGURE 7.17
Photodiode ampliﬁer with noise ﬁltering.

360
CHAPTER 7
Noise
Cc = C2 and R3C3 = R2Cc, so that m = 1/n and Q ∼= 1 for m ≫1. Then we ﬁne-
tune Cc and R3 for a best compromise between noise and response characteristics.
EXAMPLE 7.12.
Assuming the parameters of Example 7.11, ﬁnd suitable values for
Cc, R3, and C3 in the circuit of Fig. 7.17.
Solution.
Let Cc = C2 = 0.5 pF. Pick C3 = 10 nF as a convenient value. Then, R3 =
R2Cc/C3 = 500 .
PSpice simulations for different values of R3 give a good compromise for R3 =
1 k, which results in a signal-gain bandwidth of about 24 kHz and Eno ∼= 80 μV (rms).
Thus, ﬁltering has reduced noise to about one third of the original value of 230 μV (rms).
When the circuit is tried out in the lab, empirical tuning is necessary because of parasitics
not accounted for by our PSpice model.
T-Feedback Photodiode Ampliﬁers
As we know, the use of a T-network makes it possible to achieve extremely high
sensitivities using moderately high resistances. To assess its impact on dc as well as
noise, we use the model of Fig. 7.18. The T-network is usually implemented with
R3 ∥R4 ≪R2, so R2 is raised to the equivalent value Req ∼= (1 + R4/R3)R2, and
i2
R ∼= i2
R2 = 4kT/R2. One can show (see Problem 7.38) that the noise and signal gains
are now
An ∼=

1 + R2
R1

1 + R4
R3

1 + jf/fz
(1 + jf/f p)(1 + jf/fx)
(7.33a)
As ∼=
(1 + R4/R3)R2
(1 + jf/f p)(1 + jf/fx)
(7.33b)
fz =
1
2π(R1 ∥R2)(C1 + C2)
f p =
1
2π(1 + R4/R3)R2C2
(7.34)
C2
R2
R4
C1
in
R1
R3
Is
Vo
en
+
–
a
iR
FIGURE 7.18
T-network photodiode ampliﬁer.

361
SECTION 7.6
Low-Noise Op
Amps
indicating that the dc values of both gains are raised by a factor of 1 + R4/R3.
In particular, we observe that EnoR ∼= (1 + R4/R3) × R2iR
π f p/2 = [(1 +
R4/R3)kT/C2]1/2, indicating that thermal noise increases with the square root of the
factor 1 +R4/R3. Consequently, we must suitably limit this factor in order to avoid
raising noise unnecessarily. As it turns out, the T-network option is worthwhile12
when high-sensitivity ampliﬁers are used in connection with large-area photodiodes.
The large capacitances of these devices cause enough noise-gain peaking to allow
for thermal noise increase without jeopardizing the overall noise performance.
EXAMPLE 7.13.
In the circuit12 of Fig. 7.18 let the op amp be the OPA627 of Exam-
ple 7.11, and let the diode be a large-area photodiode such that C1 = 2 nF, everything
else remaining the same. (a) Specify a T-network for a dc sensitivity of 1 V/nA. (b) Find
the total rms output noise and the signal bandwidth.
Solution.
(a) Wenowhave1/β0 ∼= 1+R4/R3,1/β∞= 1+C1/C2 = 4000V/Vand fx = β∞ft =
4 kHz. To avoid increasing voltage noise unnecessarily, impose 1/β0 < 1/β∞, or
1 + R4/R3 < 4000. Then, Enoe ∼= (1/β∞)en
√π fx/2 = 1.43 mV. To avoid increas-
ing thermal noise unnecessarily, impose EnoR ≤Enoe/3, or [(1+ R4/R3)kT/C2]1/2
≤Enoe/3. This yields 1 + R4/R3 ≤27 ( < 4000). Then R2 = 109/27 = 37 M.
Pick R2 = 36.5 M, R3 = 1.00 k, R4 = 26.7 k.
(b) The signal bandwidth is fB = f p = 1/(2π × 109 × 0.5 × 10−12) = 318 Hz.
Moreover, EnoR ∼= 0.5 mV, Enoi = 109 × 0.566 × 10−15√1.57 × 318 = 12.6 μV,
and Eno ∼=
√
1.432 + 0.52 = 1.51 mV (rms).
7.6
LOW-NOISE OP AMPS
As discussed in Section 7.4, the ﬁgures of merit in op amp noise performance are
the white-noise ﬂoors enw and inw, and the corner frequencies fce and fci. The
lower their values, the quieter the op amp. In wideband applications, usually only
the white-noise ﬂoors are of concern; however, in instrumentation applications the
corner frequencies may be crucial as well.
A well-documented13 op amp that was speciﬁcally designed with the opti-
mization of the above ﬁgures of merit in mind is the industry-standard OP27 of
Fig. 7.19. The device incorporates a number of the precision features discussed
in Chapter 5, namely, input current cancellation (Q6), common-centroid layout
(Q1A/Q1B-Q2A/Q2B), and on-chip VOS trimming (R1-R2). It also includes an
input-protectiondiodepair,asshown.Thenoisecharacteristics,graphedinFig.7.20a
and b, are: enw = 3 nV/
√
Hz, fce = 2.7 Hz, inw = 0.4 pA/
√
Hz, and fci = 140 Hz.
These characteristics are compared, in Fig. 7.20c, against those of the NE5533
low-noise audio op amp and the 741 general-purpose op amp. In the following dis-
cussion we shall use the OP27 as a vehicle for a discussion of basic low-noise design
issues.
Except for programmable op amps, the user has no control over the noise char-
acteristics; however, a basic understanding of how these characteristics originate
will help in the device selection process. As with the input offset voltage and bias

362
CHAPTER 7
Noise
VCC
vO
Q22
Q19
Q20
R23 R24
Q23
Q2A
Q2B
VOS
vP
vN
VEE
Adj
Q1B
Q1A
Q3
Q28
Q24
Q46
Q45
Q26
Q27
Q21
R4
R3
Q6
R1
R2
FIGURE 7.19
Simpliﬁed circuit diagram of the OP27 low-noise precision op amp. (Courtesy of Analog
Devices.)
current, both voltage and current noise depend very heavily on the technology and
operating conditions of the differential transistor pair of the input stage. Voltage
noise is also affected by the load of the input pair and by the second stage. The noise
produced by the subsequent stages is less critical because, as discussed in connection
with Fig. 1.27, when reﬂected to the input, this noise gets divided by the gains of all
preceding stages.
(a)
(b)
(c)
FIGURE 7.20
(a) Noise-voltage and (b) noise-current characteristics of the OP27/37 op amp. (c) Noise-
voltage comparison of three popular op amps. (Courtesy of Analog Devices.)

363
SECTION 7.6
Low-Noise Op
Amps
Differential Input-Pair Noise
The noise contributed by the differential input pair can be minimized by proper
choice of transistor type, geometry, and operating current. Consider BJT-input op
amps ﬁrst. Recall from Eq. (7.19a) that BJT voltage noise depends on the base-
spreading resistance rb and transconductance gm. In the OP27 the differential-pair
BJTs are realized in the striped geometry (long and narrow emitters surrounded by
base contacts on both sides) to minimize rb, and are biased at substantially higher-
than-normal collector currents (120 μA per side) to increase gm.13 The increase in
operating current, however, has an adverse effect on the input bias current IB and
the input noise current in. In the OP27 shown in Fig. 7.19, IB is reduced by the
current-cancellation technique. Noise densities, however, do not cancel but add up
in rms fashion, so in current-cancellation schemes, inw is higher than the shot-noise
value predicted by Eq. (7.19b).
When the application requires large external resistances, FET-input op amps
offer a better alternative since their noise current levels are orders of magnitude
lower than those of BJT-input devices, at least near room temperature. FETs, on the
other hand, tend to exhibit higher voltage noise, mainly because they have lower
gms than BJTs. As an example of a JFET-input op amp, the OPA827 has, at 1 kHz,
en = 4 nV/
√
Hz and in = 2.2 fA/
√
Hz.
In the case of MOSFETs, 1/f noise is also a critical factor. By Eq. (7.21a), the
1/f component can be reduced by using large-area devices. Moreover, the empirical
observation that p-channel devices tend to display less 1/f noise than n-channel
types indicates that, in general, the best noise performance in CMOS op amps is
achieved by using p-channel input transistors. As an example of a CMOS op amp,
the OPA320 has, at 1 kHz, en = 8.5 nV/
√
Hz and in = 0.6 fA/
√
Hz at 1 kHz. (A
web search for low-noise JFET or CMOS op amps will give you a better idea of the
staggering variety of available products.)
Input-Pair Load Noise
Another critical source of noise is the load of the differential input pair. In general-
purpose op amps such as the 741, this load is implemented with a current-mirror
active load to maximize gain. Active loads, however, are notoriously noisy since they
amplify their own noise current. Once divided by the ﬁrst-stage transconductance
and converted to an equivalent input noise voltage, this component can degrade the
noise characteristics signiﬁcantly. In fact, in the 741, noise from the active load
exceeds noise from the differential input pair itself.8
The OP27 avoids this problem by using a resistively loaded input stage,13 as
shown in Fig. 7.19. In CMOS op amps, the noise contribution from the active load,
when reﬂected back to the input, is multiplied by the ratio of the gm of the load to the
gm of the differential pair.8 Thus, using a load with low gm reduces this component
signiﬁcantly.
Second-Stage Noise
The last potentially critical contributor to en is the second stage, particularly when
this is implemented with pnp transistors to provide level shifting as well as additional

364
CHAPTER 7
Noise
gain (see Q23 and Q24 in Fig. 7.19). Being surface devices, pnp transistors suffer
from large 1/f noise and poor β. Once this noise is reﬂected back to the input, it can
increase fce signiﬁcantly. The OP27 avoids this drawback by using emitter followers
Q21 and Q22 (see again Fig. 7.19) to isolate the ﬁrst stage from the pnp pair.13
Ultralow-Noise Op Amps
High-precision instrumentation often requires ultrahigh open-loop gains to achieve
the desired degree of linearity, together with ultralow noise to ensure an adequate
SNR. In these situations, considerations of cost and availability may justify the
development of specialized circuits to meet the requirements.
Figure 7.21 shows an example of specialized op amp design whose dc speci-
ﬁcations are compatible with high-precision transducer requirements and ac speci-
ﬁcations are suitable for professional audio work.14 The circuit uses the low-noise
OP27 op amp with a differential front end to simultaneously increase the open-loop
gain and reduce voltage noise. The front end consists of three parallel-connected
MAT-02 low-noise dual BJTs operating at moderately high collector currents
(1 mA per transistor). The parallel arrangement reduces the base spreading resistance
of the composite device by
√
3, while the high collector current increases gm. This
yields an equivalent input noise voltage with enw = 0.5 nV/
√
Hz and fce = 1.5 Hz.
R6 
22 Ω
C1
100 nF
100 nF
100 Ω
R4
1.5 kΩ, 0.1%
R5
1.5 kΩ, 0.1%
R9
22 Ω
R8
390 Ω
R1
390 Ω
R2
390 Ω
27 kΩ
R3
180 Ω
R12
2N2905
Q4
+
–
2
3
4
7
6
MAT-02
MAT-02
MAT-02
RED
LED
+15 V
–15 V
Null
R7
 150 Ω
0.01 μF
vO
vN
vP
OP-27
FIGURE 7.21
Ultralow-noise op amp. (Courtesy of Analog Devices.)

365
Problems
Transistor Q4, in conjunction with R12 and the LED, forms a temperature-stable
6-mA current sink that R1 through R3 then split evenly among the three differential
pairs. R6 and C1 provide frequency compensation for closed-loop gains greater than
10, and R7 nulls the input offset voltage.
The additional gain provided by the front end increases the overall dc gain to
a0 = 3×107 V/V. Other measured parameters are inw = 1.5 pA/
√
Hz, TC(VOS) =
0.1 μV/◦C (max), GBP = 150 MHz with A0 = 103 V/V, and CMRRdB = 130 dB.
Similar front-end designs can be used to improve the noise characteristics of other
critical circuits, such as instrumentation ampliﬁers and audio preamps.
PROBLEMS
7.1 Noise properties
7.1 Two IC noise spot measurements, performed respectively at f1 = 10 Hz and f2 ≫fce,
yield en( f1) = 20 nV/
√
Hz and en( f2) = 6 nV/
√
Hz. Find the rms noise from 1 mHz
to 1 MHz.
7.2 Consider two integrated-circuit noise sources en1 and en2 of the type of Eq. (7.8) in
series with each other. (a) Show that the equivalent noise en of the combination of
the two sources is still of the type of Eq. (7.8) by deriving expressions for its white-
noise ﬂoor enw and corner frequency fce in terms of the individual noise ﬂoors and
corner frequencies. (b) If en1 has enw1 = 30 nV/
√
Hz and fce1 = 400 Hz, and en2
has enw2 = 40 nV/
√
Hz and fce2 = 100 Hz, what is the total noise En from 1 Hz to
1 MHz?
7.2 Noise dynamics
7.3 (a) Using the integral tables (you can ﬁnd them on the web), prove Eq. (7.11). (b) Repeat,
but for Eq. (7.14).
7.4 (a) Assuming fL = 0, ﬁnd the NEB of the composite ampliﬁer of Fig. 6.6a, consisting
of two identical stages in cascade. How does this NEB compare with that of each
individual stage? Justify in terms of Bode-plot areas. (b) How would you approximate
for the ﬂicker-noise frequency fH?
7.5 (a) Consider the case Q = 1/
√
2 in Eq. (7.13b). Compare NEBBP with NEBLP, and
compare NEBLP with the NEB of a ﬁrst-order circuit, and justify the differences intu-
itively in terms Bode-plot areas. (b) Compare NEBBP with NEBLP for the case Q = 10,
and justify the differences.
7.6 Conﬁrm the value of fH of Example 7.2 via hand calculations. Hint: Apply Eq. (7.12),
along with Eqs. (7.11b) and (7.13b).
7.7 (a) Find the NEB of a ﬁlter consisting of an R-C network, followed by a buffer, followed
byanotherR-Cnetwork.(b)Repeat,butforaﬁlterconsistingofa C-Rnetwork,followed
by a buffer, followed by an R-C network. (c) Repeat, but for a ﬁlter consisting of an R-C
network, followed by a buffer, followed by a C-R network. (d) Rank the three ﬁlters in
terms of noise minimization.
7.8 Estimate the NEB of the RIAA response of Fig. 3.13. Conﬁrm with PSpice.

366
CHAPTER 7
Noise
7.9 Find the NEB if An(s) has two zeros at s = −20π rad/s and s = −2π103 rad/s, and four
poles at s = −200π rad/s, s = −400π rad/s, s = −2π104 rad/s, and s = −2π104 rad/s.
7.10 Find the total output noise when a noise source with fce = 100 Hz and enw =
10 nV/
√
Hz is played through a noiseless wideband band-pass ﬁlter with a mid-
frequency gain of 40 dB and −3-dB frequencies of 10 Hz and 1 kHz. Conﬁrm via
the pink-noise tangent.
7.11 A certain voltage reference is buffered to the outside via an FET-input op amp voltage
follower. The reference’s output noise en1 has enw1 = 100 nV/
√
Hz and fce1 = 20 Hz,
and the noise produced by the op amp itself is modeled by a source en2 (in series with
en1) and such that en2 has enw2 = 25 nV/
√
Hz and fce2 = 200 Hz. Moreover, the op
amp is dominant-pole compensated for GBP = 1 MHz via an external capacitance Cc.
(a) Calculate the total noise above 0.1 Hz at the output of the follower. (b) Repeat if Cc
is increased such that GBP = 10 kHz.
7.12 The spectral noise eno of a certain ampliﬁer below 100 Hz consists of 1/f noise with
fce = 1 Hz and enw = 10 nV/
√
Hz; from 100 Hz to 1 kHz it rolls off at the rate of
−1 dec/dec; from 1 kHz to 10 kHz it is again constant at 1 nV/
√
Hz; and past 10 kHz
it rolls off at the rate of −1 dec/dec. Sketch and label eno, estimate the total rms noise
above 0.01 Hz, and conﬁrm using the pink-noise tangent principle.
7.3 Sources of noise
7.13 The noise of an IC current source is measured at two different frequencies and is found
to be in(250 Hz) = 6.71 pA/
√
Hz and in(2500 Hz) = 3.55 pA/
√
Hz. (a) What are the
values of inw and fci? (b) If the source is fed to a 1-k resistance, ﬁnd the values of
enw and fce for the noise voltage across its terminals. (c) Find the total rms noise En
above 0.01 Hz if a 10-nF capacitor is placed across the resistor.
7.14 A diode with Is = 2 fA, rS ∼= 0, K = 10−16 A, and a = 1 is forward-biased at
ID = 100 μA by a 3.3-V supply via a suitable series resistance R. The supply itself
exhibitsnoisethatcanbeassumedwhitewithadensityofens = 100 nV/
√
Hz.Combine
the supply noise ens, the resistor noise enr, and the diode noise in, to ﬁnd the overall
noise voltage en( f ) across the diode, and express it in the form of Eq. (7.8). What are
the values of enw and fce? Hint: To perform noise analysis, replace the diode with its
ac equivalent, consisting of a noiseless resistance rd = VT /ID = (26 mV)/ID.
7.15 The LT1009 2.5-V reference diode, when suitably biased, acts as a 2.5-V source with
superimposed noise of the type e2
n ∼= (118 nV/
√
Hz)2(30/f + 1). If the diode voltage
is sent through an R-C ﬁlter with R = 10 k and C = 1 μF, estimate the peak-to-peak
noise that one would observe at the output over a 1-minute interval.
7.16 Find a resistance that will produce the same amount of room-temperature noise as a
diode operating with (a) a forward-bias current of 50 μA, and (b) a reverse-bias current
of 1 pA.
7.17 (a) Show that the total rms noise voltage across the parallel combination of a resistance
R and capacitance C is En = √kT/C, regardless of R. (b) Find an expression for the
total rms value of the noise current ﬂowing through a resistance R in series with an
inductance L.

367
Problems
7.18 (a) Find a resistance that produces the same enw as a 741 op amp at room temperature.
(b) Find a reverse-biased diode current that produces the same inw as a 741 op amp.
How does this current compare with the input bias current of the 741?
7.4 Op amp noise
7.19 In the difference ampliﬁer of Fig. 1.18 let R1 = R3 = 10 k and R2 = R4 = 100 k.
Find the total output noise Eno above 0.1 Hz if the op amp is (a) the 741 type, and
(b) the OP27 type. Compare also the individual components Enoe, Enoi, and EnoR, and
comment. For the 741 assume ft = 1 MHz, enw = 20 nV/
√
Hz, fce = 200 Hz, inw =
0.5 pA/
√
Hz, and fci = 2 kHz; for the OP27 assume ft = 8 MHz, enw = 3 nV/
√
Hz,
fce = 2.7 Hz, inw = 0.4 pA/
√
Hz, and fci = 140 Hz.
7.20 Using a 741 op amp, design a circuit that accepts three inputs v1, v2, and v3, and yields
vO = 2(v1 −v2 −v3); hence, estimate its total output noise above 1 Hz.
7.21 In the bridge ampliﬁer of Fig. P1.81 let R = 100 k and A = 2 V/V, and let the op
amps be 741 types. Estimate the total output noise above 1 Hz.
7.22 (a) Find the total rms output noise above 0.1 Hz for the I-V converter of Fig. 2.2 if
R = 10 k, R1 = 2 k, R2 = 18 k, and the op amp is the OP27, whose characteristics
are given in Problem 7.19. (b) Find the SNR if iI is a triangular wave with peak values
of ±10 μA.
7.23 (a) Find the total output noise above 0.1 Hz for the inverting ampliﬁer of Fig. P1.64
if all resistances are 10 k and the op amp is the 741 type. (b) Find the SNR if
vI = 0.5 cos 100t + 0.25 cos 300t V.
7.24 A JFET-input op amp with enw = 18 nV/
√
Hz, fce = 200 Hz, and ft = 3 MHz is conﬁg-
ured as an inverting integrator with R = 159 k and C = 1 nF. Estimate the total output
noise above 1 Hz.
7.25 It is required to design an ampliﬁer with A0 = 60 dB using op amps with GBP =
1 MHz. Two alternatives are being evaluated, namely, a single-op-amp realization and
a two-op-amp cascade realization of the type of Example 6.2. Assuming the resistances
are sufﬁciently low to render current and resistor noise negligible, which of the two
conﬁgurations is noisier and by how much?
7.26 Using the OP227 dual op amp, design a dual-op amp instrumentation ampliﬁer with a
gain of 103 V/V, and ﬁnd its total output noise above 0.1 Hz. Try keeping noise as low
as practical. The OP227 consists of two OP27 op amps in the same package, so use the
data of Problem 7.19.
7.27 With reference to the triple-op amp instrumentation ampliﬁer of Fig. 2.20, consider
the ﬁrst stage, whose outputs are vO1 and vO2. (a) Show that if OA1 and OA2 are
dual op amps with densities en and in, the overall input power density of this stage is
e2
ni = 2e2
n + [(RG ∥2R3)in]2/2 + 4kT (RG ∥2R3). (b) Estimate the total rms noise pro-
duced by this stage above 0.1 Hz if RG = 100 , R3 = 50 k, and the op amps are
from the OP227 dual-op amp package, whose characteristics are the same as those of
the OP27 given in Problem 7.19.

368
CHAPTER 7
Noise
7.28 (a) In the triple-op amp instrumentation ampliﬁer of Fig. 2.21 let the pot be adjusted
for a gain of 103 V/V. Using the results of Problem 7.27, estimate the total output
noise above 0.1 Hz. (b) Find the SNR for a sinusoidal input having a peak amplitude
of 10 mV.
7.29 Use PSpice to verify the CFA noise calculations of Example 7.10.
7.30 The circuit of Fig. 7.9a has R1 = R3 = 10  and R2 = 10 k, and its output is
observed through a band-pass ﬁlter having NEB = 100 Hz. The reading is 0.120 mV
(rms), and it can be regarded as being primarily voltage noise since R1 and R3 are so
small. Next, a 500-k resistor is inserted in series with each input pin of the op amp
to generate substantial current noise. The output reading is now 2.25 mV rms. Find en
and in.
7.31 (a) Derive the transfer function of the noise ﬁlter of Fig. 7.13. (b) Modify the circuit so
that it works as an inverting voltage ampliﬁer with H = −10HLP.
7.32 Using two 0.1-μF capacitances, specify resistances in the noise ﬁlter of Fig. 7.13 for
f0 = 100 Hz and Q = 1/2. If the op amp is the 741 type, ﬁnd the total rms noise
generated by the ﬁlter above 0.01 Hz with Vi and Ii both set to zero.
7.33 Using the voltage-input option of the noise ﬁlter of Fig. 7.13, design a circuit to ﬁlter
the voltage of the LT1009 reference diode of Problem 7.15 for a total output noise
above 0.01 Hz of 1 μV (rms) or less. Assume an OP27 op amp whose characteristics
are given in Problem 7.19.
7.34 A student feeds the output of the LT1009 2.5-V reference diode (see Problem 7.15) to a
voltage follower as well as to a unity-gain inverting ampliﬁer so as to create a buffered
dual reference of ±2.5 V. The op amps used are JFET types with GBP = 1 MHz,
enw = 10 nV/
√
Hz, and fce = 250 Hz, and the inverting ampliﬁer uses two 20-k
resistors. Find the total output noise above 1 Hz for both the +2.5-V and the −2.5-V
op amp outputs. Which one is less noisy, and why? Is this a good design, or can you
suggest improvements?
7.5 Noise in photodiode ampliﬁers
7.35 Use PSpice to plot enoe, enoi, enoR, and eno for the circuit of Example 7.11. Hence, use
the “s” and “sqrt” Probe functions to ﬁnd Eno.
7.36 Investigate the effect of connecting an additional capacitance C f = 2 pF in parallel
with R2 in the photodiode ampliﬁer of Example 7.11. How does it affect noise? The
signal-gain bandwidth?
7.37 Use PSpice to conﬁrm Example 7.12.
7.38 Derive Eqs. (7.33) and (7.34).
7.39 Rework Example 7.11, but with R2 replaced by a T-network with R2 = 1 M,
R3 = 2 k, and R4 = 18 k, everything else staying the same. Comment on your
ﬁndings.

369
References
7.40 Verify Example 7.13 via PSpice.
7.41 Modify the circuit of Example 7.13 to ﬁlter noise without signiﬁcantly reducing the
signal bandwidth. What is the total output noise of your circuit?
7.6 Low-noise op amps
7.42 A popular noise reduction technique is to combine N identical voltage sources in the
manner of Fig. P7.42. (a) Show that if the noise of the resistors is negligible, the output
density eno is related to the individual source densities en as eno = en/
√
N. (b) Find
the maximum value of the resistances in terms of en so that the rms noise contributed
by the resistances is less than 10% of the rms noise due to the sources.
R
VREF
R
VREF
R
vO
VREF
FIGURE P7.42
7.43 The circuit of Fig. P7.42 uses four LT1009 reference diodes (see Problem 7.15) and
four 10-k resistors, and includes also a 1-μF capacitor between the output node and
ground. (a) Find the total output noise above 1 Hz. (b) Repeat, if three of the LT1009s
are disconnected, leaving only one in place.
REFERENCES
1. H. W. Ott, Noise Reduction Techniques in Electronic Systems, 2d ed., John Wiley &
Sons, New York, 1988.
2. C. D. Motchenbacher and J. A. Connelly, Low-Noise Electronic System Design, John
Wiley & Sons, New York, 1993.
3. A. P. Brokaw, “An IC Ampliﬁers User’s Guide to Decoupling, Grounding, and Making
Things Go Right for a Change,” Application Note AN-202, Applications Reference
Manual, Analog Devices, Norwood, MA, 1993.
4. A. Rich, “Understanding Interference-Type Noise,” Application Note AN-346, and
“Shielding and Guarding,” Application Note AN-347, Applications Reference Manual,
Analog Devices, Norwood, MA, 1993.
5. F. N. Troﬁmenkoff, D. F. Treleaven, and L. T. Bruton, “Noise Performance of RC-Active
Quadratic Filter Sections,” IEEE Trans. Circuit Theory, Vol. CT-20, No. 5, September
1973, pp. 524–532.
6. A. Ryan and T. Scranton, “Dc Ampliﬁer Noise Revisited,” Analog Dialogue, Vol. 18,
No. 1, Analog Devices, Norwood, MA, 1984.
7. M. E. Gruchalla, “Measure Wide-Band White Noise Using a Standard Oscilloscope,”
EDN, June 5, 1980, pp. 157–160.
8. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009, ISBN 978-0-470-
24599-6.

370
CHAPTER 7
Noise
9. S. Franco, “Current-Feedback Ampliﬁers,” Analog Circuits: World Class Designs, R. A.
Pease ed., Elsevier/Newnes, New York, 2008, ISBN 978-0-7506-8627-3.
10. W. Jung, Op Amp Applications Handbook (Analog Devices Series), Elsevier/Newnes,
New York, 2005, ISBN 0-7506-7844-5.
11. R. M. Stitt, “Circuit Reduces Noise from Multiple Voltage Sources,” Electronic Design,
Nov. 10, 1988, pp. 133–137.
12. J.G.Graeme,PhotodiodeAmpliﬁers–OpAmpSolutions, McGraw-Hill,NewYork,1996.
13. G. Erdi, “Ampliﬁer Techniques for Combining Low Noise, Precision, and High Speed
Performance,” IEEE J. Solid-State Circuits, Vol. SC-16, December 1981, pp. 653–661.
14. A. Jenkins and D. Bowers, “NPN Pairs Yield Ultralow-Noise Op Amp,” EDN, May 3,
1984, pp. 323–324.

8
STABILITY
8.1 The Stability Problem
8.2 Phase and Gain Margin Measurements
8.3 Frequency Compensation of Op Amps
8.4 Op Amp Circuits with a Feedback Pole
8.5 Input-Lag and Feedback-Lead Compensation
8.6 Stability in CFA Circuits
8.7 Composite Ampliﬁers
Problems
References
Since its conception by Harold S. Black in 1927, negative feedback has become a
cornerstone of electronics and control, as well as other areas of applied science, such
as biological systems modeling. As seen in the previous chapters, negative feedback
results in a number of performance improvements, including gain stabilization
against process and environmental variations, reduction of distortion stemming from
component nonlinearities, broadbanding, and impedance transformation. These ad-
vantages are especially startling if feedback is applied around very high-gain ampli-
ﬁers such as op amps.
Negative feedback comes at a price, however: the possibility of an oscillatory
state. In general, oscillation will result when the system is capable of sustaining a sig-
nal around the loop regardless of any applied input. For this to occur, the system must
provide enough phase shift around the loop to turn feedback from negative to posi-
tive, and enough loop gain to sustain an output oscillation without any applied input.
Chapter Highlights
The chapter provides a systematic investigation of the conditions leading to insta-
bility as well as suitable cures, known as frequency compensation techniques, to
371

372
CHAPTER 8
Stability
stabilize the circuit so that the beneﬁts of negative feedback can be fully realized.
The chapter begins with important deﬁnitions related to stability, such as phase
and gain margins, peaking and ringing, rate of closure, loop-gain calculations via
return-ratio analysis, and loop-gain measurements via voltage/current injections.
Next, it illustrates the most common techniques used in internally compensated
op amps: dominant pole, pole-zero, Miller, right-half-plane zero control, and feed-
forward compensation. The chapter proceeds with a detailed analysis of circuits
containing a feedback pole, with particular attention to the effect of stray input
capacitances and capacitive loading. Next, the chapter discusses the popular com-
pensation schemes known as input-lag and feedback-lead. Finally, after investigating
the stability of current-feedback ampliﬁers, the chapter concludes with the stability
of composite ampliﬁers.
Stability provides a fertile area for computer simulations, both to illustrate new
concepts as they are being introduced, and as a veriﬁcation tool for estimations via
hand calculations. This chapter makes abundant use of PSpice to provide visual
immediacy to the various compensation schemes presented.
8.1
THE STABILITY PROBLEM
The advantages of negative feedback are realized only if the circuit has been stabi-
lized against the possibility of oscillations. For an intuitive discussion,1,2 refer to
the feedback system of Fig. 8.1, where for simplicity we assume unilateral blocks
and no feedthrough, so we can apply Eq. (6.13),
A( j f ) = Vo
Vi
= Aideal × D( j f )
(8.1)
where Aideal is the closed-loop gain in the limit a →∞, and
D( j f ) =
1
1 + 1/T ( j f )
(8.2)
is the discrepancy function, and
T ( j f ) = a( j f )β( j f )
(8.3)
is the loop gain, which we ﬁnd via the return-ratio techniques of Section 1.7. As we
know, whenever the ampliﬁer detects an input error Vd, it tries to reduce it. It takes
Vo
Vi
Vd
Vf
a( j f )
( j f )
+
–Σ
FIGURE 8.1
Negative-feedback system with unilat-
eral ampliﬁer and unilateral feedback
network.

373
SECTION 8.1
The Stability
Problem
some time, however, for the ampliﬁer to react and then transmit its response back
to the input via the feedback network. The consequence of this combined delay is a
tendency on the part of the ampliﬁer to overcorrect the input error, especially if the
loop gain is high. If the overcorrection exceeds the original error, a regenerative effect
results, whereby the magnitude of Vd diverges, instead of converging, and instability
results. Signal amplitudes grow exponentially until inherent circuit nonlinearities
limit further growth, forcing the system either to saturate or to oscillate, depending
on the order of its system function. By contrast, a circuit that succeeds in making
Vd converge is stable.
Gain Margin
Whether a system is stable or unstable is determined by the manner in which its
loop gain T varies with frequency. To substantiate, suppose a frequency exists at
which the phase angle of T is −180◦; call this frequency f−180◦. Then, T ( j f−180◦)
is real and negative, such as −0.5, −1, −2, indicating that feedback has turned from
negative to positive. We consider three signiﬁcant cases:
If |T ( j f −180◦)| < 1, then Eq. (1.40), rewritten as
A( j f−180◦) =
a( j f−180◦)
1 + T ( j f−180◦)
indicates that A( j f−180◦) is greater than a( j f−180◦) because the denominator is less
than unity. The circuit is nonetheless stable because any signal circulating around the
loop will progressively decrease in magnitude and eventually die out; consequently,
the poles of A(s) must lie in the left half of the s plane.
If T ( j f −180◦) = −1, the above equation predicts A( j f−180◦) →∞, indicating
that the circuit can now sustain an output signal even with zero input! The circuit
is an oscillator, indicating that A(s) must have a conjugate pole pair right on the
imaginary axis. Oscillations are initiated by ac noise, which is always present in
some form at the ampliﬁer input. An ac noise component Vd right at f = f−180◦
results in a feedback component V f = −Vd, which is further multiplied by −1 in
the summing network to yield Vd itself. Thus, once this ac component has entered
the loop, it will be sustained indeﬁnitely.
If |T ( j f−180◦)| > 1, mathematical tools other than the foregoing equation are
needed to predict circuit behavior. Sufﬁce it to say here that now A(s) may have
a conjugate pole pair in the right half of the s plane. Consequently, once started,
oscillation will grow in magnitude until some circuit nonlinearity, either inherent,
suchasanonlinearVTC,ordeliberate,suchasanexternalclampingnetwork,reduces
the loop gain to exactly unity. Henceforth, oscillation is of the sustained type.
A quantitative measure of stability is offered by the gain margin, deﬁned as
GM = 20 log
1
|T ( j f−180◦)|
(8.4)
The GM represents the number of decibels by which we can increase |T ( j f−180◦)|
before it becomes unity and thus leads to instability. For instance, a circuit with
|T ( j f−180◦)| = 1/
√
10 has GM = 20 × log10
√
10 = 10 dB, which is considered a
reasonable margin. By contrast, a circuit with |T ( j f−180◦)| = 1/
√
2 has GM = 3 dB,

374
CHAPTER 8
Stability
|T| (dB)
<) T
T0
0
f–180°
f–180°
f  (dec)
f  (dec)
fx
fx
GM
φm
φ
–180°
–90°
0
FIGURE 8.2
Visualizing gain margin GM and phase margin φm.
not much of a margin: only a modest increase in the gain a because of manufacturing
process variations or environmental changes may easily lead to instability! The GM
is visualized in Fig. 8.2 (top).
Phase Margin
An alternative and more common way of quantifying stability is via phase. In this
case we focus on T ( j fx), the phase angle of T at the crossover frequency fx,
where |T | = 1 by deﬁnition, and we deﬁne the phase margin φm as the number of
degrees by which we can lower T ( j fx) before it reaches −180◦and thus leads to
instability. We have φm = T ( j fx) −(−180◦), or
φm = 180◦+ T ( j fx)
(8.5)
The phase margin is visualized in Fig. 8.2 (bottom). As we move along, we shall be
interestedinthequantity|D( j f x)|.Since T ( j fx) = φm−180◦,wehave T ( j f x) =
1 exp[ j(φm −180◦)] = −1 exp( jφm). Substituting into Eq. (8.2) gives
|D( j fx)| =

1
1 + 1/(−1e jφm)
 =

1
1 −e−jφm
 =

1
1 −(cos φm −j sin φm)

=
1

(1 −cos φm)2 + (sin φm)2
where Euler’s formula has been used. Expanding and using the identity cos2 φm +
sin2 φm = 1, we get
|D( j fx)| =
1
√2 (1 −cos φm)
(8.6)

375
SECTION 8.1
The Stability
Problem
+
–
Vi
F
I
O
IN+
IN−
OUT+
OUT−
0
E
EOA
LAPLACE {v(I, F)} = {100k/((1+s/6.283E3)*(1+s/6.283E5)*(1+s/6.283E7))}
0
0
0
Vo
V/V
+
–
+
–
FIGURE 8.3
PSpice circuit to investigate a three-pole op amp under different
amounts of feedback.
An Illustrative Example
Let us illustrate the above concepts using the feedback circuit of Fig. 8.3 as a vehicle.
The circuit is based on a three-pole op amp with the open-loop gain
a( j f ) =
105
1 + j f/103 1 + j f/105 1 + j f/107
(8.7)
Magnitude and phase are calculated as
|a( j f )| =
105
1 + ( f/103)2 ×
1 + ( f/105)2 ×
1 + ( f/107)2
(8.8a)
a( j f ) = −

tan−1( f/103) + tan−1( f/105) + tan−1( f/107)
	
(8.8b)
and are plotted via PSpice in Fig. 8.4a (magnitude is in dB, as marked at the left,
and phase in degrees, as marked at the right).
If the roots are widely spaced apart as in the present example, we can combine
magnitude and phase in the more concise and visually intuitive form of Fig. 8.4b.
(a)
Frequency f (Hz)
Gain a (dB)
103
104
105
106
107
108
102
−60
−80
−20
0
20
40
60
−40
80
100
Phase of a
0°
−240°
−270°
−180°
−210°
−150°
−120°
−90°
−60°
−30°
|a|
(b)
Frequency f (Hz)
Gain a (dB)
103
104
105
106
107
108
102
−60
−80
−20
0
20
40
60
−40
80
100
−225°
−270°
f1
f2
f3
f–180°
f1
f2
f3
f–180°
−20 dB/dec
−40 dB/dec
−60 dB/dec
−180°
−135°
−90°
−45°
0°
<) a
FIGURE 8.4
(a) Open-loop magnitude and phase plots for the op amp of Fig. 8.3 (b) Linearized magnitude plot
associating phase with slope.

376
CHAPTER 8
Stability
Speciﬁcally, we draw a linearized magnitude plot using segments of progressively
steeper slopes, and we mark signiﬁcant phase values using the correspondence
Phase (in degrees) ↔4.5 × Slope (in dB/dec)
(8.9)
Thus, from dc to f1 we draw a segment with a slope of 0 dB/dec, for which Eq. (8.9)
implies a phase of 0◦. From f1 to f2 we draw a segment with a slope of −20 dB/dec,
implying a phase of 4.5 × (−20), or −90◦. Right at f1 the slope is the mean of
0 dB/dec and −20 dB/dec, or −10 dB/dec, so the corresponding phase is 4.5×(−10),
or −45◦. Likewise, the segment from f2 to f3 has a slope of −40 dB/dec, implying a
phase of −180◦. The phase at f2 is −135◦, and past f3 slope approaches −60 dB/dec
and phase approaches −270◦.
We now wish to investigate the closed-loop response under increasing amounts
of frequency-independent feedback, in which case T ( j f ) = a( j f ). We have
the following signiﬁcant cases:
• Starting out with β = 10−4, we observe that if we draw the 1/β line (1/β = 104 =
80 dB) in Fig. 8.4b, it will intersect the gain curve at fx ∼= 10 kHz, where
 a( j fx) ∼= −90◦. Consequently, φm ∼= 180◦−T ( j fx) = 180◦−a( j fx) =
180◦−90◦= 90◦. The closed-loop response, shown in Fig. 8.5, exhibits a domi-
nant pole frequency of fx. The response to an input step of β V (= 0.1 mV), shown
in Fig. 8.6a, is an approximately exponential transient. Once the input is stepped
back to zero, vO(t) will decay in approximately exponential fashion, indicating a
stable circuit.
• Raising β from 10−4 to 10−3 would lower the 1/β line to 60 dB in Fig. 8.4b, giving
fx ∼= 100 kHz and a( j fx) ∼= −135◦, so φm ∼= 180◦−135◦= 45◦. Now the
closed-loop gain exhibits a bit of peaking just before fx, after which it rolls off with
frequencyas|a( j f )|.ByEq.(8.6)wehave|D( j fx)| = 1/√2(1−cos 45◦) = 1.307,
102
103
104
105
106
107
10
1
102
103
104
105
Frequency f (Hz)
Gain (V/V)
|a|
1/ 5 104(m ù 908)
1/ 5 103(m ù 458)
1/ 5 102(m ù 17.58)
1/ 5 9.802 (m 5 08)
FIGURE 8.5
Closed-loop responses of the circuit of Fig. 8.3 for different
amounts of feedback. Raising β lowers the 1/β curve, shifting
the crossover frequency to regions of greater phase shift and thus
lower phase margin. This, in turn, increases the amount of peaking
as well as ringing (see Fig. 8.6).

377
SECTION 8.1
The Stability
Problem
0
10 ms
20 ms
30 ms
40 ms
0 V
0.5 V
1 V
(a)
0
10 ms
20 ms
30 ms
40 ms
0 V
1 V
2 V
(c)
0
1 ms
2 ms
3 ms
4 ms
5 ms
0 V
1 V
2 V
(d)
0
1 ms
2 ms
3 ms
4 ms
5 ms
2200 nV
0 V
200 nV
(e)
0
10 ms
20 ms
30 ms
40 ms
0 V
0.5 V
1 V
1.5 V
(b)
Time
Re
Im
Re
Im
Re
Im
Re
Im
Re
Im
p3
p2
p1
p3
p2
p1
p3
p2
p1
p3
p2
p1
p3
p2
p1
1/ 5 102
1/ 5 103
1/ 5 104
1/ 5 9.802
1/ 5 20
FIGURE 8.6
Step responses and s-plane pole locations of the circuit of Fig. 8.3 for increasing β.
so Eq. (8.1) predicts |A( j f x)| = 103 × 1.307, which is 30.7% higher than Aideal.
Recall from systems theory that peaking in the frequency domain is accompanied
by ringing in the time domain. This is conﬁrmed by Fig. 8.6b, showing the tran-
sient response to an input step of β V (= 1 mV). Once we step the input back
to zero, vO(t) will decay to zero, albeit with a bit of ringing. We conclude that

378
CHAPTER 8
Stability
a circuit with φm = 45◦is still a stable circuit, though its (moderate) amount of
peaking and ringing may be undesirable in certain applications.
• Raising β to 10−2 would lower the 1/β line to 40 dB in Fig. 8.4b, so fx is now the
geometric mean of 100 kHz and 1 MHz, or fx ∼=

105 × 106 = 316 kHz, and
a( j fx) is the arithmetic mean of −145◦and −180◦, or about −162.5◦, so φm ∼=
180◦−162.5◦= 17.5◦. With a reduced phase margin, both peaking and ringing
are more pronounced. In fact we now have |D( j f x)| = 1/√2(1 −cos 17.5◦) =
3.287, so Eq. (8.1) predicts |A( j f x)| ∼= 102 × 3.28, or almost 3.3 × Aideal!
Figure 8.6c shows the response to an input step of β V (= 10 mV). Once we step
the input back to zero, vO(t) will decay with quite a bit of ringing. We conclude
that a circuit with φm = 17.5◦, though still stable, is likely to be unacceptable in
most applications because of excessive peaking and ringing.
• Cursor measurements on the PSpice plots of Fig. 8.4a give f−180◦= 1.006 MHz,
where |a( j f −180◦)| = 9.802 V/V, so if we let β = 1/9.802 = 1.02 × 10−1, we
get fx = 1.006 MHz and a( j fx) = −180◦, or φm = 0◦. Consequently, |D( j f x)|
shoots up to inﬁnity, indicating oscillatory behavior. This is conﬁrmed by Fig. 8.6d,
showing the response to a 100-mV input step.
• Raising β to 2 × 10−1 lowers the 1/β line further, pushing fx into a region of
additional phase shift and thus φm < 0◦. All it takes now is internal noise to trigger
a growing oscillation. Using an input step of just 1 nV to simulate noise, we obtain
the response of Fig. 8.6e.
It is instructive to visualize circuit behavior also in terms of its poles in the
complex plane. Letting j f →(s/2π) in Eq. (8.7), substituting into Eq. (8.2) and
then into Eq. (8.1), we get, after minor algebra,
A(s) =
105
β105 +

1 +
s
2π103
 
1 +
s
2π105
 
1 +
s
2π107

The roots of the denominator are the poles of A(s). Using a scientiﬁc calculator or
similar, we ﬁnd the poles of Table 8.1. These data are best visualized in the s-plane
as shown (not to scale) at the right side of Fig. 8.6. Starting out with no feedback
(β = 0) and gradually increasing β brings the two lowest poles closer together,
until they become coincident and then split apart to become complex conjugate and
move toward the imaginary axis. Once on the imaginary axis, they result in sustained
TABLE 8.1
Closed-loop poles for the circuit of Fig. 8.3
β
p1(s−1)
p2(s−1)
p3(s−1)
0
2π(−1.0 k)
2π(−100 k)
2π(−10 M)
10−4
2π(−12.4 k)
2π(−88.5 k)
2π(−10 M)
10−3
2π(−50 k + j87.2 k)
2π(−50 k −j87.2 k)
2π(−10 M)
10−2
2π(−45.4 k + j313 k)
2π(−45.4 k −j313 k)
2π(−10.01 M)
1.02 × 10−1
2π(0 + j1.0 M)
2π(0 −j1.0 M)
2π(−10.1 M)
2 × 10−1
2π(46.7 k + j1.34 M)
2π(46.7 k −j1.34 M)
2π(−10.2 M)

379
SECTION 8.1
The Stability
Problem
oscillation; once they spill into the right half of the complex plane, they result in a
growing oscillation.
Looking at Fig. 8.5, we observe that if we can tolerate the amount of peaking
that comes with, say, φm = 45◦, then we must restrict operation to 1/β ≥103 V/V.
What if we want to operate the ampliﬁer at lower gains, such as 1/β = 50 V/V or
1/β = 2 V/V? As is, the circuit will just oscillate with these βs! Mercifully, clever
frequency-compensation techniques have been developed that allow us to stabilize
an ampliﬁer for virtually any gain we wish, including what by now we recognize as
the most difﬁcult conﬁguration to stabilize, namely, the voltage follower, for which
β = 1.
EXAMPLE 8.1. (a) What is the minimum allowable noise gain 1/β if we want to operate
the ampliﬁer of Fig. 8.3 with a phase margin of 60◦? (b) Find |D( j f x)| and comment.
(c) Verify with PSpice.
Solution.
(a) By Eq. (8.5) we have T ( j fx) = φm −180◦= 60◦−180◦= −120◦. A look at
Fig. 8.4a indicates that f−120◦is about an octave below 100 kHz. Start out with
the initial estimate f−120◦= 50 kHz and iterate using Eq. (8.8b) until you settle at
f−120◦= 59.2 kHz. Next, use Eq. (8.8a) to ﬁnd that |a( j f −120◦)| ∼= 1, 453 V/V.
This is the minimum value of 1/β for φm ≥60◦with this particular ampliﬁer.
(b) Proceeding in the usual manner, we get
|D( j fx)| ∼=
1
√2 (1 −cos 60◦) = 1
Since at dc we have T0 = 105/1, 453 = 68.8, it follows that D0 = 1/(1+1/68.8) =
0.986 < |D( j f x)|, indicating a very small amount of peaking.
(c) Using the circuit of Fig. 8.3 with β = 1/1, 453 = 0.688×10−3 V/V we get the plots
of Fig. 8.7. It is fair to say that, aside from a slight amount of peaking and ringing,
which is acceptable in many applications, the condition φm = 60◦is almost as good
as φm = 90◦in terms of stability, yet it expands the range of possible closed-loop
gains by decreasing the lower limit of acceptable values for 1/β from 104 V/V to
1,453 V/V, or by almost 17 dB.
103
104
105
106
10
102
103
0
10
20
Time (µs)
Frequency f (Hz)
(b)
(a)
Gain (V/V)
vO (V)
30
40
50
0
0.4
0.8
1.2
FIGURE 8.7
(a) Frequency and (b) step responses for the special case φm = 60◦.

380
CHAPTER 8
Stability
Peaking and Ringing as Functions of the Phase Margin φm
Peaking in the frequency domain and ringing in the time domain are quantiﬁed,
respectively, via the gain peaking GP, in dB, and the overshoot OS, in percentage, in
the manner depicted in Fig. 8.8. Both effects are absent in ﬁrst-order systems since
it takes a complex pole pair to produce them. For a second-order all-pole system,
peaking occurs for Q > 1/
√
2, and ringing for ζ < 1, where the quality factor Q and
the damping ratio ζ are related as Q = 1/2ζ, or ζ = 1/(2Q). Second-order all-pole
systems are well documented in the literature,3 where it is found that
GP = 20 log10
2Q2

4Q2 −1
for Q > 1/
√
2
(8.10)
OS (%) = 100 exp
−πζ

1 −ζ 2
for ζ < 1
(8.11)
φm = cos−1

4ζ 4 + 1 −2ζ 2

= cos−1

1 +
1
4Q4 −
1
2Q2

(8.12)
Combining these equations yields the graphs of Fig. 8.9, which relate peaking and
ringing to the phase margin. We observe that peaking occurs for φm ≤cos−1(
√
2 −
1) = 65.5◦, and ringing for φm ≤cos−1(
√
5 −2) = 76.3◦. It is also worth keeping
in mind the following frequently encountered values of GP (φm) and OS (φm):
GP (60◦) ∼= 0.3 dB
OS (60◦) ∼= 8.8%
GP (45◦) ∼= 2.4 dB
OS (45◦) ∼= 23%
Depending on the case, a closed-loop response may have a single pole, a pole
pair, or a higher number of poles. Mercifully, the response of higher-order circuits
is often dominated by a single pole pair, so the graphs of Fig. 8.9 provide a good
starting point for a great many circuits of practical interest.
The Rate of Closure (ROC)
In everyday’s practice an engineer must be able to quickly assess the degree of
stability of a circuit. A popular tool for circuits with poles (and possibly zeros) in
0
–20
f  (dec)
GP
OS
Normalized 
freq. response (dB)
(a)
0
1
t (lin)
Normalized 
step response (V)
(b)
FIGURE 8.8
Illustrating gain peaking GP and overshoot OS.

381
SECTION 8.1
The Stability
Problem
0
0
4
8
12
16
20
24
28
Gain peaking (dB)
32
36
40
8
16
24
32
(a)
Phase margin (degrees)
40
48
56
64
0
0
10
20
30
40
50
60
70
Overshoot (%)
80
90
100
8
16
24
32
(b)
Phase margin (degrees)
40
48
56
64
FIGURE 8.9
GP and OS as functions of φm for a second-order all-pole system.
the left-half of the complex plane (such circuits are referred to as minimum-phase
circuits) is offered by the rate of closure (ROC), representing the difference between
the slopes of the |1/β| and |a| curves right at the crossover frequency,
ROC = Slope of

1
β( j fx)
 −Slope of |a( j fx)|
(8.13)
Once we know the ROC, we use Eq. (8.9) to estimate the phase margin as
φm(in degrees) ∼= 180◦−4.5 × ROC (in dB/dec)
(8.14)
Let us illustrate via the typical cases depicted in Fig. 8.10.
a0
0
dB
f 
|1/7|
|1/6|
|1/5|
|1/4|
|1/3|
|1/2|
|1/1|
f1
f2
f3
|a|
m1 ≅ 45°
m2 ≅ 0°
m3 ≅ 45°
m4 ≅ 90°
m6 ≅ 90°
m5 ≅ 45°
m7 ≅ 0°
FIGURE 8.10
Rate of closure (ROC) for different feedback-factor types.

382
CHAPTER 8
Stability
The |1/β4|, |1/β5|, and |1/β7| curves are ﬂat, indicating frequency-independent
feedback of the types already seen in connection with Fig. 8.5. Thus, for |1/β4|,
Eq. (8.13) gives ROC4 = 0 −(−20) = 20 dB/dec, so φm4 ∼= 180 −4.5 × 20 =
90◦. Likewise, for |1/β5| we have ROC5 = 0 −(−30) = 30 dB/dec, so φm5 ∼=
180 −4.5 × 30 = 45◦; for |1/β7| we have ROC7 = 0 −(−40) = 40 dB/dec, so
φm7 ∼= 180 −4.5 × 40 = 0◦.
The |1/β1| and |1/β2| curves refer to the case of a zero frequency for 1/β,
and thus a pole frequency for β. A pole inside the loop introduces phase lag, thus
eroding the phase margin. In fact, the |1/β2| curve has ROC2 = +20 −(−20) =
40 dB/dec, so φm2 ∼= 180 −4.5 × 40 = 0◦. The phase margin is higher for the
|1/β1| curve, whose break point was made to coincide with the crossover frequency
so that ROC1 = 10 −(−20) = 30 dB/dec, thus resulting in φm1 ∼= 45◦.
The |1/β6| curve exhibits a pole frequency, or a zero frequency for β6. A left-
plane zero inside the loop introduces phase lead, thus ameliorating φm. In fact,
ROC6 = −20 −(−40) = 20 dB/dec, so φm6 ∼= 90◦. (In this circuit β6 is more
stable than β7, even though fx6 > fx7!). It pays to regard ROC as the angle between
the |1/β| and |a| curves at fx. The lower this angle, the more stable the circuit.
8.2
PHASE AND GAIN MARGIN MEASUREMENTS
In the course of designing a negative-feedback circuit, we need to monitor its phase
margin φm to ensure that the stability speciﬁcations are met (if they aren’t, we need to
take suitable frequency-compensation measures). As an example, let us investigate
the circuit of Fig. 8.11, consisting of an inverting ampliﬁer driving a capacitive load
RL-CL, and inclusive also of the inverting-input stray capacitance Cn. Each of CL
and Cn creates a pole within the loop, so we expect a two-fold erosion of the phase
margin.
Return-Ratio Analysis
If the op amp lends itself to be modeled via its Thevenin or Norton equivalent, we use
return-ratio analysis to plot T ( j f ). Next, we ﬁnd fx, measure T ( j fx), and ﬁnally
let φm = 180◦+ T ( j fx). Alternatively, we ﬁnd f−180◦, measure |T ( j f −180◦)|,
and let GM = −20 log |T ( j f −180◦)|.
+
–
–
R2
R1
Cn
Vi
Vo
RL
CL
+
FIGURE 8.11
Anillustrativecircuitexampleforstabilityevaluation.

383
SECTION 8.2
Phase and Gain
Margin
Measurements
EXAMPLE 8.2. LettheopampofFig.8.11havea0 = 105 V/V,rd = 1M,ro = 100 ,
and two pole frequencies of 10 Hz and 2 MHz. (a) Use PSpice to ﬁnd φm and GM if
R2 = 2R1 = 100 k, RL = 2 k, Cn = 3 pF, and CL = 1 nF. (b) What is the phase-
margin erosion due to Cn? That due to CL? (c) What is φm if Cn = CL = 0? Comment
on your ﬁndings.
Solution.
(a) As shown in Fig. 8.12a, we model the open-loop response with a dependent source
of the Laplace type. Next, we set the input to zero, we break the loop right at the
Laplace source’s output to inject a test voltage Vt downstream of the source, we ﬁnd
the voltage Vr returned by the source, and we let T ( j f ) = −Vr/Vt. The resulting
magnitude and phase plots are shown in Fig. 8.12b. Using PSpice’s cursor facility,
we ﬁnd fx = 276.4 kHz and T ( j fx) = −125.3◦, so φm = 180 −125.3 = 54.7◦.
Also, f−180◦= 792 kHz and |T ( j f −180◦)| = −12.7 dB, so GM = 12.7 dB.
(b) Rerunning with Cn = 0, we get fx = 290.1 kHz and T ( j fx) = −108.1◦, so
φm = 180−108.1 = 71.9◦. The presence of Cn erodes φm by 71.9−54.7 = 17.2◦.
Rerunning with Cn = 3 pF and CL = 0 gives fx = 279.8 kHz and  T ( j fx) =
−116.2◦, or φm = 180 −116.2 = 63.8◦, so the phase erosion by CL is 63.8 −
54.7 = 9.1◦.
(c) Rerunning with Cn = CL = 0, we get fx = 294.3 kHz and T ( j fx) = −98.4◦, so
φm = 81.6◦. In this case the 1/|β| curve is ﬂat and T ( j fx) consists of −90◦due to
the 10-Hz op amp pole, and −8.4◦due to the 2-MHz pole. Clearly, the presence of
Cn and CL results in a pole-frequency pair for β, or a zero-frequency pair for 1/β,
causing a high-frequency two-fold upward bend for the 1/|β| curve (see Fig. 8.12b).
This increases the ROC, in turn reducing φm.
Double-Injection Techniques
Return-ratio analysis postulates a dependent-source model for the op amp. If the
op amp is available in transistor-level or in macromodel-level form, we do not have
access to such a source, so we must use other means to measure φm. An elegant
(b)
<) T
Frequency f (Hz)
Gain (dB)
102
103
104
105
106
107
1
10
−40
−20
0
20
40
60
80
100
Phase
0°
−120°
−90°
−60°
−30°
|a|
|1/|
|T|
LAPLACE {v(0,N)} = {100k/((1+s/62.832)*(1+s/1.257E7))}
(a)
IN+
IN−
OUT+
OUT−
EOA
0
0
0
Vr
R
T
N
200 kΩ
100 kΩ
R2
R1
rd
1 MΩ
Cn
3 pF
100 Ω
ro
RL
2 kΩ
Vt
CL
1 nF
+
–
0
FIGURE 8.12
(a) PSpice circuit to ﬁnd the loop gain T ( j f ) via return-ratio analysis, and (b) Bode plots. The |a| trace
is plotted as DB(V(R)/(-V(N))), the |1/β| trace as DB(V(T)/V(N)), the |T | trace as DB(-V(R)/V(T)),
and the T trace as P(-V(R)/V(T)).

384
CHAPTER 8
Stability
(a)
(b)
Feedback loop
vt
vr
vf
+
–
+
+
−
−
Feedback loop
it
if
ir
FIGURE 8.13
Illustrating (a) voltage injection and (b) current injection.
alternative for ﬁnding T ( j f ), which is suited both to SPICE simulation and to
testing in the lab, is the successive voltage and current injection technique devised
by R. D. Middlebrook4 and depicted in Fig. 8.13. The steps are as follows: First,
set all external signal sources to zero so as to put the circuit in its dormant state.
Next, break the feedback loop and insert a series test-source vt as in Fig. 8.13a.
The perturbation introduced by vt causes a signal v f to propagate in the forward
direction, to which the loop responds with a return signal vr. Let
Tv = −vr
v f
(8.15a)
Next, remove the test source vt and apply, between the same set of wires, a shunt test
source it as shown in Fig. 8.13b. The perturbation introduced by it causes a signal
i f to propagate in the forward direction, to which the loop responds with a return
signal ir. Let
Ti = −ir
i f
(8.15b)
It has been proved4 that the loop gain T is such that
1
1 + T =
1
1 + Tv
+
1
1 + Ti
(8.16)
Solving for T we get
T =
TvTi −1
Tv + Ti + 2
(8.17a)
Alternatively, using Eqs. (8.15), we have
T = (vr/v f ) × (ir/i f ) −1
2 −vr/v f −ir/i f
(8.17b)
EXAMPLE 8.3.
Suppose the circuit of Example 8.2 is implemented with a 741 op amp
powered from ±10-V supplies. Find the phase margin using PSpice’s 741 macromodel.
Solution.
Lacking a dependent-source model for the op amp, we cannot use return-
ratio analysis. Rather, we use the successive-injection test circuits of Fig. 8.14, and
obtain the plots of Fig. 8.15. It is interesting to observe the way Tv and Ti contribute to
the makeup of T . Using PSpice’s cursor facility, we readily ﬁnd fx = 283.6 kHz and
T ( j fx) = −122.7◦, so φm = 180◦−122.7◦= 57.3◦.

385
SECTION 8.2
Phase and Gain
Margin
Measurements
(a)
+
Vf
Vr
R
F
R2
200 kΩ
R1
100 kΩ
RL
2 kΩ
CL
1 nF
2
3
4
6
1 mVac
7
0
µA741
–
VCC (10 V)
VEE (−10 V)
0
0
0
Cn
3 pF
Vt
–
+
(b)
+
If
Ir
It
VR (0 V)
VF (0 V)
R2
200 kΩ
R1
100 kΩ
RL
2 kΩ
CL
1 nF
2
3
4
6
1 nAac
7
0
µA741
–
+
–
+
–
VCC (10 V)
VEE (−10 V)
0
0
0
0
Cn
3 pF
FIGURE 8.14
Finding the loop gain of the circuit of Example 8.3 via (a) voltage and (b) current injections.
Remark. One might be tempted to break the loop right at the op amp’s output lead
(pin #6) and use return-ratio analysis instead of double injections. This would be wrong
because the test source would be driving CL directly, thus preventing it from forming
a pole with the op amp’s internal resistance ro. There is no question that the injection
method is mandatory for this circuit!
Single-Injection Approximations
Since the loop gain T ( j f ) is an intrinsic circuit characteristic, it must be independent
of where we break the loop for our injections. If we break the loop of Fig. 8.14 at a
different point, we will get the same curves for T , though those for Tv and Ti will
generally vary with the point of injection. We wonder whether one injection point
<) T
Frequency f (Hz)
Gain (dB)
102
103
104
105
106
107
1
10
−40
−20
0
20
40
60
80
100
Phase
0°
−120°
−150°
−90°
−60°
−30°
|Ti|
|Tv|
|T|
FIGURE 8.15
Bode plots for the circuit of Example 8.3. The |Tv| and |Ti|
traces are plotted as DB(-V(R)/V(F)) and as DB(-I(VR)/
I(VF)), the |T | and T trace are plotted as DB((V(R)*I(VR)-
V(F)*I(VF))/(2*V(F)*I(VF)-V(R)*I(VF)-V(F)*I(VR)))
and as P((V(R)*I(VR)-V(F)*I(VF))/(2*V(F)*I(VF)-V(R)
*I(VF)-V(F)*I(VR))).

386
CHAPTER 8
Stability
(a)
Feedback loop
Zr
Zf
(b)
+
Vr
R
R1
100 kΩ
R2
200 kΩ
RL
2 kΩ
CL
1 nF
2
3
4
6
7
0
µA741
–
VCC (10 V)
VEE (−10 V)
0
0
0
Cn
3 pF
Vt
–
+
Vf
F
FIGURE 8.16
(a) The impedances Z f and Zr seen looking in the forward and return directions.
(b) Single-injection approximation for the circuit of Example 8.3.
is preferable to another, and why. The answer is provided by the fact that the terms
involving Tv and Ti satisfy the condition4
1 + Tv
1 + Ti
= Zr
Z f
(8.18)
where Z f and Zr are the impedances seen looking in the forward and in the return
directions relative to the point of signal injection (see Fig. 8.16a). According to
Eq. (8.16) the terms (1 + Tv) and (1 + Ti) combine in the guise of resitances in
parallel, so if one happens to be much larger than the other, the smaller will prevail
and we can estimate T more quickly by limiting ourselves to just one signal injection,
namely, the one resulting in the smaller of the two terms. Sure enough, if we break the
loop of the circuit of Example 8.3 just upstream of R2, where the condition Z f ≫Zr
holds, we have (1 + Tv) ≪(1 + Ti), so we can use only a voltage injection and
approximate T ∼= Tv = −Vr/V f . Indeed, running the PSpice circuit of Fig. 8.16b
gives again fx = 283.6 kHz and φm = 57.3◦, but via a single injection!
Feedthrough Considerations
To facilitate our introduction to stability, we have deliberately ignored the possibility
of direct signal transmission from input to output, bypassing the loop. For a more
accurate investigation we must refer to the more general block of Fig. 1.37, whose
gain is, by Eq. (1.72),
A =
Aideal
1 + 1/T +
aft
1 + T
where aft is the feedthrough gain, which coincides with the value of A in the limit
a →∞. Using Eq. (8.1), we manipulate A into the insightful form
A( j f ) = AidealDeff( j f )
(8.19a)

387
SECTION 8.2
Phase and Gain
Margin
Measurements
where the effective discrepancy function
Deff( j f ) = D( j f )

1 +
aft( j f )
T ( j f )Aideal

(8.19b)
represents a reﬁnement of D( j f ) to account for feedthrough. As seen in the various
examples of Chapter 1, if T ( j f ) is sufﬁciently large to make |T ( j f )Aideal| ≫
|a f t( j f )|, the effect of feedthrough is negligible.5 However, this may no longer be
the case in the vicinity of the crossover frequency fx, where T ( j f x) drops to unity.
As an example, consider the I-V converter of Fig. 8.17, based on an op amp
whose poles and dc gain have been adjusted for φm = 67.4◦, a slightly higher
margin than that marking the onset of peaking, which is cos−1 √
2 −1

= 65.5◦.
Yet, the actual plot of |A| reveals peaking even though loop-gain analysis predicts
none. Evidently, signal feedthrough bolsters Vo in the vicinity of fx in a way not
accounted for by loop analysis alone. (The culprit in this particular example is the
relatively high value of ro compared to R, so chosen in order to cause substantial
feedthrough. Feedthrough is evidenced also by the initial jump of −4 V of the
transient response, occurring before the op amp starts to react.)
The interested reader is encouraged to consult the literature6,7 for computer
simulation techniques offering information about the closed-loop gain also in the
presence of substantial feedthrough. Here, we take the viewpoint of using loop-
gain analysis to come up with an initial stability estimate, and then ﬁne-tuning the
component values when testing the ﬁnal circuit in the lab.
(a)
Time (µs)
vO (V)
1
1.5
2
0
−4
0
5
10
0.5
vO
(b)
Frequency f (Hz)
Gain (V/mA)
103
106
1
4
10
<) T
|A|
Gain (dB)
103
106
1
−50
100
50
0
|T|
Phase
0°
−120°
−150°
−90°
−60°
−30°
IN+
IN−
OUT+
OUT−
EOA
4 kΩ
LAPLACE {v(0,N)} = {100k/((1+s/63)*(1+s/14E7))}
0
0
0
ro
Vo
Ii
10 kΩ
R
N
FIGURE 8.17
(a) PSpice I-V converter (top), and transient response to a 1-mA step (bottom). (b) Loop gain
T (top), and closed-loop gain A = Vo/Ii (bottom).

388
CHAPTER 8
Stability
8.3
FREQUENCY COMPENSATION OF OP AMPS
As a signal travels around a feedback loop, it experiences a variety of delays, ﬁrst
in propagating through the transistors of the op amp, then through the reactive
elements (parasitic as well as intentional, if any) of the surrounding circuitry. If
the cumulative delay is such that T ( j fx) ≤−180◦, the circuit will oscillate, so
we need to modify T ( j f ) to guarantee an adequate phase margin φm, a modiﬁcation
known as frequency compensation. Since T = aβ, frequency compensation requires
that we modify a( j f ), or β( j f ), or both.
We begin by investigating how to modify a( j f ) for the case of frequency-
independent feedback. Although this is usually the task of the IC designer, the
user needs to be familiar with the various compensation schemes in use as they
may inﬂuence the choice of the device for a given application. Typically, the IC
designer strives to guarantee a given φm for the hardest-to-compensate conﬁguration,
namely, the voltage-follower, for which β = 1. In this particular case we have
T ( j f ) = a( j f ) × 1 = a( j f ), that is, T ( j f ) coincides with a( j f ). As a vehicle, let
us use the generalized op amp model of Fig. 8.18, consisting of two transconductance
stages with dc gains a10 = −g1R1 and a20 = −g2R2, followed by a unity-gain
voltage stage, so the overall dc gain is a0 = a10a201. The three R-C networks
establish three pole frequencies at fk = 1/(2π RkCk), k = 1, 2, and 3. With the
component values shown, we have
a0 = (−200)(−500)1 = 105 V/V
f1 = 1 kHz
f2 = 100 kHz
f3 = 10 MHz
(These parameters have deliberately been chosen to match those of Fig. 8.4, so we
can recycle already familiar knowledge.)
Dominant-Pole Compensation
A popular compensation technique involves lowering the ﬁrst pole frequency f1 to
a new value f1(new) such that the compensated response is dominated by this lone
pole all the way up to the crossover frequency, which for β = 1 is the transition
frequency ft. We can then write T ( j ft) = −90◦+ φt(HOR), where −90◦is the
phase shift due to f1(new), and φt(HOR) is the combined phase shift due to the higher-
order roots (poles and possibly zeros) at ft. (For instance, the circuit of Example 8.3
has φt(HOR) = 90 −122.7 = −32.7◦.) The phase margin after compensation is
Vo
0
R1
10 MΩ
C1
15.9 pF
20 µA/V
g1
+
–
Vi
5 mA/V
g2
+
–
+
–
R2
100 kΩ
1.0 kΩ
C3
15.9 pF
C2
15.9 pF
1 V/V
e3
R3
+
–
+
–
FIGURE 8.18
Generalized three-pole op amp model for the investigation of frequency compensation.

389
SECTION 8.3
Frequency
Compensation of
Op Amps
φm = 180◦+ T ( j ft) = 180◦−90◦+ φt(HOR), that is,
φm = 90◦+ φt(HOR)
(8.20)
By making f1(new) sufﬁciently low, we can keep φt(HOR) as small as needed. For
instance, for φm = 60◦we need φx(HOR) = −30◦.
A simple way to lower f1 is to deliberately increase the capacitance at the node
responsible for f1 itself. In the three-pole ampliﬁer of Fig. 8.18 we simply add a
shunt capacitance Cc in parallel with C1 to lower the ﬁrst pole frequency from
f1 = 1/(2π R1C1) to
f1(new) =
1
2π R1(C1 + Cc)
(8.21)
To estimate the required value of f1(new), note that a dominant-pole response exhibits
a constant gain-band width product, GBP = a0 × f1(new) = 1 × ft. So, we ﬁrst
select ft on the basis of the desired phase margin, then we estimate the dominant
pole frequency as
f1(new) = ft
a0
(8.22a)
Finally, we substitute into Eq. (8.21) and solve for the desired Cc.
EXAMPLE 8.4. (a) Find the capacitance Cc that, placed in parallel with C1 in Fig. 8.18,
will ensure φm ∼= 45◦for operation with β = 1. (b) Verify with PSpice and comment
on your results. (c) Repeat, but for φm ∼= 60◦.
Solution.
(a) For φm ∼= 45◦we need to impose ft = f−135◦. Inspection of Fig. 8.4 reveals that
f−135◦= f2 = 100 kHz, so Eq. (8.22a) gives f1(new) = 105/105 = 1 Hz. Plugging
into Eq. (8.21) we get
1 =
1
2π107(15.9 × 10−12 + Cc)
whose solution is Cc = 999C1 ∼= 15.9 nF (≫C1).
(b) Using the PSpice circuit of Fig. 8.19, we generate the plots of Fig. 8.20. Cursor
measurements give ft = 78.6 kHz anda( j ft) = −128.6◦, so φm = 180−128.6 =
51.4◦, in fair agreement with the target values of ft = 100 kHz and φm = 45◦. We
note that ft is much lower than the crossover frequency of the uncompensated
response, which is near 3 MHz. However, Fig. 8.4 reveals that the phase shift there
is about −195◦, indicating that with β = 1 the circuit would be unstable. Evidently,
the drastic bandwidth reduction is the price we are paying for the sake of stability!
Vo
0
R1
10 MΩ
C1
15.9 pF
20 µA/V
g1
+
–
Vi
5 mA/V
g2
+
–
+
–
R2
100 kΩ
1.0 kΩ
C3
15.9 pF
C2
15.9 pF
1 V/V
e3
R3
+
–
+
–
Cc
15.9 nF
FIGURE 8.19
Dominant-pole compensation for φm ≅45◦with β = 1 using shunt capacitance Cc.

390
CHAPTER 8
Stability
<) a
<) auc
Frequency f (Hz)
Gain (dB)
102
103
104
105
106
107
0.1
1
−40
−20
0
20
40
60
80
100
10
Phase
0°
−120°
−150°
−90°
−60°
−30°
|auc|
|a|
FIGURE 8.20
Compensated (a) and uncompensated (auc) responses of the
circuit of Fig. 8.19.
(c) For φm = 60◦we need to impose ft = f−120◦(= 59.2 kHz, as per Example 8.1).
Recalculating as above we now get the more conservative values f1(new)= 0.592 Hz
and Cc ∼= 26.9 nF. Rerunning PSpice with this new value of Cc gives ft = 52.4 kHz
and a( j ft) = −118◦, so now φm= 62◦.
EXAMPLE 8.5.
Find the capacitance Cc that, placed in parallel with C1 in Fig. 8.18,
will ensure φm ∼= 60◦for operation with β = 0.1. Hence, use PSpice to plot both the
open-loop and the closed-loop gains.
Solution.
So long as β is frequency independent, T ( j f ) will have the same poles as
a( j f ). However, we now have GBP = a0× f1(new) = (1/β)× fx, so Eq. (8.22a) changes
as
f1(new) =
fx
βa0
(8.22b)
For φm = 60◦we get f1(new) = (59.2 × 103)/(0.1 × 105) = 5.92 Hz. Plugging into
Eq. (8.21) gives Cc ∼= 2.67 nF. Using the PSpice circuit of Fig. 8.21, we generate the
plots of Fig. 8.22, where we visualize the loop gain |T | as the difference between the |a|
and 1/β curves. Using the cursor, we ﬁnd that the two curves intersect at fx = 52.5 kHz,
Vo
0
0
0
R1
10 MΩ
Cc
2.67 nF
C1
15.9 pF
20 µA/V
g1
+
–
Vi
5 mA/V
g2
+
–
+
–
R2
100 kΩ
1.0 kΩ
C3
15.9 pF
C2
15.9 pF
1 V/V
e3
R3
+
–
 = 0.1
E
+
–
+
–
+
–
FIGURE 8.21
Compensating the ampliﬁer of Fig. 8.18 for φm = 60◦with β = 0.1 V/V.

391
SECTION 8.3
Frequency
Compensation of
Op Amps
Frequency f (Hz)
Gain (dB)
102
103
104
105
106
1/
107
1
−40
−20
20
40
60
80
100
10
|auc|
|A|
|a|
FIGURE 8.22
Open-loop a, closed-loop A, and uncompensated auc
gains of the circuit of Fig. 8.21.
where a( j fx) = −118◦, so φm = 62◦(note the slight peaking, in accordance with
Fig. 8.7). We observe that as we increase 1/β, compensation becomes less conservative.
The reader may wish to verify that without Cc, the circuit would be close to oscillatory,
as indicated by Figs. 8.5 and 8.6.
It must be pointed out that the model of Fig. 8.18 is based on stages that are
isolated from each other, so changing the capacitance of one stage does not affect the
other stages. In an actual ampliﬁer, adding capacitance to change one pole is likely
to have some effect also on the other poles, so the compensation schemes based on
the above model provide just a starting point. To meet the desired φm, we may have
to do some tweaking, a task greatly facilitated by the visual feedback attainable via
PSpice.
Pole-Zero Compensation
It is possible to increase the GBP by the mere artiﬁce of inserting a suitable resistance
Rc(≪R1) in series with Cc. It can be proved (see Problem 8.28) that the presence
of Rc introduces a left-half-plane zero (LHPZ), whose phase lead can be exploited
on purpose to compensate for a higher ft. A common approach is to make this zero
coincide with the existing second pole so as to achieve a pole-zero cancellation that
raises phase by about 90◦at the pole-zero itself.
Applying physical insight to Fig. P8.28, we can state the following: (a) At low
frequencies Cc’s impedance is much larger than Rc, so Rc acts as a short by compar-
ison, and Eq. (8.21) still holds. (b) As we raise f , Cc’s impedance decreases until its
magnitude equals Rc. This occurs at the frequency fz such that 1/|2π j fzCc)| = Rc,
or fz = 1/(2π RcCc). (c) For f ≫fz, Cc acts as a short compared to Rc, leaving
C1 to form an additional pole with the combination R1∥Rc(∼= Rc, since Rc ≪R1).
In summary, the presence of Rc leaves f1(new) unchanged, but introduces a zero
frequency fz as well as a new pole frequency f4,
f1(new) =
1
2π R1(C1 + Cc)
fz =
1
2π RcCc
f4 ∼=
1
2π RcC1
(8.23)

392
CHAPTER 8
Stability
EXAMPLE 8.6.
Find Rc and Cc to compensate the circuit of Fig. 8.18 for φm ∼= 45◦
with β = 1. Verify with PSpice.
Solution.
After the pole-zero cancellation, a( j f ) is left with three pole frequencies:
f1(new), f3, and f4( f4 ≫f1(new)). Let us momentarily ignore f3 and impose ft = f4 for
φm ∼= 45◦. Letting f1(new) = ft/a0 and fz = f2, we have
1
2π R1(C1 + Cc) = 1
a0
1
2π RcC1
1
2π RcCc
= f2
Plugging in the known data (R1 = 10 M, C1 = 15.9 pF, a0 = 105 V/V, and f2 =
100 kHz), we get two equations in the unknowns Rc and Cc, which we easily solve
to get Rc = 3.2 k and Cc = 496 pF. Running PSpice with these values results in
ft = 2.42 MHz and a( j ft) = −140.4◦, so φm = 39.6◦. This is less than the target
margin of 45◦because we have ignored f3. To increase φm we need to raise Cc a bit
while lowering Rc in proportion in order to maintain pole-zero cancellation. This causes
f1(new) and f4 to split a bit further apart. After a few iterations aided by visual feedback
from PSpice, we ﬁnd that raising Cc to 560 pF while reducing Rc to 2.84 k gives
ft = 2.28 MHz and a( j ft) = −135◦, so φm = 45◦. The ﬁnal circuit is shown
in Fig. 8.23, and its response in Fig. 8.24, which you can compare with Fig. 8.20 to
appreciate the wider bandwidth afforded by pole-zero cancellation.
Vo
0
R1
10 MΩ
Cc
Rc
560 pF
2.84 kΩ
C1
15.9 pF
20 µA/V
g1
+
–
Vi
5 mA/V
g2
+
–
+
–
R2
100 kΩ
1.0 kΩ
C3
15.9 pF
C2
15.9 pF
1 V/V
e3
R3
+
–
+
–
FIGURE 8.23
Pole-zero compensation for φm ≅45◦with β = 1.
<) a
Frequency f (Hz)
Gain (dB)
102
103
104
105
106
107
0.1
1
−40
−20
0
20
40
60
80
100
10
Phase
0°
−120°
−150°
−90°
−60°
−30°
|auc|
|a|
<) auc
FIGURE 8.24
Compensated (a) and uncompensated (auc) responses of the
circuit of Fig. 8.23.

393
SECTION 8.3
Frequency
Compensation of
Op Amps
Miller Compensation
Nowadays the majority of op amps come with frequency compensation on chip,
a trend pioneered by the 741 op amp in the late 1960s. The shunt and pole-zero
schemes discussed above, though pedagogically insightful, do not lend themselves
to on-chip fabrication because of the large Cc required (capacitors of more than a
few tens of picofarads would take up too much chip area). A clever way around this
limitation is to start out with a small enough capacitance Cc that can be fabricated
on chip, and then use the Miller effect to make it appear as large as needed for
dominant-pole compensation. We shall see that two additional beneﬁts accrue from
this scheme, namely, pole splitting and higher slew rates.
InordertofocusontheessentialsofMillercompensation,letusrestrictourselves
to the ﬁrst two stages, shown in Fig. 8.25. In the absence of Cc, we know that the
circuit exhibits the pole frequencies
f1 =
1
2π R1C1
f2 =
1
2π R2C2
(8.24)
With Cc in place, a detailed ac analysis (see Problem 8.31) yields
V2
Vi
= a0
1 −j f/fz
1 + j f/f1(new)
 1 + j f/f2(new)

(8.25)
where
a0 = g1R1g2R2
fz =
g2
2πCc
(8.26a)
f1(new) ∼=
f1
(g2R2Cc)/C1
f2(new) ∼=
(g2R2Cc) f2
C1 + Cc(1 + C1/C2)
(8.26b)
Since f1 gets divided and f2 gets multiplied by the common term (gm2R2Cc), the
presence of Cc lowers the ﬁrst pole and raises the second pole, a phenomenon known
as pole splitting. Depicted in Fig. 8.26 for φm ∼= 45◦, pole splitting is highly welcome
because the upshift in f2(new) eases the amount of downshift required of f1(new),
now the dominant pole, thus allowing for a wider GBP than with shunt-capacitance
compensation. Writing GBP = a0 × f1(new) and using Eqs. (8.24) and (8.26), we
have
GBP ∼=
g1
2πCc
(8.27)
C2
C1
g2V1
g1Vi 
V1 
V2 
Vi
R2
R1
+
–
Cc 
FIGURE 8.25
Two-pole ampliﬁer with Miller compensation.

394
CHAPTER 8
Stability
f1(new)
f2(new)
fz
f1
f2
Gain (dB)
a0
0
dB
f
|auc|
|a|
FIGURE 8.26
Miller compensation and pole splitting for the two-
pole ampliﬁer of Fig. 8.25.
It is instructive to manipulate the dominant pole into the alternative form
f1(new) ∼=
1
2π R1[(g2R2)Cc]
(8.28)
because it shows that thanks to the Miller effect, the (small) capacitance Cc gets
multiplied by the (large) second-stage gain (g2R2 = 500 in our example) to form,
with R1, the (low-frequency) dominant pole. Yet, during large transients, it is Cc (not
the multiplied Cc!) that is responsible for the slew rate, as already seen in Eq. (6.33)
for the 741 op amp.
We observe that Miller compensation, besides relocating the pole pair, es-
tablishes also a right-half-plane (RHP) zero, which produces phase lag, possibly
eroding the phase margin. Physically, when the current injected into node V2 via
Cc equals that removed by the g2V1 source, R2 is left with no current, so V2
goes to zero, as shown in Fig. 8.27a. This occurs at the frequency fz such that
(V1 −0)/|1/(2π j fzCc)| = g2V1, that is, for fz as given in Eq. (8.26a). For f > fz,
the incoming current via Cc prevails over that removed by the g2V1 source, resulting
in polarity reversal, so feedback turns from negative to positive.
g2V1
V1 
V2 (= 0)
(a)
Cc 
g2V1
V1 
V2 (= 0)
(b)
Cc 
Rc 
FIGURE 8.27
Partial circuits to visualize (a) the formation of the RHP
zero, and (b) zero control via Rc.

395
SECTION 8.3
Frequency
Compensation of
Op Amps
Vo
Cc
0
R1
10 MΩ
C1
15.9 pF
20 µA/V
g1
+
–
Vi
5 mA/V
2.9 pF
g2
+
–
+
–
+
–
R2
100 kΩ
1.0 kΩ
C3
15.9 pF
C2
15.9 pF
1 V/V
e3
R3
+
–
FIGURE 8.28
Miller compensation for φm ≅75◦with β = 1.
EXAMPLE 8.7.
Find Cc to Miller-compensate the circuit of Fig. 8.18 for φm ∼= 75◦
with β = 1. Verify with PSpice.
Solution.
By Eq. (8.20) we need φt(HOR) = −15◦. Assume for a moment that φt(HOR)
is due exclusively to f2(new). Then, ft must be such that −15◦= −tan−1( ft/f2(new)), or
ft = 0.268 f2(new). Imposing f1(new) = ft/a0 gives
f1
(g2R2Cc)/C1
= 0.268
105
(g2R2Cc) f2
C1 + Cc(1 + C1/C2)
Plugging the known data and solving gives Cc = 2.2 pF. Running the PSpice circuit of
Fig. 8.18 with Cc = 2.2 pF gives φm = 68◦, so we need to increase Cc a bit because
of the phase lag by the higher-order roots. Empirically we ﬁnd that Cc = 2.9 pF gives
ft = 1.06 MHz and φm = 74.8◦. The ﬁnal circuit, shown in Fig. 8.28, gives the response
in Fig. 8.29 (note that because of the −90◦shift by the RHP zero, the high-frequency
asymptote of phase changes from −270◦to −360◦).
RHP Zero Control
The RHP zero frequency in Example 8.7 is fz = 5 × 10−3/(2π × 2.9 × 10−12) =
274 MHz, so much higher than ft that its effect on φm is immaterial. This, however,
<) a
Frequency f (Hz)
Gain (dB)
103 104 105 106
108
107
1010
109
1
10
−150
−100
−50
0
50
100
102
Phase
0°
−270°
−360°
−180°
−90°
|auc|
|a|
<) auc
FIGURE 8.29
Compensated (a) and uncompensated (auc) responses of the
circuit of Fig. 8.28.

396
CHAPTER 8
Stability
is not always the case (the two-stage CMOS op amp is a notorious example in which
the RHP zero does matter8,9). To investigate further, use Eq. (8.26) to express fz in
the alternative form
fz ∼= g2
g1
GBP
(8.29)
where GBP = a0 × f1(new). So long as g2 ≫g1, we have fz ≫GBP, so ft ∼= GBP
and fz has negligible effect. Not so if g2 is close to, or even less than g1, for then
we have a two-fold reduction in φm, ﬁrst because the +20-dB slope change due to
fz raises ft, second because of the phase lag due to fz itself.
A clever way around this drawback is to insert a suitable resistance Rc in se-
ries with Cc, as shown in Fig. 8.27b. At low frequencies, where Cc’s impedance is
much larger than Rc, we can regard Rc as a short by comparison, so Eq. (8.26b)
still holds for the pole pair. However, the presence of Rc changes the location
of the transmission zero, now occurring at the complex frequency sz such that
(V1 −0)/[1/(szCc) + Rc] = g2V1. Solving, we get the s-plane zero
sz =
1
(1/g2 −Rc) Cc
(8.30a)
so the zero frequency in the numerator of Eq. (8.25) takes on the modiﬁed form
fz(new) =
1
2π(1/g2 −Rc)Cc
(8.30b)
The presence of Rc (0 < Rc < 1/g2) reduces the denominator, raising fz(new) and
pushing the phase lag away from fx. For Rc = 1/g2 we have fz(new) →∞, so the
numerator of Eq. (8.25) becomes unity. Raising Rc further (Rc > 1/g2) changes the
polarity of fz(new), resulting in a left-half-plane (LHP) zero. This is highly desirable
because it produces phase lead (as opposed to phase lag by an RHP zero), thus
boosting φm.
EXAMPLE 8.8.
(a) Use PSpice to ﬁnd the phase margin of the two-stage op amp of
Fig. 8.30 in the absence of compensation, and comment. (b) Show how to calculate the
values of Cc and Rc given in the ﬁgure, and use PSpice to measure the actual values of
ft and φm. (c) Discuss the effect of letting Rc = 0, and verify with PSpice. (d) How
would you change Rc to raise φm to 60◦?
Solution.
(a) Running PSpice without the Cc-Rc network we ﬁnd ft = 223 MHz and a( j ft) =
−177◦, so φm = 3◦, indicating a circuit in dire need of compensation.
(b) By inspection, a0 = (−100) × (−50) = 5, 000 V/V, f1 = 1 MHz, and f2 =
10 MHz. To achieve fz(new) →∞, impose Rc = 1/g2 = 1/10−3 = 1 k. Then,
for φm ∼= 45◦impose ft = f2(new). Plugging the data into Eq. (8.26b), and then
into Eq. (8.22a), and solving, we get Cc = 2.144 pF. Running PSpice with the
Cc-Rc network shown in Fig. 8.30, we get the response of Fig. 8.31, for which
ft = 58.7 MHz and a( j ft) = −129.4◦, so φm = 50.6◦.

397
SECTION 8.3
Frequency
Compensation of
Op Amps
Vo
Cc
Rc
0
R1
100 kΩ
C1
1.59 pF
1 mA/V
g1
+
–
Vi
1 mA/V
2.144 pF
g2
+
–
+
–
R2
50 kΩ
1 kΩ
C2
0.318 pF
FIGURE 8.30
Miller compensation for φm ≅45◦with β = 1, under the constraint
fz(new) →∞.
(c) For Rc = 0, use Eqs. (8.26) to calculate fz ∼= 74.2 MHz and f2(new) ∼= 74.2 MHz.
These frequencies are identical in value, but since the zero is in the RHP and the
pole in the LHP, the zero and pole are complex-conjugate of each other. As we use
Eq. (8.25) to calculate magnitude, the terms involving fz and f2(new) cancel each
other out, leaving only the term involving f1(new). However, as we calculate phase,
both fz and f2(new) contribute phase lag, drastically reducing φm. This is conﬁrmed
by the thin traces of Fig. 8.31, obtained by rerunning PSpice with Rc = 0. Cursor
measurements now give ft = 72.4 MHz and a( j ft) = −177.3◦, so φm = 2.7◦. No
doubt that Rc plays a vital role! (Beware that even though the situation is deceptively
similar to that of |1/β4| in Fig. 8.10, ROC reasoning is not applicable here because
this is not a minimum-phase circuit!)
(d) Raising Rc above 1 k moves the zero to the LHP, thus introducing phase lead
(and turning the circuit into a minimum-phase type!). Tweaking with Rc, we ﬁnd
that raising it to Rc = 1.25 k yields ft = 60 MHz and a( j ft) = −119.3◦, so
φm = 60.7◦.
Frequency f (Hz)
Gain (dB)
106
107
108
109
103
104
−40
−20
0
20
40
60
105
Phase
0°
−120°
−180°
−150°
−90°
−60°
−30°
|a|
<) a
FIGURE 8.31
Frequency response of the circuit of Fig. 8.30 (thin curves
show the response with Rc = 0).

398
CHAPTER 8
Stability
Feedforward Compensation
In a multistage ampliﬁer there is usually one stage that acts as a bandwidth bot-
tleneck by contributing substantial phase lag. Feedforward compensation creates a
high-frequency bypass around this bottleneck stage in order to reduce its phase lag
contribution in the vicinity of the crossover frequency. The principle is illustrated
in Fig. 8.32 (top) for the case of an inverting ampliﬁer implemented with a two-
stage op amp having pole frequencies of 1 kHz and 100 kHz, respectively. Clearly,
the bottleneck stage is the ﬁrst stage, and the bypass function is provided by the
compensation capacitance C f f .
For a closer look, let us plot T using the circuit at the bottom of Fig. 8.32, where
the point of injection has been chosen so that a single injection sufﬁces. It is apparent
from Fig. 8.33 that without C f f the rate of closure (ROC) of the |Tuc| curve with the
0-db curve approaches 40 dB/dec, indicating a circuit on the verge of oscillation. The
presence of C f f , while lowering the bottleneck pole frequency from 1/(2π R1C1) to
about 1/[2π R1(C1 + C f f )], establishes also a zero frequency somewhere between
100 kHz and 1 MHz, whose effect is to cut the ROC almost in half. In fact, cursor
measurements give fx = 2.56 MHz and T ( j fx) = −103.4◦, so φm = 76.6◦. The
slight amount of peaking and overshoot appearing in Fig. 8.34 is due to the fact that
the compensated open-loop response includes a pole-zero doublet. The step response
consists17 of two exponential transients acting in concert: a fast exponential transient
leading to the overshoot and a slower exponential transient, also known as a long
Vo
0
R1
10 MΩ
1 kΩ
Cff
RA
2 kΩ
RB
C1
15.9 pF
0.1 mA/V
43 pF
g1
+
–
1 mA/V
g2
+
–
Vi
+
–
R2
100 kΩ
C2
15.9 pF
1 V/V
e3
+
–
0
R1
10 MΩ
1 kΩ
Cff
RA
2 kΩ
RB
C1
15.9 pF
0.1 mA/V
43 pF
g1
+
–
1 mA/V
g2
+
–
R2
100 kΩ
C2
15.9 pF
1 V/V
e3
+
–
Vf
F
Vr
Vt
R
–
+
+
–
+
–
FIGURE 8.32
Feedforward compensation for an inverting ampliﬁer (top), and voltage-injection circuit
to plot T (bottom).

399
SECTION 8.3
Frequency
Compensation of
Op Amps
<) T
<) Tuc
Frequency f (Hz)
Loop gain (dB)
102
103
104
105
106
107
10
−40
−20
0
20
40
60
80
100
Phase
0°
−120°
−90°
−60°
−30°
|Tuc|
|T|
FIGURE 8.33
Loop gain of the circuit of Fig. 8.32 (Tuc refers to the
uncompensated case).
tail, pulling back to the steady-state value of −2 V. The long tail tends to lengthen
the settling time signiﬁcantly,17 and this may be an issue in certain applications.
10
104
105
107
103
102
106
−20
−10
0
10
0
0.5
1
Time (µs)
Frequency f (Hz)
(b)
(a)
Gain (dB)
vO (V)
vO
1.5
2
−2
−1
0
|A|
FIGURE 8.34
Closed-loop responses of the circuit of Fig. 8.32 (top): (a) frequency response and (b) transient
response to a +1-V input step.
Three Representative Examples
Figure 8.35 shows three examples of the frequency compensation techniques dis-
cussed above.
The 741 circuit schematic of Fig. 5A.2 reveals Miller compensation via the
30-pF capacitor in the feedback path of the Darlington pair forming the second stage
(the compensation subcircuit is repeated in Fig. 8.35a for convenience). The second
stage has a gain of about −500 V/V, indicating that once reﬂected to the input of the
second stage, Cc appears as a capacitance of about 500× (30 pF) = 15 nF.
Figure 8.35b shows the compensation subcircuit of the two-stage CMOS op
amp of Fig. 5.4a. Here too we have Miller compensation. However, because of
the notoriously low transconductance of MOSFETs (gm5 in this case), the zero

400
CHAPTER 8
Stability
(a)
M5
Q16
Q17
(b)
Cc 
Rc 
VSS 
M6
(c)
Cc 
vO 
M8
Ro
30 pF
R8
100 Ω
R9
50 kΩ
VEE
Cc 
FIGURE 8.35
Subcircuits showing the frequency compensation of (a) the 741 bipolar
op amp, (b) the two-stage CMOS op amp, and (c) the folded-cascode CMOS
op amp.
frequency introduced by Miller compensation is low enough to erode the phase
margin signiﬁcantly. So, including a series resistance Rc = 1/gm5 moves the zero
out of the way to inﬁnity.
Figure 8.35c shows the compensation subcircuit of the folded-cascode CMOS
op amp of Fig. 5.4b. A distinguishing attribute of this topology is that all nodes
except for the output node are low-resistance nodes, so the pole formed by each
such node with its own stray capacitance is a high-frequency pole. Consequently,
the overall response is dominated by the output pole fb = 1/(2π RoCc). Given that
the dc gain is a0 = gm1Ro, it follows that GBP = a0 fb = gm1/(2πCc). Adding
capacitance at the output, far from destabilizing the op amp, will actually make φm
approach 90◦, if at the price of a lower GBP. For this reason folded-cascode op
amps are particularly suited to applications that require driving capacitive loads, as
in switched-capacitor ﬁlters.
8.4
OP AMPS CIRCUITS WITH A FEEDBACK POLE
Nowadays most op amps come with on-chip frequency compensation. Also referred
to as internally compensated op amps, they use schemes of the type of Section 8.3 to
provide, in frequency-independent feedback operation, a phase margin of the type
φm = 90◦+ φx(HOR)
where φx(HOR) is the combined phase lag due to higher roots (HOR) at the crossover
frequency fx. Most op amps are compensated for operation up to β = 1, in which
case fx is the unity-gain frequency ft (these op amps are also said to be unity-gain
stable). To allow for faster closed-loop dynamics, some op amps are compensated
for operation up to some β(max)< 1, such as β(max)= 0.2, in which case fx is the
crossover frequency between the 1/β(max) and the |a( j f )| curves. Aptly called de-
compensated op amps, they are intended for closed-loop gains of 1/β(max) or higher.

401
SECTION 8.4
Op Amps Circuits
with a Feedback
Pole
+
–
Rc
R
Vi
Vo
a
C
+
–
(a)
(b)
+
–
R
Vi
Vo
a
C
+
–
FIGURE 8.36
The differentiator circuit: (a) uncompensated, and (b) compensated by means
of Rc.
If the feedback network contains reactive elements, whether intentional or par-
asitic, φm may get so low as to require that the user alter the feedback network to
restore φm to the desired value. We are particularly concerned about the presence
of poles in the feedback path because their phase lag tends to destabilize the loop.
Example 8.2 has already exposed us to two feedback-pole types: that due to capac-
itance at the inverting input, and that due to capacitance at the output. We now wish
to investigate the two cases separately. To focus on the bare essentials, we make the
simplifying assumption that the op amp has just one single pole, so φx(HOR) = 0.
The Differentiator
The differentiator of Fig. 8.36a is a notorious example of a circuit with a feedback
pole. Stemming from the low-pass action provided by the R-C network to the feed-
back signal, this pole produces phase lag that adds to that produced by the op amp,
reducing φm to a perilously low value. For a closer look, refer to the PSpice circuit of
Fig. 8.37a, which uses an op amp with GBP = 1 MHz to provide differentiation with
Frequency f (Hz)
(b)
Gain (dB)
102
103
104
105
106
107
1
−40
−20
0
20
40
60
80
100
10
|H|
|a|
|1/|
(a)
LAPLACE {v(0,N)} = {100k/(1+s/62.83)}
Vt
IN+
IN−
OUT+
OUT−
EOA
0
0
0
0
O
10 kΩ
R
I
N
T
Rb
10 kΩ
Nb
15.9 nF
Vi
+
–
C
15.9 nF
Cb
Vo
+
–
FIGURE 8.37
(a) Differentiator designed for a unity-gain frequency of 1.0 kHz, and (b) its frequency
characteristics. The feedback network for plotting 1/β is repeated at the bottom of (a), with
its elements identiﬁed by subscript b. The |H| trace is plotted as DB(V(O)/V(I)), the |a|
trace as DB(V(OA)/(-V(N))), and the |1/β| trace as DB(V(T)/V(Nb)).

402
CHAPTER 8
Stability
unity-gain frequency f0 = 1/(2πRC) = 1 kHz. Its response |H( j f )| = |Vo/Vi|
is shown in Fig. 8.37b, along with the |a| and |1/β| curves, so we can visualize
the loop gain |T | as the difference between the two. So long as |T | ≫1, we have
H →Hideal = −j f /f0. However, as we approach the crossover frequency fx, |H|
exhibits considerable peaking, and past fx, where |T | ≪1, it rolls off with |a|.
Although H( j f ) can be derived analytically (see Problem 8.42), visual inspection
reveals that the rate of closure (ROC) approaches 40 dB/dec, so φm approaches
zero (this is similar to the |1/β2| curve of Fig. 8.10). Cursor measurements give
fx = 31.6 kHz and T ( j fx) = −178.2◦, so φm = 1.8◦, indicating a circuit on the
verge of oscillation.
A popular way of stabilizing the differentiator is by inserting a series resistance
Rc as in Fig. 8.36b. At low frequencies Rc has little effect because Rc ≪|ZC|. But
at high frequencies, where C acts as a short compared to Rc, the noise gain tends
to 1/β∞= 1 + R/Rc, indicating that the |1/β| curve must have a pole frequency.
Adjusting Rc so as to place this pole right at the crossover frequency will reduce the
ROC and yield φm ∼= 45◦(this is similar to the |1/β3| curve of Fig. 8.10).
EXAMPLE 8.9. Find Rc to stabilize the differentiator of Fig. 8.37a for φm ∼= 45◦. Verify
with PSpice.
Solution. Inspection of Fig. 8.37b reveals that |a( j f x)| = 30 dB = 31.6 V/V. To place
the pole right at fx, we must impose 1/β∞= 1 + 104/Rc = 31.6, or Rc = 326 .
Running the PSpice circuit of Fig. 8.38a, we get the curves of Fig. 8.38b, where cursor
measurements give φm = 53.8◦(even better than the target of 45◦).
Stray Input Capacitance Compensation
All real-life op amps exhibit stray input capacitances. Of special concern is the net
capacitance Cn of the inverting input toward ground,
Cn = Cd + Cc/2 + Cext
(8.31)
Frequency f (Hz)
(b)
Gain (dB)
102
103
104
105
106
107
1
−40
−20
0
20
40
60
80
100
10
|H|
|a|
|1/|
(a)
LAPLACE {v(0,N)} = {100k/(1+s/62.83)}
Vt
IN+
IN−
OUT+
OUT−
EOA
0
0
0
0
O
10 kΩ
R
I
N
T
Rb
Rc
10 kΩ
326 Ω
Nb
15.9 nF
Vi
+
–
C
15.9 nF
Cb
Rcb
326 Ω
Vo
+
–
FIGURE 8.38
(a) Differentiator compensated for φm ≅45◦, and (b) its frequency characteristics.

403
SECTION 8.4
Op Amps Circuits
with a Feedback
Pole
φm ≅ 45°
R2
R1
a0
+
0
Cf
Cn
Vo
Vi
+
–
a
1 + R2/R1
fz
fp
φ m ≅ 0°
φ
φ
φm ≅ 90°
ft
dB
(a)
(b)
a
φ
f  (dec)
1/β
FIGURE 8.39
Using the feedback capacitance C f to compensate for the stray input capacitance Cn.
where Cd is the differential capacitance between the input pins; Cc/2 is the common-
mode capacitance of each input to ground, so that when the inputs are tied together
the net capacitance is the sum of the two; and Cext is the external parasitic capac-
itance of components, leads, sockets, and printed-circuit traces associated with the
inverting input node. Typically, each of the above components is on the order of a
few picofarads.
As in the case of the differentiator, Cn creates a feedback pole whose phase
lag erodes φm. A common way of counteracting this lag is by using a feedback
capacitance C f to create feedback phase lead. This is illustrated in Fig. 8.39a for
the inverting case. Assuming ri = ∞and ro = 0, one can easily prove (see Prob-
lem 8.43) that the noise gain is
1
β( j f ) =

1 + R2
R1
 1 + j f/fz
1 + j f/f p
, fz =
1
2π(R1∥R2)(Cn + C f ), f p =
1
2π R2C f
(8.32)
In the absence of C f , the noise gain exhibits a breakpoint at fz because of Cn. If
fz is sufﬁciently low to make the ROC approach 40 dB/dec, the circuit will exhibit
excessive peaking and ringing. Physically, this is not surprising as the impedance
presented by the inverting input is of the shunt type and thus inductive, so Cn will
tend to resonate with the inductive component Leq (see Fig. 6.11b).
Inserting C f lowers fz somewhat while also establishing a second breakpoint
at f p, above which the noise gain ﬂattens out toward the high-frequency asymptote
1/β∞= 1+ZC f /ZCn = 1+Cn/C f . By properly positioning this second breakpoint,
we can increase φm. For φm ∼= 45◦we place f p right on the |a| curve, so f p = β∞ft.
Rewriting as 1/(2π R2C f ) = ft/(1 + Cn/C f ) gives
C f = (1 +

1 + 8π R2Cn ft)/(4π R2 ft)
for φm ∼= 45◦
(8.33a)
Alternatively, we can compensate for φm = 90◦. In this case we place f p right on
top of fz so as to cause a pole-zero cancellation. This makes the |1/β| curve ﬂat
throughout, or 1/β∞= 1 + R2/R1. Rewriting as 1 + Cn/C f = 1 + R2/R1 yields
C f = (R1/R2)Cn
for φm = 90◦
(8.33b)

404
CHAPTER 8
Stability
Frequency f (Hz)
(b)
Gain (dB)
106
107
−20
0
20
|Auc|
|a|
|1/|
|1/uc|
(a)
LAPLACE {v(0,N)} = {100k/(1+s/1257)}
Vt
IN+
IN−
OUT+
OUT−
EOA
0
0
0
0
0
0
O
30 kΩ
R2
I
N
T
R2b
R1
30 kΩ
30 kΩ
Nb
Vi
+
–
Cf
Cn
16 pF
R1b
30 kΩ
Vo
2.2 pF
Cfb
0
Cnb
16 pF
+
–
2.2 pF
|A|
FIGURE 8.40
(a) Stray input capacitance compensation, and (b) frequency characteristics.
This alternative, also referred to as neutral compensation, is similar to the compensa-
tion of oscilloscope probes. However, the price for φm ∼= 90◦is a lower closed-loop
bandwidth of f p.
EXAMPLE 8.10.
Let the op amp of Fig. 8.39a have a0 = 105 V/V, ft = 20 MHz,
Cd = 7 pF, and Cc/2 = 6 pF. (a) If R1 = R2 = 30 k and Cext = 3 pF, use PSpice
to verify that the circuit does not have an adequate phase margin. (b) Find C f for
φm ∼= 45◦, calculate fB, and verify with PSpice. (c) Repeat (b), but for the case of
neutral compensation. Compare with (b).
Solution.
(a) We have Cn = 7 + 6 + 3 = 16 pF. Running the PSpice circuit of Fig. 8.40a with
C f = 0 we get the uncompensated curves |Auc| and |1/βuc| of Fig. 8.40b. Their
crossover frequency is 2.53 MHz, where the combined phase shift by a and βuc is
−165.3◦, so φm = 14.7◦, a poor phase margin.
(b) Using Eq. 8.33a, we ﬁnd C f = 2.2 pF. Moreover, fB = 1/(2π × 30 × 103 × 2.2 ×
10−12) = 2.4 MHz. Rerunning PSpice with C f in place, we get the |A| and |1/β|
curves, whose crossover frequency is 3.03 MHz. The corresponding phase shift is
−117.6◦, so φm = 62.4◦(even better than the target of 45◦). Moreover, PSpice gives
fB = 2.7 MHz.
(c) Use C f = 16 pF and get fB = 0.332 MHz (PSpice gives fB = 0.330 MHz), a
much lower bandwidth.
We now turn to the noninverting conﬁguration10 of Fig. 8.41a, where the various
stray input capacitances have been shown explicitly. We observe that the overall
capacitance Cn is still given by Eq. (8.31). However, the portion C1 = Cc/2+Cext is
now in parallel with R1, so we have Aideal = 1+ Z2/Z1, Z1 = R1 ∥[1/( j2π f C1)],

405
SECTION 8.4
Op Amps Circuits
with a Feedback
Pole
R2
R1
+
Vi
Cext
Cf
Cc/2
Cc/2
Cd
Vo
+
–
a
a0
0
1 + R2/R1
fx
ft
|a| 
dB
(b)
(a)
φm ≅ 0°
φm ≅ 90°
φ
φ
f  (dec)
1/β
|
|
FIGURE 8.41
Stray input capacitance compensation for the noninverting conﬁguration.
Z2 = R2 ∥[1/( j2π f C f )]. We can make Aideal frequency-independent by using
C f = (R1/R2)(Cc/2 + Cext)
(8.34)
The effect of C f is shown in Fig. 8.41b. The actual gain is now A( j f ) ∼= (1 +
R2/R1)/(1 + j f/fx), fx = β∞ft = ft/(1 + Cn/C f ).
EXAMPLE 8.11.
Stabilize the circuit of Fig. 8.41a if the data are the same as in Exam-
ple 8.10. Hence, ﬁnd A( j f ).
Solution. We have C f = (30/30)(6+3) = 9 pF, fx = 2×107/(1+16/9) = 7.2 MHz,
and
A( j f ) ∼=
2
1 + j f/(7.2 MHz) V/V
With careful component layout and wiring, Cext can be minimized but not
altogether eliminated. Consequently, it is always a good practice to include a small
feedback capacitance C f in the range of a few picofarads to combat the effect of Cn
as given in Eq. (8.31).
Capacitive-Load Isolation
There are applications in which the external load is heavily capacitive. Sample-
and-hold ampliﬁers and peak detectors are typical examples. When an op amp
drives a coaxial cable, it is the distributed cable capacitance that makes the load
capacitive.Toinvestigatecapacitiveloading,considerthesimplecircuitofFig.8.42a.
As shown more explicitly in Fig. 8.42b (ignore the Cs-Rs network for a moment),
the load CL forms a pole with the op amp’s output resistance zo, thus increasing the
phase lag around the loop. This reduces the phase margin, possibly causing peaking
and ringing. Again, we justify this physically by noting that the output impedance
presented by the follower is of the shunt type and thus inductive, so CL will tend

406
CHAPTER 8
Stability
(b)
(a)
+
–
Vd
Vo
Cs
Rs
Vi
+
–
+
–
aVd
zo
+–
CL
Vi
+
–
CL
+
– a
Vo
FIGURE 8.42
(a) Capacitively loaded voltage follower, and (b) stabilization using a
snubber network.
to resonate with the inductive component Leq (see Fig. 6.11b). To tame the ringing,
we must alter the damping conditions, a function that is provided by the Cs-Rs
snubber.
As an example, consider the PSpice circuit of Fig. 8.43, which uses an op amp
with ft = 1 MHz and zo = 100 , and is loaded by CL = 50 nF. Since β = 1, T = a
in this case. Without the snubber, the circuit gives the uncompensated (uc) responses
of Fig. 8.44. The loop gain Tuc contains two pole frequencies, one at 10 Hz and the
other at 1/(2πzoCL) ∼= 32 kHz. Its ROC with the 0-dB line approaches 40 dB/dec,
indicating an almost oscillatory circuit. Cursor measurements give fx = 177 kHz
and Tuc( j fx) = −169.8◦, so φm = 10.2◦, which explains the pronounced peaking
of |Auc| and ringing of vO(uc).
The open-loop output impedance zo is small and resistive at dc, but tends to
become a complex function of frequency. Consequently, the snubber network values
must be found empirically. Starting out with a large Cs, we adjust Rs until the gain
peaking (GP) and the overshoot (OS) are lowered to their desired levels. Then, we
lower Cs to a value that still retains acceptable GP/OS characteristics. With the
snubber values shown in Fig. 8.43, the ROC of the |T | curve with the 0-dB line
is appreciably lower. In fact, cursor measurements now give fx = 115 kHz and
T ( j fx) = −119◦, so φm = 61◦, which explains the much reduced peaking of |A|
and ringing of vO.
LAPLACE {v(I,O)} = {100k/(1+s/62.83)}
IN+
IN−
OUT+
OUT−
EOA
0
0
0
0
O
I
ro
100 Ω
15 Ω
Vi
+
–
Vo
1 µF
Cs
Rs
CL
50 nF
FIGURE 8.43
PSpice circuit to investigate the capacitive loading of
a voltage follower.

407
SECTION 8.4
Op Amps Circuits
with a Feedback
Pole
104
105
106
−20
0
25
50
Frequency f (Hz)
(a)
Gain (dB)
|A|
|Tuc|
|Auc|
Time (µs)
(b)
0
20
vO(uc)
40
60
2 V
0 V
1 V
vO
|T|
FIGURE 8.44
(a) Frequency characteristics and (b) step responses of the follower of Fig. 8.43.
Figure 8.45 shows a capacitive-load stabilization alternative that is popular
with resistive circuits such as the inverting/noninverting ampliﬁers and the sum-
ming/difference ampliﬁers. Also called in-loop compensation, it uses a small series
resistance Rs to decouple the op amp’s output node from CL, and a suitable feed-
back capacitance C f to provide a high-frequency bypass around CL as well as to
combat the effect of any stray input capacitance Cn. It is possible to specify the
compensation network so that the phase lead introduced by C f exactly neutralizes
the phase lag due to CL. The design equations for neutral compensation are11
Rs = (R1/R2)ro
C f = (1 + R1/R2)2(ro/R2)CL
(8.35a)
Moreover, the closed-loop bandwidth is12
fB =
1
2π(1 + R2/R1)RsCL
(8.35b)
and is set by the external components independently of the op amp’s GBP.
(b)
(a)
R2
Rs
zo
R1
+– aVd
CL
Cf
+
–
+
–
Vd
R2
R3
R3
zo
R1
+– aVd
CL
+
–
+
–
Vd
FIGURE 8.45
(a) Generalized resistive-feedback circuit, and (b) in-loop compensation.

408
CHAPTER 8
Stability
Frequency f (Hz)
(b)
Gain (dB)
105
106
104
−30
0
30
60
|A|
|Auc|
|a|
|1/uc|
|1/|
(a)
IN+
IN−
OUT+
OUT−
EOA
LAPLACE {v(0,N)} = {100k/(1+s/628.3)}
0
0
0
0
0
OA
O
120 kΩ
100 Ω
25 Ω
I
N
T
rob
Rsb
100 Ω
25 Ω
Nb
30 kΩ
Vi
R1
R2
65 pF
Cfb
50 nF
CL
0
50 nF
0
CLb
65 pF
R2b
120 kΩ
R1b
30 kΩ
ro
Vo
Rs
Vt
+
–
+
–
Cf
FIGURE 8.46
(a) PSpice circuit of Example 8.12, and (b) its frequency characteristics.
EXAMPLE 8.12. Suppose the circuit of Fig. 8.45a is conﬁgured as an inverting-ampliﬁer
with R1 = 30 k and R2 = 120 k, and it drives a 50-nF load. (a) If the op amp has a0 =
105 V/V, ft = 10 MHz, and ro = 100 , ﬁnd Rs and C f for neutral compensation. What
is the closed-loop bandwidth? (b) Verify with PSpice, compare with the uncompensated
case, and comment.
Solution.
(a) By Eq. (8.35), Rs = (30/120)100 = 25 , C f = (1 + 30/120)2(0.1/120)50 ×
10−9 = 65 pF, fB = 1/[2π(1 + 120/30)25 × 50 × 10−9] = 25.5 kHz.
(b) Running the PSpice circuit of Fig. 8.46a, we get the plots of Fig. 8.46b. Without
compensation the circuit has φm = 7.2◦, with compensation it has φm ∼= 90◦and
fB = 24 kHz. Even though the crossover frequency is above 1 MHz, fB is set by
the external components and is much lower, this being the price we are paying for
neutral compensation.
As mentioned, at high frequencies zo is no longer purely resistive, so the above
equations offer only initial estimates for Rs and C f . The optimum values must be
found empirically once the circuit has been assembled in the lab.
The need to drive capacitive loads arises frequently enough to warrant the design
of special op amps with provisions for automatic capacitive-load compensation. The
AD817andLT1360opampsaredesignedtodriveunlimitedcapacitiveloads.Special
internal circuitry senses the amount of loading and adjusts the open-loop response to
maintain an adequate phase margin regardless of the load. The process, completely
transparent to the user, is most effective when the load is not ﬁxed or is ill-deﬁned,
as in the case of unterminated coaxial cable loads.

409
SECTION 8.5
Input-Lag and
Feedback-Lead
Compensation
Other Sources of Instability
In circuitry incorporating high-gain ampliﬁers such as op amps and voltage compara-
tors, the specter of instability arises in a number of subtle ways unless proper circuit
design and construction rules are followed.13–16 Two common causes of instabil-
ity are poor grounding and inadequate power-supply ﬁltering. Both problems stem
from the distributed impedances of the supply and ground busses, which can provide
spurious feedback paths around the high-gain device and compromise its stability.
In general, to minimize the ground-bus impedance, it is good practice to use a
ground plane, especially in audio and wideband applications. To reduce grounding
problems further, it is good practice to provide two separate ground busses: a signal-
ground bus to provide a return path for critical circuits—such as signal sources,
feedback networks, and precision voltage references—and a power-ground bus to
provide a return path for less critical circuits, such as high-current loads and digital
circuits. Every effort is made to keep both dc and ac currents on the signal-ground
bus small in order to render this bus essentially equipotential. To avoid perturbing
this equipotential condition, the two busses are joined only at one point of the circuit.
Spurious feedback paths can also form through the power-supply busses. Be-
cause of nonzero bus impedances, any change in supply currents brought about by a
load current change will induce a corresponding voltage change across the op amp
supply pins. Due to ﬁnite PSRR, this change will in turn be felt at the input, thus
providing an indirect feedback path. To break this path, each supply voltage must
be bypassed with a 0.01-μF to 0.1-μF decoupling capacitor, in the manner already
depicted in Fig. 1.43. The best results are obtained with low ESR and ESL ceramic
chip capacitors, preferably surface-mounted. For this cure to be effective, the lead
lengths must be kept short and the capacitors must be mounted as close as possible to
the op amp pins. Likewise, the elements of the feedback network must be mounted
close to the inverting-input pin in order to minimize the stray capacitance Cext
appearing in Eq. (8.31). Manufacturers often provide evaluation boards to guide the
user in the proper construction of the circuit.
8.5
INPUT-LAG AND FEEDBACK-LEAD COMPENSATION
Input-lag and feedback-lead are popular compensation techniques that are used to
stabilize a circuit by lowering its ROC via suitable manipulation of the noise gain
1/β( j f ).
Input-Lag Compensation
This technique, depicted in Fig. 8.47a for a generalized resistive-feedback circuit,
reshapes the noise gain by connecting a suitable Cc-Rc network across the op amp’s
input terminals. At low frequencies Cc acts as an open circuit, so the compensation
network has no effect, yielding the familiar low-frequency noise gain 1/β0 = 1 +
R2/R1. However, at high frequencies, where Cc acts as a short, the noise gain shoots
up to the asymptotic value (see Problem 8.52)
1
β∞
= 1 + R2
R1
+ R2 + (1 + R2/R1)R3
Rc

410
CHAPTER 8
Stability
R2
R1
Rc
Cc
+
–
a
dB
0.1fx
fx
a0
0
f
1 + R2
R1
|a|
|1/|
1/
(a)
(b)
R3
FIGURE 8.47
(a) Input-lag compensation, (b) illustration via Bode plots for the case φm ≅45◦.
Once we decide on the value of fx based on the desired noise margin, we adjust Rc
so as to make 1/β∞= |a( j f x)|, as exempliﬁed in Fig. 8.47b for the case φm ∼= 45◦.
The design equation for Rc is thus
Rc =
R2 + (1 + R2/R1)R3
|a( j fx)| −(1 + R2/R1)
(8.36a)
The high-frequency breakpoint of the noise margin (see Problem 8.52) is
1/(2π RcCc), this being the frequency at which the impedance of Cc equals, in
magnitude, Rc. To contain the erosion of φm, it is customary to position this fre-
quency about a decade below fx, as shown. Consequently,
Cc =
5
π Rc fx
(8.36b)
The input-lag technique is used to stabilize uncompensated as well as decompensated
op amps, and also circuits that use compensated op amps but have feedback poles,
like capacitively loaded circuits.
EXAMPLE 8.13.
A difference ampliﬁer is implemented with four 10-k resistors and
an uncompensated op amp having a0 = 105 V/V and two pole frequencies of 1 kHz and
1 MHz. (a) Verify that the circuit needs compensation. (b) Design an input-lag network
to stabilize it for φm = 60◦, and verify with PSpice.
Solution.
(a) With a noise gain as low as 1 + 10/10 = 2 V/V, the crossover frequency of the
uncompensated (uc) circuit is in the region where the ROC approaches 40-dB/dec,
indicating a negligible phase margin. Indeed, using the PSpice circuit of Fig. 8.48a
but without Rc and Cc, we ﬁnd φm ∼= 8◦(see Fig. 8.48b).
(b) For φm = 60◦we need fx = f−120◦. Using again the cursor, we ﬁnd f−120◦=
581 kHz, and |a( j f −120◦)| = 43.5 dB, or 149 V/V. Substituting these values into
Eqs. (8.36), along with R3 = 10 ∥10 = 5 k , we get Rc = 136  and Cc = 20 nF.
Rerunning PSpice with Rc and Cc in place, we get fx = 584 kHz and T ( j fx) =
−125.7◦, so φm = 54.3◦.

411
SECTION 8.5
Input-Lag and
Feedback-Lead
Compensation
(a)
LAPLACE {v(P,N)} = {100k/((1+s/6.3E3)*(1+s/6.3E6))}
IN+
IN−
OUT+
OUT−
EOA
0
0
0
0
Vi
R4
10 kΩ
R2
10 kΩ
Cc
Rc
Vo
R1
P
N
I
O
+
–
10 kΩ
R3
10 kΩ
20 nF
136 Ω
Vt
Nb
Pb
0
0
T
R4b
Rcb
10 kΩ
136 Ω
20 nF
0
Ccb
R2b
10 kΩ
0
R1b
10 kΩ
R3b
10 kΩ
+
–
Frequency f (Hz)
(b)
Gain (dB)
105
107
106
102
103
104
−20
0
20
40
60
80
100
|Auc|
|a|
|A|
|1/uc|
|1/|
FIGURE 8.48
(a) Input-lag compensated difference ampliﬁer of Example 8.13, and (b) its frequency charac-
teristics. The |A| trace is plotted as DB(V(O)/V(I)), the |a| trace as DB(V(O)/(V(P)-V(N))),
and the |1/β| trace as DB(V(T)/(V(Nb)-V(Pb))).
A popular application of input-lag compensation is the stabilization of decom-
pensated op amps for operation all the way to β = 1. A classic example is the
LF356/357 op amp pair: the 356 version uses an on-chip capacitor Cc = 10 pF to
provide GBP = 5 MHz and SR = 12 V/μs for β ≤1; the 357, the decompensated
version, uses Cc = 3 pF to achieve faster dynamics (GBP = 20 MHz and SR =
50V/μs)butonlyforoperationwithβ ≤0.2,ornoisegainsof1/β ≥5V/V(5.5V/V
= 14 dB). What if we want to operate a 357 with 1/β ≤5 V/V? Figure 8.49a shows
(a)
(b)
0.1fx
fx
dB
f
|a|
|1/|
a0
14
0
Vi
+
–
Vo
Rf
Rc
Cc
+
–
357
FIGURE 8.49
(a) Using a decompensated op amp as a voltage follower, and (b) Bode plots.

412
CHAPTER 8
Stability
the use of input-lag compensation to stabilize a 357 for voltage-follower (β = 1) op-
eration. Adapting Eq. (8.36a) to the present case, we get Rc = R f /(5−1) = R f /4
(use R f = 12 k and Rc = 3 k). Then, adapting Eq. (8.36b) with fx = GBP/5 =
20/5 = 4 MHz, we get Cc = 5/(π × 3 × 103 × 4 × 106) = 133 pF (use 130 pF).
Input-lag compensation provides yet another alternative for the stabilization of
capacitively loaded circuits, as demonstrated by the following example.
EXAMPLE 8.14.
Use input-lag compensation to stabilize the circuit of Example 8.12
for φm = 45◦.
Solution.
We use the PSpice circuit of Fig. 8.50a, but without the Rc-Cc network,
to plot |aloaded|, the gain of the op amp loaded by CL. Next, we use the cursor to ﬁnd
f−135◦= 32 kHz and |aloaded( j f −135◦)| = 46.836 dB, or 220 V/V. Proceeding as in
Example 8.13, we get Rc = 559  and Cc = 89 nF. Using again the cursor, we ﬁnd
φm = 39.4◦(the 5.6◦phase-margin erosion from the target value of 45◦is due to the
presence of the breakpoint at 0.1 fx).
Compared with internal compensation, the input-lag method allows for higher
slew rates as the op amp is spared from having to charge or discharge any in-
ternal compensating capacitance. The capacitance is now connected between the
inputs, so the voltage changes it experiences tend to be very small. However,
the settling-time improvement stemming from a higher slew rate is counter-
balanced by a long settling tail17 due to the presence of a pole-zero doublet at
fz and f p.
Frequency f (Hz)
(b)
(a)
Gain (dB)
106
105
104
103
102
−20
0
20
40
60
80
100
|A|
|1/|
|Auc|
|aloaded|
IN+
IN−
OUT+
OUT−
EOA
LAPLACE {v(0,N)} = {100k/(1+s/628.3)}
0
0
0
0
OA
O
120 kΩ
559 Ω
100 Ω
I
N
30 kΩ
R1
R2
50 nF
CL
0
89 nF
Cc
Rc
ro
Vo
+
–
Vi
0
120 kΩ
559 Ω
I
T
30 kΩ
R1b
R2b
Nb
0
89 nF
Ccb
Rcb
0
Vt
+
–
|1/uc|
FIGURE 8.50
(a) Input-lag compensation of the capacitively loaded circuit of Example 8.12, and (b) its
frequency characteristics. The |aloaded| trace is plotted as DB(V(O)/(-V(N)), and the |1/β|
trace as DB(V(T)/V(Nb)).

413
SECTION 8.5
Input-Lag and
Feedback-Lead
Compensation
A notorious disadvantage of this method is increased high-frequency noise,
since the noise-gain curve is raised signiﬁcantly in the vicinity of the crossover
frequency fx. Another disadvantage is a much lower closed-loop differential input
impedance Zd, since zd is now in parallel with Zc = Rc + 1/( j2π f Cc), and Zc is
much smaller than zd. Though this is inconsequential in inverting conﬁgurations, it
may cause intolerable high-frequency input loading and feedthrough in noninverting
conﬁgurations. Input-lag compensation is nevertheless popular.
Feedback-Lead Compensation
This technique1 uses a feedback capacitance C f to create phase lead in the feedback
path. This lead is designed to occur in the vicinity of the crossover frequency fx,
which is where φm needs to be boosted. Alternatively, we can view this method as
a reshaping of the |1/β| curve near fx to reduce the rate of closure ROC. Refer-
ring to Fig. 8.51a and assuming rd = ∞and ro = 0, we have 1/β = 1 + Z2/R1,
Z2 = R2 ∥[1/( j2π f C f )]. Expanding, we can write
1
β( j f ) =

1 + R2
R1
 1 + j f/fz
1 + j f/f p
(8.37)
where f p = 1/(2π R2C f ) and fz = (1+R2/R1) f p. As depicted in Fig. 8.51b, |1/β|
has the low- and high-frequency asymptotes |1/β0| = 1 + R2/R1 and |1/β∞| =
0 dB, and two breakpoints at f p and fz.
The phase lag provided by 1/β( j f ) is maximum1 at the geometric mean of f p
and fz, so the optimum value of C f is the one that makes this mean coincide with the
crossover frequency, or fx = 
 f p fz = f p
√1 + R2/R1. Under such a condition
we have |a( j fx)| = √1 + R2/R1, which can be used to ﬁnd fx via trial and error.
Once fx is known, we ﬁnd C f = 1/(2π R2 f p), or
C f =
√1 + R2/R1
2π R2 fx
(8.38)
R1
R2
A
B
Vo
+
–
f1
f2
fp
fx
f3
fz
0
dB
a0
1 + R2/R1
a
a
1/β
(b)
(a)
f  (dec)
Cff
FIGURE 8.51
Feedback-lead compensation.

414
CHAPTER 8
Stability
The closed-loop bandwidth is approximately 1/(2π R2C f ). Moreover, C f helps
combat the effect of the inverting-input stray capacitance Cn.
One can readily verify that at the geometric mean of f p and fz we have
(1/β) = 90◦−2 tan−1√1 + R2/R1, so the larger the value of 1 + R2/R1, the
greater the contribution of 1/β to φm. For example, with 1 + R2/R1 = 10 we get
(1/β) = 90◦−2 tan−1√
10 ∼= −55◦, which yields T = a −(−55◦) = a +
55◦. We observe that for this compensation scheme to work for a given φm, the
open-loop gain must satisfy a( j fx) ≥φm −90◦−2 tan−1√1 + R2/R1.
EXAMPLE 8.15.
(a) Using an op amp with a0 = 105 V/V, f1 = 1 kHz, f2 = 100 kHz,
and f3 = 5 MHz, design a noninverting ampliﬁer with A0 = 20 V/V. Hence, verify that
the circuit needs compensation. (b) Stabilize it with the feedback-lead method, and ﬁnd
φm. (c) Find the closed-loop bandwidth.
Solution.
(a) For A0 = 20 V/V use R1 = 1.05 k and R2 = 20.0 k. Then β0 = 1/20 V/V, and
a0β0 = 105/20 = 5000. Thus, without compensation we have
T ( j f ) =
5000
[1 + j f/103][1 + j f/105][1 + j f/(5 × 106)]
Usingtrialanderror,weﬁndthat|T | = 1for f = 700kHz,andthatT ( j700kHz) =
−179.8◦. So, φm = 0.2◦, indicating a circuit in bad need of compensation.
(b) Again using trial and error, we ﬁnd that |a| =
√
20 V/V for f = 1.46 MHz, and
a( j1.46 MHz) = −192.3◦. Letting fx = 1.46 MHz in Eq. (8.38) yields C f =
24.3 pF. Moreover, φm = 180◦+a −(90◦−2 tan−1√
20) = 180◦+(−192.3◦)−
(90◦−2 × 77.4◦) = 52.5◦.
(c) f−3dB = 1/(2π R2C f ) = 327 kHz.
We observe that feedback-lead compensation does not enjoy the slew-rate ad-
vantages of input-lag compensation; however, it provides better ﬁltering capabilities
forinternallygeneratednoise.Thesearesomeofthefactorstheuserneedstoconsider
when deciding which method is best for a given application.
8.6
STABILITY IN CFA CIRCUITS18
The open-loop response z( j f ) of a current-feedback ampliﬁer (CFA) is domi-
nated by a single pole only over a designated frequency band. Beyond this band,
higher-order roots come into play, which increase the overall phase shift. When
frequency-independent feedback is applied around a CFA, the latter will offer uncon-
ditional stability with a speciﬁed phase margin φm only as long as 1/β ≥(1/β)min =
|z( j fφm−180◦)|, where fφm−180◦is the frequency at which z = φm −180◦. Lower-
ing the 1/β curve below (1/β)min would increase the phase shift, thus eroding φm
and inviting instability. This behavior is similar to that of decompensated op amps.
The value of (1/β)min can be found from the data-sheet plots of |z( j f )| and z( j f ).
As with voltage-feedback ampliﬁers (VFAs), instability in CFA circuits may also
stem from feedback phase lag due to external reactive elements.

415
SECTION 8.6
Stability in CFA
Circuits
 V/A (dec)
fx
fb
fp
fz
1/ 0
1/ ∞
z
z0
(b)
R2
R1
Cf
+
–
CFA
(a)
Α
Β
β
β
f  (dec)
FIGURE 8.52
A large feedback capacitance C f tends to destabilize a CFA circuit.
Effect of Feedback Capacitance
To investigate the effect of feedback capacitance, refer to Fig. 8.52a. At low fre-
quencies, C f acts as an open circuit, so we can apply Eq. (6.64) and write 1/β0 =
R2 + rn(1 + R2/R1). At high frequencies, R2 is shorted out by C f , so 1/β∞=
1/β0|R2→0 = rn. Since 1/β∞≪1/β0, the crossover frequency fx is pushed into
the region of greater phase shift, as shown in Fig. 8.52b. If this shift reaches −180◦,
the circuit will oscillate.
We thus conclude that direct capacitive feedback must be avoided in CFA cir-
cuits. In particular, the familiar inverting or Miller integrator is not amenable to
CFA implementation, unless suitable measures are taken to stabilize it (see Prob-
lem 8.62). However, the noninverting or Deboo integrator is acceptable because β in
the vicinity of fx is still controlled by the resistance in the negative-feedback path.
Likewise, we can readily use CFAs in those ﬁlter conﬁgurations that do not employ
any direct capacitance between the output and the inverting input, such as KRC
ﬁlters.
Stray Input Capacitance Compensation
In Fig. 8.53a Cn appears in parallel with R1. Replacing R1 with R1 ∥[1/( j2π f Cn)]
in Eq. (6.64) yields, after minor algebra,
1
β = 1
β0
(1 + j f/fz)
(8.39a)
1
β0
= R2 + rn

1 + R2
R1

fz =
1
2π(R1 ∥R2 ∥rn)Cn
(8.39b)
As shown in Fig. 8.53b, the 1/β curve starts to rise at fz, and if Cn is sufﬁciently
large to make fz < fx, the circuit will become unstable.

416
CHAPTER 8
Stability
 V/A (dec)
fx
fz
fb
1/ 0
1/ββ
z
z0
(b)
R2
R1
Cf
Cn
+
–
CFA
(a)
Without Cf
With Cf
β
f  (dec)
FIGURE 8.53
Input stray capacitance compensation in CFA circuits.
Like a VFA, a CFA is stabilized by counteracting the effect of Cn with a small
feedback capacitance C f . Together with R2, C f creates a pole frequency for 1/β
at f p = 1/(2π R2C f ). For φm = 45◦, impose f p = fx. We observe that fx is the
geometric mean of fz and β0z0 fb. Letting 1/(2π R2C f ) = √β0z0 fb fz and solving,
we get
C f =

rnCn/(2π R2z0 fb)
(8.40)
A typical application is when a CFA is used in conjunction with a current-output
DAC to perform fast I-V conversion, and the stray capacitance is the combined result
of the stray output capacitance of the DAC and the stray inverting-input capacitance
of the CFA (see Fig. 8.54).
EXAMPLE 8.16.
A current-output DAC is fed to a CFA having z0 = 750 k, fb =
200 kHz, and rn = 50 . Assuming R = 1.5 k and Cn = 100 pF, ﬁnd C f for φm = 45◦.
Verify with PSpice.
Solution.
C f =

50 × 100 × 10−12/(2π × 1.5 × 103 × 1.5 × 1011) = 1.88 pF. This
value can be increased for a greater phase margin, but this will also reduce the bandwidth
of the I-V converter.
+
–
CFA
R
iI
Cn
Cf
vO
FIGURE 8.54
CFA-based I-V converter.

417
SECTION 8.6
Stability in CFA
Circuits
+
–
Vo
Ii
N
50 Ω
1.88 pF
1.88 pF
rn
Ceq
1.061 pF
Req
750 kΩ
R
0
Nb
50 Ω
rnb
Cnb
100 pF
1.5 kΩ
Rb
Cfb
0
0
0
1 V/V
Eo
+
–
+
–
1 A/A
F
0
Vt
1.5 kΩ
Cf
Cn
100 pF
0
0
FIGURE 8.55
PSpice circuit for the CFA I-V converter of Example 8.16. Circuit proper (top)
and feedback network for plotting 1/β (bottom).
Using the simpliﬁed CFA model of Fig. 6.37, we set up the PSpice circuit of Fig. 8.55
(since the noninverting input is grounded, we can drop the input buffer and short rn to
ground). After running PSpice, we obtain the plots of Fig. 8.56. The uncompensated
circuit (uc) has insufﬁcient phase margin (φm = 32.6◦), which accounts for the peaking
and ringing. After compensation we have φm ∼= 74◦, indicating the absence of peaking
and negligible ringing. The −3-dB closed-loop frequency is near 70 MHz.
(a)
Frequency f (MHz)
Gain (V/A)
200
100
50
20
10
200
vO(uc)
vO
104
103
|z|
|1/|
|1/uc|
|A|
|Auc|
(b)
Time (ns)
50
30
40
20
10
0
0 V
1 V
2 V
FIGURE 8.56
(a) Frequency and (b) transient responses of the I-V converter of Fig. 8.55. The |A| trace
is plotted on a log scale as V(O)/I(Ii), the |z| trace as V(O)/I(rn), and the |1/β| trace as
V(T)/(-I(rnb)).

418
CHAPTER 8
Stability
8.7
COMPOSITE AMPLIFIERS
Two or more op amps can be combined to achieve improved overall performance.19
The designer need be aware that when an op amp is placed within the feedback loop
of another, stability problems may arise. In the following we shall designate the gains
of the individual op amps as a1 and a2, and the gain of the composite device as a.
Increasing the Loop Gain
Two op amps, usually from a dual-op amp package, can be connected in cascade
to create a composite ampliﬁer with a gain a = a1a2 much higher than the indivi-
dual gains a1 and a2. We expect the composite device to provide a much greater
loop gain, and thus a much lower gain error. However, if we denote the individual
unity-gain frequencies as ft1 and ft2, we observe that at high frequencies, where a =
a1a2 ∼= ( ft1/j f )( ft2/j f ) = −ft1 ft2/f 2, the phase shift of the composite response
approaches −180◦, thus requiring frequency compensation.
In applications with sufﬁciently high closed-loop dc gains, the composite am-
pliﬁer can be stabilized via the feedback-lead method20 shown in Fig. 8.57a. As
usual, the circuit can be either an inverting or a noninverting ampliﬁer, depending on
whether we insert the input source at node A or B. The decibel plot of |a| is obtained
by adding together the individual decibel plots of |a1| and |a2|. This is illustrated in
Fig. 8.57b for the case of matched op amps, or a1 = a2.
As we know, the 1/β curve has a pole frequency at f p = 1/(2π R2C f ) and a
zero frequency at fz = (1 + R2/R1) f p. For ROC = 30 dB/dec, or φm = 45◦, we
place f p right on the |a| curve. This yields 1 + R2/R1 = |a( j f p)| = ft1 ft2/f 2p.
Solving for f p and then letting C f = 1/(2π R2 f p) gives
C f =

(1 + R2/R1)/ft1 ft2/(2π R2)
(8.41)
The closed-loop bandwidth is fB = f p. It can be shown (see Problem 8.66) that
increasing C f by the factor (1 + R2/R1)1/4 will make the crossover frequency fx
R2
R1
Cf
Vo
+
–
(a)
fz
fp
ft1, ft2
1/
(b)
a0
a10, a20
0
1 + R2/R1
dB
A
B
a
a1
a2
,
+
–
OA1
OA2
β
f  (dec)
FIGURE 8.57
Composite ampliﬁer with feedback-lead compensation.

419
SECTION 8.7
Composite
Ampliﬁers
coincide with the geometric mean 
 f p fz and thus maximize φm; however, this will
also decrease the closed-loop bandwidth in proportion.
EXAMPLE 8.17.
(a) The circuit of Fig. 8.57a is to be used as a noninverting ampliﬁer
with R1 = 1 k and R2 = 99 k. (a) Assuming op amps with GBP = 1 MHz, ﬁnd C f
for φm = 45◦. Then compare φm, T0, and fB with the case of a single-op amp realization.
(b) Find C f for the maximum phase margin. What are the resulting values of φm and
f p? (c) What happens if C f is increased above the value found in (b)?
Solution.
(a) Insert the input source at node B. Letting ft1 = ft2 = 1 MHz in Eq. (8.41) gives
C f = 16.1 pF for φm = 45◦. Moreover, T0 = a2
0/100 = 4 × 108, and fB = f p =
100 kHz. Had a single op amp been used, then φm = 90◦, T0 = a0/100 = 2 × 103,
and fB = 106/100 = 10 kHz.
(b) C f = (100)1/4 × 16.1 = 50.8 pF, f p = 31.62 kHz, φm = 180◦+ a −(1/β) ∼=
180◦−180◦−[tan−1( fx/fz) −tan−1( fx/f p)] = −(tan−1 0.1 −tan−1 10) = 78.6◦.
(c) Increasing C f above 50.8 pF will reduce φm until eventually φm →0◦, indicating
that overcompensation is detrimental.
In Fig. 8.57 we have stabilized the composite ampliﬁer by acting on its feed-
back network. An alternative21 type of compensation is by controlling the pole of
the second op amp using local feedback, in the manner depicted in Fig. 8.58. The
composite response a = a1A2 has the dc gain a0 = a10(1 + R4/R3), and two pole
frequencies at fb1 and at fB2 = ft2/(1 + R4/R3). Without the second ampliﬁer,
the closed-loop bandwidth would be fB1 = ft1/(1+R2/R1). With the second ampli-
ﬁer in place, the bandwidth is expanded to fB = (1+R4/R3) fB1 = ft1(1+R4/R3)/
(1 + R2/R1). It is apparent that if we align fB and fB2, then ROC = 30 dB/dec,
or φm = 45◦. Thus, imposing ft1(1 + R4/R3)/(1 + R2/R1) = ft2/(1 + R4/R3)
yields
1 + R4/R3 =

( ft2/ft1)(1 + R2/R1)
(8.42)
We observe that for the beneﬁts of using OA2 to be signiﬁcant the application must
call for a sufﬁciently high closed-loop gain.
R2
R1
R3
R4
Vo
+
–
(a)
f (dec)
fB2
fB
ft1, ft2
1/
(b)
a0
a10
0
1 + R2/R1
1 + R4/R3
dB
A
B
a
a1
A2
+
–
OA1
OA2
β
FIGURE 8.58
Composite ampliﬁer with compensation provided by OA2.

420
CHAPTER 8
Stability
EXAMPLE 8.18. (a) Assuming op amps with GBP = 1 MHz in the circuit of Fig. 8.58a,
specify suitable components for operation as an inverting ampliﬁer with a dc gain of
−100 V/V. Compare with a single-op-amp realization.
Solution.
Insert the input source at node A and let R1 = 1 k and R2 = 100 k. Then,
R4/R3 =
√
101 −1 = 9.05. Pick R3 = 2 k and R4 = 18 k. The dc loop gain
is T0 = a10(1 + R4/R3)/(1 + R2/R1) ∼= 2 × 104, and the closed-loop bandwidth is
fB ∼= ft/10 = 100 kHz. If only one op amp had been used, then φm ∼= 90◦, T0 ∼= 2×103
and fB ∼= 10 kHz, indicating an order-of-magnitude improvement brought about by the
second op amp.
Optimizing dc and ac Characteristics
There are applications in which it is desirable to combine the dc characteristics of
a low-offset, low-noise device, such as a bipolar voltage-feedback ampliﬁer (VFA),
with the dynamics of a high-speed device, such as a current-feedback ampliﬁer
(CFA). The two sets of technologically conﬂicting speciﬁcations can be met with a
composite ampliﬁer. In the topology of Fig. 8.59a we use a CFA with local feedback
to shift the |a1|dB curve upward by the amount |A2|dB, and thus improve the dc
loop gain by the same amount. As long as fB2 ≫ft1, the phase shift due to the pole
frequency at f = fB2 will be insigniﬁcant at f = ft1, indicating that we can operate
the VFA with a feedback factor of unity, or at the maximum bandwidth ft1. Imposing
1 + R4/R3 = 1 + R2/R1
(8.43)
will maximize also the closed-loop bandwidth fB of the composite device, which
is now fB = ft1.
The composite topology offers important advantages other than bandwidth.
Since the CFA is operated within the feedback loop of the VFA, its generally poorer
input dc and noise characteristics become insigniﬁcant when referred to the input
of the composite device, where they are divided by a1. Moreover, with most of the
signal swing being provided by the CFA, the slew-rate requirements of the VFA are
signiﬁcantly relaxed, thus ensuring high full-power bandwidth (FPB) capabilities
for the composite device. Finally, since the VFA is spared from having to drive the
R2
R1
R3
R4
Vo
+
–
(a)
f  (dec)
fB2
ft1
ft1
1/
(b)
a10
a10 A20
A20
0
dB
A
B
a
a1
A2
+
–
VFA
CFA
fB
β
FIGURE 8.59
VFA-CFA composite ampliﬁer.

421
SECTION 8.7
Composite
Ampliﬁers
output load, self-heating effects such as thermal feedback become insigniﬁcant, so
the composite device retains optimum input-drift characteristics.
There are practical limitations to the amount of closed-loop gain achievable with
a CFA. Even so, it pays to use a CFA as part of a composite ampliﬁer. For instance,
suppose we need an overall dc gain A0 = 103 V/V, but using a CFA having only
A20 = 50 V/V. Clearly, the VFA will now have to operate with a gain of A0/50 =
20 V/V and a bandwidth ft1/20. This is still 50 times better than if the VFA were
to operate alone, not to mention the slew-rate and thermal-drift advantages.
In the arrangement of Fig. 8.59a the composite bandwidth is set by the VFA, so
the ampliﬁcation provided by the CFA above this band is in effect wasted. The alter-
native topology of Fig. 8.60 exploits the dynamics of OA2 to their fullest extent by
allowing it to participate directly in the feedback mode, but only at high frequencies.
The circuit works as follows.
At dc, where the capacitances act as opens, the circuit reduces to that of
Fig. 8.57a, so a0 = a10a20. Clearly, the dc characteristics are set by OA1, which
provides OA2 with whatever drive is needed to force Vn →VOS1. Moreover, any
gross bias current at the inverting input of OA2 is prevented from disturbing node
Vn because of the dc blocking action by C2.
As we increase the operating frequency, we witness a gradual decrease in OA1’s
gain A1 = −1/( j f/f1), f1 = 1/(2π R3C1), while the crossover network C2R4 grad-
ually changes the mode of operation of OA2 from open-loop to closed-loop. Above
the crossover network frequency f2 = 1/(2π R4C2), we can write Vo ∼= a2(A1Vn −
Vn), or
Vo ∼= −
a20
1 + j f/fb2
1 + j f/f1
j f/f1
Vn
It is apparent that if we impose f1 = fb2, or R3C1 = 1/(2π fb2), then we obtain a
pole-zero cancellation and Vo = −aVn, a = a20/( j f/f1) = a20 fb2/j f ∼= a2,
indicating that the high-frequency dynamics are fully controlled by OA2.
In a practical realization the pole-zero cancellation is difﬁcult to maintain be-
cause fb2 is an ill-deﬁned parameter. Consequently, in response to an input step, the
composite device will not completely stabilize until the integrator loop has settled to
its ﬁnal value. The resulting settling tail17 may be of concern in certain applications.
R2
R1
R3
R4
Vo
+
–
OA1
+
–
OA2
Vi
C2
C1 
Vn
+
FIGURE 8.60
Composite ampliﬁer enjoying the dc characteristics of OA1 and the ac
characteristics of OA2.

422
CHAPTER 8
Stability
Improving Phase Accuracy
As we know, a single-pole ampliﬁer exhibits an error function of the type 1/(1 +
1/T ) = 1/(1 + j f/fB), whose phase error is ϵφ = −tan−1( f/fB), or ϵφ ∼= −f/fB
for f ≪fB. This error is intolerable in applications requiring high phase accu-
racy. In the composite arrangement22 of Fig. 8.61, OA2 provides active feedback
around OA1 to maintain a low phase error over a much wider bandwidth than in
the uncompensated case. This is similar to the active compensation of integrators of
Section 6.5.
To analyze the circuit, let β = R1/(R1 + R2) and α = R3/(R3 + R4). We
note that OA2 is a noninverting ampliﬁer with gain A2 = (1/β)/[1 + j f/(β ft2)].
Consequently, the feedback factor around OA1 is β1 = β × A2 × α = α/[1 +
j f/(β ft2)].
The closed-loop gain of the composite device is A = A1 = a1/(1+a1β1), where
we are using the fact that OA1 too is operating in the noninverting mode. Substituting
a1 ∼= ft1/( j f ) and β1 = α/[1 + j f/(β ft2)], and letting ft1 = ft2 = ft, we obtain,
for α = β,
A( j f ) = A0
1 + j f/fB
1 + j f/fB −( f/fB)2
(8.44)
where A0 = 1+R2/R1 and fB = ft/A0.AsdiscussedinSection6.5,thiserrorfunc-
tion offers the advantage of a very small phase error, namely, ϵφ = −tan−1( f/fB)3,
or ϵφ ∼= −( f/fB)3 for f ≪fB.
Figure 8.62 (top) shows the results of the PSpice simulation of a composite
ampliﬁer with A0 = 10 V/V using a matched pair of 10-MHz op amps, so that
fB = 1 MHz. For instance, at 1/10 of fB, or 100 kHz, the composite circuit gives
ϵφ = −0.057◦, which is far better than ϵφ = −5.7◦for a single-op amp realization.
The stability situation, shown in Fig. 8.62 (bottom), reveals a rise in the |1/β1|
curve because of the feedback pole introduced by OA2 at f = β ft2. This frequency
is high enough not to compromise the stability of OA1, yet low enough to cause
a certain amount of gain peaking: this is the price we are paying for the dramatic
improvement in the phase-error characteristic!
R2
R3
R1
R4
Vo
+
–
OA1
+
–
OA2
Vi
+
FIGURE 8.61
Composite ampliﬁer with high phase accuracy.

423
Problems
FIGURE 8.62
Frequency plots of the circuit of Fig. 8.61.
PROBLEMS
8.1 The stability problem
8.1 Suppose the loop gain of Fig. 8.1 has T0 = 104 and three pole frequencies of 102 Hz,
106 Hz, and 107 Hz. (a) Find f−180◦, and calculate GM. (b) Find fx, and calculate φm.
(c) Find the value to which we must lower T0 if we want φm = 60◦.
8.2 The μA702, the ﬁrst monolithic op amp, had a0 = 3600 V/V and three pole frequencies
of 1 MHz, 4 MHz, and 40 MHz. (a) Find the range of values of β for which φm ≥45◦.
(b) Find the range of values of β for which the circuit will oscillate. What is the
approximate frequency of oscillation?
8.3 (a) What is the percentage of gain peaking at fx of a system with φm = 30◦? (b) What
is φm for |D( j fx)| = 2? For |D( j fx)| = 10? For |D( j fx)| = 3 dB? For D( j fx)| =
−3 dB? (c) Find β so that the circuit of Fig. 8.21 has φm = 75◦. What is the value of
|D( j fx)?

424
CHAPTER 8
Stability
8.4 A voltage ampliﬁer with open-loop gain a( j f ) = a0/[(1 + j f /f1) × (1 + j f /f2)] is
operated with β = 0.1 V/V. (a) If the closed-loop dc gain is A0 = 9 V/V, ﬁnd a0;
hence, develop a standard-form expression for A( j f ) in terms of f1 and f2. (b) If it is
found that the phase and magnitude of A( j f ) at f = 10 kHz are −90◦and 90/11 V/V,
what are the values of f1 and f2? (c) Find the crossover frequency fx and, hence, the
phase margin φm. (d) Find φm if β is raised to 1 V/V.
8.5 An ampliﬁer with open-loop gain a(s) = 100/[(1 + s/103) × (1 + s/105)] is placed
in a negative-feedback loop. (a) Derive an expression for the closed-loop gain A(s) as
a function of the feedback factor β, and ﬁnd the value of β that causes the poles of
A(s) to be coincident. What is their common value? (b) Find the crossover frequency
fx and, hence, the phase margin φm.
8.6 Anampliﬁerwithdcgaina0 = 105 andthreepolefrequencies f1 = 1kHz, f2 = 1MHz,
and f3 = 10 MHz is to be operated with frequency-independent feedback. (a) Find β
for φm = 60◦. What is the corresponding value of GM? (b) Find β for GM = 20 dB.
What is the corresponding value of φm?
8.7 An op amp with a0 = 103 V/V and two pole frequencies at f1 = 100 kHz and f2 =
2 MHz is connected as a unity-gain voltage follower. Find φm, ζ, Q, GP, OS, and
A( j f ). Would you have much use for this circuit?
8.8 An ampliﬁer has three identical pole frequencies so that a( j f ) = a0/(1+ j f/f1)3, and
is placed in a negative-feedback loop with a frequency-independent feedback factor β.
Find an expression for f−180◦as well as the corresponding value of T .
8.9 (a) Verify that a circuit with a dc loop gain T0 = 102 and three pole frequencies at
f1 = 100 kHz, f2 = 1 MHz, and f3 = 2 MHz is unstable. (b) One way of stabilizing it
is by reducing T0. Find the value to which T0 must be reduced for φm = 45◦. (c) Another
way of stabilizing it is by rearranging one or more of its poles. Find the value to which
f1 must be reduced for φm = 45◦. (d) Repeat parts (b) and (c), but for φm = 60◦.
8.10 An ampliﬁer with a( j f ) = 105(1 + j f/104)/[(1 + j f/10) × (1 + j f/103)] V/V is
placed in a negative-feedback loop with frequency-independent β. (a) Find the range
of values of β for which φm ≥45◦. (b) Repeat, but for φm ≥60◦. (c) Find the value of
β that minimizes φm. What is φm(min)?
8.11 Two negative-feedback systems are compared at some frequency f1. If it is found that
the ﬁrst has T ( j f1) = 10 /−180◦and the second has T ( j f1) = 10 /−90◦, which system
enjoys the smaller magnitude error? The smaller phase error?
8.12 The response of a negative-feedback circuit with β = 0.1 V/V is observed with the
oscilloscope. For a 1-V input step, the output exhibits an overshoot of 12.6% and a ﬁnal
value of 9 V. Moreover, with an ac input, the phase difference between output and input
reaches 90◦for f = 10 kHz. Assuming a second-pole error ampliﬁer, ﬁnd its open-loop
response.
8.13 As mentioned, the rate-of-closure considerations hold only for minimum-phase sys-
tems. Verify by comparing the Bode plots of the minimum-phase function H(s) = (1 +
s/2π103)/[(1 + s/2π10)(1 + s/2π102)] with those of the function H(s) = (1 −
s/2π103)/[(1 + s/2π10)(1 + s/2π102)], which is similar to the former, except that
its zero is located in the right half of the complex plane.

425
Problems
8.2 Phase and gain margin measurements
8.14 (a) An op amp with ri = ∞,ro = 0, and a( j f ) = 103/(1 + j f /103) is conﬁgured
for operation as an inverting integrator with f0 = 10 kHz. Use return-ratio analysis
to calculate its phase margin. (b) Repeat, if a( j f ) has an additional pole frequency at
1 MHz. (c) Comment on your results.
8.15 Repeat problem 8.14 if the resistance and capacitance are interchanged with each other
so as to turn the circuit into an inverting differentiator.
8.16 (a) Assuming ideal op amp, ﬁnd the gain margin GM of the equal-component KRC
ﬁlter of Example 3.8. (b) What happens if the op amp, instead of being ideal, has a
constant GBP of 1 MHz?
8.17 Find the phase and gain margins if the circuit of Fig. 8.14 is conﬁgured as a voltage
follower by letting R1 = ∞and R2 = 0. Use two different injection points, and verify
that even though Tv and/or Ti vary with the point of injection, T remains the same.
8.18 Supposethehigh-sensitivity I-V converterofExample2.2isimplementedwitha741op
amp with the same Cn and RL-CL values of Fig. 8.14. Find an injection point where only
a single injection sufﬁces, and use it to measure φm and GM. Compare the phase erosion
by Cn and CL with Example 8.2, and explain why it is less critical in the current circuit.
8.19 Figure P8.19 shows the voltage-injection method applied to some op amp circuit.
(a) Calculate T if a = 16 V/V, Zo = Z1 = 1 k, and Z2 = 2 k. (b) Calculate
Tv. (c) Based on the above results, what do you expect the value of Ti to be? (d) Verify
the above value of Ti via current injection.
Vr
Vt
Vf
aVd
Vi
(0 V)
+
–
Z1
Z2
Zo
–
+
+–
+
–
Vd
FIGURE P8.19
8.20 A certain unity-gain inverting ampliﬁer is at the onset of peaking for having φm =
cos−1(
√
2−1). Assuming aft is a real number, ﬁnd conditions for aft that cause peaking
by making |A( j f x)| > 1.
8.3 Frequency compensation of op amps
8.21 The μA702 op amp has a0 = 3600 V/V, f1 = 1 MHz, f2 = 4 MHz, and f3 = 40 MHz
and is operated as a unity-gain buffer. Assuming we can change f1 without affecting
f2 and f3, estimate f1(new) for a dominant-pole compensation such that (a) φm = 60◦,
(b) GM = 12 dB, (c) GP = 2 dB, and (d) OS = 5%.

426
CHAPTER 8
Stability
8.22 Consider a negative-feedback loop with dc gain T0 = 103, a dominant pole at 1 kHz,
and a pair of coincident poles at 250 kHz. (a) Verify that with β = 1 this loop is
unstable. (b) To what value must f1 be reduced for φm = 45◦? (c) Another way to
stabilize the circuit is to reduce T0 so that the ensuing downward shift of the magnitude
plot will lower fx to a frequency region of less phase lag. To what value must T0 be
reduced for φm = 45◦? (d) Repeat Parts (b) and (c), but for φm = 60◦.
8.23 An ampliﬁer has dc gain a0 = 105 V/V and three pole frequencies f1 = 100 kHz,
f2 = 1 MHz, and f3 = 10 MHz, arising at three nodes with equivalent resistances R1,
R2, and R3. (a) Use linearized Bode plot reasoning to verify that with β = 1 V/V this
circuit is unstable. (b) One way of stabilizing it is to place a compensating resistance
Rc in parallel with R2 so as to raise f2 and lower a0. Sketch the new Bode plot if
Rc = R2/99, and verify that this causes a two-decade drop in a0 as well as a two-
decade increase in f2. How do fx and φm change? (c) Find the ratio Rc/R2 that results
in φm = 60◦.
8.24 Suppose in Fig. 8.21 the terminals of C1 are inaccessible, but those of C2 are.
Repeat Example 8.5, but for Cc in parallel with C2. Compare with the example and
comment.
8.25 A certain op amp has a0 = 104 V/V, f1 = 1 kHz, and an adjustable pole frequency f2.
Find β and f2 for a maximally ﬂat closed-loop response with a dc gain of 60 dB. What
is its −3-dB frequency?
8.26 A student wants to implement a unity-gain voltage buffer using a voltage comparator
having a dc gain of 104 V/V, a pole frequency of 100 kHz, and a pole pair of 10 MHz.
(a) Use ROC reasoning to verify that the circuit is unstable. (b) Although comparators
are meant for open-loop operation, the student can still stabilize the buffer by creat-
ing a suitable additional dominant pole fd via an external R-C network, as shown in
Fig. P8.26. Find fd for φm = 70◦. Hence, assuming R = 30 k, ﬁnd the required value
of C. What is the expression for T ( j f ) after compensation?
Vo
R
–
+
C
R
CMP
Vi
+
–
FIGURE P8.26
8.27 A student is using three identical CMOS inverters to implement a quick inverting am-
pliﬁer in the manner of Fig. P8.27. Each inverter has gm = 1 mA/V, ro = 20 k, and
an equivalent capacitance C = 1 pF between its output node and ground. (a) Assuming
R2 = 2R1 = 200 k, use ROC reasoning to show that the circuit is unstable. (b) Find a
capacitance Cc that, connected between the output node of I1 and ground, will stabilize
the circuit for φm = 70◦. Verify with PSpice and ﬁnd the actual phase margin and the
closed-loop −3-dB frequency.

427
Problems
R1
R2
Vi
–VS
VS
Vo
I1
I2
I3
+
–
FIGURE P8.27
8.28 Obtain an expression for the gain a1( j f ) = Vo1/Vi of the circuit of Fig. P8.28. Hence,
assuming Rc ≪R1 and Cc ≫C1, prove Eq. (8.23). Hint: Given two real roots such
that ωa ≪ωb, you can approximate (1+s/ωa)×(1+s/ωb) ∼= 1+s/ωa +s2/(ωaωb).
R1
g1Vi
C1
Cc
Rc
Vi
+
–
+
–
Vo1
FIGURE P8.28
8.29 Specify Rc and Cc for pole-zero compensation of the circuit of Fig. 8.18 for φm ∼= 60◦
with β = 0.2. Verify with PSpice.
8.30 Specify Rc and Cc for pole-zero compensation of the circuit of Problem 8.27 with
φm ∼= 60◦.
8.31 Derive Eqs. (8.25) and (8.26). Hint: Apply KCL at nodes V1 and V2, eliminate V1, and
use the hint of Problem 8.28.
8.32 An ampliﬁer with a dc gain of 40,000 V/V and three pole frequencies of 100 kHz,
3 MHz, and 5 MHz is operated with β = 0.5 V/V. (a) Sketch and label the lin-
earized Bode plot of |T | for a visual estimation of fx and φx. Is the circuit unstable?
(b) Given that the ﬁrst two poles are produced at the input and output nodes of an inter-
nal stage that has a dc gain of −200 V/V and input-node and output-node resistances
R1 = 100 k and R2 = 10 k, ﬁnd the capacitance Cc that, connected between the
input and output terminals of this internal stage, stabilizes the circuit for φm = 45◦.
(c)Whatarethevaluesofthisstage’s gm,C1,andC2?Whatarethevaluesofthenewpole
frequencies as well as the RHP zero frequency? Use these values to write an expression
for T ( j f ).
8.33 Consider two ampliﬁers having, respectively, open-loop gains
a1( j f ) =
104(1 + j f/105)
(1 + j f/103)(1 + j f/107)
a2( j f ) =
104(1 −j f/105)
(1 + j f/103)(1 + j f/107)
Sketch and label their linearized Bode plots (magnitude as well as phase). Find the
phase margins for operation with β = 1, compare the two ampliﬁers, and comment on
similarities as well as differences.

428
CHAPTER 8
Stability
8.34 Use a suitable feedback network Rc-Cc across I2 in the circuit of Problem 8.27 to
provide Miller compensation for φm = 75◦and zero removal. Verify with PSpice.
8.35 Two-stage CMOS op amps are notoriously prone to the phase erosion by the RHP
zero. An alternative to using a resistor Rc to remove the offending zero is to exploit
the unidirectionality of a voltage buffer, modeled in Fig. P8.35 by the 1Vo dependent
source. The buffer retains the multiplicative action of the Miller effect while block-
ing forward transmission to the output, thereby removing the RHP zero. Find the gain
a(s) = Vo/Vi, verify that the transmission zero has been moved to inﬁnity, and obtain
approximate expressions for its poles f1 and f2 assuming f1 ≪f2.
R1
g1Vi
Cc
g2V1
V1
C1
Vi
1Vo
+
–
+–
R2
Vo
C2
FIGURE P8.35
8.36 According to PSpice, the closed-loop gain of the feedforward-compensated ampliﬁer of
Fig. 8.32 peaks at 6.593 dB. If we were to Miller-compensate the same ampliﬁer with a
capacitance Cc across the second stage, what Cc value would yield the same closed-loop
peak? Use PSpice to compare the two compensation methods, and comment.
8.4 Op amp circuits with a feedback pole
8.37 The open-loop gain of an internally compensated op amp can be approximated with
a dominant pole frequency f1 and a single high-frequency pole f2 to account for the
phase shift due to its higher-order roots. (a) Assuming a0 = 106 V/V, f1 = 10 Hz, and
β = 1 V/V, ﬁnd the actual bandwidth fB and phase margin φm if f2 = 1 MHz. (b) Find
f2 for φm = 60◦; what is the value of fB? (c) Repeat (b), but for φm = 45◦.
8.38 An op amp with a( j f ) = 105/(1 + j f/10) is placed in a negative-feedback loop with
β( j f ) = β0/(1 + j f/105)2. Find the values of β0 corresponding to (a) the onset of
oscillatory behavior, (b) φm = 45◦, and (c) GM = 20 dB.
8.39 A Howland current pump is implemented with a constant-GBP op amp and four identi-
cal resistances. Using rate-of-closure reasoning, show that as long as the load is resistive
or capacitive the circuit is stable, but can become unstable if the load is inductive. How
would you compensate it?
8.40 An alternative frequency compensation method for the differentiator of Fig. 8.36a is by
means of a suitable feedback capacitance C f in parallel with R. Assuming C = 10 nF,
R = 78.7 k, and GBP = 1 MHz, specify C f for φm = 45◦.
8.41 Show that if a constant-GBP op amp with transition frequency ft is operated in conjunc-
tion with a feedback pole β( j f ) = β0/(1 + j f /f p), then the discrepancy function is,
for f p ≫fb, D( j f ) = HLP with f0 = 
β0 ft f p and Q = 
β0 ft/f p, that is, D( j f )
is the standard second-order low-pass function HLP deﬁned in Eq. (3.44). Clearly, the
lower f p relative to β0 ft, the higher the Q, which provides an alternative way for
visualizing gain peaking as a consequence of inadequate phase margin.

429
Problems
8.42 (a) Use Eq. (8.1), along with the results of Problem 8.41, to prove that the trans-
fer function of the uncompensated differentiator of Fig. 8.36a is H( j f ) = Vo/Vi =
H0BPHBP( j f ), where HBP( j f ) is the standard second-order band-pass function de-
ﬁned in Eq. (3.48). (b) Calculate H0BP, Q, the resonant frequency, and the peak value
of H( j f ), and compare with Fig. 8.37b. (c) Repeat (b), but for the compensated dif-
ferentiator of Fig. 8.38b.
8.43 Derive Eq. (8.32)
8.44 (a) Show that the circuit of Fig. 8.39a gives A = −R2/R1 × HLP, where HLP is the
standard second-order low-pass response deﬁned in Eq. (3.44) with f0 = 
β0 ft fz
and Q = 
β0 ft/fz/(1 + β0 ft/f p). (b) Find Q in the circuit of Example 8.10 be-
fore compensation. (c) Compensate the circuit for φm = 45◦, and ﬁnd Q after
compensation.
8.45 In the circuit of Example 8.10 ﬁnd C f for φm = 60◦; hence, exploit Problem 8.44 to
ﬁnd A( j f ), GP, and OS.
8.46 An alternative way of stabilizing a circuit against stray input capacitance Cn is by scal-
ing down all resistances to raise fz until fz ≥fx. (a) Scale the resistances of the circuit
of Example 8.10 so that with C f = 0 the circuit yields φm = 45◦. (b) Repeat, but for
φm = 60◦. (c) What is the main advantage and disadvantage of this technique?
8.47 The high-sensitivity I-V converter of Fig. 2.2 uses R = 1 M, R1 = 1 k, R2 = 10 k,
and the LF351 JFET-input op amp, which has GBP = 4 MHz. (a) Assuming an overall
input stray capacitance Cn = 10 pF, show that the circuit does not have enough phase
margin. (b) Find a capacitance C f that, when connected between the output and the
inverting input, will provide neutral compensation. What is the closed-loop bandwidth
of the compensated circuit?
8.48 Using an op amp with GBP = 10 MHz and ro = 100 , ﬁnd the maximum CL that can
be connected to the output of the circuit of Fig. 8.45a and still allow for φm ≥45◦if
(a) R1 = R2 = 20 k, (b) R1 = 2 k, R2 = 18 k, (c) R1 = ∞, R2 = 0. (d) Repeat
(c), but for φm ≥60◦.
8.49 Using the op amp data of Problem 8.48, design an ampliﬁer with A0 = +10 V/V, under
the constraint that the sum of all resistances be 200 k, and that it be capable of driving
a 10-nF load. Then use PSpice to verify its frequency and transient responses.
8.50 Assuming constant-GBP op amps, use linearized Bode plots to investigate the stability
of (a) the wideband band-pass ﬁlter of Fig. 3.11, (b) the multiple-feedback low-pass
ﬁlter of Fig. 3.32, and (c) the −KRC low-pass ﬁlter of Problem 3.32.
8.51 (a) Assuming the op amp has a constant GBP of 1 MHz, discuss the stability of the
multiple-feedback band-pass ﬁlter of Fig. 3.31, and verify with PSpice. (b) Repeat, but
for the −KRC band-pass ﬁlter of Problem 3.33 for the case R1 = R2 = 1.607 k,
kR2 = 1.445 M, and C1 = C2 = 3.3 nF.
8.5 Input-Lag and Feedback-Lead Compensation
8.52 Assuming the op amp of Fig. 8.47a has rd = ∞and ro = 0, drive an expression for
the noise gain 1/β( j f ). Provide individual expressions for 1/β0, 1/β∞, f p, and fz.

430
CHAPTER 8
Stability
8.53 An op amp with a0 = 105 V/V, f1 = 10 kHz, f2 = 3 MHz, and f3 = 30 MHz, is to be
used as an inverting ampliﬁer with two 20-k resistances. Use input-lag compensation
to stabilize it for φm = 45◦. Hence, obtain an expression for A( j f ).
8.54 Use input-lag compensation to stabilize the voltage comparator of Problem 8.26 for
voltage-buffer operation with φm = 65◦.
8.55 In Fig. P8.55 let R1 = R2 = R4 = 100 k, R3 = 10 k, and let the op amp have a0 =
105 V/V, f1 = 10 kHz, f2 = 200 kHz, and f3 = 2 MHz. (a) Verify that the circuit is
unstable. (b) Use input-lag compensation to stabilize it for φm = 45◦. (c) Find the
closed-loop bandwidth after compensation.
R1
R2
R3
R4
Vo
+
–
Vi
+
FIGURE P8.55
8.56 A certain decompensated op amp has GBP = 25 MHz for βmax = 0.1 V/V, and is
to be used to implement an I-V converter with a sensitivity of 0.1 V/μA. A designer
is considering two alternatives: one using a 100-k feedback resistor and input-lag
compensation, and the other using a T -network in such a way as to make compensation
unnecessary. Show the two circuit designs, and compare them in terms of closed-loop
bandwidth, output error due to VOS, and dc gain error.
8.57 The OPA637 op amp of Fig. P8.57 is a decompensated ampliﬁer with SR = 135 V/μs
and GBP = 80 MHz for 1/β ≥5 V/V. Since the op amp is not compensated for unity-
gain stability, the integrator shown would be unstable. (a) Show that the circuit can be
stabilized by connecting a compensation capacitance Cc as shown, and ﬁnd a suitable
value for Cc for φm = 45◦. (b) Obtain an expression for H( j f ) after compensation
and indicate the frequency range over which the circuit behaves reasonably well as an
integrator.
R
Vo
+
–
Vi
Cc
C
2.5 kΩ
OPA637
40 pF
+
FIGURE P8.57
8.58 An op amp with GBP = 6 MHz and ro = 30  is to operate as a unity-gain voltage
follower with an output load of 5 nF. Design an input-lag network to stabilize it. Then
verify its frequency and transient responses via PSpice.

431
Problems
8.59 Using a decompensated op amp with GBP = 80 MHz and βmax = 0.2 V/V, design a
unity-gain inverting ampliﬁer, and ﬁnd A( j f ).
8.60 An op amp with a0 = 106 V/V and two coincident pole frequencies f1 = f2 = 10 Hz
is conﬁgured as an inverting ampliﬁer with R1 = 1 k and R2 = 20 k. (a) Use
feedback-lead compensation to stabilize it for φm = 45◦; then ﬁnd A( j f ). (b) Find the
valueofC f thatwillmaximizeφm;nextﬁndφm aswellasthecorrespondingclosed-loop
bandwidth.
8.61 The wideband band-pass ﬁlter of Example 3.5 is implemented with an op amp having
a0 = 105 V/V and two pole frequencies f1 = 10 Hz and f2 = 2 MHz. Sketch the Bode
plots of |a| and |1/β| in the vicinity of fx and ﬁnd φm.
8.6 Stability in CFA circuits
8.62 The CFA integrator of Fig. P8.62 uses a series resistance R2 between the summing
junction and the inverting-input pin to ensure 1/β ≥(1/β)min over frequency and thus
avoid instability problems. (a) Investigate the stability of the circuit using Bode plots.
(b) Assuming the CFA parameters of Problem 6.66, specify suitable components for
f0 = 1 MHz. (c) List possible disadvantages of this circuit.
R
R2
C
+
Vi
Vo
+
–
CFA
FIGURE P8.62
8.63 The CFA of Problem 6.66 is to be used to design a Butterworth band-pass ﬁlter with
f0 = 10 MHz and H0BP = 0 db, and two alternatives are being considered, namely, the
multiple-feedback and the KRC designs. Which conﬁguration are you choosing, and
why? Show the ﬁnal circuit.
8.64 (a) Show that without C f the CFA I-V converter of Fig. 8.54 yields Vo/Ii = RHLP,
where HLP is the standard second-order low-pass response deﬁned in Eq. (3.44) with
f0 = [z0 fb/(2πrn R2Cn)]1/2 and Q = z0 fb/[(rn + R2 f0)]. (b) Predict the GP and OS
for the circuit of Example 8.16 before compensation.
8.65 A certain CFA has rn = 50  and an open-loop dc gain of 1 V/μA, and its frequency
response can be approximated with two pole frequencies, one at 100 kHz and the other
at 100 MHz. The CFA is to be used as a unity-gain voltage follower. (a) Find the feed-
back resistance needed for a phase margin of 45◦; what is the closed-loop bandwidth?
(b) Repeat, but for a 60◦margin.
8.7 Composite ampliﬁers
8.66 (a) With reference to the circuit of Fig. 8.57a, show that φm is maximized for C f =
(1 + R2/R1)3/4/[2π R2( ft1 ft2)1/2]. (b) Show that for φm(max) ≥45◦we must have

432
CHAPTER 8
Stability
1 + R2/R1 ≥tan2 67.5◦= 5.8. (c) Assuming 1-MHz op amps, specify suitable
component values for operation as an inverting ampliﬁer with A0 = −10 V/V and
maximum phase margin. Hence, ﬁnd the actual values of φm and A( j f ).
8.67 (a) Compare the circuit of Example 8.15 with a circuit implemented by cascading two
ampliﬁers with individual dc gains A10 = A20 = √|A0| V/V. (b) Repeat, but for the
circuit of Example 8.16.
8.68 An alternative to Eq. (8.42) is 1+ R4/R3 = √(1 + R2/R1)/2, where we have assumed
ft1 = ft2. (a) Verify that this alternative yields φm ∼= 65◦. (b) Apply it to the design of a
composite ampliﬁer with dc gain A0 = −50 V/V. (c) Assuming ft1 = ft2 = 4.5 MHz,
ﬁnd A( j f ).
8.69 In the composite ampliﬁer of Fig. 8.60 assume OA1 has a10 = 100 V/mV, ft1 = 1 MHz,
VOS1 ∼= 0, and IB1 ∼= 0, and OA2 has a20 = 25 V/mV, ft2 = 500 MHz, VOS2 = 5 mV,
and IB2 = 20 μA. Specify suitable components for A0 = −10 V/V, under the constraint
f2 = 0.1 f1. What is the output dc error EO and the closed-loop bandwidth fB?
8.70 For the circuit of Problem 8.69 ﬁnd the total rms output noise Eno if en1 = 2 nV/
√
Hz,
in1 = 0.5 pA/
√
Hz, en2 = 5 nV/
√
Hz, and in2 = 5 pA/
√
Hz. Ignore 1/f noise. Can
you reduce Eno?
8.71 (a) Find φm, GP, and OS for the composite ampliﬁer of Fig. 8.61. (b) Find its 1◦
phase-error bandwidth, and compare it with that of a single-op-amp realization with
the same value of A0, as well as with that of the cascade realization of two ampliﬁers
with individual dc gains √A0.
8.72 The active-compensation scheme of Fig. P8.72 (see IEEE Trans. Circuits Syst.,
Vol. CAS-26, February 1979, pp. 112–117) works for both the inverting and the nonin-
verting mode of operation of OA1. Show that Vo = [(1/β)V2+(1−1/β)V1]/(1+1/T ),
1/(1 + 1/T ) = (1 + j f/β2 ft2)/(1 + j f/β ft1 −f 2/β ft1β2 ft2), β = R1/(R1 + R2),
β2 = R3/(R3 + R4).
R3
R4
R1
R2
+
+
V1
 V2
Vo
+
–
+
–
OA2
OA1
FIGURE P8.72
8.73 Apply the scheme of Problem 8.72 to the design of a high-phase-accuracy (a) voltage
follower, (b) I-V converter with a sensitivity of 10 V/mA, and (c) difference ampliﬁer
with a dc gain of 100 V/V. Assume matched op amps with ft = 10 MHz.

433
References
REFERENCES
1. J. K. Roberge, Operational Ampliﬁers: Theory and Practice, John Wiley & Sons, New
York, 1975.
2. S. Rosenstark, Feedback Ampliﬁers Principles, Macmillan, New York, 1986.
3. R. C. Dorf and R. H. Bishop, Modern Control Systems, 12th ed., Prentice Hall, Upper
Saddle River, NJ, 2011.
4. R. D. Middlebrook, “Measurement of Loop Gain in Feedback Systems,” Int. J. Elec-
tronics, Vol. 38, No. 4, April 1975, pp. 485–512.
5. P. J. Hurst, “A Comparison of Two Approaches to Feedback Circuit Analysis,” IEEE
Trans. on Education, Vol. 35, No. 3, August 1992, pp. 253–261.
6. R. D. Middlebrook, “The General Feedback Theorem: A Final Solution for Feedback
Systems,” IEEE Microwave Magazine, April 2006, pp. 50–63.
7. M. Tian, V. Visvanathan, J. Hantgan, and K. Kundert, “Striving for Small-Signal Stabil-
ity”, IEEE Circuits and Devices Magazine, Vol. 17, No. 1, January 2001, pp. 31–41.
8. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009.
9. S. Franco, Analog Circuit Design—Discrete and Integrated, McGraw-Hill, New York,
2014.
10. J. G. Graeme, “Phase Compensation Counteracts Op Amp Input Capacitance,” EDN,
Jan. 6, 1994, pp. 97–104.
11. S. Franco, “Simple Techniques Provide Compensation for Capacitive Loads,” EDN,
June 8, 1989, pp. 147–149.
12. Dr. Alf Lundin, private correspondence, September 2003.
13. J. Williams, “High-Speed Ampliﬁer Techniques,” Application Note AN-47, Linear
Applications Handbook Volume II, Linear Technology, Milpitas, CA, 1993.
14. A. P. Brokaw, “An IC Ampliﬁers User’s Guide to Decoupling, Grounding, and Making
Things Go Right for a Change,” Application Note AN-202, Applications Reference
Manual, Analog Devices, Norwood, MA, 1993.
15. A. P. Brokaw, “Analog Signal Handling for High Speed and Accuracy,” Application
Note AN-342, Applications Reference Manual, Analog Devices, Norwood, MA, 1993.
16. J.-H. Broeders, M. Meywes, and B. Baker, “Noise and Interference,” 1996 Design
Seminar, Burr-Brown, Tucson, AZ, 1996.
17. S. Franco, “Demystfying Pole-Zero Doublets,” EDN, Aug. 27, 2013
http://www.edn.com/electronics-blogs/analog-bytes/4420171/Demystifying-pole-zero-
doublets.
18. Based on the author’s article “Current-Feedback Ampliﬁers Beneﬁt High-Speed
Designs,” EDN, Jan. 5, 1989, pp. 161–172. c⃝Cahners Publishing Company, 1997,
a Division of Reed Elsevier Inc.
19. J. Williams, “Composite Ampliﬁers,” Application Note AN-21, Linear Applications
Handbook Volume I, Linear Technology, Milpitas, CA, 1990.
20. J. Graeme, “Phase Compensation Perks Up Composite Ampliﬁers,” Electronic Design,
Aug. 19, 1993, pp. 64–78.
21. J. Graeme, “Composite Ampliﬁer Hikes Precision and Speed,” Electronic Design Analog
Applications Issue, June 24, 1993, pp. 30–38.
22. J. Wong, “Active Feedback Improves Ampliﬁer Phase Accuracy,” EDN, Sept. 17, 1987.

9
NONLINEAR CIRCUITS
9.1 Voltage Comparators
9.2 Comparator Applications
9.3 Schmitt Triggers
9.4 Precision Rectiﬁers
9.5 Analog Switches
9.6 Peak Detectors
9.7 Sample-and-Hold Ampliﬁers
Problems
References
All circuits encountered so far are designed to behave linearly. Linearity is achieved
by (a) using negative feedback to force the op amp to operate within its linear region
and (b) implementing the feedback network with linear elements.
Using a high-gain ampliﬁer with positive feedback, or even with no feedback
at all, causes the device to operate primarily in saturation. This bistable behavior
is highly nonlinear and forms the basis of voltage-comparator and Schmitt-trigger
circuits.
Nonlinear behavior can also be achieved by implementing the feedback network
with nonlinear elements, such as diodes and analog switches. Common examples
include precision rectiﬁers, peak detectors, and sample-and-hold ampliﬁers. Another
class of nonlinear circuits exploits the predictable exponential characteristic of the
BJT to achieve a variety of nonlinear transfer characteristics, such as logarithmic
ampliﬁcation and analog multiplication. This category of nonlinear circuits will be
investigated in Chapter 13.
434

435
SECTION 9.1
Voltage
Comparators
Chapter Highlights
The chapter begins with voltage comparators and their performance characteristics
such as response times and logic levels. It then proceeds to illustrate a variety of
commonapplications:leveldetectors,on/offcontrol,windowcomparators,bargraph
meters, and pulse-width modulation. The comparator part concludes with Schmitt
triggers and their application in comparator chatter elimination and on/off control
with hysteresis.
The second part of the chapter is devoted to diode-based nonlinear circuits
and applications thereof: superdiodes, half-wave and full-wave rectiﬁers, and ac-dc
converters.
The chapter concludes with analog switches, peak detectors, and sample-and-
hold ampliﬁers.
9.1
VOLTAGE COMPARATORS
The function of a voltage comparator is to compare the voltage vP at one of its inputs
against the voltage vN at the other, and output either a low voltage VOL or a high
voltage VOH according to
vO = VOL
for vP < vN
(9.1a)
vO = VOH
for vP > vN
(9.1b)
As shown in Fig. 9.1a, the symbolism used for comparators is the same as for op
amps.WeobservethatwhilevP andvN areanalogvariablesbecausetheycanassume
a continuum of values, vO is a binary variable because it can assume only one of two
values, VOL or VOH. It is fair to view the comparator as a one-bit analog-to-digital
converter.
Introducing the differential input voltage vD = vP −vN, the above equations
can also be expressed as vO = VOL for vD < 0 V, and vO = VOH for vD > 0 V. The
voltage transfer curve (VTC), shown in Fig. 9.1b, is a nonlinear curve. At the origin,
the curve is a vertical segment, indicating an inﬁnite gain there, or vO/vD = ∞. A
practical comparator can only approximate this idealized VTC, with actual gains
vO
vO (V)
vD (V)
+
–
VEE
VCC
VOL
VOH
+
–
vD
vP
vN
0
0
(b)
(a)
CMP
FIGURE 9.1
Voltage-comparator symbolism and ideal VTC. (All
node voltages are referenced to ground.)

436
CHAPTER 9
Nonlinear Circuits
being typically in the range from 103 to 106 V/V. Away from the origin, the VTC
consists of two horizontal lines positioned at vO = VOL and vO = VOH. These levels
need not necessarily be symmetric, though symmetry may be desirable in certain
applications. All that matters is that the two levels be sufﬁciently far apart to make
their distinction reliable. For example, digital applications require VOL ∼= 0 V and
VOH ∼= 5 V.
The Response Time
In high-speed applications it is of interest to know how rapidly a comparator responds
as the input state changes from vP < vN to vP > vN, and vice versa. Comparator
speed is characterized in terms of the response time, also called the propagation delay
tPD, deﬁned as the time it takes for the output to accomplish 50% of its transition in
response to a predetermined voltage step at the input. Figure 9.2 illustrates the setup
for the measurement of tPD. Though the input step magnitude is typically on the
order of 100 mV, its limits are chosen to barely exceed the level required to cause the
output to switch states. This excess voltage is called the input overdrive Vod, with
typical overdrive values being 1 mV, 5 mV, and 10 mV. In general tPD decreases
with Vod. Depending on the particular device and the value of Vod, tPD can range
from a few microseconds to a few nanoseconds.
The Op Amp as a Voltage Comparator
When speed is not critical, an op amp can make an excellent comparator,1 especially
in view of the extremely high gains and low input offsets available from many popular
op amp families. The VTC of a practical op amp was depicted in Fig. 1.46, where we
expressed vD in microvolts in order to be able to visualize the slope of the VTC in
the linear region. In comparator applications vD can be a hefty signal, so it is more
vO
vO 
+
–
Vod
tPD
50%
0
vI
t 
t 
VOL
VOH
(b)
(a)
+
vI
–100 mV
CMP
FIGURE 9.2
The response time of a comparator.

437
SECTION 9.1
Voltage
Comparators
vO
VT
VT 
vO
VT
301
(a)
(b)
(c)
Volts
+
vI
+
vI
vI
vO
t
Vsat
Vsat
–Vsat
–Vsat
+
–
FIGURE 9.3
Threshold detector.
appropriate to express it in volts than in microvolts. If we do so, the horizontal scale
undergoes so much compression that the linear-region portion of the VTC coalesces
with the vertical axis, resulting in a curve of the type of Fig. 9.1b.
The circuit of Fig. 9.3a uses a 301 op amp to compare vI against some voltage
threshold, VT . When vI < VT the circuit gives vO = −Vsat ∼= −13 V, and when
vI > VT it gives vO = +Vsat ∼= +13 V. This is illustrated in the ﬁgure via both the
VTC and the voltage waveforms. Since vO goes high whenever vI rises above VT ,
the circuit is aptly called a threshold detector. If VT = 0 V, the circuit is referred to
as a zero-crossing detector.
It is important to realize that when used as a comparator, the op amp has no
control over vN due to the absence of feedback. The ampliﬁer now operates in the
open-loop mode and, because of its extremely high gain, it spends most of its time
in saturation. Clearly, vN no longer tracks vP!
Though the output transitions in Fig. 9.3c have been shown as instantaneous,
we know that in practice they take some time due to slew-rate limiting. Had we
used a 741 op amp, the time to accomplish 50% of the output transition would have
been tR = Vsat/SR = (13 V)/(0.5 V/μs) = 26 μs, an intolerably long time in
many applications. The reason for using the 301 op amp is that it comes without
the internal frequency-compensation capacitance Cc, so it slews more rapidly than
the 741 op amp. Frequency compensation is indispensable in negative-feedback
applications but is superﬂuous in open-loop applications, where it only slows down
the comparator unnecessarily.
Whether internally compensated or not, op amps are intended for negative-
feedback operation, so their dynamics are not necessarily optimized for open-loop
operation. Moreover, their output saturation levels are generally awkward to interface
to digital circuitry. These and other needs peculiar of the voltage-comparison opera-
tion have provided the motivation for developing a category of high-gain ampliﬁers
speciﬁcally optimized for this operation and thus called voltage comparators.
General-Purpose IC Comparators
Figure 9.4 depicts one of the earliest and most popular voltage comparators, the
LM311. The input stage consists of the pnp emitter followers Q1 and Q2 driving the

438
CHAPTER 9
Nonlinear Circuits
Q1
Q2
IBIAS
Q3
Q4
Q6
Q5
Q10
Q8
Q9
Q7
QO
R5
OUTPUT
GND
8
7
1
10 μA
10 μA
500 μA
500 μA
3
2
4
VEE
vP
vN
VCC
4 Ω
R4
600 Ω
R6
600 Ω
R3
750 Ω
R1
1.2 kΩ
R2
1.2 kΩ
FIGURE 9.4
Simpliﬁed circuit diagram of the LM311 voltage comparator. (Courtesy of Texas
Instruments.)
differential pair Q3-Q4. The output of this pair is further ampliﬁed by the Q5-Q6 pair
and then by the Q7-Q8 pair, from which it emerges as a single-ended current drive
for the base of the output transistor QO. Circuit operation is such that for vP < vN,
Q8 sources substantial current to the base of QO, keeping it in heavy conduction;
for vP > vN, the base drive is removed and QO is thus in cutoff. Summarizing,
QO = Off
for vP > vN
(9.2a)
QO = On
for vP < vN
(9.2b)
The function of Q9 and R5 is to provide overload protection for QO, in the manner
discussed in Section 5.8 for op amps.
When on, QO can draw up to 50 mA of current. When off, it draws a negligi-
ble leakage current of 0.2 nA typical. Both the collector and the emitter terminals
(ignoring R5) are externally accessible to allow for custom biasing of QO. The
most common biasing scheme involves a mere pullup resistance RC, as shown in
Fig. 9.5a. For vP < vN, QO saturates and is thus modeled with a source VCE(sat)
as in Fig 9.5b. So, vO = VEE(logic) + VCE(sat). Typically VCE(sat) ∼= 0.1 V, so we
can approximate
vO = VOL ∼= VEE(logic)
for vP < vN
(9.3a)

439
SECTION 9.1
Voltage
Comparators
+
–
vP
vN
RC
vO
VCC
VEE
VEE(logic)
VCC(logic)
3
2
4
1
8
7
311
+
–
RC
vO
VCE(sat)
VEE(logic)
VCC(logic)
1
7
vP < vN
+
+
–
vP
vN
RC
vO
VEE(logic)
VCC(logic)
1
7
>
(a)
(b)
(c)
FIGURE 9.5
(a) Biasing the LM311 output stage with a pullup resistance RC. Equivalent circuits for the
(b) “output low” and (c) “output high” states.
For vP > vN, QO is in cutoff and is modeled with an open circuit as in Fig. 9.5c.
By the pullup action of Rc we can write
vO = VOH ∼= VCC(logic)
for vP > vN
(9.3b)
The above expressions indicate that the output logic levels are under the con-
trol of the user. For example, letting VCC(logic) = 5 V and VEE(logic) = 0 V provides
TTL and CMOS compatibility. Letting VCC(logic) = 15 V and VEE(logic) = −15 V
yields ±15-V output levels, but without the notorious uncertainties of op amp sat-
uration voltages. The 311 can also operate from a single 5-V logic supply if we let
VCC(logic) = VCC = 5 V and VEE(logic) = VEE = 0 V. In fact, in the single-supply
mode the device is rated to function all the way up to VCC = 36 V.
Figure 9.6a shows another popular biasing scheme, which uses a pulldown
resistance RE to operate QO as an emitter follower. This alternative is useful when
interfacingtogroundedloadssuchassilicon-controlledrectiﬁers(SCRs),anexample
of which will be discussed in Section 11.5. The VTCs for the two biasing schemes
are shown in Fig. 9.6b. Note the opposing polarities of the two curves.
vO
vN
vp
+
–
311
RE
VCC
VEE
VEE (logic)
VCC (logic)
1
4
3
2
8
7
(b)
(a)
FIGURE 9.6
(a) Biasing the LM311 output stage with a pulldown resistance RE. (b) VTC comparison for
pullup and pulldown biasing. (Courtesy of Texas Instruments.)

440
CHAPTER 9
Nonlinear Circuits
FIGURE 9.7
Typical response times of the LM311 comparator. (Courtesy of Texas
Instruments.)
Figure 9.7 shows the response times of the 311 for various input overdrives.
The responses corresponding to Vod = 5 mV are often used for comparing different
devices. Based on the diagrams, we can characterize the 311 as basically a 200-ns
comparator when used with a pullup resistor on the order of a few kilo-ohms.
Like their op amp cousins, voltage comparators suffer from dc input errors
whose effect is to shift the input tripping point by an error
EI = VOS + Rn IN −RpIP
(9.4)
where VOS is the input offset voltage, IN and IP the currents into the inverting- and
noninverting-input pins, and Rn and Rp the external dc resistances seen by the same
pins. A web search for the LM311 data sheets will reveal typical room-temperature
characteristics of VOS = 2 mV, IB = 100 nA (ﬂowing out of the input pins because
of the pnp input BJTs), and IOS = 6 nA. The data sheets show also a scheme for
externally nulling the input offset error.
Another very popular comparator, especially in low-cost single-supply applica-
tions, is the LM339 quad comparator and its derivatives. As shown in Fig. 9.8, its
differential input stage is implemented with the pnp Darlington pairs Q1-Q2 and
Q3-Q4, which result in a low-input-bias current as well as an input voltage range
extending all the way down to 0 V (by contrast, the input voltage range of the LM311
extends only down to VE E + 0.5 V, that is, within 0.5-V of the negative supply rail).
The current mirror Q5-Q6 forms an active load for this stage and also converts to
a single-ended drive for Q7. This transistor provides additional gain as well as the
base drive for the open-collector output transistor QO. The state of QO is controlled
by vP and vN according to Eq. (9.2). Open-collector output stages are suited to
wired-OR operation, just like open-collector TTL gates. When on, QO can sink
16 mA typical, 6 mA minimum; when off, its collector leakage is typically 0.1 nA.
The other pertinent characteristics are, typically, VOS = 2 mV, IB = 25 nA,
and IOS = 5 nA. Moreover, the operating supply range is from 2 V to 36 V, and the
input voltage range is from 0 V to VCC −1.5 V.

441
SECTION 9.1
Voltage
Comparators
vP
vN
QO
Q2
Q3
Q4
Q1
VCC
100
μA
3.5
μA
3.5
μA
100
μA
Q6
Q7
Q5
Out
GND
FIGURE 9.8
Simpliﬁed circuit diagram of the LM339 quad comparator. (Courtesy
of Texas Instruments.)
Comparators are available in a variety of versions, such as duals and quads,
low-power versions, FET-input versions, and rail-to-rail versions. The LMC7211 is
a micropower CMOS comparator with rail-to-rail capabilities both at the input and
at the output; the LMC7221 is similar, but with an open-drain output.
High-Speed Comparators
High-speed data converters, such as ﬂash A-D converters, to be studied in Chapter 12,
rely on the use of commensurately fast voltage comparators. To serve this and similar
needs, very high-speed comparators are available with response times on the order
of 10 ns or less. Such speeds are achieved through circuit techniques and fabrication
processes similar to those of the faster logic families such as Schottky TTL and ECL.
Moreover, to fully realize these capabilities, suitable circuit construction techniques
and power-supply bypass are mandatory on the part of the user.2
These comparators are often equipped with output latch capabilities, which
allow freezing the output state in a latch ﬂip-ﬂop and holding it indeﬁnitely until the
arrival of a new latch-enable command. This feature is especially useful in ﬂash A-D
converters.ThesymbolismandtimingforthesecomparatorsareshowninFig.9.9.To
guarantee proper output data, vD must be valid at least tS ns before the latch-enable
command is asserted, and must remain valid for at least tH ns thereafter, where tS
and tH represent, respectively, the setup and hold times. Popular examples of latch
comparators are the CMP-05 and LT1016. The latter has tS = 5 ns, tH = 3 ns, and
tPD = 10 ns.

442
CHAPTER 9
Nonlinear Circuits
vO
+
–
Vod
VOL
VOH
+
–
vD
vN
vP
LE
LE:
vD:
vO:
Compare
Latch
tH
tS
tPD
0 V
–100 mV
50%
(a)
(b)
CMP
FIGURE 9.9
Comparator with latch enable, and waveforms.
Another useful feature available in some comparators is the strobe control,
which disables the device by forcing its output stage into a high-impedance state.
This feature is designed to facilitate bus interfacing in microprocessor applications.
Finally, for increased ﬂexibility, some comparators provide the output both in true
(Q) and in negated (Q) form.
SPICE Simulation of Comparators
Like their op amp cousins, voltage comparators are most efﬁciently simulated by
means of SPICE macromodels. The PSpice circuit of Fig. 9.10a uses a 339 macro-
model downloaded from the web to display the voltage transfer curve (VTC) of
Fig. 9.10b (note the 28-μV offset of this particular macromodel). Likewise, we can
0
1
2
3
4
−100
−50
0
50
100
5
Input vI (µV)
(b)
Output vO (V)
VCC (+5 V)
2 kΩ
–
+
vI
RC
vO
+
–
LM339
0
0
(a)
0
FIGURE 9.10
(a) PSpice circuit to display (b) the VTC of the 339 voltage comparator.

443
SECTION 9.2
Comparator
Applications
(a)
Time t (µs)
0
5
0
1.8
1.4
1.0
0.6
0.2
0
−100
1.8
1.4
1.0
0.6
0.2
0
vO (V)
vI (mV)
Vod
(b)
vI (mV)
Vod
Time t (µs)
0
5
0
1.8
1.4
1.0
0.6
0.2
0
1.8
1.4
1.0
0.6
0.2
100
Output vO (V)
0
20 mV
100 mV
5 mV
−100 mV
−20 mV
−5 mV
FIGURE 9.11
Response times of the 339 voltage comparator of Fig. 9.10a for different input overdrives.
use the circuit of 9.10a also to display the response times for different overdrives, as
illustrated in Fig. 9.11. As in the case of the 311 comparator, the higher the overdrive,
the shorter the propagation delays.
9.2
COMPARATOR APPLICATIONS
Comparators are used in various phases of signal generation and transmission, as
well as in automatic control and measurement. They appear both alone or as part
of systems, such as A-D converters, switching regulators, function generators, V-F
converters, power-supply supervisors, and a variety of others.
Level Detectors
The function of a level detector, also called a threshold detector, is to monitor a
physical variable that can be expressed in terms of a voltage, and signal whenever
the variable rises above (or drops below) a prescribed value called the set value.
The detector output is then used to undertake a speciﬁc action as demanded by the
application. Typical examples are the activation of a warning indicator, such as a
light-emitting diode (LED) or a buzzer, the turning on of a motor or heater, or the
generation of an interrupt to a microprocessor.
As shown in Fig. 9.12, the basic components of a level detector are: (a) a voltage
reference VREF to establish a stable threshold, (b) a voltage divider R1 and R2 to
scale the input vI , and (c) a comparator. The latter trips whenever vI is such that
[R1/(R1 + R2)]vI = VREF. Denoting this special value of vI as VT , we get
VT = (1 + R2/R1)VREF
(9.5)

444
CHAPTER 9
Nonlinear Circuits
R3
QO
R4
R1
R2
vI
VREF
VCC
+
+
–
FIGURE 9.12
Basic level detector with optical indicator.
For vI < VT , QO is off and so is the LED. For vI > VT , QO saturates and makes the
LED glow, thus providing an indication of when vI rises above VT . Interchanging
the input pins will make the LED glow whenever vI drops below VT . The function
of R3 is to bias the reference diode, and that of R4 is to set the LED current.
EXAMPLE 9.1.
In the circuit of Fig. 9.12 let VREF = 2.0 V, R1 = 20 k, and R2 =
30 k. Assuming a 339 comparator with VOS = 5 mV (maximum) and IB = 250 nA
(maximum), estimate the worst-case error of your circuit.
Solution.
In this circuit, IP has no effect because Rp ∼= 0. Since IN ﬂows out of the
comparator, it raises the inverting-input voltage by (R1 ∥R2)IN = 3 mV (maximum)
when the comparator is about to trip. The worst-case scenario occurs when VOS adds in
the same direction, for a net inverting-input rise of VOS + (R1 ∥R2)IN = 5 + 3 = 8 mV
(maximum). This has the same effect as an 8-mV drop in VREF, giving VT = (1 +
30/20)(2 −0.008) = 4.98 V instead of VT = 5.00 V.
If vI is VCC itself, the circuit will monitor its own power supply and function as
an overvoltage indicator. If the input pins are interchanged with each other so that
vN = VREF and vP = vI /(1 + R2/R1), then we have an undervoltage indicator.
EXAMPLE 9.2.
Using comparators of the 339 type, an LM385 2.5-V reference diode
(IR ∼= 1 mA), and two HLMP-4700 LEDs (ILED ∼= 2 mA and VLED ∼= 1.8 V), design a
circuit that monitors a 12-V car battery and causes the ﬁrst LED to glow whenever the
battery voltage rises above 13 V, and causes the second LED to glow whenever it drops
below 10 V.
Solution. We need two comparators, one for overvoltage and the other for undervoltage
sensing. The comparators share the same reference diode, and in both cases vI is the
battery voltage VCC. For the overvoltage circuit we need 13 = (1+ R2/R1)2.5 and R4 =
(13−1.8)/2; use R1 = 10.0 k and R2 = 42.2 k, both 1%, and R4 = 5.6 k. For the
undervoltage circuit we interchange the input pins, and we impose 10 = (1+ R2/R1)2.5
and R4 = (10 −1.8)/2; use R1 = 10.0 k and R2 = 30.1 k, both 1%, and
R4 = 3.9 k. To bias the reference diode, use R3 = (12 −2.5)/1 ∼= 10 k.

445
SECTION 9.2
Comparator
Applications
+
–
QO
LM395
VCC (10 V to 36 V)
Heater
LM335
V(T)
LM329
6.9 V   
R4
2 kΩ
R5         
 6.2 kΩ
R6
 10 kΩ
R1
R2
R3
FIGURE 9.13
On-off temperature controller.
On-Off Control
Level detection can be applied to any physical variable that can be expressed in terms
of a voltage via a suitable transducer. Typical examples are temperature, pressure,
strain, position, ﬂuidic level, and light or sound intensity. Moreover, the comparator
can be used not only to monitor the variable, but also to control it.
Figure 9.13 shows a simple temperature controller, or thermostat. The compara-
tor, a 339 type, uses the LM335 temperature sensor to monitor temperature, and the
LM395 high-beta power transistor to switch a heater on and off in order to keep tem-
perature at the setpoint established via R2. The LM335 is an active reference diode
designed to produce a temperature-dependent voltage according to V (T ) = T/100,
where T is absolute temperature, in kelvins. The purpose of R5 is to bias the sensor.
For the circuit to work over a wide range of supply voltages, the transducer-bridge
voltage must be stabilized. This function is provided by the LM329 6.9-V reference
diode, which is biased via R4.
The circuit operates as follows. As long as temperature is above the setpoint,
we have vN > vP; QO saturates and keeps the LM395-heater combination off. If,
however, temperature drops below the setpoint, then vN < vP; QO is now in cutoff,
thus diverting the current supplied by R6 to the base of the LM395 transistor. The
latter then saturates, turning the heater fully on.
Both the sensor and the heater are placed inside an oven and can be used, for
instance, to thermostat a quartz crystal. This also forms the basis of substrate thermo-
stating, a technique often used to stabilize the characteristics of voltage references
and log/antilog ampliﬁers. We will see examples in Chapter 11 and 13.
EXAMPLE 9.3. In the circuit of Fig. 9.13 specify suitable resistances so that the set point
can be adjusted anywhere between 50 ◦C and 100 ◦C by means of a 5-k potentiometer.
Solution.
Since V (50 ◦C) = (273.2 + 50)/100 = 3.232 V, and V (100 ◦C) = 3.732 V,
the current through R2 is (3.732 −3.232)/5 = 0.1 mA. Consequently, R3 = 3.232/0.1 =
32.3 k (use 32.4 k, 1%), and R1 = (6.9 −3.732)/0.1 = 31.7 k (use 31.6 k, 1%).

446
CHAPTER 9
Nonlinear Circuits
vI
vI
vO
vO
QO1
QO2
RC
VTH
VTH
VTL
VTL
VCC
VCC
0
0
(a)
(b)
+
–
+
–
FIGURE 9.14
Window detector and its VTC.
Window Detectors
The function of a window detector, also called a window comparator, is to indicate
when a given voltage falls within a speciﬁed band, or window. This function is
implemented with a pair of level detectors, whose thresholds VTL and VTH deﬁne
the lower and upper limits of the window. Referring to Fig. 9.14a, we observe that
as long as VTL < vI < VTH, both QO1 and QO2 are off, so RC pulls vO to VCC to
yield a high output. Should, however, vI fall outside the range, the output BJT of
one of the comparators will go on (QO1 for vI > VTH, QO2 for vI < VTL) and bring
vO near 0 V. Figure 9.14b shows the resulting VTC.
If RC is replaced by an LED in series with a suitable current-limiting resistor,
the LED will glow whenever vI falls outside the window. If we wish the LED to
glow whenever vI falls inside the window, then we must insert an inverting stage
between the comparators and the LED-resistor combination. An inverter example is
offered by the 2N2222 BJT of Fig. 9.15.
The window detector shown monitors whether its own supply voltage is within
tolerance. The top comparator pulls the base of the 2N2222 BJT low whenever VCC
drops below a given lower limit, and the bottom comparator pulls the base low
whenever VCC rises above a given upper limit; in either case the LED is off. For
VCC within tolerance, however, the output BJTs of both comparators are off, letting
R4 turn on the 2N2222 BJT and thus causing the LED to glow.
EXAMPLE 9.4.
Specify suitable component values so that the LED of Fig. 9.15 glows
for VCC within the band 5 V ±5%, which is the band usually required by digital circuits
to work according to speciﬁcation. Assume VLED ∼= 1.5 V, and impose ILED ∼= 10 mA
and IB(2N2222) ∼= 1 mA.
Solution. For VCC = 5 + 5% = 5.25VwewantvN = 2.5Vforthebottomcomparator;
for VCC = 5 −5% = 4.75 V we want vP = 2.5 V for the top comparator. Using the

447
SECTION 9.2
Comparator
Applications
VCC
R2
R1
R4
R6
R5
R3
LM385
2.5 V
3
2
4
5
6
7
12
1
2N2222
1/4
LM339
1/4
LM339
+
–
+
–
FIGURE 9.15
Power-supply monitor; LED glows as long as VCC is within
speciﬁcation.
voltage divider formula twice gives 2.5/5.25 = R1/(R1 + R2 + R3), and 2.5/4.75 =
(R1 + R2)/(R1 + R2 + R3). Let R1 = 10.0 k; then we get R2 = 1.05 k and
R3 = 10.0 k. Moreover, R4 = (5 −0.7)/1 = 4.3 k, R5 = (5 −2.5)/1 ∼= 2.7 k,
and R6 = (5 −1.5)/10 ∼= 330 .
Window comparators are used in production-line testing to sort out circuits that
fail to meet a given tolerance. In this and other automatic test and measurement
applications, VTL and VTH are usually provided by a computer via a pair of D-A
converters.
Bar Graph Meters
A bar graph meter provides a visual indication of the input signal level. The circuit
is a generalization of the window detector in that it partitions the input signal range
into a string of consecutive windows, or steps, and uses a string of comparator-LED
pairs to indicate the window within which the input falls at a given time. The larger
the number of windows, the higher the resolution of the bar display.
Figure 9.16 shows the block diagram of the popular LM3914 bar graph meter.
The upper and lower limits of the signal range are set by the user via the voltages
applied to the reference low (RLO) and the reference high (RHI) input pins. An
internal resistance string partitions this range into ten consecutive windows, and
each comparator causes the corresponding LED to glow whenever vI rises above
the reference voltage available at the corresponding tap. The input level can be

448
CHAPTER 9
Nonlinear Circuits
FIGURE 9.16
The LM3914 dot/bar display driver. (Courtesy of Texas Instruments.)

449
SECTION 9.2
Comparator
Applications
R1
1.21 kΩ
R2
3.83 kΩ
+
vI
VCC  (6.8 V to 18 V)
VLED
V +
V –
Mode
10
9
3
6
7
8
4
LM3914
5
2
11
12
13
14
15
16
17
18
1
RHI
RLO
Ref
1.25 V
Reference
out
ADJ
Sig
in
FIGURE 9.17
0-Vto5-Vbargraphmeter.(CourtesyofTexasInstruments.)
visualized either in bar graph form, or as a moving dot, depending on the logic level
applied at the mode control pin 9.
The circuit also includes an input buffer to prevent loading the external source
and a 1.25-V reference source to facilitate input range programming. With the
connection of Fig. 9.16 the input range is from 0 V to 1.25 V; however, boot-
strapping the reference source, as in Fig. 9.17, expands the upper limit to (1 +
R2/R1)1.25 + R2IADJ, where IADJ is the current ﬂowing out of pin 8. Since
IADJ ∼= 75 μA, specifying R2 in the low-kilohm range will make the R2IADJ
term negligible, so the input range is from 0 V to (1 + R2/R1)1.25 V. A va-
riety of other conﬁgurations are possible, such as multiple-device cascading for
greater resolution, and zero-center meter operation. Consult the data sheets for more
details.
The LM3915 is similar to the LM3914, except that the resistance string values
have been chosen to give 3-dB logarithmic steps. This type of display is intended for
signals with wide dynamic ranges, such as audio level, power, and light intensity.
The LM3916 is similiar to the LM3915, except that the steps are chosen to conﬁgure
the device for VU meter readings, the type of readings commonly used in audio and
radio applications.

450
CHAPTER 9
Nonlinear Circuits
2 V
5 V
1 V
0 V
0 V
10
8
6
4
2
0
vT
vO
Time (ms)
(b)
(a)
VCC (+5 V)
VEE (–5 V)
2 kΩ
–
+
RC
vO
O
vT
LM311
2
8
7
1
4
I
3
T
vI
+
–
0
0
0
+
–
vI
FIGURE 9.18
(a) Using the 311 macromodel to illustrate pulse-width modulation. (b) Waveforms.
Pulse-Width Modulation
If a voltage comparator is made to compare a slowly varying signal vI against
a high-frequency triangular wave vT , the outcome vO is a square wave with the
same frequency as vT , but with its symmetry controlled by vI . This is illustrated in
Fig. 9.18 for the case of a sinusoidal input vI .
The degree of symmetry of vO is expressed via the duty cycle
D(%) = 100
TH
TL + TH
(9.6)
where TL and TH denote, respectively, the times spent by vO in the low and the high
state within a given cycle of vTR. For instance, if vO is high for 0.75 ms and low for
0.25 ms, then D(%) = 100 × 0.75/(0.25 + 0.75) = 75%. It is readily seen that for
the example illustrated we have
D(%) = 100 vI
2 V
(9.7)
indicating that varying vI over the range 0 < vI < 2 V varies D over the range
0% < D < 100%. We can regard vO as a train of pulses whose widths are controlled,
or modulated, by vI . Pulse-width modulation (PWM) ﬁnds application in signal
transmission and power control.
9.3
SCHMITT TRIGGERS
Having investigated the behavior of high-gain ampliﬁers with no feedback, we now
turn to ampliﬁers with positive feedback, also known as Schmitt triggers. While
negative feedback tends to keep the ampliﬁer within the linear region, positive feed-
back forces it into saturation. The two types of feedback are compared in Fig. 9.19.
At power turn-on, both circuits start out with vO = 0. However, any input distur-
bance that might try to force vO away from zero will elicit opposite responses. The

451
SECTION 9.3
Schmitt Triggers
vO
+
–
R1
R2
⇒
⇒
vO
+
–
R1
R2
(a)
(b)
FIGURE 9.19
Mechanical models of (a) negative and (b) positive feedback.
ampliﬁer with negative feedback will tend to neutralize the perturbation and return
to the equilibrium state vO = 0. Not so in the case of positive feedback, for now the
reaction is in the same direction as the perturbation, indicating a tendency to rein-
force rather than neutralize it. The ensuing regenerative effect will drive the ampliﬁer
into saturation, indicating two stable states, namely, vO = VOH and vO = VOL.
In Fig. 9.19 negative feedback is likened to a ball at the bottom of a bowl, and
positive feedback to a ball at the top of a dome. If we shake the bowl to simulate
electronic noise, the ball will eventually return to its equilibrium position at the
bottom, but shaking the dome will cause the ball to fall to either side.
Inverting Schmitt Trigger
The circuit of Fig. 9.20a uses a voltage divider to provide positive dc feedback
around a 301 op amp. The circuit can be viewed as an inverting-type threshold
detector whose threshold is controlled by the output. Since the output has two stable
states, this threshold has two possible values, namely,
VTH =
R1
R1 + R2
VOH
VTL =
R1
R1 + R2
VOL
(9.8)
+
R2
8 kΩ
R1
5 kΩ
vO
VOL
VTL
VTH
VOH
VOH
VTH
VTL
VOL
vO
vP
301
(a)
(b)
(c)
0
Volts
–15 V
15 V
vI
vI
vI
vO
t
+
–
FIGURE 9.20
Inverting Schmitt trigger, VTC, and sample waveforms.

452
CHAPTER 9
Nonlinear Circuits
With the output saturating at ±13 V, the component values shown give VTH = +5 V
and VTL = −5 V, also expressed as VT = ±5 V.
The best way to visualize circuit behavior is by deriving its VTC. Thus, for
vI ≪0, the ampliﬁer saturates at VOH = +13 V, giving vP = VTH = +5 V. Increas-
ing vI moves the operating point along the upper segment of the curve until vI
reaches VTH. At this juncture the regenerative action of positive feedback causes vO
to snap from VOH to VOL as fast as the ampliﬁer can swing. This, in turn, causes vP
to snap from VTH to VTL, or from +5 V to −5 V. If we wish to change the output
state again, we must now lower vI all the way down to vP = VTL = −5 V, at which
juncture vO will snap back to VOH. In summary, as soon as vN = vI approaches
vP = VT , vO and, hence, vP, snap away from vN. This behavior is opposite to that
of negative feedback, where vN tracks vP!
Looking at the VTC of Fig. 9.20b, we observe that when coming from the
left, the threshold is VTH, and when coming from the right it is VTL. This can also
be appreciated from the waveforms of Fig. 9.20c, where it is seen that during the
times of increasing vI the output snaps when vI crosses VTH, but during the times
of decreasing vI it snaps when vI crosses VTL. Note also that the horizontal por-
tions of the VTC can be traveled in either direction, under external control, but the
vertical portions can be traveled only clockwise, under the regenerative effect of
positive feedback.
A VTC with two separate tripping points is said to exhibit hysteresis. The hys-
teresis width is deﬁned as
VT = VTH −VTL
(9.9)
and in the present case can be expressed as
VT =
R1
R1 + R2
(VOH −VOL)
(9.10)
With the component values shown, VT = 10 V. If desired, VT can be varied
by changing the ratio R1/R2. Decreasing this ratio will bring VTH and VTL closer
together until, in the limit R1/R2 →0, the two vertical segments coalesce at the
origin. The circuit is then an inverting zero-crossing detector.
Noninverting Schmitt Trigger
The circuit of Fig. 9.21a is similar to that of Fig. 9.20a, except that vI is now applied
at the noninverting side. For vI ≪0, the output will saturate at VOL. If we want vO
to switch state, we must raise vI to a high enough value to bring vP to cross vN = 0,
since this is when the comparator trips. This value of vI , aptly denoted as VTH, must
be such that (VTH −0)/R1 = (0 −VOL)/R2, or
VTH = −R1
R2
VOL
(9.11a)
Once vO has snapped to VOH, vI must be lowered if we want vO to snap back to
VOL. The tripping voltage VTL is such that (VOH −0)/R2 = (0 −VTL)/R1, or
VTL = −R1
R2
VOH
(9.11b)

453
SECTION 9.3
Schmitt Triggers
vO
VOL
VTL
VTH
VOH
VOH
VTH
VTL
VOL
vO
vP
vN
301
(a)
(b)
(c)
0
Volts
–15 V
15 V
+
vI
vI
vI
vO
t
R2
13 kΩ
R1
5 kΩ
+
–
FIGURE 9.21
Noninverting Schmitt trigger, VTC, and sample waveforms.
The resulting VTC, shown in Fig. 9.21b, differs from that of Fig. 9.20b in that
the vertical segments are traveled in the counterclockwise direction. The output
waveform is similar to that of the inverting Schmitt trigger, except for a reversal in
polarity. The hysteresis width is now
VT = R1
R2
(VOH −VOL)
(9.12)
and it can be varied by changing the ratio R1/R2. In the limit R1/R2 →0 we obtain
a noninverting zero-crossing detector.
VTC Offsetting
In single-supply Schmitt triggers the need arises to offset the VTC so that it lies
entirely within the ﬁrst quadrant. The circuit of Fig. 9.22a achieves the positive
vO
VOH
VOL
vI
VTH
VTL
vP
+
–
R4
R2
R1
R3
VCC
vO
vI
+
(a)
(b)
FIGURE 9.22
Single-supply inverting Schmitt trigger.

454
CHAPTER 9
Nonlinear Circuits
offset depicted in Fig. 9.22b by using a pullup resistance R2. To ﬁnd suitable design
equations, we apply the superposition principle and write
vP =
R1 ∥R3
(R1 ∥R3) + R2
VCC +
R1 ∥R2
(R1 ∥R2) + R3
vO
As we know, the circuit gives VOL ∼= 0 V. To achieve VOH ∼= VCC, we specify R4 ≪
R3 + (R1 ∥R2). Then, imposing vP = VTL for vO = VOL = 0, and vP = VTH for
vO = VOH = VCC, we get
VTL =
R1 ∥R3
(R1 ∥R3) + R2
VCC
VTH =
R1
R1 + (R2 ∥R3)VCC
Rearranging gives
1
R2
=
VTL
VCC −VTL
 1
R1
+ 1
R3

1
R1
= VCC −VTH
VTH
 1
R2
+ 1
R3

(9.13)
Since we have two equations and four unknown resistances, we ﬁx two, say, R4 and
R3 ≫R4, and then solve for the other two.
EXAMPLE 9.5.
Let the comparator of Fig. 9.22a be the LM339 type with VCC = 5 V.
Specify suitable resistances for VOL = 0 V, VOH = 5 V, VTL = 1.5 V, and VTH = 2.5 V.
Solution.
Let R4 = 2.2 k (a reasonable value) and let R3 = 100 k (which is
much greater than 2.2 k). Then, 1/R2 = (1.5/3.5)(1/R1 +1/100) and 1/R1 = 1/R2 +
1/100. Solving yields R1 = 40 k (use 39 k) and R2 = 66.7 k (use 68 k).
Figure 9.23a shows the noninverting realization of the single-supply Schmitt
trigger. Here, the function of R1 and R2 is to provide a suitable bias for vN. Imposing
R5 ≪R3 + R4 to ensure VOH ∼= VCC, and following a similar line of reasoning,
one can readily show (see Problem 9.10) that
R3
R4
= VTH −VTL
VCC
R2
R1
= VCC −VTL
VTH
(9.14)
These equations are used to achieve the desired VTL and VTH.
vO
VOH
VOL
vI
VTH
VTL
vN
+
–
R5
R2
R1
R3
vP
R4
VCC
vO
vI
+
(a)
(b)
FIGURE 9.23
Single-supply noninverting Schmitt trigger.

455
SECTION 9.3
Schmitt Triggers
VOH
VOL
(b)
0
Volts
vI
vO
t
+
vO
(a)
vI
+
–
CMP
FIGURE 9.24
Comparator chatter.
Eliminating Comparator Chatter
When processing slowly varying signals, comparators tend to produce multiple out-
put transitions, or bounces, as the input crosses the threshold region. Figure 9.24
shows an example. Referred to as comparator chatter, these bounces are due to
ac noise invariably superimposed on the input signal, especially in industrial envi-
ronments. As this signal crosses the threshold region, noise is ampliﬁed with the
full open-loop gain, causing output chatter. For instance, the LM311 comparator,
whose gain is typically 200 V/mV, requires an input noise spike of only
(5/200,000) = 25 μV to cause a 5-V output swing. Chatter is unacceptable in
counter-based applications.
The problem is eliminated with the help of hysteresis, as shown in Fig. 9.25. In
this case, as soon as vI crosses the present threshold, the circuit snaps and activates
the other threshold, so vI must swing back to the new threshold in order to make
vO snap again. Making the hysteresis width greater than the maximum peak-to-peak
amplitude of noise prevents spurious output transitions.
VOH
VOL
(b)
0
Volts
vI
vO
t
+
vO
(a)
vI
+
–
VTH
VTL
R2
R1
CMP
FIGURE 9.25
Using hysteresis to eliminate chatter.

456
CHAPTER 9
Nonlinear Circuits
Even in situations where the input signal is relatively clean, it always pays to
introduce a small amount of hysteresis, say, a few millivolts, to stave off poten-
tial oscillations due to stray ac feedback caused by parasitic capacitances and the
distributed impedances of the power-supply and ground busses. This stabilization
technique is particularly important in ﬂash A-D converters.
Hysteresis in On-Off Controllers
Hysteresis is used in on-off control to avoid overfrequent cycling of pumps, fur-
naces, and motors. Consider, for instance, the temperature controller discussed in
connection with Fig. 9.13. We can easily turn it into a home thermostat by having the
comparator drive a power switch like a relay or a triac to turn a home furnace on or
off. Starting with temperatures below the setpoint, the comparator will activate the
furnace and cause the temperature to rise. This rise is monitored by the temperature
sensor and conveyed to the comparator in the form of an increasing voltage. As
soon as the temperature reaches the setpoint, the comparator will trip and shut off
the furnace. However, the smallest temperature drop following furnace shut off will
sufﬁce to trip the comparator back to the active state. As a result, the furnace will be
cycled on and off at a rapid pace, a very taxing affair.
In general, temperature need not be regulated to such a sharp degree. Allowing
a hysteresis of a few degrees will still ensure a comfortable environment and yet
reduce furnace cycling signiﬁcantly. This we achieve by providing a small amount
of hysteresis.
EXAMPLE 9.6. Modify the temperature controller of Example 9.3 to ensure a hysteresis
of about ±1 ◦C. The LM395 power BJT has typically VBE(on) = 0.9 V.
Solution.
Connect a positive-feedback resistance RF between the output vO and the
noninverting input vP of the comparator, so that vP = vO RW/(RW + RF), where
RW is the equivalent resistance presented to RF by the wiper. With the wiper in the
middle, RW = (R1 + R2/2)∥(R3 + R2/2) = 17.2 k. Using vO = 0.9 V and
vP = ±1 × 10 mV = 20 mV, and solving, we get RF ∼= 750 k.
9.4
PRECISION RECTIFIERS
A half-wave rectiﬁer (HWR) is a circuit that passes only the positive (or only the
negative) portion of a wave, while blocking out the other portion. The transfer
characteristic of the positive HWR, pictured in Fig. 9.26a, is
vO = vI
for vI > 0
(9.15a)
vO = 0
for vI < 0
(9.15b)
A full-wave rectiﬁer (FWR), besides passing the positive portion, inverts and then
passes also the negative portion. Its transfer characteristic, depicted in Fig. 9.26b, is
vO = vI for vI > 0, and vO = −vI for vI < 0, or, more concisely,
vO = |vI |
(9.16)
An FWR is also referred to as an absolute-value circuit.

457
SECTION 9.4
Precision
Rectiﬁers
vO
vI
vO
vI
(a)
(b)
FIGURE 9.26
Half-wave rectiﬁer (HWR) and full-wave rectiﬁer (FWR).
Rectiﬁers are implemented using nonlinear devices such as diodes. The nonzero
forward-voltage drop VD(on) of a practical diode may cause intolerable errors in low-
level signal rectiﬁcation. As we shall see, this shortcoming is avoided by placing the
diode inside the negative-feedback path of an op amp.
Half-Wave Rectiﬁers
The analysis of the circuit of Fig. 9.27 is facilitated if we consider the cases vI > 0
and vI < 0 separately.
1. vI > 0: In response to a positive input, the op amp output vOA will also swing
positive, turning on the diode and thus creating the negative-feedback path shown
in Fig. 9.28a. This allows us to apply the virtual-short principle and write vO =
vI . We observe that to make vO track vI , the op amp rides its output a diode
drop above vO, that is, vOA = vO + VD(on) ∼= vO + 0.7 V. Placing the diode
within the feedback loop in effect eliminates any errors due to its forward-voltage
drop. To emphasize this dramatic effect of negative feedback, the diode-op amp
combination is referred to as a superdiode.
2. vI < 0: Now the op amp output swings negative, turning the diode off and
thus causing the current through R to go to zero. Hence, vO = 0. As pictured
in Fig. 9.28b, the op amp is now operating in the open-loop mode, and since
vP < vN, the output saturates at vOA = VOL. With VEE = −15 V, vOA ∼= −13 V.
vO
+
–
OA
R
+
vI
D
Superdiode
FIGURE 9.27
Basic half-wave rectiﬁer.

458
CHAPTER 9
Nonlinear Circuits
+
vI > 0
vO = vI 
+
–
OA  
+
R
+
vI < 0
vO = 0
+
–
OA
R
VOL
vOA
VD(on)
(a)
(b) 
FIGURE 9.28
Equivalent circuits of the basic HWR for (a) positive and (b) negative inputs.
A disadvantage of this circuit is that when vI changes from negative to positive,
the op amp output has to come out of saturation and then swing all the way from
vOA = VOL ∼= −13 V to vOA ∼= vI + 0.7 V in order to close the feedback loop.
All this takes time, and if vI has changed appreciably meanwhile, vO may exhibit
intolerable distortion. The improved HWR of Fig. 9.29aalleviates this inconvenience
by using a second diode to clamp the negative saturation level just a diode drop below
ground. Proceeding as usual, we identify two cases:
1. vI > 0: A positive input causes D1 to conduct, thus creating a negative-feedback
path around the op amp. By the virtual-ground principle we have vN = 0, indi-
cating that D1 now clamps the op amp output at vOA = −VD1(on). Moreover, D2
is off, so no current ﬂows through R2 and, hence, vO = 0.
2. vI < 0: A negative input causes the op amp output to swing positive, thus turning
D2 on. This creates an alternative negative-feedback path via D2 and R2, which
still ensures vN = 0. Clearly, D1 is now off, so the current sourced by the op amp
to R2 must equal the current sunk by vI from R1, or (vO −0)/R2 = (0−vI )/R1.
This gives vO = (−R2/R1)vI . Moreover, vOA = vO + VD2(on).
Circuit behavior is summarized as
vO = 0
for vI > 0
(9.17a)
vO = −(R2/R1)vI
for vI < 0
(9.17b)
R1
vI
+
–
OA
R2
vO
D2
D1
vO
vI
–R2/R1
   
(a)
(b)  
+
FIGURE 9.29
Improved HWR and its VTC.

459
SECTION 9.4
Precision
Rectiﬁers
and the VTC is shown in Fig. 9.29b. In words, the circuit acts as an inverting HWR
with gain. The op amp output vOA still rides a diode drop above vO when vO > 0;
however, when vO = 0, vOA is clamped at about −0.7 V, that is, within the linear
region. Consequently, the absence of saturation-related delays and the reduced output
voltage swing result in much improved dynamics.
Full-Wave Rectiﬁers
One way of synthesizing the absolute value of a signal is by combining the signal
itself with its inverted half-wave rectiﬁed version in a 1-to-2 ratio, as shown in
Fig. 9.30. Here OA1 provides inverting half-wave rectiﬁcation, and OA2 sums vI and
the HWR output vHW in a 1-to-2 ratio to give vO = −(R5/R4)vI −(R5/R3)vHW.
Considering that vHW = −(R2/R1)vI for vI > 0, and vHW = 0 for vI < 0, we can
write
vO = ApvI
for vI > 0 V
(9.18a)
vO = −AnvI
for vI < 0 V
(9.18b)
where
An = R5
R4
Ap = R2R5
R1R3
−An
(9.19)
We want both halves of the input wave to be ampliﬁed by the same gain Ap = An =
A, for then we can write vO = AvI for vI > 0 and vO = −AvI for vI < 0, or,
concisely,
vO = A|vI |
(9.20)
One way of achieving this goal is by imposing R1 = R2 = R4 = R, R3 = R/2,
and R5 = AR, as shown; then, A = R5/R.
Because of resistance tolerances, Ap and An will generally differ from each
other. Their difference
Ap −An = R2R5
R1R3
−2 R5
R4
R4 = R
R2 = R
R1 = R
R3 = R/2
R5 = AR
D2
D1
+
vI
vO
+
–
OA2
vHW
+
–
OA1
FIGURE 9.30
Precision FWR, or absolute-value circuit.

460
CHAPTER 9
Nonlinear Circuits
is maximized when R2 and R4 are maximized and R1 and R3 are minimized. (R5
can be ignored since it appears in both terms.) Denoting percentage tolerance as p
and substituting R2 = R4 = R(1 + p) and R1 = 2R3 = R(1 −p) gives
|Ap −An|max = 2A
 1 + p
(1 −p)2 −
1
1 + p

where A = R5/R. For p ≪1 we can ignore higher-order powers of p and use
the approximations (1 ± p)−1 ∼= (1 ∓p). This allows us to estimate the maximum
percentage difference between Ap and An as
100

Ap −An
A
max
∼= 800p
For instance, with 1% resistances, Ap and An may differ from each other by as
much as about 800 × 0.01 = 8%. To minimize this error, we can either use more
precise resistors, such as laser-trimmed IC resistor arrays, or trim one of the ﬁrst
four resistors, say, R2.
The alternative FWR realization of Fig. 9.31 requires only two matched resistors.
For vI > 0, D1 is on, allowing OA1 to keep its inverting input at virtual ground.
With the output of OA1 clamped at −VD1(on), D2 is off, allowing R4 to transmit vI
to OA2. The latter, acting as a noninverting ampliﬁer, gives vO = ApvI ,
Ap = 1 + R3
R2
For vI < 0, D1 is off and D2 is forward biased by R4. OA1 still keeps its inverting
input at virtual ground, but via the feedback path D2-OA2-R3-R2. By KCL, (0−vI )/
R1 = (vO −0)/(R2 + R3), or vO = −AnvI ,
An = R2 + R3
R1
Imposing Ap = An = A allows us to write concisely vO = A|vI |. This condition
is met by imposing R1 = R2 = R and R3 = (A −1)R, as shown. Clearly, only two
matched resistances are needed.
R4
D2
D1
vO
+
–
OA2
+
vI
+
–
OA1
R2 = R
R3 = (A – 1)R
R1 = R
FIGURE 9.31
FWR using only two matched resistors.

461
SECTION 9.4
Precision
Rectiﬁers
Ac-dc Converters
The most common application of precision absolute-value circuits is ac-dc conver-
sion, that is, the generation of a dc voltage proportional to the amplitude of a given ac
wave. To accomplish this task, the ac signal is ﬁrst full-wave rectiﬁed, and then low-
pass ﬁltered to synthesize a dc voltage. This voltage is the average of the rectiﬁed
wave,
Vavg = 1
T
 T
0
|v(t)| dt
where v(t) is the ac wave and T is its period. Substituting v(t) = Vm sin(2πft),
where Vm is the peak amplitude and f = 1/T is the frequency, gives
Vavg = (2/π)Vm = 0.637Vm
An ac-dc converter is calibrated so that when fed with an ac signal it gives its
root-mean-square (rms) value,
Vrms =

1
T
 T
0
v2(t) dt
1/2
Substituting v(t) = Vm sin(2πft) and integrating gives
Vrms = Vm/
√
2 = 0.707Vm
The relationships between average and rms values and peak value are depicted in
Fig. 9.32a. These relationships, which hold for sinusoidal waves but not necessarily
for other waveforms, indicate that in order to obtain Vrms from Vavg, we need to
multiply the latter by (1/
√
2)/(2/π) = 1.11. The complete block diagram of an
ac-dc converter is thus as in Fig. 9.32b.
Figure 9.33 shows a practical ac-dc converter implementation. The gain of
1.11 V/V is adjusted by means of the 50-k pot, and the capacitance provides
low-pass ﬁltering with cutoff frequency f0 = 1/2π R5C, where R5 is the net resis-
tance in parallel with C, or 1.11 × 200 = 222 k. Hence, f0 = 0.717 Hz. Using
the LT1122 fast-settling JFET-input op amps allows the circuit to process a 10-V
peak-to-peak ac signal with a 2-MHz bandwidth.
v(t)
Vm
Vrms
Vavg
 1.11
Amp
LPF
FWR
dc
ac
(a)
(b)
t
100%
70.7%
63.7%
FIGURE 9.32
(a) Relationship between Vrms and Vm, and between Vavg and Vm. (b) Block diagram of an
ac-dc converter.

462
CHAPTER 9
Nonlinear Circuits
20 kΩ
100 kΩ
20 kΩ
vO
+
–
+
vI
+
–
LT1122
LT1122
1N4148
1N4148
200 kΩ
50 kΩ
200 kΩ
1 kΩ
1 F
C
μ
FIGURE 9.33
Wideband ac-dc converter.
The capacitance must be sufﬁciently large to keep the residual output ripple
within speciﬁed limits. This requires that f0 be well below the minimum operating
frequency fmin. Since an FWR doubles the frequency, the criterion for specifying C
becomes
C ≫
1
4π R5 fmin
As a conservative rule of thumb, C should exceed the right-hand term by the inverse
of the fractional ripple error that can be tolerated at the output. For instance, for a 1%
ripple error, C should be about 1/0.01 = 100 times as large as the right-hand term.
To remain within this error all the way down to the low end of the audio range, so
that fmin = 20 Hz, the above circuit would require C = 100/(4π × 222 × 103 ×
20) ∼= 1.8 μF.
9.5
ANALOG SWITCHES
Many circuits require electronic switches, that is, switches whose state is voltage-
programmable. Chopper ampliﬁers, D-A converters, function generators, S/H ampli-
ﬁers, and switching power supplies are common examples. Switches are also used to
route signals in data acquisition systems, and to reconﬁgure circuits in programmable
instrumentation.
As depicted in Fig. 9.34a, SW closes or opens, depending on the logic level at
the control input C/O. When SW is closed, it drops zero voltage regardless of the
current, and when SW is open, it draws zero current regardless of the voltage, thus
giving the characteristic of Fig. 9.34b. This behavior can be approximated by any
device capable of high on-off resistance ratios, such as ﬁeld-effect transistors (FETs).
An FET acts as a variable resistor called channel, whose resistance is controlled by
the voltage applied between a control terminal called gate G and one of the channel
terminals. These terminals, called source S and drain D, are usually interchangeable
because the FET structure is symmetric.

463
SECTION 9.5
Analog Switches
+
–
v
i
i
v
SW
C/O
Closed (C/O = H)
Open (C/O = L)
(a)
(b)
FIGURE 9.34
Ideal switch and its i-v characteristics.
JFET Switches
Figure 9.35 shows the characteristics of the n-channel JFET, or n-JFET for short.
Each curve represents the i-v characteristic of the channel for a different value of
the control voltage vGS applied between gate and source. For vGS = 0 the channel
is highly conductive, this being the reason why JFETs are said to be normally on
devices. Making vGS progressively more negative reduces channel conductivity until
a cutoff threshold VGS(off) < 0 is reached, such that for vGS ≤VGS(off) conductivity
drops to zero and the channel acts as an open circuit. VGS(off) is typically in the
range of −0.5 V to −10 V, depending on the device.
In switch applications we are interested only in two curves, the ones correspond-
ing to vGS = 0 and vGS ≤VGS(off). The former is highly nonlinear; however, when
the channel is used as a closed switch, its operation is near vDS = 0 V, where the
curve is fairly steep and linear. The slope is inversely proportional to a resistance
rds(on) called the dynamic resistance of the channel,
diD
dvDS
=
1
rds(on)
(9.21)
For ideal switch operation, this resistance should be zero; in practice, it is typi-
cally in the range of 102  or less, depending on the device type.
+
–
vDS
vDS
vDS
vGS = 0
vGS = 0
vGS
iD
iD
iD
+
–
vGS
D
G
S
(a)
(b)
(c)
VGS (off)
vGS ≤
VGS (off)
vGS ≤
Decr.
1/rds(on)
FIGURE 9.35
The n-channel JFET (VGS(off) < 0), and its i-v characteristics.

464
CHAPTER 9
Nonlinear Circuits
R3
R1
J1
R4
Q2
+
SW
SW
+
vI
+
vI
RL
RL
2 kΩ
R2
D1
3.3 kΩ
2  kΩ
100  kΩ
2N4391
2N2222
Driver
1N4148
G
D
S
Q1
2N2927
+15 V
–15 V
5 V
O/C
O/C   
0 V
On
Off
⇒
(a)
(b)
FIGURE 9.36
The n-channel JFET as a switch.
When the channel is off, its resistance is virtually inﬁnite. The only currents
of potential concern in this case are the leakage currents, namely, the drain cutoff
current ID(off) and the gate reverse current IGSS. At ambient temperature these
currents are typically in the picoampere range; however, they double with about
every 10 ◦C increase. This can be of concern in certain applications, as we shall see.
A popular n-JFET switch is the 2N4391 (Siliconix), whose room-temperature
ratings are: −4 V ≤VGS(off) ≤−10 V, rds(on) ≤30 , ID(off) ≤100 pA, IGSS ≤
100 pA ﬂowing out of the gate, turn-on delay ≤15 ns, and turn-off delay ≤20 ns.
Figure 9.36 illustrates a typical switch application. The function of the switch is to
provide a make/break connection between a source vI and a load RL, whereas the
function of the switch driver is to translate the TTL-compatible logic command O/C
to the proper gate drive.
With O/C low (∼= 0 V), the E-B junction of Q1 is off, so both Q1 and Q2 are
off. By the pullup action of R2, D1 is reverse-biased, allowing R1 to keep the gate
at the same potential as the channel. We thus have vGS = 0 regardless of vI , so the
switch is heavily on.
With O/C high (∼= 5 V), Q1 conducts and forces Q2 to saturate, thus pulling the
gate close to −15 V. With a gate voltage this negative, the switch is off. To prevent
J1 from inadvertently going on, we must limit vI in the negative direction,
vI (min) = VEE + VCE2(sat) + VD1(on) −VGS(off)
(9.22)
For instance, with VGS(off) = −4 V we obtain vI (min) ∼= −15+0.1+0.7−(−4) ∼=
−10 V, indicating that the circuit will operate properly only as long as the input is
above −10 V.

465
SECTION 9.5
Analog Switches
J1
J2
D1
+
vI
R
R
5 V
O/C
0 V
Off
On
vO
+
–
FIGURE 9.37
Analog ground switch using p-channel JFETs.
For high-speed operation,2 connect a 100-pF capacitor between the control
input and the base of Q2 to speed up the turn-on and turn-off times of Q2, and an
HP2810 Schottky diode between the base and collector of Q2 (anode at the base) to
eliminate the storage delay of Q2. JFET drivers as well as JFET-driver combinations
are available in IC form from a variety of manufacturers.
The conﬁguration of Fig. 9.36 requires a dedicated driver because the switch
must ride with the signal vI . If the switch is allowed to remain at a nearly constant
potential, such as the virtual-ground potential of an op amp, then the driver can be
simpliﬁed or even eliminated, as the conﬁguration of Fig. 9.37 shows. Referred to as
analog ground switch or current switch, this conﬁguration uses a p-JFET designed
for direct compatibility with standard logic levels. The p-JFET is similar to the
n-JFET, except that the cutoff voltage is now positive, or VGS(off) > 0. Moreover,
the fabrication of p-JFETs is compatible with low-cost bipolar technology. The
switch operates as follows.
When the control input O/C is low, we have vGS1 ∼= 0, indicating that J1 is
heavily on. To compensate for the presence of rds1(on), a dummy JFET J2 is used
in the feedback path of the op amp with the gate and source tied together to keep it
permanently on. J1 and J2 are matched devices to ensure rds2(on) = rds1(on) and,
hence, vO/vI = −1 V/V.
When O/C is high, or vGS1 > VGS1(off), J1 is off and signal propagation is thus
inhibited, so now vO/vI = 0. D1 provides a clamping function to prevent the channel
from inadvertently turning on during the positive alternations of vI . Summarizing,
the circuit provides unity gain when O/C is low, and zero gain when O/C is high.
The principle of Fig. 9.37 is especially useful in summing-ampliﬁer applications.
Replicating the input resistor-diode-switch combination k times gives a k-channel
analog multiplexer, a device widely used in data acquisition and audio signal switch-
ing. The AH5010 quad switch consists of four p-FET switches and relative diode
clamps plus a dummy FET in the same package. With an external op amp and ﬁve
resistors, one can implement a four-channel multiplexer, and by cascading multiple
AH5010s, one can expand to virtually any number of channels.
MOSFET Switches
Since MOS technology forms the basis of digital VLSI, MOS switches are partic-
ularly attractive when analog and digital functions must coexist on the same chip.
MOSFETs are available both in normally on, or depletion, versions, and in normally

466
CHAPTER 9
Nonlinear Circuits
+
–
vDS
vDS
vDS
vGS
iD
iD
iD
+
–
vGS
D
G
S
(a)
(b)
(c)
VGS(on)
vGS ≤
VGS(on)
vGS >>
VGS(on)
vGS >>
VGS(on)
vGS ≤
Incr.
1/rds(on)
FIGURE 9.38
The enhancement n-channel MOSFET (VGS(on) > 0), and its i-v characteristics.
off, or enhancement, versions. The latter are by far the most common, since they
form the basis of CMOS technology.
Figure 9.38 shows the characteristics of the enhancement n-channel MOSFET,
or n-MOSFET, for short. Its behavior is similar to that of the n-JFET, except that
with vGS = 0 the device is off. To make the channel conductive, vGS must be raised
above some threshold VGS(on) > 0; the greater vGS compared to VGS(on), the more
conductive the channel. When operated in a virtual-ground arrangement of the type
of Fig. 9.37, an n-MOSFET opens when the gate voltage is low and closes when the
gate voltage is high.
If the n-MOSFET is connected in a ﬂoating arrangement of the type of Fig. 9.36,
the on-state conductivity is no longer uniformly high, but varies with vI since vGS
itself is a function of vI . The channel is much less conductive during positive
than during negative alternations of vI , and for sufﬁciently positive values of
vI it may actually turn off. These drawbacks are eliminated by using a pair of
complementary MOS (CMOS) FETs, one handling the negative and the other the
positive alternations of vI . The former is an enhancement n-MOSFET, and the
latter an enhancement p-MOSFET, whose characteristics are similar to those of
the n-MOSFET, except that the turn-on threshold is now negative. So, to make a
p-MOSFET conductive, we need vGS < VGS(on) < 0; the lower vGS compared to
VGS(on), the more conductive the channel. For proper operation, the p-MOSFET
must be driven in antiphase with respect to the n-MOSFET. As shown in Fig. 9.39a
for the case of symmetric power supplies, this drive is provided by an ordinary CMOS
inverter.
When C/O is high, the gate of n-MOSFET Mn is high and that of p-MOSFET Mp
is low, turning both devices on. As depicted in Fig. 9.39b, Mn offers low resistance
only over the lower portion of the signal range, and Mp only over the upper portion.
However, as a team, they offer a combined parallel resistance that is reasonably low
throughout the entire range VSS ≤vI ≤VDD. Finally, when C/O is low, both FETs
are off and signal transmission is inhibited.
Also called a transmission gate, the basic conﬁguration of Fig. 9.39a is avail-
able in a variety of versions and performance ratings. Two of the oldest exam-
ples are the CD4066 quad bilateral switch and the CD4051 eight-channel
multiplexer/demultiplexer, originally introduced by RCA. The 4051 also provides

467
SECTION 9.6
Peak Detectors
0
Parallel resistance
rds(on)
VDD
VDD
VDD
VSS
VSS
VSS
VSS
VDD
Mn
Mp
Mp
Mn
vI
+
vI
C/O
On
Off
RL
(b)
(a)
FIGURE 9.39
CMOS transmission gate and its dynamic resistance as a function of vI.
logic-level translation to allow the switches to work with bipolar analog signals
while accepting unipolar logic levels. A wide variety of other MOS-switch products
can be found by consulting the data books.
9.6
PEAK DETECTORS
The function of a peak detector is to capture the peak value of the input and yield
vO = vI (peak). To achieve this goal, vO is made to track vI until the peak value is
reached. This value is then held until a new, larger peak comes along, in which case
the circuit will update vO to the new peak value. Figure 9.40a shows an example of
input and output waveforms. Peak detectors ﬁnd application in test and measurement
instrumentation.
From the above description we identify the following four blocks: (a) an analog
memory to hold the value of the most recent peak—this is the capacitor, whose
ability to store charge makes it act as a voltage memory, as per V = Q/C; (b) a
D2
D1
+
vI
vI
t
Volts
R
SW
CH
+
–
OA1
vO
vO
+
–
OA2
(a)
(b)
FIGURE 9.40
Peak-detector waveforms and circuit diagram.

468
CHAPTER 9
Nonlinear Circuits
v1
vO = vI
+
vI
R
CH
+
–
OA1
VD2(on)
+
–
OA2
(a)
+
v1
vO = vI (peak)
+
vI
R
CH
+
–
OA1
VD1(on)
+
–
OA2
(b)
+
FIGURE 9.41
Peak-detector equivalents during (a) the track mode, and (b) the hold mode.
unidirectional current switch to further charge the capacitor when a new peak comes
along: this is the diode; (c) a device to force the capacitance voltage to track the input
voltage when a new peak comes along: this is the voltage follower; (d) a switch to
periodically reinitialize vO to zero: this is accomplished with a FET discharge switch
in parallel with the capacitor.
In the circuit of Fig. 9.40b the above tasks are performed, respectively, by CH,
D2, OA1, and SW. The function of OA2 is to buffer the capacitor voltage to prevent
discharge by R and by any external load. Moreover, D1 and R prevent OA1 from
saturating after a peak has been detected, and thus speed up recovery when a new
peak comes along. The circuit operates as follows.
With the arrival of a new peak, OA1 swings its output v1 positive, turning D1
off and D2 on as shown in Fig. 9.41a. OA1 uses the feedback path D2-OA2-R to
maintain a virtual short between its inputs. Since no current ﬂows through R, the
result is that vO will track vI . During this mode, aptly called the track mode, OA1
sources current to charge CH via D2, and its output rides a diode drop above vO, or
v1 = vO + VD2(on).
After peaking, vI starts to decrease, causing the output of OA1 also to decrease.
Consequently, D2 goes off and D1 goes on, thus providing an alternative feedback
path for OA1, as depicted in Fig. 9.41b. By the virtual-short concept, the output of
OA1 now rides a diode drop below vI , or v1 = vI −VD1(on). During this mode,
called the hold mode, the capacitor voltage remains constant, and the function of R
is to provide a current path for D1.
We observe that placing D2 and OA2 within the feedback path of OA1 eliminates
any errors due to the voltage drop across D2 and the input offset voltage of OA2. All
that is required at the input of OA2 is a sufﬁcently low input bias current to minimize
capacitance discharge between peaks. The requirements of OA1 are a sufﬁciently low
dc input error, and a sufﬁciently high output-current capability to charge CH during
fast peaks. Moreover, OA1 may need to be stabilized against the feedback-loop pole
introduced by ro1 and CH, and that introduced by OA2. This is usually achieved by
connecting suitable compensation capacitors in parallel with D1 and R. Typically,
R is on the order of a few kiloohms, and the compensation capacitances on the order
of a few tens of picofarads.

469
SECTION 9.6
Peak Detectors
It is readily seen that reversing the diode directions causes the circuit to detect
the negative peaks of vI .
Voltage Droop and Sagback
During the hold mode, vO should remain rigorously constant. In practice, because of
leakage currents, the capacitor will slowly charge or discharge, depending on leakage
polarity. Leakage stems from various sources, namely, from diode, capacitor, and
reset-switch leakage; printed-circuit board leakage; and the input bias current of OA2.
Using the capacitance law i = C dv/dt and denoting the net capacitance leakage as
IL, we deﬁne the voltage droop rate as
dv0
dt = IL
CH
(9.23)
For instance, a 1-nA leakage current through a 1-nF capacitance produces a voltage
droop rate of 10−9/10−9 = 1 V/s = 1 mV/ms. Droop is minimized by reducing the
individual leakage components.
The most crucial limitations of a practical capacitor in analog memory appli-
cations are leakage and dielectric absorption. Leakage causes the device to slowly
discharge when in the hold mode; dielectric absorption causes the new voltage to
creep back toward the previous voltage after the capacitance is subjected to a rapid
voltage change. This sagback effect, stemming from charge storage phenomena in
the bulk of the dielectric, can be modeled with a series of internal R-C stages, each
in parallel with CH. Referring to the ﬁrst-order model of Fig. 9.42a, we observe
that even though CH discharges almost instantaneously when SW is closed, CDA
will retain some charge because of the series resistance RDA. After SW is opened,
CDA will transfer part of its charge back to CH to achieve equilibrium, thus causing
the sagback effect depicted in Fig. 9.42b. Though more than one time constant may
intervene in the sag, a single time constant is often sufﬁcient to characterize the sag,
with CDA typically one or more orders of magnitude smaller than CH, and a time
constant ranging from fractions of a millisecond to fractions of a second. Capacitor
types are available with low leakage and low dielectric absorption. These include
polystyrene, polypropylene, and Teﬂon types.3
RDA
CDA
+
–
vCH
vCH
CH
SW
Practical capacitor
Sagback
SW opens
SW closes
(a)
(b)
t
FIGURE 9.42
(a) Circuit model for dielectric absorption, and (b) the sagback effect.

470
CHAPTER 9
Nonlinear Circuits
R3
R1
M1
M2
+
vI
Cc
CH
R2
D2
D1
D3
vO
+
–
OA2
+
–
OA1
RESET
Guard ring
+15 V
–15 V
FIGURE 9.43
Peak detector for extended hold.
Printed-circuit board leakage is minimized by input guarding techniques of the
type discussed in Section 5.3. In the present circuit the ring is driven by vO and is
made to surround all traces associated with the noninverting input of OA2, as shown
in the practical example of Fig. 9.43.
A FET-input op amp is often chosen for OA2 to take advantage of its low-input-
bias-current characteristics. However, this current doubles with about every 10 ◦C
increase, so if an extended range of operating temperatures is anticipated, a BJT-input
op amp with ultralow-input bias current may be preferable.
When reverse biased, a diode draws a leakage current that also doubles with
every 10 ◦C increase. The circuit of Fig. 9.43 eliminates the effect of diode leakage
by using a third diode D3 and the pullup resistance R2. During the track mode, the
D2-D3 pair acts as a unidirectional switch, but with a voltage drop twice as large.
During the hold mode, R2 pulls the anode of D3 to the same potential as the cathode,
thus eliminating D3’s leakage; the reverse bias is sustained solely by D2.
A similar technique can be used to minimize reset-switch leakage. In the exam-
ple shown, this switch is implemented with two 3N163 enhancement p-MOSFETs
(Siliconix). Applying a negative pulse to their gates turns both FETs on and also
discharges CH. Upon pulse removal both FETs go off; however, with R3 pulling
the source of M1 to the same potential as the drain, M1’s leakage is eliminated; the
switch voltage is sustained solely by M2. If TTL compatibility is desired, one can
use a suitable voltage-level translator, such as the DH0034.
A good choice for the op amps of Fig. 9.43 is a dual JFET-input device such as
the precision, high-speed OP249 op amp. The diodes can be any general-purpose
devices, such as the 1N914 or 1N4148 types, and suitable values for the various
resistances are in the 10-k range. The purpose of Cc, typically in the range of a
few tens of picofarads, is to stabilize the capacitively loaded op amp OA1 during the
track mode. CH should be large enough to reduce the effect of leakage, yet small
enough to allow for its rapid charge during fast peaks. A reasonable compromise is
typically in the 1-nF range.

471
SECTION 9.7
Sample-and-Hold
Ampliﬁers
Speed Limitations
Peak-detector speed is limited by the slew rates of its op amps as well as the max-
imum rate at which OA1 can charge or discharge CH. The latter is Isc1/CH, where
Isc1 is the short-circuit output current of OA1. For instance, with CH = 0.5 nF, an op
amp having SR1 = 30 V/μs and Isc1 = 20 mA gives Isc1/CH = 40 V/μs, indicating
that speed is limited by SR1. However, with CH = 1 nF, we get Isc1/CH = 20 V/μs,
indicating that speed is now limited by Isc1. The output current drive of OA1 can be
boosted by replacing D3 with the B-E junction of an npn BJT, whose collector is
returned to VCC via a series resistance on the order of 102  to limit current spikes
below a proper safety level.
9.7
SAMPLE-AND-HOLD AMPLIFIERS
It is often necessary to capture the value of a signal in response to a suitable logic
command, and hold it until the arrival of a new capture command. We have been
exposed to this concept in Chapter 5 in connection with autozeroing ampliﬁers,
where the signal in question is an offset-nulling voltage. Other examples will be
encountered in Chapter 12 in connection with A-D and D-A converters.
A sample-and-hold ampliﬁer (SHA) is a circuit in which the value of the input
signal is captured instantaneously, as shown in Fig. 9.44a. Though mathematically
convenient in sampled-data theory, instantaneous capture is unfeasible because of
inherent dynamic limitations of physical circuits. Rather, a practical circuit is made
to track the input for a prescribed time interval, and then hold its most recent value
for the remainder of the cycle. The timing of the track-and-hold ampliﬁer (THA)
is shown in Fig. 9.44b. In spite of the obvious differences between the diagrams,
engineers use the designations SHA and THA interchangeably.
S
H
H
H
H
H
H
T
T
T
T
T
H
H
H
S
S
S
S
t
t
t
t
S/H
T/H
Volts 
Volts 
(a)
(b)
vI
vI
vO
vO
FIGURE 9.44
Idealized responses of (a) the sample-and-hold ampliﬁer (SHA), and (b) the track-and-hold
ampliﬁer (THA).

472
CHAPTER 9
Nonlinear Circuits
+
vI
SW
CH
R
T/H
vO
D1
D2
+
–
OA2
+
–
OA1
FIGURE 9.45
Basic track-and-hold ampliﬁer.
Figure 9.45 shows one of the most popular THA topologies. The circuit is
reminiscent of the peak detector, except for the replacement of the diode switch
with an externally controlled bidirectional switch to charge as well as discharge CH,
depending on the case. The circuit operates as follows.
During the track mode, SW is closed to create the feedback path SW-OA2-R
around OA1. Due to the low voltage drop across SW, both diodes are off, indicating a
0-V drop across R. OA1 thus acts as a voltage follower, providing CH with whatever
current it takes to make vO track vI .
During the hold mode, SW is opened, allowing CH to retain whatever voltage
it had at the instant of switch aperture; OA2 then buffers this voltage to the outside.
The function of D1 and D2 is to prevent OA1 from saturating, and thus facilitate
OA1’s recovery when a new track command is received.
The switch is usually a JFET, a MOSFET, or a Schottky diode bridge, and
is equipped with a suitable driver to make the T/H command TTL- or CMOS-
compatible. The main requirements of OA1 are (a) low-input dc error, (b) adequate
output current capability to rapidly charge or discharge CH, (c) high open-loop
gain to minimize the gain error and errors due to the voltage drop across SW
and OA2’s input offset voltage, and (d) proper frequency compensation for suf-
ﬁciently fast dynamics and settling characteristics. Compensation is often imple-
mented with a bypass capacitance of a few tens of picofarads in parallel with the
diodes. The requirements of OA2 are (a) low-input bias current to minimize droop,
and (b) adequately fast dynamics. As in the peak-detector case, CH should be a
low-leakage, low-dielectric-absorption capacitor, such as Teﬂon or polystyrene.3 Its
value is chosen as a compromise between low droop and rapid charge/discharge
times.
The basic THA of Fig. 9.45 can be implemented with individual op amps and
passive components, or it can be purchased as a self-contained monolithic IC. A
popular example is the LM398 BiFET THA.
THA Performance Parameters
In the track mode, a THA is designed to behave like an ordinary ampliﬁer, so its
performance is characterized in terms of the dc and gain errors, the dynamics, and

473
SECTION 9.7
Sample-and-Hold
Ampliﬁers
Droop
vI
vO
Hold step
Feedthrough
Desired output
Droop
tAP
tS
tAQ
vO
vI
vI
vO
H
T
H
FIGURE 9.46
THA terminology.
other parameters peculiar to ampliﬁers. However, during the transition from the track
to the hold mode and vice versa, as well as during the hold mode itself, performance
is characterized by speciﬁcations peculiar to THAs. The following list uses the
expanded timing diagram of Fig. 9.46 as a guideline.
1. Acquisition Time (tAQ). Following the track command, vO starts slewing toward
vI , and tAQ is the time it takes for vO to begin tracking vI within a speciﬁed error
band after the inception of the track command. This includes propagation delays
through the switch driver and the switch, and delays due to slew-rate limiting
and settling times of the op amps. The acquisition time increases with the step
magnitude as well as the narrowness of the error band. Usually tAQ is speciﬁed
for a 10-V step and for error bands of 1%, 0.1%, and 0.01% of full scale. The
input must be fully acquired before switching to the hold mode.
2. Aperture Time (tAP). Because of propagation delays through the driver and the
switch, vO will cease tracking vI some time after the inception of the hold com-
mand. This is the aperture time. The hold command would have to be advanced
by tAP for precise timing.
3. Aperture Uncertainty (tAP). Also called aperture jitter, it represents the varia-
tion in aperture time from sample to sample. If tAP is compensated for by advanc-
ing the hold command by tAP, then tAP establishes the ultimate timing error
and, hence, the maximum sampling frequency for a given resolution. Aperture
jitter results in an output error vO = (dvI /dt)tAP, indicating that the actual
sampled waveform can be viewed as the sum of an ideally sampled waveform
and a noise component. The signal-to-noise ratio of an otherwise ideal sampling
circuit with a sinusoidal input of frequency fi is4
SNR = −20 log10[2π fitAP(rms)]
(9.24)

474
CHAPTER 9
Nonlinear Circuits
where tAP(rms) is the rms value of tAP, and the latter is assumed uncorrelated
with vI . Typically, tAP is an order of magnitude smaller than tAP, and tAP, in
turn, is one to two orders of magnitude smaller than tAQ.
4. Hold Mode Settling Time (tS). After the inception of the hold command, it takes
some time to settle within a speciﬁed error band, such as 1%, 0.1%, or 0.01%.
This is the hold mode settling time.
5. Hold Step. Because of parasitic switch capacitances, when the circuit is switched
to the hold mode there is an unwanted charge transfer between the switch driver
and CH, causing a change in the voltage across CH. The corresponding
change vO is referred to as hold step, pedestal error, or sample-to-hold
offset.
6. Feedthrough. When in the hold mode, vO should be independent of any variations
in vI . In practice, because of stray capacitance across SW, there is a small amount
of ac coupling from vI to vO called feedthrough. This capacitance forms an
ac voltage divider with CH, so an input change vI causes an output change
vO = [CSW /(CSW + CH)]vI , where CSW is the capacitance across the
switch. The feedthrough rejection ratio
FRR = 20 log vI
vO
(9.25)
gives an indication of the amount of stray coupling. For example, if FRR = 80 dB,
a hold mode change vI = 10 V results in vO = vI /1080/20 = 10/104 =
1 mV.
7. Voltage Droop. THAs are subject to the same droop limitations as peak detec-
tors. Droop is of special concern when CH must be kept low to ensure a fast
acquisition.
In the case of a JFET switch, feedthrough is due to the drain-source capacitance
Cds, and the hold step is due to the gate-drain capacitance Cgd. (For discrete devices,
these capacitances are typically in the picofarad range.) As the driver pulls the gate
from near vO to near VEE, it removes the charge Q ∼= Cgd(VEE −vO) from CH,
causing a hold step
vO ∼=
Cgd
Cgd + CH
(VEE −vO)
(9.26)
This step varies with vO. For example, with CH = 1 nF and VEE = −15 V, the
hold step for every picofarad of Cgd is about −15 mV/pF for vO = 0, −20 mV/pF
for vO = 5 V, and −10 mV/pF for vO = −5 V. A Cgd of just a few picofarads can
cause intolerable errors!
There are various techniques for minimizing the signal-dependent hold step.
One such technique is to implement the switch with the CMOS transmission gate
of Fig. 9.39a. Since the two FETs are driven in antiphase, one FET will inject and
the other will remove charge, and if their geometries are properly scaled, the two
charges will cancel each other out.
An alternative technique5 is depicted in Fig. 9.47. As the circuit goes into hold,
OA4 produces a positive-going output swing that, by the superposition principle,
depends on vO as well as on the negative step on the switch gate. This swing is

475
SECTION 9.7
Sample-and-Hold
Ampliﬁers
R1
+
H/T
D2
+
–
OA3
6.2 V
+
–
OA4
+
–
OA2
OA1
+
vI
LT1010
R2
50 pF
2kΩ
200 kΩ
R7
6.2 kΩ
50 kΩ
5 kΩ
10 kΩ
R11
R9
R8
R10
R1
C3
R4
R4
Q2
2N2222
R6
1 kΩ
2 kΩ
2 kΩ
20 Ω
R3
R3
J1
2N5432
Cds
Cgd
G
S
D  
VCC
LT118A
CH
1 nF
LT118A
LT118A
110 pF
10 pF
C5
VEE
D1
HP2810
2N2907
C2
150 pF
Q1
vO
R5
1 kΩ
C1
FIGURE 9.47
A 5-MHz THA with charge-transfer compensation to minimize the hold step. (Courtesy of
Linear Technology.)
designed to inject into CH, via C3, a charge packet of magnitude equal to that
removed via Cgd, thus resulting in a net charge transfer of zero. The hold step is
made independent of vO with R7, and adjusted to zero via R10. To calibrate the
circuit, adjust R7 for equal hold steps with vI = ±5 V; then, null the residual offset
via R10.
To achieve high speed, the circuit utilizes fast op amps and boosts OA1 with the
LT1010 fast power buffer to rapidly charge and discharge CH in the track mode.
Moreover, by using local feedback around the OA1-OA2 pair, the settling dynamics
of the input and output stages are kept separate and simpler. With OA3 no longer
inside the control loop, its input offset voltage is no longer irrelevant; however, its
offset as well as that of the input buffer are automatically compensated for during
calibration of R10. For long hold periods, OA3 can be replaced by a FET-input device
such as the LF356 to reduce droop.
Charge compensation can be simpliﬁed considerably if the switch is operated in
a virtual-ground arrangement. This is the case with THAs of the integrating type,4,6
so-called because the holding capacitor is placed in the feedback path of the output
ampliﬁer, as exempliﬁed in Fig. 9.48. Since the switch always sees a virtual ground,
the charge removed from the summing junction via Cgd is constant regardless of vO.
Consequently, the hold step appears as a constant offset that can easily be nulled by
standard techniques, such as adjusting the offset of OA1, as shown. With an easier-
to-compensate hold step, the holding capacitance can be reduced signiﬁcantly to
achieve faster acquisition times. The HA-5330 high-speed monolithic THA uses a
90-pF holding capacitance to achieve tAQ = 400 ns to 0.01%.

476
CHAPTER 9
Nonlinear Circuits
R
T/H
R
SW
CH
vO
VCC
+
–
OA2
Cgd
+
–
OA1
+
vI
Offset
null
Switch driver
FIGURE 9.48
Integrating-type THA.
Figure 9.49 shows an improved integrating-type THA that simultaneously opti-
mizes droop, hold step, and feedthough. During the track mode, SW3 is open while
SW1 and SW2 are closed. In this mode the circuit operates just as in Fig. 9.48,
with vO slewing toward −vI . During the hold mode, SW1 and SW2 are open while
SW3 is closed, causing the circuit to hold whatever voltage it acquired during sam-
pling.Note,however,thatbygroundingtheinputtothebuffervia SW3,anyvariations
in vI are muzzled, thus improving the FRR signiﬁcantly. Moreover, since both SW1
and SW2 experience a voltage drop very close to zero, switch leakage is virtually
eliminated. The main source of leakage is now the input bias current of OA. How-
ever, returning its noninverting input to a dummy capacitance C of size equal to
CH produces a hold step and a droop that, to a ﬁrst approximation, will cancel out
the hold step and droop of CH. An example of a THA utilizing this technique is
the SHC803/804, whose typical ambient-temperature ratings are: tAQ = 250 ns and
tS = 100 ns, both to 0.01%; tAP = 15 ns; tAP = ±15 ps; FRR = ±0.005%, or
86 dB; hold mode offset = ±2 mV; droop rate = ±0.5 μV/μs.
R
T/H
R
CH
vO
+
–
OA
SW2
SW1
SW3
C = CH
+
vI
Driver
Buffer
FIGURE 9.49
Improved THA. (Switch settings shown for the hold mode.)

477
Problems
THAs are available from a variety of sources and in a wide range of perfor-
mance speciﬁcations and prices. Consult the catalogs to familiarize yourself with
the available products.
PROBLEMS
9.1 Voltage comparators
9.1 (a) Using a 311 comparator powered from ±5-V regulated supplies, design a threshold
detector that gives vO ∼= 0 for vI > 1 V, and vO ∼= +5 V for vI < 1 V. (b) Repeat, but
with vO ∼= +5 V for vI > −1 V, and vO ∼= −5 V for vI < −1 V. (c) Repeat, but with
vO ∼= 2.5 V for vI > 0, and vO ∼= −2.5 V for vI < 0.
9.2 Comparator applications
9.2 The thermal characteristic of a certain class of thermistors can be expressed as R(T ) =
R(T0) exp[B(1/T −1/T0)], where T is absolute temperature, T0 is some reference
temperature, and B is a suitable constant, all three parameters being in kelvins. Using
a single comparator of the 339 type and a thermistor having R(25 ◦C) = 100 k and
B = 4000 K, design a bridge comparator circuit that gives vO = VOH for T > 100 ◦C,
and vO = VOL for T < 100 ◦C. Assuming 10% component tolerances, make provision
for the exact adjustment of the setpoint, and outline the calibration procedure.
9.3 Using an op amp, two comparators of the 339 type, a 2N2222 npn BJT, and resistors as
needed, design a circuit that accepts a data input vI and a control input VT , 0 < VT ≤
2.5 V, and causes a 10-mA LED to glow whenever −VT ≤vI ≤VT . Assume ±5-V
power supplies.
9.4 Using two comparators of the 339 type and a thermistor of the type of Problem 9.2
with R(25 ◦C) = 10 k and B = 4000 K, design a circuit that yields vO ∼= 5 V for
0 ◦C ≤T ≤5 ◦C, and vO ∼= 0 V otherwise. Assume a single 5-V regulated supply.
9.5 Show that the window detector of Fig. P9.5 has a window whose center is controlled
by v1 and whose width is controlled by v2; then sketch and label the VTC if v1 = 3 V
and v2 = 1 V.
+
–
+
–
R
R
R
R
R
R
R
+
vI
+
v2
vO
R
5 V
v1
+
Rc
FIGURE P9.5

478
CHAPTER 9
Nonlinear Circuits
9.6 Using three comparators of the 339 type, an LM385 2.5-V reference diode, an HLMP-
4700 LED of the type of Example 9.2, and resistors as needed, design a circuit that
monitors a 15-V ± 5% power supply and causes the LED to glow whenever the supply
is within range.
9.7 Using an LM385 2.5-V reference diode, an LM339 quad comparator, and four HLMP-
4700 LEDs of the type of Example 9.2, design a 0-V to 4-V bar graph meter. The circuit
must have an input impedance of at least 100 k and must be powered from a single
5-V supply.
9.8 Using a 311 comparator powered from ±15-V regulated supplies, design a circuit that
accepts a triangular wave with peak values of ±10 V, and generates a square wave with
peak values of ±5 V and duty cycle D variable from 5% to 95% by means of a 10-k
potentiometer.
9.3 Schmitt triggers
9.9 In the circuit of Fig. 9.20a let vI be a triangular wave of ±10 V peak values and let
±Vsat = ±13 V. Modify the circuit so that the phase of its square-wave output, relative
to that of the input, is variable from 0◦to 90◦by means of a 10-k potentiometer. Show
the input and output waveforms when the wiper is in the middle.
9.10 (a) Derive Eq. (9.14). (b) Specify suitable resistances in the circuit of Fig. 9.23 to
achieve VOL = 0 V, VOH = 5 V, VTL = 1.5 V, and VTH = 2.5 V with VCC = 5 V. Try
minimizing the effect of the input bias current.
9.11 Assuming VD(on) = 0.7 V and ±Vsat = ±13 V, sketch and label the VTC of the inverting
Schmitt trigger of Fig. P9.11.
D2
D1
D3
D4
+
vI
13.3 kΩ
+15 V
–15 V
13.3 kΩ
1 kΩ
vO
+
–
301
FIGURE P9.11
9.12 (a) Assuming the op amp of Fig. 9.20a saturates at ±13 V, sketch and label the
VTC if a resistance R3 = 33 k is connected between the nodes labeled vP and
−15 V. (b) Suitably modify the circuit of Fig. 9.21a so that it gives VTL = 1 V and
VTH = 2 V.
9.13 (a) Using CMOS inverters of the type shown in Fig. 10.11, along with resistances in the
10-k to 100-k range, design a noninverting Schmitt trigger with VTL = (1/3)VDD and
VTH = (2/3)VDD; assume VT = 0.5VDD. (b) Modify the circuit so that VTL = (1/5)VDD

479
Problems
and VTH = (1/2)VDD. (c) How would you turn the preceding circuits into Schmitt trig-
gers of the inverting type?
9.14 Suitably modify the circuit of Problem 9.2 to ensure a hysteresis of ±0.5 ◦C. Outline
the calibration procedure.
9.15 In the Schmitt trigger of Fig. 9.20a let the input vI be applied to the inverting-input pin
via a voltage divider made up of two 10-k resistances, let R1 be replaced by the series
combination of two 4.3-V Zener diodes connected back to back anode with anode, and
let the output vO be obtained at the node where R2 joins the Zener network. Draw the
circuit. Hence, assuming a 0.7-V forward-bias diode voltage drop, sketch and label
the VTC.
9.16 In the circuit of Fig. P1.18 let the source be a variable source, denoted as iI, and let the
op amp saturate at ±10 V. (a) Sketch and label vO versus iI for iI variable over the
range −1 mA ≤iI ≤1 mA. (b) Repeat, but with a 2-k resistor in parallel with iI,
and for iI variable over the range −2 mA ≤iI ≤2 mA.
9.17 A circuit consists of a 311 comparator and three equal resistors, R1 = R2 = R3 =
10 k. The 311 is powered between 15 V and ground, and has VEE(logic) = 0. Moreover,
R1 is connected between the 15-V supply and the noninverting-input pin, R2 between
the noninverting-input pin and the open-collector output pin, and R3 between the open-
collector output pin and ground. Moreover, the input vI is applied to the comparator’s
inverting-input pin. Draw the circuit, and sketch and label its VTC if the output vO is
obtained from: (a) the node where R1 joins R2; (b) the node where R2 joins R3.
9.18 Consider the circuit obtained by removing R, C, and OA from Fig. 10.19a. What is
left then is a noninverting Schmitt trigger, whose input is the node labeled as vTR, and
whose output is the node labeled as vSQ. Sketch and label its VTC if R1 = 10 k,
R2 = 13 k, R3 = 4.7 k, and the Zener diode is a 5.1-V device; assume forward-bias
diode voltage drops of 0.7 V.
9.19 (a) Using a 339 comparator powered from a 5-V regulated supply, design an inverting
Schmitt trigger such that VOL = 2.0 V, VO H = 3.0 V, VT L = 2.0 V, and VT H = 3.0 V.
(b) Modify your circuit so that VT L = 0 V and VT H = 5.0 V.
9.4 Precision rectiﬁers
9.20 Sketch and label the VTC of the circuit of Fig. 9.29a if R2 = 2R1 and the noninverting
input of the op amp is lifted off ground and returned to a −5-V reference voltage. Next,
sketch and label vO if vI is a triangular wave with peak values of ±10 V.
9.21 Sketch and label the VTC of the circuit of Fig. 9.29a if R1 = R2 = 10 k, and a third
resistance R3 = 150 k is connected between the +15-V supply and the inverting-input
pin of the op amp. (b) Repeat, but with the diode polarities reversed.
9.22 One side of a 10-k resistance is driven by a source vI, and the other side is left ﬂoating.
Denoting the voltage at the ﬂoating side as vO, use a superdiode circuit to implement
a variable precision clamp, that is, a circuit that gives vO = vI for vI ≤Vclamp and
vO = Vclamp for vI ≥Vclamp, where Vclamp is a continuously adjustable voltage from 0
to 10 V by means of a 100-k pot. Assume ±15-V regulated supplies. List advantages
and drawbacks of your circuit.

480
CHAPTER 9
Nonlinear Circuits
9.23 Suitably modify the FWR of Fig. 9.30 so that, when fed with a triangular wave of ±5-V
peak values, it gives a triangular wave of ±5-V peak values, but twice the frequency.
Assume ±10-V regulated power supplies.
9.24 (a) Use PSpice to investigate the behavior of the FWR of Fig. 9.30 in response to
a sinusoidal input of ±5-V peak values. Use LM324 op amps powered from ±9-V
supplies, 1N4148 diodes, and R = 10 k throughout, along with A = 1. Display vI,
vO, and vHW, starting out with an input frequency of 1 kHz. Rerun PSpice for increasing
values of the input frequency until the circuit begins to distort. Based on what you see,
can you explain the reasons?
9.25 Assuming R1 = R2 = R4 = 10 k and R3 = 20 k in the FWR of Fig. 9.31, ﬁnd
all node voltages for vI = 10 mV, 1 V, and −1 V. For a forward-biased diode, assume
vD = (26 mV) ln[iD/(20 fA)].
9.26 Discuss the effect of resistance mismatches in the FWR of Fig. 9.31, and derive an
expression for 100|(Ap −An)/A|. Compare with the FWR of Fig. 9.30, and comment.
9.27 Consider the circuit obtained from that of Fig. 9.31 by grounding the left terminals of
R1 and R4, lifting the noninverting input of OA1 off ground and driving it with source
vI. (a) Show that the modiﬁed circuit gives vO = ApvI for vI > 0 and vO = −AnvI
for vI < 0, where Ap = 1 + (R2 + R3)/R1 and An = R3/R2. (b) Specify component
values for vO = 5|vI|. List advantages and disadvantages of this circuit.
9.28 Consider the circuit obtained from that of Fig. 9.31 by removing R1, grounding the
left terminal of R4, lifting the noninverting input of OA1 off ground and driving it
with source vI. Analyze the modiﬁed circuit if R2 = R3 = R. Afterward, discuss the
implications of mismatched resistances.
9.29 (a) Find the VTC of the circuit of Fig. P9.29. (b) Assuming ±Vsat = ±13 V and VD(on) =
0.7 V, show all node voltages for vI = +3 V and vI = −5 V. (c) List advantages and
disadvantages of this circuit.
R1 = R
R2 = R
+
vI
vO
+
–
OA1
D1
R3
+
–
OA2
FIGURE P9.29
9.30 The circuit of Fig. 9.30 can be turned into a high-input-impedance FWR by lifting both
noninverting inputs off ground, tying them together, and driving them with a common
input vI; moreover, R4 is removed, and the left terminal of R1 is grounded. (a) Assuming
R1 = R2 = R3 = R and R5 = 2R, ﬁnd the VTC of the modiﬁed circuit. (b) Assuming
VD(on) = 0.7 V, show all node voltages for vI = +2 V and vI = −3 V. (c) Investigate
the effect of mismatched resistances.

481
Problems
9.31 (a) Find the VTC of the circuit of Fig. P9.31; then, assuming VD(on) = 0.7 V, show all
node voltages for vI = +1 V and vI = −3 V. (b) Suitably modify the circuit so that it
accepts two inputs v1 and v2, and gives vO = |v1 + v2|.
D2
D1
+
vI
R
R
R
R
R
vO
+
–
OA2
+
–
OA1
FIGURE P9.31
9.32 Repeat Problem 9.24, but for the circuit of Fig. P9.31.
9.33 Investigate the effect of the input offset voltages VOS1 and VOS2 of OA1 and OA2 in the
FWR of Fig. 9.30.
9.5 Analog switches
9.34 Using a 311 comparator, a 2N4391 n-JFET, and a 741 op amp, design a circuit that
accepts an analog signal vI and two control signals v1 and v2, and yields a signal vO such
that vO = 10vI for v1 > v2, and vO = −10vI for v1 < v2. Assume ±15-V supplies.
9.35 For small values of |vDS|, the channel resistance of a MOSFET can be found as
1/rds(on) ∼= k(|vGS| −|VGS(on)|), where k is called the device transconductance param-
eter, in amperes per square volt. Assuming ±5-V supplies in the transmission gate of
Fig. 9.39a, and truly complementary FETS with k = 100 μA/V2 and |VGS(on)| = 2.5 V,
ﬁnd the net switch resistance for vI = ±5 V, ±2.5 V, and 0 V. What are the correspond-
ing values of vO if RL = 100 k?
9.6 Peak detectors
9.36 Consider the circuit obtained from that of Fig. 9.40b by returning the noninverting
input of OA1 to ground, and applying the source vI to the inverting input of OA1 via
a series resistance having the same value as the feedback resistance R. Discuss how
the modiﬁed circuit operates, and show its response to a sinusoidal input of increasing
amplitude.
9.37 Design a peak-to-peak detector, that is, a circuit that gives vO = vI (max) −vI (min).
9.38 Using the circuit of Fig. 9.29a as a starting point, design a circuit to provide the mag-
nitude peak-detector function, vO = |vI|max.
9.39 Three superdiodes of the type of Fig. 9.27 are driven by three separate sources v1, v2, and
v3, and their outputs are tied together and returned to −15 V via a 10-k resistor. What
function does the circuit provide? What happens if the diode polarities are reversed? If
the node common to the outputs is returned to the node common to the inverting inputs
via a voltage divider?

482
CHAPTER 9
Nonlinear Circuits
9.7 Sample-and-hold ampliﬁers
9.40 Suitably modify the THA of Fig. 9.45 for a gain of 2 V/V. What is the main disadvantage
of the modiﬁed circuit, and how would you take care of it?
9.41 In the THA of Fig. 9.48 let Cgd = 1 pF, CH = 1 nF, and let the net leakage current
through CH be 1 nA, ﬂowing from right to left. Assuming vI = 1.000 V, ﬁnd vO
(a) shortly after the circuit is switched to the hold mode, and (b) 50 ms later.
9.42 The THA of Fig. P9.42 uses a feedback capacitor CF = CH to provide a ﬁrst-order
compensation for the droop due to leakage in CH. (a) Explain how the circuit works.
What are the functions of the p-channel JFET J1 and the n-channel JFETs J2 and J3?
(b) Assuming an average leakage of 1 nA in each capacitor and a leakage mismatch
of 5%, estimate the voltage droop for the case CF = CH = 1 nF. What would be the
leakage if CF were absent and replaced with a wire?
+
–
+
–
R3
J2
OA2
T/H
J3
J1
OA1
R1
R2
+
vI
vO
CH
CF
+15 V
–15 V
FIGURE P9.42
REFERENCES
1. J. Sylvan, “High-Speed Comparators Provide Many Useful Circuit Functions When
Used Correctly,” Analog Dialogue, Vol. 23, No. 4, Analog Devices, Norwood, MA,
1989.
2. J. Williams, “High-Speed Comparator Techniques,” Application Note AN-13, Linear
Applications Handbook Volume I, Linear Technology, Milpitas, CA, 1990.
3. S. Guinta, “Capacitance and Capacitors,” Analog Dialogue, Vol. 30, No. 2, Analog
Devices, Norwood, MA, 1996.
4. B. Razavi, Principles of Data Conversion System Design, IEEE Press, Piscataway, NJ,
1995.
5. R. J. Widlar, “Unique IC Buffer Enhances Op Amp Designs, Tames Fast Ampliﬁers,”
Application Note AN-16, Linear Applications Handbook Volume I, Linear Technology,
Milpitas, CA, 1990.
6. D. A. Johns and K. W. Martin, Analog Integrated Circuit Design, John Wiley & Sons,
New York, 1997.

10
SIGNAL GENERATORS
10.1 Sine Wave Generators
10.2 Multivibrators
10.3 Monolithic Timers
10.4 Triangular Wave Generators
10.5 Sawtooth Wave Generators
10.6 Monolithic Waveform Generators
10.7 V-F and F-V Converters
Problems
References
The circuits investigated so far can be categorized as processing circuits because
they operate on existing signals. We now wish to investigate the class of circuits
used to generate the signals themselves. Though signals are sometimes obtained
from transducers, in most cases they need to be synthesized within the system. The
generation of clock pulses for timing and control, signal carriers for information
transmission and storage, sweep signals for information display, test signals for
automatic test and measurement, and audio signals for electronic music and speech
synthesis are some of the most common examples.
The function of a signal generator is to produce a waveform of prescribed char-
acteristics such as frequency, amplitude, shape, and duty cycle. Sometimes these
characteristics are designed to be externally programmable via suitable control sig-
nals, the voltage-controlled oscillator being the most typical example. In general,
signal generators employ some form of feedback together with devices possess-
ing time-dependent characteristics, such as capacitors. The two main categories of
signal generators that we shall investigate are sinusoidal oscillators and relaxation
oscillators.
483

484
CHAPTER 10
Signal Generators
Sinusoidal Oscillators
These oscillators employ concepts from systems theory to create a pair of conjugate
poles right on the imaginary axis of the complex plane to maintain sustained sinu-
soidal oscillation. The specter of instability that was of so much concern in Chapter 8
is now exploited on purpose to achieve predictable oscillation.
The sinusoidal purity of a periodic wave is expressed via its total harmonic
distortion
THD (%) = 100

D2
2 + D2
3 + D2
4 + · · ·
(10.1)
where Dk (k = 2, 3, 4, . . .) is the ratio of the amplitude of the kth harmonic to
that of the fundamental in the Fourier series of the given wave. For instance, the
triangular wave, for which
Dk = 1/k2, k = 3, 5, 7, . . . , has THD = 100 ×

1/34 + 1/54 + 1/74 + · · · ∼= 12%, indicating that as a crude approximation to a
sine wave, a triangular wave has a THD of 12%. On the other hand, a pure sine wave
has all harmonics, except for the fundamental, equal to zero, so THD = 0% in this
case. Clearly, the objective of a sine wave generator is to achieve a THD as low as
possible.
Relaxation Oscillators
These oscillators employ bistable devices, such as switches, Schmitt triggers, logic
gates, and ﬂip-ﬂops, to repeatedly charge and discharge a capacitor. Typical wave-
forms obtainable with this method are the triangular, sawtooth, exponential, square,
and pulse waves. As we proceed, we shall often need to ﬁnd the time t it takes to
charge (or discharge) a capacitance by a given amount v. The two most common
forms of charge/discharge are linear and exponential.
When driven with a constant current I, a capacitance C charges or discharges at a
constant rate, yielding a linear transient or ramp of the type of Fig. 10.1a. Engineers
often describe this ramp via the easy-to-remember relationship
Cv = It
v
V1
V∞
V0
    Δv
Δt
t0
t1
t
v
V1
V0
Δv
Δt
t0
t1
t
(a)
(b)
FIGURE 10.1
Linear and exponential waveforms.

485
SECTION 10.1
Sine Wave
Generators
or “cee delta vee equals aye delta tee.” This allows us to estimate the time it takes to
effect a constant-rate change v as
t = C
I v
(10.2)
An exponential transient occurs when C is charged or discharged via a series
resistance R. With reference to Fig. 10.1b, the instantaneous capacitance voltage is
v(t) = V∞+ (V0 −V∞) exp[−(t −t0)/τ]
where V0 is the initial voltage, V∞is the steady-state voltage that would be reached
in the limit t →∞, and τ = RC is the time constant governing the transient. This
equation holds regardless of the values and polarities of V0 and V∞. The transient
reaches a speciﬁed intermediate value V1 at an instant t1 such that V1 = V∞+(V0 −
V∞) exp[−(t1 −t0)/τ]. Taking the natural logarithm of both sides and solving for
t = t1 −t0 allows us to estimate the time it takes to charge or discharge C from
V0 to V1 as
t = τ ln V∞−V0
V∞−V1
(10.3)
As we proceed, we shall make frequent use of these equations.
Chapter Highlights
The chapter begins with sine wave oscillators. It starts with Wien-bridge types,
and proceeds to quadrature oscillators and essentially any circuit that is capable
of maintaining automatically a complex-conjugate pole pair right on the imaginary
axis. This includes some of the ﬁlters studied in Chapter 3. Oscillator behavior is
illustrated via PSpice for the case of several different pole-control schemes.
Next, multivibrators are investigated, both astable and bistable types, along with
a number of common applications using ICs such as the popular 555 timer.
The chapter turns to triangular and sawtooth wave generators, including voltage-
controlled types, and addresses also triangle-to-sine wave conversion. This part
includes popular ICs such as the 8038 waveform generator, emitter-coupled VCOs,
and the XR2206 function generator.
The chapter concludes with voltage-to-frequency and frequency-to-voltage con-
verters and common applications thereof.
10.1
SINE WAVE GENERATORS
The sine wave is certainly one of the most fundamental waveforms—both in a math-
ematical sense, since any other waveform can be expressed as a Fourier combination
of basic sine waves, and in a practical sense, since it ﬁnds extensive use as a test, ref-
erence, and carrier signal. In spite of its simplicity, its generation can be a challenging
task if near-purity is sought. The op amp circuits that have gained the most promi-
nence in sine wave generation are the Wien-bridge oscillator and the quadrature

486
CHAPTER 10
Signal Generators
f0
f0
T  (dB)
0
(deg)
0
–90
90
f
f
<) T
(a)
(b)
R
R
C
C
R2
R1
Vo
Vp
+
–
FIGURE 10.2
Wien-bridge circuit and its loop gain T ( j f ) for the case R2/R1 = 2.
oscillator, to be discussed next. Another technique, based on the conversion of the
triangular to the sine wave, will be discussed in Section 10.4.
Basic Wien-Bridge Oscillator
The circuit of Fig. 10.2a uses both negative feedback, via R2 and R1, and posi-
tive feedback, via the series and parallel RC networks. Circuit behavior is strongly
affected by whether positive or negative feedback prevails. The components of the
RC networks need not be equal-valued; however, making them so simpliﬁes analysis
as well as inventory.
The circuit can be viewed as a noninverting ampliﬁer that ampliﬁes Vp by the
amount
A = Vo
Vp
= 1 + R2
R1
(10.4)
where we are assuming an ideal op amp for simplicity. In turn, Vp is supplied by
the op amp itself via the two RC networks as Vp = [Z p/(Z p + Zs)]Vo, where
Z p = R ∥[1/( j2π f C)] and Zs = R + 1/( j2π f C). Expanding, we get
B( j f ) = Vp
Vo
=
1
3 + j( f/f0 −f0/f )
(10.5)
where f0 = 1/(2πRC). The overall gain experienced by a signal in going around
the loop is T ( j f ) = AB, or
T ( j f ) =
1 + R2/R1
3 + j( f/f0 −f0/f )
(10.6)
Thisisaband-passfunctionsinceitapproacheszeroatbothhighandlowfrequencies.
Its peak value occurs at f = f0 and is
T ( j f 0) = 1 + R2/R1
3
(10.7)

487
SECTION 10.1
Sine Wave
Generators
The fact that T ( j f 0) is real indicates that a signal of frequency f0 will experience
a net phase shift of zero in going around the loop. Depending on the magnitude of
T ( j f 0), we have three distinct possibilities:
1. T ( j f 0) < 1, that is, A < 3 V/V. Any disturbance of frequency f0 arising at the
input of the op amp is ﬁrst ampliﬁed by A < 3 V/V, and then by B( j f 0) = 1
3 V/V,
for a net gain of less than unity. Intuition tells us that this disturbance lessens
each time it goes around the loop until it eventually decays to zero. We can state
that negative feedback (via R2 and R1) prevails over positive feedback (via Zs
and Z p), resulting in a stable system. Consequently, the circuit poles lie in the
left half of the complex plane.
2. T ( j f 0) > 1, that is, A > 3 V/V. Now positive feedback prevails over negative
feedback, indicating that a disturbance of frequency f0 will be ampliﬁed regen-
eratively, causing the circuit to break out into oscillations of growing magnitude.
The circuit is now unstable, and its poles lie in the right half of the complex plane.
As we know, the oscillations build up until the saturation limits of the op amp are
reached. Thereafter, vO will appear as a clipped sine wave when observed with
the oscilloscope or visualized via PSpice.
3. T ( j f 0) = 1, or A = 3 V/V exactly, a condition referred to as neutral stability
because positive and negative feedback are now applied in equal amounts. Any
disturbance of frequency f0 is ﬁrst ampliﬁed by 3 V/V and then by 1
3 V/V,
indicating that once started, it will be sustained indeﬁnitely. As we know, this
corresponds to a pole pair right on the jω axis. The conditions T ( j f 0) = 0◦and
|T ( j f 0)| = 1 are together referred to as the Barkhausen criterion for oscillation
at f = f0. The band-pass nature of T ( j f ) allows for oscillation to occur only
at f = f0; any attempt to oscillate at other frequencies is naturally discouraged
because T ̸= 0◦and |T | < 1 there. By Eq. (10.7), neutral stability is achieved
with
R2
R1
= 2
(10.8)
It is apparent that when this condition is met, the components around the op amp
form a balanced bridge at f = f0.
In a real-life circuit, component drift makes it difﬁcult to keep the bridge ex-
actly balanced. Moreover, provisions must be made so that (a) oscillation starts
spontaneously at power turn-on, and (b) its amplitude is kept below the op amp
saturation limits to avoid excessive distortion. These objectives are met by making
the ratio R2/R1 amplitude-dependent such that at low signal levels it is slightly
greater than 2 to ensure oscillation start-up, and that at high signal levels it is
slightly less than 2 to limit amplitude. Then, once the oscillation has started, it
will grow and automatically stabilize at some intermediate level where R2/R1 = 2
exactly.
Amplitude stabilization takes on many forms, all of which use nonlinear ele-
ments to either decrease R2 or increase R1 with signal amplitude. To provide an
intuitive basis for our discussion, we shall continue using the function T ( j f ), but in
an incremental sense because of the nonlinearity now present in the circuit.

488
CHAPTER 10
Signal Generators
vO
D2
22.1 kΩ
158 kΩ
158 kΩ
1 nF
1 nF
10.0 kΩ
100 kΩ
D1
vO   
J1
20.0 kΩ
158 kΩ
158 kΩ
1 nF
1 nF 
11.0 kΩ
51 kΩ
D
(a)
(b)
   
1 μF
1 MΩ
+
–
+
–
+
μ
FIGURE 10.3
Practical Wien-bridge oscillators.
Automatic Amplitude Control
The circuit of Fig. 10.3a uses a simple diode-resistor network to control the effective
value of R2. At low signal levels the diodes are off, so the 100-k resistance has
no effect. We thus have R2/R1 = 22.1/10.0 = 2.21, or T ( j f 0) = (1 + 2.21)/3 =
1.07 > 1, indicating oscillation buildup. As the oscillation grows, the diodes are
gradually brought into conduction on alternate half-cycles. In the limit of heavy
diode conduction, R2 would effectively change to (22.1 ∥100) = 18.1 k, giv-
ing T ( j f 0) = 0.937 < 1. However, before this limiting condition is reached,
amplitude will automatically stabilize at some intermediate level of diode conduc-
tion where R2/R1 = 2 exactly, or T ( j f 0) = 1. We can easily visualize the pro-
cess via the PSpice circuit of Fig. 10.4a, designed for an oscillation frequency of
f0 = 1/[2π(159 k) × (1 nF)] ∼= 1 kHz. As shown in Fig. 10.4b, the oscillation
starts up spontaneously and grows until its amplitude stabilizes at about 1 V.
A disadvantage of the above circuit is that Vom is quite sensitive to variations in
the diode-forward voltage drops. The circuit of Fig. 10.3b overcomes this drawback
by using an n-JFET as the stabilizing element.1 At power turn-on, when the 1-μF
capacitance is still discharged, the gate voltage is near 0 V, indicating a low chan-
nel resistance. The JFET effectively shorts the 51-k resistance to ground to give
R2/R1 ∼= 20.0/(11.0 ∥51) ∼= 2.21 > 2, so oscillation starts to build up. The diode
and the 1-μF capacitance form a negative peak detector whose voltage becomes
progressively more negative as the oscillation grows. This gradually reduces the
conductivity of the JFET until, in the limit of complete cutoff we would have
R2/R1 = 20.0/11.0 = 1.82 < 2. However, amplitude stabilizes automatically at
some intermediate level where R2/R1 = 2 exactly. Denoting the corresponding
gate-source voltage as VGS(crit), and the output peak amplitude as Vom, we have
−Vom = VGS(crit) −VD(on). For instance, with VGS(crit) = −4.3 V we get Vom ∼=
4.3 + 0.7 = 5 V.
Figure 10.5 shows yet another popular amplitude-stabilization scheme,2 this
time using a diode limiter for easier programming of amplitude. As usual, for low
output levels the diodes are biased in cutoff, yielding R2/R1 = 2.21 > 2. The

489
SECTION 10.1
Sine Wave
Generators
vO
(b)
(a)
Time (ms)
15
0
5
10
−1 V
0
1 V
µA741
VCC (9 V)
VEE (−9 V)
0
0
–
+
Rs
vO
O
Cp
1 nF
R1
10 kΩ
R2
1 nF
Rp
159 kΩ
159 kΩ
Cs
R3
10 kΩ
22.1 kΩ
D1
D2
1N4148
1N4148
FIGURE 10.4
(a) Wien-bridge oscillator and (b) its output vO.
oscillation grows until the diodes become conductive on alternate output peaks.
Thanks to the symmetry of the clamping network, these peaks are likewise sym-
metric, or ±Vom. To estimate Vom, consider the instant when D2 starts to conduct.
Assuming the current through D2 is still negligible, and denoting the voltage at
the anode of D2 as V2, we use KCL to write (Vom −V2)/R3 ∼= [V2 −(−VS)]/R4,
where V2 = Vn + VD2(on) ∼= Vom/3 + VD2(on). Eliminating V2 and solving gives
Vom ∼= 3[(1+ R4/R3)VD2(on) + VS]/(2R4/R3 −1). For example, with R3 = 3 k,
R4 = 20 k, VS = 15 V, and VD(on) = 0.7 V, we get Vom ∼= 5 V.
vO   
22.1 kΩ
C
10.0 kΩ
+
–
R
C
R
D1
D2
R4
R2
R1
R3
R3
R4
+VS   
–VS   
FIGURE 10.5
Wien-bridge oscillator using a limiter for
amplitude stabilization.

490
CHAPTER 10
Signal Generators
Practical Considerations
The accuracy and stability of the oscillation are affected by the quality of the pas-
sive components as well as op amp dynamics. Good choices for the elements in
the positive-feedback network are polycarbonate capacitors and thin-ﬁlm resistors.
To compensate for component tolerances, practical Wien-bridge circuits are often
equipped with suitable trimmers for the exact adjustment of f0 as well as THD
minimization. With proper trimming, THD levels as low as 0.01% can be achieved.1
We observe that because of the ﬁltering action provided by the positive-feedback
network, the sine wave vP available at the noninverting input is generally purer than
vO. Consequently, it may be desirable to use vP as the output, though a buffer would
be needed to avoid perturbing circuit behavior.
To avoid slew-rate limiting effects for a given output peak-amplitude Vom, the
op amp should have SR > 2πVom f0. Once this condition is met, the limiting fac-
tor becomes the ﬁnite GBP, whose effect is a downshift in the actual frequency
of oscillation. It can be proved2 that to contain this shift within 10% when a
constant-GBP op amp is used, the latter should have GBP ≥43 f0. To compensate
for this downshift, one can suitably predistort the element values of the positive-
feedback network, in a manner similar to the ﬁlter predistortion techniques of
Sections 6.5 and 6.6.
The low end of the frequency range depends on how large the components in
the reactive network can be made. Using FET-input op amps to minimize input-
bias-current errors, the value of R can easily be increased to the range of tens of
megohms. For instance, using C = 1 μF and R = 15.9 M gives f0 = 0.01 Hz.
Quadrature Oscillators
We can generalize the above ideas and make an oscillator out of any second-order
ﬁlter that is capable of giving Q = ∞as well as Q < 0. To this end, we ﬁrst ground
the input, since it is no longer necessary; then, we design for an initially negative Q
to force the poles in the right half of the complex plane and thus ensure oscillation
startup; ﬁnally, we include a suitable amplitude-dependent network to automatically
pull the poles back to the jω axis and give Q = ∞, or sustained oscillation.
Of special interest are ﬁlter topologies of the dual-integrator-loop type, since
they provide two oscillations in quadrature, that is, with a relative phase shift of 90◦.
A good candidate is the loop of Fig. 10.6a, consisting of the inverting integrator
OA1 and the noninverting (or Deboo) integrator OA2. (The circuit uses half the
LM334 quad op amp, whose macromodel is available in PSpice’s library.) With the
component values shown, both integrators admit, ideally, a unity-gain frequency of
f0 = 1/[2π(159 k)×(1 nF)] ∼= 1 kHz. In practice, because of the open-loop gain
rolloff of the op amps, the integrators will be slightly lossy, as discussed in Chapter 6.
To compensate for these losses as well as to make the circuit start out with Q < 0, we
impose R5 > R4, as per Eq. (3.22). Under this condition, the oscillation will build
up as in Fig. 10.6b, until the diode network discussed in connection with Fig. 10.5
takes over and stabilizes the amplitude of the oscillation at about 5 V. As depicted
in the expanded view of Fig. 10.6c, vO1 exhibits some distortion, but vO2 is purer
because of the ﬁltering action provided by the Deboo integrator.

491
SECTION 10.2
Multivibrators
(a)
R7
33 kV
R8
33 kV
OA1
vO1
O1
0
R6
75 kV
VCC (10 V)
VEE (−10 V)
VEE (−10 V)
1N4148
1.0 nF
2.0 nF
LM324
D1
R1
R6
75 kV
R5
1N4148
D2
159 kV
159 kV
110 kV
OA2
vO2
O2
VCC (10 V)
VEE (−10 V)
LM324
+
–
+
–
R3
C2
R2
R4
100 kV
159 kV
0
0
C1
VCC (10 V)
0
50
10
20
30
40
−5 V
0
5 V
Time (ms)
(b)
vO1, vO2
50
49.5
49.0
−5 V
0
5 V
Time (ms)
(c)
vO1
vO2
FIGURE 10.6
(a) Quadrature oscillator, (b) growing oscillations, and (c) expanded view after amplitude
stabilization.
10.2
MULTIVIBRATORS
Multivibrators are regenerative circuits intended especially for timing applications.
Multivibrators are classiﬁed as bistable, astable, and monostable.
In a bistable multivibrator both states are stable, so external commands are
needed to force the circuit to a given state. This is the popular ﬂip-ﬂop, which in turn
takes on different names, depending on the way in which the external commands
are effected.

492
CHAPTER 10
Signal Generators
An astable multivibrator toggles spontaneously between one state and the other,
without any external commands. Also called a free-running multivibrator, its timing
is set by a suitable network, usually comprising a capacitor or a quartz crystal.
A monostable multivibrator, also called a one-shot, is stable only in one of its
two states. If forced into the other state via an external command called a trigger, it
returns to its stable state spontaneously, after a delay set by a suitable timing network.
Here we are interested in astable and monostable multivibrators. These circuits
are implemented with voltage comparators or with logic gates, especially CMOS
gates.
Basic Free-Running Multivibrator
In the circuit of Fig. 10.7a, the 301 op amp comparator and the positive-feedback
resistances R1 and R2 form an inverting Schmitt trigger. Assuming symmetric output
saturation at ±Vsat = ±13 V, the Schmitt-trigger thresholds are also symmetric at
±VT = ±VsatR1/(R1 + R2) = ±5 V. The signal to the inverting input is provided
by the op amp itself via the RC network.
At power turn-on (t = 0) vO will swing either to +Vsat or to −Vsat, since these
are the only stable states admitted by the Schmitt trigger. Assume it swings to
+Vsat, so that vP = +VT . This will cause R to charge C toward Vsat, leading to an
exponential rise in vN with the time constant τ = RC. As soon as vN catches up with
vP = VT , vO snaps to −Vsat, reversing the capacitance current and also causing vP
to snap to −VT . So, now vN decays exponentially toward −Vsat until it catches up
with vP = −VT , at which point vO again snaps to +Vsat, thus repeating the cycle.
It is apparent that once powered, the circuit has the ability to start and then sustain
oscillation, with vO snapping back and forth between +Vsat and −Vsat, and vN
slewing exponentially back and forth between +VT and −VT . After the power-on
cycle, the waveforms become periodic.
We are interested in the frequency of oscillation, which is found from the period
T as f0 = 1/T . Thanks to the symmetry of the saturation levels, vO has a duty cycle
of 50%, so we only need to ﬁnd T/2. Applying Eq. (10.3) with t = T/2, τ = RC,
Volts
(a)
(b)
301
Vsat
–Vsat
VT
vO
vN
–VT
t
0 0
T
R
C
R1
R2
16 kΩ
10 kΩ
vO
vP
+
–
vN
FIGURE 10.7
Basic free-running multivibrator.

493
SECTION 10.2
Multivibrators
V∞= Vsat, V0 = −VT , and V1 = +VT , we get
T
2 = RC ln Vsat + VT
Vsat −VT
Substituting VT = Vsat/(1 + R2/R1) and simplifying ﬁnally gives
f0 = 1
T =
1
2RC ln(1 + 2R1/R2)
(10.9)
With the components shown, f0 = 1/(1.62RC). If we use the ratio R1/R2 = 0.859,
then f0 = 1/(2RC).
We observe that f0 depends only on the external components. In particular, it
is unaffected by Vsat, which is known to be an ill-deﬁned parameter since it varies
from one op amp to another and also depends on the supply voltages. Any variation
in Vsat will cause VT to vary in proportion, thus ensuring the same transition time
and, hence, the same oscillation frequency.
The maximum operating frequency is determined by the comparator speed.
With the 301 op amp as a comparator, the circuit yields a reasonably good square
wave up to the 10-kHz range. This can be extended signiﬁcantly by using a faster
device. At higher frequencies, however, the stray capacitance of the noninverting
input toward ground becomes a limiting factor. This can be compensated by using a
suitable capacitance in parallel with R2.
The lowest operating frequency depends on the practical upper limits of R and
C, as well as the net leakage at the inverting input node. FET-input comparators may
be a good choice in this case.
Although f0 is unaffected by uncertainties in Vsat, it is often desirable to stabilize
the output levels for a cleaner and more predictable square-wave amplitude. This is
readily achieved with a suitable voltage-clamping network. If it is desired to vary
f0, a convenient approach is to use an array of decade capacitances and a rotary
switch for decade selection, and a variable resistance for continuous tuning within
the selected decade.
EXAMPLE 10.1. Design a square-wave generator meeting the following speciﬁcations:
(a) f0 must be variable in decade steps from 1 Hz to 10 kHz; (b) f0 must be variable con-
tinuously within each decade interval; (c) amplitude must be ±5 V, stabilized. Assume
±15-V poorly regulated supplies.
Solution. To ensure stable ±5 V output levels, use a diode-bridge clamp as in Fig. 10.8.
When the op amp saturates at +13 V, current ﬂows through the path R3-D1-D5-D4, thus
clamping vO at VD1(on) + VZ5 + VD4(on). To clamp at 5 V, use VZ5 = 5 −2VD(on) =
5 −2 × 0.7 = 3.6 V. When the op amp saturates at −13 V, current ﬂows through the
path D3-D5-D2-R3, clamping vO at −5 V.
To vary f0 in decade steps, use the four capacitances and rotary switch shown.
To vary f0 within a given decade, implement R with a pot. To cope with component
tolerances, ensure an adequate amount of overlap between adjacent decade intervals.
To be on the safe side, impose a range of continuous variability from 0.5 to 20, that
is, over a 40-to-1 range. We then have Rpot + Rs = 40Rs, or Rpot = 39Rs. To keep
input-bias-current errors low, impose IR(min) ≫IB, say, IR(min) = 10 μA. Moreover,
let R1 = R2 = 33 k, so that VT = 2.5 V. Then, Rmax = (5 −2.5)/(10 × 10−6) =
250 k. Since Rs ≪Rpot, use a 250-k pot. Then, Rs = 250/39 = 6.4 k (use
6.2 k).

494
CHAPTER 10
Signal Generators
vO
+
–
301
D5
C1
C2
C3
C4
Rs
R1
R4
R3
D3
D4
D2
D1
R2
R
3.3 nF
0.33 nF
33 nF
3.3 nF
6.2 kΩ
250 kΩ
10 kΩ
2.2 kΩ
33 kΩ
33 kΩ
μ
μ
FIGURE 10.8
Square-wave generator of Example 10.1.
To ﬁnd C1, impose f0 = 0.5 Hz with the pot set to its maximum value. By Eq. (10.9),
C1 = 1/[2 × 0.5 × (250 + 6.2) × 103 × ln 3] = 3.47 μF. The closest standard value is
C1 = 3.3 μF. Then, C2 = 0.33 μF, C3 = 33 nF, and C4 = 3.3 nF.
The function of R4 is to protect the comparator input stage at power turn-off, when
the capacitors may still be charged, and that of R3 is to supply current to the bridge, R2,
R, and to the external load, if any. The maximum current drawn by R is when vO = +5 V,
vN = −2.5 V, and the pot is set to zero. This current is [5 −(−2.5)]/6.2 = 1.2 mA. We
also have IR2 = 5/66 = 0.07 mA. Imposing a bridge current of 1 mA and allowing for
a maximum load current of 1 mA, we have IR3(max) = 1.2 + 0.07 + 1 + 1 ∼= 3.3 mA.
Hence, R3 = (13 −5)/3.3 = 2.4 k (use 2.2 k to be safe). For the diode bridge use
a CA3039 array.
Figure10.9showsamultivibratordesignedforsingle-supplyoperation.Byusing
a fast comparator, the circuit can operate well into the hundreds of kilohertz. As we
know, the circuit gives VOL ∼= 0 and, if R4 ≪R3 + (R1 ∥R2), it gives VOH ∼= VCC.
At power turn-on (t = 0), when C is still discharged, vO is forced high, causing C
to charge toward VCC via R. As soon as vN reaches VTH, vO snaps low, causing C
to discharge toward ground. Henceforth, the oscillation becomes periodic with duty
cycle D(%) = 100TH/(TL + TH) and f0 = 1/(TL + TH). Applying Eq. (10.3)
twice, ﬁrst with t = TL, V∞= 0, V0 = VTH, and V1 = VTL, then with t = TH,
V∞= VCC, V0 = VTL, and V1 = VTH, we get, after combining terms,
f0 =
1
RC ln
VTH
VTL
× VCC −VTL
VCC −VTH

(10.10)
To simply inventory and achieve D = 50%, it is customary to impose R1 =
R2 = R3, after which f0 = 1/(RC ln 4) = 1/1.39RC. Oscillators of this type can
easily achieve stabilities approaching 0.1% with initial predictability of the order of
5% to 10%.

495
SECTION 10.2
Multivibrators
Volts
(a)
(b)
VTH
VCC
VCC
VCC
VTL
vO
vN
vN
t
0
0
TL
TH
R
R4
R1
1
2
3
8
7
4
311
R2
C
R3
vO
+
–
FIGURE 10.9
Single-supply free-running multivibrator.
EXAMPLE 10.2.
In the circuit of Fig. 10.9 specify components for f0 = 1 kHz, and
verify with PSpice for VCC = 5 V.
Solution.
Use R1 = R2 = R3 = 33 k, R4 = 2.2 k, C = 10 nF, and R = 73.2 k.
Using the PSpice circuit of Fig. 10.10a, we readily obtain the waveforms of Fig. 10.10b.
Cursor measurements give T = 1.002 ms, or f0 = 998 Hz.
Free-Running Multivibrator Using CMOS Gates
CMOS logic gates are particularly attractive when analog and digital functions must
coexist on the same chip. A CMOS gate enjoys an extremely high input impedance,
a rail-to-rail input range and output swing, extremely low power consumption, and
(a)
VCC (+5 V)
R4
2.2 kΩ
R2
R3
R1
R
33 kΩ
33 kΩ
33 kΩ
73.2 kΩ
8
2
3
4
1
7
–
+
vN
vO
LM311
0
0
0
C
10 nF
(b)
Time (ms)
0
2.5
0.5
1
1.5
2
0
2.5 V
5 V
vO
vN
FIGURE 10.10
(a) Free-running multivibrator of Example 10.2, and (b) waveforms.

496
CHAPTER 10
Signal Generators
VDD
VDD
D1
D2
VDD
VDD
vO
vO
vO
VT
vI
vI
vI
Mp
Mn
0
0
(a)
(b)
(c)
FIGURE 10.11
CMOS inverter: logic symbol, internal circuit diagram, and VTC.
the speed and low cost of logic circuitry. The simplest gate is the inverter depicted in
Fig. 10.11. This gate can be regarded as an inverting-type threshold detector giving
vO = VOH = VDD for vI < VT , and vO = VOL = 0 for vI > VT . The threshold
VT is the result of internal transistor operation, and it is nominally halfway between
VDD and 0, or VT ∼= VDD/2. The protective diodes, normally in cutoff, prevent vI
from rising above VDD + VD(on) or dropping below −VD(on), and thus protect the
FETs against possible electrostatic discharge.
In the circuit of Fig. 10.12a assume at power turn-on (t = 0) v2 goes high. Then,
by I2’s inverting action, vO remains low, and C starts charging toward v2 = VDD
via R. The ensuing exponential rise is conveyed to I1 via R1 as signal v1. As soon as
VDD
VDD
VDD
VDD
v2
v3
t
t
t
vO
VT +
VDD
VT –
VT 
0
0
0
0
0
0
(a)
(b)
TH
TL
VDD
VDD
vO
C
R
R1
v1
I1
I2
v2
v3
(>> R)
FIGURE 10.12
CMOS-gate free-running multivibrator.

497
SECTION 10.2
Multivibrators
v1 rises to VT , I1 changes state and pulls v2 low, forcing I2 to pull vO high. Since
the voltage across C cannot change instantaneously, the step change in vO causes v3
to change from VT to VT + VDD ∼= 1.5VDD, as shown in the timing diagram. These
changes occur by a snapping action similar to that of Schmitt triggers.
With v3 being high and v2 being low, C will now discharge toward v2 = 0 via
R. As soon as the value of v3 decays to VT , the circuit snaps back to the previous
state; that is, v2 goes high and vO goes low. The step change in vO causes v3 to
jump from VT to VT −VDD ∼= −0.5VDD, after which v3 will again charge toward
v2 = VDD. As shown, v2 and vO snap back and forth between 0 and VDD, but in
antiphase, and they snap each time v3 reaches VT .
To ﬁnd f0 = 1/(TH +TL), we again use Eq. (10.3), ﬁrst with t = TH, V∞= 0,
V0 = VT + VDD, and V1 = VT , then with t = TL, V∞= VDD, V0 = VT −VDD,
and V1 = VT . The result is
f0 =
1
RC ln
VDD + VT
VT
× 2VDD −VT
VDD −VT

(10.11)
For VT = VDD/2 we get f0 = 1/(RC ln 9) = 1/2.2RC and D(%) = 50%. In practice,
due to production variations, there is a spread in the values of VT . This, in turn,
affects f0, thus limiting the circuit to applications where frequency accuracy is not
of primary concern.
We observe that if v3 were applied to I1 directly, the input protective diodes of
I1 would clamp v3 and alter the timing signiﬁcantly. This is avoided by using the
decoupling resistance R1 ≫R (in practice, R1 ∼= 10R will sufﬁce).
CMOS Crystal Oscillator
In precise timekeeping applications, frequency must be much more accurate and
stable than that afforded by simple RC oscillators. These demands are met with
crystal oscillators, an example of which is shown in Fig. 10.13. Since the circuit
exploits the electromechanical-resonance characteristics3 of a quartz crystal to set
f0, it acts more like a tuned ampliﬁer than a multivibrator. The idea here is to
Rf
10 MΩ
R1
C2
10 pF
2 kΩ
1 MHz
Xtal
C1
10 pF
I
vO
FIGURE 10.13
CMOS-gate crystal oscillator.

498
CHAPTER 10
Signal Generators
place a network that includes a crystal in the feedback loop of a high-gain inverting
ampliﬁer. This network routes a portion of the output signal back to the input, where
it is reampliﬁed in such a way as to sustain oscillation at a frequency set by the
crystal.
A CMOS gate is made to operate as a high-gain ampliﬁer by biasing it near
the center of its VTC, where slope is the steepest and gain is thus maximized.
Using a plain feedback resistance R f , as shown, establishes the dc operating point
at VO = VI = VT ∼= VDD/2. Thanks to the extremely low input leakage current of
CMOS gates, R f can be made quite large. The function of the remaining components
is to help establish the proper loss and phase, as well as provide a low-pass ﬁlter
action to discourage oscillation at the crystal’s higher harmonics.
Although crystals have to be ordered for speciﬁc frequencies, a number of
commonly used units are available off the shelf, namely, 32.768 kHz crystals for
digital wristwatches, 3.579545 MHz for TV tuners, and 100 kHz, 1 MHz, 2 MHz,
4 MHz, 5 MHz, 10 MHz, etc., for digital clock applications. A crystal oscillator can
be tuned slightly by varying one of its capacitances, as shown. Crystal oscillators of
the type shown can easily achieve stabilities on the order of 1 ppm/◦C (1 part-per-
million per degree Celsius).4
Thedutycycleofclockgeneratorsisnotnecessarily50%.Applicationsrequiring
perfect square-wave symmetry are easily accommodated by feeding the oscillator
to a toggle ﬂip-ﬂop. The latter then produces a square wave with D(%) = 50%,
but with half the frequency of the oscillator. To achieve the desired frequency, we
simply use a crystal with a frequency rating twice as high.
Monostable Multivibrator
On receiving a trigger pulse at the input, a monostable multivibrator or one-shot
produces a pulse of a speciﬁed duration T. This duration can be generated digitally,
by counting a speciﬁed number of pulses from a clock source, or in analog fashion,
by using a capacitor for time-out control. One-shots are used to generate strobe
commands and delays, and in switch debouncing.
The circuit of Fig. 10.14 uses a NOR gate G and an inverter I. The NOR yields
a high output only when both inputs are low; if at least one of the inputs is high,
the output will be low. Under normal conditions, vI is low and C is in steady state,
so v2 = VDD due to the pullup action by R, and vO = 0 by inverter action. Further,
since both inputs to the NOR gate are low, its output is high, or v1 = VDD, indicating
zero voltage across C.
The arrival of a trigger pulse vI causes the NOR gate to pull v1 low. Since the
voltage across C cannot change instantaneously, v2 will also go low, causing in turn
vO to go high. Even if the trigger pulse is now deactivated, the NOR gate will keep v1
low because vO is high. This state of affairs, however, cannot last indeﬁnitely because
R is now charging C toward VDD. In fact, as soon as v2 reaches VT , the inverter snaps,
forcing vO back low. In response to this, the NOR gate forces v1 high, and C then
transmits this step to the inverter, thus reinforcing its initial snap in Schmitt-trigger
fashion. Even though v2 tries to swing from VT to VT + VDD ∼= 1.5VDD, the internal
protective diode D1 of the inverter, shown explicitly in Fig. 10.11b, will clamp v2
near VDD, thus discharging C. The circuit is now back in the stable state preceding

499
SECTION 10.3
Monolithic Timers
t
vI
VDD
VDD
VDD
t
v1
v1
v2
v2
0
0
VDD
t
T
vO
0
VDD
VT
t
0
R
C
+
vI
vO
(b)
(a)
I
G
FIGURE 10.14
CMOS-gate one-shot.
the arrival of the trigger pulse. The timeout T is found via Eq. (10.3) as
T = RC ln
VDD
VDD −VT
(10.12)
For VT = VDD/2, this reduces to T = RC ln 2 = 0.69RC.
A retriggerable one-shot begins a new cycle each time the trigger is activated,
including activation during T. By contrast, a nonretriggerable one-shot is insensitive
to triggering during T.
10.3
MONOLITHIC TIMERS
The need for the astable and monostable functions arises so often that special
circuits,4 called IC timers, are available to satisfy these needs. Among the vari-
ety of available products, the one that has gained the widest acceptance in terms
of cost and versatility is the 555 timer. Another popular product is the 2240 timer,
which combines a timer with a programmable counter to provide additional timing
ﬂexibility.
The 555 Timer
As shown in Fig. 10.15, the basic blocks of the 555 timer are: (a) a trio of identical re-
sistors, (b) a pair of voltage comparators, (c) a ﬂip-ﬂop, and (d) a BJT switch QO. The
resistances set the comparator thresholds at VTH = (2/3)VCC and VTL = (1/3)VCC.
For additional ﬂexibility, the upper threshold node is externally accessible via pin 5
so that the user can modulate the value of VTH. Regardless of the value of VTH, we
always have VTL = VTH/2.

500
CHAPTER 10
Signal Generators
+
–
CMP1
VCC
CMP2
VTH
VTL
3
4
8
6
5
2
7
1
CL
R
Q
S
Q
    
+
–
OUT
RES
THRESH
CONTROL
TRIG
DISCH
GND
R
R
QO
100 Ω
R
FIGURE 10.15
The 555 timer block diagram.
The state of the ﬂip-ﬂop is controlled by the comparators as follows: (a) When-
ever the voltage at the trigger input (TRIG) drops below VTL, CMP2 ﬁres and sets
the ﬂip-ﬂop, forcing Q high and Q low; with a low voltage at its base, QO is in
cutoff. (b) Whenever the voltage at the threshold input (THRESH) rises above VTH,
CMP1 ﬁres and clears the ﬂip-ﬂop, forcing Q low and Q high. With a high voltage
applied to its base via the 100- resistance, QO is now heavily on. Summarizing,
lowering TRIG below VTL turns QO off, and raising THRESH above VTH turns QO
heavily on. The ﬂip-ﬂop includes a reset input (RES) to force Q low and turn QO
on regardless of the conditions at the inputs of the comparators.
The 555 is available in both bipolar and CMOS versions. The bipolar versions
operate over a wide range of supply voltages, typically 4.5 V ≤VCC ≤18 V,
and are capable of sourcing and sinking output currents of 200 mA. The TLC555,
which is a popular CMOS version, is designed to operate over a power-supply
range of 2 V to 18 V, and has output current sinking and sourcing capabilities of
100 mA and 10 mA, respectively. The transistor switch is an enhancement-type
n-MOSFET. The advantages of CMOS timers are low power consumption, very
high input impedances, and a rail-to-rail output swing.
The 555 as an Astable Multivibrator
Figure 10.16 shows how the 555 is conﬁgured for astable operation using just three
external components. To understand circuit operation, refer also to the internal dia-
gram of Fig. 10.15.
At power turn-on (t = 0), when the capacitor is still discharged, the voltage at
the TRIG input is less than VTL. This forces Q high and keeps the BJT in cutoff, thus
allowing C to charge toward VCC via the series RA+RB. As soon as vC reaches VTH,

501
SECTION 10.3
Monolithic Timers
VOH
VCC
VCC
VTH
VTL
t
t
vO
vO
vC
0
0
0
(a)
(b)
RA
vC
RB
TH
TL
C
DISCH
THRESH
6
7
8
1
4
3
2
TRIG
OUT
RES
GND
VCC
FIGURE 10.16
The 555 timer as an astable multivibrator.
CMP1 ﬁres and forces Q low. This turns on QO, which then pulls the DISCH pin to
VCE(sat) ∼= 0 V. Consequently, C now discharges toward ground via RB. As soon as
vC reaches VTL, CMP2 ﬁres, forcing Q high and turning off QO. This reestablishes
the conditions for a new cycle of astable operation.
The time intervals TL and TH are found via Eq. (10.3). During TL the time
constant is RBC, so TL = RBC ln(VTH/VTL) = RBC ln 2; during TH the time
constant is (RA + RB)C, so TH = (RA + RB)C ln[(VCC −VTL)/(VCC −VTH)].
Consequently,
T = TL + TH = RBC ln 2 + (RA + RB)C ln VCC −VTH/2
VCC −VTH
(10.13)
Substituting VTH = (2/3)VCC and solving for f0 = 1/T and D(%) = 100TH/
(TL + TH) gives
f0 =
1.44
(RA + 2RB)C
D(%) = 100 RA + RB
RA + 2RB
(10.14)
We observe that the oscillation characteristics are set by the external components
and are independent of VCC. To prevent power-supply noise from causing false
triggering when vC approaches either threshold, use a 0.01-μF bypass capacitor
between pin 5 and ground: this will clean VTH as well as VTL. The timing accuracy4
of the 555 astable approaches 1%, with a temperature stability of 0.005%/◦C and a
power-supply stability of 0.05%/V.
EXAMPLE 10.3.
In the circuit of Fig. 10.16 specify suitable components for f0 =
50 kHz and D(%) = 75%.
Solution. Let C = 1 nF, so that RA +2RB = 1.44/( f0C) = 28.85 k. Imposing (RA +
RB)/(RA + 2RB) = 0.75 gives RA = 2RB. Solving gives RA = 14.4 k (use 14.3 k)
and RB = 7.21 k (use 7.15 k).
Since VTL and VTH remain stable during the oscillation cycle, the dual-
comparator scheme utilized in the 555 allows higher operating frequencies than

502
CHAPTER 10
Signal Generators
the single-comparator schemes of the previous section. In fact some 555 versions
can easily operate to the megahertz range. The upper frequency limit is determined
by the combined propagation delays of the comparators, ﬂip-ﬂop, and transistor
switch. The lower-frequency limit is determined by how large the external compo-
nent values can practically be made. Thanks to the extremely low input currents,
CMOS timers allow for large external resistances, so very long time constants can
be obtained without using excessively large capacitances.
Since TH > TL, the circuit always gives D(%) > 50%. A symmetric duty cycle
can be approached in the limit RA ≪RB; however, making RA too small may lead
to excessive power dissipation. A better approach to perfect symmetry is to use an
output toggle ﬂip-ﬂop, as discussed in the previous section.
The 555 as a Monostable Multivibrator
Figure 10.17 shows the 555 connection for monostable operation. Under normal con-
ditions, the TRIG input is held high, and the circuit is in the stable state represented
by Q low. Moreover, the BJT switch QO is closed, keeping C discharged, or vC ∼= 0.
The circuit is triggered by lowering the TRIG input below VTL. When this is
done, CMP2 sets the ﬂip-ﬂop, forcing Q high and turning off QO. This frees C to
charge toward VCC via R. However, as soon as vC reaches VTH, the upper comparator
clears the ﬂip-ﬂop, forcing Q low and turning QO heavily on. The capacitance is
rapidly discharged, and the circuit returns to the stable state preceding the arrival of
the trigger pulse.
The pulse width T is readily found via Eq. (10.3) as
T = RC ln
VCC
VCC −VTH
(10.15)
0
t
vI
VTL
VCC
0
THRESH
OUT
6
2
7
1
4
8
TRIG
3
555
GND
DISCH
t
vC
vC
VTH
VCC
VCC
VCC
0
t
vO
vO 
VOH
T
(b)
(a)
+
vI
R
C
RES
FIGURE 10.17
The 555 timer as a monostable multivibrator.

503
SECTION 10.3
Monolithic Timers
Letting VTH = (2/3)VCC gives T = RC ln 3, or
T = 1.10RC
(10.16)
Note once again the independence of VCC. To enhance noise immunity, connect a
0.01-μF capacitor between pin 5 and ground (see Fig 10.15).
Voltage Control
If desired, the timing characteristics of the 555 can be modulated via the CONTROL
input. Changing VTH from its nominal value of (2/3)VCC will result in longer
or shorter capacitance charging times, depending on whether VTH is increased or
decreased.
When the timer is conﬁgured for astable operation, modulating VTH varies TH
while leaving TL unchanged, as indicated by Eq. (10.13). Consequently, the output
is a train of constant-width pulses with a variable repetition rate. This is referred to
as pulse-position modulation (PPM).
When the timer is conﬁgured for monostable operation, modulating VTH varies
T, as per Eq. (10.15). If the monostable is triggered by a continuous pulse train, the
output will be a pulse train with the same frequency as the input but with the pulse
width modulated by VTH. We now have pulse-width modulation (PWM).
PPM and PWM represent two common forms of information encoding for stor-
age and transmission. Note that once VTH is overridden externally, VTH and VCC
are no longer related; hence, the timing characteristics are no longer independent
of VCC.
EXAMPLE 10.4.
Assuming VCC = 5 V in the multivibrator of Example 10.3, ﬁnd the
range of variation of f0 and D(%) if the voltage at the CONTROL input is modulated
by ac coupling to it an external sine wave with a peak amplitude of 1 V.
Solution.
The range of variation of VTH is (2/3)5 ± 1 V, or between 4.333 V and
2.333 V. Substituting into Eq. (10.13) gives TL = 4.96 μs and 7.78 μs ≤TH ≤31.0 μs,
so we have 27.8 kHz ≤f0 ≤78.5 kHz, and 61.1% ≤D(%) ≤86.2%.
Timer/Counter Circuits
In applications requiring very long delays, the values of the timing components
can become impractically large. This drawback is overcome by using components
of manageable size and then stretching the multivibrator time scale with a binary
counter. This concept is exploited in the popular 2240 timer/counter circuit, as well
as other similar devices. As shown in Fig. 10.18, the basic elements of the 2240 are
a time-base oscillator (TBO), an 8-bit ripple counter, and a control ﬂip-ﬂop (FF).
The TBO is similar to the 555 timer, except that RB has been eliminated to reduce
the external component count, and the comparator thresholds have been changed to
VTL = 0.27VCC and VTH = 0.73VCC to make the value of the logarithm in Eq. (10.13)
exactly unity. Thus, the time-base is
T = RC
(10.17)

504
CHAPTER 10
Signal Generators
9
OUT
TRIG
TBO
Time
OUT
10
11
TRIGGER
RESET
R
C
R
+
20 kΩ
128T
8 
7
64T
6
32T
5
16T
4
8T
3
4T
2
2T
1
15
14
16
13
T
Rp
10 kΩ
Binary
counter
FF
S
Q
INH
TBO
CK
R
VCC
To
T
(a)
(b)
FIGURE 10.18
(a) Programmable delay generator using the XR2240 timer/counter. (b) Timing
diagram. (Courtesy of Exar.)

505
SECTION 10.4
Triangular Wave
Generators
The binary counter consists of eight toggle ﬂip-ﬂops that are buffered by open-
collector BJTs. The desired amount of time stretching is programmed by connecting
a suitable combination of counter outputs to a common pullup resistor Rp in a
wired-OR conﬁguration. Once a particular combination is selected, the output will
be low as long as any one of the selected outputs is low. For instance, connecting
only pin 5 to the pullup resistor gives To = 16T , while connecting pins 1, 3, and 7
gives To = (1+4+64)T = 69T , where To is the duration of the output timing cycle.
By suitable choice of the connection pattern, one can program To anywhere over the
range T ≤To ≤255T .
The purpose of the control ﬂip-ﬂop is to translate the external TRIGGER and
RESET commands to the proper controls for the TBO and the counter. At power
turn-on the circuit comes up in the reset state, where the TBO is inhibited and all
open-collector outputs are high. On receiving an external trigger pulse, the control
ﬂip-ﬂop goes high and initiates a timing cycle by enabling the TBO and forcing
the common output node of the counter low. The TBO will now run until the count
programmed by the wired-OR pattern is reached. At this point the output goes high,
resetting the control ﬂip-ﬂop and stopping the TBO. The circuit is now in the reset
state, awaiting the arrival of the next trigger pulse.
Cascading the counter stages of two or more 2240s makes it possible to achieve
truly long delays. For instance, cascading two 8-bit counters yields an effective
counter length of 16 bits, which allows To to be programmed anywhere in the range
from T to over 65 × 103T . In this manner, delays of hours, days, or months can be
generated using relatively small timing component values. Since the counters do not
affect the timing accuracy, the accuracy of To depends only on that of T, which is
typically around 0.5%. T can be ﬁne-tuned by adjusting R.
10.4
TRIANGULAR WAVE GENERATORS
Triangular waves are generated by alternately charging and discharging a capacitor
with a constant current. In the circuit of Fig. 10.19a the current drive for C is
provided by OA, a JFET-input op amp functioning as a ﬂoating-load V-I converter.
The converter receives a two-level drive from a 301 op amp comparator conﬁgured
as a Schmitt trigger. Because of the inversion introduced by OA, the Schmitt trigger
must be of the noninverting type. Also shown is a diode clamp to stabilize the
Schmitt-trigger output levels at ±Vclamp = ±(VZ5 + 2VD(on)). Consequently, the
Schmitt-trigger input thresholds are ±VT = ±(R1/R2)Vclamp.
Circuit behavior is visualized in terms of the waveforms of Fig. 10.19b. Assume
at power turn-on (t = 0) CMP swings to +Vsat so that vSQ = +Vclamp. OA converts
this voltage to a current of value Vclamp/R entering C from the left. This causes vTR
to ramp downward. As soon as vTR reaches −VT , the Schmitt trigger snaps and vSQ
switches from +Vclamp to −Vclamp. OA converts this new voltage to a capacitance
current of the same magnitude but opposite polarity. Consequently, vTR will now
ramp upward. As soon as vTR reaches +VT , the Schmitt trigger snaps again, thus
repeating the cycle. Figure 10.19b shows also the waveform v1 at the noninverting
input of CMP. By the superposition principle, this waveform is a linear combination
of vTR and vSQ, and it causes the Schmitt trigger to snap whenever it reaches 0 V.

506
CHAPTER 10
Signal Generators
–
+
+
–
OA
CMP
LM301
VT
–VT
T
vTR
vTR
vSQ
vSQ
0
Vclamp
–Vclamp
0
R2
R1
C
R
R3
D1
D5
D2
D3
D4
(b)
(a)
t
t
t
v1
v1
LF356
FIGURE 10.19
Basic triangular/square-wave generator.
By symmetry, the time taken by vTR to ramp from −VT to +VT is T/2. Since
the capacitor is operated at constant current, we can apply Eq. (10.2) with t =
T/2, I = Vclamp/R and v = 2VT = 2(R1/R2)Vclamp. Letting f0 = 1/T gives
f0 = R2/R1
4RC
(10.18)
indicating that f0 depends only on external components, a desirable feature indeed.
As usual, f0 can be varied continuously by means of R, or in decade steps by means
of C. The operating frequency range is limited at the upper end by the SR and GBP
of OA as well as the speed of response of CMP; at the lower end by the size of R
and C, as well as the input bias current of OA and capacitor leakage. A FET-input
op amp is usually a good choice for OA, while CMP should be an uncompensated
op amp or, better yet, a high-speed voltage comparator.
EXAMPLE 10.5.
In the circuit of Fig. 10.19a specify suitable components for a square
wave with peak values of ±5 V, a triangular wave with peak values of ±10 V, and f0
continuously variable from 10 Hz to 10 kHz.
Solution.
We need VZ5 = Vclamp −2VD(on) = 5 −2 × 0.7 = 3.6 V, and R2/R1 =
Vclamp/VT = 5/10 = 0.5 (use R1 = 20 k, R2 = 10 k). Since f0 must be variable over
a 1000 : 1 range, implement R with a pot and a series resistance Rs such that Rpot + Rs =
1000Rs, or Rpot ∼= 103Rs. Use Rpot = 2.5 M and Rs = 2.5 k. For R = Rmin = Rs we
want f0 = f0(max) = 10 kHz. By Eq. (10.18), C = 0.5/(104 × 4 × 2.5 × 103) = 5 nF.
The function of R3 is to provide current to R, R2, the diode bridge, and the output
load under all operating conditions. Now, IR(max) = Vclamp/Rmin = 5/2.5 = 2 mA, and
IR2(max) = Vclamp/R2 = 5/10 = 0.5 mA. Imposing a bridge current of 1 mA and allowing
for a maximum load current of 1 mA yields IR3(max) = 2 + 0.5 + 1 + 1 = 4.5 mA. Then,
R3 = (13 −5)/4.5 = 1.77 k (use 1.5 k to be safe). For the diode bridge, use a
CA3039 diode array.

507
SECTION 10.4
Triangular Wave
Generators
+
+
–
OA
–
CMP
VT
–VT
TL
TH
vTR
vTR
vSQ
vSQ
0
Vclamp
–Vclamp
0
R2
R1
R
C
R3
RH
RL
D1
D2
D3
D4
D6
D5
D7
D8
D9
(b)
(a)
t
t
FIGURE 10.20
Triangular wave generator with independently adjustable slopes.
Slope Control
With the modiﬁcation of Fig. 10.20a, the charge and discharge times can be adjusted
independently to generate asymmetric waves. With vSQ = +Vclamp, D3 is on and
D4 is off, so the discharge current is IH = [Vclamp −VD(on)]/(RH + R). With
vSQ = −Vclamp, D3 is off and D4 is on, and the charge current is IL = [Vclamp −
VD(on)]/(RL + R). The charge and discharge times are found as C × 2VT = ILTL
and C × 2VT = IH TH, respectively. The function of D1 and D2 is to compensate
for the VD(on) term due to D3 and D4. With D1 and D2 in place we now have
VT /R1 = [Vclamp −VD(on)]/R2. Combining all the above information yields
TL = 2 R1
R2
C(RL + R)
TH = 2 R1
R2
C(RH + R)
(10.19)
The frequency of oscillation is f0 = 1/(TH + TL). Note that if one of the slopes is
made much steeper than the other, vTR will approach a sawtooth and vSQ a train of
narrow pulses.
Voltage-Controlled Oscillator
Many applications require that f0 be programmable automatically, for instance, via
a control voltage vI . The required circuit, known as a voltage-controlled oscillator
(VCO), is designed to give f0 = kvI , vI > 0, where k is the sensitivity of the VCO,
in hertz per volt.
Figure 10.21 shows a popular VCO realization. Here OA is a V-I converter that
forces C to conduct a current linearly proportional to vI . To ensure capacitor charging

508
CHAPTER 10
Signal Generators
+
–
t
vTR
0
t
vSQ
0
10 V
10 V
+15 V
+15 V
T
vI/2
+
–
OA
R
R2
1.8 kΩ
R3
10 kΩ
R3
10 kΩ
M1
M116
R1
3.6 kΩ
+
iI
2iI
25 kΩ
2R
LF356
CMP
LM311
C
3
2
5
1
6
(b)
(a)
vI
(>0)
vTR
vSQ
FIGURE 10.21
Voltage-controlled triangular/square-wave oscillator. (Power supplies are ±15 V.)
as well as discharging, this current must alternate between opposite polarities. As
we shall see shortly, polarity is controlled via the n-MOSFET switch. Moreover,
CMP forms a Schmitt trigger whose output levels are VOL = VCE(sat) ∼= 0 V
when the output BJT is saturated, and VO H = VCC/(1 + R2/R1) = 10 V when the
BJT is off. Since the noninverting input is obtained directly from the output, the
trigger thresholds are likewise VTL = 0 V and VTH = 10 V. The circuit operates as
follows.
By op amp and voltage-divider action, the voltage at both inputs of OA is vI /2, so
the current through the 2R resistance is at all times iI = (vI −vI /2)/2R = vI /4R.
Assume the Schmitt trigger starts in the low state, or vSQ ∼= 0 V. With a low gate
voltage, M1 is off, so all the current supplied by the 2R resistance ﬂows into C,
causing vTR to ramp downward.
As soon as vTR reaches VTL = 0 V, the Schmitt trigger snaps, causing vSQ to
jump to 10 V. With a high gate voltage, M1 turns on and shorts R to ground, sinking
the current (vI /2)/R = 2iI . Since only half of this current is supplied by the 2R
resistance, the other half must come from C. Thus, the effect of turning on M1 is to
reverse the current through C without affecting its magnitude. Consequently, vTR is
now ramping upward.
As soon as vTR reaches VTH = 10 V, the Schmitt trigger snaps back to 0 V,
turning off M1 and reestablishing the conditions of the previous half-cycle. The
circuit is therefore oscillating. Using Eq. (10.2) with t = T/2, I = vI /(4R), and
v = VTH −VTL, and then solving for f0 = 1/T gives
f0 =
vI
8RC(VTH −VTL)
(10.20)
With VTH −VTL = 10 V we get f0 = kvI , k = 1/(80RC). Using, for example,
R = 10 k, 2R = 20 k, and C = 1.25 nF gives a sensitivity k = 1 kHz/V. Then,
varying vI over the range of 10 mV to 10 V sweeps f0 over the range of 10 Hz to
10 kHz.

509
SECTION 10.4
Triangular Wave
Generators
The accuracy of Eq. (10.20) is limited at high frequencies by the dynamics of
OA, CMP, and M1, and at low frequencies by the input bias current and offset voltage
of OA. To null the latter, set vI to a low value, say, 10 mV, and then adjust the offset-
nulling pot for a 50% duty cycle. Another source of error is the channel resistance
rds(on) of the FET switch. The data sheets of the M116 FET give rds(on) = 100 
typical. With R = 10 k, this represents an error of only 1%; if desired, this can be
eliminated by reducing R from 10 k to 10 k −100  = 9.9 k.
Triangular-to-Sine Wave Conversion
If a triangular wave is passed through a circuit exhibiting a sinusoidal VTC, as shown
in Fig. 10.22a, the result is a sine wave. Since nonlinear wave shaping is independent
of frequency, this form of sine wave generation is particularly convenient when used
in connection with triangular-output VCOs, since the latter offer much wider tuning
ranges than Wien-bridge oscillators. Practical wave shapers approximate a sinusoidal
VTC by exploiting the nonlinear characteristics of diodes or transistors.4
In the circuit of Fig. 10.22b a sinusoidal VTC is approximated by suitably over-
driving an emitter-degenerated differential pair. Near the zero-crossings of the input,
the gain of the pair is approximately linear; however, as either peak is approached,
one of the BJTs is driven to the verge of cutoff, where the VTC becomes logarithmic
and produces a gradual rounding of the triangular wave. The THD of the output is
minimized4 at about 0.2% for RI ∼= 2.5VT and Vim ∼= 6.6VT , where Vim is the peak
amplitude of the triangular wave and VT is the thermal voltage (VT ∼= 26 mV at
room temperature). This translates to RI ∼= 65 mV and Vim ∼= 172 mV, indicating
that the triangular wave must be properly scaled to ﬁt the requirements of the wave
shaper.
R
Rc
Rc
+
vI
vI
vO
vI
t
t
vO
I
I
+
– vO
VCC
VEE
(b)
(a)
FIGURE 10.22
(a) VTC of a triangular-to-sine wave converter. (b) Logarithmic wave shaper.

510
CHAPTER 10
Signal Generators
EXAMPLE 10.6.
Design a circuit to convert a 1-kHz triangular wave of ±5-V peak
values to a ground-referenced sine wave, also of ±5-V peak values, and visualize the
input and output waveforms via PSpice. For a change, use the LF411 JFET-input op amp,
whose macromodel is available in PSpice’s library. Also, assume ±9-V power supplies.
Solution.
First, use a voltage divider (R1 and R2 in Fig. 10.23a) to scale the ±5-V
input vT to a ±172-mV drive for the base of Q1. Next, use R7 = 65  to implement the
condition (65 ) × (1 mA) = 2.5VT = 65 mV. Finally, use an LF411-based difference
ampliﬁer to convert the voltage difference between the collectors to a single-ended output
vS. Judging by the waveforms shown, vS is a fairly good sine wave representation.
+
R5
R4
2.0 kΩ
2.6 kΩ
0
0
2N2222
R7
Q1
Q2
I2
I1
1 mA
1 mA
65 Ω
R3
2.0 kΩ
2.8 kΩ
R2
100 Ω
0
R6
S
2.6 kΩ
2
3
4
6
7
LF411
–
VEE (−9 V)
VCC (+9 V)
vS
VCC (+9 V)
VEE (−9 V)
R1
T
vT
0
+
–
(a)
(b)
0
1.5
1
0.5
−5 V
0
5 V
Time (ms)
vS
vT
FIGURE 10.23
(a) PSpice triangular-to-sine converter and (b) input/output waveforms.
10.5
SAWTOOTH WAVE GENERATORS
A sawtooth cycle is generated by charging a capacitor at a constant rate and then
rapidly discharging it with a switch. Figure 10.24 shows a circuit utilizing this
principle. The current drive for C is provided by OA, a ﬂoating-load V-I converter. In
order for vST to be a positive ramp, iI must always ﬂow out of the summing junction,
or vI < 0. R2 and R3 establish the threshold VT = VCC/(1 + R2/R3) = 5 V.
At power turn-on (t = 0), when C is still discharged, the 311 comparator inputs
are vP = 0 V and vN = 5 V, indicating that the output BJT is in saturation and
vPULSE ∼= −15 V. With a gate voltage this low, the n-JFET J1 is in cutoff, allowing C
to charge. As soon as the ensuing ramp vST reaches VT , the comparator output BJT
goes off, allowing the 2-k resistor to pull vPULSE to ground. This change of state
takes place in a snapping fashion because of the positive-feedback action provided
by C1. Since now vGS = 0 V, the JFET switch closes and rapidly discharges C,
bringing vST to 0 V.

511
SECTION 10.5
Sawtooth Wave
Generators
vST
vPULSE
vPULSE
5 V
t
t
0
0
–15 V
TCH
TD
+
–
+
–
25 kΩ
20 kΩ
10 kΩ
10 kΩ
22 pF
iI
+
vI
LF356
2N4391
LM311
J1
R1
R
R2
R3
(<0)
2
1
OA
CMP
(b)
(a)
3
6
5
+15 V
vST
–15 V
2 kΩ
C
C1
FIGURE 10.24
Voltage-controlled sawtooth/pulse-wave oscillator.
The comparator is prevented from responding immediately to this change in
vST because of the charge accumulated in C1 during the transition of vPULSE from
−15 V to 0 V. This one-shot action, whose duration TD is proportional to R1C1, is
designed to ensure that C undergoes complete discharge. With the component values
shown, TD < 1 μs. After timing out, vPULSE returns to −15 V, turning J1 off again
and allowing C to resume charging. The cycle, therefore, repeats itself.
The charging time TCH is found using Eq. (10.2) with t = TCH, I = |vI |/R,
and v = VT . Letting f0 = 1/(TCH + TD), we obtain
f0 =
1
RCVT /|vI | + TD
(10.21)
As long as TD ≪TCH, this simpliﬁes to
f0 =
|vI |
RCVT
(10.22)
indicatingthat f0 islinearlyproportionaltothecontrolvoltagevI .With R = 90.9 k
andC = 2.2 nF, f0 = k|vI |,k = 1 kHz/V, so varyingvI from−10 mV to−10 V will
sweep f0 from 10 Hz to 10 kHz. The circuit can also function as a current-controlled
oscillator (CCO) if we drive it directly with a current sink iI . Then, f0 = iI /(CVT ).
A common application of sawtooth CCOs is found in electronic music, where the
control current is provided by an exponential V-I converter designed for a sensitivity
of 1 octave per volt over a 10-decade frequency range, typically from 16.3516 Hz
to 16.744 kHz.
Practical Considerations
A good choice for OA is a FET-input op amp combining low input bias current, which
is critical at the low end of the control range, with good slew-rate performance, which
is critical at the high end. The input offset voltage is not critical in the CCO mode;

512
CHAPTER 10
Signal Generators
however, offset nulling may be necessary in the VCO mode. Also, J1 should exhibit
low leakage and low rds(on).
The high-frequency accuracy of the oscillator is limited by the presence of TD in
Eq. (10.21). The ensuing error can be compensated for by speeding up the capacitor
charging time to make up for the delay TD. This can be achieved by making VT
decrease with frequency, for instance, by coupling vI , which is negative, to the
junction of R2 and R3 via a suitable series resistance R4. It can be proved (see
Problem 10.31) that choosing R4 = (R2 ∥R3) × (RC/TD −1) makes f0 linearly
proportionalto|vI |,thoughatthepriceofaslightreductionofthesawtoothamplitude
at high frequencies.
10.6
MONOLITHIC WAVEFORM GENERATORS
Also called function generators, these circuits are designed to provide the basic
waveforms with a minimum of external components. The heart of a waveform gen-
erator is a VCO that generates the triangular and square waves. Passing the triangular
wave through an on-chip wave shaper yields the sine wave, whereas conﬁguring the
oscillator for a highly asymmetric duty cycle gives the sawtooth and pulse-train
waves. The two most frequent VCO conﬁgurations are the grounded capacitor and
the emitter-coupled types,4 both of which are available either as stand-alone units
or as part of complex systems, such as phase-locked loops (PLLs), tone decoders,
V-F converters, and PWM controllers.
Grounded-Capacitor VCOs
These circuits are based on the principle of charging and discharging a grounded
capacitor at rates controlled by programmable current generators. With reference to
Fig. 10.25a, we note that when the switch SW is in the up position, C charges at a rate
set by the current source iH. Once vTR reaches the upper threshold VTH, the Schmitt
trigger changes state and ﬂips SW to the down position, causing C to discharge at
vTR
vSQ
VTH
VTL
t
t
0
0
TH
TL
vI
vTR
vSQ
VCC
iL
+
C
SW
(a)
(b)
iH
FIGURE 10.25
Grounded-capacitor VCO.

513
SECTION 10.6
Monolithic
Waveform
Generators
a rate set by the current sink iL. Once vTR reaches VTL, the trigger changes state
again, ﬂipping SW to the up position and repeating the cycle.
To allow for automatic frequency control, iH and iL are made programmable
via an external control voltage vI . If the magnitudes of iL and iH are equal, the
output waveform will be symmetric. Conversely, if one of the currents is made much
larger than the other, vTR will approach a sawtooth.
The grounded-capacitor conﬁguration is used in the design of temperature-stable
VCOs with operating frequencies up to tens of megahertz. Popular products utilizing
this conﬁguration are the NE566 function generator and the ICL8038 precision
waveform generator.
The ICL8038 Waveform Generator
In the circuit5 of Fig. 10.26, Q1 and Q2 form two programmable current sources
whose magnitudes are set by the external resistors RA and RB. The drive for Q1
and Q2 is provided by the emitter follower Q3, which also compensates for their
base-emitter voltage drops to yield iA = vI /RA and iB = vI /RB, with vI being
referenced to VCC as shown. While iA is fed to C directly, iB is diverted to the current
mirror Q4-Q5-Q6 where it undergoes polarity reversal as well as ampliﬁcation by 2
due to the combined action of Q5 and Q6. The result is a current sink of magnitude
2iB.
The Schmitt trigger is similar to that of the 555 timer, with VTL = (1/3)VCC and
VTH = (2/3)VCC. When the ﬂip-ﬂop output Q is high, Q7 saturates and pulls the
–
+
–
+
+
–
CMP2
R1
RA
RB
R
R
R
10 kΩ
R2
40 kΩ
Q3
Q1
Q5
Q4
Q6
Q7
Q2
BUF
CMP1
11
10
5
8
7
VCC
vI
iB
iB
2iB
iA
iA
C
IBIAS
R
S
Q
Q¯
6
2
3
9
4
Q8
FIGURE 10.26
Simpliﬁed circuit diagram of the ICL8038 waveform generator. (Courtesy of Harris Semi-
conductor.)

514
CHAPTER 10
Signal Generators
bases of Q5 and Q6 low, shutting off the current sink. Consequently, C charges at
a rate set by iH = iA. Once the capacitance voltage reaches VTH, CMP1 ﬁres and
clears the ﬂip-ﬂop, turning Q7 off and enabling the current mirror. The net current
out of C is now iL = 2iB −iA; as long as 2iB > iA, this current will cause C to
discharge. Once VTL is reached, CMP2 ﬁres and sets the ﬂip-ﬂop, thus repeating the
cycle. It can be shown (see Problem 10.36) that
f0 = 3

1 −RB
2RA

vI
RACVCC
D(%) = 100

1 −RB
2RA

(10.23)
With RA = RB = R the circuit yields symmetric waveforms with f0 = kvI ,
k = 1.5/RCVCC. As shown in the ﬁgure, the device is also equipped with a unity-
gain buffer to isolate the waveform developed across C, a wave shaper to convert
the triangular wave to a low-distortion sine wave, and an open-collector transistor
(Q8) to provide, with the help of an external pullup resistor, a square-wave output.
Figure 10.27 shows the wave shaper5 utilized in the 8038. The circuit is known
as a breakpoint wave shaper because it uses a set of breakpoints at designated
signal levels to ﬁt a nonlinear VTC by a piecewise linear approximation. The circuit,
designed to process triangular waves alternating between (1/3)VCC and (2/3)VCC,
uses the resistive strings shown at the right to establish two sets of breakpoint voltages
symmetric about the midrange value of (1/2)VCC. These voltages are then buffered
by the even-numbered emitter-follower BJTs. The circuit works as follows.
For vI near (1/2)VCC, all odd-numbered BJTs are off, giving vO = vI . Con-
sequently, the initial slope of the VTC is a0 = vO/vI = 1 V/V. As vI is in-
creased to the ﬁrst breakpoint, the common-base BJT Q1 goes on and loads down
the source, changing the VTC slope from a0 to a1 = 10/(1 + 10) = 0.909 V/V.
Further increasing vI to the second breakpoint turns Q3 on, changing the slope
to a2 = (10 ∥2.7)/[1 + (10 ∥2.7)] = 0.680 V/V. The process is repeated for the
remaining breakpoints above (1/2)VCC as well for the corresponding breakpoints
below (1/2)VCC. By progressively reducing the slope as vI moves away from its
midrange value, the circuit approximates a sinusoidal VTC with THD levels around
1% or less. We observe that the even- and odd-numbered BJTs associated with each
breakpoint are complementary to each other. This results in a ﬁrst-order cancella-
tion of the corresponding base-emitter voltage drops, yielding more predictable and
stable breakpoints.
Basic 8038 Applications5
In the basic connection of Fig. 10.28 the control voltage vI is derived from VCC via
the internal voltage divider R1 and R2 (see Fig. 10.26), so vI = (1/5)VCC. Inserting
into Eq. (10.23) gives
f0 = 0.3
RC
D(%) = 50%
(10.24)
indicating that f0 is independent of VCC, a desirable feature as we know. By proper
choice of R and C, the circuit can be made to oscillate at any frequency from 0.001 Hz
to 1 MHz. The thermal drift of f0 is typically 50 ppm/◦C. For optimum performance,
conﬁne iA and iB within the 1-μA to 1-mA range.

515
SECTION 10.6
Monolithic
Waveform
Generators
Q2
Q3
Q4
Q5
Q6
Q7
Q8
+
vI
Q9
Q10
Q11
Q12
Q13
Q14
Q15
Q16
2.7 kΩ
10 kΩ
2.7 kΩ
800 Ω
800 Ω
200 Ω
330 Ω
1.6 kΩ
375 Ω
330 Ω
375 Ω
200 Ω
5.2 kΩ
5.2 kΩ
vO
VCC
1 kΩ
33 kΩ
33 kΩ
33 kΩ
33 kΩ
33 kΩ
33 kΩ
33 kΩ
33 kΩ
Q1
10 kΩ
VCC
FIGURE 10.27
Breakpoint wave shaper. (Courtesy of Harris Semiconductor.)

516
CHAPTER 10
Signal Generators
8038
10
11
12
4
5
6
9
3
2
7
8
VCC
RP
R
R
C
RTHD
100 kΩ
RSYM
FIGURE 10.28
Basic ICL8038 connection for ﬁxed-
frequency, 50% duty cycle operation.
(Courtesy of Harris Semiconductor.)
For perfect symmetry it is crucial that iL and iH be exactly in a 2:1 ratio.
By adjusting RSYM, one can keep the distortion level of the sine wave near 1%.
Connecting a 100-k pot between pins 12 and 11 allows one to control the degree
of balance of the wave shaper to further reduce the THD.
As mentioned, the square-wave output is of the open-collector type, so a pullup
resistor Rp is needed. The peak-to-peak amplitudes of the square, triangular, and sine
waves are VCC, 0.33VCC, and 0.22VCC, respectively. All three waves are centered
at VCC/2. Powering the 8038 from split supplies makes the waves symmetric about
ground.
EXAMPLE 10.7.
Assuming VCC = 15 V in the circuit of Fig. 10.28, specify suitable
components for f0 = 10 kHz.
Solution.
Impose i A = iB = 100 μA, which is well within the recommended range.
Then, R = (15/5)/0.1 = 30 k, and C = 0.3/(10 × 103 × 30 × 103) = 1 nF. Use
Rp = 10 k, and use RSYM = 5 k to allow for a ±20% symmetry adjustment. Then,
recalculate R as 30−5/2 = 27.5 k (use 27.4 k). To calibrate the circuit, adjust RSYM
so that the square wave has D(%) = 50%, and RTHD until the THD of the sine wave is
minimized.
Varying the voltage of pin 8 provides automatic frequency sweeps. The fact that
the control voltage must be referenced to the VCC rail is annoying in certain appli-
cations. This can be avoided by powering the 8038 between ground and a negative
supply, as in Fig. 10.29. Also shown in the diagram is an op amp that converts the
control voltage vI to a current iI , which then splits evenly between Q1 and Q2.
This scheme also eliminates any errors stemming from imperfect cancellation of the
base-emitter voltage drops of Q3 and the Q1-Q2 pair. For accurate V-I conversion,
the input offset voltage of the op amp must be nulled. The circuit shown is designed
to give iI = vI /(5 k) over a 1000:1 range, and is calibrated as follows: (a) with
vI = 10.0 V and the wiper of R3 set in the middle, adjust R2 for D(%) = 50%; hence,

517
SECTION 10.6
Monolithic
Waveform
Generators
+
vI
Q3
Q2
Q1
+
–
LF356
4
5
6
9
3
2
12
11
10
1
2
3
7
5
8
6
4
C
–15 V
R5
100 kΩ
10 kΩ
R1
2.5 kΩ
R2
R4
R3
iI
3.9 kΩ
330 pF
100 kΩ
2.7 kΩ
500 Ω
3.3 MΩ
+15 V
2.7 kΩ
8038
–15 V
10 kΩ
25 kΩ
–15 V
+15 V
(10 mV to 10 V)
FIGURE 10.29
The ICL8038 as a linear voltage-controlled oscillator. (Courtesy of Harris Semiconductor.)
adjust R1 for the desired full-scale frequency fFS; (b) with vI = 10.0 mV, adjust
R4 for f0 = fFS/103; hence, adjust R3 for D(%) = 50%; repeat the adjustment of
R4, if necessary; (c) with vI = 1 V, adjust R5 for minimum THD.
Emitter-Coupled VCOs
These VCOs use a pair of cross-coupled Darlington stages and an emitter-coupling
timing capacitor, as shown4 in Fig. 10.30a. The two stages are biased with matched
emitter currents, and their collector swings are constrained to just one diode
voltage drop by clamps D1 and D2.
The cross-coupling between the two stages ensures that either Q1-D1 or Q2-D2
(but not both) are conducting at any given time. This bistable behavior is similar
to cross-coupled inverters in ﬂip-ﬂop realizations. Unlike ﬂip-ﬂops, however, the
capacitive coupling between the emitters causes the circuit to alternate between
its two states in astable-multivibrator fashion. During any half cycle, the capacitor
plate connected to the stage that is on remains at a constant potential, while the plate
connected to the stage that is off ramps downward at a rate set by iI . As the ramp
approaches the emitter conduction threshold of the corresponding BJT, the latter
goes on, forcing the other BJT to go off because of the positive-feedback action
stemming from cross-coupling. Thus, C is alternately charged and discharged at a
rate set by iI .
Circuit operation is better visualized by tracing through the waveforms of
Fig. 10.30b. Note that the emitter waveforms are identical except for a half-cycle de-
lay. Feeding them to a high input-impedance difference ampliﬁer yields a symmetric
triangular wave with a peak-to-peak amplitude of two base-emitter voltage drops.

518
CHAPTER 10
Signal Generators
+
IBIAS
VCC  – VBE
VCC  – 2VBE
VCC  – VBE
VCC  – VBE
VCC  – 2VBE
VCC  – 3VBE
VCC  – VBE
VCC  – 3VBE
+VBE
–VBE
vE1– vE2
VCC
vB1
vB2
vE1
vE2
Rc
Rc
C
iI
iI
(a)
(b)
Q4
Q1
Q3
D1
D2
Q2
IBIAS
vI
FIGURE 10.30
Emitter-coupled VCO.
The frequency of oscillation is found via Eq. (10.2) with t = T/2 and v = 2VBE.
Letting f0 = 1/T gives
f0 =
iI
4CVBE
(10.25)
indicating the CCO capability of the circuit.
The emitter-coupled oscillator enjoys a number of advantages: (a) it is sim-
ple and symmetric, (b) it lends itself to automatic frequency control, and (c) it
is inherently capable of high-frequency operation since it consists of nonsaturat-
ing npn-BJTs. In its basic form of Fig. 10.30a, however, it suffers from a major
drawback, namely, the thermal drift of VBE, which is typically −2 mV/◦C. There
are various methods4 of stabilizing f0 with temperature. One method makes iI
proportional to VBE to render their ratio temperature-independent. Popular devices
utilizing this technique are the PLLs of the NE560 and XR-210/15 types. Other
methods modify the basic circuit to eliminate the VBE term altogether. Though the
increased circuit complexity lowers the upper end of the usable frequency range,
these methods achieve thermal drifts as low as 20 ppm/◦C. Popular products using
this approach are the XR2206/07 monolithic function generators and the AD537
V-F converter.
The XR2206 Function Generator
This device uses an emitter-coupled CCO to generate the triangular and square
waves, and a logarithmic wave shaper to convert the triangle to the sine wave.4 The
CCO parameters are designed so that when the circuit is connected in the basic

519
SECTION 10.6
Monolithic
Waveform
Generators
16
15
14
13
2206
CCO
12
11
10
9
1
2
3
4
5
6
7
8
Multiplier
and
sine
shaper
Current
switches
RSYM
R1
C
R
1 kΩ
2 MΩ
+
R2
50 kΩ
25 kΩ
RTHD
500 kΩ
5.1 kΩ
5.1 kΩ
10 kΩ
VCC
VCC
+1
1 μF (Bypass)
FIGURE 10.31
Basic XR2206 connection for low-distortion sine wave generation. (Courtesy of Exar.)
conﬁguration of Fig. 10.31, the frequency of oscillation is
f0 = 1
RC
(10.26)
The operating frequency range is from 0.01 Hz to more than 1 MHz, with a typical
thermal stability of 20 ppm/◦C. The recommended range for R is from 1 k to
2 M, and the optimum range is 4 k to 200 k. Varying R with a pot, as shown,
allows for a 2000 : 1 sweep of f0. Symmetry and distortion adjustments are provided,
respectively, by RSYM and RTHD. With proper calibration the circuit can achieve
THD ∼= 0.5%.
The amplitude and offset of the sine wave are set by the resistive network
external to pin 3. Denoting the equivalent resistance seen by this pin as R3, the
peak amplitude is approximately 60 mV for every kilohm of R3. For instance,
with the wiper of R2 set in the middle, the peak amplitude of the sine wave is
[25 + (5.1 ∥5.1)] × (60 mV) ∼= 1.65 V. The sine wave offset is the same as the dc
voltage established by the external network. With the components shown, this is
VCC/2.
Open circuiting pins 13 and 14 disables the rounding action by the wave shaper
so that the output waveform becomes triangular. Its offset is the same as that of
the sine wave; however, its peak amplitude is approximately twice as large. The
square-wave output is of the open-collector type, hence, a pullup resistor is required.
Figure 10.32 shows another widely used 2206 conﬁguration, which exploits
the device’s ability to operate with two separate timing resistances R1 and R2. With
control pin 9 open-circuited or driven high, only R1 is active and the circuit oscillates
at f1 = 1/(R1C); similarly, with pin 9 driven low, only R2 is active and the circuit
oscillates at f2 = 1/(R2C). Thus, frequency can be keyed between two levels, often
referred to as mark and space frequencies, whose values are set independently by
R1 and R2. Frequency shift keying (FSK) is a widely used method of transmitting

520
CHAPTER 10
Signal Generators
2206
CCO
FSK Out
1
2
3
4
5
6
7
8
< 1 V
> 2 V
Multiplier
and
sine
shaper
Current
switches
R1
R2
C
+
R2
50 kΩ
200 kΩ
5.1 kΩ
5.1 kΩ
VCC
+1
1 μF
+
vI
f1
f2
16
15
14
13
12
11
10
9
FIGURE 10.32
Sinusoidal FSK generator. (Courtesy of Exar.)
data over telecommunication links. If the FSK control signal is obtained from the
square-wave output, R1 and R2 will be active on alternate half-cycles of oscillation.
This feature can be exploited to conﬁgure the 2206 as a sawtooth/pulse generator.
10.7
V-F AND F-V CONVERTERS
The function of a voltage-to-frequency converter (VFC) is to accept an analog input
vI and generate a pulse train with frequency
fO = kvI
(10.27)
where k is the VFC sensitivity, in hertz per volt. As such, the VFC provides a simple
form of analog-to-digital conversion. The primary reason for this type of conversion
is that a pulse train can be transmitted and decoded much more accurately than
an analog signal, especially if the transmission path is long and noisy. If electrical
isolation is also desired, it can be accomplished without loss of accuracy using
inexpensive optocouplers or pulse transformers. Moreover, combining a VFC with
a binary counter and digital readout provides a low-cost digital voltmeter.6
VFCs usually have more stringent performance speciﬁcations than VCOs. Typ-
ical requirements are (a) wide dynamic range (four decades or more), (b) the ability
to operate to relatively high frequencies (hundreds of kilohertz, or higher), (c) low
linearity error (less than 0.1% deviation from the straight line going from zero to the
full scale), (d) high scale-factor accuracy and stability with temperature and supply
voltage. The output waveform, on the other hand, is of secondary concern as long as
its levels are compatible with standard logic signals. VFCs fall into two categories:
wide-sweep multivibrators and charge-balancing VFCs.4

521
SECTION 10.7
V-F and F-V
Converters
Wide-Sweep Multivibrator VFCs
These circuits are essentially voltage-controlled astable multivibrators designed with
VFC performance speciﬁcations in mind. The multivibrator is usually a temperature-
stabilized version of the basic CCO concept of Fig. 10.30. A popular product7 in this
category is the AD537 shown in Fig. 10.33. The op amp and Q1 form a buffer V-I
converter that converts vI to the current drive iI for the CCO according to iI = vI /R.
The CCO parameters have been chosen so that fO = iI /(10C), or
fO =
vI
10RC
(10.28)
This relationship holds fairly accurately over a dynamic range of at least four de-
cades, up to a full-scale current of 1 mA and a full-scale frequency of 100 kHz.
For instance, with C = 1 nF, R = 10 k, and VCC = 15 V, varying vI from
1 mV to 10 V varies iI from 0.1 μA to 1 mA and fO from 10 Hz to 100 kHz.
To minimize the V-I conversion error at the low end of the range, the op amp in-
put offset error is nulled internally via ROS. With a capacitor of suitable quality
(polystyrene or NPO ceramic for low thermal drift and low dielectric absorption),
the linearity error ratings are 0.1% typical for fO ≤10 kHz, 0.15% typical for
fO ≤100 kHz.
Though the ﬁgure shows the connection for vI > 0, we can easily conﬁgure
the device for vI < 0 by grounding the noninverting input of the op amp, lifting the
left terminal of R off ground, and applying vI there. The device can also function
as a current-to-frequency converter (CFC) if we make the control current ﬂow out
of the inverting input node. For instance, grounding pin 5 and replacing R by a
photodetector diode current sink will convert light intensity to frequency.
The AD537 also includes an on-chip precision voltage reference to stabilize the
CCO scale factor. This yields a typical thermal stability of 30 ppm/◦C. To further
enhance the versatility of the device, two nodes of the reference circuitry are made
available to the user, namely, VR and VT . Voltage VR is a stable 1.00-V voltage
reference. Obtaining vI from pin 7 in Fig. 10.33 yields fO = 1/(10RC), and if R is
14
13
AD537
BUF
12
11
10
9
8
1
2
3
4
5
6
7
CCO
Driver
Precision
voltage
reference
C
Q2
Q1
+
vI
(> 0 V)
ROS
20 kΩ
5 kΩ
VCC
VT
VR
fO
+
–
iI
R
FIGURE 10.33
The AD537 voltage-to-frequency converter. (Courtesy of Analog Devices.)

522
CHAPTER 10
Signal Generators
a resistive transducer, such as a photoresistor or a thermistor, it will convert light or
temperature to frequency.
Voltage VT is a voltage linearly proportional to absolute temperature T as VT =
(1 mV/K)T . For instance, at T = 25 ◦C = 298.2 K we have VT = 298.2 mV. If vI
is derived from pin 6 in Fig. 10.33, then fO = T/(RC × 104K), indicating that the
circuit converts absolute temperature to frequency. For instance, with R = 10 k
and C = 1 nF, the sensitivity is 10 Hz/K. Other temperature scales, such as Celsius
and Fahrenheit, can be accommodated by suitably offsetting the input range with
the help of VR.
EXAMPLE 10.8.
In the circuit of Fig. 10.34 specify suitable components to yield
Celsius-to-frequency conversion with a sensitivity of 10 Hz/◦C; then outline the cal-
ibration procedure.
Solution.
For T = 0 ◦C = 273.2 K we have VT = 0.2732 V and we want fO = 0.
Thus, R3 must develop a 0.2732-V drop. Imposing 0.2732/R3 = (1.00 −0.2732)/R2
yields R2 = 2.66R3. For a sensitivity of 10 Hz/◦C we want 10 = 1/104RC, where
R = R1 + (R2 ∥R3) is the effective resistance seen by Q1. Let C = 3.9 nF; then
R = 2.564 k. Let R3 = 2.74 k; then R2 = 2.66 × 2.74 = 7.29 k (use 6.34 k
in series with a 2-k pot). Finally, R1 = 2.564 −(2.74 ∥7.29) = 572  (use 324  in
series with a 500- pot).
To calibrate, place the IC in a 0 ◦C environment and adjust R2 so that the circuit
is barely oscillating, say, fO ∼= 1 Hz. Then move the IC to a 100 ◦C environment and
adjust R1 for fO = 1.0 kHz.
Figure 10.34 shows another useful feature of the AD537, namely, the ability
to transmit information over a twisted pair. This pair serves the dual purpose of
supplying power to the device and carrying frequency data in the form of current
+
–
1 kΩ
120 Ω
220 Ω
Q2
Q1
R1
R2
R3
1
2
3
4
5
6
7
14
13
12
11
10
 9
 8
Driver
CCO
AD537
Precision
voltage
reference
VT
VR
BUF
C
iI
GND
Rp
5 V
VCC
fO
Q3
FIGURE 10.34
AD537 application as a temperature-to-frequency converter with two-wire transmission.
(Courtesy of Analog Devices.)

523
SECTION 10.7
V-F and F-V
Converters
modulation. With the parameter values shown, the current drawn by the AD537
alternates between about 1.2 mA during the half-cycle in which Q2 is off, and
1.2 + [5 −VEB3(sat) −VCE2(sat)]/Rp ∼= 1.2 + (5 −0.8 −0.1)/1 = 5.3 mA during
the half-cycle in which Q2 is on. This current difference is sensed by Q3 as a voltage
drop across the 120- resistance. This drop is designed to be low enough to keep
Q3 in cutoff when the current is 1.2 mA, yet large enough to drive Q3 in saturation
when the current is 5.3 mA. Consequently, Q3 reconstructs a 5-V square wave at
the receiving end. The ripple of about 0.5 V appearing across the 120- resistance
does not affect the performance of the AD537, thanks to its high PSRR.
Charge-Balancing VFCs
The charge-balancing technique8 supplies a capacitor with continuous charge at a
rate that is linearly proportional to the input voltage vI , while simultaneously pulling
discrete charge packets out of the capacitor at a rate fO such that the net charge ﬂow
is always zero. The result is fO = kvI . Figure 10.35 illustrates the principle using
the VFC32 V-F converter.
OA converts vI to a current iI = vI /R ﬂowing into the summing junction; the
value of R is chosen such that we always have iI < 1 mA. With SW open, iI ﬂows
into C1 and causes v1 to ramp downward. As soon as v1 reaches 0 V, CMP ﬁres
and triggers a precision one-shot that closes SW and turns on Q1 for a time interval
+
–
Q1
R
13
10
12
11
4
Rp
7
fO
fO
One-
shot
5
+
SW
1
14
OA
CMP
C
VEE
VCC
v1
(a)
C1
vI 
(> 0) 
v1
t
t
TH
TL
(b)
1 mA
+
–
iI
FIGURE 10.35
The VFC32 voltage-to-frequency converter. (Courtesy of Texas Instruments.)

524
CHAPTER 10
Signal Generators
TH set by C. The one-shot, whose details have been omitted for simplicity, uses a
threshold of 7.5 V and a charging current of 1 mA to give
TH = 7.5 V
1 mAC
(10.29)
The closure of SW causes a net current of magnitude (1 mA −iI ) to ﬂow out
of the summing junction of OA. Consequently, during TH, v1 ramps upward by an
amount v1 = (1 mA −iI )TH/C1. After the one-shot times out, SW is opened
and v1 resumes ramping downward at a rate again set by iI . The time TL it takes
for v1 to return to zero is such that TL = C1v1/iI . Eliminating v1 and letting
fO = 1/(TL + TH) gives, with the help of Eq. (10.29),
fO =
vI
7.5RC
(10.30)
where fO is in hertz, vI in volts, R in ohms, and C in farads. As desired, fO is
linearly proportional to vI . Moreover, the duty cycle D(%) = 100× TH/(TH + TL)
is readily found to be
D(%) = 100
vI
R × 1 mA
(10.31)
and it is also proportional to vI . For best linearity, the data sheets recommend
designing for a maximum duty cycle of 25%, which corresponds to iI(max) =
0.25 mA.
The absence of C1 from the above equations indicates that the tolerance and
drift of this capacitor are not critical, so its value can be chosen arbitrarily. However,
for optimum performance, the data sheets recommend using the value of C1 that
yields v1 ∼= 2.5 V. C, on the other hand, does appear in Eq. (10.30), so it must
be a low-drift type, such as NPO ceramic. If C and R have equal but opposing
thermal coefﬁcients, the overall drift can be reduced to as little as 20 ppm/◦C.
For accurate operation to low values of vI , the input offset voltage of OA must be
nulled.
The VFC32 offers a 6-decade dynamic range with typical linearity errors of
0.005%, 0.025%, and 0.05% of full-scale reading for full-scale frequencies of
10 kHz, 100 kHz, and 500 kHz, respectively. Though Fig. 10.35 shows the con-
nection for vI > 0, the circuit is readily conﬁgured for vI < 0 or for current-input
operation in a manner similar to the AD537 discussed above.
EXAMPLE 10.9.
In the circuit of Fig. 10.35 specify components so that a full-scale
input of 10 V yields a full-scale output of 100 kHz. The circuit is to have provisions for
offset voltage nulling as well as full-scale adjustment.
Solution.
We have T = 1/105 = 10 μs. For D(%)max = 25% use TH = 2.5 μs.
By Eq. (10.29), C = 2.5 × 10−6 × 10−3/7.5 = 333 pF (use a 330-pF NPO capacitor
with 1% tolerance). By Eq. (10.30), R = 10/(7.5 × 330 × 10−12 × 105) = 40.4 k
(use a 34.8-k, 1% metal-ﬁlm resistor in series with a 10-k cermet pot for full-scale
adjustment). Imposing v1(max) = 2.5 V yields C1 = (10−3 × 2.5 × 10−6)/2.5 = 1 nF.
To null the input offset voltage of OA, use the scheme of Fig. 5.20b with RA = 62 ,
RB = 150 k, and RC = 100 k. The calibration is similar to that of Example 10.8.

525
SECTION 10.7
V-F and F-V
Converters
Frequency-to-Voltage Conversion
The frequency-to-voltage converter (FVC) performs the inverse operation, namely,
it accepts a periodic waveform of frequency fI and yields an analog output voltage
vO = k fI
(10.32)
where k is the FVC sensitivity, in volts per hertz. FVCs ﬁnd application as tachome-
ters in motor speed control and rotational measurements. Moreover, they are used
in conjunction with VFCs to convert the transmitted pulse train back to an analog
voltage.
A charge-balancing VFC can easily be conﬁgured as an FVC by applying the
periodic input to the comparator and deriving the output from the op amp, which now
has the resistance R in the feedback path (see Fig. 10.36). The input signal usually
requires proper conditioning to produce a voltage with reliable zero-crossings for
CMP. Shown in the ﬁgure is a high-pass network to accommodate inputs of the
TTL and CMOS type. On each negative spike of v1, CMP triggers the one-shot,
closing SW and pulling 1 mA out of C1 for a duration TH as given in Eq. (10.29).
In response to this train of current pulses, vO builds up until the current pulled out
of the summing junction of OA in 1-mA packets is exactly counterbalanced by that
injected by vO via R continuously, or fI × 10−3 × TH = vO/R. Solving for vO
and using Eq. (10.29) gives
vO = 7.5RC fI
(10.33)
Q1
R
C1
12
10
13
14
11
1
fI
fI
v1
vO
One-shot
5
4
SW
C
VEE
VCC
vO
v1
(a)
(b)
t
t
t
t
One-
shot
15 V
680 pF
13 kΩ
2 kΩ
1 mA
+
–
OA
CMP
+
–
+
FIGURE 10.36
VFC connection for frequency-to-voltage conversion, and corresponding waveforms.
(Courtesy of Texas Instruments.)

526
CHAPTER 10
Signal Generators
+
–
vO
vI
+
VFC
FVC
FIGURE 10.37
Transmission of analog information in isolated form.
The value of C is determined on the basis of a maximum duty cycle of 25%, as
discussed earlier, while R now establishes the full-scale value of vO. As in the
VFC case, the input offset voltage of OA should be nulled to avoid degrading the
conversion accuracy at the low end of the range.
Between consecutive closures of SW, R will cause C1 to discharge somewhat,
resulting in output ripple. This can be objectionable, especially at the low end of the
conversion range where the ripple-to-signal ratio is the worst. The maximum ripple
is Vr(max) = (1 mA)TH/C1. Using Eq. (10.29), we get
Vr(max) = C
C1
7.5 V
(10.34)
indicating that the ripple can be reduced by making C1 suitably large. Too large a
capacitance, however, slows down the response to a rapid change in fI since this
response is governed by the time constant τ = RC1. The optimum value of C1 is,
therefore, a compromise between the two opposing demands.
Figure 10.37 shows, in block diagram form, a typical VFC-FVC arrangement
for transmitting analog information in isolated form. Here vI is usually a transducer
signal that has been ampliﬁed by an instrumentation ampliﬁer. The VFC converts
vI to a train of current pulses for the LED, the phototransistor reconstructs the pulse
train at the receiving end, and the FVC converts frequency back to an analog signal
vO. The example shown utilizes an opto-isolator; however, other forms of isolated
coupling are possible, such as ﬁber optic links, pulse transformers, and RF links.
PROBLEMS
10.1 Sine wave generators
10.1 Show that for arbitrary component values in its positive-feedback network, the Wien-
bridge circuit of Fig. 10.2a gives B( j f 0) = 1/(1 + Rs/Rp + C p/Cs) and f0 =
1/(2π
Rs RpCsC p), where Rp and C p are the parallel and Rs and Cs the series
elements. Hence, verify that neutral stability requires R2/R1 = Rs/Rp + C p/Cs.
10.2 Disregarding the limiter in Fig. 10.3a, obtain expressions for T (s) for the cases in
which the feedback resistance is 22.1 k, 20.0 k, and 18.1 k. Then, ﬁnd the pole
locations for each of the three cases.
10.3 Problem 10.1 indicates that the frequency of a Wien-bridge oscillator can be varied by
varying, for instance, Rp. However, to maintain neutral stability, we must also vary Rs
in such a way as to keep the ratio Rs/Rp constant. This awkward constraint is avoided

527
Problems
by the circuit9 of Fig. P10.3. (a) Show that f0 is still as in Problem 10.1, but neutral
stability now requires (R2/R1)(1 + R3/Rp) = Rs/Rp + C p/Cs. (b) Verify that if
we let R2/R1 = C p/Cs, this condition simpliﬁes to R3 = (R1/R2)Rs. (c) Assuming
sufﬁciently fast JFET-input of amps in the design shown, ﬁnd the range of variability
of f0.
R2A
R2B
Cp
Rp
Cs
Rs
2.55 kΩ
1 kΩ
10 MΩ
51.1 kΩ
2.49 kΩ
R1
2.49 kΩ
R3
2.49 kΩ
4.7 nF
4.7 nF
vO
+
–
OA2
+
–
OA1
FIGURE P10.3
10.4 Consider a Wien-bridge oscillator whose parallel elements are C p = 2.0 nF and
Rp = 10 k, and whose series elements are Cs = 1.0 nF and Rs = 20 k. Assuming
±9-V power supplies, design a nonlinear network of the type of Fig. 10.5 to ensure
oscillations of ±5-V peak values. Use PSpice to ﬁne-tune your design. What is the
predicted and the actual frequency of oscillation? What happens if the diodes are
removed?
10.5 Adapt the multiple-feedback circuit of Fig. P3.41 to design a 100-kHz sinusoidal
oscillator with peak values of ±3 V. Assume ±5-V power supplies, and verify with
PSpice.
10.6 Suppose the low-pass ﬁlter of Fig. 3.23 has R1 = 2R2 = 20 k and C1 = 2C2 = 2 nF,
and is powered from ±5-V power supplies. Can the circuit be turned into an oscillator?
If no, explain why. If yes, show a suitable design, and ﬁnd f0.
10.7 Repeat Problem 10.6, but for the KRC ﬁlter of Fig. 3.27, assuming R1 = R2 = R3 =
22.6 k and C1 = C2 = 2 nF.
10.8 Estimate the s-plane locations of the poles of the quadrature oscillator of Fig. 10.6a
at power turn-on, before the diodes kick in.
10.2 Multivibrators
10.9 In the circuit of Fig. 10.7a let R = 330 k, C = 1 nF, R1 = 10 k, and R2 = 20 k.
Assuming ±15-V supplies, ﬁnd f0 and D(%) if a third resistance R3 = 30 k is
connected between the noninverting-input pin of the 301 and the −15-V supply.
10.10 In the circuits of Fig. 10.7a let R1 = R2 = 10 k, and suppose a control source vI is
connected to the noninverting input of the comparator via a 10-k series resistance.

528
CHAPTER 10
Signal Generators
Sketch the modiﬁed circuit, and show that it allows for automatic duty-cycle control.
What are the expressions for D(%) and f0 in terms of vI? What is the permissible
range for vI?
10.11 In the circuits of Fig. 10.9a and Fig. 10.12a specify suitable components for f0 =
100 kHz. The circuits must have provision for the exact adjustment of f0.
10.12 (a) Using a 339 comparator, design a single-supply astable multivibrator with f0 =
10 kHz and D(%) = 60%. (b) Repeat (a), but with D(%) = 40%.
10.13 The inverters of Fig. 10.12a have the following threshold ratings at VDD = 5 V:
VT = 2.5 V typical, 1.1 V minimum, and 4.0 V maximum. (a) Specify suitable com-
ponents for f0 = 100 kHz typical. (b) Find the percentage spread of f0 due to the spread
of VT .
10.14 Compared to the two-gate oscillator of Fig. 10.12a, the three-gate counterpart of
Fig. P10.14 is always guaranteed to start. Assuming VT = 0.5VDD, sketch the timing
waveforms and derive an expression for f0.
10R
vO
C
R
I1
I2
I3
FIGURE P10.14
10.15 If in Fig. P10.14 we remove the capacitor and replace each resistor with a wire, the
resulting circuit is called a ring oscillator and is often used to measure the propagation
delays of logic gates. (a) Sketch the voltages at the gate outputs versus time; then
derive a relationship between the average gate propagation delay tP and the frequency
of oscillation f0. (b) Can this technique be extended to four gates within the loop?
Explain.
10.16 Assuming the threshold spread speciﬁcations of Problem 10.13, ﬁnd suitable compo-
nents for T = 10 μs (typical) in the one-shot of Fig. 10.14a; then ﬁnd the percentage
spread of T.
10.17 Design a one-shot using two CMOS NAND gates. Next, explain how it works, show
its waveforms, and derive an expression for T. (Recall that the output of a NAND gate
goes low only when both inputs are high.)
10.18 Consider the circuit obtained from the one-shot of Fig. 10.14a by connecting the
output of G to the input of I directly, inserting a resistance R between the lower input
of G and ground, and returning the output of I to the lower input of G via a series
capacitance C. Draw the modiﬁed circuit; then, sketch and label its waveforms, and
ﬁnd T if R = 100 k, C = 220 pF, and VT = 0.4VDD.
10.3 Monolithic timers
10.19 Let the 555 astable multivibrator of Fig. 10.16a be modiﬁed as follows: RB is shorted
out, and the wire connecting the bottom node of RA to pin 7 is cut to allow for the

529
Problems
insertion of a series resistance RC. (a) Sketch the modiﬁed circuit and show that
choosing RC = RA/2.362 gives D(%) = 50%. (b) Specify suitable components for
f0 = 10 kHz and D(%) = 50%.
10.20 (a) Verify that if the THRESHOLD and TRIGGER terminals of the TLC555 CMOS
timer are tied together to form a common input, then the device forms an inverting
Schmitt trigger with VTL = (1/3)VDD, VTH = (2/3)VDD, VOL = 0 V, and VOH = VDD,
where VDD isthesupplyvoltage.(b)Usingjustoneresistorandonecapacitor,conﬁgure
the device as a 100-kHz free-running multivibrator, and verify that its duty cycle
is 50%.
10.21 Design a 555 one-shot whose pulse width can be varied anywhere from 1 ms to 1 s by
means of a 1-M pot.
10.22 A 10-μs 555 one-shot is powered from VCC = 15 V. What voltage must be applied
to the CONTROL input to stretch T from 10 μs to 20 μs? To shrink T from 10 μs to
5 μs?
10.23 Using a 555 timer powered from VCC = 5 V, design a voltage-controlled astable mul-
tivibrator whose frequency of oscillation is f0 = 10 kHz when VT H = (2/3)VCC, but
can be varied over the range 5 kHz ≤f0 ≤20 kHz by externally varying VT H. What
are the values of VT H and D(%) corresponding to the extremes of the above frequency
range?
10.24 In the circuit of Fig. 10.18a specify suitable components and output interconnections
for T = 1 s and To = 3 min.
10.4 Triangular wave generators
10.25 In the circuit of Fig. 10.19a let the noninverting input of OA be lifted off ground
and returned to a +3-V source. Draw the modiﬁed circuit; then, sketch and label its
waveforms and ﬁnd f0 and D(%) if R = 30 k, C = 1 nF, R1 = 10 k, R2 = 13 k,
R3 = 2.2 k, and D5 is a 5.1-V reference diode.
10.26 In the circuit of Fig. 10.19a let R1 = R2 = R = 10 k, R3 = 3.3 k, VD(on) = 0.7 V,
VZ5 = 3.6 V, and suppose a control source vI is connected to the inverting input of
OA via a 10-k series resistance. Sketch the modiﬁed circuit, and show that it allows
for automatic duty-cycle control. What are the expressions for D(%) and f0 in terms
of vI? What is the permissible range for vI?
10.27 Using an LF411 op amp and an LM311 comparator, both of which have macromodels
in PSpice’s library, (a) design a circuit of the type of Fig. 10.19a to produce 100-kHz
triangular/square waves with ±5-V peak amplitudes. Assume ±9-V power supplies.
(b) Verify with PSpice. (c) Try different PSpice runs with progressively decreasing
values of C until circuit behavior starts to depart appreciably from the intended. How
far up in frequency can you push this circuit?
10.28 In the circuit of Fig. 10.20a specify suitable components so that both waves have
peak amplitudes of 5 V and TL and TH are independently adjustable from 50 μs to
50 ms.

530
CHAPTER 10
Signal Generators
10.29 Using a CMOS op amp connected as a Deboo integrator, and a CMOS 555 timer
connected as a Schmitt trigger in the manner of Problem 10.20, design a single-
supply triangular wave generator. Then, show its waveforms and derive an expression
for f0.
10.30 The effect of component tolerances in the VCO of Fig. 10.21a can be compensated
for by inserting a variable resistance Rs in series between the control source vI and
the rest of the circuit, and suitably decreasing the nominal value of C to allow for the
adjustment of k in both directions. Design a VCO with k = 1 kHz/V, k adjustable over
a range of ±25%.
10.31 Shown in Fig. P10.31 is another popular VCO. Sketch and label its waveforms, and
ﬁnd an expression for f0 in terms of vI.
+
vI
15 V
20 kΩ
3.6 kΩ
1.8 kΩ
10 kΩ
20 kΩ
(>0)
R
M
+
–
OA1
+
–
OA2
CMP
v1
vTR
vSQ
311
356
356
C
+
–
FIGURE P10.31
10.32 Designawave-shapercircuitthatacceptsthetriangularoutputoftheVCOofFig.10.21
and converts it to a sine wave of variable amplitude and offset. Amplitude and offset
must be separately adjustable over the ranges 0 to 5 V and −5 V to +5 V, respectively.
10.33 Figure P10.33 shows a crude triangular-to-sine wave converter. R1 and R2 are found by
imposing that vS and vT /(1 + R2/R1) have (a) identical slopes at the zero crossings,
and (b) peak values equal to VD(on). Assuming VD(on) = 0.7 V at ID = 1 mA, ﬁnd R1
and R2 if vTR has peak values of ±5 V; then use PSpice to plot vT and vS versus
time.
R2
R1
D1
D2
+
vT
vS
FIGURE P10.33
10.34 The crude triangle-to-sine converter of Fig. P10.33 can be improved considerably by
rounding the sides of the triangular wave input, besides clipping it at the top and
bottom. The circuit of Fig. P10.34 provides a VTC with a slope of 1 V/V near the

531
Problems
origin, where all diodes are off. As the magnitude of vT rises and approaches a diode
drop, either D1 or D2 goes on, in effect switching R2 into the circuit. At this point,
the slope of the VTC decreases to about R1/(R1 + R2). As the magnitude of vT rises
further and vS approaches two diode drops, either the D3-D4 pair goes on, clipping the
top of the waveform, or the D5-D6 pair goes on, clipping the bottom. Let us arbitrarily
impose Vsm = 2 × 0.7 = 1.4 V, so that Vtm = (π/2)1.4 = 2.2 V, and let us assume
diodes with Is = 2 fA and nVT = 26 mV, so that at 0.7 V they draw 1 mA. To ﬁnd
suitable values for R1 and R2, arbitrarily impose the following pair of constraints:
(1) When vT reaches its positive peak Vtm, let the current through the D3-D4 pair
be 1 mA; (2) When vT reaches half its positive peak, or Vtm/2, let the slope of the
VTC match that of the sine function there, which one can readily prove to be cos
45◦= 0.707 V/V. (a) Guided by the above constraints, ﬁnd suitable values for R1
and R2. (b) Simulate the circuit via PSpice using a 1-kHz triangular wave with peak
values of ±2.2 V, and display both vT and vS versus time. Try different runs, each
time changing the values of R1 and R2 a bit until you come up with a set that gives
what you think is the best sine wave. (c) Using the optimized wave shaper of part
(b) as a basis, design a circuit that accepts a triangular wave with peak values of ±5
V and yields a sine wave also with peak values of ±5 V. Hint: At the input, replace
R1 by a suitable voltage divider to accommodate the increased triangular wave while
still meeting the aforementioned constraints. At the output, use a suitable ampliﬁer
implemented with a 741-type op amp.
R2
R1
D3
D2
D1
D4
vT
+
–
+
–
vS
D5
D6
FIGURE P10.34
10.5 Sawtooth wave generators
10.35 (a) Show that connecting a resistance R4 between the source vI and the inverting-input
pin of the 311 in Fig. 10.24a gives VT = VT 0 −k|vI|, VT 0 = VCC/[1+ R2/(R3 ∥R4)],
and k = 1/[1 + R4/(R2 ∥R3)]. (b) Verify that letting R4 = (R2 ∥R3)(RC/TD −1)
gets rid of the TD term in Eq. (10.21) and gives f0 = |vI|/(RCVT 0). (c) Assuming
TD ∼= 0.75 μs, specify suitable components for a sensitivity of 2 kHz/V and a low-
frequency sawtooth amplitude of 5 V. Your circuit is to be compensated against the
error due to TD.
10.6 Monolithic waveform generators
10.36 Derive Eq. (10.23).
10.37 Assuming VCC = 15 V, design an ICL8038 sawtooth generator with f0 = 1 kHz
and D(%) = 99%. The circuit must have provision for frequency adjustment over a
±20% range.
10.38 Specify C for a 20-kHz full-scale frequency in the VCO of Fig. 10.29.

532
CHAPTER 10
Signal Generators
10.39 Assuming VCC = 15 V, design an XR2206 sawtooth generator with f0 = 1 kHz,
D(%) = 99%, and sawtooth peaks of 5 V and 10 V.
10.7 V-F and F-V converters
10.40 (a) Using the AD537 VFC, design a circuit that accepts a voltage in the range −10 V <
vS < 10 V and converts it to a frequency in the range 0 Hz < fO < 20 kHz. The
circuit is to be powered from ±15-V poorly regulated supplies. (b) Repeat, but for the
case of an input 4 mA < iS < 20 mA and an output range 0 < fO < 100 kHz.
10.41 Repeat Example 10.8, but for the Fahrenheit scale.
10.42 The circuit of Fig. P10.42 allows for the VFC32 to work with bipolar inputs. (a) An-
alyze the circuit for both vI > 0 and vI < 0, and ﬁnd a condition for the resistances
that will ensure fO = k|vI|. (b) Specify suitable components for a VFC sensitivity of
10 kHz/V.
R4
+
vI
R3
C1
C
15 V
–15 V
R5
VFC32
R1
R2
D1
D2
fO
Rp
+
–
OA2
+
–
OA1
1
13
10
12
4
7
14
11
5
FIGURE P10.42
10.43 Specify suitable component values so that the FVC of Fig. 10.36 yields a full-scale
output of 10 V for a full-scale input of 100 kHz with a maximum ripple of 10 mV.
Then, estimate how long it takes for the output to settle within 0.1% of the ﬁnal value
for a full-scale change in fI.
10.44 Using a 4N28 optocoupler, design an external resistive network to provide an opto-
coupled link between the VFC of Example 10.9 and the FVC of Problem 10.43. The
transistor of the 4N28 gives IC(min) = 1 mA with a diode forward current ID = 10 mA.
Assume ±15-V supplies.
REFERENCES
1. “Sine Wave Generation Techniques,” Texas Instruments Application Note AN-263,
http://www.ti.com/lit/an/snoa665c/snoa665c.pdf.
2. E. J. Kennedy, Operational Ampliﬁer Circuits: Theory and Applications, Oxford Uni-
versity Press, New York, 1988.

533
References
3. J. Williams, “Circuit Techniques for Clock Sources,” Linear Technology Application
Note AN-12, http://cds.linear.com/docs/en/application-note/an12fa.pdf.
4. A. B. Grebene, Bipolar and MOS Analog Integrated Circuit Design, John Wiley & Sons,
New York, 1984.
5. Linear & Telecom ICs for Analog Signal Processing Applications, Harris Semi-
conductor, Melbourne, FL, 1993–1994, pp. 7-120–7-129.
6. P. Klonowski, “Analog-to-Digital Conversion Using Voltage-to-Frequency Converters,”
Analog Devices Application Note AN-276, http://www.analog.com/static/imported-
ﬁles/application notes/185321581AN276.pdf.
7. B. Gilbert and D. Grant, “Applications of the AD537 IC Voltage-to-Frequency Con-
verter,” Analog Devices Application Note AN-277, http://www.analog.com/static/
imported-ﬁles/application notes/511072672AN277.pdf.
8. J. Williams, “Design Techniques Extend V/F Converter Performance,” EDN, May 16,
1985, pp. 153–164.
9. P. Brokaw, “FET Op Amps Add New Twist to an Old Circuit,” EDN, June 5, 1974,
pp. 75–77.

11
VOLTAGE REFERENCES AND REGULATORS
11.1
Performance Speciﬁcations
11.2
Voltage References
11.3
Voltage-Reference Applications
11.4
Linear Regulators
11.5
Linear-Regulator Applications
11.6
Switching Regulators
11.7
The Error Ampliﬁer
11.8
Voltage Mode Control
11.9
Peak Current Mode Control
11.10 PCMC of Boost Converters
Problems
References
The function of a voltage reference/regulator is to provide a stable dc voltage VO
starting from a less stable power source VI . The general setup is depicted in Fig. 11.1.
In the case of a regulator, VI is usually a poorly speciﬁed voltage, such as the
crudely ﬁltered output of a transformer and diode rectiﬁer. The regulated output
VO is then used to power other circuits, collectively referred to as the load and
characterized by the current IO that the load draws from the regulator.
In the case of a voltage reference, VI is already regulated to some degree,
so the function of the reference is to produce an even more stable voltage VO to
serve as a standard for other circuits. The role of a reference is similar to that of a
tuning fork for a musical ensemble. For example, the full-scale accuracy of a digital
multimeter is set by an internal voltage reference of suitable quality. Similarly, power
supplies; A-D, D-A, V-F, and F-V converters; transducer circuits; VCOs; log/antilog
ampliﬁers; and a variety of other circuits and systems require some kind of reference
standard, or yardstick, to function with the desired degree of accuracy. The primary
requirements of a voltage reference are thus accuracy and stability. Typical stability
534

535
CHAPTER 11
Voltage
References and
Regulators
+
VI
IO
+
–
VO
In
Out
Common
Load
FIGURE 11.1
Basic connection of a voltage reference/
regulator.
requirements are on the order of 100 ppm/◦C (parts per million per degree Celsius) or
better. To minimize errors due to self-heating, voltage references come with modest
output-current capabilities, usually on the order of a few milliamperes.
Traditionally, the standard of voltages has been the Weston cell, an electrochem-
ical device that, at 20 ◦C, yields a reproducible voltage of 1.018636 V with a thermal
coefﬁcient of 40 ppm/◦C. Solid-state references are now available with far better
stability. Even though semiconductor devices are strongly affected by temperature,
clever compensating techniques have been devised to achieve thermal coefﬁcients
below 1 ppm/◦C! These techniques are also exploited in the synthesis of voltages or
currents with predictable thermal coefﬁcients for use in temperature-sensing appli-
cations. This forms the basis of a variety of monolithic temperature transducers and
signal conditioners.
The performance parameters of voltage regulators are similar to those of voltage
references, except that the requirements are less stringent and the output current
capabilities are much higher. Depending on the regulator type, the output current
rating may range from as low as 100 mA to 10 A or higher.
In this chapter we discuss two popular categories, namely, linear regulators and
switchingregulators.Linearregulatorscontrol VO bycontinuouslyadjustingapower
transistor connected in series between VI and VO. The simplicity of this scheme
comes at the price of poor efﬁciency because of the power dissipated in the transistor.
Switching regulators improve efﬁciency by operating the transistor as a high-
frequency switch, which inherently dissipates less power than a transistor operating
in the continuous mode. Moreover, unlike their linear counterparts, switching reg-
ulators can generate outputs that are higher than the unregulated input or even of
the opposite polarity; they can provide multiple outputs, isolated outputs, and can
be made to run directly off the ac power line, with no need for bulky power trans-
formers. The price for these advantages is the need for coils, capacitors, and more
complex control circuitry, along with much noisier behavior. Nonetheless, switch-
ing regulators are widely used to power computers and portable equipment. Even
in power-supply design for analog systems, it is common to exploit the efﬁciency
and the lightweight advantages of switching regulators to generate preregulated—
if noisy—voltages and then use linear regulators to provide cleaner postregulated
voltages for critical analog circuitry.1
Chapter Highlights
The chapter begins with a discussion of performance speciﬁcations common to both
voltage references and regulators: line and load regulation, ripple rejection ratio,

536
CHAPTER 11
Voltage
References and
Regulators
thermal drift, and long-term stability are discussed and evaluated using already
familiar circuits as vehicles.
Next,voltagereferencesareinvestigatedinspeciﬁcdetail:startingwiththermally
compensated Zener-diode references, the chapter proceeds to bandgap references
and monolithic temperature sensors, and it concludes with a variety of applications,
such as the current-reference design and thermocouple signal conditioning.
The chapter proceeds to linear voltage regulators, emphasizing inherent protec-
tions as well as the thermal considerations required of the user in actual applications.
Also addressed are issues speciﬁc to power-supply design such as low-dropout reg-
ulators and power-supply supervisory circuits.
The second part of the chapter is devoted to switching regulators. After intro-
ducing the three basic topologies of buck, boost, and buck-boost conversions, and
addressing common issues such as coil/capacitor selection and efﬁciency calcula-
tions, the chapter turns to the control schemes in widest use today, namely, voltage
mode control (VMC) and peak current mode control (PCMC). Issues such as slope
compensation in PCMC and the effect of the right-half-plane zero in boost-type
converters are illustrated in proper detail. Central to switching control is the design
of the error ampliﬁer, a subject that relies very heavily on the stability material dis-
cussed in Chapter 8. All concepts are put into practice via a number of actual design
examples and PSpice simulations.
11.1
PERFORMANCE SPECIFICATIONS
The ability of a voltage reference or regulator to maintain a constant output under
varying external conditions is characterized in terms of performance parameters
such as line and load regulation, and the thermal coefﬁcient. In the case of voltage
references, output noise and long-term stability are also signiﬁcant.
Line and Load Regulation
Lineregulation,alsocalledinput,orsupplyregulation,givesameasureofthecircuit’s
ability to maintain the prescribed output under varying input conditions. In the case of
voltage references, the input is typically an unregulated voltage or, at best, a regulated
voltage of lower quality than the reference itself. In the case of voltage regulators,
the input is usually derived from the 60-Hz line via a step-down transformer, a
diode-bridge rectiﬁer, and a capacitor ﬁlter and is afﬂicted by signiﬁcant ripple.
With reference to the symbolism of Fig. 11.1, we deﬁne
Line regulation = VO
VI
(11.1a)
where VO is the output change resulting from a change VI at the input. Line
regulation is expressed in millivolts or microvolts per volt, depending on the case.
An alternative deﬁnition is
Line regulation (%) = 100VO/VO
VI
(11.1b)

537
SECTION 11.1
Performance
Speciﬁcations
with the units being percent per volt. As you consult the catalogs, you will ﬁnd that
both forms are in use.
A related parameter is the ripple rejection ratio (RRR), expressed in decibels as
RRRdB = 20 log10
Vri
Vro
(11.2)
where Vro is the output ripple resulting from a ripple Vri at the input. The RRR is
used especially in connection with voltage regulators to provide an indication of the
amount of ripple (usually 120-Hz ripple) feeding through to the output.
Load regulation gives a measure of the circuit’s ability to maintain the prescribed
output voltage under varying load conditions, or
Load regulation = VO
IO
(11.3a)
Both voltage references and voltage regulators should behave like ideal voltage
sources, delivering a prescribed voltage regardless of the load current. The i-v char-
acteristic of such a device is a vertical line positioned at v = VO. A practical reference
or regulator exhibits a nonzero output impedance whose effect is a slight dependence
of VO on IO. This dependence is expressed via the load regulation, in millivolts per
milliampere or per ampere, depending on the output current capabilities. The alter-
native deﬁnition
Load regulation (%) = 100VO/VO
IO
(11.3b)
expresses the above dependence in percent per milliampere or per ampere.
EXAMPLE 11.1. The data sheets of the μA7805 5-V voltage regulator indicate that VO
typically changes by 3 mV when VI is varied from 7 V to 25 V, and by 5 mV when
IO is varied from 0.25 A to 0.75 A. Moreover, RRRdB = 78 dB at 120 Hz. (a) Estimate
the typical line and load regulation of this device. What is the output impedance of the
regulator? (b) Estimate the amount of output ripple Vro for every volt of Vri.
Solution.
(a) Line regulation = VO/VI = 3 × 10−3/(25 −7) = 0.17 mV/V. Alternatively,
line regulation = 100(0.17 mV/V)/(5 V) = 0.0033%/V. Load regulation = VO/
IO = 5 × 10−3/[(750 −250)10−3] = 10 mV/A. Alternatively, load regulation =
100(10 mV/A)/(5 V) = 0.2%/A. The output impedance is VO/IO = 0.01 .
(b) Vro = Vri/1078/20 = 0.126 × 10−3 × Vri. Thus, a 1-V, 120-Hz ripple at the input
will result in an output ripple of 0.126 mV.
Thermal Coefﬁcient
The thermal coefﬁcient of VO, denoted as TC(VO), gives a measure of the circuit’s
ability to maintain the prescribed output voltage VO under varying thermal condi-
tions. It is deﬁned in two forms,
TC(VO) = VO
T
(11.4a)

538
CHAPTER 11
Voltage
References and
Regulators
in which case it is expressed in millivolts or microvolts per degree Celsius, or
TC(VO) (%) = 100VO/VO
T
(11.4b)
in which case it is expressed in percent per degree Celsius. Replacing 100 by 106
gives the TC in parts per million per degree Celsius. Good voltage references have
TCs on the order of a few parts per million per degree Celsius.
EXAMPLE 11.2.
The data sheets of the REF101KM 10-V precision voltage reference
give a typical line regulation of 0.001%/V, a typical load regulation of 0.001%/mA, and
a maximum TC of 1 ppm/◦C. Find the variation in VO brought about by: (a) a change
of VI from 13.5 V to 35 V; (b) a ±10-mA change in IO; (c) a temperature change from
0 ◦C to 70 ◦C.
Solution.
(a) By Eq. (11.1b), 0.001%/V = 100(VO/10)/(35 −13.5), or VO = 2.15 mV
typical.
(b) By Eq. (11.3b), 0.001%/mA = 100(VO/10)/(±10 mA), or VO = ±1 mV
typical.
(c) By Eq. (11.4b), 1 ppm/◦C = 106(VO/10)/(70 ◦C), or VO = 0.7 mV maximum.
You will agree that these are rather small variations for a 10-V source!
In the case of voltage references, output noise and long-term stability are also
important. The data sheets of the aforementioned REF101 give a typical output
noise of 6 μV peak-to-peak from 0.1 Hz to 10 Hz, and a typical long-term stability
of 50 ppm/(1000 hours). This means that over a period of 1000 hours (about 42 days)
the reference output may typically change by (50 × 10−6)10 V = 0.5 mV.
Illustrative Examples
Let us apply the above concepts to the analysis of the classical shunt regulator
of Fig. 11.2. The input is a raw voltage assumed to lie within known limits, or
VI (min) ≤VI ≤VI (max). The goal is to produce an output VO that is as insensitive
as possible to both input and load variations. This is achieved by exploiting the
nearly vertical i-v characteristic of a Zener diode. As depicted in Fig. 11.3a, this
characteristic can be approximated with a straight line having a slope of 1/rz and
Rs
+
VI 
Dz
+
–
VO
VO
VI
Load
Regulator
t
t
(a)
(b)
(c)
VI(max)
VI(min)
FIGURE 11.2
The Zener diode as a shunt regulator.

539
SECTION 11.1
Performance
Speciﬁcations
+
VI
IO
+
–
VO
VZ0
Load
rz
Rs
+
–VZ0
i
v
VZ
1
rz
IZ
(a)
(b)
FIGURE 11.3
Breakdown diode characteristic, and equivalent circuit of the shunt
regulator.
a v-axis intercept at −VZ0, so the coordinates VZ and IZ of an arbitrary operating
point down the curve are related as VZ = VZ0 + rz IZ. The resistance rz, called
the dynamic resistance of the Zener diode, is typically in the range of a few ohms
to several hundreds of ohms, depending on the diode. Zener diodes are speciﬁed
at the point corresponding to 50% of the power rating. Thus, a 6.8-V, 0.5-W, 10-
Zener diode has, at the 50% power point, IZ = (PZ/2)/VZ = (500/2)/6.8 ∼= 37 mA.
Moreover, VZ0 = VZ −rz IZ = 6.8 −10 × 37 × 10−3 = 6.43 V.
It is apparent that a Zener diode can be modeled with a voltage source VZ0 and
a series resistance rz, so the circuit of Fig. 11.2b can be redrawn as in Fig. 11.3b.
To function as a regulator, the diode must operate well within the breakdown region
under all possible line and load conditions. In particular, IZ must never be allowed to
drop below some safety value IZ(min). Simple analysis reveals that Rs must satisfy
Rs ≤VI (min) −VZ0 −rz IZ(min)
IZ(min) + IO(max)
(11.5)
The value of IZ(min) is chosen as a compromise between the need to ensure proper
worst-case operation and the need to avoid excessive power wastage. A reasonable
compromise is IZ(min) ∼= (1/4)IO(max).
We are now ready to estimate the line and load regulation. Applying the super-
position principle, we readily ﬁnd
VO =
rz
Rs + rz
VI +
Rs
Rs + rz
VZ0 −(Rs ∥rz)IO
(11.6)
Only the second term on the right-hand side is a desirable one. The other two indicate
dependence on line and load as
Line regulation =
rz
Rs + rz
(11.7a)
Load regulation = −(Rs ∥rz)
(11.7b)
Multiplying by 100/VO gives the regulations in percentage form.

540
CHAPTER 11
Voltage
References and
Regulators
EXAMPLE 11.3.
A raw voltage 10 V ≤VI ≤20 V is to be stabilized by a 6.8-V, 0.5-W,
10- Zener diode and is to feed a load with 0 ≤IO ≤10 mA. (a) Find a suitable value
for Rs, and estimate the line and load regulation. (b) Estimate the effect of full-scale
changes of VI and IO on VO.
Solution.
(a) Let IZ(min) = (1/4)IO(max) = 2.5 mA. Then, Rs ≤(10 −6.43 −10 × 0.0025)/
(2.5 + 10) = 0.284 k (use 270 ). Line regulation = 10/(270 + 10) =
35.7 mV/V; multiplying by 100/6.5 gives 0.55%/V. Load regulation = −(10 ∥270)
= −9.64 mV/mA, or −0.15%/mA.
(b) Changing VI from 10 V to 20 V gives VO = (35.7 mV/V) × (10 V) = 0.357 V,
which represents a 5.5% change in VO. Changing IO from 0 to 10 mA gives VO =
−(9.64 mV/mA) × (10 mA) = −0.096 V, which represents a −1.5% change.
The modest line and load regulation capabilities of a diode can be improved
dramatically with the help of an op amp. The circuit of Fig. 11.4 uses the artiﬁce of
powering the diode from VO, that is, from the very voltage we are trying to regulate.
The result is a far more stable voltage VZ, which the op amp then ampliﬁes to give
VO =

1 + R2
R1

VZ
(11.8)
This artiﬁce, aptly referred to as self-regulation, shifts the burden of line and load
regulation from the diode to the op amp. As an additional advantage, VO is now
adjustable, for instance, via R2. Moreover, R3 can now be raised to avoid unnecessary
power wastage and self-heating effects.
By inspection, we now have
Load regulation ∼= −
zo
1 + aβ
(11.9)
where a and zo are the open-loop gain and output impedance, and β = R1/(R1+R2).
To ﬁnd the line regulation, we observe that because of single-supply operation, a
1-V change in VI is perceived by the op amp both as a 1-V supply change and as a
0.5-V input common-mode change. This results in a worst-case input offset voltage
change VOS = VI (1/PSRR + 1/2CMRR) appearing in series with VZ. The op
R1
Dz
39 kΩ
R3
3.3 kΩ
R2
24 kΩ
VO
VI
(12 V to 36 V)
VZ
10.0 V
6.2 V
+
–
741
IO
Load
2
3
4
7
6
FIGURE 11.4
Self-regulated 10-V reference.

541
SECTION 11.2
Voltage
References
amp then gives VO = (1 + R2/R1)VOS, so
Line regulation =

1 + R2
R1

×

1
PSRR +
0.5
CMRR

(11.10)
We observe that since zo, a, PSRR, and CMRR are frequency-dependent, so are the
line and load regulation. In general, both parameters tend to degrade with frequency.
EXAMPLE 11.4. Assuming typical 741 dc parameters, ﬁnd the line and load regulation
of the circuit of Fig. 11.4.
Solution.
Load regulation = −75/[1 + 2 × 105 × 39/(39 + 24)] = −0.6 μV/mA =
−0.06 ppm/mA. Using 1/PSRR = 30 μV/V and 1/CMRR = 10−90/20 = 31.6 μV/V,
we get line regulation = (1+24/39)×(30+15.8)10−6 = 74 μV/V = 7.4 ppm/V. They
represent dramatic improvements over the circuit of Example 11.3.
Dropout Voltage
The circuit of Fig. 11.4 will work properly as long as VI does not drop too low to
cause the op amp to saturate. This holds for voltage references and regulators in
general, and the minimum difference between VI and VO for which the circuit still
functions properly is called the dropout voltage VDO. In the example of Fig. 11.4
the 741 requires that VCC be at least a couple of volts higher than VO, so in this
case VDO ∼= 2 V. Moreover, since the maximum supply rating of the 741 is 36 V, it
follows that the permissible input voltage range for the circuit is 12 V < VI < 36 V.
Start-Up Circuitry
In the self-regulated circuit of Fig. 11.4, VO depends on VZ, and VZ, in turn, depends
on VO being greater than VZ to keep the diode reverse biased. If at power turn-on
VO fails to swing to a value greater than VZ, the diode will never turn on, making
positive feedback via R3 prevail over negative feedback via R2 and R1. The result
is a Schmitt trigger latched in the undesirable state VO = VOL. The possibility for
this undesirable behavior is common in most self-biased circuits, and is avoided by
using suitable circuitry, known as start-up circuitry, to override the ampliﬁer and
prevent it from latching in this undesirable state when power is ﬁrst applied.
The particular implementation of Fig. 11.4 will start properly because of the
internal nature of the op amp being used. With reference to Fig. 5.1, we observe
that at power turn-on, when vP and vN are still zero, the ﬁrst two stages of the 741
remainoff,allowing IC toturnontheoutputstage.Consequently, VO willswingposi-
tive until the Zener diode turns on and the circuit stabilizes at VO = (1+ R2/R1)VZ.
However, if another op amp type is used, the circuit may never be able to properly
bootstrap itself, thus requiring start-up circuitry.
11.2
VOLTAGE REFERENCES
Besides line and load regulation, thermal stability is the most demanding perfor-
mance requirement of voltage references due to the tendency of IC components to

542
CHAPTER 11
Voltage
References and
Regulators
be strongly inﬂuenced by temperature.2 For example, consider the silicon pn junc-
tion, which forms the basis of diodes and BJTs. Its forward-bias voltage VD and
current ID are related as VD = VT ln(ID/Is), where VT is the thermal voltage and
Is the saturation current. Their expressions are
VT = kT/q
(11.11a)
Is = BT 3 exp(−VG0/VT )
(11.11b)
where k = 1.381 × 10−23 J/K is Boltzmann’s constant, q = 1.602 × 10−19 C is the
electron charge, T is absolute temperature, B is a proportionality constant, and VG0 =
1.205 V is the bandgap voltage for silicon.
The TC of the thermal voltage is
TC(VT ) = k/q = 0.0862 mV/◦C
(11.12)
The TC of the junction voltage drop VD at a given bias ID is TC(VD) = ∂VD/∂T =
(∂VT /∂T ) ln(ID/Is) + VT ∂[ln(ID/Is)]/∂T = VD/T −VT ∂(3 ln T −VG0/VT )/
∂T . The result is
TC(VD) = −
VG0 −VD
T
+ 3k
q

(11.13)
Assuming VD = 650 mV at 25 ◦C, we get TC(VD) ∼= −2.1 mV/◦C. Engineers
rememberthisbysayingthattheforwarddropofasiliconjunctiondecreasesbyabout
2 mV for every degree Celsius increase. Equations (11.12) and (11.13) form the basis
of two common approaches to thermal stabilization, namely, thermally compensated
Zener diode references and bandgap references. Equation (11.12) forms also the
basis of solid-state temperature sensors.
Thermally Compensated Zener Diode References
The thermal stability of VO in the self-regulated reference of the previous section
can be no better than that of VZ itself. As depicted in Fig. 11.5a, TC(VZ) is a
function of VZ as well as IZ. There are two different mechanisms by which the
i-v characteristic breaks down: ﬁeld emission breakdown, which dominates below
about 5 V and produces negative TCs, and avalanche breakdown, which dominates
above about 5 V and produces positive TCs. The idea behind thermally compensated
Zener diodes is to connect a forward-biased diode in series with a Zener diode having
an equal but opposing TC, and then ﬁne-tune IZ to drive the TC of the composite
device to zero.3 This is illustrated in Fig. 11.5b for the compensated diodes of
the popular 1N821-9 series. The composite device, whose voltage we relabel as
VZ = 5.5 + 0.7 = 6.2 V, uses IZ = 7.5 mA to minimize TC(VZ). This TC ranges
from 100 ppm/◦C (1N821) to 5 ppm/◦C (1N829).
Self-regulated references based on thermally compensated Zener diodes are
available in monolithic form from a number of sources. A popular example is the
LT1021 precision reference (look it up on the web), sporting a drift of 5 ppm/◦C and a
ripple rejection in excess of 100 dB. Another popular device is the LM329 precision
reference shown in Fig. 11.6 (bottom). The device uses the Zener diode Q3 in series

543
SECTION 11.2
Voltage
References
5
4
3
2
2
3
4
5
6
7
8
9
1
0
–1
–2
–3
10 mA
30 mA
1 mA
0.1 mA
0.01 mA
TC (VZ)
VZ  (V)
(mV/°C)
IZ
+
–
VZ
0.7 V
TC < 0
TC > 0
(TC = 0)
(7.5 mA)
5.5 V
(a)
(b)
FIGURE 11.5
(a) TC(VZ) as a function of VZ and IZ. (b) Thermally compensated breakdown diode.
(Courtesy of Motorola, Inc.)
with the BE junction of Q13 to achieve TCs ranging from 100 ppm/◦C to 6 ppm/◦C,
depending on the version. The device uses also active feedback circuitry to lower
the effective dynamic resistance to rz = 0.6  typical, 1  maximum. Except for
its much greater stability and much lower dynamic resistance, it acts as an ordinary
Zener diode, and it is biased via a series resistor to provide shunt regulation. The
bias current may be anywhere between 0.6 mA and 15 mA.
Thermal stability can be improved further via substrate thermostating.4 The
LM399 stabilized reference of Fig. 11.6 uses the aforementioned LM329 active
diode (shown at the bottom) to provide the reference proper, and suitable stabilizing
circuitry (shown at the top) to sense the substrate temperature and hold it at some set
value above the maximum expected ambient temperature. Thermal sensing is done
via the BE junction of Q4, and substrate heating via the power-dissipating transistor
Q1. At power turn-on, Q1 heats the substrate to 90 ◦C, where it is then maintained
within less than 2 ◦C over ambient variations from 0 ◦C to 70 ◦C. The result is a
typical TC of 0.3 ppm/◦C. Another thermally stabilized reference is the LTZ1000
ultraprecision reference (look it up online), sporting a thermal drift of 0.05 ppm/◦C.
An obvious drawback of these devices is the additional power required to heat the
chip. For instance, at 25 ◦C, the LM399 dissipates 300 mW. An LM399 application
will be shown in Fig. 11.10.
Anotoriousproblemwithbreakdowndiodesisnoise,especiallyavalanchenoise,
which plagues devices with breakdown voltages above 5 V, where avalanche break-
down predominates. The use of diode structures of the so-called buried, or sub-
surface, type4 reduces noise signiﬁcantly while improving long-term stability and
reproducibility. The LM399 uses this structure to achieve a typical noise rating of
7 μV (rms) from 10 Hz to 10 kHz. When noise becomes a factor, noise-ﬁltering
techniques of the type discussed in Section 7.4 can be used.

544
CHAPTER 11
Voltage
References and
Regulators
3
4
+
–
Heater
1
2
+
–
6.95V
FIGURE 11.6
Circuit diagram of the LM399 6.95-V thermally stabilized reference. (Cour-
tesy of Texas Instruments.)
Bandgap Voltage References
Since the best breakdown voltages range from 6 V to 7 V, they usually require supply
voltages on the order of 10 V to operate. This can be a drawback in systems powered
from lower supplies, such as 5 V. This limitation is overcome by bandgap voltage
references, so called because their output is determined primarily by the bandgap
voltage VG0 = 1.205 V. These references are based on the idea of adding the voltage
drop VBE of a base-emitter junction, which has a negative TC, to a voltage K VT
proportional to the thermal voltage VT , which has a positive TC.2 With reference
to Fig. 11.7a we have VBG = K VT + VBE, so TC(VBG) = KTC(VT ) + TC(VBE),
indicating that to achieve TC(VBG) = 0 we need K = −TC(VBE)/TC(VT ) or, using
Eqs. (11.12) and (11.13),
K = VG0 −VBE
VT
+ 3
(11.14)

545
SECTION 11.2
Voltage
References
VI
+
–
VREF
VBG
VBG (TC = 0)
VBE2
KVT
+
+
+
–
Q2
Q1
R3
R4
R1
R2
R
R
nAE
AE
(TC < 0)
(TC > 0)
VBE
KVT
(b)
(a)
FIGURE 11.7
Bandgap voltage reference.
Substituting into VBG = K VT + VBE gives
VBG = VG0 + 3VT
(11.15)
At 25 ◦C we have VBG = 1.205 + 3 × 0.0257 = 1.282 V.
Figure 11.7b shows one of several popular bandgap-cell realizations. Known as
the Brokaw cell for its inventor,5 the circuit is based on two BJTs of different emitter
areas. The emitter area of Q1 is n times as large as the emitter area AE of Q2, so
the saturation currents satisfy Is1/Is2 = n, by Eq. (5.32). With identical collector
resistances, the collector currents are also identical, by op amp action. Ignoring base
currents, we have K VT = R4(IC1 + IC2) = 2R4IC1, or
K VT = 2R4
VBE2 −VBE1
R3
= 2R4
R3
VT ln IC2Is1
Is2IC1
= 2R4
R3
VT ln n
indicating that
K = 2 R4
R3
ln n
(11.16)
This constant can be ﬁne-tuned by adjusting the ratio R4/R3. The op amp raises the
cell’s voltage to VREF = (1 + R2/R1)VBG.
EXAMPLE 11.5.
Assuming n = 4 and VBE2(25◦C) = 650 mV in the circuit of
Fig. 11.7b, specify R4/R3 for TC(VBG) = 0 at 25 ◦C, and R2/R1 for VREF = 5.0 V.
Solution.
By Eq. (11.14), K = (1.205 −0.65)/0.0257 + 3 = 24.6. Then, R4/R3 =
K/(2 ln 4) = 8.87. Moreover, imposing 5.0 = (1 + R2/R1)1.282 gives R2/R1 = 2.9.
The bandgap concept is available also in CMOS technology, where it is imple-
mented by exploiting the presence of parasitic BJTs such as the so-called well BJT

546
CHAPTER 11
Voltage
References and
Regulators
VBG
+
–
Q1
R2
R1
mpR2
Q2
Q1
rB
p1
n1
p2 Body
n2 Well
E
C
B
SiO2
SiO2
SiO2
(a)
(b)
FIGURE 11.8
(a) pnp BJT fabricated in an n−CMOS process, and (b) CMOS bandgap reference.
depicted in Fig. 11.8a. Since the p−body must be connected to the most negative
voltage in the circuit (ground, in this case), the rest of the circuitry must be properly
adapted, and Fig. 11.8b shows one possibility. The BJTs are usually fabricated with
equal emitter areas, so the KVT term is generated by biasing the BJTs differently
via unequal resistances. Through negative feedback, the op amp keeps its own input
terminals at the same potential, so Q2 is forced to operate at a current m p times
smaller than Q1’s. It is left as an exercise (see Problem 11.7) to prove that
VBG = VE B1 + K VT
K = m p
R2
R1
ln(m p)
(11.17)
A well BJT tends to exhibit high bulk resistance rB across the long and lightly doped
base region, so in order to minimize the voltage drop across rB it is customary to
bias well BJTs at suitably low currents.
Thanks to their ability to operate with low supply voltages, bandgap references
(see also the alternative realizations2 of Problems 11.5 and 11.6) ﬁnd wide applica-
tion as part of systems such as voltage regulators; D-A, A-D, V-F, andF-V converters;
bar graph meters; and power-supply supervisory circuits. They are also available as
stand-alone products, either as two-terminal or as three-terminal references, and
sometimes they come with provisions for external trimming.
An example of a two-terminal reference is the already familiar LM385 2.5-V
micropower reference diode. Besides the bandgap cell, the device includes circuitry
to minimize its dynamic resistance as well as raise the cell voltage to 2.5 V. Typically,
it has a TC of 20 ppm/◦C and a dynamic resistance of 0.4 . It is biased with a plain
series resistance, and its operating current may be anywhere between 20 μA and
20 mA.
An example of a three-terminal reference is the REF05 5-V precision reference.
Its output, rated at 5.00 V±30 mV, can be adjusted externally over a ±300-mV range.
The REF05A version has, typically, TC = 3 ppm/◦C for −55 ◦C ≤T ≤125 ◦C, line

547
SECTION 11.2
Voltage
References
regulation = 0.006%/V for 8 V ≤VI ≤33 V, load regulation = 0.005%/mA for
0 ≤IO ≤10 mA, output noise = 10 μV peak-to-peak from 0.1 Hz to 10 Hz, and
long-term stability = 65 ppm/1000 hours.
Monolithic Temperature Sensors
The voltage K VT arising in bandgap cells is linearly proportional to absolute tem-
perature (PTAT). As such it forms the basis for a variety of monolithic temperature
sensors6 known as VPTATs and IPTATs, depending on whether they produce a PTAT
voltage or a PTAT current. These sensors enjoy the low-cost advantages of IC fabri-
cation and do not require the costly linearization circuitry common to other sensors,
such as thermocouples, RTDs, and thermistors. Besides temperature measurement
and control, common applications include ﬂuid-level detection, ﬂow-rate measure-
ment, anemometry, PTAT circuit biasing, and thermocouple cold-junction compen-
sation. Moreover, IPTATs are used in remote-sensing applications because of their
insensitivity to voltage drops over long wire runs.
A popular VPTAT is the LM335 precision temperature sensor. As shown in
Fig. 11.9a, this device acts as a reference diode, except that its voltage is PTAT with
TC(V ) = 10 mV/K. Thus, at room temperature it gives V (25 ◦C) = (10 mV/K) ×
(273.2 + 25)K = 2.982 V. The device is also equipped with a third terminal for
the exact adjustment of its TC. The LM335A version comes with an initial room-
temperature accuracy of ±1 ◦C. After calibration at 25 ◦C, its typical accuracy is
±0.5 ◦C for −40 ◦C ≤T ≤100 ◦C. Its operating current may be anywhere between
0.5 mA and 5 mA, and its dynamic resistance is less than 1 .
A popular IPTAT is the AD590 two-terminal temperature transducer. To the
user this device appears as a high-impedance current source providing 1 μA/K.
Terminating it on a grounded resistance as in Fig. 11.9b gives a VPTAT with a
sensitivity of R × (1 μA/K). The AD590M version comes with a room-temperature
accuracy of ±0.5 ◦C maximum. After calibration at 25 ◦C, the accuracy is ±0.3 ◦C
maximum for −55 ◦C ≤T ≤150 ◦C. The device operates properly as long as the
voltage across its terminals is between 4 V and 30 V.
R 
R1
12 kΩ
1 kΩ
10 kΩ
9.53 kΩ
LM335
AD590
15 V
15 V
V(T)
(10 mV/K)
I(T)
(1 μA/K)
V(T)
(10 mV/K)
(a)
(b)
FIGURE 11.9
Basic temperature sensors using the LM335 VPTAT and the AD590 IPTAT.

548
CHAPTER 11
Voltage
References and
Regulators
Additional temperature-processing devices include Celsius and Fahrenheit sen-
sors, and thermocouple signal conditioners. Consult the manufacturer websites to
see what is available.
11.3
VOLTAGE-REFERENCE APPLICATIONS
When applying voltage references, care must be exercised to prevent the external
circuitry and wiring interconnections from degrading the performance of the refer-
ence. This may require the use of precision op amps and low-drift resistors, along
with special wiring and circuit-construction techniques. As an example, consider the
circuit of Fig. 11.10, which uses a precision op amp to raise the output of a thermally
stabilized reference to 10.0 V.
EXAMPLE 11.6.
Considering that the LM399 data sheets give TCmax = 2 ppm/◦C and
rz(max) = 1.5 , and the LT1001 data sheets give TC(VOS)max = 1 μV/◦C, TC(IB) ∼=
4 pA/◦C, CMRRmin = 106 dB, and PSRRmin = 103 dB, estimate the worst-case drift
and worst-case line regulation of the 10.0-V output.
Solution.
The maximum drift due to the LM399 is 2 × 10−6 × 6.95 = 13.9 μV/◦C,
and that due to the overall input error of the LT1001 is 1 × 10−6 + (20 ∥8.87)103 × 4 ×
10−12 ∼= 1 μV/◦C; consequently, the worst-case output drift is (1 + 8.87/20) ×
(13.9 + 1) = 1.44 × 14.9 = 21.5 μV/◦C. The worst-case line regulation due to the
LM399 is 1.5/(1.5 + 7500) = 200 μV/V, and that due to the LT1001 is 10−103/20 +
0.5 × 10−106/20 = (7.1 + 2.5) = 9.6 μV/V; consequently, the overall worst-case line
regulation is 1.44(200 + 9.6) = 303 μV/V. To give an idea, a 1-V power-supply change
has the same effect as a temperature change of 303/21.5 ∼= 14 ◦C. It is apparent that the
use of a precision op amp causes negligible degradation in the present example.
Current Sources
A voltage reference can readily be turned into a current reference7 by bootstrapping
its common terminal with a voltage follower, as in Fig. 11.11. By op amp action, the
0.1%
8.87 kΩ
5%
7.5 kΩ
0.1%
20.0 kΩ
10.0 V
15 V
6.95 V
+
–
2
3
3
4
2
1
4
6
7
LT1001
LM399
FIGURE 11.10
Buffered 10-V reference.

549
SECTION 11.3
Voltage-Reference
Applications
+
–
R
VCC
VCC
VEE
IO
Common
Load
Reference
Out
In
+
–
VREF
+
–
VL
FIGURE 11.11
Turning a voltage reference into a current
source.
voltage across R is always VREF, so the circuit gives
IO = VREF
R
(11.18)
regardless of the voltage VL developed by the load, provided no saturation effects
occur. The permissible range of values of VL is called the voltage compliance of the
current source.
EXAMPLE 11.7.
Suppose the circuit of Fig. 11.11 uses a 5-V reference with TC =
20 μV/◦C, line regulation = 50 μV/V, and dropout voltage VDO = 3 V, and a JFET-
input op amp with TC(VOS) = 5 μV/◦C and CMRRdB = 100 dB. (a) Specify R for
IO = 10 mA. (b) Find the worst-case values of TC(IO) and of the resistance Ro seen by
the load. (c) Assuming ±15-V supplies, ﬁnd the voltage compliance.
Solution.
(a) R = 5/10 = 500  (use 499 , 1%).
(b) A 1 ◦C change in T causes a worst-case change in the voltage across R of 20 + 5 =
25 μV/◦C; the corresponding change in IO is 25 × 10−6/500 = 50 nA/◦C. A 1-V
change in VL causes a 50-μV/V change in VREF and a 10−100/20 = 10 μV/V change
in VOS, for a worst-case change in IO of (50 + 10)10−6/500 = 120 nA/V. Thus,
Ro(min) = (1 V)/(120 nA) = 8.33 M.
(c) VL ≤VCC −VDO −VREF = 15 −3 −5 = 7 V.
The bootstrapping principle can readily be applied to the case of diode references
to implement either current sources or current sinks. This is shown in Fig. 11.12,
where IO = VREF/R for both circuits. The function of R1 is to bias the diode. If an
LM385 reference diode is used, imposing a bias current of 100 μA when VL = 0
yields R1 = 150 k. The voltage compliance of the source is VL ≤VOH −VREF,
and that of the sink is VL ≥VOL + VREF. If a 741 op amp and a 2.5-V diode are
used, then VL ≤10.5 V for the source, and VL ≥−10.5 V for the sink.
When the circuits just discussed fail to meet load-current demands, we can use
current-boosting transistors. The circuit of Fig. 11.13a uses a pnp BJT to source
current. By op amp action, the voltage across the current-setting resistance R is
VREF, so the current entering the emitter is IE = VREF/R. The current leaving the

550
CHAPTER 11
Voltage
References and
Regulators
+
–
+
–
VL
IO
Load
R
R1
15 V
–15 V
VREF
–
+
–
+
VL
IO
Load
R
R1
15 V
–15 V
VREF
(b)
(a)
FIGURE 11.12
Using a reference diode to implement a current source and a current
sink.
collector is IC = [β/(β + 1)]IE, so IO = [β/(β + 1)]VREF/R ∼= VREF/R. The
voltage compliance is VL ≤VCC −VREF −VEC(sat).
–
+
IO
Load
R
R1
VREF
(b)
(a)
+
–
R2
+
–
VL
+
–
VREF
–
+
IO
Load
R
R1
VREF
+
–
R2
+
–
VL
+
–
VREF
VCC
VCC
FIGURE 11.13
Current sources with current-boosting transistors.
EXAMPLE 11.8.
Let the circuit of Fig. 11.13a use a 741 op amp with VCC = 15 V,
an LM385 2.5-V diode with a bias current of 0.5 mA, and a 2N2905 BJT with R2 =
1 k. (a) Specify R and R1 for IO = 100 mA. (b) Assuming typical BJT parameters,
ﬁnd the voltage compliance of the source, and check that the 741 is operating within
speciﬁcations.
Solution.
(a) We have R = 2.5/0.1 = 25  (use 24.9 , 1%), and R1 = (15−2.5)/0.5 = 25 k
(use 24 k).

551
SECTION 11.3
Voltage-Reference
Applications
(b) VL ≤15−2.5−0.2 = 12.3 V. The 741 inputs are at 15−2.5 = 12.5 V, which is within
the input voltage range speciﬁcations. Assuming β = 100 so that IB = 1 mA, we
ﬁnd that the 741 output is at VCC−VREF−VEB(on)−R2IB = 15−2.5−0.7−1×1 =
10.8 V (which is below VOH = 13 V), and sinks a current of 1 mA (which is below
Isc = 25 mA). Consequently, the 741 is operating within speciﬁcations.
For higher output currents, the transistor can be replaced by a power pnp
Darlington, or by a power enhancement p-MOSFET as in Fig. 11.13b. In these
cases, heat-sinking, to be discussed in Section 11.5, may be required.
Temperature-Sensor Applications
In thermometer applications it is desirable that V (T ) and I (T ) be calibrated in
degrees Celsius or Fahrenheit rather than in kelvins. If a VPTAT or an IPTAT is
used, then suitable conditioning circuitry is required.6
ThecircuitofFig.11.14sensestemperatureviatheAD590IPTAT,whosecurrent
can be expressed as I (T ) = 273.2 μA + (1 μA/◦C)T , T in degrees Celsius. By the
superposition principle,
VO(T ) = R2(273.2 + T )10−6 −10R2/R1
It is apparent that letting R1 = 10/(273.2 × 10−6) = 36.6 k will cause a can-
cellation and leave VO(T ) = R210−6T , T in degrees Celsius. For a sensitivity of
100 mV/◦C, use R2 = (100 mV)/(1 μA) = 100 k. To compensate for the various
tolerances, implement R1 with a 35.7-k resistor in series with a 2-k pot, and R2
with a 97.6-k resistor in series with a 5-k pot. To calibrate, (a) place the IPTAT
in an ice bath (T = 0 ◦C) and adjust R1 for VO(T ) = 0 V; (b) place the IPTAT in
boiling water (T = 100 ◦C) and adjust R2 for VO(T ) = 10.0 V.
Another popular application of temperature sensors is cold-junction compen-
sation in thermocouple measurements.6 A thermocouple is a temperature sensor
consisting of two wires of dissimilar metals and producing a voltage of the type
VTC = α(TJ −TR)
where TJ is the temperature at the measurement or hot junction; TR is the temperature
at the reference or cold junction, formed where the thermocouple is connected to the
leads (usually of copper) of the measuring device; α is the Seebeck coefﬁcient. For
OP77
–15 V
15 V
10.0  V
IPTAT
AD590
+
–
VO (T)
100 mV/°C
In
Out
Common
R1
R2
AD581
FIGURE 11.14
Celsius sensor.

552
CHAPTER 11
Voltage
References and
Regulators
15 V
10.0 V
In
Out
Common
–15 V
R1
AD581
R3
R
C
OP77
+
–
VO (TJ)
R2
AD590
Isothermal
block
+
–
VTC
TJ
TR
Fe
Cn
Cu
Cu
FIGURE 11.15
Thermocouple cold-junction compensation using the AD590
IPTAT.
example, Type J thermocouples are made up of iron and constantan (55% Cu and
45% Ni), and give α = 52.3 μV/◦C.
It is apparent that a thermocouple inherently provides only relative temperature
information. If we want to measure TJ regardless of TR, we must use another sensor
to measure TR, as exempliﬁed in Fig. 11.15. Using again the superposition principle,
VO =

1 +
R2
R1 ∥R3

α(TJ −TR) + R2(273.2 + TR)10−6 −10R2/R1
where both TJ and TR are in degrees Celsius. As before, we select R1 to cancel out
the 273.2 term, R3 to cancel out TR, and R2 to achieve the desired output sensitivity.
EXAMPLE 11.9. If the thermocouple of Fig. 11.15 is a type J for which α = 52.3 μV/◦C,
specify suitable component values for an output sensitivity of 10 mV/◦C. Outline its
calibration.
Solution.
As before, let R1 = 10/(273.2 × 10−6) = 36.6 k to cancel out the 273.2
term. This leaves
VO =

1 +
R2
R1 ∥R3

α(TJ −TR) + R2TR10−6
Next, impose [1 + R2/(R1 ∥R3)]α = R210−6 = 10 mV/◦C to cancel out TR as well as
achieve the desired output sensitivity. The results are R2 = 10.0 k and R3 = 52.65 .
In practice we would use R3 = 52.3 , 1%, and make R1 and R2 adjustable as
follows: (a) place the hot junction in an ice bath and adjust R1 for VO(TJ) = 0 V;
(b) place the hot junction in a hot environment of known temperature and adjust R2
for the desired output (the second adjustment can also be performed with the help of a
thermocouple voltage simulator).
To suppress noise pickup by the thermocouple wires, use an RC ﬁlter as shown, say
R = 10 k and C = 0.1 μF.
Thermocouple cold-junction compensators are also available as self-contained
IC modules. Two examples are the AD594/5/6/7 series and the LT1025.

553
SECTION 11.4
Linear Regulators
11.4
LINEAR REGULATORS
Figure 11.16 shows the basic ingredients of a voltage regulator. The circuit uses the
Darlington pair Q1-Q2, also called the series-pass element, to transfer power from
the unregulated input source VI to the output load at a prescribed regulated voltage
VO. (In MOS technology, the series-pass element is a power FET.) The feedback
network R1-R2 samples VO and feeds a portion thereof to the error ampliﬁer EA for
comparison against a reference VREF. The ampliﬁer provides the series-pass element
with whatever drive it takes to force the error close to zero. The regulator is a classic
example of series-shunt feedback, and it can be viewed as a noninverting op amp
that has been equipped with a Darlington current booster to give
VO =

1 + R2
R1

VREF
(11.19)
Since the error ampliﬁer provides currents on the order of milliamperes and
the load may draw currents on the order of amperes, a current gain on the order of
103 A/A is required. A single power BJT is usually insufﬁcient, so a Darlington pair
is used instead, whose overall current gain is β ∼= β1 × β2. We observe that for
an npn BJT to work in the forward-active region, where IC = βIB, the condi-
tions vBE = VBE(on) and vCE ≥VCE(sat) must hold. A low-power BJT has typically
β ∼= 100, VBE(on) ∼= 0.7 V, and VCE(sat) ∼= 0.1 V; a power BJT may have β ∼= 20,
VBE(on) ∼= 1 V, and VCE(sat) ∼= 0.25 V. If a power MOSFET is used as the series-pass
element, then just one transistor sufﬁces because the gate terminal draws virtually
zero current.
Q4
Q1
Q2
Q3
–
+
R5
RB
R7
R8
R2
R1
Rsc
RE
R6
VREF
+
Dz
VI
EA
VO
Load
IO
FIGURE 11.16
Simpliﬁed circuit diagram of a typical bipolar positive voltage regulator.

554
CHAPTER 11
Voltage
References and
Regulators
Protections
The reliable performance of a power BJT is critically affected by power-dissipation
capabilities, current and voltage ratings, maximum junction temperature, and second
breakdown, a phenomenon resulting from the formation of hot spots within the BJT,
which cause uneven sharing of the total load among different regions of the device.
The above factors deﬁne a restricted region of the iC-vCE characteristic, known as
the safe operating area (SOA), within which the device can be operated without the
risk of failure or performance degradation.
Voltage regulators are equipped with special circuitry to protect the power stage
against current overload, second breakdown, and thermal overload. Each circuit is
designed to be inactive under normal operating conditions, but to become active as
soon as an attempt is made to exceed the corresponding safety limits.
Current overload protection is dictated by maximum power-rating considera-
tions. Since the power dissipated by the series-pass BJT is P ∼= (VI −VO)IO,
we must ensure IO ≤Pmax/(VI −VO) for safe operation. The protection scheme of
Fig. 11.17, similar to that discussed at the end of Chapter 5 for op amps, uses a brute-
force approach to keep IO below the limit Isc = Pmax/VI , which occurs when the
output is short-circuited to ground, or VO = 0. As we know, the design equation is
Rsc = VBE3(on)
Isc
(11.20)
To conﬁne the series-pass BJT within its SOA, its collector current must be
reduced in case the collector-emitter voltage rises above a safety level, a likely
event when high-voltage transients are present on the unregulated input line. This
protection is implemented with the Zener diode Dz, as shown in Fig. 11.16. This
diode, normally in cutoff, is designed to turn on as soon as VI rises above a safety
level. The current supplied by Dz will then turn on Q3 and divert current away from
the base of the series-pass BJT, as in the case of current overload. The function of
R5 is to decouple the base of Q3 from the low-impedance emitter of Q2, and that
of R6 is to limit the current through Dz, particularly in the presence of large noise
spikes on the input line.
Excessive self-heating may cause permanent damage to BJTs, unless junction
temperatures are kept from rising above a safety level, usually 175 ◦C or less. The
RB
R1, R2 
VO
VI
Q1, Q2
Q3
Load
EA
Rsc
IO
FIGURE 11.17
Output overload protection.

555
SECTION 11.4
Linear Regulators
series-pass BJT is protected by sensing its instantaneous temperature and reducing
its collector current in case of thermal overload. In the circuit of Fig. 11.16 this
protection is provided by Q4, a BJT mounted in close thermal coupling with the
series-pass element. Temperature is sensed by exploiting the negative TC of VBE4.
This BJT is designed to be in cutoff during acceptable thermal conditions, but to
turn on as soon as the temperature approaches 175 ◦C. Once in conduction, Q4 will
divert current away from the base of the series-pass BJT, reducing its conduction
to the point of even shutting it off until the temperature drops to a more tolerable
level.
EXAMPLE 11.10.
In the circuit of Fig. 11.16 assume VBE4(25 ◦C) = 700 mV and
TC(VBE4) = −2 mV/◦C. Find R7 and R8 to cause thermal shutdown at 175 ◦C if VREF
is a bandgap reference.
Solution.
The voltage required to turn on Q4 can be estimated as VBE4 (175 ◦C) =
VBE4 (25 ◦C) + TC(VBE4)(175 −25) ◦C ∼= 700 mV + (−2 mV/◦C)150 ◦C ∼= 400 mV.
Ignoring IB4 and imposing 0.4 = [R8/(R8 + R7)]1.282 gives R7/R8 = 2.2. Assum-
ing IB4 = 0.1 mA and imposing VREF/(R7 + R8) ∼= 10IB4 gives R7 = 880  and
R8 = 400 .
Efﬁciency
The efﬁciency of a regulator is deﬁned as η(%) = 100PO/PI , where PO(= VO IO)
is the average power delivered to the load, and PI (= VI II ) is that absorbed from
the input source. The current II drawn from the VI source splits between the load
and the control circuitry consisting of the bandgap reference, the error ampliﬁer, and
the feedback network. Being only on the order of milliamperes, the latter current is
negligible compared to IO, so we approximate II ∼= IO and write
η(%) ∼= 100VO
VI
(11.21)
EXAMPLE 11.11.
In the circuit of Fig. 11.16 let RB = 510 , RE = 3.3 k, and
Rsc = 0.3 , and suppose the error ampliﬁer can swing its output linearly to within
0.25 V of VI. Assuming a bandgap reference and typical BJT, ﬁnd (a) the ratio R2/R1
for VO = 5.0 V, (b) the error-ampliﬁer output voltage and current needed to provide
IO = 1 A, (c) the dropout voltage VDO, and (d) the maximum efﬁciency for the given
IO. (e) What is the efﬁciency if VI is obtained from a car battery?
Solution.
(a) Imposing the condition 5 = (1 + R2/R1) × 1.282 gives R2/R1 = 2.9.
(b) For IO = 1 A we have IB2 = IE2/(β2 + 1) = 1/21 = 47.6 mA, and IE1 =
IB2 + VBE2(on)/RE2 ∼= 48 mA. The error ampliﬁer must therefore supply IO A =
IB1 = IE1/(β1+1) = 48/101 ∼= 0.475 mA at a voltage of VO A = VRB +VBE1(on)+
VBE2(on) + VRsc + VO = 0.51 × 0.475 + 0.7 + 1 + 0.3 × 1 + 5 ∼= 7.25 V.
(c) Allowing a headroom of 0.25 V for the EA, it is apparent that to function properly
the circuit needs VI ≥7.25 + 0.25 = 7.5 V. Hence, VDO = 7.5 −5 = 2.5 V.
(d) Since VI ≥7.5, Eq. (11.21) gives η(%) ≤100 × 5/7.5 ∼= 67%.
(e) For VI = 12 V, the efﬁciency drops to η(%) = 100 × 5/12 ∼= 42%.

556
CHAPTER 11
Voltage
References and
Regulators
Monolithic Voltage Regulators
The basic structure of Fig. 11.16, or variants thereof, is available in monolithic
form from many sources. Two of the earliest products to gain widespread popularity
were the μA7800 series of positive regulators, and the μA7900 series of negative
regulators (look them up on the web). The μA78G series is similar to the μA7800
series, except that the R1-R2 resistor pair of Fig. 11.16 is omitted, and the inverting
input terminal of the error ampliﬁer, referred to as the control pin, is made accessible
to the user for the external setting of VO. Called a four-terminal adjustable regulator,
the device is especially useful in remote sensing. As depicted in Fig. 11.18, mounting
the feedback network right across the load and equipping it with separate returns
will ensure a regulated voltage of Eq. (11.19) right at the load, irrespective of any
voltage drops across the stray resistances rs of the wires. The four-terminal version
of the 7900 negative regulators is called the μA79G.
Another popular class of products is offered by three-terminal adjustable reg-
ulators, of which the LM317 positive regulator and the LM337 negative regulator
are among the most widely known examples. In the LM317 functional diagram8
of Fig. 11.19a, the diode is a 1.25-V bandgap reference biased at 50 μA. The er-
ror ampliﬁer provides whatever drive it takes to keep the voltage at the output pin
1.25-V higher than the voltage at the adjustment pin. Thus, connecting the device
as in Fig. 11.19b gives VO = VADJ + 1.25 V. By the superposition principle,
VADJ = VO/(1 + R1/R2) + (R1 ∥R2)(50 μA). Eliminating VADJ gives
VO =

1 + R2
R1

1.25 V + R2(50 μA)
(11.22)
The purpose of R1 and R2, besides setting the value of VO, is to provide a conductive
path toward ground for the quiescent current of the error ampliﬁer and the remaining
circuitry in the absence of a load. The data sheets recommend imposing a current
of 5 mA through R1 to meet this requirement. One can then verify that the effect of
the 50-μA current becomes negligible, so VO = (1 + R2/R1)1.25 V. By varying
R2, VO can be adjusted anywhere from 1.25 V and 35 V. A more recent adjustable
regulator is the LT3080, which you can search online for its circuit schematic as
well as useful application suggestions.
VO
+
–
rs
rs
rs
In
Out
78G
Control
Common
R2
R1
Load
+
VI
FIGURE 11.18
Adjustable regulator with remote sensing.

557
SECTION 11.4
Linear Regulators
VI
VO
+
–
+
–
EA
R1
R2
VADJ
Protection
circuits
500 Ω
0.2 Ω
50 μΑ
 μ 
50 μΑ
 μ 
Output
LM317
Input
Adjustment
1.25 V
1.25 V
In
Out
Adjust
(a)
(b)
FIGURE 11.19
Functional diagram and typical connection of the LM317 three-terminal adjustable regulator.
(Courtesy of Texas Instruments.)
Low-Dropout (LDO) Regulators
Considerations of efﬁciency and power dissipation, along with the demands by low-
voltage portable-power systems, have led to the emergence of low-dropout (LDO)
regulators. For a closer look at the dropout voltage VDO, refer to the commonly
used topologies of Fig. 11.20, each circuit consisting of a series-pass element and
its driver, in turn controlled by the voltage vX. Recalling that VDO = VI (min) −VO,
where VI (min) is the lowest input voltage before the control loop stops regulating,
we can proceed along the same lines as for the OVS estimations of Section 5.7.
The topology of Fig. 11.20a gives VDO = VEC1(EOS) + VBE2(on) + VBE3(on),
where VEC1(EOS) is Q1’s emitter-collector voltage at the edge of saturation. Using
typical values, VDO = 0.25+0.7+1 ∼= 2 V. Figure 11.20b shows the MOS version
vX
VO
VI
M1
M2
vX
VO
VI
Q1
Q2
Q3
vX
VO
VI
VI
VO
Q1
Q2
M2
M1
vX
(a)
(b)
(c)
(d)
FIGURE 11.20
Common output topologies for series regulators.

558
CHAPTER 11
Voltage
References and
Regulators
+
–EA
Current
limit
Reference
Series 
element
Input
Output
⇒
Common
Q2
Q1
R1
R2
R3
FIGURE 11.21
Block-diagram of a low-dropout (LDO) regulator.
of Fig. 11.20a (thanks to the virtually inﬁnite input resistance of FETs, the series-pass
function in this case performed by a single power FET, M2). We now have VDO =
VSD1(EOS) + VGS2 = VOV 1 + Vtn + VOV 2, where VOV is the overdrive voltage
and Vtn is the threshold voltage. Assuming the typical values of Section 5.7, VDO =
0.25 + 0.75 + 0.25 = 1.25 V. In both topologies the series-pass element is a voltage
follower (common collector in the BJT case, common drain in the MOS case). As
such, it is inherently fast, and its low output impedance makes it relatively immune to
capacitive loading.1 However, their VDOs are unacceptably high in many situations.
Following the rail-to-rail considerations of Section 5.7, we can reduce VDO
signiﬁcantly by operating the series-pass element as common emitter (CE) or a
common source (CS) instead of CC or CD. This leads to the topologies of Fig.
11.20c and d, for which we have, respectively, VDO = VEC2(EOS) (∼= 0.25 V) and
VDO = VSD2(EOS) = VOV 2 (∼= 0.25 V), which are appreciably lower. Their lower
VDOs, however, come at a price, and this is the inherently high output impedance of
the CE/CS conﬁgurations: the feedback pole formed by the capacitive and resistive
components of the load tend to destabilize the control loop. A common cure is to
use a snubber compensation technique of the type discussed in Section 8.4, using
an output capacitor with a prescribed range of capacitance and equivalent series
resistance (ESR) values.1,9
Figure 11.21 shows an example of a LDO regulator. To avoid using Rsc, which
would increase VDO, the pnp BJT is equipped with an additional small-area collector
to provide collector-current sensing information for the overload protection circuitry.
LDOs are often used to provide postregulation of the noisier outputs of switching
regulators.
11.5
LINEAR-REGULATOR APPLICATIONS
The primary application of voltage regulators is in power supplies, especially dis-
tributed supplies, where the unregulated voltage is brought to different subsystems
to be treated locally by dedicated regulators. Aside from a few simple requirements,

559
SECTION 11.5
Linear-Regulator
Applications
C2
C1
7805
Common
1
2
3
In
Out
Unregulated input
(7.5 V to 35 V)
Regulated output
(5 V, 0 to 1 A)
0.33 μF
 μ
0.1 μF
 μ
FIGURE 11.22
Typical circuit connection of the μA7805 voltage regulator. (Copyright,
Fairchild Semiconductor Corporation, 1982. Used by permission.)
a linear regulator is generally easy to use. As exempliﬁed in Fig. 11.22, the device
should always be equipped with an input capacitor to reduce the effects of stray in-
ductance in the input wires, especially if the regulator is located away from the unreg-
ulated source, and an output capacitor to help improve the response to sudden load-
current changes. For best results, use thick wires and traces, keep the leads short, and
mount both capacitors as close as possible to the regulator. Depending on the case,
heat-sinking may be required to keep the internal temperature within tolerable levels.
Power Sources
With the help of a few external components, a voltage regulator can, like a voltage
reference, be conﬁgured for a variety of voltage source or current source applications,
the main difference lying in the much higher currents available.
A regulator is conﬁgured for a higher output voltage by raising its common
terminal to a suitable voltage pedestal. In Fig. 11.23a we have VO = VREG + R2 ×
VO/(R1 + R2), or
VO =

1 + R2
R1

VREG
(11.23)
+
–
Rpot
kRpot
R2
R1
VREG
VCC
+
–
VO
In
Out
Common
Regulator
Regulator
+
–
R
kVREG
VCC
VEE
+
–
+
–
VL
In
Out
Common
Load
IO
(a)
(b)
FIGURE 11.23
Conﬁguring a regulator (a) as a power voltage source, and (b) as an adjustable power current
source.

560
CHAPTER 11
Voltage
References and
Regulators
The role of the op amp, which is powered from the regulated output to eliminate any
PSRR and CMRR errors, is to prevent the feedback network from being loaded by
the common terminal. However, if the current of this terminal is sufﬁciently small,
as in the case of adjustable regulators such as the LM317 and LM337 types, then
we can do without the op amp and the circuit simpliﬁes to the familiar form of
Fig. 11.19b.
EXAMPLE 11.12.
Suppose the circuit of Fig. 11.23a uses a 7805 5-V regulator, whose
ratings are VDO = 2 V and (VIn −VCommon)max = 35 V. Specify suitable resistances for
VO = 15.0 V, and comment on the line and load regulation. What is the permissible
range for VCC?
Solution.
Imposing 15 = (1 + R2/R1)5 gives R2/R1 = 2. Use R1 = 10 k, R2 =
20 k. For the exact adjustment of VO, interpose a 1-k potentiometer between R1
and R2, and connect the op amp’s noninverting input to the wiper. The percentage
values of the line and load regulation are the same as those reported in the 7805 data
sheets. However, their mV/V and mV/A values are now 1 + R2/R1 = 3 times as
large. The op amp keeps VCommon at 10 V, so VCC(max) = 10 + 35 = 45 V. Moreover,
VCC(min) = VO + VDO = 15 + 2 = 17 V.
In Fig. 11.23b the op amp bootstraps the regulator’s common terminal with
the voltage VL developed by the output load, and the regulator keeps the voltage
across R at kVREG, where k represents the fraction of the potentiometer between the
wiper and the regulator’s output, 0 ≤k ≤1. Consequently, the circuit gives
IO = k VREG
R
(11.24)
regardless of VL, provided no saturation effects occur. We thus have an adjustable
current source, and its voltage compliance is VL ≤VCC −VDO −kVREG. If a current
sink is needed, then we can use a negative regulator. To maximize the compliance
for a given VCC, use a regulator with low VDO and VREG. An adjustable regulator
of the 317 or 337 type is a good choice.
EXAMPLE 11.13.
The circuit of Fig. 11.23b uses an LM317 1.25-V regulator, whose
ratings are VDO = 2 V and line regulation = 0.07%/V maximum. Assuming a 10-k
potentiometer, an op amp with CMRRdB ≥70 dB, and ±15-V supplies, specify R for
an adjustable current from 0 to 1 A; next, ﬁnd the voltage compliance and the minimum
equivalent resistance seen by the load for the case k = 1.
Solution.
R = 1.25 , 1.25 W (use 1.24 , 2 W). VL ≤15−2−1.25 = 11.75 V. A 1-V
change in VL causes a worst-case change in IO of (1.25×0.07/100+10−70/20)/1.25 =
0.953 mA, so Ro(min) = (1 V)/(0.953 mA) = 1.05 k.
Thermal Considerations
The power dissipated in the base-collector junction of the series-pass BJT is con-
verted into heat, which raises the junction temperature TJ. To prevent permanent
damage to the BJT, TJ must be kept within a safe limit. For silicon devices, this
limit is in the range of 150 ◦C to 200 ◦C. To avoid excessive temperature buildup,
heat must be expelled from the silicon chip to the surrounding package structure

561
SECTION 11.5
Linear-Regulator
Applications
and from there to the ambient. At thermal equilibrium, the temperature rise of a
constant-power dissipating BJT with respect to the ambient can be expressed as
TJ −TA = θJAPD
(11.25)
where TJ and TA are the junction and ambient temperatures, PD is the dissipated
power, and θJA is the junction-to-ambient thermal resistance, in degrees Celsius
per watt. This resistance, representing the amount of temperature rise per unit of
dissipated power, is given in the data sheets. For instance, for θJA = 50 ◦C/W the chip
temperature rises above theambient temperature by50 ◦Cfor every wattof dissipated
power. If TA = 25 ◦C and PD = 2 W, then TJ = TA + θJAPD = 25 + 50 × 2 =
125 ◦C. We can also regard θJA as a measure of a device’s ability to expel heat. The
lower θJA, the smaller the temperature rise for a given PD. It is apparent that θJA and
TJ(max) set an upper limit on PD for a given TA(max).
The heat-transfer process can be modeled with an electrical-conduction analog
where power corresponds to current, temperature to voltage, and thermal resistance
to ohmic resistance. This analogy is illustrated in Fig. 11.24 for the case of free-air
operation, that is, with no provisions for cooling. The thermal resistance θJA consists
of two components,
θJA = θJC + θCA
(11.26)
where θJC is the thermal resistance from junction to case, and θCA from case to
ambient. Using Ohm’s law and KVL, we can ﬁnd the temperature at any point of
the heat-ﬂow path once the other parameters are known. If the path involves more
than one resistance, the net resistance is the sum of the individual resistances.
The component θJC is set by device layout and packaging. To help reduce θJC,
the device is encapsulated in a suitably large case, and the collector region, where
most of the heat is dissipated, is placed in direct contact with the case. Figure 11.25
shows two popular packages, along with their thermal ratings for the case of the
μA7800 and μA7900 series. Data sheets usually give only θJC and θJA; then, we
can compute θCA = θJA −θJC.
θJA
θ
θCA
θ
θCA
θ
θJC
θ
θJC
θ
TJ
TC
TA
TC
TJ
TA
PD
+
Chip (junction)
Package
Leads
Case
(a)
(b)
FIGURE 11.24
(a) Electrical analog of heat ﬂow. (b) Typical package structure operating in
free air.

562
CHAPTER 11
Voltage
References and
Regulators
TO-3
(Metal can)
TO-220
(Molded plastic)
FIGURE 11.25
Two popular power packages. For the μA7800 series, the typ-
ical
(maximum)
thermal-resistance
ratings
are:
TO-3:
θJC =
3.5(5.5) ◦C/W, θJA = 40 (45) ◦C/W; TO-220: θJC = 3.0 (5.0) ◦C/W,
θJA = 60 (65) ◦C/W.
EXAMPLE 11.14.
(a) The data sheets of the 7805 5-V regulator specify TJ(max) =
150 ◦C. Assuming TA(max) = 50 ◦C, ﬁnd the maximum power that a TO-220 package
operating in free air can dissipate. What is the corresponding case temperature TC?
(b) Find the maximum current that can be drawn from the device if VI = 8 V.
Solution.
(a) PD(max) = (TJ(max) −TA(max))/θJA = (150 −50)/60 = 1.67 W. By KVL, TC =
TJ −θJC PD = 150 −3 × 1.67 = 145 ◦C.
(b) Ignoring the current at the common terminal, we have PD ∼= (VI −VO)IO, so
IO ≤1.67/(8 −5) = 0.556 A.
In the case of free-air operation, heat encounters much more resistance in prop-
agating from case to ambient than from junction to case. The user can reduce θCA
signiﬁcantly by means of a heatsink. This is a metal structure, usually with ﬁns, that
is bonded, clipped, or clamped to the device package to facilitate heat ﬂow from case
to ambient. The effect of a heat sink is illustrated in Fig. 11.26. While θJC remains
+
TA
TS
PD
TC
TJ
TA
TS
TC
TJ
JC
θ
CS
θ
SA
θ
JA
θ
JC
θ
CS
θ
SA
θ
Fins
Fins
Case
Heat sink
Mounting
surface
Junction
(a)
(b)
FIGURE 11.26
Heat-ﬂow electrical analog of a package mounted on a heat sink.

563
SECTION 11.5
Linear-Regulator
Applications
the same, θCA is altered signiﬁcantly as
θCA = θCS + θSA
(11.27)
where θCS is the thermal resistance of the mounting surface and θSA is that of
the heatsink. The mounting surface is usually a thin insulating washer of mica
or ﬁberglass to provide electrical isolation between the case, which is internally
connected to the collector, and the sink, which is often bonded to the chassis. Usually
smeared with heat sink grease to ensure intimate thermal contact, the mounting
surface has a typical thermal resistance of less than 1 ◦C/W.
Heat sinks are available in a variety of shapes and sizes, with thermal resistances
ranging from about 30 ◦C/W for the smaller types to as little as 1 ◦C/W or less
for the truly massive units. Thermal resistance is speciﬁed for the case of a heat
sink mounted with ﬁns vertical and with unobstructed airﬂow. Forced air cooling
reduces thermal resistance further. In the limiting case of inﬁnite heat sinking and a
thermally perfect mounting surface, θCA would approach zero and the device’s ability
to expel heat would be limited only by θJC. The package-heat sink combination best
suited to a given application is determined on the basis of the maximum expected
power dissipation, the maximum allowable junction temperature, and the maximum
anticipated ambient temperature.
EXAMPLE 11.15. A μA7805 regulator is to meet the following requirements: TA(max) =
60 ◦C, IO(max) = 0.8 A, VI (max) = 12 V, and TJ(max) = 125 ◦C. Select a suitable package-
heat sink combination.
Solution. θJA(max) = (125−60)/[(12−5)0.8] = 11.6 ◦C/W. Use the TO-220 package,
which is cheaper and offers better thermal resistance. Then, θCA = θJA−θJC = 11.6−5 =
6.6 ◦C/W. Allowing 0.6 ◦C/W for the thermal resistance of the mounting surface, we are
left with θSA = 6 ◦C/W. According to the catalogs, a suitable heat sink example is the
IERC HP1 series, whose θSA rating is in the range of 5 ◦C/W to 6 ◦C/W.
Power-Supply Supervisory Circuits
The forms of protection discussed in Section 11.4 safeguard the regulator. A well-
designed power-supply system will also include circuitry to safeguard the load and
to monitor satisfactory power-supply performance. The functions typically required
are overvoltage (OV) protection, undervoltage (UV) sensing, and ac line loss detec-
tion. The MC3425 is one of a variety of dedicated circuits known as power-supply
supervisory circuits designed to assist the designer in this task.
As shown in Fig. 11.27, the circuit consists of a 2.5-V bandgap reference and
two comparator channels, one for OV protection and the other for UV detection. The
input comparators CMP1 and CMP3 have open-collector outputs with 200-μA active
pullups. These outputs are externally accessible to allow independent adjustment of
the response delays of the two channels in order to prevent false triggering in noisy
environments. The delays are established by connecting two capacitors between
these outputs and ground, as shown in the subsequent ﬁgures.
Under normal conditions these outputs are low. Should, however, an OV or UV
condition arise, either CMP1 or CMP3 will switch its output BJT off to allow the
corresponding delay capacitor to charge by the 200-μA pullup. Once the capacitor
voltage reaches VREF, the corresponding output comparator ﬁres, signaling that the
emergency condition persisted for the entire delay of that channel. The delay of

564
CHAPTER 11
Voltage
References and
Regulators
IH
+
+
–
+
–
+
–
+
–
3
4
12.5 μA
2
5
7
6
1
8
OV
Drive
UV
Indicator
UV
Sense
OV
Sense
Ground
VCC
UV
Delay
OV
Delay
CMP1
CMP3
CMP4
CMP2
200
μA
200
μA
VREF
2.5 V
FIGURE 11.27
Simpliﬁed diagram of the MC3425 power-supply supervisory/overvoltage-undervoltage pro-
tection circuit. (Courtesy of Motorola, Inc.)
either channel is obtained via Eq. (10.2) as TDLY = CDLY(2.5 V)/(200 μA), or
TDLY = 12,500CDLY
(11.28)
where CDLY is in farads and TDLY in seconds. For instance, using CDLY = 0.01 μF
yields TDLY = 125 μs.
Whereas the UV comparator CMP4 has an open-collector output, the OV com-
parator CMP2 has an overload-protected output booster to drive an external silicon
controlled rectiﬁer (SCR) crowbar for emergency power shutdown.
OV/UV Sensing and Line-Loss Detection
Figure 11.28 shows a typical 3425 connection for OV protection and UV sensing.
The OV channel trips whenever VCC tries to rise above a level VOV such that
VOV/(1 + R2/R1) = VREF, or
VOV =

1 + R2
R1

VREF
(11.29)
If the OV condition persists for the entire delay TOV as set by COV, the MC3425
ﬁres the SCR, which in turn shorts out the voltage regulator and blows the fuse, thus

565
SECTION 11.5
Linear-Regulator
Applications
R5
R4
R3
R2
R1
COV
CUV
+
–
Load
Fuse
MC3425
MCR67
Voltage
regulator
Unregulated
input
2
7
8
5
6
1
4
3
VCC
FIGURE 11.28
Overvoltage protection and undervoltage sensing using the MC3425.
protecting the load against prolonged over-voltage and the unregulated input source
against prolonged overload.
Likewise, the UV channel trips whenever VCC drops below
VUV =

1 + R4
R3

VREF
(11.30)
Once tripped, CMP3 also activates an internal circuit that sinks a current IH =
12.5 μA from the UV sense input pin. This current is designed to load down the
voltage of this pin in order to produce hysteresis and, therefore, reduce chatter. The
hysteresis width is
VUV = (R3 ∥R4)(12.5 μA)
(11.31)
Thus, once CMP3 ﬁres as a result of VCC dropping below VUV, it remains in that
state until VCC rises above VUV + VUV. Unless this happens within the delay TUV
as set by CUV, CMP4 also ﬁres and causes the LED to glow. Once VCC returns above
VUV + VUV, CMP3 returns to the original state and deactivates IH.
EXAMPLE 11.16.
In Fig. 11.28 specify suitable components for an OV trip level of
6.5 V with a 100-μs delay, and a UV trip level of 4.5 V with a 0.25-V hysteresis and a
500-μs delay.
Solution. The above equations give COV = 8 nF, R2/R1 = 1.6, R4/R3 = 0.8, R3 ∥R4 =
20 k, CUV = 40 nF. Use COV = 8.2 nF, CUV = 43 nF, R1 = 10.0 k, R2 = 16.2 k,
R3 = 45.3 k, R4 = 36.5 k.
In microprocessor-based systems, ac line loss, whether total (blackout) or partial
(brownout), must be detected in time to allow the salvage of vital status information
in nonvolatile memory, as well as disable any devices that might be adversely affected
by underpowered operation, such as motors and pumps. The circuit of Fig. 11.29a
monitors the ac line via a center-tapped transformer (which can be the very trans-
former involved in the generation of the unregulated input to the voltage regulator)
and uses the UV channel to detect line loss. Circuit operation is best understood with
the help of the waveforms of Fig. 11.29b.
The delay capacitor CUV is chosen to be large enough so that, under normal line
conditions, it does not have enough time between consecutive ac peaks to charge
past 2.5 V. This is also referred to as retriggerable one-shot operation. However,

566
CHAPTER 11
Voltage
References and
Regulators
Rp
R4
R3
R2
R1
COV
CUV
Load
Fuse
MC3425
MCR67
PFAIL
Voltage
regulator
Unregulated
input
2
7
8
5
6
1
4
3
VCC
PFAIL
2.5 V
2.5 V
v5
v4
ac
line
t
t
t
(a)
(b)
FIGURE 11.29
Overvoltage protection with ac line-loss detection circuit, and typical waveforms.
should the line drop to the extent of causing the peaks at the UV sense pin 4 to drop
below the 2.5-V threshold, CUV will fully charge and trigger CMP4, thus issuing
a PFAIL command. This can be used to interrupt the microprocessor and initiate
appropriate power-fail routines.
11.6
SWITCHING REGULATORS
As we know, in a linear regulator the series-pass transistor transfers power from VI to
VO continuously. As depicted in Fig. 11.30a for the bipolar case, the BJT operates in
the forward-active region, where it acts as a controlled current source dissipating the
power P = VCEIC + VBEIB. Ignoring the base current and the current drawn by the
control circuitry compared to the load current IO, we can write P ∼= (VI −VO)IO.
As already seen, it is precisely this dissipation that limits the efﬁciency of a linear

567
SECTION 11.6
Switching
Regulators
+
–
R2
R1
+
L
Q
Q
D
+
IO
VI
+
–
R2
C
R1
+
+
IO
VO
VO
VREF
VREF
fS
VI
Modulator
EA
EA
(a)
(b)
Load
Load
FIGURE 11.30
Linear regulator and switching regulator.
regulator to
η(%) = 100VO
VI
For example, with VI = 12 V and VO = 5 V, we get only η = 41.7%.
As we know, proper operation requires that VI ≥VO + VDO, where VDO is
the dropout voltage. A linear regulator of the low-dropout (LDO) type can be made
to operate efﬁciently by powering it with a preregulated voltage near VO + VDO.
However, in the absence of any preregulation, VI may vary well above VO + VDO,
making even an LDO regulator inefﬁcient when VI is at its maximum.
Switching regulators achieve higher efﬁciency by operating the transistor as a
periodically commutated switch as shown in Fig. 11.30b. In this case the BJT is
either in cutoff, dissipating P ∼= VCEIC ∼= (VI −VO) × 0 = 0, or in saturation,
dissipating P ∼= VSATIC, which is generally small because so is the voltage VSAT
across the closed switch. Thus, a switched BJT dissipates much less power than a
forward-active BJT. The price for switch-mode operation is the need for a coil to
provide a high-frequency transfer of energy packets from VI to VO, and a smoothing
capacitor to ensure a low output ripple. However, L and C manipulate energy without
dissipating any power, at least ideally. Consequently, the combination of switches
and low-loss reactive elements makes switching regulators inherently more efﬁcient
than their linear counterparts.
Switch-mode regulation is effected by adjusting the duty cycle D of the switch,
deﬁned as
D =
tON
tON + tOFF
= tON
TS
= fStON
(11.32)
where tON and tOFF are the time intervals during which the transistor is on and off;
TS = tON + tOFF is the duration of a switch cycle; and fS = 1/TS is the operating
frequency of the switch. There are two ways of adjusting the duty cycle: (a) in
pulse-width modulation (PWM), fS is kept ﬁxed and tON is adjusted; and (b) in
pulse-frequency modulation (PFM), tON (or tOFF) is ﬁxed and fS is adjusted. It is
apparent that switching regulators require more complex control circuitry than their
linear counterparts.

568
CHAPTER 11
Voltage
References and
Regulators
Basic Topologies
If we view the switch-coil-diode combination as a T structure, then, depending
on which leg is occupied by the coil, we have the three topologies of Fig. 11.31,
called, for reasons to be justiﬁed shortly, the buck, boost, and buck-boost topologies;
clearly, the circuit of Fig. 11.30b is a buck circuit. Though the topologies are shown
for operation with VI > 0, they can readily be conﬁgured for VI < 0 by proper
reversal of the switch and diode polarities. Moreover, a number of variants10,11 can
be obtained by suitable modiﬁcation of the coil and switch structures. To gain more
insight, we focus on the buck topology, though similar analysis can be applied also
to the other topologies.
Assuming VI > VO in Fig. 11.31a, we can describe buck operation as follows.
During tON the switch closes and connects the coil to VI . The diode is off, so
the situation is as in Fig. 11.32a, where VSAT is the voltage drop developed by the
closed switch. During this time, current and magnetic energy build up in the coil
according to the familiar laws diL/dt = vL/L and wL = (1/2)Li2
L. If VI and VO do
not change appreciably during a switch cycle, the coil voltage vL remains relatively
VI
+
SW
L
D
C
LD
Control
VI
+
SW
C
L
LD
Control
D
VI
+
SW
C
LD
Control
0
D
0
0.5
1
1
0.5
VO/VI
0
D
0
2.5
5
1
0.5
VO/VI
0
D
–4
–2
0
1
0.5
VO/VI
(a)
(b)
(c)
(d)
(e)
( f )
+
–
VO
+
–
VO
+
–
VO
FIGURE 11.31
Basic switching-regulator topologies and idealized VO/VI ratios as functions of the duty cycle
D: (a), (b) buck; (c), (d) boost; (e), ( f ) buck-boost.

569
SECTION 11.6
Switching
Regulators
VO
D
LD
+
VI
SW
(a)
(b)
+
–
vL
iL
IO
iC
VF
VSAT
+
VO
LD
+
VI
+
–
vL
iL
IO
iC
+
+
–
vC
+
–
vC
FIGURE 11.32
Equivalent circuits of the buck converter when SW is (a) closed and (b) open.
constant at vL = VI −VSAT−VO. We can replace differentials with ﬁnite differences
and write iL = vLt/L, so during tON the coil current increases by
iL(tON) = VI −VSAT −VO
L
tON
(11.33)
Recall from basic physics that current in a coil cannot change instantaneously.
Consequently, when the switch is opened, the coil will develop whatever voltage
it takes to maintain the continuity of its current. As the magnetic ﬁeld starts to
collapse, diL/dt changes polarity and so does vL, indicating that the coil will swing
the voltage of its left terminal negatively until the catch diode turns on to provide
a path in which the coil current can continue to ﬂow. The situation is depicted in
Fig. 11.32b, where VF is the voltage drop developed by the forward-biased diode.
The coil voltage is now vL = −VF −VO, indicating a coil current decrease
iL(tOFF) = −VF + VO
L
tOFF
(11.34)
Figure 11.33a shows the switch, diode, and coil-current waveforms for the case
in which the coil current never drops to zero, a situation referred to as continuous
conduction mode (CCM).
Once the circuit has reached steady-state operation following power turn-on, we
have iL(tON) = −iL(tOFF) = iL, where iL is called the coil current ripple.
Using Eqs. (11.32) through (11.34) gives, for the buck converter,
VO = D(VI −VSAT) −(1 −D)VF
(11.35)
Turning next to the boost topology of Fig. 11.31c, we note that the coil volt-
age, again assumed positive at the left, is vL = VI −VSAT during tON, and vL =
VI −(VF + VO) during tOFF. Proceeding as in the buck case, we ﬁnd, for the boost
converter,
VO =
1
1 −D (VI −DVSAT) −VF
(11.36)
Likewise, the coil voltage in Fig. 11.31e, assumed positive at the top, is vL =
VI −VSAT during tON, and vL = VO −VF during tOFF. Consequently, we have, for
the buck-boost converter,
VO = −
D
1 −D (VI −VSAT) + VF
(11.37)
In the ideal limits VSAT →0 and VF →0 the above equations simplify, respec-
tively, to the following lossless characteristics:
VO = DVI
VO =
1
1 −D VI
VO = −
D
1 −D VI
(11.38)

570
CHAPTER 11
Voltage
References and
Regulators
iL
iL
Ip
Ip
IL
0
iD
iD
Ip
Ip
0
0
0
tON
tOFF
tON
tOFF
ΔiL
t
t
t
t
iSW
iSW
Ip
Ip
0
0
t
t
(a)
(b)
FIGURE 11.33
Current waveforms for the three basic topologies: (a) continu-
ous conduction mode (CCM), and (b) discontinuous conduction
mode (DCM).
These relationships are illustrated pictorially in Fig. 11.31b, d, and f . Considering
that 0 < D < 1, the buck converter yields VO < VI and the boost converter VO > VI ,
these being the reasons for their names. By analogy with transformers, the buck and
boost circuits are also referred to as step-down and step-up converters. In the buck-
boost circuit the output magnitude can be smaller or greater than the input magnitude,
depending on whether D < 0.5 or D > 0.5; moreover, the output polarity is opposite
to that of the input, so this converter is also called an inverting converter. Note that
boost and polarity inversion are not possible with linear regulators!
In the ideal limit of lossless components and zero power dissipation by the
control circuitry, a switching regulator would be 100% efﬁcient, giving PO = PI ,
or VO IO = VI II . Writing
II = (VO/VI )IO
(11.39)
provides an estimate for the current drawn from the input source.
EXAMPLE 11.17.
Given a buck converter with VI = 12 V and VO = 5 V, ﬁnd D if
(a) the switch and diode are ideal, and (b) VSAT = 0.5 V and VF = 0.7 V. (c) Repeat (a)
and (b) if 8 V ≤VI ≤16 V.
Solution.
(a) By Eq. (11.38), D = 5/12 = 41.7%.
(b) By Eq. (11.35), D = 46.7%.
(c) The same equations give, for the two cases, 31.2% ≤D ≤62.5%, and 35.2% ≤
D ≤69.5%.

571
SECTION 11.6
Switching
Regulators
Coil Selection
Two observations should provide better insight into the role of L: (a) The coil must
carry some average current IL ̸= 0 in order to feed the load; in fact, with reference
to the continuous mode shown in Fig. 11.33a, one can prove (see Problem 11.32)
that the buck, boost, and buck-boost circuits are characterized, respectively, by
IL = IO
IL = VO
VI
IO
IL =

1 −VO
VI

IO
(11.40)
(b) In steady state the average coil voltage VL must be zero.
Should a line or load ﬂuctuation intervene, the controller adjusts the duty cycle
D to regulate VO in accordance with Eq. (11.38), and the coil adjusts IL to meet
the load-current demands in accordance with Eq. (11.40). By the inductance law
iL = (1/L)
 vL dt, the coil adjusts its average current IL by integrating the volt-
age imbalance brought about by the ﬂuctuation; this adjustment continues until the
average coil voltage VL is driven back to zero.
We can picture the effect of a rise or drop in IO as an up or down shift of the
iL waveform of Fig. 11.33a. If IO drops to the point of making IL = iL/2, the
bottom of the iL waveform reaches zero. Any further decrease of IO below this
critical value will cause the bottom of the iL waveform to become clipped, as in
Fig. 11.33b, a situation referred to as discontinuous conduction mode (DCM). We
observe that in CCM VO depends only on D and VI , regardless of IO. By contrast,
in DCM VO depends also on IO, so D will have to be reduced accordingly by the
controller; failing to do so would cause, in the limit of an open-circuited output,
VO →VI for the buck, VO →∞for the boost, and VO →−∞for the buck-boost
regulators.
To estimate a suitable value of L, it is convenient to assume VSAT = VF = 0.
Then, for a buck converter in steady state, Eqs. (11.33) and (11.34) give tON =
LiL/(VI −VO) and tOFF = LiL/VO. Letting tON + tOFF = 1/fS gives, for the
buck converter,
L = VO(1 −VO/VI )
fSiL
(11.41)
Proceeding in similar manner, we ﬁnd, for the boost converter,
L = VI (1 −VI /VO)
fSiL
(11.42)
and for the buck-boost converter,
L = VI /(1 −VI /VO)
fSiL
(11.43)
The choice of L is usually a tradeoff between maximum output power with mini-
mum output ripple, and small physical size with fast transient response.11 Moreover,
increasing L for a given IO will cause the system to go from DCM to CCM. A good
starting point is to choose the current ripple iL, and then use the proper equation
to estimate L.
There are various criteria for specifying iL. One possibility11 is to let iL =
0.2IL(max), where IL(max) is dictated either by the maximum output current rating
of the regulator, as per Eq. (11.40), or by the maximum peak-current rating of the

572
CHAPTER 11
Voltage
References and
Regulators
switch, as per Ip = IL + iL/2. The switch rating becomes important especially
in step-up situations, where IL may be considerably larger than IO. Alternatively,
to avoid discontinuous operation, we can let iL = 2IO(min), where IO(min) is the
minimum anticipated load current. Other criteria11,12 are possible, depending on the
type of regulation as well as the objectives of the given application.
Once the value of L has been chosen, a coil must be found that can handle both
the peak and rms values of iL. The peak value is limited by core saturation, for if the
coil were to saturate, its inductance would drop abruptly, causing an inordinate rise
in iL during tON. The rms value is limited by losses in the windings and the core.
Though the coil has traditionally been perceived as a very intimidating issue, modern
switching-regulator data sheets provide a wealth of useful information to ease coil
selection, including coil manufacturers’ addresses and speciﬁc part numbers.
EXAMPLE 11.18.
Specify a coil for a boost converter with VI = 5 V, VO = 12 V,
IO = 1 A, and fS = 100 kHz. What is the minimum load current IO(min) for continu-
ous operation?
Solution.
At full load, IL = (12/5)1 = 2.4 A. Let iL = 0.2IL = 0.48 A. Then,
Eq. (11.44) gives L = 61 μH. At full load the coil must withstand Ip = IL + iL/2 =
2.64 A, and Irms = [I 2
L + (iL/
√
12)2]1/2 ∼= IL = 2.4 A. Moreover, IO(min) = 0.1 A.
Capacitor Selection
To estimate a suitable value of C in the buck topology of Fig. 11.31a, we observe
that the coil current splits between the capacitor and the load as iL = iC + iO. In
steady state the average capacitance current is zero and the load current is relatively
constant. We can therefore write iC = iL, indicating that the iC waveform is
similar to the iL waveform, except that iC is centered about zero, as depicted in
Fig. 11.34. The iC ripple causes in turn a vC ripple, which we readily ﬁnd as
vC = QC/C, where QC is the area under the iC curve over half the clock
period TS/2. The area of the triangle is QC = (1/2)×(TS/2)×(iC/2). Letting
t
t
ΔiC
ΔQC
iC
VO
vC
ΔvC
TS/2
0
FIGURE 11.34
Capacitor current and voltage waveforms for the buck
converter.

573
SECTION 11.6
Switching
Regulators
ESR
ESL
C
FIGURE 11.35
A practical capacitor has an
equivalent series resistance
ESR and inductance ESL.
iC = iL and eliminating QC gives, for the buck converter,
C =
iL
8 fSvC
(11.44a)
In the boost topology of Fig. 11.31c the coil is disconnected from the output
during tON, so the load current during this time is supplied by the capacitor. Using
Eq. (10.2), we estimate the ripple as vC = IOtON/C. But, tON = D/fS and
D = 1 −VI /VO, so we have, for the boost converter,
C = IO(1 −VI /VO)
fSvC
(11.44b)
Similar considerations hold for the buck-boost topology of Fig. 11.31e, so
C = IO(1 −VI /VO)
fSvC
(11.44c)
The above equations give C for a speciﬁc ripple vC. Practical capacitors exhibit
a small equivalent series resistance (ESR) and a small equivalent series inductance
(ESL), as modeled in Fig. 11.35. The ESR contributes an output ripple term of the
type vESR = ESR × iC, where iC is the capacitor ripple current, indicating
the need for low-ESR capacitors. The ripple vC across C in Fig. 11.35 and the
ripple vESR across ESR combine to give an overall ripple Vro at the output. For an
estimation of the maximum allowed ESR, a reasonable approach11 is to allow 1
3 of
Vro to come from vC, and 2
3 of Vro from vESR.
EXAMPLE 11.19.
In the boost converter of Example 11.18, specify a capacitor for an
output ripple Vro ∼= 100 mV.
Solution.
At full load and with vC ∼= (1/3)Vro ∼= 33 mV, Eq. (11.44b) gives C =
177 μF. For the boost converter we have iC = iD = Ip, so at full load iC = 2.64 A.
Then, ESR = (67 mV)/(2.64 A) ∼= 25 m.
The C and ESR requirements may be difﬁcult to meet simultaneously, so we can
either increase the size of the capacitor, since larger capacitors tend to have smaller
ESRs, or we can ﬁlter out the existing ripple with an additional LC stage at the
output.
A well-constructed switching regulator will include an LC ﬁlter also at the input,
both to ease the output-impedance requirements of the source VI and to prevent
the injection of electromagnetic interference (EMI) upstream of the regulator. We
observe that the most taxing situation for a capacitor is when it is in series with either
the switch or the diode. When it is in series with the coil, as at the input of the boost
or at the output of the buck topology, the ﬁltering action provided by the coil itself
results in a smoother waveform. It follows that the buck converter enjoys the lowest
output ripple of the three topologies.

574
CHAPTER 11
Voltage
References and
Regulators
Efﬁciency
The efﬁciency of a switching regulator is found as
η(%) =
PO
PO + Pdiss
(11.45)
where PO = VO IO is the power delivered to the load, and
Pdiss = PSW + PD + Pcoil + Pcap + Pcontroller
(11.46)
is the sum of the losses in the switch, the diode, the coil, the capacitor, and the switch
controller.
Switch loss is the sum of a conduction component and a switching component,
or PSW = VSATISW + fSWSW . The conduction component is due to the nonzero
voltage drop VSAT; for the case of a saturating BJT switch this component is found as
VCE(sat)ISW(avg), and for the case of a FET switch asrDS(on)I 2
SW(rms). The switching
component is due to the nonzero rise and fall times of the voltage and current wave-
forms of the switch; the resulting waveform overlap causes the per-cycle dissipation
of an energy packet12 WSW ∼= 2vSW iSW tSW , where vSW and iSW are the
switch voltage and current changes, and tSW is the effective overlap time.
Diode dissipation is likewise11 PD = VF IF(avg) + fSWD, WD ∼= VR IFtRR,
where VR is the diode reverse voltage, IF the forward current at turn-off, and tRR the
reverse recovery time. Schottky diodes are good choices because of their inherently
lower voltage drop VF and the absence of charge-storage effects.
Capacitor loss is Pcap = ESRI 2
C(rms). Coil loss consists of two terms, namely,
the copper loss RcoilI 2
L(rms) in the coil resistance, and core losses, which depend
on the coil current as well as fS. Finally, the controller contributes VI IQ where IQ
is the average current it draws from VI , exclusive of the switch.
EXAMPLE 11.20. A buck converter with VI = 15 V, VO = 5 V, IO = 3 A, fS = 50 kHz,
and IQ = 10 mA, uses a switch with VSAT = 1 V and tSW = 100 ns, a diode with
VF = 0.7 V and tRR = 100 ns, a coil with Rcoil = 50 m and iL = 0.6 A, and a
capacitor with ESR = 100 m. Assuming core losses of 0.25 W, ﬁnd η and compare
with a linear regulator.
Solution.
Eq. (11.35) gives D = 38.8%. Then, PSW ∼= VSATDIO + 2 fSVI IOtSW =
1.16 + 0.45 = 1.61 W; PD ∼= VF(1 −D)IO + fSVI IOtRR = 1.29 + 0.22 = 1.51 W;
Pcap = ESR(iL/
√
12)2 = 3 mW; Pcoil = Rcoil × (iL/
√
12)2 + 0.25 W ∼= 0.25 W;
Pcontroller = 15 × 10 = 0.15 W; PO = 5 × 3 = 15 W; Pdiss = 3.52 W; η = 81%.
A linear regulator would have η = 5/15 = 33%, indicating that to deliver 15 W
of useful power it would dissipate 30 W, while the switching regulator of our example
dissipates only 3.52 W.
11.7
THE ERROR AMPLIFIER
As we know, the primary function of the error ampliﬁer (EA) in a switching regulator
is to accept a scaled version βVO of the output voltage, compare it against an internal
reference voltage VREF, and issue to the switch modulator whatever control voltage

575
SECTION 11.7
The Error
Ampliﬁer
R3
R1
a
C3
Vo
Vi
+
–
+
–
R2
C1
C2
a
+
–
Vo
Vi
ZA
ZB
⇒
+
–
FIGURE 11.36
AC equivalent of the Type 3 error ampliﬁer (EA).
vE A it takes to make βVO track VREF, or, equivalently, to make VO = VREF/β.
If there were no other delays around the control loop, a plain integrator would do,
provided we set its unity-gain frequency f0 well below the switching frequency fS
(say, f0 ∼= fS/10) to help ﬁlter out the switching noise. So, with a phase shift of
−180◦due to negative feedback, and an additional shift of −90◦due to the integrator,
we would have a phase margin of 360 −180 −90 = 90◦. But the loop of a switcher
includes also a capacitor and an inductor, whose tendency is to introduce additional
delays and thus erode the phase margin. This requires that the integrator’s response
in the vicinity of the crossover frequency be suitably shaped in order to ensure an
acceptable noise margin for the overall loop (for this reason, the EA is also called a
compensator).
EAs are categorized as Type 1, Type 2, and Type 3. As we will see, Type 1 is
a particular case of Type 2, which in turn is a particular case of Type 3, so let us
discuss Type 3, the most general type. Its popular embodiment of Fig. 11.36 uses an
op amp with an adequate GBP to provide the low-frequency gain necessary to make
VO = VREF/β, and the impedance pair Z A-Z B to establish the frequency proﬁle
necessary for an adequate phase margin. Though the transfer function can be derived
mathematically as
HEA( jω) = −Z B( jω)
Z A( jω) = −
(1 + jω/ωz1)(1 + jω/ωz2)
( jω/ω0)(1 + jω/ωp1)(1 + jω/ωp2)
(11.47)
(see Problem 11.37), we can gain far better insight if we examine the individual
impedances using physical inspection. This task is facilitated further by the fact that
EAs are implemented under the conditions
C2 ≫C1
R1 ≫R3
(11.48)
Consider ﬁrst Z B. At low frequencies, where the impedances of C1 and C2 have
much greater magnitude than R2, we can ignore R2 and write |Z B| →1/[ω(C1 +
C2)] ∼= 1/(ωC2), by Eq. (11.48). At high frequencies, where the capacitive
impedances are much smaller than R2, we can ignore C2 compared to R2, and
in turn ignore R2 compared to C1, so now |Z B| →1/(ωC1). The transition from
one asymptote to the other must occur over a region where Z B is ﬂat. In fact, this
is the intermediate-frequency region where Z B = R2. As depicted at the top of
Fig. 11.37, Z B exhibits a zero-pole frequency pair. These are the frequencies at
which 1/(ωz1C2) = R2 and 1/(ωp2C1) = R2.

576
CHAPTER 11
Voltage
References and
Regulators
|ZB| (dec)
R2
R1
(C1 + C2)
1
R2(C1 + C2)
1
(R1//R3)C3
R1//R3
1
R2C1
1
R1C3
1
C1
z1
z2
p1
p2
0
 (dec)
|ZA| (dec)
 (dec)
|ZB/ZA| (dB)
<) (ZB/ZA)
 (dec)
 (dec)
1
C3
1
−90°
90°
0°
FIGURE 11.37
Using the linearized Bode plots of the individual im-
pendaces of Fig. 11.36 to construct the magnitude and
phase plots of their ratio.
Applying similar reasoning to Z A, we can state that at low frequencies we have
Z A →R1 and at high frequencies we have Z A →R1//R3 ∼= R3, by Eq. (11.48).
The transition from one asymptote to the other must occur over a region of decreasing
Z A with ω. In fact, this is the intermediate-frequency region where |Z A| = 1/(ωC3).
As seen in Fig. 11.37, Z A exhibits a pole-zero frequency pair, which in turn is a
zero-pole pair for 1/Z A. These are the frequencies at which 1/(ωz2C3) = R1 and
1/(ωp1C3) = R3.
Having the logarithmic plots of |Z A| and |Z B| in hand, we construct the logarith-
mic plot of their ratio |Z B/Z A| as the difference between the individual logarithmic
values, multiplied by 20 to convert to decibels. Finally, using the phase-slope cor-
respondence of Eq. (8.9), we construct the phase plot shown at the bottom. It is
apparent that the EA exhibits integrator behavior both at low frequencies (where it
is designed to provide the high gain necessary to make VO = VREF/β), and at high

577
SECTION 11.8
Voltage Mode
Control
frequencies (where it is designed to provide the low-pass function needed to ﬁlter
out switching noise). At intermediate frequencies the response has been reshaped
through the creation of two zero frequencies, whose cumulative effect is to raise
phase from −90◦to +90◦! We can certainly use this phase lead to neutralize the
phase lag of two additional loop poles, or of an additional pole and a right-half-plane
zero, as we shall see below. In light of the above considerations, the characteristic
frequencies of the EA are
ωz1 ∼=
1
R2C2
ωz2 ∼=
1
R1C3
ωp1 ∼=
1
R3C3
ωp2 ∼=
1
R2C1
(11.49a)
Also relevant is the extrapolated unity-gain frequency ω0 of the low-frequency in-
tegrator segment,
ω0 =
1
R1(C1 + C2)
∼=
1
R1C2
(11.49b)
which is used as a scaling factor to shift the magnitude plot up or down without
affecting phase.
As mentioned, the Type 3 EA is the most general of the three types. Type 2 is
obtained from Type 3 simply by discarding R3 and C3 so that Z A = R1. In this
case the proﬁle of |Z B/Z A| is similar to that of |Z B|, indicating a phase boost of
only +90◦. Type 2 is used when the feedback loop includes only one additional
pole frequency, as in the case of peak current mode control for buck converters, to
be investigated in the next section. Finally, Type 1 EA is obtained from Type 3 by
discarding all components except for R1 and C1, thus reducing the EA to a plain
integrator. This type ﬁnds use in linear regulators. It ought to be pointed out that the
implementation of Fig. 11.38 is not unique (see Problem 11.38 for an alternative
implementation often proposed in the application notes). Also, the op amp used to
implement the EA must have an adequate GBP to avoid degrading the phase margin
too much (see Problem 11.41).
11.8
VOLTAGE MODE CONTROL
Voltage mode control (VMC), exempliﬁed in Fig. 11.38 for the buck topology,
synthesizestheswitchdrivebymodulatingasawtoothwavevST offrequency fS with
the voltage vE A produced by the error ampliﬁer (modulation is achieved by means
of the voltage comparator CMP along the lines already discussed in connection with
Fig. 9.18). The modulation waveforms are shown in Fig. 11.39. Note that in the
present converter rendition, typical of today’s CMOS technology, the catch diode
has been replaced by Mn, a low-channel resistance MOSFET designed to ensure an
even lower voltage drop than a Schottky diode. This is to reduce power losses and
thus improve efﬁciency. Note also that the catch FET Mn must be synchronized in
push-pull fashion with the switch proper Mp (hence, the name), and that it must be
driven in break-before-make fashion to avoid establishing a low-resistance path from
the source VI to ground (these functions are performed by the break-before-make
driver circuit, whose details are beyond our scope here). Note also the generalized
load model, consisting of a current sink IL D in parallel with a resistance RL D.

578
CHAPTER 11
Voltage
References and
Regulators
Mp
Mn
Rcoil
R2
R3
R1
R4
VREF
C2
C1
Ramp
generator
Clock
generator
Vp
fS
0
vST
C3
Rcap
vEA
ILD
RLD
VI
VO
L
C
vSW
Break-
before-
make
driver
DCR
ESR
+
–
CMP
+
–
a +
–
FIGURE 11.38
Synchronous buck converter using voltage mode control (VMC).
We now wish to investigate the stability of the circuit and design the EA for an
adequate phase margin. Central to this task is the loop gain T , which, by deﬁnition,
we ﬁnd by going around the loop as
T = −Vsw
Vea
× Vo
Vsw
× Vea
Vo
(11.50)
where Vsw, Vea, and Vo are the Laplace transforms of vSW , vE A, and vO. In the
absence of the inductor, the switch would produce the open-circuit, rail-to-rail
square wave vSW(oc) = DVI with the duty cycle D = vE A/Vp, or vSW(oc) =
(VI /Vp)vE A. Consequently, to simplify ac analysis, we apply Thévenin’s theorem
t
t
vEA, vST
vEA
vST
vSW
TS
tON
Vp
0
0
FIGURE 11.39
Voltage modulation in the buck converter of Fig. 11.38.

579
SECTION 11.8
Voltage Mode
Control
VI
Vp
Rsw
Rcoil
L
Vea
+
–
Rcap
Vo
RLD
ZA
C
FIGURE 11.40
AC equivalent of coil-capacitor structure of Fig. 11.38.
and use the equivalent of Fig. 11.40, where Rsw is the effective resistance presented
by the CMOS switch. (Note that the dc sink IL D does not appear in this ac equiva-
lent, and that Z A is terminated on the virtual ac ground presented by the inverting
input of the op amp.) It is left as an exercise (see Problem 11.39) to prove that, so
long as loading by RL D and Z A is negligible, we have
T ( jω) = VI
Vp
×
1 + jω/ωESR
1 −(ω/ωLC)2 + ( jω/ωLC)/Q
×
(1 + jω/ωz1)(1 + jω/ωz2)
( jω/ω0)(1 + jω/ωp1)(1 + jω/ωp2)
(11.51)
where
ωLC =
1
√
LC
ωESR =
1
RcapC
Q =
√L/C
Rsw + Rcoil + Rcap
(11.52)
Note that for ω ≪ωESR, the LC structure exhibits the familiar second-order
low-pass response HLP. However, at high frequencies, where C acts as a short
circuit compared to its own ESR, the structure turns into a ﬁrst-order LR circuit. The
borderline between the two cases is the frequency at which |ZC( jωESR)| = Rcoil.
Aptly referred to as left-half-plane zero (LHPZ) frequency, ωESR marks the point
where slope changes from −40 dB/dec to −20 dB/dec, and phase is on its way to
get boosted by +90◦.
EXAMPLE 11.21.
(a) Assuming VI = 10 V, Vp = 1 V, VREF = 1.282 V, and fS =
500 kHz for the buck converter of Fig. 11.38, specify suitable component values for
VO = 3.3 V and IO = 2.5 A, under the constraint of an output ripple not exceeding
10 mV. (b) Assuming Rsw = 40 m, calculate ωLC, Q, and ωESR. (c) Use PSpice to
display the Bode plots (magnitude and phase) of the transfer function from the source
at the left of Fig. 11.40 to the output node at the right.
Solution.
(a) Imposing 3.3 = (1 + R1/R4)1.282 gives R1/R4 = 1.57. Use R1 = 10.0 k and
R4 = 6.35 k. Imposing iL = 0.2IO = 0.2 × 2.5 = 0.5 A and using Eq. (11.41),
we get
L = 3.3(1 −3.3/10)
500 × 103 × 0.5 = 8.84 μH

580
CHAPTER 11
Voltage
References and
Regulators
Gain (dB)
Phase
106
105
104
103
−80
−60
−40
−20
0
20
40 mΩ
15 mΩ
15 mΩ
10 μH
40 μF
O
Phase
Frequency f (Hz)
0
(a)
(b)
0°
−40°
−80°
−120°
−160°
−200°
RSW
Rcoil
L
Rcap
C
Vo
I
Vtest
+
–
Magnitude
FIGURE 11.41
(a) PSpice circuit to generate (b) the Bode plots of the coil-capacitor ﬁlter.
Use L = 10 μH, rated to withstand an average current of IL = 2.5 A and a peak
current of Ip = IL + iL/2 = 2.5 + 0.5/2 = 2.75 A. Use a 10-μH coil having a
DCR of 15 m. Assuming (1/3) of the output ripple vO(≤10 mV) is due to C,
use Eq. (11.44a) to calculate
C =
0.5
8 × 500 × 103 × (1/3)10 × 10−3 = 37.5 μF
Use C = 40 μF. Assuming the remainder (2/3) of vO(= 6.7 mV) is due to
the ESR, estimate Rcap = (6.7 mV)/(0.5 A) = 13.3 m. Use a 40-μF capacitor
having an ESR of 15 m.
(b) Using Eq. (11.52), we get
fLC =
1/(2π)
√10 × 40 × 10−6 = 8.0 kHz
fESR =
1/(2π)
15 × 10−3 × 40 × 10−6 = 265 kHz
Q =
√10/40
(40 + 15 + 15)10−3 = 7.14(= 17 dB)
(c) Using the PSpice circuit of Fig. 11.41a, we get the plots of Fig. 11.41b, showing
the effect of the LHPZ.
Error Ampliﬁer Design
As seen above, the LC structure introduces a pole pair inside the loop, along with
a zero due to the capacitor’s ESR. The pole pair yields a phase shift of −180◦,
and the zero a phase shift of +90◦. Depending on the location of the crossover
frequency relative to the above LC pole pair and the ESR zero, we may need a
Type 3 or, at best, a Type 2 compensator. The strategy for placing the compensator’s
characteristic frequencies is not unique (in fact, different application notes provide
somewhat differing rules that may easily confuse the neophyte). Nevertheless, we
can say that (a) the crossover frequency ωx is placed typically a decade or so below
the switching frequency ωS, or ωx ∼= ωS/10, (b) the zero frequencies ωz1 and ωz2
are placed in the vicinity of ωLC to make their combined phase lead combat the phase
lag due to the LC pole pair, and (c) the pole frequencies ωp1 and ωp2 are placed near

581
SECTION 11.8
Voltage Mode
Control
ωS. If ωESR happens to be sufﬁciently close to ωLC, then ωp1 can be placed right
at ωESR to get a pole-zero cancellation so we can use just a Type 2 compensator.
EXAMPLE 11.22.
(a) Design an EA for the regulator of Example 11.21 under the
following constraints: fx = fS/10, fz1 = fz2 = fLC, and f p1 = f p2 = 4 fx. (b) Use
PSpice to generate the Bode plots of the loop gain and measure the phase margin. (c) Use
PSpice to show the regulator response to a 1-A load-current step.
Solution.
(a) We have fx = fS/10 = 500/10 = 50 kHz, fz1 = fz2 = fLC = 8 kHz, f p1 =
f p2 = 4 fx = 200 kHz. To ﬁnd the required f0, impose |T ( j fx)| = 1 in Eq. (11.51),
1 = 10
1 ×

1 + (50/265)2

1 −(50/8)22 + [(50/8)/7.14]2 ×
1
50/f0
×
1 + (50/8)2
1 + (50/200)2
This gives f0 = 5.0 kHz. Starting out with R1 = 10 k, turn around Eqs. (11.49a)
and (11.49b) and calculate
C2 =
1
ω0R1
=
1
2π5 × 103 × 104 = 3.2 nF
R2 =
1
ωz1C2
=
1
2π8 × 103 × 3.2 × 10−9 = 6.2 k
C3 =
1
ωz2R1
=
1
2π8 × 103 × 104 = 2.0 nF
R3 =
1
ωp1C3
=
1
2π200 × 103 × 2 × 10−9 = 0.4 k
C1 =
1
ωp2R2
=
1
2π200 × 103 × 6.2 × 103 = 128 pF
(b) Whether simulating the circuit via PSpice or testing it in the lab, use the injection
technique of Section 8.2 to measure the loop gain. The PSpice circuit of Fig. 11.42
uses the VCVS EOA to simulate an op amp with a gain of 80dB, and the VCVS
Emod to simulate the modulator gain VI/Vp = 10 V/V. Since this source presents
inﬁnite input resistance, breaking the loop immediately upstream of it will require
just one voltage-type injection. The loop gain is then T = −Vr/V f . The result of the
simulation, shown in Fig. 11.43a, reveals a crossover frequency of fx = 49.8 kHz,
where  T = −123.4◦, so the phase margin is φm = 180 −123.4 = 56.6◦.
(c) For the step response we use the same circuit, but with a step current out of the
output node. The result, shown in Fig. 11.43b, consists of an initial abrupt drop of
15 mV due to the 1-A current ﬂowing initially out of Rcap. Afterward, the loop takes
over, causing a bit of overshoot, as shown. Regardless of the root placement chosen
for the EA, the calculated component values should be taken only as a starting point.
A careful engineer will observe the step response experimentally, and ﬁne-tune the
EA in order to optimize the transient response for the particular application at hand.
Before concluding, we wish to point out that the above discussion assumes VI
to be a relatively constant voltage for the buck regulator to scale down to the desired
value of VO. Should VI be widely variable, the ratio VI /Vp will also vary, causing
|T | to move up or down. This, in turn, will move fx up or down the frequency
spectrum, upsetting the phase margin of the circuit. Modern regulators avoid this
drawback by making Vp track VI and thus maintain a stable VI /Vp ratio.

582
CHAPTER 11
Voltage
References and
Regulators
0
10 V/V
10 kV/V
1.282 V
Emod
+
–
+
–
0
0
+
+
–
–
+
–
C2
R2
VREF
3.2 nF
6.2 kΩ
6.35 kΩ
10 kΩ
128 pF
EOA
0
R3
2 nF
0.4 kΩ
40 μF
10 μH
15 mΩ
40 mΩ
15 mΩ
Rcoil
RSW
Rcap
C
O
L
0
R4
R1
Vt
Vr
R
Vf
F
+
–
C1
C3
FIGURE 11.42
PSpice circuit to plot the loop gain of the buck regulator of Example 11.22.
104
105
103
106
−40
0
50
0
100
Time (µs)
Frequency f (Hz)
(b)
(a)
Gain (dB)
Phase
vO
200
3.24 V
3.28 V
3.32 V
|T|
<) T
0°
−150°
−120°
−180°
−90°
−60°
−30°
FIGURE 11.43
(a) Loop gain for the buck regulator of Fig. 11.42, and (b) its response to a 1-A output
current step.
11.9
PEAK CURRENT MODE CONTROL
The aim of current mode control (CMC) is to drive the inductor on a cycle-by-cycle
basis so as to force it to act as a voltage-controlled current source (VCCS). Two
important advantages accrue from this form of control: (a) by intervening on the

583
SECTION 11.9
Peak Current
Mode Control
Mp
Mn
VI
vSW
Break-
before-
make
driver
Rcoil
L
Rsense
DCR
ai
+
–
EA
–
+
Clock
generator
Ramp
generator
RLD
b VO
ILD
Rcap
VREF
vEA – vRAMP
RiiL
fS
vRAMP
Vp
0
vEA
fS
IO
VO
ESR
C
R2
R1
+
–
iL
+
–
CMP
– +
Q
R
S
FIGURE 11.44
Buck converter with peak current mode control (PCMC).
inductor current directly, without waiting for the loop delay of voltage mode control
(VMC), we are effectively removing the inductor delay from the loop, thus making
loop compensation easier; (b) direct cycle-by-cycle current control makes it easier
to protect the inductor against excessive current buildup in case of malfunction.
PCMC for the Buck Converter
In order to control iL we need to sense it. In the buck converter of Fig. 11.44, iL
is sensed via a small (few tens of m) series resistor Rsense, whose voltage drop is
then magniﬁed by an ampliﬁer with gain ai to convert iL to the voltage RiiL, where
Ri = ai × Rsense
(11.53)
is the overall gain of the current-to-voltage conversion, in V/A, or ohms. This voltage
is then fed to the noninverting input of the voltage comparator CMP. (Other forms
of current sensing are in use, such as utilizing the channel resistance of Mp as the
sensing resistor, or by inferring the voltage drop across Rcoil via a suitable network
across the entire coil.) Current sensing comes with a notorious drawback, namely,
the fact that Rsense must of necessity be kept small to limit power dissipation for the
sake of efﬁciency makes current sensing much more sensitive to noise than voltage
mode control, where the duty cycle is created via a much heftier sawtooth wave.
The most common form of current control is the peak current mode control
(PCMC) depicted in Fig. 11.45. A cycle initiates when a clock pulse of frequency
fS and period TS = 1/fS sets the ﬂip-ﬂop. This turns on Mp, causing iL to ramp
up with a slope of
Sn = VI −VO
L
(11.54a)

584
CHAPTER 11
Voltage
References and
Regulators
Clock
TS (= 1/fS)
Mp = ON
Mn = OFF
Mp = OFF
Mn = ON
Q
0
iL(pk)
iL
Sn
DTS
(1 – D)TS
Sf
FIGURE 11.45
Timing of PCM control for the buck converter.
During this time, the energy wL = (1/2)Li2
L builds up in the inductor. Once iL
reachesapeakvalueiL(pk)establishedbytheerrorampliﬁer,thevoltage RiiL catches
up with vE A, causing the comparator to ﬁre and reset the ﬂip-ﬂop. This turns off
Mp while turning on Mn, in a break-before-make fashion to avoid simultaneous
conduction. At this instant the magnetic ﬁeld inside the inductor starts to collapse,
so for the rest of the cycle iL will ramp down with a slope of
S f = −VO
L
(11.54b)
By the end of the cycle an energy packet will have been transferred from the inductor
to the capacitor-load combination.
As the capacitor continues to receive energy packets, its voltage will build
up until, after a sufﬁcient number of cycles, an equilibrium condition is reached,
aptly referred to as steady state, whereby the average capacitor voltage VC will no
longer increase (though its instantaneous value vC will continue to alternate around
this average value). Consequently, the capacitor current must average to zero, a
condition referred to as the capacitor amp-second balance. With IC = 0, we have,
by KCL, IO = IL. In steady state the inductor satisﬁes the dual condition known as
the inductor volt-second balance, whereby its voltage averages to zero (though its
instantaneous value vL will continue to alternate around this average value).
Should a change in the line voltage VI intervene, the buck converter reacts by
adjusting the duty cycle D so as to keep VO at the prescribed value. Likewise, should
a change in the load current IO intervene, the converter adjusts D so as to move the
average inductor current IL up or down until the condition IL = IO is met. Clearly,
we expect the converter to exhibit a good line and load regulation.
We wish to visualize a cycle in terms of the EA output vE A. First, assume
vRAMP = 0 in Fig. 11.44 (this is referred to as operation without slope compensation,
to be discussed shortly), so that CMP ﬁres when RiiL catches up with vE A, or,

585
SECTION 11.9
Peak Current
Mode Control
0
0
(a)
IL
iL
iEA
iL
L
VI (15 V)
VO (5 V)
Sn
TS
DTS
Sf
0
0
(b)
IL
iL
iEA
Sn
TS
DTS
Sf
D = 
 =  
5
15
1
3
Sn = 
 =  
15 − 5
L
10
L
Sf = − 5
L
iL
L
VI (7.5 V)
VO (5 V)
D = 
 =  
5
7.5
2
3
Sn = 
 =  
7.5 − 5
L
2.5
L
Sf = − 5
L
FIGURE 11.46
Without slope compensation, the average current IL is strongly dependent on VI.
equivalently, when iL reaches the value vE A/Ri. Denoting this value as
iE A = vE A
Ri
(11.55)
allows us to visualize a cycle exclusively in terms of currents as in Fig. 11.46 (for
simplicity, the cycle is assumed to start at t = 0). This ﬁgure reveals the ﬁrst of two
possible ﬂaws of uncompensated PCMC: the fact that if we lower/raise VI while vEA
hasn’t had time to change appreciably, the average inductor current IL will raise/drop
accordingly. This is so because the downslope S f (= −VO/L) remains constant, so
the upslope Sn must change to accommodate the change in VI , and this in turn shifts
IL up or down. Since IO = IL, we have a case of very poor line regulation!
The second ﬂaw is a form of instability known as subharmonic oscillation,
which arises when D > 0.5 and the regulator is operating in the continuous mode,
whereby iL does not have time to drop to zero within a normal operating cycle.
Refer to Fig. 11.47, which shows how an inductor current perturbation il(0) at the
beginning of a cycle (such a perturbation might be due, for instance, to a misﬁring
of the comparator in the course of the previous cycle) evolves into the perturbation
il(TS) at the end of the cycle. Using simple geometry, we can write il(0)/t = Sn
and il(TS)/t = S f . Eliminating t gives
il(Ts)
il(0) = S f
Sn
=
−D
1 −D
(11.56)
indicating that (a) the polarity of il(TS) is opposite to that of il(0), and (b) for
D < 0.5 its magnitude will decrease (and die out after a sufﬁcient number of
cycles), but for D > 0.5 it will tend to increase from one cycle to the next, leading
to the aforementioned subharmonic instability.

586
CHAPTER 11
Voltage
References and
Regulators
0
0
Δt
il(0)
iEA
Sn
TS
DTS
il(TS)
Sf
FIGURE 11.47
Illustrating subharmonic oscillation for D > 0.5.
Slope Compensation
Looking back at Fig. 11.46b, it seems that if we want it to retain the same IL of
Fig. 11.46a, we need to suitably “push down” its waveforms. We achieve this by
suitably lowering iL(pk), a task in turn requiring that we suitably lower the value of
iE A responsible for tripping the comparator at DTS. In fact, one can extend this line
of reasoning over the entire range 0 < D < 1, and use simple graphical techniques to
ﬁgure that the locus of iE A values needed to maintain IL constant is itself a ramp!
This locus, denoted as iE A(comp) in Fig. 11.48, has a slope of −S f /2 = −VO/(2L).
The circuit of Fig. 11.44 synthesizes this locus by starting out with a voltage ramp
vRAMP,whichitthensubtractsfromvE A toproducethecontrolvoltagevE A−vRAMP.
ΔiL/2
IL
iEA
iEA(comp)
iL
IL
Sf /2
Sn
Sf
0
0
(a)
(b)
TS
DTS
ΔiL/2
iEA
iEA(comp)
Sf /2
Sf
0
0
TS
DTS
ΔiL/2
ΔiL/2
FIGURE 11.48
Showing how slope compensation maintains the same average current IL regardless of vari-
ations in VI and, hence, in D.

587
SECTION 11.9
Peak Current
Mode Control
0
0
TS
DTS
iEA(comp)
Sf /2
Sf
Sn
il(0)
il(TS)
IL
FIGURE 11.49
Slope compensation eliminates subharmonic oscilla-
tion regardless of D.
With this modiﬁcation, aptly called slope compensation, Eq. (11.55) changes to
iE A(comp) = vEA −vRAMP
Ri
(11.57)
Comparison of Fig. 11.48 against Fig. 11.46 conﬁrms the constancy of IL in spite
of the decrease in VI and, hence, the increase in D as we go from (a) to (b).
But, there is more, because slope compensation also eliminates subharmonic
oscillation, as depicted in Fig. 11.49. Using again graphical means, we observe that
a beginning-of-cycle disturbance il(0) will result in an end-of-cycle disturbance
il(TS) of lesser magnitude, even though D > 0.5 (in fact, you can convince yourself
that this holds also for the case D < 0.5 of Fig. 11.48a). Needless to say, slope
compensation is a genial idea!
At this juncture it is worth pointing out that the slope compensation scheme of
Fig. 11.44 is not unique. The frequently used alternative of Fig. 11.50 adds vRAMP to
RiiL (instead of subtracting it from vEA). The result, depicted in Fig. 11.51, is that
now both slopes are augmented by the amount Se = −S f /2 = VO/(2L), Se > 0,
so the upslope is now steeper, and the downslope is ﬂatter (from the viewpoint of the
comparator, raising the iL waveform as in Fig. 11.51 has the same effect as lowering
the iE A waveform as in Fig. 11.48).
The Control-to-Output Transfer Function
The ac analysis of a PCMC converter is rather complex because of the presence of
two loops (an inner current loop to drive the inductor and an outer voltage loop to
maintain voltage regulation). Moreover, since the inductor current is being sampled
at each cycle, a rigorous analysis requires sampled-data theory.13 Sufﬁce it to say
here that the control-to-output transfer function for the buck of Fig. 11.50 takes on
the form14,15
H( jω) = Vo
Vea
= H0
1 + jω/ωESR
(1 + jω/ωp)
1 −(ω/0.5ωS)2 + ( jω/0.5ωS)/Q

(11.58)

588
CHAPTER 11
Voltage
References and
Regulators
Mp
Mn
VI
vSW
Break-
before-
make
driver
Rcoil
L
Rsense
DCR
ai
+
–
EA
–
+
Clock
generator
Ramp
generator
RLD
b VO
ILD
Rcap
VREF
vEA
RiiL + vRAMP
RiiL
fS
vRAMP
Vp
0
fS
IO
VO
ESR
C
R2
R1
+
–
iL
+
–
CMP
+ +
Q
R
S
FIGURE 11.50
Alternative implementation of slope compensation, whereby vRAMP is added to RiiL
(rather than subtracted from vE A).
Sn + Se
Sn
Sf  + Se
Sf
iL + iRAMP
iEA
IL
iL
iRAMP
TS
TS
DTS
DTS
0
0
0
0
Se
FIGURE 11.51
Waveforms for the alternative buck converter of Fig. 11.50.

589
SECTION 11.9
Peak Current
Mode Control
where H0 is the dc gain, ωp is the dominant pole frequency established by the
capacitor C, ωESR is the zero frequency due to the capacitor’s ESR, and the second-
order denominator term stems from the current sampling process at frequency ωS.
The following expressions15,16 hold:
H0 =
KM RL D
RL D + RSW + Rcoil + Rsense + KM Ri
ωp =
1
[RL D∥(KM Ri)]C
ωESR =
1
RcapC
(11.59)
where RL D is the resistive component of the load and KM is a dimensionless factor
KM =
1
(0.5 −D)Ri
fSL
+ Vp
VI
(11.60)
and Vp is the peak amplitude of the compensation ramp. The Q-factor associated
with the sampling process is13
Q =
1/π
(1 + Se/Sn) × (1 −D) −0.5
(11.61)
Note that in the absence of slope compensation (Sn = 0) and in the limit D →0.5 we
get Q →∞.Thisexplainsthesystem’sabilitytosustainasubharmonicoscillationat
half the sampling frequency, or 0.5 fS. For D > 0.5, Q becomes negative, indicating
agrowingoscillation.Wenowappreciatetheneedforslopecompensation(Se > 0)to
avoid such instabilities. Beside the aforementioned choice of Se = −S f /2, another
frequently used option is Se = −S f = VO/L. With the latter option a disturbance
il will get killed within a single cycle. Also referred to as deadbeat condition, this
option gives, for D = 0.5, Q = 2/π = 0.637, which corresponds to a critically
damped system.14,15 Let us turn to an actual example to get a feel for the various
parameters involved.
EXAMPLE 11.23.
Let the buck converter of Fig. 11.50 have VI = 12 V, VO = 5 V,
IO = 4 A, fS = 500 kHz, Vp = 0.1 V, Rsense = 20 m, ai = 10 V/V, L = 10 μH,
C = 40 μF, RSW = Rcoil = Rcap = 10 m. (a) Calculate all relevant parameters for
the case of a purely resistive load RL D = VO/IO, which is typically the case when the
regulator is tested in the lab. (b) Repeat, but for the opposite extreme of RL D →∞,
so IO = IL D (a real-life load is likely to fall somewhere between these extremes).
(c) Visualize the two frequency responses via PSpice, compare, and comment.
Solution.
Using the above equations, calculate ﬁrst the load-independent parameters:
Ri = 10 × 20 × 10−3 = 0.2 
D = 5/12 = 0.4167
Sn = (12 −5)/(10 × 10−6) = 0.7 A/μs
S f = −5/(10 × 10−6) = −0.5A/μs
Se = −S f /2 = 0.25 A/μs
Q =
1/π
(1 + 0.25/0.7) × (1 −0.4167) −0.5 = 1.09
K M =
1
(0.5 −0.4167)0.2
500 × 103 × 10 × 10−6 + 0.1
12
= 85.7
0.5 fS = 250 kHz
fESR =
1/(2π)
0.01 × 40 × 10−6 = 398 kHz

590
CHAPTER 11
Voltage
References and
Regulators
(a) For the case of a purely resistive load, RL D = VO/IO = 1.25 , we have
H0 =
85.7 × 1.25
1.25 + 3 × 0.01 + 0.02 + 85.7 × 0.2 = 5.82
f p =
1/(2π)
[1.25∥(85.7 × 0.2)]40 × 10−6 = 3.42 kHz
Consequently,
H(RL D = 1.25 ) = 5.82
1 +
j f
398 kHz

1 +
j f
3.42 kHz
	
1 −

f
250 kHz
2
+
j f
250 kHz
1
1.09

(b) For the case of a purely current-sink load IL D = IO in Fig. 11.50, we recalculate
lim
RL D→∞H0 = KM = 85.7
lim
RL D→∞f p =
1
2π(KM Ri)C = 0.232 kHz
so now
H(RL D →∞) = 85.7
1 +
j f
398 kHz

1 +
j f
0.232 kHz
	
1 −

f
250 kHz
2
+
j f
250 kHz
1
1.09

(c) Using PSpice’s Laplace blocks, we readily generate the plots of Fig. 11.52. The plots
show the dominant pole, which is highest when RL D is lowest, along with a slight
amount of resonance (Q ∼= 1) at half the clock frequency. Moreover, because of the
zero frequency at fESR, the hig-frequency phase asymptote is (−1 −2 + 1) × 90 =
−180◦.
10
102
103
104
105
106
−40
−20
20
0
40
Gain (dB)
10
102
103
104
105
106
–180°
–90°
0°
Phase
Frequency f (Hz)
RD 5 
RD 5 1.25 Ω
RD 5 1.25 Ω
RD 5 
FIGURE 11.52
Bode plots of the control-to-output transfer
function of the buck converter of Example 11.23
for the limiting cases RD = VO/IO = 1.25 
and RD →∞.

591
SECTION 11.9
Peak Current
Mode Control
Simpliﬁed AC Equivalent
We now wish to develop an intuitive feel for the control-to-output transfer function.
So long as we use the proper amount of slope compensation and a low-ESR capacitor,
for f well below 0.5 fS and fESR we can approximate Eq. (11.58) as
H( j f ) = Vo
Vea
∼= H0
1
(1 + j f/f p)
(11.62)
A well-designed converter will have RSW + Rcoil + Rsense ≪RL D + KM Ri, so
Eq. (11.59) yields the simpler and more insightful expressions
H0 ∼=
KM RL D
RL D + KM Ri
= RL D∥(KM Ri)
Ri
f p =
1
2π[RL D∥(KM Ri)]C
(11.63)
We now draw two important conclusions: (a) above f p, yet well below both 0.5 fS
and fESR, the control-to-output transfer function exhibits a constant gain-bandwidth
product of
GBP = H0 × f p =
1
2π RiC
(11.64)
and (b) for f ≪0.5 fS the inductor behaves like a VCCS with transconductance
gain 1/Ri and parallel resistance KM Ri. This results in the dramatic simpliﬁcation
of Fig. 11.53, which we expect to make the design of the compensator easier.
Inductor equivalent
KMRi
RLD
R1
R2
Vo
 C
+
–
Vea
Vea
Ri
Vo
–
+
+
–
Ve
EA
FIGURE 11.53
Simpliﬁed ac equivalent of the PCMC buck converter for f ≪0.5 fS and
f ≪fESR.
Error Ampliﬁer Design
With the inductor delay removed from the loop, a Type 2 compensator will sufﬁce.
Monolithic converters usually implement the EA with an operational transconduc-
tance ampliﬁer (OTA) terminated on an impedance designed to provide a Type 2
frequency proﬁle. In Fig. 11.54 the OTA is modeled via a VCCS with transconduc-
tance gain Gm (typically on the order of 1 mA/V), output resistance Ro (typically
on the order of 1 M), and stray output-node capacitance Co (typically in the range
of a few pico-farads). The external components Rc and Cc establish the LHP zero
frequency needed to boost the loop phase in the vicinity of the crossover frequency
fx, while CHFP combines with Co to establish a high-frequency pole needed to ﬁlter
out high-frequency noise.

592
CHAPTER 11
Voltage
References and
Regulators
OTA
GmVe
Ro
Vea
Co
Ve
+
–
+
–
Ve
Cc
Rc
CHFP
FIGURE 11.54
Using an OTA to implement a Type 2 error ampliﬁer. The circuit
is usually designed with Rc ≪Ro and Cc ≫(Co + CHFP).
Using physical inspection as in connection with Fig. 11.37, we readily construct
the linearized Bode plot of Fig. 11.55, where
ωp1 ∼=
1
RoCc
ωz1 ∼=
1
RcCc
ωp2 ∼=
1
Rc(Co + CHFP)
(11.65)
Note that Rc serves the dual purpose of establishing the zero frequency fz1 and the
intermediate-frequency gain Gm Rc. Once Gm is known, the values of Rc, Cc, and
CHFP are uniquely determined by our choice of the crossover frequency as well as
ωHFP. A common strategy16 is to make the ﬁrst zero-pole pair of the compensator
coincide with the ﬁrst pole-zero pair of the control-to-output transfer function so as
to attain a loop-gain rolloff of −20 dB/dec for a phase margin of about 90◦. But, if
necessary, the compensator can be suitably tweaked when the converter is tested in
the lab.
EXAMPLE 11.24. Design an EA to stabilize the converter of Example 11.23 for the case
RL D = VO/IO = 1.25 . Assume VREF = 1.205 V, Gm = 0.8 mA/V, Ro = 1 M, and
Co = 10 pF. Verify with PSpice.
Solution.
With reference to Fig. 11.44 we have β = VREF/VO = 1.205/5 = 1/4.15,
so 1 + R2/R1 = 4.15. Pick R1 = 10 k and R2 = 31.5 k. Let us place the crossover
0
GmRo
GmRc
 (dec)
p1 
z1 
p2 
Vea/V  dB
FIGURE 11.55
Linearized gain plot of the EA of Fig. 11.54.

593
SECTION 11.9
Peak Current
Mode Control
frequency at fx = fS/10 = 500/10 = 50 kHz, where we have
|H( j fx)| = GBP
fx
= 1/(2π RiC)
fx
= 1/(2π × 0.2 × 40 × 10−6)
50 × 103
=
1
2.51
To produce |T ( j fx)| = 1, the EA’s gain at fx must make up for the combined attenuations
due to β and |H( j fx)|. Since fx is going to lie between fz1 and f p2, where the EA gain
is ﬂat, we impose
Gm Rc = 4.15 × 2.51 = 10.4 V/V
and get Rc = 10.4/(0.8×10−3) = 13 k. Next, impose fz1 = f p for the ﬁrst zero-pole
cancellation,
1
2π × 13 × 103 × Cc
= 3.42 × 103
and get Cc ∼= 3.6 nF. Finally, impose f p2 = fESR for the second pole-zero cancellation,
1
2π × 13 × 103 × (Co + CHFP) = 398 × 103
13 kΩ
31.5 kΩ
10 kΩ
R2
R1
R
F
LAPLACE {v(EA,0)} = {5.82*(1+s/(6.3*300e3))/
((1+s/(6.3*3.42e3))*(1+(s/(6.3*250e3))**2+s/(6.3*250e3*1.09)))}
Vr
Vf
Vt
CHFP
EA
21 pF
3.6 nF
0
Cc
Co
10 pF
Ro
1 MΩ
Rc
Gm
0.8 mA/V
+
–
–
+
IN+
IN−
OUT+
OUT−
EH
0
0
Gain (dB)
102
103
104
105
106
−40
−20
0
20
40
60
10
Phase
−270°
−180°
−90°
0°
|T|
Frequency f (Hz)
<) T
FIGURE 11.56
PSpice simulation of the buck converter of Example 11.24.

594
CHAPTER 11
Voltage
References and
Regulators
Substituting Co = 10 pF gives CHFP ∼= 21 pF. Finally, we use the voltage injection
technique depicted in Fig. 11.56 to plot the loop gain (note the constant rolloff of
−20 dB/dec, as expected). The crossover frequency is fx = 50.1 kHz, where  T =
−98.4◦. Consequently, φm = 180 −98.4 = 81.6◦.
11.10
PCMC OF BOOST CONVERTERS
Figure 11.57 shows the peak current mode control (PCMC) for the boost topology.
As depicted in the timing diagram of Fig. 11.58, a cycle initiates when a clock pulse
sets the ﬂip-ﬂop. This turns on the switch M, causing iL to ramp up with a slope of
Sn = VI /L. Note that during this part of the cycle the diode is cut off, so the load
is feeding entirely off the capacitor.
Once iL reaches a peak value established by the error ampliﬁer EA according to
the slope compensation mechanism, the comparator ﬁres, resetting the ﬂip-ﬂop and
turning off the switch M. At this point the magnetic ﬁeld inside the inductor starts
to collapse, so vL changes polarity and increases in magnitude until it turns on the
Schottky diode. Assuming the diode drops zero voltage for simplicity, we can say
that the voltage across the inductance is now vL = VI −VO, vL < 0, so iL ramps
down with a slope of S f = (VI −VO)/L.
Initially, following power turn-on, the value ofiL at the end of each cycle exceeds
that at the beginning of the cycle in order to build up enough average current in the
inductor to satisfy the current demanded by the load. After a sufﬁcient number of
ai
+
–
Rsense
Rcoil
DCR
VI
+
CMP
EA
–
–
+
Clock
generator
Ramp
generator
RLD
b VO
ILD
iD
Rcap
RiiL
VREF
vEA – vRAMP
vRAMP
VP
0
vEA
fS
D
L
M
IO
VO
S Q
R
ESR
C
R2
R1
+
–
iL
– +
FIGURE 11.57
Boost converter with peak current mode control (PCMC).

595
SECTION 11.10
PCMC of Boost
Converters
vL
Sf /2
Sn
Sf
TS(=1/fS)
VI
VI  − VO
iEA(comp)
M = OFF
D = ON
M = ON
D = OFF
Clock
DTS
(1 − D)TS
iL
Q
0
0
FIGURE 11.58
Timing of PCM control for the buck converter.
cycles, a steady-state condition is reached, whereby the end-of-cycle value of iL
will equal the beginning-of-cycle value. Alternatively, we invoke the inductance
volt-second balance condition by saying that in steady state vL must average to zero,
though it continues to alternate between VI and VI −VO, as shown. As discussed
in Section 11.6, a boost converter gives
VO =
1
1 −D VI
IL =
1
1 −D IO
(11.66)
The Right-Half-Plane Zero (RHPZ)
As mentioned, during the ﬁrst part of the cycle, when the diode is off, the load is
feeding entirely off the capacitor (this is in marked contrast with the buck converter,
where the capacitor/load combination receives current via the inductor during the
entire cycle). We shall now demonstrate that this feature tends to pose stability issues.
Consider ﬁrst the equilibrium situation of Fig. 11.59a. By the capacitance ampere-
second balance condition, the capacitance current in Fig. 11.57 must average zero, so
by KCL the average current IO delivered to the load must equal the average current
ID supplied via the diode, or
IO = ID
(11.67)

596
CHAPTER 11
Voltage
References and
Regulators
0
0
ID
VI
Sn
Sf
iD
DTS
TS
vL
VI  − VO
0
0
(a)
(b)
Sf /2
iea
iEA(comp)
0
0
IO
VI
iD
DTS
TS
vL
VI  − VO
0
0
dTS
dTS
io
FIGURE 11.59
Investigating the physical origin of the right-half-plane zero (RHPZ).
(You can visualize ID as the area under the iD waveform, divided by TS.) Now
suppose that in response to a jump in the current demand by the load, the EA raises
its output voltage vEA by an amount vea. This, in turn, up-shifts the waveform
iE A(comp) by the amount
iea = vea
Ri
As depicted in Fig. 11.59b, this upshift delays the ﬂip-ﬂop resetting by dTS. This
delay, while desirable because it allows for more energy to build up in the inductor
in response to the jump in the load demand, is also unwelcome because it reduces
the conduction time of the diode. Since ID is the area under the iD waveform
divided by TS, a reduced conduction time implies a drop in ID and, hence, a drop
io in the average current IO(= ID) passed on to the load. In summary, instead
of opposing the load disturbance, the circuit reinforces it (at least initially), as if
negative feedback had turned positive! Mathematically, this phenomenon is at the
basis of the much-dreaded right-half-plane zero (RHPZ) of boost-type converters
operating in the continuous conduction mode.

597
SECTION 11.10
PCMC of Boost
Converters
For a mathematical analysis of the RHPZ, start out with the equilibrium situation
of Fig. 11.59a, for which we have, by the deﬁnition of average,
VL = DTSVI
TS
+ (1 −D)TS(VI −VO)
TS
= VI −VO(1 −D)
Though VL = 0 in equilibrium, VL will increase from 0 to 0 + vl if the duty
cycle is increased from D to D + d as in Fig. 11.59b. So long as VI and VO
don’t change appreciably from one cycle to the next, the above expression gives
vl = 0 −VO(0 −d), or
vl = VOd
Similarly, the condition IO = (1 −D)IL of Eq. (11.66) holds in equilibrium, but as
we raise the duty cycle to D + d, it changes as
IO + io = [1 −(D + d)] × (IL + il) = (1 −D)IL + (1 −D)il −ILd + ild
∼= IO + (1 −D)il −ILd
where the product of small terms il × d has been ignored. Clearly we have
io ∼= (1 −D)il −ILd
Substituting il = vl/(sL) = VOd/(sL) and collecting gives
io =
(1 −D)VO
sL
−IL
	
d
It is apparent that io vanishes for s = (1 −D)VO/(LIL), s > 0, indicating a zero
in the right half of the complex plane. Letting IL = IO/(1 −D), we express the
RHPZ in the more common form
ωRHPZ = (1 −D)2VO
IO L
(11.68)
As we shall see shortly, this root results in a numerator term of the type (1 −jω/
ωRHPZ) in the control-to-output transfer function Vo/Vea. Subjecting the system to a
step change in vea will elicit, at least initially, a responseio in the opposite direction of
the intended value. This, because the term −jω/ωRHPZ prevails at high frequencies,
which is where the energy of the step’s leading edge is concentrated. However, if we
allow vea to change at a suitably slow rate so as to render −jω/ωRHPZ negligible
compared to unity, the system will respond in the intended direction almost right
from the beginning.
Let us illustrate the above concepts via a more familiar circuit such as that of
Fig. 11.60a. For R2 = 0 the circuit is a single-pole RC network with the op amp
acting as a buffer (R1 plays no role in this case), so the step response is the familiar
exponential transient depicted as a thin trace in Fig. 11.60b (top). However, with
R2 ̸= 0, the circuit exhibits also an RHPZ (see Problem 11.48), so its step response
starts out with a 0.5-V swing in the opposite direction, though eventually it will settle
to +1V as intended (can you justify this physically in terms of capacitor and op amp
behavior?). If, instead of an abrupt step, we apply a gradual ramp as in Fig. 11.60b
(bottom), the capacitor will be given more time to charge up, resulting in a less
pronounced opposing swing. In terms of the converter’s control-to-output transfer

598
CHAPTER 11
Voltage
References and
Regulators
(a)
R1
R2
vO
+
–
C
5 kΩ
10 kΩ
R
1 kΩ
vI
0
0
+
–
1 µF
(b)
0
2
3
5
1
4
−0.5
0
0.5
1
Time (ms)
vO
vI
vI, vO (V)
0
2
3
5
1
4
−0.5
0
0.5
1
vO
vI
vI, vO (V)
FIGURE 11.60
(a) Circuit with a LHP pole and a RHP zero, and (b) its step response (top) and ramp
response (bottom). The thin traces refer to the case R2 = 0.
function, this means that we can avoid the destabilizing tendency of the RHPZ by
making sure that the loop gain T at ωRHPZ has dropped to a suitably small value.
Equivalently, this requires placing the crossover frequency well below the RHP zero
frequency, such as ωx ≤ωRHPZ/10.
The Control-to-Output Transfer Function
The control-to-output transfer function of the boost converter takes on the form15,16
H( jω) = Vo
Vea
= H0
(1 −jω/ωRHPZ)(1 + jω/ωESR)
(1 + jω/ωp)[1 −(ω/0.5ωS)2 + ( jω/0.5ωS)/Q]
(11.69)
where H0 is the dc gain, ωp is the dominant-pole frequency established by the
output capacitor C, ωRHPZ is the aforementioned RHPZ frequency exhibited by
boost converters operating in the continuos-current mode, ωESR is the zero frequency
due to the capacitor’s ESR, and the second-order denominator term stems from the
current sampling process at frequency ωS. The following expressions hold:15
ωRHPZ = (1 −D)2VO
IO L
ωESR =
1
RcapC
Q =
1/π
(1 + Se/Sn) × (1 −D) −0.5
(11.70)

599
SECTION 11.10
PCMC of Boost
Converters
The dc gain H0 and the dominant pole f p are such that above f p but well below
fRHPZ, fESR, and 0.5 fS the gain-bandwidth product is constant and such that
GBP = H0 × f p = 1 −D
2π RiC
(11.71)
Except for the numerator term (1 −D), this is similar to the buck case, so we can
again exploit this feature to facilitate the design of the EA.
EXAMPLE 11.25.
Using an OTA with Gm = 1 mA/V, Ro = 1 M, and Co = 5 pF,
design an EA to stabilize a boost converter having VI = 5 V, VO = 12 V, IO = 4 A,
VREF = 1.205 V, fS = 400 kHz, Ri = 0.1 , L = 10 μH, Rcoil = 10 m, C = 200 μF,
and Rcap = 5 m. Assume the converter is terminated on a purely resistive load RL D =
VO/IO = 3 , in which case the dc gain takes on the form15
H0 ∼= RL D(1 −D)
2Ri
(11.72)
What is the phase margin of the converter?
Solution.
With reference to Fig. 11.57 we have β = VREF/VO = 1.205/12 = 1/9.96,
so R2/R1 = 8.96. Pick R1 = 10 k and R2 = 89.6 k. For this regulator we have
D = 1 −VI/VO = 1 −5/12 = 0.583, so using the above equations we ﬁnd
H0 = 6.25
f p = 0.53 kHz
fRHPZ = 8.3 kHz
fESR = 159 kHz
Q = 1.53
One possible strategy15 is to set the crossover frequency fx equal to the lower of either
(1/4) fRHPZ or (1/10) fS. So, in the present case let fx = 8.3/4 ∼= 2.0 kHz. Next,
calculate the gain required of the EA at fx. Since fx is much lower than both 0.5 fS and
fESR, we drop the corresponding terms in Eq. (11.69) and write
|H( j fx)| ∼= H0

1 + ( fx/fRHPZ)2
1 + ( fx/f p)2
= 6.25

1 + (2.0/8.3)2
1 + (2.0/0.53)2 ∼= 1.7
To produce |T ( j fx)| = 1, the EA gain at fx must compensate for the combined atten-
uation due to β and the gain of 1.7 due to H. Since fx is going to lie between fz1 and
f p2, where the EA gain is ﬂat, we impose
Gm Rc = 9.96/1.7 = 5.8 V/V
This gives Rc = 5.8/(1 × 10−3) = 5.8 k. Next, impose15 fz1 = fx/2.5 = 2.0/2.5 =
0.8 kHz, which should still give a reasonable phase margin (if subsequent lab measure-
ments prove this choice to be inadequate, we can always lower or raise fz1 by raising or
lowering Cc). Thus, letting
1
2π(5.8 k)Cc
= 0.8 kHz
gives Cc ∼= 34 nF. Finally, make the EA’s high-frequency pole f p2 equal15 to the lower
of either fRHPZ or fESR so as to ensure proper frequency rolloff for T . In the present case
let f p2 = fRHPZ, or
1
2π(5.8 k) × (Co + CHFP) = 8.3 kHz
Letting Co = 5 pF gives CHFP = 3.3 nF. The simulation of Fig. 11.61 gives fx =
1.87 kHz and φm ∼= 59◦.

600
CHAPTER 11
Voltage
References and
Regulators
5.8 kΩ
89.6 kΩ
10 kΩ
R2
R1
R
F
LAPLACE {v(EA,0)} = {6.25*(1−s/(6.3*8.3e3)*(1+s/(6.3*159e3)/
((1+s/(6.3*530))*(1+(s/(6.3*200e3))**2+s/(6.3*200e3*1.53)))}
Vr
Vf
Vt
CHFP
EA
3.3 nF
34 nF
0
Cc
Co
5 pF
Ro
1 MΩ
Rc
Gm
1 mA/V
+
–
–
+
IN+
IN−
OUT+
OUT−
EH
0
0
Gain (dB)
102
103
104
105
106
−60
−40
−20
0
20
40
60
10
Phase
−360°
−270°
−180°
−90°
<) T
|T|
FIGURE 11.61
PSpice simulation of the boost converter of Example 11.25.
PROBLEMS
11.1 Performance speciﬁcations
11.1 An unregulated voltage VI = (26 ± 2) V is applied to a shunt regulator consist-
ing of a series 200- resistor and an 18-V, 20- shunt diode. The output of this
regulator is then fed to a second regulator consisting of a 300- series resistor and
a 12-V, 10- shunt diode to achieve an even better regulated voltage VO for a load
RL. Sketch the circuit; then, ﬁnd its line and load regulation and the minimum RL
allowed.
11.2 Using a 6.2-V Zener diode and a 741 op amp, design a negative self-biased reference
that accepts an unregulated negative voltage VI and gives a regulated output VO
adjustable from −10 V to −15 V by means of a 10-k pot. What are the permissible
ranges for VI and IO?

601
Problems
11.2 Voltage references
11.3 At IZ = 7.5 mA the 1N827 thermally compensated Zener diode gives VZ = 6.2 V ±
5% and TC(VZ) = 10 ppm/◦C. (a) Using this diode, along with an op amp having
TC(VOS) = 5 μV/◦C, design a 10.0-V self-regulated reference with provision for the
exact adjustment of VO. (b) Estimate the worst-case change in VO for a temperature
variation of 0 ◦C to 70 ◦C.
11.4 Consider the circuit obtained from the self-regulated reference of Fig. 11.4 by lifting
theleftterminalsof R1 and Dz offground,connectingthemtogether,andthenreturning
the resulting common node to ground via a variable resistance R. (a) Show that this
modiﬁcation allows us to vary VO without altering the diode current. (b) Obtain a
relationship between VO and VZ. (c) Specify standard components for a variable
reference from 10 V to 20 V using the 1N827 diode of Problem 11.3 as the reference
element.
11.5 (a) Assuming matched BJTs in the alternative bandgap cell2 of Fig. P11.5, show
that VREF = VBE1 + K VT , K = (R2/R3) ln(R2/R1). (b) Assuming Is (25 ◦C) =
5 × 10−15 A for both BJTs, specify suitable components for TC(VREF) = 0 at 25 ◦C.
Q1
Q2
VREF
R1
R2
R3
VI
+
–
FIGURE P11.5
11.6 The bandgap reference2 of Fig. P11.6 is known as the Widlar bandgap cell for
its inventor. (a) Assuming matched BJTs with negligible base currents, show that
VREF = VBE3 + K VT , K = (R2/R3) ln(IC1/IC2). (b) Specify suitable components for
TC(VREF) = 0 at 25 ◦C if Is (25 ◦C) = 2×10−15 A for all BJTs, IC1 = IC3 = 0.2 mA,
and IC2 = IC1/5.
11.7 Prove Eq. (11.17). Hence, assuming m p = 10 and VT = 26 mV, specify suitable
resistance values for a current of 100 μA through Q1.
11.3 Voltage-reference applications
11.8 Suppose you have (1) an op amp whose input voltage range and output voltage swing
extend within 1 V of each supply; (2) a 5.0-V voltage reference of the type of Fig. 11.1
with a dropout voltage of 1 V; (3) a pair of 10-k resistors. (a) Using only the above
components, design a circuit to synthesize VO1 = +5 V and VO2 = −5 V. What
are the minimum supply voltages required to power your circuit? (b) Repeat, but for
VO1 = +2.5 V and VO2 = +5 V. (c) Repeat, but for VO1 = +5 V and VO2 = +10 V.
(d) Repeat, but for VO1 = +2.5 V and VO2 = −2.5 V.

602
CHAPTER 11
Voltage
References and
Regulators
Q2
Q1
5 V
VI
Q3
R1
R5
R4
R6
R2
R3
+
–
+
–
KVT
VBE3
1.28 kΩ
3.72 kΩ
VREF
+
–
FIGURE P11.6
11.9 (a) Using a 5-V voltage reference, an op amp, a 10-k potentiometer, and resistors
as needed, design a variable voltage reference over the range −5 V ≤VO ≤+5 V.
(b) Repeat, but for −10 V ≤VO ≤+10 V.
11.10 The LT1029 is a 5-V reference diode that operates with any current between 0.6 mA
and 10 mA, and has a maximum TC of 20 ppm/◦C. Using the LT1029 and a JFET-input
op amp with TC(VOS) = 6 μV/◦C, design ±2.5-V split references and estimate their
worst-case thermal drifts. Assume ±5-V power supplies.
11.11 Assuming ±15-V supplies and using an LM385 2.5-V diode with a bias current of
100 μA as a voltage reference, design a current generator whose output is variable
over the range −1 mA ≤IO ≤1 mA by means of a 10-k pot.
11.12 The LM10 consists of two op amps and a 200-mV reference internally connected as in
Fig.P11.12.Theopampshaverail-to-railoutputswingcapability,andthedevicedraws
amaximumquiescentcurrentof0.5mAfromasupplyvoltageanywherebetween1.1V
and 40 V. The LM10C version has TC(VREF) = 0.003 %/◦C, TC(VOS) = 5 μV/◦C,
line regulation = 0.0001 %/V, and CMRRdB ∼= PSRRdB ∼= 90 dB. (a) Using the
8
7
6
3
2
1
4
VREF
200 mV
+
+
–
OA1
OA1
OA2
+
–
FIGURE P11.12

603
Problems
LM10C, design a voltage reference continuously variable from 0 to 10 V by means of
a 10-k pot. (b) Find the worst-case thermal drift and line regulation of your circuit.
11.13 Figure P11.13 shows a current generator using the LM10 of Problem 11.12. (a) An-
alyze the circuit and show that as long as the externally applied voltage between
its terminals is sufﬁcient to keep the op amps in the linear region, the current that
the circuit sinks at the positive terminal and sources at the negative terminal is
IO = (1+ R2/R3)VREF/R1. (b) Specify suitable components for IO = 5 mA. (c) What
is the range of external voltages over which your circuit will operate properly?
R3
R2
R1
+
–
LM10
7
6
2
3
8
1
4
FIGURE P11.13
11.14 A 5-V voltage reference having output noise density enw1 = 100 nV/
√
Hz is buffered
by a voltage follower implemented with a 1-MHz JFET-input op amp having in-
put noise density of enw2 = 25 nV/
√
Hz. (a) What is the total output noise Eno?
(b) Modify your follower in the manner of Fig. 7.13 so as to lower Eno to 1/10 (or
less) of its original value.
11.15 Design a circuit that senses the temperatures T1 and T2 at two different sites, and yields
VO = (0.1 V)(T2 −T1), T1 and T2 in degrees Celsius. The circuit uses two matched
diodes with Is (25 ◦C) = 2 fA as temperature sensors, and two potentiometers for its
calibration. Describe the calibration procedure.
11.16 Specify suitable components in the circuit of Fig. 11.14 for a Fahrenheit sensor with
a sensitivity of 10 mV/◦F. Outline its calibration.
11.4 Linear regulators
11.17 Using a 741 op amp, an LM385 2.5-V reference diode, and pnp BJTs, design an
overload-protected negative regulator with VO = −12 V and IO(max) = 100 mA.
11.18 Using the LM10 of Problem 11.12 and two npn BJTs, design a 100-mA overload-
protected voltage regulator whose output can be varied from 0 to 15 V by means of
a 10-k pot. Show how you power your circuit, and estimate the lowest permissible
supply voltage.
11.19 Figure P11.19 shows a high-voltage regulator based on the LM10 of Problem 11.12.
Since the LM10 is powered by three VBE drops, the high-voltage capabilities of the
circuit are limited only by the external components. (a) Analyze the circuit and ﬁnd
VO in terms of VREF. (b) Specify R1 and R2 for VO = 100 V. (c) Assuming typical
BJT parametrs, estimate VDO for IO = 1 A.

604
CHAPTER 11
Voltage
References and
Regulators
R2
R1
LM10
6
8
7
1
4
2
3
R5
R4
Q2
Q3
Q1
R3
VI
LD
3.9 kΩ
0.2 kΩ
3 kΩ
IO
2N2222
2N2222
VO
2N3055
FIGURE P11.19
11.5 Linear-regulator applications
11.20 The LM338 is a 1.2-V, 5-A, adjustable regulator having VDO = 2.5 V, a maximum
input-output differential voltage of 35 V, and an adjustment-pin current of 45 μA.
Using the LM338, design a 5-A regulator whose output can be varied from 0 V to 5 V
via a 10-k pot. What are the power-supply requirements of your circuit?
11.21 Using the LT1029 reference diode of Problem 11.10 and the LM338 voltage regu-
lator of Problem 11.20, design a minimum-component circuit for the simultaneous
generation of a 5-V reference voltage and a 15-V, 5-A supply voltage. What is the
permissible unregulated input voltage range of your circuit?
11.22 Using a μA7805 5-V regulator and 0.25-W (or less) resistances, design a 1-A current
source. What is its voltage compliance as a function of the supply voltage?
11.23 In Fig. 11.23a let the common terminal of the regulator be connected directly to the
node shared by R1 and R2 to save the op amp. Assuming a μA7805 5-V regulator,
whose quiescent current is rated as IQ ∼= 4 mA ﬂowing out of the common terminal,
ﬁnd suitable resistances for VO = 12 V; then ﬁnd the permissible range for VCC, as
well as the load and line regulation.
11.24 In the circuit of Fig. 11.19b let VI = 25 V and R1 = 2.5 , and let R2 be an
arbitrary load. Find the Norton equivalent of the circuit seen by the load, along with
its voltage compliance, given the following LM317 speciﬁcations: VDO ∼= 2 V, line
regulation = 0.07%/V maximum, and IADJ = 5 μA maximum for 2.5 V ≤(VI −
VO) ≤40 V.
11.25 The LT337 is a −1.25-V, 1.5-A, adjustable negative regulator with VREG/(VI −
VO) = 0.03%/V maximum, and IADJ/(VI −VO) = 0.135 μA/V maximum. Using
this device, design a 500-mA current sink; next, ﬁnd its Norton equivalent.
11.26 Using an LM317 1.25-V, adjustable positive regulator, and an LM337 −1.25-V, ad-
justable negative regulator, design a dual-tracking bench power supply whose outputs
are adjustable from ±1.25 V to ±20 V by means of a single 10-k pot. See Prob-
lems 11.24 and 11.25 for the speciﬁcations of these regulators.

605
Problems
11.27 (a) Find the maximum allowable operating ambient temperature if TJ(max) = 190 ◦C,
PD(max) = 1 W, and θJA = 60 ◦C/W. (b) Find θJA for a 5-V regulator with TJ(max) =
150 ◦C to deliver 1 A at VI = 10 V and TA = 50 ◦C. Can a μA7805 operating in free
air do it?
11.28 In the circuit of Fig. 11.23b the pot is replaced by the series combination of a 2-k
resistance between the inverting input and the regulator’s output, and an 18-k re-
sistance between the inverting input and the regulator’s common. Assuming ±18-V
supplies, R = 1.00 , and a μA7805 regulator in the TO-220 package, specify a heat
sink for operation all the way down to a load voltage of 0 V with TA(max) = 60 ◦C.
11.29 Using the LM10 of Problem 11.12 and a 1.5-V, 2-mA LED, design an indicator circuit
that monitors its own power supply and turns the LED off whenever the supply drops
below 4.75 V.
11.30 Specify components in the circuit of Fig. 11.29a to provide OV protection when VCC
tries to rise above 6.5 V, and issue a PFAIL command when the 120-V (rms), 60-Hz
ac line tries to drop below 80% of its nominal value.
11.6 Switching regulators
11.31 The switched coil of Fig. 11.31e bears some similarity to the switched capacitor of
Fig. 4.23a. (a) Assuming VSAT = VF = 0, compare the two arrangements and point
out similarities as well as fundamental differences. (b) Assuming the coil current wave-
form of Fig. 11.33a, show that the power transferred by the coil from VI to VO is P =
fSWcycle, where Wcycle = LILiL is the energy packet transferred during each cycle.
11.32 (a) Derive Eq. (11.40). Then, assuming IO = 1 A and iL = 0.2 A, estimate Ip as
well as the minimum value of IO for continuous operation for the case of (b) a buck
converter with VI = 12 V and VO = 5 V, (c) a boost converter with VI = 5 V and
VO = 12 V, and (d) an inverting converter with VI = 5 V and VO = −15 V.
11.33 An inverting converter with 5 V ≤VI ≤10 V is to deliver VO = −12 V at a full load
of 1 A. Assuming continuous operation with VSAT = VF = 0.5 V, ﬁnd the required
range for D, as well as the maximum value of II.
11.34 A buck-boost converter is powered from +15 V and operates at 150 kHz. Specify L,
C, and ESR for VO = −15 V, Vro(max) = 150 mV, and continuous-mode operation
over the range 0.2 A ≤IO ≤1 A.
11.35 A buck converter has VI = 20 V, VO = 5 V, fS = 100 kHz, L = 50 μH, and
C = 500 μF. Assuming VSAT = VF = 0 and ESR = 0 sketch and label iSW, iD, iL,
iC, and the voltage vX at the left terminal of L for the case of (a) continuous-mode
operation with IO = 3 A, and (b) discontinuous-mode operation with tON = 2 μs.
11.36 Discuss how η in the converter of Example 11.20 is affected by (a) doubling VI, and
(b) doubling fS.
11.7 The error ampliﬁer
11.37 (a) Assuming ideal op amp in the EA of Fig. 11.36, expand Z A( jω) and Z B( jω) to ob-
tain Eqs. (11.47) and (11.49). (b) Specify suitable component values for fz1 = 1 kHz,
fz2 = 10 kHz, f p1 = 100 kHz, f p2 = 1 MHz, and |HE A( j316 kHz)| = 10 dB.

606
CHAPTER 11
Voltage
References and
Regulators
11.38 The EA implementation with Z A and Z B as pictured in Fig. 11.37 is not unique. An
alternative that you may ﬁnd in the application notes uses Z B to create fz2 and f p2,
and Z A to create fz1 and f p1. Use this alternative to design the EA of Problem 11.37.
11.8 Voltage mode control
11.39 With reference to the circuit of Fig. 11.40, derive the transfer function from the source
at the left to the output at the right, assuming negligible loading by RL D and Z A.
Hence, prove Eq. (11.52).
11.40 Redesign the EA of Example 11.22, but using the alternative implementation of
Problem 11.38.
11.41 The op amp of Example 11.22 was assumed to have GBP = ∞for simplicity. If GBP
is noninﬁnite we expect some phase-margin erosion. Specify GBPmin for a maximum
erosion of about 5◦, and verify with PSpice.
11.42 Estimate the change in the average value VO brought about by a 1-A change in the
average value IO in the converter of Fig. 11.42. Verify with PSpice.
11.9 Peak current mode control
11.43 Show that if Se = −S f /2, the Q factor of Eqs. (11.61) and (11.70) simpliﬁes as
Q = 2/[π(1 −D)].
11.44 Reconsider Example 11.24, but for the case in which 1/2 of the output current is drawn
by IL D, and the other half by RL D. Which parameters change, and how? What is the
phase margin with the modiﬁed load?
11.45 A beginner, encouraged by the fact that PCMC eliminates the coil delay from the loop,
tries to use just an ordinary op amp as the error ampliﬁer and no additional components
to compensate the converter of Example 11.24. (a) If the op amp has GBP = 1 MHz,
will the circuit work? Explain! (b) Assuming the GBP is adjustable, ﬁnd the GBP
required for a phase margin of 45◦. Verify with PSpice, compare with Example 11.24,
and comment.
11.46 Design an EA to stabilize the converter of Example 11.24, but using an op amp instead
of an OTA. What is a reasonable minimum GBP for the op amp to have? Verify with
PSpice.
11.47 A buck converter with VI = 12 V and VO = 5 V is terminated on a 1- load. Assuming
L = 10μH,C = 50μF, fS = 350kHz, Vp = 0.2V, RSW = Rsense = 20m,ai = 5V/V,
Rcoil = Rcap = 5 m, and VREF = 1.25 V, design a compensator using an op amp.
11.10 PCMC of boost converters
11.48 (a) Show that the circuit of Fig. 11.60a has an LHP pole at s = −1/(RC) and an RHP
zero at s = +R1/(R2RC). (b) If R1 = R2, the circuit is the familiar phase shifter of
Fig. 3.12. Show its step response. (c) Repeat if R2 = 2R1, comment.
11.49 Design an EA to stabilize the converter of Example 11.25, but using an op amp instead
of an OTA. What is a reasonable minimum GBP for the op amp to have? Verify with
PSpice.

607
References
REFERENCES
1. Analog Devices Engineering Staff, Practical Design Techniques for Power and Thermal
Management, Analog Devices, Norwood, MA, 1988. ISBN-0-916550-19-2.
2. P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009. ISBN 978-0-470-
24599-6.
3. R. Knapp, “Selection Criteria Assist in Choice of Optimum Reference,” EDN, February
18, 1988, pp. 183–192.
4. “IC Voltage Reference Has 1 ppm per Degree Drift,” Texas Instruments Application
Note AN-161, http://www.ti.com/lit/an/snoa589b/snoa589b.pdf.
5. A. P. Brokaw, “A Simple Three-Terminal IC Bandgap Reference,” IEEE Journal of
Solid-State Circuits, Vol. SC-9, No. 6, December 1974, pp. 388–393.
6. Analog Devices Engineering Staff, Practical Design Techniques for Sensor Signal Con-
ditioning, Analog Devices, Norwood, MA, 1999. ISBN-0-916550-20-6.
7. J. Graeme, “Precision DC Current Sources,” Part 1 and Part 2, Electronic Design, Apr. 26,
1990, pp. 191–198 and 201–206.
8. “Applications for an Adjustable IC Power Regulator,” Texas Instruments Application
Note AN-178, http://www.ti.com/lit/an/snva513a/snva513a.pdf.
9. G. A. Rincon Mora and P. E. Allen, “Study and Design of Low Drop-Out Regula-
tors,” School of Electrical and Computer Engineering, Georgia Institute of Technology,
http://users.ece.gatech.edu/∼rincon/publicat/journals/unpub/ldo des.pdf.
10. R.W.EriksonandD.Maksimovic,FundamentalsofPowerElectronics,2nded.,Springer
Science + Business Media, Dardrecht, Netherlands, 2001. ISBN 00-052569.
11. C. Nelson, “LT1070 Design Manual,” Linear Technology Application Note AN-19,
http://cds.linear.com/docs/en/application-note/an19fc.pdf.
12. C. Nelson, “LT1074/LT1076 Design Manual,” Linear Technology Application Note
AN-44, http://cds.linear.com/docs/en/application-note/an44fa.pdf.
13. R. Ridley, “A New, Continuous-Time Model for Current-Mode Control,” IEEE Trans.
on Power Electronics, Vol. 6, No. 2, April 1991, pp. 272–280.
14. R. Ridley, “Current-Mode Control Modeling,” Switching Power Magazine, 2006,
pp. 1–9, http://www.switchingpowermagazine.com/downloads/5%20Current%20Mode
%20Control%20Modeling.pdf.
15. R. Sheenan, “Understanding and Applying Current-Mode Control Theory,” Texas In-
struments Document SNVA555, 2007, http://www.ti.com/lit/an/snva555/snva555.pdf.
16. T. Hegarty, “Peak Current-Mode DC-DC Converter Stability Analysis,” 2010, http://
powerelectronics.com/regulators/peak-current-mode-dc-dc-converter-stability-analysis.

12
D-A AND A-D CONVERTERS
12.1 Performance Speciﬁcations
12.2 D-A Conversion Techniques
12.3 Multiplying DAC Applications
12.4 A-D Conversion Techniques
12.5 Oversampling Converters
Problems
References
In their natural state, information-carrying variables—such as voltage, current,
charge, temperature, and pressure—are in analog form. However, for processing,
transmission, and storage purposes, it is often more convenient to represent infor-
mation in digital form. Consider, for instance, an op amp circuit that is required to
put out a signal v in the range of 0 V to 1 V with an accuracy of 1 mV, or 0.1%.
Given the effects of component nonidealities, drift, aging, noise, and imperfect wires
and interconnections, even an accuracy requirement this moderate may be difﬁcult
to meet.
The demands on circuit performance can be relaxed signiﬁcantly if information
is represented in digital form. For instance, in decimal form, which is the most
familiar form to humans, the above signal would be expressed as v = 0.d1d2 . . . dn,
where d1, d2, . . . , dn are decimal digits between 0 and 9. For a 1-mV resolution over
the range 0.000 V ≤v < 0.999 V, three such digits are needed. This, in turn, requires
three separate circuits to hold the individual digit values; however, the performance
requirements are now much more relaxed because each digit-circuit needs to resolve
only 10 voltage levels instead of 1000. Individual accuracies of ±5% are sufﬁcient
for this task.
Expressing signals digitally, while easing one problem, creates another, namely,
the need to convert from analog to digital (A-D) and from digital to analog (D-A).
For instance, a decimal D-A converter for our example would have to determine the
608

609
CHAPTER 12
D-A and A-D
Converters
values of d1, d2, and d3 as provided by the corresponding circuits (an easy task),
and then synthesize the analog signal v = d110−1 +d210−2 +d310−3 with a 1-mV
accuracy (an inherently difﬁcult task).
Though convenient for humans, decimal representation does not relax circuit
performance requirements to the maximum extent. Rather, this is done by allowing
digits to take on just two values, namely, 0 and 1. If we represent these values with
sufﬁciently different voltages, such as 0 V and 5 V, then even the crudest circuit
will be able to resolve them. Binary digits, or bits, form the basis of digital systems
precisely because of this. Bits are held and manipulated by binary circuits such as
switches, logic gates, and ﬂip-ﬂops.
Figure 12.1 depicts the most general context1 within which A-D and D-A con-
version is used. An analog input signal, after suitable conditioning, is A-D converted
to be processed or perhaps just transmitted or recorded in digital form by the digi-
tal signal processor (DSP) block. Once processed, received, or retrieved, it is D-A
converted to be reused in analog form, possibly after additional output conditioning.
The A-D converter (ADC) is operated at a rate of fS samples per second. To
avoid any aliasing phenomena,1 the analog input must be band-limited so that its
highest frequency component is less than fS/2; antialiasing ﬁlters were addressed in
Chapter 4. ADCs usually require that the input be held constant during the conversion
process, indicating that the ADC must be preceded by an SHA to freeze the band-
limited signal just prior to each conversion; SHAs were addressed in Chapter 9.
The D-A converter (DAC) is usually operated at the same rate fS as the ADC and,
if the application demands so, it is equipped with appropriate circuitry to remove
any output glitches arising in connection with input code changes. The resulting
staircase-like signal is ﬁnally passed through a smoothing ﬁlter to ease the effects
of quantization noise.
The scheme of Fig. 12.1 is found, either in full or in part, in countless ap-
plications. Digital signal processing (DSP), direct digital control (DDC), digital
audio mixing, recording and playback, pulse-code modulation (PCM) communica-
tion, data acquisition, computer music and video synthesis, and digital-multimeter
instrumentation are only some examples.
Chapter Highlights
After an introduction to important A-D and D-A terminology and performance
parameters, the chapter discusses common D-A conversion techniques, such as
Antialiasing
filter
SHA
ADC
vO
DSP
DAC
Deglitcher
Smoothing
filter
vI
FIGURE 12.1
Sampled-data system.

610
CHAPTER 12
D-A and A-D
Converters
weighted-resistorandweighted-capacitorDACs,potentiometricDACs,currentmode
and voltage mode R-2R ladder DACs, master-slave DACs, and voltage mode and
current mode segmented DACs. A class of R-2R ladder DACs known as multiply-
ing DACs lend themselves to a number of useful applications, which are covered
next: digitally programmable attenuators, ﬁlters, and oscillators are three popular
examples.
The chapter proceeds to common A-D conversion techniques. First, it discusses
DAC-based ADCs such as successive-approximation and charge-redistribution
ADCs. Next, it turns to ﬂash converters, subranging converters, and pipelined con-
verters. Finally, it investigates integrating-type ADCs such as charge-balancing and
dual-slope converters.
The chapter concludes with oversampling converters, in connection with which
it discusses Nyquist-rate sampling, oversampling, noise shaping, and sigma-delta
converters.
12.1
PERFORMANCE SPECIFICATIONS
A string of n bits, b1b2b3 . . . bn, forms an n-bit word. Bit b1 is called the most
signiﬁcant bit (MSB) and bit bn the least signiﬁcant bit (LSB). The quantity
D = b12−1 + b22−2 + b32−3 + · · · + bn2−n
(12.1)
is called the fractional binary value. Depending on the bit pattern, D can assume 2n
equally spaced values from 0 to 1−2−n. The lower limit is reached when all bits are
0, the upper limit when all bits are 1, and the spacing between adjacent values is 2−n.
D-A Converters (DACs)
A DAC accepts an n-bit input word b1b2 . . . bn with fractional binary value DI , and
produces an analog output proportional to DI . Figure 12.2a depicts a voltage-output
DAC, for which we have
vO = K VREFDI = VFSR(b12−1 + b22−2 + · · · + bn2−n)
(12.2)
where K is a scale factor; VREF is a reference voltage; bk (k = 1, 2, . . . , n) is either
0 or 1, depending on the logic level at the corresponding input; and VFSR = K VREF
is the full-scale range. Frequently used values for VFSR are 2.5 V, 5.0 V, and 10.0 V.
Though our discussion will focus on voltage-output DACs, the results are readily
extended to current-output DACs, characterized by iO = K IREFDI = IFSRDI . A
typical IFSR value is 1.0 mA.
We observe that the DAC output is the result of multiplying the analog signal
VREF by the digital variable DI . A DAC that allows for VREF to vary all the way
down to zero is called a multiplying DAC (MDAC).
Depending on the input bit pattern, vO can assume 2n different values rang-
ing from 0 to the full-scale value VFSV = (1 −2−n)VFSR. The MSB contribution
to vO is VFSR/2, and the LSB contribution is VFSR/2n. The latter is called the
resolution, or simply the LSB. Note that VFSV is always 1 LSB short of VFSR.
The quantity DR = 20 log10 2n is called the dynamic range of the DAC. Thus,

611
SECTION 12.1
Performance
Speciﬁcations
7/8
6/8
5/8
4/8
3/8
2/8
1/8
0
000 001
1 LSB
010 011 100 101
110
111
VREF
b1 b2 b3
vO
DI
bn
vO  (V)
DAC
b1
b2
(a)
(b)
FIGURE 12.2
DAC diagram and ideal transfer characteristic for n = 3 and VFSR = 1 V.
a 12-bit DAC with VFSR = 10.000 V has LSB = 2.44 mV, VFSV = 9.9976 V, and
DR = 72.25 dB.
Since there are only 2n possible input codes, the transfer characteristic of
a DAC is a set of points whose envelope is a straight line with end points at
(b1b2 . . . bn, vO) = (00 . . . 0, 0 V) and (11 . . . 1, VFSV). Figure 12.2bshows the char-
acteristic of a DAC with n = 3 and VFSR = 1.0 V. The graph consists of 23 = 8
bars ranging in height from 0 to VFSV = 7
8 V with a resolution of 1 LSB = 1
8 V.
If we drive a DAC with a uniformly clocked n-bit binary counter and observe vO
with the oscilloscope, the waveform will be a staircase. The higher n, the ﬁner the
resolution and the closer the staircase to a continuous ramp. DACs are available in
word lengths ranging from 6 bits to 20 bits or more. While DACs with 6, 8, 10, 12,
and 14 bits are common and economical, DACs with n > 14 become progressively
more expensive and require the utmost care to realize their full precision.
DAC Speciﬁcations3
The internal circuitry of a DAC is subject to component mismatches, drift, aging,
noise, and other sources of error, whose effect is to degrade conversion performance.
The maximum deviation of the actual output from the ideal value predicted by
Eq. (12.2) is called the absolute accuracy and is expressed in fractions of 1 LSB.
Clearly, if an n-bit DAC is to retain its credibility down to its LSB, its absolute
accuracy must never be worse than 1
2 LSB. DAC errors are classiﬁed as static and
dynamic.
The simplest static errors are the offset error and the gain error depicted in
Fig. 12.3. The offset error (+1 LSB in the example) is nulled by translating the
actual envelope up or down until it goes through the origin, as in Fig. 12.3b. What
is left, then, is the gain error (−2 LSB in the example), which is nulled by adjusting
the scale factor K.

612
CHAPTER 12
D-A and A-D
Converters
Gain
error
000
0
000
111
111
b1b2b3
b1b2b3
VFSV
VFSV
vO 
vO 
(a)
(b)
Ideal
Ideal
Offset
error
0
FIGURE 12.3
DAC offset error and gain error.
Even after both errors have been nulled, the actual envelope is likely to deviate
from the straight line passing through the end points. The maximum deviation is
called the integral nonlinearity (INL), or also the relative accuracy, and is expressed
in fractions of 1 LSB. Ideally, the difference in height between adjacent bars is 1 LSB;
the maximum deviation from this ideal value is called the differential nonlinearity
(DNL). If DNL < −1 LSB, the transfer characteristic becomes nonmonotonic; that
is, for certain input code transitions vO will decrease with the input code, rather than
increase. A nonmonotonic characteristic is especially undesirable in control, where
it may cause oscillations, and in successive-approximation ADCs, where it may lead
to missing codes. An example will better clarify these concepts.
EXAMPLE 12.1.
Find the INL and DNL of the 3-bit DAC of Fig. 12.4. Comment on
your results.
Solution. By inspection, the individual-code integral and differential nonlinearities, in
fractions of 1 LSB, are found to be
k:
000
001
010
011
100
101
110
111
INLk:
0
0
−1/2
1/2
−1
1/2
−1/2
0
DNLk:
0
0
−1/2
1
−3/2
3/2
−1
1/2
The maxima of INLk and DNLk are, respectively, INL = 1 LSB and DNL = 1 1
2 LSB.
We observe a nonmonotonicity as the code changes from 011 to 100, where the step
size is −1
2 LSB instead of +1 LSB; hence, DNL100 = −1
2 −(+1) = −3
2 LSB <
−1 LSB. The fact that DNL101 = 3
2 LSB > 1 LSB, though undesirable, does not cause
nonmonotonicity.
Remark.
Note that INLk = k
i=0 DNLi. Can you provide an intuitive justiﬁcation?
DAC performance changes with temperature, age, and power-supply variations;
hence, all relevant performance parameters such as offset, gain, INL and DNL,
and monotonicity must be speciﬁed over the full temperature and power-supply
ranges.

613
SECTION 12.1
Performance
Speciﬁcations
7/8
6/8
5/8
4/8
3/8
2/8
1/8
0
000
001
010
011
100
101
110
111
b1 b2b3
vO  (V)
FIGURE 12.4
Example of actual DAC characteristics after the
offset and gain errors have been nulled.
The most important dynamic parameter is the settling time tS. This is the time it
takes for the output to settle within a speciﬁed band (usually ±1
2 LSB) of its ﬁnal
value following a code change at the input (usually a full-scale change). Typically, tS
ranges from under 10 ns to over 10 μs, depending on word length as well as circuit
architecture and technology.
Another potential source of concern is the presence of output spikes in connec-
tion with major input-code transitions. Called glitches, these spikes are due to the
internal circuitry’s nonuniform response to input bit changes as well as poor syn-
chronization of the bit changes themselves. For instance, if during the center-scale
transition from 01 . . . 1 to 10 . . . 0 the MSB is perceived as going on before (or after)
all other bits go off, the output will momentarily swing to full scale (or to zero),
causing a positive-going (or negative-going) output spike, or glitch.
Glitches are of particular concern in CRT display applications. They can be
minimized by synchronizing the input bit changes with a high-speed parallel latch
register, or by processing the DAC output with a THA. The THA is switched to the
hold mode just prior to the input code change, and is returned to the track mode only
after the DAC has recovered from the glitch and settled to its new level.
A-D Converters (ADCs)
An ADC provides the inverse function of a DAC. As shown in Fig. 12.5a, it accepts
an analog input vI and produces an output word b1b2 . . . bn of fractional value DO
such that
DO = b12−1 + b22−2 + · · · + bn2−n =
vI
K VREF
=
vI
VFSR
(12.3)

614
CHAPTER 12
D-A and A-D
Converters
0
1 LSB
 LSB
111
110
101
100
011
010
001
000
VREF
b1b2b3
vI
eq
DO
bn
vI  (V)
ADC
START
EOC
b1
b2
(a)
(b)
3
8
4
8
5
8
6
8
7
8
1
8
1
8
1
2
 LSB
1
2
2
8
0
0
vI  (V)
3
8
4
8
5
8
6
8
7
8
2
8
–
FIGURE 12.5
ADC diagram, and ideal transfer characteristic and quantization noise for n = 3 and
VFSR = 1 V.
Usually, an ADC includes two additional control pins: the START input, to tell the
ADC when to start converting, and the EOC output, to announce when conversion
is complete. The output code can be in either parallel or serial form. ADCs are often
equipped with latches, control logic, and tristate buffers to facilitate microprocessor
interfacing. ADCs intended for digital panel-meter applications are designed to drive
LCD or LED displays directly.
The input to an ADC is often a transducer signal proportional to the transducer
supply voltage VS, or vI = αVS (a load cell is a typical example). In these cases it is
convenient to use VS also as the reference to the ADC, for then Eq. (12.3) simpliﬁes
as DO = αVS/K VS = α/K, indicating a reference-independent conversion. Called
ratiometric conversion, this technique allows for highly accurate conversions using
references of only modest quality.
Figure 12.5b, top, shows the ideal characteristic of a 3-bit ADC with VFSR =
1.0 V. The conversion process partitions the analog input range into 2n intervals
called code ranges, and all values of vI within a given code range are represented
by the same code, namely, that corresponding to the midrange value. For example,
code 011, corresponding to the midrange value vI = 3
8 V, actually represents all
inputs within the range 3
8 ± 1
16 V. Due to the inability by the ADC to distinguish
among different values within this range, the output code can be in error by as much
as ±1
2 LSB. This uncertainty, called quantization error, or also quantization noise
eq, is an inherent limitation of any digitization process. An obvious way to improve
it is by increasing n.

615
SECTION 12.1
Performance
Speciﬁcations
As shown in Fig. 12.5b, bottom, eq is a sawtooth-like variable with a peak value
of 1
2 LSB = VFSR/2n+1. Its rms value is readily found to be Eq = (1
2 LSB)/
√
3 or
Eq = VFSR
2n√
12
(12.4)
If vI is a sinusoidal signal, the signal-to-noise ratio is maximized when vI has a
peak amplitude of VFSR/2, or an rms value of (VFSR/2)/
√
2. Thus, SNRmax =
20 log10[(VFSR/2
√
2)/(VFSR/2n√
12)], or
SNRmax = 6.02n + 1.76 dB
(12.5)
Increasing n by 1 cuts Eq in half and increases SNRmax by 6.02 dB.
ADC Speciﬁcations3
Similar to the case of DACs, ADC performance is characterized in terms of offset
and gain errors, differential and integral nonlinearity, and stability. However, ADC
errors are deﬁned in terms of the values of vI at which code transitions occur.
Ideally, these transitions occur at odd multiples of 1
2 LSB, as shown in Fig. 12.5b. In
particular, the ﬁrst transition (000 →001) occurs at vI = 1
2 LSB = 1
16 V, and the
last (110 →111) at vI = VFSV −1
2 LSB = VFSR −3
2 LSB = 13
16 V.
The offset error is the difference between the actual location of the ﬁrst code
transition and 1
2 LSB, and the gain error is the difference between the actual locations
of the last and ﬁrst transition, and the ideal separation of VFSR −2 LSB. Even after
both errors have been nulled, the locations of the remaining code transitions are
likely to deviate from their ideal values, as exempliﬁed in Fig. 12.6.
The dotted curve, representing the locus of the midpoints of the actual code
ranges, is called the code center line. Its maximum deviation from the straight line
0
111
110
101
100
011
010
001
000
b1b2 b3
vI   (V)
3
8
4
8
5
8
6
8
7
8
1
8
2
8
Missing code
FIGURE 12.6
Example of actual ADC characteristic with
missing code.

616
CHAPTER 12
D-A and A-D
Converters
passing through the end points after the offset and gain errors have been nulled
is called the integral nonlinearity (INL). Ideally, code transitions are 1 LSB apart.
The maximum deviation from this ideal value is called the differential nonlinearity
(DNL). If the DNL exceeds 1 LSB, some codes may be skipped at the output. Missing
codes are undesirable in digital control, where they may lead to instability.
In the example shown, the INL error is maximized in connection with the 011
code range, where this error is −1
2 LSB. This range also maximizes the DNL error.
The range width of 2 LSB indicates that DNL = (2 −1) LSB = 1 LSB. Not
suprisingly, there is a missing code. As you investigate INL and DNL errors, make
sure you measure them along the horizontal (or the vertical) axis, not as geometric
distances! As a check, you can use the relationship INLk = k
i=0 DNLi, which
holds also for ADCs.
An A-D conversion takes a certain amount of time to complete. Called the
conversion time, it typically ranges from less than 10 ns to tens of milliseconds,
depending on the conversion method, resolution, and technology.
A practical ADC will produce noise in excess of the theoretical quantization
noise of Eq. (12.4). It will also introduce distortion due to transfer-characteristic
nonlinearities. The effective number of bits is then4
ENOB = S/(N + D) −1.76 dB
6.02
(12.6)
where S/(N + D) is the actual signal-to-noise-plus-distortion ratio, in decibels.
EXAMPLE 12.2.
A 10-bit ADC with VFSR = 10.24 V is found to have S/(N + D) =
56 dB. Find Eq, SNRmax, and ENOB.
Solution. Using Eqs. (12.4) through (12.6) gives Eq = 2.89 mV, SNRmax = 61.97 dB,
and ENOB = 9.01, indicating nine effective bits. In other words, the given 10-bit ADC
yields the same performance as an ideal 9-bit ADC.
12.2
D-A CONVERSION TECHNIQUES
DACs are available in a variety of architectures and technologies.3,4 In this section
we examine the most common examples.
Weighted-Resistor DACs
Equation (12.2) indicates that the functions required to implement an n-bit DAC
are n switches and n binary-weighted variables to synthesize the terms bk2−k, k =
1, 2, . . . , n; moreover, we need an n-input summer, and a reference. The DAC of
Fig. 12.7 uses an op amp to sum n binary-weighted currents derived from VREF
via the current-scaling resistances 2R, 4R, 8R, . . . , 2n R. Whether the current ik =
VREF/2k R appears in the sum depends on whether the corresponding switch is closed
(bk = 1) or open (bk = 0). Writing vO = −R f iO gives
vO = (−R f /R)VREF(b12−1 + b22−2 + · · · + bn2−n)
(12.7)

617
SECTION 12.2
D-A Conversion
Techniques
b1
VREF
b2
b3
SW1
SW2
SW3
SWn
2nR
2R
4R
8R
i1
+
i2
i3
in
iO
Rf
bn
vO
+
–
FIGURE 12.7
Weighted-resistor DAC.
indicating that K = −R f /R. The offset error is nulled by trimming VOS, and the
gain error by adjusting R f . Since the switches are of the virtual-ground type, they
can be implemented with p-channel JFETs in the manner of Fig. 9.37.
The conceptual simplicity of the weighted-resistor DAC is offset by two
drawbacks, namely, the nonzero resistances of the switches, and a spread in the
current-setting resistances that increases exponentially with n. The effect of switch
resistances is to disrupt the binary-weighted relationships of the currents, particularly
in the most signiﬁcant bit positions, where the current-setting resistances are smaller.
These resistances can be made sufﬁciently large to swamp the switch resistances;
however, this may result in unrealistically large resistances in the least signiﬁcant
positions. For instance, an 8-bit DAC requires resistances ranging from 2R to 256R.
The difﬁculty in ensuring accurate ratios over a range this wide, especially in mono-
lithic form, restricts the practicality of resistor-weighted DACs below 6 bits.
Weighted-Capacitor DACs
Complex MOS ICs such as CODECS and microcomputers require on-chip data
conversion capabilities using only MOSFETs and capacitors, which are the natu-
ral components of this technology. The DAC of Fig. 12.8 can be viewed as the
SW1
SW0
SW2
SW3
SWn
2n–1
+
VREF
C
vO
+
–
C
2
C
4
C
2n–1
C
FIGURE 12.8
Weighted-capacitor DAC.

618
CHAPTER 12
D-A and A-D
Converters
switched-capacitor counterpart of the weighted-resistor DAC just discussed. Its heart
is an array of binary-weighted capacitances plus a terminating capacitance equal in
value to the LSB capacitance. Circuit operation alternates between two cycles called
the reset and sample cycles.
During the reset cycle, shown in the ﬁgure, all switches are connected to
ground to completely discharge all capacitors. During the sample cycle, SW0 is
opened while each of the remaining switches is either left at ground or connected
to VREF, depending on whether the corresponding input bit is 0 or 1, respectively.
This results in a redistribution of charge whose effect is to yield a code-dependent
output.
Usingelementarycapacitor-dividerprinciples,wereadilyﬁndvO =VREF Cr/Ct,
where Cr represents the sum of all capacitances connected to VREF, and Ct the to-
tal capacitance of the array. We can write Cr = b1C + b2C/2 + · · · + bnC/2n−1;
moreover, Ct = C + C/2 + · · · + C/2n−1 + C/2n−1 = 2C. Substituting gives
vO = VREF(b12−1 + b22−2 + · · · + bn2−n)
(12.8)
indicating that the sample cycle provides an n-bit D-A conversion with VFSR = VREF.
By the artiﬁce of switching the bottom plates, as shown, the bottom-plate para-
sitic capacitances are connected either to ground or to VREF, without affecting charge
distribution in the active capacitances. Since MOS capacitance ratios are easily con-
trolled to 0.1% accuracies, the weighted-capacitor scheme is suitable for n ≤10. As
with weighted-resistor DACs, the main drawback of this scheme is an exponentially
increasing capacitance spread.
Potentiometric DACs
It is not difﬁcult to imagine the impact that component mismatches in the most
signiﬁcant bit positions of the previous DACs may have on differential nonlinearity
and monotonicity. A potentiometric DAC achieves inherent monotonicity by using
a string of 2n resistors to partition VREF into 2n identical intervals. As depicted in
Fig. 12.9 for n = 3, a binary tree of switches then selects the tap corresponding to
the given input code and connects it to a high-input-impedance ampliﬁer with gain
K = 1 + R2/R1.
No matter how mismatched the resistors, vO will always increase as the ampliﬁer
is switched from one tap to the next, up the ladder, hence the inherent monotonicity.
Another advantage is that if the top and bottom nodes of the resistive string are
biased at some arbitrary voltages VH and VL, the DAC will interpolate between VL
and VH with a resolution of 2n steps. However, the large number of resistors (2n)
and switches (2n+1 −2) required limits practical potentiometric DACs to n ≤8,
even though the switches can be fabricated very efﬁciently in MOS technology.
R-2R Ladders
Most DAC architectures are based on the popular R-2R ladder depicted in Fig. 12.10.
Starting from the right and working toward the left, one can readily prove that the
equivalent resistance to the right of each labeled node equals 2R. Consequently, the

619
SECTION 12.2
D-A Conversion
Techniques
+
R2
R1
R
R
R
R
R
R
R
R
b1
vO
b2
b3
VREF
+
–
FIGURE 12.9
Potentiometric DAC.
current ﬂowing downward, away from each node, is equal to the current ﬂowing
toward the right; moreover, twice this current enters the node from the left. The
currents and, hence, the node voltages are binary-weighted,
ik+1 = 1
2 ik
vk+1 = 1
2 vk
(12.9)
k = 1, 2, . . . , n −1. (Note that the rightmost 2R resistance serves a purely termi-
nating function.)
With a resistance spread of only 2-to-1, R-2R ladders can be fabricated mono-
lithically to a high degree of accuracy and stability. Thin-ﬁlm ladders, fabricated by
deposition on the oxidized silicon surface, lend themselves to accurate laser trim-
ming for DACs with n ≥12. For DACS with a lower number of bits, diffused or
2R
2R
2R
2R
2R
2R
R
R
R
R
2R
+
2R
2R
2R
2R
in
in
ik+1
ik
i2
i1
vn
vk+1
vk
v2
v1
VREF
FIGURE 12.10
R-2R ladder.

620
CHAPTER 12
D-A and A-D
Converters
SW1
b1
b2
b3
bn–1
bn
SW2
SW3
SWn–1
SWn
+
iO
iO
in–1
vO
Rf
+
–
VREF
R
R
R
2R
2R
2R
2R
2R
2R
i1
in
i2
i3
FIGURE 12.11
DAC using a current mode R-2R ladder.
ion-implanted ladders are often adequate. Depending on how the ladder is utilized,
different DAC architectures result.
Current Mode R-2R Ladder
The architecture of Fig. 12.11 derives its name from the fact that it operates on
the ladder currents. These currents are i1 = VREF/2R = (VREF/R)2−1, i2 =
(VREF/2)/2R = (VREF/R)2−2, . . . , in = (VREF/R)2−n, and they are diverted ei-
ther to the ground bus (iO) or to the virtual-ground bus (iO). Using bit bk to identify
the status of SWk, and letting vO = −R f iO gives
vO = −(R f /R)VREF(b12−1 + b22−2 + · · · + bn2−n)
(12.10)
indicating that K = −R f /R. Since iO + iO = (1 −2−n)VREF/R regardless of
the input code, iO is said to be complementary to iO. An important advantage of
the current mode is that the voltage change across each switch is minimal, so charge
injection is virtually eliminated and switch-driver design is made simpler.
We observe that the potential of the iO bus must be sufﬁciently close to that of
the iO bus; otherwise, linearity errors will occur. Thus, in high-resolution DACs, it
is crucial that the overall input offset error of the op amp be nulled and have low
drift.
Voltage Mode R-2R Ladder
In the alternative mode of Fig. 12.12, the 2R resistances are switched between VL
and VH, and the output is obtained from the leftmost ladder node. As the input code
is sequenced through all possible states from 0 . . . 0 to 1 . . . 1, the voltage of this
node changes in steps of 2−n(VH −VL) from VL to VH −2−n(VH −VL). Buffering
it with an ampliﬁer results in the scale factor K = 1 + R2/R1. The advantage of
this scheme is that it allows us to interpolate between any two voltages, neither of
which need necessarily be zero.

621
SECTION 12.2
D-A Conversion
Techniques
SW1
R1
R2
b1
b2
b3
bn–1
bn
VH
VL
SW2
SW3
SWn–1
SWn
+
vO
+
–
+
R
R
R
2R
2R
2R
2R
2R
2R
FIGURE 12.12
DAC using a voltage mode R-2R ladder.
Bipolar DACs
In the architecture exempliﬁed in Fig. 12.13 for n = 4, the R-2R ladder is used to
providethecurrentbiasfornbinary-weightedBJTcurrentsinks;nnonsaturatingBJT
b1
b2
b3
b4
Rr
Rr
VEE
+
+
–
R
R
R
R
16AE
8AE
4AE
2AE
1AE
1AE
2R
2R
2R
2R
2R
Q1
VBIAS
VREF
Q2
Q3
Q4
Q0
Q9
Q4t
iO
iO
FIGURE 12.13
Bipolar DAC.

622
CHAPTER 12
D-A and A-D
Converters
ik
vk
iCk
iEk
⇔
Q1
Qk
Qk
Q2
Q4
Q3
VCC
 VBIAS1
VBIAS2 
IBIAS 
bk
iO
iO
iO
iO
R1
R1
SWk
(b)
(a)
FIGURE 12.14
High-speed current switch.
switches then provide fast current steering, typically in the range of nanoseconds.
The current sinks are Q1 through Q4, with Q4t providing a terminating function. We
observe that for the ladder to work properly, the upper nodes of the 2R resistances
must be equipotential. The voltages at these nodes are set by the emitters of the
current sinks. Since the corresponding currents are in 2:1 ratios, the emitter areas
must be scaled accordingly as 1AE, 2AE, 4AE, and 8AE to ensure identical VBE
drops and, hence, equipotential emitters.
Figure 12.14 shows the details of the kth current-steering switch. For vk >
VBIAS1, Q1 is off and Q2 is on. This, in turn, keeps Q3 off and Q4 on, thus steering
the collector current of Qk to the iO bus. For vk < VBIAS1, the conditions are reversed
and the current of Qk is now diverted to the iO bus. The switching threshold is
typically set at VBIAS1 ∼= 1.4 V to provide both TTL and CMOS compatibility.
We observe that because of the ﬁnite betas of the BJTs, the current losses in
the bases introduce errors. The circuit of Fig. 12.13 uses Q0 to compensate for the
base losses of the current sinks, and Q9 to compensate for the base losses of the
switches. The circuit works as follows: by op amp action, iC9 = VREF/Rr. Using
the BJT relationship iC = αiE, and assuming the same α throughout, we have
iE0 = iC0/α = iE9/α = (iC9/α)/α = (VREF/Rr)/α2. By ladder action, the
emitter current of the kth sink is iEk = iE02−k. The kth current reaching the iO bus is
ik = αiCk = α(αiEk) = α2iE02−k = (VREF/Rr)2−k, indicating the disappearance
of base current errors. Summing the various currents on the iO bus gives
iO = IREF(b12−1 + b22−2 + b32−3 + b42−4)
(12.11)
where IREF = VREF/Rr.

623
SECTION 12.2
D-A Conversion
Techniques
Rf
RL
+
+
VREF
VREF
Rr
Rr
iO
iO
Rr
Rr
vO
Cf
vO
(a)
(b)
+
–
+
–
iO
iO
+
–
FIGURE 12.15
Bipolar DAC output conditioning.
Figure 12.15 shows the two most common ways of converting iO to a voltage.
The purely resistive termination of Fig. 12.15a, giving vO = −RLiO, realizes the
full-speed capability of the DAC as long as RL is sufﬁciently small to render the
effect of the stray output capacitance of the DAC negligible. The output swing is
in this case limited by the voltage compliance of the DAC, as given in the data
sheets. The op amp converter of Fig. 12.15b gives vO = R f iO with a low output
impedance, but at the price of a degradation in dynamics as well as the extra cost of
the op amp. The overall settling time tS can be estimated from the individual settling
times of the DAC and the op amp as
tS =

t2
S(DAC) + t2
S(OA)
(12.12)
The purpose of C f is to stabilize the op amp against the stray output capacitance
of the DAC.5 Suitable op amps for this application are either high-SR, fast-settling
JFET-input types, or CFA types.
Master-Slave DACs
The resolution of the basic structure of Fig. 12.13 can, in principle, be increased
by using additional current sinks; however, maintaining ratioed emitter areas soon
leads to extravagant BJT geometries. The architecture of Fig. 12.16 eases the geom-
etry requirements by combining two DACs of the type just discussed in a master-
slave conﬁguration in which the current of the terminating BJT Q4t of the master
DAC is used to bias the slave DAC. This current, representing 1 LSB of the master
DAC, is partitioned by the slave DAC into four additional binary-weighted cur-
rents, with Q8t now providing the required termination. The result is an 8-bit
DAC with IREF = VREF/Rr and a resolution of IREF/28. Popular master-slave
DACs are the DAC-08 (8-bit) and the DAC-10 (10-bit), both of which settle
within ±1
2 LSB in 85 ns (typical) and provide output voltage compliance down
to −10 V.

Q9
Q0
+
–
Q1
Q2
Q3
Q4
Q4t
R
R
R
16AE
8AE
4AE
2AE
1AE
1AE
Q5
Q6
Q7
Q8
Q8t
R
R
R
8AE
4AE
2AE
1AE
1AE
R
2R
   2R
2R
2R
2R
2R
2R
2R
2R
2R
+
VREF
+
Rr
Rr
VBIAS1
VEE
VBIAS2
iO
iO
SW1
SW2
SW3
SW4
SW5
SW6
SW7
SW8
FIGURE 12.16
Master-slave DAC.
624

625
SECTION 12.2
D-A Conversion
Techniques
–
Q5
Q0
+
–
Q4
Q3
Q2
Q1
1AE
1AE
1AE
1AE
1AE
R
R
R
R
RE
RE
RE
RE
RE
2R
2R
2R
+
VREF
+
Rr
Rr
VBIAS
VEE
Ro
iO
SW3
SW4
SW2
SW1
+
–
vO
+
–
vO ⇒
FIGURE 12.17
DAC using a current-driven R-2R ladder.
Current-Driven R-2R Ladder
The problems stemming from emitter area scaling are eliminated altogether by using
equal-value current sinks and exploiting the current-scaling capability of the R-2R
ladder to obtain binary-weighted contributions to the output. Though Fig. 12.17
shows a 4-bit example, the principle is readily extended to higher values of n. One
can readily show (see Problem 12.8) that the ladder admits a Norton equivalent with
Ro = R and iO = (2VREF/Rr)(b12−1 + b22−2 + b32−3 + b42−4); to reduce clut-
tering, b1 through b4 have been omitted.
The use of suitably small ladder resistances (≤1 k) minimizes the effect of
parasitic capacitances, allowing vO to settle very rapidly. If the output is left ﬂoating,
the DAC will give vO = −RiO = (−2R/Rr)VREFDI with Ro = R. Alternatively,
if zero output impedance is desired, an I-V converter op amp can be used, but at the
price of a longer settling time as per Eq. (12.12).
Segmentation
The matching and tracking capabilities of IC components limit the resolution of the
DAC structures considered so far to n ≤12. However, the areas of precision in-
strumentation and test equipment, process control, industrial weighing systems, and
digital audio playback often require resolutions and linearity performance well in
excess of 12 bits. One of the most important performance requirements is monotonic-
ity. In fact, there are situations in which uniform step size in the DAC characteristics
is more important than exact straight-line conformance. For instance, in process
control, even though the inherent linearity of an input transducer may not surpass

626
CHAPTER 12
D-A and A-D
Converters
0.1% or 10 bits, a higher number of bits is often required to resolve small transducer
variations. Likewise, to ensure a high signal-to-noise ratio, digital audio playback
systems use 16 bits or more of differential linearity, though not necessarily providing
the same level of integral nonlinearity.
In conventional binary-weighted DACs, monotonicity is hardest to realize at the
point of major carry due to the difﬁculty of realizing the required degree of match be-
tween the MSB and the combined sum of all remaining bits. To ensure monotonicity,
this match must be better than one part in 2n−1, indicating that difﬁculty increases
exponentially with n. High-resolution DACs achieve monotonicity by a technique
known as segmentation. Here the reference range is partitioned into a sufﬁciently
large number of contiguous segments, and a DAC of lesser resolution is then used
to interpolate between the extremes of the selected segment. We shall now discuss
this technique for both voltage mode and current mode DACs.
Voltage Mode Segmentation
Figure 12.18 illustrates the segmentation technique utilized by the AD7846 16-bit
DAC. The four MS input bits are decoded to select, via switches SW0 through SW16,
one of sixteen voltage segments available along the resistor string. The selected
segment is then buffered by the voltage followers and used as a reference voltage
of nominal value VREF/16 to drive a 12-bit voltage mode R-2R DAC. The latter, in
turn, partitions the selected segment into 212 = 4096 smaller steps, starting at the
bottom of the segment and ending one step short of the top, to give
vO = VL + D12(VH −VL)
(12.13)
where VH and VL are, respectively, the top and the bottom of the selected segment,
and D12 is the fractional value of the lower 12-bit code. Omitted from the ﬁgure
for simplicity are an input latch register, the segment decoder and switch-driver
circuitry, and an output deglitcher switch.
Since the 65,536 possible output levels consist of 16 groups of 4096 steps each,
the major carry of the 12-bit DAC is repeated in each of the 16 segments. Conse-
quently, the accuracy required of the string resistances to ensure a given differential
nonlinearity is relaxed by a factor of 16. Note, however, that integral nonlinearity
cannot be better than the accuracy of the string resistances. The AD7846 offers 16-
bit monotonicity with an integral linearity error of ±2 LSB, and a 9-μs settling time
to 0.0003%.
Considering that with VREF = 10 V the step size is only 10/216 = 152 μV, op
amp input offset errors could cause intolerable differential nonlinearity if the buffers
were stepped up the ladder in ﬁxed order. This problem is overcome by interchanging
the buffers at each segment transition, a technique referred to as leapfrogging. This,
in turn, requires that VH and VL also be interchanged to preserve the input polarity
to the 12-bit DAC. This function is provided by SWOA1 and SWOA2. The effect of
buffer interchanging can be appreciated as follows.
With the switches positioned as shown, the DAC is processing segment 0.
Denoting the input offset errors of the op amps as VOS1 and VOS2, we have VH =
Vl + VOS1 and VL = 0+ VOS2, where V1 = VREF/16. The last level of segment 0 is
found by inserting these expressions into Eq. (12.13) with D12 = (1 −2−12). This
gives vO(last) = Vl(1 −2−12) + VOS1 −(VOS1 −VOS2)2−12.

627
SECTION 12.2
D-A Conversion
Techniques
SW15
SW14
SW13
SW12
SW11
SW10
SW9
SW8
SW7
SW6
VREF
SW5
SW4
SW3
SW2
SW1
SW0
SW16
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
R
VH
VL
+
–
OA1
SWOA1
vO
SWOA2
+
–
OA2
12-bit
DAC
SEG 15
SEG 14
SEG 13
SEG 12
SEG 11
SEG 10
SEG 9
SEG 8
SEG 7
SEG 6
SEG 5
SEG 4
SEG 3
SEG 2
SEG 1
SEG 0
+
FIGURE 12.18
Simpliﬁed diagram of the AD7846 16-bit segmented DAC. (Courtesy of Analog Devices.)
At the point of transition from segment 0 to segment 1, SW0 is opened, SW1
and SW2 are closed, and SWOA1and SWOA2 are commutated. As a result, we now
have VH = V2 + VOS2 and VL = V1 + VOS1, where V2 = 2V1. Consequently, the
ﬁrst level of segment 1 is vO(ﬁrst) = V1 + VOS1. The difference between the two
levels yields the step size at the ﬁrst major carry,
vO(ﬁrst) −vO(last) = VREF
216 + VOS2 −VOS1
212

628
CHAPTER 12
D-A and A-D
Converters
indicating that the leapfrogging technique reduces the combined offset error by 212.
For instance, assuming |VOS2 −VOS1| ∼= 10 mV, the error term is 10−2/212 =
2.4 μV ≪1 LSB. Similar considerations hold at the remaining segment transitions.
Current Mode Segmentation
Figure 12.19 illustrates segmentation for the case of a 16-bit current-mode R-2R
DAC. The resistances at the left establish 15 current segments of value VREF/R,
so the contribution of each segment to the output is −(R f /R)VREF. The decode
logic examines the 4 MS input bits and diverts to the iO bus 8 such segments for
b1, 4 segments for b2, 2 segments for b3, and 1 segment for b4. The remaining
resistances form an ordinary 12-bit current-mode R-2R DAC, whose contribution to
the output is given by Eq. (12.10). Using the superposition principle, we thus have
vO = −(R f /R)VREF ×(8b1 +4b2 +2b3 +b4 +b52−1 +b62−2 +· · ·+b162−12),
or
vO = −16 R f
R VREF(b12−1 + b22−2 + · · · + b162−16)
(12.14)
indicating a 16-bit conversion with VFSR = −16(R f /R)VREF. We observe that the
segment resistances, like the ladder resistances, need only be accurate to 12 bits to
ensure monotonicity at the 16-bit level. An example of a DAC using this principle
is the MP7616 16-bit CMOS DAC.
Figure 12.20 shows a 16-bit segmented DAC using the current-driven ladder
architecture. Here Q1 through Q7 provide 7 current segments of value VREF/4Rr =
0.25 mA, which a decoder (not shown for simplicity) steers either to the iO bus or to
b5
b6
b7
b16
+
iO
vO
Rf
+
–
VREF
R
R
R
R
R
R
2R
2R
2R
2R
2R
b1
b2
b3
b4
1
2
3
15
Decode logic
15 segments
12-bit DAC
FIGURE 12.19
16-bit segmented DAC using a 12-bit current-mode R-2R ladder.

629
SECTION 12.3
Multiplying DAC
Applications
+
–
Rr
Rr
RE
RE
RE
RE
RE
RE
R
R
R
2R
2R
2R
VEE
VREF
VBIAS
Q1
Q0
Q7
Q2
Q9
Q8
Q20
Q10
+
10 kΩ
10 kΩ
 RE
    
1
4
1AE
4AE
1AE
1AE
1AE
1AE
1AE
1AE
7 segments
13-bit DAC
iO
RE
2R
10.0 V
FIGURE 12.20
16-bit segmented DAC using a 13-bit current-driven R-2R ladder.
ground, depending on the 3 MS bits. Steered to the iO bus are 4 segments for b1, 2
segments for b2, and 1 segment for b3. Moreover, Q8 through Q20, along with the R-
2R ladder, form a 13-bit current-driven DAC. Proper scaling requires an additional
R resistance between the 13-bit DAC and the iO bus. Consequently, the Norton
resistance is now Ro = 2R. By the superposition principle,iO = (VREF/4Rr)(4b1+
2b2 + b3 + b42−1 + b52−2 + · · · + b162−12), or
iO = 2VREF
Rr
(b12−1 + b22−2 + · · · + b162−16)
(12.15)
indicating a 16-bit conversion with IFSR = 2 mA. Two popular examples of 16-bit
monolithic DACs utilizing this architecture are the PCM52/53 and HI-DAC16.
12.3
MULTIPLYING DAC APPLICATIONS
The R-2R ladder DACs of Figs. 12.11 and 12.12 are especially suited to monolithic
fabrication in CMOS technology.6 The switches are implemented with CMOS tran-
sistors, and the ladder and the feedback resistor R f = R are fabricated by thin-ﬁlm
deposition on the CMOS die. Because of process variations, the resistances, though
highly matched, are not necessarily accurate. For instance, a ladder with a nominal
rating of 10 k may in practice lie in the range of 5 k to 20 k.
Figure 12.21 shows the circuit diagram of the kth switch, k = 1, 2, . . . , n. The
switch proper consists of the n-MOS pair M8-M9, while the remaining FETs accept

630
CHAPTER 12
D-A and A-D
Converters
2R
M7
M8
M9
M5
M2
M3
M1
M4
M6
ik
VDD
iO
iO
Logic
input
FIGURE 12.21
CMOS switch for R-2R ladder.
TTL- and CMOS-compatible logic inputs to provide antiphase gate drives for M8
and M9. When the logic input is high, M8 is off and M9 is on, so ik is diverted to
the iO bus. When the input is low, M8 is on, M9 is off, and ik is now diverted to the
iO bus.
The nonzero resistance rds(on) of the switches tends to disrupt the 2:1 ratio of
the ladder resistances and degrade performance. Since rds(on) is proportional to the
ratio of the channel length L to the channel width W, it could be minimized by
fabricating M8 and M9 with L/W ≪1; this, however, would lead to extravagant
device geometries. A common technique for overcoming this drawback is to ta-
per switch geometries to achieve, at least in the MS bit positions, binary-weighted
switch resistances such as rds1(on) = 20 , rds2(on) = 40 , rds3(on) = 80 ,
and so on. Since the currents halve as the switch resistances double, the product
rdsk(on) × ik remains constant throughout the tapered bit positions, causing a sys-
tematic switch voltage drop, whose value is typically 10 mV. Since this drop is effec-
tively being subtracted from VREF, the result is a gain error that is readily trimmed by
adjusting R f .
EXAMPLE 12.3.
A CMOS DAC with n = 12 is operated in the current mode depicted
in Fig. 12.11. If VREF = 10.0 V and the DAC is calibrated at 25 ◦C, specify TC(VREF)
and TC(VOS) so that the individual drift errors contributed by the reference and the op
amp are less than ± 1
4 LSB over the operating range of 0 ◦C to 70 ◦C.
Solution.
We have 1
4 LSB = 10.0/214 = 0.61 mV. Since the maximum temperature
excursion from the point of calibration is 70◦−25◦= 45 ◦C, the individual drifts must not
exceed ±0.61 × 10−3/45 ∼= ±13.6 μV/◦C. This gives TCmax(VREF) = ±1.36 ppm/◦C.
Moreover, using a conservative estimate of 2 V/V for the noise gain of the op amp, we
have TCmax(VOS) ∼= ±13.6/2 = ±6.8 μV/◦C.
In the following we shall use the functional diagram of Fig. 12.22 to represent
a CMOS DAC. This structure is available from various manufacturers in a range of
resolutions (8 to 14 bits) and conﬁgurations (single, dual, quad, and octal packages).
Many versions include input buffer latches to facilitate microprocessor interfacing.

631
SECTION 12.3
Multiplying DAC
Applications
R
R
Gnd
b1
bn
DI
Rf
VCC
iO
iO
VREF
2R
2R
2R
FIGURE 12.22
Functional diagram of a multiplying DAC.
Depending on resolution, settling times range from under 100 ns to over 1 μs. One
of the earliest and most popular families of CMOS DACs is the AD7500 series.
MDAC Applications
The reference voltage of a CMOS DAC can be varied over positive as well as negative
values,includingzero.ThisinherentmultiplicativeabilitymakesCMOSDACs,aptly
called MDACs, suited to a variety of digitally programmable applications.6
The circuits of Fig. 12.23 provide, respectively, digitally programmable attenu-
ation and ampliﬁcation. Using Eq. (12.10) with R f = R, we ﬁnd that the attenuator
n
D
+
VREF
+
–
iO
iO
Rf
vO
vI
vI
(a)
n
D
+
VREF
iO
iO
Rf
vO
(b)
+
–
FIGURE 12.23
(a) Digitally programmable attenuator: vO = −DvI; (b) digitally programmable ampliﬁer:
vO = (−1/D)vI.

632
CHAPTER 12
D-A and A-D
Converters
MDAC1
+
Vi
iO
VLP
VHP
VBP
Rf
R3
R2
R4
R5
C
+
–
OA4
+
–
OA2
R1
+
–
OA1
R5
C
+
–
OA3
VREF
iO
MDAC2
iO
Rf
+
–
OA5
VREF
iO
n
D
n
FIGURE 12.24
Digitally programmable ﬁlter.
of Fig. 12.23a gives vO = −DvI , so its gain A = −D is programmable from 0 to
−(1 −2−n) V/V ∼= −1 V/V in steps of 2−n V/V. In the ampliﬁer of Fig. 12.23b we
have vI = −DvO, or vO = (−1/D)vI . Its gain A = −1/D is programmable from
−1/(1−2−n) ∼= −1 V/V when all bits are 1, to −2 V/V when b1b2 . . . bn = 10 . . . 0,
to 2n V/V when b1 . . . bn−1bn = 0 . . . 01, to the full open-loop gain a when all bits
are 0. To combat the effect of the stray capacitance of the iO bus, it is advisable to
connect a stabilizing capacitance C f of a few tens of picofarads between the output
and the inverting input of the op amp.5
If we cascade the attenuator of Fig. 12.23a with a Miller integrator having
unity-gain frequency ω1, the transfer function of the composite circuit is H =
(−D) × [−1/( jω/ω1)] = 1/( jω/Dω1). This represents a noninverting integrator
with a digitally programmable unity-gain frequency of Dω1. Such an integrator can
be used to implement a digitally programmable ﬁlter. The ﬁlter example of Fig. 12.24
is a state-variable topology of the type encountered in Fig. 4.37, so we can reuse
Eq. (4.34) and write
ω0 = D

R2/R4/R5C
Q = R3/

R2R4
(12.16a)
H0HP = −R2/R1
H0BP = −R3/R1
H0LP = −R4/R1
(12.16b)
indicating that we can program ω0 digitally from 2−n√R2/R4/R5C to (1 −2−n)
√R2/R4/R5C. Once we have a digitally programmable ﬁlter, we can readily turn
it into a digitally programmable oscillator by letting Q →∞(see Problem 12.12).
EXAMPLE 12.4. In the circuit of Fig. 12.24 specify suitable components for Q = 1/
√
2,
H0BP = −1 V/V, and f0 digitally programmable in 10-Hz steps by means of 10-bit
MDACs.

633
SECTION 12.3
Multiplying DAC
Applications
Solution.
Impose R2 = R4 = 10.0 k, and let C = 1.0 nF. Then, the full-scale range
is f0(FSR) = 210 × 10 = 10.24 kHz, so R5 = 1/(2π10, 240 × 10−9) = 15.54 k (use
15.4 k, 1%).
Use fast op amps with low-input-offset error and noise characteristics and wide
dynamics, such as the OPA627 JFET-input op amps. To avoid high-frequency Q en-
hancement, phase-error compensation may be required, as discussed in Section 6.5.
Figure 12.25 shows a digitally programmable waveform generator. The cir-
cuit is similar to that encountered in Fig. 10.19a, except for the use of an MDAC
to control the rate of capacitance charge/discharge digitally. To avoid the uncer-
tainties of the ladder resistances, the MDAC is current-driven using the REF200
100-μA current source. When vSQ is high, IREF enters the MDAC; when vSQ is
low, IREF exits the MDAC. In either case the MDAC divides this current to give
iO = ± DIREF. To ﬁnd the frequency of oscillation f0, apply Eq. (10.2) with
t = 1/(2 f0), I = DIREF, and v = 2VT = 2(R1/R2)Vclamp, where Vclamp =
2VD(on) + VZ5. The result is
f0 = D (R2/R1)IREF
4CVclamp
(12.17)
indicating that f0 is linearly proportional to D.
EXAMPLE 12.5. In the circuit of Fig. 12.25 specify suitable components for 5-V wave-
form amplitudes and f0 digitally programmable in 1-Hz steps by means of a 12-bit
MDAC.
Solution.
For Vclamp = 5 V, use VZ5 = 3.6 V. Moreover, use R1 = R2 = 20 k and
R3 = 6.2 k. The full-scale range is f0(FSR) = 212 × 1 = 4.096 kHz, so Eq. (12.17)
gives C = 100×10−6/(20 × 4096) = 1.22 nF (use 1.0 nF, which is more easily available,
and raise R1 to 24.3 k, 1%). Use a low-offset JFET-input op amp for OA, and a high
slew-rate op amp for CMP.
IREF
D2
D4
D1
D3
D7
D9
D6
D8
D5
iO
+
–
OA
VREF
vTR
vSQ
iO
n
D
C
R1
R2
R3
+
–
CMP
REF200
FIGURE 12.25
Digitally programmable triangular/square-wave oscillator.

634
CHAPTER 12
D-A and A-D
Converters
12.4
A-D CONVERSION TECHNIQUES
This section discusses popular ADC techniques, such as DAC-based ADCs, ﬂash
ADCs, integrating ADCs, and variants thereof.3,4 A more recent technique, known
as sigma-delta (-) conversion, is addressed in Section 12.5.
DAC-Based A-D Conversion
A-D conversion can be accomplished by using a DAC and a suitable register to adjust
the DAC’s input code until the DAC’s output comes within ±1
2 LSB of the analog
input. The code that achieves this is the desired ADC output b1 . . . bn. As shown
in Fig. 12.26, this technique requires suitable logic circuitry to direct the register
to perform the code search on the arrival of the START command, and a voltage
comparator to announce when vO has come within ±1
2 LSB of vI and thus issue an
end-of-conversion (EOC) command. Moreover, to center the analog range properly,
the DAC output must be offset by +1
2 LSB, per Fig. 12.5b.
The simplest code search is a sequential search, obtained by operating the
register as a binary counter. As the counter steps through consecutive codes starting
from 0 . . . 0, the DAC produces an increasing staircase, which the comparator then
compares against vI . As soon as this staircase reaches vI , CMP ﬁres and stops the
counter. This also serves as an EOC command to notify that the desired code is
sitting in the counter. The counter must be stepped at a low enough frequency to
allow for the DAC to settle within each clock cycle. Considering that a conversion
can take as many as 2n −1 clock periods, this technique is limited to low-speed
applications. For example, a 12-bit ADC with a 1-MHz counter clock will take
(212 −1) μs = 4.095 ms to convert a full-scale input.
vO
VREF
+
–
CMP
Register
CK
EOC
START
DAC
b1
b1
bn
DO
bn
b1
bn
+
vI
FIGURE 12.26
Functional diagram of a DAC-based ADC.

635
SECTION 12.4
A-D Conversion
Techniques
A better approach is to allow the counter to start counting from the most recent
code rather than restarting from zero. If vI has not changed drastically since the last
conversion, fewer counts will be needed for vO to catch up with vI . Also referred
to as a tracking or a servo converter, this scheme uses the register as an up/down
counter with the count direction controlled by the comparator: counting will be up
when vO < vI , and down when vO > vI . Whenever vO crosses vI , the comparator
changes state and this is taken as an EOC command. Clearly, conversions will be
relatively fast only as long as vI does not change too rapidly between consecutive
conversions. For a full-scale change, the conversion will still take 2n −1 clock
periods.
The fastest code-search strategy uses binary search techniques to complete an
n-bit conversion in just n clock periods, regardless of vI . Following is a description
of two implementations: the successive-approximation and the charge-redistribution
ADCs.
Successive-Approximation Converters (SA ADCs)
This technique uses the register as a successive-approximation register (SAR) to
ﬁnd each bit by trial and error. Starting from the MSB, the SAR inserts a trial 1 and
then interrogates the comparator to ﬁnd whether this causes vO to rise above vI . If
it does, the trial bit is changed back to 0; otherwise it is left as 1. The procedure is
then repeated for all subsequent bits, one bit at a time, in a way similar to a chemist’s
balance. Figure 12.27 illustrates how a 10.8-V input is converted to a 4-bit code
with VFSR = 16 V. The analog range, in volts, is at the left, and the digital codes at
the right. To ensure correct results, the DAC output must be offset by −1
2 LSB, or
−0.5 V in our example. The conversion takes place as follows.
Following the arrival of the START command, the SAR sets b1 to 1 with all
remaining bits at 0 so that the trial code is 1000. This causes the DAC to output
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
0000
0001
0010
0011
0100
0101
0110
0111
1000
1001
1010
1011
1100
1101
1110
1111
T1
T2
T3
T4
FIGURE 12.27
Idealized DAC output for the 4-bit successive-
approximation conversion of vI = 10.8 V with
VFSR = 16 V.

636
CHAPTER 12
D-A and A-D
Converters
vO = 16(1 × 2−1 + 0 × 2−2 + 0 × 2−3 + 0 × 2−4) −0.5 = 7.5 V. At the end of
clock period T1, vO is compared against vI , and since 7.5 < 10.8, b1 is left at 1.
At the beginning of T2, b2 is set to 1, so the trial code is now 1100 and vO =
16(2−1 + 2−2) −0.5 = 11.5 V. Since 11.5 > 10.8, b2 is changed back to 0 at the
end of T2.
At the beginning of T3, b3 is set to 1, so the trial code is 1010 and vO =
10 −0.5 = 9.5 V. Since 9.5 < 10.8, b3 is left at 1.
At the beginning of T4, b4 is set to 1, so the trial code is 1011 and vO =
11 −0.5 = 10.5 V. Since 10.5 < 10.8, b4 is left at 1. Thus, when leaving T4, the
SAR has generated the code 1011, which ideally corresponds to 11 V. Note that any
voltage in the range 10.5 V < vI < 11.5 V would have led to the same code.
Since the entire conversion takes a total of n clock cycles, an SA ADC offers a
major speed improvement over a sequential-search ADC. For instance, a 12-bit SA
ADC with a clock frequency of 1 MHz will complete a conversion in 12 μs.
Figure 12.28 shows an actual implementation7 using the Am2504 SAR and
the Am6012 bipolar DAC, whose settling time is 250 ns, along with the CMP-05
comparator, whose response time to a 1.2-mV overdrive (1
2 LSB) is 125 ns maximum.
iO
iO
b1
Am6012
COMP
MSB
LSB
START
Am2504
ENABLE
START
CLK
D
EOC
1
15
14
b2
2
b3
3
b4
4
b5
5
b6
6
b7
7
b8
8
b9
9
b10
10
b11
11
b12
Q11 Q10 Q9 Q8 Q7 Q6 Q5 Q4 Q3 Q2 Q1 Q0
12
21
14
13
11
1
3
20 19 18 17 16
9
8
7
6
5
4
–
+
20 MΩ
10 kΩ
2 MHz
10 kΩ
R
2.5 kΩ
+
vI
(0 to 10 V)
–
+
CMP-05
EOC
+15 V
+15 V
–15 V
REF-01
10.0 V
18
17
16
20
19
0.01 μF
FIGURE 12.28
12-bit, 6-μs successive-approximation ADC.

637
SECTION 12.4
A-D Conversion
Techniques
The desired output code is available both in parallel form from Q0 through Q11, or
in serial form at the data pin D.
To take full advantage of the bipolar DAC speed, iO is converted to a voltage for
the comparator via simple resistive termination. Since its input is vD = vI −RiO,
the comparator is in effect comparing iO against vI /R. The function of the 20-M
resistance is to provide the required −1
2-LSB shift, and that of the Schottky diodes
is to limit the voltage swing at the comparator input in order to reduce delays caused
by the stray output capacitance of the DAC.
The primary factors affecting the speed of an SA ADC are the settling time
of the DAC and the response time of the comparator. The conversion time can be
further reduced by a number of ingenious techniques,7 such as comparator speed-up
techniques, or variable-clock techniques, which exploit the faster settling times in
the least signiﬁcant bit positions.
The resolution of an SA ADC is limited by the resolution and linearity of the
DAC, and the gain of the comparator. A crucial requirement is that the DAC be
monotonic to prevent the occurrence of missing codes. The comparator, besides
adequate speed, must provide enough gain to magnify an LSB step to a full output
logic swing, or a ≥(VOH −VOL)/(VFSR/2n). For instance, with VOH = 5 V,
VOL = 0 V, VFSR = 10 V, and n = 12, we need a ≥2048 V/V. Another important
requirement is that during conversion vI remain constant within ±1
2 LSB; otherwise
an erroneous code may result. For instance, if vI were to rise above 11.5 V after the
second clock period in Fig. 12.27, there would be no way for the SAR to go back
and change b2, so a wrong output code would result. This is avoided by preceding
the ADC with a suitable SHA.
SA ADCs are available from a variety of sources and in a wide range of perfor-
mance characteristics and prices. Conversion times typically range from under 1 μs
for the faster 8-bit units to tens of microseconds for the high-resolution (n ≥14)
types. SA ADCs equipped with an on-chip SHA are referred to as sampling ADCs.
A popular example is the AD1674 12-bit, 100-kilosamples per second (ksps) SA
ADC.
Charge-Redistribution Converters (CR ADCs)
The circuit of Fig. 12.29 performs a successive-approximation conversion using a
weighted-capacitor DAC of the type of Fig. 12.8. Its operation involves three cycles
called the sample, hold, and redistribution cycles.
During the sample cycle, SW0 grounds the top-plate bus while SWi and SW1
through SWn+1 connect the bottom plates to vI , thus precharging the entire capacitor
array to vI .
During the hold cycle, SW0 is opened and the bottom plates are switched to
ground, thus causing the top-plate voltage to swing to −vI . The voltage presented
to the comparator at the end of this cycle is thus vP = −vI .
During the redistribution cycle, SW0 is still open, SWi is connected to VREF,
and the remaining switches are sequentially ﬂipped from ground to VREF, and
possibly back to ground, to perform a successive-approximation search for the
desired code.

638
CHAPTER 12
D-A and A-D
Converters
SWn+1
C
CMP
2n–1
SWn
C
2n–1
SW3
C
4
SW2
C
2
SW1
C
SW0
+
vI
bn
b3
b2
b1
vP
SWi
+
VREF
SAR and control logic
START
CK
EOC
–
+
FIGURE 12.29
Charge-redistribution ADC.
Flipping a given switch SWk from ground to VREF causes vP to increase by the
amount VREF(C/2k−1)/Ct = VREF2−k. If it is found that this increase causes the
comparator to change state, then SWk is returned to ground; otherwise it is left at
VREF and the next switch is tried. This procedure is repeated at each bit position,
starting from the MSB and progressing down to the LSB (excluding the terminating
capacitor switch, which is left permanently grounded). It is readily seen that at the
end of the search the voltage presented to the comparator is
vP = −vI + VREF(b12−1 + b22−2 + · · · + bn2−n)
and that vP is within ±1
2 LSB of 0 V. Thus, the ﬁnal switch pattern provides the
desired output code.
Because of the exponential increase of capacitance spread with n, practical CR
ADCs are limited to n ≤10. One way to increase resolution is to combine charge
redistribution with potentiometric techniques,2 as exempliﬁed in Fig. 12.30. Here
a resistor string partitions VREF into 2nH inherently monotonic voltage segments,
and an nL-bit weighted-capacitor DAC interpolates within the selected segment. As
long as the capacitances are ratio-accurate to nL bits, the composite DAC will retain
monotonicity to n = nH + nL bits, so using it as part of an SA conversion will avoid
missing codes. A conversion proceeds as follows.
Initially, SW f is closed to autozero the comparator, and the bottom plates are
connectedviathe L busand SWL totheanaloginputvI .Thisprechargesthecapacitor
array to vI minus the comparator’s threshold voltage, thus removing this threshold
as a possible source of error.
Next, SW f is opened, and an SA search among the resistor string taps is per-
formed to ﬁnd the segment within which the voltage held in the capacitor array lies.
The outcome of this search is the nH-bit portion of the desired code.
Once the segment has been found, the H and L busses are connected to the
extremes of the corresponding resistor, and a second SA search is performed to ﬁnd
the individual bottom-plate switch settings that make the comparator input converge

639
SECTION 12.4
A-D Conversion
Techniques
C
2nL–1
C
2nL–1
C
4
C
2
H
L
C
bnH+nL
b2
b1
SWH
SWf
SAR and
switch control logic
To resistor
switches
To capacitor switches
START
EOC
+
vI
SWL
+
VREF
CK
R
SEG 2nH –1
R
SEG 2nH –2
R
SEG 2nH –3
R
SEG 2
R
SEG 1
R
SEG 0
CMP
–
+
FIGURE 12.30
High-resolution charge-redistribution ADC.
to its threshold. The outcome of this search is the nL-bit portion of the desired code.
For instance, with nH = 4 and nL = 8, the circuit provides 12 bits of resolution
without excessive demands in terms of circuit complexity or capacitance spread and
matching.
Before concluding, we wish to point out that the analog input, conveniently
represented in terms of an ideal voltage source vI in both Figs. 11.29 and 11.30, is
likely to be the output of a buffer/ampliﬁer, whose nonzero output impedance may
cause conversion inaccuracies, not to mention the stability problems associated with
capacitive loads. A common cure is to interpose a suitable decoupling R-C network
between the driver and the ADC (consult the literature and application notes for
guidelines on the optimal selection of the R-C values2).
Flash Converters
The circuit of Fig. 12.31 uses a resistor string to create 2n −1 reference levels
separated from each other by 1 LSB, and a bank of 2n −1 high-speed latched
comparators to simultaneously compare vI against each level. Note that to position
the analog signal range properly, the top and bottom resistors must be 1.5R and 0.5R,
as shown. As the comparators are strobed by the clock, the ones whose reference
levels are below vI will output a logic 1, and the remaining ones a logic 0. The
result, referred to as a bar graph, or also as a thermometer code, is then converted to
the desired output code b1 . . . bn by a suitable decoder, such as a priority encoder.
Since input sampling and latching take place during the ﬁrst phase of the clock

640
CHAPTER 12
D-A and A-D
Converters
0.5R
R
R
R
R
1.5R
+
VREF
2n – 1
2n – 2
3
2
1
+
vI
Decoder
CK
bn
b2
b1
FIGURE 12.31
n-bit ﬂash converter.
period, and decoding during the second phase, the entire conversion takes only one
clock cycle, so this ADC is the fastest possible. Aptly called a ﬂash converter, it is
used in high-speed applications, such as video and radar signal processing, where
conversion rates on the order of millions of samples per second (Msps) are required,
and SA ADCs are generally not fast enough.
The high-speed and inherent-sampling advantages of ﬂash ADCs are offset by
the fact that 2n −1 comparators are required. For instance, an 8-bit converter requires
255 comparators. The exponential increase with n in die area, power dissipation, and
stray input capacitance makes ﬂash converters impractical for n > 10. Flash ADCs
are available in bipolar or in CMOS technology, with resolutions of 6, 8, and 10 bits,
sampling rates of tens to hundreds of Msps, depending on resolution, and power
dissipation ratings on the order of 1 W or less. Consult the catalogs to familiarize
yourself with the range of available products.
Subranging Converters
Subranging ADCs trade speed for circuit complexity by splitting the conversion
into two subtasks, each requiring less complex circuitry. Also called a two-step, or
a half-ﬂash converter, this architecture uses a coarse ﬂash ADC to provide an n-bit
accurate digitization of the nH most-signiﬁcant bits. These bits are then fed to a
high-speed, n-bit accurate DAC to provide a coarse approximation to the analog
input. The difference between this input and the DAC output, called the residue, is
magniﬁed by 2nH V/V by an ampliﬁer called the residue ampliﬁer (RA), and ﬁnally
fed to a ﬁne ﬂash ADC for the digitization of the nL least-signiﬁcant bits of the n-bit

641
SECTION 12.4
A-D Conversion
Techniques
Coarse 
flash
ADC
SHA
24
DAC
Fine 
flash
ADC
Σ
vI
+
–
vRES
RA
VREF
b1
f1
b2 b3 b4
b5 b6 b7 b8
φ
f2
φ
FIGURE 12.32
8-bit subranging ADC. (Note that DAC must be 8-bit accurate.)
code, where n = nH + nL. Note that the half-ﬂash requires an SHA to hold the
value of vI during the digitization of the residue.
Figure 12.32 exempliﬁes an 8-bit converter with nL = nH = 4. Besides the
SHA, the DAC, and the RA, the circuit uses 2(24 −1) = 30 comparators, indicat-
ing a substantial saving compared to the 255 comparators required by a full-ﬂash.
(This saving is even more dramatic for n ≥10.) The main price for this saving is a
longer conversion time, with the ﬁrst phase comprising the conversion time of the
coarse ADC, the acquisition time of the SHA, and the settling time of the DAC-
subtractor-RA block, and the second phase comprising the conversion time of the
ﬁne ADC. Moreover, the requirement that the DAC be n-bit accurate may be a heavy
requirement.
Subranging ADCs, though not as fast as full-ﬂash ADCs, are still comparably
faster than SA ADCs, so the subranging architecture, or variants4 thereof, is used in
a number of high-speed ADC products.
Pipelined Converters
Pipelined ADCs break down the conversion task into a sequence of N serial subtasks,
and use SHA interstage isolation to allow for the individual subtasks to proceed
concurrently to achieve high throughput rates. With reference to Fig. 12.33, each
subtask stage consists of an SHA, an ADC, a DAC, a subtractor, and an RA, with
+
–
Σ
SHA
Stage
1
Stage
j
Stage
N
2k
vI
RA
k
f1
φ
fj
φ
fN
φ
k-bit
ADC
k-bit
DAC
FIGURE 12.33
Pipeline ADC architecture.

642
CHAPTER 12
D-A and A-D
Converters
some or even all functions often combined in one circuit.4 The ﬁrst stage samples
vI , digitizes k bits, and uses a DAC-subtractor-RA circuit to create a residue for
the next stage in the pipeline. The next stage samples the incoming residue and
performs a similar sequence of operations while the previous stage begins processing
the next sample. The ability of the various stages to operate concurrently makes
the conversion rate depend on the speed of only one stage, usually the ﬁrst stage.
Pipelined structures are used in a variety of formats, including the case k = 1, which
results in the simplest per-stage circuitry, though n such stages are needed. However,
if stages are reused, considerable savings in die area can be achieved.
Integrating-Type Converters
These converters perform A-D conversion indirectly by converting the analog input
to a linear function of time and thence to a digital code. The two most common
converter types are the charge-balancing and dual-slope ADCs.
Charge-balancing ADCs convert the input signal to a frequency, which is then
measured by a counter and converted to an output code proportional to the analog
input.8 These converters are suited to applications where it is desired to exploit the
ease with which a frequency is transmitted in noisy environments or in isolated form,
such as telemetry. However, as seen in Section 10.7, the transfer characteristic of a
VFC depends on an RC product whose value is not easily maintained with temper-
ature and time. This drawback is ingeniously overcome by dual-slope converters.
As shown in the functional diagram of Fig. 12.34, a dual-slope ADC, also called
a dual-ramp ADC, is based on a high-input-impedance buffer, a precision integrator,
and a voltage comparator. The circuit ﬁrst integrates the input signal vI for a ﬁxed
duration of 2n clock periods, and then it integrates an internal reference VREF of
opposite polarity until the integrator output is brought back to zero. The number N
R
C
CAZ
b1
b2
bn
SW1
SW2
v2
VREF
+
–
OA1
+
–
OA2
+
–
CMP
+
vI
+
Control
logic
START
EOC
CK
Counter
FIGURE 12.34
Functional diagram of a dual-slope ADC.

643
SECTION 12.4
A-D Conversion
Techniques
v2
v2
t
Autozero
–vI/RC
Integrate vI
Integrate –VREF
Autozero
2n cycles
N cycles
Δ
VREF/RC
FIGURE 12.35
Dual-slope waveform.
of clock cycles required to return to zero is proportional to the value of vI averaged
over the integration period. Consequently, N represents the desired output code. With
reference to the waveform diagram of Fig. 12.35, following is a detailed description
of how the circuit operates.
Prior to the arrival of the START command, SW1 is connected to ground and
SW2 closes a loop around the integrator-comparator combination. This forces the
autozero capacitance CAZ to develop whatever voltage is needed to bring the output
of OA2 right to the comparator’s threshold voltage and leave it there. This phase,
referred to as the autozero phase, provides simultaneous compensation for the input
offset voltages of all three ampliﬁers. During the subsequent phases, when SW2
opens, CAZ acts as an analog memory to hold the voltage required to keep the net
offset nulled.
At the arrival of the START command, the control logic opens SW2, connects
SW1 to vI (which we assume to be positive), and enables the counter, starting from
zero. This phase is called the signal integrate phase. As the integrator ramps down-
ward, the counter counts until, 2n clock periods later, it overﬂows. This marks the
end of the current phase. The swing v2 described by the integrator during this
interval is found via Eq. (10.2) as Cv2 = (vI /R) × 2n × TCK, where TCK is the
clock period, and vI the average of vI over 2nTCK.
As the overﬂow condition is reached, the counter resets automatically to zero
and SW1 is connected to −VREF, causing v2 to ramp upward. This is called the
deintegrate phase. Once v2 again reaches the comparator threshold, the comparator
ﬁres to stop the counter and issues an EOC command. The accumulated count N is
such that Cv2 = (VREF/R)NTCK. Since Cv2 is the same during the two phases,
we get
N = 2n vI
VREF
(12.18)
We make a number of important observations.
1. The conversion accuracy is independent of R, C, TCK, and the input offset volt-
age of the three ampliﬁers. As long as these parameters remain stable over the
conversion period, they affect the two integration phases equally, so long-term
drifts are automatically eliminated.

644
CHAPTER 12
D-A and A-D
Converters
2. An integrating ADC offers excellent linearity and resolution, and virtually zero
differential nonlinearity. With an integrator of suitable quality, nonlinearity errors
can be kept below 0.01%, and resolution can be pushed above 20 bits. Moreover,
since v2 is a continuous function of time, differential nonlinearity, within the
limits of clock jitter, is virtually absent, so there are no missing codes.
3. A dual-slope ADC provides excellent rejection of ac noise components with
frequencies that are integral multiples of 1/(2nTCK). For instance, if we specify
TCK so that 2nTCK is a multiple of 1/60 = 16.67 ms, then any 60-Hz pickup
noise superimposed on the input signal will be averaged to zero. In particular, if
2nTCK = 100 ms, the ADC will reject both 50-Hz and 60-Hz noise.
4. An integrating converter does not require an SHA at the input. If vI changes, the
converter will simply average it out over the signal-integrate period.
The main drawback of dual-slope ADCs is a low conversion rate. For instance,
imposing 2nTCK = 1/60 and allowing as many clock periods to complete the
deintegrate phase for a full-scale input, it follows that the conversion rate is less
than 30 sps. These converters are suited to highly accurate measurements of slowly
varying signals, as in thermocouple measurements, weighing scales, and digital
multimeters.
Dual-slope ADC ICs are available from a variety of sources, usually in CMOS
technology. Besides autozero capabilities, they offer automatic input polarity sens-
ing and reference polarity switching to provide sign and magnitude information.
Moreover, they are available both in microprocessor-compatible and in display-
oriented versions. The latter provides the output code in a format suitable for driving
decimal LCD or LED displays, and their resolution is expressed in terms of deci-
mal digits rather than bits. Since the leftmost digit is usually allowed to run only
to unity, it is counted as 1
2 digit. Thus, a 41
2-digit sign-plus-magnitude ADC hav-
ing VFSR = 200 mV yields all decimal codes within the range of ±199.99 mV and
with a resolution of 10 μV. An example is the ICL7129 41
2-digit ADC, which, with
the help of suitable support circuitry, is easily turned into a full-ﬂedged multimeter
to measure both dc and ac voltages and currents, as well as resistances.
We are now able to compare the circuit complexity and the required clock-cycles
for the architectures discussed so far:
Flash
Pipeline
SA
Integrating
Complexity :
2n
n
1
1
Conversion :
1
1
n
2n
12.5
OVERSAMPLING CONVERTERS
It is apparent that the most critical part of a data converter is its analog circuitry.
Because of component mismatches and nonlinearities, drift and aging, noise, dy-
namic limitations and parasitics, resolution and speed can be pushed only so far.
Oversampling converters ease analog-circuitry requirements at the expense of more
complex digital circuitry. These converters are ideal for mixed-mode IC fabrication
processes, where fast digital-processing circuitry is far more easily implemented
than precise analog circuitry. The principal beneﬁts of oversampling followed by

645
SECTION 12.5
Oversampling
Converters
digital ﬁltering are relaxed analog-ﬁlter requirements and quantization-noise re-
duction. Sigma-delta (-) converters combine with these beneﬁts the additional
beneﬁt of noise shaping to achieve truly high resolutions (≥16 bits) with the simplest
analog circuitry (1-bit digitizers).
Before embarking on the study of oversampling and noise shaping, we need
to examine in greater detail conventional sampling, also referred to as Nyquist-rate
sampling.
Nyquist-Rate Sampling
The digitization process, depicted in Fig. 12.36a, has a profound impact on the
frequency spectrum of the input signal. We are primarily interested in the situation
from dc to the sampling frequency fS. As depicted in Fig. 12.36b, this range consists
of two zones, namely, zone I extending from dc to fS/2, and zone II extending from
fS/2 to fS. Zone I is also called the baseband, and fS/2 is called the Nyquist
bandwidth. The effects of digitization are twofold:1
1. Digitization, viewed as discretization in time, creates additonal spectral compo-
nents, called images, at locations symmetric about the midpoint fS/2; for in-
stance, a spectral component of vI at f = fI results in an image at f = fS −fI ,
as shown in Fig. 12.36b, top.
2. Digitization, viewed as discretization in amplitude, introduces quantization noise,
as discussed in Section 12.1. The noise power of vI folds into the baseband, in
the manner depicted in Fig. 12.36b, bottom.
If vI is a relatively active or busy signal, its quantization noise can, under certain
conditions,9,10 be treated as white noise with spectral density
eq =
q
√fS/2
(12.19)
0
Zone I
Zone II
f
Amplitude
fB
fS/2
fS
fS
eq
vI
DO
fS – fB
fS – fI
fI
Amin
0
0
Sampling
ADC
Antialiasing
filter
f
fS/2
n
(b)
(a)
fS/2
q/ 
FIGURE 12.36
Nyquist sampling with analog ﬁltering.

646
CHAPTER 12
D-A and A-D
Converters
where q = VFSR/2n√
12. The rms value is
Eq =
 fS/2
0
e2
q d f
1/2
= q
(12.20)
or Eq = VFSR/2n√
12, in accordance with Eq. (12.4). As we know, this results in
SNRmax = 6.02n + 1.76 dB
(12.21)
With reference to Fig. 12.36b, top, we observe that as long as all spectral compo-
nents of vI lie within zone I, their images will be conﬁned within zone II. Processing
the spectrum of the digitized signal with a low-pass ﬁlter having a cutoff frequency
of fS/2 will pass the baseband components and block their images, thus allowing
for the full recovery of the spectrum of vI . This spectrum can, in turn, be used to
reconstruct vI itself. However, should vI possess spectral components in zone II,
their images will creep into zone I, overlapping the legitimate components there and
causing nonlinear distortion. This phenomenon, referred to as aliasing, introduces
an ambiguity that prevents the recovery of the spectrum of vI . Nyquist’s criterion
states that if we want to recover or reconstruct a signal of a given bandwidth fB
from its digitized version, the sampling rate fS must be such that
fS > 2 fB
(12.22)
where 2 fB is called the Nyquist rate. This requirement can be met either by band-
limiting vI below fS/2, or by raising fS above the Nyquist rate.
A familiar aliasing example is offered by the spoked wheels of a stagecoach
in a 16-mm, 24-frames-per-second Western. As long as the coach travels slowly
enough relative to the camera’s sampling rate of 24 frames per second, its wheels
will appear to be turning correctly. However, as the coach speeds up, a point is
reached where the wheels will appear to be slowing down, indicating an alias, or
unwanted frequency, near the upper end of the baseband. Speeding up further will
lower the alias frequency until it reaches dc, where the wheels will appear to be still.
Any speed increase beyond this point will result in a negative alias frequency, making
the wheels appear to be turning backward! These aliasing effects could be avoided
either by limiting the ﬁlming only to slow scenes, or by increasing the number of
frames per second.
In practical ADCs, to avoid wasting digital data rate, fS is usually speciﬁed not
far above the Nyquist rate of 2 fB. For example, digital telephony, where the band
of interest is fB = 3.2 kHz and thus 2 fB = 6.4 kHz, uses fS = 8 kHz. Likewise,
compact-disc audio, where fB = 20 kHz and 2 fB = 40 kHz, uses fS = 44.1 kHz.
Even though fS is not strictly equal to 2 fB, these converters are loosely referred to
as Nyquist-rate converters.
It is apparent that in order to prevent any noise or spurious input spectral com-
ponents above fS/2 from folding into the baseband, an antialiasing ﬁlter is required.
Such a ﬁlter must provide a ﬂat response up to fB and must roll off rapidly enough
thereafter to provide the desired amount of suppression at fS/2 and beyond. The
shaded area of Fig. 12.36b, top, represents the baseband aliases of the unsuppressed
signal and noise components above fS/2. The contribution from these aliases must
be kept below 1
2 LSB by suitable choice of Amin. Such a choice, in turn, depends
on the noise distribution and the spectral makeup of vI for f ≥fS/2. It is apparent

647
SECTION 12.5
Oversampling
Converters
that the performance requirements of the antialiasing ﬁlter can be quite stringent.
Elliptic ﬁlters are a common choice for this task because of their sharp cutoff rate,
if at the price of a nonlinear phase response.
Oversampling
Consider now the effect of speeding up the sampling rate by a factor of k, k ≫1.
This is shown in Fig. 12.37a. The ensuing beneﬁts, illustrated in Fig. 12.37b, are
twofold:
1. The transition band of the analog ﬁlter preceding the digitizer is now much wider,
providing an opportunity for a drastic reduction in circuit complexity. In fact, in
oversampling converters of the - type, this ﬁlter can be as simple as a mere
RC stage!
2. The quantization noise is now spread over a wider band, or
eq =
q
√k fS/2
(12.23)
indicating a spectral-density reduction by
√
k.
The price for the preceding beneﬁts is the need for a digital ﬁlter at the output
of the digitizer to (a) suppress any spectral components and noise above fS/2, and
Antialiasing
filter
Oversampling
ADC
n
(kfS)
kfS
Digital filter
& decimator
n
( fS)
vI
DO
0
f
f
Amplitude
fS/2
fS/2
fB
kfS/2
kfS/2
kfS – fB
kfS
(k – 1)fS
eq
Amin
0
0
(b)
(a)
Digital filter
Analog filter
kfS/2
q/ 
FIGURE 12.37
Oversampling with analog and digital ﬁltering.

648
CHAPTER 12
D-A and A-D
Converters
(b) reduce the data rate from k fS back to fS, a process known as decimation. Though
digital ﬁlters/decimators are beyond the scope of this book, it must be said that they
can be designed for very sharp cutoff characteristics with good phase response.
Moreover, they are far more easily implemented and maintained with temperature
and time than their analog counterparts, and they can readily be reprogrammed in
the software, if needed.
We observe that the rms noise at the output of the digitizer is still VFSR/2n√
12;
however, only the shaded portion will make it past the ﬁlter/decimator, so the rms
noise at the output is
Eq =
 fS/2
0
q2
k fS/2 d f
1/2
= q/
√
k
(12.24)
or Eq = VFSR/2n√
12k. Expressing k in the form k = 2m, we now have
SNRmax = 6.02(n + 0.5m) + 1.76 dB
(12.25)
indicating a 1
2-bit improvement for every octave of oversampling.
EXAMPLE 12.6.
An audio signal is oversampled with a 12-bit ADC. Find the over-
sampling frequency needed to achieve a 16-bit resolution. What is the corresponding
SNRmax?
Solution.
To gain 16 −12 = 4 bits of resolution, we need to oversample by m =
4/(1/2) = 8 octaves, so the oversampling frequency must be 28 × 44.1 kHz =
11.29 MHz. Moreover, SNRmax = 98.09 dB.
Remark.
Oversampling, while increasing resolution, does not improve linearity: the
integral nonlinearity of the ﬁnal 16-bit conversion cannot be better than that of the 12-bit
ADC used!
Noise Shaping and Σ-Δ Converters
It is instructive to develop an intuitive feel for quantization-noise reduction. To this
end, refer back to the 3-bit ADC example of Fig. 12.5, and suppose we apply a
constant input VI lying somewhere between 3
8 V and 4
8 V. The ADC will yield either
DO = 011 or DO = 100, depending on whether VI is closer to 3
8 V or to 4
8 V.
Moreover, only one sample needs be taken to ﬁnd DO. An ingenious way to increase
resolution above 3 bits is to add a Gaussian-noise dither en(t) to VI , and take multiple
samples of the resulting signal vI (t) = VI + en(t). Because of the ﬂuctuations of
vI (t), the samples will form a Gaussian distribution about some mean value, which
we can easily compute by taking the average of our multiple readings. The result
gives a more accurate estimate of VI ! In fact, Eq. (12.25) indicates that we need
four samples to increase resolution by 1 bit, sixteen samples to increase by 2 bits,
sixty-four samples to increase by 3 bits, and so forth.
- ADCs use feedback for the double purpose of (a) generating dither to
keep the input busy, and (b) reshaping the noise spectrum to reduce the amount of
oversampling required. In its simplest form1 depicted in Fig. 12.38a, a - ADC
consists of a 1-bit digitizer or modulator to convert vI to a high-frequency serial data

649
SECTION 12.5
Oversampling
Converters
v1
VFSR
n
Σ
vO
DO
vI
+
+
–
–
CMP
Digital filter
& decimator
1
(kfS)
(fS)
FIGURE 12.38
First-order - ADC.
stream vO, followed by a digital ﬁlter/decimator to convert this stream to a sequence
of n-bit words of fractional binary value DO at a lower rate of fS words per second.
The modulator is made up of a latched comparator acting as a 1-bit ADC, a 1-bit
DAC, and an integrator to integrate () the difference () between vI and the DAC
output; hence the name - ADC. The comparator is strobed at a rate of k fS sps,
where k, usually a power of 2, is called the oversampling ratio.
Figure 12.39 shows the integrator and comparator outputs for two representative
input conditions (the dots mark the instants in which CMP is strobed). In (a) vI is set
at midrange, so the serial stream contains an equal number of 0s and 1s. To decode
this stream with a 2-bit resolution, we pass it through a digital ﬁlter which computes
its average over four samples. The result is the fractional binary value DO = 10,
corresponding to (1
2 + 0
4)VFSR, or 0.5VFSR. In (b) vI is set at 3
4 of the range, so
the serial stream contains three 1s for every 0. After averaging, this gives DO = 11,
corresponding to (1
2 + 1
4)VFSR, or 0.75VFSR. It is apparent that the distribution
of 0s and 1s in the serial stream depends on the value of vI within the range of
0 to VFSR.
v1
vO
vO
t
0
0
0
0
1
1
1
1
1
1
1
0
1
0
v1
t
t
t
(a)
(b)
FIGURE 12.39
Integrator and comparator outputs for (a) vI = 0.5VFSR, and (b) vI = 0.75VFSR.

650
CHAPTER 12
D-A and A-D
Converters
H( jf )
Vo( jf )
eqi( jf )
Vi( jf )
Σ
Σ
+
+
+
–
FIGURE 12.40
Linear system model of a - ADC.
To understand how noise shaping comes about, refer to Fig. 12.40, where the
quantization error is modeled additively via the noise process eqi( j f ) = q/√k fS/2.
By inspection, the various Fourier transforms are related as Vo = eq +H ×(Vi −Vo),
or
Vo( j f ) =
1
1 + 1/H( j f )Vi( j f ) +
1
1 + H( j f )eqi( j f )
(12.26)
Choosing H( j f ) such that its magnitude is sufﬁciently large over the frequency
band of interest will provide the simultaneous beneﬁts of (a) making Vo closely
track Vi over the given band and (b) drastically reducing quantization noise over
the same band. This is not surprising for the observant reader who has already noted
the similarity of Fig. 12.40 to Fig. 1.27, with H playing the role of the loop gain and
with eqi playing the role of x3.
For frequency bands extending down to dc, H( j f ) is usually implemented
with integrators; however, depending on the application, other ﬁlter types may be
more efﬁcient, such as band-pass ﬁlters in telecommunications.11 In mixed-mode IC
processes, H( j f ) is implemented using switched-capacitor techniques. Figure 12.41
shows an SC realization11 of the 1-bit modulator. Using Eq. (4.22) with C1 = C2,
ω = 2π f , and TCK = 1/(k fS), we can express the SC integrator transfer function
as H( j f ) = 1/{exp[ j2π f/(k fS)] −1}. Substituting into Eq. (12.26) gives
Vo( j f ) = Vi( j f )e−j2π f/(k fS) + eqo( j f )
(12.27)
eqo( j f ) = (1 −e−j2π f/(k fS))eqi( j f )
(12.28)
VREF
+
+
vI
vO
–
+
CMP
+
–
OA
C
C
C
φ1
φ
φ2
φ
φ2
φ
φ1
φ
φ2
φ
φ1
(φ2)
φ
φ
φ2
(φ1)
φ
φ
FIGURE 12.41
Switched-capacitor implementation of a ﬁrst-order modulator. Bottom-switch
phase is (φ1, φ2) for vO = high, and (φ2, φ1) for vO = low.

651
SECTION 12.5
Oversampling
Converters
Spectral density
q/  kfS/2
fS/2
kfS/2
0
0
eqo
eqi
f
FIGURE 12.42
First-order noise shaping (k = 16).
By the well-known Fourier-transform property that multiplying by exp(−jωT ) in
the frequency domain is equivalent to delaying by T in the time domain, Eq. (12.27)
indicates that vO is simply vI delayed by 1/(k fS). Moreover, applying Euler’s
identity to Eq. (12.28), we can write
|eqo( j f )| = 2 sin[π f/(k fS)] × |eqi( j f )|
(12.29)
The plot of Fig. 12.42 reveals that the modulator shifts most of the noise energy
toward higher frequencies. Only the shaded portion will make it past the ﬁlter/
decimator, so the corresponding rms output noise is obtained as
Eq =
 fS/2
0
|eqo( j f )|2d f
1/2
(12.30)
For k ≫π, we obtain (see Problem 12.22) Eq = πq/
√
3k3 = πVFSR/(2n√
36k3).
Expressing k in the form k = 2m gives, for a ﬁrst-order - ADC,
SNRmax = 6.02(n + 1.5m) −3.41 dB
(12.31)
indicating a 1.5-bit improvement for every octave of oversampling; this is better than
the 0.5-bit improvement without noise shaping.
The beneﬁts of noise shaping can be enhanced further by using higher-order
modulators.Forinstance,suitablycascading11 twosubtractor-integratorblocksgives
a second-order - ADC with
|eqo( j f )| = {2 sin[π f/(k fS)]}2 × |eqi( j f )|
(12.32)
Substituting into Eq. (12.30), we obtain (see Problem 12.22), for k ≫π, Eq = π2q/
√
5k5 = π2VFSR/(2n√
60k5). This yields, for a second-order - ADC,
SNRmax = 6.02(n + 2.5m) −11.14 dB
(12.33)
indicating a 2.5-bit improvement for every octave of oversampling.
EXAMPLE 12.7.
Find k for SNRmax ≥96 dB (or ≥16 bits) using (a) a ﬁrst-order and
(b) a second-order - ADC.
Solution.
(a) Imposing 6.02(1 + 1.5m) −3.41 ≥96 gives m ≥10.3, or k ≥210.3 ∼= 1261.
(b) Similarly, k ≥26.7 ∼= 105.

652
CHAPTER 12
D-A and A-D
Converters
Besides offering the aforementioned advantages of undemanding and mixed-
mode-compatible analog circuitry, 1-bit quantizers are inherently linear: since only
two output levels are provided, a straight characteristic results, with no need for
trimming or calibration as in multilevel quantizers. Moreover, the presence of the
integrator makes the input SHA unnecessary—if at the price of more stringent input-
drive requirements due to charge injection effects.12
Practical upper limits on sampling rates currently restrict - ADCs to
moderate-speed but high-resolution applications, such as digital audio, digital tele-
phony, and low-frequency measurement instrumentation, with resolutions rang-
ing from 16 to 24 bits.12–14 An additional factor to keep in mind is that since the
digital ﬁlter/decimator computes each high-resolution sample using many previous
low-resolution samples, there is a latency as information progresses from input to
output through the various stages of the ﬁlter. This delay may be intolerable in certain
real-time applications, such as control. Moreover, it makes - converters unsuited
to input multiplexing, that is, to situations where it is desired to share the same ADC
among different sources to help reduce cost.
The interested reader is referred to the literature9–11 for additional practical
issues such as stability and idle tones, system architectures, and the fascinating
subject of digital ﬁltering and decimation.
PROBLEMS
12.1 Performance speciﬁcations
12.1 A 3-bit DAC designed for VFSR = 3.2 V is sequenced through all input codes from 000
to 111, and the actual output values are found to be vO = 0.2, 0.5, 1.1, 1.4, 1.7, 2.0,
2.6, and 2.9, all in V. Find the offset error, the gain error, the INL, and the DNL, in
fractions of 1 LSB.
12.2 A full-scale sinusoid is applied to a 12-bit ADC. If the digital analysis of the output
reveals that the fundamental has a normalized power of 1 W while the remaining
power is 0.6 μW, ﬁnd the effective number of bits of this ADC. What is the SNR if
the input sinusoid is reduced to 1/100th of full scale?
12.2 D-A conversion techniques
12.3 A 6-bit weighted-resistor DAC of the type of Fig. 12.7 is implemented with VREF =
1.600 V, but with R f = 0.99R instead of R f = R, and a low-quality op amp having
VOS = 5 mV and a = 200 V/V. Find the offset and gain errors of this DAC, in fractions
of 1 LSB. What is the worst-case value of the output when all bits are set to 1?
12.4 A 4-bit weighted-resistor DAC of the type of Fig. 12.7 is implemented with VREF =
−3.200 V and a high-quality op amp, but gross resistor values, namely, R f = 9.0 k
instead of 10 k, 2R = 22 k instead of 20 k, 4R = 35 k instead of 40 k,
8R = 50 k instead of 80 k, and 16R = 250 k instead of 160 k. Find the
gain error, along with the integral and differential nonlinearities. Comment on your
ﬁndings.

653
Problems
12.5 The AH5010 quad switch consists of four analog-ground p-FET switches and relative
diode clamps of the type of Fig. 9.37, plus a ﬁfth dummy FET for rds(on) compensation.
(a) Using an LM385 2.5-V reference diode, an AH5010 quad switch (rds(on) ∼= 100 ),
and a JFET-input op amp with ±15-V supplies, design a 4-bit weighted-resistor DAC
with VFSR = +10.0 V. (b) Compute vO for each input code. (c) Repeat if the op amp
has VOS = 1 mV. What are the offset and gain errors of your DAC?
12.6 One way of curbing excessive resistance spread in an 8-bit weighted-resistor DAC
is by combining the outputs of two 4-bit DACs as vO = vO(MS) + 2−4vO(LS), where
vO(MS) is the output of the DAC using the four MSBs of the 8-bit code, and vO(LS)
that of the DAC using the four LSBs. Using components of the type of Problem 12.5,
design one such 8-bit DAC.
12.7 (a) Using an 8-bit R-2R ladder with R = 10 k, an LM385 2.5-V reference diode,
and a 741 op amp, design an 8-bit voltage-mode DAC with VFSR = 10 V. (b) Modify
your circuit so that vO is offset by −5 V. Assume ±15-V regulated supplies.
12.8 (a) Derive expressions for the element values in the Norton equivalent of the current-
driven R-2R ladder DAC of Fig. 12.17. (b) Suppose VREF/Rr = 1 mA, R = 1 k,
and the output of the DAC is fed to a simple I-V converter op amp with a feedback
resistance of 1 k. If the I-V converter introduces an offset error of 1
4 LSB and a gain
error of −1
2 LSB, ﬁnd the I-V converter output for b1b2b3b4 = 0000, 0100, 1000,
1100, and 1111. (c) Find the closed-loop small-signal bandwidth if the op amp has a
constant GBP of 50 MHz.
12.3 Multiplying DAC applications
12.9 The programmable attenuator of Fig. 12.23a can be turned into a programmable
attenuator/ampliﬁer by using a T-network of the type of Fig. 2.2 in the feedback path.
This is achieved by interposing a voltage divider between the op amp output and the
R f pin of the DAC (see Analog Devices Application Note AN-137). Using a 12-bit
MDAC with R f = 10 k, design a circuit whose gain can be varied from 1
64 V/V to
64 V/V as the input code is sequenced from 0 . . . 01 to 1 . . . 11.
12.10 Consider the circuit obtained from the biquad ﬁlter of Fig. 3.36 by replacing the
inverting ampliﬁer (OA3 plus the R3 resistances) with the programmable attenuator of
Fig. 12.23a. Find an expression for the band-pass response, and verify that both f0 and
Q are proportional to
√
D, indicating a digitally programmable, constant-bandwidth
band-pass ﬁlter.
12.11 Consider the circuit obtained from Fig. 12.24 by removing R4, MDAC2, OA5, and
the OA3 integrator. (a) Sketch the reduced circuit, and show that now OA1 and OA2
provide, respectively, the ﬁrst-order high-pass and low-pass responses. (b) Specify
suitable components so that the low-pass response has a dc gain of 20 dB, the high-
pass response has a high-frequency gain of 0 dB, and the characteristic frequency is
digitally programmable in 5-Hz steps by means of a dual 10-bit MDAC.
12.12 Modify the quadrature oscillator of Fig. 10.6a for peak amplitudes of 5 V and f0
digitally programmable in 10-Hz steps by means of a dual 10-bit MDAC.

654
CHAPTER 12
D-A and A-D
Converters
12.13 Using a 12-bit MDAC and an AD537 wide-sweep CCO (see Fig. 10.33), design a
triangular wave generator with peak values of ±5 V and f0 digitally programmable
in 10-Hz steps. The circuit is to have provision for both frequency and amplitude
calibration. Assume the triangular wave available across the timing capacitor of the
AD537 has a peak-to-peak amplitude of 5
3 V.
12.14 Using an 8-bit CMOS DAC of the type of Fig. 12.11, an LM385 2.5-V reference
diode, and an LM317 regulator of the type of Fig. 11.19, along with other components
as needed, design a 1-A power supply digitally programmable over the range 0.0 V to
10.0 V. Assume ±15-V supplies.
12.4 A-D conversion techniques
12.15 As we know, an SA ADC must usually be preceded by a THA. However, if the input
is sufﬁciently slow to change by less than ± 1
2 LSB during the conversion cycle, then
the THA is unnecessary. (a) Show that a full-scale sine wave input can be converted
without the need for a THA, provided its frequency is below fmax = 1/(2nπtSAC),
where tSAC is the time it takes for the SA ADC to complete a conversion. (b) Find fmax
for an 8-bit SA ADC operating at the rate of 106 conversions per second. How does
fmax change if the SA ADC is preceded by an ideal SHA?
12.16 Discuss the general requirements on the reference, DAC, and comparator of an 8-bit
SA ADC for a conversion time of 1 μs over the range 0 ◦C ≤T ≤50 ◦C with an
accuracy of ±1/2 LSB, if VFSR = 10 V.
12.17 Consider a charge-redistribution ADC of the type of Fig. 12.29 with n = 4,
VREF = 3.0 V, and C = 8 pF. Assuming node vP has a parasitic capacitance of
4 pF toward ground, ﬁnd the intermediate values of vP during the conversion of
vI = 1.00 V.
12.18 Assume the 8-bit subranging ADC of Fig. 12.32 has VREF = 2.560 V. (a) Find
the total number of comparators, their voltage reference levels, and the maximum
level tolerances allowed for a ± 1
2 LSB accuracy. (b) Find b1 . . . b8, vRES, and the
quantization error for vI = 0.5 V, 1.054 V, and 2.543 V.
12.19 Show that if the input to the dual-slope ADC of Fig. 12.34 contains an unwanted ac
component of the type vi = Vm cos(ωt +θ), then the result of integrating it over the in-
terval T = 2nTCK is proportional to the sampling function Sa(ωT ) = sin(ωT )/(ωT ).
Plot |Sa(ωT )|dB vs. ωT , and verify that this type of ADC inherently rejects all un-
wanted ac components whose frequencies are integral multiples of 1/T .
12.20 The integrator of a dual-slope ADC is implemented with an op amp having gain
a = 103 V/V. (a) Assuming its output vO(t) is initially zero, ﬁnd vO(t ≥0) if the
input is vI = 1 V. (b) Find the minimum value of RC so that vO(t = 100 ms) is
afﬂicted by an error of less than 1 mV.
12.21 A 14-bit dual-slope ADC of the type of Fig. 12.34 is to be designed so that it re-
jects the 60-Hz power-line interference frequency and harmonics thereof. (a) What
is the required clock frequency fCK? What is the time required to convert a full-
scale input? (b) If VREF = 2.5 V and the input is in the range 0 to 5 V, what is the
value of RC for a peak value of 5 V at the integrator’s output for a full-scale input?

655
References
(c) If component aging causes R to change by +5% and C by −2%, what is the effect
upon the integrator’s output for the case of a full-scale input? Upon the conversion’s
accuracy?
12.5 Oversampling converters
12.22 (a) Plot |eqo( j f )|, 0 ≤f ≤k fS/2 for the second-order - ADC, and compare
with the ﬁrst order. (b) Show that the rms noise before digital ﬁltering is
√
2q for the
ﬁrst-order modulator, and
√
8q for the second-order modulator. (c) Using the approx-
imation sin x ∼= x for x ≪1, show that the rms noise after digital ﬁltering is, for
k ≫π, πq/
√
3k3 for the ﬁrst-order modulator, and π2q/
√
5k5 for the second-order
modulator. (d) Find the rms noise percentage removed by the digital ﬁlter for both
orders if k = 16.
12.23 Compare the sampling rates needed for a 16-bit audio ADC using a 1-bit ADC with
(a) straight oversampling, (b) ﬁrst-order noise shaping, and (c) second-order noise
shaping.
12.24 An 8-bit ADC that is linear to 12 bits is used to perform conversions over a 100-kHz
signal bandwidth. (a) Find the sampling rate required to achieve 12 bits of accuracy
using straight oversampling. (b) Repeat, but for the case in which the above ADC
is placed inside a ﬁrst-order - modulator. (c) Repeat, but for a second-order
modulator.
12.25 An oversampling audio ADC with n = 16, VFSR = 2 V, fS = 48 kHz, and k fS = 64 fS
uses a simple RC network as the input antialiasing ﬁlter. (a) Specify RC for a maxi-
mum attenuation of 0.1 dB for 0 ≤f ≤20 kHz. (b) Assuming the spectral makeup
of vI within the ﬁrst image band k fS ± 20 kHz is just white noise with spectral den-
sity enw, ﬁnd the maximum allowed value of enw so that the corresponding base-band
rms noise is less than 1
2 LSB.
REFERENCES
1. Analog Devices Engineering Staff, Mixed-Signal Design Seminar, Analog Devices,
Norwood, MA, 1991.
2. M. Oljaca and B. Baker, “Start with the Right Op Amp When Driving SAR ADCs,”
EDN, Oct. 16, 2008, http://www.edn.com/contents/images/6602451.pdf.
3. Analog Devices Engineering Staff, Analog-Digital Conversion Handbook, 3d ed.,
Prentice Hall, Englewood Cliffs, NJ, l986.
4. B. Razavi, Principles of Data Conversion System Design, IEEE Press, Piscataway, NJ,
1995.
5. A. P. Brokaw, “Analog Signal-Handling for High Speed and Accuracy,” Analog
Devices
Application
Note
AN-342,
http://www.analog.com/static/imported-ﬁles/
application notes/2904748046167431066AN-342.pdf.
6. J. Wilson, G. Whitmore, and D. Sheingold, Application Guide to CMOS Multiplying
D/A Converters, Analog Devices, Norwood, MA, 1978.
7. J. Williams, “Build Your Own A/D Converter for Optimum Performance,” EDN, Mar. 20,
1986, pp. 191–198.
8. P. Klonowski, “Analog-to-Digital Conversion Using Voltage-to-Frequency Converters,”
Analog Devices Application Note AN-276, http://www.analog.com/static/imported-
ﬁles/application notes/185321581AN276.pdf.

656
CHAPTER 12
D-A and A-D
Converters
9. M. W. Hauser, “Principles of Oversampling A/D Conversion,” J. Audio Eng. Soc.,
January/February 1991, pp. 3–26.
10. J. C. Candy and G. C. Temes, editors, Oversampling Delta-Sigma Data Converters,
IEEE Press, Piscataway, NJ, 1992.
11. D. A. Johns and K. W. Martin, Analog Integrated Circuit Design, John Wiley & Sons,
New York, 1997.
12. W. Kester, Practical Analog Design Techniques, Analog Devices, Norwood, MA, 1995.
ISBN 0-916550-16-8.
13. Burr-Brown
Engineering
Staff,
Burr-Brown
Design
Seminar
Manual,
1996,
http://www.datasheetcatalog.com/datasheets pdf/D/E/S/I/DESIGN SEMINAR.shtml.
14. W. Kester, High Speed Design Techniques, Analog Devices, Norwood, MA, 1996.
ISBN-0-916550-17-6.

13
NONLINEAR AMPLIFIERS AND
PHASE-LOCKED LOOPS
13.1 Log/Antilog Ampliﬁers
13.2 Analog Multipliers
13.3 Operational Transconductance Ampliﬁers
13.4 Phase-Locked Loops
13.5 Monolithic PLLs
Problems
References
The highly predictable characteristic of the bipolar junction transistor is ex-
ploited in the realization of some very useful nonlinear functions, such as logarithmic
conversion and variable transconductance multiplication. These functions, in turn,
provide the basis for a variety of other analog operations, such as antilogarithmic
ampliﬁcation, true rms conversion, analog division and square-root computation,
various forms of linearization, and voltage-controlled ampliﬁcation, ﬁltering, and
oscillation. These building blocks simplify analog design considerably while broad-
ening the scope of practical analog circuits to applications where considerations of
speed or cost require implementation in analog rather than digital form.
Another important class of nonlinear circuits is provided by phase-locked loops.
Though unrelated to those just mentioned, PLLs encompass many of the important
topics that we have studied so far. We thus ﬁnd it appropriate to conclude the book
with this subject.
Chapter Highlights
The chapter starts out with log/antilog ampliﬁers, emphasizing pertinent issues such
as stability and temperature compensation. Next, it turns to analog multipliers and
their applications in a number of useful analog operations. The chapter proceeds to
operationaltransconductanceampliﬁers(OTAs)andtheirapplicationsin gm-C ﬁlters
657

658
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
as well as programmable blocks such as wide-dynamic-range voltage/current con-
trolled ampliﬁers, oscillators, and ﬁlters. The chapter concludes with phase-locked
loops (PLLs). In a way, the PLL brings together some of the most sophisticated issues
addressed in the previous chapters: oscillators, ﬁlters, and frequency compensation.
Concepts and applications are addressed using the popular 4046 monolithic PLL as
a vehicle.
13.1
LOG/ANTILOG AMPLIFIERS
A logarithmic ampliﬁer—also called log amp, or logger—is an I-V converter with a
transfer characteristic of the type
vO = Vo logb
iI
Ii
(13.1)
where Vo is called the output scale factor, Ii the input reference current, and b is
the base, usually 10 or 2. Vo represents the sensitivity of the log amp, in volts per
decade (or per octave), and Ii is the value of iI for which vO = 0. Note that for
proper operation we must always have iI /Ii > 0. The quantity
DR = logb
|iI |max
|iI |min
(13.2)
is called the dynamic range and is expressed in decades or in octaves, depending on
b. For instance, a logger designed to operate over the range 1 nA ≤iI ≤1 mA has
DR = log10(10−3/10−9) = 6 decades, or DR = log2 106 ∼= 20 octaves.
Plotting Eq. (13.1) on semilog paper with iI /Ii on the logarithmic axis and vO
on the linear axis, as in Fig. 13.1a, yields a straight line with a slope of Vo V/dec.
Any departure of the actual characteristic from the best-ﬁt straight line is called the
log conformity error eO. Though this error can only be observed at the output, it is
convenient to refer it to the input because of the unique log-function property that
equal percentage errors at the input produce equal incremental errors at the output,
regardless of the point on the curve. Indeed, denoting the percentage input error as p,
we have eO = vO(actual) −vO(ideal) = Vo logb[(1 + p)(iI /Ii)] −Vo logb[iI /Ii], or
eO = Vo logb(1 + p)
(13.3)
+
–
R
+
vI
vO
vO (lin) 
iI
Ii
iI (log)
Vo
1
(b)
(a)
FIGURE 13.1
Logarithmic characteristic and the transdiode conﬁguration.

659
SECTION 13.1
Log/Antilog
Ampliﬁers
For instance, with b = 10 and Vo = 1 V/dec, a 1% input error corresponds to an output
error eO = 1 log10(1 + 0.01) = 4.32 mV. Conversely, eO = 10 mV corresponds to a
percentage error p such that 10 mV = 1 log10(1 + p), or p = 2.33%.
The main application of log amps is data compression. As an example, consider
the digitization of a photodetector current over the range 10 nA ≤iI ≤100 μA with
an error of less than 1% of its actual value. Since we have a four-decade range, the re-
quired resolutionis 0.01/104 = 1/106,or1 ppm.Since106 ∼= 220,this requires a20-
bit A/D converter, which can be a challenging and expensive proposition. Consider
now the effect of compressing the input with a log amp before digitizing. Letting, for
instance, b = 10, Vo = 1 V/dec, and Ii = 10 nA, the current range is now compressed
to a 0 to 4-V voltage range. Since a 1% current accuracy corresponds to a 4.32-mV
voltage interval, the required resolution is now (4.32 × 10−3)/4 ∼= 1/926 ∼= 1/210,
or 10 bits. This represents a substantial reduction in cost and circuit complexity!
The inverse function of logarithmic compression is exponential expansion. This
is provided by the antilogarithmic ampliﬁer (antilog amp), whose transfer charac-
teristic is
iO = IobvI/Vi
(13.4)
where Io is the output reference current and Vi the input scale factor, in volts per
decade or per octave. The output of an antilog amp can be converted to a voltage
by means of an op amp I-V converter. When plotted on semilog paper with vI on
the linear axis and iO/Io on the logarithmic axis, Eq. (13.4) also yields a straight
line. The above log conformity error considerations still hold, but with the input and
output errors interchanged.
The Transdiode Conﬁguration
Log/antilog ampliﬁers exploit the exponential characteristic of a forward-active BJT.
By Eq. (5.3), this characteristic can be written as vBE = VT ln(iC/Is). Practical
logging BJTs conform to this equation remarkably well over a range of at least six
decades,1 typically for 0.1 nA ≤iC ≤0.1 mA. The heart of log/antilog amps is the
circuit of Fig. 13.1b, known as the transdiode conﬁguration. The op amp converts
vI to the current iI = vI /R, and then forces the BJT in its feedback path to respond
with a logarithmic base-emitter voltage drop to yield
vO = −VT ln vI
RIs
(13.5)
If we also take into account the input bias voltage VOS and bias current IB, then
the collector current becomes iC = (vI −VOS)/R−IB, so the transfer characteristic
takes on the more realistic form
vO = −VT ln vI −VOS −RIB
RIs
(13.6)
The input offset error (VOS + RIB) sets the ultimate limit on the range of inputs
that can be processed within a given log conformity error. Wide-dynamic-range
loggers use op amps with ultra-low VOS and IB to approach the ideal characteristic
of Eq. (13.5). The ultimate limit is then posed by drift and noise. If the transdiode is
driven directly with a current source iI , Eq. (13.5) reduces to vO = −VT ln(iI /Is),
and the ultimate limit is now set by the input bias current of the op amp or by the

660
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
+
–
R
+
vI
vO
vo
RE
Cf
R
C
B
E
RE
Cf
Cn
Cμ
rd
re
ro
vn
ie
ie
α
(b)
(a)
FIGURE 13.2
Transdiode circuit with frequency compensation, and its incremental model.
low-end log conformity error of the BJT, whichever is higher. In general, current-
driven loggers offer a wider dynamic range than voltage-driven loggers.
Stability Considerations
Transdiode circuits are notorious for their tendency to oscillate due to the presence
of an active gain element inside the feedback loop. As shown in Fig. 13.2a, the
transdiode is stabilized1 by using an emitter-degeneration resistance RE to reduce
the feedback factor β, and a feedback capacitance C f to provide feedback lead. To
investigate stability, we need to ﬁnd the feedback factor β. To this end, refer to the
ac model of Fig. 13.2b, where the BJT has been replaced by its common-base small-
signal model.2 The BJT parameters re and ro depend on the operating current IC as
re = αVT
IC
ro = VA
IC
(13.7)
where VT is the thermal voltage and VA is the so-called Early voltage. Typically,
α ∼= 1 and VA ∼= 100 V. The base-collector junction capacitance Cμ and the
inverting-input stray capacitance Cn are typically on the order of a few picofarads.
Circuit analysis is facilitated by the introduction of
Ra = R ∥ro ∥rd
Rb = re + RE
(13.8)
Applying KCL at the summing junction gives
vn[1/Ra + jω(Cn + Cμ)] + αie + jωC f (vn −vo) = 0
Letting ie = −vo/Rb, rearranging, and solving for β = vn/vo gives, for α ∼= 1,
1
β = Rb
Ra
1 + j f /fz
1 + j f /f p
(13.9)

661
SECTION 13.1
Log/Antilog
Ampliﬁers
where the zero and pole frequencies are
fz =
1
2π Ra(Cn + Cμ + C f )
f p =
1
2π RbC f
(13.10)
The|1/β|curvehasthelow-frequencyasymptote1/β0 = Rb/Ra,thehigh-frequency
asymptote 1/β∞= 1 + (Cn + Cμ)/C f , and two breakpoints at fz and f p. While
fz and 1/β∞are relatively constant, f p and 1/β0 depend on the operating current
as per Eq. (13.7), so they can vary over a wide range of values, as exempliﬁed in
Fig. 13.3. The hardest condition to compensate is when iC is maximized, since this
minimizes 1/β0 and maximizes f p, leading to the highest rate of closure. As a rule
of thumb,1 RE is chosen so that, when iC is maximized, 1/β0 ∼= 0.5 V/V and
f p ∼= 0.5 fx, where fx is the crossover frequency.
EXAMPLE 13.1.
In the circuit of Fig. 13.2a let R = 10 k, 1 mV < vI < 10 V, Cn +
Cμ = 20 pF, VA = 100 V, rd = 2 M, and ft = 1 MHz. Find suitable values for RE
and C f .
Solution.
At the upper end of the range, where iC = (10 V)/(10 k) = 1 mA, we
have re ∼= 26 , ro = 100 k, and Ra ∼= 9 k. Imposing (26 + RE)/9000 = 0.5 gives
RE = 4.47 k (use 4.3 k).
Next, ﬁnd fx using the deﬁnition |a( j f x)| × β∞= 1. Letting |a( j f x)| ∼= ft/fx
and using 1/β∞= 1 + (Cn + Cμ)/C f we get fx = ft/[1 + (Cn + Cμ)/C f ]. Imposing
f p = 0.5 fx and simplifying, we ﬁnally obtain
C f = 1 + (Cn + Cμ)/C f
π Rb ft
Substituting the given parameter values, along with Rb ∼= 4.3 k, gives C f = 90 pF
(use 100 pF).
Figure 13.3 indicates that at low values of vI the response is dominated by f p,
thus resulting in slow dynamics. This is not surprising, since at low current levels
it takes longer to charge or discharge the various capacitances. At low currents
dB
0
10
20
30
–10
f  (Hz)
104
105
106
vI = 1 mV
vI = 10 mV
vI = 10 V
a
1/β
FIGURE 13.3
Bode plots for the transdiode circuit of Exam-
ple 13.1.

662
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
OA2
+
–
OA1
+
–
+
vI
( > 0)
R
10.0 kΩ
Rr
D1
1N914
698 kΩ
10 kΩ
R2
15.7 kΩ
R1(T)
1 kΩ
Q1
Q2
LM394
LM329
6.95 V
LT1012
LF411
VREF
IREF
330 pF
33 pF
2.2 kΩ
iI
vO
15 V
FIGURE 13.4
Logarithmic ampliﬁer.
we have re ≫RE, so f p ∼= 1/(2πreC f ), indicating a time constant τ ∼= reC f ∼=
(VT /IC)C f = (VT /vI )RC f . For instance, with C f = 100 pF, at IC = 1 nA we
have τ ∼= (0.026/10−9)10−10 = 2.6 ms, so we must be prepared for slow dynamics
near the low end of the range.
Practical Log/Antilog Circuits3
Both the output scale factor and the input reference term in Eq. (13.5) depend
on temperature. The circuit of Fig. 13.4 overcomes this serious drawback by us-
ing a matched BJT pair to eliminate Is, and a temperature-sensitive voltage di-
vider to compensate for TC(VT ). The op amps force the BJTs to develop vBE1 =
VT ln(iI /Is1) and vBE2 = VT ln(IREF/Is2), where IREF = VREF/Rr. By the volt-
age divider formula, vB2 = vO/(1 + R2/R1). But, by KVL, vB2 = vBE2 −
vBE1 = VT ln[(IREF/Is2)(Is1/iI )]. Eliminating vB2 and using the property ln x =
2.303 log10 x, we get
vO = Vo log10
iI
Ii
(13.11)
Vo = −2.303 R1(T ) + R2
R1(T )
VT
Ii = VREF
Rr
× Is2
Is1
(13.12)
For matched BJTs Is2/Is1 = 1, so we get the temperature-independent expression
Ii = VREF/Rr. Moreover, for R2 ≫R1, we can approximate Vo ∼= −2.303R2VT /
R1(T ), indicating that Vo can be thermally stabilized by using a resistance R1(T )
with TC(R1) = TC(VT ) = 1/T = 3660 ppm/◦C. A suitable resistor is the Q81
(Tel Labs), which must be mounted in close thermal coupling with the BJT pair.
The function of D1 is to protect the BJTs against inadvertent reverse bias. The use
of the LT1012 picoampere-input-current, microvolt-offset, low-noise op amp allows
for a voltage-logging range of 41
2 decades. With the given component values, Vo =
−1 V/dec and Ii = 10 μA, so vO = −(1 V/dec) log10[vI /(0.1 V)]. Vo and Ii are
calibrated via R2 and Rr.

663
SECTION 13.1
Log/Antilog
Ampliﬁers
R2
R1(T)
Q1
Q2
+
–
OA1
+
–
OA2
iREF
iI
vO
I
REF
Source
Log ratio amp
λ
λ
FIGURE 13.5
Log ratio ampliﬁer for absorbance measurements.
If the input reference current Ii is allowed to vary, the log amp is called a log ratio
ampliﬁer and ﬁnds application in wide-dynamic-range ratiometric measurements
wheretheunknownsignalismeasuredagainstareferencesignalthatisitselfvariable.
Typical examples are absorbance measurements in medicine and pollution control,
wherelighttransmittedthroughaspecimenismeasuredagainstincidentlight,andthe
result must be independent of incident light intensity. This application is illustrated
in Fig. 13.5, where frequency compensation and reverse-bias protection have been
omitted for simplicity. The transmitted light λI and the incident light λREF are
converted to the proportional currents iI and iREF by a pair of matched photodiodes
operating in the photovoltaic mode. Then, the circuit computes the log ratio vO =
Vo log10(iI /iREF) = Vo log10(λI /λREF), where Vo is given by Eq. (13.12).
Figure 13.6 shows how the log amp can be rearranged to implement an expo-
nential amp. It is left as an exercise for the reader (see Problem 13.4) to prove that
the circuit gives
iO = Io10vI/Vi
(13.13)
Io = VREF
Rr
× Is2
Is1
Vi = −2.303 R1(T ) + R2
R1(T )
VT
(13.14)
VREF
IREF
R1(T)
+
vI
Rr
10 kΩ
15 V
D1
69.8 kΩ
6.95 V
2.2 kΩ
33 pF
1N914
R
10.0 kΩ
R2
LM329
LF411
LT1012
LM394
Q1
Q2
iO
vO
+
–
OA1
+
–
OA2
FIGURE 13.6
Antilog ampliﬁer.

664
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
With the given component values, Io = 0.1 mA and Vi = −1 V/dec. It is impor-
tant that the collector of Q2 be returned to a 0-V node, such as the virtual-ground
node of the I-V converter OA2, in order to nullify the collector-base leakage cur-
rent of Q2. Otherwise, this current may degrade log conformity at the low end of
the range.
Log, log-ratio, and antilog ampliﬁers are available in IC form from various
manufacturers. These devices usually work over a six-decade current range (1 nA
to 1 mA) and a four-decade voltage range (1 mV to 10 V).
True rms-to-dc Converters
The logarithmic characteristics of BJTs are also exploited to perform a variety of
slide-rule-likeanalogcomputations.Apopularexampleistruerms-to-dcconversion,
deﬁned as
Vrms =

1
T
 T
0
v2(t) dt
1/2
(13.15)
Vrms gives a measure of the energy content of v(t), so it provides the basis for accu-
rate and consistent measurements, especially in the case of ill-deﬁned waveforms,
such as noise (electronic noise, switch contact noise, acoustical noise), mechanical
transducer outputs (stress, vibration, shock, bearing noise), SCR waveforms, low-
repetition-rate pulse trains, and other waveforms carrying information on the average
energy generated, transmitted, or dissipated.
Equation (13.15) can be mechanized by performing the operations of squaring,
averaging, and square rooting. Referred to as explicit rms computation, this scheme
places severe demands on the dynamic output range of the squarer, which must
be twice as wide as the input range. This drawback is overcome by implicit rms
computation, in which the gain of the squarer is made inversely proportional to Vrms
to make the output dynamic range comparable to the input range.
A common implementation of this principle is shown in Fig. 13.7, where fre-
quency compensation and reverse-bias protection have been omitted for simplicity.
OA1 and the associated circuitry convert v(t) to a full-wave rectiﬁed current iC1 =
|v|/R ﬂowing into Q1. By KVL, vBE3 +vBE4 = vBE1 +vBE2, or VT ln[(iC3/Is3)×
(iC4/Is4)] = VT ln[(iC1/Is1) × (iC2/Is2)]. Assuming pairwise matched BJTs and
ignoring base currents so that iC2 = iC1, we get
iC3 = i2
C1
iC4
Substituting i2
C1 = v2/R2 and iC4 = Vrms/R gives
iC3 =
v2
RVrms
indicating that the scale factor of the squaring function is controlled by Vrms, as
expected of implicit computation.
OA3 forms a low-pass ﬁlter with cutoff frequency f0 = 1/(2π RC). For signal
frequencies sufﬁciently higher than f0, OA3 will provide the running average of

665
SECTION 13.2
Analog
Multipliers
Vrms
+
v(t)
R
C
R
R
R
R/2
D1
D2
R
Q4
Q1
Q2
Q3
+
–
OA1
+
–
OA4
+
–
OA2
+
–
OA3
FIGURE 13.7
True rms converter.
iC3 as Vrms ∼= RiC3 = v2/Vrms. Making the approximation Vrms ∼= Vrms, we can
writeV 2rms = v2, or
Vrms = (v2)1/2
(13.16)
As a consequence of the approximations made, Vrms of Eq. (13.16) will differ
from the ideal Vrms of Eq. (13.15) by an average (or dc) error as well as an ac (or
ripple) error. Both errors can be kept below a speciﬁed limit by using a suitably large
capacitance.4 However, too large a capacitance will increase the response time of
the circuit, so a compromise must be reached. An effective way of reducing ripple
without unduly lengthening the response is to use a post ﬁlter, such as a low-pass
KRC type.
The structure of Fig. 13.7 (or improved variations thereof) is available in IC
form from various manufacturers. Consult the literature4 for useful application
tips.
13.2
ANALOG MULTIPLIERS
A multiplier produces an output vO proportional to the product of two inputs vX
and vY ,
vO = kvXvY
(13.17)
where k is a scale factor, usually 1/10 V−1. A multiplier that accepts inputs of either
polarity and preserves the correct polarity relationship at the output is referred to as
a four-quadrant multiplier. Both the input and output ranges are usually from −10 V
to +10 V. By contrast, a two-quadrant multiplier requires that one of its inputs be
unipolar, and a one-quadrant multiplier requires that both inputs be unipolar.

666
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
Multiplier performance is speciﬁed in terms of accuracy and nonlinearity. Ac-
curacy represents the maximum deviation of the actual output from the ideal value
predicted by Eq. (13.17); this deviation is also referred to as the total error. Nonlin-
earity, also referred to as linearity error, represents the maximum output deviation
from the best-ﬁt straight line for the case where one input is varied from end to
end while the other is kept ﬁxed, usually at +10 V or −10 V. Both accuracy and
nonlinearity are expressed as a percentage of the full-scale output.
Multiplier dynamics are speciﬁed in terms of the small-signal bandwidth, rep-
resenting the frequency where the output is 3 dB below its low-frequency value,
and the 1% absolute-error bandwidth, representing the frequency where the output
magnitude starts to deviate from its low-frequency value by 1%.
Variable-Transconductance Multipliers
Monolithicfour-quadrantmultipliersutilizethevariable-transconductanceprinciple5
to achieve errors of fractions of 1% over small-signal bandwidths extending well into
the megahertz range. This principle is illustrated in Fig. 13.8a. The block uses the dif-
ferential pair Q3-Q4 to provide variable transconductance, and the diode-connected
pair Q1-Q2 to provide the proper base drive for the former. The following analysis
assumes matched BJTs and negligible base currents.
By KVL, vBE1 + vBE4 −vBE3 −vBE2 = 0, or vBE3 −vBE4 = vBE1 −vBE2.
Using the logarithmic v-i characteristics of the BJTs, this can be expressed as
VT ln(i3/i4) = VT ln(i1/i2), or
i3
i4
= i1
i2
Rewriting as (i3 −i4)/(i3 + i4) = (i1 −i2)/(i1 + i2) gives
i3 −i4 = (i1 −i2) × (i3 + i4)
i1 + i2
(13.18)
indicating the circuit’s ability to multiply the current difference (i1 −i2) by the total
emitter current (i3 + i4).
Rx
i3
i4
i1
i2
X1
X2
i3 + i4
Q1
Q2
Q3
Q4
Q1
Q2
IX
IX
VEE
i1
i2
(a)
(b)
FIGURE 13.8
Linearized transconductance block and differential V-I converter.

667
SECTION 13.2
Analog
Multipliers
To be of practical use, the circuit requires two V-I converters to synthesize the
terms (i1 −i2) and (i3 +i4) from the input voltages vX and vY , and an I-V converter
to convert (i3 −i4) to the output voltage vO. Moreover, provisions must be made to
ensure four-quadrant operation; as is, the circuit is only two-quadrant because the
current (i3 + i4) must always ﬂow out of the emitters.
Figure 13.8b shows the circuit used to provide V-I conversion. By KCL, i1 =
IX + iRx and i2 = IX −iRx, where iRx = (vE1 −vE2)/Rx is the current through
Rx, assumed to ﬂow from left to right. Consequently,
i1 −i2 = 2vE1 −vE2
Rx
By KVL, vE1−vE2 = (vX1−vBE1)−(vX2−vBE2) = (vX1−vX2)−(vBE1−vBE2), or
vE1 −vE2 = vX1 −vX2 −VT ln i1
i2
Combining the two equations gives
i1 −i2 = 2
Rx
(vX1 −vX2) −2VT
Rx
ln i1
i2
(13.19)
In a well-designed multiplier the last term is on the order of 1% of the other two, so
we can ignore it and approximate
i1 −i2 = 2
Rx
(vX1 −vX2)
(13.20)
indicating the circuit’s ability to provide differential V-I conversion.
Figure 13.9 shows the complete multiplier. Four-quadrant operation is achieved
by using two transconductance pairs with the bases driven in antiphase and the
emitters driven by a second V-I converter. Substituting Eq. (13.20) into Eq. (13.18)
and using the identities i1 + i2 = 2IX and i3 + i4 = i9, we obtain
i3 −i4 = vX1 −vX2
Rx IX
i9
Likewise, using the identity i5 + i6 = i10, we obtain
i6 −i5 = vX1 −vX2
Rx IX
i10
Subtracting the ﬁrst equation from the second pairwise and using i10 −i9 =
(2/Ry)(vY1 −vY2), we obtain
(i4 + i6) −(i3 + i5) = (vX1 −vX2)(vY1 −vY2)
Rx Ry IX/2
The output I-V converter is made up of the op amp and a third V-I converter
in its feedback path, namely, Q11-Q12. By KVL, the voltages at the inverting and
noninverting inputs are vN = VCC −R(i4 + i6 + i11) and vP = VCC −R(i3 +
i5 + i12). The op amp will provide Q12 with whatever drive it takes to make
vN = vP, or i4 + i6 + i11 = i3 + i5 + i12, that is,
(i4 + i6) −(i3 + i5) = i12 −i11 = 2
Rz
(vZ1 −vZ2)

668
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
Y1
Y2
Z1
Z2
R1
R
R
X1
X2
Q2
Q9
Q10
Q11
Q12
Q1
Q7
Q8
Q3
Q4
Q5
Q6
Out
IX
Rx
Ry
Rz
IX
IY
IY
IZ
IZ
VCC
VEE
+
–
FIGURE 13.9
Four-quadrant analog multiplier.
Combining the last two equations, we ﬁnally obtain
vZ1 −vZ2 = k(vX1 −vX2)(vY1 −vY2)
(13.21)
k =
Rz
Rx Ry IX
(13.22)
Most multipliers are designed for k = 1/(10 V). Letting vO = vZ1 −vZ2, vX =
vX1 −vX2, and vY = vY1 −vY2 gives Eq. (13.17).
One of the main causes of linearity error is the logarithmic term of Eq. (13.19).
This error is, to a ﬁrst approximation, compensated for by introducing an equal but
opposite nonlinearity term via the V-I converter Q11-Q12 inside the feedback path.
The architecture of Fig. 13.9 forms the basis of a variety of monolithic multipliers.
Two of the earliest and most popular examples are the AD534 and MPY100. The
AD534L version has a maximum pretrimmed total error of 0.25%, a maximum
linearity error of 0.12%, a typical small-signal bandwidth of 1 MHz, and a typical
1% amplitude error bandwidth of 50 kHz.
Multiplier Applications
Analog multipliers ﬁnd application in signal modulation/demodulation, analog com-
putation, curve ﬁtting, transducer linearization, CRT distortion compensation, and
a variety of voltage-controlled functions.1,6

669
SECTION 13.2
Analog
Multipliers
X1
X2
Y1
Y2
Z1
Z2
+
v2
vO
VO
+
v1
R
C
470 kΩ
50 kΩ
1 kΩ
AD534
Out
15 V
–15 V
FIGURE 13.10
Basic multiplier connection for vO = v1v2/10. If followed by a low-pass
ﬁlter, it can be used for phase detection.
Figure 13.10 shows the basic connection for signal multiplication, or vO =
v1v2/10. As such, it forms the basis of amplitude modulation and voltage-controlled
ampliﬁcation. When either input is zero, vO should also be zero, regardless of the
other input. In practice, because of slight component mismatches, a small fraction
of the nonzero input will feed through to the output, causing an error. In critical
applications such as suppressed-carrier modulation, this error can be minimized by
applying an external trim voltage (±30-mV range required) to the X2 or the Y2 input.
Of particular interest is the case in which the inputs are ac signals, or v1 =
V1 cos(ω1t + θ1) and v2 = V2 cos(ω2t + θ2), for then their product is, by a well-
known trigonometric identity
vO = V1V2
20 {cos[(ω1 −ω2)t + (θ1 −θ2)] + cos[(ω1 + ω2)t + (θ1 + θ2)]}
indicating that vO consists of two components, with frequencies equal to the sum
and the difference of the input frequencies. If the input frequencies are the same and
the high-frequency component is suppressed with a low-pass ﬁlter, as shown, then
we get
vO = V1V2
20
cos(θ1 −θ2)
(13.23)
In this capacity, the circuit can be used in ac power measurements or as a phase
detector in phase-locked-loop circuits.
Figure 13.11 shows how a multiplier can be conﬁgured for two other popular
functions, namely, analog division and square-root extraction. In Fig. 13.11a we
have, by Eq. (13.21), 0−v2 = (v1−0)(0−vO)/10, or vO = 10(v2/v1). To maximize
the denominator range, return the X2 input to a trimmable voltage (±3-mV range
required).
In Fig. 13.11b we have 0 −vI = (vO −0)(0 −vO)/10, or vO = √10vI . The
function of the diode is to prevent a latching condition, which could arise in the event
of the input inadvertently changing polarity. Additional applications are discussed
in the end-of-chapter problems.

670
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
RL
v2
vO
Z1
Z2
AD534
X1
X2
Y1
Y2
Out
vO = 10(v2/v1)
(a)
Z1
Z2
AD534
X1
X2
Y1
Y2
Out
vO =   10vI
(b)
vI
vO
v1
FIGURE 13.11
Analog divider and square rooter.
13.3
OPERATIONAL TRANSCONDUCTANCE AMPLIFIERS
An operational transconductance ampliﬁer (OTA) is a voltage-input, current-output
ampliﬁer. Its circuit model is shown in Fig. 13.12a. To avoid loading effects both
at the input and at the output, an OTA should have zd = zo = ∞. The ideal OTA,
whose circuit symbol is shown in Fig. 13.12b, gives iO = gmvD, or
iO = gm(vP −vN)
(13.24)
where gm is the unloaded transconductance gain, in amperes per volt.
In its simplest form, an OTA consists of a differential transistor pair with a
current-mirror load.7 We have encountered this conﬁguration when studying op
amp input stages in Chapter 5. In the bipolar example of Fig. 5.1 the OTA consists of
the Q1-Q2 pair and the Q3-Q4 mirror; in the MOS example of Fig. 5.4a it consists
of the M1-M2 pair and the M3-M4 mirror.
Besides serving as building blocks for other ampliﬁers, OTAs ﬁnd applica-
tion in their own right. Since it can be realized with just one stage and it operates
on the principle of processing currents rather than voltages, the OTA is an inher-
ently fast device.8 Moreover, gm can be varied by changing the bias current of
the differential transistor pair, making OTAs suited to electronically programmable
functions.
+
–
vD
iO
iO
gmvD
gmvD
zo
zd
+
–
vD
vP
vN
vP
vN
(b)
(a)
FIGURE 13.12
Operational transconductance ampliﬁer: (a) equivalent circuit and
(b) ideal model.

671
SECTION 13.3
Operational
Transconductance
Ampliﬁers
–
+
gm2
R
C
C1
C2
+
Vi
VLP
VBP
VBP
L
–
+
gm3
+
–
gm1
Vi
+
(b)
(a)
FIGURE 13.13
Second-order gm-C ﬁlter and its RLC equivalent.
gm-C Filters
A popular OTA application is the realization of fully integrated continuous-time
ﬁlters, where OTAs have emerged as viable alternatives to traditional op amps.7–9
OTA-based ﬁlters are referred to as gm-C ﬁlters because they use OTAs and capac-
itors, but no resistors and no inductors. A popular gm-C ﬁlter example is shown in
Fig. 13.13a. Its analysis proceeds as follows.
Denoting the currents out of the three OTAs as I1, I2, and I3, we have, by
Eq. (13.24), I1 = gm1(Vi −VBP), I2 = gm2VLP, and I3 = −gm3VBP. By Ohm’s
law, VLP = (1/sC2)I3 and VBP = (1/sC1)(I1 + I2). Combining, we get
VBP
Vi
=
sC2gm1/(gm2gm3)
s2C1C2/(gm2gm3) + sC2gm1/(gm2gm3) + 1
(13.25)
It is readily seen that this transfer function is the same as that of the RLC equiva-
lent of Fig. 13.13b, provided C = C1, R = 1/gm1, and L = C2/(gm2gm3). Evidently,
gm1 simulates a resistance, whereas the combination gm2-gm3-C2 simulates an in-
ductance. Moreover, the circuit provides VBP and VLP simultaneously, a feature
not available in its RLC counterpart. What is even more important is that we can
automatically tune f0 by varying gm2 and gm3, and tune Q by varying gm1.
EXAMPLE 13.2. (a) In the ﬁlter of Fig. 13.13a ﬁnd gm1 and gm2 = gm3 for ω0 = 105 rad/s
and Q = 5 with C1 = C2 = 100 pF. (b) What are the values of the simulated resistance
and the simulated inductance? (c) The sensitivities of the ﬁlter?
Solution.
(a) By inspection, ω0 = √gm2gm3/C1C2 and Q = √C1/C2 × √gm2gm3/gm1. Substi-
tuting the given data, we get gm2 = gm3 = 10 μA/V and gm1 = 2 μA/V.
(b) R = 500 k, and L = 1 H.
(c) The sensitivity of Q with respect to gm1 is −1; all other sensitivities are either 1
2 or
−1
2, which are fairly low.

672
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
Off-the-Shelf OTAs
Figure 13.14 shows a popular OTA available as an off-the-shelf IC. Its heart is the
linearized transconductance multiplier made up of D1-D2 and Q3-Q4. The remain-
ing blocks, each consisting of a BJT pair and a diode, are high-output-impedance
current mirrors of the Wilson type. Denoting the collector current of transistor Qk
as ik and ignoring base currents, we can describe circuit operation as follows.
The mirror Q1-D3-Q2 accepts the external control current IC and duplicates it
at the emitters of the Q3-Q4 pair to give
i3 + i4 = IC
The mirror Q5-D4-Q6 duplicates i3 to yield i6 = i3, and the mirror Q7-D5-Q8
duplicates i6 to yield i8 = i6, so i8 = i3. Likewise, the mirror Q9-D6-Q10 duplicates
i4 to yield i10 = i4. Consequently, KCL gives iO = i10 −i8, or
iO = i4 −i3
Retracing the reasoning of Section 5.1, we can write
iO = IC tanh vP −vN
2VT
(13.26)
Q3
IC
Q6
Q2
Q10
Q4
Q8
Q5
Q9
D2
D1
vP
vN
D6
D4
VCC
D5
D3
VEE
Q1
Q7
iO
Diode bias
FIGURE 13.14
Bipolar OTA.

673
SECTION 13.3
Operational
Transconductance
Ampliﬁers
where VT is the thermal voltage (VT ∼= 26 mV at room temperature). The plot of
iO versus (vP −vN) is the familiar s-shaped curve of Fig. 5.2b. As discussed in
connection with Fig. 1.24, the output will generally be distorted.
There are two ways to keep distortion under control. One is to restrict the Q3-Q4
pair to small-signal operation. To see how, expand as tanh x = x −x3/3 + . . .,
and observe that to approximate linear operation (tanh x ∼= x) we need to impose
|x3/3| ≪|x|, or |x| ≪
√
3. Letting x = (vP −vN)/(2VT ), small-signal operation
requires that we keep |vP −vN| ≪2
√
3VT (∼= 90 mV). Under this condition we have
io ∼= Gm(vp −vn)
where the transconductance gain
Gm =
IC
2VT
(13.27a)
is linearly proportional to the control current IC; as such, it is linearly programmable
bytheuser.Asweknow,BJTshandlecurrentrangesinexcessofﬁvedecades,ormore
than 100 dB, making bipolar OTAs particularly suited to a variety of programmable
circuits such as programmable ampliﬁers, oscillators, and ﬁlters, especially in wide-
dynamic range applications like audio and electronic music.
The small-signal constraint is generally a drawback, so a viable alternative is to
predistort the input drive (vP −vN) according to the inverse of the tanh function. A
circuit approximating this function is the diode network of Fig. 13.15a, consisting
of: (a) the voltage dividers R1-R2 and R3-R4 to suitably scale the external inputs
(in Fig 13.15a only one input, vI , is used, and the resistance values are designed to
accommodate input peak amplitudes of ±5 V); (b) the nonlinear diode pair D1-D2;
(b)
(a)
i3 – i4
vN – vP
Time t (ms)
1
0
−1
vN – vP (mV)
i3 – i4 (mV)
80
0
−80
0.5
0
2.0
1.0
1.5
0.5
0
2.0
1.0
1.5
Q4
Q3
VEE (−15 V)
VCC(15 V)
i3
D2
i4
R3
vP
RA
IC
A
10 kΩ
1 mA
13 kΩ
0
vN
vI
R2
0.5 kΩ
R1
10 kΩ
0
0
R4
0.5 kΩ
0
+
–
D1
FIGURE 13.15
Using PSpice to visualize the linearizing effect of the input diode network.

674
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
(c) the diode-biasing resistance RA. Figure 13.15b shows how the diode network
converts a triangular input vI of ±5-V peak values to a suitably distorted drive
(vN −vP) of ±60-mV peak values to yield a virtually undistorted triangular output
(i3 −i4), which the Wilson mirrors then convert to the output current iO. (Note the
similarity of Fig. 13.15b to Fig. 1.26b, except that the predistortion of Fig. 1.26 is
achievedvianegativefeedback,whereasthatofFig.13.15isachievedbymeansofthe
nonlinear diode network.) In light of the above, we express the transfer characteristic
of the circuit of Fig. 13.15a as
i3 −i4 = GmvI
where the transconductance gain is found empirically to be, for the component values
shown,
Gm ∼=
1
12.2 k
(13.27b)
Applications with Off-the-Shelf OTAs
Though OTA data sheets propose quite a variety of useful applications, we shall
examine a few representative ones, namely, voltage-controlled ampliﬁers, ﬁlters,
and oscillators (VCAs, VCFs, and VCOs).
Figure 13.16 shows a basic VCA (note the alternative symbol for the OTA). Here
OA1 and Q1 form a V-I converter to provide IC = VC/R, where we are assuming
the base current of Q1 to be negligible. OA2 converts iO to a voltage vO, and since
iO is proportional to the product IC × vI , the ﬁnal result is vO = AvI ,
A = kVC
(13.28)
where k is a suitable proportionality constant, in V−1. The 1-k pot is used for offset
nulling, and the 25-k pot for the calibration of k. By Eq. (13.27b), adjusting the
25-k pot near 12.2 k yields k = 1/(10 V), indicating that varying VC from 0 to
D1
1N914
R
+
vI
VC
10 kΩ
1 kΩ
1 kΩ
+
–
OTA
IC
iO
13 kΩ
25 kΩ
15 V
Q1
2N3906
+
10 kΩ
+
–
OA2
+
–
OA1
TL072
TL072
1/2 LM13600
vO
FIGURE 13.16
Voltage-controlled ampliﬁer with linear control.

675
SECTION 13.3
Operational
Transconductance
Ampliﬁers
+
–
R2
R1(T)
+
VC
2.2 kΩ
LM385
Q1
Q2
OA
OTA
1N914
2.5 V
330 pF
AD821
–15 V
8.2 kΩ
2.49 kΩ
TL071
IC
FIGURE 13.17
OTA with exponential control.
10 V will change A from 0 to 1 V/V. The circuit is calibrated as follows: (a) with
vI = 0, sweep VC from 0 to 10 V and adjust the 1-k pot for the minimum deviation
of vO from 0 V; (b) with VC = 10 V, adjust the 25-k pot so that vO = 10 V for
vI = 10 V.
The circuit of Fig. 13.16 provides linear gain control. Audio applications often
call for exponential control, or
A = A0bkVC
(13.29)
where b is usually either 10 or 2, k is a proportionality constant in decades or octaves
per volt, and A0 is the gain for VC = 0. Exponential control is readily achieved by
generating IC with an antilog converter, as shown in Fig. 13.17. Since IC must be
sourced to the OTA, the BJTs must be of the pnp type. With VC = 0, the circuit
gives IC = 1 mA; increasing VC decreases IC exponentially with a sensitivity of k
dec/V or k oct/V, with k being set by R2.
OTA-based VCFs and VCOs rely on the integration of the OTA’s output current
usingacapacitor.TheexampleofFig.13.18alsousesanopamptoprovidelowoutput
C
V1
V2
1 kΩ
10 kΩ
10 kΩ
13 kΩ
15 V
Io
IC
+
–
OTA
Vo
+
–
OA
FIGURE 13.18
Current-controlled integrator.

C
10 kΩ
10 kΩ
1N914
13 kΩ
 LM13600
TL072
TL072
1 kΩ
1 kΩ
Q ¥ 10 kΩ
15 V
+
–
+
–
C
10 kΩ
13 kΩ
13 kΩ
15 V
–15 V
IC
+
–
+
–
OTA1
OTA2
OA1
OA2
VBP
VLP
+
Vi
+
VC
Q2
Q1
V-I
Converter
AD821
1
2
1
2
 LM13600
1
2
AD821
1
2
FIGURE 13.19
Voltage-controlled state-variable ﬁlter.
676

677
SECTION 13.3
Operational
Transconductance
Ampliﬁers
impedance. Writing Vo = (−1/sC)Io = (−1/sC) × [IC/(12.2 V)] × (V2 −V1),
and letting s = j2π f , we obtain
Vo =
1
j f /f0
(V1 −V2)
f0 =
IC
2π(12.2 V)C
(13.30)
The circuit integrates the difference V1 −V2 with a programmable unity-gain fre-
quency f0. For instance, varying IC from 1 μA to 1 mA with C = 652 pF will
sweep f0 over the entire audio range, from 20 Hz to 20 kHz. IC can be generated
either with a linear V-I converter, as in Fig. 13.16, or with an exponential converter,
as in Fig. 13.17.
The circuit of Fig. 13.19 uses two OTA-based integrators to implement a state-
variable topology of the type of Fig. 4.37. The output current of the V-I converter,
which can be controlled either linearly or exponentially, is split between the two
OTAs by the suitably biased AD821 matched BJT pair.
Applying Eq. (13.30), we get VBP = (Vi −VBP/Q −VLP)/( j f /f0) and VLP =
VBP/( j f /f0). Combining, we obtain
VBP
Vi
= QHBP
VLP
Vi
= HLP
(13.31)
where HBP and HLP are the standard second-order band-pass and low-pass functions
deﬁned in Section 3.4, and
f0 =
IC
4π(12.2 V)C
If a resonance gain of unity is desired, then increase the 10-k input resistance by a
factor of Q. To reduce Q-enhancement effects, follow the directions of Section 6.5
and use a small phase-lead capacitor in parallel with the 10-k interstage resistance.
In the circuit of Fig. 13.20 the OTA is used to source/sink a current of value IC,
and thus charge/discharge C at a programmable rate. The resulting triangle waveform
alternates between 5 V and 10 V, the thresholds of the high-input-impedance CMOS
C
1 kΩ
2 kΩ
THRESH
TRIG
OUT
RES
DISCH
TLC555
10 kΩ
10 kΩ
1
3
4
8
6
2
7
15 V
–15 V
IC
VCC
vO
+
–OTA
FIGURE 13.20
Current-controlled relaxation oscillator.

678
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
timer. The frequency of oscillation is (see Problem 13.16),
f0 =
IC
10C
(13.32)
As usual, IC can be controlled either linearly or exponentially. If the triangular wave
is used, a buffer ampliﬁer may be required.
13.4
PHASE-LOCKED LOOPS
A phase-locked loop (PLL) is a frequency-selective circuit designed to synchronize
with an incoming signal and maintain synchronization in spite of noise or variations
in the incoming signal frequency. As depicted in Fig. 13.21, the basic PLL system
comprises a phase detector, a loop ﬁlter, and a voltage-controlled oscillator (VCO).
The phase detector compares the phase θI of the incoming signal vI against
the phase θO of the VCO output vO, and develops a voltage vD proportional to
the difference θI −θO. This voltage is sent through a low-pass ﬁlter to suppress
high-frequency ripple and noise, and the result, called the error voltage vE, is applied
to the control input of the VCO to adjust its frequency ωO.
The VCO is designed so that with vE = 0 it is oscillating at some initial
frequency ω0 called the free-running frequency, so its characteristic is
ωO(t) = ω0 + KovE(t)
(13.33)
where Ko is the sensitivity of the VCO, in radians-per-second per volt. If a periodic
input is applied to the PLL with frequency ωI sufﬁciently close to the free-running
frequency ω0, an error voltage vE will develop, which will adjust ωO until vO
becomes synchronized with vI , that is, until for every input cycle there is one, and
only one, VCO cycle. At this point the PLL is said to be locked on the incoming
signal, and it gives ωO = ωI exactly.
Should ωI change, the phase shift between vO and vI will start to increase,
changing vD and, hence, the control voltage vE. This change in vE is designed to
adjust the VCO until ωO is brought back to the same value as ωI . This self-adjusting
ability by the feedback loop allows the PLL, once locked, to track input frequency
changes. Since a change in ωI is ultimately reﬂected by a change in vE, we use vE
as the output of the PLL whenever we wish to detect changes in ωI , as in FM and
FSK demodulation.
Voltage-
controlled
oscillator
Loop
filter
Phase 
detector
vI (wI, qI)
ω θ
vO (wO, qO)
ω
θ
vD
vE
FIGURE 13.21
Basic phase-locked loop.

679
SECTION 13.4
Phase-Locked
Loops
A PLL can be designed to lock on the incoming signal in spite of noise that might
afﬂict such a signal. A noisy input will generally cause the phase-detector output
vD to jitter around some average value. However, if the ﬁlter cutoff frequency is
low enough to suppress this jitter, vE will emerge as a clean signal, in turn resulting
in a stable VCO frequency and phase. We thus use ωO as the output of the PLL
whenever we wish to recover a signal buried in noise, and also in frequency-related
applications such as frequency synthesis and synchronization.
Lock and Capture
To develop a concrete understanding of PLL operation, consider the case of phase
detection being accomplished with a balanced mixer of the type discussed in Sec-
tion 13.2. As we know, the mixer output contains the sum and difference frequencies
ωI ± ωO. When the loop is locked, the sum is twice ωI and the difference is zero,
or dc. The low-pass ﬁlter suppresses the sum but passes the dc component, which
thus keeps the loop in lock.
If the loop is not locked, and if the difference frequency falls above the cutoff
frequency of the ﬁlter, it will be suppressed along with the sum frequency, leaving
the loop unlocked and oscillating at its free-running frequency. However, if ωO is
sufﬁciently close to ωI to make the difference frequency approach the ﬁlter band
edge, part of this component is passed, tending to drive ωO toward ωI . As the
difference ωO −ωI is reduced, more error signal is transmitted to the VCO, resulting
in a constructive effect that ultimately brings the PLL in lock.
The capture range is the frequency range ±
ωC, centered about ω0, over which
the loop can acquire lock. This range is affected by the ﬁlter characteristics, and gives
an indication of how close ωI must be to ω0 to acquire lock. The lock range is the
frequency range ±
ωL, also centered about ω0, over which the loop can track the
inputoncelockhasbeenestablished.Thelockrangeisaffectedbytheoperatingrange
of the phase detector and the VCO. The capture process is a complex phenomenon,
and the capture range is never greater than the lock range.
The time it takes for a PLL to capture the incoming signal is called the capture
time or pull-in time. This time depends on the initial frequency and phase differences
between vI and vO, as well as the ﬁlter and other loop characteristics. In general, it
can be said that reducing the ﬁlter bandwidth has the following effects: (a) it slows
down the capture process, (b) it increases the pull-in time, (c) it decreases the capture
range, and (d) it increases the interference-rejection capabilities of the loop.
The PLL in the Locked Condition
When in the locked condition, a PLL can be modeled10–12 as in Fig. 13.22. This
diagram is similar to that of Fig. 13.21, except that we are now working with Laplace
transforms of signal changes (symbolized by lowercase letters with lowercase sub-
scripts) about some operating point, and operations on these changes, both of which
are generally functions of the complex frequency s. The phase detector develops the
voltage change
vd(s) = Kdθd(s)
(13.34a)
θd(s) = θi(s) −θo(s)
(13.34b)

680
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
1/s
vi
Σ
vd   
Ko
Ko
vd
Kd
F(s)
ve
Ka
θ
θ
θ
vi
ω
vo
ω
1/s
+
–
FIGURE 13.22
Block diagram of the basic PLL system in the locked condition.
where Kd is the phase-detector sensitivity, in volts per radian. This voltage is sent
through the loop ﬁlter, whose transfer function is denoted as F(s), and possibly
an amplifer with gain Ka, in volts per volt, to produce the error-voltage variation
ve(s). This, in turn, is converted to the frequency variation ωo(s) = Kove(s), by
Eq. (13.33).
Since the phase detector processes phase, we need a means for converting from
frequency to phase. Considering that frequency represents the rate of change of
phase with time, or ω = dθ(t)/dt, we have
θ(t) = θ(0) +
 t
0
ω(ξ) dξ
(13.35)
indicating that frequency-to-phase conversion is inherently an operation of integra-
tion. Exploiting the well-known Laplace transform property that integration in the
time domain corresponds to division by s in the frequency domain, we use the 1/s
blocks shown.
If we were to open the loop at the inverting input of the phase comparator, the
overall gain experienced by θi(s) in going around the path and emerging as θo(s) is
Kd × F(s) × Ka × Ko × 1/s, or
T (s) = Kv
F(s)
s
(13.36)
Kv = Kd KaKo
(13.37)
where T (s) is the open-loop gain, in radians per radian, and Kv is called the gain
factor, in s−1. With the loop closed, we readily ﬁnd
H(s) = θo(s)
θi(s) =
T (s)
1 + T (s) =
KvF(s)
s + Kv F(s)
(13.38)
Other transfer functions may be of interest, depending on what we consider as input
and output. For instance, substituting θi(s) = ωi(s)/s and θo = (Ko/s)ve(s), we
readily get
ve(s)
ωi(s) = 1
Ko
H(s)
(13.39)

681
SECTION 13.4
Phase-Locked
Loops
which allows us to ﬁnd the voltage change ve(s) in response to an input frequency
change ωi(s), as in FM and FSK demodulation.
Comparing Fig. 13.22 with Fig. 1.22, we observe that a PLL is a negative-
feedback system with xi = θi, x f = θo, and aβ = T = Kv F(s)/s, indicating that
the open-loop gain T plays also the role of the loop gain of the system. Further, even
though we are more attuned to frequency, we must recognize that the natural input
of a PLL is phase. Since T →∞as s →0, the PLL will force θo to track θi, just
as an op amp voltage follower forces vo to track vi. In this respect, it pays to view
a PLL as a phase follower. The fact that it also forces ωO to track ωI is a conse-
quence of this phase-follower action, along with the phase-frequency relationship
ω = dθ/dt.
As seen in Chapter 8, the loop gain T affects both the dynamics and the stability
of the PLL. In turn, T (s) is strongly inﬂuenced by F(s). We make the following
observations: (a) The number of poles of H(s) deﬁnes the order of the loop; (b) the
number of 1/s terms (or integrations) present within the loop deﬁnes the type of
loop. Because of the 1/s function associated with the VCO, a PLL is at least Type I,
and its order equals the order of the ﬁlter plus 1.
First-Order Loop
Consider the instructive case in which there is no loop ﬁlter, or F(s) = 1. The
result is a ﬁrst-order loop, and the above equations simplify, after the substitution
s →jω, as
T ( jω) =
1
jω/Kv
(13.40)
ve( jω)
ωi( jω) =
1/Ko
1 + jω/Kv
(13.41)
Equation (13.40) indicates a Type I loop with crossover frequency ωx = Kv and
phase margin φm = 90◦. Equation (13.41) indicates that the loop inherently pro-
vides a ﬁrst-order low-pass response with a dc gain of 1/Ko V/(rad/s) and a cutoff
frequency of Kv rad/s.
If ωi(t) is a step change, the resulting change ve(t) will be an exponential
transient governed by the time constant τ = 1/Kv. If ωi(t) is varied sinusoidally
with a modulating frequency ωm, ve(t) will also vary sinusoidally with the same
frequency ωm; its amplitude is |ve| = (1/Ko)|ωi| at low frequencies, and rolls off
with ωm at the rate of −1 dec/dec past Kv.
EXAMPLE 13.3. A ﬁrst-order PLL with Kv = 104 s−1 uses a VCO with a free-running
frequency of 10 kHz and a sensitivity of 5 kHz/V. (a) What is the control voltage
needed to lock the PLL on a 20-kHz input signal? On a 5-kHz input signal? (b) Find
the response ve(t) if the input frequency is changed stepwise as fI = [10 + u(t)] kHz,
where u(t) = 0 for t < 0 and u(t) = 1 for t > 0. (c) Repeat if the input frequency is
modulated as fI = 10[1 + 0.1 cos(2π fmt)] kHz, fm = 2.5 kHz.

682
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
Solution.
(a) By Eq. (13.33), vE = (ωO −ω0)/Ko, where ω0 = 2π104 rad/s and Ko = 2π ×
5 × 103 = π104 (rad/s)/V. For ωO = 2π × 20 × 103 rad/s we get vE = 2 V, and for
ωO = 2π × 5 × 103 rad/s we get vE = −1 V.
(b) The response to a step increase ωi(t) = 2πu(t) krad/s is an exponential transient
with amplitude |ωi(t)|/Ko = 2π103/104π = 0.2 V, and time constant 1/Kv =
1/104 = 100 μs, so
ve(t) = 0.2[1 −e−t/(100 μs)]u(t) V
(c) Now ωi(t) = 2π ×104×0.1(cos 2π fmt) = 2π103 cos(2π2500t) rad/s. Calculating
Eq. (13.41) at jω = jωm = j2π2500 rad/s gives
ve( jωm)
ωi( jωm) =
1/104π
1 + j2π2500/104 = 0.5370
104π
/−57.52◦V/(rad/s)
Letting ωi( jωm) = 2π103/0◦rad/s gives ve( jωm) = 0.1074 /−57.52◦V, so
ve(t) = 0.1074 cos(2π2500t −57.52◦) V
The absence of a loop ﬁlter drastically limits the selectivity and noise-
suppression capabilities of a PLL, so ﬁrst-order loops are seldom used in practice.
Second-Order Loops
Most PLLs utilize a one-pole low-pass ﬁlter and are thus second-order loops. Such
a ﬁlter provides a ﬂywheel-like function that allows the VCO to smooth over noise
and jumps in the input frequency. As seen in Chapter 8, the presence of a second
pole within the loop erodes the phase margin, so care must be exercised to avoid
instability. Second-order loops are also stabilized by introducing a ﬁlter zero to
counterbalance the phase lag due to the ﬁlter pole.
A popular loop ﬁlter is shown in Fig. 13.23a. Called a passive lag-lead ﬁlter, it
provides the transfer function
F(s) = 1 + s/ωz
1 + s/ωp
(13.42)
where ωz = 1/(R2C) and ωp = 1/(R1 + R2)C. By Eq. (13.36), the loop gain is
now
T ( jω) =
1 + jω/ωz
( jω/Kv)(1 + jω/ωp)
(13.43)
indicating a second-order, Type I loop. This gain is plotted in Fig. 13.23b for the case
in which ωz is positioned at the geometric mean of ωp and Kv, or ωz = ωpKv.
The crossover frequency is then ωz itself, and the phase margin is 45◦. Also shown
for comparison is the loop gain of the ﬁrst-order loop, or F(s) = 1.

683
SECTION 13.4
Phase-Locked
Loops
0
T   (dB)
p
ω
z
ω
ω (dec)
ω 
Kv
(b)
(a)
–20 dB/dec
1st order loop
R2
C
R1
Vo
+
–
Vi 
+
–
FIGURE 13.23
Passive lag-lead ﬁlter, and magnitude plot of the loop gain T.
EXAMPLE 13.4. (a) Given a PLL system with Kv = 104 s−1, specify a passive lag-lead
ﬁlter for a crossover frequency ωx = 103 rad/s and a phase margin φm = 45◦. (b) What
are the actual values of ωx and φm?
Solution.
(a) For φm ∼= 45◦we want ωz = ωx = 103 rad/s, so ωp = ω2
z/Kv = 106/104 = 100 rad/s.
Let C = 0.1 μF. Then, R2 = 1/(ωzC) = 10 k, and R1 = 1/(ωpC)−R2 = 90 k
(use 91 k).
(b) Using Eq. (13.43), along with the trial-and-error technique of Example 8.1, we ﬁnd
the actual values ωx = 1.27 krad/s, and φm = 180◦+ T ( j1.27 × 103) = 56◦.
Another popular loop ﬁlter is the active PI ﬁlter of Fig. 13.24a, so called because
its output is proportional to the input as well as to the integral of the input. The
inverting stage OA2 can be omitted by interchanging the phase-detector inputs, if
needed. Assuming ideal op amps, the ﬁlter gives
F(s) = 1 + s/ωz
s/ωp
(13.44)
R2
R1
R3
R3
C
Vi
+
–
OA1
Vo
+
–
OA2
0
T   (dB)
p
ω
z
ω
ω  (dec)
ω 
Kv
(a)
(b)
FIGURE 13.24
Active PI ﬁlter, and magnitude plot of the loop gain T.

684
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
where ωz = 1/R2C and ωp = 1/R1C. The corresponding loop gain is
T ( jω) =
1 + jω/ωz
( jω/Kv)( jω/ωp)
(13.45)
indicating a second-order, Type II loop. As shown in Fig. 13.24b, the slope is
−40 dB/dec below ωz, and −20 dB/dec above ωz. Imposing again ωz = ωpKv
gives ωx ∼= ωz and φm ∼= 45◦.
Compared to the passive ﬁlter, whose dc gain is F(0) = 1, the active ﬁlter gives
F(0) = ∞, indicating that the phase error θD needed to sustain the control voltage
vE approaches zero when the PI ﬁlter is used. In practice, F(0) is limited by the ﬁnite
dc gain of OA1; even so, θD will still be vanishingly small, implying θO ∼= θI , or
phase coherence at the detector input. The use of the active ﬁlter also avoids possible
loading effects at the output.
Damping Characteristics
Additional insight is gained by substituting Eqs. (13.42) and (13.44) into Eq. (13.38),
and then expressing the latter in the standard form of Eq. (3.40). The results (see
Problem 13.20) are
H(s) = (2ζ −ωn/Kv)(s/ωn) + 1
(s/ωn)2 + 2ζ(s/ωn) + 1
(13.46a)
ωn =

ωpKv
ζ = ωn
2ωz

1 + ωz
Kv

(13.46b)
for the passive lag-lead ﬁlter, and
H(s) =
2ζ(s/ωn) + 1
(s/ωn)2 + 2ζ(s/ωn) + 1
(13.47a)
ωn =

ωpKv
ζ = ωn
2ωz
(13.47b)
for the active PI ﬁlter. As we know, ωn is the undamped natural frequency, and ζ
is the damping ratio. If ωn ≪Kv, as is predominantly the case, Eq. (13.46) reduces
to Eq. (13.47) and the PLL with the passive lag-lead ﬁlter is said to be a high-gain
loop. We observe that H(s) is in both cases a combination of the band-pass response
HBP and the low-pass response HLP. At low frequencies H →HLP, but at high
frequencies H →HBP.
Recall that for ζ < 1 the step response exhibits overshoot. To keep the latter
within reason, it is customary to design for 0.5 ≤ζ ≤1. Under this condition, the
time constant governing the loop response to small phase or frequency changes is
roughly7
τ ∼= 1
ωn
(13.48)
and the loop bandwidth, obtained by imposing |H( jω)| = 1/
√
2, is13
ω−3 dB = ωn[1 ± 2ζ 2 +

1 + (1 ± 2ζ 2)2]1/2
(13.49)
where the plus (minus) sign holds for high-gain (low-gain) loops.

685
SECTION 13.4
Phase-Locked
Loops
EXAMPLE 13.5.
(a) Find ζ, τ, and ω−3 dB for the PLL of Example 13.4. (b) Find the
response ve(t) to small input changes of the type ωi = |ωi|u(t) and ωi = |ωi| cos(ωmt),
ωm = 1 krad/s.
Solution.
(a) By Eq. (13.46b), ωn =
√
102 × 104 = 1 krad/s and ζ = [103/(2 × 103)](1 +
103/104) = 0.55. Using Eq. (13.49) for the high-gain loop case gives ω−3 dB ∼=
1.9ωn = 1.9 krad/s. By Eq. (13.48), τ ∼= 1/103 = 1 ms.
(b) Substituting the above data into Eq. (13.46a) gives
H(s) =
s/103 + 1
(s/103)2 + 1.1(s/103) + 1
This function has a complex pole pair at s = −550 ± j835 complex Np/s, indicating
a step response of the type
ve(t) = |ωi|
Ko
[1 −Ae−550t cos(835t + φ)]
with A and φ suitable constants. Calculating H(s) at s = jωm as in Example 13.3,
we ﬁnd the ac response as
ve(t) = |ωi|
Ko
1.286 cos(103t −45◦)
Filter Design Criteria
In general, ωn is chosen high enough to ensure satisfactory dynamics, yet low enough
to provide sufﬁcient ﬂywheel action for smoothing over undesired frequency jumps
or noise. A typical design process proceeds as follows: (a) ﬁrst, choose ωn to achieve
either the desired ω−3 dB or the desired τ, depending on the application; (b) next,
using Eq. (13.46b) or (13.47b), specify ωp for the chosen ωn; (c) ﬁnally, specify ωz
for the desired ζ.
We observe that because of the ﬁlter zero, a second-order PLL acts as a ﬁrst-
order loop at high frequencies, indicating a reduced ability to suppress ripple and
noise. This drawback can be overcome by adding a capacitance C2 ≪C in parallel
with R2 in either of the above ﬁlters. This creates an additional high-frequency pole
and turns the loop into a third-order loop. To avoid perturbing the existing values of
ωx and φm signiﬁcantly, this pole is positioned about a decade above ωx by imposing
1/(R2C2) ∼= 10ωx.
EXAMPLE 13.6.
Redesign the ﬁlter of Example 13.4 for ω−3 dB = 1 krad/s and ζ =
1/
√
2. What are the new values of τ and φm? What value of C2 would yield a third-order
loop without reducing φm too much?
Solution. With ζ = 1/
√
2 we get ωn ∼= ω−3 dB/2 = 103/2.0 = 500 rad/s, so τ ∼= 2 ms.
Equation (13.46b) gives ωp = 25 rad/s and ωz = 366 rad/s, which can be realized with
C = 1 μF, R1 = 39 k, and R2 = 2.7 k. Proceeding as in Example 13.4, we ﬁnd
ωx ∼= 757 rad/s, and φm ∼= 66◦. Use C2 ∼= C/10 = 0.1 μF.

686
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
13.5
MONOLITHIC PLLS
Monolithic PLLs are available in various technologies and in a wide range of perfor-
mance speciﬁcations.12 In the following we discuss the popular 4046 CMOS PLL
as a representative example.
The 74HC(T)4046A CMOS PLL
Originally developed by RCA, the 4046 family of CMOS PLLs has gone through
a series of improvements, and presently includes the 74HC(T)4046A, the
74HC(T)7046A, and the 74HC(T)9046A.13 We select the 4046A version, shown
in simpliﬁed form in Fig. 13.25, because it includes the three most common phase
detector types, known as Type I (PC1), Type II (PC2), and Type III (PC3) phase
comparators. Since the circuit is powered from a single supply (typically VSS = 0 V
and VDD = 5 V), all analog signals are referenced to VDD/2, or 2.5 V.
The VCO
The VCO, whose details7,13 are omitted for brevity, is a current-controlled mul-
tivibrator operating on a principle similar to that of the emitter-coupled VCO of
Fig. 10.30. The current for the capacitor is obtained from the control voltage vE via
a V-I converter whose sensitivity is set by R1 and whose output is offset by R2. The
VCO characteristic is of the type
fO =
k1
R1C vE +
k2
R2C
(13.50)
C
VSS
VDD
VCO
 in
VCO
 out
Comp
 in
Sig
 in
PC1
VCO
6
7
11
12
4
8
3
14
16
2
13
9
15
PC2
PC3
PC1 out
PC2 out
PC3 out
R1
R2
FIGURE 13.25
Simpliﬁed block diagram of the 4046A CMOS PLL.

687
SECTION 13.5
Monolithic PLLS
fO
fO(max)
f0
fO(min)
vE(min)
vE(max)
0.5VDD
VDD
vE
fO(off)
0
0
Set by R2C
Set by R1C
2fR
Ko
FIGURE 13.26
VCO characteristic and terminology.
where k1 and k2 are suitable circuit constants. As shown in Fig. 13.26, the value of
fO corresponding to vE = VDD/2 is called the center frequency f0. It is apparent
that if R2 is omitted (R2 = ∞), the frequency offset fO(off) = k2/(R2C) becomes
zero. The maximum VCO frequency of CMOS PLLs is typically on the order of
10 MHz.
The VCO characteristic of Eq. (13.50) holds only as long as vE is conﬁned
within the range vE(min) ≤vE ≤vE(max). For a 4046A PLL with VDD = 5 V, this
range is typically13 1.1 V ≤vE ≤3.9 V. The frequency range corresponding to the
permissible range of vE is called the VCO frequency range 2 fR. Outside this range
the VCO characteristic depends on the particular 4046 version, and it can be found
in the data sheets.
The VCO sensitivity is Ko = 2 fR/[vE(max) −vE(min)]. In FM applications it
is usually required that the V-F characteristic of the VCO be highly linear in order
to minimize distortion. However, in such applications as frequency synchronization,
synthesis, and reconstruction the linearity requirements are less stringent.
The Type I Phase Comparator
The Type I phase comparator, depicted in Fig. 13.27a, is an exlusive-OR (XOR) gate.
This gate outputs vD = VDD = 5 V whenever its input levels disagree with each
other, and vD = VSS = 0 whenever they agree. This is exempliﬁed in the timing
diagram of Fig. 13.28, where the waveforms have been plotted as a function of ωI t.
It is apparent that if we average out vD(t) by means of a low-pass ﬁlter, the result is
VD = DVDD, where D is the duty cycle of vD. D is minimized when the inputs are
in phase with each other, and maximized when they are in antiphase. If both input
waveforms have 50% duty cycles, as shown, then 0 ≤D ≤1. Consequently, PC1 will
exhibit the characteristic of Fig. 13.27b, and Kd = VDD/π = 5/π = 1.59 V/rad.
An alternative implementation of the Type I comparator, especially in bipo-
lar PLLs designed to work with low-amplitude inputs, is a four-quadrant multi-
plier, as discussed in Section 13.2. Also called a balanced modulator, the multiplier
is implemented with a scale factor high enough to ensure that vI will typically

688
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
VD
0
0
/2
D
VDD
VDD/2
(b)
vD
vI
vO
vO
vO
(a)
θ
π
π
FIGURE 13.27
Type I phase comparator, and its output average VD as a
function of the input phase difference.
2π
θ 
It
ω
vI
vO
vD
D
θ D
θ D
π   
FIGURE 13.28
Typical waveforms for the Type I phase comparator in the locked condition: θD = π/6 (left),
θD = π/2 (center), and θD = (5/6)π (right).
overdrive the multiplier and thus render the sensitivity Kd independent of the am-
plitude of vI .10
The Type I comparator requires that both inputs have 50% duty cycles; if at least
one input is asymmetrical (see Problem 13.23), the characteristic will generally be
clipped, reducing the lock range. Another notorious feature of the Type I comparator
is that it may allow the PLL to lock on harmonics of the input signal. Note that if
vI is absent, vD oscillates at the same frequency as vO, so the average of vD is
VD = 0.5VDD, and ωO = ω0.
The Type III Phase Comparator
The Type III comparator, shown in simpliﬁed form in Fig. 13.29a, overcomes both of
the above limitations by using an edge-triggered set-reset (SR) ﬂip-ﬂop. As depicted
in Fig. 13.30, vD now responds only to the rising edges of vI and vO, regardless of the
duty cycles. It is readily seen that the phase range of PC3 is twice as large as that of
PC1, so the characteristic is as in Fig. 13.29b, and Kd = VDD/(2π) = 0.796 V/rad.
The advantages of edge-triggering operation come at the price of higher sen-
sitivity to noise. An input noise spike may falsely toggle the ﬂip-ﬂop and cause
unacceptable output errors. By contrast, with a Type I comparator, an input spike is
merely transmitted to the output, where it is suppressed by the loop ﬁlter.

689
SECTION 13.5
Monolithic PLLS
VD
0
0
π
2
θD
VDD
VDD/2
vO
vI
vD
S
R
FF
Q
(a)
(b)
π
θ
FIGURE 13.29
Type III phase comparator, and its output average VD as a
function of the input phase difference.
We observe that in the locked condition the output frequency is ωD = 2ωI for
PC1, and ωD = ωI for PC3, so the ripple at the output of the loop ﬁlter is generally
higher with PC3 than with PC1. Note that with vI absent, PC3 will drive ωO as low
as it can.
2ππ
θ
θ
vI
vO
vD
  It
D
D
θD
ω
FIGURE 13.30
Typical waveforms for the Type III phase comparator in the locked condition: θD =
π/4 (left), θD = π (center), and θD = (7/4)π (right).
The Type II Phase Comparator
The Type II comparator differs from PC1 and PC3 because its output depends not
only on the phase error θI −θO, but also on the frequency error ωI −ωO when the
loop has not yet acquired lock. Also called a phase-frequency detector (PFD), the
circuit is shown in simpliﬁed form in Fig. 13.31a.
With reference to Fig. 13.32, we observe that PC3 produces UP pulses when the
rising edge of vI leads that of vO, DN pulses when the rising edge of vI lags that
of vO, and no pulses when the leading edges are aligned. An UP pulse closes the
MOSFET switch Mp and causes the ﬁlter capacitance C to charge toward VDD
via the series R1 + R2. A DN pulse closes switch Mn and discharges C toward
VSS = 0 V. Between pulses, both Mp and Mn are off, providing a high-impedance
state to the ﬁlter. When PC2 is in this state, C acts as an analog memory, retain-
ing whatever charge it had accumulated at the end of the last UP or DN pulse.

690
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
VD
0
0
−2π
2π
θD
VDD
VDD/2
VDD
vO
D
FF2
FF1
Q
vI
VDD
D
Q
Q
(a)
(b)
UP
DN
C
R2
R1
vD
VDD
Mn
Mp
vE
vC
+
–
θ
π
π
CL
CL
FIGURE 13.31
Type II phase comparator, and its output average VD as a function of the input phase difference.
Clearly, we now have vD = vE = vC. The characteristic is as in Fig. 13.31b, with
Kd = VDD/(4π) = 0.398 V/rad. For obvious reasons, PC2 is also called a charge-
pump phase comparator.
To appreciate its operation, suppose we initially have ωI > ωO. Since vI gen-
erates more rising edges per unit time than vO, UP will be high most of the time,
pumping charge into C and thus raising ωO. Conversely, when ωI < ωO, DN is high
most of the time, pumping charge out of C and lowering ωO. In either case, PC2
will keep pumping charge until the inputs become equal both in frequency and in
phase, or ωO = ωI and θO = θI . We conclude that PC2 approaches ideal-integrator
behavior.
vO
vD
vI
DN
UP
    I t
ω
FIGURE 13.32
Typical waveforms for the Type II phase comparator for ωO = ωI: vO
lags vI (left), vO is in phase with vI (center), and vO leads vI (right).

691
SECTION 13.5
Monolithic PLLS
It is apparent that a PLL with a Type II comparator will lock under any condition,
and that it drives the input-phase error to zero over the full frequency range of the
VCO. Moreover, since the UP and DN pulses disappear entirely once the loop is
locked, vE will exhibit no ripple, so there are no unwanted phase modulation effects.
The main drawback of PC2 is its susceptibility to noise spikes, just like PC3. Even
so, PC2 is the most popular of the three PCs. Note that with vI absent, PC2 will
drive ωO as low as it can.
Designing with PLLs
The design process of a PLL-based system involves a number of decisions12 dictated
by the performance speciﬁcations of the given application, along with considerations
of circuit simplicity and cost. For 4046 PLLs, this process requires (a) the speci-
ﬁcation of the VCO parameters f0 and 2 fR, the choice of (b) the phase-detector
type and (c) the ﬁlter type, and (d) the speciﬁcation of the ﬁlter parameters ωp
and ωz.
To simplify the process, computer programs are available that accept spec-
iﬁcations by the user and translate them into actual resistance and capacitance
values to meet the VCO and ﬁlter requirements. An example is the HCMOS
Phase-Locked Loop Program, by Philips Semiconductors, which also provides im-
portant data about the loop dynamics and displays the frequency response
via Bode plots. Once a PLL system has been designed, it can be simulated by
computer,7,12 for instance, using suitable SPICE macromodels.14 However, the de-
signer still needs a sound understanding of PLL theory to judge the results of any
simulation!
PopularPLLapplications10 includeFM,PM,AM,andFSKmodulation/demod-
ulation, frequency synchronization and synthesis, clock reconstruction, and motor
speed control. Here we discuss two examples, FM demodulation and frequency
synthesis. Other examples can be found in the end-of-chapter problems.
EXAMPLE 13.7.
An FM signal is being modulated over the range of 1 MHz ± 10 kHz
withamodulatingfrequencyof1kHz.Usinga4046APLL,designacircuittodemodulate
such a signal.
Solution. For the VCO we let f0 = 1 MHz, and choose 2 fR wide enough to accommo-
date parameter spread. Thus, let 2 fR = 0.5 MHz. This gives Ko = 2π ×0.5×106/2.8 =
1.122 × 106 (rad/s)/V. Using the data sheets or the aforementioned PLL program,
we ﬁnd that a suitable set of VCO components is R1 = 95.3 k, R2 = 130 k, and
C = 100 pF.
Next, anticipating a noisy input signal, we choose PC1, so Kd = 5/π V/rad and
Kv = Kd Ko = 1.786 × 106 s−1. To allow for the possibility of a weak input, we
take advantage of the fact that the detector input buffers are self-biased near VDD/2,
where gain is maximized. Consequently, the input signal is ac coupled, as shown in
Fig. 13.33.
Finally, to minimize cost, we use a passive lag-lead ﬁlter. Impose ζ = 0.707 and
choose f−3 dB > fm, say, f−3 dB = 10 kHz. Proceeding as in Example 13.6, we ﬁnd
ωp = 553 rad/s and ωz = 22.5 krad/s, which can be met with the ﬁlter components
shown in the ﬁgure.

692
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
+
vI
vO
80.6 kΩ
2.00 kΩ
95.3
 kΩ
130
 kΩ
22 nF
100 pF
10 nF
14
2
3
9
11
12
4
6
7
PC1
VCO
FIGURE 13.33
FM demodulator using the 4046A PLL.
Just as inserting a voltage divider within the feedback loop of an op amp in-
creases the output voltage swing, inserting a frequency divider inside the PLL loop
downstream of the VCO increases the VCO frequency. A frequency divider is imple-
mented with a counter, and the VCO output frequency becomes ωO = NωI , where
N is the counter modulus. Making the counter programmable allows the synthesis
of variable frequencies that are integral multiples of ωI .
The PLL formalism still holds, but with Ko replaced by Ko/N. We observe that
varying N varies also the gain factor Kv, so care must be exercised to ensure that
stability and dynamics are maintained over the full range of values of N.
EXAMPLE 13.8.
Using a 4046A PLL, design a circuit that accepts a 1-kHz refer-
ence frequency and synthesizes all frequencies between 1 MHz and 2 MHz in 1-kHz
steps.
Solution.
To span the given range, we need a programmable counter between Nmin =
106/103 = 1000 and Nmax = 2000. Choose, for instance, a 4059 counter, which allows
for N to be programmed anywhere from 3 to 15,999 via a set of inputs referred to as the
jam inputs J in the data sheets.
For the VCO, specify f0 halfway between the extremes, or f0 = 1.5 MHz, and
again choose 2 fR wide enough, say, 2 fR = 1.5 MHz. This gives Ko = 3.366 × 106
(rad/s)/V. Using the data sheets or the aforementioned PLL program, we ﬁnd the VCO
component values R1 = 28.0 k, R2 = 287 k, and C = 110 pF.
Anticipating relatively clean on-board signals, we choose PC2, so Kd = 5/(4π)
V/rad. Since N is variable, a reasonable approach12 is to design for the geometric mean
of the extremes, or for Nmean = √NminNmax = 1414. The corresponding gain factor is
then Kv(mean) = Kd Ko/Nmean = 947 s−1.
We again use a passive lag-lead ﬁlter. Imposing ζ = 0.707 and arbitrarily choosing
ωn = ωI/20 = 2π103/20 = π100 rad/s, we obtain ωp = 104 rad/s and ωz = 290 rad/s.
These parameters are met with the ﬁlter components shown in Fig. 13.34, where the
wiring details of the 4059 counter have been omitted for simplicity.
Using Eq. (13.46b), we ﬁnd ζ = 0.78 for N = 1000, and ζ = 0.65 for N = 2000,
both of which are fairly reasonable values.

693
Problems
+
vI
6.17 kΩ
kΩ
3.45 kΩ
14
13
3
12
11
1 μF
23
÷ N
4059
VCO
110 pF
7
6
4
9
vO
(1 MHz to 2 MHz
  in 1-kHz steps)
28.0
 kΩ
287
1
PC2
1 kHz
J
  
FIGURE 13.34
Frequency synthesizer using the 4046A PLL.
PROBLEMS
13.1 Log/antilog ampliﬁers
13.1 In the transdiode of Fig. 13.2a let R = 10 k, Cn + Cμ = 20 pF, VA = 100 V, rd =
2 M, and ft = 1 MHz. If RE = 4.3 k and C f = 100 pF, calculate 1/β0, 1/β∞, fz,
and f p for vI = 1 mV, 10 mV, and 10 V; hence, conﬁrm the linearized plots of Fig. 13.3.
13.2 Find the phase margin of the circuit of Example 13.1.
13.3 Modify the circuit of Fig. 13.4 to yield vO = −(2 V/dec) log10[vI/(1 V)].
13.4 (a) Derive Eqs. (13.13) and (13.14). (b) Design a circuit that accepts an input voltage
−5V ≤vI ≤+5V,andgivesiO = (10μA)2−vI /(1 V);thiscircuitisusefulinelectronic
music. (c) Modify the above circuit so that it gives the same output range, but for
0 V ≤vI ≤10 V.
13.5 The log conformity error at the upper end of the current range is due primarily to the
bulk resistance of the emitter region, which can be modeled with a small resistancers in
series with the emitter itself. (a) Recompute the transfer characteristic of the transdiode
of Fig. 13.1b, but with rs in place. If rs = 1 , what is the log conformity error at
iI = 1 mA? At iI = 0.1 mA? (b) The effect of rs can be compensated by feeding
a small portion of vI to the base of the BJT. This is achieved by lifting the base off
ground, returning it to ground via a resistance Rx, and connecting a second resistance
Ry between the source vI and the base of the BJT. Sketch the modiﬁed transdiode,
and show that choosing Ry/Rx = R/rs −1 will eliminate the error due to rs.

694
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
13.6 In the log amp of Fig. 13.4 the bulk-resistance error (see Problem 13.5) can be com-
pensated by connecting a suitable network between the base of Q2 and the output of
OA2. Such a network consists of a resistance Rc in series with a diode Dc (cathode
at the output of OA2). Likewise, in the antilog amp of Fig. 13.6 the compensation
network is connected between the base of Q1 and the output of OA1 (cathode at the
output of OA1). Show that the error is nulled when Rc = (R1 ∥R2)(2.2 k)/rs. What
is the required Rc, given that the LM394 has rs = 0.5 ?
13.2 Analog multipliers
13.7 A popular multiplier application is frequency doubling. One way of conﬁguring the
AD534 for this operation is as follows:6 connect X2 and Y1 to ground, connect X1
and Y2 together and drive them with a source vI = 10 cos ωt V, connect the Out
pin to Z1 via a 10-k resistor, connect Z1 to Z2 via another 10-k resistor, and
drive Z2 with a 10-V reference voltage. (a) Sketch the circuit; then using the iden-
tity cos2 α = (1 + cos 2α)/2, obtain an expression for the output vO. (b) Assum-
ing well-regulated ±15-V supplies, design a circuit to generate the 10-V reference
for Z2.
13.8 The AD534 multiplier can be made to approximate the sine function within 0.5% of
full scale as follows:6 connect Y2 to ground, connect Y1 and Z2 together and drive
them with a source vI, connect Y1 to X2 via a 10-k resistor, connect X2 to ground
via an 18-k resistor, connect the Out pin to Z1 via a 4.7-k resistor, connect Z1 to
X1 via a 4.3-k resistor, and connect X1 to ground via a 3-k resistor. (a) Sketch
the circuit, derive an expression for the output vO as a function of vI, and calcu-
late vO at some signiﬁcant points to verify that the circuit approximates the function
vO = 10 sin[(vI/10)90◦] V. (b) Using additional components as needed, design a cir-
cuit that accepts a triangular wave with peak values of ±5 V and gives a sine wave
with the same frequency and peak values as the input.
13.9 The AD534 multiplier can be conﬁgured to yield the percentage deviation between
two signals v1 and v2 as follows: connect X1 and Z1 together and drive them with
v1, connect X2 and Y1 to ground, drive Z2 with v2, connect the Out pin to Y2 via a
resistance R1, and connect Y2 to ground via a resistance R2. Develop an expression
for the output vO, and specify R1 and R2 for vO = 100(v2 −v1)/v1.
13.10 Figure P13.10 shows a transducer-response linearization technique using a four-
quadrant multiplier. Derive an expression for VO as a function of δ and verify that it
is linearly proportional to δ in spite of the fact that the voltage across the transducer
is a nonlinear function of δ.
R
10 V
–10 V
X1
Z1
Z2
X2
Y1
Y2
Out
AD534
R(1 +    ) 
δ
VO
FIGURE P13.10

695
Problems
13.11 Using the AD534 as a voltage-controlled attenuator, design a programmable ﬁrst-
order low-pass ﬁlter with a dc gain of 20 dB and f0 = kVC, 0.1 V ≤VC ≤10 V and
k = 100 Hz/V. Hint: See Problem 12.11.
13.3 Operational transconductance ampliﬁers
13.12 Find the transfer function of the gm-C ﬁlter of Fig. P13.12.
C2
C1
+
Vi
Vo
–
+
gm2
–
+
gm1
FIGURE P13.12
13.13 Design an exponential VCA such that A = 2−VC/(1 V) V/V, 0 ≤VC ≤10 V. Hence,
outline its calibration procedure.
13.14 Design a programmable state-variable ﬁlter with Q = 10, H0BP = 1, and f0 variable
over the audio range by means of control voltage VC as f0 = (20 kHz)2−VC/(1 V),
0 ≤VC ≤10 V.
13.15 The VCA610 is a wideband VCA that accepts two signal inputs vP and vN and a
control input VC, and gives vO = A(vP −vN), where A = 0.01 × 10−VC/(0.5 V) V/V
for −2 V ≤VC ≤0. Using a VCA610 and an OPA620 wideband precision op amp,
design a ﬁrst-order low-pass ﬁlter with unity dc gain and programmable cutoff
frequency from 100 Hz to 1 MHz.
13.16 (a) Sketch and label all relevant waveforms in the CCO of Fig. 13.20, and derive
Eq. (13.32). (b) Find C so that f0 = 100 kHz for IC = 1 mA; next, using this CCO
as basis, design a VCO such that f0 = (100 kHz)10−VC/(2 V), 0 ≤VC ≤10 V. Outline
its calibration procedure.
13.4 Phase-locked loops
13.17 Find the phase response θd(t), in degrees, in parts (a) and (b) of Example 13.3.
13.18 If we let R2 = 0 in Fig. 13.23a, the zero is moved to inﬁnity, resulting in a passive lag
ﬁlter. Such a ﬁlter ﬁnds limited use because it does not allow for ωx to be speciﬁed
independently of Kv. (a) Verify that if we let R2 = 0 in the ﬁlter of Example 13.4,
the phase margin is inadequate. (b) Specify a new set of values for R1 and C to ensure
φm ∼= 45◦with R2 = 0. What is the corresponding value of ωx?
13.19 Repeat Example 13.4, but using an active PI ﬁlter.
13.20 Prove Eqs. (13.46) through (13.47).
13.21 APLLhasω0 = 2π106 rad/s, Kd = 0.2V/rad, Ka = 1V/V,and Ko = π106 (rad/s)/V.
Design an active PI ﬁlter for a loop time constant of approximately 100 periods of the
free-running frequency and Q = 0.5.

696
CHAPTER 13
Nonlinear
Ampliﬁers and
Phase-Locked
Loops
13.22 If a 0.1-μF capacitance is connected in parallel with R2 in the loop ﬁlter of Exam-
ple 13.6, ﬁnd how it affects ωx and φm.
13.5 Monolithic PLLs
13.23 (a) Sketch and label the average VD versus θD for a Type I phase comparator if the
duty cycles of vI and vO are DI = 1
2 and DO = 1
3. (b) Repeat, but with DI = 1
3 and
DO = 1
2. Comment.
13.24 Sketch vI, vO, UP, DN, and vD for a Type II detector if (a) ωI is slightly higher than
ωO, (b) ωI is slightly lower than ωO, (c) ωI ≫ωO, and (d) ωI ≪ωO.
13.25 A certain CMOS PLL is powered between 5 V and 0 V, and uses a Type I phase com-
parator and a VCO with Ko = 5 MHz/V and f0 = 10 MHz for vE = 2.5 V. (a) Design
a passive lag-lead ﬁlter for ωn = 2π5 krad/s and Q = 0.5. (b) Sketch vI, vO, vD, and
vE for the case in which the loop is locked to an input frequency of 7.5 MHz.
13.26 Find ve(t) in the FM demodulator of Example 13.7.
13.27 Dual-slope ADCs are clocked at a frequency that is locked to the ac line frequency
fline in order to reject line-induced noise. Using a 4046A PLL, design a circuit that
accepts fline (either 60 Hz or 50 Hz) and gives fCK = 216 × fline. Specify as many
parameters and components as you can in your circuit.
13.28 Using a 4046A for phase detection and an 8038 as VCO, design a circuit that generates
a 1-kHz sine wave synchronized on a 1-MHz crystal oscillator.
13.29 An FSK signal vI alternates between fL = 1200 Hz (logic 0) and fH = 2400 Hz
(logic 1). One way13 to decode this signal with a 4046A PLL is to use PC3, a loop
ﬁlter consisting of a plain RC stage with 1/(2π RC) = fH, the VCO with f0 =
( fL + fH)/2 = 1.8 kHz and 2 fR = 2 kHz, and a positive edge-triggered latch ﬂip-
ﬂop of the type of Fig. 13.31, with vI as the D input and the VCO output vO as the
clock; the Q output of the ﬂip-ﬂop is the FSK decoder output. Draw the circuit; then
sketch and label vI, the average of vE, vO, and Q both for fI = fL and fI = fH. What
is the distinguishing feature of PC3 that makes it attractive in this application?
REFERENCES
1. D. H. Sheingold, ed., Nonlinear Circuits Handbook, Analog Devices, Norwood, MA,
1974.
2. P. R. Gray, P. J. Hurts, S. H. Lewis, and R. G. Meyer, Analysis and Design of Analog
Integrated Circuits, 5th ed., John Wiley & Sons, New York, 2009. ISBN 978-0-470-
24599-6.
3. “Theory and Applications of Logarithmic Ampliﬁers,” Texas Instruments Application
Note AN-311, http://www.ti.com/lit/an/snoa575b/snoa575b.pdf.
4. C. Kitchin and L. Counts, RMS to DC Conversion Application Guide, 2d ed., http://www
.analog.com/static/imported-ﬁles/design handbooks/17505283758302176206322RMS-
toDC Cover-Section-I.pdf.
5. B. Gilbert, “Translinear Circuits—25 Years On,” Electronic Engineering: Part I, August
1993, pp. 21–24; Part II, September 1993, pp. 51–53; Part III, October 1993, pp. 51–56.

697
References
6. D. H. Sheingold, ed., Multiplier Application Guide, Analog Devices, Norwood, MA,
1978.
7. D. A. Johns and K. W. Martin, Analog Integrated Circuit Design, John Wiley & Sons,
New York, 1997.
8. C. Toumazou, F. J. Lidgey, and D. G. Haigh, eds., Analogue IC Design: The Current-
Mode Approach, IEEE Circuits and Systems Series, Peter Peregrinus Ltd., London, U.K.,
1990.
9. R. Schaumann, M. S. Ghausi, and K. R. Laker, Design of Analog Filters: Passive, Active
RC, and Switched Capacitor, Prentice Hall, Englewood Cliffs, NJ, 1990.
10. A. B. Grebene, Bipolar and MOS Analog Integrated Circuit Design, John Wiley & Sons,
New York, 1984.
11. F. M. Gardner, Phaselock Techniques, 2d ed., John Wiley & Sons, New York, 1979.
12. R. E. Best, Phase-Locked Loops: Theory, Design, and Applications, 3d ed., McGraw-
Hill, New York, 1997.
13. CMOS Phase-Locked Loops, Philips Semiconductors, Sunnyvale, CA, June 1995.
14. J. A. Connelly and P. Choi, Macromodeling with SPICE, Prentice Hall, Englewood
Cliffs, NJ, 1992.

This page intentionally left blank

INDEX
A
Absolute accuracy, 611
Absolute maximum ratings, 259
Absolute-value circuits. See
Full-wave rectiﬁers
Ac-dc converters, 461–462
average value (Vavg), 461
peak value (Vm), 461
ripple error, 462
rms value (Vrms), 461
Acquisition time (tAQ), 473
Active compensation of
integrators, 305–306
Active ﬁlters, 114–214
audio ﬁlter applications,
130–135
biquad ﬁlters, 157–160
cascade design, 178–185
common frequency responses,
114–117
direct design, 191–197
ﬁlter approximations, 172–177
ﬁrst-order ﬁlters, 123–130
generalized impedance
converters, 185–191
KRC ﬁlters, 142–149
multiple-feedback ﬁlters,
149–154
sensitivity, 160–163
standard second-order
responses, 135–142
state-variable ﬁlters, 154–157
switched-capacitor ﬁlters,
197–208
transfer functions, 118–122
universal switched-capacitor
ﬁlters, 208–214
Active guard drive, 93–94
Active tone control, 132–134
bass, 132
treble, 132
A-D conversion techniques,
634–644
complexity comparison of, 644
DAC-based, 634–639
ﬂash, 639–640
integrating-type, 642–644
pipelined, 641–642
subranging, 640–641
ADC speciﬁcations, 613–616
code ranges, 614
code transitions, 615
differential nonlinearity (DN),
615–616
errors, 615
fractional binary value (DO),
613
integral nonlinearity (INL),
615–616
quantization noise (eq),
614–615
ratiometric conversion, 614
signal-to-noise ratio (SNR),
615
Adjustable power current
sources, 559
Adjustable voltage regulators,
557
AD537 V -F converter, 521–523
Aliasing, 645–646
All-pass ﬁlters, 115–116,
129–130, 141
ﬁrst-order, 129–130
responses of, 115–116, 141
standard second-order (HAP),
141
Amount of feedback, 24
Ampliﬁer fundamentals, 3–5
current ampliﬁer, 4
input resistance (Ri), 3
open-circuit gain (Aoc), 3
output resistance (Ro), 3
short-circuit gain (Asc), 5
source-to-load gain, 4
transconductance ampliﬁer, 5
transresistance ampliﬁer, 5
unloaded gain. 4
voltage ampliﬁer, 3
Ampliﬁer types
autozero, 246–248
bipolar, 223–226
bridge, 99–105
chopper-stabilized (CSOA),
246–248
CMOS, 227–228, 399–400
composite, 418–423
constant-GBP, 281
current, 4–5, 79–80
current-feedback (CFAs),
315–322
dc offsetting, 19
decompensated, 400, 411–412
difference, 20–21, 80–87
digitally programmable, 631
error (EA), 24, 31–33, 553,
574–577
high-speed, 315–324
instrumentation, 87–93
inverting, 13–16, 287–290,
297
JFET-input, 226
log/antilog, 658–665
log ratio, 663
low-input-bias-current,
234–237
low-input-offset-voltage,
243–248
low-noise, 361–365
micropower, 47
noninverting, 9–12, 285–287
nonlinear, 488–491, 657–678
operational transconductance
(OTAs), 670–678
phono, 131–132
photodetector, 70
photodiode, 70, 357–361
photovoltaic, 70
power, 261
programmable, 301
rail-to-rail, 50, 256–259
residue, 640
sample-and-hold (SHAs),
471–477.
summing, 18–19
superbeta-input, 234
tape, 132
three-pole, 375–379
track-and-hold (THAs),
471–477
transducer bridge, 99–105
transconductance, 5, 71–79
transimpedance, 68, 316
transresistance, 5, 68–70
unity-gain, 12
voltage, 3–5
voltage-controlled, 674–675
voltage-feedback,
CFA-derived, 322–323
Analog division, 669–670
Analog-ground-switch, 465
Analog multiplier applications,
668–670
division, 669–670
phase detector, 669
square-root extraction,
669–670
699

700
INDEX
Analog multipliers, 665–670
applications of, 668–670
differential V -I converter,
666–667
four-quadrant operation,
667–668
linearity error, 666
linearized transconductance
block, 666
1% absolute-error bandwidth,
666
variable transconductance
principle, 666
Analog switches, 462–467, 630
in CMOS DACs, 630
dynamic resistance of, 463
JFET, 463–465
MOSFET, 465–467
Analog to digital converters
(ADCs), 634–652
A-D conversion techniques,
634–644
ADC speciﬁcations, 613–616
oversampling converters,
644–652
Antialiasing, 609
Antilog ampliﬁer, 659, 663
Aperture jitter, 473
Aperture time (tAP), 473
Aperture uncertainty (tAP), 473
Appendix 5A: Data sheets of the
μA741 op amp, 268–276
Astable multivibrators, 492–493
Audio ﬁlter applications,
130–135
graphic equalizers, 134–135
phono preampliﬁer, 131–132
tape preampliﬁer, 132
tone control, 132–134
Automatic amplitude control,
488–490
using a diode limiter, 488–489
using a diode netwok, 488–489
using a JFET, 488
Autozero ampliﬁers, 246–248
autozero mode, 247
nulling amplifer in, 247
Avalanche breakdown, 542
Avalanche noise, 356
Average value (Vavg), 461
B
Balanced bridge, 21, 74, 81, 487
in difference ampliﬁers,
21, 81
in Howland current pumps, 74
in Wien bridge oscillators,
Balanced modulator, 687
Balanced transmission, 94
Bandgap voltage, 542
Bandgap voltage references,
544–547
Brokaw Cell, 545
CMOS, 545–546
Band-pass ﬁlters, 114–116,
128–129, 138–140,
154–157, 181–184, 202–204
biquad, 157, 202–204
cascade design, 181–184
direct synthesis, 206–208
ﬁnite GBP, effect of, 312–314
KRC, 147–148
multiple-feedback, 150–152
responses of, 115–116,
138–140
SPICE simulation of, 152
standard second-order (HB P),
138–140
switched-capacitor, 206
state-variable, 154–157
wideband, 128–129
Band-reject ﬁlters, 114–116, 173,
185. See also Notch ﬁlters
Bar graph code, 639
Bar graph meters, 447–449
Barkhausen criteron, 487
Baseband, 645
Basic op amp conﬁgurations,
9–16
inverting, 13–16
noninverting, 9–12
voltage follower, 12–13
Bass/treble control, 133
Bessel ﬁlters, 177
Bipolar DACs, 621–623
output conditioning of, 623
Bipolar op amps, 223–226
input stage, 224–225
output stage, 225–226
second stage, 225
simpliﬁed circuit diagram of,
223
SPICE models, 229–229
Biquad ﬁlters, 157–160, 202–204
high-pass notch, 159
low-pass notch, 159
Q enhancement in, 307–310
sensitivities, 162
SPICE simulation of, 160,
308–309
switched-capacitor, 202–204
symmetric notch, 158
Bistable multivibrators, 491
Black, Harold S., 371
Blackman’s impedance formula,
42–45, 290
Blackout, 565–566
Bode plots, 122–123
Boost converters, 568–571
Breakpoint wave shaper, 515
Bridge ampliﬁers, 99–105
Bridge calibration, 101–102
Bridge imbalance, 75–77, 82–84
in difference ampliﬁers, 82–84
in V -I converters, 75–77
Bridge linearization, 104–105
Brokaw Cell, 545
Brownout, 565–566
Buck-boost converters, 568–571
Buck converters, 568–571,
578–580
w. peak current mode control,
582–594
synchronous, 578–580
w. voltage mode control,
577–582
Buried diode structure, 543
Butterworth ﬁlter design
examples, 145–146, 176,
181–183, 206
Butterworth ﬁlters, 138, 175–176
Bypass capacitors, 46–47
C
Cancellation, 234, 391–392
input-bias-current, 234
pole-zero, 304, 391–392, 403,
421, 581, 593
Capacitive impedances, 290–291
Capacitive-load isolation,
405–408
using in-loop compensation,
407–408
using input lag compensation,
412–413
using a snubber network,
406–407
SPICE simulations, 406–408,
412
Capacitor amp-second balance,
584
Capacitor selection in switching
regulators, 572–573
equivalent series inductance
(ESL), 573
equivalent series resistance
(ESR), 573
Capture range in PLLs, 679
Capture time in PLLs, 679
Cascade ﬁlter design, 178–185
band-pass, 181
band-reject, 185
ﬁlter tables, 179
high-pass, 181
low-pass, 178
SC ﬁlters, 212–214
Cauer ﬁlters, 176
Cauer ﬁlter design examples,
181–182, 193–195
Celsius sensor, 551

701
INDEX
CFA-derived VFAs, 322–323
CFAs. See Current-feedback
ampliﬁers
Charge-balancing ADCs, 642
Charge-balancing V -F
converters (VFC32),
523–524
Charge-pump phase comparator,
690
Charge-redistribution ADCs,
635, 637–639
high-resolution, 639
hold cycle, 637
redistribution cycle, 637
sample cycle, 637
Charge-transfer compensation,
474–475
Chatter elimination, 456
Chebyshev ﬁlters, 176
Chebyshev ﬁlters design
examples, 180–183, 185,
206–208, 212–213
Chopper-stabilized op amps
(CSOA), 246–248
autozero mode, 247
nulling ampliﬁer in, 247
Circuits with resistive feedback,
67–105
current ampliﬁers, 79–80
current-to-voltage (I-V )
converters, 68–70
difference ampliﬁers, 80–87
instrumentation ampliﬁers
(IAs), 87–93
instrumentation applications,
93–99
transducer bridge ampliﬁers,
99–105
voltage-to-current (V -I)
converters, 71–79
Classical ﬁlter sensitivity, 160
CLC401 CFA, 416
Clipping, 51–52
Closed-loop gain (A), 10, 24
Closed-loop frequency response,
283–290
closed-loop bandwidth ( fB),
284
discrepancy function (D),
284
gain-bandwidth tradeoff, 284
I-V and V -I converters,
287–290
magnitude error (εm), 284
noninverting and inverting
ampliﬁers, 285–287
phase error (εφ), 284
plotting, 285
Closed-loop I/O resistances
(Ri, Ro), 34–37
Closed-loop responses as
functions of β, 376–379
frequency, 376–378
pole locations, 377–378
step, 376–379
CMOS bandgap references,
545–546
CMOS crystal oscillators,
497–498
CMOS DACs, 629–633
multiplying applications,
631–633
switch, 630
CMOS gate characteristics, 496
CMOS gate multivibrators,
495–499
free-running, 496–497
one-shot, 498–499
CMOS op amps, 227–228,
399–400
folded-cascode, 229
frequency compensation of,
399–400
rail-to-rail, 258
two-stage, 227–228
CMOS transmission gate,
466–467
Code center line, 615
Code range, 614
Code transitions, 615
Coil current ripple, 569
Coil selection in switching
regulators, 571–572
copper loss, 574
Cold-junction compensation in,
552
Commercial range, 259
Common-centroid layout, 245
Common frequency responses,
114–117
in the frequency domain,
115–116
idealized, 115
in the time domain, 116
Common-mode gain (Adm), 83
Common-mode input capacitance
(Cc), 403
Common-mode input impedance,
293
Common-mode input resistance,
82
Common-mode rejection ratio
(CMRR), 83–84, 240–241
in difference ampliﬁers, 83–84
in op amps, 240–241
Common-mode voltage (vCM), 81
Comparator applications,
443–450
bar graph meters, 447–449
level detectors, 443–444
on-off control, 445
pulse-width modulation, 450
window detectors, 446–447
Comparator chatter, 455
Composite ampliﬁers, 418–423
using feedback lead, 418–419
to improve phase accuracy,
422–423
to increase the loop gain,
418–420
to optimize dc and ac
characteristics, 420–421
VFA-CFA combination,
420–421
Constant-GBP op amps, 281
Contact noise, 346
Continuous conduction mode
(CCM), 569
Continuous-time ﬁlters, 197
Control-to-output transfer
functions, 587–590,
598–600
in boost converters, 598–600
in buck converters, 587–590
Conversion time, 616
Copper loss, 574
Corner frequencies, noise, 339
CRD structure, 192
Crest factor (CF), 335–336
Crossover frequency, 283, 374
Cross-talk for common return
impedance, 86
Current ampliﬁers, 4, 33–34,
79–80, 292–293
frequency response of,
292–293
ﬂoating-load, 79–80
grounded-load, 80
SPICE simulation of, 292–293
voltage compliance of, 80
Current cancellation, 234–235
Current-controlled integrator, 675
Current-controlled oscillator
(CCO), 511, 518, 677
Current-driven R-2R ladders, 625
Current-feedback ampliﬁers
(CFAs), 315–324
applying CFAs, 320–321
CFA-derived VFAs, 322–323
closed-loop gain, 317–318
dynamics, 318–319
folded-cascode VFAs,
323–324
higher-order effects, 319–320
noise in, 356
open-loop transimpedance
gain,
SPICE models, 321
SPICE simulation of, 321–322
stability, 414–417

702
INDEX
Current-input IA, 98–99
Current mirror, 80
Current mode R-2R ladders, 620
Current-mode segmentation,
628–629
Current-output IA, 97–98
Current reverser, 80
Current sinks, 550
Current sources, 548–551
voltage compliance of, 549
Current switch, 465, 622
Current-to-voltage (I-V )
converters, 68–70, 287,
357–361
basic, 68–69
closed-loop parameters of, 69
frequency response of, 287
high-sensitivity, 69–70
noise characteristics of,
357–361
photodetector, 70, 357–361
Cutoff frequency, 114, 172
D
D-element realizations,
186–188
DAC-based A-D conversion,
634–639
charge-redistribution, 635
sequential search, 634
servo converter, 635
successive-approximation, 635
tracking converter, 635
D-A conversion techniques,
616–629,
bipolar DACs, 621–623
current-driven R-2R ladders,
625
current mode R-2R ladders,
620
master-slave, 623–624
potentiometric DACs, 618
settling time in, (tS), 623
voltage mode R-2R ladders,
620–621
weighted-capacitor DACS,
617–618
weighted-resistor DACS,
616–617
DAC speciﬁcations, 610–613
absolute accuracy, 611
dynamic range (DR), 610
errors, 611–613
fractional binary value (DI ),
610
full-scale range (VFSR), 610
full-scale value (VFSV), 610
least signiﬁcant bit (LSB), 610
most signiﬁcant bit (MSB),
610
multiplying DACs, 610
reference voltage (VREF), 610
Damping characteristics of PLLs,
684–685
damping ratio (ς), 684
undamped natural frequency
(ωn), 684
Damping ratio (ζ), 135, 684
overdamped response, 135
undamped natural frequency
(ω0, ωn), 135–136, 684
undamped response of, 136
Darlington pair, 225, 553
Dc gain, (a0), 280
Dc offsetting ampliﬁer, 19
Dc noise, 333
Dc noise gain, 248
Deadbeat, 589
Deboo integrator, 125
Decimation, 648
Decompensated op amps, 400,
411–412
Deintegrate phase, 643
Delay ﬁlters, 116. See also
All-pass ﬁlters
Delta-sigma (-	) converters.
See Sigma-delta converters
Delyiannis-Friend ﬁlter, 150
Desensitivity factor, 26
Dielectric absorption, 469
Difference ampliﬁers, 20–21,
80–87
calibration of, 84
common-mode input
resistance, 82
common-mode input
voltage, 81
common-mode rejection ratio,
83–84
differential-mode input
resistance, 82
differential-mode input
voltage, 81
ground-loop interference
elimination, 86–87
resistance mismatches, effect
of, 82–85
variable gain, 85–86
Difference-input, difference-
output ampliﬁer, 87–88
Differential input impedance,
269
Differential input-pair noise, 363
Differential-mode gain, 83
Differential-mode input
capacitance (Cd), 403
Differential-mode input
resistance, 82
Differential-mode voltage (vDM),
81
Differential nonlinearity (DN),
612, 615–616
Differential V-I converter, 616,
617
Differentiator, 21–22, 123–124,
401–402
Bode plot, 125
frequency compensation of,
401–402
SPICE simulation of, 401–402
unity-gain frequency, 123–124
Digitally programmable
ampliﬁer, 631
Digitally programmable
attenuator, 631
Digitally programmable ﬁlter,
632–633
Digitally programmable IA,
95–96
Digitally programmable
oscillator, 633
Digital to analog converters
(DACs), 610–613, 616–633
D-A conversion techniques,
616–629,
DAC speciﬁcations, 610–613
multiplying DAC applications,
629–633
Diode noise models, 347
Direct ﬁlter design, 191–197,
206–208
ﬁlter tables, 193
high-pass, 195–196
low-pass, 192–195
RLC ladders, 191–192
SC ﬁlters, 206–208
Discontinuous conduction mode
(DCM), 571
Discrepancy function (D), 284,
372, 374
effective, in the presence of
feedthrough, 387
as a function of the phase
margin, 374
Disturbances in the presence of
negative feedback, 29–30
Dominant-pole compensation,
388–391
lowering the ﬁrst pole, 391
Miller effect, 395
pole-zero cancellation,
391–392
RHPZ control, 396–397
Dominant-pole response,
278–280, 294–301
frequency, 278–280
transient, 294–301
Double-injection techniques,
383–385
using SPICE, 385

703
INDEX
Doubly terminated all-pole RLC
ladder, 204
Doubly terminated series-
resonant RLC ladder, 192
Drain cutoff current, 464
Dropout voltage, 541
Dual-ampliﬁer band-pass ﬁlter
(DABP), 188–189
effect of ﬁnite GBP on,
313–314
sensitivities of, 189
Dual-integrator-loop SC ﬁlters,
202–204
Dual-op-amp IA, 90–91
Dual-ramp ADCs, 642
Dual-slope ADCs, 642–644
autozero phase, 643
deintegrate phase, 643
signal integrate phase, 643
Dummy resistance, 232, 353
Duty cycle, 450, 567
Dynamic op amp limitations,
277–324
closed-loop frequency
response, 283–290
current-feedback ampliﬁers,
315–324
effect of ﬁnite GBP on ﬁlters,
310–314
effect of ﬁnite GBP on
integrators, 301–309
input-output impedances,
290–294
open-loop frequency response,
278–283
transient response, 294–301
Dynamic range (DR), 610
Dynamic resistance, 464
E
Effect of ﬁnite GBP on
integrators, 301–309
active compensation,
305–306
magnitude error (εm), 303
passive compensation,
304–305
phase error (εφ), 304
Q-enhancement compensation,
307–310
SPICE simulation of, 302, 306
unity-gain frequency
downshift, 303
Effect of ﬁnite GBP on ﬁlters,
310–314
ﬁrst-order ﬁlters, 310–312
predistortion, 308–309, 313
remarks, 314
second-order ﬁlters, 312–314
SPICE simulations, 310–314
Effective number of bits (ENOB),
616
Efﬁciency (η), 555, 567, 574
Electromagnetic interference
(EMI), 573
Elliptic ﬁlters 176
design examples, 183–184,
195–196, 213–214
Emitter-coupled VCOs, 517–518
Equal-component KRC ﬁlter,
144–145, 148
band-pass, 148
low-pass, 144–145
Equivalent series inductance
(ESL), 573
Equivalent series resistance
(ESR), 573
Error ampliﬁer (EA), 24, 31–33,
553, 574–577
in linear regulators, 553
in negative feedback, 24,
31–33
in switching regulators,
574–577
Error ampliﬁer design, 580–582,
591–594, 599–600
for PCMC in boost converters,
599–600
for PCMC in buck converters,
591–594
for voltage mode control,
580–582
Error ampliﬁer gain (aε), 24,
31–33
in series-series topology, 33
in series-shunt topology, 31
in shunt-series topology, 33
in shunt-shunt topology, 31
Error ampliﬁer type, 575–577
1, 575
2, 575
3, 575–577
Error signal, 24–26
Excess noise, 346
External offset nulling, 250–253
F
Fahrenheit sensors, 551
False ground, 298
FDNR, 187
Feedback factor b (two-port), 24,
31–33
in series-series topology, 33
in series-shunt topology, 31
in shunt-series topology, 33
in shunt-shunt topology, 31
Feedback factor β (return-ratio),
282, 372
Feedback in op amp circuits,
30–37
closed-loop I/O resistances
(Ri, Ro), 34–37
series-series, 33
series-shunt, 30–31
shunt-series, 33–34
shunt-shunt, 31–32
Feedback lead compensation,
413–414
in composite ampliﬁers,
418–419
Feedback network, 24
Feedback pole compensation,
400–409
capacitive-load isolation,
405–408
differentiator compensation,
401–402
other sources of instability, 409
SPICE simulations, 401–402,
404, 406–408
stray-input capacitance
compensation, 402–405
Feedback signal (x f ), 24–26
Feedforward compensation,
398–399
pole-zero doublet, 398
Feedthrough gain (a f t), 39–42,
386–387
in current ampliﬁers, 41–42
effect on the discrepancy
function, 386–387
in inverting ampliﬁers, 39
in noninverting ampliﬁers, 39,
42
Feedthrough rejection ratio
(FRR), 473–474
FET-input op amps, 235–236
Field emission breakdown, 542
FILDES, 174
Filter approximations, 172–177
band-pass, 173
band-reject, 173
Bessel, 177
Butterworth, 175–176
Cauer, 176
Chebyshev, 176
comparisons, 175, 177
elliptic, 176
frequency plots using SPICE,
174
high-pass, 172
low-pass, 172
Filter measurements, 141–142
Filter sensitivities, 160–163
in biquad ﬁlters, 162
classical sensitivity, 160
in DABP ﬁlters, 189
in KRC ﬁlters, 161
in multiple-feedback ﬁlters, 162
in state-variable ﬁlters, 163

704
INDEX
Filter tables, 179, 193
cascade design, 179
direct design, 193
Filters, 114–214, 356–357
active, 114–214
noise, 356–357
First-order active ﬁlters,
123–130, 301–312
differentiator, 123, 124
ﬁnite GBP, effect of, 301–312
ﬁnite open loop gain, effect of,
130
high-pass with gain, 127–128
integrators, 124–126
low-pass with gain, 126–127
phase shifters, 129–130
wideband band-pass ﬁlter,
128–129
First-order PLL, 681–682
First-order noise shaping, 651
555 IC timer, 499–503
Flash converters, 639–640
bar graph code, 639
thermometer code, 639
Flicker noise, 346
Flip-ﬂop, 492
as an astable multivibrator,
500–502
block diagram of, 500
as a monostable multivibrator,
402–503
voltage control, 503
pulse-position modulation, 503
pulse-width modulation, 503
Floating-load current ampliﬁers,
80
Floating-load V -I converters,
71–73
practical op amp limitations,
effect of, 73
voltage compliance of, 72
Flying capacitor techniques,
92–93
FM demodulator, 691–692
Folded-cascode CMOS op amp,
228
frequency compensation of,
399–400
Folded-cascode VFA, 323–324
4046 CMOS PLL, 686–693
Four-quadrant multiplier,
667–668
Four-terminal adjustable
regulator, 556
Fractional binary value (D), 610,
613
Free-running multivibrators,
492–493
Frequency compensation of op
amps, 388–400
lowering the ﬁrst pole,
388–391
feedforward, 398–399
input lag compensation,
409–413
Miller compensation, 393–397
pole-zero cancellation,
391–392
RHPZ control, 396–397
three representative examples
of, 399–400
Frequency compensation of op
amp circuits, 401–414
capacitive-load isolation,
405–408, 411–412
differentiator, 401–402
feedback lead, 413–414
input lag, 409–413
stray-input capacitance,
402–405
Frequency-dependent negative
resistance (FDNR), 187
ﬁlter synthesis using, 189–191,
192–195
Frequency responses, 120–122,
376–378
as functions of β, 376–378
Frequency shift keying (FSK),
519–520
Frequency synthesizer, 692
Frequency-to-voltage (F-V )
converters, 525–526
in isolated transmission, 526
Full-power bandwidth,
297–298
Full-scale range (VFSR), 610
Full-scale value (VFSV), 610
Full-wave rectiﬁers (FWRs),
459–462
in ac-dc converters, 461–462
effect of resistance tolerances
on, 459–460
Function generators, 513–520
ICL8038, 513–517
XR2206, 518–520
Fuse links, 246
G
Gain-bandwidth product (GBP),
281, 301–314
effect on ﬁlters, 310–314
effect on integrators, 301–309
Gain-bandwidth tradeoff, 286
Gain error, 25, 611, 616
Gain margin (GM), 373–374
Gain node, 315–316
Gain peaking (GP), 380–381
Gaussian distribution, 336
Generalized impedance
converters (GICs), 185–191
D-element realizations,
186–188
dual-ampliﬁer band-pass ﬁlter
(DABP), 188–189
frequency-dependent negative
resistance (FDNR), 187
inductance simulator, 186–187
synthesis using FDNRs,
189–191
synthesis using grounded
inductances, 188–189
General-purpose IC comparators,
437–441
LM311, 437–440
LM339, 440–441
SPICE simulation of, 442–443
Glitches, 613
GM, 348, 349
gm-C ﬁlters, 671
Graphic equalizers, 134–135
octave, 135
Ground-loop interference
elimination, 86–87
Grounded-capacitor VCOs,
512–513
Grounded-load V -I converters,
73–79
calibration of, 77
Howland current pump,
73–79
improved Howland pump,
78–79
ﬁnite open-loop gain, effect of,
77–78
loop gain of, 75
practical op amp limitations,
72–73
resistance mismatches, effect
of 75–77
SPICE simulation of, 78
voltage compliance of, 74, 79
Ground-loop interference,
86–87
elimination of, 86
Guard ring, 470
Guarding, input, 237
Gyrator, 216–217
H
Half-ﬂash ADCs, 640
Half-wave rectiﬁers (HWRs),
456–459
basic, 457–458
improved, 458–459
superdiode, 457
voltage transfer curves of, 458
HCMOS Phase-Locked Loop
Program, 691
Heat ﬂow, 561–563
Heat sink, 562–563

705
INDEX
High-pass ﬁlters, 114–127–128,
137–138, 181, 195–196
cascade design, 181
direct design, 195–196
ﬁrst-order w. gain, 127–128
KRC, 147
responses of, 115–116,
137–138
standard second-order (HHP),
137–138
state-variable, 154–156
High-pass notch, 159
High-resolution charge-
redistribution ADC, 639
High-sensitivity I-V converter,
69–70
High-speed comparators,
441–442
hold time, 441
setup time, 441
High-speed current switch, 622
High-speed voltage-feedback
ampliﬁers, 322–324
CFA-derived, 323
folded-cascode, 324
Higher-order roots (HOR),
388–389, 400
Hold mode, 468, 473–474
in peak detectors, 468
in THAs, 473–474
Hold mode settling time (tS),
473–474
Hold step, 473–474
Howland current pump, 73–79
calibration of, 77
ﬁnite open-loop gain, effect of,
77–78
improved, 78–79
loop gain of, 75
resistance mismatches, effect
of 75–77
SPICE simulation of, 78
voltage compliance of, 74, 79
Hysteresis, 452
width, 452
I
IC timers, 499–505
ICL8038 waveform generator,
513–517
block diagram of, 513
breakpoint wave shaper, 515
ﬁxed-frequency operation, 516
as a voltage-controlled
oscillator, 517
Ideal inverting ampliﬁer, 14–16,
17–18
Ideal noninverting ampliﬁer,
10–13, 17–18
Ideal op amp, 7–8
Ideal op amp circuit analysis,
16–23
basic ampliﬁers revisited,
17–18
dc-offsetting ampliﬁer, 19
difference ampliﬁer, 20–21
differentiator, 21–22
input current constraint, 16
input voltage constraint, 16
integrator, 22–23
negative-resistance converter
(NIC), 23
summing ampliﬁer, 18–20
summing junction, 18
virtual short, 16
Ideal terminal resistances, 5
Idealized ﬁlter responses,
115–116
Images, 645
Impedance transformation, 23
Implicit rms computation, 664
Improved Howland current
pump, 78–79
voltage compliance of, 79
Improving phase accuracy via
composite ampliﬁer,
422–423
SPICE simulation, 423
Inadequate power-supply
ﬁltering, 409
Increasing loop gain via
composite ampliﬁers,
418–420
Inductance simulator, 186–187
ﬁlter synthesis using, 188–189,
195–196
Inductive impedances, 290–291
Inductor volt-second balance, 584
In-loop compensation, 407–408
SPICE simulation, 408
Industrial range, 259
Inﬁnite-gain ﬁlters. See
Multiple-feedback ﬁlters
Inherent noise, 334
Initial input offset voltage, 243
Input bias current (IB), 229–231
capacitive feedback, 231–233
comparison, 236–237
drift of, 236–237
dummy resistance, 232, 353
errors caused by, 231–233
resistive feedback, 231–233
Input-current cancellation,
234–235
Input bias-current drift, 237
Input current constraint, 16
Input diode protection, 235
Input guarding, 237
Input lag compensation,
409–413
in capacitively-loaded op
amps, 412–413
in decompensated op amps,
411–412
SPICE simulation, 411–412
in uncompensated op amps,
410–411
Input linearization network, 673
Input offset current (IOS),
230–231
capacitive feedback, 231–233
errors caused by, 231–233
resistive feedback, 231–233
Input offset error, 248–253
capacitive feedback, 249
compensation of, 249–253
noise gain, 248
nulling of, 249–253
resistive feedback, 248–249
total, referred to the input,
248–249
Input offset error nulling,
249–253
external, 250–252
instrumentation ampliﬁer,
252–253
internal, 249–250
Input offset voltage (VOS),
238–243
capacitive feedback, 239
change with the output swing,
242
common-mode rejection ratio,
240–241
complete expression for, 243
errors caused by, 238–239
initial, 243
power-supply rejection ratio,
241–242
resistive feedback, 239
ripple rejection, 241–242
thermal drift of, 239
Input/output impedances,
290–294
using Blackman’s formula,
290
capacitive modeling, 290–291
inductive modeling, 290–291
series-type, 290–291
practical considerations,
293–294
shunt-type, 290–291
SPICE simulation, 292–293
Input overdrive (Vod), 436
Input-pair load noise, 363
Input-protection diode leakage,
235–236
Input reference current, 658
Input resistance (Ri), 3
Input scale factor, 659

706
INDEX
Input signal-to-noise ratio, 355
Input voltage constraint, 16
Input voltage range (IVR),
253–259
of μA741 op amp, 253–255
of rail-to-rail op amps,
256–259
of two-stage CMOS op amp,
254–255
Instrumentation ampliﬁers (IAs),
87–93
digitally programmable, 95–96
dual-op-amp, 90–91
ﬂying capacitor techniques,
92–93
input offset error nulling,
252–253
monolithic, 91–92
triple-op-amp, 87–89
variable gain, 88–92
Instrumentation-ampliﬁer
applications, 93–104
active guard drive, 93–94
as bridge ampliﬁers, 100–104
current-input, 98–99
current-output, 97–98
digitally programmable, 95–96
output-offsetting, 96–97
Integral nonlinearity (INL), 612,
615–616
Integrated-circuit noise, 339
corner frequencies, 339
white-noise ﬂoor, 339
Integrating-type ADCs,
642–644
charge-balancing, 642
dual-ramp, 642
dual-slope, 642–644
Integrating-type THA, 475–477
Integrators, 22–23, 124–126,
198–200, 302–309
active compensation of,
305–306
Bode plot of, 124
Deboo, 125
frequency response of, 302
inverting, 124, 198–199
magnitude error (εm) in, 303
Miller, 124
noninverting, 125, 199–200
passive compensation of,
304–305
phase error (εφ) in, 304
pole control in, 125–126
SPICE simulation of, 306,
308–309
switched-capacitor, 198–200
unity-gain frequency of, 125
unity-gain frequency
downshift, 303
Integrator circuits, effect of ﬁnite
GBP on, 301–309
Interference noise, 333–334
Internal (inherent) noise, 334
Internal offset nulling, 249–250
Internal power dissipation, 47
Inverting ampliﬁer, 13–16,
39–42, 287–290, 297
feedthrough in, 39–42,
289–290
frequency response of,
287–290
ideal characteristics of, 14–16
SPICE simulation of, 14,
289–290
transient response of, 297
virtual ground in, 14
Inverting integrator, 22, 124,
198–199, 301–306,
Inverting Schmitt trigger,
451–452
single-supply, 453–454
IPTAT, 547
I-V converters. See
Current-to-voltage
converters
J
JFET-input op amps, 226
JFET switches, 463
analog-ground type, 465
driver for, 464
Johnson noise, 344
K
KHN ﬁlters, 154–156
KRC ﬁlters, 142–149
band-pass, 147–148
band-reject, 148–149
equal-component, 144–145
high-pass, 147
low-pass, 143–146
positive feedback, 142
Sallen-Key, 142
sensitivity of, 161–162
SPICE simulation of, 146,
150
unit-gain, 145–146
L
Ladder simulation, 191–196,
204–208
continuous-time ﬁlters,
191–196
switched-capacitor ﬁlters,
204–208
Ladders, 191–192, 618–623
RLC, 191–192
R-2R, 619–623
Large-signal conditions, 225
Leakage, 469–470
Leapfrogging, 626
Least signiﬁcant bit (LSB), 610
Left-half-plane zero (LHPZ), 579
Level detectors, 443–444
overvoltage indicator, 444
undervoltage indicator, 444
Linear regulator applications,
558–566
adjustable power current
source, 559–560
line-loss detection, 565–566
OV/UV sensing, 564–566
power, 559–560
power-supply supervisory
circuits, 563–566
thermal considerations in,
560–563
typical interconnection of,
558–559
Linear regulator protections,
554–555
current overload, 554
safe operating area, 554
second breakdown, 554
thermal overload, 554–555
Linear regulators, 553–566
applications of, 558–566
efﬁciency, 555
error ampliﬁer in, 553
low-droput, 557–558
monolithic, 556–558
protections in, 554–555
series-pass element in, 553
typical circuit of, 553
Linearized transconductance
block, 666
Line-loss detection, 563, 566
Line regulation, 536
LM311 voltage comparator,
437–440
circuit diagram of, 438
pulldown resistance, 439
pullup resistance, 438–439
response times of, 440
voltage transfer curves of, 439
LM317 adjustable regulator,
556–557
LM329 precision reference
diode, 445, 542–544
LM335 temperature sensor, 445
LM339 quad voltage comparator,
440–441
circuit diagram of, 441
response times of, 443
SPICE simulation of, 442–443
voltage transfer curve of, 442
LM385 2.5-V micropower
reference diode, 447, 511

707
INDEX
LM395 power BJT, 409
LM399 6.95-V thermally stabilized
reference, 543–544
LM3914 dot/bar display driver,
447–449
LM13600, 674–678
Load cell, 102
Loading, 3–4
Load regulation, 537
Lock and capture in PLLs, 679
capture range, 679
capture time, 679
lock range, 679
pull-in time, 679
Lock range, 679
Log/antilog ampliﬁers, 658–665
dynamic range of, 658
input scale factor, 658–659
log-conformity error (eO), 658
output scale factor, 658–659
practical circuits, 662–664
transdiode, 658
in true rms converters,
664–665
Logarithmic wave shaper, 509
Log-conformity error (eO), 658
Log ratio ampliﬁer, 663
Long tail, 398–399
Loop gain L (two-port), 25,
30–37
comparison with T , 45–46
in feedback-system
block-diagram, 37
in series-series topology, 33
in series-shunt topology, 31
in shunt-series topology, 33
in shunt-shunt topology, 31
Loop gain T (return-ratio),
38–46, 282–283, 372
in Blackman’s formula, 42–45
comparison with L, 45–46
in feedback-system
block-diagram, 40
feedthrough gain (aft), 38–39
graphical visualization of,
282–283
of an op amp, 40–42
Lossy integrator, 22, 127
Low-dropout (LDO) regulators,
557–558
common output topologies in,
557–558
Low-input-bias-current op amps,
234–237
comparison, 236–237
FET-input, 235–236
input-bias-current drift,
236–237
input-current cancellation,
234–235
input guarding in, 237
input-protection diode leakage,
235–236
superbeta-input, 234
Low-input-offset-voltage op
amps, 243–248
autozero and chopper-
stabilized op amps,
246–248
bipolar, 243–244
CMOS, 244
matching considerations,
244–245
offset voltage trimming,
245–246
Low-noise op amps, 361–365
comparison, 362
differential input-pair noise,
363
input-pair load noise, 363
OP27, 361–362
second-stage noise, 363–364
ultra-low noise op amps,
364–365
Low-pass ﬁlters, 126–127,
137–138, 143–146,
154–160, 178–181,
192–195, 202–206
biquad, 157–160, 202–204
cascade design, 178–181
direct design, 192–195, 206
using FDNRs, 192–195
ﬁrst-order w. gain, 126–127
KRC, 143–146
multiple-feedback, 152–153
responses of, 115–116,
137–138
SPICE simulation of, 146, 180
standard second-order (HLP),
137–138
state-variable, 154–157
switched-capacitor, 202–204,
206
Low-pass notch, 159–160
SPICE simulation of, 160
M
μA741 op amp, 49–52, 223–224,
228–230, 253–255,
268–276, 279, 295–298,
399–400
data sheets of, 268–276
frequency compensation of,
399–400
frequency response, 279
input offset voltage of,
243–244
input stage of, 224, 230
input voltage range of,
253–254
macromodel of, 228–229
output voltage swing of, 255
overload protection, 260–261
in saturation, 49–52
simpliﬁed circuit schematic of,
223
transient response, 295–298
Macromodels, 228–229
Magnitude error (εm), 201, 303
due to ﬁnite op amp GBP,
303
in switched-capacitor
integrators, 201
Mark frequency, 519
Master-slave DACs, 623–624
Matching considerations,
244–245
common-centroid layout, 245
Maximally-ﬂat response, 138
Maximum passband ripple
(Amax), 173
Maximum ratings, 259–261
absolute, 259
common-mode input voltage,
259
differential-mode input
voltage, 259
internal power dissipation
(Pmax), 259
overload protection, 260–261
supply voltages, 259
MF10 universal SC ﬁlter,
209–214
in cascade design, 212–214
Chebyshev example, 212–213
Elliptic example, 213–214
modes of operation, 210–212
Micropower op amps, 47
Military range, 259
Miller compensation, 393–397
polarity reversal, 394
pole splitting, 393
right-half plane zero control,
395–397
Miller effect, 35, 393
Miller integrator, 124
Minimum stopdand attenuations
(Amin), 173
Missing code, 615
Monolithic instrumentation
ampliﬁers, 91–92
Monolithic PLLs, 686–693
balanced modulator, 687
center frequency, 687
charge-pump phase
comparator, 690
designing with PLLs, 691–693
FM demodulator, 691–692
frequency offset, 687
frequency range, 687

708
INDEX
Monolithic PLLs (cont.)
frequency synthesizer, 692
phase-frequency detector, 689
PLL program, 691
74HC(T)4046A, 686
Type I phase comparator,
687–688
Type II phase comparator,
689–691
Type III phase comparator,
688–689
VCO, 686–687
Monolithic temperature sensors,
547–548
IPTAT, 547
VPTAT, 547
Monolithic timers, 499–505
555, 499–503,
XR2240, 503–505
Monolithic voltage regulators,
556–558
adjustable, 556–557
low-dropout (LDO), 558
Monolithic waveform generators,
512–520
emitter-coupled VCOs,
517–518
grounded-capacitor VCOs,
512–513
ICL8038, 513–517
XR2206 function generator,
518–520
Monostable multivibrators, 492,
498–499
MOSFET switches, 197,
465–467
transmission gates, 466–467
Most signiﬁcant bit (MSB), 610
Multiple-feedback ﬁlters,
149–154
bandpass, 150–152
ﬁnite GBP, effect on, 312–314
low-pass, 152–153
notch, 153–154
sensitivities, 162
SPICE simulation of, 152, 313
Multipliers, 665–670
Multiplying DAC (MDAC)
applications, 631–633
digitally programmable
ampliﬁer, 631
digitally programmable
attenuator, 631
digitally programmable ﬁlter,
632–633
digitally programmable
oscillator, 633
Multivibrators, 491–499
astable, 492–493
bistable, 491
CMOS crystal oscillators,
497–498
CMOS gates, using, 495–499
free-running, 492–493
monostable, 492, 498–499
one-shot, 492, 498–499
single-supply, 494–499
SPICE simulation of, 495
square-wave generators,
493–494
N
NAB equalization curve and tape
preampliﬁer, 132
Natural response, 119
Negative feedback, 24–30
amount of feedback, 24
block diagram of, 24, 37
closed-loop gain (A), 24
disturbances, under the effect
of, 29–30
error ampliﬁer, 24
error signal (xε), 24–26
feedback factor (b), 24
feedback network, 24
feedback signal (x f ), 24–26
gain desensitivity, 26–27
gain error, 25
loop gain (L), 25
noise, under the effect of,
29–30
nonlinear distortion reduction
by, 27–29
open-loop gain (aε), 24
summing network, 24
voltage transfer curve (VTC),
27–29
Negative resistance, 23
Negative-resistance converter
(NIC), 23
Neper frequency, 118
Neutral compensation, 403
Neutral stability, 487
NIC, 23
Noise, 29–30, 333–365, 654
densities, (en, in), 337;
(eq), 654
dynamics, 340–344
equivalent bandwidth, 340
inherent, 334
interference, 333–334
low-noise op amps, 361–365
and negative feedback,
29–30
in op amp, 350–357
in photodiode ampliﬁers,
357–361
properties, 335–339
signal-to-noise ratio, 334
sources/types, 344–350
Noise dynamics, 340–344
noise equivalent bandwidth
(NEB), 340
piecewise graphical
integration, 342–344
pink-noise tangent principle,
344
upper-brick-wall frequency for
1/ f noise, 342
Noise equivalent bandwidth
(NEB), 340
ﬁnding via SPICE, 342
Noise ﬁltering, 356–357
Noise gain, 248, 358
An, 358
1/β, 248
Noise measurements using
PSpice, 354–355
Noise modeling via PSpice,
349–350
Noise models for semiconductor
devices, 346–349
BJT, 347–348
JFET, 347–348
MOSFET, 347–349
pn junction, 347
Noise in photodiode ampliﬁers,
357–361
ﬁltering, 359–360
noise gain (An), 358
signal gain (As), 358
T -feedback, 360–361
Noise power densities (e2n, i2n),
337
Noise shaping, 645, 648–652
ﬁrst-order, 651
latency, 652
second-order, 651
Noise sources/types, 344–350
avalanche noise, 346
excess noise, 346
ﬂicker noise, 346
Johnson noise, 344
models for semiconductor
devices, 346–349
modeling in SPICE, 349–350
1/ f noise, 346
shot noise, 345
thermal noise, 344
Noise spectra, 337–338
noise power densities (e2n, i2n),
337
spectral noise densities,
(en, in), 337
Noise summation, 337
Noninverting ampliﬁers, 9–12,
285–287
frequency response of,
285–287
ideal characteristics of, 10–11

709
INDEX
Noninverting integrator, 125, 199
Noninverting Schmitt trigger,
452–453
single-supply, 454
Noninverting SC integrator,
199, 200
waveforms of, 200
Nonlinear ampliﬁers, 657–678
analog multipliers, 665–670
log/antilog ampliﬁers,
658–665
operational transconductance
ampliﬁers, (OTAs),
670–678
Nonlinear circuits, 434–477
analog switches, 462–467
comparator applications,
443–450
peak detectors, 467–471
precision rectiﬁers, 456–462
sample-and-hold ampliﬁers,
471–477
Schmitt triggers, 450–456
voltage comparators, 435–443
Nonlinear distortion reduction,
27–29
Nonmonotonic DAC
characteristic, 612
Non-overlapping clock drive, 197
Nonretriggerable one-shot, 499
Notch ﬁlters, 115-116, 140–141
KRC, 148–149
multiple-feedback, 153–154
responses of, 115–116,
140–141.
SPICE simulation of, 150
standard second-order (HN ),
140–141
Nulling ampliﬁer, 247
Nyquist bandwidth, 645
Nyquist’s criterion, 646
Nyquist-rate converters, 646
Nyquist-rate sampling, 645–647
aliasing, 645–646
bandwidth, 645
baseband, 645
noise density (eq), 654
O
Octave equalizer, 135
Offset error, 611, 615
Offset nulling, 249–253
external, 250–253
internal, 249–250
Offset-voltage adjustment range,
250
Offset voltage trimming,
245–246
fuse links, 246
Zener zapping, 246
Off-the-shelf OTAs, 672–678
applications of, 674–678
On-chip trimming, 245–246
1/ f noise, 338
1N821-9 thermally-compensated
diode series, 542–543
One-shot, 492, 498–499
On-off control, 445, 452
w. hysteresis, 452
Op amp, 6–8
equivalent circuit of, 6
ideal, 7
SPICE simulation of, 8
symbol of, 6
terminology, 6–7
Op amp circuit diagrams, 223
bipolar op amp, 223–226
CMOS op amps, 227–228
input stage, 224–225
JFET-input op amps, 226
μA741, 269
OP27, 362
output stage, 225–226
second stage, 225
SPICE models, 229–229
Op amp limitations, 229–261,
277–324
dynamic, 277–324
static, 229–261
Op amp noise, 350–357
CFA noise, 356
noise ﬁltering, 356–357
noise measurements using
PSpice, 354–355
op amp noise model, 350
overall input spectral density
(eni), 352
rms output noise (Eno), 353
signal-to-noise ratio (SNR),
355–356
Op amp powering, 46–52
bypass capacitors, 46–47
clipping, 51–52
current ﬂow, 47–49
output saturation, 49–52
output voltage swing (OVS),
49
power dissipation, 47–49
quiescent supply current, 47
SPICE simulation, 51–52
Op amp as a voltage comparator,
436–437
OPA627, precision high-speed
JFET op amp, 358–361
Open-circuit gain (Aoc), 3
Open-circuit noise, 352
Open-loop bandwidth ( fb), 280
Open-loop frequency response,
278–283
dominant-pole, 278–280
loop-gain T , 282–283
μA741 response, 279
single-pole open-loop gain,
280–282
Open-loop gain (aε), 24
Operational ampliﬁer
fundamentals, 1–52
ampliﬁer fundamentals, 3–5
basic op amp conﬁgurations,
9–16
Blackman’s impedance
formula, 42–45
feedback in op amp circuits,
30–37
ideal op amp circuit analysis,
16–23
negative feedback, 24–30
the op amp, 6–8
op amp powering, 46–52
return ratio, 38–45
Operational transconductance
ampliﬁers, (OTAs), 670–678
applications, 674–678
w. exponential control, 675
gm-C ﬁlter application of, 671
input predistortion, 673–674
w. linear control, 674
linearization of, 673–674
off-the-shelf OTAs, 672–674
OP27 low-noise op amp, 89, 362
OP227 dual low noise, low offset
op amp, 89
OTA control, 674–675
exponential, 675
linear, 674
Output/input impedances,
290–294
Output-offsetting in IAs, 96–97
Output overload protection,
260–261, 554
Output reference current, 659
Output resistance (Ro), 3,
34–37
Output saturation, 49–52
SPICE simulation, 51–52
waveforms, 51–52
Output scale factor, 658
Output short-circuit current,
260–261
Output spectral density (eno), 353
Output voltage swing (OVS), 49,
255–259
of μA741 op amp, 59, 255
of rail-to-rail op amps,
256–259
of two-stage CMOS op amp,
256
Overall input spectral density
(eni), 352
Overdamped response, 135

710
INDEX
Overload protection, 260–261,
554
Oversampling, 647–648
Oversampling converters,
644–652
noise shaping, 648–652
Nyquist-rate sampling,
645–647
oversampling, 647–648
sigma-delta (	-) converters,
648–652
overshoot (OS), 380–381
Overvoltage (OV), 563–566
protection, 564–566
OV sensing, 564–565
P
Passband, 115, 172
Passband ripple, 173
Passive compensation of
integrators, 304–305
Passive lag-lead ﬁlter, 683
Peak current mode control
(PCMC), 582–600
in boost converters, 594–600
in buck converters, 582–594
PCMC in boost converters,
594–600
control-to-output transfer
function, 598–600
error ampliﬁer design,
599–600
right-half-plane zero, 595–598
SPICE simulation of, 600
PCMC in buck converters,
582–594
control-to-output transfer
function, 587–590
deadbeat, 589
error ampliﬁer design, 591–594
w/o slope compensation, 585
simpliﬁed ac equivalent in, 591
slope compensation, 586–587
SPICE simulation, 590, 593
subharmonic oscillation,
585–587
Peak detectors, 467–471
dielectric absorption in, 469
extended hold mode, 470
hold mode, 468
leakage in, 469
sagback in, 469
speed limitations in, 471
track mode, 468
voltage droop in, 469–470
Peaking, 138, 380–381
as a function of the phase
margin, 381
gain peaking (GP), 380–381
Pedestal error, 473–474
Phase accuracy, improving,
422–423
Phase comparators, 687–691
charge-pump, 690
Type I, 687–688
Type II, 689–691
Type III, 688–689
Phase error (εφ), 201, 303–306
compensation of, 303–306
in switched-capacitor
integrators, 201
Phase-frequency detector, 689
Phase-locked loops (PLLs),
678–693
damping characteristics,
684–685
ﬁlter design criteria for, 685
ﬁrst-order loop, 681–682
lock and capture, 679
locked condition, 679–681
monolithic PLLs, 686–693
second-order loops, 682–684
third-order loop, 685
Phase margin (φm), 374–375
dependence on the
rate-of-closure, 381–382
measurements, 382–387
Phase/gain margin
measurements, 382–387
using double-injection
techniques, 383–385
feedthrough considerations,
386–387
using return-ratio analysis,
382–383
using single injection, 385
using SPICE, 383–387
Phase shifters, 129–130
Bode plot, 129
Phase-slope correspondence, 376
Phono preampliﬁer, 131–132
Photoconductive detectors, 70
Photodetector ampliﬁers, 70
Photodiode ampliﬁers, 70,
357–361
noise in, 357–361
Photovoltaic detectors, 70
Piecewise graphical integration
of noise, 342–344
Pink-noise tangent, 343
principle, 344
Pipelined ADCs, 641–642
Platinum RTD, 99–100
PLL in the locked condition,
679–681
basic diagram, 680
loop gain, 681
phase follower, 681
Polarity reversal, 394
Pole splitting, 393
Pole-zero, 304, 391–392, 403,
421, 581, 593
Pole-zero doublet, 398
long tail, 398–399
Poles, 118, 377–378
locations as functions of β,
377–378
Poor grounding, 409
Potentiometric DACs, 618
Power op amps, 261
Power packages, 562
TO-220, 562
TO-3, 562
Power sources, 559–560
Power-supply rejection ratio
(PSRR), 241–242
Power-supply supervisory
circuits, 563–566
blackout, 565–566
brownout, 565–566
line-loss detection, 563, 566
overvoltage (OV), 563
OV/UV sensing, 564–565
undervoltage (UV), 563
Practical log/antilog circuits,
662–664
antilog, 663
log, 662
log ratio, 663
temperature compensation of,
662–664
true rms converters, 664–665
Precision rectiﬁers, 456–462
absolute-value circuits, 456
full-wave, 459–462
half-wave, 456–459
Predistortion, 28–29, 308–309,
313
in negative feedback, 28–29
in ﬁlters, 308–309, 313
Programmable delay generator,
504
Programmable op amps, 301
Proportional to absolute
temperature (PTAT), 547
PSpice, xii, 8
Pull-in time, 679
Pulse-position modulation
(PPM), 503
Pulse-width modulation (PWM),
450, 503, 567
Push-pull pair, 225
Q
Q enhancement, 307–310
active compensation of, 309
passive compensation of,
308–309
SPICE simulation of, 302, 306
Q factor, 138–140

711
INDEX
Q multiplier, 168
Quadrature oscillators, 490–491
SPICE simulation of, 491
Quantization error (eq), 614–615
Quantization noise (eq),
614–615
Quiescent supply current, 47
R
Ragazzini, John R., 1
Rail-to-rail op amps, 50,
256–259
bipolar, 257–258
CE push-pull, 257
CMOS, 258–259
CS push-pull, 258
waveforms of, 257
Rate of closure (ROC), 380–382
for different feedback-factor
types, 381–382
effect of on the phase margin,
381
Ratiometric conversion, 614
Reference voltage (VREF), 610
Regions of op amp operation,
49–50
Relative accuracy, 612
Relaxation oscillators, 484
exponential transients, 485
linear transients, 484–485
Remote sensing, 556
Residue in subranging ADCs,
640
ampliﬁer, 640
Resistance mismatches, 75–77,
82–84
in difference ampliﬁers, 82–84
in V-I converters, 75–77
Resistance values, standard,
65–66
Resistive feedback circuits,
67–105
Resistive transducers, 99–100
Resolution, in DACs, 610
Resonance frequency (ω0), 138
Resonance gain, 138
Response time (tPD), 436
Retriggerable one-shot, 499, 565
Return-ratio feedback factor (β).
See Feedback factor β
Return-ratio loop gain (T ). See
Loop gain T
Return-ratio stability analysis,
382–383
RIAA equalization curve, 131
phono preampliﬁer, 131–132
Right-half-plane zero (RHPZ),
393–394, 595–598
in boost converters, 595–598
control of, 395–397
Ring oscillator, 528
Ringing, 380–381
as a function of the phase
margin, 381
overshoot (OS), 380–381
Ripple band, 173
Ripple rejection ratio (RRR),
241–242, 537
Rise time (tR), 294–295
RLC ladders, 191–192
all-pole 192, 204
doubly-terminated, 191–192
series-resonant, 191-192
Rms output noise (Eno),
Rms value (Vrms), 335, 461
Root locus, 135–136
as a function of the damping
ratio, 135–136, 377
R-2R ladders, 618–623
in bipolar DACs, 621–623
current-driven, 625
current mode, 620
in master-slave DACs,
623–624
in segmentation, 628–629
voltage mode, 620
S
Safe operating area (SOA), 554
current overload, 554
output overload, 554–555
second breakdown, 554
thermal overload, 554-555
Sagback, 469
Sallen-Key ﬁlters. See KRC ﬁlters
Sample-and-hold ampliﬁers
(SHAs), 471–477. See also
Track-and-hold ampliﬁers
Sample-to-hold offset, 473–474
Sampling ADCs, 637
Saturation, output, 49–52
Saturation current (Is), 542
Sawtooth wave generators,
510–512
current-controlled, 511
practical considerations,
511–512
voltage-controlled, 511
SC integrators, 198–200
inverting, 198–199
noninverting, 199–200
practical limitations of,
200–202
Schmitt triggers, 450–456
in chatter elimination, 456
hysteresis in, 452
in on-off control, 456
Second breakdown, 554
Second-order all-pass response
(HAP), 138–140
as a function of HBP, HHP,
and HLP, 141
Second-order band-pass response
(HBP), 138–140
bandwidth (BW), 139–140
Q, 138–140
resonance frequency (ω0), 138
resonance gain (H0BP), 138
−3-dB frequencies (ωH , ωL),
140
Second-order high-pass response
(HHP), 138
high-frequency gain (H0HP),
138
Second-order low-pass response
(HLP), 136–137
Butterworth, 138
dc gain (H0LP), 138
maximally-ﬂat, 138
peaking, 138
plot of, using SPICE, 137
Second-order notch response
(HN), 140–141
as a function of HLP and HB,
140
notch frequency,140
Second-order PLLs, 682–685
w. active PI ﬁlter, 683–684
damping characteristics of,
684–685
w. passive lead-lag ﬁlter,
682–684
Type I, 682–683
Type II, 683–684
Seebeck coefﬁcient, 551
Segmentation, 625–629
current mode, 628–629
voltage mode, 626–628
Selectivity factor, 173
Self-regulated 10-V reference,
540
Self-regulation, 540–541
Sensitivity. See Filter sensitivity
Sequential search, 634
Series impedances, 290–291
Series-pass element in, 553
Series resistances, 34–37
Series-series topology, 33
error gain, 33
feedback factor, 33
loop gain, 33
transconductance gain (Ag), 33
Series-shunt topology, 30–31
error gain, 31
feedback factor, 31
loop gain, 31
SPICE simulation of, 36
voltage gain (Av), 31
Servo converter, 635
Settling time (tS), 298–299, 613

712
INDEX
74HC(T)4046A CMOS PLL,
686–693
741 op amp. See μA741 op amp
Short-circuit gain (Asc), 5
Short-circuit noise, 352
Short-circuit protection,
260–261, 554
Shot noise, 345
Shunt impedances, 290–291
Shunt regulator (Zener diode),
538–540
Shunt resistances, 34–37
Shunt-series topology, 33–34
error gain, 33
feedback factor, 33
loop gain, 33
transconductance gain
(Ai), 33
Shunt-shunt topology, 31–32,
68–69
error gain, 31
feedback factor, 31
inverting ampliﬁer, 32
loop gain, 31
transresistance gain (Ar ), 32
Sigma-delta (	-) converters,
648–652
ﬁrst-order, 649–651
switched-capacitor
implementation of, 650
Signal gain (As), 248, 358
Signal generators, 483–526
monolithic timers, 499–505
monolithic waveform
generators, 512–520
multivibrators, 491–499
sawtooth wave generators,
510–512
sine wave generators, 485–491
triangular wave generators,
505–510
V -F and F-V converters,
520–526
Signal-to-noise ratio (SNR), 224,
355–357, 473–474, 615
in ADCs, 615
in THAs, 473–474
Sine wave generators, 485–491
using the ICL8038 waveform
generator, 514–517
practical considerations, 490
quadrature oscillators, 490–491
total harmonic distortion
(THD), 484
Wien bridge, 485–490
using the XR2206 function
generator, 519
Single-injection approximations,
385–386
using SPICE, 386
Single-op-amp bridge ampliﬁer,
104
Single-pole open-loop gain,
280–282
dc gain, (a0), 280
gain-bandwidth product
(GBP), 281
open-loop bandwidth ( fb), 280
transition frequency ( ft), 280
unity-gain frequency ( ft), 280
Skirt, 173
Slew rate (SR), 295
Slew-rate limiting, 295–297,
300–301
causes and cures, 300–301
slew rate (SR), 295
waveforms, 296–297
Slope compensation, 586–587
Small-signal step response, 294
maximum step amplitude, 296
time constrant (τ), 294–195
Snubber network, 406–407
SPICE simulations, 406–407
Source-free response, 119
Source-to-load gain, 3
Space frequency, 519
Spectral noise densities, (en, in),
337
SPICE models, 8, 228–229
basic op amp, 8
macromodels, 228–229
noise, 346–349
Square-root extraction, 669–670
Square-wave generators,
493–494
Stability, 371–423, 660–662
CFA circuits, stability in,
414–417
composite ampliﬁers, 418–423
feedback lag compensation,
409–413
feedback lead compensation,
413–414
feedback pole, circuits with,
400–409
frequency compensation of op
amps, 388–400
gain margin measurements,
382–387
input lag compensation,
409–413
phase margin measurements,
382–387
the stability problem, 372–382
in transdiode circuits, 660–662
Stability problem, the, 372–382
closed-loop responses as
functions of β, 376–379
crossover frequency ( fx), 374
discrepancy function (D), 372
feedback factor (β), 372
gain margin (GM), 373–374
loop gain (T ), 372
peaking, 380–381
phase margin (φm), 374–375
phase-slope correspondence,
376
pole locations as functions of
β, 377–378
rate of closure (ROC), 380–382
ringing, 380–381
step responses as functions of
β, 376–379
three-pole ampliﬁer, 375–379
Standard resistance values, 65–66
Standard second-order responses,
135–142
characteristic frequency (ω0),
damping ratio (ζ), 135
ﬁlter measurements, 141–142
HAP, 141
HBP, 138–140
HHP, 138
HLP, 136–137
HN, 140–141
Q, 136–138
root locus, 135–135
Start-up circuitry, 541
State-variable ﬁlters, 154–157
inverting, 154–156
noninverting, 156
Static op amp limitations, 229–261
data sheets of the μA741 op
amp, 268–276
input bias and offset currents,
229–233
input offset error and
compensation, 248–253
input offset voltage, 238–243
input voltage range, 253–259
low-input-bias-current op
amps, 234–237
low-input-offset-voltage op
amps, 243–248
maximum ratings, 259–261
op amp circuit diagrams,
223–229
output voltage swing, 255–259
Step-down converters, 570
Step responses, 294–297,
376–379
critical step amplitude, 296
as functions of β, 376–379
large-signal, 295–297
small-signal, 294–295
Step-up converters, 570
Stop-band, 115, 173
Strain-gauge bridges, 102–103
fractional elongation, 102
instrumentation ampliﬁer, 103

713
INDEX
load cell, 102
single-op amp, 104
Stray input capacitance
compensation, 402–405,
415–416
in CFA circuits, 415–416
common-mode capacitance
(Cc), 403
differential capacitance (Cd),
403
inverting ampliﬁer, 403–404
neutral compensation, 403
noninverting ampliﬁer,
404–405
SPICE simulations, 401–402,
404
Subharmonic oscillation,
585–587
Subranging ADCs, 640–641
half-ﬂash, 640
residue, 640
residue ampliﬁer, 640
Substrate thermostating, 543–544
Subsurface diode structure, 543
Successive-approximation ADCs,
635–637
sampling ADCs, 637
successive-approximation
register (SAR), 635
Summing ampliﬁer, 18–19
Summing junction, 18
Summing network, 24
Superbeta-input op amps, 234
Superdiode, 457
Switched capacitor (SC),
197–208
integrators, 198–200
non-overlapping clock drive,
197
practical SC ﬁlter limitations,
200–202
sigma-delta ADC, 650
SPDT switch, 197–198
Switched-capacitor ﬁlters,
197–208
biquad, 202–204
direct synthesis of, 206–208
dual-integrator loop, 202–214
ladder simulation, 204–208
universal, 208–214
Switching-regulator topologies,
568–574
boost, 568–571
buck, 568–571
buck-boost, 568–571
capacitor selection in, 572–573
coil selection in, 571–572
current waveforms in, 570
Switching regulators, 566–574
basic topologies, 568–574
capacitor selection in, 572–573
coil selection in, 571–572
comparison with linear
regulators, 566–567
continuous conduction mode
(CCM), 569
copper loss, 574
discontinuous conduction
mode (DCM), 571
duty cycle (D) 567
efﬁciency (η) of, 567, 574
electromagnetic interference
(EMI), 573
equivalent series inductance
(ESL), 573
equivalent series resistance
(ESR), 573
pulse-frequency modulation
(PFM) in, 567
pulse-width modulation
(PWM) in, 567
Symmetric notch, 158
Synchronous buck converters,
578–580
T
Tape preampliﬁer, 132
Temperature coefﬁcient, 239
Temperature controller,
445, 452
Temperature sensors, 547–548,
551–552
Celsius, 551
cold-junction compensation in,
552
Fahrenheit, 551
IPTAT, 547
thermocouples as, 552
VPTAT, 547
Temperature-to-frequency
converter, 522
THA performance parameters,
472–474
acquisition time (tAQ), 473
aperture jitter, 473
aperture time (tAP), 473
aperture uncertainty (tAP),
473
feedthrough rejection ratio
(FRR), 473–474
hold-mode settling time (tS),
473–474
hold step, 473–474
pedestal error, 473–474
sample-to-hold offset, 473–474
signal-to-noise ratio (SNR),
473–474
voltage droop, 473–474
Thermal coefﬁcient (TC),
537–538
Thermal considerations in power
supplies, 560–563
heat ﬂow, 561–563
heat sinks, 562–563
power packages, 562
thermal resistance (θ),
561–563
Thermal drift, 236–237, 239
of the input bias current,
236–237
of the input offset voltage, 239
Thermal overload, 554–555
Thermal resistance (θ),
561–563
case to ambient (θCA), 561
junction to ambient (θJA), 561
junction to case (θJC), 561
sink to ambient (θSA),
562–563
Thermally-compensated
breakdown diode, 543
Thermally-compensated Zener
diode references, 542–544
avalanche breakdown, 542
ﬁeld emission breakdown, 542
thermally-compensated
breakdown diode, 543
thermally-stabilized, 543–544
Thermally-stabilized voltage
reference, 543–544
Thermocouples, 552
Thermometer code, 639
Third-order loop, 685
Thomson ﬁlters, 177
−3-db frequency (ω–3-dB),
127–128, 140
in the band-pass response
(ωH , ωL), 140
Three-pole ampliﬁer, 375–379
closed-loop responses as
functions of β, 376–379
frequency responses, 376–378
pole locations, 377–378
step responses, 376–379
Threshold detectors, 437
Time-base oscillator (TBO), 503
Timer/counter circuits,
499–505
TLE2426 Rail Splitter, 50
T -network, 69, 360–361
in I-V converters, 69
in photodiode ampliﬁers,
360–361
Tone control, 132–134
Total harmonic distortion (THD),
484
Total rms input noise, 355
Total rms output noise, 340
Tow-Thomas ﬁlters, 157–160
tuning of, 157

714
INDEX
Track-and-hold ampliﬁers
(THAs), 471–477
basic, 472
improved, 476–477
integrating-type, 475–476
performance parameters,
472–474. See also THA
performance parameters
using charge-transfer
compensation, 474–475
Tracking converter, 635
Track mode, 468
Transconductance ampliﬁers, 5,
71–79. See also
Voltage-to-current
converters
Transdiode conﬁguration,
659–662
stability of, 660–662
Transducer bridge, 100–102
bridge calibration, 101–102
bridge legs, 100
transducer resistance
deviation, 99–100
Transducer bridge ampliﬁers,
99–105
instrumentation ampliﬁer,
100–104
single-op-amp, 104
single-transducer with linear
response, 105
Transducer resistance deviation,
99–100
Transfer functions (H), 118–122
Bode plots, 122–123
frequency response, 120–122
poles, 118
stability, 119
transient response, 119–120
using SPICE to plot, 174
zeros, 118
Transient response, 119–120,
294–301
in ﬁlters, 119–120
full-power bandwidth,
297–298
of the inverting ampliﬁer, 297
of the μA741 op amp, 295–297
rise time (tR), 294–295
settling time (tS), 298–299
slew-rate limiting, 295–297,
300–301
small-signal step response, 294
Transimpedance ampliﬁers, 68,
316
Transistor noise models, 347
Transition band, 173
Transition frequency ( ft), 280
useful expressions for, 282
Transmission gates, 466–467
Transresistance ampliﬁer, 5,
68–70
Treble/bass control, 133
Triangular-to-sine conversion,
509–510, 515
using a breakpoint wave
shaper, 515
using a logarithmic wave
shaper, 509–510
SPICE simulation of, 510
Triangular wave generators,
505–510
w. adjustable slopes, 507
basic, 506
triangular-to-sine conversion,
509–510
voltage-controlled, 507–509
Triple-op-amp IA, 87–89
True difference ampliﬁer, 21
True rms converters, 664–665
2240 timer/counter circuit,
503–505
Two-port feedback factor (b). See
Feedback factor b
Two-port loop gain (L). See Loop
gain L
Two-stage CMOS op amps,
227–228
circuit schematic of, 227
frequency compensation of,
399–400
input offset voltage of, 244
input voltage range of,
254–255
output voltage swing of, 256
Type I phase comparator,
687–688
Type II phase comparator,
689–691
Type III phase comparator,
688–689
U
Ultra-low noise op amps,
364–365
Undamped response, 136
Underdamped response, 136
Undervoltage (UV), 563–566
sensing, 564–565
Unity-gain ampliﬁer, 12
Unity-gain frequency, 124, 125,
280
in differentiators ( f0), 124
in integrators ( f0), 125
in op amp open-loop response
( ft), 280
Unity-gain KRC circuit, 145–156
SPICE simulation of, 146
Universal ﬁlters, 154–160
biquad, 157–160
state-variable, 154–157
switched-capacitor, 208–214
universal, 208–214
Universal switched-capacitor
ﬁlters, 208–214
in cascade design, 212–214
MF10, 209–214
Upper-brick-wall frequency for
1/ f noise, 342
V
Variable transconductance
principle, 666
VFAs. See Voltage-feedback
ampliﬁers
VFC32 V -F converter, 523–524
V -I converters. See
Voltage-to-current
converters
Virtual ground, 14
Virtual short, 16
Voltage ampliﬁer, 3
Voltage comparators, 435–443
general-purpose, 437–441
high-speed, 441–442
input overdrive (Vod), 436
op amp as a comparator,
436–437
response time (tPD), 436
SPICE simulation of, 442–443
threshold detectors, 437
zero-crossing detectors, 437
Voltage compliance, 71, 79,
549–550, 560
Voltage-controlled ampliﬁers,
674–675
Voltage-controlled oscillators
(VCOs), 507–509, 677–678
ICL8038 as a VCO, 513–517
using OTAs, 677–678
sawtooth/pulse wave wave, 511
triangular/square wave,
507–509
Voltage-controlled state-variable
ﬁlter, 676–677
Voltage-to-current converters,
71–79
ﬁnite open-loop gain, effect of,
77–78
ﬂoating-load, 71–73
frequency response of, 288
grounded-load, 73–79
Howland current pump, 73–79
improved Howland pump,
78–79
practical op amp limitations,
72–73
resistance mismatches, effect
of 75–77
voltage compliance of, 71, 79

715
INDEX
Voltage/current injection
techniques, 383–385
double, 383–385
single, 385–386
Voltage droop, 469–470,
473–474
in peak detectors, 469–470
in THAs, 473–474
Voltage-feedback ampliﬁers
(VFAs), 322–323
CFA-derived, 322–323
folded-cascode, 323–324
Voltage follower, 12, 294–296
transients in, 294–296
Voltage-to-frequency (V -F)
converters, 520–524
charge-balancing (VFC32),
523–524
wide-sweep (AD537),
521–523
Voltage mode control in
switching regulators,
577–582
current-step response, 581–582
error-ampliﬁer design for,
580–582
left-half-plane zero (LHPZ) in,
579
loop gain (T ) in, 578–582
SPICE simulation of, 580–582
in synchronous buck
converters, 578–580
waveforms of, 578
Voltage mode R-2R ladders,
620–621
Voltage mode segmentation,
626–628
Voltage-reference applications,
548–552
current sinks, 550
current sources, 548–551
in temperature sensing,
551–552
Voltage reference circuits,
541–548
bandgap, 544–547
monolithic temperature
sensors, 547–548
thermally-compensated Zener
diode, 542–544
Voltage references 534–552
applications of, 548–552
performance speciﬁcations of,
536–541
Voltage regulators, 536–541,
553–600
error ampliﬁer, 574–577
linear, 553–566
linear-regulator applications,
558–566
PCMC of boost converters,
594–600
peak current mode control
(PCMC), 582–600
performance speciﬁcations of,
536–541
switching, 566–600
voltage mode control,
577–582
Voltage transfer curve (VTC),
27–29
closed-loop, 28–29
open-loop, 27
VPTAT, 547
VTC offsetting for Schmitt
triggers, 453–454
W
Weighted-capacitor DACS,
617–618
Weighted-resistor DACS,
616–617
White noise, 338
ﬂoor, 339
Wideband band-pass ﬁlter,
128–129
Wide-sweep V -F converters
(AD537), 521–523
Widlar, Robert J., 1
Wien bridge oscillators, 485–490
automatic amplitude control,
488–490
balanced bridge, 487
Barkhausen criteron, 487
basic, 486–488
neutral stability, 487
practical considerations, 490
SPICE simulation of, 489
Window detectors, 446–447
X
XR2206 function generator,
518–520
XR2240 monolithic
timer/counter, 503–505
block diagram of, 504
as a programmable delay
generator, 504
time-base oscillator (TBO),
503
Z
Zener diode (as shunt regulator),
538–540
buried, 543
self-regulated, 540–541
subsurface, 543
thermally-compensated,
542–544
Zener zapping, 246
Zero-crossing detectors, 437
Zero-pole cancellation, 304,
391–392, 403, 421, 581, 593
in integrator compensation, 304
in op amp compensation,
391–392, 403, 421
in switching regulator
compensation, 581, 593
Zeros, 118


