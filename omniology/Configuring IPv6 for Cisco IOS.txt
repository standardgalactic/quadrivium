
s o l u t i o n s @ s y n g r e s s . c o m
With more than 1,500,000 copies of our MCSE, MCSD, CompTIA, and Cisco
study guides in print, we continue to look for ways we can better serve the
information needs of our readers. One way we do that is by listening.
Readers like yourself have been telling us they want an Internet-based ser-
vice that would extend and enhance the value of our books. Based on
reader feedback and our own strategic plan, we have created a Web site
that we hope will exceed your expectations.
Solutions@syngress.com is an interactive treasure trove of useful infor-
mation focusing on our book topics and related technologies. The site
offers the following features:
■
One-year warranty against content obsolescence due to vendor
product upgrades. You can access online updates for any affected
chapters.
■
“Ask the Author” customer query forms that enable you to post
questions to our authors and editors.
■
Exclusive monthly mailings in which our experts provide answers to
reader queries and clear explanations of complex material. 
■
Regularly updated links to sites specially selected by our editors for
readers desiring additional reliable information on key topics.
Best of all, the book you’re now holding is your key to this amazing site.
Just go to www.syngress.com/solutions, and keep this book handy when
you register to verify your purchase.
Thank you for giving us the opportunity to serve your needs. And be sure
to let us know if there’s anything else we can do to help you get the 
maximum value from your investment. We’re listening.
www.syngress.com/solutions


1 YEAR UPGRADE
B U Y E R  P R O T E C T I O N  P L A N
Configuring
Sam Brown
Brian Browne
Neal Chen
Paul J. Fong
Robbie Harrell
Eric Knipp
Bart Saylors
Rob Webber
Edgar Parenti, Jr.
Technical Editor
I Pv6
Cisco IOS
for

Syngress Publishing, Inc., the author(s), and any person or ﬁrm involved in the writing, editing, or
production (collectively “M akers”) of this book (“the Work”) do not guarantee or warrant the results
to be obtained from the Work.
T here is no guarantee of any kind, expressed or implied, regarding the Work or its contents.T he Work
is sold AS IS and W IT H O U T  WAR R AN T Y. You may have other legal rights, which vary from state
to state.
In no event will M akers be liable to you for damages, including any loss of proﬁts, lost savings, or
other incidental or consequential damages arising out from the Work or its contents. Because some
states do not allow the exclusion or limitation of liability for consequential or incidental damages, the
above limitation may not apply to you.
You should always use reasonable care, including backup and other appropriate precautions, when
working with computers, networks, data, and ﬁles.
Syngress M edia®, Syngress®,“C areer Advancement T hrough Skill Enhancement®,” and “Ask the
Author U PDAT E®,” are registered trademarks of Syngress Publishing, Inc. “M ission C ritical™,” “H ack
Prooﬁng®,” and “T he O nly Way to Stop a H acker is to T hink Like O ne™” are trademarks of Syngress
Publishing, Inc. Brands and product names mentioned in this book are trademarks or service marks of
their respective companies.
KEY
SERIAL NUMBER
001
44BVHTR46T
002
AKTRT4YHE4
003
KUH4T945T5
004
87U86T6NVH
005
NFGTE4RNAS
006
SGD34B39F4
007
Q2F9R565MR
008
MSVX63N54N
009
GT6YH2BDFC
010
83N5M4B3ES
PU BLISH ED BY
Syngress Publishing, Inc.
800 H ingham Street
R ockland, M A 02370
Conﬁguring IPv6 for Cisco IOS
C opyright © 2002 by Syngress Publishing, Inc.All rights reserved. Printed in the U nited States of
America. Except as permitted under the C opyright Act of 1976, no part of this publication may be
reproduced or distributed in any form or by any means, or stored in a database or retrieval system,
without the prior written permission of the publisher, with the exception that the program listings
may be entered, stored, and executed in a computer system, but they may not be reproduced for
publication.
Printed in the U nited States of America
1  2  3  4  5  6  7  8  9  0
ISBN : 1-928994-84-9
Technical Editor: Edgar Parenti, Jr.
C over Designer: M ichael K avish
Technical R eviewer:Tony Bautts
Page Layout and Art by: Shannon Tozier 
Acquisitions Editor: C atherine B. N olan
C opy Editors:Alexandra Kent and M ichelle M elani
Developmental Editor: K ate Glennon
Indexer: J. Edmund R ush
Distributed by Publishers Group West in the U nited States and Jaguar Book Group in C anada.

v
Acknowledgments
v
We would like to acknowledge the following people for their kindness and support
in making this book possible.
R alph Troupe, R honda St. John, Emlyn R hodes, and the team at C allisma for their
invaluable insight into the challenges of designing, deploying and supporting world-
class enterprise networks.
K aren C ross, Lance T ilford, M eaghan C unningham, K im Wylie, H arry K irchner, Kevin
Votel, Kent Anderson, Frida Yara, Jon M ayes, John M esjak, Peg O ’Donnell, Sandra
Patterson, Betty R edmond, R oy R emer, R on Shapiro, Patricia Kelly,Andrea Tetrick,
Jennifer Pascal, Doug R eil, David Dahl, Janis C arpenter, and Susan Fryer of Publishers
Group West for sharing their incredible marketing experience and expertise.
Jacquie Shanahan,AnnH elen Lindeholm, David Burton, Febea M arinetti, and R osie
M oss of Elsevier Science for making certain that our vision remains worldwide in
scope.
Annabel Dent and Paul Barry of Elsevier Science/ H arcourt Australia for all their help.
David Buckland,Wendi Wong, M arie C hieng, Lucy C hong, Leslie Lim,Audrey Gan,
and Joseph C han of Transquest Publishers for the enthusiasm with which they receive
our books.
K won Sung June at Acorn Publishing for his support.
Ethan Atkin at C ranbury International for his help in expanding the Syngress
program.
Jackie Gross, Gayle Voycey,Alexia Penny,Anik R obitaille, C raig Siddall, Darlene
M orrow, Iolanda M iller, Jane M ackay, and M arie Skelly at Jackie Gross & Associates
for all their help and enthusiasm representing our product in C anada.
Lois Fraser, C onnie M cM enemy, Shannon R ussell, and the rest of the great folks at
Jaguar Book Group for their help with distribution of Syngress books in C anada.


vii
Contributors
Sam Brown (C C N P, C C DP, M C SE, M C P+I, C N E, C itrix C C A) is a
C onsultant with C allisma where he provides technical consulting to a
variety of C allisma clients. H is specialties include N etwork M anagement
Systems (N M S) planning and implementation, C isco routers and LAN
switches, M icrosoft N T  and N ovell design and implementation, network
planning, network architecture and design, and network troubleshooting
and optimization. Sam’s background includes positions as a N etwork
Analyst for O pryland U SA in N ashville,T N , and and as a Senior
N etwork Engineer at Frost Bank in Fiesta,T X . Sam makes his home 
in Denver, C O.
Brian Browne (C ISSP) is a Senior C onsultant with C allisma providing
senior-level strategic and technical security consulting to C allisma clients.
H e has 12 years of experience in the ﬁeld of information systems security
and is skilled in all phases of the security lifecycle.A former independent
consultant, Brian has provided security consulting expertise for multiple
Fortune 500 clients, and has been published in B usiness C ommunications
R eview magazine. H is security experience includes network security, ﬁre-
wall architectures,Virtual Private N etworks (VPN s), Intrusion Detection
Systems (IDSs), U N IX  security,W indows N T  security, and Public Key
Infrastructure (PK I). Brian resides in W illow Grove, PA with his wife Lisa
and daughter M arisa.
Neal Chen (C C N P, C C N A) is a C onsultant with C allisma providing
strategic and technical consulting to all C allisma clients in the N ortheast
region of the U nited States. H is specialties include C isco routers and
LAN  switches, C isco and N ortel Dense Wavelength Division
M ultiplexing (DW DM ) and SO N ET  equipment, strategic network plan-
ning, network architecture and design, and network troubleshooting and
optimization. N eal’s background also includes a position as a N etwork
Engineer at R aytheon C orporation.

viii
Paul J. Fong (C C DP, C C N P) is a Senior C onsultant for C allisma where
he provides strategic and technical consulting to service provider clients.
Paul’s background includes positions as an Advisory Systems Analyst at IBM
where he developed a network monitoring system for N ASA Space Shuttle
telemetry, and as a senior member of the technical staff at M C I Worldcom
where he played a key role in the development of the SR DF-over-IP pro-
tocol. Paul holds a Bachelor’s and a M aster’s degree from Stanford
U niversity.W hile pursuing his studies, Paul developed speech recognition
software at the X erox Palo Alto R esearch C enter as a research associate and
published his work in IE E E  Transactions on Systems, M an and C ybernetics. Paul
is a member of the C olorado Springs C isco U sers Group and lives in
M onument, C O, with his wife Sharon and their daughter Shana.
Robbie Harrell (C C IE #3873) is a Principle Architect with C allisma in
Atlanta, GA. H e has over 10 years of experience and provides strategic,
business, and technical consulting services to clients. R obbie specializes in
the design and implementation of complex solutions necessary to meet
business objectives in the enterprise and service provider market space.
H is expertise is in routing and switching, and strategic planning. R obbie’s
background includes positions as a Principle C onsultant at International
N etwork Services, Lucent, and Frontway.
Eric Knipp (C C N P, C C DP, C C N A, C C DA, M C SE, M C P+I) is a
C onsultant with C allisma. H e is currently engaged in a broadband opti-
mization project for a major U.S. backbone service provider. H e special-
izes in IP telephony and convergence, C isco routers, LAN  switches, well
as M icrosoft N T, and network design and implementation. Eric has also
passed both the C C IE R outing and Switching written exam as well as
the C C IE C ommunications and Services O ptical qualiﬁcation exam and
is currently preparing to take the C C IE lab later this year. Eric’s back-
ground includes positions as a Project M anager for a major international
law ﬁrm, and a Project M anager for N O R T EL. Eric has contributed to
the Syngress publications C isco AV V ID  and IP  Telephony D esign and
Implementation (ISBN : 1-928994-83-0), M anaging C isco N etwork Security,
Second E dition (ISBN : 1-931836-56-6), and the forthcoming C onﬁguring
C isco Voice O ver IP, Second E dition (ISBN : 1-931836-64-7).

ix
Bart Saylors (C C N P, C C DP) is a Senior C onsultant with C allisma. H is
specialties include C isco router and LAN  switching design, implementation,
and troubleshooting as well as providing the business processes and project
management needed during the life cycle of these technologies. Bart has 19
years of networking experience and has held positions of Senior N etwork
Support for the JC Penney corporate data center network, Senior Design
Engineer at AC S and Data Engineering Support for GT E.
Rob Webber (C C IE #6922) is a Senior N etwork C onsultant with
C allisma in Wakeﬁeld, M A. H e has over 14 years of experience in the data
networking industry, and has spent the last four as a consultant. R ob spe-
cializes in the design and implementation of complex networks in the
ﬁnancial, medical, manufacturing, and service provider industries. H is
expertise includes routing, switching, security, and converged voice and
data networking solutions from C isco Systems and N ortel N etworks.
R ob is a contributing author to C isco AV V ID  and IP  Telephony D esign &
Implementation (Syngress Publishing, ISBN : 1-928994-83-0). In addition to
networking R ob enjoys Web development and Perl scripting. R ob holds a
Bachelor’s of Science degree from the U niversity of N ew H ampshire.

x
Technical Reviewer
Tony Bautts is a Senior Security C onsultant with Astech C onsulting. H e
currently provides security advice and architecture for clients in the San
Francisco Bay area. H is specialties include Intrusion Detection Systems
(IDSs), ﬁrewall design and integration, post-intrusion forensics, bastion
hosting, and secure infrastructure design.Tony’s security experience has
led him to work with Fortune 500 companies in the U nited States as well
as to perform two years of security consulting in Japan.Tony was a con-
tributing author to H ack P rooﬁng Your W ireless N etwork (Syngress
Publishing, ISBN : 1-928994-59-8). H e is also involved with the
BerkeleyW ireless.net project, which is working to build neighborhood
wireless networks for residents of Berkeley, C A.
Edgar Parenti, Jr. (C C N A, C C DA, C C N P, C C DP, C N E-3/ 4/ 5,
M C N E, PSE, M C SE 2000, M C T ) is currently a C onsulting Engineer
with U N IC O M  Technology Group, Inc. where he provides corporate,
education, and government customers with a portfolio of cutting-edge
networking solutions. Edgar has a strong background in network and
directory design, network analysis and optimization, system performance
tuning,Web application architecture and support, messaging and infras-
tructure engineering, operating system support, process engineering, and
information security. H is background also includes working at numerous
corporations of all sizes providing senior-level IT  consulting services uti-
lizing a wide array of technologies and over six years of designing and
managing C isco internetworks.
Technical Editor

Contents
xi
Foreword
xix
Chapter 1 Introduction to the Cisco IOS
1
Introduction
2
C onnecting to the R outer
2
C onsole Port C onnections
3
Telnet C onnection
6
SN M P C onfigurations
7
Entering C ommands to C onfigure a C isco R outer
9
U sing C onfiguration C ommands
11
U sing Passwords to C ontrol R outer Access 13
Performing Interface C onfiguration Tasks
15
U sing show C ommands
18
U sing the show version C ommand
21
U sing the show running-configuration
C ommand
23
U sing the show interface C ommand
25
Increasing Efficiency by U sing Shortcuts
27
Summary
29
Solutions Fast Track
30
Frequently Asked Q uestions
31
Chapter 2 Introduction to 
IPv6 Architecture 
33
Introduction
34
U nderstanding the Benefits of IPv6
34
Increased IP Address Size 
35
Increased Addressing H ierarchy Support
36
Simplified H ost Addressing 
41
The show version
Command
The show version
command enables
administrators to discern
the following system
conditions and
parameters:
■
System Platform
■
System IOS version
■
System Boot Rom
Version
■
System Uptime
■
Reason for last reboot
■
System Image File
■
Processor and Memory
available
■
Physical Interfaces
■
Configuration Register

xii
Contents
Simpler Autoconfiguration of Addresses
42
Improved Scalability of M ulticast R outing
44
T he Anycast Address
48
Streamlined H eader
50
Security
52
M obility
53
Performance
54
C omparing IPv6 to IPv4 
55
Addressing Structure
56
Address Administration
56
H eader C omparison
58
Feature C omparison
59
Examining IPv6 N etwork Architecture
60
IPv6 C ommunication Fundamentals
61
Intra-Subnet C ommunications
61
Inter-Subnet C ommunications
63
Internetwork C ommunications
65
U pper-Layer Protocol Issues
67
U nderstanding IC M Pv6
68
Error M essages
69
Informational M essages
70
U nderstanding N eighbor Discovery 
71
R outer Solicitation and Advertisement
72
N eighbor Solicitation and Advertisement
73
R edirect M essage
73
M essage O ptions
74
Summary
75
Solutions Fast Track
76
Frequently Asked Q uestions
79
Chapter 3 The IPv6 Headers
81
Introduction
82
Analyzing the IPv6 H eader
83
C omparing the IPv6 and IPv4 H eaders
84
T he IPv6 Extension H eaders
87
H op-by-H op O ptions H eader
91
R outing H eader
94
The Benefits of IPv6
The benefits of IPv6
include:
■
Increased IP Address
Size
■
Increased Addressing
Hierarchy Support
■
Simplified Host
Addressing
■
Simplified Auto-
configuration of
Addresses
■
Improved Scalability of
Multicast Routing 
■
The Anycast Address
■
Streamlined Header
■
Improved Security
■
Better Mobility
■
Better Performance

Contents
xiii
Fragment H eader 
98
Authentication H eader
101
Encapsulating Security Payload
104
Destination O ptions H eader
106
Summary
108
Solutions Fast Track
109
Frequently Asked Q uestions
111
Chapter 4 Explaining IPv6 Addressing
113
Introduction
114
T he Basics of IPv6 Addressing
115
IPv6 Addressing Scheme C haracteristics
116
IPv6 H eader O verview
116
Version Field
116
Traffic C lass Field
117
Flow Label Field
118
Payload Length Field
118
N ext H eader Field
119
IPv4 and IPv6 Address Space 
119
IPv6 Address Structure
121
U nicast Addresses
127
M ulticast Address
141
Anycast Address
145
N odes-R equired Address
147
T he N eed for Further Development
149
T he M ultihoming Problem
149
Dual IPv6 Addressing on a H ost
151
Portability of Address Space
152
Dual IPv6 Address Prefixes Allocated
within the Environment 
152
Independently Assigned Address Space
153
T he 6Bone
153
Summary
155
Solutions Fast Track
155
Frequently Asked Q uestions
157
IPv4 and IPv6 Address
Spaces 
The allocation and
assignment policies are
defined in RFC 2050.
Specifically, the policy is as
follows:
1. End users should
request address space
from their directly
connected upstream
provider.
2. If no addresses are
available from the
upstream provider,
request addresses from
the provider’s provider.
3. If justifiable, request
address space directly
from ARIN, RIPE, or
APNIC.

xiv
Contents
Chapter 5 Configuring IPv6 Addressing
159
Introduction
160
C onfiguring IPv6 Addressing 
160
C onfiguring LAN  Addresses
162
C onfiguring Duplicate Address Detection
165
C onfiguring DN S
166
C onfiguring WAN  Addresses
168
C onfiguring AT M  
168
C onfiguring Frame-R elay
169
C onfiguring IC M Pv6 and N eighbor
Discovery
172
Verifying Addressing C onfiguration
174
Verifying LAN  Addressing
176
Verifying WAN  Addressing
177
Verifying IC M Pv6 and N eighbor
Discovery C onfiguration
178
Summary
180
Solutions Fast Track
181
Frequently Asked Q uestions
183
Chapter 6 Routing IPv6 for the Cisco IOS
185
Introduction
186
Explaining R IP for IPv6
186
Periodic U pdates
187
R outing Loops
189
Triggered U pdates
190
Split H orizon
191
C ounting to Infinity
192
Poison R everse
193
H old-Down T imers
193
R IP T imers
194
Administrative Distance
195
C onfiguring R IP for IPv6
196
Basic IPv6 R IP C onfiguration
196
Default R outes in IPv6 R IP
198
IPv6 R IP R oute R edistribution
200
Filtering IPv6 R IP R outing
205
Configuring IPv6
Addressing
■
When configuring your
interfaces, remember
that ipv6 must be
included in the syntax
to distinguish between
IPv4 and IPv6
addresses.
■
There are three types
of addresses that can
be assigned on an
interface: global, site-
local and link-local.
■
If you are using the
EUI-64 command when
entering an IPv6
address, remember
that the router uses its
identifier for the last
64 bits of the IPv6
address, therefore if
you want to find out
the address, you have
to go back and get the
full IPv6 address. 
■
With the configuration
of duplicate address
detection, you can
specify the number of
solicitation messages
that are sent out.

Contents
xv
Verifying IPv6 R IP O peration
208
Exploring IS-IS for IPv6
210
Link-State Advertisements
211
N eighbors
212
Link-State Database
213
Areas
213
IS-IS Specifics
213
C LN S Addressing
214
Integrated IS-IS
214
C onfiguring IS-IS for IPv6
215
IS-IS Default R outes
217
M aximum Paths for IS-IS
218
IS-IS R oute R edistribution
218
Describing M uliprotocol BGP Extensions
for IPv6
219
Autonomous Systems 
220
N eighbors
220
BGP M etrics
220
C onfiguring BGP Extensions for IPv6
221
C onfiguring an IPv6 N eighbor R elationship 
221
C onfiguring a BGP R outer ID
225
C onfiguring BGP Peer Groups
226
C onfiguring Link-Local Addressing
226
BGP R edistribution
228
Verifying BGP O peration
231
U sing the show bgp C ommand
231
U sing the show bgp ipv6 summary
C ommand
232
O ther R outing Protocols and Future
Developments
232
IPv6 O SPF
233
IPv6 EIGR P
233
Summary
234
Solutions Fast Track
235
Frequently Asked Q uestions
237
WARNING
BGP uses a ten-step
process in calculating
its metric. Redistributed
routes do not go
through this process,
unless of course you
are redistributing
another BGP process;
therefore, you should
manually configure the
redistributed protocols
to appropriately fit into
the BGP routing
process. 

xvi
Contents
Chapter 7 Deploying IPv6 on the 
Cisco IOS
239
Introduction
240
IPv6 Deployment Strategies
240
U nderstanding Deployment M ethods 
241
C onfiguring IPv6 over IPv4 Tunnels
242
IPv6 M anually C onfigured Tunnel
242
IPv6 over IPv4 GR E Tunnel
244
Automatic IPv6 Tunnel
245
Automatic 6to4 Tunnel
245
ISATAP Tunnel
247
6over4 Tunnels
248
Tunnel Broker
248
C onfiguring IPv6 over Dedicated Links
248
Deploying IPv6 over an M PLS Backbone
251
IPv6 U sing Tunnels on the C ustomer
Edge R outers
251
IPv6 over a C ircuit Transport over M PLS
251
IPv6 on the Provider Edge R outers
252
U sing a Dual-Stack Backbone
252
Translating between IPv4 and IPv6
255
Protocol Translation M echanisms
256
N AT-PT
256
T C P-U DP R elay
257
Bump in the Stack M ethod
257
Dual-Stack Transition M echanism
258
Socks-Based IPv6/ IPv4 Gateway
258
Summary
260
Solutions Fast Track
262
Frequently Asked Q uestions
266
Chapter 8 IPv6 Security
267
Introduction
268
IPSec O verview
268
U nderstanding the Building Blocks of IPSec 
270
Extension H eaders O verview
270
C hoosing the M ode of O peration
271
IPv6 Deployment
Strategies
To verify the platform
support and list minimum
memory requirements for
the intended deployment,
follow these steps:
1. Go to www.cisco.com/
kobayashi/support/tac/
software.shtml.
2. Select either Software
Advisor |  Search by
Release, or Software
Upgrade Planner for
Cisco IOS selection.

Contents
xvii
Internet K ey Exchange O verview
272
U nderstanding the Implementation O ptions
273
U nderstanding the Authentication O ptions
275
C ryptographic Algorithms U sed in IPSec
275
C ombining IPSec’s C ryptographic M echanisms
276
T he Security Policy Database 
277
T he Security Association
278
Internet K ey Exchange 
280
IK E Phase 1 M ain M ode
283
IK E Phase 1 Aggressive M ode
284
IK E Phase 2 Q uick M ode
285
Applying Perimeter Security 
286
Summary
289
Solutions Fast Track
290
Frequently Asked Q uestions
292
Chapter 9 Monitoring and 
Troubleshooting IPv6 Networks
295
Introduction
296
U sing show C ommands
296
U sing B asic show C ommands
296
U sing the show bgp C ommands
304
U sing debug C ommands
308
Analyzing IPv6 Traffic
312
W hat’s N ew in Internet C ontrol M essage
Protocol for IPv6
313
T he N eighbor Discovery Process
315
Summary
321
Solutions Fast Track
321
Frequently Asked Q uestions
323
Configuring IPv6 for the 
Cisco IOS Fast Track
325
Index
343
Extension Headers
Overview
When more than one IPv6
extension header is
included in a packet, the
header should adhere to
the following order:
1. IPv6 Header
2. Hop-by-Hop Options
Header
3. Destination Options
Header (for options to
be processed by the
first destination that
appears in the IPv6
Destination Address
field plus subsequent
destinations listed in
the Routing header)
4. Routing Header
5. Fragment Header
6. Authentication Header 
7. Encapsulating Security
Payload Header
8. Destination Options
Header (for options to
be processed only by
the final destination of
the packet)


It’s time for the next generation of the Internet Protocol and IPv6 has arrived! T his
new protocol will allow for the continued expansion of the Internet and is one of
the most signiﬁcant developments in the history of the communications industry.
Today’s Internet uses mostly IPv4, which is now nearly 20 years old. In spite of
its age, IPv4 has been remarkably resilient, although it’s limitations are now becoming
problematic. M ost importantly, there is a growing shortage of IPv4 addresses, which
are needed by all new machines added to the Internet.
IPv6 offers multiple advantages over IPv4: larger address space, hierarchical
addressing, security, and mobility. O ne of the most important beneﬁts of IPv6 is hier-
archical addressing, because supernetting fosters smaller routing table entries. IPv6
will eventually replace IPv4 in next generation carrier networks, although the prob-
able catalyst for IPv6 might be the expected widespread adoption of 3G data wireless
services.T his adaptation of IPv6 to next-generation wireless networks is already
under way.
C onﬁguring IP v6 for C isco IO S reviews the IPv6 architecture and features while
focusing on the practical aspects of IPv6 implementation, which include addressing
and routing.Also, because IPv4 networks will continue to exist for quite some time,
requiring efﬁcient and stable IPv4/ IPv6 internetworking, the book explores several
approaches to IPv6 transitioning.Also, it reviews the monitoring and troubleshooting
required for long-term operational support.T his book provides understanding of the
technology and more important, it offers the real-world experience of writers who
have worked with the IPv6 architecture.
As a professional services ﬁrm focused on network infrastructure solutions,
C allisma provides planning, design and implementation of advanced networking pro-
tocols such as IPv6.We regularly assist customers with the considerations this book
covers and will educate readers on some of the theory and practical information
required to successfully deploy and support their mission critical networks. For more
information, visit the C allisma Web site at www.callisma.com.
— R alph Troupe
P resident and C E O , C allisma
xix
Foreword


Introduction to 
the Cisco IOS
Solutions in this chapter:
■
Connecting to the Router
■
Entering Commands to Conﬁgure a Cisco
Router
■
Increasing Efﬁciency by Using Shortcuts
Chapter 1
1
 Summary
 Solutions Fast Track
 Frequently Asked Questions

2
Chapter 1 • Introduction to the Cisco IOS
Introduction
A common management and conﬁguration framework is the goal of any good
network equipment provider. C isco Systems has achieved this goal in commend-
able fashion.T he C isco Internetwork O perating System (IO S) provides a breadth
of features, which facilitates a uniform conﬁguration and management platform
across nearly its entire line of routing and switching products. O ne of C isco’s
goals for its routing and switching products has been to unify the core services
provided by its IO S to create a standard “look and feel” for its product lines.T he
C ommand Line Interface (C LI), which is used to enter conﬁguration and man-
agement commands, has been standardized in recent years and has been emulated
by other networking vendors due to its effective structure.
T he IO S is not unlike any other operating system. Its purpose is to transform
the otherwise lifeless collection of electronics within the particular piece of net-
work equipment into a useable, intelligent device. O perating systems such as M S-
DO S, U N IX ,VM S, N T, and W indows 2000 perform a similar function for
mid-range and personal computers.T he function of the C isco IO S is much dif-
ferent from that of a PC  operating system but not any more difﬁcult to learn.At
ﬁrst glance, however, conﬁguring a C isco networking product’s IO S through the
C LI seems quite intimidating.T here are complex sets of commands that require
intricate syntax to perform even the simplest tasks.T he daunting nature of the
large command set and complex syntax is offset by the consistency of command
syntax and integrated help features. Gaining access to the router and entering
commands become routine activities after you have performed them only a few
times, due to the short learning curve necessary for mastering the C LI.
T his chapter will focus entirely on the necessary procedures to connect to a
C isco router and enter commands using the C LI. It will cover in detail the steps
necessary to connect to the router and will describe how to enter commands,
how to work with command shortcuts, and how to access help features. Because
this book is about conﬁguring a routed protocol, IO S conﬁguration tasks will be
demonstrated on a C isco router. If you have never conﬁgured a C isco router, this
chapter will give you all the information necessary to help you accomplish this
often-intimidating task with the greatest of ease.
Connecting to the Router
As logic would dictate, to conﬁgure a router, you must ﬁrst be able to connect to
it. O ut of the box, the IO S is loaded; however, it has no conﬁguration at all.As
www.syngress.com

www.syngress.com
such, it has no Layer 3 addressing on the interfaces or Simple N etwork
M anagement Protocol (SN M P) strings loaded into the router.T his makes it
impossible to connect remotely.To conﬁgure the router, a physical connection
must be made to the router through the use of the router console port.
Although router conﬁgurations differ considerably from platform to platform,
all routers generally share two common ports: an auxiliary port and a console port.
Auxiliary ports are typically attached to a modem or other device for remote
management in case of network failure or some other catastrophic event.
Although the auxiliary port is useful in many cases, we are going to focus our
discussion on the console port.
Console Port Connections
T he console port, as its name implies, provides a console connection to the router
for conﬁguration purposes.To access this port you need to use a rolled-R J45 cable
Introduction to the Cisco IOS • Chapter 1
3
One IOS?
Not just one IOS exists for all Cisco devices; in fact, hundreds of different
IOS releases and versions are available. IOS releases are written for each
router platform and even more speciﬁc releases offer certain features
and solutions. IOS releases are custom tailored for almost any environ-
ment, such as Service Providers, Enterprises, Systems Network
Architecture (SNA) integration, and Internetwork Packet Exchange (IPX)
support.
What you must decide as a network administrator is which IOS is
right for your network. To assist in this, Cisco offers an IOS software
selection tool. This tool enables you to select the individual router/switch
platform and displays all the speciﬁc IOS releases available and the fea-
tures that each of them support. The IOS selection tool is available at the
Cisco technical assistance (TAC) Web site at www.cisco.com/tac. One
point to keep in mind is that in order to access the TAC Web site you
must have a Cisco Connection Online (CCO) login. To obtain a CCO login,
you must have either a service contract with Cisco Systems for a speciﬁc
hardware platform or you must be a Cisco partner.
Conﬁguring & Implementing…

4
Chapter 1 • Introduction to the Cisco IOS
with a 9– or 25-pin adapter connected to a PC  that is running terminal emulation
software, connected to the console port of the router. O n older routers, the con-
sole port is a 25-pin serial port; a 25-pin to R J-45 connector with a rolled R J-45
cable is incorporated to connect to the console ports of these routers.A rolled 
R J-45 cable is simply a cable in which each pair have been swapped at opposite
ends to make the send receive and the receive send.W ires connecting to pins 
5, 2, 4, and 1 on one R J-45 connector interface with pins 2, 5, 1, and 4 on the
other connector in order to accomplish this. Figure 1.1 demonstrates the connec-
tion between a PC  running terminal software and the router’s console port.A new
router usually comes with a console connection kit with a 9-pin and 25-pin con-
nector as well as an R J-45 rolled cable.
N ow that you have an understanding of how the physical connection is made
to the router, we can turn our attention to how the logical connection to the
router is made.To make a software connection to the router, you must run a ter-
minal-emulation software program on your computer. For purposes of this dis-
cussion we will use the H yperTerminal software program, which is included in
the accessories software package of most W indows-based computers.
T his conﬁguration is as follows:
1.
Go to Start Menu |  Programs |  Accessories |  Communications,
and launch H yperTerminal.
2.
In the C onnection Description screen, enter a name for your new con-
nection and press OK (see Figure 1.2).
3.
In the C onnect To screen, choose a C O M  port from the list (2-4 ports
are usually available). For the purposes of this example we will use
COM 2, as shown in Figure 1.3.
www.syngress.com
Figure 1.1 PC Connecting to a Router Console Port
Computer
Router Console Port
Rolled RJ -45 Cable
RJ -45 Connector Pins:
5
2
4
1
RJ -45 Connector Pins:
2
5
1
4

Introduction to the Cisco IOS • Chapter 1
5
4.
M ake the following changes to the connection: C hoose 9600 bps and
None for the option for ﬂow control. Figure 1.4 demonstrates what the
appropriate connection settings should look like.
Turn the router on and you should see the system post information come up.
T his information includes the boot information and pertinent information to the
www.syngress.com
Figure 1.2 HyperTerminal Name Settings
Figure 1.3 HyperTerminal Connection Settings
Figure 1.4 Com Port Settings

6
Chapter 1 • Introduction to the Cisco IOS
current conﬁg.After the router has ﬁnished posting, press Return twice and the
router is ready to accept commands.
Telnet Connection
After you have conﬁgured addressing on interfaces and network paths are avail-
able to these addresses, you can access the router through the virtual terminal
(VT Y ) interfaces of the router.VT Y  ports are a set of completely logical inter-
faces that answer to the T C P port 23 requests to the Internet Protocol (IP)
addresses conﬁgured for the router.To access a router via Telnet connection, use
terminal emulation software from a PC  to issue the telnet command to access a
router. Several products, such as the R eﬂection suite of products, are available to
provide Telnet connectivity. In the following example, we will be using the Telnet
function built into the W indows operating system to access our router.To do this
on a PC, go to Start |  Run and type Cmd if you are using W indows 2000 or
X P (or Command, if you are using W indows 9x).T his brings up a command
prompt.At the command prompt, enter the telnet <ip address> command.An
example of this command is shown in Figure 1.5.
If you have already set up your router, you can see from our example in
Figure 1.6 that we issued the telnet command for the IP address 10.1.1.1 and
that this request was successful because we were met with a router prompt.T his
particular router is prompting us for a username and password because we have
conﬁgured a username and password on the router.We will discuss this in more
detail in the “Entering C ommands” section later in this chapter.
www.syngress.com
Figure 1.5 Router Telnet Connection

Introduction to the Cisco IOS • Chapter 1
7
SNMP Conﬁgurations
T he Simple N etwork M anagement Protocol is an industry open standard used by
administrators and network management systems (N M S) to remotely manage sys-
tems. SN M P incorporates a system known as management information bases
(M IBs) to accomplish this. M IBs are sets of device characteristics that let the
N M S know how the device operates.W hen a certain criterion is met, an event
known as a trap is set off.A trap lets the N M S know that a speciﬁc event has
occurred and whether or not an action should be taken for the action.
www.syngress.com
Figure 1.6 Successful Connection to a Router via Telnet
Exploring GUI Options
The goal of this chapter is to familiarize you with the Cisco IOS and its
command structure. However, many individuals are very leery of com-
mand-line interfaces; indeed, in this age of Windows and Java consoles,
command line is starting to become quite passé. As you can see, the
command-line interface offered by the Cisco IOS differs from many of
the stereotypes faced by these traditional interfaces in that it is a user-
friendly and fairly intuitive interface; however, if you wish to have a
graphical user interface (GUI), a few options are available to you.
Designing & Planning…
Continued

8
Chapter 1 • Introduction to the Cisco IOS
C isco routers are fully compliant with the SN M P standard.Although initial
conﬁguration cannot take place through the use of SN M P, ongoing management
and monitoring is more than possible through it. C isco routers, through use of
SN M P, can interoperate with almost all the major N M S platforms including
C iscoWorks, H P O penView, IBM  T ivoli, M icromuse, and SM ART S. SN M P is
enabled on a router through the conﬁguration of community strings and privileges.
www.syngress.com
Network Management Systems:
Through the use of a network management system, of which
CiscoWorks 2000 is the ﬂagship, many of the common management
functions and statistical data gathering can be accomplished through a
GUI or similar interface. This type of system would enable the routers
and switches to be managed from a single point of administration.
CiscoWorks and other NMSs do offer an alternative to the command-line
interface for some but not all functions; initial conﬁguration still has to
be done through command lines.
Web Conﬁguration:
In recent years, Cisco has begun writing versions of the IOS to sup-
port Web-based GUIs to their products. These are a highly powerful and
easy-to-use interfaces that enable almost all conﬁguration and moni-
toring tasks to be accomplished through use of a Web browser. To
accomplish this, you simply type HTTP:// followed by the router’s IP
address in a typical Java-enabled browser. Be advised, though, that not
all Cisco’s products support Web-based conﬁguration; you should check
the Cisco Web site to see if your speciﬁc router/switch supports Web
conﬁguration. Also, you should keep in mind that you still need to do
initial conﬁguration through a console connection to the router.
ConﬁgMaker:
ConﬁgMaker is a very powerful conﬁguration tool available as a
free download from the Cisco Web site. This tool offers a GUI interface
and uses a series of user inputs and questions to build a conﬁguration
ﬁle that can be easily applied to the conﬁguration of a new or working
router. Although it is not an all-encompassing solution, and it cannot
create a conﬁguration ﬁle for every possible scenario, it is a great tool
for general conﬁgurations and is part of the tool set used by network
engineers and administrators from novice to expert levels. ConﬁgMaker
can be downloaded from the Cisco Web site at www.cisco.com.

Introduction to the Cisco IOS • Chapter 1
9
Entering Commands to 
Conﬁgure a Cisco Router
N ow that you know how to connect to the router, let’s turn our attention to
what we do when we have accessed the router— conﬁgure it. R outer conﬁgura-
tion, as a process, is a relatively simple task, with a basic command structure and a
built-in command menu; however, router conﬁguration gets a bad rap for being
difﬁcult because of the logic that must be incorporated into many of the conﬁg-
urations and changes. In this section we will discuss the structure and process for
entering commands into a C isco router.
NOTE
For all our examples in this chapter we will be using a 2501 router 
running 12.2(8)T IOS.
T here are two basic levels of router conﬁguration, user mode and privileged
mode. U ser mode is for basic administration and veriﬁcation— no conﬁguration
can be done on this level.You are limited to basic functions such as ping, low-
level show commands, and trace routes at this level. Privileged mode is where the
real fun starts. Privileged mode is the conﬁguration level that enables an adminis-
trator to make actual conﬁguration changes and high-level show commands.T he
majority of this section will center on entering commands at a privileged level. If
ever in doubt as to what you can do at a particular prompt, you can enter a ques-
tion mark (?) at the command prompt to see the commands available to you.
W hen you enter the question mark after a particular command, it will show you
all the different parameters available for that command.T he following code
example shows all the commands available in user mode, and afterwards all the
particular parameters available for the ping command:
6Router-1>?
Exec commands:
<1-99>
Session number to resume
access-enable
Create a temporary Access-List entry
access-proﬁle
Apply user-proﬁle to interface
clear
Reset functions
connect
Open a terminal connection
disable
Turn off privileged commands
www.syngress.com

10
Chapter 1 • Introduction to the Cisco IOS
disconnect
Disconnect an existing network connection
enable
Turn on privileged commands
exit
Exit from the EXEC
help
Description of the interactive help system
lock
Lock the terminal
login
Log in as a particular user
logout
Exit from the EXEC
mrinfo
Request neighbor and version information from a 
multicast router
mstat
Show statistics after multiple multicast traceroutes
mtrace
Trace reverse multicast path from destination to source
name-connection
Name an existing network connection
pad
Open an X.29 PAD connection
ping
Send echo messages
ppp
Start IETF Point-to-Point Protocol (PPP)
resume
Resume an active network connection
rlogin
Open an rlogin connection
show
Show running system information
slip
Start Serial-line IP (SLIP)
systat
Display information about terminal lines
telnet
Open a telnet connection
terminal
Set terminal line parameters
traceroute
Trace route to destination
tunnel
Open a tunnel connection
udptn
Open an udptn connection
where
List active connections
x28
Become an X.28 PAD
x3
Set X.3 parameters on PAD
6Router-1>
6Router-1>ping ?
WORD  Ping destination address or hostname
ip    IP echo
ipv6  IPv6 echo
srb   srb echo
tag   Tag encapsulated IP echo
6Router-1>ping
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
11
As we mentioned earlier, when you ﬁrst enter into a router, you will enter
into basic user mode.You can always tell which level you are in by looking at the
router prompt at the far left.W hen you are in user mode, you will see the router
name followed by a greater-than angle bracket (>).To enter into privileged
mode, enter the enable command.T his changes the angle bracket to a pound
sign (#). In most cases, and as generally recommended by C isco, an enable pass-
word governs the capability to enter into privileged mode. In such cases, you are
prompted for the enable password after entering the enable command. In order to
move back into user mode from privileged mode, enter the disable command.
T he following code example demonstrates this process:
6Router-1>enable
Password: 
6Router-1#disable
6Router-1>
Using Conﬁguration Commands
After you have entered into privileged mode on your router, there are two basic
types of command that you can enter: conﬁguration commands or show commands. In
this section, we will discuss conﬁguration commands. C onﬁguration commands
are commands that you enter into the router that change the way the router
operates.As you can probably imagine, thousands of possible conﬁguration com-
mands exist for changing the router’s operations. M any changes can be made at
this level.Although this is by no means a comprehensive list, some of these
changes include interface addressing, routing protocol conﬁguration, password
changes, and system-level conﬁguration changes.All these conﬁguration changes
must be made through conﬁguration mode.To enter into conﬁguration mode,
use the conﬁgure command at privilege level.W hen you enter the conﬁgure
command, it will prompt you as to how you wish to conﬁgure the router, either
by terminal, memory, or network. In this particular instance, select terminal to con-
ﬁgure it from your terminal connection. M emory and network conﬁguration
changes are made if you wish to use the conﬁguration stored either in the
router’s non-volatile R AM  (N VR AM ) or if you wish to conﬁgure from a net-
work server.To exit the conﬁguration level of the router, enter Ctrl+Z to exit
completely or exit to exit the current layer (when at the top layer, the exit com-
mand also takes you out of conﬁguration mode).T he following code example
demonstrates the conﬁgure command:
www.syngress.com

12
Chapter 1 • Introduction to the Cisco IOS
6Router-1#conﬁgure
Conﬁguring from terminal, memory, or network [terminal]? terminal
Enter conﬁguration commands, one per line.  End with CTRL/Z.
6Router-1(conﬁg)#^Z
6Router-1#
N otice in the preceding example that when entering into conﬁguration
mode the (conﬁg) prompt is present next to the router name.T his is always a way
to tell that you are in conﬁguration mode.T his will change as you move into the
different layers of conﬁguration, such as interface conﬁguration. In conﬁguration
mode you can see all the possible conﬁguration commands by again entering a
question mark. For reasons of brevity, we will shorten this list considerably (more
than one hundred possible commands exist for the following output):
6Router-1(conﬁg)#?
Conﬁgure commands:
aaa
Authentication, Authorization, and Accounting.
boot
Modify system boot parameters
clock
Conﬁgure time-of-day clock
conﬁg-register
Deﬁne the conﬁguration register
default
Set a command to its defaults
do
To run exec commands in conﬁg mode
downward-compatible-conﬁg
Generate a conﬁguration compatible with 
older software
enable
Modify enable password parameters
hostname
Set system's network name
ip
Global IP conﬁguration subcommands
logging
Modify message-logging facilities
multilink
PPP multilink global conﬁguration
netbios
NETBIOS access control ﬁltering
no
Negate a command or set its defaults
parser
Conﬁgure parser
regexp
regexp commands
rif
Source-route RIF cache
service
Modify use of network-based services
username
Establish User Name Authentication
virtual-proﬁle             
access-list
Add an access list entry
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
13
alias
Create command alias
alps
Conﬁgure Airline Protocol Support
arp
Set a static ARP entry
. . .
6Router-1(conﬁg)#
O nce again you can see the speciﬁc parameters for a conﬁguration command
by entering it followed by a question mark. In this case, see what possible conﬁg-
uration parameters you can make with the ipv6 command:
6Router-1(conﬁg)#ipv6 ?
access-list
Conﬁgure access lists
hop-limit
Conﬁgure hop count limit
host
Conﬁgure static hostnames
icmp
Conﬁgure ICMP parameters
neighbor
Neighbor
preﬁx-list
Build a preﬁx list
route
Conﬁgure static routes
router
Enable an IPV6 routing process
unicast-routing
Enable unicast routing
6Router-1(conﬁg)#ipv6
It would be nearly impossible to discuss in any degree of detail all of these
conﬁguration commands. In fact, many of them do not apply in many situations.
T he next sections will discuss some of the more general conﬁguration commands.
U sing Passwords to C ontrol R outer Access
Passwords are used on a C isco router just like they are used on any computer: to
control access. C isco routers use ﬁve different passwords to control access to the
router: console, auxillary, V T Y , enable, and enable secret.
U sing the console Password
U se the console password to control physical access to the console port of a router.
W hen utilizing a console password, a user will automatically be prompted for 
the console password to access the router even before entering user mode.T his
provides for security of the console port in case an unauthorized user tries to
www.syngress.com

14
Chapter 1 • Introduction to the Cisco IOS
physically connect to the router console port.To assign or change the console
password, you must ﬁrst specify that interface when working in conﬁguration
mode.T his is accomplished by entering the line console 0 command in conﬁg-
uration mode.After entering into the line conﬁguration mode, you will see that
the prompt changed from just (conﬁg) to (conﬁg-line).To change this password, you
can simply enter the password command followed by the password that you
wish to use:
6Router-1(conﬁg)#line console 0
6Router-1(conﬁg-line)#password cisco
6Router-1(conﬁg-line)#exit
6Router-1(conﬁg)
U sing the auxiliary (aux) Password
As we discussed earlier, the auxiliary password is a secondary port for access to the
router. M ost commonly it is used to attach a modem for remote access to the
router in the case of network failure. It can also be used for dial backup in the
case of primary network link failure.T his port does present a security problem if
not secured and, as such, should also be protected with a password.T he conﬁgu-
ration for this password is nearly identical to that of the conﬁguration for a con-
sole password, except here you specify the aux 0 port:
6Router-1(conﬁg)#line aux 0
6Router-1(conﬁg-line)#password cisco
6Router-1(conﬁg-line)#exit
6Router-1(conﬁg)
U sing the V T Y  Password
As we discussed before,VT Y  ports are virtual interfaces into the router for Telnet
access. In general, routers have ﬁve virtual terminal interfaces (0-4). Since there
are multiple interfaces, they can be grouped when making conﬁguration changes.
Because it is impossible to know which VT Y  port will answer the Telnet session
and because VT Y  ports allow for remote access to the router, all need to be
secured. It is highly recommended that appropriate password protection be
implemented on these ports. C onﬁguration for a password on these ports is also
very similar to that of the console and aux passwords:
6Router-1(conﬁg)#line vty ?
<0-4>  First Line number
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
15
6Router-1(conﬁg)#line vty 0?
<0-4>  
6Router-1(conﬁg)#line vty 0 ?
<1-4>  Last Line number
<cr>
6Router-1(conﬁg)#line vty 0 4
6Router-1(conﬁg-line)#password cisco
6Router-1(conﬁg-line)#exit
U sing the enable and enable secret Passwords
U se the enable and enable secret passwords to gain access to the privileged mode of
the router— the conﬁguration mode that you can make all your changes in. O ut
of the box, privileged mode can be entered by just using the enable command.
U nsecured, this is a very large security risk.To change this, use the enable pass-
word command in conﬁguration mode.T he enable secret password is an extension
of the enable password.T he enable secret command overrides the enable password,
making itself the enable password.Also, the enable password, unless manually
encrypted, is a clear-text password, whereas the enable secret password is an
encrypted password.T he following code examples demonstrate conﬁguration of
both the enable and enable secret passwords:
6Router-1(conﬁg)# enable password cisco
6Router-1(conﬁg)# enable secret cisco
Performing Interface C onﬁguration Tasks
Interface conﬁguration is also one of the more fundamental tasks of router con-
ﬁguration. Interface conﬁguration concerns itself with the actual physical,
Ethernet, serial,Asynchronous Transfer M ode (AT M ), and so on, as well as logical
interfaces such as loopback addresses on the routers.As such it is also one of the
most important types of conﬁguration because it speciﬁes how the router will
connect to the rest of the network. C onﬁguration tasks that take place on this
level include logical addressing, line speed, duplex settings, framing, and so on.To
enter into interface conﬁguration, enter the interface command from conﬁgura-
tion mode, followed by the interface type and number of the particular interface.
www.syngress.com

16
Chapter 1 • Introduction to the Cisco IOS
As usual, you can follow the command with a question mark to see the available
options:
6Router-1(conﬁg)#interface ?
Async
Async interface
BVI
Bridge-Group Virtual Interface
CTunnel
CTunnel interface
Dialer
Dialer interface
Ethernet
IEEE 802.3
Group-Async
Async Group interface
Lex
Lex interface
Loopback
Loopback interface
MFR
Multilink Frame Relay bundle interface
Multilink
Multilink-group interface
Null
Null interface
Serial
Serial
Tunnel
Tunnel interface
Vif
PGM Multicast Host interface
Virtual-Template
Virtual Template interface
Virtual-TokenRing
Virtual TokenRing
range
interface range command
6Router-1(conﬁg)#interface
For purposes of this discussion, select the Ethernet 0 interface by selecting
Ethernet from the preceding list and selecting the 0 port. R emember, many
routers have more than one type of speciﬁc port, so it is important to specify the
port that you intend to work with:
6Router-1(conﬁg)#interface ethernet ?
<0-0>  Ethernet interface number
6Router-1(conﬁg)#interface ethernet 0
6Router-1(conﬁg-if)#
As you can see from the preceding example, when you enter into interface
conﬁguration mode, your prompt changes from (conﬁg) to (conﬁg-if) for interface
conﬁguration.Again, you can enter a question mark to ﬁnd out the conﬁguration
options for this interface:
6Router-1(conﬁg-if)#?
Interface conﬁguration commands:
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
17
access-expression
Build a bridge boolean access expression
arp
Set arp type (arpa, probe, snap) or timeout
backup
Modify backup parameters
bandwidth
Set bandwidth informational parameter
bridge-group
Transparent bridging interface parameters
carrier-delay
Specify delay for interface transitions
cdp
CDP interface subcommands
cmns
OSI CMNS
custom-queue-list
Assign a custom queue list to an interface
default
Set a command to its defaults
delay
Specify interface throughput delay
description
Interface speciﬁc description
dlsw
DLSw interface subcommands
dspu
Down Stream PU
duplex
Conﬁgure duplex operation
exit
Exit from interface conﬁguration mode
fair-queue
Enable Fair Queuing on an Interface
fras
DLC Switch Interface Command
help
Description of the interactive help system
hold-queue
Set hold queue depth
ip
Interface Internet Protocol conﬁg commands
ipv6
IPv6 interface subcommands
keepalive
Enable keepalive
lan-name
LAN Name command
llc2
LLC2 Interface Subcommands
load-interval
Specify interval for load calculation for an
interface
locaddr-priority
Assign a priority group
logging
Conﬁgure logging for interface
loopback
Conﬁgure internal loopback on an interface
mac-address
Manually set interface MAC address
max-reserved-bandwidth
Maximum Reservable Bandwidth on an Interface
media-type
Interface media type
mtu
Set the interface Maximum Transmission Unit (MTU)
multilink-group
Put interface in a multilink bundle
netbios
Use a deﬁned NETBIOS access list or enable
name-caching
www.syngress.com

18
Chapter 1 • Introduction to the Cisco IOS
no
Negate a command or set its defaults
ntp
Conﬁgure NTP
pppoe
pppoe interface subcommands
pppoe-client
pppoe client
priority-group
Assign a priority group to an interface
random-detect
Enable Weighted Random Early Detection (WRED) on 
an Interface
rate-limit
Rate Limit
rmon
Conﬁgure Remote Monitoring on an interface
sap-priority
Assign a priority group
service-policy
Conﬁgure QoS Service Policy
shutdown
Shutdown the selected interface
sna
SNA pu conﬁguration
snapshot
Conﬁgure snapshot support on the interface
snmp
Modify SNMP interface parameters
standby
HSRP interface conﬁguration commands
timeout
Deﬁne timeout values for this interface
trafﬁc-shape
Enable Trafﬁc Shaping on an Interface or
Sub-Interface
transmit-interface
Assign a transmit interface to a receive-only
interface
tx-ring-limit
Conﬁgure PA level transmit ring limit
6Router-1(conﬁg-if)#
We could go on forever with each of the different interface conﬁguration
options, and that is just for this particular interface. C onﬁguration commands are
at the very heart of working with routers and at the very heart of this book.We
will leave our discussion of conﬁguration options with this piece of advice:
R emember the question mark! It will be your best friend in knowing the appropriate
conﬁguration changes and commands on routers.
Using show Commands
Show commands serve as invaluable tools for diagnosing your routers and net-
work conditions.As with conﬁguration commands, literally hundreds of potential
show commands exist, ranging from the very general, such as showing the overall
conﬁguration on a router, to the very speciﬁc, such as showing the collisions on
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
19
an Ethernet interface, and everything in between. O nce again, you can use the
question mark to learn the available show commands at your disposal.T he fol-
lowing listing is the command output of a show ? command.As before, the
output was shortened for purposes of brevity. M ore than 100 possible show
commands exist.
6Router-1#show ?
aaa
Show AAA values
access-expression
List access expression
access-lists
List access lists
accounting
Accounting data for active sessions
adjacency
Adjacent nodes
aliases
Display alias commands
alps
Alps information
arp
ARP table
async
Information on terminal lines used as router interfaces
backup
Backup status
bgp
BGP information
bridge
Bridge Forwarding/Filtering Database [verbose]
bsc
BSC interface information
bstun
BSTUN interface information
buffers
Buffer pool statistics
caller
Display information about dialup connections
cca
CCA information
cdapi
CDAPI information
cdp
CDP information
cef
Cisco Express Forwarding
class-map
Show QoS Class Map
clock
Display the system clock
cls
DLC user information
cns
CNS subsystem
compress
Show compression statistics
conﬁguration
Contents of Non-Volatile memory
connection
Show Connection
controllers
Interface controller status
cops
COPS information
debugging
State of each debugging option
derived-conﬁg
Derived operating conﬁguration
www.syngress.com

20
Chapter 1 • Introduction to the Cisco IOS
dhcp
Dynamic Host Conﬁguration Protocol status
dialer
Dialer parameters and statistics
dlsw
Data Link Switching information
dnsix
Shows Dnsix/DMDP information
drip
DRiP DB
dspu
Display DSPU information
dxi
atm-dxi information
entry
Queued terminal entries
exception
exception informations
ﬁle
Show ﬁlesystem information
ﬂash:
display information about ﬂash: ﬁle system
ﬂh-log
Flash Load Helper log buffer
frame-relay
Frame-Relay information
fras
FRAS Information
fras-host
FRAS Host Information
funi
FUNI information
history
Display the session command history
hosts
IP domain-name, lookup style, nameservers, and host 
. . . 
6Router-1#show
As you can see, quite a few potential show commands are available to you.
R emember that each one of these commands has speciﬁc parameters that you
can specify.You can learn what each of these is by issuing the command followed
by a question mark.Take a look at the parameters available for show interface:
6Router-1#show interface ?
Async
Async interface
BVI
Bridge-Group Virtual Interface
CTunnel
CTunnel interface
Dialer
Dialer interface
Ethernet
IEEE 802.3
Loopback
Loopback interface
MFR
Multilink Frame Relay bundle interface
Multilink
Multilink-group interface
Null
Null interface
Serial
Serial
Tunnel
Tunnel interface
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
21
Vif
PGM Multicast Host interface
Virtual-Template
Virtual Template interface
Virtual-TokenRing
Virtual TokenRing
accounting
Show interface accounting
crb
Show interface routing/bridging info
irb
Show interface routing/bridging info
mac-accounting
Show interface MAC accounting info
precedence
Show interface precedence accounting info
rate-limit
Show interface rate-limit info
summary
Show interface summary
|
Output modiﬁers
<cr>    
Lex
Lex interface
6Router-1#show interface
Although hundreds of potential show commands are available on a router, you
will ﬁnd a few universally useful in understanding and diagnosing your system
conﬁguration and operation, including show version, show running-conﬁguration, and
show interface, which we will discuss further.
U sing the show version C ommand
T he show version command is a very useful command that enables an adminis-
trator to discern the following system conditions and parameters:
■
System Platform
■
System IO S version
■
System Boot R om Version
■
System U ptime
■
R eason for the last reboot
■
System Image File
■
Processor and M emory available
■
Physical Interfaces
■
C onﬁguration R egister
www.syngress.com

22
Chapter 1 • Introduction to the Cisco IOS
T his is a truly useful command in fully understanding the general informa-
tion about your system.T his information is also useful in understanding malfunc-
tioning system states such as reboots and gives a good overall picture as to the
operation of your router.T he following code example demonstrates this com-
mand for a C isco 2500 router running IO S version 12.2(8)T :
6Router-1#show version
Cisco Internetwork Operating System Software 
IOS (tm) 2500 Software (C2500-IS-L), Version 12.2(8)T,  RELEASE SOFTWARE
(fc2)
TAC Support: http://www.cisco.com/tac
Copyright (c) 1986-2002 by cisco Systems, Inc.
Compiled Wed 13-Feb-02 21:11 by ccai
Image text-base: 0x0306DA78, data-base: 0x00001000
ROM: System Bootstrap, Version 5.2(8a), RELEASE SOFTWARE
BOOTLDR: 3000 Bootstrap Software (IGS-RXBOOT), Version 10.2(8a), RELEASE
SOFTWA)
6Router-1 uptime is 1 week, 5 days, 21 hours, 39 minutes
System returned to ROM by reload
System image ﬁle is "ﬂash:c2500-is-l.122-8.T.bin"
cisco 2500 (68030) processor (revision N) with 14336K/2048K bytes of
memory.
Processor board ID 05606049, with hardware revision 00000000
Bridging software.
X.25 software, Version 3.0.0.
1 Ethernet/IEEE 802.3 interface(s)
2 Serial network interface(s)
32K bytes of non-volatile conﬁguration memory.
16384K bytes of processor board System ﬂash (Read ONLY)
Conﬁguration register is 0x2102
6Router-1#
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
23
U sing the show running-conﬁguration C ommand
T he show running-conﬁguration command is also a very useful tool in getting an
overall picture of your router.W hereas the show version command discussed the
actual system parameters, the show running-conﬁguration command shows the actual
system conﬁgurations that have been made on the router to process trafﬁc.You
will obtain the following information from issuing this command:
■
IO S version
■
Service Information
■
H ostname
■
Enable password (if not encrypted)
■
IP and IPV6 static routes
■
Access List information
■
H ost ﬁle entries
■
Interface addressing information
■
Dynamic R outing Processes
■
C onsole,Aux, and VT Y  parameters
T he following is an example of this command output. Keep in mind that this
will vary greatly from system to system depending on the conﬁguration.As with
a few of the previous command outputs, we have signiﬁcantly abbreviated this; it
can literally be four to ﬁve pages and even more in certain instances.
6Router-1#show running-conﬁguration
Building conﬁguration…
Current conﬁguration : 2718 bytes
!
version 12.2
service timestamps debug uptime
service timestamps log uptime
service password-encryption
service tcp-small-servers
!
hostname 6Router-1
www.syngress.com

24
Chapter 1 • Introduction to the Cisco IOS
!
enable secret 5 $1$kW9A$aKyzOAaklR/ReD6YKiyQa/
!
clock timezone EST -5
clock summer-time EST recurring
ip subnet-zero
ip tcp synwait-time 5
no ip domain-lookup
ip host 6ROUTER-2 2001 192.168.123.50
ip host 2501-2 2001 192.168.123.50
!
ipv6 unicast-routing
interface Ethernet0
ip address 192.168.123.50 255.255.255.0
no ip route-cache
no ip mroute-cache
ipv6 address 3FFE:4200:1:1::1/64
ipv6 address 2000:1:2::1/64
ipv6 rip cisco enable
!         
interface Serial0
ip address 172.16.4.1 255.255.255.0
no ip route-cache
no ip mroute-cache
ipv6 address 2000:1:1::1/64
ipv6 rip cisco enable
!
!
router rip
redistribute ospf 1 metric 3
passive-interface Serial0
network 172.16.0.0
!
!
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
25
address-family ipv6
neighbor cisco activate
neighbor 2000:1:1::2 peer-group cisco
network 2000:1:1::/64
network 2000:1:2::/64
no synchronization
exit-address-family
!
!
line con 0
line aux 0
exec-timeout 0 0
transport input all
line vty 0 4
exec-timeout 90 0
password 7 060A1A2255
login local
!
end
6Router-1#
U sing the show interface C ommand
T he show interface command gives the physical and logical information for each
physical and logical interface on the router.You can also use this command to
specify a speciﬁc interface or type of interface by following it with the interface
type, such as show interface ethernet 0. Information gathered from this show com-
mand includes the following:
■
Physical up/ down status
■
Line Protocol up/ down status
■
IP or logical addressing information
■
M T U  information
www.syngress.com

26
Chapter 1 • Introduction to the Cisco IOS
■
Encapsulation
■
Q ueuing
■
C ollisions
■
C R C  errors
■
Dropped packets
T his show command is very useful in diagnosing problems associated with
speciﬁc interfaces and is a powerful tool for your system’s overall health.T he fol-
lowing example is of the show ethernet 0 command output:
6Router-1#show interface ethernet 0
Ethernet0 is up, line protocol is up 
Hardware is Lance, address is 00e0.b05a.d998 (bia 00e0.b05a.d998)
Internet address is 192.168.123.50/24
MTU 1500 bytes, BW 10000 Kbit, DLY 1000 usec, 
reliability 255/255, txload 1/255, rxload 1/255
Encapsulation ARPA, loopback not set
Keepalive set (10 sec)
ARP type: ARPA, ARP Timeout 04:00:00
Last input 00:00:00, output 00:00:00, output hang never
Last clearing of "show interface" counters never
Input queue: 0/75/0/0 (size/max/drops/ﬂushes); Total output drops: 0
Queueing strategy: ﬁfo
Output queue :0/40 (size/max)
5 minute input rate 0 bits/sec, 0 packets/sec
5 minute output rate 0 bits/sec, 0 packets/sec
93866 packets input, 13802455 bytes, 0 no buffer
Received 47471 broadcasts, 0 runts, 0 giants, 0 throttles
0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
0 input packets with dribble condition detected
234089 packets output, 24304032 bytes, 0 underruns
0 output errors, 2 collisions, 31 interface resets
0 babbles, 0 late collision, 19 deferred
0 lost carrier, 0 no carrier
0 output buffer failures, 0 output buffers swapped out
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
27
Increasing Efﬁciency by Using Shortcuts
T hroughout this chapter we have purposefully completely written out the entire
string when entering a speciﬁc command to ensure that you understood the
entire command syntax. N ow that you do, we’ll discuss how to save you a con-
siderable amount of time and energy by using shortcuts.A shortcut is a very useful
feature built into the C isco IO S that enables you to enter only a partial com-
mand at the command prompt, just enough for the IO S to recognize it. For
example, you can enter copy run-star, which the router will recognize to mean
“copy running-conﬁguration startup-conﬁguration.” Isn’t the former much
easier? Look at a brief example, in which you will use shortcuts rather than entire
commands to conﬁgure the router. In this example, you will enter the router via
the console and conﬁgure an IP address for the Ethernet 0 interface.You will
then copy the running conﬁguration to the startup conﬁguration:
6Router-1>en
6Router-1#conf t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#int e0
6Router-1(conﬁg-if)#ip add 10.1.1.1
6Router-1(conﬁg-if)#ex
6Router-1(conﬁg)#^Z
6Router-1(conﬁg)# copy run star
In the preceding example you connected to the router and entered privileged
exec mode by entering en instead of typing enable, then entered conﬁguration
mode by entering conﬁg t, which the router recognized as conﬁgure terminal.
After that, you entered interface conﬁguration mode by typing int e0, which the
router recognized as interface Ethernet 0; then you conﬁgured an IP address by
using the IP add command.You then exited interface conﬁguration mode by
typing ex for exit and copied the running conﬁg to startup conﬁg by typing
copy run star for the command copy running-conﬁg startup-conﬁg.
You probably can understand the syntax from looking at the example, how-
ever the rule for shortcuts is that you can reduce a command as far as possible to
keep it unique from other commands. For example, you could not reduce disable
to DI, because disconnect also starts with DI, so you would need to use DISA,
and conversely, disconnect would need to be DISC. If you do not enter enough
information to make the command unique, you will be met with an error stating
www.syngress.com

28
Chapter 1 • Introduction to the Cisco IOS
%  A mbiguous command:.T his indicates that you need to provide more information
to the router.
Another very useful feature inherent in the C isco IO S is the auto-complete fea-
ture.T his feature automatically completes the entering of a command for you
when you simply press the Tab key. O nce again, the same rules apply as for
shortcuts: you must enter enough information for the command to be unique or
it will not work.T he following code example demonstrates this feature. In this
example you are trying to enter the conﬁgure terminal command.You start by
trying to enter con, but this does not work because both the conﬁgure and connect
commands start with “con,” so you have to enter enough information to make it
unique by entering conf.You follow this by t and hit the Tab key to get the ter-
minal word to appear:
6Router-1#con
6Router-1#conf
6Router-1#conﬁgure t
6Router-1#conﬁgure terminal
A set of shortcuts is also available with speciﬁc keystrokes. H ere is a list of
some of them and their associated actions:
■
CTRL+A M ove to the beginning of a line
■
CTRL+E M ove to the end of a line
■
CTRL+R R edisplay a line
■
CTRL+U Erase a line
■
CTRL+W Erase a Word
■
CTRL+Z Exit C onﬁguration M ode
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
29
Summary
All C isco routers share two commonalities.T hey share the same common oper-
ating system platform, the C isco Internetwork O perating System (IO S).T his
common operating system allows for simpliﬁcation and generalization of admin-
istration, affording administrators ease of use.
T he majority of routers also have two physical interfaces: a console port and
an auxiliary port.T he console port is a crucial part of the router because it is
used for initial conﬁguration of the router.To use this port for conﬁguration, a
rolled R J-45 cable as well as a 9– or 25-pin serial adapter is needed.After you
have concluded initial conﬁguration, you can administer the router remotely via
Telnet connection and via the Simple N etwork M anagement Protocol (SN M P).
C isco routers can use SN M P to interoperate with common network manage-
ment systems such as C iscoWorks, H P O penView, and SM AR T S.
A C isco router has two basic levels of access: user mode and privileged mode.
U ser mode offers a limited command set to diagnose simple problems and verify
operation. Privileged mode offers the capability to make conﬁguration changes
and to diagnose complex problems and situations.Although literally hundreds of
potential commands are available on a C isco router, commands generally fall into
two types: conﬁguration commands and show commands. C onﬁguration commands
are those that change the operation of the router; for example, routing protocols,
interface conﬁgurations, and passwords.You can access these commands in the
conﬁguration mode by using the conﬁgure terminal command.Administrators use
show commands to display network or router conditions; these function solely as a
reporting function, a majority of which must be executed from privileged mode.
Administrators also have the capability to take advantage of shortcuts in the
C isco IO S. Shortcuts enable an administrator to enter the beginning of a com-
mand and the system will recognize the rest. An important rule governing this
procedure is that you must provide enough information for the command entry
to be unique. Another feature built into the IO S is the capability to auto-com-
plete a command by pressing the Tab key.T he same rule about shortcuts applies
here: you must provide enough information to make the command unique. C isco
also has several shortcut keystrokes built into the system to make entering com-
mands quicker.
www.syngress.com

30
Chapter 1 • Introduction to the Cisco IOS
Solutions Fast Track
C onnecting to the R outer
 T he initial connection to the router must be made through the console
connector on the router.T his is accomplished by use of a rolled-R J45
cable and a 9– or 25-pin serial connector.
 After you have applied Internet Protocol (IP) or other logical addresses,
you can access a router by Telnet sessions for conﬁguration.
 R outers can also use Simple N etwork M anagement Protocol (SN M P)
settings to integrate with network management systems (N M S)
platforms.
Entering C ommands to C onﬁgure a C isco R outer
 T he router has two levels of access: user mode and privileged mode. U ser
mode is a very restricted level of access and allows for only basic
functions, whereas privileged mode allows for full conﬁguration and
diagnosing capabilities.
 Two basic types of commands are available: conﬁguration commands and
show commands.You use conﬁguration commands to change the
operation of the router and its processes; you use show commands to
understand and diagnose the system conﬁguration and operation.
 Enter a question mark (?) at the command prompt after a particular
command to see all the available commands and their conﬁguration
parameters.
Increasing Efﬁciency by U sing Shortcuts
 C ommands can be abbreviated by entering only the ﬁrst few letters of
the command— you must enter enough characters for the IO S to be
able to recognize it.
 W hen you press the Tab key after entering the beginning of a
command, the C isco IO S’s auto-complete feature automatically ﬁlls in
www.syngress.com

Introduction to the Cisco IOS • Chapter 1
31
the rest of the command.T he same rule applies as for shortcuts: you
must enter enough information to make the command unique.
 Several keystroke shortcuts are also available throughout the IO S.
Q: I am trying to connect to the console port of my router with no luck. I have
the 9-pin connector on my computer and an R J-45 cable; what should I do?
A: To communicate with the console port on your router, you must use a rolled
R J-45 cable— not a standard R J-45 cable.T he difference is that pins 5, 2, 4,
and 1 are swapped on opposite ends of the cable. U se this cable and you
should have no problem.
Q: I have replaced the cable with a rolled R J-45 cable, but I still cannot access
the router. I am using H yperTerminal on my W indows 2000 computer with
the standard settings.
A: To make H yperTerminal work with your router, you need to make your line
speed 9600, use 8 data bits, 1 stop bit, and turn off ﬂow control.T his should
enable you to talk to your router.
Q: W hat is the difference between the show version command and the show run-
ning-conﬁguration command?
A: T he show version command deals speciﬁcally with the information regarding
the operation of the router as system such as processor, memory, and software
revision.T he show running conﬁguration command displays information
regarding the actual routing conﬁguration on the router.T his will display
information such as routing protocol information, static routing, passwords,
and interface addressing parameters.
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

32
Chapter 1 • Introduction to the Cisco IOS
Q: I am trying to enter a shortcut for the disable command using “dis”, but it
doesn’t seem to work. It also is not working when I press the Tab key.W hat
is the problem?
A: W hen using shortcuts you must remember the fundamental rule of keeping
the command unique.T here are other commands that also begin with “dis-”,
so you must extend your shortcut further to allow for this.
www.syngress.com

Introduction to IPv6
Architecture 
Solutions in this chapter:
■
Understanding the Beneﬁts of IPv6
■
Comparing IPv6 to IPv4
■
Examining IPv6 Network Architecture
■
Upper-Layer Protocol Issues
■
Understanding ICMPv6
■
Understanding Neighbor Discovery
Chapter 2
33
 Summary
 Solutions Fast Track
 Frequently Asked Questions

34
Chapter 2 • Introduction to IPv6 Architecture
Introduction
Version 6 of the Internet Protocol (IPv6) has ﬁnally arrived in practical form!
Although the protocol has been worked on for close to ten years now, ofﬁcial
speciﬁcations and standards have only recently been ﬁnalized, and there are still
some aspects of the protocol that are being worked on by the Internet
Engineering Task Force (IET F) working groups.T he issues that made version 4
of the Internet Protocol (IPv4) inadequate required complex solutions.T his has
forced designers of the new protocol to work diligently to ensure that the same
issues would not be encountered with the new version of the protocol. M embers
of the Internet community who were responsible for developing the protocol
carefully scrutinized each new R equest for C omments (R FC ) that was devel-
oped. For those not familiar with the R FC  process, R FC s are documents that
detail the protocol speciﬁcations so that hardware and software manufacturers will
know how to implement the protocol in a standard and agreed-upon manner.
Standardization enables each manufacturer and software vendor to follow the
same blueprint rather than developing proprietary versions of the protocol. (T his
was a common problem with earlier networking protocols.) 
T he realization of a new, scalable protocol in which considerable thought has
been given to future expansion is a very exciting concept. N ever before has the
Internet community seen such a magnitude of effort or planning put into the
development of a new protocol, and there has certainly never been a protocol
more speciﬁcally tailored to the growth of the Internet.T he purpose of this book
is to help ensure a smooth implementation of the new protocol by focusing on
the conﬁguration of IP version 6 on the C isco IO S, the most common platform
that will utilize the new protocol.
Understanding the Beneﬁts of IPv6
Let’s discuss some of the beneﬁts of IPv6 in more detail in order to see how this
protocol attempts to deal with the Internet and business network problems of
today. Some of the main reasons for the development of the new version of the
Internet Protocol were the exhaustion of the C lass B address space, the growth of
the backbone routing table, security issues, IP options size limitation, and routing
performance.We’ll look at the two main problems solved by IPv6— namely
address depletion and routing scalability— in more detail, and then look at some
of the added beneﬁts that IPv6 gives to network designers and administrators.
T he beneﬁts of IPv6 include:
www.syngress.com

www.syngress.com
■
Increased IP Address Size
■
Increased Addressing H ierarchy Support
■
Simpliﬁed H ost Addressing (uniﬁed addressing: global, site, local)
■
Simpliﬁed Autoconﬁguration of Addresses (easier readdressing, DH C Pv6,
N eighbor Discovery instead of AR P broadcasts)
■
Improved Scalability of M ulticast R outing 
■
T he A nycast Address
■
Streamlined H eader
■
Improved Security (security extension headers, integrated data integrity)
■
Better M obility (home agent, care-of address, routing extension header)
■
Better Performance (aggregation, N eighbor Discovery instead of AR P
broadcasts, no fragmentation, no header checksum, ﬂow, priority, inte-
grated Q oS)
Increased IP Address Size 
IPv6 has 128 bits available for addressing. Let’s examine this brieﬂy in order to
appreciate the vastness of this degree of address space. 128 bits of address space
means that there are 2128 different addresses available.T he ﬁrst three bits of 001 are
reserved for Globally R outable U nicast addresses.T his means that we have 125
bits left to use for addresses (128–3=125), so we have 2125 addresses available
before Globally R outable U nicast address space is depleted.T his is roughly 4.25
E+037 addresses.To put this into perspective, let’s compare this to IPv4. In IPv4,
we use all address space between 0.0.0.0 and 223.255.255.255 for unicast routing,
which is approximately 3.7 E+09 addresses (we will not take into account the
addresses delegated as non-routable reserved addresses as deﬁned by R FC
1918).T his means that IPv6 has room for 1028 more addresses than IPv4! 
C learly, 128 bits provides enough address space to take current Internet trends
well into the future. In fact, it may seem like an inexhaustible amount of address
space, but we will see when we get into the details of LAN  and WAN  conﬁgura-
tion that this is not quite the case. Still, it is a much larger address space than
IPv4. O ne thing to think of in order to appreciate IPv6 is the number of networks
that IPv6 can support.An IPv6 address uses the last 64 bits to describe the host
ID for a system on a network. In addition, IPv6 actually uses the last 64 bits of
the address to distinguish hosts from one another on the same subnet.W hether
Introduction to IPv6 Architecture • Chapter 2
35

36
Chapter 2 • Introduction to IPv6 Architecture
using the link-local, site-local, or Globally R outable U nicast address format, the
last 64 bits on a machine will remain the same.T his is because IPv6 uses the
Layer 2 M edia Access C ontrol (M AC ) address as the host ID for a machine (the
Layer 2 M AC  address is the address that is burned into all Layer 2 hardware, such
as Ethernet cards and other N etwork Interface C ards). Since M AC  addresses are
only 48 bits long, each one is padded with a 16-bit preﬁx, which will be discussed
in more detail below.T his limits the number of addresses that can be used because
there will rarely be 264 addresses in use on a typical Ethernet LAN . Some address
space deﬁnitely gets wasted. H owever, if you remove the 64 bits used for host ID
and the ﬁrst three bits used to designate Globally R outable U nicast addresses, you
get 261 possible addresses (2.31E+018). So even without using all of the addresses
that IPv6 has available, we have the scaling ability to take us well beyond the
future of IPv4. C learly, IPv6 frees up our ability to use addressing efﬁciently
without having to worry about running out of addresses. Please keep in mind that
I do not mean to say that address space should be used in a carefree manner; that
is how IPv4 came into its current predicament.
Table 2.1 presents a rough comparison of the address sizes of IPv4 and IPv6.
Table 2.1 Address Space Comparison
Speciﬁcation 
IPv4
IPv6
Address Length
32 bits
128 bits
Host Identiﬁer Length
2 - 24 bits
64 bits
Network Identiﬁer Length
7 - 30 bits
61 bits
Maximum Number of Hosts per Subnet
22 – 224
264
Maximum Number of Subnets
27 – 230
261
Maximum Number of Hosts
3.7 E+09
4.25 E+037
Increased Addressing Hierarchy Support
As we learned earlier in the chapter, IPv6 addressing has restructured the means
by which address blocks are delegated. IPv4 ﬁrst used the classful IP assignment
rules, then began to assign based on the principles of C lassless Inter-Domain
R outing (C IDR ). IPv6 corrects the de-aggregation problems associated with
each of these by splitting the IPv6 address into a set of deﬁnite scopes, or bound-
aries, by which IPv6 addresses are delegated.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
37
T he Format Preﬁx is used to show that an address is Globally R outable
U nicast, or another type of address, and is always set to the same value.T his
allows a routing system to quickly discern whether or not a packet is Globally
R outable U nicast or some other type. By obtaining this information quickly, the
routing device can more efﬁciently pass the packet off to routing subsystems for
proper handling.
T he Top Level Aggregator (T LA) ID is used for two purposes. First, it is used
to designate a large block of addresses from which smaller blocks of addresses are
carved in order to give downstream connectivity to those who need access to the
Internet. Second, it is used to distinguish where a route has come from. If large
blocks of address space are given only to Internet service providers, and then in
turn delegated to customers, it becomes easier to see which transit network a
route has traversed, or from which transit network the route ﬁrst originated.W ith
IPv4 many addresses were portable, and the numbers authorities were delegating
blocks down to small businesses, so it became impossible to know where a route
came from without tracing back towards the source of the packet. N ow, with
IPv6, determining the source of a route is more feasible. Imagine an Internet
consisting of 500 T ier 1 providers. If this were the case (and it is most likely not
too far off from today, though what makes a provider a T ier 1 provider is very
ambiguous), then at the very least a quick search through a text ﬁle could tell
you where a route originated, based on the T LA ID of the longest match route.
It’s even possible to obtain software that has this functionality built into it (if the
software is properly written to keep a dynamic list as new delegations are
assigned).
Let us look at the size of the T LA in more detail.We discussed in prior sec-
tions how the address space would be given only to providers and those who
needed their own IPv6 space. (T he term needed is used cautiously here, as it is
ambiguous as well— there are currently no set boundaries or requirements with
respect to what need means in this context.) T his way, we are able to sufﬁciently
aggregate preﬁxes into big blocks at the Internet core, thereby passing fewer
routes between routing domains, as well as internally, which will increase the efﬁ-
ciency of the Internet core.
For fun, let us assume that we have the IPv6 address delegation 3D00::
B234::/ 24. Let us further assume that all of our customers have sufﬁcient need
for a / 48 delegation for their networks.T his leaves us with 24 bits of addressing
to delegate out— that’s a lot of address space! In fact, the number of networks we
can support with this scheme is equivalent to the number of hosts we could sup-
port with a C lass A IPv4 address block! You can see that there will be much more
www.syngress.com

38
Chapter 2 • Introduction to IPv6 Architecture
pressure put on T ier 1 service providers to efﬁciently track the delegation of
address space that they make. C urrently, a T ier 1 service provider gets addresses in
blocks of perhaps / 16 or less. If we assume that a service provider today only del-
egates addresses up to / 24, that leaves only 256 delegations (eight bits) that the
service provider can make prior to applying for more address space. M ost T ier 1
service providers today are required to subnet delegations down to at least / 28 in
order to qualify for more address space, so this example may not be entirely real-
istic, but we can still grasp the size of a T LA, which is monumental compared to
the size of the assignments that are given today.
NOTE
This amount of address space can present tremendous support infras-
tructure problems. Service providers that today provide DNS service for
their downstream customers will have to think long and hard about the
best way to implement these support structures before getting into the
IPv6 market.
As we can see from the previous example,T ier 1 service providers will have
extremely large address spaces to deal with.T his will not only eliminate most of
the politics surrounding address delegation and obtaining more address blocks,
but will also provide motivation for major support and automation of infrastruc-
ture upgrades within an organization. M any service providers today have difﬁ-
culty upgrading support structure due to the engrained functionality and
interdependencies of many support platforms integrated together. IPv6 provides
for great challenges and opportunities, not only in network engineering and
architecture, but also in IT  development and integration.T he trick will be
making the move from the old world to the new look like a fresh start, rather
than a workaround for support.
T he N ext Level Aggregator (N LA) address block is a block of addresses that
are assigned downstream out of a T LA block.We know that these addresses are to
be aggregated as much as possible into bigger T LA blocks, when they are
exchanged between providers, in the Internet core. Let us look at the beneﬁts of
this type of addressing structure from the N LA perspective.
T here are two main advantages to getting address space from a provider.T he
ﬁrst has to do with individual backbone routing stability. If we are an N LA and
wish to provide downstream service to our customers, we will most likely wish
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
39
to provide the fullest, most robust service we can to our client base in order to
retain current clients and to gain market share. Perhaps we wish to allow cus-
tomers to connect to us at multiple locations, as we are fairly geographically
diverse for a given region, and have rich connectivity upstream to Internet T ier 1
(core) providers. Furthermore, we want to allow our customers to receive a full
routing table, should they desire one, if they want to use explicit routes to form
their routing policy. Perhaps they wish to load-balance between two connections,
using some destinations preferred through one connection, and the rest preferred
through the other connection to us.To do this, we have to carry full routes in
our backbone so that we can pass them down to our customers.T hough an
Internet core is usually composed of very modern, robust routing equipment, a
T ier 2 provider may not be able to afford to constantly upgrade their backbone
in order to keep up with new technology and increased routing table size.
Luckily, with IPv6, processing power is not as big a worry as it could be. Because
the Internet core is fundamentally aggregated efﬁciently, we now have a much
smaller routing table to maintain.We can provide full routes to a customer, and
that set of routes may not be too big for us to handle. So by everyone “playing
nice” and following aggregation strategies, we are able to reap the beneﬁts of the
core’s minimized routing table size in our own network backbone.
T he second beneﬁt to N LA aggregation has to do with actual route stability
of our routes across the Internet core globally. Some background information is
needed in order to fully appreciate this point.At the beginning of the Internet’s
explosion in size, there were times when the Internet was not very stable. BGP
speakers would lose routes due to backbone links failing, immature software and
the like. Because of this, routes were constantly being advertised and then with-
drawn (when the route became unreachable), causing considerably more pro-
cessing to take place on core routers, which must keep an up-to-date set of full
Internet routes at all times.To combat this BGP instability, the concept of route
dampening emerged. Essentially, route dampening works as follows: every time a
route is withdrawn and re-advertised, it is assigned a penalty, which is kept track
of at the place of instability (usually an exterior border gateway protocol or
eBGP session).T he more the route “ﬂaps,” the higher the penalty associated with
that route.W hen the penalty associated with the route reaches a certain level, the
route is withdrawn and not accepted for advertisement for a given period of
time.W hen this happens, the route is said to be dampened.T he dampened route
must undergo some period of wait time, without ﬂapping more (or the penalty
gets even higher) before it can be re-introduced into a router’s BGP table.W hen
the route goes long enough without ﬂapping (the penalty decreases with time),
www.syngress.com

40
Chapter 2 • Introduction to IPv6 Architecture
the route is again allowed, and it is inserted back into the router’s BGP table and
treated just like other routes. R oute dampening provided a way for the Internet
core to deal with instabilities in a manner that minimized the cost of other cru-
cial processing. Border Gateway Protocol (BGP) version 6 and IPv6 routing will
be discussed in detail in a later chapter to better explain this concept.
N ow that we understand route dampening, we can appreciate the second
beneﬁt of aggregation.W hen our upstream provider aggregates this route for us
and only announces the aggregate to their peers, this aggregate will, in all likeli-
hood, remain stable, without respect to the stability of our own network. Because
of this, we are virtually certain that another provider will never dampen our
routes somewhere else on the Internet. N one of the more speciﬁc routes that we
use need be spread across the Internet core, outside of our own upstream
provider.T his improved routing stability is a major beneﬁt to aggregation as a
www.syngress.com
Site Renumbering
Site renumbering is performed when there is a need to replace or redis-
tribute existing addresses. An extreme example of site renumbering can
occur when a new service provider is chosen and new global addresses
need to be issued. Site renumbering in IPv4 can pose an administrative
nightmare, but IPv6 simpliﬁes this process immensely. Here are two
ways to implement the site renumbering process:
■If stateful autoconﬁguration is in use, the Top Level
Aggregator and Next Level Aggregator numbers of the new
service provider can be placed in the DHCPv6 service and
propagated throughout the site. 
■If stateless autoconﬁguration is in use, the new network pre-
ﬁxes can be placed in the routers and propagated
throughout the site. 
The advantage of the IPv6 architecture is that the interface identi-
ﬁer remains the same; only the preﬁxes are changed. In the case of IPv6
stateful autoconﬁguration, the preﬁxes can be propagated from a cen-
tral point.
Conﬁguring & Implementing…

Introduction to IPv6 Architecture • Chapter 2
41
whole, both in IPv4 and in IPv6.T he good part is that it is required in IPv6— in
IPv4 it is only recommended. So now the only place that we need to worry
about being dampened is within our own upstream provider’s network.
Fortunately, because we are paying for our upstream connectivity in most cases, it
is substantially easier to get our own upstream provider to help us remove the
penalties on dampened routes than it would be with another provider to whom
we had no ﬁnancial obligation.As you can see, in addition to more addresses and
smaller routing table sizes, there are more ramiﬁcations of IPv6 aggregation
schemes than ﬁrst meet the eye.
T he Site Level Aggregator (SLA) enjoys most of the beneﬁts that an N LA
does, except for its size: the SLA is usually a network or network provider with a
much smaller network. Because of this, a smaller delegation of address space is
needed. It retains the values of aggregations in that its routing tables are kept
smaller, even when receiving a full Internet routing table from its upstream
provider. It also enjoys the beneﬁts of global route stability, in that its upstream
provider, whether an N LA or a T LA, aggregates according to the principles of
the IPv6 aggregations model.
Simpliﬁed Host Addressing 
As we studied earlier, the IPv6 model deﬁnes 128 bits of address space.T he ﬁrst
64 bits are used for network numbering, and the last 64 bits are used for host
numbering.We also remember that the last 64 bits of the host ID are obtained
from the M AC  address of the host’s N etwork Interface.You may wonder how the
64-bit address is derived from a M AC  address, which is classically only 48 bits. In
this section we will look into how addresses are derived, and what developments
we may see in the future as a result of IPv6’s addressing scheme.
By convention, when assigning a host in IPv4, IPv4 will break up the given
subnet and assign host addresses based upon the addresses that are available.Also
by convention, the ﬁrst address is normally given to the designated router, and
the rest of the addresses get assigned to hosts on that subnet, with the last address
in the subnet reserved for the broadcast addresses of that subnet. In IPv6, the situ-
ation is somewhat different.W ith IPv6, we know that the host ID is a 64-bit
address that is obtained from the M AC  address.Although the M AC  addresses of
today are typically 48 bits, we need a way to get the host ID to come out to 64
bits.T he solution to this problem is to pad the M AC  address with some well-
deﬁned set of bits that will be known by routing systems on that subnet.Today,
we use the strings 0XFF and 0xFE (:FF:FE: in IPv6 terms) to pad the M AC
address between the company ID and the vendor-supplied ID of the M AC
www.syngress.com

42
Chapter 2 • Introduction to IPv6 Architecture
address. (M AC  addresses are delegated in much the same way as IP addresses
today, except that companies who make network interface (N IC ) cards are given
a piece of M AC  space, rather than providers being given IPv4 space.) T his way,
every host will have a 64-bit host ID that is related to their M AC  address in the
same way. Furthermore, we know that the 64-bit M AC  address will be unique on
a given network, because every N IC  card will have a unique M AC  address.T his
well-deﬁned padding makes it possible to learn the IPv6 addresses (or at least the
host IDs) of other machines on the subnet simply by learning the Layer 2 M AC
information.
O ne interesting debate is whether or not M AC  addresses will need to
become 64 bits in length prior to the widespread deployment of IPv6. If there is
a need for M AC  addresses to become longer (if all M AC  addresses are used), then
64 bits will most likely be the next option for length, as this will supply over
1.8E019 more M AC  addresses to use (264–248). M oreover, if this comes to be the
case, we may simply stop the padding of the M AC  address, and use the full 64
bits of the M AC  address for the H ost ID.
Simpler Autoconﬁguration of Addresses
O ne of IPv6’s best perks for administrators is that not only is the H ost ID deter-
mined prior to conﬁguring an IPv6 speaking machine, but the network on
which it resides can be deduced as well, making it possible for autoconﬁguration
to take place. Before we go into detail about autoconﬁguration, a new type of
address will have to be brought into our repertoire: the multicast address.
A multicast address can be simultaneously assigned to more than one
machine. It differs from an anycast address in that anycast packets are routed to
the closest destination (one of the set of machines with the same address), while
multicast packets are routed to all machines that are assigned that address.T his is
fundamentally different than a Globally R outable U nicast address in that more
than one host can be numbered with the same address, so the address that a given
host is assigned need not necessarily be unique for the scope on which the multi-
cast address is acting.All machines assigned this multicast address are said to be in
a multicast group whose address is the multicast address they use. M ulticast-
speaking machines send and receive data from more than one host (every
member in that group).T his type of addressing and routing has typically been
used for 1-to-N  or M -to-N  type Internet transactions (when one or more
people need to get identical information to more than one destination). M ulticast
provides an efﬁcient means by which to do so.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
43
If we unite the concept of multicast with the concept of the H ost ID coming
from the hardware on a given machine, we can see how autoconﬁguration is pos-
sible.W hen a machine ﬁrst powers up onto a network and realizes that it is con-
nected and is supposed to speak IPv6, it will send a multicast packet that is well
known and has a standard deﬁnition out onto the LAN  segment to which it is
attached.T his packet will be destined towards a locally scoped (see earlier) multi-
cast address, known as the Solicited N ode M ulticast address.W hen the router sees
this packet come in, it can reply with the network address from which the
machine should be numbered in the payload of the reply packet.T he machine
receives the packet and, in turn, reads the network number that the router has
sent. It then assigns itself an IPv6 address by appending its H ost ID (obtained
from its M AC  address of the interface that it connected to that subnet) to that
network number. See Figure 2.1 for a graphical representation of autoconﬁgura-
tion. N ot only does this require no manual intervention by the administrator to
conﬁgure the machine (though it may or may not involve manual conﬁguration
of the router on that subnet), it also ensures that the address is unique.T he
machine is guaranteed to have a unique address because the network number is
assigned uniquely by the router on that network, and the H ost ID is unique
because the M AC  address of the interface by which that machine is attached is
provided by the vendor and unique. Furthermore, now that it has a routable
address, it can learn the default route that it needs in order to get off of that
subnet. N otice the ease of conﬁguration that we now have when we move from
one network to another. N ot only do we no longer have to manually reconﬁgure
an end-station (and then reboot in most cases), we also no longer have to take
time out of our network administrator’s busy day for him to delegate an address
in order to ensure its uniqueness.Also, the administrator no longer has to keep
track of the addresses that he has assigned and which ones are free at any given
time! C ertainly, this can save a network administrator a great deal of time, not just
in the paperwork associated with keeping track of addresses used, but in reconﬁg-
uration that must occur in order for a network to be renumbered.T hink of the
things an administrator could be doing if he isn’t constantly being hounded for
IP addresses or network numbers! We will go into more detail about the concept
of the multicast address and its possibilities in a later section.
www.syngress.com

44
Chapter 2 • Introduction to IPv6 Architecture
Improved Scalability of Multicast Routing
N ow that we have studied unicast addressing, looked at the primary advantages of
multicast addressing, and discovered the potential of routing table size scalability in
the Internet with IPv6, let’s take a moment to discuss the multicast address in a
little more detail. M ulticast servers are perhaps the most misunderstood technology
of the present day.We’ll start by examining the concept of multicasting in general.
In the beginning, the Internet was primarily a research network upon which
research data ﬂowed between one university and another.T his was not big busi-
ness, so congestion problems were tolerated, and the data that people were
sending was not dated because it didn’t need to be received in real-time.Today,
by contrast, businesses and consumers are using the Internet for a vast array of
applications. M ore and more, we are seeing different types of media going over
the Internet, whether it’s stock quotes, phone calls, or even our favorite T V
channel.We see the need for media to arrive quickly and to be sent to an
increased audience. Even things like newsgroups are getting information out to
millions of people each day.T his 1-to-N  transmission trend is bringing about a
need for a new type of trafﬁc sending, in which one person can send a piece of
www.syngress.com
Figure 2.1 Autoconﬁguration Mechanism
Internet
Router Advertisement:
Subnet ID = 3ffe:2900:1:1/ 64
Workstation
Router B
Router A
3ffe:2900::/ 16
Router Solicitation
Server
Neighbor Advertisement:
Interface ID = w:x:y:z
Neighbor Solicitation
site local = fec0:0:0:abcd/ 64
link local = fe80:0:0:0/ 64

Introduction to IPv6 Architecture • Chapter 2
45
data to many people. In the past, if we wanted to send a piece of data to ten
friends, we would simply make ten copies of that data and send them to each
person one at a time. H owever, as this type of transmission gains popularity, a
scaling problem takes place. For instance, say we have a video or radio show that
we wish to send out over the Internet. If we want to send this media to 10,000
people, all of whom want to see or hear the show in a fashion as close to real-
time as possible, we have to make sure that our upstream bandwidth is sufﬁcient
to handle up to 10,000 times the data rate of one transmission.T hat requires us
to spend much more money purchasing the upstream bandwidth to satisfy our
client base (our viewers or listeners). Fortunately, the concept of multicast was
conceived some time ago, and has been in a testing phase for quite a while.T he
idea of taking one piece of data and efﬁciently sending it to many interested par-
ties at once becomes a complex routing problem, especially if we become caught
in the unicast paradigm we are all used to.T he concept of multicast addresses this
problem.
In a multicast situation, we have a 1-to-N  (or M -to-N ) relationship between
the source and the destination. Instead of using a unicast address to indicate that
we are interested in receiving a given multicast feed, we use a multicast address.
In IPv4, a multicast address is usually referred to as a group address.T his group
address, when applied to a machine or to an application on that machine, signiﬁes
that we are interested in listening to any data that is sent to that address. In IPv4,
the address range of 224.0.0.0 to 239.255.255.255 is used to designate multicast
group addresses.W hen someone wants to receive multicast feeds, they (tem-
porarily or permanently, depending on the situation) assign themselves that
address, and effectively listen for packets coming along that have that multicast
address listed as a destination.
T he routing for multicast becomes rather complex and is beyond the scope of
this book, but you are encouraged to read more about it. Good information can be
found either on the M ulticast Forum home page at www.ipmulticast.com, or in
the IET F working groups regarding multicast. Some of the IET F working groups
you may wish to check out include the M bone Deployment working group
(www.ietf.org/ html.charters/ mboned-charter.html) and the Inter-Domain
M ulticast R outing working group (www.ietf.org/ html.charters/ idmr-charter.html).
T here are also a number of protocol-speciﬁc working groups currently active
within the IET F, including the M ulticast Source Discovery Protocol working group
(M SDP) and the Protocol Independent M ulticast working group (PIM ). I leave it
up to you to learn as much as you wish about the current updates to multicast
routing in general. For the purposes of this book, let us assume that multicast
www.syngress.com

46
Chapter 2 • Introduction to IPv6 Architecture
works, and that it will help save us bandwidth (since it allows us to send only one
stream out of our Internet connection, and the backbone will reproduce it as seen
ﬁt to make sure it gets to all the interested destinations).
O ne particularly good application of multicast is in a corporate network.
Perhaps a memo needs to be sent to all employees’ workstations at once, or a live
videoconference from the C EO  needs to be sent over the corporate network to
all employees. In a corporate network, we want to save as much money as pos-
sible on bandwidth while maintaining an efﬁcient routing structure. M ulticast
buys us just that. H owever, in most cases, we only want multicast information
(streams) to get to the places that are supposed to see them.We do not want the
whole Internet to hear our C EO  talk about our newest secret initiative to take
over our competition! For this, IPv6 has the concept of multicast scoping built
into it.W ith IPv6, we can designate certain multicast streams to be routed only
within a certain area, and never to allow packets to get out of that area for fear of
who may see them.T his scoping will be well known and understood by all
routing entities in order to ensure, through minimal conﬁguration, that multicast
data and multicast routes do not get outside the edges of the routing domain for
which they are meant to exist. Figure 2.2 presents the multicast addressing format
in a little more detail.
As we can see, the multicast addressing architecture is a little different than
that of the Globally R outable U nicast addressing format. N otice that the ﬁrst
eight bits are all set to one, which will allow a routing device to know immedi-
ately that the packet is multicast in nature, and subject to the special handling
associated with this packet type.T he next four bits are used for ﬂags. C urrently,
the ﬁrst three bits in the ﬂags ﬁeld are reserved and undeﬁned, so they should
always be set to zero. (You will ﬁnd that some implementers of protocols will use
these bits fallaciously for some sort of proprietary signaling.T his is ﬁne until the
bits get standardized to something in the future, at which point incompatibilities
will arise.) T he fourth bit is known as the T  bit (see R FC  2373), and is used to
decide whether the multicast address is a permanently assigned address (also
called well-known) or a temporary assignment (also known as transient). So this
www.syngress.com
Figure 2.2 IPv6 Multicast Address Format

Introduction to IPv6 Architecture • Chapter 2
47
ﬁeld will tell us if the multicast address being used is one that is standard (perhaps
a group address used to contact all nodes within a given routing domain, for
example) or a temporarily assigned address (perhaps the M onday night football
game broadcast over the Internet).T he next ﬁeld is the one we are interested in
here: the scope ﬁeld will determine how far the multicast packet can go, in what
areas of a routing domain the packet can travel, and the group address that can be
advertised.T he scope ﬁeld takes the values shown in Table 2.2.
Table 2.2 Scope Deﬁnitions
Scope Field Value
Deﬁnition
0
Reserved
1
Node-local scope
2
Link-local scope
3
(unassigned)
4
(unassigned)
5
Site-local scope
6
(unassigned)
7
(unassigned)
8
Organization-local scope
9
(unassigned)
A
(unassigned)
B
(unassigned)
C
(unassigned)
D
(unassigned)
E
Global scope
F
Reserved
Depending on how we assign our multicast address, we can control how far
the multicast packets will travel, and how widely the routing announcements
associated with that multicast group will be advertised. For instance, if you would
like to advertise a multicast session of the ﬁsh tank in your ofﬁce, and you would
like the whole world to see it, you would assign a scope of E (1110 in binary).
H owever, if you want to set up a multicast group so that you and your coworkers
can have a video conference over the corporate network, you would want to
make sure to give the address a scope of 5 (0101 in binary), or 2 (0010) if
www.syngress.com

48
Chapter 2 • Introduction to IPv6 Architecture
everyone involved is on the same LAN  as you.T his makes life a little easier in
terms of controlling how far information gets propagated. N ow, instead of relying
on a N etwork Administrator to apply ﬁlters at the borders of each routing
domain, we can rely on software (which is generally not susceptible to the same
sort of random changes that networks are) to keep our trafﬁc within the scope
we want.T his allows for privacy at a level that is much easier to implement.T his
is another beneﬁt of IPv6: N ot only are multicast boundaries well deﬁned, they
are also easy to maintain.
The Anycast Address
IPv6 deﬁnes a new type of address, known as the anycast address.Although this
form of address is deployed in a limited fashion in IPv4, IPv6 integrates this
address type into its operations, which improves routing efﬁciency. In this section
we will look into some of the characteristics of the anycast address in detail and
discuss some of the interesting applications of the anycast address in the IPv6
Internet of the future.
An anycast address is an IPv6 address that is assigned to a group of one or
more hosts, all of which serve a common purpose or function.W hen packets are
sent to the IPv6 anycast address, routing will dictate which member of the group
receives the packet via the machine closest to the source, as determined by the
IGP of the network in question. (IGP is the Interior Gateway Protocol: the
routing protocol you use in your routing domain; for example, R IP, EIGR P, or
IS-IS,) In this way, it becomes possible to disperse functionality geographically
across your network in a way that improves efﬁciency in two ways.T his differs
fundamentally from the multicast address.Although both the anycast and the
multicast addresses are assigned to more than one host, the anycast address serves
for data transmissions that are 1-to-1, whereas multicast addressing is used when a
data transmission to multiple destinations is required. Let us look at the two pri-
mary beneﬁts of the anycast addressing scheme.
First, if you are going to the closest machine in a group and it does not
matter which group member you exchange information with, you will usually
save time by communicating with the closest (IGP-wise) group member. Second,
communicating with the closest anycast group member saves bandwidth, because
the distance a packet has to travel is, in most cases, minimized. So not only can
anycast save you time, but it can also save you money (by using less bandwidth).
T he anycast address does not have its own set of bits to deﬁne it; instead, any-
cast addressing is derived from either scoped or Globally R outable U nicast
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
49
addresses. From the point of an IPv6-speaking machine, the anycast address is no
different than a unicast address.T he only difference is that there may be other
machines that are also numbered with the same scope of unicast address within
the same region for which that scope is deﬁned (for instance, you may have more
than one machine with a site-local anycast address within a given site).
N ow that we understand the differences between anycast and multicast
addresses, let’s look into some possible uses of the anycast address. O ne applica-
tion that anycast can help with is DN S (Domain N ame Service). If we were to
offer DN S to many people or customers, as in the case of most T ier 1 service
providers today, we would need to build our DN S in a way that could handle a
large number of queries from all parties for which we provide the service.
Because of this, it is often more efﬁcient to deploy multiple DN S servers and
spread them out geographically.T his will allow for fail-over if one DN S server
becomes unreachable due to network failures, and it will also allow us to dis-
tribute the load of our DN S service between these servers. H owever, we do not
want to make our customers assign too many different IP addresses for DN S
servers to point to for resolution, as most people only use one or two.Also, we
want some way for one or two IP addresses to be used for all of our geographi-
cally diverse service, for the fail-over reason just stated. O ne way to do this would
be to assign each DN S server that has identical conﬁguration and authoritative
information the same IP address. If we then inject routes to each of these DN S
servers into our backbone routing table, when someone queries our DN S the
request will be sent to the DN S server that is geographically closest.T his will
allow us to split up the load among multiple DN S servers and to avoid too much
backhauling of DN S queries across our backbone. So by this method of deploy-
ment, we are saving both time for our customers (DN S servers are close, so their
data transmission takes less time), and money for ourselves (bandwidth = money
for service providers). Because DN S is U ser Datagram Protocol (U DP)-based
rather than T C P-based, transactions between DN S servers and end-stations are
quick and short, and don’t need to be kept track of with sequencing, error
checking, etc.W hen we want to resolve a host name, a packet is sent to the 
DN S server requesting the address associated with a given Internet Domain
N ame and a response is sent back with the answer.T his makes the anycast
addressing model viable for this type of application.An illustration of anycast in
use is provided in Figure 2.3.You can read more on this speciﬁc type of deploy-
ment at www.globecom.net/ ietf/ draft/ draft-catalone-rockell-hadns.00.txt.
www.syngress.com

50
Chapter 2 • Introduction to IPv6 Architecture
Streamlined Header
T he new IPv6 header is simpler and more streamlined than the IPv4 header.T he
new header has only six ﬁelds and two addresses, while an IPv4 header contains
www.syngress.com
Figure 2.3 Anycast Message
Closest DNS Server
Sender
Alternate DNS Server
Anycast
Message
Which Applications Are Good Candidates for Anycast?
Some applications may not be well suited to anycast deployment. For
instance, TCP-based applications using anycast addressing for deploy-
ment will not provide the fail-over capabilities that the previous example
provides. When we are using a UDP-based application, there is no
sequencing information to keep track of. With TCP, we run into a
problem: when a network problem occurs and users are in the middle of
a TCP session with an anycast machine, the TCP sequencing will be all
wrong when the trafﬁc gets rerouted to the next-closest anycast server.
In the case of Web trafﬁc, which is largely TCP-based, the user would
need to reload the Web page (at least), to get to where he or she was
when the failure occurred on the network. Other applications could have
even more disastrous consequences associated with rerouting, so
careful consideration should be given to which types of services are sup-
plied using an anycast model.
Designing & Planning…

Introduction to IPv6 Architecture • Chapter 2
51
ten ﬁxed ﬁelds, two addresses, and a variable-length options ﬁeld. Figure 2.4 illus-
trates the format of an IPv6 header.
T he IPv6 header provides the following simpliﬁcations:
■
Simpliﬁed Format T he IPv6 header has a ﬁxed format with fewer
ﬁelds.T he variable-length options ﬁeld has been eliminated. O ther IPv4
ﬁelds have been eliminated or changed to optional extension headers.
N ot all of the optional extension headers need to be processed by each
node— many of the extension headers are intended only for processing
by host nodes.T his simpliﬁed format reduces the protocol overhead of
IPv6 and allows for greater ﬂexibility.
■
No Header Checksum T he IPv4 checksum ﬁeld has been eliminated.
T his ﬁeld was included in IPv4 because early networks used slow and
unreliable links, thus computing the checksum at each hop was necessary
for ensuring data integrity.Today’s network links are fast and highly reli-
able, so only hosts need to compute the checksum, not routers.
■
No Hop-by-Hop Fragmentation Procedure In IPv4, routers frag-
mented packets that were too large for transmission on the outgoing
interface.T his added signiﬁcantly to IPv4’s processing overhead. In IPv6,
only the host may fragment a packet.To aid the host, IPv6 includes a
function that ﬁnds the maximum transmission unit (M T U ) size from
source to destination.
Figure 2.5 illustrates a transmission frame of a T C P segment (or U DP data-
gram) using IPv6.
www.syngress.com
Figure 2.4 IPv6 Header
Version
Traffic Class
Flow Label
4
8
12
16
20
24
28
32
Payload Length
Next Header
Hop Limit
Source Address
Destination Address

52
Chapter 2 • Introduction to IPv6 Architecture
Security
O ne goal of IPv6 designers was to support interoperable encryption-based secu-
rity. IPv6 integrates security into its architecture by introducing two optional
extension headers: the Authentication H eader (AH ) and the Encrypted Security
Payload (ESP) header.T hese two headers can be used together or separately to
support many types of security functions.
■
Authentication Header (AH) T he heart of the Authentication
H eader is the integrity check value (IC V ) ﬁeld.T he IC V is computed by
the source and computed again by the destination for veriﬁcation.T his
procedure provides both connectionless integrity and data origin
authentication. C onnectionless integrity detects modiﬁcations to the
payload. Data origin authentication veriﬁes the identity of the source of
the data.T he AH  also contains a sequence number ﬁeld that can be used to
detect packet replay attacks, which tie up receiving system resources. By
examining the sequence numbers, we can spot the arrival of duplicate IP
packets.
■
Encrypted Security Payload (ESP) Header IPv6 can provide con-
ﬁdentiality by encrypting the payload.T he IPV6 ESP header contains a
security parameter index (SP I) ﬁeld that refers to a security association
telling the destination how the payload is encrypted. ESP headers may
be used end-to-end or for tunneling.W hen tunneling, the original IPv6
header and payload are both encrypted and jacketed by outer IPv6 and
ESP headers. N ear the destination, a security gateway strips away the
www.syngress.com
Figure 2.5 Transmission Frame with IPv6
Frame Header
Optional IPv6 Extension Header(s)
TCP or UDP Header
Payload
IPv6 Header
Frame Trailer
Segment
or
Datagram
IPv6
Packet
Frame

Introduction to IPv6 Architecture • Chapter 2
53
outer headers and decrypts the original header and payload.T his encap-
sulation provides limited trafﬁc ﬂow conﬁdentiality because a trafﬁc 
analyzer may see the outer headers but not the inner encrypted header
and payload.
Mobility
A growing number of Internet users work while traveling.T his places primary
importance on IPv6’s ability to support mobile hosts, such as laptops. IPv6 intro-
duces four concepts that are key to its support of mobile computing:
■
H ome Address
■
C are-of Address
■
Binding 
■
H ome Agent
In IPv6, mobile hosts are identiﬁed by a home address, regardless of where
they are attached at the moment.W hen a mobile host changes from one subnet
to another, it must acquire a care-of address through the autoconﬁguration process.
T he association between the home address and the care-of address is called a
binding.W hen the mobile host acquires a care-of address, it notiﬁes its home
agent with a Binding U pdate message.T he home agent maintains a mapping
between home addresses and care-of addresses, called a binding cache.
A mobile host can be reached by sending a packet to its home address. If the
mobile host is not connected to its home network, the home agent will forward
the packet to the mobile host via its care-of address.T he mobile host will then
send a Binding U pdate message to the source node.T he source node will update
its binding cache and send subsequent packets directly to the mobile node via its
care-of address. O nly the ﬁrst packet exchanged between a source node and a
mobile host passes through the home agent.All subsequent packets are passed
directly between the source node and the mobile host.T his redirection function
of IPv6 ensures scalability when supporting mobility.
T he proposed use of IPv6 for cell phones may provide an example of the
intended operation of a mobile host.W hen an IPv6 cell phone is activated to
receive calls, it acquires a care-of address from the cell it is in.T he cell phone
notiﬁes its home agent, which is maintained by the service provider. C alls
received by the home agent are forwarded to the cell phone via the care-of
address, and the cell phone sends a Binding U pdate message to the originating
www.syngress.com

54
Chapter 2 • Introduction to IPv6 Architecture
phone.T he originating phone or the originating service provider updates its
binding cache and sends subsequent packets directly to the cell phone via its
care-of address.
If the cell phone moves into another cell, another care-of address is acquired.
Binding U pdate messages are sent to the home agent and to the originating
phone or service provider. Subsequent packets are sent directly to the cell phone
via the new care-of address. Previous care-of addresses may be maintained in the
binding caches to allow the cell phone to receive packets from a previous cell if
warranted by changes in signal strength.
Performance
T he IPv6 architecture provides advantages in network performance and scala-
bility.T hese advantages include:
■
Reduced Address Translation Overhead To overcome limitations in
its address space, IPv4 permits the use of private addresses that are
restricted for use only within the private network. N etwork address
translation must be used to map private addresses to a limited pool of
public addresses.T his address translation represents network performance
overhead. In IPv6, address translation to overcome address space limita-
tions is unnecessary.
■
Reduced Routing Overhead M any IPv4 address blocks (such as
C lass C  address blocks) are allocated to users without respect to aggrega-
tion.T his results in disjointed subnets, each requiring separate routing
table entries.T hey cannot be aggregated and be represented as a single
network.T his greatly increases routing table sizes and routing perfor-
mance overhead. In contrast, the IPv6 addresses are allocated via service
providers to encourage an addressing hierarchy that reduces routing
overhead.
■
Increased Route Stability In IPv4, route ﬂapping results when an
unreliable link is repeatedly withdrawn and re-advertised.T he advertising
and processing of these routing changes poses a burden to the Internet
backbone. In IPv6, a single provider can aggregate the routes of many
networks and allow route ﬂapping to be isolated to that provider’s net-
work. R outing changes need only to be advertised between peer routers
in a provider’s network.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
55
■
Reduced Broadcasts IPv4’s Address R esolution Protocol (AR P) uses
broadcasts to map link-layer addresses with network-layer addresses. IPv6
uses N eighbor Discovery to perform a similar function during the auto-
conﬁguration process without the use of AR P broadcasts.
■
Scoped Multicasts In IPv6, a multicast address contains a scope ﬁeld
that can restrict multicast packets to the node, the link, or the organiza-
tion. In IPv4, implementing similar restrictions requires the implementa-
tion of ﬁlters and private address spaces.
■
Streamlined Header In contrast to the 12 ﬁxed-length ﬁelds and one
variable-length ﬁeld in the IPv4 header, the streamlined IPv6 header has
only eight ﬁxed-length ﬁelds.To implement extended functions, exten-
sion headers can be used that need not be checked by intermediate
routers.T his streamlined header architecture lowers network overhead.
■
No Intermediate Node Fragmentation In IPv4, when an interme-
diate node or router receives a packet that is too large to be forwarded,
the router may fragment the packet.T his costly function is not sup-
ported in IPv6. Instead, only the source node will perform packet frag-
mentation.To assist the source node, IPv6 provides a Path M T U  D iscovery
function to determine the M T U  size for the path from source to desti-
nation.
■
No Header Checksum T he IPv4 header provides a checksum ﬁeld to
allow for error detection at each hop in the network.To eliminate the
overhead of checksum processing by each hop, IPv6 eliminates the header
checksum ﬁeld.W hile this may cause erroneous packets to be forwarded,
the reliability of today’s network links reduces that probability.
C hecksum veriﬁcation is already performed at the source and destina-
tion by upper-layer processes such as T C P and U DP. In IPv6, checksum
processing is solely the responsibility of the source and destination.T his
greatly reduces network overhead.
Comparing IPv6 to IPv4 
IPv6 clearly differs from IPv4 is many signiﬁcant ways. Let’s examine the most
signiﬁcant differences between the two versions of the protocol.T his will allow
those who have worked with IPv4 to easily recognize the major differences with
the new protocol version.T he most signiﬁcant differences are:
www.syngress.com

56
Chapter 2 • Introduction to IPv6 Architecture
■
Streamlined H eader Format
■
Flow Label
■
128-bit N etwork Addresses
■
Elimination of H eader C hecksum
■
Fragmentation O nly by Source H ost
■
Extension H eaders
■
Built-in Security
Addressing Structure
T he IPv6 unicast address is 128 bits long and is comprised of a subnet preﬁx and
an interface identiﬁer. For Aggregatable Global U nicast addresses, both the preﬁx
and the interface ID are 64 bits long, as illustrated in Figure 2.6.T he subnet
preﬁx is the network number assigned to the link.T he interface identiﬁer is
derived from the node’s M edia Access C ontrol (M AC ) address. During IPv6
address autoconﬁguration, the host node supplies its own interface ID from a
R O M  and queries the local router or DH C Pv6 server for a subnet preﬁx.
Today’s M AC  addresses are only 48-bits long so 16 bits in the interface ID is
reserved.T he IEEE has proposed a M AC  address that is 64 bits long, known as
EU I-64.
In contrast, the IPv4 addresses are only 32 bits long.T hey are also comprised
of a subnet number and a host number.T he IPv4 addresses are not derived from
M AC  addresses. N etwork administrators assign both the subnet numbers and the
host numbers.
Address Administration
T he 64-bit subnet preﬁx of an IPv6 Aggregatable Global U nicast address is further
subdivided into ﬁve ﬁelds.T hese ﬁve ﬁelds are illustrated in Figure 2.7.T he ﬁrst
ﬁeld is the format preﬁx (F P ) ﬁeld, which identiﬁes an Aggregatable Global U nicast
address with a binary value of 001.T he third ﬁeld is reserved for future use.
www.syngress.com
Figure 2.6 IPv6 Addressing Format

Introduction to IPv6 Architecture • Chapter 2
57
Two ﬁelds, the T L A  ID and the N L A  ID , are key to understanding IPv6’s
support for an aggregatable addressing hierarchy.T he T LA ID is the Top-Level
Aggregation Identiﬁer. IPv6 global addresses will be assigned to service providers
or T LA organizations.T he T LA organizations will in turn allocate addressing
space to the N ext-Level Aggregation (N LA) organizations.T his hierarchical
method of allocating address space encourages address aggregation to reduce the
size of core routing tables.
In contrast, IPv4 addresses are commonly allocated by C IDR  blocks. Each
C IDR  block is comprised of one or more C lass C  addresses. Each C lass C  block
can address approximately 254 devices. U nfortunately, C IDR  blocks allocated to
different organizations cannot be easily aggregated, and each C IDR  block may
require a separate routing table entry in a core router.T he issuance of C IDR
blocks has caused explosive growth in the size of core routing tables.
To local network administrators, the most important ﬁeld may be the Site-
L evel A ggregation (SL A ) Identiﬁer. U nlike the T LA ID and the N LA ID, the SLA
ID is not usually delegated to a downstream organization with a pre-assigned
value. Per R FC  2374, the SLA ID allows an organization to deﬁne its own local
subnets and addressing hierarchy.T he 16 bits provided by the SLA ID for subnet
identiﬁers can support 65,535 subnets, enough for all but the largest organiza-
tions.To support even larger networks, a downstream organization may request
that a lower-order portion of the N LA ID be delegated.
H erein lies a key advantage of the IPv6 addressing structure.A network
administrator need not worry about allocating addresses for both subnet and host
identiﬁers as he must in IPv4. In IPv4, both subnet and host identiﬁers often
come from the same limited pool of available addresses.An IPv4 network admin-
istrator often “borrows” host identiﬁer ﬁelds to number his subnets. In IPv6, the
top half of the IPv6 address structure provides enough addressing space for subnet
identiﬁers. In a separate and virtually inexhaustible ﬁeld, the IPv6 host identiﬁers
are uniquely generated for each host by a separate autoconﬁguration process.
IPv6 eases the network administrator’s burden in another way:Aggregatable
Global U nicast addresses do not require address translation when used to access
external networks such as the Internet. In IPv4, private address spaces are used
www.syngress.com
Figure 2.7 Subnet Preﬁx of Aggregatable Global Unicast Address
F
P
TLA ID
R
E
S
NLA ID
SLA ID
3
13
8
24
16

58
Chapter 2 • Introduction to IPv6 Architecture
when global addresses are unavailable.T hese private addresses must be translated
to a limited set of global addresses when accessing external networks. IPv4
address translation schemes include N etwork Address Translation (N AT ) and Port
Address Translation (PAT ). IPv6 virtually eliminates the need for address transla-
tion as a means of accessing external networks.
Table 2.3 illustrates the reduced address administration burden placed upon
IPv6 network administrators.
Table 2.3 Address Administration Comparison
IPv4 Private 
IPv6 Aggregatable 
Address Administration Issues
Class A Block
Global Unicast
Address Length
32 bits
128 bits
Length of Pre-assigned Upstream Fields 8 bits
48 bits
Length of Delegated Addressing Fields
24 bits
80 bits
Host Identiﬁer Length
24 – subnet bits 64 bits
Subnet Identiﬁer Length
24 – host bits
16 bits (SLA ID)
Allocate host addresses for subnet 
Yes
No
identiﬁers
Determine subnet identiﬁers
Yes
Yes
Determine host identiﬁers
Yes
No
Address Translation Required (NAT/PAT) Yes
No
Header Comparison
IPv6 provides a more streamlined header than that of IPv4. Five ﬁelds are elimi-
nated, including the variable-length IPv4 options ﬁeld. R emoval of the variable-
length ﬁeld and other ﬁelds permits the IPv6 header to have a ﬁxed format of 
40 bytes in length.A comparison of the two types of headers is summarized in
Table 2.4.
Table 2.4 Header Comparison
Header
IPv4
IPv6
Header Format
Variable
Fixed
Header Fields
13
8
Header Length
20-60 bytes
40 bytes
www.syngress.com
Continued

Introduction to IPv6 Architecture • Chapter 2
59
Address Length
32 bits
128 bits
Header Checksum
Yes
No
Fragmentation Fields
Yes
No
Extension Headers
No
Yes
To provide for additional options, IPv6 deﬁnes the following extension
headers, which will be discussed in detail in the next chapter:
■
H op-by-H op O ptions header
■
Destination O ptions header
■
R outing header
■
Fragment header
■
Authentication header
■
Encapsulating Security Payload header
Feature Comparison
T he IPv6 architecture contains integrated features that are not contained in IPv4.
Table 2.5 contrasts the features of IPv4 and IPv6.
Table 2.5 Feature Chart
Feature
IPv4
IPv6
Anycast Address
No
Yes
Multicast Scoping
No
Yes
Security Support
No
Yes
Mobility Support
No
Yes
Autoconﬁguration 
No
Yes
Router Discovery
No
Neighbor Discovery
Multicast Membership
IGMP
Multicast Listener Discovery
Router Fragmentation 
Yes
Source only
www.syngress.com
Table 2.4 Continued
Header
IPv4
IPv6

60
Chapter 2 • Introduction to IPv6 Architecture
Anycast addresses and multicast scoping are not found in IPv4.W hile security
is a function of upper-layer protocols in IPv4, IPv6 provides integrated security
support through the use of authentication and encryption headers. For mobility,
IPv6 provides the functions of the home agent, care-of addresses, and binding
caches.
IPv6 provides Plug and Play functionality.A host address and preﬁx length
can be autoconﬁgured rather than manually entered, and routers and neighbors
can be discovered. IPv4 contains no built-in discovery function— it requires that
basic IP parameters be manually conﬁgured or obtained from external sources,
such as DN S servers.
For multicast membership support, IPv4 relies on augmentations such as
Internet Group M anagement Protocol (IGM P). In contrast, IPv6 has a built-in
M ulticast Listener Discovery (M LD) protocol. M LD allows a router to determine
which of its ports contain multicast listeners and to add or prune multicast trans-
missions appropriately.
IPv4 allows routers to fragment packets, which causes greater network over-
head. IPv6 only permits the source node to fragment a packet. It provides a Path
M T U  D iscovery function that allows the source to fragment packets efﬁciently.
T his eliminates the need for network devices to further fragment a packet along
the path to its destination.
Examining IPv6 Network Architecture
T he Internet has become a victim of its own success.T he worldwide success of
the Internet has resulted in an explosion of new users and applications, and this
growth has placed new demands upon the network infrastructure and upon net-
work administrators. In the early 1990s, the IET F began to design IPv6 with the
objective of improving IPv4 to meet these new demands.T he areas targeted for
improvement included:
■
Address Space Depletion T he depletion of IP addresses has been
foreseen for many years and many patches and extensions have been
added to IPv4 to alleviate and postpone the looming crisis.Among those
extensions are variable-length subnet masking (VLSM ), C lassless Inter-
Domain R outing (C IDR ), N etwork Address Translation (N AT ), Port
Address Translation (PAT ), and private address spaces. IPv6 introduces a
large uniﬁed addressing structure that will make many of these complex
extensions obsolete.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
61
■
Network Performance T he Internet has outgrown many features in
IPv4 that now encumber network performance.Among these features
are header checksums, M T U  size, and packet fragmentation. IPv6 is
streamlined to reduce protocol overhead.
■
Security IPv4 was not designed with security in mind— security was
considered the responsibility of higher layers in the O pen Systems
Interconnect (O SI) model. IPv6 provides integrated security support for
encryption and authentication.
■
Plug and Play C onﬁguring nodes in an IPv4 network has always been
complicated. M any conﬁguration tasks are manually intensive and not
practical in large networks.A case in point is the renumbering of a net-
work when a new Internet service provider is selected.T he growth of
mobile computing has also added to the workload of network adminis-
trators. IPv6’s autoconﬁguration facilities take us a step closer to true
“Plug and Play” computing.
IPv6 Communication Fundamentals
In the following sections, we will examine in further detail how communication
occurs between the devices on a network and how IPv6 facilitates that commu-
nication.We will examine communication between hosts of the same subnet as
well as host and router communication between subnets.
Intra-Subnet C ommunications
H ow many of us have cringed at the prospect of connecting our computers or
laptops to a network for the ﬁrst time? A computer must be conﬁgured to be
able to communicate on a network. Likewise, a network administrator must con-
ﬁgure his network devices to facilitate communication between hosts. N odes at
both ends of each network link must have compatible conﬁgurations. M any
patches have been added to IPv4 to make the conﬁguration process less manually
intensive.
IPv6 is designed for Plug and Play. Support for autoconﬁguration is built into
IPv6.We will ﬁrst examine stateless autoconﬁguration and its role in intra-subnet
communications. Later, we will discuss stateful autoconﬁguration and its role in
inter-subnet communications.
T he keys to understanding intra-subnet communications are the following
concepts:
www.syngress.com

62
Chapter 2 • Introduction to IPv6 Architecture
■
Stateless Autoconﬁguration
■
Link-Local Address
■
Link-Local Preﬁx
■
Interface Identiﬁer
■
N eighbor Solicitation message
■
N eighbor Advertisement message
■
N eighbor C ache
Let’s imagine a subnet in a dentist’s ofﬁce.T he subnet is comprised of a few
workstations and printers. It has no routers, no connections to the Internet, and
no servers to assist in the conﬁguration process.A host on such a subnet must
conﬁgure its own IPv6 address with a process known as stateless autoconﬁguration.
W hen a workstation is connected to a port on the subnet, the workstation
automatically conﬁgures a tentative address, known as the link-local address.T his
address is formed using the hardware address of the workstation’s network inter-
face.T he link-local address conﬁgured by the workstation is 128 bits long and is
comprised of a local-link preﬁx and the workstation’s interface identiﬁer.T he
local-link preﬁx is an all-zero network identiﬁer prefaced with the hex digits, FE8.
T he interface ID, also known as the M edia Access C ontrol (M AC ) address, resides
in a RO M  on the interface hardware.Today’s M AC  addresses are 48 bits long, but
new speciﬁcations will support 64-bit M AC  addresses.A typical local-link address
takes the following form, where the x’s indicate the 64-bit interface ID:
FE80:0:0:0:xxxx:xxxx:xxxx:xxxx.
To ensure a unique address, the workstation will send a special N eighbor
Solicitation message to the newly conﬁgured address and wait one second for a
reply. If no N eighbor Advertisement message is returned, the new link-local
address is assumed to be unique. (Later, we will see that the N eighbor Solicitation
and N eighbor Advertisement messages are also used for other functions that are
part of the IPv6 N eighbor Discovery protocol.)
After verifying the uniqueness of the link-local address, the next phase is to
query for neighboring routers on the network. In our example of a subnet in a
dentist’s ofﬁce, no routers will be found.T he workstation is now ready to begin
communications with its neighbors.
To communicate with a destination host on the same subnet, the workstation
must discover the destination’s interface identiﬁer.To do so, the workstation uses
the functions provided by the IPv6 N eighbor Discovery protocol.T he workstation
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
63
sends a N eighbor Solicitation message to the destination and the interface identiﬁer
is returned in a N eighbor Advertisement message.T his interface ID is placed in a
header before the IPv6 header and transmitted on the subnet.T he workstation then
adds an entry to its N eighbor C ache.T he entry contains the destination’s IPv6
address, its interface identiﬁer, a pointer to packets pending transmission, and a ﬂag
indicating whether or not the destination is a router.T his cache will be used for
future transmissions instead of sending another solicitation message.
T he link-local addresses cannot be used for communications outside the local
subnet. For inter-subnet communications, site-local addresses or global addresses
must be used in conjunction with routers.We will 
discuss inter-subnet communications in the next section.
Inter-Subnet C ommunications
Suppose that in the previous example, our workstation discovered that a router
did exist on the subnet. H ow would the autoconﬁguration process differ, and how
would the workstation communicate with hosts on different subnets? To discuss
inter-subnet communications, we will expound on the stateless autoconﬁguration
process and introduce the following concepts:
■
N eighbor Discovery
■
Site-Local Address
■
Subnet Identiﬁer
■
R outer Solicitation M essage
■
R outer Advertisement M essage
■
Default R outer List C ache
■
Destination C ache
■
Preﬁx List C ache
■
R edirect M essage
■
Path M T U  Discovery
During and after autoconﬁguration, the workstation relies heavily on the
IPv6 N eighbor Discovery protocol.T he N eighbor Discovery protocol allows
nodes on the same subnet to discover each other and to ﬁnd routers for use as
the next hop towards a destination on another subnet.T he N eighbor Discovery
protocol replaces the IPv4 Address R esolution Protocol (AR P), the IPv4 default
gateway process, and the IPv4 redirect process.
www.syngress.com

64
Chapter 2 • Introduction to IPv6 Architecture
During the autoconﬁguration process, after the workstation generates a
unique link-local address, it queries for a router.T he workstation sends a R outer
Solicitation message and a router responds with a R outer Advertisement message.
T he presence of a router indicates that there may be other subnets connected
to the router. Each subnet must have its own subnet identiﬁer, because routing is
dependent on unique subnet numbers. H ost identiﬁers are not used for making
routing decisions.T he workstation address must now have a unique subnet iden-
tiﬁer.T he link-local address with its zero subnet ID is not sufﬁcient for inter-
subnet communications.
To support stateless autoconﬁguration, the R outer Advertisement contains a
subnet identiﬁer. R outer Advertisements for each router interface contain a dif-
ferent subnet identiﬁer.T his identiﬁer will be concatenated with the interface
identiﬁer to form the workstation’s IPv6 address.
T he workstation will discard its tentative link-local address and conﬁgure a
new address that is known as the site-local address.T he site-local address contains a
16-bit subnet ID and has the following format, where the x’s indicate the 64-bit
interface ID:
FEC0:0:0:<subnet ID>:xxxx:xxxx:xxxx:xxxx.
T he workstation will use information from the R outer Advertisement to
update its caches.T he subnet ID is added to the workstation’s Preﬁx List cache.
T his cache will be used to determine if an address is on the workstation’s subnet
(on-link) or not (off-link).T he router’s information will be added to the
N eighbor cache and Destination cache. If the router can be used as a default
router, an entry will be added to the Default R outer List cache.
W hen the workstation is ready to send a packet to a destination host, it
queries the Preﬁx List to determine whether the destination’s IPv6 address is on-
link or off-link. If the destination host is off-link, the packet will be transmitted
to the next hop, which is the router in the Default R outer List.T he workstation
will then update its Destination cache with an entry for the destination host and
its next hop address. If the default router selected is not the optimal next hop to
the destination, the router will send a R edirect message to the source workstation
with the new recommended next hop router for the destination.T he workstation
will then update its Destination cache with the new next hop for the destination.
T he caches are maintained by each IPv6 host and are queried before solicita-
tion messages are transmitted.T he caches reduce the number of solicitation and
advertisement messages that need to be sent.T he caches are periodically purged
of expired information, and they are constantly updated.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
65
To facilitate inter-subnet communications, IPv6 provides another useful ser-
vice, Path M T U  Discovery. IPv6 does not allow routers to fragment packets that
are too large to be forwarded through the next hop link or interface; only the
source node may fragment a packet. U sing IPv6’s Path M T U  Discovery service, a
source node can determine the largest packet that may be sent to the destination.
W ith this information, the source node can appropriately resize its packets prior
to transmission.
Site-local addresses can only be used for communications within the site. For
communications beyond the site, global addresses must be assigned with a more
scalable autoconﬁguration procedure.
Internetwork C ommunications
In stateless autoconﬁguration, each node is responsible for conﬁguring its own
address and caches using its interface identiﬁer and information provided by the
distributed N eighbor Discovery protocol. In small networks, stateless autoconﬁg-
uration is advantageous for its simplicity and ease of use. Its disadvantages include
relying on multicast discovery mechanisms, using address space inefﬁciently, and
lacking in security and control over policy and access.
To facilitate communications in larger and more complex internetworks, it
may be desirable to manage the autoconﬁguration process using a procedure
known as stateful autoconﬁguration. During our discussion of this process, we will
introduce the following concepts:
■
Stateful Autoconﬁguration
■
Dynamic H ost C onﬁguration Protocol Version 6 (DH C Pv6)
■
DH C Pv6 C lient, R elay,Agent, Server
Stateful autoconﬁguration relies on servers to provide the bulk of the conﬁg-
uration information, including the network information required for obtaining an
Aggregatable Global U nicast address.T hese servers are known as Dynamic H ost
C onﬁguration Protocol version 6 (DH C Pv6) servers. From a network adminis-
trator’s point of view, stateful autoconﬁguration is more complex than stateless
autoconﬁguration because it requires that conﬁguration information be entered
into a DH C Pv6 database. O n the other hand, stateful autoconﬁguration provides
greater scalability when administering to large networks.
Stateful autoconﬁguration can be used simultaneously with stateless autocon-
ﬁguration. For example, a node may follow the stateless procedure upon startup
to obtain a link-local address.After obtaining the link-local address, it may use
www.syngress.com

66
Chapter 2 • Introduction to IPv6 Architecture
stateful autoconﬁguration to interact with and obtain additional information from
a DH C Pv6 server.
To obtain conﬁguration information, a workstation ﬁrst locates a DH C Pv6
server by issuing a DH C P Solicit message or by listening for a DH C Pv6
Advertisement.T he workstation then issues a unicast DH C Pv6 R equest. If a
DH C Pv6 server is not on the local subnet, then a DH C Pv6 R elay or Agent will
forward the request to a server on behalf of the workstation.T he server will
respond with a DH C Pv6 R eply that contains conﬁguration information for the
workstation.
T he use of a DH C Pv6 service has several advantages:
■
Control T he DH C Pv6 service controls the distribution and assignment
of addresses from a central control point.
■
Aggregation T hrough the thoughtful distribution of addresses, an
addressing hierarchy can be built to ensure address aggregation.
■
Renumbering W hen a new Internet service provider is chosen to
replace the old provider, new addresses can more easily be distributed
with the DH C Pv6 service.
■
Security A host registration system can be enforced with the DH C Pv6
service.T his registration system can selectively provide network services
to registered hosts and deny access to unregistered hosts.
www.syngress.com
Autoconﬁguration
Stateless and stateful autoconﬁguration can coexist in IPv6. When
designing and planning for the IPv6 numbering of a site, it is often desir-
able to plan for both autoconﬁguration methods. We’ll begin by classi-
fying various types of nodes based on their need to access the site and
the Internet:
■Workstations that do not need to communicate beyond their
local subnet may use stateless autoconﬁguration to obtain
link-local addresses. 
■Workstations that need to communicate throughout the 
site but don’t need to access the Internet can use stateless
Designing & Planning…
Continued

Introduction to IPv6 Architecture • Chapter 2
67
Upper-Layer Protocol Issues
In general, the layered architecture shields the upper-layer protocols from changes
in the network layers. H owever, there are several issues need to be addressed.
U pper layer protocols that compute checksums over packets must account for
changes in IPv6, including the use of 128-bit addresses, having a ﬁnal destination
instead of intermediate ones when the R outing header is used, and so on.
As discussed earlier, the T ime To L ive ﬁeld (which behaves differently than its
original deﬁnition) has been renamed the hop limit.Any upper-layer protocol that
relies on the original meaning of the T ime To Live may have to make necessary
adjustments.T he maximum upper-layer payload size also needs to be adjusted to
reﬂect the length of the IPv6 header (40 bytes).
■
Upper-Layer Checksums C urrently, an upper-layer transport protocol
such as T C P and U DP will concatenate a pseudo header before its pay-
load when computing the transport layer checksum.T his pseudo header
contains the source and destination IPv4 addresses. For IPv6, the pseudo
header must be expanded to include the larger addresses, the upper-layer
packet length and the next header ﬁeld.T he checksum is computed over
the IPv6 pseudo header, the T C P or U DP header, and the T C P or U DP
payload. Figure 2.8 illustrates the checksum being calculated over an
IPv6 pseudo header.
■
Maximum Packet Lifetimes T he IPv4 header has a T ime To L ive ﬁeld
that is used to determine when a packet can be discarded if it has not
reached its destination. In contains either a hop count or a time in sec-
onds. IPv6 has renamed this ﬁeld as the H op L imit, and the time in seconds
measurement is no longer supported.Applications using this ﬁeld for
time data must be revised.
■
Maximum Upper-Layer Payload Size T he nominal IPv6 header is
40 bytes long.T he nominal IPv4 header is 20 bytes long. R eplacing the
www.syngress.com
autoconﬁguration to obtain site-local addresses from their
local routers.
■Workstations that need access to the Internet can obtain
aggregatable global unicast addresses from a DHCPv6 server.
DHCPv6 allows address distribution to be controlled from a
central point.

68
Chapter 2 • Introduction to IPv6 Architecture
IPv4 header with a longer IPv6 header will result in larger packet sizes,
which may have upper-layer consequences.
■
Routing Headers & Security T he IPv6 routing header extension
contains the intermediate nodes that the packet must traverse on the
way to its destination.W hen a packet with a routing header is received
by the destination, it should not assume that the reverse path to the
source is appropriate. In fact, responding along the reverse path may
facilitate certain types of security breaches.
■
Domain Name System (DNS) T he DN S is a distributed database
system that deﬁnes a hierarchical naming convention for host nodes and
maps these host names to IP addresses. For example, www.syngress.com
maps to IPv4 address 216.238.176.55. IPv6 enhancements to DN S
include new record types with the 128-bit IPv6 address and a new ser-
vice that can return a hostname when given its IPv6 address.
■
Application Programming Interface (API) Application programs
written for IPv4 must be converted to use APIs written for IPv6.T he
application programs must contain new data structures for the longer
IPv6 addresses. Functions that manipulate IPv4 addresses must be substi-
tuted with functions that can manipulate IPv6 addresses.
Understanding ICMPv6
T he Internet C ontrol M essage Protocol version 6 (IC M Pv6) is a key part of the
IPv6 architecture. IC M Pv6 performs the feedback functions necessary to ensure
the smooth operation of IPv6 processes.T hese functions include:
www.syngress.com
Figure 2.8 TCP/UDP Checksum Calculation
Pseudo Header
TCP/ UDP Header
Payload
(1) Compute Checksum
over this range
(2) Discard
(3) Transmit

Introduction to IPv6 Architecture • Chapter 2
69
■
Packet Processing Error R eporting
■
Diagnostics
■
N eighbor Discovery
■
M ulticast M embership R eporting
IC M Pv6 is streamlined to delete IC M Pv4 functions that are no longer used,
and it combines the functions of three separate IPv4 protocols: IC M Pv4, Internet
Group M embership Protocol (IGM P), and Address R esolution Protocol (AR P).
IC M Pv6 messages can be divided into error messages and information messages.
Error Messages
IC M Pv6 issues error messages pertain to packet processing.T hese error messages
include:
■
Destination Unreachable  T he source host or a router generates this
message when a packet cannot be delivered for any reason other than
congestion.
■
Packet Too Big  T he router generates this message when a packet
cannot be forwarded because it is larger than the M T U  of the next hop
link.T he M T U  of the next link is returned in the message.T his message
is used by the Path M T U  Discovery function.
■
Time ExceededT he IPv6 header contains a H op Limit that is decre-
mented by each router that forwards the packet.W hen this hop limit
reaches zero, the router discards the packet and returns a T ime Exceeded
message to the source node.T his function is the basis of the traceroute
function; it traces the route to a destination by sending packets towards
the destination with incremental hop limits.T he T ime Exceeded mes-
sages returned are used to identify the routers along the path.
■
Parameter Problem  W hen a problem with some part of an IPv6
header keeps a router from successfully processing the packet, the packet
is discarded and the router returns a Parameter Problem message to the
source node.
Each IC M Pv6 error message includes three ﬁxed-length ﬁelds plus a variable-
length message body. Figure 2.9 illustrates the format of the error message.
www.syngress.com

70
Chapter 2 • Introduction to IPv6 Architecture
Informational Messages
IC M Pv6 can also report informational messages.T hese include:
■
Diagnostic Messages Diagnostic messages include the echo request
and reply.W hen a destination receives the echo request, it returns a
reply.T his echo request and reply are used to implement the ping diag-
nostic function.T he ping function is important for determining whether
or not a particular destination is connected to the same network as the
source.
■
Multicast Listener Discovery (MLD) Messages T hese messages
enable a router to discover neighboring nodes that wish to receive mul-
ticast packets, and what multicast addresses are of interest to them.A
router transmits an M LD Q uery to learn whether a multicast address (or
addresses) has listeners on a link. N odes respond afﬁrmatively with an
M LD R eport message.W hen a node ceases to listen to a multicast
address, it sends an M LD Done message.
■
Neighbor Discovery Messages IC M Pv6 provides messages necessary
for the N eighbor Discovery protocol.T hese messages include router
solicitation and advertisement, neighbor solicitation and advertisement,
and redirect.T hese messages include information options such as the
source link-layer address, the target link-layer address, preﬁx information,
the redirected header, and the M T U  size.
www.syngress.com
Figure 2.9 ICMPv6 Error Message
Type
Code
Checksum
8
8
16
IPv6 Header
ICMPv6 Message Body
Type
ICMPv6 Error Message
1
Destination Unreachable
2
Packet Too Big
3
Time Exceeded
4
Parameter Problem

Introduction to IPv6 Architecture • Chapter 2
71
IC M Pv6 informational messages have the same format as the IC M Pv6 error
message displayed in Figure 2.9.T he type ﬁeld values for informational messages
range from 128 to 255.Table 2.6 shows some of the common type ﬁelds for
IC M Pv6 informational messages.
Table 2.6 ICMPv6 Informational Messages
Type Field Value
ICMPv6 Informational Message
128
Echo Request
129
Echo Reply
130
Multicast Listener Query
131
Multicast Listener Report
132
Multicast Listener Done
133
Router Solicitation
134
Router Advertisement
135
Neighbor Solicitation
136
Neighbor Advertisement
137
Redirect
Understanding Neighbor Discovery 
IPv6’s N eighbor Discovery protocol is used to obtain information that facilitates
the packet forwarding process.T he information gathered by the N eighbor
Discovery protocol can be used for:
■
N ext H op Determination
■
Address R esolution
■
Preﬁx Discovery
■
Parameter Discovery
■
R edirection
Five IC M Pv6 messages are used in the N eighbor Discovery protocol.We will
discuss N eighbor Discovery with respect to these ﬁve messages.
www.syngress.com

72
Chapter 2 • Introduction to IPv6 Architecture
Router Solicitation and Advertisement
During the autoconﬁguration process, after the workstation generates a unique
link-local address, it queries for a router.T he workstation sends a R outer
Solicitation message and listens for a R outer Advertisement message.
T he presence of a router indicates that there may be other subnets connected
to the router. Each subnet must have its own subnet identiﬁer because routing is
dependent on unique subnet numbers. H ost identiﬁers are not used to make
routing decisions.T he workstation address must now have a unique subnet iden-
tiﬁer.T he link-local address, with its zero subnet ID, is not sufﬁcient for inter-
subnet communications.
T he R outer Advertisement contains a network number or preﬁx.T he preﬁx
may contain an aggregatable global unicast preﬁx or simply a subnet identiﬁer.
R outer Advertisements for each router interface contain different preﬁxes.T his
preﬁx will be concatenated with the interface identiﬁer to form the workstation’s
IPv6 address.
T he workstation uses information from the R outer Advertisement to update
its caches.T he subnet ID is added to the workstation’s Preﬁx List cache.T his
cache will be used to determine if an address is on the workstation’s subnet (on-
link) or not (off-net).T he router’s information will be added to the N eighbor
cache and the Destination cache. If the router can be used as a default router, an
entry will be added to the Default R outer List cache.
Figure 2.10 illustrates a workstation during the autoconﬁguration process.
T he workstation solicits the local router and receives the subnet identiﬁer it
needs to complete its host IPv6 address.
www.syngress.com
Figure 2.10 Router Discovery
Router Advertisement: Subnet ID = B
Workstation
Router Solicitation
Server
Subnet ID = B
Subnet ID = A

Introduction to IPv6 Architecture • Chapter 2
73
Neighbor Solicitation & Advertisement
To communicate with a destination host on the same subnet, the workstation
must discover the destination’s interface identiﬁer.To do so, the workstation uses
the functions provided by the IPv6 N eighbor Discovery protocol.T he worksta-
tion sends a N eighbor Solicitation message to the destination, and the interface
identiﬁer is returned in a N eighbor Advertisement message.T his interface ID is
placed in a header before the IPv6 header and transmitted on the subnet.T he
workstation then adds an entry to its N eighbor C ache containing the destina-
tion’s IPv6 address and interface identiﬁer, a pointer to packets pending transmis-
sion, and a ﬂag indicating whether the destination is a router.T his cache will be
used for future transmissions (instead of sending duplicate solicitation messages).
Figure 2.11 illustrates how N eighbor Solicitation and Advertisement messages
play a key role in the N eighbor Discovery process.
Redirect Message
R outers issue the R edirect message to inform other nodes of a better ﬁrst hop to
the destination.A node can be redirected to another router on the same link.
H ere’s how redirection works in the packet processing process:
W hen the workstation is ready to send a packet to a destination host, it
queries the Preﬁx List to determine whether the destination’s IPv6 address is on-
link or off-link. If the destination host is off-link, the packet will be transmitted
the next hop, which is the router in the Default R outer List.T he workstation
will then update its Destination cache with an entry for the destination host and
its next hop address. If the default router selected is not the optimal next hop to
www.syngress.com
Figure 2.11 Neighbor Discovery
Neighbor Advertisement:
Interface ID = w:x:y:z
Workstation
Neighbor Solicitation
Server

74
Chapter 2 • Introduction to IPv6 Architecture
the destination, the router will send a R edirect message to the source workstation
with the new recommended next hop router for the destination.T he workstation
will then update its Destination C ache with the new next hop for the destination.
Message Options
N eighbor Discovery messages may contain additional information options.T hese
options include:
■
Source Link-Layer Address Option T his option contains the link-
layer address of the source of the message. It is used in R outer
Solicitation, R outer Advertisement, and N eighbor Solicitation messages.
■
Target Link-Layer Address Option T his option contains the link-
layer address of the target of the message. It is used in N eighbor
Advertisement and R edirect messages.
■
Preﬁx Information Option T his option contains preﬁxes for address
autoconﬁguration. It is used in R outer Advertisements.
■
Redirected Header Option T his option contains all or part of the
packet that is being redirected. It is used in R edirect messages.
■
MTU Option T his option contains the M T U  size of the link. It is
used in R outer Advertisements.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
75
Summary
IP and its extensions have withstood the test of time over the last three decades,
during which we saw an explosion of new users and new applications.Today, its
success has prompted its re-examination.T he Internet Engineering Task Force
(IET F) has designed the next version of IP to meet the growing needs of the
Internet. IPv6 is much more than simply an extension of IPv4 with a larger
address space— its architecture was designed to provide easier administration and
greater performance, security and mobility.
IPv6 takes us closer to Plug and Play computing and greatly eases the burden
put upon network administrators. IPv6’s stateless autoconﬁguration allows subnet
communications literally “out of the box.” T he N eighbor Discovery protocol
automatically solicits and caches information needed for packet processing.
DH C Pv6 uses IPv6’s hierarchical addressing structure to allow even the daunting
task of site renumbering to proceed with relative ease. IC M Pv6 provides an effec-
tive set of diagnostic and information-gathering functions.
IPv6’s Plug and Play support extends to mobile computing: M obile hosts
acquire care-of addresses as they travel, and home agents bind the care-of
addresses to home addresses to ensure that mobile users retain connectivity away
from home. R edirection allows a source host to communicate directly with a
mobile host.
IPv6 provides integrated security support with two extension headers.T he
Authentication H eader’s Integrity C heck Value (IC V ) ﬁeld supports both connec-
tionless integrity and data origin authentication.T he sequence number ﬁeld can be
used to detect packet replay attacks. Encrypted payloads can be transmitted with
the Encrypted Security Payload (ESP) H eader.T he header’s SP I ﬁeld contains a
security association that tells the destination how the payload is encrypted. ESP
headers may be used end-to-end or for tunneling.
T he address space of IPv6 is not only larger than IPv4’s address space; it pro-
vides an aggregation hierarchy to simplify address administration and to reduce
core routing table sizes.T he use of M AC  addresses to form the host portion of
the address increases the probability of uniqueness during autoconﬁguration.
IPv6’s design enhances network performance. Its larger address space elimi-
nates the need for network and port address translation, reducing overhead. C ore
routing overhead is signiﬁcantly reduced by the ability to aggregate addresses and
reduces the size of routing tables.Aggregation enhances core router stability by
allowing route ﬂapping to be isolated to a provider’s network. IPv6’s streamlined
header architecture eliminates header checksums and router fragmentation.
www.syngress.com

76
Chapter 2 • Introduction to IPv6 Architecture
Scoped multicast trafﬁc and the introduction of anycast addresses further reduce
multicast trafﬁc.
T he layered network model generally protects upper-layer protocols from an
expensive transition to IPv6. O bvious transitional issues related to the upper-layer
protocols, which were discussed earlier, are solvable.
T his author’s hope is that this book will help you to understand the solutions
and beneﬁts provided by IPv6 and encourage you to explore IPv6 further.
Solutions Fast Track
U nderstanding the Beneﬁts of IPv6
 T he IP address size is greatly increased.
 A “top-down” allocation plan supports addressing hierarchies, enabling
greater address aggregation.
 H ost addressing is simpliﬁed by using the M AC  address to form the host
portion of the IP address.
 Plug and Play functionality is supported by simpler autoconﬁguration of
IP addresses.
 M ulticast routing is scoped to provide greater scalability.
 Anycast addresses increase routing efﬁciency.
 Streamlined headers lower routing overhead.
 Security is built in to support IP security at a lower level in the O SI
stack.
 M obility is enhanced with greater scalability and ease.
 Performance is enhanced with greater efﬁciency and streamlining.
C omparing IPv6 to IPv4
 IPv6 enlarges the addressing structure without address translation and
private address spaces.
 IPv6 address administration is “top-down” to allow for greater address
aggregation.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
77
 IPv6 headers are simpler and more efﬁcient thanks to a ﬁxed size and
fewer ﬁelds.
 IPv6 features not included in IPv4 include enhanced support for
multicasting, security, mobility, and discovery.
Examining IPv6 N etwork Architecture
 T he impending address space depletion provided the initial impetus for
developing IPv6.
 A streamlined architecture improves network performance.
 Security on the IP level is built into IPv6.
 Plug and Play has become a reality with IPv6.
 Intra-subnet communications can be autoconﬁgured in a Plug and Play
fashion.
 Inter-subnet communications can be set up by the stateless
autoconﬁguration function.
 Internetwork communications can be set up by stateful
autoconﬁguration.
U pper-Layer Protocol Issues
 U pper-layer checksums need to be computed over a larger IPv6
pseudoheader.
 T he maximum packet lifetime is expressed as an IPv6 H op Limit, not a
T ime To Live.
 M aximum upper-layer payload sizes may need revision to allow for the
larger IPv6 header.
 T he IPv6 R outing H eader must be used with care to avoid the security
risks of source routing.
 T he Domain N ame Service (DN S) is being enhanced to support IPv6.
 Application Programming Interfaces (APIs) are being developed to
support the larger IPv6 addresses.
www.syngress.com

78
Chapter 2 • Introduction to IPv6 Architecture
U nderstanding IC M Pv6
 T here are four types of IPv6 error messages:
■
Destination U nreachable messages arise when a packet cannot be
delivered for any reason other than congestion.
■
Packet Too Big messages arise when a packet exceeds the M T U  size
of the outgoing interface.
■
T ime Exceeded messages arise when a packet exceeds its H op Limit.
■
Parameter Problem messages arise when a router cannot process an
IPv6 header.
 T here are three types of Informational M essages.
■
Diagnostic messages include the echo request and reply messages.
■
M ulticast Listener Discovery (M LD) messages are used to discover
multicast listeners and the multicast addresses that are of interest to
them.
■
N eighbor Discovery messages support the N eighbor Discovery pro-
tocol.
U nderstanding N eighbor Discovery
 R outer Solicitation and Advertisement messages are used to discover
local routers and to advertise router and subnet information.
 N eighbor Solicitation and Advertisement messages are used to discover
neighbors and to advertise their addresses.
 A R edirect message is used to inform a node of a better ﬁrst hop to a
destination.
 M essage O ptions are used to include additional information in
N eighbor Discovery messages.
www.syngress.com

Introduction to IPv6 Architecture • Chapter 2
79
Q: U nder IPv6, if my organization were to change network service providers,
would we have to renumber our host IP addresses?
A: N o, the 64-bit host portion of your IPv6 address will remain the same. O nly
the 64-bit network number of your IPv6 address will change.T he network
portion of your IPv6 address is provided by a host conﬁguration server.T he
server’s network numbering program will change, but the host numbering
will remain the same.
Q: W hat is the core set of R FC s specifying IPv6 header and extension headers?
A: N ewer R FC s may render these obsolete, but most of the information in this
chapter is based on the following R FC s:
■
RFC 2374 An IPv6 Aggregatable Global U nicast Address Format
■
RFC 2460 Internet Protocol,Version 6 (IPv6) Speciﬁcation
■
RFC 2402 IP Authentication H eader
■
RFC 2406 IP Encapsulating Security Payload H eader
Q: W hat is the implementation status of IPv6?
A: IPv6 is currently being developed for many host systems and routers,
including 3C om, C isco Systems, Digital, IBM  and M icrosoft.A preview ver-
sion of W indows 2000 that supports IPv6 can be downloaded from this
U R L: http:/ / msdn.microsoft.com/ downloads/ sdks/ platform/ tpipv6.asp.
Q: H ow should my organization transition from IPv4 to IPv6?
A: Strategies have been devised to ease the difﬁculty of transitioning from IPv4
to IPv6.T hese strategies involve dual stack approaches and tunneling
approaches to provide simultaneous support for both IPv4 and IPv6 during
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

80
Chapter 2 • Introduction to IPv6 Architecture
the transition phase.T here is ongoing research aimed at making this transition
as easy as possible.
Q: W hat happened to IPv5?
A: Version 5 was assigned to an experimental protocol, the Streams P rotocol,
known as ST 2. ST 2 was designed to carry real-time trafﬁc in parallel with IP.
Q: W ill IPv6 be more complicated to implement than IPv4?
A: IPv6 was designed with autoconﬁguration and N eighbor Discovery functions
that will make it much easier to install and implement.
www.syngress.com

The IPv6 Headers
Solutions in the chapter:
■
Analyzing the IPv6 Header
■
Comparing the IPv6 and IPv4 Headers
■
The IPv6 Extension Headers
Chapter 3
81
 Summary
 Solutions Fast Track
 Frequently Asked Questions

82
Chapter 3 • The IPv6 Headers
Introduction
T his chapter examines the purpose and use of the IPv6 header within the IPv6
protocol.T he IPv6 header can be divided into a basic header that appears in
every IPv6 packet and several extension headers. Each extension header has its
own function or functions and is not required in an IPv6 packet. Examples of
these headers are the fragmentation header and the authentication header.
T he basic IPv6 header is only 40 bytes in length. C onsidering that 32 bytes
are used for the source and destination IPv6 addresses, this only leaves eight addi-
tional bytes in the header.T his was clearly by design— the creators of IPv6
wanted to keep the standard header small and ﬁxed in size. Keeping it small
reduces the overhead on each packet, and keeping it ﬁxed in size makes it easier
for all IPv6 nodes to process the header.
T he IPv6 header can have optional extension headers. N one of these are
required, but an IPv6 packet can have one or several of them. Each header serves a
general purpose, and many have option types that can serve more speciﬁc purposes.
T his is similar to the way that Internet C ontrol M essage Protocol (IC M P) in IPv4
is used for general control, but has many codes for speciﬁc control functions.
W hen examining the IPv6 header, we can treat the header as if it follows the
O pen System Interconnection (O SI) reference model. In the O SI model each layer
(Layer 2, Layer 3, Layer 4, etc.) has its own header.T he headers are sequenced in
order, starting with Layer 2, with each layer indicating the exact type of header that
follows. For example, the Layer 2 header indicates that the Layer 3 header is IP.T he
IP header indicates that the Layer 4 header is T C P, and so on.
T he basic IPv6 header has a standard format that will always appear in an
IPv6 packet, much like the Ethernet (Layer 2) header in a packet.T he header
then has a ﬁeld to indicate what comes next— an IPv6 extension header, the next
protocol (T C P), or something else.T his is very similar to the way an Ethernet
header indicates that an IPv4 header follows.An IPv6 extension header likewise
has a next header ﬁeld.T his will indicate what comes next— another IPv6 exten-
sion header or the T C P header (or other upper-layer protocol).T his is similar to
the way the IPv4 header indicates that a T C P header follows.
Furthermore, an IPv6 router or node starts at the beginning of an IPv6
packet and works in sequence though each header (for however many headers
need to be processed). It ﬁrst examines the IPv6 header, then each extension
header (if any), then the upper-layer protocol header.T his is the exact same way
that nodes process packets in the O SI model. First Layer 1/ Layer 2 is processed,
then Layer 3, then Layer 4, and so on.
www.syngress.com

www.syngress.com
W hen the format of the IPv6 header was created, the IPv4 header was used
as a template. Some ﬁelds, such as version and payload length, were maintained from
IPv4 to IPv6. O ther ﬁelds, such as T ime To L ive (T T L ), were maintained from
IPv4 to IPv6, but renamed to reﬂect their actual use (“hop limit”). Some, such as
identiﬁcation and fragment offset, were changed to IPv6 extension headers, and still
others, including header checksum and options, were dropped completely from the
IPv6 header.
Analyzing the IPv6 Header
T he IPv6 header is ﬁxed in length and aligned at 8-octet boundary, unlike the
IPv4 header, which is of variable length and aligned at 4-octet boundary. M ost
modern computer architectures are optimized to read eight octets at a time.T hus,
the length of the IPv6 header (or extension headers) is designed to be a multiple
of eight octets for 8-octet alignment.W ith a ﬁxed IPv6 header, a router can efﬁ-
ciently process a packet. For instance, a router must decide if there are any
options in an IPv4 packet by reading the header length ﬁeld. Processing a variable-
length header can lead to inefﬁcient router implementation.
T he changes from the IPv4 header to the IPv6 header will be covered in the
next section. In this section, we will describe each ﬁeld in the IPv6 header and its
intended role. Figure 3.1 shows the format of an IPv6 header.
The IPv6 Headers • Chapter 3
83
Figure 3.1 The IPv6 Header
40 octets
Destination Address
16 octets (128 bits)
Source Address
16 octets (128 bits)
32 bits
Version
4 bits
Traffic Class
8 bits
Flow Label
20 bits
Hop Limit
8 bits
Next Header
8 bits
Payload Length
16 bits
4
8
24
40
1
8
16
24
32

84
Chapter 3 • The IPv6 Headers
T he IPv6 header stores the information necessary to route and deliver packets
to their destination.T he headers are processed by each node along the path.T he
ﬁrst 4-bit ﬁeld, version, indicates the version of the Internet Protocol being used,
and its value is 6 for IPv6.T his ﬁeld is necessary because it allows both protocols
to coexist on the same segment without conﬂicts.
T he next two ﬁelds, trafﬁc class and ﬂow label, are used to provide differentiated
services and support applications requiring special per-ﬂow handling.T he 8-bit
trafﬁc class ﬁeld can be used to provide differentiated services based on the nature
of the data being transmitted.T his ﬁeld is similar to the intended use of the type
of service ﬁeld in the IPv4 header. For instance, an organization may set up its net-
work to prioritize network trafﬁc based on applications or source and destination
information, and hosts and/ or routers can use the trafﬁc class ﬁeld to differentiate
the priority.T he values and the exact use of this ﬁeld are yet to be determined.
T he ﬂow label, in combination with source and destination addresses, can
uniquely identify a ﬂow that requires special handling by intermediate routers.
W hen a router identiﬁes a ﬂow for the ﬁrst time, it remembers the ﬂow and any
special handling this ﬂow requires. O nce per-ﬂow handling has been set up, the
processing of subsequent packets belonging to this ﬂow can be shorter than pro-
cessing individual packets.
T he 16-bit payload length ﬁeld, similar to the total length ﬁeld in the IPv4
header, indicates the length of the packet, not including the length of the IPv6
header.T he 8-bit N ext H eader ﬁeld is used to indicate the next header following
the IPv6 header.T he intended use of this ﬁeld is identical to that of the protocol
ﬁeld in the IPv4 header.T he hop limit can be used to limit the number of inter-
mediate hops a packet is allowed to visit, which can prevent packets from being
circularly routed in a network. (In IPv4, the T T L ﬁeld has been used to prevent
packets from being routed circularly— the new name for this ﬁeld was chosen to
more accurately reﬂect accurately its purpose.) As in IPv4 headers, IPv6 headers
contain source and destination IP addresses. U nlike IPv4 nodes, IPv6 nodes use
128-bit addresses.
Comparing the IPv6 and IPv4 Headers
T he IPv6 header shares some similarities with its predecessor, the IPv4 header.
We will review the IPv4 header and discuss its similarities and differences to the
IPv6 header. Figure 3.2 illustrates the format of an IPv4 header.
www.syngress.com

The IPv6 Headers • Chapter 3
85
Let’s take a look at each of the ﬁelds in an IPv4 header and how they relate
to the IPv6 header:
Version T he ﬁrst 4-bit version ﬁeld in the IPv4 header is used to indi-
cate the current version of the IP being used.T he same ﬁeld is used in
the IPv6 header and is necessary in order to make IPv6 backward com-
patible.
Header Length T he 4-bit header length ﬁeld is necessary for the IPv4
header to indicate the length of the header since the total length of the
IPv4 header is variable between 20 and 64 bytes, depending on the pres-
ence and the length of options in the option ﬁeld. H owever, this ﬁeld is
not necessary in an IPv6 header, because an IPv6 header is a ﬁxed length
of 40 bytes.
Type of Service (ToS) T he intent of the type of service ﬁeld in IPv4 is
similar to that of the trafﬁc class ﬁeld in the IPv6 header. N evertheless,
this ﬁeld has not been widely accepted or used in IPv4 implementations.
Total Length T his ﬁeld indicates the entire length of the IP portion of
the packet. It only includes the IP portion, so it does not include parts
www.syngress.com
Figure 3.2 The IPv4 Header
20 octets typical, up to 60 octets with options
Destination Address
4 octets (32 bits)
Source Address
4 octets (32 bits)
Version
4 bits
Hdr Len
4 bits
Total Length
16 bits
Fragment Offset
13 bits
Flags
3 bits
Identification
16 bits
4
8
20
60
Type of Service
8 bits
Time to Live
8 bits
Protocol
8 bits
Header Checksum
16 bits
12
16
Options (if any)
0 - 40 octets
Part of the
IPv6 Header
Not Included in
the IPv6 Header
32 bits
1
8
16
24
32

86
Chapter 3 • The IPv6 Headers
of a packet that are not related to IP, such as the Ethernet header or the
Frame C heck Sequence (also used on Ethernet packets), for example.
IPv6 uses a similar ﬁeld called payload length.
Identiﬁcation, Flags, Fragment Offset T he next three ﬁelds in the
IPv4 header, the identiﬁcation, ﬂags and fragmentation offset ﬁelds, are all
related to the handling of fragmentation and the reassembly of packets.
In IPv4, an intermediate hop may further fragment a packet when the
maximum transmission unit (M T U ) on the outgoing link is smaller than
the size of the packet that is to be transmitted on that link. U nlike IPv4,
fragmentation processing in IPv6 takes place only at the source node,
using a path M T U. Further, information related to fragmentation is
encoded in the fragmentation header as an extension header in an IPv6
packet.T herefore, these three ﬁelds are not necessary in the IPv6 header.
Time To Live (TTL) In the original design of IPv4, the T T L ﬁeld was
used to indicate the number of seconds to live in a network, thus pre-
venting packets from being circularly routed if a circular route existed in
a network. H owever, in implementations, this ﬁeld has been used to
limit the number of hops the packet is allowed to visit.At each hop, a
router decrements this ﬁeld, and when it reaches zero, the packet is
removed from the network. In IPv6, this ﬁeld has been renamed hop
limit, a more accurate description of its implementation.
Protocol T he protocol ﬁeld, which is used to indicate the next protocol
(header) following the IPv4 header, is similar to the next header ﬁeld in
the IPv6 header.
Header Checksum T he header checksum ﬁeld is used to maintain the
integrity of the IPv4 header. H owever, the higher layer calculates the
checksum again for the entire packet, making this ﬁeld redundant.
T herefore, this ﬁeld is not used in IPv6 header. If applications require a
higher degree of integrity, they can achieve it through appropriate use of
the Authentication and Encapsulating Security Payload extension headers.
Source and Destination Address T he source and destination ﬁelds in
IPv4 header remain the same in IPv6, except that the IPv4 node
addresses are 32 bits and the IPv6 node addresses are 128 bits.
Options T he use of options in IPv4 implies that each intermediate
node in the path needs to examine the options ﬁeld in the IPv4 header,
although the options may be pertinent only to the destination node.T his
www.syngress.com

The IPv6 Headers • Chapter 3
87
leads to inefﬁcient router performance when options are used. In IPv6,
optional information is encoded in extension headers.
The IPv6 Extension Headers
Extension headers, placed between the IPv6 header and the upper-layer protocol
header, are used to carry optional Internet-layer information in a packet.An IPv6
packet may carry zero, one, or more extension headers.T he N ext H eader ﬁeld in
the IPv6 header and extension headers is used to indicate which extension
header or upper-layer protocol header follows the current header.
NOTE
Table 3.1 provides the Next Header value and the corresponding headers.
Except for the Hop-by-Hop Options header, the Next Header value
appears in the immediately preceding header. When the Hop-by-Hop
Options header is used, it must follow immediately after the IPv6 header.
Therefore, the Next Header value of zero can appear only in IPv6 header.
Table 3.1 Next Value Headers
Next Header Value
Next Header
0
Hop-by-Hop Options header
4
Internet Protocol
6
Transmission Control Protocol
17
User Datagram Protocol
43
Routing header
44
Fragment header
45
Inter Domain Routing Protocol
46
Resource Reservation Protocol
50
Encapsulating Security Payload
51
Authentication header
58
Internet Control Message Protocol
59
No next header
60
Destination Options header
www.syngress.com

88
Chapter 3 • The IPv6 Headers
W hen a T C P header immediately follows an IPv6 header without an exten-
sion header, the value of the N ext H eader ﬁeld in the IPv6 header indicates that
the following header is a T C P header.W hen a packet using T C P as its upper-
layer protocol carries one extension header, the R outing header, this extension
header is placed between the IPv6 header and the T C P header.T he N ext H eader
ﬁeld in the IPv6 header indicates that the R outing header follows the IPv6
header and the N ext H eader ﬁeld in the R outing header indicates that the T C P
header immediately follows the R outing header.T he N ext H eader value of 59
indicates that there is no extension or upper-layer protocol header following the
current header.
A full implementation of IPv6 includes the following extension headers:
H op-by-H op O ptions, R outing (Type 0), Fragment, Destination O ptions,
Authentication, and Encapsulating Security Payload.T he recommended ordering
of extension headers when multiple extension headers are present in a packet is
as follows:
■
IPv6 header
■
H op-by-H op O ptions header
■
Destination O ptions header (to be processed by all destination nodes
appearing in the routing header)
■
R outing header
■
Fragment header
■
Authentication header
■
Encapsulating Security Payload header
■
Destination O ptions header (to be processed only by the ﬁnal destina-
tion of the packet)
■
U pper-layer header
Except for the Destination O ptions header, each extension header should
appear no more than once in a packet.T he Destination O ptions header contains
information to be processed by the ﬁnal destination node.W hen the R outing
header is present, an additional Destination O ptions header may be used for
options to be processed by all nodes listed in the R outing header; in this case, there
will be at most two occurrences of Destination O ptions headers in an IPv6 packet.
W hen an IPv4 packet carries an option that is applicable only to its destina-
tion node, all intermediate nodes must examine and process the packet before
forwarding, thus impacting the performance of the forwarding nodes.
www.syngress.com

The IPv6 Headers • Chapter 3
89
WARNING
Most often, routers are implemented such that packets containing
options are handled after packets without options. For this reason, the
use of options is discouraged in IPv4 networks.
Except for the H op-by-H op O ptions header, extension headers are examined
or processed only by the destination node (or nodes, in the case of multicast) of
the packet.T hus, an IPv6 packet may carry optional information applicable only
to its destination node without impacting the performance of the intermediate
nodes.T he H op-by-H op O ptions header can be used to carry optional informa-
tion that needs to be examined or processed at all intermediate nodes.
T he value of the N ext H eader ﬁeld in the current header determines the next
action to be taken, and the semantics of the current extension header determine
whether to continue processing the next header.T hus extension headers must be
examined in the order they appear in a packet.W hen a node receives an unrec-
ognized N ext H eader value in a packet, it discards the packet and sends an IC M P
Parameter Problem message to the source of the packet, with an IC M P C ode
value of 1— unrecognized N ext H eader type encountered. Because the H op-by-H op
O ptions header must immediately follow the IPv6 header, a N ext H eader value
of zero in any header other than IPv6 header will be treated as a packet with an
unrecognized N ext H eader value.
C urrently, the H op-by-H op O ptions header and the Destination O ptions
header carry a variable number of options encoded in Type-Length-Value (T LV)
format, as seen in Figure 3.3.
T he O ption Type identiﬁers are encoded in such a way that the highest-order
two bits specify the action to be taken when the processing node does not recog-
nize the O ption Type, and the third highest bit speciﬁes whether or not the
www.syngress.com
Figure 3.3 TLV-Encoded Option Format
Option Type
8 bits
Opt Data Len
8 bits
Option Data
variable length
Option Type
8-bit identifier of the type of option
Opt Data Len
8-bit unsigned integer. Length of the Option Data
field of this option, in octets.
Option Data
Variable-length field. Option-Type-Specific data.

90
Chapter 3 • The IPv6 Headers
O ption Data of that option can change en route to the packet’s ﬁnal destination.
For instance, when a node encounters an unknown O ption Type value of 130
(1000 0010), the highest-order two bits indicate that the node must discard the
packet and send an IC M P Parameter Problem, C ode 2, message to the source of
the packet.Table 3.2 describes the encoding of O ption Type.
Table 3.2 Option Type Encoding 
Highest-order 
two bits
Action to be taken
00
Skip over this option and continue processing the header.
01
Discard the packet.
10
Discard the packet and, regardless of whether or not the
packet’s Destination Address was a multicast address, send
an ICMP Parameter Problem, Code 2, message to the
packet’s Source Address, pointing to the unrecognized
Option Type.
11
Discard the packet and, only if the packet’s Destination
Address was not a multicast address, send an ICMP
Parameter Problem, Code 2, message to the packet’s Source
Address, pointing to the unrecognized Option Type.
Some O ption Type values may change as the packet progresses through the
route to its destination.T he third highest-order bit of the O ption Type is used to
indicate whether its data value can be changed en-route or not.T he third
highest-order bit is zero when O ption Data does not change en-route, and one
when it may change.T his can create problems for an authentication service, since
its purpose it to assure the contents of the packet do not change.W hen the
Authentication header is used, the source of the packet computes the authenti-
cating value over the packet and places the result in the Authentication header.
For an O ption Type whose O ption Data may change en route, the O ption Data
is treated as a set of zero-valued octets when computing the packet’s authenti-
cating value.
As stated before, extension headers are designed to be multiples of eight
octets in length.To ensure that the end of the option data ﬁeld is aligned with the
8-octet boundary, speciﬁc O ption Types may be associated with alignment
requirements in the form xn+y, indicating that the O ption Type must appear at
an integer multiple (n) of x octets from the start of the header, plus y octets. For
instance, a 4n+2 alignment requirement indicates that the O ption Type must start
www.syngress.com

The IPv6 Headers • Chapter 3
91
at any 4-octet offset from the start of the header, plus two octets, such as 2, 6, 10,
14, and so on.
Two padding options, the Pad1 option and the PadN  option, may be used to
force headers containing options to be multiples of eight octets in length.T he
Pad1 option is used to insert one zero-valued octet of padding, and the PadN
option is used to insert more than one octet of padding.T he format of the PadN
option is shown in Figure 3.4.To insert two octets of padding (Pad2), one octet
with the value of one and one octet (option data length ﬁeld) with the value of
zero can be used.T he Pad2 option is a special case in that there is no O ption
Data, or O ption Data of zero length is used.
Hop-by-Hop Options Header
T he H op-by-H op O ptions header, identiﬁed by a N ext H eader value of zero in
the IPv6 header, carries optional information that must be processed by every
node along a packet’s delivery path. For instance, it may be necessary for a router
to examine and process a packet containing control messages for new protocols,
such as R SV P .T he use of the H op-by-H op O ptions header allows routers to
selectively examine packets for special handling, if necessary.T he format of the
H op-by-H op O ptions header is shown in Figure 3.5. N ote that the header exten-
sion length ﬁeld is the length of the H op-by-H op O ptions header in 8-octet units,
not including the ﬁrst eight octets. In other words, when the length of the T LV-
encoded option(s) is less than or equal to six octets, the header extension length
ﬁeld is zero. Examples of H op-by-H op O ptions include the R outer Alert O ption
and Jumbo Payload O ption.
A call set-up control message using R SVP protocol needs special provisioning
at each router along the path of the connection. U sing the R outer Alert H op-by-
H op option, routers can provide special handling. Processing a H op-by-H op
option may result in processing an upper-layer protocol such as R SVP. R SVP is
a protocol used for end-to-end ﬂow control and is detailed in numerous R FC s.
U sing R SVP for ﬂow control and quality of services (Q oS) is a complex subject
that is just brieﬂy mentioned here to illustrate header processing.
www.syngress.com
Figure 3.4 PadN Option Format
1
8 bits
Opt Data Len
8 bits
Option Data
variable length
Opt Data Len
For N octets of padding, a value of N-2.
Option Data
For N octets of padding, N-2 zero-valued octets.

92
Chapter 3 • The IPv6 Headers
T he O ption Type of the R outer Alert option is 5 (00000101), indicating that
nodes not recognizing this option should skip it and continue processing the
header, and the O ption Data must not change its value en route.T he O ption
Length of the R outer Alert option is two; thus the valid range of the O ption
Data is 0 to 65535. C urrently, only 0, 1, and 2 have been deﬁned to indicate a
packet containing an IC M Pv6 Group M embership message, an R SVP message,
or an Active N etwork message, respectively. N o alignment requirement has been
associated with this option.
Figure 3.6 (a) illustrates a packet containing a R outer Alert H op-by-H op
O ption.T he value of the next header ﬁeld in the IPv6 header is zero, indicating
that a H op-by-H op O ptions header follows.All nodes in the path of this packet
are to examine and process this packet.T he next header ﬁeld of the H op-by-H op
O ptions header indicates the next header following this H op-by-H op header— a
T C P header in this sample packet.T he extension header length ﬁeld is zero since
there is only one option (the R outer Alter option), and the total length of the
T LV encoding of this option is four octets. Since there is no alignment require-
ment associated with this option, its T LV-encoded option is placed ﬁrst, and the
Pad2 O ption is used to make the length of this H op-by-H op O ptions header
exactly eight octets.
www.syngress.com
Figure 3.5 Hop-by-Hop Options Header
variable
Options
variable length
Next Header
8 bits
Hdr Ext Len
8 bits
Next Header
8-bit selector. Identifies the type of header
immediately following the Hop-by-Hop Options
header. Uses the same values as the IPv4
Protocol field [RFC-1700].
Hdr Ext Len
8-bit unsigned integer. Length of the Hop-by-Hop
Options header in 8-octet units, not including the
first 8 octets.
Options
Variable-length field, of length such that the
complete Hop-by-Hop Options header is an
integer multiple of 8 octets. Contains one or
more TLV-encoded options.
32 bits
1
8
16
24
32

The IPv6 Headers • Chapter 3
93
T he IPv6 header uses the 16-bit payload length ﬁeld, which limits the max-
imum length of a packet to 65536. H owever, advances in hardware have enabled
the transmission of a jumbogram, a packet with payload larger than 65536 octets.
T his option supports jumbograms up to 4,294,967,296 octets.W hen a path
M T U  can support payloads larger than 65535, this option may be used to
transmit jumbograms.
T he O ption Type of the Jumbo Payload O ption is 192 (1100 0010), indi-
cating that nodes not recognizing this option type must discard this packet and
send an IC M P, Parameter Problem, C ode 2, message to its sender (only if the des-
tination is not a multicast), and the O ption Data must not change en route.T he
option length ﬁeld of this option is four octets, and the O ption Data is the length
of the IPv6 jumbogram, not including the IPv6 header.W hen this option is used,
the payload length ﬁeld in IPv6 is set to zero.T his option has an alignment
requirement of 4n+2.
Figure 3.6 (b) illustrates a packet that includes the Jumbo Payload H op-by-
H op option.T he next header ﬁeld in the IPv6 header indicates that the H op-by-
H op O ptions header follows. N ote that the payload length ﬁeld in the IPv6 header
www.syngress.com
Figure 3.6 Packets with the Hop-by-Hop Options Header
(destination address)
(source address)
6
(ver)
(traffic cl.)
(flow label)
(hop limit)
0
(next hdr)
(payload length)
upper-layer protocol header
(TCP header, for example)
data
6
(next hdr)
0
(hdr len)
5
(op. type)
2
(op. len.)
1
(Pad2)
0
(Pad2)
32 bits
1
8
16
24
32
(option data)
(destination address)
(source address)
6
(ver)
(traffic cl.)
(flow label)
(hop limit)
0
(next hdr)
0
(payload length)
upper-layer protocol header
(TCP header, for example)
data
6
(next hdr)
0
(hdr len)
192
(op. type)
4
(op. len.)
32 bits
1
8
16
24
32
0x002A FFFF
(option data)
(a) Router Alert Option
(b) J umbo Payload Option

94
Chapter 3 • The IPv6 Headers
is set to zero.T he next header ﬁeld in this H op-by-H op options header indicates
that the next header is a T C P header.T he extension header ﬁeld has a value of zero
because the total length of the T LV-encoded Jumbo Payload option is six octets.
T he value of the O ption Data of this packet indicates that the payload of is
2,818,048 octets (0x002A FFFF). Since the end of the O ption Data is aligned
with an 8-octet boundary, no padding option is necessary.
T he processing of a Jumbo Payload option must detect several possible format
errors and send an appropriate IC M P Parameter Problem message if one is pre-
sent.T hese format errors include the absence of the Jumbo Payload option when
the IPv6 Payload and the IPv6 N ext H eader are both zero, the use of the Jumbo
Payload option when the IPv6 Payload is not zero, the use of the Jumbo Payload
option when the actual payload is less than 65,535, and the use of the Jumbo
Payload option when the Fragment H eader is present.
NOTE
The Fragment header uses the 13-bit fragment offset ﬁeld, in 8-octet
units, to indicate the offset of the fragmented data relative to the orig-
inal packet. In other words, the maximum offset can be the 65536th
octet. Therefore, it makes little or no sense to use the Jumbo Payload
option and Fragment header at the same time.
Routing Header
T he R outing H eader, identiﬁed by a N ext H eader value of 43 in the header
immediately preceding it, allows an IPv6 source to determine routes to reach its
destination by listing one or more intermediate nodes to be visited. (T his is very
similar to IPv4’s Loose Source and R ecord R oute options.) T he format of the
R outing H eader is shown in Figure 3.7.
W hen a node encounters an unrecognized R outing Type, and the value of
segment left is zero, it ignores the R outing header and continues to process the
next header. H owever, if Segment Left is not zero, a node discards the packet and
sends an IC M P Parameter Problem, C ode 0, message to the packet’s Source
Address. C urrently, only Type 0 has been deﬁned; Figure 3.8 shows the format of
a Type 0 R outing header.
O ne application of the Type 0 R outing header is in supporting new proto-
cols, such as R SVP.
www.syngress.com

The IPv6 Headers • Chapter 3
95
www.syngress.com
Figure 3.7 Routing Header
variable
type-specific data
variable length
Next Header
8 bits
Hdr Ext Len
8 bits
Next Header
8-bit selector. Identifies the type of header immediately following the Routing
header. Uses the same values as the IPv4 Protocol field [RFC-1700].
Hdr Ext Len
8-bit unsigned integer. Length of the Routing header in 8-octet units, not  
including the first 8 octets.
Routing Type
8-bit identifier of a particular Routing header variant.
Segments Left
8-bit unsigned integer. Number of route segments remaining, i.e., number of  
explicitly listed intermediate nodes still to be visited before reaching the  
final destination.
type-specific data
Variable-length field, of format determined by the Routing Type, and of length 
such that the complete Routing header is complete Routing header is an integer 
multiple of 8 octets.
Routing Type
8 bits
Segments Left
8 bits
32 bits
1
8
16
24
32
Figure 3.8 Type 0 Routing Header
24 octets
Reserved
Next Header
Hdr Ext Len
Next Header
8-bit selector. Identifies the type of header immediately following the Routing 
header. Uses the same values as the IPv4 Protocol field [RFC-1700].  
Hdr Ext Len
8-bit unsigned integer. Length of the Routing header in 8-octet units, not
including the first 8 octets. For the Type 0 Routing header, Hdr Ext Length
is equal to two times the number of addresses in the header.
Routing Type
0
Segments Left
8-bit unsigned integer. Number of route segments remaining, i.e., number  
of explicitly listed intermediate nodes still to be visited before reaching 
the final destination.
Reserved
32-bit reserved field. Initialized to zero for transmission; ignored on reception.
Address[1...n]
Vector of 128-bit addresses, numbered 1 to n.
Routing Type
Segments Left
Address[1]
Address[n]
16 octets
32 bits
1
8
16
24
32

96
Chapter 3 • The IPv6 Headers
In R SVP, a connection path may be established whereby all packets
belonging to that connection follow the same path to reach the destination.T he
source of this connection may then use a Type 0 R outing header to specify the
path to its destination.
Another use of a R outing header is to communicate with a mobile node
away from its home network without triangle routing.W ithout R oute
O ptimization, which may or may not be supported, packets may have to be sent
to the mobile node’s home network and be forwarded by the home agent (cre-
ating triangle routing) when a mobile node is away from its home network.T he
source of such a connection can specify the path using a Type 0 R outing header
in order to allow the source of a connection to specify its path and avoid triangle
routing.
For the connection between source node s and destination node d via routers
r1 and r2, source node s creates an IPv6 packet with a routing header, as shown
in Figure 3.9(a). N otice that the destination ﬁeld is r1, the ﬁrst router in the path,
rather than the ﬁnal destination node d. R ecall that except for the H op-by-H op
O ptions header, all other extension headers are examined only by the packet’s
destination node. Since router r1 is the destination of this packet, after examining
the IPv6 header, it will continue to process the next header as indicated by the
N ext H eader ﬁeld. In this case, the R outing header will be processed by router r1.
T he extension header length ﬁeld has a value of four, indicating that the length
of the R outing header is four 8-octet sets, not counting the ﬁrst eight octets.T he
value of four is also twice the number of addresses in this R outing header (two,
as indicated in the segments left ﬁeld).T he ﬁrst address in the R outing header is
the next router in the path, r2, followed by the ﬁnal destination node d.
R outer r1 decrements the segments left ﬁeld and swaps the values of the desti-
nation ﬁeld in the IPv6 header and the ﬁrst address in the R outing header. Figure
3.9 (b) shows the packet sent from router r1 to router r2. Similarly, after exam-
ining the IPv6 header, router r2 continues to process the R outing header, since
the destination ﬁeld of the IPv6 header is r2.Again, router r2 decrements the seg-
ment left ﬁeld and swaps the values in the destination ﬁeld of the IPv6 header and
the second address in the R outing header, as shown in Figure 3.9(c).W hen pro-
cessing the R outing header, the index of the address to visit can be computed
using the header extension length and the segment left ﬁelds:
(Header Extension Length ÷ 2) – (Segment Left + 1)
www.syngress.com

The IPv6 Headers • Chapter 3
97
W hen the Segment Left value reaches zero, the node handling this R outing
header proceeds to process the next header in the packet, whose type is identiﬁed
in the next header ﬁeld in the R outing header.
NOTE
The Type 0 Routing header is processed by all nodes appearing in the
address ﬁeld, and each node decrements the segment left ﬁeld and
swaps the values in the destination ﬁeld in the IPv6 node and the
address. Thus, multicast addresses must not appear in the address of the
Type 0 Routing header or in the IPv6 destination ﬁeld of a packet con-
taining the Routing header.
W hen processing the Type 0 R outing header, format checking is performed.
R ecall that the H eader Extension length is two times the number of addresses in
the R outing header.T hus, the H eader Extension length must not be odd.A node
processing this packet discards the packet and sends an IC M P Parameter Problem,
C ode 0, message to the source node. Since the H eader Extension length is two
www.syngress.com
Figure 3.9 Packets with a Routing Header
data
d
r1
0
r2
s
6
43
upper-layer
protocol
header
data
d
r2
0
6
4
0
2
r1
s
6
43
data
r2
r1
0
d
s
6
43
(a) between
s and r1
(b) between
r1 and r2
(c) between
r2 and d
r2
s
d
r1
upper-layer
protocol
header
upper-layer
protocol
header
6
4
0
0
6
4
0
1

98
Chapter 3 • The IPv6 Headers
times the number of addresses in the R outing header, the largest value in the 
segment left ﬁeld cannot be more than half of the H eader Extension length. If the
Segment Left value is larger, the node handling the packet also discards this
packet and sends an IC M P Parameter Problem, C ode 0, message to the source.
Fragment Header 
T he 16-bit total length ﬁeld in the IPv4 header limits the maximum size of a packet
to be 64k bytes. H owever, depending on the link technology used, the actual size of
a packet may be further limited. In IPv4 packet transmission, each IP layer is
responsible for fragmenting packets, if necessary, to ensure that the packet size does
not exceed the maximum transmission unit.T hus, the user data sent in a single
packet from a source node may arrive at the destination node in multiple packets if
there is a link whose M T U  is smaller than the link M T U  at the source node.T his
approach, however, may not be the most optimal solution for the path.
www.syngress.com
Packet Fragmentation Overhead
Consider an application that transfers a segment of 3000 bytes at a reg-
ular interval, where the link MTU at the source is 3000 bytes. The next
link MTU is 1500 bytes; thus, a packet is fragmented into two packets of
1500 bytes each. However, the following link MTU is 1000 bytes. Then
each of 1500-byte packets will be further fragmented into two packets,
1000 bytes and 500 bytes, for a total of four packets. If the path MTU
had been known at the source, the source node would have fragmented
the 3000 bytes in three packets. In IPv6’s implementation of fragmenta-
tion, the source node discovers the lowest MTU in the end-to-end path
and performs any fragmentation necessary.
In general, fragmentation involves high overhead, so the use of
fragmentation should be discouraged. (In IPv4, the overhead involved in
the transmission of 3000 bytes is 20 bytes for an IP header alone,
without options. The overhead is higher when upper-layer protocol
header overhead is considered.) Links with conﬁgurable MTUs (e.g. PPP
links) should conﬁgure their MTU to at least 1280 octets, which is the
required MTU in IPv6.
Designing & Planning…

The IPv6 Headers • Chapter 3
99
In IPv6, only source nodes perform fragmentation.A source node ﬁrst ﬁnds
the path M T U  and then segments the fragmentable part of the original packet so
that the length of each fragmented packet does not exceed the path M T U.
Before fragmentation, the original packet consists of two parts: the unfrag-
mentable part and fragmentable part.T he IPv6 header and any extension headers
that need to be processed at each hop on the way to the destination are unfrag-
mentable, and extension headers processed only by the ﬁnal destination node (or
nodes in the case of multicast) are considered to be fragmentable.
T he H op-by-H op O ptions header is always unfragmentable, since it must be
processed by each hop in the path.T hus when the H op-by-H op O ptions header
is present, the unfragmentable part of the original packet includes the IPv6
header and the H op-by-H op O ptions header. W hether the Destination O ptions
header is fragmentable depends on whether there is a R outing O ptions header. If
there is no R outing O ptions header, the Destination O ptions header is frag-
mentable, since it only needs to be processed by the ﬁnal destination. If there is a
R outing O ptions header, the Destination O ptions header is unfragmentable, since
it will need to be processed by every node appearing in the R outing header.
T he Fragmentation header is identiﬁed by a N ext H eader value of 44 in the
immediately preceding header. Figure 3.10 shows the format of the Fragmentation
header.T he source node generates a unique 32-bit identiﬁer for every fragmented
packet sent to the same destination. Except for the last fragmented packet, the frag-
mentable part of the original packet is divided so that each fragmented part is of a
length that is an integer multiple of eight octets.T he fragment offset ﬁeld is used to
www.syngress.com
Figure 3.10 The Fragmentation Header
8 octets
Identification
Next Header
8 bits
Reserved
8 bits
Next Header
8-bit selector. Identifies the initial header type of the fragmentable part of the 
original packet. Uses the same values as the IPv4 Protocol field [RFC-1700].
Reserved
8-bit reserved field. Initialized to zero for transmission; ignored on reception.
Fragment Offset
13-bit unsigned integer. The offset, in 8-octet units, of the data following
this header, relative to the start of the fragmentable part of the original packet.
Res
2-bit reserved field. Initialized to zero for transmission; ignored on reception.
M flag
1 = more fragments; 0 = last fragment.
Identification
32-bit identifier
Fragment Offset
13 bits
Res
M
32 bits
1
8
16
24
32

100
Chapter 3 • The IPv6 Headers
indicate the offset of the data following this Fragmentation header relative to the
start of the Fragmentable part of the original packet.
C onsider the packet shown in Figure 3.11 (a).T his packet needs to be further
fragmented by the source node because its path M T U  is 1514 bytes.T he unfrag-
mentable part of the original packet in this example includes the IPv6 header and
the R outing header (the N ext H eader of the IPv6 is 43).T he original packet is
broken into three parts. Since the Ethernet header is 14 bytes, the IPv6 packet
including the IPv6 header cannot be longer than 1500 bytes. Since the IPv6
header is 40 bytes, the headers and data after the IPv6 header cannot be longer
than 1460 bytes.T he R outing header contains two destinations (router 2 and the
destination), so its length will be 40 bytes. Since the R outing header is part of
the unfragmented part, each fragment includes the R outing header, so the
headers and data after the R outing header cannot be longer than 1420 bytes.
Further, the Fragmentation header (eight octets) is added, leaving 1412 bytes for
user data. H owever, the fragmentation offset ﬁeld in the Fragmentation header iden-
tiﬁes the number of 8-octet units of user data.T hus the user data must be a mul-
tiple of eight octets. Since 1412 is not a multiple of eight octets, the maximum
size of the fragmentable part of the original packet is limited to 1408 (176 8-
octet units).T his explains the value of 1456 in the payload length ﬁeld in the IPv6
H eader of the ﬁrst fragmentation as shown in Figure 3.11 (b) (1408 of user data
+ 8 for the Fragmentation header + 40 for the R outing header).
T he next header ﬁeld in the R outing header of each fragment (Figure 3.11
(b), (c), and (d)) has a value of 44, indicating that the next header following this
R outing header is the Fragmentation header.T he next header ﬁeld in the ﬁrst
fragment is 6, indicating that the upper-layer protocol header (T C P) follows this
Fragmentation header. H owever, the next header ﬁeld in each of the other two
fragments is 59, indicating that there are no more headers following this
Fragmentation header. In this example, the hexadecimal 0x12345678 is used to
indicate that the same identiﬁer is used for all fragments.T he fragmentation offset
ﬁeld is used to indicate the offset, in 8-octet units, of the data following the
Fragmentation header, relative to the start of the fragmentable part of the original
packet.T hus, the Fragmentation offset in Figure 3.11 (c) indicates that the data
following this Fragmentation header should be positioned in the 1768 byte in the
fragmentable part when reassembled at the destination node.
www.syngress.com

The IPv6 Headers • Chapter 3
101
Authentication Header
In an IP network (both IPv4 and IPv6), the Authentication header is used to
provide integrity and data origin authentication for IP packets and to protect
against replays. In this section, we will provide terms based on an IPv6 network.
T he Authentication header provides authentication for the IPv6 header, upper-
layer protocol headers and user data, and IPv6 extension header ﬁelds that may
not change en route. For instance, the destination address ﬁeld in the IPv6 header
changes at every hop when the Type 0 R outing header is used, so in this case the
Authentication H eader cannot provide the authentication of the destination address
ﬁeld. Figure 3.12 shows the format of the Authentication H eader.
N ote that the payload length ﬁeld is in a 4-octet unit (32-bit word), not
including the ﬁrst eight octets (or two units of four octets each).
www.syngress.com
Figure 3.11 Fragmentation Example
43
upper-layer
protocol
header
data
destination
router 2
0
44
4
0
2
router 1
source
6
6
0
0
0 1
0x12345678
1456
43
data
destination
router 2
0
44
4
0
2
router 1
source
6
59
0
352
0 0
0x12345678
94
43
(b) first
fragment
packet
(c) second
fragment
packet
(d) third
fragment
packet
data
destination
router 2
0
44
4
0
2
router 1
source
6
59
0
176
0
1
0x12345678
1456
43
upper-layer
protocol
header
data
destination
router 2
0
6
4
0
2
router 1
source
2902
6
(a) original
packet
43

102
Chapter 3 • The IPv6 Headers
NOTE
All other IPv6 header extension lengths are encoded by measuring the
header length in 8-octet units, then subtracting one (since the ﬁrst eight
octets are not counted).
T hus with a 96-bit Authentication Data value, the payload length will be
four. For debugging purposes, the N ull Authentication algorithm may be used. In
this case, the value of the payload length ﬁeld will be two.
T he sequence number ﬁeld is used to provide protection against anti-replay.
W hen a Security Association is established between source and destination nodes,
counters at the sending and receiving ends are initialized to zero. It is mandatory
for the sender to increment this ﬁeld for every transmission; however, the receiver
www.syngress.com
Figure 3.12 The Authentication Header
variable
Security Parameters Index (SPI)
32 bits
Next Header
8 bits
Payload Len
8 bits
Next Header
8-bit selector. Identifies the type of header immediately following
the Authentication header. Uses the same values as the
IPv4 Protocol field [RFC-1700].
Payload Len
8-bit unsigned integer. Length of the Authentication header in
4-octet units, not including the first eight octets.
Reserved
16-bit reserved field. Initialized to zero for transmission; ignored
on reception.
Security Parameter Index
32-bit unsigned integer. Combination of this field, destination address,
and security protocol identifies the Security Association for this packet.
Sequence Number
32-bit unsigned integer. Monotonically increasing counter value.
Authentication Data
Variable-length field containing the Integrity Check Value (ICV) for this
packet. This field must be an integral multiple of eight octets in length.
Reserved
16 bits
Sequence Number Field
32 bits
Authentication Data
variable
32 bits
1
8
16
24
32

The IPv6 Headers • Chapter 3
103
may elect not to process the transmission.T his service is effective only if the
receiver processes this ﬁeld.
T he authentication data ﬁeld contains the Integrity C heck Value (IC V) for the
packet.T he authentication algorithm, selected when the Security Association is
established between the sender and the receiver, speciﬁes the length of the IC V,
the comparison rules, and the necessary processing steps.T his value is computed
over the packet by the source node and veriﬁed by the destination node, which
compares the value to its own recomputed value.
T he Authentication header may be applied in transport or tunnel mode.T he
transport mode Authentication header, implemented in hosts, provides protection
for the upper-layer protocol header and any ﬁelds in the IPv6 header, as well as
extension headers that do not change in transit.T he tunnel mode Authentication
header is applied to the original IPv6 packet, encapsulating the original packet by
constructing a new IPv6 packet that uses a distinct IPv6 addresses, such as a secu-
rity gateway.
In transport mode, the Authentication header is viewed as an end-to-end pay-
load and is placed after the IPv6 header and H op-by-H op, R outing, and
Fragmentation extension headers. R ecall that the Destination O ptions header
may appear once before the R outing header, as the options in the Destination
O ptions header are applicable to intermediate nodes speciﬁed in the R outing
header. In this case, the Authentication header comes after the Destination
O ptions header, as shown in Figure 3.13.
In tunnel mode, the Authentication H eader is applied to the original IPv6
packet using distinct IPv6 addresses as communication end points, and a new
IPv6 header is constructed using addresses of security gateways for source and
www.syngress.com
Figure 3.13 Header Order with Authentication Header in Transport Mode
IPv6
header
extension
headers,
if any
upper layer
protocol
header
data
IPv6
header
extension
headers*
upper layer
protocol
header
data
destination
options
header
authentication
header
* Hop-By-Hop Options, Destination Options, Routing and Fragmentation headers
apply authentication header

104
Chapter 3 • The IPv6 Headers
destination addresses. Fragmentation processing may be necessary after applying
the Authentication header; thus a newly constructed IPv6 packet may undergo
further processing. Figure 3.14 shows the order of headers after applying the
Authentication header in tunnel mode.
Encapsulating Security Payload
T he Encapsulating Security Payload header, used in transport mode or in tunnel
mode, also provides security services in both IPv4 and IPv6 networks.T he secu-
rity services provided through the Encapsulating Security Payload include conﬁ-
dentiality, authentication (data origin authentication and connectionless
integrity), an anti-replay service, and limited trafﬁc ﬂow conﬁdentiality.T he
implementation and options chosen at the time the Security Association is estab-
lished determine the security services provided.
As in the case of the anti-replay service provided by the Authentication
header, the source increments the Sequence N umber; however, the destination
node must check this ﬁeld to enable the anti-replay service.To provide trafﬁc
ﬂow conﬁdentiality service, true source and destination information should be
hidden.T hus, this service requires that the Encapsulating Security Payload header
be used in a tunnel mode.
Figure 3.15 shows the format of the Encapsulating Security Payload header.
T he N ext H eader value of 50 in the immediately preceding header indicates that
the Encapsulating Security Payload header processing is necessary.
T he mandatory payload data ﬁeld contains encrypted data described by the
next header ﬁeld.T he encryption algorithm used speciﬁes the length and the loca-
tion of the structure of the data within the payload data ﬁeld. Padding may be
necessary to fulﬁll the encryption algorithm requirement of the length of the
plain text or the 4-octet boundary alignment of the payload data ﬁeld.
www.syngress.com
Figure 3.14 Header Order with Authentication Header in Tunnel Mode
IPv6
header
extension
headers,
if any
upper layer
protocol
header
data
new
IPv6
header
extension
headers,
if any
upper layer
protocol
header
data
authenti-
cation
header
orig.
IPv6
header
extension
headers,
if any
apply authentication header

The IPv6 Headers • Chapter 3
105
Figures 3.16 and 3.17 illustrate the sequence of an IPv6 packet with its
encrypted portion when Encapsulating Security Payload headers are used in
transport mode and tunnel mode, respectively.
www.syngress.com
Figure 3.15 The Encapsulation Security Payload Header
Authentication Data
variable length
Next Header
8 bits
Pad Length
8 bits
32 bits
1
8
16
24
32
Security Parameters Index (SPI)
32 bits
Sequence Number
32 bits
Payload Data
variable length
Padding
0-255 octets
Security Parameter Index
32-bit unsigned integer. Combination of this field, destination
address, and Security Protocol (ESP) identifies the Security
Association for this packet.
Sequence Number
32-bit unsigned integer. Monotonically increasing counter value.
Payload Data
Variable-length field containing data described by the Next Header field.
Padding
Variable-length field containing 0 to 255 octets of 8-bit padding.
Pad Length
8-bit unsigned integer. Indicates the number of pad octets immediately preceding it.
Next Header
8-bit selector. Identifies the type of data contained in the Payload Data.
Authentication Data
Variable-length field containing the Integrity Check Value (ICV)
computed over the ESP packet minus the Authentication Data.
Authentication Coverage
Confidentiality Coverage
Figure 3.16 Header Order with Encapsulating Security Payload in 
Transport Mode
IPv6
header
extension
headers,
if any
upper layer
protocol
header
data
IPv6
header
extension
headers*
upper layer
protocol
header
data
ESP
header
destination
options
header
ESP
trailer
* Hop-By-Hop Options, Destination Options, Routing and Fragmentation headers
ESP
auth
encrypted
authenticated
apply authentication header

106
Chapter 3 • The IPv6 Headers
Destination Options Header
A source node may need to convey optional information that needs to be pro-
cessed by a destination node. For instance, when a mobile node is away from its
home network, a home agent (such as a router at the home network) may be a
proxy forwarding packets to the mobile node.A mobile node away from its home
network needs to send control messages to its home agent so that the home
agent can set up the proxy service and forward packets destined for the mobile
node to its current address. In an IPv4 network, a packet that contains options in
the IPv4 header will be subject to an examination at every hop on the path.
In an IPv6 network, such optional messages can be handled efﬁciently using
either an extension header dedicated for handling speciﬁc optional information
or using the Destination O ptions header. Packet fragmentation or authentication
information is handled as an extension header, as shown previously.T he IPv6
M obility Support Internet-Draft proposes four Destination O ptions to support
M obile IPv6.
T he optional information may be encoded either in a separate extension
header or in the Destination O ptions header, based on the desired action to be
taken at the destination node when the node does not recognize the option.
O ptional information that requires a few octets to send an IC M P U nrecognized
Type message to the sender only if the destination node is not a multicast address
may be encoded in a separate extension header.
T he Destination O ptions header, identiﬁed by a N ext H eader value of 60 in
the immediately preceding header, carries optional information that needs to be
examined and processed only by a packet’s destination node (or nodes, in multi-
cast).T he format is shown in Figure 3.18.
www.syngress.com
Figure 3.17 Header Order with Encapsulating Security Payload in Tunnel Mode
IPv6
header
extension
headers,
if any
upper layer
protocol
header
data
new
IPv6
header
new
ext
headers
upper layer
protocol
header
data
ESP
header
original
IPv6
header
ESP
trailer
ESP
auth
encrypted
authenticated
apply authentication header
original
ext
headers

The IPv6 Headers • Chapter 3
107
www.syngress.com
Figure 3.18 The Destinations Options Header
variable
Options
variable length
Next Header
8 bits
Hdr Ext Len
8 bits
Next Header
8-bit selector. Identifies the type of header immediately following the Destination
Options header. Uses the same values as the IPv4 Protocol field [RFC-1700].
Hdr Ext Len
8-bit unsigned integer. Length of the Destination Options header in 8-octet units,
not including the first 8 octets.
Options
Variable length field, of length such that the complete Destination Options header
is an integer multiple of 8 octets. Contains one or more TLV-encoded options.
32 bits
1
8
16
24
32

108
Chapter 3 • The IPv6 Headers
Summary
T he IPv6 header strikes a delicate balance between being small and efﬁcient (the
standard IPv6 header), yet also supporting the many legacy and new variations
needed within IP (the extension headers).T he IPv6 header and extension headers
maintain lengths in multiples of eight octets wherever possible.T his provides
maximum efﬁciency for today’s 64-bit architectures.
T he design of IPv6 places considerable importance on the future by dedi-
cating 28 bits of the standard header to Q oS-related ﬁelds.T his includes the 8-bit
trafﬁc class and 20-bit ﬂow label.T he ﬂow label ﬁeld may not always be explicitly
used for Q oS— it may simply be used to identify a particular ﬂow of trafﬁc
within the network. H owever, it is likely that the network will often identify
ﬂows to perform some type of preferential service. Even though the IPv6 deﬁni-
tion does not completely detail the exact uses of these ﬁelds, it is understood
these will be important in the future.
T he payload length ﬁeld in IPv6, as in IPv4, is 16 bits long.T his allows a
packet to be as large as 64K  bytes.Although 64K  bytes may be too large to be
practical, it provides substantial ﬂexibility to increase the maximum packet size
over today’s de facto standard of 1514 bytes. Even packets as large as 5K  or 10K
bytes would reduce packet overhead and transfer data more quickly and efﬁ-
ciently.As for the concern of large packets occupying a link for too long and
delaying time-sensitive trafﬁc, most ISP links operate at such a high speed that 5K
or 10K  packets take very little time to transport. For slower links, the M T U  can
be set lower.T his will force nodes to transmit in smaller sizes (such as 1514
bytes), allowing time-sensitive packets to be sent in a timely manner. O f course,
the Ethernet M T U  will need to be increased before widespread use of larger
packet sizes becomes a reality.
T he IPv6 header maintains the most useful features of the IPv4 header while
getting rid of outdated or unused features.T he payload length, version, N ext H eader,
and hop limit ﬁelds are taken almost directly from the IPv4 header, making the
IPv6 header familiar and fairly easy to understand for anyone who is familiar
with the IPv4 header.
C ertain needed but rarely used features like fragmentation have been moved
to their own optional headers in IPv6. In this way, fragmentation remains avail-
able without burdening the vast majority of IPv6 packets that don’t require it.
Similarly, other IPv4 options (and some new options) have been redesigned as
extension headers, to be used only if required.
www.syngress.com

The IPv6 Headers • Chapter 3
109
IPv4 ﬁelds that would not be useful in IPv6 were dropped, including header
length and header checksum.
IPv6 implements a variety of extension headers.Two of these headers, H op-
by-H op O ptions and R outing, are speciﬁcally designed to be easily processed by
all nodes in a path.T his will become useful if path-speciﬁc protocols such as
R SVP become widespread.T hey can also be useful for protocols such as multi-
cast, where you may want to indicate to all the routers in a path that multicast
trafﬁc is or is not desired.
IPv6 created a Destinations header speciﬁcally designed to deliver informa-
tion to the destination node. M uch like the trafﬁc class and ﬂow label, the details
of this header were not all originally deﬁned in IPv6. Instead, IPv6 created a ﬂex-
ible framework (the Type-Length-Value option) for options and features to be
easily added in the future.
Two other extension headers,Authentication and Encapsulation Security
Payload, provide various security services.T hese are very similar to the
Authentication and Encapsulation Security Payload protocols used in IP Security
(IPSec) today, but they are implemented as extension headers in IPv6.T his famil-
iarity should allow these to be easily implemented and quickly adopted in IPv6.
W ith IPv6’s 128-bit available address space, IPv6 addresses should be plentiful.
T his has obvious beneﬁts, since obtaining IPv6 address blocks should be easy.T he
large number of IPv6 addresses will also allow companies to assign legitimate
IPv6 addresses to every internal node, should they desire. O ne advantage of this is
that it will allow security headers, such as the Authentication header, to protect
integrity of the IPv6 packet.Today most packets sent across the Internet (when
you want the most security) go through at least one N AT  process.T his changes
the source IP address and makes full authentication difﬁcult, if not impossible.
W ith IPv6’s plentiful address space N AT  should not be required, allowing the
Authentication header to better protect packets.
Solutions Fast Track
Analyzing the IPv6 H eader
 T he IPv6 header reserves two ﬁelds (totaling 28 bits) for prioritizing
and/ or identifying packets and packet ﬂows that require special handling,
such as prioritization.As real-time applications such as video and voice
become more prevalent, these ﬁelds should be heavily used.
www.syngress.com

110
Chapter 3 • The IPv6 Headers
 T he N ext H eader ﬁeld in IPv6 uses the same deﬁnitions used in IPv4
(and deﬁned in R FC  1700).T hus T C P uses “6,” U DP uses “17,” and 
so on.
 Immediately following the destination IPv6 address is the next header—
an IPv6 extension header, an upper-layer protocol header, etc.
C omparing the IPv6 and IPv4 H eaders
 Source and destination IPv6 addresses are four times as long as IPv4
addresses (128 bits versus 32 bits)
 T he IPv4 header adds optional functions within the header in the options
ﬁeld. IPv6 has a completely ﬁxed header, but adds extension headers for
optional functions such as routing, fragmentation, or authentication.
 In IPv6, many IPv4 ﬁelds were maintained, a few were added, and
several were dropped (or changed to extension headers)
T he IPv6 Extension H eaders
 Different extension headers were created based on the nodes that would
need to examine and process them. For example, the Destination H eader
and Fragmentation H eaders were created strictly for viewing by the
endpoint, whereas the R outing and H op-by-H op H eaders were created
to be viewed by all routers along the path.T his improves efﬁciency, since
some headers do not need to be processed by intermediate routers.
 Authentication and Encryption are incorporated into the IPv6 standard
as extension headers, supporting the need for increased security in the
digital world.
 Although the Fragmentation header is part of the IPv6 standard, its use
is discouraged. In reality, it will likely get very little use.
www.syngress.com

The IPv6 Headers • Chapter 3
111
Q: Since the routing header can control the path of a packet, can it be used to
optimize the path used between a client and server?
A: W hile in theory this could be done, in reality it will probably be used only in
conjunction with protocols such as R SVP.T his is primarily because without
R SVP (or an equivalent protocol), the client and the server will not be aware
of the underlying network infrastructure. Instead, this feature will most likely
be used by mobile users or for diagnostic purposes by network management
applications that will allow you to control the ﬂow of the packet for testing
purposes.
Q: Doesn’t the IPv6 header create more overhead— and thus less efﬁciency—
than IPv4?
A: T he IPv6 header is larger and does add more overhead to each packet than
IPv4.Assuming there are no options or extensions, the standard IPv6 header
is 40 bytes, while the standard IPv4 header is only 20 bytes. So IPv6 adds 20
bytes to the header, but with IPv6 there are 24 more bytes just in the source
and destination addresses (32 bytes versus 8 bytes).W ithout the larger source
and destination addresses, the IPv6 header is smaller than IPv4. H owever,
given the shortage of IPv4, I think there is a good argument for increasing
the size of IPv6 addresses.
Q: I see that IPv6 supports packets up to 64 K B, or— with the H op-by-H op
O ptions header— even much larger packets. Is this feature likely to be used?
A: Larger packets have advantages, such as reduced processing at the end nodes.
H owever, packet sizes larger than 1514 bytes have been proposed in the
industry several times and have received surprisingly little support. O ne pre-
vious opposing point was that network designers did not want a very large
packet to “clog” a slower link, preventing time-sensitive trafﬁc (such as video
or voice) to pass in a timely manner.As WAN  speeds are increasing over time,
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

112
Chapter 3 • The IPv6 Headers
this is becoming less of a problem. O ver time this may become a common
option, but I do not anticipate this feature being used in the near future.
Q: M any of the extension headers have ﬁelds where options can be added— why
are only a few of those discussed here?
A: T he current IPv6 speciﬁcation, R FC  2460, wanted to create a framework that
would be ﬂexible enough to support changes over time.As such, they deﬁned
several extension headers, most with ﬁelds for options, yet they did not deﬁne
many of these options. R ather, they wanted these to be further deﬁned in later
R FC s as the needs and requirements of IPv6 became more clear. M ost of these
options are still evolving and being reﬁned as more and more users adopt IPv6.
Q: Since IPv6 will often be sent over Ethernet (which has its own packet
checksum), and it frequently delivers T C P data (which uses a checksum), is
the authentication header necessary?
A: In many cases the Authentication header will not be used. H owever, in envi-
ronments requiring higher levels of security, the Authentication header is still
useful.T he Ethernet and T C P checksums use open, well-known methods for
calculating the checksum.T hus, in theory, someone could alter the packet and
calculate the new, correct checksum. M ore importantly, though, the authenti-
cation header provides end-to-end protection from changes for the IPv6
packet (as opposed to relying on Ethernet or T C P). It also provides additional
beneﬁts, such as anti-replay protection— anti-replay is a real threat, especially
if someone uses a sniffer on the original conversation).
Q: In today’s Internet it is not unusual for packets to traverse different paths,
even between the same two endpoints.Wouldn’t this make it difﬁcult for an
IPv6 source node to effectively use M T U  discovery and be sure they had
correctly detected the smallest M T U ?
A: W hile today’s packets do take different paths, it is unlikely this condition will
create a problem in the future. Packet sizes today are standardized at 1514
bytes, even in IPv6 environments. Should the M T U  of Internet links increase
(creating a possible M T U  problem), it is likely all link M T U s would increase
at approximately the same time (or at the very least, all links within an ISP).
T his would help to minimize the problem. If this is not the case, potential
problems could occur, since intermediate routers do not have the ability to
fragment a packet the way IPv4 routers do today.
www.syngress.com

Explaining IPv6
Addressing
Solutions in this chapter:
■
The Basics of IPv6 Addressing
■
IPv6 Addressing Scheme Characteristics
■
The Need for Further Development
Chapter 4
113
 Summary
 Solutions Fast Track
 Frequently Asked Questions

114
Chapter 4 • Explaining IPv6 Addressing
Introduction
T he explosion of Internet growth has created a severe depletion of the current
Internet Protocol v4 (IPv4) address space.T he current IPv4 address space mainly
serves the address requirements for the PC  computer market in today’s service
provider and enterprise business markets. H owever, the development of new mar-
kets has required networks to support an increasing variety of network attach-
ments, including mobile IP elements such as wireless and infrared devices and IP
phones.T his expansion of the market drives the need for a substantially larger IP
address space. R outing and addressing using the IPv4 address space has become
increasingly constrained, and as the Internet has grown, inefﬁciencies have arisen
in the capability to deploy a hierarchal infrastructure that promotes address aggre-
gation.T he utilization of C lassless Inter-Domain R outing (C IDR ) has extended
the lifetime of the IPv4 address space considerably, but it is increasingly evident
that the current IPv4 address space will be depleted in the near future. IPv6 rep-
resents the next generation of Internet protocol that can meet both the current
addressing requirements and those generated by emerging markets.
IPv6 addresses are much different from IPv4 addresses from both an
addressing structure and aggregation and routing functionality.T hese differences
require designers of supporting protocols to re-design the operations of the pro-
tocols.T he mapping of addresses to hostnames via the Domain N ame System
(DN S) has been updated and is becoming increasingly more important as IPv6
starts to become widely used. M anagement protocols such as Simple N etwork
M anagement Protocol (SN M P) will change to accommodate IPv6. Internet
C ontrol M essage Protocol (IC M P) has been updated to IC M Pv6 to support the
monitoring and troubleshooting of IPv6 networks.
T he task of modifying and updating network equipment to support the new
protocol is daunting.T he scope of modiﬁcation needed and the time it will take
to fully implement the necessary changes will require not only a huge amount of
planning, but also a thorough understanding of exactly how IPv6 works and how
addressing is handled.
T his chapter explains the key concepts related to IPv6 addressing, including
IPv6 address syntax, the address space, the types of addresses (unicast, multicast,
anycast), preﬁxes and subnetting, address assignment (where to get addresses:
T LA/ N LA/ SLA, and so on), link-local/ site-local addressing, the unspeciﬁed
address, the loopback address (of course), and any other appropriate addressing
topics.T his chapter also gives a short introduction to the history and develop-
ment of the IPv6 protocol, through its current accepted form.
www.syngress.com

www.syngress.com
We will look at some of the key aspects of IPv6 that separate the protocol
from IPv4, and look into the beneﬁts that we can gain by utilizing IPv6 and its
addressing schemas to build a more scalable network. From there, we can begin
to build real-world examples of how this addressing can be deployed in Internet-
connected networks to come.
Finally, we will look into some of IPv6’s yet unsolved issues, and some of the
proposed solutions to cope with them.Also in this section, we will give a brief
introduction to the IPv6 test network, the 6Bone.
The Basics of IPv6 Addressing
By the early 1990s, it was clear that the Internet was going to take off.T he
average person was becoming aware of its existence, and the killer-apps of today
(Web browsers) were coming into their own.Address space delegations increased
at an alarming rate, and it was clear that the Internet Protocol version 4 had a
foreseeable upper limit in terms of the number of entities it could connect to the
ever-increasing worldwide Internet.T he Internet Engineering Task Force (IET F),
the standards group from which a large portion of Internet technologies emerge,
was beginning to see this as an issue that needed to be tackled earlier rather than
later. In a three-year span between 1996 and 1999, authority agents responsible
for address allotment allocated 150 million IP addresses.Although the Internet is
growing at an alarming rate, it is clear that 150 million hosts were not added.
Address allocation has a major problem, even after the efforts of C IDR  were
implemented.Address space is being wasted and will run out eventually.
In addition, demand dictated enhanced features on the network layer (Layer 3
on the O pen Systems Interconnection [O SI] reference model stack), such as end-
to-end encryption, authentication of packets, source-routing, and Q uality of
Service (Q oS).As people began to see these factors as a reality, many proposals
for a new Internet protocol emerged.
T he ﬁrst draft that gained widespread notice was loosely based on the
C onnection-Less N etwork Protocol (C LN P), which was based upon another
protocol suite, the O SI stack.T his stack originally ran on the early Internet, but
was quickly replaced by IPv4 when the Internet began to take on size and popu-
larity.T he proposal was coined T U BA (T C P/ U DP over Bigger Addresses). C LN P
did provide for a much larger address range than the current IPv4. Its N etwork
Service Access Point (N SAP) address consisted of 20 octets and would provide
adequate addressing ranges for the Internet’s foreseeable future. H owever, this
proposal was rejected because C LN P lacked some of the value-added features
Explaining IPv6 Addressing • Chapter 4
115

116
Chapter 4 • Explaining IPv6 Addressing
that were already installed into the current IP (Q oS, multicast, and so on.), and
these were determined to be important to the Internet’s growth.
T here was a proposal that attempted to create a packet format compatible
with current IP, C LN P, and Internetwork Packet Exchange (IPX ).Yet another
proposal, known as Simple IP Plus (SIPP), simply advocated increasing the cur-
rent IP addressing format to 64 bits and ﬁne-tuning some of the feature sets of
IPv4, as well as establishing better routing strategies. SIPP turned out, after some
modiﬁcations, to be the closest match for what the Internet needed.T he
addressing range was changed from 64 to 128 bits, and the name was changed to
IP version 6, or IPv6 (IPv5 was already delegated to another protocol).T his
would be the protocol to solve the Internet scalability problems and put us into
the next millennium.
IPv6 Addressing Scheme Characteristics
T his section provides an overview of the IPv6 header and the characteristics of
the IPv6 addressing scheme, and discusses how they can improve routing stability
and efﬁciency.Topics of discussion include:
■
IPv6 header 
■
IPv4 and IPv6 address space
■
IPv6 address structure
IPv6 Header Overview
T he IPv6 header is 40 bytes long and contains ﬁelds pertaining to version, trafﬁc
class, ﬂow label, payload length, next header, hop limit, source address, and desti-
nation address. Figure 4.1 depicts the IPv6 header as expressed in R equest for
C omments (R FC ) 2460 (www.ietf.org/ rfc/ rfc2460.txt).
Version Field
T he version ﬁeld in the IPv6 header is so that Internet mechanisms that know
how to route, or even speak routing protocols, will know what type of routing
protocol they are about to deal with. N otice the similarities to IPv4. In the case
of IPv6, the Version ﬁeld is a 4-bit integer, with the value of 6 (0110 in binary),
to designate this packet as an IP version 6 packet.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
117
Figure 4.1 IPv6 Header
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Trafﬁc Class |           Flow Label                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length
|  Next Header
|   Hop Limit
|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|
|
+
+
|
|
+                         Source Address
+
|
|
+
+
|
|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|
|
+
+
|
|
+                      Destination Address
+
|
|
+
+
|
|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Trafﬁc C lass Field
T he trafﬁc class ﬁeld is an 8-bit ﬁeld in which some sort of trafﬁc differentiation
identiﬁer can be placed. C urrently, in the IET F, many working groups are dedicated
to coming up with the best way to utilize this type of differentiation mechanism
(though they mostly concentrate on IPv4 today). O ne example of such a group is
the DiffServ (Differentiated Services).T he members of DiffServ are trying to come
up with a way to give more important trafﬁc a higher priority for routing on the
Internet today.T his ﬁeld was designed for things such as IP Precedence bits (giving
certain values of this ﬁeld higher priority, and then using differentiated queuing
www.syngress.com

118
Chapter 4 • Explaining IPv6 Addressing
strategies in the router to tell “who goes ﬁrst”).You can learn more about DiffServ
on the Web at www.ietf.org/ html.charters/ diffserv-charter.html.A number of drafts
and R FC s have been written with ideas as to how to implement such a policy.T he
list of current open drafts (they are good for only six months after writing, at
which time they need to be resubmitted, just to keep things current) and R FC s is
at the bottom of the aforementioned U R L.
Flow Label Field
T he ﬂow label ﬁeld is a 20-bit ﬁeld used when special handling of a packet is
needed. C ommon interpretation of this ﬁeld at the time of this writing is that the
ﬁeld will assign ﬂow labels in order to engineer different trafﬁc patterns in an IPv6
network.T he major player in this (though for mostly IPv4 at this time) is the
M ulti-Protocol Label Switching (M PLS) working group.To see the group’s
charter, please see www.ietf.org/ html.charters/ mpls-charter.html.T his group’s
main intention is to come up with an efﬁcient way to assign labels to ﬂows, and to
come up with an efﬁcient and scalable way to route based on these ﬂows.A ﬂow
can be deﬁned as any class of trafﬁc going from one point to anther, whether
point-to-point trafﬁc, or a T C P ﬂow from one end-station at a given port to a
destination end-station on a given port.T he possibility of assigning ﬂows opens up
many interesting options for deployment. Perhaps Q oS (quite a buzzword in the
ﬁeld today) can be deployed with scalability this way. M any Internet providers are
keeping their eyes wide open as this working group develops, because advanced
services that the M PLS working group sees as feasible could lead to ground-
breaking new developments in the Internet industry as a whole.
Payload Length Field
T he payload length ﬁeld is a 16-bit integer used to designate the length of the
payload (the data) in the IPv6 packet, in octets. N otice this ﬁeld is 16 bits long (2
raised to the power 16), which gives us more than 64,000 different possibilities,
enabling IPv6 to have fairly big packets (more than 64,000 bytes).T he capability
to make big packets can increase the efﬁciency of the Internet as a whole.W hen
your packets are bigger, the number of packets needed to send a given amount of
data becomes smaller for a given ﬂow.W hen a router has fewer packets to route,
it has more time to route other packets, or to perform other tasks (routing table
maintenance, cache aging, and so on.).You can see how this can help to increase
Internet efﬁciency altogether. N ote that any extension headers outside this
header are included in the total packet length in this case. C ompare this with the
IPv4 case (R FC  791) where the total length ﬁeld includes the IPv4 main header.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
119
N ext H eader Field
T he next header ﬁeld is designated to tell routers if any other headers need to be
looked at for the packet to route according to instruction.T his feature differs
drastically from the IPv4 case, where only one header has a ﬁxed length.T he
IPv6 main header has a ﬁxed length as well (enabling routers to know before-
hand how much of the packet they need to read), but has built-in functionality
to stack other headers that provide other value-added services on top of the main
header.T his ﬁeld is 8 bits in length, allowing for up to 255 types of N ext-
H eaders. C urrently, only a ﬁnite amount of N ext-H eaders are developed. H ere is
a list of the ones currently on the plate:
■
H op by H op O ptions H eader
■
Destination O ptions H eader I
■
R outing H eader
■
Fragment H eader
■
Authentication H eader
■
Encapsulating Security Payload H eader
■
Destination O ptions H eader II
T he preceding list shows the selection of N ext-H eader ﬁelds that can occur
in an IPv6 packet.T hese headers are listed in order of the appearance they would
make in an IPv6 packet utilizing this extra functionality.All these headers will be
discussed in detail in the previous chapter.
IPv4 and IPv6 Address Space 
IPv4 and IPv6 addresses are similar in that they both utilize network and host
portion subnetting and C IDR  notation to express the address. H owever, IPv6
utilizes a much larger address space and provides a much different policy for allo-
cation of addresses to support aggregation. In this section, we’ll discuss these dif-
ferences and present the IPv6 address syntax.
As discussed in the introduction, the growth and stability of the IPv4 address
space is severely constrained. IPv4 addressing utilizes a 32-bit value that is repre-
sented in a four-section dotted decimal format. Each section contains 8 bits that
represent byte values between 0 and 255.T his allows for a theoretical number of
addresses in the range of four billion. H owever, many of these addresses are
reserved, resulting in an actual number of addresses much lower than four billion.
www.syngress.com

120
Chapter 4 • Explaining IPv6 Addressing
W hile this may seem to be an inordinate amount of address space, the majority of
this space has been allocated to Internet service providers. It is almost impossible
for independent businesses (non service providers) to obtain their own IPv4
address space. M ost service providers have obtained their own IPv4 address space
from address allocation agents such as the American R egistry for Internet
N umbers (AR IN ), R éseaux IP Européens (R IPE), or the Asia Paciﬁc N etwork
Information C entre (APN IC ).T he aforementioned agents must follow stringent
policies for allocation of address space. M ost providers adopt these allocation poli-
cies when assigning address space to their customers.AR IN , R IPE, and APN IC
allocate subsets of the IPv4 address space to providers who in turn assign IPv4
addresses to end users.T he allocation and assignment policies are deﬁned in R FC
2050. Speciﬁcally, the policy is as follows:
1.
End users should request address space from their directly connected
upstream provider.
2.
If no addresses are available from the upstream provider, request addresses
from the provider’s provider.
3.
If justiﬁable, request address space directly from AR IN , R IPE, or APN IC.
AR IN , R IPE, and APN IC  are responsible for determining the number of
addresses assigned to providers.Allocations are based solely on need and not on
the providers’ projected customer allotments and are deﬁned on C IDR  bit
boundaries. Generally, a / 20 or lower (/ 19, / 18, and so on) is the smallest preﬁx
assigned to the providers. If a preﬁx of / 20 or longer is needed, the preceding
rules are utilized.AR IN , R IPE, and APN IC  use a slow-start model for allocating
the IPv4 address space.T his means that addresses are allocated out of a subset of a
C IDR  block of addresses.T he C IDR  block is reserved and providers can request
additional addresses out of the reserved space, when exhaustion of the allocated
addresses is justiﬁed.
Address space allocated by AR IN , R IPE, or APN IC  is globally routable, but
the preﬁxes assigned to end customers may not be if the customer has dual
providers or if they have smaller preﬁxes that are not advertised by their upstream
providers. C IDR  aggregation blocks are used to minimize the size of the Internet
routing table. M ost providers have policies regarding the advertisement of small
preﬁxes (such as a / 24 preﬁx).T he exhaustion of the IPv6 address space is the
primary reason for the introduction of IPv6 addressing.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
121
T he IPv6 address space utilizes a 128-bit format that consists of an 
eight-part hex address separated by colons (:). Each part of the IPv6 address 
space represents sixteen bits, which provides a theoretical address space of
340,282,366,920,938,463,463,374,607,431,768,211,456 addresses. Due to the
fact that IPv6 has reserved addresses, the total assignable address space is smaller
than this.T he size and scope of the IPv6 address space enables allocations of
addresses in a much more hierarchal fashion than IPv4, which in turn enables
independent customers of service providers to obtain and deploy globally
routable addresses within their environments.T his functionality is especially useful
in environments that have been forced to utilize N etwork Address Translation
(N AT ) due to the inability of the customer to obtain public IPv4 address space.
T he basic premise of N AT  is that it takes a non-globally routable (private) address
space from a service provider customer and translates it to a globally routable
(public) address before forwarding it on to the Internet. N AT  solutions usually
require additional hardware and software (that is, a ﬁrewall) or resource intensive
processing on a customer’s router. In addition, N AT  introduces unnecessary com-
plexities that can be avoided completely with the deployment of IPv6 addressing.
T he IPv6 address space provides more than enough address space to reassign
public IPv6 addresses to all entities that require global routing over the Internet.
IPv6 Address Structure
As discussed previously, IPv6 utilizes hex notation.T his is a fundamental change
from the dotted decimal notation used in the IPv4 addressing. U tilization of
dotted decimal notation to express and address space equivalent to the size of the
IPv6 scope would be complex and cumbersome.To express the same address
space as IPv6 in decimal notation, the current IPv4 string would have to be
expanded four times. If dotted decimal notation were used, addresses would
appear as 15.25.35.45.55.65.75.85.95.105.115.125.135.145.155.165, which
would make it very difﬁcult to remember IP addresses. U sing hexadecimal nota-
tion allows for the expression of these numbers using two hexadecimal numbers.
For example, an IPv4 address can be expressed in hexadecimal notation with two
numbers per octet.T he IPv4 address 100.64.172.255 converts to 64.40.AC.FF in
hexadecimal. It is important to understand how to convert from decimal to hex-
adecimal values in order to express IPv4 addresses as IPv6 addresses. Decimal to
hexadecimal conversion is easily done with a conversion calculator; however, you
may not always have access to a calculator. C onversion from decimal to hexadec-
imal and vice versa is a necessary evil for anyone considering IPv6, especially if
www.syngress.com

122
Chapter 4 • Explaining IPv6 Addressing
IPv4 addresses are incorporated into the IPv6 address.Table 4.1 depicts decimal
to hexadecimal equivalents.T his table is useful when converting smaller numbers.
Table 4.1 Decimal to Hexadecimal Equivalents
Decimal Notation 
Hex Notation
0
0
1
1
2
2
3
3
4
4
5
5
6
6
7
7
8
8
9
9
10
a
11
b
12
c
13
d
14
e
15
f
I like to use a simple procedure when converting from decimal to hex for
numbers larger than 255.T he procedure is as follows.
1.
Divide the decimal number by 16.
2.
W rite down the remainder as a hex number.
3.
Take the result from step 1 and divide by 16 again.
4.
C ontinue until you cannot divide by 16 again (or until the result is 0).
5.
T he conversion to hex is the hex numbers found in step 2 written from
last to ﬁrst.
T he entire formula and procedure can be summarized by the following chart
and procedural steps.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
123
X 
Number you want to convert
Y
Number of times 16 goes into X
Y1
Number of times 16 goes into Y
Y2
Number of times 16 goes into Y2
Yn 
Number of times 16 goes into Yn-1
R1
Remainder1
R2
Remainder2
Rn 
Remaindern
H1
R1 in hex
H2
R2 in hex
Hn 
Rn in hex
1.
X / 16 = Y  remainder R 1
2.
R 1 converts to H 1
3.
Y / 16 = Y 1 remainder R 2
4.
R 2 converts to H 2
5.
Y 1/ 16 = Y 2 remainder R 3
6.
R 3 converts to H 3
7.
Y n/ 16=Y n-1 remainder R n
8.
R n converts to H n
9.
H exadecimal equivalent is H nH 3H 2H 1
For example, to convert 35,000 decimal to hexadecimal, do the following:
1.
35,000/ 16 = Y  = 2187 with a remainder of 8 = R 1
2.
R 1 = 8, which converts to 8 in hex, which equals H 1
3.
From step 1,Y  = 2187, so 2,187/ 16 = Y 1 = 136 with a remainder of 
11 = R 2
4.
R 2 = 11, which converts to b in hex, which equals H 2
5.
From step 3,Y 1 = 136, so 136/ 16 = Y 2 = 8 with a remainder of 
8 = R 3
6.
R 3 = 8, which converts to 8 in hex, which equals H 3
7.
8/ 16 is not divisible in this scenario so the R 4 = 8
www.syngress.com

124
Chapter 4 • Explaining IPv6 Addressing
8.
R 4 = 8, which converts to 8 in hex which, equals H 4
9.
H EX  equivalent is expressed as H 4H 3H 2H 1 (from above H 4=8, H 3=8,
H 2=b, H 1=8)
10.
35,000 = 88B8
T his formula is good to know, but conversion from hex to decimal with
numbers less than 255 is more likely to be useful as the initial deployments of
IPv6 may use many IPv4 addresses.T he procedure is as follows.
1.
Divide the decimal number by 16.
2.
R ecord the value as a hex number.
3.
R ecord the remainder as a hex value.
For example: 232 decimal converted to hexadecimal is done as follows:
1.
232/ 16 = 14 with a remainder of 8.
2.
14 = E in hex.
3.
8 = 8 in hex.
4.
H ex equivalent equals the two numbers together starting with step 2;
therefore, 232 = E8.
You might ask how hexadecimal numbers are used within the IPv6
addressing architecture? R FC  2373 provides an addressing structure for IPv6
addressing architectures. C isco requires that all addressing comply with R FC
2373.Although the hexadecimal notation shortens the number of digits required
to express a decimal value, the address structure is much longer than IPv4 due to
the amount of address space.
As previously discussed, IPv6 addresses utilize a 128-bit format that consists of
an eight-part hex address separated by colons (:).T herefore an IPv6 address is
expressed as follows:ADBF:0:FEEA:0:0:00EA:00AC :DEED
IPv6 provides two methods for compressing the syntax of the address space.
T he ﬁrst is the omission of leading zeroes and the second is the replacement of
multiple groups of zeroes by double colons (::). U sing these methods, the pre-
ceding address can be shortened considerably.
For example, using the ﬁrst method, omitting the leading zeroes, provides an
address of ADBF:0:FEEA:0:0:EA:AC :DEED. If the second method is applied, the
address is represented as ADBF:0:FEEA::EA:AC :DEED. H owever, the double
colon can appear only once in the address. In addition to replacing multiple
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
125
groups of zeroes within the address, the double colon can be used to represent
the leading or trailing zeroes in an address.
R FC  2373 outlines a structure for representing IPv4 addresses.T he six high-
order bits of the IPv6 address space are represented as leading zeroes and the two
remaining 16-bit spaces are broken into four 8-bit spaces.T hese represent stan-
dard IPv4 addresses.T his provides an address in the form of 0:0:0:0:0:0.A.B.C.D,
where ABC D is expressed in standard IPv4 syntax. For example, the IPv4 address
of 192.168.100.10 can be represented as 0:0:0:0:0:0.192.168.100.10. N otice that
within the IPv6 address the IPv4 address space is delimited by dots (.), not
colons.T he IPv6 address can be further truncated by omitting the leading zeroes.
T he result is an IPv6 address in the form of ::192.168.100.10.
T he Internet community adopted C IDR  notation to extend the life of the
IPv4 address space. IPv6 also utilizes C IDR  notation. C IDR  does not solve the
problem of multiple entries in the Internet routing tables. C IDR  presents a
method for aggregating address space only outside the normal C lass A, B, and C
network boundaries. Let’s say for example that a customer has a connection to
Provider A, which has been assigned the address block of 100.100.0.0 –
100.100.255.255 (or 100.100.0.0/ 16). Provider A can allocate addresses out of
this block for a customer to use as public address space. Let’s say that the provider
allocates 100.100.100.0-100.100.100.255 (or 100.100.100.0/ 24) to the customer.
Provider A announces an aggregate address of 100.100.0.0/ 16 to everyone on the
Internet.T his simply means that anyone trying to reach an address in the
100.100.0.0/ 16 address space can forward trafﬁc to Provider A.T herefore, all
trafﬁc destined for 100.100.100.0/ 24 (the customer) goes through Provider A’s
backbone.T his works ﬁne until the customer decides that he wants to implement
a dual-homed connection to the Internet. Provider B enters the picture as a sec-
ondary provider of Internet connectivity. Because the customer already has the
address space of 100.100.100.0/ 24, Provider B must advertise this route in its
routing table.T his means that now two routes to get to 100.100.100.0/ 24 exist,
one through Provider A’s aggregated route of 100.100.0.0/ 16 and one through
Provider B’s 100.100.100.0/ 24 route. It is not as important to understand how
the routing works as to understand that C IDR  in combination with smaller pre-
ﬁxes carved out of the C IDR  aggregation create multiple routes in the Internet
routing table. For every customer who wishes to dual home to different
providers, multiple entries to the customer’s networks are injected into the
Internet routing tables. If the multiple routing entries seen in IPv4 routing tables
also were present in the IPv6 address space, the impact would be enormous. R FC
2373 provides mechanisms for subnetting the IPv6 address space so that it does
www.syngress.com

126
Chapter 4 • Explaining IPv6 Addressing
not negatively impact the Internet routing tables.A discussion of the mechanisms
used for subnetting is found in the “Aggregatable Global U nicast Address” section
later in this chapter.
T he next sections discuss the types of addresses deﬁned within IPv6 and their
uses.As with IPv4 addresses, speciﬁc types of reserved addresses divisions are
within the IPv6 addressing architecture.T he leading bits within the address iden-
tify reserve addresses.Table 4.2 shows the reserved addresses.
Table 4.2 IPv6 Address First-Bits Standards
Fraction of 
Allocation 
Preﬁx (binary)
Address Space
Reserved
0000 0000
1/256
Unassigned
0000 0001
1/256
Reserved for NSAP Allocation 
0000 001
1/128
Reserved for IPX Allocation 
0000 010
1/128
Unassigned
0000 011
1/128
Unassigned
0000 1
1/32
Unassigned
0001
1/16
Aggregatable Global Unicast Addresses 
001
1/8
Unassigned
010
1/8
Unassigned
011
1/8
Unassigned
100
1/8
Unassigned
101
1/8
Unassigned
110
1/8
Unassigned
1110
1/16
Unassigned
1111 0
1/32
Unassigned
1111 10
1/64
Unassigned
1111 110
1/128
Unassigned
1111 1110 0
1/512
Link-Local Unicast Addresses
1111 1110 10
1/1024
Site-Local Unicast Addresses
1111 1110 11
1/1024
Multicast Addresses
1111 1111
1/256
Each of these reserved address spaces deﬁnes a speciﬁc type of address.T he
addresses deﬁned have scope.A node or router may have multiple addresses 
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
127
conﬁgured that deﬁne the scope as local to the link, local to the site, or globally
signiﬁcant. In addition, there are loopback and local use, multicast, and anycast
addresses.T he types of addresses are as follows:
■
U nicast Address
■
M ulticast Address
■
Anycast Address
■
N odes-R equired Address
U nicast Addresses
A unicast address represents an end node or host. U nicast addresses are aggregat-
able and require the use of contiguous bits to represent the subnet mask. By
deﬁning clear and concise deﬁnitions within the address structure, IPv6 allows for
a robust addressing architecture that provides a much more structured hierarchy
when allocating address space. IPv6 unicast addresses are segmented into the fol-
lowing formats, which we’ll look into in the next sections:
■
Aggregatable Global U nicast Addresses
■
T he Loopback Address
■
T he U nspeciﬁed Address
■
Interface Identiﬁers
■
Local-use U nicast Addresses
■
N SAP Addresses
■
IPX  Addresses
A ggregatable G lobal U nicast A ddress
T he A ggregatable G lobal U nicast address format is used to deﬁne a tiered structure
for the assignment and allocation of the IPv6 address space.T he new structure
calls for the address space to be broken into six separate components.T hese com-
ponents are the Format Preﬁx (FP), the Top-Level Aggregation Identiﬁer (T LA
ID), R eserved (R ES), N ext-Level Aggregation Identiﬁer (N LA ID), Site-Level
Aggregation Identiﬁer (SLA ID), and the Interface Identiﬁer (Interface ID).
Figure 4.2 depicts the global unicast address format.
www.syngress.com

128
Chapter 4 • Explaining IPv6 Addressing
T he public routing topology preﬁx consists of the ﬁrst 48 bits of unicast
address space.T his includes the FP bits plus the T LA, R eserved, and N LA bits.
T he next 16 bits deﬁne the site topology and the ﬁnal 64 bits are the interface
identiﬁer.T he public topology is address space assigned to exchanges and ISPs
that provide transit Internet services.T he site topology can be deﬁned as the cus-
tomers of the providers and exchanges and the interface identiﬁer is an end host
or node interface identiﬁer.
FP T he F ormat P reﬁx for Globally R outable U nicast preﬁxes will always
have the same three bits (in the initial deployment of IPv6).T hese ﬁrst
three bits will always be set to 001 and are there to designate (to any
routing entity on the Internet) that this address is a Globally R outable
U nicast address. For each type of IPv6 address that we discuss, the FP
will be unique to that type of address, thus making it easier for routing
entities to discern packet types and to process them according to the
rules that apply to the respective packet type. For example, multicast
packets and unicast packets are routed in very different ways. U nicast
packet routing is 1-to-1 (a packet with an IPv6 Globally R outable
U nicast destination originates from one host and is delivered to one
host), and multicast packets are 1-to-N  (one multicast packet may be
delivered to N  interested destination hosts), or N -to-N  (N  sources deliv-
ering packets to N  destinations), so these packets are handled in vastly
different ways on an Internet backbone.T he FP serves as a delimiter, so
a routing device can make a quick decision as to how to handle the
incoming packet and ensure that it is handled correctly. N ote that using
the ﬁrst few bits of an address to designate type of address is more efﬁ-
cient than putting it into the packet, because now we can utilize more
of the packet for other valuable features, discussed earlier.
TLA ID T he T L A  ID utilizes 13 bits that provide for 8,192 T LAs.T his
means there can be 8192 providers or exchanges at this level.T his is
analogous to today’s T ier-1 providers.T he T LAs reside at the highest
www.syngress.com
Figure 4.2 Global Unicast Address Format
001
TLA ID
RES
NLA ID
SLA ID
Interface ID
13 bits
8 bits
24 bits
16 bits
64 bits
3 bits

Explaining IPv6 Addressing • Chapter 4
129
point of the routing hierarchy.T LAs will be assigned one of the 8,192
T LA IDs and will own responsibility for allocating addresses to down-
stream customers.
NOTE
The Internet community discusses intently what deﬁnes a Tier-1 provider.
Possibly the simplest deﬁnition is that these are providers that do not
pay peering costs to exchange routing information with each other.
However, no standard deﬁnition exists, nor are there any rules governing
who can peer with whom. This lack of standards and rules leads to the
question of who will be TLA providers and who will make this decision.
This is important in terms of which providers will be classiﬁed as TLAs
and own one of the 8,192 address blocks at the TLA level and how they
plan their address allocations.
RES  T hese bits are reserved for now. It has not been determined by the
IET F what course of action should be used for these bits.At this stage, it
is appropriate for T LAs to subnet their assignment using these 8 bits to
increase the amount of Globally R outable U nicast address space that a
T LA can use to delegate to their customers or use on their Backbone.
NLA ID T hese 24 bits depict the N ext-L evel A ggregator Identiﬁer.A
N ext-Level Aggregator can be thought of today as a T ier-2 network ser-
vice provider or ISP.An N LA can range from a small organization with
one T LA connection, to a large, regional provider with many upstream
T LA connections and complex backbones.An N LA will receive an
N LA ID from its upstream T LA, and, in turn, will break its N LA ID into
chunks, which will be delegated to its customers.
SLA ID A Site-L evel A ggregator Identiﬁer describes an entity that has no
downstream customers who are network service providers.An SLA
could be a small to large business, or a small service provider who does
not delegate address space to its providers (for instance, today’s cable-
modem providers could ﬁt into an SLA arrangement).
Interface ID T he ﬁnal 64 bits of the Globally R outable IPv6 U nicast
address is reserved for the Interface Identiﬁer. In IPv4 terms, this is known
as the host ID.T hese 64 bits will be designated to distinguish one host
www.syngress.com

130
Chapter 4 • Explaining IPv6 Addressing
from another on a given network segment. Each Interface ID on a given
network segment must be unique.We will see that IPv6 builds in a
clever way to ensure this is so.
To effectively understand IPv6 addressing, it is necessary to understand how
the address space is allocated.T he policies governing the assignment and alloca-
tion of the IPv6 address space have been set forth in a published standard entitled
ripe-196.T his abstract deﬁnes the Internet registry system for the distribution of
IPv6 unicast addresses.T he goal is to ensure that the IPv6 address space is man-
aged properly.T his management is necessary to eliminate the inconsistencies and
unfairness of address allocation seen in the IPv4 address space.T his minimizes
waste of address space and maximizes aggregation.T he authority for all IPv6
address space is the Internet Assigned N umbers Authority (IAN A). IAN A allo-
cates IPv6 address space to regional Internet R egistries (IR s).T here are three
IR s:AR IN , R IPE N etwork C ordination C entre (N C C ), and APN IC.AR IN
serves N orth and South America, the C aribbean, and sub-Saharan Africa; R IPE
N C C  handles Europe, the M iddle East, and some parts of Africa;APN IC  handles
areas in the Asia Paciﬁc region.T he IR s can handle areas outside their adminis-
trative control if necessary.Additional IR s can be created as the deployed base of
IPv6 addresses grows.T he policies governing the assignment of IPv6 unicast
address space must be done in a manner that ensures that each unicast address is
efﬁciently allocated, globally routable, unique, and supports aggregation. R FC
2374 (the update to R FC  2373) organizes the IPv6 address space into a topolog-
ical hierarchy.T he topologies are public topology, site topology, and interface.
Figure 4.3 depicts the mapping of these topologies to the IPv6 address space.
An IPv6 address can be expressed in the same manner as IPv4 addresses.An
IPv4 address contains network and host bits.T he network and host portions of an
IPv6 address are shown in Figure 4.4.
T he network portion of an IPv6 address is 64 bits and the host portion is 64
bits.T he expression of IPv6 addresses uses C IDR  notation to divide the address
www.syngress.com
Figure 4.3 Unicast Address Hierarchical Topology
001
TLA ID
RES
NLA ID
SLA ID
Interface ID
Public Topology
48 bits
Site Topology
16 bits
Interface Topology
64 bits
13 bits
8 bits
24 bits
16 bits
64 bits
3 bits

Explaining IPv6 Addressing • Chapter 4
131
into network and host portions.An address with a / 48 mask represents an aggre-
gatable network preﬁx assigned out of the public topology allocation. Subnetting
and address assignment are discussed in detail later in this chapter.
T he regional IR s use a modiﬁed version of the IPv6 address T LA ﬁeld for
allocation of the initial address space.T his requires dividing the T LA space into a
sub-T LA, which allows for allocating less of the address space to the original
T LAs as previously planned.T he IR  reserves the additional 6 bits for the T LA so
that if the need arises, it can allocate the address space to the T LA.T he reserva-
tion preserves the aggregation policies but allows for efﬁcient allocation on an as-
needed basis.T his policy creates a modiﬁed format to the IPv6 address space.T he
modiﬁed version is shown in Figure 4.5.
T he address allocation policy for IPv6 is as follows:
■
R egional IR s assign addresses to qualiﬁed sub-T LAs (T LA ISPs).
■
T LA ISPs assign N LA addresses to N LA ISPs (T LA customers).
■
N LA ISPs assign SLA addresses to their customers.
T LA providers have to be able to allocate SLA addresses to customers.T LA
ISPs provide direct Internet connectivity to end users as well as N LAs.
Subnetting the address space within the T LA and N LA providers’ networks is left
up to the discretion of the individual providers. R egardless of how providers
www.syngress.com
Figure 4.4 Unicast Address Network and Host Bits
001
TLA ID
RES
NLA ID
SLA ID
Interface ID
Public Topology
48 bits
Site Topology
16 bits
Interface Topology
64 bits
13 bits
8 bits
24 bits
16 bits
64 bits
Network
64 bits
Host
64 bits
3 bits
Figure 4.5 Modiﬁed Sub-TLA Format
001
TLA ID
Sub-TLA
RES
NLA ID
SLA ID
Interface ID
13 bits
13 bits
6 bits
13 bits
16 bits
64 bits
3 bits

132
Chapter 4 • Explaining IPv6 Addressing
subnet the address space within their networks, aggregation of the address space
falls on the preﬁx boundaries shown in Table 4.3.
Table 4.3 Aggregation Preﬁx Boundaries
ID
Longest Preﬁx 
Length in Bits
TLA
/16
13
Sub-TLA
/29
13
Reserved
N:LA
/48
13
SLA
/64
16
T he L oopback A ddress
T he loopback address is a part of the IPv6 unicast address space.T he loopback
interface is not a physical interface and has no hardware associated with it. It is a
software interface that is always reachable regardless of the physical interface
status. R FC  2373 deﬁnes the loopback interface address as 0:0:0:0:0:0:0:1, or ::1
in condensed form.An IPv6 node uses the loopback interface to send packets to
itself and can never be used as a source address for IPv6 packets sent outside a
single node (router).T he standard prohibits a node from forwarding a packet with
a destination address of a loopback.
T he U nspeciﬁed A ddress
T he unspeciﬁed address is another part of the IPv6 unicast address space.T he
unspeciﬁed address is never assigned to any node. In addition, the unspeciﬁed
address may never be used as a destination address in an IP packet nor can it be
used in routing headers. U nspeciﬁed addresses are used during the auto conﬁgu-
ration process.Auto conﬁguration is discussed in C hapter 2.
Interface Identiﬁers
Interface identiﬁers are used to uniquely identify interfaces on a link. IPv6 uti-
lizes a modiﬁed EU I-64 format to construct interface identiﬁers. EU I-64
addresses are a derivation of the 24-bit company_id value assigned by the IEEE
registration authority. C onversion to the EU I-64 format is accomplished by mod-
ifying the 48-bit M edia Access C ontrol (M AC ) address assigned to the hardware
interface. O ther interfaces such as tunnel, Frame-R elay, and loopback derive the
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
133
EU I-64 identiﬁer via M AC  addresses from the router. C isco routers contain
pools of M AC  addresses that are assigned for internal identiﬁers.T he exceptions
to these rules are tunnels that are used with IPv6 overlay tunnels. For these types
of interfaces the Interface Identiﬁer is the IPv4 address with zeroes in the high-
order 32 bits.
To create EU I-64 addresses from vendor M AC  addresses, perform the fol-
lowing steps:
1.
Insert ff-ee between the third and fourth bytes of the M AC  address.
2.
C omplement the “U niversal/ Local” (U / L) bit. (T he U / L bit is the ‘u’ bit
in IEEE EU I-64 terminology. C omplementing this bit means to invert
the bit from the original value and set it to either a 0 or 1. Setting the
bit to 0 means that the interface identiﬁer is locally administered; setting
it to 1 indicates a globally unique interface identiﬁer.)
L ocal-use U nicast A ddresses
Two types of local-use addresses exist within the IPv6 address space:
■
Link-local addresses (used on a single link)
■
Site-local addresses (used within a site)
L ink-local addresses are signiﬁcant only on the physical medium connected to
the router (that is, Ethernet,Token R ing, or WAN  segment). O nly the hosts and
router interface connected to the same segment are aware of the link-local
addresses for that segment.T he router does not advertise link-local addresses,
which considerably simpliﬁes renumbering.After the addresses have been assigned
(either manually or via auto conﬁguration), the global unicast address space can
change without having to revisit and reconﬁgure the link-local addresses. In addi-
tion, link-local addressing is used in neighbor discovery and internal routing.
Figure 4.6 shows the format for the link-local address.
www.syngress.com
Figure 4.6 Link-Local Unicast Address Format
1111111010
zeroes (0)
Interface ID
10 bits
54 bits
64 bits

134
Chapter 4 • Explaining IPv6 Addressing
T he left-most 10 bits shown in Figure 4.6 translate into the preﬁx FE80::/ 64.
Appending the Interface ID to the FE80::/ 64 preﬁx derives link-local addresses.
Figure 4.7 depicts a segment utilizing link-local addressing.
Link-local devices are conﬁgured using a M AC  address or the EU I-64 format
prepended by FE80. Figure 4.8 depicts the address assignments for the devices in
link format.
www.syngress.com
Figure 4.7 Link-Local Address Space
Internet NLA or
sub-TLA
Server
Workstation
Workstation
Figure 4.8 Link-Local Assigned Addresses 
Internet NLA or
sub-TLA
Server
Workstation
Workstation
FE80::2E0:B0FF:FE5A:D998
EUI-64
FE80::2E0:B0FF:FE5A:D1000
EUI-64
FE80::MACadd
FE80::MACadd
FE80::MACadd
FE80::/ 64

Explaining IPv6 Addressing • Chapter 4
135
In this example, the routers are utilizing EU I-64 format for the Interface ID;
the server and workstations are using M AC  addresses.T hese addresses are never
visible outside the local segment on which they are conﬁgured. If the devices
need to be reached from hosts outside the local segment, site-local unicast
addresses are assigned.
A site-local address is an address that is routable within a site only.T his means
that hosts that are conﬁgured with a site-local address can communicate with
other hosts within the same environment but are not globally routable.T hese
addresses are assigned without a global unicast preﬁx. Site-local addresses are used
in the same fashion as R FC  1918 addresses in the IPv4 world. Site-local addresses
are considered private and form the addressing structure for an internal domain.
Figure 4.9 shows the format for the site-local address.
T he left-most 10 bits shown in Figure 4.9 translate into the preﬁx FEC 0::/ 10.
C oncatenating the 16-bit SLA ﬁeld (subnet ID) with the interface ID derives the
site-local address. Figure 4.10 shows a topology that utilizes site-local addresses.
www.syngress.com
Figure 4.9 Site-Local Address Format
1111111011
Subnet ID
Interface ID
zeroes (0)
10 bits
38 bits
16 bits
64 bits
Figure 4.10 Site-Local Address Space
Internet NLA or
 sub-TLA
Workstation
Workstation

136
Chapter 4 • Explaining IPv6 Addressing
Site-local devices are conﬁgured using a M AC  address or the EU I-64 format
prepended by FEC 0. Figure 4.11 depicts the address assignments for the devices
in site-local format.
In this example, the routers utilize site-local addresses and interface IDs in the
EU I-64 format.T he workstations are using the M AC  address as the interface ID.
T he numbers 1 and 2 before the interface ID represent the subnet ID.Workstations
on subnet 1 can communicate with workstations on subnet 2 and vice versa.T hese
addresses are never advertised outside the internal domain to the global Internet. If
future Internet connectivity is required, it makes sense to initially conﬁgure the
host with a Globally R outable U nicast address.Again, this introduces the issue of
renumbering in the event that the customer changes providers.
N SA P  A ddresses
IPv6 allows for the mapping of N SAP addresses into IPv6 addresses. N SAP
addresses are part of the O SI protocol suite developed by the International
O rganization for Standardization (ISO ). O SI was the predecessor of IPv4 routing.
T he O SI model incorporates the End System-to-Intermediate System (ES-IS),
Intermediate System-to-Intermediate System (IS-IS), and Interdomain R outing
Protocol (IDR P) suites. Because providers have deployed Internet backbones uti-
lizing these protocol suites, IPv6 allows for the mapping of the N SAP addresses
into IPv6 addresses. It is recommended that providers that have deployed networks
www.syngress.com
Figure 4.11 Site-Local Assigned Addresses
Internet NLA or
 sub-TLA
Workstation
Workstation
FEC0::1:2E0:B0FF:FE5A:D998/ 64
FEC0::1:MACadd/ 64
FEC0::2:2E0:B0FF:FE5A:D1000/ 64
FEC0::2:MACadd/ 64

Explaining IPv6 Addressing • Chapter 4
137
with an O SI N SAP addressing plan migrate to an IPv6 plan. R FC  188 provides
information on the mapping of N SAP to IPv6 addresses.T his standard is still
under development.
IP X  A ddresses
T he standard for mapping IPX  addresses into IPv6 addresses is also under 
development.
Subnetting and P reﬁxes for IP v6 A ggregation
As stated, IPv6 provides a much larger address space than IPv4. IPv6 was devel-
oped with a structure and format that is conducive to high levels of aggregation.
In the previous section, you learned that IPv6 addresses are broken up into pre-
ﬁxes of T LA, sub-T LA, N LA, and SLA allocations. Providers allocate addresses in
a hierarchical fashion that provides aggregation from the lower-level preﬁxes to
the higher-level T LAs. R FC  2373 provides a clear method for the allocation of
the IPv6 address space.
AR IN , R IPE, and APN IC  allocate sub-T LA address space to the T LA
providers.T hese providers in turn allocate N LA address space to downstream
providers who in turn allocate to SLAs. R emember that T LAs can also allocate
SLAs. Figure 4.12 depicts the hierarchy of global unicast address allocation.
www.syngress.com
Figure 4.12 Global Unicast Address Allocation
Regional Internet Registries (IRs)
ARIN, RIPE, and APNIC
Internet Assigned Numbers Authority (IANA)
Global Unicast Address
Allocation / 23
Global Unicast Address
Allocation / 35
sub-TLA 1
sub-TLA 2
NLA 1
NLA 2
SLA 1
SLA 2
SLA  3

138
Chapter 4 • Explaining IPv6 Addressing
T he following IPv6 address assignments have been allocated to the three IR s:
2001:0400::/ 23 – AR IN
2001:0200::/ 23 – APN IC
2001:0600::/ 23 – R IPE
We will use AR IN  as an example to demonstrate the aggregation capabilities
of IPv6.AR IN  has adopted assignment guidelines for IPv6 address allocation
from R FC  3177.T hese guidelines provide the following recommendations for
IPv6 address space allocation:
■
Allocate / 35 addresses to T LAs— this is a sub-T LA address space.
■
T LAs allocating address space to N LAs are responsible for preﬁx/
network length determination.
■
As a general rule, allocate a / 48 to all SLAs (except for very large SLAs).
■
Allocate a / 64 to SLAs that have only one subnet.
■
Allocate a / 128 to SLAs with only one subscriber.
T hese policies relate more to SLA end customers, but they provide efﬁcient
guidelines that facilitate aggregation.AR IN  has the responsibility for assigning
the slow-start sub-T LA addresses out of the 2001:0400::/ 23 block to providers.
Let’s say that AR IN  allocates the following addresses:
2001:0420::/ 35 - sub-T LA1
2001:0428::/ 35 - sub-T LA2 
T his allocation gives each of these sub-T LA providers the capability to subnet
this space and allocate to the N LAs. So rules govern the subnetting of the N LA
address space.T his subnetting should be done at the N LA provider’s discretion.
T he T LAs can allocate the following address space to the downstream N LAs:
■
Sub-T LA1 provides the following preﬁxes to its N LA customers:
2001:0420:0001::/ 48
2001:0420:0002::/ 48
2001:0420:0002::/ 48 etc
■
Sub-T LA2 provides the following preﬁxes to its N LA customers
2001:0428:0001::/ 48
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
139
2001:0428:0002::/ 48
2001:0428:0002::/ 48 etc
Each N LA provider can subnet and allocate the address space delegated to
them by the sub-T LAs. U sing the guidelines established in R FC  3177, the N LAs
should allocate / 48s to their downstream SLA customers. For example, an N LA
provider with the address space of 2001:0420:0001::/ 48 can allocate the fol-
lowing address space:
2001:0420:0001:1:/ 48
2001:0420:0001:2:/ 48
2001:0420:0001:3:/ 48 etc
T he allocation policies described previously provide the aggregation desired
for a hierarchical IPv6 infrastructure. Figure 4.13 shows the distribution of the
AR IN -allocated IPv6 addresses to the N LA providers and SLA customers.
Internet providers use BGPv4 to propagate addresses throughout the Internet.
In today’s Internet, addresses are aggregated and advertised to the upstream
provider when possible.T he inefﬁciencies of IPv4 allocation and advertisement
www.syngress.com
Figure 4.13 ARIN 
ARIN 2001:0400::/ 23
Internet Assigned Numbers Authority (IANA)
Global Unicast Address
Allocation / 23
Global Unicast Address
Allocation / 35
2001:0420::/ 35
2001:0428::/ 35
2001:0420:0001::/ 48
2001:0428:0001::/ 48
2001:0420:0001:1:/ 48
2001:0428:0001:1:/ 48
2001:0428:0002:1:/ 48
2001:0420:0002:1:/ 48

140
Chapter 4 • Explaining IPv6 Addressing
policies have created an abundance of routes with a small preﬁx.W ith the IPv6
aggregation capabilities, the SLA can advertise the entire preﬁx assigned to them
to the N LA.All SLA space is a subset of the N LA that the customer is connected
to.T his enables the N LA to generate one preﬁx announcement to the sub-T LA
for all SLA customers.T he same holds true for the N LA space.T he N LA allo-
cates all addresses out of the sub-T LA assignment, enabling the sub-T LA to gen-
erate one preﬁx advertisement to its peers. Figure 4.14 depicts the aggregate
announcements.
U sing this hierarchical aggregation model substantially reduces the size of the
Internet routing table.T he routing table for sub-T LA1 comprises only N LA pre-
ﬁxes and preﬁxes learned from other sub-T LAs (or T LAs).Address space assigned
to T LAs is not portable.T his means that the addresses have to be advertised to the
T LA that allocated the address space, which cuts down signiﬁcantly on the de-
aggregation of addresses as is seen in the current IPv4 allocations. N on-portability
does have its drawbacks. If a customer is unsatisﬁed with the level of service pro-
vided by her upstream provider and switches providers, the entire network has to
be renumbered out of the new provider’s address space.
Switching providers creates issues not only with addressing, but also with the
subject of dual homing. IPv6 address space is not intended to be portable; in
www.syngress.com
Figure 4.14 Aggregate Route Announcements
sub-TLA 1
2001:0420::/ 35
2001:0428::/ 35
2001:0420:0001::/ 48
2001:0428:0001::/ 48
2001:0420:0001:1:/ 48
2001:0428:0001:1:/ 48
2001:0428:0002:1:/ 48
2001:0420:0002:1:/ 48
NLA 1 advertises
2001:0420:0001::/ 48
to sub-TLA1
SLA 1
SLA 2
sub-TLA 2
NLA 2
SLA 3
SLA 4
SLA 1 advertises
2001:0420:0001:1:/ 48
to NLA 1
SLA 2 advertises
2001:0420:0001:2:/ 48
to NLA 1
SLA 3 advertises
2001:0428:0001:1:/ 48
to NLA 2
NLA 2 advertises
2001:0428:0001::/ 48
to sub-TLA2
NLA 1
SLA 4 advertises
2001:0428:0002:1:/ 48
to sub-TLA2
sub-TLA1 advertises
2001:0420::/ 48
to sub-TLA2
sub-TLA2 advertises
2001:0428::/ 48
to sub-TLA1

Explaining IPv6 Addressing • Chapter 4
141
other words, a secondary provider does not accept preﬁx advertisements from
other providers, which prevents customers from dual homing to multiple
providers.T his topic is discussed in detail in “T he N eed For Further
Development” section later in this chapter.
M ulticast Address
IPv6 multicast addresses are used to identify groups of interfaces. Packets are sent
from a single host to multiple receivers as deﬁned by the multicast address.A
router is not limited to only one multicast group and may belong to several mul-
ticast groups.A multicast address is identiﬁed by the presence of eight 1 bits at
the start of the IPv6 address. Figure 4.15 shows the structure of the IPv6 multi-
cast address.
T he ﬂgs ﬁeld is a set of 4 bits with the ﬁrst three reserved and the fourth used
to ﬂag whether the multicast address is permanently or non-permanently
assigned.A 0 indicates permanent and a 1 indicates non-permanent.T he global
Internet numbering authority assigns permanent multicast addresses.
www.syngress.com
IP Renumbering
Readdressing an environment to a new IP addressing scheme is not a
trivial exercise. It takes careful planning and execution to renumber
without impacting normal business operations. This exercise has been
simpliﬁed by the widespread use of DNS, but all environments have their
share of static IP addresses. Hosts with static IP addresses must be phys-
ically reconﬁgured. In addition, many applications have static IP
addressing embedded. These factors must be taken into consideration
when considering renumbering.
Conﬁguring & Implementing…
Figure 4.15 Multicast Address
11111111
group ID
scop
8 bits
4 bits
flgs
4 bits
112 bits

142
Chapter 4 • Explaining IPv6 Addressing
T he scop ﬁeld is another set of 4 bits used to specify the scope of the multi-
cast group.Table 4.4 outlines the values for the scop ﬁelds.
Table 4.4 Multicast Scope Field
Scope Value
Scope
0
Reserved
1
Node-local scope
2
Link-local scope
3
Unassigned
4
Unassigned
5
Site-local scope
6
Unassigned
7
Unassigned
8
Organization-local scope
9
Unassigned
A
Unassigned
B
Unassigned
C
Unassigned
D
Unassigned
E
Global scope
F
Reserved
T he group ID ﬁeld identiﬁes multicast addresses as permanent or non-perma-
nent within a scope. It is important to distinguish between permanent addresses
within a scope and permanent addresses across a scope. Permanent addresses
within a scope are those addresses that are reserved for multicast functions for
that particular scope. For example, FF01 indicates a node-local scope.Addresses
FF01:0:0:0:0:0:0:1 and FF01:0:0:0:0:0:0:2 are reserved within the FF01 scope.
Permanent addresses across a scope are those addresses that have a reserved group
ID value for any scope range. For example, the group ID of 100 is reserved for
the VM T P M anagers Group (R FC  1045).T his address is a permanent address
across any of the scope values shown in Table 4.4.Table 4.5 deﬁnes reserved mul-
ticast groups for both ﬁxed scope and variable scope allocations.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
143
Table 4.5 Reserved Multicast Addresses
Node-Local Scope
Reserved For
Multicast-Address
All Nodes Address
FF01:0:0:0:0:0:0:1
All Routers Address
FF01:0:0:0:0:0:0:2
Link-Local Scope
Reserved For
Multicast-Address
All Nodes Address
FF02:0:0:0:0:0:0:1
All Routers Address
FF02:0:0:0:0:0:0:2
Unassigned
FF02:0:0:0:0:0:0:3
DVMRP Routers
FF02:0:0:0:0:0:0:4
OSPFIGP
FF02:0:0:0:0:0:0:5
OSPFIGP Designated Routers
FF02:0:0:0:0:0:0:6
ST Routers
FF02:0:0:0:0:0:0:7
ST Hosts
FF02:0:0:0:0:0:0:8
RIP Routers
FF02:0:0:0:0:0:0:9
EIGRP Routers
FF02:0:0:0:0:0:0:A
Mobile-Agents
FF02:0:0:0:0:0:0:B
SSDP
FF02:0:0:0:0:0:0:C
All PIM Routers
FF02:0:0:0:0:0:0:D
RSVP-ENCAPSULATION 
FF02:0:0:0:0:0:0:E
Link Name
FF02:0:0:0:0:0:1:1
All-dhcp-agents
FF02:0:0:0:0:0:1:2
Solicited-Node Address
FF02:0:0:0:0:1:FFXX:XXXX
Site-Local Scope
Reserved For
Multicast-Address
All Routers Address
FF05:0:0:0:0:0:0:2
All-dhcp-servers
FF05:0:0:0:0:0:1:3
All-dhcp-relays
FF05:0:0:0:0:0:1:4
Service Location, Version 2
FF0X:0:0:0:0:0:1:1000- FF0X:0:0:0:0:0:1:13FF
www.syngress.com
Continued

144
Chapter 4 • Explaining IPv6 Addressing
Variable Scope
Reserved For
Multicast-Address
Reserved
FF0X:0:0:0:0:0:0:0
VMTP
FF0X:0:0:0:0:0:0:100
Network
FF0X:0:0:0:0:0:0:101
SGI-Dogﬁght
FF0X:0:0:0:0:0:0:102
Rwhod
FF0X:0:0:0:0:0:0:103
VNP
FF0X:0:0:0:0:0:0:104
Artiﬁcial
FF0X:0:0:0:0:0:0:105
NSS
FF0X:0:0:0:0:0:0:106
AUDIONEWS
FF0X:0:0:0:0:0:0:107
SUN NIS+
FF0X:0:0:0:0:0:0:108
MTP
FF0X:0:0:0:0:0:0:109
IETF-1-LOW-AUDIO
FF0X:0:0:0:0:0:0:10A
IETF-1-AUDIO
FF0X:0:0:0:0:0:0:10B
IETF-1-VIDEO
FF0X:0:0:0:0:0:0:10C
IETF-2-LOW-AUDIO
FF0X:0:0:0:0:0:0:10D
IETF-2-AUDIO
FF0X:0:0:0:0:0:0:10E
IETF-2-VIDEO
FF0X:0:0:0:0:0:0:10F
MUSIC-SERVICE
FF0X:0:0:0:0:0:0:110
SEANET-TELEMETRY
FF0X:0:0:0:0:0:0:111
SEANET-IMAGE
FF0X:0:0:0:0:0:0:112
MLOADD
FF0X:0:0:0:0:0:0:113
any private experiment
FF0X:0:0:0:0:0:0:114
DVMRP
FF0X:0:0:0:0:0:0:115
SVRLOC
FF0X:0:0:0:0:0:0:116
XINGTV
FF0X:0:0:0:0:0:0:117
microsoft-ds
FF0X:0:0:0:0:0:0:118
nbc-pro
FF0X:0:0:0:0:0:0:119
nbc-pfn 
FF0X:0:0:0:0:0:0:11A
lmsc-calren-1
FF0X:0:0:0:0:0:0:11B
lmsc-calren-2
FF0X:0:0:0:0:0:0:11C
www.syngress.com
Table 4.5 Continued
Continued

Explaining IPv6 Addressing • Chapter 4
145
lmsc-calren-3
FF0X:0:0:0:0:0:0:11D
lmsc-calren-4
FF0X:0:0:0:0:0:0:11E
ampr-info
FF0X:0:0:0:0:0:0:11F
Mtrace
FF0X:0:0:0:0:0:0:120
RSVP-encap-1
FF0X:0:0:0:0:0:0:121
RSVP-encap-2
FF0X:0:0:0:0:0:0:122
SVRLOC-DA
FF0X:0:0:0:0:0:0:123
rln-server
FF0X:0:0:0:0:0:0:124
proshare-mc
FF0X:0:0:0:0:0:0:125
Dantz
FF0X:0:0:0:0:0:0:126
cisco-rp-announce
FF0X:0:0:0:0:0:0:127
cisco-rp-discovery
FF0X:0:0:0:0:0:0:128
Gatekeeper
FF0X:0:0:0:0:0:0:129
Iberiagames
FF0X:0:0:0:0:0:0:12A
Rwho
FF0X:0:0:0:0:0:0:201
SUN RPC 
FF0X:0:0:0:0:0:0:202
Mbus/Ipv6
FF0X:0:0:0:0:0:0:300
Multimedia
FF0X:0:0:0:0:0:2:0000-FF0X:0:0:0:0:0:2:7FFD
SAPv1
FF0X:0:0:0:0:0:2:7FFE
SAPv0
FF0X:0:0:0:0:0:2:7FFF
SAP
FF0X:0:0:0:0:0:2:8000-FF0X:0:0:0:0:0:2:FFFF
R FC  2373 also provides a method for mapping multicast addresses into M AC
addresses.T he low-order 32 bits of the multicast address generate the M AC
address.T his is only feasible for group IDs that have 32 bits or fewer. IPv6 multi-
cast address assignment should be done so that the group ID is always in the low-
order 32 bits.
Anycast Address
Any address assigned to more than one interface is considered an IPv6 anycast
address. Packets sent to an anycast address are routed dynamically to the nearest
interface conﬁgured with the anycast address. R outing protocols determine the
“nearness” of the closest (in terms of routing distance) anycast interface.Anycast
www.syngress.com
Table 4.5 Continued
Reserved For
Multicast-Address

146
Chapter 4 • Explaining IPv6 Addressing
addresses are indistinguishable from a unicast address. R outers must be conﬁgured
to handle anycast packets.Anycast addresses are beneﬁcial because they can be
used to augment dynamic routing protocols when choosing the shortest path to a
destination. For example, anycast addresses can be conﬁgured on a set of Internet
router interfaces to provide one address for routing to the Internet. Dynamic
routing forwards along the best path to the anycast address.An additional beneﬁt
of anycast addressing is the capability to load share to multiple hosts.An example
of this is if a user wants to use a service provided on multiple servers.T he user
initiates a connection to the anycast address and the packet is routed to the nearest
server based on the dynamic route.T he user does not have to specify which server
to connect to.T his requires each server to be conﬁgured with the anycast address.
T he anycast address for routers is called the subnet-router anycast address.All routers
are required to support this address for the interfaces that are conﬁgured as sub-
nets. Figure 4.16 depicts the format of the subnet-router anycast address.
In addition to the subnet-router anycast address, there are two reserved any-
cast addresses.T he format of these addresses is dependent on the type of IPv6
address conﬁgured.T he format is determined by examining the format preﬁx.A
simple rule to remember is this: If the leading bits of an address equals 000, then
the interface ID can have any width; if the leading bits of an address is not equal
to 000, then the interface ID is 64 bits wide.T he only exception is the multicast
address discussed earlier. Figure 4.17 depicts the anycast address structure for the
types of addresses that require the 64-bit interface ID.
T he universal/ local bit must be set to 0 for this type of anycast address.T he
second reserved anycast address covers all addresses whose format preﬁx equals
www.syngress.com
Figure 4.16 Anycast Address
Subnet Prefix
0000000000000
n bits
128-n bits
Figure 4.17 Anycast Addresses Requiring EUI-64 Format
Subnet Prefix
Anycast ID
1111110111...111
64 bits
Interface Identifier Field
57 bits
7 bits

Explaining IPv6 Addressing • Chapter 4
147
000.T hese are addresses whose interface ID is not in EU I-64 format.T he
Interface ID length is dependent upon the subnet preﬁx. Figure 4.18 depicts this
type of address.
Anycast addresses in this format AR E N O T  to be assigned as unicast
addresses on any interface.Additional anycast identiﬁers are anticipated in the
near future. C urrently three reserve subnet anycast identiﬁers exist:
■
7E = 126 Decimal (used for M obile IPv6 H ome-Agents anycast)
■
7F = 127 Decimal 
■
00 = 0 Decimal
If we were to write the mobile IPv6 home agents IPv6 EU I-64 interface ID
address, it would be represented as follows:
1111110111111111     1111111111111111    1111111111111111   1111111111111110
T he 0 in the ﬁrst 16 bits is the universal local bit and means this address is
local.T he last eight bits of the address represent 7E. 11111110 = 7E in hex.
N odes-R equired Address
IPv6 requires that certain addresses be conﬁgured to route IPv6 packets.To acti-
vate IPv6 routing on a C isco router, a site-local or global unicast address must be
conﬁgured.T his automatically conﬁgures the link-local address for that interface.
In addition, the router automatically joins the required multicast groups.T he fol-
lowing listing shows an example of this:
6Router-1#sh conf
interface Ethernet0
ip address 192.168.123.50 255.255.255.0
no ip route-cache
no ip mroute-cache
<<<<remaining output omitted>>>>
www.syngress.com
Figure 4.18 Anycast Address Non–EUI-64 Format
Subnet Prefix
Anycast ID
1111111...111111
n bits
Interface Identifier Field
121-n bits
7 bits

148
Chapter 4 • Explaining IPv6 Addressing
6Router-1#sh int e 0
Ethernet0 is up, line protocol is up 
Hardware is Lance, address is 00e0.b05a.d998 (bia 00e0.b05a.d998)
Internet address is 192.168.123.50/24  
<<<<remaining output omitted>>>>
T he following listing shows the output after an IPv6 address is conﬁgured on
the router:
6Router-1#sh ipv6 int e 0
Ethernet0 is up, line protocol is up
IPv6 is enabled, link-local address is FE80::2E0:B0FF:FE5A:D998 
Global unicast address(es):
3FFE:4200:1:1::1, subnet is 3FFE:4200:1:1::/64 
Joined group address(es):
FF02::1:FF00:1
FF02::1
FF02::2
FF02::1:FF5A:D998
MTU is 1500 bytes
<<<<remaining output omitted>>>>
As can be seen from this output, the router automatically created the fol-
lowing addresses:
FE80::2E0:B0FF:FE5A:D998     Link-local address
3FFE:4200:1:1::1             Global unicast address
3FFE:4200:1:1::/64           Subnet router anycast address
FF02::1:FF00:1               Solicited-node multicast group
FF02::1                      All-nodes multicast group
FF02::2                      All-routers multicast group
FF02::1:FF5A:D998            Solicited-node multicast range (in 
combination with solicited node group)
As can be seen from this output, IPv6 is signiﬁcantly different from IPv4
addressing in terms of the affect it has on each interface.T he following list is a
summarization of the required addresses for IPv6 to operate between a host and 
a router.
A host deployed with IPv6 must recognize the following addresses:
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
149
■
U nicast address
■
Loopback address
■
Link-local address
■
All-nodes multicast address
■
Solicited-node multicast address (for each unicast and anycast address
conﬁgured)
■
M ulticast address for all groups that the host belongs to
R outers must recognize the same addresses as the host plus the following:
■
Subnet router anycast address for each subnet that the router advertises
■
All routers multicast address
■
Anycast address
The Need for Further Development
Although IPv6 does in fact present many new and useful ideas aimed at increased
efﬁciency and ease of routing and conﬁguration, the work that is needed prior to
deploying IPv6 natively on the Internet is not done. In this section, we will look at
one current issue that is gaining increased attention by the IET F’s IPv6 working
gruop formerly called the Internet Protocol N ext-Generation Working Group
(IPN GW G). See http:/ / playground.sun.com/ pub/ ipng/ html/ png-main.html for
information on the working group’s charter and the current status of their goals.
The Multihoming Problem
M ultihoming is an issue that is mentioned throughout this chapter as a limitation
of the IPv6 architecture.You have seen how IPv6 provides an addressing architec-
ture that is hierarchical, scalable, and efﬁcient in terms of address allocation,
aggregation, and structure. H owever, these beneﬁts do not apply to environments
that wish to implement dual-homing solutions to multiple service providers. Dual
homing is a necessity for ensuring Internet connectivity in the event that the pri-
mary link to a service provider fails. Dual homing to the same service provider is
not an issue if a link fails (unless it becomes a congestion issue), but if the service
provider experiences a failure on its backbone, it impacts Internet connectivity
regardless of how many redundant links you have. Industry best practices recom-
mend that end customers dual home to multiple service providers, especially in
www.syngress.com

150
Chapter 4 • Explaining IPv6 Addressing
the environments where Internet connectivity is an integral part of the day-to-
day business of an organization. O ne of the basic premises of IPv6 address space
is that it is non-portable. In other words, one provider cannot advertise address
space that belongs to an aggregate of another.Two types of dual homing exist
from a customer SLA edge: via a single router or via multiple routers.T he dual-
homing problem is also evident between providers, but our discussion focuses on
the end SLA customers. Figure 4.19 depicts an SLA customer who is multi-
homed to two service providers via a single router.
In this scenario, the SLA customer has dual connections to different providers
on a single router. Figure 4.20 depicts an SLA customer who is multihomed via
multiple routers.
www.syngress.com
Figure 4.19 Multihomed Single Router
sub-TLA 1
sub-TLA 2
NLA 1
NLA 2
Figure 4.20 Multihomed Multiple Routers
sub-TLA 1
sub-TLA 2
NLA 1
NLA 2

Explaining IPv6 Addressing • Chapter 4
151
In this scenario, the SLA customer has single connections to different
providers on separate routers.T he Ethernet connection is for example purposes
only.T he routers do not have to be on the same LAN  and may in fact be in sep-
arate geographical locations.
M ultiple solutions are being investigated that enable these types of peer-to-
peer connections to take place. Some of the proposed solutions are as follows:
■
Dual IPv6 addressing on a host
■
Portability of address space
■
Dual IPv6 address preﬁxes allocated within the environment
■
Independently assigned address space
Dual IPv6 Addressing on a H ost
T he solution of dual IPv6 addressing on a host requires that host machines
internal to the SLA be conﬁgured with IPv6 addresses from each provider.T he
host makes a decision of which IPv6 source address is used based on the avail-
ability of a viable path to an outside host.W hen a broken path is found, the
router that is aware of it signals the host machines. IPv6 addresses are conﬁgured
with a lifetime attribute. Lifetime has two values: preferred and valid.T he lifetime
value determines the time that an IPv6 address is valid. Preferred lifetime must be
equal to or less than the valid lifetime value.T he preferred lifetime attribute can
be set to zero to inform a host that the IPv6 source address for the broken link is
invalid.T his attribute is encoded in the preﬁx that the router(s) advertise within
the SLA environment. In our example, if the link between the SLA customer and
the N LA1 or N LA2 provider goes down, the hosts within the environment auto-
matically adjust the source IPv6 address to the valid preﬁx needed for routing.
T he implication here is that the host machines are capable of supporting this fea-
ture.Alternatively, the external host must be aware of the change to the destina-
tion IPv6 address when it sends a response to the internal SLA host.T his can
only be accomplished with DN S, because no signaling is done between the
internal SLA host and the external host. Several efforts are under way to address
the DN S architecture needed to support this solution. R FC  1886 outlines IPv6
DN S solutions. In addition to the inefﬁcient allocation of address space, the solu-
tion proposed also has issues with T C P.T C P does not allow for address changing
in the middle of a T C P session. T he only solution to this is to adjust T C P to
allow for this, which in itself seems easy, but the ramiﬁcations are far more than
meet the eye. M ost T C P applications are built in such a way that modiﬁcations of
www.syngress.com

152
Chapter 4 • Explaining IPv6 Addressing
T C P would require modiﬁcations of the application.T his could mean drastic
reworking of current network software.Also, current operating systems them-
selves may need overhauling in order to switch source addresses dynamically
when a network becomes unreachable. H ow does a source know that a network
failure has occurred in the right place? W hat if the destination had a problem?
H ow would the source know if switching IPv6 source addresses would ﬁx the
problem?
Portability of Address Space
Portable address space means that upstream providers announce preﬁxes for SLA
customers that are not part of their assigned aggregated preﬁx.Again, the use of
portable address space introduces smaller preﬁxes that need to be advertised glob-
ally on the Internet.T his is the same issue created in the IPv4 space that has gen-
erated the enormous routing tables seen in today’s Internet backbones.W hile this
solution breaks down the aggregation advancements achieved by IPv6, it might
be a necessary evil. For example, an upstream provider N LA1 assigns its SLA cus-
tomer an address preﬁx.T he SLA has a redundant connection to N LA2 that
serves as a backup to the N LA1 connection. In the event that the connection to
N LA1 fails, N LA2 is required to announce the preﬁx assigned by N LA1.T his
breaks the aggregation of addresses advertised to the upstream sub-T LA by
N LA2. Sub-T LA-2 now has an entry in its routing table that is carved out of the
sub-T LA1 address space in addition to the aggregate advertised by sub-T LA1.
Dual IPv6 Address Preﬁxes 
Allocated within the Environment 
T he solution of allocating dual IPv6 address preﬁxes within the environment calls
for IPv6 addresses from each provider to be distributed throughout the SLA
environment. H osts communicating to N LA1 utilize N LA1 address preﬁxes and
hosts communicating to N LA2 utilize N LA2 address preﬁxes.T his solution
doesn’t address the redundancy requirement for customer networks. Even though
the customer has dual internet connection, a host can use only one connection at
a time. Portable address space is the only way to overcome this issue. For
example, if a customer loses a link to N LA2, N LA1 must advertise a preﬁx
belonging to N LA2.T his generates two entries in N LA1’s routing table. O ne is
the global aggregate route of the sub-T LA2 that provides the path to N LA2 and
the second is the SLA preﬁx injected by the customer.T his scenario is similar to
the inefﬁciencies seen in today’s IPv4 routing tables.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
153
Independently Assigned Address Space
Another solution under review is the assignment of independent address space to
the SLAs.Addresses assigned independently are not part of the aggregate preﬁxes
assigned to the sub-T LAs.T his means that every sub-T LA would have a globally
unique address allocation that is a summarized advertisement to the upstream
providers.T he addresses assigned are portable and accepted as valid preﬁxes by all
service providers. Due to the scope of the IPv6 address space, this appears to be
the most viable solution.
A tremendous amount of focus is on the multihoming issue. R esolution of
this issue and the adoption of a standard practice is a major obstacle to the adop-
tion of the IPv6 address space within the Internet community.
The 6Bone
N ow that you have the basis for understanding elementary IPv6 addressing and
routing, let us look into current IPv6 deployment and the successes and short-
comings of them.T he primary example of IPv6 deployment is the IET F N ext-
Generation Transition Working Group (N GT R AN SW G) 6Bone.T he 6Bone is a
network of IPv6-speaking entities interconnected over the classical IPv4 Internet.
It consists of both native networks (where IPv6 is running without being tun-
neled through another Layer 3 protocol) and IPv4 tunnels between different IPv6
speaking entities.T he purpose of this network is twofold.T he ﬁrst reason for the
6Bone is to provide implementers a means to test their IPv6 implementations in
a large network where other vendors have deployed their own version of IPv6
implementations. By enabling this, we can ensure that IPv6 implementations are
interoperable.T his way, protocol developers can make sure that the protocol spec-
iﬁcations are speciﬁc enough to allow for implementers to develop IPv6-speaking
machines without ambiguity.T he second reason for the 6Bone is to give net-
works operators a chance to design networks and get their feet wet with the new
protocol.Also, it enables operators to uncover any problems with the IPv6 pro-
tocol (such as the previous multihoming problems) that may have been missed or
underappreciated during the protocol’s conception.Although the fathers of the
IPv6 protocol were extremely meticulous in the protocol’s design, it never hurts
to get the new technology running on a live network somewhere prior to imple-
mentation on a grand scale.T he 6Bone helps to work out all the details and test
new features, prior to deployment, in a cooperative, multinational fashion.T he
6Bone is not only a tremendous asset for dampening the learning curve for enti-
ties wishing to deploy IPv6, but is also a way to partially meet the criteria for
www.syngress.com

154
Chapter 4 • Explaining IPv6 Addressing
obtaining IPv6 address allocations.AR IN  and the other IR s have established a
temporary bootstrap phase that established requirements for obtaining an initial
allocation of IPv6 addresses.T he bootstrap phase is temporary until the
widespread allocation of IPv6 addresses enables the IR s to move into the general
phase. Please refer to the IR ’s Web pages for the policies governing IPv6 address
allocations.T he Web pages are as follows:
■
ARIN www.arin.net
■
RIPE www.ripe.net
■
APNIC www.apnic.net
T he 6Bone utilizes routing practices as deﬁned by the IET F. For the most
current IPv6 routing practices on the 6Bone, see R FC  2772 (www.ieft.org/
rtc/ rfc2772.txt). For more information on the 6Bone, please see www.6bone.net.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
155
Summary
IPv6 provides for many of the much-needed improvements in the Internet that
we will need in the near future. N ot only does it solve the address depletion
problems of today’s IPv4, but it also makes for a more scalable Internet core,
which can help improve routing efﬁciency of the Internet as a whole. By
allowing for 128 bits of addresses, we can see that adequate address space is avail-
able for the future. By then aggregating this address space in an efﬁcient manner,
we may establish a ﬁrm upper limit on routing table size in the Internet core.
T his, in turn, can help us to build an Internet to take us into the future.
Although the two primary problems of the Internet can be solved with IPv6,
the protocol improvements do not stop there.Also built into the IPv6 protocol
are means for hop-by-hop routing, authentication of packets, encrypted packets,
tag switching, Q oS, and other things to make the protocol more versatile than its
grandfather, IPv4. Furthermore, IPv6 has built into it the capability to use multi-
cast and unicast routing in a manner such that boundaries easily can be scoped to
ensure that data does not get to places where it is not allowed. IPv6 also intro-
duces the use of an anycast address, for applications that may be serviced by mul-
tiple machines, but the need for distribution of these services in a scalable manner
is required.
IPv6 is already in testing, and is starting into production in some areas, con-
nected via the 6Bone.T his virtual backbone will provide for testing of both IPv6
implementations and the protocol itself. C learly, the IPv6 is getting more and
more attention and is looking like a promising tool for the future of the Internet.
Solutions Fast Track
T he Basics of IPv6 Addressing
 IPv6 uses a 128-bit format that represents the next generation of
Internet protocol that can meet both the current addressing
requirements and those generated by emerging markets.
 IPv6 was not developed solely as a mechanism for addressing address
depletion. It provides enhancements to aggregation, Q oS, security, and
routing.
www.syngress.com

156
Chapter 4 • Explaining IPv6 Addressing
 C onverting to IPv6 is not a trivial task; it is an entirely new addressing
structure that introduces complexities in the deployment and
management of the address space.
IPv6 Addressing Scheme C haracteristics
 A format for the deployment of highly structured, hierarchical address
space is introduced in the global unicast address space.
 Due to the variety of address types used in the IPv6 address architecture,
routers now have multiple addresses per physical interface.T his can
include the global unicast address, link-local address, site-local address,
and multicast addresses on a per-interface basis.
 IPv6 provides three mechanisms for representing the interface identiﬁer
of the host address portion of an IPv6 address.T hese mechanisms are the
M AC  address, the converted EU I-64 address, and an IPv4 address.
T he N eed for Further Development
 M ultihoming to multiple service providers can defeat the highly
structured aggregation policies deﬁned in the IPv6 address architecture.
A tremendous amount of focus exists in the area of multihoming to
alleviate these issues.
 M odiﬁcations to the T C P stack and to DN S architectures are required
to fully realize the beneﬁts of the IPv6 addressing.
 T he 6Bone provides a test bed for the development of IPv6
infrastructures and is constantly evolving to meet the requirements
generated by ongoing deployments of IPv6.
www.syngress.com

Explaining IPv6 Addressing • Chapter 4
157
Q: H ow do I subnet my address space if I am an SLA?
A: Subnetting of the IPv6 address space assigned to you by an N LA or sub-T LA
provider is up to you.T he ﬁrst thing to do is to completely understand how
the address space is broken up.T his means that you need to understand the
IPv6 address SLA structure completely.T he 16 SLA bits provide 65,535 sub-
nets and the 64 interface identiﬁer bits provide 4,294,967,295 hosts per
subnet. For subnetting purposes, I would recommend starting with subnet
one and allocating as needed from there.T he host addresses are assigned auto-
matically with either M AC  addresses of the host or EU I-64 addresses con-
verted from M AC  addresses.T he exception to interface ID rule is if you want
to translate the current IPv4 address into an IPv6 address.Your ﬁrst subnet
could be 0000000000000001:Interface IDs; your second could be
0000000000000002:Interface IDs, and so on.T he ﬁrst part of the address has
been omitted, because these are dependent on whether the address is site
local or a global unicast address.
Q: W ill IPv6 ever see widespread deployment?
A: T his is a question that everyone will have to ask sooner rather than later.
Although limitations to using IPv6 in a dual-homed environment exist and
complexities are associated with the deployment, IPv6 will be deployed. IPv4
address space has a limited lifespan and estimates have put its exhaustion
between the years 2008-2015.
Q: H ow can I get onto the 6Bone?
A: T he 6Bone has a mailing list where operational issues associated with it, as
well as new proposals for transition strategies, are discussed and collaborated
upon.T his list can be joined by sending e-mail to majordomo@isi.edu, with
“subscribe 6bone” as the contents of the message. It is encouraged that all
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

158
Chapter 4 • Explaining IPv6 Addressing
mailing list members of the 6Bone actually become IPv6 speakers on the
6Bone as well. R efer to the Web page www.6bone.net for information on
how to get connected and to ﬁnd the nearest upstream provider to obtain a
tunnel.
Q: W here do I get an IPv6 address?
A: T he providers who have them delegate IPv6 addresses.W hen you join the
6Bone or any other IPv6 network, your upstream provider is responsible for
providing you with adequate IPv6 address space to take care of your needs.
Q: W here do I get the IPv6 protocol speciﬁcations for more details?
A: All protocol speciﬁcations are in the form of IET F R FC s.T hese can be found
at www.ietf.org, where a search engine helps you pull up all current IPv6
R FC  and Internet drafts.
www.syngress.com

Conﬁguring IPv6
Addressing
Solutions in this chapter:
■
Conﬁguring IPv6 Addressing 
■
Verifying Addressing Conﬁguration
Chapter 5
159
 Summary
 Solutions Fast Track
 Frequently Asked Questions

160
Chapter 5 • Conﬁguring IPv6 Addressing
Introduction
T his chapter will explain the commands required to conﬁgure IPv6 addresses and
associated parameters on the C isco IO S, and should enable you to effectively
conﬁgure IPv6 on either your own network or a customer’s network.T his
chapter is geared toward those who want to learn the exact command syntax
necessary to fully conﬁgure the C isco router to support IPv6.
T he second half of the chapter is dedicated to verifying the router conﬁgura-
tion.We will cover the commands that are necessary to quickly view key infor-
mation about the IPv6 conﬁguration. Each command will be discussed in detail
to ensure that you have all the tools necessary to conﬁgure and verify IPv6 on
the IO S-based C isco router.
Conﬁguring IPv6 Addressing 
T he ﬁrst step in conﬁguring IPv6 on your router is making sure that the correct
version of IO S is installed on the router. IPv6 was ﬁrst introduced in IO S version
12.2(1)T  Technology release, so that is the earliest version that can be used.T he
C isco IO S version can be checked using the show version command, a sample
output of which is seen below. For a thorough explanation of IO S version num-
bering, please visit C isco’s Web site.
6Router-1#show version
Cisco Internetwork Operating System Software
IOS (tm) 2500 Software (C2500-IS-L), Version 12.2(8)T,  RELEASE 
SOFTWARE (fc2)
TAC Support: http://www.cisco.com/tac
Copyright (c) 1986-2002 by cisco Systems, Inc.
Compiled Wed 13-Feb-02 21:11 by ccai
Image text-base: 0x0306DA78, data-base: 0x00001000
As you can see from this output, the version of code being used on the router
is C isco IO S 12.2(8)T, which at the time of the writing of this book is the latest
release.We will look next at some of the commands that can be conﬁgured on
the router for IPv6.T hese will be broken down into LAN  and WAN  conﬁgura-
tions. Some of the commands from the router are listed below to give a quick
overview of the various commands that can be conﬁgured just for IPv6.T he ﬁrst
mode shown is the global conﬁguration mode.T he second list shown is one from
an interface, in this case an Ethernet interface.
www.syngress.com

www.syngress.com
6Router-1(conﬁg)#ipv6 ?
access-list
Conﬁgure access lists
hop-limit
Conﬁgure hop count limit
host
Conﬁgure static hostnames
icmp
Conﬁgure ICMP parameters
neighbor
Neighbor
preﬁx-list
Build a preﬁx list
route
Conﬁgure static routes
router
Enable an IPv6 routing process
unicast-routing
Enable unicast routing
6Router-1(conﬁg-if)#ipv6 ?
IPv6 interface subcommands:
address
Conﬁgure IPv6 address on interface
enable
Enable IPv6 on interface
mtu
Set IPv6 Maximum Transmission Unit
nd
IPv6 interface Neighbor Discovery subcommands
redirects
Enable sending of ICMP Redirect messages
rip
Conﬁgure RIP routing protocol
trafﬁc-ﬁlter
Access control list for packets
unnumbered
Conﬁgure IPv6 interface as unnumbered
O nce you have veriﬁed that the C isco IO S version you are using supports
IPv6, the next step is to enable IPv6 globally on the router.T his is done while in
the conﬁguration mode with the command is ipv6 unicast-routing.T his command
enables IPv6 for the entire router. If this command is not enabled globally, the
rest of the commands on the interfaces will not operate.T he command to enable
IPv6 on the router is shown below.
6Router-1#conf t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 unicast-routing
6Router-1(conﬁg)#
Enabling IPv6 globally does not do much good until IPv6 is conﬁgured on
some individual interfaces, so the next step is to enable IPv6 on the desired inter-
faces.T he following sections will cover how to conﬁgure the IPv6 address on
LAN  and WAN  interfaces, as well as how to conﬁgure some of the options avail-
able for tuning IPv6.
Conﬁguring IPv6 Addressing • Chapter 5
161

162
Chapter 5 • Conﬁguring IPv6 Addressing
Conﬁguring LAN Addresses
T here are a few steps involved in conﬁguring the LAN  address.Assuming that
the IPv6 global routing has already been conﬁgured, the ﬁrst step is to conﬁgure
the actual interface. In most cases this will be an Ethernet interface, although it is
currently possible to conﬁgure IPv6 on Token R ing and Fiber Distributed Data
Interface (FDDI) as well.T his section will focus on Ethernet interfaces.
T he process of conﬁguring an IPv6 address on an interface is pretty straight-
forward.T here are three types of addresses that can be assigned on LAN
addresses.T he three types are link-local, site-local and the global addresses.T he
global and site-local addresses are assigned at the same time. If a global address is
already assigned by the architecture of your network, then the full address will be
typed in during conﬁguration. If only the ﬁrst 64 bits are speciﬁed, then the
E xtended U nique Identiﬁer (E U I) command at the end of the global address will
have an interface identiﬁer assigned for the global address.To enter the address in
the router, go into conﬁguration mode and then select the desired interface.
Each of the commands can be seen below, the ﬁrst with the full address and the
second using the E U I parameter at the end of the command to have the router
assign the last 64 bits of the address.
T he EU I works similarly to the link-local addresses that will be discussed
later in the chapter. If the EU I is used, then only the ﬁrst 64 bits of the address
need to be speciﬁed; the rest of the address will be ﬁlled in automatically using
the M AC  address of the router. If there are multiple interfaces using the E U I
parameter, you will notice that all of the interfaces will have addresses with the
same last 64 bits.
Router conﬁguration for predetermined global address
6Router-1#conf t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#int e0
6Router-1(conﬁg-if)#ipv6 address 2000:1:1::1/64
6Router-1(conﬁg-if)#
Router conﬁguration for global address to be assigned interface identiﬁer
6Router-1#conf t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#int e0
6Router-1(conﬁg-if)#ipv6 address 2000:1:1:1::/64 eui-64
6Router-1(conﬁg-if)#
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
163
W hen the E U I parameter is used, the remaining 64 bits of the address are
automatically ﬁlled in by the router.T he address produced by the command above
can be seen below. N otice that only the ﬁrst 64 bits were deﬁned above.Also
notice that the link-local address has the same last 64 bits as the global address.
6Router-1#sh ipv6 int e0
Serial1 is down, line protocol is down
IPv6 is enabled, link-local address is FE80::2E0:B0FF:FE5A:D998
Global unicast address(es):
2001:1:1:1:2E0:B0FF:FE5A:D998, subnet is 2001:1:1:1::/64
W hen the IPv6 address has been assigned to the interface, by default IPv6 is
also enabled on the interface itself. H aving IPv6 enabled on the interface assigns
www.syngress.com
EUI-64
The Extended Unique Identiﬁer (EUI) can be used when assigning
addresses. This is something that you may want to consider using when
designing your network—it may use up a little more address space, but
it can make deploying the network a bit simpler. One of the beneﬁts of
using the EUI is that you don’t have to know the last 64 bits of the
address, as the router will ﬁgure that out based on the 48-bit identiﬁer
that is used for the interface. The other 16 bits are randomly generated.
(If more than one interface of a router is conﬁgured using the EUI
parameter, then all of the interfaces will share the same last 64 bits. This
can make monitoring a little easier: if you know the MAC address of the
router, then you can recognize as a router address any IPv6 address that
has that MAC address in it.
This can also be a problem in the eyes of the administrator because
now, instead of setting the interface IPv6 address, the router is assigning
the value, which can be difﬁcult to manage. Also, if the EUI is used and
an end user machine needs to be statically deﬁned, then the end user
won’t know what the router interface address is (although sometimes
that can be a good thing). The traditional way to set up a router inter-
face is to use an address at the beginning or the end of the address
space. 
Designing & Planning…

164
Chapter 5 • Conﬁguring IPv6 Addressing
the interface a link-local address.T his address (as discussed in C hapter 4) is a
local-only address that is not propagated outside of the local link.T he router
automatically assigns a link-local address, and will typically use the EU I identiﬁ-
cation of the router for the last 64 bits of the address. If the architecture of your
network requires that the local links have speciﬁc addresses, you can assign an
address as link-local by simply typing link-local after the IPv6 address in the
conﬁguration. R emember that for link-local to be enabled the address must be a
valid one— it must be between FE80 and FEBF.T he command can be seen
below, followed by an example of an invalid address attempt:
6Router-1#conf t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#int e0
6Router-1(conﬁg-if)#ipv6 address fe80::1:1:1:1 link-local
6Router-1(conﬁg-if)#
6Router-1(conﬁg-if)#ipv6 addr 2001::1 link-local
Invalid link-local address
6Router-1(conﬁg-if)#
Sometimes an interface may not require an IPv6 interface, as is the case when
subinterfaces are used for tunneling.T he conﬁguration of an unnumbered inter-
face is similar to the equivalent IPv4 conﬁguration. Simply type the command
ipv6 unnumbered and the interface will have no IPv6 address assigned to it,
although it will be associated with the interface speciﬁed at the end of the com-
mand.An unnumbered interface can also be used for segments that will use only
link-local addresses.As with a regular IPv6 address, IPv6 is enabled when an
unnumbered address is conﬁgured. If no global address is needed, then a link-
local address will be conﬁgured just by enabling IPv6 on the interface.T he com-
mand for enabling IPv6 on an interface while maintaining an unnumbered
interface is shown here:
6Router-1#conf t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#int s1
6Router-1(conﬁg-if)#ipv6 unnumbered loopback0
6Router-1(conﬁg-if)#ipv6 enable
If desired, multiple IPv6 addresses can be assigned to an interface. C isco IO S
release 12.2.(4)T  or later is required for this operation. U nlike IPv4, the secondary
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
165
command is not necessary when adding a second IPv6 address; simply add
another IPv6 address on the desired interface and the interface will now have
multiple IPv6 addresses. N ote that at present only one link-local address is sup-
ported.T his will probably not change, because there should not be a demand for
multiple local addresses.W hen the IPv6 address is assigned on an interface, the
interface by default will join several multicast groups for that interface.T he mul-
ticast address joins the all-nodes multicast group, the all-routers multicast group and
the solicited-node multicast group. Figure 5.1 is a quick diagram of the network as
conﬁgured above.
C onﬁguring Duplicate Address Detection
T he purpose of duplicate address detection is to verify that a new IPv6 address is
unique to the router.T he router will check its other interfaces using neighbor
solicitation messages to verify that the IPv6 address is unique; if it is not, then an
error will be returned stating that the IPv6 address is a duplicate and indicating
what interface the address resides on.T his feature is on the router by default, and
thus requires no conﬁguration, but there is a parameter that can be conﬁgured for
the detection process: the number of solicitation messages that are sent out by an
interface can be changed in the conﬁguration (the default is one). It must fall in
the range from 0 to 600.T he command is as follows:
6Router-1(conﬁg-if)#ipv6 nd dad attempts 2
T he duplicate address detection can be turned off by setting the value of
attempts to zero.T his will shut off the detection for that interface only. If you
want to turn off duplicate address detection for an entire router, every interface
on the router must have the attempt number set to zero. N ote that the command
no ipv6 nd dad attempts will not disable duplicate address detection on that router
interface, but will instead reset the number of attempts to the default of one.T his
www.syngress.com
Figure 5.1 LAN Diagram
Ethernet
Ethernet
6Router-2
6Router-1
S0
S0
2000:1:1::1/ 64
2000:1:1::2/ 64
2000:1:2::1/ 64
2000:1:3::1/ 64
Loopback 0
2000:1:5::1/ 128
Loopback 0
2000:1:5::2/ 128

166
Chapter 5 • Conﬁguring IPv6 Addressing
is counterintuitive to the usual procedure of C isco IO S, but that is the way 
it works.
C onﬁguring DN S
C onﬁguring the Domain N ame System (DN S) for IPv6 is not unlike conﬁg-
uring it for IPv4. DN S is enabled by default, but having DN S enabled on your
router does not enable it for the interfaces. O nly the router itself uses the DN S
information, meaning that specifying a DN S server on the router will not send
that information out through the Ethernet interface to the clients of the inter-
face. DN S is often shut off on the router because the DN S server will sometimes
www.syngress.com
Duplicate Address Detection
It should be noted that when duplicate address detection is used, there
will only be an error message if the duplicate IPv6 address is on the same
router. When a duplicate IPv6 address is tried on an Ethernet interface
and that address is already assigned to a serial interface, an error mes-
sage is displayed. But if you are conﬁguring two neighbor routers and,
for example, you mistype the IPv6 address to be the same as the router
on the other end, you will not get an error message! Duplicate address
detection is used mostly for Ethernet interfaces because most serial
interfaces are point-to-point, so the duplicate address detection does
not provide much functionality. However, if you use the command show
ipv6 interface XXX, the IPv6 address will show up as a duplicate
because it is still discovered. In addition, if duplicate address detection
was turned off on an interface and then turned on, it will not give an
error message for already conﬁgured addresses. 
Note that duplicate address detection is for unicast addresses
only—it must not be performed on anycast addresses. Duplicate address
detection is most useful for link-local addresses, because they are usu-
ally automatically assigned. Most global and site-local address are
already assigned and there should not be any nodes that are assigned
the same address as the router, so the likelihood of having a duplicate
address is already reduced.
Conﬁguring & Implementing…

Conﬁguring IPv6 Addressing • Chapter 5
167
try to attach itself to mistyped commands, which wastes time. If DN S has been
shut off and needs to be turned back on, use the command shown here:
6Router-1(conﬁg)#ip domain-lookup
W ith DN S enabled, there are a few additional features that become available,
very similar to the ones available with IPv4.A name server and default domain
name can be speciﬁed.T he commands for entering a domain name or domain
list are, not surprisingly, the same as IPv4, because only names are being speciﬁed.
H owever, when conﬁguring the name server, the command does not use IP v6 in
the command but must distinguish between IPv4 and IPv6.T he command can
have either an IPv4 or IPv6 address entered; the example below shows IPv6:
6Router-1(conﬁg)#ip name-server 1000:1000:2ad::2000:2000:2
WARNING
The command shown above is not supported by Cisco IOS code
12.2(4)T1. It is supported by Cisco IOS 12.2(8)T and later. 
As with IPv4, you can also use host-name-to-address mappings.T his is espe-
cially convenient given the length of some of the IPv6 addresses, as it enables you
to type just a name instead of the whole address. H ost names are often used with
routers that have asynchronous connections to other routers and switch console
ports.A host name mapping is the easiest way to conﬁgure those routers. Several
examples of host name mapping are shown below. N otice how the ipv6 com-
mand is used to specify that the address is going to be IPv6.T he ﬁrst example
shows how to set up a direct host name for the IPv6 address; the second shows
how to set the host name to the local router and out of the A ux port (which
could be connected to another 6router-2 console port). In the second command,
remember that 2001 is the port number that the host name maps to (in this case
the A ux port), and not part of the IPv6 address.
6Router-1(conﬁg)# ipv6 host 6Router-2 2000:1:1::2
6Router-1(conﬁg)# ipv6 host backup  2001 2000:1:5::1 
www.syngress.com

168
Chapter 5 • Conﬁguring IPv6 Addressing
Conﬁguring WAN Addresses
N ow let’s take a look at conﬁguring the WAN  addresses with respect to IPv6,
with a focus on  Asynchronous Transfer M ode (AT M ) and Frame-R elay. Just as
with the LAN  addresses, there are some differences in the commands. M ost of
the commands have to do with the mapping of permanent virtual circuits
(PVC s), switched virtual circuits (SVC s), and data-link connection identiﬁers
(DLC Is) with either the AT M  or Frame-R elay network.
C onﬁguring AT M  
T he conﬁguration of AT M  using IPv6 is not very different from the conﬁgura-
tion for IPv4. IPv6 will have some different commands for the conﬁguration, but
the theory behind AT M  is the same, and IPv6 does not change the way AT M
works or offer any improvements to the AT M  platform.As we have seen in pre-
vious sections, the ipv6 address command, followed by the IPv6 address, is used to
enter an IPv6 address for an AT M  interface.
If there are several PVC s that are mapped to one interface (a point-to-multi-
point interface), the command protocol ipv6 must be entered on the interface for
the particular PVC.T his command is not needed if there are not multiple connec-
tions on one interface, because in that case the interface would just be a point-to-
point interface and no mapping would be required. For a point-to-point interface,
only an IPv6 address would be required to conﬁgure the AT M  interface.W hen
point-to-multipoint is used,AT M  mapping must be used. Examples of some con-
ﬁgurations are shown here.T he ﬁrst conﬁguration is just point-to-point:
Point-to-Point
6Router-1(conﬁg-if-atm-vc)# ipv6 address 2000:1:20::1/64
6Router-2(conﬁg-if-atm-vc)# ipv6 address 2000:1:20::2/64
Point-to-Multipoint
6Router-1(conﬁg-if-atm-vc) protocol ipv6 2000:1:20::2
6Router-1(conﬁg-if-atm-vc) protocol ipv6 fe80::1:1:20:2
6Router-1(conﬁg-if-atm-vc) ipv6 address 2000:1:20::1
6Router-2(conﬁg-if-atm-vc) protocol ipv6 2000:1:20::1
6Router-2(conﬁg-if-atm-vc) protocol ipv6 fe80::1:1:20:1
6Router-2(conﬁg-if-atm-vc) ipv6 address 2000:1:20::2
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
169
NOTE
In IPv4, Inverse ARP was used to ﬁnd the network layer address of the
node at the other end. When using IPv6, the inverse neighbor discovery
protocol will be used to by the router to discover the far end node’s
global IPv6 address. The problem is that inverse neighbor discovery is not
currently supported by Cisco IOS.
C onﬁguring Frame-R elay
As with AT M , the conﬁguration of Frame-R elay for IPv6 is not very different
from that of IPv4, but some of the commands are a little different. Since it pro-
vides no major enhancements, we’ll just explain the different commands that are
necessary when IPv6 is implemented on Frame-R elay.
Frame-R elay, like AT M , has only a few commands that need to be entered to
get the interface up and running.Also like AT M , Frame-R elay has several dif-
ferent scenarios for point-to-point and point-to-multipoint interfaces.T he ﬁrst
scenario is a fully meshed topology between three routers. Each router has a PVC
connection to the other two routers through point-to-point connections.
Because the connections are point-to-point, no mappings are needed. O ne IPv6
address is required for each PVC, just as it would be with IPv4.T he second sce-
nario also uses three routers, but this time there are no subinterfaces used on the
Frame-R elay connection. Because these interfaces are point-to-multipoint, they
will require mappings to know how to get to the other routers.T he commands
needed for this are very similar to those of IPv4, with the exception of the ipv6
designation. Some sample conﬁgurations for both point-to-point and point-to-
multipoint interfaces are shown below. N otice that, just like in IPv4, map state-
ments are only needed in point-to-multipoint instances.Also notice that the
link-local address is mapped as well as the global IPv6 address— this is one extra
command that is needed when using IPv6. Diagrams of the two frame-relay sce-
narios are shown in Figures 5.2 and 5.3.
www.syngress.com

170
Chapter 5 • Conﬁguring IPv6 Addressing
Point-to-Point
6Router-1(conﬁg)#int s0
6Router-1(conﬁg-if)#encapsulation frame-relay
6Router-1(conﬁg)#int s0.100 point-to-point
6Router-1(conﬁg-subif)#ipv6 address 2000:1:1::1/64
6Router-1(conﬁg-subif)#frame-relay interface-dlci 101
6Router-1(conﬁg)#int s0.200 point-to-point
6Router-1(conﬁg-subif)#ipv6 address 2000:1:10::1/64
6Router-1(conﬁg-subif)#frame-relay interface-dlci 201
6Router-2(conﬁg)#int s0
6Router-2(conﬁg-if)#encapsulation frame-relay
6Router-2(conﬁg)#int s0.101 point-to-point
6Router-2(conﬁg-subif)#ipv6 address 2000:1:1::2/64
6Router-2(conﬁg-subif)#frame-relay interface-dlci 100
6Router-2(conﬁg)#int s0.300 point-to-point
6Router-2(conﬁg-subif)#ipv6 address 2000:1:11::1/64
6Router-2(conﬁg-subif)#frame-relay interface-dlci 301
6Router-3(conﬁg)#int s0
6Router-3(conﬁg-if)#encapsulation frame-relay
www.syngress.com
Figure 5.2 Frame-Relay Point-to-Point
6Router-1
6Router-2
6Router-3
S0.100
2000:1:1::1/ 64
dlci 100
S0.301
2000:1:11::2/ 64
dlci 301
S0.300
2000:1:11::1/ 64
dlci 300
S0.201
2000:1:10::2/ 64
dlci 201
S0.200
2000:1:10::1/ 64
dlci 200
S0.101
2000:1:1::2/ 64
dlci 101

Conﬁguring IPv6 Addressing • Chapter 5
171
6Router-3(conﬁg)#int s0.201 point-to-point
6Router-3(conﬁg-subif)#ipv6 address 2000:1:10::2/64
6Router-3(conﬁg-subif)#frame-relay interface-dlci 200
6Router-3(conﬁg)#int s0.301 point-to-point
6Router-3(conﬁg-subif)#ipv6 address 2000:1:11::2/64
6Router-3(conﬁg-subif)#frame-relay interface-dlci 300
N otice that the commands are almost identical to the commands that would
be used for conﬁguring IPv4. T he command used to deﬁne the DLC I is exactly
the same one used with IPv4.
Point-to-Multipoint
6Router-1(conﬁg)#int s0
6Router-1(conﬁg-if)#encapsulation frame-relay
6Router-1(conﬁg-if)#ipv6 address 2000:1:1::1/64
6Router-1(conﬁg-if)#ipv6 address fe80:1:1::1 link-local
6Router-1(conﬁg-if)#frame-relay map ipv6 2000:1:1::2 200
6Router-1(conﬁg-if)#frame-relay map ipv6 2000:1:1::3 300
6Router-1(conﬁg-if)#frame-relay map ipv6 fe80:1:1::2 200
6Router-1(conﬁg-if)#frame-relay map ipv6 fe80:1:1::3 300
6Router-2(conﬁg)#int s0
www.syngress.com
Figure 5.3 Frame-Relay Point-to-Multipoint
6Router-1
6Router-2
6Router-3
S0
S0
S0
2000:1:1::2/ 64
FE80:1:1::2
dlci 200
2000:1:1::3/ 64
FE80:1:1::3
dlci 300
2000:1:1::1/ 64
FE80:1:1::1
dlci 100

172
Chapter 5 • Conﬁguring IPv6 Addressing
6Router-2(conﬁg-if)#encapsulation frame-relay
6Router-2(conﬁg-if)#ipv6 address 2000:1:1::2/64
6Router-2(conﬁg-if)#ipv6 address fe80:1:1::2 link-local
6Router-2(conﬁg-if)#frame-relay map ipv6 2000:1:1::1 100
6Router-2(conﬁg-if)#frame-relay map ipv6 2000:1:1::3 300
6Router-2(conﬁg-if)#frame-relay map ipv6 fe80:1:1::1 100
6Router-2(conﬁg-if)#frame-relay map ipv6 fe80:1:1::3 300
6Router-3(conﬁg)#int s0
6Router-3(conﬁg-if)#encapsulation frame-relay
6Router-3(conﬁg-if)#ipv6 address 2000:1:1::3/64
6Router-1(conﬁg-if)#ipv6 address fe80:1:1::3 link-local
6Router-3(conﬁg-if)#frame-relay map ipv6 2000:1:1::1 100
6Router-3(conﬁg-if)#frame-relay map ipv6 2000:1:1::2 200
6Router-3(conﬁg-if)#frame-relay map ipv6 fe80:1:1::1 100
6Router-3(conﬁg-if)#frame-relay map ipv6 fe80:1:1::1 100
Again, the commands are almost identical to the ones used for conﬁguring
IPv4.T he big difference is that the link-local address is also speciﬁed, although it
does not need to be. T he map statement must also explicitly have the ipv6
parameter in the command.
Conﬁguring ICMPv6 and Neighbor Discovery
C onﬁguring IC M Pv6 primarily involves just tweaking the settings, not actually
performing setup on the router.T he tweaking is necessary because some func-
tions of IC M P can be affected if the tweaking is not performed. O ne of the
functions that can fail is traceroute, which we all know is an invaluable tool if you
are trying to troubleshoot your network.T he tweaking adjusts the IC M P error
interval and the bucket size, or number of tokens in the bucket.
NOTE
Once again, pay attention to the version of Cisco IOS that you have on
your router. The earliest version needed to adjust the ICMPv6 rate limit is
Cisco IOS 12.2(4)T, but you cannot specify the number of tokens for the
bucket size unless you have Cisco IOS 12.2(8)T or later.
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
173
T he two parameters that can be conﬁgured for IC M Pv6 are primarily for the
router C PU  utilization and for certain functions like traceroute to function prop-
erly.T he problem with traceroute is that if the rate limit is not set low enough, it
can require rapid requests faster than the rate limit, causing the function to fail.
T he bucketsize option lets you tell the router how many tokens can be taken out
of the bucket until the process is stopped. For example, if a client were continu-
ally sending unrecognizable packets, the router would have to continually send
back error messages, potentially hurting the router’s C PU  performance.T his way,
when the bucket is empty, the router will stop sending error messages, conserving
C PU  performance.T he command to set the IC M Pv6 rate limit can be seen here.
N ote that the value of 100 is the error interval in milliseconds, and 10 is the
number of tokens that are in the bucket:
6Router-1(conﬁg)# ipv6 icmp error-interval 100 10
N eighbor discovery in IPv6 is equivalent to IP Address R esolution Protocol
(AR P) in IPv4.T he neighbor discovery process will go out and ﬁnd the 48-bit
hardware address (usually referred to as the M A C  address) that is associated with a
particular IPv6 address.T he router will keep a record of that address for a speci-
ﬁed period time. If there is no activity from the node, then the entry in the
neighbor discovery table will time out and have to be rediscovered the next time
the router needs to communicate with that node. In some instances, a static cache
entry may have to be inserted into the neighbor discovery cache. For example, if
a router needed to talk to a server, but the server was over a threshold of utiliza-
tion, it would stop responding to neighbor discovery packets.A static entry would
be needed because we still need to talk to the server even though it is busy. Static
entries are only allowed on LAN  interfaces (Ethernet, FDDI, and Token R ing).
Like AR P, neighbor discovery does not go out WAN  interfaces (Serial etc.)
because those are typically point-to-point interfaces with no nodes on them.An
example of the command to conﬁgure a static entry for the neighbor discovery
cache can be seen below. Also shown is an example of the command being
attempted on a WAN  interface:
6Router-1(conﬁg)#ipv6 neighbor 2000:1:2::10 ethernet0 0000.1234.5678
6Router-1(conﬁg)#
6Router-1(conﬁg)#ipv6 neighbor 2000:1:1::10 serial0 0000.1111.2222
% Static Neighbor Cache entries not supported on this interface type
6Router-1(conﬁg)#
www.syngress.com

174
Chapter 5 • Conﬁguring IPv6 Addressing
Verifying Addressing Conﬁguration
It is crucial to verify that all of your conﬁgurations have in fact worked.T his sec-
tion lists many of the commands that are needed to verify that the conﬁgurations
have taken place and are working the way you want them to. O bviously, the show
command will be used extensively in this section to show different parts of the
conﬁguration.T he output of the show command will be displayed, along with a
detailed description of what the important part of the output is telling you.T he
following list displays the available show commands that are speciﬁc to IPv6. (N ote
that this is an output for a router using C isco IO S 12.2(8)T — if you are using a
different version of the C isco IO S, your output may look slightly different):
6Router-1#show ipv6 ?
access-list
Summary of access lists
interface
IPv6 interface status and conﬁguration
mtu
MTU per destination cache
neighbors
Show IPv6 neighbor cache entries
preﬁx-list
List IPv6 preﬁx lists
protocols
IPv6 Routing Protocols
rip
RIP routing protocol status
route
Show IPv6 route table entries
www.syngress.com
Upgrading Cisco IOS 
As we have seen throughout the conﬁguration section of the chapter,
there are several features that require you to take notice of what version
of Cisco IOS is running on the router. You should also take care when
upgrading the Cisco IOS code: be sure to back up your conﬁguration
before upgrading the code in case there are any problems. You should
also have network diagrams of your existing network as another means
of going back to your previous network state in the event that anything
goes wrong during the upgrade. I noticed when I upgraded my Cisco
IOS from 12.2(4)T1 to 12.2(8)T that I lost all of the IPv6 conﬁgurations.
I had to use my backup conﬁgurations to restore the IPv6 portion of the
conﬁguration.
Conﬁguring & Implementing…

Conﬁguring IPv6 Addressing • Chapter 5
175
routers
Show local IPv6 routers
trafﬁc
IPv6 protocol statistics
tunnel
Summary of IPv6 tunnels
6Router-1#clear ipv6 ?
neighbors
Clear IPv6 ND Entry Cache
preﬁx-list
Preﬁx-list
route
Clear IPv6 route table entries
trafﬁc
Clear trafﬁc counters
6Router-1#debug ipv6 ?
icmp
ICMPv6 debugging
nd
IPv6 Neighbor Discovery debugging
packet
IPv6 packet debugging
rip
RIP Routing Protocol debugging
routing
IPv6 routing table debugging
T he ﬁrst command shows whether IPv6 is conﬁgured to perform a show 
running-conﬁg.T here is no way to tell whether IPv6 has been enabled other than
using this command.T here are some show commands that will indicate that the
global command has not been conﬁgured on the router, but the only sure way to
know is to check the actual conﬁguration.T he command to check the conﬁgu-
ration of the router is as follows:
6Router-1#show running-conﬁg
Building conﬁguration...
Current conﬁguration : 1487 bytes
!
version 12.2
service timestamps debug uptime
service timestamps log uptime
service password-encryption
service tcp-small-servers
!
hostname 6Router-1
!
ipv6 unicast-routing
www.syngress.com

176
Chapter 5 • Conﬁguring IPv6 Addressing
!
interface Loopback0
no ip address
no ip route-cache
no ip mroute-cache
As shown above, the command ipv6 unicast-routing is used in the conﬁguration
of the router.T his is the global command that is required for IPv6 to operate on
the router.
T he next command we will look at is similar to one used in IPv4: show ipv6
interface brief. T his command will give a brief overview of all the interfaces that
have IPv6 enabled, along with their respective global IPv6 addresses.T he status of
the interface itself— that is, whether it is in an operational state— is also listed.
N otice that only the global address is listed, not the link-local address.T hose
addresses can be seen using other commands that we will discuss later.T he output
of the show ipv6 interface brief command is shown here:
6Router-1#show ipv6 interface brief
Ethernet0                  [up/up]
2000:1:2::1
Loopback0                  [up/up]
2000:1:5::1
Serial0                    [up/up]
2000:1:1::1
Serial1                    [down/down]
unassigned
Verifying LAN Addressing
To verify that the LAN  addresses are conﬁgured correctly, perform a show ipv6
interfaces <type> command.T his command is very useful for gathering some of
the basic information about an interface, as it will display a detailed description of
what is conﬁgured for the interface.T he global and link-local addresses will be
shown, as well as different multicast groups that have been joined on the inter-
face.T here is also information on duplicate address detection and the rate limit at
which IC M P error messages are being transmitted.T he following is an example
of the output for an Ethernet interface:
6Router-1#show ipv6 int ethernet0
Ethernet0 is up, line protocol is up
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
177
IPv6 is enabled, link-local address is FE80::2E0:B0FF:FE5A:D998
Global unicast address(es):
2000:1:2::1, subnet is 2000:1:2::/64
Joined group address(es):
FF02::1
FF02::1:FF5A:D998
FF02::1:FF00:1
FF02::2
MTU is 1500 bytes
ICMP error messages limited to one every 100 milliseconds
ICMP redirects are enabled
ND DAD is enabled, number of DAD attempts: 1
ND reachable time is 30000 milliseconds
ND advertised reachable time is 0 milliseconds
ND advertised retransmit interval is 0 milliseconds
ND router advertisements are sent every 200 seconds
ND router advertisements live for 1800 seconds
Hosts use stateless autoconﬁg for addresses.
N otice that both the global address and the link-local address are shown.T he
multicast addresses are also shown in the lines that follow.
Verifying WAN Addressing
To verify that your AT M  and Frame-R elay have been set up correctly for IPv6,
you will use several commands, similar to those used with IPv4.T he ﬁrst com-
mands we will look at are the mapping commands for both AT M  and Frame-
R elay.T hese two commands are actually the same commands used with IPv4 and
will output both IPv4 and IPv6 mappings, as can be seen in the Frame-R elay
output:
6Router-1#show atm map
Map list ATM0pvc1:  PERMANENT
Ipv6 FE80::1:1 maps to VC 1,  VPI 1, VCI 32, ATM0,
Broadcast
Ipv6 2000:1:1::1 maps to VC 1, VPI 1, VCI 32, ATM0
Frame-Relay
www.syngress.com

178
Chapter 5 • Conﬁguring IPv6 Addressing
6Router-1#show frame-relay map
Serial1 (up): ip 10.10.10.2 dlci 200(0xC8,0x3080), static,
CISCO, status deﬁned, active
Serial1 (up): ipv6 2000:1:1::2 dlci 200(0xC8,0x3080), static,
CISCO, status deﬁned, active
Serial1 (up): ipv6 2000:1:1::3 dlci 300(0x12C,0x48C0), static,
CISCO, status deﬁned, active
Verifying ICMPv6 and 
Neighbor Discovery Conﬁguration
To look at the neighbor discovery cache, use the command show ipv6 neighbors
E thernet0.T he output will show all of the discovered neighbors that the router
has in its cache. Both discovered and statically conﬁgured entries will be shown,
as well as the age of each entry.A hyphen (–) in the age ﬁeld indicates that the
entry is a static one.A sample output of the command is shown here:
6Router-1#show ipv6 neighbors ethernet0
IPv6 Address                         Age Link-layer Addr State Interface
2000:1:2::10                          - 0000.1234.5678  REACH Ethernet0
2000:1:2::15                           0 0000.2345.5678  REACH Ethernet0
2000:1:2::17                           1 0000.2222.5678  REACH Ethernet0
To view IC M Pv6 trafﬁc and other general trafﬁc on the router, issue the
command show ipv6 trafﬁc.T his will give the IPv6 statistics, broken down into
general, IC M P, and U ser Datagram Protocol (U DP) statistics.Take note of the
general statistic not a router, which will have a value if the router is not globally
conﬁgured for IPv6.Although this is a good indicator that the router doesn’t
have IPv6 enabled, it is not a fool-proof way to check, unless the counters were
just cleared.T he best way to see if IPv6 is globally conﬁgured, as mentioned
before, is to check the running conﬁguration.
T he statistics listed below are the IC M P statistics. In the Sent portion you can
see how many of the packets were rate-limited.You can also see how many errors
there were and whether you need to change your rate-limit and bucket size.
T hese outputs are similar to the outputs from an IPv4 command.
6Router-1#show ipv6 trafﬁc
IPv6 statistics:
Rcvd:  4903 total, 4892 local destination
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
179
0 format errors, 0 hop count exceeded
0 bad header, 0 unknown option, 0 bad source
0 unknown protocol, 0 not a router
0 fragments, 0 total reassembled
0 reassembly timeouts, 0 reassembly failures
Sent:  27330 generated, 0 forwarded
0 fragmented into 0 fragments
1 encapsulation failed, 11 no route, 0 too big
Mcast: 0 received, 0 sent
ICMP statistics:
Rcvd: 36 input, 0 checksum errors, 0 too short
0 unknown info type, 0 unknown error type
unreach: 0 routing, 0 admin, 0 neighbor, 0 address, 0 port
parameter: 0 error, 0 header, 0 option
0 hopcount expired, 0 reassembly timeout, 0 too big
15 echo request, 10 echo reply
0 group query, 0 group report, 0 group reduce
0 router solicit, 0 router advert, 0 redirects
2 neighbor solicit, 9 neighbor advert
Sent: 2561 output, 0 rate-limited
unreach: 0 routing, 0 admin, 0 neighbor, 0 address, 0 port
parameter: 0 error, 0 header, 0 option
0 hopcount expired, 0 reassembly timeout,0 too big
15 echo request, 15 echo reply
0 group query, 0 group report, 0 group reduce
0 router solicit, 2480 router advert, 0 redirects
25 neighbor solicit, 26 neighbor advert
UDP statistics:
Rcvd: 4797 input, 0 checksum errors, 0 length errors
0 no port, 0 dropped
Sent: 24701 output
www.syngress.com

180
Chapter 5 • Conﬁguring IPv6 Addressing
Summary
C onﬁguring IPv6 is not unlike conﬁguring IPv4— you still need an IP address
on your Ethernet interface in order for that interface to operate using IP, and
whether an IPv4 or IPv6 address is used does not affect the way that Ethernet
works or how the router will actually route the packet.T he major differences are
in the syntax used to enter the address. M ost of the commands that involve IPv6
speciﬁcally have ipv6 somewhere in the syntax of the command, whereas IPv4
just uses the syntax IP .
In this chapter we learned how to conﬁgure IPv6 addresses on LAN  inter-
faces.We also learned that there are three types of addresses that can be conﬁg-
ured on a LAN  address: the global, site-local and the link-local addresses.T he global
address is a well-known address that can be routed throughout the Internet.T he
site-local address is one that can be routed anywhere within the site but cannot
be routed to the Internet.T he link-local address is an address that can only be
used for the speciﬁc interface on which it is conﬁgured.
T hese three types of addresses are conﬁgured using the ipv6 address command
followed by certain parameters that distinguish the address as one of the three
types.You can assign speciﬁc IPv6 addresses to these interfaces, or you can use the
EU I-64 command to let the router use its identiﬁer to ﬁll in the last 64 bits of
the address. (T his is not recommended for the global address, but should be ﬁne
for the link-local address.) U nnumbered addresses are assigned in a manner very
similar to IPv4.
We discussed several parameters and ways to tweak them for your network.
Duplicate address detection was discussed, and we saw how to alter the number
of neighbor solicitation messages that are sent out.We saw that, contrary to typ-
ical C isco IO S protocol, entering the no command for duplicate address detection
does not disable it— rather, it resets it to its default parameters.We saw that the
process of conﬁguring DN S is almost identical to that of IPv4 as well as with
statically mapping host names to IPv6 address. O nce again, the only difference
was that ipv6 was speciﬁcally typed into the syntax to differentiate between IPv6
and IPv4 addresses.T he rate limit for IC M Pv6 is a new parameter that can be
changed— some basic functions like traceroute can have problems if this limit is not
altered, and not having traceroute at your disposal can make troubleshooting
much more difﬁcult.
We looked at conﬁguring for WAN  interfaces, focusing on the Frame-R elay
and AT M  connections. O nce again, we saw that there was not much difference
between IPv4 and IPv6 except for the syntax of the commands.A few examples
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
181
where given to show how AT M  can be mapped to certain PVC s and how
Frame-R elay can be mapped to different DLC Is.
We also looked at ways to verify that all of our conﬁgurations went through
correctly.We learned how to verify that the global command has been conﬁgured
on the router for IPv6, as well as how to identify what interfaces IPv6 has been
conﬁgured on and what the IPv6 address of each interface is.T he different IPv6
parameters were checked with various show commands.T hese commands were,
once again, similar to IPv4 except in syntax.T he output of the show commands
was also very similar to the output in IPv4. Because the outputs are similar, we
can read them faster and more efﬁciently.
O ne thing that we noticed throughout the conﬁguration and veriﬁcation
processes was that IPv6 is still growing and being tweaked in the C isco IO S.
T here are minor changes in each revision of the C isco IO S that can cause slight
differences in the way various commands will work.T his will probably be the
case for some time because IPv6 is still growing and becoming more popular as
time goes on.You should always be aware of what version of C isco IO S you are
running on your router, and be sure to check C isco C C O  to how IPv6 has been
updated with the different releases.
Solutions Fast Track
C onﬁguring IPv6 Addressing
 W hen conﬁguring your interfaces, remember that IP v6 must be
included in the syntax to distinguish between IPv4 and IPv6 addresses.
 T here are three types of addresses that can be assigned on an interface:
global, site-local and link-local.T hese different types of addresses are
deﬁned on the interface with different conﬁguration parameters.T hese
addresses must be within their respective address spaces, as deﬁned earlier
in the book.
 If you are using the E U I-64 command when entering an IPv6 address,
remember that the router uses its identiﬁer for the last 64 bits of the
IPv6 address, therefore if you want to ﬁnd out the address, you have to
go back and get the full IPv6 address.
 W ith the conﬁguration of duplicate address detection, you can specify
the number of solicitation messages sent out. If you want to disable this
www.syngress.com

182
Chapter 5 • Conﬁguring IPv6 Addressing
feature, set the number of solicitation messages to zero. Entering the no
command will restore the number of solicitation messages to the default
of one.
 T he ability to conﬁguring the rate limit for IC M Pv6 is a new feature
that was not available in IPv4.T his feature allows you to set the rate at
which error messages are sent out, as well as to conﬁgure a bucket size
for the number of error messages that can be sent.
 WAN  connections, like Frame-R elay and AT M , function the same way
with IPv6 as with IPv4.T he only differences are that you are using an
IPv6 address and that you can enter a link-local address.
 M ost of the commands that involve IPv6 have IP v6 in the actual syntax
used to conﬁgure the command on the router. If IP v6 is not speciﬁed an
IPv4 address will be assumed, and you will receive an error from your
router because it will not know how to read the address. O ne exception
is entering the DN S information; that command uses just IP in the
syntax, but will accept either an IPv6 or IPv4 address.
Verifying IPv6 Addressing
 T here is no Address R esolution Protocol with IPv6; it has been replaced
with the neighbor discovery protocol. Showing the neighbor discovery will
give the link-layer address that is associated with the IPv6 address.
 W hen using show commands to view IPv6 conﬁgurations, then ipv6 is
usually in the syntax of the command. If just IP is used, typically only
IPv4 results will be produced.
 R emember to always know what version of C isco IO S you are running,
because IPv6 is still an emerging technology and there will be changes is
almost every new revision of C isco IO S that becomes available.
www.syngress.com

Conﬁguring IPv6 Addressing • Chapter 5
183
Q: W hy is the router giving me an error when I try to conﬁgure an IPv6 link-
local address?
A: T he most likely reason is that you are entering an invalid link-local address.
R emember from previous chapters that the ﬁrst 10 bits deﬁne the type of
address.T he start of a link-local address must fall in the range of FE80 to
FEBF.
Q: C an I assign multiple addresses on my interfaces?
A: Yes, you can, as long as you have the correct version of C isco IO S. In order to
have multiple addresses with the same preﬁx length, you must have C isco
IO S version 12.2(4)T  or later; with prior versions of code you will receive an
error message. Keep in mind that you can only have multiple addresses for
global and site-local address— multiple link-local addresses are not permitted.
Q: H ow do I know what version of C isco IO S I need to run on my router?
A: You will need at least C isco IO S version 12.0(21)ST  or 12.2(2)T  to run
IPv6. I would recommend one of the latest copies that C isco has released,
because IPv6 is constantly evolving and there will be changes to IPv6 in each
revision. O f course, be sure to check C C O  for the latest caveats for each
release.
Q: C an I have an IPv6 address and an IPv4 address on the same interface?
A: IPv6 and IPv4 act independently of each other, therefore it is possible to have
both versions on one interface. H owever, there is no way to check both IPv6
and IPv4 addresses with the same command.
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

184
Chapter 5 • Conﬁguring IPv6 Addressing
Q: W hat is neighbor discovery?
A: N eighbor discovery is the equivalent of AR P in IPv4. N eighbor discovery
will resolve the M AC  address to the IPv6 address.T his process is the same as
AR P: it will hold the M AC  address in its table for a speciﬁed amount of
time, and if there is no activity from that M AC  address the table will ﬂush the
entry out.
www.syngress.com

Routing IPv6 for 
the Cisco IOS
Solutions in this chapter:
■
Explaining RIP for IPv6
■
Conﬁguring RIP for IPv6 
■
Exploring IS-IS for IPv6
■
Conﬁguring IS-IS for IPv6 
■
Describing Multiprotocol BGP Extensions
for IPv6
■
Conﬁguring BGP Extensions for IPv6
■
Other Routing Protocols and Future
Developments
Chapter 6
185
 Summary
 Solutions Fast Track
 Frequently Asked Questions

186
Chapter 6 • Routing IPv6 for the Cisco IOS
Introduction
T he routing of IPv6 trafﬁc has changed signiﬁcantly. N ew versions of routing
protocols have been developed to support dynamic routing on IPv6 networks,
because there have been only a few routing protocols built into the C isco IO S to
this point.T he R outing Information Protocol (R IP), Intermediate System-to-
Intermediate System (IS-IS), and the Border Gateway Protocol (BGP) have been
updated and built into the C isco IO S already, and new versions of O pen Shortest
Path First (O SPF) and Enhanced Interior Gateway R outing Protocol (EIGR P)
will be supported with future releases of the IO S.
R outing IPv6 remains as complex as it was with IPv4, but it has been
enhanced to support the enhanced addressing characteristics of IPv6. C onﬁguring
a network for a dynamic routing protocol has long been a task required of net-
work engineers and designers and it will remain a valued skill with IPv6.T his
chapter outlines the necessary steps to conﬁgure each supported routing protocol
and explores the details of how each protocol operates on the network.
Explaining RIP for IPv6
To discuss R IP— also referred to as R IPng (N ext Generation)— for IPv6, a brief
discussion of its predecessors, IPv4 R IP v1 and v2, will be necessary.Version 2
represents several enhancements to the original R IP standard.T he most notable
enhancement is the support for classless routing (also known as variable-length
subnet masking, or VLSM ), as well as authentication for R IP routing updates.
Although two different versions exist, they are essentially the same protocol and
share the same common characteristics, advantages, and ﬂaws.
T he R outing Information Protocol is one of the oldest and most stable
dynamic routing protocols in use today. R IP’s ancestry dates back as far as 1969
with its involvement in the original DAR PAN et project. R IP is a true open-
standard, distance-vector protocol. Distance-vector protocols represent the ﬁrst
generation of dynamic-routing protocols.
Distance-vector protocols are based primarily on the Bellman-Ford algo-
rithm, outlining many of the primary functions of such protocols.T he Bellman-
Ford algorithm gets its name from the individuals who developed the concept of
distance-vector route calculation.T his algorithm bases its metric calculation on a
single-path tree concept, using the parameter of weight, and using a relaxation
technique progressively throughout a path.T his technique enables the protocol to
select from several paths to a destination network, using a Boolean expression to
www.syngress.com

www.syngress.com
determine the weight of a particular path and to select the path with the best
metric.T his is a very brief discussion of this process; a detailed discussion of the
Bellman-Ford algorithm is outside the scope of this chapter.T he term distance
vector comes from the function of the protocols. Protocols use a vector, or list, of
distances or hop counts to determine the optimal routes to a given destination
network.All distance-vector routing protocols share several key elements, which
we’ll discuss in the following sections: periodic updates, routing loops, triggered
updates, split horizon, counting to inﬁnity, poison reverse, hold-down timers, and
R IP timers.
Periodic Updates
R outers use routing updates to propagate topological and reachablity information
throughout the network. R IP networks rely heavily on such updates to ensure
full connectivity to the network around them as well as to ensure that neigh-
boring routers are still online and functioning properly.All this is done to obtain
a network state known as convergence, which is when all the routers within a
network agree on the network topology.
R IP represents the ﬁrst standardized routing protocols developed, and, due to
this and to its ease of conﬁguration, it still represents a very large portion of the
installed base of routing protocols today.T he manner in which distance-vector
protocols transmit their routing updates is one of the reasons that link-state
routing protocols, such as O SPF, are now considered a better alternative than dis-
tance-vector routing protocols.
Distance-vector protocols transmit their entire routing table to all directly
connected neighbors at predeﬁned intervals.T he update timer within distance-
vector protocols governs the timing and sequence of these updates.T he default
value for this timing is 30 seconds for R IP.T his means that, by default, every
router in the network will push an entire routing table to every directly con-
nected neighbor every 30 seconds regardless of any changes in the network. In
other words, in a stable environment, every neighbor of a given router will
receive that router’s entire routing table every 30 seconds to tell it things about
the network that it most likely already knew. Seems like a lot of overhead, doesn’t
it? T his has been one of the major reasons that distance-vector protocols have lost
much of their popularity to the more advanced link-state protocols.
R outers take a very localized view of the things surrounding them, both in
calculating path cost to networks from their perspective as well as in broadcasting
and advertising network reachability with regard to what is immediately adjacent
Routing IPv6 for the Cisco IOS • Chapter 6
187

188
Chapter 6 • Routing IPv6 for the Cisco IOS
to them. In other words, all the routers know about the network only from their
own perspective. N o single router can know about the entire network topology
ﬁrsthand; instead, every router must rely on third-party information provided by
its neighbors just as its neighbors must rely on information that they received
from their neighbors.T his leads to a problem that almost every distance-vector
routing protocol faces: routing by rumor.
R outing by rumor is a serious problem for distance-vector protocols. Because
of the manner in which distance-vector protocols view the network, from a
localized perspective, it is not possible for every router to have ﬁrst-hand infor-
mation for the entire network. Instead, each router must rely on the periodic
updates transmitted to it from its directly connected neighbors. So, if incorrect
routing information is transmitted at any point, that information will propagate
throughout the network unchecked, because every router trusts its neighbor
routers to provide correct information. M any compare this process to a child-
hood game called “telephone,” in which children sit in a circle and the ﬁrst child
is given a sentence to whisper to the next child , who then whispers that same
sentence to the next child , and so on until it gets all the way around the circle.
T he funny part being that the message that started at the beginning rarely is the
message received at the other end of the circle.T his is, unfortunately, a very good
comparison.T he nature of distance-vector protocols is to pass along “facts” about
the network, of which they have no direct knowledge.T his process causes a high
margin of error within distance-vector routing protocols.As the size and diam-
eter of a distance-vector–routed network increases, the probability and severity of
this type of problem also increases.
Like all other distance-vector protocols, R IP sends its entire routing update to
all directly connected neighbors through the use of periodic updates, every 30 sec-
onds in this case, using U DP port 520 for this broadcast.T his update comes
regardless of network change and or link failure.A maximum of 25 networks can
be contained within a single R IP packet.T he protocol uses the update not only to
communicate routing update changes, but also to verify neighbor connectivity and
activity.All of these factors make R IP a good solution for small– to mid-sized net-
works only. Figure 6.1 shows examples of the R IP version 1 and version 2
packets. N otice that the size and number/ size of ﬁelds do not change between the
two protocols; however, R IP v2 packet has added the R oute Tag, subnet mask, and
next hop ﬁeld.T hese additional ﬁelds enable R IP v2 to support variable-length
subnet masking (VLSM ) as well as authentication when making routing updates.
Also included is an example of the IPv4 header.A single R IP routing entry can
contain as many as 25 networks, making the size of a single R IP packet as large as
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
189
512 bytes.Add that to the corresponding 20 to 24 bytes of the IPv4 header
attached and you have a large amount of trafﬁc traversing your network!
Routing Loops
From our discussion in the previous section, you know that distance-vector pro-
tocols take a very localized view of the network, considering only how an indi-
vidual router will reach a given destination network and the metrics for reaching
www.syngress.com
Figure 6.1 RIP v1, RIP v2 Packets and IPv4 Header
Type of
Service
Header
Length
Version
Fragmented Offset
Total Length
Identifier
Protocol
Time To Live
Header Checksum
Source Address
Destination Address
Padding
Options
Flags
Version
Command
Unused (set to all zeros)
IPv4 Header
RIP v1 Header
Address Family Identifier
Unused (set to all zeros)
IP address
Unused (set to all zeros)
Unused (set to all zeros)
Metric
Version
Command
Unused (set to all zeros)
RIP v2 Header
Address Family Identifier
Route Tag
IP address
Subnet Mask
Next Hop
Metric
32 Bits
32 Bits
32 Bits
Route
Entry
Route
Entry

190
Chapter 6 • Routing IPv6 for the Cisco IOS
that network.W hen transmitting its routing table to directly connected neigh-
bors, this is also the information that it will send out; that is, how it will get to a
destination network. Due to these factors, as well as the periodic updates used to
transmit network and topology changes in a distance-vector routing environ-
ment, routing loops can be a real threat to a distance-vector network.
R outing loops are a state in which, due to incorrect information being prop-
agated through a network, packets will continually encircle a network unable to
reach the given destination network. R outing loops pose a great danger and are
more common in distance-vector routing networks because of the delay in the
propagation of network information as well as the problem of “routing by
rumor” discussed in the previous section.
In a routing loop, a network has become unreachable due to a link failure or
some other unforeseen circumstance.T he directly affected router will transmit
this change to its directly connected neighbors, informing them of the inability
to reach this network; however, this update may not make it to every router
within the network, and another router may transmit its ability to reach the net-
work in the meantime, using the link through the ﬁrst router that saw the link
was down. So now all the routers, including the one that was ﬁrst affected by the
link failure, will update their routing tables to use the new router and route
packets to this router, which in turn will forward them back to the original
router, which will forward them to the transmitting router, so it can reach the
network.A loop has now occurred.
R outing loops can be detrimental to the speed and performance of a produc-
tion network.As more packets are sent to the inaccessible network, more and more
packets will continue to encircle the network, screeching network trafﬁc to a stand-
still. Fortunately, the designers of R IP foresaw this problem early on and built sev-
eral countermeasures into this distance-vector routing protocol, such as triggered
updates, split horizon, counting to inﬁnity, poison reverse, and hold downs.
Triggered Updates
As you already know, distance-vector protocols use periodic updates to propagate
network information to neighboring routers and to ensure connectivity. But, in
many instances this is not enough to ensure connectivity. In such cases, triggered
updates serve as a critical element to ensure that connectivity is maintained at all
times and that link changes are transmitted on a real-time basis.
Triggered updates are a mechanism used by routing protocols to deal with
sudden network changes such as link failure. U pon detection of a network
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
191
change, the affected router(s) will send updates informing its neighbors of the
new conditions; the neighbors will in turn forward this information to their
neighbors, thus helping to prevent conditions such as routing loops and
decreasing convergence time.Triggered updates augment periodic updates to
ensure that routers would not have to wait until the next periodic update to
know about a network change.
W hen sending a periodic update, routers transmit their entire routing table,
regardless of change.Triggered updates, on the other hand, send only information
regarding the change in the link or network status that has occurred.T his fact
alone makes triggered updates much more efﬁcient than periodic updates.T his
also helps distance-vector protocols to converge at a much faster rate, allowing for
data transfer to resume much faster.
Split Horizon
Loops in a production environment can be a major service-affecting, if not ser-
vice-halting, problem. Split horizon is a mechanism employed by distance-vector
routing protocols used to help limit routing loops.T his is done by a very simple
rule stating that a network will not be advertised out of the same interface
through which it was learned. R outers will omit these routes from their routing
tables when sending their routing tables back out of the interface through which
the route was learned. In the examples of sample networks we have discussed
thus far, split horizon could effectively stop routing loops from occurring.
H owever, split horizon cannot prevent routing loops in every situation.
M any people dealing with split horizon encounter a problem with non-
broadcast multi-access mediums such as frame-relay or AT M . M any implementa-
tions of N BM A functionality work in a basic hub and spoke topology, a central
router, or hub router, with several spoke routers hanging off it.T he problem
arises when all of these spoke routers terminate into one single interface on the
hub router (a multi-point Frame R elay interface, for example).According to the
rules of split horizon, an interface cannot advertise a network out of the same
interface through which the network was learned and, unfortunately, the hub
router cannot, therefore, send the update to the other routers also attached to that
interface.
T his has been recognized as a problem by C isco and split horizon is disabled
by default on all Frame R elay physical interfaces. H owever, split horizon is
enabled on all point-to-point sub-interfaces and all point-to-multipoint sub-
interfaces.W hen using point-to-point sub-interfaces, each link is treated like a
www.syngress.com

192
Chapter 6 • Routing IPv6 for the Cisco IOS
separate point-to-point link (so there is no conﬂict with the rule of split
horizon); whereas, with point-to-multipoint sub-interfaces, all sub-interfaces are
treated as a shared medium and must be in the same subnet to communicate.
O bviously, this creates a problem with the rule of split horizon. Disabling split
horizon leaves the possibility of routing loops, so you must be very careful in this
type of environment. Figure 6.2 demonstrates split horizon operation.
Counting to Inﬁnity
As we discussed earlier, some distance-vector protocols calculate their routing
metric based on the number of hops or routers that must be traversed to reach a
given destination network.W ithin these routing protocols the maximum number of
hops, or inﬁnity, is a number set specifying the maximum distance or diameter of a
network that a packet can cross to reach a given destination network before it is
considered to be unreachable. R IP, our prime example of a hop–count-based, dis-
tance-vector routing protocol, has an inﬁnity number set at 16 hops. If a destination
network is 16 or more hops away, it will be considered unreachable and will not be
considered for packet forwarding by the router.T he concept of counting to inﬁnity
is part of R FC  1058, the R FC  that speciﬁes the operation of R IP v1.
C ounting to inﬁnity is incorporated into distance-vector routing protocols as
a means of eliminating the possibility of packets traversing the network aimlessly
for an eternity due to a downed link and the routing loop that could ensue
thereafter. In such a situation, the packet would be permitted to traverse the net-
work for a maximum of 16 hops before it would be removed from the network.
As the packet bounces from router to router in a situation such as this, the T ime
To Live (T T L) ﬁeld is incremented by one.W hen the counter reaches 16, the
packet is removed from the network by the next router it encounters.
M any feel that the hop count limitation placed on R IP of 16 is too small for
many of today’s networks and organizations, but when you consider 16 hops of
aimlessly circling a network, 16 becomes a very large number. Imagine the lost
trafﬁc and delay associated with a packet that is counting to inﬁnity and think of
what even double that amount, 32, could cause.
www.syngress.com
Figure 6.2 Split Horizon
Router A
Router B
Router C
Network B
Network A
Network  A
Network  A
Network  B
Network  B

Routing IPv6 for the Cisco IOS • Chapter 6
193
C ounting to inﬁnity is not by itself a loop-prevention mechanism; rather, it
should be considered a last line of defense for dealing with routing loops.T he
concept of inﬁnity, however, is incorporated into a loop-prevention mechanism
known as poison reverse.
Poison Reverse
In the previous section, we introduced the concept of counting to inﬁnity, or the
maximum number of hops that a packet can traverse before the network is con-
sidered unreachable. Poison reverse works with this concept as well as with split
horizon to help prevent loops. R FC  1058 outlines poison reverse (this is the
same R FC  that discusse the operation of R IP v1). It is used as a solution to the
problem of counting to inﬁnity, or packets circling the network until they have
reached the maximum number of hops— 16, in the case of R IP.
In a standard application of split horizon, a rule states that a network cannot
be advertised out of the interface through which the network was learned. U sing
this as a basis, poison reverse takes this a step further.W hen using poison reverse
and split horizon in concert, networks learned via a certain interface are adver-
tised back out the same interface, with one major difference: the route is given a
metric of unreachable, or inﬁnity, so that the receiving router will not consider,
under any circumstances, the use of that route (because it will be seen as
unreachable). In this case, the route is said to have been poisoned. R outers that
receive this route will not consider it as an alternative path and will not add it to
their routing tables, thus preventing a routing loop in this situation.
Poison reverse is sometimes considered a disadvantage because it increases the
size of routing updates. In simple split horizon operation, routes learned via an
interface would not be transmitted out that interface, thus reducing the size of
the routing update. H owever, when using poison reverse, the routes are included,
but with the inﬁnity metric.T his causes larger updates and an increase in band-
width utilization. H owever, this is generally seen as an acceptable tradeoff for the
increased protection against routing loops.
Hold-Down Timers
As we have discussed through several of the preceding sections, link failure can
cause several problems throughout a production network.We have also discussed
several of the different mechanisms, such as triggered updates and split horizon,
that help to deal with the effects of link failure, especially loop avoidance. N ow
we will turn our attention to the ﬁnal of these safety mechanisms, hold downs.
www.syngress.com

194
Chapter 6 • Routing IPv6 for the Cisco IOS
H old downs are safety mechanisms that prevent regular routing update mes-
sages from re-instating a route that is down due to link failure or other unfore-
seen circumstances. In normal routing operation, when a router goes down or a
link to a network fails, the neighboring routers re-calculate their routing metrics
and ﬁnd or choose a new path to reach the down network. H owever, during this
time, a non-directly connected router could possibly re-transmit a routing update
specifying that the link is up, before triggered updates can reach it to inform it
that the route is in fact down.T his router could potentially update all the devices
that had just been notiﬁed that the link was down, and cause them to re-instate
the route.
H old downs speciﬁcally address this issue, by specifying an amount of time, in
seconds, that the router should wait before accepting any changes to the status of
the route.T his helps to prevent the scenario discussed in the previous paragraph.
H old downs are generally calculated to be greater than the period needed to
update every router in the network of the failed link.
Distance-vector routing protocols use hold-down timers, which are mechanisms
that specify the amount of time, in seconds, that the router will suppress better
path information for a route for which the router has received information that
the path is down. During this time, the route will be marked as inaccessible and is
advertised as unreachable; however, it will still be used to forward trafﬁc.T he
default hold-down timer is 180 seconds for R IP.W hen the hold timer expires,
routes advertised by other sources will be accepted for the given network.
RIP Timers
A set of three timers is incorporated into R IP; they govern the update interval, the
hold-down interval, and the ﬂush timer.T he update interval is the amount of time
that a router will wait before sending its entire routing table to all its neighbors.
T he default value for this is 30 seconds. M any believe that this is too often, so it is
a conﬁgurable parameter. Keep in mind, though, that the update interval should be
uniform across your R IP network to avoid your routers being out of sync.
T he next value is the hold-down timer. If you recall from our earlier discus-
sion, when a route is placed in the hold-down state, no routing updates are
received for that route, and that route will not be advertised.T he hold-down
timer is the amount of time that the router will wait without receiving updates
before putting a route into hold-down state.T he default value for this is 180 sec-
onds; this value is also conﬁgurable.
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
195
T he ﬁnal timer is the ﬂush timer.T his timer speciﬁes the amount of time in
seconds that the router will wait before completely removing a route from its
routing table, after which a new route to the destination network is sought.T he
default value for this is six times the update interval, or 240 seconds.T his value is
also conﬁgurable.
Administrative Distance
C isco routers incorporate the concept of administrative distance when making
routing decisions.Administrative distance is a scale from 0 to 255 that speciﬁes
the reliability of a given route. 0 is the most reliable and 255 is the least reliable—
actually it is considered unreachable. Each of the routing protocols that C isco
routers support is given a speciﬁed default administrative distance; however, these
values can be manipulated when necessary. R IP in all its forms, IPv4 v1and v2 as
well as IPv6, are assigned the default value of 120.You can change this value for
R IP in R IP conﬁguration mode by use of the distance command.Table 6.1 pro-
vides the administrative distances of routing protocols on C isco routers.
Table 6.1 Administrative Distances
Routing Protocol
Administrative Distance
Connected Interface
0
Static Route
1
EIGRP Summary Route
5
External BGP
20
Internal EIGRP
90
IGRP
100
OSPF
110
IS-IS
115
RIP v1, v2, IPv6 RIP
120
EGP
140
External EIGRP
170
Internal BGP
200
Unknown (Unreachable)
255
www.syngress.com

196
Chapter 6 • Routing IPv6 for the Cisco IOS
Conﬁguring RIP for IPv6
T he R IP standard for IPv6, or R IPng, is built upon the original R IP standard,
which is why it is important to have a thorough understanding of the original
protocol. H owever, R IPng does offer a few enhancements to the original R IP
standard; these include, of course, full support for the IPv6 standard and preﬁxes
as well as support for an all-routers R IP multicast address group for routing
update messages to all R IPng routers.T his offers an alternative to the broadcast
messaging solution used by the previous implementations of R IP.
Basic IPv6 RIP Conﬁguration
Although IPv6 R IP is very similar to its predecessor R IP, some striking differ-
ences exist between the two protocols when it comes down to their actual con-
ﬁguration.T he ﬁrst of these differences is apparent when enabling the R IP
routing process. In the previous release, you started the R IP process by giving the
command R outer rip in global conﬁguration mode followed by specifying the
networks that would be included in the R IP routing domain by typing the net-
work command.T he conﬁguration for IPv6 R IP is similar, but not identical.To
enable the R IP routing process for IPv6, the ipv6 router rip <word> command is
used.T he word command is actually a process identiﬁer that is a user-deﬁned
series of numbers or letters that identify the speciﬁc R IP process.T his enables the
router to run multiple segregated R IP processes on the same router.To add spe-
ciﬁc networks to the R IPng routing domain, the ipv6 rip <word> enable com-
mand is used.T his command places that speciﬁc IPv6 enabled interface into the
speciﬁed IPv6 R IP routing domain.T he following listing shows an example of
this process on the router:
6Router-1>enable
Password: 
6Router-1#conﬁg terminal
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 router rip cisco
6Router-1(conﬁg-rtr)#exit
6Router-1(conﬁg)#interface ethernet 0
6Router-1(conﬁg-if)#ipv6 rip cisco enable
6Router-1(conﬁg-if)#exit
6Router-1(conﬁg)#interface serial 0
6Router-1(conﬁg-if)#ipv6 rip cisco enable
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
197
6Router-1(conﬁg-if)#exit
6Router-1(conﬁg)#
In the preceding example, we entered global conﬁguration mode by issuing
the conﬁg terminal command and enabled the Ipv6 R IP routing process by using
the ipv6 router rip cisco command.We then included both the Ethernet 0 and
Serial 0 interfaces into the Ipv6 R IP routing process by issuing the ipv6 rip cisco
enable command on each interface in interface conﬁguration mode.
Figure 6.3 shows an example of a simple IPv6 R IP network.
In the example shown in Figure 6.3, we have created a R IP routing domain
with three separate subnets, 2000:1:1::/ 64, which is the network that runs between
the two router’s serial links, and we have two networks off of the Ethernet 0
routers of each of the routers 2000:1:2::/ 64 and 2000:1:3::/ 64 respectively. By
issuing show ipv6 protocol, we can see all the IPv6 routing protocols currently run-
ning on the router. In the following listing, we see that we have both connected
networks, static routes, and of course R IP running on our 6R outer-1 router:
6Router-1#show ipv6 protocol
IPv6 Routing Protocol is "connected"
IPv6 Routing Protocol is "static"
IPv6 Routing Protocol is "rip cisco"
Interfaces:
Serial0
Ethernet0
Redistribution:
Redistributing protocol rip cisco
By issuing the show ipv6 route command, you can see the routes derived for
IPv6.At the top of the following code example, you can see that IPv6 can cur-
rently support seven types of routes (C onnected, Local, Static, R IP, BGP, IS-IS
levels one and two, as well as interarea IS-IS— we will cover IS-IS later in this
www.syngress.com
Figure 6.3 Simple IPv6 RIP Network
6Router-1
6Router-2
Serial 0
2000:1:1::1
Serial 0
2000:1:1::2
Ethernet 0
2000:1:3::1
Ethernet 0
2000:1:2::1

198
Chapter 6 • Routing IPv6 for the Cisco IOS
chapter). R outes derived from a R IP routing process are denoted with an R .T he
following example shows that 6R outer-1 has derived one route from the R IP
routing process, a connection to 2000:1:3:: / 64, which, of course, is the network
off the Ethernet 0 interface on 6R outer-2.We also see the interface that R IP
uses to get to that network, in this case the Serial 0 interface of 6R outer-1.
6Router-1#show ipv6 route
IPv6 Routing Table - 7 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea
Timers: Uptime/Expires
L   2000:1:1::1/128 [0/0]
via ::, Serial0, 1d05h/never
C   2000:1:1::/64 [0/0]
via ::, Serial0, 1d05h/never
L   2000:1:2::1/128 [0/0]
via ::, Ethernet0, 1d05h/never
C   2000:1:2::/64 [0/0]
via ::, Ethernet0, 1d05h/never
R   2000:1:3::/64 [120/2]
via FE80::2E0:B0FF:FE55:B035, Serial0, 00:00:13/00:02:46
L   FE80::/10 [0/0]
via ::, Null0, 1d05h/never
L   FF00::/8 [0/0]
via ::, Null0, 1d05h/never
6Router-1#     
Default Routes in IPv6 RIP
A default route is, essentially, a route that a router and/ or routing protocol uses to
forward packets for which it does not have the actual destination network address
in its routing tables. Default routes have been used widely by almost all IPv4
routing protocols. IPv6 R IP also supports the utilization and conﬁguration of
default routes.
U nlike with IPv4 R IP, however, where you conﬁgured default routes at the
global level, you conﬁgure IPv6 R IP for default routes on an interface level by
using the default-information command.T his command tells the router to inject a
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
199
::/ 0 route into the R IP routing domain as a default route (or, as it is also known,
a gateway of last resort). Follow the default-information command by one of two
parameters: originate or only settings.
T he originate setting tells the router to inject this ::/ 0 route into the R IP
routing domain and to advertise this route along with all the other routes in its
R IP routing advertisements.T he only parameter instructs the router running IPv6
R IP to advertise only this default route, and to suppress advertisement of any
other routes.
T he following listing show an example of default route conﬁguration in an
IPv6 R IP routing process.We have conﬁgured the serial 0 interface of our
6router-1 router to originate a default route and to advertise it to the rest of the
IPv6 R IP routing domain.
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#interface serial0
6Router-1(conﬁg-if)#ipv6 rip cisco default-information ?
only       Advertise only the default route
originate  Originate the default route
6Router-1(conﬁg-if)#ipv6 rip cisco default-information originate
6Router-1(conﬁg-if)#exit
In the preceding example, we entered interface conﬁguration mode and
entered the ipv6 rip cisco default-information originate command, thus telling the
router to use the network attached to the serial 0 interface as the default route.
If you look at the routing table of the neighboring 6router-2, you will see
that 6router-1 is indeed injecting that default route into your R IP routing
domain. If you examine the preceding routing table, you will see an additional
R IP entry for the ::/ 0 network via serial 0. N ote that entries for R IP routes have
an “R ” next to them.T his is your default route:
6Router-2#show ipv6 route
IPv6 Routing Table - 8 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea
Timers: Uptime/Expires
L   2000:1:1::2/128 [0/0]
via ::, Serial0, 5d14h/never
www.syngress.com

200
Chapter 6 • Routing IPv6 for the Cisco IOS
C   2000:1:1::/64 [0/0]
via ::, Serial0, 5d14h/never
R   2000:1:2::/64 [120/2]
via FE80::2E0:B0FF:FE5A:D998, Serial0, 00:00:09/00:02:50
L   2000:1:3::1/128 [0/0]
via ::, Ethernet0, 5d14h/never
C   2000:1:3::/64 [0/0]
via ::, Ethernet0, 5d14h/never
L   FE80::/10 [0/0]
via ::, Null0, 5d14h/never
L   FF00::/8 [0/0]
via ::, Null0, 5d14h/never
R   ::/0 [120/2]
via FE80::2E0:B0FF:FE5A:D998, Serial0, 00:00:09/00:02:50
6Router-2#exit
IPv6 RIP Route Redistribution
R oute redistribution is a very useful mechanism. R edistribution enables routes
created and calculated by another routing process to be injected into your routing
domain, in this instance, our IPv6 R IP routing domain. R edistribution, as a prac-
tice, offers several beneﬁts, such as enabling full connectivity throughout your net-
work without having to run one standard protocol throughout.T his enables
administrators to leverage the best that each of the different types of routing pro-
tocols has to offer for individual parts of the overall network. N etwork administra-
tors commonly incorporate redistribution between their core and edge networks.
Administrators will often select one routing protocol, such as O SPF, to act as a
network backbone protocol, and utilize a less resource-intensive protocol, such as
R IP to run at the network edge, thus enabling the network to segment core trafﬁc
from edge trafﬁc, while enabling full connectivity throughout the network.
R oute redistribution for IPv6 R IP operates on these principles as well; how-
ever, the scope of redistribution is limited to other IPv6 protocols.T his list cur-
rently includes IS-IS and BGP. R IP also has the capability to redistribute other
R IP routing processes as well as static and connected routes.
You perform the IPv6 R IP route redistribution at the R IP conﬁguration
level with the redistribute command. Follow this command with the particular
protocol that you wish to redistribute. Each one of these protocols has speciﬁc
conﬁguration steps that will follow. Start with static and connected routes.T hese
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
201
routes, aside from another R IP process, are the easiest to conﬁgure for redistribu-
tion. U pon selecting one of these two choices, you can complete conﬁguration
by simply pressing Enter; however, you can perform further conﬁguration by
using the metric and route-map parameters.T he metric command speciﬁes a metric
that IPv6 R IP assigns to use when calculating the best path to take to reach a
given network. R emember that R IP uses hop-count as its primary metric; when
distributing protocols into R IP, it will automatically assign a value of 1 for redis-
tributed routes. If this is not preferable, the metric command can change this to
the desired metric.You can use the route-map command, followed by the name of
a route map to use, to incorporate policy-based routing for this route. P olicy-based
routing is a mechanism that enables routers to make routing and forwarding deci-
sions based on numerous factors such as the type of trafﬁc and the interface that
the packet arrived on. It enables administrators to have granular control over
trafﬁc decisions in their network.T he following listing is an example of static
route redistribution in our R IP network.We will redistribute static routes into
the R IP routing domain and assign a metric value of 4 to the redistributed static
routes:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 router rip cisco
6Router-1(conﬁg-rtr)#redistribute ?
bgp        Border Gateway Protocol (BGP)
connected  Connected Routes
isis       ISO IS-IS
rip        IPv6 Routing Information Protocol (RIPv6)
static     Static Routes
6Router-1(conﬁg-rtr)#redistribute static ?
metric     Metric for redistributed routes
route-map  Route map reference
<cr>
6Router-1(conﬁg-rtr)#redistribute static metric 4
6Router-1(conﬁg-rtr)#exit
6Router-1(conﬁg)#
You can verify redistribution conﬁguration by looking at your IPv6 routing
protocols by issuing the show ipv6 protocols command.T he redistribution portion
www.syngress.com

202
Chapter 6 • Routing IPv6 for the Cisco IOS
of the following command output shows that this router is redistributing static
routes with a metric of 4. By specifying a metric of 4, you are telling the router
that the network is 4 hops away. R emember, the maximum number of hops is
15, with 16 being unreachable.W hen manually assigning metrics to routes,
remember to assign the appropriate metric for a given network. N ot doing so
can lead to sub-optimal routing performance.
6Router-1#show ipv6 protocols
IPv6 Routing Protocol is "connected"
IPv6 Routing Protocol is "static"
IPv6 Routing Protocol is "rip cisco"
Interfaces:
Serial0
Ethernet0
Redistribution:
Redistributing protocol static with metric 4
6Router-1#
R edistribution of another R IP routing process is very similar to the redistri-
bution of static or connected routes.To accomplish this, use the redistribute rip
<word> command.T he <word> parameter speciﬁes the R IP routing process that
you wish to redistribute.You can also incorporate the optional commands of
metric and route map into this redistribution. O ne important note to make, how-
ever, is that when redistributing R IP into R IP, the metrics will be retained, and
you need to manipulate the metric settings only if you do not want to use the
standard R IP routing metrics for redistributed routes.T he following listing shows
an example of R IP into R IP route redistribution.We are conﬁguring the C isco
R IP process to redistribute the C isco2 R IP process:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 router rip cisco
6Router-1(conﬁg-rtr)#redistribute ?
bgp        Border Gateway Protocol (BGP)
connected  Connected Routes
isis       ISO IS-IS
rip        IPv6 Routing Information Protocol (RIPv6)
static     Static Routes
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
203
6Router-1(conﬁg-rtr)#redistribute rip ?
WORD  User selected string identifying this process
6Router-1(conﬁg-rtr)#redistribute rip cisco2
6Router-1(conﬁg-rtr)# exit
You can verify this redistribution by using the show ipv6 protocols command
again:
6Router-1#show ipv6 protocols
IPv6 Routing Protocol is "connected"
IPv6 Routing Protocol is "static"
IPv6 Routing Protocol is "rip cisco"
Interfaces:
Serial0
Ethernet0
Redistribution:
Redistributing protocol static with metric 4
Redistributing protocol rip cisco2
R edistribution of BGP routes is carried out in much the same way as redis-
tribution of other R IP processes.T he primary difference is that BGP uses an
autonomous system number to specify the routing process in question.W hen
specifying redistribution for BGP within a R IP routing domain, this autonomous
system number must be given.As with the previous discussions about static and
R IP routes, you can also utilize the metric and route-map commands to manipulate
the redistributed BGP routes.T he following listing shows an example of BGP
redistribution.We have redistributed the BGP AS 2 and have assigned a metric
value of 4 for the redistributed BGP routes:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 router rip cisco
6Router-1(conﬁg-rtr)#redistribute ?
bgp        Border Gateway Protocol (BGP)
connected  Connected Routes
isis       ISO IS-IS
rip        IPv6 Routing Information Protocol (RIPv6)
static     Static Routes
www.syngress.com

204
Chapter 6 • Routing IPv6 for the Cisco IOS
6Router-1(conﬁg-rtr)#redistribute bgp ?
<1-65535>  Autonomous system number
6Router-1(conﬁg-rtr)#redistribute bgp 2 ?
metric     Metric for redistributed routes
route-map  Route map reference
<cr>
6Router-1(conﬁg-rtr)#redistribute bgp 2 metric 4
6Router-1(conﬁg-rtr)#
R edistribution of IS-IS routes is slightly more involved than it is for the pre-
vious routing protocols. (We discuss the details of IS-IS in the next section.) IS-
IS operates slightly differently than other routing protocols do in that it speciﬁes
two types of routes, level 1 and level 2. Level 1 areas are areas that do not act as a
backbone area for the network and level 2 areas are backbone areas. R IP has the
capability to redistribute IS-IS routes by their level. R IP can redistribute either
just level 1 routes, level 2 routes, or both level 1 and level 2 routes.
You perform redistribution for IS-IS in much the same way you conﬁgure
the redistribution for the other routing protocols. First, you use the redistribute isis
command to tell the R IP routing process to redistribute IS-IS.After entering this
command, you have the capability to specify the route tag, or identiﬁer, that IS-IS
is using to identify the routing process.You can then specify if you want to redis-
tribute level 1, level 2, or both level 1 and level 2 routes into the R IP routing
process.You can then specify a route-map to use or manipulate the metrics.T he
following listing shows an example of IS-IS redistribution into IPv6 R IP.We are
redistributing an IS-IS process called C isco.We will redistribute both level 1 and
level 2 routes as well as assign the redistributed routes a metric of 4:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 router rip cisco
6Router-1(conﬁg-rtr)#redistribute ?
bgp        Border Gateway Protocol (BGP)
connected  Connected Routes
isis       ISO IS-IS
rip        IPv6 Routing Information Protocol (RIPv6)
static     Static Routes
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
205
6Router-1(conﬁg-rtr)#redistribute isis ?
WORD       IPv6 process name
level-1    IS-IS level-1 routes only
level-1-2  IS-IS level-1 and level-2 routes
level-2    IS-IS level-2 routes only
metric     Metric for redistributed routes
route-map  Route map reference
<cr>
6Router-1(conﬁg-rtr)#redistribute isis cisco ?
level-1    IS-IS level-1 routes only
level-1-2  IS-IS level-1 and level-2 routes
level-2    IS-IS level-2 routes only
metric     Metric for redistributed routes
route-map  Route map reference
<cr>
6Router-1(conﬁg-rtr)#redistribute isis cisco level-1-2 ?
metric     Metric for redistributed routes
route-map  Route map reference
<cr>
6Router-1(conﬁg-rtr)#redistribute isis cisco level-1-2 metric 4
Filtering IPv6 RIP Routing
N umerous instances exist in which you do not want all your routing table infor-
mation to be transmitted from one router to all its neighbors. C onversely, there
are also occasions when you do not wish a router to receive and update its
routing table entries with all the information received from its neighbors.To
address this concern, IPv6 R IP has the capability to utilize distribute-lists along
with preﬁx-lists to ﬁlter incoming and outgoing routing table entries.T his is a
two-step process.T he ﬁrst step in this process is the creation of the preﬁx list.You
perform this conﬁguration at the global conﬁguration level by using the ipv6
preﬁx-list command.T he preﬁx-list is very similar to an access list in that both use
a permit/ deny system to allow or disallow trafﬁc. C onﬁguration of the IPv6
www.syngress.com

206
Chapter 6 • Routing IPv6 for the Cisco IOS
preﬁx list follows with specifying a name for the preﬁx-list as well as specifying
the permit and/ or deny statement(s). R emember that, as with standard access-
lists, an implicit deny-all is at the end of every preﬁx list.T he following listing
shows an example of a preﬁx-list:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 preﬁx-list?
preﬁx-list  
6Router-1(conﬁg)#ipv6 preﬁx-list ?
WORD             Name of a preﬁx list
sequence-number  Include/exclude sequence numbers in NVGEN
6Router-1(conﬁg)#ipv6 preﬁx-list cisco ?
deny         Specify packets to reject
description  Preﬁx-list speciﬁc description
permit       Specify packets to forward
seq          sequence number of an entry
6Router-1(conﬁg)#ipv6 preﬁx-list cisco permit ?
X:X:X:X::X/<0-128>  IPv6 preﬁx <network>/<length>
6Router-1(conﬁg)#ipv6 preﬁx-list cisco permit 2000:1:1::/64 ?
ge  Minimum preﬁx length to be matched
le  Maximum preﬁx length to be matched
<cr>
6Router-1(conﬁg)#ipv6 preﬁx-list cisco permit 2000:1:1::/64 
6Router-1(conﬁg)#
In the preceding example, we created a preﬁx-list to enable 2000:1:1::/ 64.We
also had some other conﬁguration options as well.T he ge option enables you to
specify a minimum length that an address must match to qualify for the preﬁx-list
and the le option enables you to set a maximum length of matching.T hese two
options are useful if you want a single entry to be used to represent more than
one address.As it stands now, we are specifying that an exact match is necessary
to qualify for the preﬁx list.
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
207
You conﬁgure the second part of distribute-lists at the R IP conﬁguration
level by using the distribute-list preﬁx-list command. Follow this with the name of
the list and specify whether this will be an in-bound or out-bound distribution
list.T he ﬁnal part of the conﬁguration is specifying an interface on which to
apply the distribute-list.Although this is an optional step, if it is not performed,
the distribute-list will be applied to all IPv6 interfaces on the router.T he fol-
lowing listing shows a conﬁguration example of this. In this example, we have
conﬁgured the router to apply the C isco preﬁx list as an outbound distribute list
on the Ethernet 0 interface:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#ipv6 router rip cisco
6Router-1(conﬁg-rtr)#distribute-list ?
preﬁx-list  Filter connections based on an IPv6 preﬁx-list
6Router-1(conﬁg-rtr)#distribute-list preﬁx-list ?
WORD  Preﬁx-list name
6Router-1(conﬁg-rtr)#distribute-list preﬁx-list cisco ?
in
out
6Router-1(conﬁg-rtr)#distribute-list preﬁx-list cisco out ?
Async              Async interface
BVI                Bridge-Group Virtual Interface
CTunnel            CTunnel interface
Dialer             Dialer interface
Ethernet           IEEE 802.3
Lex                Lex interface
Loopback           Loopback interface
MFR                Multilink Frame Relay bundle interface
Multilink          Multilink-group interface
Null               Null interface
Serial             Serial
Tunnel             Tunnel interface
Vif                PGM Multicast Host interface
www.syngress.com

208
Chapter 6 • Routing IPv6 for the Cisco IOS
Virtual-Template   Virtual Template interface
Virtual-TokenRing  Virtual TokenRing
<cr>
6Router-1(conﬁg-rtr)#distribute-list preﬁx-list cisco out Ethernet 0
6Router-1(conﬁg-rtr)#
Verifying IPv6 RIP Operation
You have a few commands to use to verify that IPv6 R IP is working correctly.
T he ﬁrst of these is show ipv6 rip.T his command gives you all the speciﬁc infor-
mation relating to the operation of IPv6 R IP, including the following:
■
T imer Information
■
Port Information
■
U pdate Frequency
■
U pdate Types
■
Default R oute Information
T his command is a very useful tool for verifying that R IP is functioning cor-
rectly.T he following listing shows an example of a command output from the
show ipv6 rip command:
6Router-1#show ipv6 rip
RIP process "cisco", port 521, multicast-group FF02::9, pid 71
Administrative distance is 120.  Routing table is 0
Updates every 30 seconds, expire after 180
Holddown lasts 180 seconds, garbage collect after 120
Split horizon is on; poison reverse is off
Default routes are generated
Periodic updates 24667, trigger updates 2
6Router-1#
show ipv6 protocols is useful for showing all the IPv6 protocols, including R IP,
that are running on a router. Information included from this output includes the
following:
■
R outing protocols in use
■
Interfaces used by routing protocols
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
209
■
R edistribution information
T he following listing show an example of this command output:
6Router-1#show ipv6 protocols
IPv6 Routing Protocol is "connected"
IPv6 Routing Protocol is "static"
IPv6 Routing Protocol is "rip cisco"
Interfaces:
Serial0
Ethernet0
Redistribution:
Redistributing protocol static with metric 4
Redistributing protocol rip cisco
Although we have already used this command throughout our discussion of
R IP numerous times, the show ipv6 route command is also important in verifying
R IP operation.T his command output shows all the IPv6 routes that have been
learned by the router thus far, as well as the protocol used to obtain the routes in
question.T he following listing shows an example of this command output:
6Router-1#show ipv6 route
IPv6 Routing Table - 7 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea
Timers: Uptime/Expires
L   2000:1:1::1/128 [0/0]
via ::, Serial0, 5d17h/never
C   2000:1:1::/64 [0/0]
via ::, Serial0, 5d17h/never
L   2000:1:2::1/128 [0/0]
via ::, Ethernet0, 1w2d/never
C   2000:1:2::/64 [0/0]
via ::, Ethernet0, 1w2d/never
R   2000:1:3::/64 [120/2]
via FE80::2E0:B0FF:FE55:B035, Serial0, 02:45:40/00:02:32
L   FE80::/10 [0/0]
via ::, Null0, 1w2d/never
www.syngress.com

210
Chapter 6 • Routing IPv6 for the Cisco IOS
L   FF00::/8 [0/0]
via ::, Null0, 1w2d/never
6Router-1#
Exploring IS-IS for IPv6
IS-IS is one of the ﬁrst link-state routing protocols. In the previous sections our dis-
cussion has focused on R IP, which is a distance-vector routing protocol.As you
know from our discussion, distance-vector routing protocols use the distance, or
number of hops, to determine the metric for reaching a given destination. Link-
www.syngress.com
A Whole New Protocol
With a whole new protocol in RIPng, wouldn’t it make much more sense
to transition completely over to this new standard when implementing
IPv6 in a network? The answer to this is: It depends. Although RIPng
does show a lot of promise as a protocol, don’t forget that we are dis-
cussing RIP, the often lamented and downplayed protocol of the net-
working world. RIP is one of the oldest and most stable routing
protocols in existence. However, a lot of the reason that we now have
multiple protocols is because of the limitations of RIP and its distance-
vector routing protocol brothers. Two other factors should be consid-
ered in this discussion as well: your existing network and your plans for
growth. It is hard to imagine that any organization considering IPv6
does not have an existing network—probably a large one if they are
looking to IPv6 as an alternative. 
The assumption that should be made is that if you would put RIP
on this existing IPv4 network, then you would probably be safe in
putting IPv6 on it. If not, then you should seriously consider putting RIP
for IPv6 on this network. If there are plans for network growth, will this
protocol scale to meet them? Will it need legacy support for IPv4? These,
among hundreds of other questions, should be considered before
choosing any protocol for your network. It’s important to note that two
of the most widely deployed protocols in Cisco networks, OSPF and
EIGRP, are also due to be supported on the existing standard, allowing
for support for both IPv4 and IPv6.
Conﬁguring & Implementing…

Routing IPv6 for the Cisco IOS • Chapter 6
211
state routing protocols, such as IS-IS, take a much more overall picture of the
network and base their metrics on a more accurate set of metrics and calcula-
tions.We’ll discuss some of the overall aspects that all link-state routing protocols
share here.
Link-state routing protocols offer much more scalability and many more fea-
tures than their distance-vector predecessors. Link-state protocols also offer a
system of hierarchy within a routed domain that affords the user much greater
control and scalability than would be possible using distance-vector routing pro-
tocols.T hese protocols also offer support for VLSM , enabling a network to sup-
port multiple subnet masks, making much better utilization of available IP address
space. It is for these reasons, along with several others, that link-state protocols are
the protocols of choice within large enterprise organizations as well as within the
networks of major service providers.
Link-state protocols derive their name from the manner in which they view
the network.T hey take the state, or conditions, of the path into account when
making a routing determination. R outers examine not only the state of the spe-
ciﬁc link, but also the link and its relation to the neighboring router. Information
such as bandwidth of the links and delay are taken into consideration as is infor-
mation pertaining to interface types, IP addresses, and subnet mask, which are all
calculated in the link-state database to make the best path determination at any
given time.T his provides a much better system of path determination than does
the distance-vector routing system that generally takes into account hop count as
its primary metric.
Link-state protocols are typically more difﬁcult to conﬁgure than distance-
vector protocols.Also, the C PU  and memory utilization on routers running link-
state routing protocols is typically greater than the load when running
distance-vector routing protocols, so you must ensure that you router has the
capability to support link-state protocols. It would not be wise to completely
write off distance-vector protocols either. Even though networks continue to
grow at accelerated rates and link-state protocols can scale to meet these needs,
distance-vector protocols, due to their simplicity and ease of conﬁguration will
most likely be around for some time to come.
Link-State Advertisements
L ink-state advertisements (L SA s) are the primary means of communication for link-
state protocols.W hen a router comes online, it ﬂoods the area around it with
LSAs to announce its networks.W hen other routers ﬂood the network with
www.syngress.com

212
Chapter 6 • Routing IPv6 for the Cisco IOS
LSAs, routers discover the network topology, build neighbor relationships, and
form adjacencies.
T his initial ﬂooding of packets is very important, because it ensures that all
routers in a link-state environment know about all the other routes so that an
accurate picture of the network is available to every router. R outers also use LSAs
to inform other routers of network topology changes. Every time a change
occurs, a router or routers send LSAs out with speciﬁc information. If the
receiving router does not know the updated information already (from another
source, perhaps), it requests a link-state update (LSU ) containing the new infor-
mation. LSAs are coded with sequence numbers; if a router receives an LSA with
a number older than the last one it received, it knows to discard it. LSAs also
have an aging mechanism (the default is 30 minutes), which will make an LSA
invalid and require a new one to be sent.
Neighbors
N eighbor relationships are formed in link-state protocols to facilitate network dis-
covery.W hen a new router comes online it ﬂoods the network with LSAs to
obtain neighbor reachability information with routers adjacent to it. Soon every
router knows about every other router within a single area. Because of their mem-
bership in a given area, routers will also learn about the given areas within a single
network, but they may not know about every route within those areas.T his helps
to limit the size of routing tables without limiting network reachability.
W ith that information in hand, routers can make the optimal path selection
and determination for each network. N eighbor relationships are handled differ-
ently by each link-state protocol; for instance, in an O SPF network, each router
builds a table of its adjacent neighbors, allowing for quick and efﬁcient access to
neighbor information.
T he establishment and communication with neighbors help to form relation-
ships known as adjacencies.Adjacencies are relationships formed between routers
for the purpose of exchanging routing information.Adjacencies will be formed
with different types of routers in different situations. In the case of a broadcast or
non-broadcast multi-access media used for interconnecting routers, a designated
router and backup designated router will be elected.T he routers on this segment
will establish adjacencies with these routers and only accept routing updates from
them. In the case of point-to-point links, routers will establish adjacencies with
each router to which it is directly connected in order to communicate and
exchange routing information.
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
213
Link-State Database
T he link-state database is a collection of all the information a router has obtained
through the receiving of LSAs. Every time a new LSA is received, the informa-
tion contained within is compared to the router’s link-state database and if the
sequence number is newer the information is added to the database.T his infor-
mation could include network reachability information, new routers, and so on.
A router maintains a link-state database for every area of which it is a member.
Areas
Link-state routing protocols use areas to establish hierarchy within a routed net-
work.Areas are logical, not physical, groupings of routers that are used to control
route propagation and control trafﬁc. Every router within an area has the same
link-state database. R outers belonging to more than one area will maintain a
link-state database for each area that they belong to.
IS-IS Speciﬁcs
N ow that we have discussed some of the characteristics that all link-state routing
protocols share, we’ll discuss some of the speciﬁcs of the protocol. IS-IS is quite
similar in some of its behaviors to O SPF.T his is no accident, as the developers
borrowed and improved on IS-IS when developing O SPF.Although IS-IS was
developed by the ISO  to route C onnectionless N etwork Service (C LN S), it has
been modiﬁed to route IP. Its modular architecture means that it can be further
adapted to route other protocols such as IPX , should anyone need or choose to
develop that particular aspect of it.T his fact is also why it is one of the ﬁrst pro-
tocols to support IPv6.
As deﬁned in the original ISO  standard (ISO  10589 and R FC  1142), IS-IS
was developed to route only C LN S.T here was no other support for any other
network protocols such as IP. O ne of the driving factors behind C LN S was the
expected depletion of IP. IS-IS was to become the routing protocol of choice
after C LN S gained widespread acceptance.
C LN S and IS-IS were created and groomed to take up the mantle of network
addressing upon the retirement or demise of IP and its merry band of routing
protocols.As anyone who has ever used “the Internet” knows, this did not happen,
but it wasn’t from a lack of effort. O rganizations implemented a tighter grip on 
IP address allocation, and various ways to extend IP’s life were created and
deployed— N AT  and creative uses of private address space among them.
www.syngress.com

214
Chapter 6 • Routing IPv6 for the Cisco IOS
IS-IS is a link-state routing protocol with a similar concept of areas as O SPF.
Its area 0 (the backbone areas that all areas must transit to reach each other) is
called the level 2 (L2) area.All other areas are classiﬁed as level 1 (L1) areas. IS-IS
also has its own interpretation of the N SAP address as discussed in the N SAP
addressing section; please review before proceeding.
IS-IS routes by area within the autonomous system (L2 routing) and by the
system ID within an area (L1 routing).T hat is, IS-IS uses the area address to
determine how to reach the area, and the system ID to reach a particular device
after it gets to the destination area.T herefore, it can be said that IS-IS routes on
two levels: area and station.
CLNS Addressing
As we mentioned earlier, IS-IS was designed with the routing of C LN S in mind.
T hese addresses, commonly referred to as N SA P  addresses as well, are 80 bytes in
length and are read from right to left as opposed to left to right like common
English, or the way we read IP addresses.T his is a very important distinction to
make.Also, C LN S addresses are not assigned to an interface; rather, they are
assigned to the router or network entity as a whole.T his is why C LN S addresses
are often commonly referred to as N ET  addresses.T he format for this is broken
up into four ﬁelds.T he ﬁrst of these ﬁelds is the authority and format identiﬁer,
and is one octet in length.T he second is the area ID; this section is three octets
in length and speciﬁes the area that the particular network entity belongs to.T he
third section is the system ID.T his six-octet portion of the address speciﬁes the
exact system identiﬁer and must be unique within the network.T he last portion
of the address is the selector portion, which is also one octet.T his is used to
specify the actual port or interface of the network entity. R outing for C LN S
addresses is enabled by use of the clns routing command in global conﬁguration
mode, followed by the router isis command and speciﬁcation of a net address.
Integrated IS-IS
Support for IP is not inherent in IS-IS, as we discussed before— it was designed
for C LN S-only routing.You need to make only a few conﬁguration changes to
your C LN S routing conﬁguration to be able to use IS-IS.T he ﬁrst of these is the
ip router isis command. If IP addresses are not conﬁgured, you must conﬁgure
them on the interface at this time.You must then also assign the interfaces to an
area by using the area command.T his enables the IS-IS process to advertise the IP
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
215
address to other IS-IS routers.T his is a brief introduction to a fairly complex
topic, but we will cover more IS-IS conﬁguration in our discussion of IPv6 IS-IS.
Conﬁguring IS-IS for IPv6
U nlike with R IP, a speciﬁc version of IS-IS was not written to support IPv6;
rather, extensions were written into the protocol to provide this support.T his is
because of the modular architecture of IS-IS. So the conﬁguration for IS-IS is
somewhat different from the conﬁguration for R IP.
You perform initial conﬁguration for IPv6 IS-IS the same as you do the con-
ﬁguration for standard IPv4 IS-IS: through the use of the router isis command.You
should then directly follow this command with the net command, specifying the
network entity address for the router. IPv6 support comes into play at the inter-
face level when assigning an IPv6 address to the router by using the ipv6 address
command followed by the ipv6 router isis <area> command. Figure 6.4 shows an
example of a basic IS-IS network.
In the following conﬁguration example we are using the two routers shown
in Figure 6.4, 6R outer-1 and 6R outer-2 respectively.
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)# clns routing
6Router-1(conﬁg)# router isis cisco
6Router-1(conﬁg-router)# net 49.aaaa.bbbb.cccc.dddd.0000.2222.2222.2222.00
6Router-1(conﬁg-router)# exit
6Router-1(conﬁg)# interface ethernet 0
6Router-1(conﬁg-if)# ipv6 address 2000:1:2::1/64
6Router-1(conﬁg-if)# ipv6 router isis cisco
6Router-1(conﬁg-if)# interface serial 0
6Router-1(conﬁg-if)# ipv6 address 2000:1:1::1/64
www.syngress.com
Figure 6.4 Basic IS-IS Network
6Router-1
6Router-2
Serial 0
2000:1:1::1
Serial 0
2000:1:1::2
Ethernet 0
2000:1:3::1
Ethernet 0
2000:1:2::1

216
Chapter 6 • Routing IPv6 for the Cisco IOS
6Router-1(conﬁg-if)# ipv6 router isis cisco
6Router-1(conﬁg-if)# exit
6Router-2#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-2(conﬁg)# clns routing
6Router-2(conﬁg)# router isis cisco
6Router-2(conﬁg-router)# net 49.aaaa.bbbb.cccc.dddd.0000.2222.2222.2223.01
6Router-2(conﬁg-router)# exit
6Router-2(conﬁg)# interface ethernet 0
6Router-2(conﬁg-if)# ipv6 address 2000:1:3::1/64
6Router-2(conﬁg-if)# ipv6 router isis cisco
6Router-2(conﬁg-if)# interface serial 0
6Router-2(conﬁg-if)# ipv6 address 2000:1:1::2/64
6Router-2(conﬁg-if)# ipv6 router isis cisco
6Router-2(conﬁg-if)# exit
In the preceding examples we enabled IS-IS routing by issuing the clns routing
command on both routers in global conﬁguration mode, after which we enable
integrated IS-IS by issuing the router isis cisco command.We then assigned the
N SAP address of 49.aaaa.bbbb.cccc.dddd.0000.2222.2222.2223.00 and
49.aaaa.bbbb.cccc.dddd.0000.2222.2222.2223.01 respectively by using the net
command.After which we assigned Ipv6 addresses to both the Ethernet and
serial interfaces of each router by using the ipv6 address command on both routers
in interface conﬁguration mode.We then assigned the interfaces to the IS-IS
routing process by issuing the ipv6 router isis cisco command on each interface.
We can verify proper IS-IS operation by performing show Iipv6 route (note
the I1 address, a level-1 IS-IS route running between our two test routers):
6Router-1#show ipv6 route
IPv6 Routing Table - 7 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea
Timers: Uptime/Expires
L   2000:1:1::1/128 [0/0]
via ::, Serial0, 5d20h/never
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
217
C   2000:1:1::/64 [0/0]
via ::, Serial0, 5d20h/never
L   2000:1:2::1/128 [0/0]
via ::, Ethernet0, 1w2d/never
C   2000:1:2::/64 [0/0]
via ::, Ethernet0, 1w2d/never
I1  2000:1:3::/64 [120/2]
via FE80::2E0:B0FF:FE55:B035, Serial0, 05:57:49/00:02:43
L   FE80::/10 [0/0]
via ::, Null0, 1w2d/never
L   FF00::/8 [0/0]
via ::, Null0, 1w2d/never
IS-IS Default Routes
Like R IP, IS-IS uses default routes to reach destination networks for which
routers do not have routes in their routing tables. H owever, entering default route
information for IS-IS IPv6 is somewhat different from that for R IP.
C onﬁguration for a default route for IPv6 in IS-IS is a two-step process.T he ﬁrst
step is to enter address family conﬁguration mode in IS-IS conﬁguration.T his is
accomplished by using the address-family ipv6 command in IS-IS conﬁguration
mode. U se the address family identiﬁer to specify which group of addresses,
either IPv4 or IPv6, is to be conﬁgured. Follow this command with the default-
information originate command.T his command also has optional parameters of
specifying a route-map to use when advertising the default route.We exit IPv6 IS-
IS conﬁguration by entering the exit-address-family command. If a route-map is
not used, the default route will be advertised to the rest of the routing domain as
a Layer 2 route.T he following listing shows an example of this conﬁguration:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)# router isis cisco
6Router-1(conﬁg-router)# address-family ipv6
6Router-1(conﬁg-router-af)# default-information originate
6Router-1(conﬁg-router-af)# exit-address-family
www.syngress.com

218
Chapter 6 • Routing IPv6 for the Cisco IOS
Maximum Paths for IS-IS
IS-IS automatically supports load balancing for up to two paths. H owever, this
value can be increased by up to four by manipulating the maximum paths value.T his
can be a very useful and effective conﬁguration, allowing for faster transmission of
data across multiple paths to a given destination.You manipulate the maximum paths
command at the IS-IS conﬁguration level. O nce again, this is a two-step process;
the ﬁrst step is to specify the appropriate address family that you wish to change by
using the address-family ipv6 command. Follow this with the maximum-paths
<number-paths> command.T he number parameter speciﬁes the number of max-
imum paths that you wish the router to support.T he maximum for this number is
four.T he following listing shows an example of this conﬁguration:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)# router isis cisco
6Router-1(conﬁg-router)# address-family ipv6
6Router-1(conﬁg-router-af)# maximum-paths 4
6Router-1(conﬁg-router-af)# exit-address-family
IS-IS Route Redistribution
R oute redistribution in IS-IS is similar, but not identical, to route redistribution
in R IP networks, so we will not go into the detail on this topic that we did on
R IP.We should discuss, however, some redistribution conﬁguration issues speciﬁc
to IS-IS.We will begin with a discussion of how to perform route redistribution
in IS-IS networks.
You perform IS-IS redistribution at the IS-IS router conﬁguration level. First,
enter the IS-IS conﬁguration mode with the router isis <area-name> command.
T hen, specify the address family you wish to conﬁgure redistribution on by using
address-family ipv6.You can then conﬁgure redistribution by using the redistribute
command.As with R IP, IS-IS can redistribute R IP, BGP, Static, and other IS-IS
processes.Also, like R IP, IS-IS has the capability to specify metric values and
which route-map to use.T he following listing shows an example of a basic R IP
into IS-IS redistribution. In this example, we are redistributing the IPv6 R IP
routing process cisco into our IS-IS routing domain with a metric of 100:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
219
6Router-1(conﬁg)# router isis cisco
6Router-1(conﬁg-router)# address-family ipv6
6Router-1(conﬁg-router-af)# redistribute rip cisco metric 100
6Router-1(conﬁg-router-af)# exit-address-family
IS-IS also has the capability to redistribute routes between level-1 and level-2
routers, enabling the two levels of routers to fully share connectivity information
while still keeping the network segmented. Inter-level route redistribution is
similar to standard redistribution; however, you must use a few more conﬁgura-
tion commands to make it happen. Inter-level redistribution begins like standard
redistribution with specifying the isis <area-id> and entering into the address-
family ipv6 level for conﬁguration of IPv6 parameters. U pon entering that level,
give the redistribute command, except now, you use the command: isis level-1 into
level 2 or level-2 into level-1. It is important to note that level-1 routes are automat-
ically redistributed into the level-2 routing process.W ith that in mind, we will
conﬁgure level-2 into level-1 redistribution in the following example:
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)# router isis cisco
6Router-1(conﬁg-router)# address-family ipv6
6Router-1(conﬁg-router-af)# redistribute isis level-2 into level-1
6Router-1(conﬁg-router-af)# exit-address-famil
Describing Muliprotocol 
BGP Extensions for IPv6
U p to now, our discussion has focused solely on routing protocols that operate
within a single organization, or, as it would be called in the world of networking,
single autonomous systems (AS). R outing protocols that operate within a single
AS are referred to as interior gateway protocols (IGPs). But what about trafﬁc that
leaves the AS— what happens to it? T he answer to that is exterior gateway protocols
(EGPs). Just as IGPs operate solely within a single AS, EGPs operate between ASs,
providing connectivity between organizations rather than within them.
T he most well-known and by far widely deployed EGP is BGPv4. For pur-
poses of this discussion we will just refer to it as BGP. Entire books have been
written on this protocol for two basic reasons: First, it is a very complex and intri-
cate protocol, and very few people are actually proﬁcient in their understanding of
www.syngress.com

220
Chapter 6 • Routing IPv6 for the Cisco IOS
this protocol, and second, because it is one of the most important protocols in use
today, connecting the ASs of the world.W ith this in mind, it would be impossible
to have a detailed discussion of this protocol within this chapter, so we are brieﬂy
going to discuss some of the basic concepts behind this protocol and then turn our
attention to the speciﬁc IPv6 conﬁguration tasks and considerations.
Autonomous Systems 
As mentioned, BGP operates between autonomous systems (AS).W hat exactly is
an AS? An AS is deﬁned as a network, or networks, that are under a single
administrative authority. C ompany networks generally fall into the category of
being a single AS; however, very large multi-national ﬁrms often segment their
networks into multiple autonomous systems for purposes of administration.
Autonomous systems are deﬁned by a numerical value; these numbers are gener-
ally assigned by your organization’s ISP or from an organization known as AR IN .
T hese numerical values number between 1 and 65635, a range between 64512
and 65535 have been set aside for private addressing, much like the private IP
address space that many companies utilize as speciﬁed by R FC  1918. BGP uses
these AS numbers, rather than just IP addresses, to route information between
autonomous systems.You specify the autonomous system number for the BGP
session running on a router by using the router bgp <as number> command.
Neighbors
Although BGP is considered to be a dynamic routing protocol, it relies on static
entries, known as neighbor statements, to communicate between autonomous
systems.T hese neighbor statements specify the neighbor’s autonomous system, as
well as their IP address.T hese neighbor statements are at the heart of the BGP
protocol.Another important note to make is that an existing IP connection must
exist between the two neighbors, either by static route, direct connection, or
through the use of an IGP. BGP cannot dynamically ﬁnd its own way to given
destination networks. N eighbor relationships are conﬁgured through the use of
the neighbor <ip-address> remote-as <as number> command.
BGP Metrics
All dynamic routing protocols incorporate the use of metrics to make calcula-
tions regarding the best path to take to make a routing decision, and BGP is no
exception to this rule. U nlike other routing protocols that base routing decisions
on one or a few metrics, BGP bases its routing metrics on 10 criteria.T he reason
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
221
for this is the advanced policy-based features that BGP has incorporated, which
enable the protocol to make data-forwarding decisions based on several different
factors.T he metrics that BGP incorporates are as follows:
■
O rigin
■
AS Path
■
N ext H op
■
M ulti-Exit Discriminator (M ED)
■
Local Pref
■
Atomic Aggregate
■
Aggregator
■
C ommunity
■
O riginator ID
■
C luster List
Conﬁguring BGP Extensions for IPv6
As with IS-IS, a new version of BGP was not developed speciﬁcally for the pur-
pose of routing IPv6; rather, new multi-protocol extensions were added to the
protocol to support IPv6. Enhancements made to the protocol include the sup-
port for IPv6, support for IPv6 next hop addressing information, and support for
link-local IPv6 addressing.
As we discussed before, a new version of BGP was not created for IPv6, so
you enter into IPv6 BGP conﬁguration the same way that you did IPv4 conﬁgu-
ration: through the use of the router bgp <as number> command. U pon entering
the BGP conﬁguration mode, you then need to enter the no bgp default ipv4-uni-
cast command.T his command turns off IPv4 BGP unicasts.T his is a necessary
step because, by default, IPv4 address information is advertised for each BGP
neighbor conﬁgured on the router. IPv6 cannot work if this is taking place.
Conﬁguring an IPv6 Neighbor Relationship 
It is slightly more involved to set up IPv6 neighbor relationships than IPv4
neighbors.To set up an IPv6 neighbor in BGP, you must ﬁrst specify the IPv6
address and remote-as number of the neighbor router by using the neighbor
www.syngress.com

222
Chapter 6 • Routing IPv6 for the Cisco IOS
<ipv6 address> remote-as <as number> command. Follow this command set by
entering into IPv6 address family conﬁguration and activation of the neighbor.
You do this with the ipv6 address-family command, followed by the neighbor
<ipv6 address> activate command.T he networks that you wish that the BGP pro-
cess advertise is also speciﬁed here through use of the network command.
Figure 6.5 shows a basic BGP network.T he following listing is an example of
this conﬁguration for the network. In this example we have two routers,
6R outer-1 and 6R outer-2. O n 6R outer-1 we have created a BGP process with
the autonomous system of 64999 and we have created a neighbor relationship
with the router at the 2000:1:1::2 address with an AS number of 65000.We have
also instructed the router to advertise the 2000:1:1::0/ 64 and 2000:1:2::0/ 64 net-
works.
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#router bgp 64999 (Enable BGP routing with AS 64999)
6Router-1(conﬁg-router)#no bgp default ipv4-unicast (Disable 1Pv4 unicasts)
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 remote-as 65000 (Neighbor)
6Router-1(conﬁg-router)#address-family ipv6 unicast (Allow IPv6 unicasts)
6Router-1(conﬁg-router-af)#neighbor 2000:1:1::2 activate (Activate neighor
6Router-1(conﬁg-router-af)#network ?
6Router-1(conﬁg-router-af)#network 2000:1:1::0/64 (Advertise network)
6Router-1(conﬁg-router-af)#network 2000:1:2::0/64 (Advertise network)
6Router-1(conﬁg-router-af)#exit
6Router-1(conﬁg-router)#exit
6Router-1(conﬁg)#
O n 6R outer-2 we created a BGP process with an autonomous system of
65000 and we created a neighbor relationship with 2000:1:1::1 with an
autonomous system ID of 64999.We also instructed the router to advertise 
the 2000:1:1::0/ 64 and 2000:1:3::0/ 64 networks.
www.syngress.com
Figure 6.5 Basic BGP Network
AS 64999
AS 65000
6Router-1
6Router-2
Serial 0
2000:1:1::1
Serial 0
2000:1:1::2
Ethernet 0
2000:1:3::1
Ethernet 0
2000:1:2::1

Routing IPv6 for the Cisco IOS • Chapter 6
223
6Router-2#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-2(conﬁg)#router bgp 65000 (Enable BGP routing with AS 65000)
6Router-2(conﬁg-router)#no bgp defaul ipv4-unicast (Disable 1Pv4 unicasts)
6Router-2(conﬁg-router)#neighbor 2000:1:1::1 remote-as 64999 (Neighbor)
6Router-2(conﬁg-router)#address-family ipv6 unicast (Allow Ipv6 unicasts)
6Router-2(conﬁg-router-af)#neighbor 2000:1:1::1 activate (Activate neighor)
6Router-2(conﬁg-router-af)#network 2000:1:1::0/64 (Advertise Network)
6Router-2(conﬁg-router-af)#network 2000:1:3::0/64  (Advertise Network)
6Router-2(conﬁg-router-af)#exit
6Router-2(conﬁg-router)#exit
6Router-2(conﬁg)#exit
We can verify the success of our BGP conﬁguration by using the show B G P
neighbors command on 6R outer-1.T he following listing shows that we have
indeed established a neighbor relationship with 2000:1:1::2 and shows that IPv6
unicast trafﬁc is going between the two routers.T he more important information
to be gained from this output would be the ﬁrst line of the conﬁg, verifying that
we do in fact have a neighbor relationship between the two routers as well as the
information contained in the following bolded lines concerning version, router
ID, BGP state, and up time.T his is followed by the information concerning the
IPv6-speciﬁc information about the BGP table and neighbor version as well as
connected/ dropped connection information:
6Router-1#show bgp neighbors
BGP neighbor is 2000:1:1::2,  remote AS 65000, external link
BGP version 4, remote router ID 172.16.8.33
BGP state = Established, up for 00:13:43
Last read 00:00:43, hold time is 180, keepalive interval is 60 seconds
Neighbor capabilities:
Route refresh: advertised and received(old & new)
Address family IPv6 Unicast: advertised and received
Received 18 messages, 0 notiﬁcations, 0 in queue
Sent 18 messages, 0 notiﬁcations, 0 in queue
Default minimum time between advertisement runs is 30 seconds
For address family: IPv6 Unicast
BGP table version 3, neighbor version 3
www.syngress.com

224
Chapter 6 • Routing IPv6 for the Cisco IOS
Index 1, Offset 0, Mask 0x2
Route refresh request: received 0, sent 0
1 accepted preﬁxes consume 68 bytes
Preﬁx advertised 2, suppressed 0, withdrawn 0
Connections established 1; dropped 0
Last reset never
Connection state is ESTAB, I/O status: 1, unread input bytes: 0
Local host: 2000:1:1::1, Local port: 179
Foreign host: 2000:1:1::2, Foreign port: 11000
Enqueued packets for retransmit: 0, input: 0  mis-ordered: 0 (0 bytes)
Event Timers (current time is 0x33538748):
Timer          Starts    Wakeups            Next
Retrans            17          0             0x0
TimeWait            0          0             0x0
AckHold            17         10             0x0
SendWnd             0          0             0x0
KeepAlive           0          0             0x0
GiveUp              0          0             0x0
PmtuAger            0          0             0x0
DeadWait            0          0             0x0
iss: 1756584196  snduna: 1756584638  sndnxt: 1756584638     sndwnd:  15943
irs: 2281490682  rcvnxt: 2281491115  rcvwnd:      15952  delrcvwnd:    432
SRTT: 269 ms, RTTO: 516 ms, RTV: 247 ms, KRTT: 0 ms
minRTT: 4 ms, maxRTT: 300 ms, ACK hold: 200 ms
Flags: passive open, nagle, gen tcbs
Datagrams (max data segment is 1440 bytes):
Rcvd: 25 (out of order: 0), with data: 17, total data bytes: 432
Sent: 27 (retransmit: 0, fastretransmit: 0), with data: 27, total data
bytes: 19
6Router-1#
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
225
You can also verify that IPv6 BGP is functioning by using the show ipv6 route
command.T he following show ipv6 route command output shows that the
6R outer-1 has learned of the 2000:1:3::/ 64 network by way of the BGP routing
process:
6Router-1#show ipv6 route
IPv6 Routing Table - 7 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea
Timers: Uptime/Expires
L   2000:1:1::1/128 [0/0]
via ::, Serial0, 5d23h/never
C   2000:1:1::/64 [0/0]
via ::, Serial0, 5d23h/never
L   2000:1:2::1/128 [0/0]
via ::, Ethernet0, 1w2d/never
C   2000:1:2::/64 [0/0]
via ::, Ethernet0, 1w2d/never
B   2000:1:3::/64 [20/1]
via 2000:1:1::2, Serial0, 00:00:47/never
L   FE80::/10 [0/0]
via ::, Null0, 1w2d/never
L   FF00::/8 [0/0]
via ::, Null0, 1w2d/never
6Router-1#
Conﬁguring a BGP Router ID
BGP uses router IDs to identify BGP speaking routers. In IPv4, this address was
automatically set to the loopback interface of the router. If this address did not
exist, then the address was set as the highest IPv4 address on the router. BGP
does not, however, do this for a router running only IPv6 BGP; therefore, you
must manually conﬁgure this value.Although you are not running BGP for IPv4
trafﬁc, you will need to conﬁgure the R outer ID as an IPv4 address.To do this,
you use the bgp router-id <ip address> command in BGP conﬁguration mode.T he
following listing shows an example of this conﬁguration:
www.syngress.com

226
Chapter 6 • Routing IPv6 for the Cisco IOS
6Router-1(conﬁg)#router bgp 64999
6Router-1(conﬁg-router)#bgp router-id 172.16.0.1
6Router-1(conﬁg-router)#
Conﬁguring BGP Peer Groups
P eer groups are a management mechanism that C isco routers can use to make
policy changes to multiple routers.T his functionality is very advantageous for
administrators who have to replicate policy changes to multiple BGP-speaking
routers.You deﬁne peer groups on routers with a name and a set of routing poli-
cies.You conﬁgure a peer group for IPv6 BGP by using the <name> peer-group
command.T hen, create a neighbor relationship, as we discussed earlier, and then
activate the peer group by using the neighbor <peer group name> activate command
in address family conﬁguration mode. Finally, add the neighbor’s IPv6 address to
the peer group by using the neighbor <ipv6 address> peer group <peer group name>
command.T he following listing shows an example of this conﬁguration:
6Router-1(conﬁg)#router bgp 64999
6Router-1(conﬁg-router)#neighbor cisco peer-group (Establish peer group)
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 remote-as 65000 (neighbor est)
6Router-1(conﬁg-router)#address-family ipv6 unicast (Enable IPV6 unicast)
6Router-1(conﬁg-router-af)#neighbor cisco activate (activate neighbor)
6Router-1(conﬁg-router-af)#neighbor 2000:1:1::2 peer-group cisco (add to 
peer group)
6Router-1(conﬁg-router-af)#exit
6Router-1(conﬁg-router)#
Conﬁguring Link-Local Addressing
You use link-local addresses for routers on a single link.T hey are an inherent part
of the IPv6 protocol. Each router assigns each of its active IPv6 interfaces a link-
local address.T herefore, a unique address, speciﬁc to the link running between
the two routers, can be used. BGP has the capability to use this address for
neighbor addressing to automatically assign a link-local address to peer routers.
You conﬁgure link-local addressing in the BGP conﬁguration mode by using the
update-source  <interface type> command in neighbor conﬁguration mode.T his
command speciﬁes that the router should use the address conﬁgured on the
interface speciﬁed for the neighbor relationship.After this, you should enter into
address-family conﬁguration mode and activate the neighbor relationship.At this
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
227
point you also have the option of also conﬁguring a route map.T he following
example shows this conﬁguration:
6Router-1(conﬁg)#router bgp 64999
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 update-source ? (Specify update 
source)
Async              Async interface
BVI                Bridge-Group Virtual Interface
CTunnel            CTunnel interface
Dialer             Dialer interface
Ethernet           IEEE 802.3
Lex                Lex interface
Loopback           Loopback interface
MFR                Multilink Frame Relay bundle interface
Multilink          Multilink-group interface
Null               Null interface
Serial             Serial
Tunnel             Tunnel interface
Vif                PGM Multicast Host interface
Virtual-Template   Virtual Template interface
Virtual-TokenRing  Virtual TokenRing
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 update-source serial ?
<0-1>  Serial interface number
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 update-source serial 0?
.  :  <0-1>  
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 update-source serial 0
6Router-1(conﬁg-router)#neighbor 2000:1:1::2 update-source serial 0
6Router-1(conﬁg-router)#address-family ipv6
6Router-1(conﬁg-router-af)#?
Router Address Family conﬁguration commands:
aggregate-address    Conﬁgure BGP aggregate entries
bgp                  BGP speciﬁc commands
default              Set a command to its defaults
default-information  Control distribution of default information
www.syngress.com

228
Chapter 6 • Routing IPv6 for the Cisco IOS
default-metric
Set metric of redistributed routes
distribute-list
Filter networks in routing updates
exit-address-family
Exit from Address Family conﬁguration mode
help
Description of the interactive help system
neighbor
Specify a neighbor router
network
Specify a network to announce via BGP
no
Negate a command or set its defaults
redistribute
Redistribute IPv6 preﬁxes from another routing 
protocol
synchronization
Perform IGP synchronization
table-map
Map external entry attributes into routing table
6Router-1(conﬁg-router-af)#neighbor 2000:1:1::2 activate (Activate neighbor)
6Router-1(conﬁg-router-af)#exit-address-family
6Router-1(conﬁg-router)#
BGP Redistribution
Like both R IP and IS-IS, BGP also has the capability to redistribute routes from
other routing protocols and from static routes on the local router.You conﬁgure
redistribution from the ipv6 address-family conﬁguration level in BGP conﬁgura-
tion mode by using the redistribute command.After you enter the redistribute com-
mand, a default protocol is speciﬁed, but you have the capability to specify a
different metric other than the default and to specify a route map statement.
WARNING
BGP uses a ten-step process in calculating its metric. Redistributed routes
do not go through this process, unless of course you are redistributing
another BGP process; therefore, you should manually conﬁgure the redis-
tributed protocols to appropriately ﬁt into the BGP routing process. 
Because this conﬁguration is almost identical to the redistribution of the
other protocols, we will not go into the process in detail.T he following listing
shows an example of BGP R IP redistribution:
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
229
6Router-1#conﬁg t
Enter conﬁguration commands, one per line.  End with CNTL/Z.
6Router-1(conﬁg)#router bgp 64999
6Router-1(conﬁg-router)#address-family ipv6 unicast
6Router-1(conﬁg-router-af)#redistribute ?
bgp        Border Gateway Protocol (BGP)
connected  Connected Routes
isis       ISO IS-IS
rip        IPv6 Routing Information Protocol (RIPv6)
static     Static Route
6Router-1(conﬁg-router-af)#redistribute rip ?
WORD  User selected string identifying this process
6Router-1(conﬁg-router-af)#redistribute rip cisco ?
metric     Metric for redistributed routes
route-map  Route map reference
<cr>
6Router-1(conﬁg-router-af)#redistribute rip cisco metric ?
<0-4294967295>  Default metric
6Router-1(conﬁg-router-af)#redistribute rip cisco metric 100
6Router-1(conﬁg-router-af)#exit
6Router-1(conﬁg-router-af)#exit-address-family 
6Router-1(conﬁg-router)#
We can verify the successful redistribution of R IP into BGP by issuing the
show IP V 6 protocols command:
6Router-1#show ipv6 protocols 
IPv6 Routing Protocol is "connected"
IPv6 Routing Protocol is "static"
IPv6 Routing Protocol is "bgp 64999"
IGP synchronization is disabled
Redistribution:
None
Neighbor(s):
Address                  FiltIn FiltOut Weight RoutemapIn RoutemapOut
2000:1:1::2                                                
www.syngress.com

230
Chapter 6 • Routing IPv6 for the Cisco IOS
IPv6 Routing Protocol is "rip cisco"
Interfaces:
None
Redistribution:
Redistributing protocol rip cisco
6Router-1#
www.syngress.com
Why Redistribute?
Redistribution is a very powerful tool that affords a network full con-
nectivity both within itself and to outside networks, without the cost of
the high processor utilization of running multiple routing protocols on
the same router, or choosing a single uniform routing protocol to go
across an entire network, if even possible. Rather, redistribution enables
multiple routing protocols and processes to work in harmony, sharing
the information. This enables the network administrator to fully leverage
the capabilities of the routing protocols in question, while oftentimes
averting its pitfalls. 
Let’s examine the three routing protocols we discuss in the
chapter to see how we could fully utilize their strengths in a network,
starting with RIP. RIP is an excellent protocol for small, stable networks.
With its hop count limitation of 15 routers and periodic broadcasting of
its entire routing table, it has also proven to be a bane to large, complex
networks, but remains an excellent protocol for small networks. IS-IS,
meanwhile, was traditionally intended for large CLNS networks. As a dis-
tance-vector routing protocol, it makes its path and metric calculation
based on several factors, generally making better routing decisions than
RIP. It is also a far more scalable solution than RIP, utilized across the
backbone networks of many major ISPs. However, IS-IS is also very pro-
cessor intensive, not even supported on many low-end routers. The third
protocol in question is BGP, which is an exterior routing protocol—it
works between organizations to provide connectivity. But how does it
communicate within a network? Although a version of BGP exists to
serve this function (IBGP), it still requires either static routes or an IGP to
provide connectivity.
Designing & Planning…
Continued

Routing IPv6 for the Cisco IOS • Chapter 6
231
Verifying BGP Operation
Several commands are available to ensure that your IPv6 BGP conﬁguration is
running correctly.We review some of these commands, their applications, and the
command syntax in the following sections.
U sing the show bgp C ommand
You can verify your BGP operation by using the show bgp ipv6 command.T his
command is very useful in diagnosing the overall health of the IPv6 BGP pro-
cess, as well as verifying that the protocol is advertising the appropriate networks.
T his output, displayed in the following listing, shows the local router ID, net-
works being advertised and learned via BGP, BGP table version, as well as path
and weights for the networks.
6Router-1#show bgp ipv6
BGP table version is 13, local router ID is 172.16.0.1 (Table version and
local router ID)
Status codes: s suppressed, d damped, h history, * valid, > best, i -
internal,
r RIB-failure
Origin codes: i - IGP, e - EGP, ? – incomplete 
Network          Next Hop            Metric LocPrf Weight Path
*  2000:1:1::/64    2000:1:1::2                            0 65000 i 
*>                  ::                                 32768 i
www.syngress.com
So you have three protocols that have desirable characteristics
for a particular network, but none is perfect for your network.
Redistribution enables you to leverage these strengths in such a way
that the weaknesses are completely forgotten. In your network alone
with just these three protocols, you could leverage redistribution to opti-
mize your network by using RIP at the edge network and redistributing
it into an IS-IS session, which would serve as a backbone protocol for
your network. This IS-IS process would then in turn interface with BGP
to provide internal connectivity for BGP and receive external connectivity
for the network.
Although this is a somewhat over-simpliﬁcation, it demonstrates
the effectiveness and scalability that redistribution can afford a network.

232
Chapter 6 • Routing IPv6 for the Cisco IOS
*> 2000:1:2::/64    ::                                 32768 i
*> 2000:1:3::/64    2000:1:1::2                            0 65000 i
(Advertised Networks)
6Router-1#
U sing the show bgp ipv6 summary C ommand
T he show bgp ipv6 summary command also gives an overall picture of the IPv6
BGP routing process; however, it does it in a different way than the show bgp ipv6
command did.As the following example illustrates, this command shows the BGP
router identiﬁer, local AS number, and BGP table version. Instead of listing the
individual network entries, as does the show bgp ipv6 command, it shows the
number of network entries with the available number of paths. N eighbor infor-
mation is listed at the bottom of this command output.T he command output
also displays memory utilization as well as route-map and ﬁlter-list usage.
6Router-1#show bgp ipv6 summary
BGP router identiﬁer 172.16.0.1, local AS number 64999 (Local BGP info)
BGP table version is 13, main routing table version 13 (Table version)
3 network entries and 4 paths using 659 bytes of memory (Network entries)
2 BGP path attribute entries using 120 bytes of memory (Path attribute info)
1 BGP AS-PATH entries using 24 bytes of memory 
0 BGP route-map cache entries using 0 bytes of memory
0 BGP ﬁlter-list cache entries using 0 bytes of memory
BGP activity 10/23 preﬁxes, 14/10 paths, scan interval 60 secs
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down
State/PfxRcd
2000:1:1::2     4 65000    1482    1489       13    0    0 00:05:04     2
6Router-1#
Other Routing Protocols 
and Future Developments
As you have probably already ﬁgured out, IPv6 support is still quite limited, with
only three dynamic routing protocols being supported; however, this fact will
change in the not-too-distant future. C isco is currently developing its third phase
of IPv6 support.T he most exciting of these enhancements will be the support for
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
233
two of the most widely deployed protocols in C isco networks: O SPF and
EIGR P.We’ll brieﬂy discuss these protocols in the following sections.
IPv6 OSPF
O pen Shortest Path F irst has been called the premier routing protocol of its time.
T his distinction was made because of the feature-rich, scalable, and open-stan-
dards platform that this protocol offers. O SPF is a hierarchical, link-state protocol
nature that can efﬁciently scale to meet the needs of any network from single
sites to large multi-national corporations. Because of its open standard nature,
O SPF can be used to interconnect multiple vendors’ equipment, and has there-
fore become the protocol of choice for thousands of organizations.
O SPF IPv6 support is outlined in R FC  2740. Like IS-IS and BGP, enhance-
ments to the existing protocol, rather than an entirely new protocol, were decided
for the support for IPv6. Like with BGP and IS-IS, the basic function of the pro-
tocol; that is, designated router selection, path selection, and support for areas,
remains unchanged.T he support for IPv6 is made possible by changes to the
addressing formats, to support the new IPv6 address formats, changes to basic LSAs,
and removal of authentication functions from the O SPF packet.T he ladder of these
changes is due to the fact that IPv6 has an inherent security feature built in.
As we mentioned, O SPF support is part of the phase-three deployment of
IPv6 services.T his deployment is currently scheduled to take place in mid-2002.
IPv6 EIGRP
Enhanced Interior Gateway R outing Protocol is another protocol widely
deployed throughout C isco networks. EIGR P is known as a hybrid protocol,
incorporating mechanisms of both distance-vector and link-state protocols.
EIGR P offers a scalable and effective solution for any C isco network, often a
preferential protocol to O SPF; however, EIGR P is a C isco proprietary protocol,
and it cannot be used to interconnect with other vendor’s equipment.As with
O SPF, C isco plans to maintain the current structure of EIGR P and will write
extensions into the protocol to support IPv6.T his support will also be part of the
third-phase deployment and will come in mid-2002.
www.syngress.com

234
Chapter 6 • Routing IPv6 for the Cisco IOS
Summary
IPv6 routing protocols offer the dynamic routing protocol solution for IPv6.
Although the support of IPv6 will certainly spread to all routing protocols in
time, currently only three routing protocols support IPv6 addressing.T hese pro-
tocols are R IP, IS-IS, and BGP.Although the R IP implementation was an entirely
new standard, both IS-IS and BGP were updated to support IPv6.
R IP is a traditional distance-vector protocol whose roots go as far back as
1982. R IP is also an open-standard routing protocol, and therefore can be used 
to interconnect different vendors’ equipment.As a distance-vector routing pro-
tocol, R IP calculates its metric based on hop count and considers a network
more than 15 hops away to be unreachable.T he IPv6 implementation of R IP
shares all the traditional mechanisms of R IP, because it performs metric calcula-
tion in the same fashion. IPv6 R IP also supports default routes, route redistribu-
tion, and route ﬁltering
IS-IS is a traditional link-state routing protocol. O riginally written to support
C LN S routing, extensions were written into it to support IPv4 addressing and
now IPv6 addressing.As a link-state routing protocol, IS-IS takes a more overall
look of the network when determining the path to use to reach a destination
network and will generally make a better routing decision because it is not con-
cerned with hop count as much as it is with items such as bandwidth. IS-IS treats
IPv6 support as an extension of the existing protocol instead of writing an
entirely new protocol as was done in the case of R IP. Like R IP, IS-IS supports
default routes and redistribution; IS-IS has the capability to conﬁgure a max-
imum number of paths that can be used to reach a destination network.
BGP is an exterior gateway protocol. IS-IS and R IP operate within a single
network or under a single entity of control, often called an autonomous system.
BGP operates between these autonomous systems to provide connectivity.
Support for IPv6 also came in the form of new extensions being written into the
protocol stack. IPv6 features supported by BGP include IPv6 routing, redistribu-
tion, manual conﬁguration of a R outer ID, link-local addressing, and peer groups.
O SPF and EIGR P support for IPv6 will be part of C isco’s Phase III support
for IPv6. Phase III is currently scheduled to be released in mid-2002. O SPF is an
industry standard link-state routing protocol that has become the protocol of
choice for several large organizations. O SPF support for IPv6 will also come in
the form of extensions written for the existing protocol rather than a new pro-
tocol entirely. EIGR P is a C isco-proprietary protocol. EIGR P is also considered
to be a hybrid routing protocol, which comes from its use of both link-state and
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
235
distance-vector routing protocol mechanisms. EIGR P support for IPv6 will also
come in the form of extensions written into the existing protocol.
Solutions Fast Track
Explaining R IP for IPv6
 T he R outing Information Protocol (R IP) is a distance-vector routing
protocol. It calculates its routing metrics based solely on hop-count.
 A new version of R IP, often referred to as R IPng, was written to
support IPv6.T his new version of R IP shares the IPv4 limitations and
mechanisms.
 IPv6 R IP supports default routes, route redistribution, and route
ﬁltering.
C onﬁguring R IP for IPv6 
 You enable R IP with the Ipv6 router rip <word> command.T he <word>
speciﬁes the R IP routing process to be used.
 Include networks in the IPv6 R IP routing process at the interface level
with the ipv6 rip <word> enable command. O nce again, the <word>
speciﬁes the R IP process ID.
 C onﬁgure default routes at the interface layer with the ipv6 rip
<word>default-information originate command.
Exploring IS-IS for IPv6
 Integrated System-to-Integrated System (IS-IS) is a link-state routing
protocol that was originally designed for C LN S routing. Extensions were
written in to support IP and now IPv6.
 Because it is a link-state routing protocol, its metric calculation is based
on numerous factors, not just hop-count. It can therefore make better
routing decisions than typical distance-vector routing protocols can.
www.syngress.com

236
Chapter 6 • Routing IPv6 for the Cisco IOS
 IS-IS supports all the same functions as the IPv6 version of R IP and also
supports speciﬁcation of more than one path to use for data transmission
through use of the maximum-paths command.
C onﬁguring IS-IS for IPv6
 You enable IS-IS on a router with the C L N S routing command. Enable
integrated IS-IS by issuing the router ISIS <word> command.Again,
<word> refers to the process ID.
 Advertise networks via IS-IS at the interface level with the ipv6 router isis
<word> command.
 R edistribute other routing protocols into IS-IS with the redistribution
command in the address family conﬁguration mode.
Describing M ultiProtocol BGP Extensions for IPv6 
 Border Gateway Protocol (BGP) is an exterior routing protocol used to
route between autonomous systems.
 Like IS-IS, extensions were added into the existing standard to support
IPv6.
 IPv6 BGP supports IPv6 routing, redistribution, manual conﬁguration of
a R outer ID, link-local addressing, and peer groups.
C onﬁguring BGP Extensions for IPv6
 Start basic BGP conﬁguration with the router bgp <process id> command.
 To support IPv6 unicast trafﬁc, you must disable IPv4 unicasts with the
no bgp default ipv4-unicast command.
 Form router peering relationships between BGP routers with the
neighbor command.You must form a neighbor relationship between every
router that you wish your BGP router to exchange information with.
www.syngress.com

Routing IPv6 for the Cisco IOS • Chapter 6
237
O ther Protocols and Future Developments
 O pen Shortest Path First (O SPF) is a link-state routing protocol used in
many large organizations. IPv6 support will come in the form of
extensions written into the existing standard
 Enhanced Interior Gateway R outing Protocol (EIGR P) is a hybrid
protocol incorporating mechanisms of both distance-vector and link-
state routing protocols. Like O SPF, IPv6 support will come in the form
of extensions written into the existing standard
 Both O SPF and EIGR P support for IPv6 will come with the Phase III
deployment of IPv6 from C isco, which is currently scheduled for 
mid-2002.
Q: W hat version of the IO S supports IPv6 addressing?
A: Support for IPv6 began with IO S 12.2(4) on limited platforms.You should
consult the C isco Web site to ensure that your speciﬁc router platform sup-
ports IPv6.
Q: W hy is support for IPv6 restricted to just R IP, IS-IS, and BGP?
A: As with any new technology, some growing pains are involved in rolling out
new technology.Although this is speculation, the protocols that they chose to
write extensions were probably picked because they are open standards that
can be used to interoperate with multiple vendors’ equipment. Support for
EIGR P and O SPF will come shortly.
Q: In previous versions of R IP you could only specify R IP to run as a single
process on the router.W ith the naming of the R IP process IDs in IPv6, does
this mean that multiple R IP processes can be run on the same router?
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

238
Chapter 6 • Routing IPv6 for the Cisco IOS
A: Yes, the new standard of R IP does support multiple R IP processes. H owever,
you must keep in mind the processor and resource utilization that multiple
R IP processors will incur and make resources available as necessary.
Q: In many examples I noted a double colon (::) when expressing an IPv6
address.W hat does this mean?
A: W hen dealing with an IPv6 address that has multiple octets that have only a
zero value in them, you can compress them by using the double colon.
Q: C an an IPv6 BGP process also advertise IPv4 addresses?
A: U nfortunately, no. Because of the unicast address properties of IPv4
addressing, you must disable IPv4 unicast trafﬁc for the entire BGP process in
order for IPv6 addressing and neighbor relationships to be formed.
www.syngress.com

Deploying IPv6 on
the Cisco IOS
Solutions in this chapter:
■
IPv6 Deployment Strategies
■
Understanding Deployment Methods
■
Translating between IPv4 and IPv6
Chapter 7
239
 Summary
 Solutions Fast Track
 Frequently Asked Questions

240
Chapter 7 • Deploying IPv6 on the Cisco IOS
Introduction
W ith all the changes from IPv4 to IPv6, the task of deploying the new protocol
can appear insurmountable.T his chapter will explain methods of deployment of
IPv6, the co-existence with IPv4, and the migration from IPv4. Strategies for
deploying IPv6 have been discussed alongside the protocol development since its
inception.T his has been a carefully considered topic of the designers of IPv6,
because a smooth transition from IPv4 to IPv6 is vital to the protocol’s success.
An entire IET F working group has been assigned the task of ﬁguring out how to
transition the Internet from IPv4 to IPv6.We will talk about some of the deploy-
ment scenarios that have been thought of so far.
Although there are various methods of deploying IPv6 on a network, a well-
thought-out project plan and a solid execution are necessary for any project of
this magnitude. Successful conversion and migration of each network attached to
the Internet is critical to the overall transition to IPv6, so the future of the
Internet is in the hands of the collective group of network engineers, administra-
tors, and designers that work for not only tier-1 providers and ISPs, but also for
individual organizations.T his chapter will provide the necessary information to
make an informed decision as to which path to take when deploying IPv6.
IPv6 Deployment Strategies
We will discuss many deployment strategies in this chapter for deploying IPv6
into an operational IPv4 network, or at the least running Ipv6 alongside IPv4.
IPv6 and IPv4 can co-exist until the time it is decided that IPv4 is no longer
needed in the network.T here are pros and cons to each method— one method is
not best in all cases. Each network is unique and the following sections will help
determine which strategy is best for your given environment and requirements.
At a high level, the basic strategies are to build tunnels or Virtual Private
N etworks (VPN s) for running IPv6 and IPv4 protocols concurrently at the
routers and hosts.T hese strategies apply to both the service provider and the
enterprise customer. For the service provider, these may be a result of any of the
following situations:
■
Internet services/ applications such as integrated telephony or Internet-
enabled PDAs
■
C ustomers requesting IPv6 access to the 6Bone or between their host
site to remote locations
www.syngress.com

www.syngress.com
■
A need to interconnect IPv6 with other providers
■
R equirement to route IPv6 trafﬁc on the backbone versus building 
tunnels
Enterprise users may have needs for any of the following:
■
Application(s) requiring IPv6
■
IP telephony deployment requiring additional end-to-end addressing
■
End-to-end security not available with existing N AT  operations
For each router that IPv6 will be implemented, the IO S will need to be at
12.0 ST  or 12.2 T  or later. R efer to C isco’s Web page for memory requirements
and individual device limitations. C isco has more than 3000 listed minimum
requirements based on product platform and feature set to determine the min-
imum DR AM  and Flash memory requirements.To verify the platform support
and list minimum memory requirements for the intended deployment, follow
these steps:
1.
Go to www.cisco.com/ kobayashi/ support/ tac/ software.shtml.
2.
Select either Software Advisor | Search by Release, or  Software
Upgrade Planner for C isco IO S selection.
Understanding Deployment Methods 
It is assumed that IPv4 and IPv6 will have requirements to co-exist in the near
future. IPv6 has not caught up with IPv4 robustness in routing protocols and for-
warding acceleration methods, which may delay the decision to fully migrate to
IPv6. H owever, isolated segments or departments may require IPv6 now, so to
accommodate this are four basic deployment methods:
■
M anually conﬁgure tunnels across an existing IPv4 network for encapsu-
lating IPv6 trafﬁc.
■
Implement mechanisms that can automatically build and select tunnels
based on the IPv6 header.
■
Provision dedicated virtual links such as AT M  or Frame R elay PVC s or
M PLS VPN s.
■
Deploy a dual-stack network where IPv4 and IPv6 are fully redundant
of the other protocol.
Deploying IPv6 on the Cisco IOS • Chapter 7
241

242
Chapter 7 • Deploying IPv6 on the Cisco IOS
Each of these deployment methods requires upgrading some of the routers to
support both IPv4 and IPv6 protocols, which we will refer to as dual-stack routers.
R egardless of the deployment method, in a dual IPv6/ IPv4 network, it will
be the Domain N ame Server (DN S) that directs the requesting host to which
protocol to use.T he API exists for DN S to support both IPv6 and IPv4 protocols
on the same server.A new “A6” record now exists.“A6” records are the equiva-
lent of the “A” record used by IPv4. DN S will probably play a major role in sim-
plifying the deployment of IPv6.As IPv6 routes are added, the DN S can be
updated to the new IPv6 addresses for hosts that have limited users still using
IPv4.T he DN S can be conﬁgured with the IPv6 address as the primary and the
IPv4 address as the secondary.
NOTE
Cisco routers do not currently route IPv6 by default as they do IPv4. You
must enter ipv6 unicast-routing in global conﬁguration mode to enable
the forwarding of IPv6 unicast packets.
Conﬁguring IPv6 over IPv4 Tunnels
T his is a very quick and easy approach to deploying IPv6 to limited locations.
IPv6 appears only at the access points supporting IPv6 hosts.T he interface sup-
porting the IPv6 segment is conﬁgured for both IPv4 and IPv6, or IPv6 only.
T he IPv6 trafﬁc is then encapsulated into IPv4 packets for transport through the
network. O nly the routers supporting the ingress and egress tunnel interfaces
require a dual stack (running both IPv6 and IPv4). Each of the tunnel interfaces
will treat IPv6 packets the same as a physical interface.T he IPv6 hosts will use
the tunnel’s address as their default gateway function and a routing protocol such
as IPv6 R IP will be required to forward packets (route) between tunnels.
IPv6 M anually C onﬁgured Tunnel
IPv6 packets are encapsulated inside IPv4 packets in the payload section.A dual-
stack router is required at the end-points of the tunnel.T he tunnel appears as an
LLC  point-to-point connection to the IPv6 domains.W ith the entire IPv6 packet
encapsulated inside the IPv4 payload section of the frame, the original IPv6 headers
are not modiﬁed. If there are a limited number of IPv6 domains to interconnect,
this may be a viable solution. H owever, you have to manually conﬁgure a tunnel
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
243
for each connection, which will impose scaling and management issues with large
numbers of IPv6 domains interconnecting with manual tunnels. Figure 7.1 illus-
trates this type of conﬁguration. If R outer B sends a packet to R outer C, the
packet has to travel across the tunnel to R outer A before it can enter the second
tunnel to reach R outer C  and vice versa.T he packets are routed across the IPv4
network based on the destination address of the tunnel. N o routing decisions are
made based on the IPv6 destination address; only the tunnel destination address is
routed upon, while IPv6 is encapsulated within the tunnel.
T he minimum conﬁguration commands required to conﬁgure the tunnel are
listed in this section. For the service provider, this may mean building a tunnel
between customer sites or possibly the 6Bone. For the enterprise, this would enable
communication between two IPv6 domains across the existing IPv4 infrastructure.
T he following is the required minimum conﬁguration needed to set up a
manual IPv6 tunnel on a C isco router.T he following commands will create a
tunnel and then specify both the ingress and egress of the tunnel.
T he ﬁrst command creates the tunnel or virtual interface for IPv6.
Router6(conﬁg)#interface tunnel tunnel-number
T he following commands are entered at the (tunnel) interface level.An IPv6
address is assigned to the tunnel interface.T he tunnel interface processes packets
just like a physical interface.
Router6(conﬁg-if)#ipv6 address ipv6-preﬁx/preﬁx-length [eui-64]
www.syngress.com
Figure 7.1 Manually Conﬁgured Tunnel
IPv4 Internet or Intranet
IPv6 domain
IPv6 domain
IPv6 domain
Tunnel 1
Tunnel 2
Router A
Router B
Router C

244
Chapter 7 • Deploying IPv6 on the Cisco IOS
N ext, create the local Tunnel End Point (T EP) associated with this tunnel
interface.
Router6(conﬁg-if)#tunnel source {ip-address | interface-type interface-
number}
T hen you will, create the remote T EP by specifying the remote T EP IP
address.
Router6(conﬁg-if)#tunnel destination ip-address
T he last command that you need to complete the tunnel mode is to select
the encapsulation method.T here are two types: ipv6ip and C isco’s protocol-
independent Generic R oute Encapsulation (GR E) gre ip. If you use a GR E
tunnel, simply replace the ipv6ip in the command with gre ip
Router6(conﬁg-if)#tunnel mode ipv6ip
IPv6 over IPv4 GR E Tunnel
C isco’s standard GR E tunnels provide the necessary services to encapsulate trafﬁc
in a point-to-point conﬁguration. GR E tunnels are not tied to any protocol or
transport, which is a beneﬁt over the preceding tunnel technique.As a result of
this protocol independence, GR E is the only tunnel method that can distinguish
Integrated IS-IS from other protocols and transport that trafﬁc on the same
tunnel.T he only conﬁguration difference from the IPv6 manually conﬁgured
tunnel is the last step, which speciﬁes the tunnel type. Substituting GR E for the
tunnel mode will create a GR E tunnel. IPv6 trafﬁc will have the same for-
warding characteristics as the IPv6 manually conﬁgured tunnel.
www.syngress.com
QoS on Manual Tunnels
Queuing methods used on standard interfaces may not apply to virtual
interfaces. Priority Queuing, Weighted Fair Queuing, Distributed
Weighted Fair Queuing, and Committed Access Rate methods are NOT
supported on tunnel interfaces. For Quality of Service on tunnel inter-
faces, Generic Trafﬁc Shaping will enable the manual conﬁguration of
the bit-rate, burst-size, and excess-burst-size for the virtual interface. If
Conﬁguring & Implementing…
Continued

Deploying IPv6 on the Cisco IOS • Chapter 7
245
Automatic IPv6 Tunnel
Automatic tunneling of IPv6 over IPv4 was an early technique where the low
order 32 bits of the IPv6 address were replaced with the 32-bit IPv4 address and
the leading 96 bits were 0:0:0:0:0:0.T his would produce an IPv6 address of
0:0:0:0:0:0:A.B.C.D, where A.B.C.D would be the IPv4 address.Although this
gives an automatic way of building tunnels, the beneﬁts of the increased address
space of IPv6 cannot be realized, because each host must have an IPv4 address
and the same constraints remain for which IPv6 was created to resolve.T his tech-
nique doesn’t scale well in large environments; it appears ISATAP is an extension
of this format allowing aggregatable IPv6 addressing. ISATAP is still in draft form
and is explained later in this chapter.
T he following is the required minimum conﬁguration needed to set up an
automatic IPv6 tunnel on a C isco router.T he following commands will create the
tunnel, associate the interface with the tunnel source, and specify the tunnel type.
T his ﬁrst command creates the tunnel or virtual interface for IPv6.
Router6(conﬁg)# interface tunnel {tunnel number}
T here is no need for an ip address on the tunnel interface.
IPv6.Router6(conﬁg-if)# no ip address
T his is different from the manual tunnel where an IP address is assigned to the
tunnel.An IPv4 and IPv6 address are both assigned to the physical interface.W ith
the automatic tunnel, the T EP is directed to the interface only.W ith the tunnels
being built automatically, there is no need to pre-conﬁgure the remote T EP.
Router6(conﬁg-if)# tunnel source {interface-type interface-number}
T he following command deﬁnes the type of tunnel.
Router6(conﬁg-if)# tunnel mode ipv6ip auto-tunnel
Automatic 6to4 Tunnel
C isco currently supports automatic 6to4 tunnels (R FC  3056).You need to do
only minimal manual conﬁguration for this technique.T he IPv4 network, either
www.syngress.com
the current trafﬁc requires a set amount of bandwidth, this will ensure
the tunneled trafﬁc won’t exceed a set bandwidth and compromise the
trafﬁc assigned to the physical interface.

246
Chapter 7 • Deploying IPv6 on the Cisco IOS
an intranet or the Internet, is treated as a unicast point-to-point link layer.T he
intent of using 6to4 tunnels is to connect IPv6 domains and not for individual
hosts, albeit technically it would work but could create scaling issues.Although
IPv6 packets are encapsulated inside IPv4 packets, predeﬁned tunnels are not
deﬁned.T he Internet Assigned N umber Authority (IAN A) has assigned a unique
routing preﬁx for 6to4 tunnels.T he unique 13-bit T LA is 0x0002, or referred to
as 2002::/ 16.T he following 32 bits (the high level N LA) is the unique global
IPv4 address of the 6to4 tunnel routers interface (See Table 7.1).W hen a 6to4
router receives an IPv6 packet that is not part of its own domain with an
FP/ T LA of 2002 it will encapsulate the packet inside an IPv4 packet and set the
protocol ﬁeld to 41.T he router will then use the high-level N LA (32-bit IPv4
address) as the destination address and route the packet across the IPv4 network.
If the T LA is not of a value of 2002, then the packet will be encapsulated in the
same manner and routed (to a default route destination) to another automatic
6to4-conﬁgured router (see Figure 7.2) or relay router, possibly a (dual-stack)
router connected to the 6Bone for de-capsulation and forwarding.
If multiple subnets exist in the IPv6 domain, an IPv6 IGP will need to be
used but no IPv6 EGP is needed, because the IPv4 exterior routing will perform
the necessary routing.
Table 7.1 6to4 Address
Bits
3
13
32
16
64
Field
FP 001
TLA 0x0002
V4ADDR
SLA ID
Interface ID
www.syngress.com
Figure 7.2 Automatic 6to4 Tunnel Interconnection
IPv4 Internet or Intranet
IPv6 domain
IPv6 domain
IPv4 Int addr: 192.168.1.1
IPv4 Int addr: 192.168.1.2
IPv6 Prefix
2002:C0A8:0101::/ 48
IPv6 Prefix
2002:C0A8:0102::/ 48

Deploying IPv6 on the Cisco IOS • Chapter 7
247
T he following commands are the minimum commands required to set up the
local router for 6to4 tunnels. First, use the following command to create the
tunnel interface for IPv6:
Router6(conﬁg)#interface tunnel {tunnel-number}
T he tunnel will use the speciﬁed interface for its source IPv6 address.T he
speciﬁed interface must have a valid global IPv6 address.
Router6(conﬁg-if)#ipv6 unnumbered {interface-type interface-number}
T he following command deﬁnes the local T EP.T his must be the same inter-
face used for the source address in the previous command.
Router6(conﬁg-if)#tunnel source {interface-type interface-number
T his next command speciﬁes 6to4 as the tunnel method:
Router6(conﬁg-if)#tunnel mode ipv6ip 6to4
T he next command exits the interface mode and returns to global 
conﬁguration:
Router6(conﬁg-if)#exit
Finally, the last command creates a static route for all 6to4 addresses to the
tunnel interface:
Router6(conﬁg)#ipv6 route 2002::/16 tunnel {tunnel-number}
ISATAP Tunnel
Future support of Intra-Site Automatic Tunnel Addressing Protocol (ISATAP) is
planned from C isco at a later date.T his is very similar to the 6to4 technique with a
major difference being where the IPv4 address is. 6to4 imbeds the address in the
N LA ID ﬁeld and ISATAP uses a speciﬁed T Y PE of “FE” and inserts the IPv4
address into the combined T SE and T SD ﬁelds of the IPv6 packet (see Table 7.2.)
As the name implies, ISATAP is meant as a means of connecting intranets versus
connecting inter-domains.T his approach offers advantages such as the following:
■
Aggregatable global unicast IPv6 addresses can be created that can be
either routed across the IPv6 network or tunneled locally.
■
Greater aggregation at the borders routers can be realized using the
upper 64 bits as deﬁned, versus imbedding an IPv4 address as 6to4.
www.syngress.com

248
Chapter 7 • Deploying IPv6 on the Cisco IOS
■
Both registered and private addresses can be used in ISATAP tunnels
with no effect.
Table 7.2 ISATAP Address Format
Bits
3
13
8
24
16
8
8
8
8
32-bits
Field
FP RES TLA ID NLA ID SLA ID 0x00 0x00 0x5E 0xFE IPv4 Address
of Endpoint
6over4 Tunnels
C isco has no plans to implement 6over 4 and recommends using ISATAP
instead.T his is another automatic tunneling method, which uses the IPv4 address
as the IPv6 lower 32-bit interface address.T he IPv6 packets are encapsulated in
IPv4 packets with the protocol type of 41.T he IPv6 frame would be represented
as FE80::A.B.C.D where A.B.C.D is the IPv4 address. 6over4 uses Internet
Group M embership Protocol (IGM P) to notify local IPv4 routers of their intent
to use 6over4.T he requirement of a multicast infrastructure has limited its
deployment.
Tunnel Broker
Tunnel Broker (T B) is not a C isco function.T he broker, most likely an ISP, is
responsible for providing access to destined IPv6 hosts or networks.T B is usually
a server serving many clients, or tunnels, and providing connection to either IPv6
services or the 6Bone.T he customer, with either a dedicated IPv6 or dual-stack
router, creates a connection to the ISP T B, most likely a dual-stack server, and the
ISP assumes responsibility of creating the tunnels to the end networks or hosts
using 6over4 tunnels.Tunnels can be created between hosts or routers.T he Web
site at www.ipv6.org should have a list of well-known tunnel brokers.A search of
the Internet will result in a number of free tunnel brokers, which your host can
connect to.T he only requirement on the host is a valid IPv6 stack.
T B tunnels use 6over4 tunnels; because C isco doesn’t support 6over4 tunnels
a C isco router cannot be used to create a tunnel to a T B.
Conﬁguring IPv6 over Dedicated Links
Both physical and virtual links can be used to segments or isolate IPv6 trafﬁc
from IPv4 trafﬁc.A dedicated WAN  physical link provides separation of IPv6
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
249
trafﬁc, but these links are typically costly and slow to be provisioned.T hree
common types of WAN  connectivity support virtual links, which the adminis-
trator can use to control trafﬁc ﬂows and provide Q oS. Frame R elay,AT M , and
now with the emerging optical networking, lambdas can be provisioned on a
single interface.
For Frame R elay (Figure 7.3), you can add a PVC  to an existing port and
provide dedicated C IR  to the PVC.You can think of AT M  in much the same
way, except the added levels of Q oS that can be provisioned to a single PVC  is
much more granular.W ith optical networking, if you use multiple lambdas, you
can conﬁgure dedicated lightstreams for separation of trafﬁc types. In all three of
these examples, it is possible to use a separate virtual interface and not require the
addition of additional interfaces or “local loops” from their service provider. For
both the end customer and the service provider, this enables both IPv4 and IPv6
trafﬁc to share resources while at the same time enabling enforcement of SLAs
and Q oS.
www.syngress.com
Figure 7.3 Frame relay
DDS Access
56 Port
DLCI 16   CIR 16
T1 Access
512 Port
DLCI 14   CIR 256
DLCI 16  CIR 16
Internet
IPv6
IPv6 & IPv4
DLCI 16
DLCI 16
DLCI 14

250
Chapter 7 • Deploying IPv6 on the Cisco IOS
Pros:
■
Link utilization is unaffected. Existing SLAs can be maintained.
■
C apability to utilize existing local loops and router investment while
keeping IP backbone trafﬁc separated.
C ons:
■
IPv6 routing isn’t as robust as that of IPv4. O SPF and EIGR P aren’t
available yet and hardware acceleration is only available on one or two
models currently.
Figures 7.4 (A & B) are display commands of the conﬁguration of the Frame
R elay serial port from the show interface serial 0 command.
Figure 7.4 (a) Frame Relay Conﬁguration Example: Hub Cisco Conﬁguration
interface Serial0 
encapsulation frame-relay 
! 
interface Serial0.14 point-to-point 
description to Internet 
ip address 1.2.3.4 255.255.255.0 
frame-relay interface-dlci 14 
! 
interface Serial0.16 point-to-point 
description to IPv6 remote domain 
ipv6 address 3ffe:1111:2222:1122::62/64 
frame-relay interface-dlci 16 
Figure 7.4 (b) Frame Relay Conﬁguration Example: Cisco IPv6 Conﬁguration 
interface Serial0 
encapsulation frame-relay 
! 
interface Serial0.16 point-to-point 
description to Hub Cisco 
ipv6 address 3ffe:1111:2222:1122::63/64 
frame-relay interface-dlci 16 
! 
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
251
NOTE
As with IPv4 addresses, IPv6 addresses can be mapped to DLCIs on a
single interface versus using sub-interfaces.
frame-relay map IPv6 IPv6-address dlci [broadcast] [cisco] 
[ietf] [payload-compression {packet-by-packet | 
frf9 stac [hardware-options] | data-stream stac 
[hardware-options]}]
Deploying IPv6 over an MPLS Backbone
Very little change is needed for an M PLS network when deploying IPv6. Because
M PLS forwards based on labels and not IP headers, the fact the IPv6 trafﬁc is
being transported is transparent to M PLS.T hree approaches exist for transporting
IPv6 over an M PLS network.T he ﬁrst two approaches are supported currently
and don’t introduce new technologies to the P or PE routers; the third approach
supports IPv6 at the PE and is currently under development in the draft stages
within the IET F.T he ﬁrst two approaches are very attractive to the service pro-
vide running M PLS, because they require no upgrades to hardware or software to
the network.
IPv6 U sing Tunnels on the C ustomer Edge R outers
T he approach of IPv6 using tunnels on the C ustomer Edge (C E) routers is much
like the ﬁrst examples of building tunnels across a routed network.You conﬁgure
the C E router as a dual-stack router and conﬁgure for IPv4-compatible or 6to4
tunnels.All trafﬁc to the PE routers remains IPv4 and therefore the IPv6 is trans-
parent to M PLS. For the enterprise user utilizing M PLS, this enables the use of
the existing M PLS infrastructure for IPv6 tunneled within IPv4.
IPv6 over a C ircuit Transport over M PLS
IPv6 over a circuit transport over M PLS is another way to move IPv6 trafﬁc
across the M PLS network with no changes needed to the P or PE routers. Layer
2 tunnels such as Any Transport over M PLS (AToM ) can be created. Because
www.syngress.com

252
Chapter 7 • Deploying IPv6 on the Cisco IOS
these tunnels are based on layer two technologies, the M PLS network doesn’t
care if the upper-layer trafﬁc is IPv6 or IPv4.AToM  can provide both leased line
“like” services as well as layer 2 services for Frame R elay,AT M , PPP, H DLC, or
Ethernet across the switched M PLS backbone. Like in the manual tunnel exam-
ples earlier, the ingress and egress are deﬁned for the trafﬁc ﬂows and would
behave as point-to-point circuits more than routed trafﬁc.Another limitation is
that IPv4 and IPv6 cannot co-exist on the same circuit. For the service provider
this is an attractive way to provide end-to-end connections.
IPv6 on the Provider Edge R outers
IPv6 on the Provider Edge (PE) R outer is under development as IET F Internet-
Draft draft-ietf-ngtrans-bgp-ngtrans-bgp-tunnel-03 speciﬁcation. PE routers must
be conﬁgured as dual-stack routers to provide both IPv6 and IPv4 to the C E
routers. N ative IPv6 is exchanged between the 6PE and C E router. N o changes
are needed to the P routers, because they are forwarding based on labels, not IP
headers. IPv4 is run between the PE and P routers to establish BT P sessions for
propagating IPv6 reachability via M P-iBGP.T he M PLS network appears to be
providing native IPv6 services with no changes to the core and native IPv6 ser-
vice to the C E routers.T he dual-stack PE routers are referred to as 6PE routers
and will exchange reachability information with other 6PE routers in the domain
using multiprotocol BGP and sharing a common IPv4 routing protocol with the
other P and PE routers.T his is the only M PLS solution where reachability infor-
mation is exchanged between the 6PE routers and shares a common IPv4 routing
protocol. M P-BGP provides the extensions necessary to advertise next hop
reachability using IPv6. IPv6 trafﬁc will be encapsulated with two levels of M PLS
labels.T he top label is the label distribution protocol (LDP), which carries the
trafﬁc between the 6PE routers using IPv4 routing protocols.T he lower label is
associated with the destination IPv6 address and uses multiprotocol BGP-4.
Please refer to Figure 7.5.
Using a Dual-Stack Backbone
Taken to the extreme, a dual-stack network would have all applications, hosts, and
routers as dual-stack devices.T his is a valid approach to IPv6 migration if prepared
to undertake the required tasks.T he upside is that there would be full native
routing and communications throughout the network, regardless of the protocol,
without building tunnels or placing the appropriate translations in front of speciﬁc
networks or hosts.T he network could be transitioned in two waves (see Figure
7.6).T he ﬁrst wave would be adding IPv6 to the network, then when the need for
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
253
IPv4 is no longer required, the second wave would be the removal of IPv4 from
the network.T he effort to fully implement a dual-stack network may outweigh the
beneﬁts.To fully implement a dual-stack network, administration and management
requirements will theoretically be doubled.A second addressing schema as well as
routing plan/ protocol will be implemented, all applications and servers would
require the addition and testing of IPv6 and all the client hosts and applications
would be upgraded with IPv6.W hat may be the biggest issue with proceeding
with this approach is the lack of comparative routing protocols and features devel-
oped for IPv6 at this time. IPv4 has mature Q oS and routing robustness, which
hasn’t been implemented in IPv6 as of this writing.
www.syngress.com
Figure 7.5 IPv6 on the Provider Edge Routers
IPv4
IPv4
IPv6
IPv6
IPv6
6PE
6PE
6PE
P
P
P
P
Figure 7.6 Migration to IPv6 from IPv4 Using Dual-Stack Strategy
IPv6
IPv6 & IPv4
IPv4
Dual-stack
dual routing protocols
Dual-stack
protocols & applications
Dual-stack
protocols & applications
IPv6 only
IPv6 only
IPv6 only
IPv4 only
IPv4 only
IPv4 only
Transition phase
Initial phase
Final phase

254
Chapter 7 • Deploying IPv6 on the Cisco IOS
www.syngress.com
Planning Methodology
The following items should be inputs to any network design or upgrade.
IPv6 is no exception.
■How many hosts: What are the effects on the addressing plan?
■What are the current network utilizations? Is the LAN satu-
rated; is the WAN saturated? Is there available bandwidth to
support the new additions?
■What are the trafﬁc patterns? How much trafﬁc is destined
for other domains?
■Is there sufﬁcient budget? This applies to hardware, soft-
ware, training, and personnel.
■CPU and memory utilization: Can the current equipment sup-
port the additional protocols and trafﬁc?
■Training: Is training needed for design, support, or manage-
ment of proposed deployment?
■Stafﬁng: Can the current staff complete the proposed
changes with the current responsibilities?
■Security: Will the new changes ﬁt into the current security
policies?
■Time Line: Establish a time line with deﬁned milestones that
are realistic.
■Management requirements: Needs for fault, performance,
and security need to be addressed.
■Response time: Ensure SLAs are considered with the design.
■Give thorough consideration to the chosen routing protocol
to ensure it will scale with the network; do not make a short-
sighted decision based on immediate requirements.
■Creating an aggregateable addressing plan will simplify the
routing plan and minimize the utilization placed on the
router.
The following input will be needed for decision of deployment of
IPv6 in addition to the preceding considerations.
Designing & Planning…
Continued

Deploying IPv6 on the Cisco IOS • Chapter 7
255
Translating between IPv4 and IPv6
As with the network, there will be a transition period where IPv6 hosts will need
to communicate with IPv4 hosts. In the ﬁrst part of the chapter we talked about
how to transport protocols across the network, but we didn’t talk about how they
would talk to the remote host if it hadn’t been upgraded to IPv6 support.
Building a tunnel across the network won’t do any good if the host at the far end
cannot communicate IPv6, hence the need to have an interim solution to trans-
late IPv6 data to IPv4 data. M ost of these solutions introduce a single point of
failure in the network and are intended as a transition tool, not as a permanent
network solution, but they do allow for the communication between IPv6 and
IPv4 hosts.
www.syngress.com
■Is connection to the 6Bone desired? Requirement for globally
unique address.
■Is interoperability between IPv6 hosts and IPv4 required? Will
the new IPv6 domain be an isolated test network or are the
users expected to access the same applications as other users
of the network?
■Will existing apps support IPv6? Is there a need for protocol
translation?
■Will existing SLA prevent encapsulating IPv6 across the
existing network? Will protocols need to be routed on sepa-
rate circuits?
■Troubleshooting tools: Are the NMS system and engineers
equipped to support the new protocol?
■Regardless of the deployment method chosen, basic IP
design issues will remain. Determining the proper addressing
and how many addresses are needed for each domain hasn’t
changed.
Each network will have unique requirements, but it is common to
underestimate the requirements for network projects and as a result
cause complications. Ensuring all the effected groups have input into
the planning and design phase can help ensure a successful deployment.

256
Chapter 7 • Deploying IPv6 on the Cisco IOS
Protocol Translation Mechanisms
As with the protocols, various mechanisms exist for translating IPv6 to IPv4,
depending on the requirements. Protocols can be translated on a per-host basis,
application basis, or all trafﬁc entering and exiting a domain can be translated.
Translations for all trafﬁc entering or leaving a domain at Layer 3 is accomplished
with N AT-PT  or translated at Layer 4 with T C P-U DP. Data can be translated
after it is received on the N IC  and before it gets to the protocol stack with BIS;
DST M  and Socks require a client on the IPv6 workstations that terminates the
IPv6 session at the translation box, which then initiates an IPv4 session and passes
trafﬁc between the two sessions.T he beneﬁt of using a protocol translation is that
there is no need to modify the existing applications.T he network migration can
begin without the need to upgrade all the applications at the same time.
N AT-PT
N AT-PT  is deﬁned in R FC 2766.C isco had an early release of N AT-PT  in
11.3(x)T  EFT, but due to problems has removed the feature from IO S 12.2(1)T ;
they plan to re-introduce the feature in a future release.T he term N AT  refers to
N etwork Address Translation, as in IPv4, but instead of converting an IPv4
address to another IPv4 address, the translation is from a valid IPv4 packet to a
valid IPv6 packet.T he PT  refers to Protocol Translation. Because IPv4 and IPv6
are different protocols, more is involved than with IPv4 N AT.T hree ﬂavors of
N AT-PT  are deﬁned: Basic N AT-PT, N AT-PT, and Bi-Directional-N AT-PT.T he
following is a description of each:
■
Basic NAT-PT Traditional N AT-PT  is set up to enable an IPv6
domain to initiate sessions and communicate with hosts in an IPv4 
network.T he router providing the connection between the IPv4 and
IPv6 networks would have a pool of IPv4 addresses for mapping ses-
sions.W hen an IPv6 host originates a session outside the IPv6 domain,
the router will map the IPv6 address to one of the available IPv4
addresses in the pool and translate the IP,T C P, U DP, and IC M P header
checksums.
■
NAPT-PT Adds port translation as well as address translation.T his 
provides the same functionality as N A T  overload used with C isco’s cur-
rent IPv4 routing.A single IPv4 address can be used to map multiple
IPv6 addresses to.T he N APT-PT  translates the T C P and U DP port
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
257
numbers and IC M P query identiﬁers of multiple IPv6 addresses to a
single IPv4 address.
■
Bi-Directional-NAT-PT T here is an additional requirement for hosts
in an IPv4 network to initiate a session to an IPv6 domain.A DN S
Application Level Gateway (ALG) must be used to translate V6 addresses
in DN S Q ueries and responses.
T C P-U DP R elay
T C P-U DP R elay is deﬁned in R FC  3142 as “An IPv6-to-IPv4 Transport R elay
Translator.” T he assumption is that a new IPv6 host has a need to establish com-
munication with an IPv4 host.T he primary difference between T C P-U DP R elay
and N AT-PT  is that N AT-PT  operates at the network layer and T C P-U DP
works at the transport layer.T his is technology that has been used in ﬁrewall-
related products in the past and has been adapted to ﬁll the requirement of IPv6
hosts communicating with legacy IPv4 hosts.Although the Transport R elay
Translator (T R T ) is a stateful device and DN S entries will need to map the IPv4
hosts to the T R T, no modiﬁcation is required on any of the hosts or routers.T his
has been proven to work well with protocols such as H T T P, SM T P, SSH , and
most of the day-to-day protocols.T his is a very simplistic method for isolated
IPv6 domains to communicate to IPv4 networks.
■
Supports bi-directional trafﬁc only
■
M ay not work with N AT  and certain protocols such as IPSec
■
M T U  size isn’t an issue, because the translation happens at the transport
layer and not the network layer.
■
M ost likely server router based.
■
N o changes needed on routers or hosts
Bump in the Stack M ethod
T he Bump In the Stack (BIS) method is deﬁned in R FC 2767. BIS inserts mod-
ules in dual-stack hosts between the network Interface driver modules and the
IPv4 modules.T hese modules snoop data ﬂowing between the modules and
translate IPv4 into IPv6 and vice versa.T his enables applications that have not or
cannot be modiﬁed to communicate with IPv6 to support IPv6 trafﬁc transpar-
ently.All the functions of N AT-PT, including deﬁning a pool of IPv4 addresses,
www.syngress.com

258
Chapter 7 • Deploying IPv6 on the Cisco IOS
are performed on the host.T he difference is, instead of performing N AT-PT  at
the IPv6 domain edge, the translation is performed at the host.T his is a valid
solution in the initial stages to address applications waiting to be modiﬁed to run
in the IPv6 domain or for applications that cannot be upgraded.
Dual-Stack Transition M echanism
Dual-Stack Transition M echanism (DST M ) has not been ﬁnalized as of this
writing.T he current IET F draft is draft-ietf-ngtrans-dstm-07.txt. C isco has not
made a public commitment to support DST M  as of this writing. U nlike the
other translation mechanisms, DST M  includes tunneling. DST M  is designed as a
solution for intranets that have totally converted the network to IPv6 and still
have requirements to access IPv4 hosts or have applications in the network that
still require IPv4.T he assumptions for DST M  is that the hosts will be dual-stack
hosts with a DST M  client installed, which will sit between the IP stacks and the
interface.A DST M  T EP (tunnel end point) and DST M  server are also required.
N o IPv4 address is deﬁned to the hosts when using DST M .A server (DST M
server) has a pool of addresses or ports that are allocated on a per-session basis.
W hen the need to initiate an IPv4 session is initiated, the host will contact the
DST M  server for a valid IPv4 host address to use during the session.T he server
will provide a valid IPv4 address from its address pool to the requesting host to
use for the session.T he sending host will then encapsulate the IPv4, using the
provided address from the DST M  server, packet inside an IPv6 packet using 
IPv4 over IPv6 (also referred to as 4over6 tunnel) and send the packet to the
DST M  T EP, which will de-capsulate the IPv4 packet from IPv6 and forward 
the IPv4 frame.
Socks-Based IPv6/ IPv4 Gateway
T he Socks-based IPv6/ IPv4 gateway method is based on version 5 of the
SO C K S protocol (SO C K Sv5) and is deﬁned in R FC 3089.T his method is
unique in that the translation between IPv4 and IPv6 is done at the application
layer and not at the networking layers.A “Socks Lib” module is required at the
client site; this module resides between the application layer and the socket layer.
T his is referred to as socksifying the client.T he other requirement is that a dual-
stack gateway (enhanced SO C K S server) is required to connect the IPv4 and
IPv6 network domains.W hen the client wants to establish a session to a host
with a different protocol, the client creates and terminates the session to the
gateway.T his session is entirely IPv4 or entirely IPv6.T he gateway, which is also
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
259
connected to the dissimilar network, then creates a session to the remote host
using the second protocol stack and relays the packets between the two hosts.T he
Socks protocol can run on both W indows and U N IX  operating systems.
Although this method does not require dual-stack workstations, it does require
socksifying all the hosts.T he two major differences with Socks are that the ses-
sions terminate at the gateway and there is end-to-end session security between
the gateway and the client and the gateway and the destination host.T he network
headers are not modiﬁed in any way that eliminates issues with fragmentation,
properly translating protocol features, and DN S translations.
www.syngress.com

260
Chapter 7 • Deploying IPv6 on the Cisco IOS
Summary
N o matter how you look at it, there will be some pain in implementing IPv6.
H owever, there is no reason that the pain has to be great or that the network has
to be upgraded overnight. People are reluctant to change and may think that the
way things are now aren’t broken and don’t need to be ﬁxed. It appears that “if”
has been replaced with “when” IPv6 will become the dominant protocol.T his is
evident by a quick glance at who is shipping IPv6 support now. Just to name a
few are the desktop and server companies such as C ompaq, M icrosoft, IBM , Sun,
Solaris, and Linux. In the networking ﬁeld, C isco, 3C om,Toshiba, N ortel, Lucent,
N okia, and many others are all shipping IPv6 now.You may already have devices
in your home with IPv6, such as a 3G phone or Sony PlayStation 2, without
even being aware of it.
W ith standards still being tweaked and the lack of hardware implementation,
C isco currently supports IPv6 in software; you may not want to rush out and
perform an entire IPv6 upgrade on your network, such as creating an entire dual-
stack network, yet.T his chapter covered various techniques to deploy IPv6 into
an existing IPv4 network, and/ or to enable communications between IPv6
domains across an existing IPv4 infrastructure, or to ensure the capability to con-
tinue assessing legacy IPv4 servers.T he approach that you choose will determine
the number of upgrades to routers for IPv6 support and IPv6 stack installs that
will be required on hosts. O ver a dozen different techniques have been discussed
in this chapter for integrating IPv6 with IPv4.All these approaches fall into four
basic categories: complete integration of IPv6 (dual stack), using dedicated links,
tunneling, or protocol translation.T hese four approaches can even be combined if
needed; for example, a dual-stack network could use dedicated links to ensure
SLAs are met across the wide area network.
For isolated IPv6 domains that need to communicate between other IPv6
domains, both manual and automatic tunnels can carry IPv6 trafﬁc across existing
IPv4 networks. M anual tunnels encapsulate IPv6 packets inside IPv4 packets for
delivery to pre-deﬁned T EPs.T hese T EPs will be required to run both IPv4 and
IPv6. IPv6 manually conﬁgured tunnels and IPv6 over IPv4 GR E tunnels are
manual tunnels.Automatic tunnels also encapsulate IPv6 inside IPv4, but the tun-
nels don’t have to be pre-deﬁned. Instead, the edge router uses the destination
address of the IPv6 packet to determine the end T EP.T hese approaches require
much less setup time and each of the approaches use different addressing schemes
for embedding IPv4 addresses inside the IPv6 address to facilitate the formation
of automatic tunnels.T here are a number of automatic tunnel techniques:
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
261
Automatic IPv6 Tunnel,Automatic 6to4 Tunnel, ISATAP Tunnel, 6over4 Tunnels,
and Tunnel Brokers.Tunnels can also be created in M PLS networks by using the
C E routers as the T EPs.
If the existing links that would normally be used for tunneling is of a critical
nature or can’t be jeopardized to perform outside set SLAs, using dedicated links
for IPv6 is a better solution than tunneling (encapsulating) IPv6 inside IPv4.
T hree solutions exist for using dedicated links; the ﬁrst is to use dedicated inter-
faces and dedicated physical links.Although dedicated transport and interfaces
guarantee separation of trafﬁc, it is costly to duplicate ports and circuits. If Frame
R elay or AT M  is deployed, a virtual circuit can be created with the proper band-
width guarantees and appropriate Q oS. Dedicated Layer 2 links can also be
deployed if M PLS is deployed with the use of AToM  with the appropriate Q oS.
For native IPv6 support across the entire network, only one solution is avail-
able today. M PLS will be able to offer native service with the use of 6PE routers,
but this approach is still in the draft stages in the IET F. For native support, all the
routers would be upgraded to run both IPv4 and IPv6 concurrently— this is
referred to as a dual-stack router.T his creates the greatest overhead with the need
for dual-addressing and dual-routing protocols running in the network.T here are
two current drawbacks with using this approach now.T he ﬁrst is that C isco has
implemented IPv6 in software and as such there is no hardware acceleration at
this time.T he second is that R IP and IS-IS are the only available routing proto-
cols; O SPFv3 or EIGR P haven’t been released yet for IPv6.
R egardless of the deployment method that you use to introduce IPv6 to your
networks, you will need to communicate to IPv4 hosts. Even if all the servers in
the network were to support IPv6, there are still IPv4 hosts on the Internet, which
will require protocols translation to facilitate communication.Again, there is more
than one way to perform IPv6 to IPv4 translations. N AT-PT  and T C P-U DP use a
server to pass trafﬁc between the two protocol domains with protocol translation
happening at the network layer and transport layer respectively. BIS is a solution
that is deployed on the destination server.A module is installed that sits between
the network card and the IPv4 protocol stack.W hen an IPv6 packet arrives at the
host, it is translated to IPv4 and delivered to the IPv4 protocol stack. DST M  and
Socks-based gateways use gateways that communicate between the protocol
domains. Both require a client on the IPv6 hosts that terminates the session at the
translation server and the server then creates a session to the end IPv4 host. O nly
Socks is available at this time; DST M  is still in the IET F draft mode.
www.syngress.com

262
Chapter 7 • Deploying IPv6 on the Cisco IOS
Solutions Fast Track
IPv6 Deployment Strategies
 C reating tunnels across an existing IPv4 network is a tried-and-true
method of creating connectivity between IPv6 domains. Point-to-point
can be created manually with IPv6 manually conﬁgured tunnels and
C isco’s GR E tunnels.Tunnels can be created automatically based on the
address using Automatic IPv6 Tunnels,Automatic 6to4 Tunnels, and
ISATAP Tunnels. If M PLS is deployed, tunnels can be created at the C E
router.
 For Q oS or SLA requirements, the use of dedicated links will provide
the needed control over the different protocols. Separate links can be
provisioned with total separation as the most costly and secure method.
U sing virtual links with transports such as Frame R elay,AT M , or O ptical
LAM BDAs. C ircuit transport over M PLS can also provide Q oS while
separating the protocols.
 W hen isolating IPv4 from IPv6 isn’t a concern or there is a need to
have both IPv4 and IPv6 co-exist in the domains both hosts and routers
can run in a dual-stack mode which basically running dual protocol
stacks in both the hosts and routers.T he routers will also be required to
run dual routing protocols.
U nderstanding Deployment M ethods
 Tunnels A technique to encapsulate IPv6 packets inside IPv4 packets
for transport across an existing IPv4 infrastructure.
■
IPv6 Manually Conﬁgured Tunnel T EPs are deﬁned across an
IPv4 network.All IPv6 trafﬁc enters and exits the network at the
T EPs.
Pros: Ease of deployment, low cost, tried-and-tested technology.
C ons: Doesn’t scale, tunnels are pre-deﬁned point-to-point links,
high management overhead, troubleshooting is difﬁcult.
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
263
■
IPv6 over IPv4 GRE Tunnel Enhanced features of the IPv6
manually conﬁgured tunnel.Added feature of protocol independence
of trafﬁc conﬁgured for the tunnel.
■
Automatic IPv6 Tunnel Tunnels are created automatically based
on the lower 32 bits of the address.T he IPv6 address is created by
taking an IPv4 address and padding 0’s into the upper 96 bits.
Pros: Ease of deployment, low cost, tunnels are created automatically.
C ons: N o realization of the increased address space of IPv6, doesn’t
scale, troubleshooting is difﬁcult.
■
Automatic 6to4 Tunnel Tunnels are created automatically based
on the IPv6 address.An IPv4 address is used in the upper 32 bits of
the N LA, which allows another 16 bits of SLA for segmentation
within the IPv6 domain.
Pros: Ease of deployment, low cost, tunnels are created automatically,
use of valid IPv6 frames.
C ons:Troubleshooting is difﬁcult,
■
ISATAP Tunnel T his tunnel technique is still in draft form. C isco
has plans to support ISATAP at a later date. ISATAP uses an IPv4
address to create the tunnel, but places the 32 bit IPv4 address in the
low 32 bits of the interface and uses a valid 64 bit IPv6 network
address.
Pros: Ease of deployment, low cost, tunnels are created automatically,
full use of valid IPv6 network addresses.
C ons:Troubleshooting is difﬁcult.
■
6over4 Tunnels T his tunnel technique uses multicast routing as a
virtual link layer. C isco does not and does not plan to support
6over4 tunnels. Like the Automatic IPv6 tunnel, an IPv4 address is
used in the lower 32 bits with a ﬁxed FE80::/ 96 preﬁx.
Pros: Ease of deployment, low cost, tunnels are created automatically.
C ons: N ot supported on C isco products, no realization of the
increased address space of IPv6, requires multicast network, doesn’t
scale, troubleshooting is difﬁcult.
www.syngress.com

264
Chapter 7 • Deploying IPv6 on the Cisco IOS
 IPv6 over Dedicated Links U sing existing transport infrastructure,
IPv6 is directed to dedicated links or virtual links. IPv6 has no impact
on IPv4 trafﬁc.
Pros: Q oS and SLAs can be managed for IPv4 and IPv6 separately.
C ons: IPv6 hardware acceleration and routing isn’t as robust as that 
of IPv4.
 IPv6 over an MPLS Backbone Tunneling, dedicated links, and dual-
stack techniques work with M PLS as they do with IPv4-routed
backbones.T he same restraints and beneﬁts apply to each of the
techniques; the only difference is the beneﬁts realized by having M PLS
on the backbone.
■
IPv6 Using Tunnels on the Customer Edge Routers T his has
the same characteristics as the manually conﬁgured tunnels, with the
difference being that the encapsulated packets are switched across the
M PLS backbone versus being routed across an IPv4 backbone.
■
IPv6 over a Circuit Transport over MPLS Same characteristics
as using dedicated links. M PLS VPN s are created with the appro-
priate Q oS assigned to each VPN .
■
IPv6 on the Provider Edge Router T his is not commercially
available and is still in draft form with the IET F. U sing M P-BGP,
M PLS is able to advertise next-hop reachability using IPv6 address,
which will enable native IPv6 service to be offered to the C E
routers from the PE.
 Using a Dual-Stack Backbone R equires fully redundant
conﬁgurations of IPv4 and IPv6 with each router supporting both IPv4
and IPv6 and their routing protocols.
Pros: Ease of deployment, ability to use protocol analyzer for IPv6 issues,
full management of IPv6.
C ons: IPv6 hardware acceleration and routing protocols not as robust as
IPv4, depending on the size of the network, the overhead to upgrade all
the routers (and hosts) for IPv6 support could be large; possible hard-
ware and memory upgrades to support IPv6.
www.syngress.com

Deploying IPv6 on the Cisco IOS • Chapter 7
265
Translating between IPv4 and IPv6
 Translation techniques have three basic approaches:
■
All trafﬁc passes through a single “translation device,” such as N AT-
PT  or T C P-U DP R elay.
■
Snifﬁng packets at the host and making the translation from IPv6 to
IPv4 before the N IC  passes the data to the network layer of the
host.T he BIS method requires a client (or module) to be installed
on each of the workstations.
■
U sing a server to terminate both the IPv6 session as well as the IPv4
session. Both DST M  and Socks-based IPv6/ IPv4 gateways relay data
between the two sessions.T his requires the installation of a client to
communicate with the server.
 U sing a server to translate all trafﬁc creates a single point of failure,
because all trafﬁc passes through the translator. H eavy trafﬁc could tax
the server, requiring more server power or additional memory to
support the volume of packets.T he upside is that this approach eases
management— because all trafﬁc passes through a single device, all
changes and troubleshooting would be at a central location and not
dispersed across the network.
 Installing clients on each workstation can be an administration and
management burden for large deployments. For large deployments the
amount of effort to install clients on all the workstations and manage
host compatibility and possible upgrades should be factored in before
deploying these techniques.
www.syngress.com

266
Chapter 7 • Deploying IPv6 on the Cisco IOS
Q: Is IPv6 routing enabled in C isco IO S?
A: IPv6 is not enabled by default and must be enabled in global conﬁguration of
the router.
Router6(conﬁg)# IPv6 unicast-routing
Q: W hat IO S is required to support IPv6?
A: IO S will need to be at 12.0 ST  or 12.2 T  or later.
Q: C an IPv4 and IPv6 co-exist on the same networks?
A: Yes, they can.T here is no need to segment the two protocols, and co-exis-
tence allows for a phased deployment of IPv6 onto the network.
Q: M y production servers are deployed with IPv4; how could I justify deploying
IPv6?
A: IPv6 could be loaded on the server and the applications could create sessions on
both protocol stacks, or, if there are barriers to this, there are many protocol
translations discussed in this chapter to translate IPv6 into IPv4 packets so that
the server would only see IPv4 trafﬁc and would have no knowledge of IPv6.
Q: H ow much equipment must be added to the network to deploy IPv6?
A: Existing C isco routers can support both IPv4 and IPv6 with the current
12.2T  release.
Q: M y current IP trafﬁc is mission critical and is subject to strict SLAs; intro-
ducing a new protocol to these links would be hard to justify.
A: IPv6 can be isolated with the use of virtual links while maintaining band-
width, and Q oS guarantees your existing trafﬁc. Frame R elay and AT M  both
offer virtual circuits, M PLS offers AtoM , and optical LAM BDAs can all pro-
vide independents trafﬁc prioritization across a common transport.
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

IPv6 Security
Solutions in this chapter:
■
IPSec Overview 
■
Understanding the Building Blocks 
of IPSec
■
Combining IPSec’s Cryptographic
Mechanisms 
■
Applying Perimeter Security
Chapter 8
267
 Summary
 Solutions Fast Track
 Frequently Asked Questions

268
Chapter 8 • IPv6 Security
Introduction
In the open, hostile environment of today’s Internet, clearly the security of infor-
mation must be the top priority of any organization.To best protect an organiza-
tion’s critical electronic information, security should be implanted at many layers,
but the introduction of security at the network layer has grown signiﬁcantly in
recent years. IP Security (IPSec) speciﬁcations have been implemented widely
with IPv4 between communicating hosts on local networks or on virtual private
networks (VPN s), in which the Internet serves as the communication channel
between two private networks.
IPv6 has integrated the IPSec framework into the protocol speciﬁcations and
allows for easy implementation of security at the network layer.T his chapter
focuses on the IPSec framework, explaining how each component works in IPv6;
it also explores the topic of perimeter security, another critical component of a
good security implementation, and explains how to apply this type of security for
IPv6 using C isco IO S.
IPSec Overview
Security risks speciﬁc to IP include data theft, data tampering, and peer imper-
sonation. D ata theft is typically accomplished by eavesdropping on all the trafﬁc
traversing a particular network segment using a device called a sniffer. D ata tam-
pering involves actually intercepting trafﬁc (not just eavesdropping) that is not des-
tined for a particular machine, modifying the data, and sending the modiﬁed
trafﬁc along to the ultimate destination. P eer impersonation involves pretending to
be another node by sending trafﬁc to a particular destination node, but specifying
another IP address as the source address instead of your IP address.T his imper-
sonation is called IP  spooﬁng and can be used in denial of service (DoS) attacks
and in more sophisticated attacks that exploit a trust relationship.
T hrough the inclusion of IP Security (IPSec) extension headers, IPv6
includes security features that provide cryptographic security services at the net-
work layer:
■
Authentication T he veriﬁcation of the identity of a peer— a counter-
measure against IP spooﬁng.
■
Integrity T he veriﬁcation that data has not been modiﬁed in transit— a
countermeasure against data tampering.
www.syngress.com

www.syngress.com
■
Conﬁdentiality T he protection of data in transit— a countermeasure
against data theft.
■
Access control T he limitation of communication to only authorized
peers— can be a countermeasure against many attacks.
IPSec is a standard deﬁned by a suite of R equests for C omments (R FC s)
from the Internet Engineering Task Force (IET F) that can be implemented in
both IPv4 and IPv6.T here are many deployments of IPSec within the existing
IPv4 world used to establish VPN s.A VPN  provides you with the means to com-
municate over a public network while maintaining the privacy of the communi-
cations and can provide you with a cost-effective means of leveraging an Internet
connection for communication to multiple enterprise sites, partners, and clients
through a VPN  gateway at the network perimeter.W ith IPv6, you will have an
opportunity to utilize IPSec to provide true end-to-end security by protecting
data along the entire path between the source and destination nodes, not just
between gateways.
IPv6 Security • Chapter 8
269
Comparing IPSec and SSL
After reading about the complexity of IPSec, you may ask the question:
Why would anyone use IPSec when Secure Sockets Layer (SSL) is avail-
able and is so easy to implement? The answer is that there are situations
where it may make sense to use SSL instead of IPSec, but the use of IPSec
instead of SSL makes sense in other situations. The basic differences can
be described in terms of ease of use, implementation layer, and scope of
protection.
Because of its wide implementation in Web servers and Web
browsers, SSL is a commonly used protection that can be conﬁgured rela-
tively easily. Many Web servers implement SSL to provide encrypted and
authenticated communications (depending on the conﬁguration) to an
unknown community of potential browsers. The actual use of SSL during
a session is often transparent to the user. On the other hand, IPSec has not
been widely implemented or deployed on user workstations, and it is typ-
ically more complex to conﬁgure and implement. The most common use
of IPSec today is in both remote access and site-to-site VPNs.
Designing & Planning…
Continued

270
Chapter 8 • IPv6 Security
Understanding the 
Building Blocks of IPSec 
IPSec is a complex set of standards and protocols.You can implement IPSec in
both IPv4 and IPv6.W ithin IPv4, IPSec services are just another “upper layer”
protocol that you can specify within the Protocol ﬁeld of the IPv4 header.
W ithin IPv6, IPSec services are extension headers that you can include within an
IPv6 header. In either case, the IPSec services consist of two security protocols:
the Authentication H eader (AH ) and the Encapsulating Security Payload (ESP).
Extension Headers Overview
AH  is an extension header and protocol that uses a cryptographic signature to
provide both connectionless integrity and data origin authentication. C onnection
integrity ensures that the data within the packet is not modiﬁed in transit from the
sender to the receiver; it is a countermeasure against data tampering. D ata origin
authentication ensures that the packet was sent by the expected sender, not
someone impersonating the sender. It is a countermeasure against IP spooﬁng.
ESP is an extension header and protocol that can provide conﬁdentiality, data
origin authentication, connectionless integrity, replay protection, and limited
trafﬁc ﬂow conﬁdentiality. C onﬁdentiality ensures that even if the trafﬁc is subject
to eavesdropping, the privacy of the data is ensured such that only the authorized
recipient will be able to read it.T he data origin authentication and connectionless
integrity provided by ESP are not as extensive as those provided by AH  in that AH
protects as much of the IP header information as possible, and ESP does not
(unless it is used in tunnel mode). R eplay protection ensures that once a packet has
been received, its session number cannot be reused by an attacker. L imited trafﬁc
www.syngress.com
In terms of the OSI model, you implement SSL at the transport
layer, and it provides protection to TCP services. No protection is avail-
able for UDP services. In addition, an application that wishes to take
advantage of the protection provided by SSL needs to either be Web-
enabled so that it can be used via a Web browser, or programmed to
take advantage of the desired SSL services. On the other hand, IPSec is
implemented at the network layer and provides protection to any trans-
port layer protocol (including both TCP and UDP). It requires no modiﬁ-
cation to applications and can protect all trafﬁc between two nodes.

IPv6 Security • Chapter 8
271
ﬂow conﬁdentiality ensures that an eavesdropper cannot determine communi-
cating nodes nor the frequency or volume of trafﬁc.T his is available only when
using tunnel mode.
W hen more than one IPv6 extension header is included in a packet, the
header should adhere to the following order:
1.
IPv6 H eader
2.
H op-by-H op O ptions H eader
3.
Destination O ptions H eader (for options to be processed by the ﬁrst
destination that appears in the IPv6 Destination Address ﬁeld plus subse-
quent destinations listed in the R outing header)
4.
R outing H eader
5.
Fragment H eader
6.
Authentication H eader 
7.
Encapsulating Security Payload H eader
8.
Destination O ptions H eader (for options to be processed only by the
ﬁnal destination of the packet)
NOTE
The ESP and AH formats and their use in both transport and tunnel
mode are identiﬁed and described in Chapter 3. 
Choosing the Mode of Operation
Both AH  and ESP support two modes of use: transport mode and tunnel mode. In
transport mode, the selected protocol (AH  or ESP) provides protection primarily
for upper layer protocols, and its extension header is created and inserted as part
of the original IPv6 header. Figure 8.1 illustrates the basic premise of transport
mode without getting into the speciﬁcs of either AH  or ESP.
H owever, in tunnel mode, the selected protocol (AH  or ESP) encapsulates the
original packet in a new one and treats it as the payload. In other words, the
extension header is created and inserted as part of a new IPv6 header that encap-
sulates the entire original packet as the payload.As a result, tunnel mode provides
www.syngress.com

272
Chapter 8 • IPv6 Security
the requested services (AH  or ESP) to the entire original packet. Figure 8.2 illus-
trates the basic premise of transport mode without getting into the speciﬁcs of
either AH  or ESP.Typically, you would use transport mode when utilizing IPSec
directly between two communicating hosts, and you would use tunnel mode
when utilizing IPSec between two gateways that provide services to one or more
hosts behind each of them.Tunnel mode is commonly implemented today in
order to create site-to-site VPN s for an organization.
Internet Key Exchange Overview
Although the AH  and ESP protocols provide the actual cryptographic services at
the network layer, you still need a mechanism that will determine which services
should be applied to the different trafﬁc ﬂows, and to negotiate the required
cryptographic keys for those services. Internet Key Exchange (IK E), deﬁned in
R FC  2409, is a secure key management protocol that essentially provides the
mortar that ties everything together within IPSec. IK E negotiates a Security
Association (SA) that contains the information necessary for an IPSec peer to
process incoming or outgoing trafﬁc. Because SAs are unidirectional, two SAs are
required to specify the cryptographic services for bi-directional trafﬁc between
two IPSec peers. O ne SA is used for outbound trafﬁc, and one SA is used for
www.syngress.com
Figure 8.1 IPSec Transport Mode
Original
Extension
Headers
Original
IPv6
Header
Upper Layer
Protocol
Header (TCP)
Data
Extension
Headers
Upper Layer
Protocol
Header (TCP)
Data
Extension
Headers
IPSec
Header(s)
Original
IPv6
Header
Apply
IPSec
Figure 8.2 IPSec Tunnel Mode
Original
Extension
Headers
Original
IPv6
Header
Upper Layer
Protocol
Header
Data
Apply
IPSec
Original
Extension
Headers
Original
IPv6
Header
Upper Layer
Protocol
Header
Data
New
Extension
Headers
IPSec
Header(s)
New
IPv6
Header

IPv6 Security • Chapter 8
273
inbound trafﬁc. In addition, the contents of a particular SA varies for each con-
nection, based on the services that are being applied (such as AH , ESP,AH , or
ESP). IK E negotiates these SAs using two primary phases:
■
Phase 1 Establishes an Internet Security Association and K ey
M anagement Protocol (ISAK M P, R FC  2408) SA, which provides a
secure mechanism for negotiating the actual SA that will be used for the
IPSec services (AH  and ESP).
■
Phase 2 Establishes the pair of IPSec SAs that will be used to select
and apply the appropriate IPSec services (AH  and ESP).
T he IK E protocol, phases, and their associated modes will be discussed in
more detail in the section “Internet Key Exchange” later in this chapter.
Understanding the Implementation Options
Because IPSec is intended to provide network layer security services, it can be
implemented on end hosts and devices. For an end host, the IPSec functionality
is typically implemented in one of the following ways:
■
Native Operating System IP Stack M any operating system vendors,
including M icrosoft, are now providing integrated IPSec functionality in
the native IP stack of the operating system.
■
Replacement Stack For those operating systems that do not have a
native stack IPSec implementation, a complete third-party replacement
stack may be available that takes the place of the entire native stack.
■
Bump in the Stack (BITS) An alternative to a complete replacement
stack, a third-party BIT S implementation is inserted into the native
operating system stack using a known application programming 
interface (API).
Although end host IPSec implementations are more available now, most
actual IPSec implementations utilize IPSec gateways that provide services to one
or more hosts that reside behind it. For a gateway, the IPSec functionality is typi-
cally implemented in one of the following ways:
■
Bump in the Wire (BITW) C alled a “bump in the wire” because it is
largely transparent to other devices on the network, this IPSec imple-
mentation is typically a dual interface device that provides IPSec services
www.syngress.com

274
Chapter 8 • IPv6 Security
to incoming and outgoing packets.An example of a BIT W  implementa-
tion is a VPN  gateway.
■
Integrated with Firewall An alternative gateway implementation that
is integrated with a ﬁrewall. Because ﬁrewalls reside primarily at the net-
work perimeter, this implementation is a relatively common implemen-
tation for remote access and site-to-site VPN s.
www.syngress.com
Perimeter Topology
When a VPN is using IPSec, you often need to make a decision about the
location of the VPN gateway with respect to a ﬁrewall. Should the VPN
gateway be located behind the ﬁrewall, in front of the ﬁrewall, or par-
allel with the ﬁrewall? From a security perspective, the ﬁrst choice
should be the location that enables the ﬁrewall to inspect the decrypted
trafﬁc. This accomplishes two things: 
1. Enables the ﬁrewall to apply a consistent policy to trafﬁc
traversing the network perimeter
2. Provides defense-in-depth should another site or user that is
part of the VPN be compromised
To accomplish this, the VPN gateway can be located in a demilita-
rized zone (DMZ) and be protected by either the external border router
or by the ﬁrewall itself, depending on how the DMZ is implemented. 
Implementing the VPN gateway either parallel to the ﬁrewall or
behind the ﬁrewall prevents the ﬁrewall from inspecting decrypted
trafﬁc. This could result in prohibited trafﬁc traversing the perimeter
through the encrypted tunnel, or it could lead to the compromise of the
site if another site or user computer that is part of the VPN is compro-
mised. Although there may be business-related or non-security related
technical reasons to deviate from this recommended topology, an orga-
nization should be aware of the risks before proceeding: The ﬁrewall
cannot inspect and control decrypted trafﬁc from the VPN gateway.
Designing & Planning…

IPv6 Security • Chapter 8
275
Understanding the Authentication Options
W ithin IPSec are two primary methods of authenticating peers: pre-shared keys
and certiﬁcates. In both methods, some authentication information is exchanged
between the peers out of band.W ith pre-shared keys, two or more peers securely
exchange (pre-share) a secret key prior to any IPSec negotiation.T he method of
exchanging the pre-shared keys is typically a manual process that involves typing
them in or sharing them via a ﬂoppy diskette. Pre-shared keys are a simple and
inexpensive way to authenticate peers; however, they do not scale as well as cer-
tiﬁcates. C ertiﬁcates are a preferable authentication option for larger and more
meshed IPSec deployments, but because they require the use of a certiﬁcate
authority (C A), they are typically more complex to implement.
Cryptographic Algorithms Used in IPSec
You use different types of cryptographic algorithms to achieve different goals.T he
following types of algorithms are used in IPSec:
■
Keyed-Hash Message Authentication Code (HMAC) Sometimes
called a keyed hash, H M AC  is used to authenticate both the source of a
message and its integrity. It requires a shared secret key between the two
parties and the use of a speciﬁed hash function.T he H M AC  function
produces a value (the M AC ) that is based on the message being sent and
the shared secret key.T he original message and the M AC  are sent to the
recipient, who calculates a M AC  based on the received message and the
shared secret key.T he recipient then compares the calculated M AC  to
the one that was received with the message. If they match, then the
sender is authenticated and the message has not been altered. If they
don’t match, then either the sender has been spoofed or the message has
been altered.T he keyed hashes required for IPSec are deﬁned in R FC
2403 (H M AC -M D5-96), R FC  2404 (H M AC -SH A-1-96), and R FC
2857 (H M AC -R IPEM D-160-96). O ther keyed hashes can be imple-
mented but are not required.
■
Block-Oriented Encryption T he block-oriented encryption algo-
rithm required for IPSec is DES. Stronger encryption algorithms are
often implemented; these include Triple DES, Blowﬁsh, C AST, IDEA,
and R C 5. In addition, the N U LL encryption algorithm can be used
with ESP, but does not actually provide any encryption. It would be
used in situations where only ESP authentication is desired.
www.syngress.com

276
Chapter 8 • IPv6 Security
■
Difﬁe-Hellman Key Agreement T he Difﬁe-H ellman key agreement
protocol relies on something known as the discrete algorithm problem
to provide the security that enables two users to exchange a secret key
over an insecure medium without the prior exchange of any secrets. It
requires the use of private values by both peers and the exchange of
associated public values by both peers. Difﬁe-H ellman is used within
IPSec to generate session keys.
Combining IPSec’s 
Cryptographic Mechanisms
N ow that you are aware of the IPSec building blocks, you may be wondering
how IPSec nodes determine which cryptographic services to apply and which
cryptographic keys to use for speciﬁc trafﬁc ﬂows. It uses various mechanisms
(which we’ll explore in this section) to accomplish the following speciﬁc tasks:
■
Determine whether any IPSec services need to be applied to the trafﬁc.
■
N egotiate the security services (AH  and ESP), algorithms, and associated
parameters to use for a given trafﬁc ﬂow. (N egotiation)
■
Authenticate the node with which you are communicating.
(Authentication)
■
Exchange and manage keys for the cryptographic services. (Key
Exchange)
■
Track all agreements.
T hese tasks are accomplished through a combination of the behind-the-
scenes mechanisms, including the Security Policy Database (SPD), the SA, and
the Internet Key Exchange (IK E) protocol.T he SPD solves the problem of iden-
tifying the trafﬁc to which IPSec services should be applied.T he IK E protocol
solves the problem of negotiating the services, algorithms, and parameters,
authenticating the other node, and exchanging and managing cryptographic keys.
T he SA concept solves the problem of tracking the IK E agreements with respect
to services, algorithms, and parameters for particular trafﬁc ﬂows.
www.syngress.com

IPv6 Security • Chapter 8
277
The Security Policy Database 
H ow does an IPSec node know whether or not to apply IPSec services to a
packet and which services it should apply? By using the Security Policy Database
(SPD).T he SPD identiﬁes the services to be applied to IP packets, and is con-
sulted in the processing of all trafﬁc (inbound and outbound), including non-
IPSec trafﬁc. It requires you to provide the security policy information through
the appropriate conﬁguration mechanism (for example, command line or graph-
ical user interface). For any packet, the SPD will identify one of three options for
processing:
■
Discard T his option can be applied to trafﬁc that is not allowed to
enter or exit the host or gateway.
■
Bypass IPSec T his option can be applied to trafﬁc that is allowed to
enter or exit the host or gateway, but does not require IPSec services to
be applied to it.
■
Apply IPSec T his option can be applied to trafﬁc entering or exiting
the host or gateway that requires IPSec protection. For this option, the
relevant information must be speciﬁed, including the services, protocols,
and algorithms.
T he SPD is an ordered list of policy entries that are identiﬁed by selectors,
which are roughly equivalent to the types of information used by a trafﬁc-ﬁl-
tering device.Table 8.1 identiﬁes typical IPSec selectors and the types of values
that can be deﬁned for each one.
Table 8.1 IPSec Selectors
Selector
Description
Destination IP Address
A single IP address, range of addresses,
address+mask, or a wildcard address
Source IP Address
A single IP address, range of addresses,
address+mask, or a wildcard address
Name
A userid (fully qualiﬁed user name string (DNS) –
Mozart@foo.bar.com or X.500 distinguished name)
or System Name (for example, FQDN or X.500 dis-
tinguished name)
Data Sensitivity Level
IPSO/CIPSO labels
www.syngress.com
Continued

278
Chapter 8 • IPv6 Security
Transport Layer Protocol
Obtained from the IPv6 “Next Header” ﬁeld; may
be an individual transport protocol value, a wild-
card, or OPAQUE
Source Port
May be an individual UDP or TCP port values, a
wildcard port value, or OPAQUE
Destination Port
May be an individual UDP or TCP port values, a
wildcard port value, or OPAQUE
NOTE
The OPAQUE value referenced throughout Table 8.1 is necessary because
the value for these ﬁelds may be encrypted.
You can use the selectors identiﬁed in Table 8.1 to deﬁne granular or broad
policies to apply to trafﬁc. For example, for host implementations, deﬁning a
broad policy can result in one SA being used for all trafﬁc between a pair of
hosts, regardless of the applications that are communicating. Likewise, for gateway
implementations, a broad policy can result in one SA being used for all trafﬁc
between a pair of gateways, regardless of the hosts behind the gateways that are
communicating. O n the other hand, a granular policy on host implementations
can result in different SAs being used for different communicating applications,
depending on the security services required by them. Likewise, a granular policy
on gateway implementations can result in different SAs being used for different
communicating host pairs, depending on the security services required by them.
The Security Association
T he SA is a mechanism that IPSec uses to keep track of the details of a negoti-
ated IPSec session between two nodes.An SA is unidirectional so that a pair of
SAs is actually required for communication between a pair of nodes. From one
node’s perspective, one SA is used for outbound trafﬁc and the other SA is used
for inbound trafﬁc.An SA is uniquely identiﬁed by three components: a destina-
tion IP address, a security protocol identiﬁer (AH  or ESP), and a Security
Parameter Index (SPI).T he SPI is a 32-bit number that is used to distinguish
www.syngress.com
Table 8.1 Continued
Selector
Description

IPv6 Security • Chapter 8
279
among different SAs terminating at the same destination IP address and using the
same protocol (AH  or ESP). It is generated by one node and sent to its peer for
it to include in the AH  or ESP headers.
NOTE
See Figures 3.12 and 3.15 for an illustration of the SPI’s relationship to
the AH and ESP headers.
SAs are stored and tracked in a mechanism called the Security Association
Database (SAD).T hey are indexed based on the SA triple-identiﬁer of destination
IP address, security protocol (AH  or ESP), and SPI, and include the information
identiﬁed in Table 8.2.
Table 8.2 Security Association Database (SAD) Fields
SAD Field
Description
Sequence 
32-bit value used to generate the Sequence Number ﬁeld 
Number Counter
in AH or ESP headers
Sequence 
Flag indicating whether overﬂow of the Sequence 
Number Overﬂow
Number Counter should generate an auditable event and
prevent transmission of additional packets on the SA
Anti-Replay 
32-bit counter and a bit-map used to determine whether 
Window
an inbound AH or ESP packet is a replay. This is used only
for inbound trafﬁc, and only if anti-replay is enabled.
AH Authentication Speciﬁes that authentication algorithm, keys, and other 
Information 
parameters that AH uses
ESP Authentication Speciﬁes that authentication algorithm, keys, and other 
Information 
parameters that ESP uses if the authentication service of
ESP is selected
ESP Encryption 
Speciﬁes that encryption algorithm, keys, and other 
Information 
parameters that ESP uses, if the encryption service of ESP
is selected
SA Lifetime
Speciﬁes the time interval after which an SA must be
replaced with a new one or terminated. The interval can
be expressed as a time interval, a byte count, or both.
IPSec Protocol 
The IPSec mode of operation (transport or tunnel) that 
Mode
has been applied to the trafﬁc
Path MTU
Any observed path MTU and aging variables
www.syngress.com

280
Chapter 8 • IPv6 Security
Because an individual SA is linked to one of the IPSec security protocols
(such as AH  or ESP), a single SA cannot be used in situations where trafﬁc
requires the services of more than one security protocol. In those situations, more
than one SA is required to implement the required services. C alled an SA  bundle,
this grouping of one or more SAs can include SAs that terminate at different
endpoints (for example, at a security gateway and a host behind the gateway).
T here are two basic types of bundles:
■
Transport Adjacency A situation where one or more protocols are
applied to the same IP packet without the use of tunneling.
■
Iterated Tunneling A situation where multiple layers of security are
applied to an IP packet through nested tunneling.
Internet Key Exchange 
Internet K ey Exchange (IK E) is the mechanism that determines which services
should be applied to the different trafﬁc ﬂows and negotiates the required crypto-
graphic keys for those services. It is the glue that binds the IPSec building blocks
together.Although you can conﬁgure keys manually and statically, this is not a
scalable or a secure solution. M anual key management can be practical in a small
deployment, but presents signiﬁcant management problems if the deployment
expands. In addition, because the keys are static (unless you manually change
them), as time passes and the keys are used to encrypt/ decrypt more trafﬁc, your
security risk increases because the probability of the keys being cracked increases.
IK E provides an automated and scalable solution to key management that can
ensure that the keys are continually refreshed.
IK E is a hybrid protocol that integrates ISAK M P with subsets of the O akley
key determination protocol and the SK EM E key exchange mechanism. ISAK M P
is a framework for authentication and key exchange, but does not deﬁne the
actual mechanisms. O akley deﬁnes a series of key exchanges that are called
modes, and SK EM E describes another versatile key exchange technique. IK E uses
parts of the O akley and SK EM E protocols within the ISAK M P framework by
using the ISAK M P packet format, shown in Figure 8.3. IK E uses the packet
format and deﬁned ISAK M P exchanges and payloads to negotiate SAs, authenti-
cation peers, and exchange keys. It accomplishes this using the following phases
and modes:
www.syngress.com

IPv6 Security • Chapter 8
281
■
Phase 1 Establishes an ISAK M P SA that provides a secure mechanism
for negotiating the actual SA that will be used for the IPSec services
(AH  and ESP).Two modes can be used in Phase 1: main mode and
aggressive mode. Both modes accomplish the goal of establishing an
ISAK M P SA; however, there are differences in the amount of security
protection that is provided, and the quickness with which the ISAK M P
SA is established.
■
Phase 2 Establishes the pair of IPSec SAs that will be used to select
and apply the appropriate IPSec services (AH  and ESP).T his phase is
accomplished using the protection services provided by the ISAK M P
SA, and uses only one mode (quick mode) to negotiate the IPSec SA.
www.syngress.com
Figure 8.3 ISAKMP Header Format
32 bits
0
8
16
24
32
Initiator Cookie
Responder Cookie
Message ID
Length
Next
Payload
Flags
Exchange
Type
MjVer
MnVer
Initiator Cookie
8 octet cookie of entity that initiated the SA establishment, notification, or deletion.
Responder Cookie
8  octet cookie of entity that is responding to an SA establishment request,
notification, or deletion.
Next Payload
8 bits that indicates the type of the first payload in the message.
MjVer
4 bits that indicates the major version of the ISAKMP protocol in use (currently 1).
MnVer
4 bits that indicates the minor version of the ISAKMP protocol in use (currently 0).
Exchange Type
8 bits that indicates the type of exchange being used, and dictates the message and
payload orderings in the ISAKMP exchange.
Flags
8 bits that indicate the specific options that are used for the ISAKMP exchange, including
encryption and authentication.
Message ID
4 octet unique message identifier that is used to identify protocol state during
phase 2 negotiations.
Length
4 octet value that identifies the length of the total message including the header.

282
Chapter 8 • IPv6 Security
T he ISAK M P packet format includes cookies generated by both the initiator
and the responder that together identify the applicable SA.T he packets also
include an exchange type that identiﬁes the type of exchange that is occurring
between the two nodes.T his exchange type determines both the series of
ISAK M P messages that will be exchanged and the payload types that will be
included in the packets. For this discussion, you need to be aware of the
exchange types identiﬁed in Table 8.3.
Table 8.3 ISAKMP Exchanges Used by IKE
ISAKMP Exchange Type
ISAKMP Value
IKE Phase and Mode
Identity Protection 
2
Phase 1 Main Mode
Aggressive
4
Phase 1 Aggressive Mode
Depending on what the two IPSec nodes are attempting to accomplish, an
ISAK M P packet will include one or more payloads. For this discussion, you need
to be aware of the ISAK M P payload types identiﬁed in Table 8.4.
Table 8.4 ISAKMP Payload Types Used by IKE
ISAKMP 
ISAKMP 
Payload Type 
Value
Description
Security Association 
1
Used to negotiate security attributes and to
indicate the Domain of Interpretation (DOI).
Key Exchange
4
Used to exchange data that will be used to
generate a session key. The interpretation of
the data depends on the DOI and supports a
variety of key exchange techniques.
Identiﬁcation 
5
Used to exchange information that identiﬁes
the communicating IPSec nodes.
Certiﬁcate
6
Used to exchange certiﬁcates or related infor-
mation if certiﬁcates are used and another
distribution mechanism (for example, a direc-
tory service) is not available.
Hash
8
Contains data generated by the hash function
over some part of the message and/or
ISAKMP state. This payload may be used to
verify the integrity of the data in an ISAKMP
message or for the authentication of the
negotiating entities.
www.syngress.com
Continued

IPv6 Security • Chapter 8
283
Signature
9
The Signature Payload contains data generated
by the digital signature function, over some
part of the message and/or ISAKMP state. This
payload is used to verify the integrity of the
data in the ISAKMP message and may be of
use for non-repudiation services.
Nonce
10
The Nonce Payload contains random data
used to guarantee liveness during an
exchange and protect against replay attacks.
Although ISAK M P may be implemented over any transport protocol, the
Internet Assigned N umbers Authority (IAN A) has reserved U DP port 500 for
use by ISAK M P. Putting it all together, Figure 8.4 illustrates an ISAK M P data-
gram within an IPv6 packet. It includes an IPv6 header, any extension headers, a
U DP header that indicates port 500, an ISAK M P header, and one or more
ISAK M P payloads, as deﬁned previously in Figure 8.3.
IK E Phase 1 M ain M ode
IK E Phase 1 M ain M ode is used to establish the ﬁrst phase ISAK M P SA, which
will provide protection for the negotiation of IPSec SAs and is illustrated in
Figure 8.5. It consists of three exchanges between the initiator and the responder
for a total of six exchanged packets.T he ﬁrst two packets that are exchanged
negotiate policy with respect to basic algorithms and hashes.T he next two
packets are used to exchange key material that will be used to calculate a session
key and nonces that will be used to perform authentication.T he ﬁnal two packets
are used to perform mutual authentication using the negotiated mechanism.T he
packets include relevant identiﬁcation and authentication data that are encrypted
using the session key calculated from the second exchange, as you can see in
Figure 8.5. Because this data is encrypted, main mode provides what is called
www.syngress.com
Table 8.4 Continued
ISAKMP 
ISAKMP 
Payload Type 
Value
Description
Figure 8.4 Internet Key Exchange (IKE) Packet
Data
(ISAKMP
Payloads)
Extension
Headers
IPv6
Header
UDP Header
(port=500)
ISAKMP
Header

284
Chapter 8 • IPv6 Security
identity protection.T his means that any eavesdropper that may have been capturing
this exchange would not be able to view the ISAK M P payload to determine the
identities of the communicating parties.T his is particularly effective when the
communicating IPSec nodes are gateways that may be negotiating SAs for mul-
tiple clients that reside behind them.
IK E Phase 1 Aggressive M ode
IK E Phase 1 Aggressive M ode, illustrated in Figure 8.6, can also be used to establish
the ﬁrst phase ISAK M P SA that will provide protection for the negotiation of
IPSec SAs; however, it uses a total of three packets instead of six.W ith aggressive
mode, the initiator includes as much information as it can in the ﬁrst packet,
including its SA proposals, key material, nonce, and ID.T he responder sends back
all the information that is necessary to complete the exchange, including the
selected SA, its own key material, its own nonce, its own ID, and any required
authentication data.W ith the last packet, the initiator conﬁrms that exchange by
including its own authentication data.As you can see, aggressive mode accomplishes
www.syngress.com
Figure 8.5 IKE Main Mode Exchange
UDP Header
(port=500)
Extension
Headers
Security
Association
Extension
Headers
IPv6
Header
UDP Header
(port=500)
IPv6
Header
ISAKMP
Header
Responder
ISAKMP
Header
Security
Association
UDP Header
(port=500)
Extension
Headers
IPv6
Header
ISAKMP
Header
Key Material
&
 Initiator Nonce
Key Material
&
 Responder Nonce
Extension
Headers
IPv6
Header
UDP Header
(port=500)
ISAKMP
Header
UDP Header
(port=500)
Extension
Headers
IPv6
Header
ISAKMP
Header
Responder
Authentication Data
(ID, Signature, Cert)
Extension
Headers
IPv6
Header
UDP Header
(port=500)
ISAKMP
Header
Initiator
Authentication Data
(ID, Signature, Cert)
= Encrypted
Initiator

IPv6 Security • Chapter 8
285
the ISAK M P SA negotiation, authentication, and key exchange much quicker than
main mode, which can be important if the IPSec nodes are under a heavy load.
H owever, unlike main mode, notice that none of the payloads of the packets in the
aggressive mode are encrypted.T his means that the identities are communicated in
the clear and any eavesdropper will be able to see who the communicating end
parties are.Aggressive mode does not provide identity protection.
T he choice of using main mode or aggressive mode will depend on your
requirements, but essentially comes down to a choice of security (identity protec-
tion) versus performance (speed).
IK E Phase 2 Q uick M ode
After negotiating and establishing the ISAK M P SA, the two IPSec nodes move
on to Phase 2 to negotiate IPSec SAs that will be used to apply the IPSec cryp-
tographic services to the appropriate trafﬁc.T here is only one mode for the
negotiation of IPSec SAs: quick mode.As illustrated in Figure 8.7, quick mode, like
aggressive mode, consists of a 3-packet exchange. U nlike aggressive mode, the
payloads of all the packets of a quick mode exchange are encrypted using the
ISAK M P SA established in Phase 1.
NOTE
The payloads of quick mode packets are encrypted using the ISAKMP SA
established in Phase 1 regardless of the mode (main mode or aggressive
mode) that was used in Phase 1.
www.syngress.com
Figure 8.6 IKE Aggressive Mode Exchange
SA, Key, Nonce, ID,
Signature, Cert
Extension
Headers
IPv6
Header
UDP Header
(port=500)
ISAKMP
Header
Initiator
Responder
UDP Header
(port=500)
Extension
Headers
IPv6
Header
ISAKMP
Header
Signature &
Cert
UDP Header
(port=500)
Extension
Headers
IPv6
Header
ISAKMP
Header
SA, Key, Nonce, ID

286
Chapter 8 • IPv6 Security
As mentioned earlier, an SA is unidirectional. Because a pair of SAs is required
for communication between a pair of nodes, the result of a successful quick mode
exchange is two SAs (one SA is used for outbound trafﬁc and the other SA is used
for inbound trafﬁc). In addition, quick mode is used to generate fresh keying
material for an SA (ISAK M P or IPSec) that is about to expire.T he key refresh can
be accomplished in two ways— with or without perfect forward secrecy (PFS).
W ithout PFS, the keys are refreshed using the existing keying material, but with
additional hashing; whereas with PFS, a new Difﬁe-H ellman exchange is per-
formed to generate brand new key material.Also, without PFS, if one session key
is compromised, subsequent session keys that are based on the same key material
can be compromised as well; PFS ensures that this does not occur, because the
new session keys are generated from completely new key material.
After a pair of IPSec SAs have been negotiated between two nodes, the
appropriate IPSec services (AH  and ESP) can be applied.
Applying Perimeter Security 
Access lists provide packet-ﬁltering capabilities for C isco routers by ﬁltering net-
work trafﬁc to determine whether routed packets can be forwarded or should be
blocked at the router interfaces.T hey can be used to control access to services on
the router itself and to ﬁlter trafﬁc passing through the router.T hey are an
important component in the secure conﬁguration of a router.Access lists contain
one or more rules and are applied to an interface on the router. In addition, you
can conﬁgure access lists to ﬁlter inbound trafﬁc, outbound trafﬁc, or both.T he
two basic types of access lists are standard and extended. Standard access lists can
www.syngress.com
Figure 8.7 IKE Phase 2 Quick Mode Exchange
Extension
Headers
IPv6
Header
UDP Header
(port=500)
ISAKMP
Header
Initiator
Responder
UDP Header
(port=500)
Extension
Headers
IPv6
Header
ISAKMP
Header
UDP Header
(port=500)
Extension
Headers
IPv6
Header
ISAKMP
Header
Hash3
Hash2, SA, Nonce,
Key, IDs
Hash1, SA, Nonce,
Key, IDs
= Encrypted using IKE SA

IPv6 Security • Chapter 8
287
ﬁlter based on only the source IP address within a packet. E xtended access lists can
ﬁlter based on other packet parameters, including source and destination IP
address, source and destination ports, and protocol. In addition, extended access
lists support logging.
C isco supports only standard access lists for IPv6 in the current release of IO S
(12.2), which represents Phase 1 of their roadmap to support IPv6. Extended
access lists will be supported in Phase 2 of their IPv6 roadmap.To conﬁgure stan-
dard access lists of IPv6, you need to perform the following tasks:
1.
Deﬁne the IPv6 standard access list.
2.
Apply the IPv6 standard access list to an interface.
3.
Verify the IPv6 standard access list conﬁguration.
Table 8.5 identiﬁes and describes the commands you can use to accomplish
these tasks.
Table 8.5 IPv6 Standard Access List Commands
Task
IOS Command
Description
1
ipv6 access-list 
Deﬁnes a standard IPv6 access list and sets 
access-list-name
deny or permit conditions for the access 
{permit |  deny} 
list.
{ source-ipv6-preﬁx/ 
The access-list-name argument speciﬁes 
preﬁx-length |  any} 
the name of the IPv6 access list. Access list 
{ destination-ipv6-preﬁx/ 
names cannot contain a space or quota-
preﬁx-length |  any} 
tion mark.
[priority value]
The deny keyword speciﬁes deny condi-
tions for the access list.
The permit keyword speciﬁes permit con-
ditions for the access list.
The source-ipv6-preﬁx/preﬁx-length and
destination-ipv6-preﬁx/preﬁx-length argu-
ments are mandatory. The preﬁx-length
argument indicates the number of consec-
utive, most-signiﬁcant bits that are used in
the match. A slash mark must precede the
decimal value.
The any keyword, when speciﬁed instead
of the source-ipv6-preﬁx/preﬁx-length or
destination-ipv6-preﬁx/preﬁx-length,
matches any preﬁx and is equivalent to the
IPv6 preﬁx ::/0.
www.syngress.com
Continued

288
Chapter 8 • IPv6 Security
The priority keyword speciﬁes the order in
which the statement is applied in the
access list. The acceptable range is from 1
to 4294967295.
2
interface interface-type 
Speciﬁes an interface type and number and 
interface-number
places the router in interface conﬁguration
mode.
3
ipv6 trafﬁc-ﬁlter
Applies the speciﬁed IPv6 access list to the 
access-list-name
interface speciﬁed in the previous step.
{in |  out}
The in keyword ﬁlters incoming IPv6 trafﬁc
on the speciﬁed interface.
The out keyword ﬁlters outgoing IPv6
trafﬁc on the speciﬁed interface.
4
show ipv6 access-list
Veriﬁes that the IPv6 standard access lists
are conﬁgured correctly.
T he following example conﬁgures the access list named list2 and applies the
access list to outbound trafﬁc on Ethernet interface 0. Speciﬁcally, the ﬁrst access
list entry keeps all packets from the network fec0:0:0:2::/ 64 (packets that have
the site-local preﬁx fec0:0:0:2 as the ﬁrst 64 bits of their source IPv6 address)
from exiting Ethernet interface 0.T he second entry in the access list permits all
other trafﬁc to exit Ethernet interface 0.T he second entry is necessary because
an implicit deny all condition is at the end of each IPv6 access list.
ipv6 access-list list2 deny fec0:0:0:2::/64 any
ipv6 access-list list2 permit any any
interface ethernet 0
ipv6 trafﬁc-ﬁlter dublin out
www.syngress.com
Table 8.5 Continued
Task
IOS Command
Description

IPv6 Security • Chapter 8
289
Summary
T hrough the inclusion of IP Security (IPSec) extension headers, security features
have been included in IPv6 that provide cryptographic security services at the
network layer.
W ithin IPv6, IPSec services are extension headers that can be included
within an IPv6 header. In either case, the IPSec services consist of two security
protocols: the Authentication H eader (AH ) and the Encapsulating Security
Payload (ESP).AH  is an extension header and protocol that uses a cryptographic
signature to provide both connectionless integrity and data origin authentication.
ESP is an extension header and protocol that can provide conﬁdentiality, data
origin authentication, connectionless integrity, replay protection, and limited
trafﬁc ﬂow conﬁdentiality.
Although the AH  and ESP protocols provide the actual cryptographic ser-
vices at the network layer, you still need mechanisms that will determine which
services should be applied to the different trafﬁc ﬂows, and to negotiate the
required cryptographic keys for those services.
T hese tasks are accomplished through a combination of mechanisms,
including the Security Policy Database (SPD), the Security Association (SA), and
the Internet Key Exchange (IK E) protocol.T he SPD identiﬁes the services to be
applied to IP packets, and is consulted in the processing of all trafﬁc (inbound
and outbound), including non-IPSec trafﬁc. It is an ordered list of policy entries
that are identiﬁed by “selectors,” which are roughly equivalent to the types of
information used by a trafﬁc-ﬁltering device. For any packet, the SPD will iden-
tify one of three options for processing: discard, bypass IPSec, or apply IPSec.
T he SA is a mechanism that IPSec uses to keep track of the details of a nego-
tiated IPSec session between two nodes. It solves the problem of tracking the
IK E agreements with respect to services, algorithms, and parameters for particular
trafﬁc ﬂows.
Internet K ey Exchange (IK E) is the mechanism that determines which ser-
vices should be applied to the different trafﬁc ﬂows, and to negotiate the required
cryptographic keys for those services. It is the glue the binds the IPSec building
blocks together. IK E has two phases. Phase 1 is used to establish a secure channel
(ISAK AM P SA) through which IPSec cryptographic services and algorithms can
be negotiated. Phase 2 is the actual negotiation of the IPSec cryptographic ser-
vices and algorithms through the secure channel established in Phase 1.
www.syngress.com

290
Chapter 8 • IPv6 Security
Solutions Fast Track
IPSec O verview
 Security risks speciﬁc to IP include data theft, data tampering, and peer
impersonation.
 Security features included in IPv6 via IP Security (IPSec) extension
headers provide authentication, integrity, conﬁdentiality, and access
control.
 IPSec is a standard deﬁned by a suite of Internet Engineering Task Force
(IET F) R equests for C omments (R FC s) that can be implemented in
both IPv4 and IPv6.
U nderstanding the Building Blocks of IPSec
 IPSec services are extension headers that can be included within an IPv6
header.T he services consist of two security protocols: the Authentication
H eader (AH ) and the Encapsulating Security Payload (ESP).
 AH  is an extension header and protocol that uses a cryptographic
signature to provide both connectionless integrity and data origin
authentication.You should use AH  when it’s important to be certain that
you are communicating with correct node and when you want to
ensure that data is not modiﬁed in transit.
 ESP is an extension header and protocol that can provide conﬁdentiality,
data origin authentication, connectionless integrity, replay protection,
and limited trafﬁc ﬂow conﬁdentiality.
 Both AH  and ESP support two modes of use: transport mode and tunnel
mode. In transport mode, the selected protocol (AH  or ESP) provides
protection primarily for upper layer protocols, and its extension header is
created and inserted as part of the original IPv6 header. H owever, in
tunnel mode, the extension header is created and inserted as part of a
new IPv6 header that encapsulates the entire original packet as the
payload.
 Because IPSec is intended to provide network layer security services, it
can be implemented on end hosts and devices.
www.syngress.com

IPv6 Security • Chapter 8
291
 W ithin IPsec there are two primary methods of authenticating peers in
which authentication information is exchanged between the peers out
of band: pre-shared keys and certiﬁcates.W ith pre-shared keys, two or
more peers securely exchange (pre-share) a secret key prior to any IPSec
negotiation— the process is simple and inexpensive but does not scale
well. C ertiﬁcates scale well but are typically more complex to
implement.
C ombining IPSec’s C ryptographic M echanisms
 T he Security Policy Database (SPD) identiﬁes the services to be applied
to IP packets and is consulted in the processing of all trafﬁc. For any
packet, the SPD will identify one of three options for processing: discard,
bypass IPSec, or apply IPSec.
 T he SA is a mechanism that IPSec uses to keep track of the details of a
negotiated IPSec session between two nodes.A pair of SAs is required
for communication between a pair of nodes.An SA is uniquely
identiﬁed by a destination IP address, a security protocol identiﬁer (AH
or ESP), and a Security Parameter Index (SPI).
 Internet K ey Exchange (IK E) is the mechanism that determines which
services should be applied to the different trafﬁc ﬂows and negotiates the
required cryptographic keys for those services. IK E has two phases. Phase
1 is used to establish a secure channel (ISAK AM P SA) through which
IPSec cryptographic services and algorithms can be negotiated. Phase 2
is the actual negotiation of the IPSec cryptographic services and
algorithms through the secure channel established in Phase 1.
 W ithin IK E Phase 1, two possible modes can be used to establish the
ISAK M P SA: main mode and aggressive mode. M ain M ode consists of
three exchanges between the initiator and the responder for a total of six
packets exchanged. Because this data is encrypted, main mode provides
what is called identity protection.Aggressive M ode can also be used to
establish the ISAK M P SA; however, it uses a total of three packets
instead of six.Aggressive mode does not provide identity protection.
www.syngress.com

292
Chapter 8 • IPv6 Security
Applying Perimeter Security
 Access lists are an important component in the secure conﬁguration of a
router.T hey provide packet ﬁltering capabilities for C isco routers,
controlling access to services on the router itself, and ﬁltering trafﬁc
passing through the router.
 Standard access lists can ﬁlter based on only the source IP address within
a packet. Extended access lists can ﬁlter based on other packet
parameters, including source and destination IP address, source and
destination ports, and protocol. In addition, extended access lists support
logging.
Q: H ow is IPSec different in IPv6 from IPv4?
A: T here are no differences or changes in IPSec from IPv4 to IPv6.T he IPSec
services and mechanisms, including AH , ESP, and IK E, are the same.W hat is
different is how IPSec is referenced with the IP header.W ithin IPv4, IPSec
services are just another “upper layer” protocol that can be speciﬁed within
the Protocol ﬁeld of the IPv4 header.W ithin IPv6, IPSec services are exten-
sion headers that can be included within an IPv6 header. In either case, the
IPSec services are the same.
Q: H ow is IPSec used to implement IPv4 virtual private networks (VPN s)?
A: IPSec is commonly used today in IPv4 to create virtual private networks
(VPN s), which provide you with the means to communicate over a public
network while maintaining the privacy of the communications. IPv4 IPSec
VPN s are typically created using gateways that are effectively “bumps in the
wire” and utilize at least ESP to provide the necessary privacy.T hey may or
may not utilize AH .Tunnel mode is used to encapsulate and provide services
to the entire IPv4 packet.
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

IPv6 Security • Chapter 8
293
Q: H ow do I conﬁgure IPSec for IPv6 in C isco IO S?
A: According to the C isco Statement of Direction (SO D) for IPv6, IPSec will
not be supported for IPv6 until Phase 3, which is scheduled for later in 2002.
W ithin IPv4, you conﬁgure IPSec using access lists that specify the trafﬁc to
which IPSec services should be applied.T hese crypto access lists are then
bundled with relevant IPSec parameters through something called a crypto
map, which is then applied to the appropriate interface. For a complete
description of how to conﬁgure IPSec for IPv4, visit the following link:
www.cisco.com/ univercd/ cc/ td/ doc/ product/ software/ ios122/ 122cgcr/
fsecur_c/ ﬁpsenc/ index.htm.
Q: Should I use tunnel mode or transport mode?
A: T he use of tunnel mode or transport mode depends on a few factors, the ﬁrst
of which is whether either of the nodes involved is acting as a security
gateway. If so, the IPSec R FC s require that tunnel mode be used. In addition,
when you consider that gateways are typically used to create a VPN  between
multiple hosts, this makes sense. If one of the nodes is not acting as a security
gateway, then you must identify the threat(s) that you are attempting to pro-
tect against in light of the protections offered by tunnel mode and transport
mode.W ith tunnel mode, the IPSec services provide protection to the entire
IP header.W ith transport mode, the IPSec services provide protection pri-
marily to the upper layer protocols.
Q: Should I use pre-shared keys or certiﬁcates?
A: Pre-shared keys provide a quick and easy way to implement authentication
and can be leveraged for a relatively small and simple IPSec implementation.
W hile more complex, the use of certiﬁcates for authentication provides a
more scalable solution for a larger or more complex IPSec implementation. If
your IPSec implementation will consist of a small number of nodes in a star
conﬁguration (where a central node communicates to the rest of the nodes),
then the use of pre-shared keys will help you jumpstart the implementation.
If your IPSec implementation will consist of more than a small number of
nodes, or will have a high degree of meshing (where many of the nodes com-
municate among themselves), then the use of certiﬁcates will provide a more
scalable and manageable solution.
www.syngress.com


Monitoring and
Troubleshooting
IPv6 Networks
Solutions in this chapter:
■
Using show Commands
■
Using debug Commands
■
Analyzing IPv6 Trafﬁc
Chapter 9
295
 Summary
 Solutions Fast Track
 Frequently Asked Questions

296
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
Introduction
A good network administrator is one who can effectively troubleshoot and diag-
nose network problems. O ne key skill for a network administrator is the ability to
use the tools necessary to diagnose problems on the C isco IO S.T hese tools con-
sist of two main commands, show and debug.T he information that can be ascer-
tained using these commands can be used to help troubleshoot nearly all network
issues.T his chapter will list and explain the various show and debug commands
necessary to troubleshoot an Internet Protocol Version 6 (IPv6) network running
C isco routers.
Another key skill of a network administrator is the ability to analyze protocol
trafﬁc traversing the network. H aving a solid understanding of the protocol oper-
ations enables the administrator to discern the necessary information used to
solve any network issue.T his chapter will discuss IPv6 trafﬁc and analyze speciﬁc
trafﬁc patterns.T his information can be used as a template to troubleshoot IPv6
network problems.
Using show Commands
C isco IO S 12.0(21)ST  and 12.2(2)T  introduced many new show commands for
revealing information about the conﬁguration of IPv6 in your C isco network.
T his section will detail the new show commands used with the IPv6 protocol for
gathering information on basic and BGP conﬁgurations.
Using Basic show Commands
T he show ipv6 interface command will be your most frequently used command. It
displays the usability status of interfaces conﬁgured for IPv6 and you can run it in
the privileged EX EC  mode or user EX EC  mode.T his command is the ﬁrst step
in determining the current status of the interface; you can often use it to deter-
mine how to proceed with troubleshooting interface/ communication problems.
You typically use this command when you are unable to ‘ping’ a remote interface
or are experiencing some other connectivity related issue. It provides you with
the ﬁrst look at whether the problem may be related to the Layer 2 or Layer 3
portion of the IPv6 connection, which will be explained in more detail later in
this chapter.T he full command syntax is as follows:
show ipv6 interface [brief] [interface-type interface-number].
www.syngress.com

www.syngress.com
6Router-1#show ipv6 interface serial0
Serial0 is up, line protocol is up
# denotes the status of the interface
IPv6 is enabled, link-local address is FE80::2E0:B0FF:FE5A:D998
# displays the status of the IPv6 on the interface and the
# link--local address assigned
Global unicast address(es):
2001::1000:1000:1, subnet is 2001::/64  Joined group address(es):
# shows the multicast groups this interface belongs to
FF02::1
FF02::2
FF02::1:FF00:1
FF02::1:FF5A:D998
MTU is 1500 bytes
ICMP error messages limited to one every 500 milliseconds 
# frequency of ICMP messages
ICMP redirects are enabled
ND DAD is enabled, number of DAD attempts: 1
# neighbor discovery status
ND reachable time is 30000 milliseconds
Hosts use stateless autoconﬁg for addresses.
T he ﬁrst and most important line to review when trying to determine an
IPv6 connectivity problem is the status of the interface.T he interface can be in
one of three states commonly referred to as up/ up, up/ down, or down/ down,
denoting the status of the Layer 2 and Layer 3 connection respectively.An up/ up
interface indicates that you are communicating with the interface hardware
and/ or the local C SU / DSU  and that the Layer 3 communication, in this case
IPv6, is communicating with the same Layer 3 protocol on the other side of the
link, the neighbor.An interface displaying an up/ down status, also referred to as
line protocol down, indicates that the local device is not communicating with the
neighbor across the conﬁgured Layer 3 protocol (IPv6).T his problem could be
the result of an incorrect IP address or subnet mask on the local or remote
device, a disabled neighbor interface, a failed local or remote C SU / DSU, equip-
ment timing, or keepalive problem.An interface displaying down/ down, also
referred to as interface down, indicates faulty local hardware or cabling. In sum-
mary, this output helps determine if you should be chasing a physical or logical
Monitoring and Troubleshooting IPv6 Networks • Chapter 9
297

298
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
problem. Logical problems are usually indicated with up/ down and physical
problems are often indicated with down/ down.An interface can also be adminis-
tratively down, which indicates that an administrator has disabled the interfaces.
T he IPv6 interface status is derived through the use of duplicate address
detection (DAD). DAD is the process of how a node determines that an address it
wishes to use is not already in use by another node. If duplicate address detection
has identiﬁed the link-local address of the interface as being a duplicate address,
the processing of IPv6 packets is disabled on the interface and the interface is
marked “stalled.” If IPv6 is not enabled, the interface is marked “disabled.”
During the duplicate address detection process, the interface may also display
DU PLIC AT E,T EN TAT IVE, or O K .T he T EN TAT IVE status informs you that
the duplicate address detection process is in progress.T he other states are self-
explanatory.T he assigned link-local address is used for neighbor discovery and the
stateless auto-conﬁguration process and its preﬁx is FE80 with the remainder of
the address derived from the interface identiﬁer in modiﬁed EU I-64 format.
T he joined group addresses list the multicast groups to which this interface
belongs.T he IC M P error messages line indicates IC M P messages are periodically
sent every 500 milliseconds (default) and the rate can be modiﬁed using the ipv6
icmp error-interval command, which can ultimately reduce link-layer congestion.
N D DAD indicates that the N eighbor Discovery Duplicate Address
Detection is enabled.T he number of DAD attempts indicates the number of
N eighbor Solicitation messages that were sent while the duplicate address detec-
tion process was being performed.
You can use the show ipv6 interface brief command to display a summary of the
status of each IPv6-conﬁgured interface on the router.T he command displays
only the interface name, its status [up/ down], and the assigned IPv6 address, just
as it did for the IPv4 version of this command.
You use the show ipv6 route command to display the routing table and to
determine the next hop corresponding to the connected network.You execute
the command from the U ser EX EC  or Privileged EX EC  modes.You should use
this command to troubleshoot a communication problem with a destination
device. P ing ipv6 and traceroute ipv6 are great commands to use in addition to the
show ipv6 route command to pinpoint the source of the trafﬁc loss.You should use
the ping ipv6 [destination address] command ﬁrst during troubleshooting to deter-
mine if the destination device is accessible. If the ping fails, then use traceroute ipv6
[destination address] to determine where in the path to the destination device the
connection problem may reside.T he traceroute output will give you the last hop
that answered the IC M P ping and should be your next focus of attention in
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
299
troubleshooting the connectivity problem.T he full command syntax for show ipv6
route command is as follows:
show ipv6 route [ipv6-address | ipv6-preﬁx/preﬁx-length | protocol].
6Router-1
#show ipv6 route
IPv6 Routing Table - 9 entries
Codes: C - Connected, L - Local, S - Static, R - RIP, B - BGP
I1 - ISIS L1, I2 - ISIS L2, IA - ISIS interarea 
# legend of possible protocol types that may be displayed below
Timers: Uptime/Expires
L   2000:1:1::1/128 [0/0]
via ::, Serial0, 20:45:43/never  
# neighboring network information
C   2000:1:1::/64 [0/0]
via ::, Serial0, 20:45:46/never  
L   2000:1:2::1/128 [0/0]
via ::, Ethernet0, 20:46:12/never
C   2000:1:2::/64 [0/0]
via ::, Ethernet0, 20:46:13/never
B   2000:1:3::/64 [20/1]
via 2000:1:1::2, Serial0, 20:45:37/never
L   3FFE:4200:1:1::1/128 [0/0]
via ::, Ethernet0, 1d19h/never
C   3FFE:4200:1:1::/64 [0/0]
via ::, Ethernet0, 1d19h/never
L   FE80::/10 [0/0]
via ::, Null0, 1w5d/never
L   FF00::/8 [0/0]
via ::, Null0, 1w5d/never
T he output of this command displays the routing protocol (if any) that the
route is using, the preﬁx of the remote network [2000:1:1::1/ 128], the adminis-
trative distance and metric for the link [0/ 0], as well as the interface to forward
packets through [Serial0].T he output also indicates the last time the route was
www.syngress.com

300
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
updated and when the route expires [20:45:43/ never] (local and connected routes
never expire).
T he show ipv6 route command enables you to specify the IPv6 address/
network and preﬁx and/ or the protocol type to enable more granularity in the
output.T he full command syntax is listed here:
show ipv6 route [ipv6-address | ipv6-preﬁx/preﬁx-length | protocol] 
You can use the show ipv6 route summary command to display the number of
routes per route source and each preﬁx length.T his command lists the total
number of entries in the IPv6 routing table and provides a quick look at the total
number of locally connected, directly connected, statically mapped, and dynami-
cally derived networks as well as a summary of the total number of routing table
entries per given preﬁx length.
6Router-1#show ipv6 route summary
IPv6 Routing Table Summary - 9 entries
# total routing table entries
5 local, 3 connected, 0 static, 0 RIP, 1 BGP 0 IS-IS
# route source
Number of preﬁxes:
/8: 1, /10: 1, /64: 4, /128: 3
# number of accessible networks by preﬁx
T he show ipv6 neighbors command displays the contents of the neighbor dis-
covery cache constructed through the exchange of R outer Solicitation/
Advertisement, N eighbor Solicitation/ Advertisement, and R edirect IC M P mes-
sages.T he command can be executed from the Privileged EX EC  or U ser EX EC
modes.T his command is useful in determining which if any neighbors are inac-
cessible, and, if accessible, the last time the neighbor was contacted.T his com-
mand is useful in troubleshooting connectivity with neighboring devices.T he full
command syntax is as follows:
show ipv6 neighbors [interface-type interface-number | ipv6-address]
6Router-1#show ipv6 neighbors
IPv6 Address                         Age Link-layer Addr State Interface
2000:1:2::10                           - 0000.1234.5678  REACH Ethernet0
# list of each IPv6 neighbor
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
301
T he command output displays the neighbor’s IPv6 address [2000:1:2::10], the
last time the neighbor was conﬁrmed to be reachable (a hyphen (-) indicates a
static entry), the link-layer [M AC ] address of the neighbor, the state of the
neighbor cache entry and the interface the neighbor can be reached through.
Table 9.1 lists the various neighbor communication states.T he listed states apply
only to non-static neighbor cache entries.
Table 9.1 Neighbor Cache Entry States
Neighbor Cache Entry
Deﬁnition
INCMP – Incomplete
Neighbor resolution has not been completed. The
Neighbor Solicitation ICMP message has been sent
but the Neighbor Advertisement message has not
yet been received.
REACH – Reachable
The neighbor has been conﬁrmed as reachable
within the last ReachableTime (default 30000 ms).
The ReachableTIme is displayed in the show IPv6
interface output.
STALE
The neighbor has not been successfully contacted
within the ReachableTime setting. No action is
taken until a packet is sent.
DELAY
The DELAY state follows the STALE state and indi-
cates a packet was sent within the last
DELAY_FIRST_PROBE_TIME. If a conﬁrmation is not
received, the state will change to the PROBE state
and send Neighbor Solicitation message.
PROBE
Neighbor Solicitation messages will continue to be
sent at an interval speciﬁed by the neighbor dis-
covery-related variable RetransTimer (RFC 2461,
Neighbor Discovery for IP Version 6 [IPv6]), until
reachability is conﬁrmed. The RetransTimer interval
is speciﬁed in milliseconds.
????
The neighbor is in an unknown state.
U se the show ipv6 protocols command to display the IPv6 protocols conﬁgured
on the router.T his command displays an at-a-glance summary providing infor-
mation such as the conﬁgured route redistribution, the IPv6 neighbors, and the
routing protocol conﬁgured on each interface.T he command is useful for getting
a snapshot of the routing conﬁguration and can be used as a roadmap for deter-
mining the additional commands that would be useful in troubleshooting 
www.syngress.com

302
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
connectivity or routing problems. For example, the output from this command
tells you there are directly connected, statically mapped, and BGP-derived net-
works accessible from this router and that route redistribution has been conﬁg-
ured. It also tells you that the R IP routing protocol is conﬁgured on the Serial0
and Ethernet0 interfaces and that R IP is being redistributed.
6Router-1#show ipv6 protocols
IPv6 Routing Protocol is "connected"
IPv6 Routing Protocol is "static"
IPv6 Routing Protocol is "bgp 64999"
# the BGP network conﬁgured on this router
IGP synchronization is disabled
Redistribution:
None
Neighbor(s):
Address                 FiltIn FiltOut Weight RoutemapIn RoutemapOut
2000:1:1::2
IPv6 Routing Protocol is "rip cisco"
# RIP is conﬁgured on the Serial0 and Ehternet0 interfaces
Interfaces:
Serial0
Ethernet0
Redistribution:
Redistributing protocol rip cisco
# RIP is being reditributed
T he show ipv6 protocols command will also display if neighbor route maps or
AS-ﬁlter lists have been applied to each of the interfaces. If an AS-ﬁlter list has
been applied, then the neighbor weight value will also be displayed.T he FiltIn,
FiltO ut, and Weight columns are applicable only to BGP-conﬁgured interfaces.
You can also add the summary keyword at the end of the command to display
each conﬁgured protocol, as shown here:
6Router-1#show ipv6 protocols summary
Index Process Name
0     connected
1     static
5     bgp 64999
6     rip cisco
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
303
T he show ipv6 trafﬁc command provides statistics for IPv6, IC M P, and U DP
packets that have been received by or originated from the IPv6-conﬁgured
router.T his command is useful for determining if the IPv6 packets contain errors.
In addition, you can determine the overhead incurred from IC M P trafﬁc and
whether any IC M Pv6 parameters should be tuned to decrease overhead.
6Router-1#show ipv6 trafﬁc
IPv6 statistics:
Rcvd:  17489 total, 14367 local destination
# total number of IPv6 packets received by this router
0 format errors, 0 hop count exceeded
0 bad header, 0 unknown option, 0 bad source
0 unknown protocol, 0 not a router
0 fragments, 0 total reassembled
0 reassembly timeouts, 0 reassembly failures
Sent:  67630 generated, 0 forwarded
# total number od IPv6 packets sent from this router
0 fragmented into 0 fragments
1 encapsulation failed, 3122 no route, 0 too big
Mcast: 0 received, 0 sent
ICMP statistics:
Rcvd: 61 input, 0 checksum errors, 0 too short
# total number of IPv6 ICMP packets reeived by this router
0 unknown info type, 0 unknown error type
unreach: 0 routing, 0 admin, 0 neighbor, 0 address, 0 port
parameter: 0 error, 0 header, 0 option
0 hopcount expired, 0 reassembly timeout, 0 too big
25 echo request, 25 echo reply
# total number of ping request/replies to this router
0 group query, 0 group report, 0 group reduce
0 router solicit, 0 router advert, 0 redirects
2 neighbor solicit, 9 neighbor advert
# neigbor discovery statistics
Sent: 6000 output, 0 rate-limited
# total number of ICMP packets sent by this router
unreach: 0 routing, 0 admin, 0 neighbor, 0 address, 0 port
www.syngress.com

304
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
parameter: 0 error, 0 header, 0 option
0 hopcount expired, 0 reassembly timeout,0 too big
30 echo request, 25 echo reply
# total number of ping request/replies from this router
0 group query, 0 group report, 0 group reduce
0 router solicit, 5880 router advert, 0 redirects
# number of router advertisements sent by this router
32 neighbor solicit, 33 neighbor advert
# ICMP neighbor advertisements and solicitations 
# used in neighbor discovery sent by this router
UDP statistics:
Rcvd: 9089 input, 0 checksum errors, 0 length errors
0 no port, 0 dropped
Sent: 56804 output
Using the show bgp Commands
Various commands that assist in viewing and troubleshooting Border Gateway
Protocol (BGP) are included in the C isco IO S versions supporting IPv6.T he
show bgp commands are useful in situations where you are connected to an ISP
that requires the use of BGP or to other sites using BGP for routing decisions.
T he show bgp ipv6 command displays the BGP table version, the next hop
address to reach the listed network along with the metric, a local preference (if
conﬁgured), weight, and AS path.T his command is a ﬁrst step in determining the
health and conﬁguration of BGP on your router and can be used to determine
how to proceed with troubleshooting.T he full command syntax is as follows:
show bgp ipv6 [ipv6-preﬁx/preﬁx-length] [longer-preﬁxes]
6Router-1#show bgp ipv6
BGP table version is 13, local router ID is 172.16.0.1
# the BGP table version number and IP address used as the router ID
Status codes: s suppressed, d damped, h history, * valid, > best, i -
internal,r RIB-failure
Origin codes: i - IGP, e - EGP, ? – incomplete
# indicates the origin of the entry
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
305
Network          Next Hop            Metric LocPrf Weight Path
*  2000:1:1::/64    2000:1:1::2                            0 65000 i
# the accessible BGP networks and the next hop address to reach them
*>                  ::                                 32768 I
# the :: indicates the router has non-BGP routes to this network
*> 2000:1:2::/64    ::                                 32768 i
*> 2000:1:3::/64    2000:1:1::2                            0 65000 i
T he show bgp ipv6 command output contains similar information as the show
ipv6 route command but displays only BGP routing information.
T he show bgp ipv6 summary command provides an overview of the BGP con-
ﬁguration on the router.T he command displays the local identiﬁer, taken from
the lowest IP address, as well as the BGP table version and the router memory
used by the individual BGP entries.
6Router-1#show bgp ipv6 summary
BGP router identiﬁer 172.16.0.1, local AS number 64999
# the BGP router ID and AS assigned to this router
BGP table version is 13, main routing table version 13
3 network entries and 4 paths using 659 bytes of memory
# memory used by the BGP routing protocol
2 BGP path attribute entries using 120 bytes of memory
1 BGP AS-PATH entries using 24 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP ﬁlter-list cache entries using 0 bytes of memory
BGP activity 10/41 preﬁxes, 14/10 paths, scan interval 60 secs
Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down
State/PfxRcd
2000:1:1::2     4 65000    4293    4300       13    0    0 1d22h       2
T he last section of output from the show bgp ipv6 summary command displays
the neighbor address, the BGP version number spoken to that neighbor, the
autonomous system, the number of BGP messages received/ sent by/ from this
neighbor, the BGP table version, the number of BGP messages waiting to be sent
or processed by this router, as well as the length of time the BGP session has
been ESTABLISH ED/ not ESTABLISH ED.T his output is useful in determining
the health and reliability of the BGP session.
www.syngress.com

306
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
T he show bgp ipv6 neighbors command is useful for determining the status of
the BGP neighbor communications.You should use it when troubleshooting
BGP connectivity or routing problems.T his command provides BGP information
on all IPv6 neighbors.You can add an address of an IPv6 BGP neighbor to this
command to restrict the output to a single IPv6 BGP neighbor.You can further
target the output from this command by adding any of the optional parameters
contained in [ ].T he full syntax for the command is as follows:
show bgp ipv6 neighbors [ipv6-address] [received-routes | routes |
ﬂap-statistics | advertised-routes | paths regular-expression |
dampened-routes].
T he section of the output to pay particular attention to is the current BGP
state and how long the peer connection has been established.T he “BGP state =
Established” line in the output tells you that the BGP neighbors have established
a T C P connection and have agreed to communicate via the BGP protocol.
6Router-1#show bgp ipv6 neighbors
BGP neighbor is 2000:1:1::2,  remote AS 65000, external link
# the BGP neighbors address and AS number
Member of peer-group cisco for session parameters
# update policy peer group this router belongs to
BGP version 4, remote router ID 172.16.8.33
BGP state = Established, up for 00:51:16
# current state of the BGP session and how long the 
# underlying TCP connection has been established
Last read 00:00:16, hold time is 180, keepalive interval is 60 seconds
# BGP conﬁguration settings
Neighbor capabilities:
# the BGP capabilities advertised and received from this neighbor
Route refresh: advertised and received(old & new)
Address family IPv6 Unicast: advertised and received
Received 1528 messages, 0 notiﬁcations, 0 in queue
# IPv6 unicast-speciﬁc properties of this neighbor
Sent 1535 messages, 1 notiﬁcations, 0 in queue
Default minimum time between advertisement runs is 30 seconds
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
307
For address family: IPv6 Unicast
BGP table version 13, neighbor version
13
# conﬁrms router and neighbor are using the same BGP routing table
Index 1, Offset 0, Mask 0x2
cisco peer-group member
Route refresh request: received 0, sent 0
2 accepted preﬁxes consume 136 bytes
Preﬁx advertised 11, suppressed 0, withdrawn 1
Connections established 4; dropped 2
# number of times the peers have agreed to speak BGP
# and the how often a good connection has failed or been taken down
Last reset 22:53:50, due to BGP Notiﬁcation sent, hold time expired
Connection state is ESTAB, I/O status: 1, unread input bytes: 0
Local host: 2000:1:1::1, Local port: 179
# peering address of the local router
Foreign host: 2000:1:1::2, Foreign port: 11631
# peering address of the
neighbor
Enqueued packets for retransmit: 0, input: 0  mis-ordered: 0 (0 bytes)
Event Timers (current time is 0x3D6B4AF8):
Timer          Starts    Wakeups            Next
Retrans            58          2             0x0
TimeWait            0          0             0x0
AckHold            55         26             0x0
SendWnd             0          0             0x0
KeepAlive           0          0             0x0
GiveUp              0          0             0x0
PmtuAger            0          0             0x0
DeadWait            0          0             0x0
iss: 2268213783  snduna: 2268215016  sndnxt: 2268215016     sndwnd:  15152
irs:  840903895  rcvnxt:  840905059  rcvwnd:      15221  delrcvwnd:   1163
SRTT: 302 ms, RTTO: 323 ms, RTV: 21 ms, KRTT: 0 ms
minRTT: 4 ms, maxRTT: 424 ms, ACK hold: 200 ms
www.syngress.com

308
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
Flags: passive open, nagle, gen tcbs
Datagrams (max data segment is 1440 bytes):
Rcvd: 84 (out of order: 0), with data: 55, total data bytes: 1163
Sent: 82 (retransmit: 2, fastretransmit: 0), with data: 82, total data
bytes: 45
20
As you can see, the output from the show bgp ipv6 neighbors command is quite
verbose.Additional study of the BGP protocol is required to make good use of
the command output. If your network is running BGP and IPv6, you will use the
preceding commands the most frequently in your day-to-day troubleshooting.
Using debug Commands
You use debug commands to assist with network troubleshooting.You should take
care when executing debug commands, because they add overhead to the router.
D ebug commands read each complete packet rather than just the header, which
can put enormous demands on the router’s processor and memory.You should
make debug commands as speciﬁc as possible to minimize the load placed on the
router resources. Improperly used debug commands can cause the router to
become inaccessible, requiring a potential local router restart (power on/ off) to
regain command-line access, which can be quite detrimental when support per-
sonnel cannot easily access the router.T his section will discuss and display the
results of various debug commands that can assist you with resolving IPv6 prob-
lems or verifying IPv6 trafﬁc.T his section covers general commands and BGP-
related commands.
H ere are some debug commands that you can use to help verify IPv6 trafﬁc or
troubleshoot IPv6 communication and neighbor relationship problems.
T he debug ipv6 packet command displays information on the IPv6 packets
received, generated, and forwarded on this router. Fast-switched packets do not
generate messages.T he debug ipv6 packet command will create substantial over-
head on the router and should only be used when trafﬁc levels are very low.
T he output displays the source and destination address, the contents of the
trafﬁc class ﬁeld, and whether the packet was forwarded to an upper-layer pro-
tocol or was originated from the router.
6Router-1#debug ipv6 packet
IPv6 unicast packet debugging is on
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
309
6Router-1#
1w6d: IPV6: source 2000:1:1::2 (Serial0)
# the source address in the IPv6 header
1w6d:       dest 2000:1:1::1
# the destination address in the IPv6 header
1w6d:       trafﬁc class 192, ﬂow 0x0, len 79+4, prot 6, hops 64, forward 
to ulp   #the contents of the trafﬁc class, ﬂow, length, 
protocol, and hops ﬁelds
1w6d: IPV6: source 2000:1:1::1 (local)
1w6d:       dest 2000:1:1::2 (Serial0)
1w6d:       trafﬁc class 192, ﬂow 0x0, len 60+0, prot 6, hops 64, 
originating
#indicates this packet originated from this router
…
1w6d: IPV6: source FE80::2E0:B0FF:FE5A:D998 (local)
1w6d:       dest FF02::9 (Serial0)
1w6d:       trafﬁc class 224, ﬂow 0x0, len 112+1388, prot 17, hops 255, 
originating
1w6d: IPv6: Sending on Serial0
1w6d: IPV6: source FE80::2E0:B0FF:FE5A:D998 (local)
1w6d:       dest FF02::9 (Ethernet0)
1w6d:       trafﬁc class 224, ﬂow 0x0, len 112+1388, prot 17, hops 255, 
originating
1w6d: IPv6: Sending on Ethernet0
1w6d: IPV6: source FE80::2E0:B0FF:FE5A:D998 (local)
1w6d:       dest FF02::9 (Serial0)
1w6d:       trafﬁc class 224, ﬂow 0x0, len 112+1388, prot 17, hops 255, 
originating
1w6d: IPv6: Sending on Serial0
1w6d: IPV6: source FE80::2E0:B0FF:FE5A:D998 (local)
1w6d:       dest FF02::9 (Ethernet0)
1w6d:       trafﬁc class 224, ﬂow 0x0, len 112+1388, prot 17, hops 255, 
originating
1w6d: IPv6: Sending on Ethernet0
1w6d: IPV6: source 2000:1:1::2 (Serial0)
1w6d:       dest 2000:1:1::1
1w6d:       trafﬁc class 192, ﬂow 0x0, len 79+4, prot 6, hops 64, forward 
to ulp
# indicates this was received by the router and forwarded 
www.syngress.com

310
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
# to an upper-layer protocol
1w6d: IPV6: source 2000:1:1::1 (local)
1w6d:       dest 2000:1:1::2 (Serial0)
1w6d:       trafﬁc class 192, ﬂow 0x0, len 60+12, prot 6, hops 64,
originating
T he debug ipv6 icmp command is useful for troubleshooting IC M P communi-
cation on the router.T he neighbor discovery process, M T U  determination, and
M ulticast Listener Discovery (M LD) all use IC M P, although a separate debug
command exists for troubleshooting the neighbor discovery process, which we
will discuss next.T he following trace is simply the ping command to give you an
idea of the output generated from the debug ipv6 icmp command— notice the
echo request and echo reply process used with the ping command.
6Router-1#debug ipv6 icmp
ICMP packet debugging is on
6Router-1#ping ipv6 2000:1:1::2
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 2000:1:1::2, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 8/10/12 ms
6Router-1#
1w6d: ICMPv6: Sending echo request to 2000:1:1::2
# indictaes ICMPv6 packet has been sent
1w6d: ICMPv6: Received ICMPv6 packet from 2000:1:1::2, type 129
# ICMPv6 packet received, type 129 = echo reply
1w6d: ICMPv6: Received echo reply from 2000:1:1::2
T he debug ipv6 nd command is useful for troubleshooting the neighbor dis-
covery process where adjacencies are attained by passing IC M Pv6 packets
between routers to establish neighbor adjacencies.T he following output displays a
router advertisement (R A) message sent from the Ethernet0 interface to the two
conﬁgured preﬁxes on the Ethernet0 interface:
6Router-1#debug ipv6 nd
ICMP Neighbor Discovery events debugging is on
6Router-1#
2w0d: ICMPv6-ND: Sending RA to FF02::1 on Ethernet0
# indicates a router advertisement is being sent to
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
311
# all-nodes multicast group
2w0d: ICMPv6-ND:     preﬁx = 3FFE:4200:1:1::1/64 onlink autoconﬁg
2w0d: ICMPv6-ND:     preﬁx = 2000:1:2::1/64 onlink autoconﬁg
# indicates the type of autoconﬁguration
T he following debug output shows a more complete communication ﬂow.
R eviewing the ﬂow will show you that the N eighbor Solicitation (N S) and
N eighbor Advertisement (N A) are being passed between the FastEthernet0/ 0
interface and a neighbor at 2000:0:0:3::2.Also visible from the output is the
Duplicate Address Detection (DAD) and its conﬁrmation that the interfaces
address is unique.
13:22:40:ICMPv6-ND:STALE -> DELAY:2000:0:0:3::2
# indicates ND cache entry used to be reachable but is now stale, 
# reachability needs to be conﬁrmed
13:22:45:ICMPv6-ND:DELAY -> PROBE:2000:0:0:3::2 
# indicates reachability being conﬁrmed
13:22:45:ICMPv6-ND:Sending NS for 2000:0:0:3::2 on FastEthernet0/0 
# sending neighbor solicitation
13:22:45:ICMPv6-ND:Received NA for 2000:0:0:3::2 on FastEthernet0/0 from
2000:0:0:3::2
# receiving neighbor advertisement conﬁrming reachability
13:22:45:ICMPv6-ND:PROBE -> REACH:2000:0:0:3::2
# entry ﬂagged as reachable
13:22:45:ICMPv6-ND:Received NS for 2000:0:0:3::1 on FastEthernet0/0 from 
FE80::203:A0FF:FED6:1400
# received neighbor solicitation to determine link-local address
13:22:45:ICMPv6-ND:Sending NA for 2000:0:0:3::1 on FastEthernet0/0 
# sending neighbor advertisement in response to previous NS
13:23:15: ICMPv6-ND: Sending NS for FE80::1 on Ethernet0/1
13:23:16: ICMPv6-ND: DAD: FE80::1 is unique.
# duplicate address detection was performed and address is unique
13:23:16: ICMPv6-ND: Sending NS for 2000::2 on Ethernet0/1
13:23:16: ICMPv6-ND: Sending NS for 3000::3 on Ethernet0/1
13:23:16: ICMPv6-ND: Sending NA for FE80::1 on Ethernet0/1
13:23:17: ICMPv6-ND: DAD: 2000::2 is unique.
13:23:53: ICMPv6-ND: Sending NA for 2000::2 on Ethernet0/1
13:23:53: ICMPv6-ND: DAD: 3000::3 is unique.
13:23:53: ICMPv6-ND: Sending NA for 3000::3 on Ethernet0/1
www.syngress.com

312
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
T he debug ipv6 routing command displays debug messages for IPv6 routing
table updates and route cache updates.T he following output displays routes being
added to the routing table:
13:18:43:IPv6RT0:Add 2000:0:0:1:1::/80 to table
# speciﬁes addition of the network to the routing table
13:18:43:IPv6RT0:Better next-hop for 2000:0:0:1:1::/80, [120/2]
# indicates the entry was in the routing table but a lower
# cost path was added
13:19:09:IPv6RT0:Add 2000:0:0:2::/64 to table
13:19:09:IPv6RT0:Better next-hop for 2000:0:0:2::/64, [20/1]
13:19:09:IPv6RT0:Add 2000:0:0:2:1::/80 to table
13:19:09:IPv6RT0:Better next-hop for 2000:0:0:2:1::/80, [20/1]
13:19:09:IPv6RT0:Add 2000:0:0:4::/64 to table
13:19:09:IPv6RT0:Better next-hop for 2000:0:0:4::/64, [20/1]
13:19:37:IPv6RT0:Add 2000:0:0:6::/64 to table
13:19:37:IPv6RT0:Better next-hop for 2000:0:0:6::/64, [20/2]
T he debug bgp ipv6 command enables the debugging of IPv6 BGP informa-
tion.T he full command syntax is as follows:
debug bgp ipv6 {dampening [neighbor-acl] | updates [neighbor-address |
neighbor-acl | in | out]}.
T he following output displays BGP keepalive messages.
6Router-1#debug bgp ipv6
BGP debugging is on
6Router-1#
2w0d: BGP: 2000:1:1::2 rcv message type 4, length (excl. header) 0
2w0d: BGP: 2000:1:1::2 send message type 4, length (incl. header) 19
Analyzing IPv6 Trafﬁc
To analyze IPv6 will require new knowledge of the IPv6 packet functions.An
important aspect of IPv6 is its N eighbor Discovery (N D) process, which uses
IC M P packets to determine and maintain neighbor relationships and provides
auto-conﬁguration functionality similar to DH C P. In this section we will review
the IC M Pv6 header and the different message types in IC M Pv6.T his section will
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
313
also discuss the neighbor discovery process and the IC M Pv6 packet types used
speciﬁcally for neighbor discovery and maintenance.
What’s New in Internet Control 
Message Protocol for IPv6
Internet C ontrol M essage Protocol (IC M P) generates error and informational
messages, as stated in R FC  792, in IPv6 just as it did in IPv4. IC M P is an impor-
tant troubleshooting protocol for providing reachability testing and ﬂow control
at the IP layer. Ping uses IC M P echoes and replies to conﬁrm reachability and is
the most widely used IC M P-based utility. In the IPv6 protocol, IC M P packets
www.syngress.com
Migrating to IPv6
As IPv4 address space is exhausted in the near future with the continued
addition of devices to the network—many of which will be mobile—the
migration to IPv6 will be absolutely necessary. It will also be costly and
time consuming. Software upgrades will be required on every host and
router to support IPv6 addressing; however, the cost of not migrating to
IPv6 and simply continuing to patch and improve IPv4 will also prove
costly to the consumer and to ISPs alike. It is estimated that the IPv4
address space will be exhausted by 2008, although the continued use of
NAT and other methods may continue to prolong the life of IPv4.
Dual-stack, tunneling, and translation methods have been engi-
neered to assist with the migration to IPv6. The dual-stack method com-
pletely supports IPv6 by having both an IPv4 address and an IPv6 address
assigned so that each protocol talks natively to its destination. Manual
and automatic tunneling methods include tunnel broker, 6over4, and
6to4, providing Web-based tunnel set up, host IPv6 over IPv4 communi-
cation without explicit tunnels, and IPv6 domain communication over
IPv4 using a unique IPv6 preﬁx to denote 6to4 communication.
Translation methods provide other migration alternatives, which include
stateless IP/ICMP translator, NAT-PT, Socks64, and Bump-in-the-Stack.
The use of each of these methods will depend on your requirements and
will require additional study and research to implement.
Designing & Planning…

314
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
are used in the neighbor discovery process, path M aximum Transmission U nit
(M T U ) discovery, and the M ulticast Listener Discovery (M LD) protocol. M LD
discovers multicast listeners, which are nodes that want to receive multicast
packets destined for speciﬁc multicast addresses, on directly attached links on
IPv6-enabled routers. M LD is based on Internet Group M anagement Protocol
version 2 (IGM P) for IPv4.
An IPv6 IC M P packet is identiﬁed by a value of 58 in the N ext H eader ﬁeld
of the basic IPv6 packet header.W ithin IPv6 IC M P packets, the IC M Pv6 Type
and IC M Pv6 C ode ﬁelds identify IPv6 IC M P packet speciﬁcs, such as the IC M P
message type.T he value in the C hecksum ﬁeld is derived from the ﬁelds in the
IPv6 IC M P packet and the IPv6 pseudo-header.T he IC M Pv6 Data ﬁeld contains
error or diagnostic information relevant to IP packet processing. Figure 9.1 shows
the IPv6 IC M P packet header format.
T he IC M Pv6 messages are displayed in Table 9.2.T he majority of the error
and informational messages are the same as IC M Pv4 messages.
www.syngress.com
Figure 9.1 ICMPv6 Packet Header Format
Source Address
Destination Address
Version
Traffic Class
Payload Length
Next Header
Flow Label
Hop Limit
Next Header =58
ICMPv6 Packet
ICMPv6 Code
ICMPv6 Type
Checksum
ICMPv6 Data
IPv6 Basic Header

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
315
Table 9.2 ICMP Error Message Types
Included 
Message Type
Message Cause
Sub-Messages
New in IPv6
Error Message
Destination 
No route
No
Unreachable
Administratively 
prohibited
Address 
unreachable
Port unreachable
Packet too big
N/A
No
Time exceeded
N/A
No
Parameter 
Erroneous header No
problem
ﬁeld
Unrecognized 
next header type
Unrecognized 
option 
Informational Message
Echo request
N/A
No
Echo reply
N/A
No
Multicast listener Query
Yes
discovery
Report
(Like IGMP 
Done
for IPv4)
The Neighbor Discovery Process
N eighbor Discovery (N D) is a new IPv6 protocol used by nodes (hosts and
routers) to determine the Layer 2 addresses for neighbors on the same network
or attached links, much like Address R esolution Protocol (AR P) in IPv4. N D is a
combination of the IPv4 protocols AR P, IC M P R outer Discovery (R DISC ), and
IC M P R edirect.T he N D protocol is used to ﬁnd neighboring routers that will
forward packets, track the reachability status of neighbors, and detect new or
changed Layer 2 addresses.You can use the neighbor discovery table to quickly
determine if an alternate path exists when a path to a neighboring router fails.
T he N D protocol is deﬁned in R FC  2461 to resolve issues related to the
interaction among nodes residing on the same physical link.T he R FC  deﬁnes all
the N D interactions including router discovery, preﬁx discovery, address auto-
conﬁguration, duplicate address detection, neighbor unreachability detection,
link-layer address resolution, next-hop determination, and redirects. Each of the
N D interactions are made possible through the use of router solicitations, router
www.syngress.com

316
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
advertisements, neighbor solicitations, neighbor advertisements, and redirect
IC M P messages.
R outer solicitations and router advertisement IC M P messages facilitate the
router discovery and address auto-conﬁguration interactions. R outer discovery
deﬁnes how a host locates routers that reside on an attached link; address auto-
conﬁguration deﬁnes how nodes automatically conﬁgure an address for an inter-
face. R outer solicitations and router advertisements are covered in more detail a
little later in this chapter.
N eighbor solicitations and neighbor advertisements IC M P messages facilitate
the preﬁx discovery, duplicate address detection (DAD), neighbor unreachability
detection (N U D), link-layer address resolution, and next-hop determination inter-
actions as deﬁned in R FC  2461. Preﬁx discovery deﬁnes how hosts discover the
set of address preﬁxes that deﬁne which destinations are on-link for an attached
link. Preﬁxes are used to distinguish between destinations residing on-link from
those accessible only through a router. DAD deﬁnes how a node determines that
an address it wishes to use is not already in use by another node.A neighbor solic-
itation message is used to determine whether the IPv6 address to be assigned to
the interface is unique.T he status of the interface during this process is T EN TA-
T IVE and the address will be assigned to the interface if no neighbor advertise-
ment is received in response to the neighbor solicitation or if no neighbor
solicitation is received from another router attempting to use the same IPv6
address. N U D deﬁnes how nodes determine that a neighbor is no longer acces-
sible.T he default settings will determine that a neighbor is unreachable after 38
seconds. Parameters can be modiﬁed to reduce this time to as little as ﬁve seconds,
although overhead is increased. Link-layer address resolution deﬁnes how nodes
determine the link-layer address of a neighbor when only the destination’s IP
address is known. N ext-hop determination deﬁnes how an IP destination address
is mapped into the IP address of the neighbor to which trafﬁc for the destination
should be sent.T he next-hop can be a router or the destination itself.
Finally, the redirect IC M P packet is used for IVM P redirects. R edirect 
deﬁnes how a router informs a host of a better ﬁrst-hop node to reach a partic-
ular destination.
T he N eighbor Discovery process, seen in Figure 9.2, uses ﬁve different
IC M Pv6 packet types to determine and maintain the neighbor relationships
among IPv6 routers.T he ﬁve packet types are router solicitation, router advertise-
ment, neighbor solicitation, neighbor advertisement, and the redirect packet.
T he router solicitation packet contains a value of 133 in the IC M P packet
header and is sent to an all-routers multicast address when an IPv6 interface is
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
317
enabled to request an immediate router advertisement from the neighboring
routers rather than wait for their next periodic router advertisement.T he router
solicitation message will cause neighboring IPv6 routers to respond with a router
advertisement message, which enables the host to immediately auto-conﬁgure its
interface.
T he router advertisement packet contains a value of 134 in the IC M P packet
header and is periodically sent to an all-nodes multicast address to announce their
presence or is sent in response to a router solicitation packet and is sent in
response to the router solicitation message.T he advertisement typically contains
preﬁxes that local-link nodes can use to auto-conﬁgure their IPv6 addresses, the
lifetime information for each advertised preﬁx, the ﬂags indicating a stateless or
stateful auto-conﬁguration, whether the router sending the advertisement should
be used as a default router, and host information such as hop limit and M T U.
N eighbor solicitation packets contain a value of 135 in the IC M P packet
header and are sent to solicited-node multicast addresses to determine the link-
layer address of a neighbor on the same local link.T he neighbor solicitation can
also be sent to a neighbor’s unicast address to verify neighbor reachablity and is
used for duplicate address detection. N eighbor reachability identiﬁes the failure of
a neighbor or the failure of the forwarding path to the neighbor.T he neighbor
solicitation message will cause a neighbor advertisement to be sent from the
neighboring routers.
T he neighbor advertisement packet contains a value of 136 in the IC M P
packet header and is sent in response to a neighbor solicitation message.A
www.syngress.com
Figure 9.2 Neighbor Discovery: Router Solicitation/Advertisement Messages
A
B
Router Solicitation
ICMPv6 Type = 133
Source = 0::0 or configured unicast address
Destination = all routers multicast address
Data = (sent when interface enabled)
Router Advertisement
ICMPv6 Type = 134
Source = router link-local address
Destination = all nodes multicast address or
source address of  router A if answering
solicitation message
Data = options, prefix, lifetime, autoconfig flag

318
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
neighbor advertisement message is sent with the source address of the IPv6 inter-
face sending the neighbor advertisement.After the sender of the neighbor solici-
tation receives the neighbor advertisement, the two nodes can communicate.A
node may also send unsolicited neighbor advertisements to announce a link-layer
address change.T his concept is illustrated in Figure 9.3.
A redirect packet contains a value of 137 in the IC M P packet header.
R outers use a redirect packet to inform hosts of a better ﬁrst hop for a destina-
tion. R outers also use the redirect packet when the destination address of the
packet is not a multicast address, when the packet is not addressed to the router,
when the packet is about to be sent out the interface it was received on, or when
the source address of the packet is a global IPv6 address of a neighbor on the
same link or a link-local address.
T he ipv6 icmp error-interval command can be used to limit the rate at which all
IC M P messages are sent, which ultimately can reduce link congestion.
T he N eighbor discovery protocol provides many improvements over the IPv4
protocols. O ne of the major improvements is the incorporation of router dis-
covery into the base IPv6 protocol rather than requiring hosts to perform dis-
covery using information in the routing protocols. R outer advertisements can
carry the link-layer address without requiring additional packet exchange; thus,
the address resolution overhead is reduced. R outer advertisements contain the
network preﬁx so that netmask conﬁguration and determination are not required
and not conﬁgured incorrectly.T he M T U  is advertised throughout the conversa-
tion path, ensuring that all nodes are using the same M T U. R outer advertisements
www.syngress.com
Figure 9.3 Neighbor Discovery: Neighbor Solicitation/Advertisement Messages
A
B
Neighbor Solicitation
ICMPv6 Type = 135
Souce = A
Destination = solicited-node multicast of B
Data = link-layer address of A
Query = requesting your link address?
Neighbor Advertisement
ICMPv6 Type = 136
Souce = B
Destination = A
Data = link-layer address of B
A and B can exchange packets

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
319
enable address auto-conﬁguration, reducing overall conﬁguration time. R edirect
messages contain the new ﬁrst hop link-layer address, thereby eliminating separate
address resolution when the redirect message is received. Lastly, neighbor
unreachability detection has been built into the base IPv6 protocol, improving
packet delivery in the case of failed routers, links, or changed link-layer addresses.
www.syngress.com
Tuning the Neighbor Discovery Process
You can tune the Neighbor Discovery process to decrease the time a
neighbor failure is detected and/or reduce the overhead of the process
itself. The following are some commands that can be used to tune the
ND process.
■
ipv6 nd reachable-time Conﬁgures the amount of time that
a remote IPv6 node is considered reachable after some reach-
ability conﬁrmation event has occurred. This variable defaults
to 0 ms for router advertisements and 30000 ms for
neighbor discovery activity. The lower the value the more
quickly unreachability status can be determined, but band-
width and processing are increased.
■
ipv6 nd ra-interval Conﬁgures the interval between IPv6
router advertisement transmissions on an interface. The
default setting conﬁgures the router advertisement interval
at 200 seconds. The interval between RA transmissions
should be less than or equal to the ipv6 nd ra-interval.
■
ipv6 nd ra-lifetime Conﬁgures the “router lifetime” value in
IPv6 router advertisements on an interface. The default value
conﬁgures the “router lifetime” at 1800 seconds. With the
value set to 0, the router will not be considered as a default
router.
■
ipv6 nd dad attempts Conﬁgures the
DupAddrDetectTransmits variable setting the number 
of consecutive neighbor solicitation messages sent on 
an interface while duplicate address detection is 
performed on the unicast IPv6 addresses of the interface. 
The default setting sends one neighbor solicitation message
Conﬁguring & Implementing…
Continued

320
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
www.syngress.com
when the interface is enabled. The variable can be set from 
0 to 600.
■
ipv6 nd ns-interval Conﬁgures the interval between IPv6
neighbor solicitation retransmissions on an interface and is
set in interface conﬁguration mode. This variable defaults to
0 for router advertisements and 1000 for neighbor discovery
activity.
■
ipv6 nd preﬁx-advertisement Conﬁgures which of the con-
ﬁgured IPv6 preﬁxes to include in router advertisements. By
default, all preﬁxes conﬁgured on an interface are advertised.
The complete syntax of the command is as follows:
ipv6 nd preﬁx-advertisement ipv6-preﬁx/preﬁx-length 
valid-lifetime preferred-lifetime [onlink] [autoconﬁg].
■
ipv6 nd suppress-ra Suppresses IPv6 router advertisement
transmissions on a LAN interface. Router advertisements are
sent on a LAN interface if unicast routing is enabled. You
should use the no version of the command on non-LAN inter-
faces if you wish to send router advertisements.
■
ipv6 nd managed-conﬁg-ﬂag Sets the “managed address
conﬁguration” ﬂag in IPv6 router advertisements indicating
to attached hosts whether or not they should use stateful
auto-conﬁguration (DHCPv6) to obtain addresses. If set, the
attached hosts should use stateful auto-conﬁguration to
obtain addresses; otherwise, stateless auto-conﬁguration is
used to obtain addresses. Hosts may use stateful and state-
less address auto-conﬁguration simultaneously.

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
321
Summary
In this chapter, we reviewed a few of the new commands that you can use to
determine status and to troubleshoot IPv6 conﬁgurations and trafﬁc ﬂows.We
reviewed several 
commands that provide information on the status of IPv6-
conﬁgured router interfaces, show you which paths are available for routing IPv6
trafﬁc, and enable you to determine and monitor IPv6 neighbors. N ew IPv6
commands also help you to determine which interfaces are conﬁgured with
routing protocols and enable you to review the quantity and makeup of the IPv6
trafﬁc originating or being received by the router.We also reviewed a few com-
mands used to monitor the status of IPv6 BGP-conﬁgured interfaces and deter-
mine the BGP neighbors and their communication status.
We reviewed a few commands that are helpful in debugging IPv6 communi-
cation.T hese commands provide insight into IC M P communication, including
the neighbor discovery process, IPv6 routing, and IPv6 BGP routing.
A few important aspects of IPv6 are useful to assist in understanding and ana-
lyzing IPv6 trafﬁc ﬂows. O ne important concept is the process of neighbor dis-
covery and the process in which an unreachable neighbor is determined. IC M P
packets are used to maintain the neighbor adjacencies and report when a
neighbor is unreachable. By learning the contents and messages used by IC M P to
maintain neighbor relationships, you will have a ﬁrm grasp on the basis of IPv6
communication.
Solutions Fast Track
U sing show C ommands
 show ipv6 interface T he most frequently used command to
determine the status of the IPv6-conﬁgured interfaces.T his should be
one of the ﬁrst commands when troubleshooting link problems.
 show ipv6 route Displays the possible paths to reach other accessible
IPv6 networks.T he administrative distance and metric are displayed
when using this command.
 show ipv6 route summary U sed to display the number of routes per
route source and each preﬁx length.
www.syngress.com

322
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
 show ipv6 neighbors Displays the IPv6 neighbor adjacency table and
provides a listing of neighbors that have become inaccessible and if still
accessible, the last time the neighbor was contacted.
 show ipv6 protocols Displays the IPv6 protocols conﬁgured on the
router. Displays an at-a-glance summary providing information such as
the conﬁgured route redistribution, the IPv6 neighbors, and the routing
protocol conﬁgured on each interface.
 show ipv6 trafﬁc Displays statistics about IPv6 trafﬁc and is useful in
conﬁrming that IPv6 is operating.
 show bgp ipv6 Displays the overall health of BGP on the router and
should be one of the ﬁrst commands used to troubleshoot BGP on the
router.
 show bgp ipv6 summary Provides an overview of the BGP
conﬁguration on the router.
 show bgp ipv6 neighbors U seful for determining the status of the
BGP neighbor communications.
U sing debug C ommands
 debug ipv6 packet Displays information on the packets received,
generated, and forwarded on this router.
 debug ipv6 icmp U seful for troubleshooting IC M P communication
on the router.T he neighbor discovery process, M T U  determination, and
M ulticast Listener Discovery (M LD) all use IC M P.
 debug ipv6 nd U seful for troubleshooting the neighbor discovery
process where passing IC M Pv6 packets between routers to establish
neighbor adjacencies attains adjacencies.
 debug ipv6 Displays debug messages for IPv6 routing table updates and
route cache updates.
 debug bgp ipv6 Enables the debugging of IPv6 BGP information.
www.syngress.com

Monitoring and Troubleshooting IPv6 Networks • Chapter 9
323
Analyzing IPv6 Trafﬁc
 IC M P packets in IPv6 are used in the IPv6 neighbor discovery process,
path M aximum Transmission U nit (M T U ) discovery, and the M ulticast
Listener Discovery (M LD) protocol. M LD is similar to IGM P in
IC M Pv4.
 N eighbor Discovery, among other things, deﬁnes the neighbor discovery
process, duplicates address detection, address auto-conﬁguration, and the
neighbor unreachabilty process.
 Five IC M Pv6 packet types fulﬁll the neighbor discovery process:
N eighbor Advertisements, N eighbor Solicitations, R outer
Advertisements, R outer Solicitations, and R edirect messages.
Q: Does migrating to IPv6 provide improved reliability over IPv4?
A: A migration to IPv6 does not increase the reliability over IPv4, because the
communication path is made up of essentially the same hardware; however, an
improvement has been made in the resiliency of the protocol itself through
the implementation of the neighbor discovery protocol and its capability to
detect neighbor failures.T his failure detection mechanism decreases the time,
if conﬁgured, to as little as ﬁve seconds.
Q: I see “6to4” often when reading about IPv6.W hat is 6to4 tunneling?
A: T he 6to4 method is a transitional “automatic tunneling” method that enables
connectivity to other IPv6 networks across the traditional IPv4 infrastructure
with less required conﬁguration than other methods. It encapsulates IPv6
trafﬁc in an IPv4 packet and sends the trafﬁc across the network to another
6to4 end-site.T he 2002::/ 16 preﬁx is reserved for 6to4 based networks and
allows for 216 networks with 264 nodes each.
www.syngress.com
Frequently Asked Questions
The following Frequently Asked Questions, answered by the authors of this book,
are designed to both measure your understanding of the concepts presented in 
this chapter and to assist you with real-life implementation of these concepts. To
have your questions about this chapter answered by the author, browse to
www.syngress.com/solutions and click on the “Ask the Author” form.

324
Chapter 9 • Monitoring and Troubleshooting IPv6 Networks
Q: C an I still use ping and traceroute to troubleshoot and resolve IPv6 net-
working problems?
A: Ping and traceroute are still used to troubleshoot IPv6 networks.T he syntax
requires the insertion of IPv6 in the command, in addition, of course, to the
destination IPv6 address.T he syntax is as follows:
ping ipv6 [ipv6-address] and traceroute ipv6 [ipv6-address]
Q: W hat is unicast?
A: A unicast packet is the communication between a single host and a single
receiver. U nicast and multicast are widely used in IPv6 rather than broadcasts.
IPv4 used broadcast in many cases that are sent to all hosts on network,
thereby increasing bandwidth utilization.
Q: W hat is a link-local address?
A: T he link-local addresses are used within a local network to provide addressing
on a single link, for neighbor discovery, and when no IPv6 routers are pre-
sent. R outers do not forward link-local addresses.
Q: W hat is a site-local address?
A: T he site-local addresses are used within a site when global addresses are not
wanted. Site-local addresses are equivalent to using a 10.0.0.0/ 8 address in IPv4.
Site-local addresses are not forwarded outside the site where they are used.
www.syngress.com

Conﬁguring IPv6 
for the Cisco IOS
Fast Track
This Appendix will provide you with a quick,
yet comprehensive, review of the most 
important concepts covered in this book.
Appendix
325

326
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track
❖Chapter 1: Introduction to the Cisco IOS
C onnecting to the R outer

T he initial connection to the router must be made through the console
connector on the router.T his is accomplished by use of a rolled-R J45 cable
and a 9– or 25-pin serial connector.

After you have applied Internet Protocol (IP) or other logical addresses, you
can access a router by Telnet sessions for conﬁguration.

R outers can also use Simple N etwork M anagement Protocol (SN M P)
settings to integrate with network management systems (N M S) platforms.
Entering C ommands to C onﬁgure a C isco R outer

T he router has two levels of access: user mode and privileged mode. U ser mode
is a very restricted level of access and allows for only basic functions,
whereas privileged mode allows for full conﬁguration and diagnosing
capabilities.

Two basic types of commands are available: conﬁguration commands and show
commands.You use conﬁguration commands to change the operation of the
router and its processes; you use show commands to understand and diagnose
the system conﬁguration and operation.

Enter a question mark (?) at the command prompt after a particular
command to see all the available commands and their conﬁguration
parameters.
Increasing Efﬁciency by U sing Shortcuts

C ommands can be abbreviated by entering only the ﬁrst few letters of the
command— you must enter enough characters for the IO S to be able to
recognize it.

W hen you press the Tab key after entering the beginning of a command,
the C isco IO S’s auto-complete feature automatically ﬁlls in the rest of the
command.T he same rule applies as for shortcuts: you must enter enough
information to make the command unique.

Several keystroke shortcuts are also available throughout the IO S.
www.syngress.com

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
327
❖Chapter 2: Introduction to IPv6 Architecture 
U nderstanding the Beneﬁts of IPv6

T he IP address size is greatly increased.

A “top-down” allocation plan supports addressing hierarchies, enabling
greater address aggregation.

H ost addressing is simpliﬁed by using the M AC  address to form the host
portion of the IP address.

Plug and Play functionality is supported by simpler autoconﬁguration 
of IP addresses.

M ulticast routing is scoped to provide greater scalability.

Anycast addresses increase routing efﬁciency.

Streamlined headers lower routing overhead.

Security is built in to support IP security at a lower level in the O SI stack.

M obility is enhanced with greater scalability and ease.

Performance is enhanced with greater efﬁciency and streamlining.
C omparing IPv6 to IPv4

IPv6 enlarges the addressing structure without address translation and private
address spaces.

IPv6 address administration is “top-down” to allow for greater address
aggregation.

IPv6 headers are simpler and more efﬁcient thanks to a ﬁxed size and 
fewer ﬁelds.

IPv6 features not included in IPv4 include enhanced support for
multicasting, security, mobility, and discovery.
Examining IPv6 N etwork Architecture

T he impending address space depletion provided the initial impetus for
developing IPv6.

A streamlined architecture improves network performance.
www.syngress.com

328
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track

Security on the IP level is built into IPv6.

Plug and Play has become a reality with IPv6.

Intra-subnet communications can be autoconﬁgured in a Plug and Play
fashion.

Inter-subnet communications can be set up by the stateless
autoconﬁguration function.

Internetwork communications can be set up by stateful autoconﬁguration.
U pper-Layer Protocol Issues

U pper-layer checksums need to be computed over a larger IPv6
pseudoheader.

T he maximum packet lifetime is expressed as an IPv6 H op Limit, not a
T ime To Live.

M aximum upper-layer payload sizes may need revision to allow for the
larger IPv6 header.

T he IPv6 R outing H eader must be used with care to avoid the security
risks of source routing.

T he Domain N ame Service (DN S) is being enhanced to support IPv6.

Application Programming Interfaces (APIs) are being developed to support
the larger IPv6 addresses.
U nderstanding IC M Pv6

T here are four types of IPv6 error messages:
■
Destination U nreachable messages arise when a packet cannot be deliv-
ered for any reason other than congestion.
■
Packet Too Big messages arise when a packet exceeds the M T U  size of
the outgoing interface.
■
T ime Exceeded messages arise when a packet exceeds its H op Limit.
■
Parameter Problem messages arise when a router cannot process an IPv6
header.
www.syngress.com
Chapter 2 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
329

T here are three types of Informational M essages.
■
Diagnostic messages include the echo request and reply messages.
■
M ulticast Listener Discovery (M LD) messages are used to discover mul-
ticast listeners and the multicast addresses that are of interest to them.
■
N eighbor Discovery messages support the N eighbor Discovery protocol.
U nderstanding N eighbor Discovery

R outer Solicitation and Advertisement messages are used to discover local
routers and to advertise router and subnet information.

N eighbor Solicitation and Advertisement messages are used to discover
neighbors and to advertise their addresses.

A R edirect message is used to inform a node of a better ﬁrst hop to a
destination.

M essage O ptions are used to include additional information in N eighbor
Discovery messages.
❖Chapter 3: The IPv6 Headers
Analyzing the IPv6 H eader

T he IPv6 header reserves two ﬁelds (totaling 28 bits) for prioritizing and/ or
identifying packets and packet ﬂows that require special handling, such as
prioritization.As real-time applications such as video and voice become
more prevalent, these ﬁelds should be heavily used.

T he N ext H eader ﬁeld in IPv6 uses the same deﬁnitions used in IPv4 (and
deﬁned in R FC  1700).T hus T C P uses “6,” U DP uses “17,” and so on.

Immediately following the destination IPv6 address is the next header— an
IPv6 extension header, an upper-layer protocol header, etc.
C omparing the IPv6 and IPv4 H eaders

Source and destination IPv6 addresses are four times as long as IPv4
addresses (128 bits versus 32 bits)
www.syngress.com
Chapter 2 Continued

330
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track

T he IPv4 header adds optional functions within the header in the options
ﬁeld. IPv6 has a completely ﬁxed header, but adds extension headers for
optional functions such as routing, fragmentation, or authentication.

In IPv6, many IPv4 ﬁelds were maintained, a few were added, and several
were dropped (or changed to extension headers)
T he IPv6 Extension H eaders

Different extension headers were created based on the nodes that would
need to examine and process them. For example, the Destination H eader
and Fragmentation H eaders were created strictly for viewing by the
endpoint, whereas the R outing and H op-by-H op H eaders were created to
be viewed by all routers along the path.T his improves efﬁciency, since some
headers do not need to be processed by intermediate routers.

Authentication and Encryption are incorporated into the IPv6 standard as
extension headers, supporting the need for increased security in the digital
world.

Although the Fragmentation header is part of the IPv6 standard, its use is
discouraged. In reality, it will likely get very little use.
❖Chapter 4: Explaining IPv6 Addressing
T he Basics of IPv6 Addressing

IPv6 uses a 128-bit format that represents the next generation of Internet
protocol that can meet both the current addressing requirements and those
generated by emerging markets.

IPv6 was not developed solely as a mechanism for addressing address
depletion. It provides enhancements to aggregation, Q oS, security, and
routing.

C onverting to IPv6 is not a trivial task; it is an entirely new addressing
structure that introduces complexities in the deployment and management
of the address space.
www.syngress.com
Chapter 3 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
331
IPv6 Addressing Scheme C haracteristics

A format for the deployment of highly structured, hierarchical address space
is introduced in the global unicast address space.

Due to the variety of address types used in the IPv6 address architecture,
routers now have multiple addresses per physical interface.T his can include
the global unicast address, link-local address, site-local address, and multicast
addresses on a per-interface basis.

IPv6 provides three mechanisms for representing the interface identiﬁer of
the host address portion of an IPv6 address.T hese mechanisms are the M AC
address, the converted EU I-64 address, and an IPv4 address.
T he N eed for Further Development

M ultihoming to multiple service providers can defeat the highly structured
aggregation policies deﬁned in the IPv6 address architecture.A tremendous
amount of focus exists in the area of multihoming to alleviate these issues.

M odiﬁcations to the T C P stack and to DN S architectures are required to
fully realize the beneﬁts of the IPv6 addressing.

T he 6Bone provides a test bed for the development of IPv6 infrastructures
and is constantly evolving to meet the requirements generated by ongoing
deployments of IPv6.
❖Chapter 5: Conﬁguring IPv6 Addressing
C onﬁguring IPv6 Addressing

W hen conﬁguring your interfaces, remember that IP v6 must be included in
the syntax to distinguish between IPv4 and IPv6 addresses.

T here are three types of addresses that can be assigned on an interface:
global, site-local and link-local.T hese different types of addresses are deﬁned
on the interface with different conﬁguration parameters.T hese addresses
must be within their respective address spaces, as deﬁned earlier in the book.

If you are using the E U I-64 command when entering an IPv6 address,
remember that the router uses its identiﬁer for the last 64 bits of the IPv6
www.syngress.com
Chapter 4 Continued

332
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track
address, therefore if you want to ﬁnd out the address, you have to go back
and get the full IPv6 address.

W ith the conﬁguration of duplicate address detection, you can specify the
number of solicitation messages sent out. If you want to disable this feature,
set the number of solicitation messages to zero. Entering the no command
will restore the number of solicitation messages to the default of one.

T he ability to conﬁguring the rate limit for IC M Pv6 is a new feature that
was not available in IPv4.T his feature allows you to set the rate at which
error messages are sent out, as well as to conﬁgure a bucket size for the
number of error messages that can be sent.

WAN  connections, like Frame-R elay and AT M , function the same way with
IPv6 as with IPv4.T he only differences are that you are using an IPv6
address and that you can enter a link-local address.

M ost of the commands that involve IPv6 have IP v6 in the actual syntax used
to conﬁgure the command on the router. If IP v6 is not speciﬁed an IPv4
address will be assumed, and you will receive an error from your router
because it will not know how to read the address. O ne exception is entering
the DN S information; that command uses just IP in the syntax, but will
accept either an IPv6 or IPv4 address.
Verifying IPv6 Addressing

T here is no Address R esolution Protocol with IPv6; it has been replaced
with the neighbor discovery protocol. Showing the neighbor discovery will
give the link-layer address that is associated with the IPv6 address.

W hen using show commands to view IPv6 conﬁgurations, then ipv6 is
usually in the syntax of the command. If just IP is used, typically only IPv4
results will be produced.

R emember to always know what version of C isco IO S you are running,
because IPv6 is still an emerging technology and there will be changes is
almost every new revision of C isco IO S that becomes available.
www.syngress.com
Chapter 5 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
333
❖Chapter 6: Routing IPv6 for the Cisco IOS
Explaining R IP for IPv6

T he R outing Information Protocol (R IP) is a distance-vector routing
protocol. It calculates its routing metrics based solely on hop-count.

A new version of R IP, often referred to as R IPng, was written to support
IPv6.T his new version of R IP shares the IPv4 limitations and mechanisms.

IPv6 R IP supports default routes, route redistribution, and route ﬁltering.
C onﬁguring R IP for IPv6 

You enable R IP with the Ipv6 router rip <word> command.T he <word>
speciﬁes the R IP routing process to be used.

Include networks in the IPv6 R IP routing process at the interface level with
the ipv6 rip <word> enable command. O nce again, the <word> speciﬁes the
R IP process ID.

C onﬁgure default routes at the interface layer with the ipv6 rip
<word>default-information originate command.
Exploring IS-IS for IPv6

Integrated System-to-Integrated System (IS-IS) is a link-state routing
protocol that was originally designed for C LN S routing. Extensions were
written in to support IP and now IPv6.

Because it is a link-state routing protocol, its metric calculation is based on
numerous factors, not just hop-count. It can therefore make better routing
decisions than typical distance-vector routing protocols can.

IS-IS supports all the same functions as the IPv6 version of R IP and also
supports speciﬁcation of more than one path to use for data transmission
through use of the maximum-paths command.
C onﬁguring IS-IS for IPv6

You enable IS-IS on a router with the C L N S routing command. Enable
integrated IS-IS by issuing the router ISIS <word> command.Again, <word>
refers to the process ID.
www.syngress.com

334
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track

Advertise networks via IS-IS at the interface level with the ipv6 router isis
<word> command.

R edistribute other routing protocols into IS-IS with the redistribution
command in the address family conﬁguration mode.
Describing M ultiProtocol BGP Extensions for IPv6 

Border Gateway Protocol (BGP) is an exterior routing protocol used to
route between autonomous systems.

Like IS-IS, extensions were added into the existing standard to support IPv6.

IPv6 BGP supports IPv6 routing, redistribution, manual conﬁguration of a
R outer ID, link-local addressing, and peer groups.
C onﬁguring BGP Extensions for IPv6

Start basic BGP conﬁguration with the router bgp <process id> command.

To support IPv6 unicast trafﬁc, you must disable IPv4 unicasts with the no
bgp default ipv4-unicast command.

Form router peering relationships between BGP routers with the neighbor
command.You must form a neighbor relationship between every router that
you wish your BGP router to exchange information with.
O ther Protocols and Future Developments

O pen Shortest Path First (O SPF) is a link-state routing protocol used in
many large organizations. IPv6 support will come in the form of extensions
written into the existing standard

Enhanced Interior Gateway R outing Protocol (EIGR P) is a hybrid protocol
incorporating mechanisms of both distance-vector and link-state routing
protocols. Like O SPF, IPv6 support will come in the form of extensions
written into the existing standard

Both O SPF and EIGR P support for IPv6 will come with the Phase III
deployment of IPv6 from C isco, which is currently scheduled for 
mid-2002.
www.syngress.com
Chapter 6 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
335
❖Chapter 7: Deploying IPv6 on the Cisco IOS
IPv6 Deployment Strategies

C reating tunnels across an existing IPv4 network is a tried-and-true method
of creating connectivity between IPv6 domains. Point-to-point can be
created manually with IPv6 manually conﬁgured tunnels and C isco’s GR E
tunnels.Tunnels can be created automatically based on the address using
Automatic IPv6 Tunnels,Automatic 6to4 Tunnels, and ISATAP Tunnels. If
M PLS is deployed, tunnels can be created at the C E router.

For Q oS or SLA requirements, the use of dedicated links will provide the
needed control over the different protocols. Separate links can be
provisioned with total separation as the most costly and secure method.
U sing virtual links with transports such as Frame R elay,AT M , or O ptical
LAM BDAs. C ircuit transport over M PLS can also provide Q oS while
separating the protocols.

W hen isolating IPv4 from IPv6 isn’t a concern or there is a need to have
both IPv4 and IPv6 co-exist in the domains both hosts and routers can run
in a dual-stack mode which basically running dual protocol stacks in both
the hosts and routers.T he routers will also be required to run dual routing
protocols.
U nderstanding Deployment M ethods

Tunnels A technique to encapsulate IPv6 packets inside IPv4 packets for
transport across an existing IPv4 infrastructure.
■
IPv6 Manually Conﬁgured Tunnel T EPs are deﬁned across an IPv4
network.All IPv6 trafﬁc enters and exits the network at the T EPs.
Pros: Ease of deployment, low cost, tried-and-tested technology.
C ons: Doesn’t scale, tunnels are pre-deﬁned point-to-point links, high
management overhead, troubleshooting is difﬁcult.
■
IPv6 over IPv4 GRE Tunnel Enhanced features of the IPv6 manually
conﬁgured tunnel.Added feature of protocol independence of trafﬁc
conﬁgured for the tunnel.
www.syngress.com

336
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track
■
Automatic IPv6 Tunnel Tunnels are created automatically based on
the lower 32 bits of the address.T he IPv6 address is created by taking an
IPv4 address and padding 0’s into the upper 96 bits.
Pros: Ease of deployment, low cost, tunnels are created automatically.
C ons: N o realization of the increased address space of IPv6, doesn’t scale,
troubleshooting is difﬁcult.
■
Automatic 6to4 Tunnel Tunnels are created automatically based on
the IPv6 address.An IPv4 address is used in the upper 32 bits of the
N LA, which allows another 16 bits of SLA for segmentation within the
IPv6 domain.
Pros: Ease of deployment, low cost, tunnels are created automatically,
use of valid IPv6 frames.
C ons:Troubleshooting is difﬁcult,
■
ISATAP Tunnel T his tunnel technique is still in draft form. C isco has
plans to support ISATAP at a later date. ISATAP uses an IPv4 address to
create the tunnel, but places the 32 bit IPv4 address in the low 32 bits of
the interface and uses a valid 64 bit IPv6 network address.
Pros: Ease of deployment, low cost, tunnels are created automatically,
full use of valid IPv6 network addresses.
C ons:Troubleshooting is difﬁcult.
■
6over4 Tunnels T his tunnel technique uses multicast routing as a vir-
tual link layer. C isco does not and does not plan to support 6over4 tun-
nels. Like the Automatic IPv6 tunnel, an IPv4 address is used in the
lower 32 bits with a ﬁxed FE80::/ 96 preﬁx.
Pros: Ease of deployment, low cost, tunnels are created automatically.
C ons: N ot supported on C isco products, no realization of the
increased address space of IPv6, requires multicast network, doesn’t
scale, troubleshooting is difﬁcult.

IPv6 over Dedicated Links U sing existing transport infrastructure, IPv6
is directed to dedicated links or virtual links. IPv6 has no impact on IPv4
trafﬁc.
www.syngress.com
Chapter 7 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
337
Pros: Q oS and SLAs can be managed for IPv4 and IPv6 separately.
C ons: IPv6 hardware acceleration and routing isn’t as robust as that 
of IPv4.

IPv6 over an MPLS Backbone Tunneling, dedicated links, and dual-
stack techniques work with M PLS as they do with IPv4-routed backbones.
T he same restraints and beneﬁts apply to each of the techniques; the only
difference is the beneﬁts realized by having M PLS on the backbone.
■
IPv6 Using Tunnels on the Customer Edge Routers T his has the
same characteristics as the manually conﬁgured tunnels, with the differ-
ence being that the encapsulated packets are switched across the M PLS
backbone versus being routed across an IPv4 backbone.
■
IPv6 over a Circuit Transport over MPLS Same characteristics as
using dedicated links. M PLS VPN s are created with the appropriate Q oS
assigned to each VPN .
■
IPv6 on the Provider Edge Router T his is not commercially avail-
able and is still in draft form with the IET F. U sing M P-BGP, M PLS is
able to advertise next-hop reachability using IPv6 address, which will
enable native IPv6 service to be offered to the C E routers from the PE.

Using a Dual-Stack Backbone R equires fully redundant conﬁgurations
of IPv4 and IPv6 with each router supporting both IPv4 and IPv6 and their
routing protocols.
Pros: Ease of deployment, ability to use protocol analyzer for IPv6
issues, full management of IPv6.
C ons: IPv6 hardware acceleration and routing protocols not as robust
as IPv4, depending on the size of the network, the overhead to
upgrade all the routers (and hosts) for IPv6 support could be large;
possible hardware and memory upgrades to support IPv6.
Translating between IPv4 and IPv6

Translation techniques have three basic approaches:
■
All trafﬁc passes through a single “translation device,” such as N AT-PT
or T C P-U DP R elay.
www.syngress.com
Chapter 7 Continued

338
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track
■
Snifﬁng packets at the host and making the translation from IPv6 to
IPv4 before the N IC  passes the data to the network layer of the host.
T he BIS method requires a client (or module) to be installed on each of
the workstations.
■
U sing a server to terminate both the IPv6 session as well as the IPv4
session. Both DST M  and Socks-based IPv6/ IPv4 gateways relay data
between the two sessions.T his requires the installation of a client to
communicate with the server.

U sing a server to translate all trafﬁc creates a single point of failure, because
all trafﬁc passes through the translator. H eavy trafﬁc could tax the server,
requiring more server power or additional memory to support the volume
of packets.T he upside is that this approach eases management— because all
trafﬁc passes through a single device, all changes and troubleshooting would
be at a central location and not dispersed across the network.

Installing clients on each workstation can be an administration and
management burden for large deployments. For large deployments the
amount of effort to install clients on all the workstations and manage host
compatibility and possible upgrades should be factored in before deploying
these techniques.
❖Chapter 8: IPv6 Security
IPSec O verview

Security risks speciﬁc to IP include data theft, data tampering, and peer
impersonation.

Security features included in IPv6 via IP Security (IPSec) extension headers
provide authentication, integrity, conﬁdentiality, and access control.

IPSec is a standard deﬁned by a suite of Internet Engineering Task Force
(IET F) R equests for C omments (R FC s) that can be implemented in both
IPv4 and IPv6.
www.syngress.com
Chapter 7 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
339
U nderstanding the Building Blocks of IPSec

IPSec services are extension headers that can be included within an IPv6
header.T he services consist of two security protocols: the Authentication
H eader (AH ) and the Encapsulating Security Payload (ESP).

AH  is an extension header and protocol that uses a cryptographic signature
to provide both connectionless integrity and data origin authentication.You
should use AH  when it’s important to be certain that you are
communicating with correct node and when you want to ensure that data is
not modiﬁed in transit.

ESP is an extension header and protocol that can provide conﬁdentiality,
data origin authentication, connectionless integrity, replay protection, and
limited trafﬁc ﬂow conﬁdentiality.

Both AH  and ESP support two modes of use: transport mode and tunnel
mode. In transport mode, the selected protocol (AH  or ESP) provides
protection primarily for upper layer protocols, and its extension header is
created and inserted as part of the original IPv6 header. H owever, in tunnel
mode, the extension header is created and inserted as part of a new IPv6
header that encapsulates the entire original packet as the payload.

Because IPSec is intended to provide network layer security services, it can
be implemented on end hosts and devices.

W ithin IPsec there are two primary methods of authenticating peers in
which authentication information is exchanged between the peers out of
band: pre-shared keys and certiﬁcates.W ith pre-shared keys, two or more
peers securely exchange (pre-share) a secret key prior to any IPSec
negotiation— the process is simple and inexpensive but does not scale well.
C ertiﬁcates scale well but are typically more complex to implement.
C ombining IPSec’s C ryptographic M echanisms

T he Security Policy Database (SPD) identiﬁes the services to be applied to
IP packets and is consulted in the processing of all trafﬁc. For any packet, the
SPD will identify one of three options for processing: discard, bypass IPSec,
or apply IPSec.
www.syngress.com
Chapter 8 Continued

340
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track

T he SA is a mechanism that IPSec uses to keep track of the details of a
negotiated IPSec session between two nodes.A pair of SAs is required for
communication between a pair of nodes.An SA is uniquely identiﬁed by a
destination IP address, a security protocol identiﬁer (AH  or ESP), and a
Security Parameter Index (SPI).

Internet K ey Exchange (IK E) is the mechanism that determines which
services should be applied to the different trafﬁc ﬂows and negotiates the
required cryptographic keys for those services. IK E has two phases. Phase 1
is used to establish a secure channel (ISAK AM P SA) through which IPSec
cryptographic services and algorithms can be negotiated. Phase 2 is the
actual negotiation of the IPSec cryptographic services and algorithms
through the secure channel established in Phase 1.

W ithin IK E Phase 1, two possible modes can be used to establish the
ISAK M P SA: main mode and aggressive mode. M ain M ode consists of three
exchanges between the initiator and the responder for a total of six packets
exchanged. Because this data is encrypted, main mode provides what is
called identity protection.Aggressive M ode can also be used to establish the
ISAK M P SA; however, it uses a total of three packets instead of six.
Aggressive mode does not provide identity protection.
Applying Perimeter Security

Access lists are an important component in the secure conﬁguration of a
router.T hey provide packet ﬁltering capabilities for C isco routers,
controlling access to services on the router itself, and ﬁltering trafﬁc passing
through the router.

Standard access lists can ﬁlter based on only the source IP address within a
packet. Extended access lists can ﬁlter based on other packet parameters,
including source and destination IP address, source and destination ports,
and protocol. In addition, extended access lists support logging.
www.syngress.com
Chapter 8 Continued

Conﬁguring IPv6 for the Cisco IOS Fast Track • Appendix
341
❖Chapter 9: Monitoring and 
Troubleshooting IPv6 Networks
U sing show C ommands

show ipv6 interface T he most frequently used command to determine
the status of the IPv6-conﬁgured interfaces.T his should be one of the ﬁrst
commands when troubleshooting link problems.

show ipv6 route Displays the possible paths to reach other accessible IPv6
networks.T he administrative distance and metric are displayed when using
this command.

show ipv6 route summary U sed to display the number of routes per
route source and each preﬁx length.

show ipv6 neighbors Displays the IPv6 neighbor adjacency table and
provides a listing of neighbors that have become inaccessible and if still
accessible, the last time the neighbor was contacted.

show ipv6 protocols Displays the IPv6 protocols conﬁgured on the
router. Displays an at-a-glance summary providing information such as the
conﬁgured route redistribution, the IPv6 neighbors, and the routing
protocol conﬁgured on each interface.

show ipv6 trafﬁc Displays statistics about IPv6 trafﬁc and is useful in
conﬁrming that IPv6 is operating.

show bgp ipv6 Displays the overall health of BGP on the router and
should be one of the ﬁrst commands used to troubleshoot BGP on the
router.

show bgp ipv6 summary Provides an overview of the BGP
conﬁguration on the router.

show bgp ipv6 neighbors U seful for determining the status of the BGP
neighbor communications.
U sing debug C ommands

debug ipv6 packet Displays information on the packets received,
generated, and forwarded on this router.
www.syngress.com

342
Appendix • Conﬁguring IPv6 for the Cisco IOS Fast Track

debug ipv6 icmp U seful for troubleshooting IC M P communication on
the router.T he neighbor discovery process, M T U  determination, and
M ulticast Listener Discovery (M LD) all use IC M P.

debug ipv6 nd U seful for troubleshooting the neighbor discovery process
where passing IC M Pv6 packets between routers to establish neighbor
adjacencies attains adjacencies.

debug ipv6 Displays debug messages for IPv6 routing table updates and
route cache updates.

debug bgp ipv6 Enables the debugging of IPv6 BGP information.
Analyzing IPv6 Trafﬁc

IC M P packets in IPv6 are used in the IPv6 neighbor discovery process, path
M aximum Transmission U nit (M T U ) discovery, and the M ulticast Listener
Discovery (M LD) protocol. M LD is similar to IGM P in IC M Pv4.

N eighbor Discovery, among other things, deﬁnes the neighbor discovery
process, duplicates address detection, address auto-conﬁguration, and the
neighbor unreachabilty process.

Five IC M Pv6 packet types fulﬁll the neighbor discovery process: N eighbor
Advertisements, N eighbor Solicitations, R outer Advertisements, R outer
Solicitations, and R edirect messages.
www.syngress.com
Chapter 9 Continued

343
Index
2500 routers, 22
2501 routers, 9
4over6 tunnel, 245–247
6Bone, 153–154, 157–158
6PE routers, 252
6to4 tunnel, 245–247, 323
A
aaa command, 12
Access control, 269
Access lists
access-enable command, 9
access-list configuration command, 12
access-profile command, 9
commands, 287–288
extended, 287
standard, 286–287
Accounting, 12, 19
Active connections, listing, 10
address-family ipv6, 217–219
Address format illustrations
Aggregatable Global U nicast, 57
anycast, 146–147
4over6, 246
Global U nicast, 128
Internet Protocol version 6 (IPv6), 56
ISATAP, 248
link-local unicast, 133
modified sub-T LA, 131
multicast, 46, 141
site-local, 135
6to4, 246
unicast, 130
unicast network and host bits, 131
Address resolution, link-layer, 316
Address R esolution Protocol (AR P), 62,
169, 173
Address space
addressing scheme, 119–121, 152
C lass B exhaustion, 34
independently assigned, 153
portable, 152
public routing topology prefix, 128
size of IPv6 address space, 121
See also Subnetting and prefixes
Address structure
Aggregatable Global U nicast address
format, 127–132
anycast addresses, 145–147
first-bits standards, 126
hexadecimal notation, 121–124
interface identifiers, 132–133
IPv4 versus IPv6, 56
IPX  addresses, 137
link-local addresses, 133–135
local-use unicast addresses, 133–136
loopback addresses, 132
multicast addresses, 141–145

344
Index
N etwork Service Access Point (N SAP)
addresses, 115, 136–137, 214
nodes-required addresses, 147–149
site-local addresses, 135–136
syntax compression, 124–125
unicast addresses, 127–141
unspecified addresses, 132
See also Addresses;Addressing scheme;
Subnetting and prefixes
Addresses
administration, IPv4 versus IPv6, 56–58
allocation agents, 120
anycast, 48–50
autoconfiguration, 42–44
deriving, 41–42
dual IPv6, 151–152
duplicate address detection, 165–166
EU I-64 format, 132–133, 146–147
group addresses, 45
hierarchy in IPv6, 36–41
history, 115–116
host addressing, 41–42
Layer 3, 3
lifetime attribute, 151
local-link, 62
multicast, 42–48
multicast routing scalability, 44–48
multiple, 165, 183
Solicited N ode M ulticast, 43
translation overhead, 54
types of, 148–149
unicast, 35–37
See also Address structure;Addressing
scheme; C onfiguring IPv6
addressing; Global addresses; Link-
local addresses; Site-local addresses
Addresses, mapping host names to, 167
Addressing scheme
address space, 119–121, 152
C lass B address space, exhaustion of,
34
flow label field, 118
header overview, 116–119
N ext H eader field, 119
payload length field, 118
traffic class field, 117–118
version field, 117
See also Address structure;Addresses;
M ultihoming problem
Adjacencies, 212, 310
Adjacency, transport, 280
Administrative distance, 195
Advertisement
link-state advertisements (LSAs),
211–212
N eighbor, 62, 73
R outer, 64, 72
Aggregatable Global U nicast address
format, 127–132
Aggregation
capabilities, 138
prefix boundaries, 132
route announcements, 140
See also N ext-Level Aggregation
Identifier (N LA ID); Site-Level
Aggregation Identifier (SLA ID);
Top-Level Aggregation Identifier
(T LA ID)
Aggressive mode, IK E phase 1, 284–285
Airline Protocol Support (ALPS), 13, 19
ALG. See Application Level Gateway 
Algorithm, Bellman-Ford, 186–187
Algorithms, cryptographic, 275–276
alias command, 13

Index
345
Allocation and assignment policies, 120,
137–138
ALPS. See Airline Protocol Support 
alps command, 13
Ambiguous commands, 28
American R egistry for Internet
N umbers (AR IN ), 120, 130,
137–138
Anti-replay service, 104
Any Transport over M PLS (AToM ),
251–252
Anycast addresses, 48–50, 145–147
API. See Application Programming
Interface (API)
APN IC. See Asia Pacific N etwork
Information C entre (APN IC )
Application Level Gateway (ALG), 257
Application Programming Interface, 68
Architecture of IPv6
communication fundamentals, 61–67
depletion of IP addresses, 60
inter-subnet communications, 63–65
Internet C ontrol M essage Protocol
version 6 (IC M Pv6), 68–71
internetwork communications, 65–67
intra-subnet communications, 61–63
message, R edirect, 73–74
message options, 74
messages, error, 69–70
messages, informational, 70–71
N eighbor Advertisement, 62, 73
N eighbor Solicitation, 73
network performance, 61
plug-and-play, 61
R outer Advertisement, 64, 72
R outer Solicitation, 72
security, 61
upper-layer protocol issues, 67–68
See also Benefits of IPv6; Internet
Protocol version 4 (IPv4)
comparison; N eighbor Discovery
(N D)
area command, 214
Areas of routing protocols, 213
AR IN . See American R egistry for
Internet N umbers 
AR P. See Address R esolution Protocol 
Asia Pacific N etwork Information
C entre (APN IC ), 120, 130,
137–138
Asynchronous Transfer M ode (AT M ),
168
AT M . See Asynchronous Transfer M ode 
AToM . See Any Transport over M PLS 
Authentication, 12, 19, 268, 275
authentication data field, 102–103
Authentication header, 52, 101–104,
112, 270
Authorization, 12, 19
Autoconfiguration
IPv6 addresses, 42–44
stateful, 65–66
stateless, 62, 64
unspecified addresses, 132
Autonomous BGP systems, 219–220
Auxiliary password, 14
Auxiliary port, 3
B
Backbone, dual-stack, 252–253
Bellman-Ford algorithm, 186–187
Benefits of IPv6
addressing hierarchy, 36–41
anycast address, 48–50

346
Index
autoconfiguration of addresses, 42–44
IP address size, 35–36
mobility, 53–54
performance, 54–55
scalability of multicast routing, 44–48
security, 52–53
simplified host addressing, 41–42
streamlined header, 50–52
BGP. See Border Gateway Protocol 
Binding U pdate message, 53–54
BIT S. See Bump In the Stack method
BIT W. See Bump In the W ire method
Block-oriented encryption, 275
boot command, 12
Border Gateway Protocol (BGP)
autonomous systems (AS), 220
bgp router-id command, 225
current state, 306
extensions, configuring, 221–232
link-local addresses, configuring,
226–228
metrics, 220–221, 228
multiprotocol extensions, 219–221
neighbor relationships, configuring,
221–225
neighbors, 220
peer groups, 226
redistribution of routes, 228–231
route instability, 39–40
route redistribution, 203
router IDs, configuring, 225–226
show bgp command, 19
troubleshooting, 304–308
verifying operation, 231–232
See also show commands
Bump In the Stack (BIT S) method,
257–258, 273
Bump In the W ire (BIT W ) method,
273–274
C
C able, rolled-R J45, 3–4, 31
C C O. See C isco C onnection O nline 
C E routers. See C ustomer Edge routers
C EF. See C isco Express Forwarding 
C ell phones, IPv6, 53–54
C ertificates, 275, 293
C hecksum calculation, 68
checksum field, 51, 55
C IDR . See C lassless Inter-Domain
R outing 
C ircuit transport over M PLS, 251–252
C isco C onnection O nline (C C O ), 3
C isco Express Forwarding (C EF), 19
C isco Internetwork O perating System
(IO S)
features, 2
minimum requirements, 241
See also C isco IO S version
C isco IO S version
adjusting IC M Pv6 rate limit, 172
configuring name servers, 167
finding correct version, 183
hundreds of versions available, 3
Internet Protocol version 6 (IPv6),
160–161, 237
show commands, 174
upgrading, 174
C isco technical assistance (TAC ), 3
C lass B address space, exhaustion of, 34
C lassless Inter-Domain R outing
(C IDR )
aggregation blocks, 120
description, 125

Index
347
disadvantages, 57
IPv4 stopgap, 60, 114
clear command, 9
C LN P. See C onnectionless N etwork
Protocol 
C LN S. See C onnectionless N etwork
Service 
clns routing command, 214, 216
clock command, 12
C olons, double (::), 124–125
C ommands for configuring routers
ambiguous, 28
list of, 9–11
partial commands, 27
using, 11–13
C ommunications
fundamentals, 61–67
inter-subnet, 63–65
internetwork, 65–67
intra-subnet, 61–63
between IPv6 and IPv4 hosts., 255
troubleshooting, 298–299
C omparison, IPv4 versus IPv6. See
Internet Protocol version 4 (IPv4)
comparison
C ompatibility, 12
C onfidentiality, 269–270
config-register command, 12
C onfigM aker tool, 8
C onfiguration mode
enabling IPv6 on routers, 161
entering LAN  addresses in routers, 162
exiting, 11
R IP configuration, 196–197
configure command, 11–13
C onfiguring
BGP extensions, 221–232
BGP neighbor relationships, 221–225
BGP peer groups, 226
interfaces, 15–18
IS-IS for IPv6, 215–217
link-local addresses, 226–228
router IDs, 225–226
R outing Information Protocol (R IP),
194–195
See also C onfiguring IPv6 addressing;
C onfiguring routers
C onfiguring IPv6 addressing
Asynchronous Transfer M ode (AT M ),
168–169
C isco IO S version, 160–161, 167
Domain N ame System (DN S),
166–167
duplicate address detection, 165–166
Frame R elay, 169–172, 249–251
IC M Pv6, 178–179
LAN  addresses, 162–167, 176–177
N eighbor discovery, 173, 178–179
verification, 174–179
WAN  addresses, 168–172, 177–178
C onfiguring routers
commands, list of, 9–11
commands, using, 11–13
intimidation, 2
modes, 9
passwords, 13–15
Web-based configuration, 8
See also C onfiguring IPv6 addressing
connect command, 9
C onnecting to routers, 1–8
C onnection integrity, 270
C onnectionless N etwork Protocol
(C LN P), 115–116

348
Index
C onnectionless N etwork Service
(C LN S), 213–214
See also N etwork Service Access Point
(N SAP) addresses
C onnectors, 3–4, 31
C onsole password, 13–14
C onsole port connections, 3–6
C ontrol-key shortcuts, 28
C onvergence, 187
C onversion, decimal to hexadecimal,
121–124
C ounting to infinity, 192–193
C ryptographic mechanisms
algorithms, 275–276
overview, 276
Security Policy Database (SPD),
277–278
C SU / DSU, 297
C ustomer Edge (C E) routers, 251
D
DAD. See Duplicate address detection 
Dampening, route, 39
Data-link connection identifiers
(DLC Is), 168, 171, 251
Data origin authentication, 270
Data speed, 31
Data tampering, 268
Data theft, 268
debug commands, 308–312
Decimal-to-hexadecimal conversion,
121–124
Dedicated links, 248–251
default command, 12
default-information command, 198–199
Default routes, 198–200, 217
Depletion of IP addresses, 60
Deployment
Bump In the Stack (BIT S) method,
257–258
dual-stack backbone, 252–253
dual-stack routers, 242
Dual-Stack Transition M echanism
(DST M ), 258
methods, 241–251
M ulti-Protocol Label Switching
(M PLS), 251–252
N etwork Address Translation (N AT ),
256–257
prospects, 157
protocol translation mechanisms,
256–259
quality of service (Q oS), 118
Socks-based IPv6/ IPv4 gateway,
258–259
strategies, 240–241
T C P-U PD R elay, 257
translation between IPv4 and IPv6,
255–259
tunnels, automatically configured,
245–248, 263
tunnels, manually configured, 242–245,
262
tunnels on C E routers, 251
tunnels on PE routers, 252
Description, 87–91
destination field, 86
Destination O ptions header, 88,
106–107
Destination U nreachable error message,
69, 315
DH C P. See Dynamic H ost
C onfiguration Protocol 
Diagnostic messages, 69–70
Diffie-H ellman key agreement, 276

Index
349
DiffServ (Differentiated Services) group,
117–118
disable command, 9, 11
Disabled interfaces, 298
disconnect command, 10
Discovery. See M ulticast Listener
Discovery (M LD); N eighbor
Discovery (N D) protocol; Path
M T U  Discovery function
DLC Is. See Data-link connection
identifiers (DLC Is)
DN S. See Domain N ame Service;
Domain N ame System 
do command, 12
Domain N ame Service (DN S), 49, 242
Domain N ame System (DN S), 68,
166–167
Double colons (::), 124–125
Down/ down status, 297
downward-compatible-config command, 12
DST M . See Dual-Stack Transition
M echanism 
Dual IPv6 addressing, 151–152
Dual-stack backbone, 252–253
Dual-stack migration method, 313
Dual-stack routers, 242
Dual-Stack Transition M echanism
(DST M ), 258
Duplicate address detection (DAD),
165–166, 297, 311
Dynamic H ost C onfiguration Protocol
(DH C P), 20, 66
E
Echo messages, 10
Efficiency, 27–28, 118
See also O verhead
EIGR P. See Enhanced Interior Gateway
R outing Protocol 
enable command, 10, 12
enable password, 15
enable secret password, 15
Enabling IPv6 on routers, 161
Encapsulating Security Payload header,
104–106
Encapsulation
Generic R oute Encapsulation (GR E),
244, 263
ipv6ip, 244
Encrypted Security Payload (ESP)
header, 52–53, 270
Encryption, block-oriented, 275
End System-to-Intermediate System
(ES-IS), 136
Enhanced Interior Gateway R outing
Protocol (EIGR P), 186, 233
Equipment requirements, 266
Error messages, 69–70, 89, 315
ES-IS. See End System-to-Intermediate
System
ESP. See Encrypted Security Payload
header
EU I. See Extended U nique Identifier 
EU I-64 format, 132–133, 146–147, 163
exit-address-family command, 217
exit command, 10–11
Exiting configuration mode, 11
Extended access lists, 287
Extended U nique Identifier (EU I),
162–163
See also EU I-64 format
extension header length field, 96
Extension headers
Authentication header, 101–104
description, 87–91

350
Index
Destination O ptions header, 88,
106–107
Encapsulating Security Payload header,
104–106
Fragment header, 98–101
H op-by-H op O ptions header, 87,
91–94
N ext H eader values, 87
R outing header, 94–98
security, 270–271
Exterior gateway protocols (EGPs), 219
F
Fail-over, 49
FAQ. See Frequently Asked Q uestions 
FDDI. See Fiber Distributed Data
Interface 
Features, IPv4 versus IPv6, 59–60
Fiber Distributed Data Interface
(FDDI), 162
Filtering IPv6 R IP routing, 205–208
First-bits standards, 126
Flapping, route, 39, 54, 75
Flash Load H elper (FLH ), 20
flow label field, 84, 118
Flush timer, 194–195
Format Prefix (FP), 127–128, 146
Formats
error messages, 70
IPv6 addresses, 56
multicast addresses, 46
Type-Length-Value (T LV), 89
See also Address format illustrations;
H eader illustrations
4over6 tunnel, 245–247
FP. See Format Prefix
Fragment header, 98–101
fragment offset field, 94, 99–100
Fragmentation
example, 101
Fragment header, 98–101
hop-by-hop, 51
intermediate node, 55
overhead, 98
Path M T U  Discovery function, 65
related fields, 86
Frame of IPv6 transmission, 52
Frame R elay, 169–172, 249–251
Frequently Asked Q uestions (FAQ )
addressing in IPv6, 157–158
architecture of IPv6, 79–80
C isco IO S introduction, 31–32
configuring IPv6 addressing, 183–184
deploying IPv6 on C isco IO S, 266
headers in IPv6, 111–112
monitoring and troubleshooting,
323–324
routing IPv6 on C isco IO S, 237–238
security, 292–293
Future developments, 149–154, 232–233
G
Generic R oute Encapsulation (GR E),
244, 263
Global addresses, 162
Globally R outable U nicast addresses,
35–37, 127–130, 136
Graphical user interface (GU I), 7–8
Group addresses, 45
group ID field, 142
GU I. See Graphical user interface

Index
351
H
header checksum field (IPv4), 86
H eader fields
authentication data, 102–103
destination, 86
extension header length, 96
flow label, 84
fragment offset, 94, 99–100
header checksum (IPv4), 86
header length (IPv4), 85
hop limit, 67, 84, 86
N ext H eader, 84, 87
options (IPv4), 86
payload data, 104
payload length, 84
protocol (IPv4), 84, 86
sequence number, 102
source, 86
T ime To Live (T T L) (IPv4), 67, 84, 86
total length (IPv4), 84–86
traffic class, 84
type of service (IPv4), 84–85
version, 84–85
H eader illustrations
Authentication, 102
Destinations O ptions, 107
Encapsulation Security Payload, 105
Fragmentation, 99, 101
H op-by-H op O ptions, 92, 93
Internet Protocol version 4 (IPv4), 85,
189
Internet Protocol version 6 (IPv6), 51,
83, 116–117, 314
Internet Security Association and K ey
M anagement Protocol (ISAK M P),
281
PadN  O ption, 91
R outing, 95, 97
R outing Information Protocol (R IP),
281
T LV-Encoded O ption, 89
transport mode, 103, 105
tunnel mode, 104, 106
header length field (IPv4), 85
H eaders
Authentication header (AH ), 52,
101–104, 112, 270
Encrypted Security Payload (ESP)
header, 52–53, 270
Internet Protocol version 4 (IPv4)
comparison, 58–59, 84–87
length, 83
streamlined format, 50–52
structure analysis, 83–84
See also Extension headers; H eader
fields; H eader illustrations
H eadings, IPv4 versus IPv6, 58–59
help command, 10
H exadecimal notation, 121–124
H ierarchical aggregation, 140
H ierarchical topology, 130
H istory of IP addresses, 115–116
H M AC. See Keyed-hash message
authentication code 
H old-down interval timer, 194
H op-by-hop fragmentation, 51, 55
H op-by-H op O ptions header, 87, 91–94
H op counting, 192–193, 230
hop limit field, 67, 84, 86
H orizon, split, 191–192
H ost addressing, 41–42
H ost names, mapping to addresses, 167
hostname command, 12
H yperTerminal software, 4–6, 31

352
Index
I
IAN A. See Internet Assigned N umbers
Authority 
IC M Pv6. See Internet C ontrol M essage
Protocol version 6
IC V. See Integrity C heck Value 
Identity protection, 284
IDR P. See Interdomain R outing
Protocol 
IET F. See Internet Engineering Task
Force 
IGM P. See Internet Group M anagement
Protocol; Internet Group
M embership Protocol
IGP. See Interior gateway protocols 
IK E. See Internet K ey Exchange 
Implementation status of IPv6, 79
Independently assigned address space,
153
Infinity, counting to, 192–193
Informational messages, 70–71
Instability, BGP, 39
Integrated IS-IS, 214–215
Integrity C heck Value (IC V), 103
Integrity verification, 268
Inter-Domain M ulticast R outing
working group, 45
Inter-subnet communications, 63–65
Interdomain R outing Protocol (IDR P),
136
interface command, 15, 288
Interface identifiers (interface IDs), 127,
129–130, 132–133
interface tunnel command, 245
Interfaces
configuration, 15–18
disabled, 298
stalled, 298
Interior gateway protocols (IGPs), 48,
219
Intermediate System-to-Intermediate
System (IS-IS)
areas of routers, 213
C LN S addresses, 214
configuring for IPv6, 215–217
default routes, 217
description, 210–211, 213–214
integrated IS-IS, 214–215
link-state advertisements (LSAs),
211–212
link-state database, 213
maximum paths, 218
neighbor relationships, 212
O SI model, 136
route redistribution, 204, 218–219
International O rganization for
Standardization (ISO ), 136
See also O pen System Interconnection
reference model
Internet Assigned N umbers Authority
(IAN A), 130, 246, 283
Internet C ontrol M essage Protocol
version 6 (IC M Pv6), 68–71,
178–179, 313–315
Internet Engineering Task Force (IET F),
50–52, 115
Internet Group M anagement Protocol
(IGM P), 60
Internet Group M embership Protocol
(IGM P), 69, 248
Internet K ey Exchange (IK E), 272–273,
276, 280–286
Internet Protocol N ext-Generation
Working Group (IPN GW G), 149
Internet Protocol version 4 (IPv4)
comparison

Index
353
address administration, 56–58
addressing structure, 36, 56
features, 59–60
headers, 58–59, 84–87
interfaces, affects on, 148
Internet Protocol version 5 (IPv5), 80,
116
Internet Protocol version 6 (IPv6),
architecture of. See Architecture of
IPv6; Benefits of IPv6; Internet
Protocol version 4 (IPv4)
comparison
Internet R egistries (IR s), 120, 130
Internet Security Association and Key
M anagement Protocol (ISAK M P),
273, 280–286
Internet services/ applications, 240
Internet sites. SeeWeb sites
Internetwork communications, 65–67
Internetwork O perating System (IO S).
See C isco Internetwork O perating
System (IO S)
Internetwork Packet Exchange (IPX )
addresses, 116, 137
Intimidation, 2
Intra-Site Automatic Tunnel Addressing
Protocol (ISATAP), 247–248, 263
Intra-subnet communications, 61–63
Inverse neighbor discovery, 169
IO S. See C isco Internetwork O perating
System (IO S)
IP address size in IPv6, 35–36
IP addresses, depletion of, 60
ip command, 12
ip router is-is command, 214
IP Security (IPSec), 61
authentication options, 275
cryptographic algorithms, 275–276
cryptographic mechanisms, 276–286
extension headers, 52–53, 270–271
implementation options, 273–274
Internet K ey Exchange (IK E),
272–273, 280–286
IPv6 versus IPv4, 292
overview, 268–270
passwords, router access, 13–15
perimeter security, 286–288
Secure Sockets Layer (SSL), 269–270
security association (SA), 272,
278–280, 282
Security Policy Database (SPD),
277–278
selectors, 277–278
transport mode, 271–272
tunnel mode, 271–272
virtual private networks (VPN s), 292
IP spoofing, 268, 270
IPN GW G. See Internet Protocol N ext-
Generation Working Group 
IPSec. See IP Security 
IPv4. See Internet Protocol version 4
comparison
IPv4 versus IPv6, 56
IPv6. See Architecture of IPv6; Benefits
of IPv6; Internet Protocol version
4 comparison
ipv6 commands
configuration parameters, 13
host-name-to-address mappings, 167
ipv6 access-list, 287–288
ipv6 address, 168, 215
ipv6 icmp error-interval, 298, 318
ipv6 nd, 319–320
ipv6 prefix-list, 205–207
ipv6 router isis, 215

354
Index
ipv6 router rip, 196
ipv6 traffic-filter, 288
ipv6 unicast-routing, 161, 176, 242
ipv6 unnumbered, 164
See also Show commands
ipv6ip encapsulation, 244
IPX . See Internetwork Packet Exchange
addresses
IR s. See Internet R egistries 
IS-IS. See Intermediate System-to-
Intermediate System 
ISAK M P. See Internet Security
Association and Key M anagement
Protocol 
ISATAP. See Intra-Site Automatic Tunnel
Addressing Protocol 
ISO. See International O rganization for
Standardization 
Iterated tunneling, 280
J
Jumbo Payload option, 91, 93–94
K
Key agreement, Diffie-H ellman, 276
Keyed-hash message authentication code
(H M AC ), 275
L
Lambdas, 249
LAN  addresses, 162–167, 176–177
Layer 2 M edia Access C ontrol (M AC )
address, 36
Layer 3 addressing, 3
lifetime attribute, 151
line console 0 command, 14
Line speed, 31
Link-layer address resolution, 316
Link-local addresses, 133–135, 162, 164,
226–228, 324
Link-state advertisements (LSAs),
211–212
Link-state database, 213
Link-state routing protocols, 210–211
Links, dedicated, 248–251
Local-link addresses, 62
Local-use unicast addresses, 133–136
lock command, 10
logging command, 12
login command, 10
logout command, 10
Loopback addresses, 132
M
M AC. See M edia Access C ontrol
addresses
M anagement information bases 
(M IBs), 7
M apping host names to addresses, 167
M aximum paths, 218
maximum-paths command, 218
M aximum transmission unit (M T U ), 86,
100, 112
See also Path M T U  Discovery function
M bone Deployment working group, 45
M edia Access C ontrol (M AC ) addresses,
36, 41–42, 62, 132–133
M essages
Binding U pdate, 53–54
diagnostic, 70
error, 69–70, 89, 315
informational, 70–71
M ulticast Listener Discovery (M LD),
70

Index
355
N eighbor Discovery, 70
options, 74
R edirect, 73–74
M ethodology, planning, 254–255
M etrics of BGP, 220–221
M IBs. See M anagement information
bases 
M igrating to IPv6, 313
M inimum requirements, 241
M LD. See M ulticast Listener Discovery 
M obility in IPv6, 53–54
M odems, attaching to router, 14
M odes for configuring, 9
M onitoring and troubleshooting
analyzing traffic, 312–320
debug commands, 308–312
Internet C ontrol M essage Protocol
version 6 (IC M Pv6), 313–315
migrating to IPv6, 313
N eighbor Discovery (N D) protocol,
315–320
See also show commands
M PLS. See M ulti-Protocol Label
Switching 
mrinfo command, 10
mstat command, 10
mtrace command, 10
M T U. See M aximum transmission unit 
M T U  option, 74
M ulti-Protocol Label Switching
(M PLS), 118, 251–252
M ulticast Listener Discovery (M LD)
Internet C ontrol M essage Protocol
(IC M P), 310, 314
messages, 70
protocol, 60
M ulticasting
addresses, 141–145
description, 42–43
groups, 42
M ulticast Forum Web site, 45
reserved addresses, 143–145
scalability, 44–48
scoping, 46–47, 55
M ultihoming problem
description, 149–151
dual IPv6 addressing, 151–152
independently assigned address space,
153
portable address space, 152
multilink command, 12
M ultiple addresses, 183
M ultiprotocol BGP extensions, 219–221
N
name-connection command, 10
N AT. See N etwork Address Translation 
N AT  overload, 256
N AT-PT. See N etwork Address
Translation-Protocol Translation 
N C C. See N etwork C oordination
C entre
N D. See N eighbor Discovery protocol
N eighbor Advertisement, 62, 73, 311
N eighbor advertisement packets,
317–318
N eighbor cache entry states, 300
N eighbor Discovery (N D) protocol
address resolution, 55
Address R esolution Protocol (AR P),
173
configuration, 178–179
description, 173, 184, 312

356
Index
finding destination’s interface
identifier, 62–63
inverse, 169
messages, 70
monitoring and troubleshooting,
315–320
N eighbor Solicitation and
Advertisement, 73
R edirect message, 73–74
R outer Solicitation and
Advertisement, 72
tuning, 319–320
N eighbor relationships, 212
N eighbor Solicitation, 62, 73, 311
N eighbor solicitation packets, 317
N eighbor unreachability detection
(N U D), 315, 319
N eighbors in BGP, 220
net command, 215
netbios command, 12
N etwork Address Translation (N AT ), 58,
121
N etwork Address Translation-Protocol
Translation (N AT-PT ), 256–257
N etwork C oordination C entre (N C C ),
130
N etwork management systems (N M S),
7–8
N etwork performance, 61
N etwork Service Access Point (N SAP)
addresses, 115, 136–137, 214
See also C onnectionless N etwork
Service 
N ext-Generation Transition Working
Group (N GT R AN SW G), 153
N ext H eader field, 84, 87, 119
N ext H eader values, 87
N ext-hop determination, 316
N ext-Level Aggregation Identifier (N LA
ID), 38, 57, 127, 129, 246
N GT R AN SW G. See N ext-Generation
Transition Working Group 
N LA ID. See N ext-Level Aggregation
Identifier 
N M S. See N etwork management
systems 
no command, 12
no ipv6 nd dad attempts command,
165–166
N odes-required addresses, 147–149
N SAP. See N etwork Service Access
Point addresses
N U D. See N eighbor unreachability
detection
O
O akley key determination protocol, 280
O pen Shortest Path First (O SPF)
protocol, 184, 233
O pen System Interconnection (O SI)
reference model, 82, 115, 136
O ption Type identifiers, 89–90
O ptions (configuration), question mark
for, 9–18
O ptions (packet), delayed processing of,
89
options field (IPv4), 86
O SI. See O pen System Interconnection
reference model
O SPF. See O pen Shortest Path First
protocol
O verhead
address-translation, 54
fragmentation, 98
IC M P traffic, 303

Index
357
Internet Protocol version 6 (IPv6)
header, 111
routing, 54
See also Efficiency
P
Packet size, 111–112
Packet Too Big error message, 69
Packet types, 316
pad command, 10
Padding options, 91
Parameter Problem error message, 69, 89
parser command, 12
Partial commands, 27
Passwords, router access, 13–15
PAT. See Port Address Translation
Path M T U  Discovery function, 60, 65,
314
payload data field, 104
payload length field, 84, 118
Payload types of Internet Key Exchange
(IK E), 282–283
PE routers. See Provider Edge routers
Peer groups, 226
Peer impersonation, 268
Perfect forward secrecy (PFS), 286
Performance, network, 61
Performance in IPv6, 54–55
Perimeter security, 286–288
Perimeter topology, 274
Periodic updates, 187–189
Permanent virtual circuits (PVC s), 168
PFS. See Perfect forward secrecy (PFS)
ping command, 10
ping ipv6 command, 298
Planning methodology, 254–255
Plug and Play, 61
Point-to-Point Protocol (PPP), 10
Poison reverse, 193
Port Address Translation (PAT ), 58
Portable address space, 152
Ports, router console, 3–6
PPP. See Point-to-Point Protocol 
ppp command, 10
Pre-shared keys, 275, 293
Prefix, public routing topology, 128
Prefix boundaries, aggregation, 132
Prefix information option, 74
Prefixes and subnetting, 125–126,
137–141, 146–147, 157
Privileged mode, 9
Prompts, 11
Protection, identity, 284
protocol field (IPv4), 84, 86
Protocol translation mechanisms,
256–259
Provider Edge (PE) routers, 251
Public topology, 128
PVC s. See Permanent virtual circuits 
Q
Q uality of service (Q oS)
class map, 19
deployment, 118
header fields, 108
IPv4 versus IPv6, 253
manual tunnels, 244–245
permanent virtual circuits (PVC s), 249
service policy, 18
Q uestion mark for options, 9–18
Q uick mode, IK E phase 2, 285–286

358
Index
R
R edirect message, 73–74
R edirect packets, 318
R edirected header option, 74
redistribute command, 200–202, 228
R edistribution of routes, 200–205,
228–231
regexp command, 12
R eliability, 323
R enumbering, factors in, 141
R enumbering sites, 40
R eplay protection, 270
R equests for C omments (R FC s), 34, 79
R equirements of C isco IO S
equipment, 266
minimum, 241
R ES. See R eserved bits
R éseaux IP Européens (R IPE), 120,
130, 137–138
R eserved (R ES) bits, 127, 129
resume command, 10
R FC s. See R equests for C omments 
rif command, 12
R IP. See R outing Information Protocol 
R IPE. See R éseaux IP Européens 
R IPng. See R outing Information
Protocol N ext Generation 
R J-45 connectors, 3–4, 31
rlogin command, 10
R olled-R J45 cable, 3–4, 31
R outer Advertisement, 64, 72
R outer advertisement packets, 317–318
R outer Alert option, 91–92
router bgp command, 221
R outer console port, 3–6
R outer IDs, 225–226
router isis command, 214–215
router rip command, 196
R outer Solicitation, 72
R outer solicitation packets, 316–317
R outers
2500 model, 22
2501 model, 9
6PE routers, 252
attaching modems, 14
connecting to, 1–8
dual-stack, 242
prompts, 11
See also C onfiguring IPv6 addressing;
C onfiguring routers
R outes
announcements, 140
dampening, 39
flapping, 39, 54, 75
instability, 39–40
optimization, 96
redistribution, 200–205, 218–219
stability, 54
R outing by rumor, 188
R outing header, 94–98
R outing Information Protocol N ext
Generation (R IPng), 186, 196, 210
R outing Information Protocol (R IP)
administrative distance, 195
basic configuration, 196–198
convergence, 187
counting to infinity, 192–193
default routes, 198–200
description, 186
filtering IPv6 R IP routing, 205–208
flush timer, 194–195
hold-down interval timer, 194
Internet Protocol version 4 (IPv4), 186
multiple processes, 238

Index
359
periodic updates, 187–189
poison reverse, 193
route redistribution, 200–205
router rip command, 196
routing by rumor, 188
routing loops, 189–190
split horizon, 191–192
triggered updates, 190–191
update interval timer, 194
verifying IPv6 R IP operation,
208–210
R outing loops, 189–190
R outing overhead, 54
R SVP protocol, 91, 96, 111
S
SAs. See Security associations
Scalability of IPv6 multicast routing,
44–48
scop field, 142
Scoping, multicast, 46–47, 55
Secure Sockets Layer (SSL), 269–270
Security. See IP Security (IPSec)
Security associations (SAs), 272,
278–280, 282, 286
Security Parameter Index (SPI),
278–279
Security Policy Database (SPD),
276–278
sequence number field, 102
Serial-Line IP (SLIP), 10
service command, 12
Shortcuts, 27–28
show commands
basic show commands, 296–304
overview, 18–21
show bgp, 231–232, 304–308
show interface, 20–21, 25–26
show ipv6 access-list, 288
show ipv6 interface, 296, 298
show ipv6 neighbors, 300
show ipv6 neighbors ethernet0, 178
show ipv6 protocols, 201–202, 208–209,
301–302
show ipv6 rip, 208
show ipv6 route, 197, 209, 225, 300
show ipv6 traffic, 178, 303
show running-configuration, 23–25, 175
show version, 21–22, 160–161
verifying addressing configuration,
174–179
See also ipv6 commands
Simple IP Plus (SIPP), 116
Simple N etwork M anagement Protocol
(SN M P), 3, 7–8
Simplified host addressing in IPv6,
41–42
SIPP. See Simple IP Plus 
Site-Level Aggregation Identifier (SLA
ID), 57, 127, 129
Site-local addresses, 135–136, 162, 324
Site renumbering, 40
6Bone, 153–154, 157–158
6PE routers, 252
6to4 tunnel, 245–247, 323
Size of IPv6 address space, 36, 121
SK EM E key exchange mechanism, 280
SLA. See Site-Level Aggregation
Identifier 
SLIP. See Serial-Line IP
slip command, 10
Sniffers, 268
SN M P. See Simple N etwork
M anagement Protocol 

360
Index
Socks-based IPv6/ IPv4 gateway,
258–259
Software selection tool, 3
Solicitation
N eighbor, 62, 73
R outer, 72
Solicited N ode M ulticast address, 43
Solutions Fast Track
addressing in IPv6, 155–156
architecture of IPv6, 76–78
C isco IO S introduction, 30–31
configuring IPv6 addressing, 181–182
deploying IPv6 on C isco IO S,
262–265
headers in IPv6, 109–110
monitoring and troubleshooting,
321–323
routing IPv6 on C isco IO S, 235–237
security, 290–292
source field, 86
Source link-layer address option, 74
SPD. See Security Policy Database 
SPI. See Security Parameter Index 
Split horizon, 191–192
Spoofing, 268, 270
SSL. See Secure Sockets Layer 
Stability, route, 54
Stalled interfaces, 298
Standard access lists, 286–287
Stateful autoconfiguration, 65–66
Stateless autoconfiguration, 62, 64
Status of IPv6 implementation, 79
Streamlined header in IPv6, 50–52
Subnet masking, variable-length
(VLSM ), 188
Subnet-router anycast address, 146
Subnetting and prefixes, 125–126,
137–141, 146–147, 157
Support, development of, 232–233
Switched virtual circuits (SVC s), 168
Syntax compression, 124–125
systat command, 10
System information, showing, 10
T
T  bit, 46
TAC. See C isco technical assistance 
Target link-layer address option, 74
T B. SeeTunnel brokers 
T C P/ U DP over Bigger Addresses
(T U BA), 115
T C P-U PD R elay, 257
Telephony, IPv6, 53–54
telnet command, 10
telnet connections, 6–7
T EP. SeeTunnel end point 
terminal command, 10
Testing network (6Bone), 153–154,
157–158
T ime Exceeded error message, 69
T ime To L ive (T T L ) field (IPv4), 67, 84,
86
T imers, R outing Information Protocol
(R IP), 187, 194–195
T LA ID. SeeTop-Level Aggregation
Identifier
T LV. SeeType-Length-Value format
Token R ing, 162
Tool, software selection, 3
Top-Level Aggregation Identifier (T LA
ID), 37, 57, 127–129, 131, 246
Topology
hierarchical, 130

Index
361
perimeter, 274
public, 128
Topology prefix, 128
total length field (IPv4), 84–86
traceroute command, 10, 172–173, 298
Traffic, analyzing, 312–320
traffic class field, 84, 117–118
Transition from IPv4 to IPv6, 79–80
Translation between IPv4 and IPv6,
255–259
Translation migration method, 313
Transmission frame, IPv6, 52
Transport adjacency, 280
Transport mode, 103, 271–272, 293
See also Tunnel mode
Transport R elay Translator (T R T ), 257
Traps, 7
Triggered updates, 190–191
Troubleshooting and monitoring
analyzing traffic, 312–320
debug commands, 308–312
Internet C ontrol M essage Protocol
version 6 (IC M Pv6), 313–315
migrating to IPv6, 313
N eighbor Discovery (N D) protocol,
315–320
See also show commands
T R T. SeeTransport R elay Translator 
T T L field. See T ime To L ive (T T L ) field
(IPv4)
T U BA. SeeT C P/ U DP over Bigger
Addresses 
Tunnel brokers (T Bs), 248
tunnel command, 10
Tunnel end point (T EP), 244–245, 258
Tunnel mode, 103–106, 243–244,
271–272, 293
See also Transport mode
Tunneling migration method, 313
Tunnels
automatically configured, 245–248,
263
C ustomer Edge (C E) routers, 251
4over6 tunnel, 245–247
Intra-Site Automatic Tunnel
Addressing Protocol (ISATAP),
245–248, 263
iterated, 280
manually configured, 242–245, 262
Provider Edge (PE) routers, 252
quality of service (Q oS), 244–245
6to4 tunnel, 245–247, 323
Type-Length-Value (T LV) format, 89
type of service field (IPv4), 84–85
U
udptn command, 10
U nicast addresses, 35–37, 127–141
U nicast packets, 324
U nreachable destination, 69, 193, 315
U nspecified addresses, 132
U p/ down status, 297
U p/ up status, 297
U pdate interval timer, 187, 194
U pdates
periodic, 187–189
triggered, 190–191
U pper-layer protocol issues, 67–68
U R Ls. SeeWeb sites
U ser mode, 9
U ser profile, applying, 9
username command, 12

362
Index
V
Variable-length subnet masking
(VLSM ), 188, 211
Verifying BGP operation, 231–232
Verifying IPv6 addressing, 174–179
Verifying IPv6 R IP operation, 208–210
version field, 84–85, 117
Version of C isco IO S. See C isco IO S
version
Virtual private networks (VPN s)
benefits, 269
concurrent IPv6 and IPv4 tunnels, 240
definition, 268
perimeter topology, 274
site-to-site, 272
Virtual terminal (VT Y )
interfaces, 6
password, 14–15
VLSM . SeeVariable-length subnet
masking 
VPN s. SeeVirtual private networks 
VT Y. SeeVirtual terminal 
W
WAN  addresses, 168–172, 177–178
Web sites
American R egistry for Internet
N umbers (AR IN ), 154
Asia Pacific N etwork Information
C entre (APN IC ), 154
C isco IO S minimum requirements,
241
C isco technical assistance (TAC ), 3
C onfigM aker tool, 8
configuring IPSec for IPv4, 293
DiffServ (Differentiated Services)
group, 117–118
Inter-Domain M ulticast R outing
working group, 45
Internet C ontrol M essage Protocol
version 6 (IC M Pv6) header, 116
Internet C ontrol M essage Protocol
version 6 (IC M Pv6) specifications,
157
Internet Protocol N ext-Generation
Working Group (IPN GW G), 149
M bone Deployment working group,
45
M ulti-Protocol Label Switching
(M PLS) working group, 118
M ulticast Forum, 45
R equest for C omments (R FC ) 2460,
116
R éseaux IP Européens (R IPE), 154
6Bone practices, 154
tunnel brokers (T Bs), 248
where command, 10
X
x3 command, 10
x28 command, 10


SYNGRESS SOLUTIONS…
s o l u t i o n s @ s y n g r e s s . c o m
AVAILABLE AUGUST 2002!
ORDER at
www.syngress.com
Configuring Cisco Voice Over IP, Second Edition
Configuring Cisco Voice O ver IP, Second Edition demonstrates how to configure all
of Cisco’s core VoIP products— among them Cisco CallM anager software, Cisco
7910 series phones, and server-based IP PBXs. N ow updated with coverage of
Cisco’s AVVID enterprise solutions, the book continues to supply hands-on guidance
for implementing Q oS (Q uality of Service) features to reduce network latency and
jitter, plus case studies illustrating real-world VoIP configuration and troubleshooting
strategies.
ISBN : 1-931836-64-7
Price: $69.95 USA , $108.95 CA N  
Managing Cisco Network Security, 
Second Edition
Information security has become an extremely important topic over the past few
years. In today’s environment the number of touch points between an organization’s
information assets and the outside world has drastically increased. M illions of cus-
tomers interact via W eb sites, employees and partners connect via Virtual Private
N etworks, applications are outsourced to A pplication Service Providers (A SPs) and
wireless LA N s are regularly deployed. Cisco Systems has placed a high priority on
security and offers a wide range of security products. M anaging Cisco N etwork
Security, Second Edition is important to anyone involved with Cisco networks, as it
provides practical information on using a broad spectrum of Cisco’s security products.
ISBN : 1-931836-56-6
Price: $59.95  USA  $92.95  CA N
Building a Cisco Wireless LAN
W ireless LA N  (W i-Fi) technology is significantly more complex than cordless
telephony; loss, coverage, and bandwidth requirements are much more stringent and
the proliferation of wireless LA N s in corporate environments has resulted in interesting
security challenges. IEEE 802.11-based products offered by Cisco Systems have
quickly become one of the foundational technologies fostering the untethering of data
communications. Building a Cisco W ireless LA N will bring you up to speed fast with
Cisco W i-Fi technology.
ISBN : 1-928994-58-X
Price: $69.95 USA   $108.95 CA N
AVAILABLE NOW!
ORDER at
www.syngress.com
AVAILABLE NOW!
ORDER at
www.syngress.com


