
Topic 1
Subject
Calculating my tax automatically in Excel
Question
It's my very first post here so hi all. I did a lot of research before hand but
couldn't find the answer I was looking for.
I want a spreadsheet in Google Sheets to automatically calculate my tax.
€0 - €11000 w/ 0%
€11000 - €18000 w/ 25%
€18000 - €31000 w/ 35%
€31000 - €60000 w/ 42%
€60000 - €90000 w/ 48%
€90000 - €1000000 w/ 50%
€1000000+ w/ 55%
So the first 11k are taxed with 0% the next 7k are taxed with 25% etc.
What I've had the following thought - give that F9 are my before tax earnings:
=IF(0<=F9<=11000,SUM(F9*0%),(IF(11000<F9<=18000,SUM((F9-
11000)25%),(IF(18000<F9<=31000,SUM((700025%)+((F9-
18000)*35%),SUM(F9))))))
Unfortunately it just won't work.
Am I using the right function?
Is there anything out there which would make it much easier?
Thank you for your help.
Answer
Here is an example (Excel) for your problem:
In Cell A1 is your Money, paste the code in A2 for example:

=WENN(A1>10000;"10%";WENN(A1>7000;"7%";WENN(A1>5000;"5%";W
FK
Answer
Excel does not work that way X<y<z. Plus it resolves in order so it is not
necessary:
=IF(F9<=11000,SUM(F9*0%),(IF(F9<=18000,SUM((F9-11000)25%),
(IF(F9<=31000,SUM((700025%)+((F9-18000)*35%),SUM(F9))))))
if it is less than 11000 then the first will fire and none others. then if greater
than 11000 but less than 18000 the second will fire, and so on.
Answer
List values of each bracket range with the percentage applied if it is above that
amount, for example:
A B
1 11000 0.25
2 18000 0.35
3 31000 0.42
4 60000 0.48
5 90000 0.50
6 1000000 0.55
You can format the percentage values as percentages if you prefer. What is
important is that the value is a decimal and not a string.
Then you can use the MATCH function to determine the row of the first value
that is larger than your income. So if the cell holding your income is F9, you'd
have:
=MATCH(F9;A1:A6;1)
But this only returns the row number. If we want to retrieve the tax applied,
we'll need to use this to pinpoint the value in column B pertaining to that. To

get a value pertaining at a certain point dynamically, we use INDEX.
So putting it together, you'd have:
=INDEX(B1:B6; MATCH(F9; A1:A6; 1); 1)
One minus this times the value in F9 to get the amount after taxes:
=F9*(1 - INDEX(B1:B6; MATCH(F9; A1:A6; 1); 1))
Why would you do it this way? It lets you change the values in an intuitive
fashion without having to parse a long and arduous formula. You can also add
new values with relative ease. Just remember to adjust the A1:A6 and B1:B6
ranges.
Good luck! Let me know how it turns out!
Answer
You might want to try this:
=if(F9<=0,"Error",IF(F9<=11000,0,(IF(F9<=18000,(F9-11000)*25%,
(IF(F9<=31000,1750+(F9-18000)*35%,IF(F9<=60000,6300+(F9-
31000)*0.42,if(F9<=90000,18480+(F9-
60000)*0.48,IF(F9<=1000000,32880+(F9-90000)*0.5,487880+(F9-
1000000)*0.55)))))))))
Topic 2
Subject
Vlookup combined with first following date in list
Question
I have two separate tables each consisting of a "container number" column, and
"date" field.
In sheet 1 I want to create an excel formula in a new column 3 to look up a date
in sheet 2. This date should be the date first found but subsequent or equal to
"sheet1/columnB date" for a given container number.

For example:
Sheet 1
MMAU1109032 15/2/2015 ..16/1/2015
MMAU1109032 20/2/2015 ..20/2/2015
MMAU1109285 27/11/2015 ..29/11/2015
Sheet 2:
MMAU1108695 30/11/2015
MMAU1108859 26/3/2015
MMAU1109032 16/1/2015
MMAU1109032 20/2/2015
MMAU1109285 29/11/2015
MMAU1110033 30/12/2014
MMAU1110054 30/9/2015
MMAU1110687 26/1/2015
An idea anyone?
Answer
If you have 2010 or later then use this regular formula:
=AGGREGATE(15,6,Sheet2!$B$1:$B$8/((Sheet2!$A$1:$A$8=A1)*
(Sheet2!$B$1:$B$8>=B1)),1)
If you have 2007 or earlier you will need to use this Array formula:
=SMALL(IF(((Sheet2!$A$1:$A$8=A1)*
(Sheet2!$B$1:$B$8>=B1)),Sheet2!$B$1:$B$8),1)
Being an Array it needs to be confirmed with Ctrl-Shift-Enter instead of Enter
or Tab when leaving edit mode.
Column C contains the AGGREGATE() and D the Array SMALL().
Topic 3
Subject
Highlighting in vba excel

Question
I'm try to highlight all "output" in my worksheet but my code gives me a object
variable error on SearchString
Sub Sample()
Dim oRange As Range, aCell As Range, bCell As Range Dim ws As
Worksheet
Dim ExitLoop As Boolean
Dim SearchString As UniqueValues, FoundAt As String Dim iCount() As
String
Dim outws As Worksheet
Set ws = Worksheets("detail_report")
Set oRange = ws.Cells
SearchString = output
SearchString.DupeUnique = xlUnique
SearchString.Interior.Color = vbRed
Set aCell = oRange.Find(What:=SearchString, LookIn:=xlValues, _ 
              LookAt:=xlPart, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
              MatchCase:=False, SearchFormat:=False) 
If Not aCell Is Nothing Then 
      Set bCell = aCell 
      FoundAt = aCell.Address 
      Do While ExitLoop = False 
          Set aCell = oRange.FindNext(After:=aCell) 
          If Not aCell Is Nothing Then 
              If aCell.Address = bCell.Address Then Exit Do 
              FoundAt = FoundAt & ", " & aCell.Address 
          Else 
              ExitLoop = True 
          End If 
      Loop 

       iCount = Split(FoundAt, ", ") 
      Set outws = Worksheets("output") 
      outws.Range("A1").Value = SearchString 
     outws.Range("B1").Value = UBound(iCount) + 1 
Else
MsgBox SearchString & " not Found" End If
MsgBox "The Search String has been found in these locations: " & FoundAt
Exit Sub
Err
MsgBox Err.Description
End Sub
Topic 4
Subject
Getting “WARNING: Augmenter should be applied to the instances of
@Augmentable classes or previously augmented instances only”
Question
The below function to convert a csv file to Excel was working fine till recently
now I get a warning message.
warning Feb 11, 2016 8:52:00 AM org.openqa.selenium.remote.Augmenter
extractRemoteWebDriver WARNING: Augmenter should be applied to the
instances of @Augmentable classes or previously augmented instances only
Feb 11, 2016 8:52:00 AM org.openqa.selenium.remote.Augmenter
extractRemoteWebDriver WARNING: Augmenter should be applied to the
instances of @Augmentable classes or previously augmented instances only
And My automation test case fails with out converting the csv to excel.
I did try doing debugging by putting the Sys out statement. In try block 1 is

printed but the next sys out "csvFileAddress in TRY block 2" does not prints
so I believ there is something wrong with this lines.
XSSFWorkbook workBook = new XSSFWorkbook(); XSSFSheet sheet =
workBook.createSheet("sheet1");
public void csvToXLSX(String csvFileAddress, String xlsxFileAddress)
{ 
      try 
      { 
          System.out.println("In TRY block 1"); 
          Thread.sleep(1000); 
          XSSFWorkbook workBook = new XSSFWorkbook(); 
          XSSFSheet sheet = workBook.createSheet("sheet1"); 
          System.out.println("csvFileAddress in TRY block
2"); 
          String currentLine=null; 
          int RowNum=0; 
          BufferedReader br = new BufferedReader(new
FileReader(csvFileAddress)); 
          System.out.println("in TRY block 3"); 
          while ((currentLine = br.readLine()) != null) 
          { 
              System.out.println("In while loop"); 
              String str[] = currentLine.split(","); 
              XSSFRow currentRow=sheet.createRow(RowNum); 
              for(int i=0;i<str.length;i++) 
                
currentRow.createCell(i).setCellValue(str[i]); 
              RowNum++; 
          } 
          FileOutputStream fileOutputStream =  new
FileOutputStream(xlsxFileAddress); 
          workBook.write(fileOutputStream); 
          fileOutputStream.close(); 
          report.addReportStep("Converting CSV to Excel" ,
"Conversion successfull", StepResult.PASS); 
      } catch (Exception ex) 
      { 
          report.addReportStep("Converting CSV to Excel" ,
"Conversion unsuccessfull", StepResult.FAIL); 

          System.out.println(ex.getMessage()+"Exception in
try"); 
      } 
}
Please suggest what's wrong
Topic 5
Subject
How to do filter in VBA for the last three days?
Question
I use VBA EXCEL and I need to to filter for row to the last 3 days. For
example: Today it's 02.11 and i dont want to see days 11.02, 10.02 and 09.02.
I tried to do this with the macro:
ActiveSheet.Range("$A$1:$AB$11153").AutoFilter Field:=10, Operator:= _
xlFilterValues, Criteria2:=Array(2, "1/12/2016", 2, "1/13/2016", 2,
"1/17/2016", 2, _ "1/18/2016", 2, "1/20/2016", 2, "1/21/2016", 2,
"1/22/2016", 2, "1/23/2016", 0, _ "12/21/2015")
but its for spastic days and i need the last three days? Answer
The key to building criteria for the AutoFilter method is realizing that it must
be a string. If you are comparing dates, the date that you supply must be in the
same format as those that you are comparing against. Even a slight difference
such as criteria posted as m/d/yyyy against values displayed as mm/dd/yyyy is
sufficient to produce unreliable results.
With Worksheets("Sheet2")
If .AutoFilterMode Then .AutoFilterMode = False With .Cells(1,
1).CurrentRegion 
      .Columns(10).AutoFilter Field:=1, _ 
          Criteria1:=Chr(62) & Format(Date - 3, .Cells(2,

10).NumberFormat) 
End With
End With
With this filter, we are constructing the date criteria using the cell formatting
(e.g. Range.NumberFormat property) found in the second row of the filtered
column.
Topic 6
Subject
Why mysql odbc connector 64 bits does not work well with VBA despite my
system is running fully on 64 bits?
Question
I am writing a simple VBA that inserts a query to my local MySQL database.
With Mysql ODBC Connector 64bit Installed.
Private Sub CommandButton1_Click()
Dim c As ADODB.Connection
Dim r As ADODB.Recordset
Set c = New ADODB.Connection
strCon = "Driver={MySQL ODBC 5.1
Driver};SERVER=127.0.0.1;DATABASE=DATABASENAME;UID=USER;PW
Dim rw As Integer
c.Open strCon
sq = "INSERT INTO `DATABASE`.`TABLE` (`ID`, `title`) VALUES ('1',
'SOMETITLE');"
Set r = c.Execute(sq)
c.Close
End Sub

And added the reference
Tools > References >"Microsoft ActiveX Data Objects 2.5 Library"
When I test it it gives me the error below
Run-time error '-2147467259 (80004005)':
[Microsoft][ODBC Driver Manager] Data source name not found and no
default driver specified
When I install Mysql ODBC Connector 32bit everything works.
Yet, my question is Why would the 32 bit work? Despite my system is 64 bits
and MySQL is also 64 bit . Why would the 64 bit version giving me such error,
yet 32 bit worked?
Topic 7
Subject
Exported CSV Formatting Issues
Question
I have a macro that Macro Man created for me that exports an excel table by
range to a csv. When I run the macro the formatting of the csv is not what I am
looking for. For instance, the last column in the spreadsheet is a money value
(100.25), but when I convert it I get a value like 100.2542. Is there anywhere
in the macro I can insert a command allowing me to correct or change the
formatting to the correct format? Thanks for any help in advance.
Sub MacroMan()
ChDrive "P:" '// <~~ change current drive to P:\ Dim copyRng As Excel.Range
Dim ThisWB As Excel.Workbook
Dim OtherWB As Excel.Workbook
Dim sName As String
'// set reference to the 'Master' workbook Set ThisWB = ActiveWorkbook
'// assign selected range to 'copyRng'

Set copyRng = Application.InputBox(Prompt:="Select range to convert to
CSV", Type:=8)
'// If the user selected a range, then proceed with rest of code: If Not copyRng
Is Nothing Then
'// Create a new workbook with 1 sheet. Set OtherWB = Workbooks.Add(1)
'// Get A1, then expand this 'selection' to the same size as copyRng. '// Then
assign the value of copyRng to this area (similar to copy/paste)
OtherWB.Sheets(1).Range("A1").Resize(copyRng.Rows.Count,
copyRng.Columns.Count).Value = copyRng.Value
'// Get save name for CSV file.
sName = Application.GetSaveAsFilename(FileFilter:="CSV files (*.csv),
*.csv")
'// If the user entered a save name then proceed: If Not LCase(sName) = "false"
Then
'// Turn off alerts
Application.DisplayAlerts = False
'// Save the 'copy' workbook as a CSV file OtherWB.SaveAs sName, xlCSV
'// Close the 'copy' workbook
OtherWB.Close
'// Turn alerts back on
Application.DisplayAlerts = True
End If
'// Make the 'Master' workbook the active workbook again ThisWB.Activate
MsgBox "Conversion complete", vbInformation
End If
End Sub
Answer
I do not personally recommend this action. Currency is typically stored and

calculated to four decimal places when displayed to two decimal places. This
is to ensure accuracy with tax calculation, multiplication against quantities
expressed as mixed numbers and the totaling of a long column of numbers in a
complicated formula. Truncating off values to two decimal places will
inevitably get you 'losing a penny' somewhere.
With that said, that is what you want to do so here is how you do it.
'// If the user entered a save name then proceed: If Not LCase(sName) = "false"
Then
'// Turn off alerts
Application.DisplayAlerts = False
' set Precision As Displayed' - permanently truncates off numbers to the
displayed decimal places OtherWB.PrecisionAsDisplayed = True '// Save the
'copy' workbook as a CSV file OtherWB.SaveAs sName, xlCSV
' turn off Precision As Displayed' - numbers have been permanently changed;
you don't get back the lost decimal places OtherWB.PrecisionAsDisplayed =
False '// Close the 'copy' workbook
OtherWB.Close
'// Turn alerts back on
Application.DisplayAlerts = True
End If
Topic 8
Subject
MVC 5 How to upload Excel file and read rows till the last populated data
row using EPPlus (OfficeOpenXml) ExcelPackage
Question
I have a MVC file upload solution which uploads a Excel file, I am having an
issue with the Excel Package where it reads my Excel docs row right to the
end of the file using Dimension.End.Row property, I want to read till the last
populated row and not the entire spreadsheet rows as it bombs out my code
with a null reference error, the Excel is from an external source and it is a
locked file which has about 7000 rows, but only about 3000 rows are
populated with data, the Dimension.End.Row property reads the entire 7000
rows therefore when I loop though and map the rows and columns, after the

last populated data row 3001 on wards it has null values. How can I enable
this to read only the populated rows in the excel file, like I said I cannot
modify this file as its locked and read-only, I can only read it and upload it.
please see my code below.
[HttpPost]
public ActionResult Upload(FormCollection formCollection) { 
      if (Request != null) 
      { 
          HttpPostedFileBase file =
Request.Files["UploadedFile"]; 
          if ((file != null && file.ContentLength > 0 &&
!string.IsNullOrEmpty(file.FileName))) 
          { 
              string fileName = file.FileName; 
              string fileContentType = file.ContentType; 
              byte[] filebytes = new
byte[file.ContentLength]; 
              var data = file.InputStream.Read(filebytes, 0,
Convert.ToInt32(file.ContentLength)); 
              var suppleirList = new List<CleanSupplierClaim>
(); 
              using (var package = new
ExcelPackage(file.InputStream)) 
              { 
                  var currentSheet =
package.Workbook.Worksheets; 
                  var workSheet = currentSheet.First(); 
                  var noOfColumns =
workSheet.Dimension.End.Column; 
                  var noOfRows =
workSheet.Dimension.End.Row;// Here is where my issue is 
                  for (int rowIterator = 5; rowIterator <
noOfRows; rowIterator++) 
                  { 
                      var claim = new CleanSupplierClaim(); 
                      claim.Action =
workSheet.Cells[rowIterator, 1].ToString(); 
                      claim.Line_Number =
workSheet.Cells[rowIterator, 2].Value.ToString(); 

                      claim.Total_Claim =
workSheet.Cells[rowIterator, 3].Value.ToString(); 
                      claim.ClaimReference =
workSheet.Cells[rowIterator, 4].Value.ToString(); 
                      claim.Supplier_Claim =
workSheet.Cells[rowIterator, 5].Value.ToString(); 
                      claim.Currency =
workSheet.Cells[rowIterator, 6].Value.ToString(); 
                      suppleirList.Add(claim); 
                  } 
              } 
          } 
      } 
      return View("Index"); 
Answer
You can do something like this;
for (int rowIterator = 5; rowIterator < noOfRows; rowIterator++) { 
    if(workSheet.Cells[rowIterator, 1] == null)//can this be
null? 
    { 
      break; //if it's null exit from the for loop 
    } 
    var claim = new CleanSupplierClaim(); 
    claim.Action = workSheet.Cells[rowIterator,
1].ToString(); 
    claim.Line_Number = workSheet.Cells[rowIterator,
2].Value.ToString(); 
    claim.Total_Claim = workSheet.Cells[rowIterator,
3].Value.ToString(); 
    claim.ClaimReference = workSheet.Cells[rowIterator,
4].Value.ToString(); 
    claim.Supplier_Claim = workSheet.Cells[rowIterator,
5].Value.ToString(); 
    claim.Currency = workSheet.Cells[rowIterator,
6].Value.ToString(); 
    suppleirList.Add(claim); 

}
Topic 9
Subject
Concatenate cell data into another data if values matches
Question
I have two columns A and B in same excel sheet. I am trying that if in Column
B two values matches then it should copy related value A in same row.
For e.g
Table 
Column A      Column B 
xyz              1 
abc              1 
pqr              1 
eee              2 
qqq              3 
www              4 
oop              5 
Desierd Output 
column A         Column B 
xyz,abc,pqr         1 
eee                 2 
qqq                 3 
www                 4 
oop                 5 
Answer
You could probably use a User Defined Function (aka UDF) for this. Put this
into a module sheet.
Public Function conditional_concat_strs(rSTRs As Range, rCRITs As Range,

rCRIT As Range, Optional sDELIM As String = ", ")
Dim c As Long, sTMP As String
Set rSTRs = rSTRs.Cells(1, 1).Resize(rCRITs.Rows.Count,
rCRITs.Columns.Count) For c = 1 To rCRITs.Cells.Count 
      If rCRITs(c).Value2 = rCRIT Then 
          sTMP = sTMP & rSTRs(c).Value & sDELIM 
Next c
conditionalconcat_strs = Left(sTMP, Application.Max(Len(sTMP) -
Len(sDELIM), 0)) End Function
Use like any native worksheet function.
     
Answer
You can also use this one:
Public Sub combine()
Dim row, result, lastRow As Integer Dim isExist As Boolean
With Sheets("sheetname") 
      'get the last use row 
      lastRow =
.Range("A1").SpecialCells(xlCellTypeLastCell).row 
      'Loop from row 1 to last row 
      For row = 1 To lastRow Step 1 
          'set the start row for result. 
          result = 1 
          'Reset flag 
          isExist = False 
          'Loop result count column until blank 

          Do While .Range("F" & result) <> "" 
              'check count 
              If .Range("B" & row) = .Range("F" & result)
Then 
                  isExist = True 
                  'If old, combine 
                  .Range("E" & result) = .Range("E" & result)
& "," & .Range("A" & row) 
                  Exit Do 
              End If 
              'increase row 
              result = result + 1 
          Loop 
          'If new, add new record 
          If Not isExist Then 
              .Range("E" & result) = .Range("A" & row) 
              .Range("F" & result) = .Range("B" & row) 
          End If 
      Next row 
End With
End Sub
Here, testing evidence for my code:
I used column A & B as input and column E & F as output.
If there is any problem, let me know.
Answer
There's a formula solution for this as well (with helper columns):

Assuming data is column A:B ...
In C1 write this formula: =IF(A1<>A2,B2,D1&","&B2) In D1 write this
formula: =IF(A2<>A3,A2,"") Filter on column D for blanks and then deleted
the visible cells.
Topic 10
Subject
EXCEL IF / OR statements using ISBLANK
Question
I am trying to compare 5 Properties databases, I've dumped them into Excel
since the database can't use SQL, then took the time to overlap so that I can see
who shares the same values
I am using formula
=IF(OR(ISBLANK(A3),ISBLANK(B3),ISBLANK(C3),ISBLANK(D3),ISBLA
"NO", "ALL 5 Match")
to show me all 5 properties share this function, but I have some 2000 lines
where 4 of 5 or 3 of 5 match and I'd like to change the formula to tell me HOW
many cells are blank in the field, so if 1 Cell is blank it will list 4 Match, if 2
are blank it will list 3 match etc.
Thank you very much for any direction you can point me to. Answer
The forumla would look like
=5-
(ISBLANK(A3)+ISBLANK(B3)+ISBLANK(C3)+ISBLANK(D3)+ISBLANK(E
Logicals results can be treated like numbers, where 1 is true, and 0 is false. So
we sum up the true for blank, and subtract that from the number of possible
cells.
UPDATE
Jeeped's answer with COUNTBLANK is even cleaner:

=5-COUNTBLANK(A3:E3)
Answer
Assuming an Excel version of 2007 or higher the COUNTBLANK function
might be appropriate to get the number of blanks or the the older COUNTA
function will return the number of non-blank cells.
The CHOOSE function can return a result from a series of responses.
=CHOOSE(COUNTBLANK(A3:E3)+1, "none blank", "one blank", "two
blanks", "three blanks", "four blanks", "five blanks")
=CHOOSE(COUNTA(A3:E3)+1, "none filled", "one filled", "two filled",
"three filled", "four filled", "five filled")
The CHOOSE function works on a 1 based index so 1 must be added to avoid
zero.
Topic 11
Subject
Oracle 11g ado connection strings for ODBC (not OLEDB) using excel VBA
64 bit (DSN Less and tnsnames)
Question
Please help. I have researched this for hours. I get some parts to work but not
others.
What I am trying to do is write all the connection strings in excel VBA to
connect to Oracle 11g database. I don't want to set up the User DSN in ODBC
Administrator and I don't want to have to maintain a tnsnames.ora file.
I can get this to work for OLEDB connection strings but I believe this is no
longer supported by Oracle so I want to use the Oracle ODBC Driver
commands only.
This is what I have got to work (which requires a tnsnames.ora file)
DRIVER={Oracle in
OraClient11g_home1};DBQ=MyTNSnamesALias;UID=xxxx;PWD=xxxx

I have tried this also but I get a TNS Protocol error
DRIVER={Oracle in OraClient11g_home1};
Server=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=
(PROTOCOL=TCP)(HOST=hostname)(PORT=xxxx))) (CONNECT_DATA=
(SERVICE_NAME=xxx)(SERVER=DEDICATED)));UID=xxxx;PWD=xxxx
Other useful information might be that i get my connections to work just fine
when I use the DSN name as per the ODBC Administrator.
Any suggestions would be greatly appreciated
Thanks
Answer
OLEDB Provider from Oracle (Provider=OraOLEDB.Oracle) is still
supported, just the provider from Microsoft (Provider=msdaora) is
deprecated. Microsoft recommends to use the Oracle provider.
Microsoft provider msdaora does even not exist for 64 Bit.
I think your connection string for Oracle ODBC must be this (without the line
breaks):
Driver={Oracle in OraClient11g_home1};
DBQ=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)
(HOST=hostname)(PORT=xxxx)))(CONNECT_DATA=
(SERVICE_NAME=xxx)(SERVER=DEDICATED))); Pwd=xxxx;
Uid=xxxx
Note, for the Oracle driver you must use DBQ instead of Server.
Server is the attribute for the Microsoft ODBC driver (e.g. Driver={Microsoft
ODBC for Oracle})
Answer

There are no possibility to connect using Oracle ODBC driver without TNS
alias already configured in tnsnames.ora file.
All configuration steps mentioned in Oracle ODBC Driver documentation
requires it:
Connecting to DataSource
Configuring theDataSource
Oracle ODBC Driver Configuration Dialog Box
Also in documentation for SQLDriverConnect implementation DBQ parameter
noted as required, and passing a name of TNS alias in this parameter is only
method to specify server to connect to. Because it's a common API function
used by all clients of Oracle ODBC Driver, there are no possibility that some
other interface (COM-object, configuration dialog or something else) may
accept different parameters for connection.
There are no such possibility in Oracle Objects for OLE too.
I can't find anything about cancelling of Oracle Provider for OLEDB support. It
has been released as a part of latest version of ODAC: "ODAC 12c Release 4
(12.1.0.2.4)" and this release is a top news topic at related section of Oracle
site at the moment. There are some improvements in latest versions and
support for usage from .NET applications.
Also, it works (at least for me):
Const hostName = "server_host"
Const portNo = "1521"
Const srvSID = "ORASERVERSID"
Const usrID = "login"
Const usrPwd = "password"
Sub con_Oracle_OLEDB()
strDriver = "Provider=OraOLEDB.Oracle;" strParams = "Data Source=
(DESCRIPTION=(CID=MyVbaApp)(ADDRESS_LIST=(ADDRESS=
(PROTOCOL=TCP)(HOST=" + hostName + ")(PORT=" + portNo + ")))

(CONNECT_DATA=(SID=" + srvSID + ")));"
strCon = strDriver + strParams + strUser
' Open the above connection string. Dim con As Object
Set con = CreateObject("ADODB.Connection") con.ConnectionString = strCon
con.Open
End Sub
Based on the above, I recommend to stay with OLEDB Provider, just update
ODAC to a latest version.
If you don't want to use OLEDB at all, there are a variant with Microsoft
ODBC driver("Driver={Microsoft ODBC for Oracle};") with detailed server
parameters specification in CONNECTSTRING:
Const hostName = "server_host"
Const portNo = "1521"
Const srvSID = "ORASERVERSID"
Const usrID = "login"
Const usrPwd = "password"
Sub con_Microsoft_ODBC_for_Oracle()
strDriver = "Driver={Microsoft ODBC for Oracle};" strParams =
"CONNECTSTRING=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)
(HOST=" + hostName + ")(PORT=" + portNo + "))(CONNECT_DATA=
(SID=" + srvSID + ")));" strUser = "UID=" + usrID + ";PWD=" + usrPwd + ";"
strCon = strDriver + strParams + strUser
' Open the above connection string. Dim con As Object
Set con = CreateObject("ADODB.Connection") con.ConnectionString = strCon
con.Open
End Sub
Of course, this variant has its own drawbacks. At least, there are a much more

probability of support cancellation from Microsoft's side than from side of
Oracle.
Topic 12
Subject
Excel VBA : How can I avoid automatic code generation when I click
worksheet?
Question
I am a beginner of Excel VBA.
When I write code on VBA editer, whenever I click worksheet or do
something(something like changing position or delete cells), corresponding
codes are automatically generated on my VBA editer.
For example, when I click E5 cell by mouse, Range("E5").Select is
automatically generated, and then I delete the code, always.
Would it be possible to block this automatic code generation?
Thanks in advance.
Topic 13
Subject
Pivot tables Run-time error 438: Object doesn't support this property or
method
Question
I'm totally flabbergasted
I have this line of code and I get this error everytime. I've tried so many things,
putting it into variables, checking if all of the names are correct, clearing the
cache, nothing seems to work.
Sheets("Uren verschil per
vestiging").PivotTable("Draaitabel1").PivotFields("jaar
mutatie").PivotItem(Year(Date)).Visible = True Answer
Seems the syntax is off by one s:

Sheets("Uren verschil per
vestiging").PivotTables("Draaitabel1").PivotFields("jaar
mutatie").PivotItems(CStr(Year(Date))).Visible = True
Edited 20160212 to add an additional s after "PivotItem" and to add CStr
around the Year function.
Topic 14
Subject
Excel VBA Textbox Calculation
Question
So i have made userform with data in it that should trigger an calculation.
Running into a few problems though...
1
I use a vlookup to get the price for an product. In the named range its written
down as €5,75 but in the userform it gives me 575,00 when trying to format it
as #,##.
2
.. I think its related to problem number one: It gives me wrong calculations in
the result field.
Example of my code:
Private Sub txtZP2bedrag_change()
DTPicker16.Enabled = True
DTPicker9.Enabled = True
Dim firstdate As Date, seconddate As Date, firstdate = DTPicker16.Value
seconddate = DTPicker9.Value
txtDagZP2 = DateDiff("d", firstdate, seconddate) + 1 m =
Day(DateSerial(Year(Date), Month(Date) + 1, 0)) txtZP2CB =
Val(txtZP2price) / m * Val(txtDagZP2)
User fills in date, txtDAGZP2 gives the amount of days +1 m - gives me the

number of days in the month txtprice is the price of the product
calculation in txtzp2cb = Price / days in month * count of days..
Think I have to tackle this with the european/usa format and DIM some values.
Any Ideas? Thanks in advance.
Topic 15
Subject
cell/column width in Excel Office.js
Question
The latest Javascript Api for Excel makes working with worksheets much
easier, but I seem to miss the ability of setting a cells width in code. Range
objects have a format property, but that only supports font sizes and borders
and such.
What am i missing? I'm inserting dates into columns from a task pane add-in,
but the default cell width means that the user only sees '####' and has to
manually resize the cells.. not very nice Answer
you can use Range object to set the width as
range.format.columnWidth = 130;
Answer
I am glad to know that you like the new JavaScript APIs for Excel. Actually
we are releasing a new wave of APIs for Excel which will include the set
column width and a lot of other new exciting features including worksheet
protections, sort/filter and so much more. Check it out on GitHub.
If you want to try out the new APIs, make sure you have the latest Office 2016
for Windows or Office365. Here are the instructions
With in your add-in, in HTML, replace the existing Office.js script reference
with

<script src=" https://appsforoffice.microsoft.com/lib/beta/hosted/office.js"
type="text/javascript"></script>
If you want IntelliSense for a even more delightful coding experience, go to
Scripts/References/_references.js, remove the last two entries, and instead
replace them with
/// <reference path="
https://appsforoffice.microsoft.com/lib/beta/hosted/office.js" />
Thanks,
Sky
Microsoft
Topic 16
Subject
Inserting an Excel OLE objects in another Excel workbook
Question
I use this code to add an OLE object in an Excel worksheet:
Set OLE = wsAttachment.OLEObjects.Add(Filename:=sDateinameMitPfad,
Link:=False, DisplayAsIcon:=True, IconIndex:=0,
IconFileName:=sDateinameMitPfad)
This works when I insert files like jpg, png or docx When I try to add another
xlsx file I get a warning:
Caution! Parts of your document may contain personal information that can not
be removed from the document examination.
(Sorry, Google translate) The original german messagebox shows:
Vorsicht! Teile Ihres Dokuments enthalten möglicherweise persönliche
Informationen, die von der Dokumentprüfung nicht entfernt werden können.
I know that this behaviour can be stopped in the trust center, which is not an
option (users can not change their trust center settings).

How do I add an external xlsx file without this warning?
Topic 17
Subject
Conditional formatting in excel, find variable in chart
Question
Hi I need some help with conditional formatting in excel.
What I want is: When I put the height of any certain individual in the "Height
box" I want excel to match it to the table to the left and find the preferable
weight accordingly and put the weight in the box "Preferable weight". Answer
VLOOKUP() is what you are after here.
Based on your example (assuming top left col is A) put into the cell next to the
preferable weight label:
=VLOOKUP(WeightCell,$A$2:$B$12,2,0)
where HeightCell is the cell with the value you want to look for, and the
$A$2:$B$12 part is the range of heights and weights (modify the range to suit
your needs)
Topic 18
Subject
Trying to get my SQL data into Excel, NULL Aggregate warning and not able to
connect
Question
I've created a query that gives me exactly what I want as far as results go,
Ideally I just want to create a view with this and bring it into Excel for usage.
This is the code.....
--Calculates the percentage split of Property Support Departments for YTD
Oct/Nov/Dec SET ANSI_WARNINGS OFF;
declare @PropApportion Table(
type varchar(50),

net money);
insert into @PropApportion
select type,Net from DB_ConsolApportionment where type in
('PostComplete','DirectPropSupPbo','PropSupPbo')
declare @PostComplete as money
set @PostComplete =
(select net from @PropApportion where type = 'PostComplete')
declare @PropSup as money
set @PropSup =
(select net from @PropApportion where type = 'PropSupPbo')
declare @DirPropSup as money
set @DirPropSup =
(select net from @PropApportion where type = 'DirectPropSupPbo')
select
type,
Concat,
Net,
Cast(1. * Net/ SUM(Net) OVER(PARTITION BY type)as decimal(8,3)) as
'%', round(@PostComplete * ((1. * Net/ SUM(Net) OVER(PARTITION BY
type))),2) as 'PostCompleteSplit', round(@PropSup * ((1. * Net/ SUM(Net)
OVER(PARTITION BY type))),2) as 'PropSupSplit', round(@DirPropSup *
((1. * Net/ SUM(Net) OVER(PARTITION BY type))),2) as 'DirPropSupSplit'
from
(select
type,
Concat,
sum(-[oct-15]-[Nov-15]-[Dec-15]) as 'Net' from DB_ConsolApportionment ca
where type = 'Sales'
and ((ca.Concat like '%Estate%'
or ca.Concat like '%Developer%')
or concat like 'Commercial')

group by concat, type
)ca
where type = 'Sales'
and ((ca.Concat like '%Estate%'
or ca.Concat like '%Developer%')
or concat like 'Commercial')
order by
case
when concat like '%Commercial%' then 1
when concat like '%EstateAgentsA%' then 2 when concat like
'%EstateAgentsB%' then 3 when concat like '%DeveloperA%' then 4
when concat like '%DeveloperB%' then 5
when concat like '%DeveloperC%' then 6
end;
This gives me these results.... 
type    Concat        Net       %       PostCompleteSplit  
PropSupSplit    DirPropSupSplit 
Sales   Commercial    46366.67  0.101   3282.290000        
443.220000      11857.150000 
Sales   EstateAgentsA 69717.00  0.152   4935.250000        
666.420000      17828.430000 
Sales   EstateAgentsB 146788.94 0.321   10391.160000      
1403.150000     37537.700000 
Sales   DeveloperA    88731.19  0.194   6281.260000        
848.180000      22690.840000 
Sales   DeveloperB    50324.18  0.110   3562.440000        
481.050000      12869.190000 
Sales   DeveloperC    55371.69  0.121   3919.750000        
529.300000      14159.960000 
This is exactly what I need but I need to get it into a view so that I can quickly
pull it into Excel. If I paste the query directly into Excel (Data/Existing
Connections etc), Initially I got the 'Null Aggregate' warning, I then added the..
SET ANSI_WARNNINGS OFF;
to remove the warnings as I have several other views that run from the same

source that don't have the problem when running from a view. Once the
warning were switched off, the query wouldn't connect to the server.
Is there a better way to structure my code so I can store it as a view? ...should I
use sub-queries instead of variables? Answer
Fixed it myself, I'll post this anyway in case others find it useful (or if anyone
has any other tips regarding my code (..would be much appreciated)).
So..subqueries instead of variables, it takes 10 secs to run but it works!
--Calculates the percentage split of Peterborough Property Support
Departments for YTD Oct/Nov/Dec
select
top 999999999999
ca.Type,
ca.Concat,
ca.Net,
Cast(1. * ca.Net/ SUM(ca.Net) OVER(PARTITION BY ca.type)as
decimal(8,3)) as '%', round((select sum(net) from DB_ConsolApportionment
where type = 'PostComplete' ) * ((1. * ca.Net/ SUM(ca.Net)
OVER(PARTITION BY ca.type))),2) as 'PostCompleteSplit', round((select
sum(net) from DB_ConsolApportionment where type = 'PropSupPbo' ) * ((1. *
ca.Net/ SUM(ca.Net) OVER(PARTITION BY ca.type))),2) as 'PropSupSplit',
round((select sum(net) from DB_ConsolApportionment where type =
'DirectPropSupPbo' ) * ((1. * ca.Net/ SUM(ca.Net) OVER(PARTITION BY
ca.type))),2) as 'DirPropSupSplit'
from
(select
type,
Concat,
sum(-[oct-15]-[Nov-15]-[Dec-15]) as 'Net' from DB_ConsolApportionment ca
where type = 'Sales'
and ((Concat like '%Estate%'
or Concat like '%Developer%')
or concat like 'Commercial')

group by concat, type
)ca
where ca.Type = 'Sales'
and ((ca.Concat like '%Estate%'
or ca.Concat like '%Developer%')
or ca.concat like 'Commercial')
order by
case
when ca.Concat like '%Commercial%' then 1 when ca.Concat like
'%EstatsAgentsA%' then 2 when ca.concat like '%EstateAgentsB%' then 3
when ca.concat like '%DeveloperA%' then 4 when ca.concat like
'%DeveloperB%' then 5 when ca.concat like '%DeveloperC%' then 6 end;
Topic 19
Subject
Python xlsxwriter - add a worksheet to an existing workbook
Question
I am doing my first steps with xlswriter.
I have an existing workbook test.xlsx, and I want to add to it a new worksheet -
sheet 2.
what I tried is the following:
import xlsxwriter as xl
xbook=xl.Workbook('test.xlsx')
xbook.add_worksheet('sheet2')
The problem with this is that it overrides all the other sheets in the workbook.
How can I add a worksheet without overriding all the other worksheets in the
workbook? Answer
I don't think this is still possible with xlsxwriter. Please take a look at this
answer for help

Topic 20
Subject
How to retrieve data from child cells EXCEL
Question
I want to retrieve all items within a specific column of a table.
In this scenario, I have 2 tables, The first table contains a primary key, and the
second table contains a foreign key. a 1 to many relationship is set up for the
tables respectively.
I want a function/way of retrieving all items within a column in table 2 that has
a foreign key that matches the primary key in table 1.
One way of doing this is through a VLOOKUP, though surely through using
DAX, or some other function set, I can exploit the relationship I have made in
the DataModel to make this easier for me to do. Answer
Use MSQUERY - select your 2nd Data sheet as input, and then use
conditionals to only take data from where the Foreign key is equal to the
primary key that you are looking for.
A handy tutorial is here - https://support.office.com/en-us/article/Use-
Microsoft-Query-to-retrieve-external-data-42a2ea18-44d9-40b3-9c38-
4c62f252da2e
Answer
Why don't you just get the required data from the DB with a proper SELECT
statement? Something like
SELECT column
FROM t1, t2
WHERE t1.key = t2.fkey
AND t1.key = 'whatever you search for';
Then you should get the data you want.
Topic 21

Subject
xlsxwriter conditional formatting by formula criteria
Question
I want to apply format to cells in a column. The row indexes are 5,7,8,9,10,11
and 13.
The code I am using is the following:
worksheet.conditional_format("C4:C14", {'type' : 'formula', 
                                         'criteria':
'=ISNUMBER(MATCH(ROW(),{5,7,8,9,10,11,13},0))=TRUE', 
                                         'format'  :  
format_white}) 
The result is no Excel file is generated.
The formula =ISNUMBER(MATCH(ROW(),{5,7,8,9,10,11,13},0))=TRUE
works as I expected when I type it directly in Excel. I run the code above with
a simpler formula 'criteria': '=MOD(ROW(),2)=0' and it works, so I suspect
the problem is in the criteria field.
Can anyone help me? Thanks in advance
Answer
In order for a formula to work in an XlsxWriter generated file it has to work in
Excel.
In this case the conditional formula formula isn't valid in Excel:
=ISNUMBER(MATCH(ROW(),{5,7,8,9,10,11,13},0))=TRUE
If you add it manually in Excel you get the following error/warning:
"You may not use reference operators (such as unions, intersections, and
ranges) or other array constants for Conditional Formatting criteria".
Topic 22

Subject
How to convert some fields of a row into a column emp_id, month, year
Question
Table data:

code salary TA DA month year
01 30000 5000 1000 01 2015
Output required:

Code amount month year
01             30000      01  2015 
01              5000      01  2015 
01              1000      01  2015 
Please check the data in table and required output in image format Answer
Try using Cross Apply with Values,
Below code is as per the image 
SELECT      Empcode, 
              B.Amount, 
              Month_attd, 
              Year_attd 
  FROM        #Your_Table A 
  CROSS APPLY ( VALUES(Salary), 
                      (Phone_all), 
                      (Proff_tax)) B (Amount) 
Answer
DECLARE @Table1 TABLE
(code int, salary int, TA int, DA int, month int, year int) ;
INSERT INTO @Table1
(code, salary, TA, DA, month, year) VALUES
(01, 30000, 5000, 1000, 01, 2015)
;
select code,amount,month,year
from @Table1 s

unpivot
(
amount
for val in (salary, TA, DA)
) u;
Topic 23
Subject
Pivot more than one column
Question
i have two tables in SQL Server 2008, in one i have the needs of articles per
week, and in another i have the stock, somethin like
NEEDS
Article Week Need
aa                            1                              
25 
aa                            2                              
13 
aa                            4                              
33 
aa                            6                              
21 
aa                            25                              
40 
ab                            1                              
 1 
ab                            2                              
 3 
ab                            16                              
14 
ab                            50                              
50 
STOCKS

Article Units
  aa                            80 
  ab                            14 
  ac                             8 
and i need to show something like: 
Article       WEEK1          WEEK2       WEEK4         WEEK6  
    WEEK16       WEEK25 
          needs stock   needs stock  needs stock   needs
stock   needs stock  needs stock 
aa           25    80      13   55      42    22      21    20
    0   -1        40  -1 
ab            1    14       3   13       0    10        0   10
   14  10          0  -4 
This will show in Encel, for this i use C# and T-SQL, my problem is that if use
PIVOT i can oly do it with the needs per week but i expect the needs and the
stock, if i do without the pivot i can obtain the article the week an the stock,
save the data in objects and do the calculation of the stock per week and then
format the Excel, but i have one problem i need in the object something like:
puclic class needsPerWeek
{
string Article{get;set;}
int needsWeek1{get;set;}
int stockWeek1{get;set;}
int needsWeek2{get;set;}
int stockWeek2{get;set;}
int needsWeek{get;set;}
int stockWeek4{get;set;}
int needsWeek6{get;set;}
int stockWeek6{get;set;}
int needsWeek16{get;set;}
int stockWeek16{get;set;}

int needsWeek25{get;set;}
int stockWeek25{get;set;}
int needsWeek50{get;set;}
int stockWeek50{get;set;}
....
....
}
but i don´t know how much weeks i will recibe.
So, can i do this with pivot?, or any other way to obtain this? Answer
Just copy and paste the code below and do some changes according to your
need. We are just making dynamic column strings (UnitsWeek1, UnitsWeek2,
NeedsWeek1... etc). And get two tables using Pivot and obtain a final table by
joining the two.
DECLARE @cols1 AS NVARCHAR(MAX),
@query1 AS NVARCHAR(MAX),
@cols2 AS NVARCHAR(MAX),
@query2 AS NVARCHAR(MAX);
select @cols1 = STUFF((SELECT distinct ',' +
QUOTENAME('NeedsWeek'+Week) 
                 from NeedsMaster FOR XML PATH(''), TYPE 
         ).value('.', 'NVARCHAR(MAX)') 
     ,1,1,'') 
set @query1 = 'SELECT Article, ' + @cols1 + ' from 
          ( 
              select Article 
                     , Need 
                     ,''NeedsWeek''+Week as Week 
                     from 
                 NeedsMaster 
         ) x 
         pivot 

         ( 
             min(need) 
             for Week in (' + @cols1 + ') 
         ) p ' 
select @cols2 = STUFF((SELECT distinct ',' +
QUOTENAME('UnitsWeek'+n.Week)
from NeedsMaster n left join StocksMaster s on s.Article=n.Article 
         FOR XML PATH(''), TYPE 
         ).value('.', 'NVARCHAR(MAX)') 
     ,1,1,'') 
set @query2 = 'Select * from (SELECT Article, ' + @cols2 + ' from 
          ( 
              select n.Article 
                     , s.Units 
                     ,''UnitsWeek''+n.Week as Week 
                 from StocksMaster s 
                 inner join NeedsMaster n 
                    on s.Article=n.Article 
         ) x1 
         pivot 
         ( 
             min(Units) 
             for Week in (' + @cols2 + ') 
         ) p1 ) a inner join 
         (SELECT Article, ' + @cols1 + ' from 
          ( 
              select Article 
                     , Need 
                    ,''NeedsWeek''+Week as Week 
                     from 
                 NeedsMaster 
         ) x2 
         pivot 
         ( 
             min(need) 
             for Week in (' + @cols1 + ') 
         ) p2 ) b on a.Article=b.Article' 

execute(@query2)
(@query1 is just for better understanding purpose). Give it a try and i hope you
will edit it as your requirements.
Reference
Topic 24
Subject
Series of conditional table and cell references
Question
I have a reference table as such in Sheet2 of my workbook
|Score 1| | |Score 2 | | |
| name | min | max | target | min | max | target |
| jeff | 30 | 40 | 35 | 45 | 55 | 50 |
| steve | 35 | 45 | 40 | 45 | 65 | 55 |
then in Sheet1 I have a list of scores for each name as such

| jeff | 1 | | | | steve | 3 | | |
| jeff | 2 | | | | steve | 2 | | |
| jeff | 2 | | | | steve | 3 | | |
| jeff | 3 | | | | steve | 3 | | |
| jeff | 1 | | | | steve | 2 | | |
I am aware of simple lookups and offsetting values but I can't think of a way to
do multiple references on different levels... Is there a way to in Sheet1 next to
the scores have a function that looks up the score, then who the score is for,
and then prints the corresponding min max and target values for that person
with that score.
So if it sees 1 and then jeff, it returns 30 | 40 | 35 in the next 3 boxes. I would
do this manually but the list is very long and is populated daily by an existing
macro. Answer
Use VLOOKUP with the name (jeff) and take the index (1) to calculate the
column to take.
Topic 25
Subject
How can I prevent this VBA script written to remove blanks in a column from
stalling at the end?
Question
I have the following script written to remove blank cells in long column in
excel
Sub RemoveBlanks()
Dim Rng As Range

Dim i As Long
i = 1
Application.ScreenUpdating = False
Do While i <= 30000
Set Rng = Range("A" & i)
If Application.WorksheetFunction.CountA(Rng) = 0 Then Rng.Delete
Shift:=xlUp
ElseIf Application.WorksheetFunction.CountA(Rng) = 1 Then i = i + 1
Else: Stop
End If
Loop
End
End Sub
I want this to be a 'one size fits all' macro, so if there are only 20000 rows, the
script will still run out until the end. I've been experimenting with adding
another range chunk which is set as rng, rng.offset(10,0) and telling the script
to increase i if this is empty too (as this is only empty at the end of the column)
but this approach doesn't seem to be working. Is there another angle I can take
on this?
Thanks
Answer
Try setting a dynamic range:
replace
Do While i <= 30000
with
range = ActiveSheet.Cells(ActiveSheet.Rows.Count, "A").End(xlUp).Row Do
While i <= range

Next thing is you have to update your range if you delete something, so after
this line:
If Application.WorksheetFunction.CountA(Rng) = 0 Then
Rng.Delete Shift:=xlUp
Add this code:
Range = Range -1
Answer
Your method should be starting at the bottom and working up. Failing to do this
may results in skipped blanks when row i is deleted, the rows shift up but you
increment i and carry on down.
However, your best bet is to use the Range.SpecialCells method with the
xlCellTypeBlanks parameter.
with worksheets("Sheet1")
with .columns(1) 
      on error resume next 
      .specialcells(xlcelltypeblanks).delete shift:=xlup 
      on error goto 0 
end with
end with
This can be slow if a large number of discontiguous cells are being deleted.
Probably not as slow as cycling through them all one at a time but still time
consuming.
Topic 26
Subject
How to list Unique Values Based on a Value in another Column

Question
The following code lists all unique values from column C and in column S and
also lists the corresponding values from column I in column T
With Sheets("DATABASE")
Union(.Range("C7:C" & LastRow), .Range("I7:I" & LastRow)).Copy
.Range("S7") .Range("S7:T" & LastRow).RemoveDuplicates Columns:=1,
Header:=xlNo End With
I'd like to add a condition to this.
It should only lists unique values if the value in column E is equal to the value
in cell A1. Any ideas?
Topic 27
Subject
BETWEEN clause in Excel
Question
How can i select data from an excel sheet between two dates i.e '01-12-2012'
to '06-14-2015'. 
Date        Name     Address   Phone_No 
12-1-2006   Adam     Landon     00000 
12-21-2015  Root     Karachi    00000 
06-1-2013   Sara     New York   00000 
01-12-2012  Clrick   Speen      00000 
06-14-2015  Ravi0    Lokat      00000 
12-1-2011   John1    Kamilo     00000 
02-7-2010 Naveed Anima282 00000
Answer
If you want to import to another sheet, use MSQUERY (from Data ---> From
other Sources ---> MSQUERY), select the sheet you want as an input, then in
conditional formatting set it to what you want for the date range.
This will take only the data with this.
Topic 28

Subject
Concatenate cell data into another data if values matches
Question
I have two columns A and B in same excel sheet. I am trying that if in Column
B two values matches then it should copy related value A in same row.
For e.g
Table 
Column A      Column B 
xyz              1 
abc              1 
pqr              1 
eee              2 
qqq              3 
www              4 
oop              5 
Desierd Output 
column A         Column B 
xyz,abc,pqr         1 
eee                 2 
qqq                 3 
www                 4 
oop                 5 
Answer
You could probably use a User Defined Function (aka UDF) for this. Put this
into a module sheet.
Public Function conditional_concat_strs(rSTRs As Range, rCRITs As Range,
rCRIT As Range, Optional sDELIM As String = ", ")
Dim c As Long, sTMP As String
Set rSTRs = rSTRs.Cells(1, 1).Resize(rCRITs.Rows.Count,

rCRITs.Columns.Count) For c = 1 To rCRITs.Cells.Count 
      If rCRITs(c).Value2 = rCRIT Then 
          sTMP = sTMP & rSTRs(c).Value & sDELIM 
Next c
conditionalconcat_strs = Left(sTMP, Application.Max(Len(sTMP) -
Len(sDELIM), 0)) End Function
Use like any native worksheet function.
     
Answer
You can also use this one:
Public Sub combine()
Dim row, result, lastRow As Integer Dim isExist As Boolean
With Sheets("sheetname") 
      'get the last use row 
      lastRow =
.Range("A1").SpecialCells(xlCellTypeLastCell).row 
      'Loop from row 1 to last row 
      For row = 1 To lastRow Step 1 
          'set the start row for result. 
          result = 1 
          'Reset flag 
          isExist = False 
          'Loop result count column until blank 
          Do While .Range("F" & result) <> "" 
              'check count 
              If .Range("B" & row) = .Range("F" & result)
Then 

                  isExist = True 
                  'If old, combine 
                  .Range("E" & result) = .Range("E" & result)
& "," & .Range("A" & row) 
                  Exit Do 
              End If 
              'increase row 
              result = result + 1 
          Loop 
          'If new, add new record 
          If Not isExist Then 
              .Range("E" & result) = .Range("A" & row) 
              .Range("F" & result) = .Range("B" & row) 
          End If 
      Next row 
End With
End Sub
Here, testing evidence for my code:
I used column A & B as input and column E & F as output.
If there is any problem, let me know.
Answer
There's a formula solution for this as well (with helper columns):
Assuming data is column A:B ...
In C1 write this formula: =IF(A1<>A2,B2,D1&","&B2) In D1 write this
formula: =IF(A2<>A3,A2,"") Filter on column D for blanks and then deleted
the visible cells.

Topic 29
Subject
Copy multiple cell ranges and paste in chronological order onto next available
row on other sheet tab?
Question
I am using the following code to copy cell ranges from cells on one sheet and
paste in chronological order onto another sheet on the next available row.
For some reason if i try to copy multiple cell ranges it will not work, like so:
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
If Target.Address = "$R$71:$U$73" Then Application.ScreenUpdating = False
Dim copySheet As Worksheet
Dim pasteSheet As Worksheet
Set copySheet = Worksheets("Form")
Set pasteSheet = Worksheets("Total Data")
copySheet.Range("J8").Copy
copySheet.Range("R8").Copy
pasteSheet.Cells(Rows.Count, 1).End(xlUp).Offset(1, 0).PasteSpecial
xlPasteValues Application.CutCopyMode = False
Application.ScreenUpdating = True
MsgBox "Something"
End If
End Sub
Please can someone show me where i am going wrong?
Thanks in advance
Answer
You are only pasting the values so opt for direct value transfer instead.
pasteSheet.Cells(Rows.Count, 1).End(xlUp).Offset(1, 0) = _

copySheet.Range("J8").Value
pasteSheet.Cells(Rows.Count, 1).End(xlUp).Offset(0, 1) = _
copySheet.Range("R8").Value
Note the change in the parameters to the Range.Offset property. The first finds
the last populated row and moves one down. The second finds that cell that
just received a value and moves one to the right.
Topic 30
Subject
Convert code for 32 bit to 64 bit
Question
I have a lot of images which I need to download on my folder and renamed. I
have tried the macro below but it is not working on 32bit excel please help me
work on 64 bit.
Option Explicit
Private Declare Function URLDownloadToFile Lib "urlmon" _
Alias "URLDownloadToFileA" (ByVal pCaller As Long, _ ByVal szURL As
String, ByVal szFileName As String, _ ByVal dwReserved As Long, ByVal
lpfnCB As Long) As Long
Dim Ret As Long
'~~> This is where the images will be saved. Change as applicable Const
FolderName As String = "C:\Temp\"
Sub Sample()
Dim ws As Worksheet
Dim LastRow As Long, i As Long
Dim strPath As String
'~~> Name of the sheet which has the list Set ws = Sheets("Sheet1")

LastRow = ws.Range("A" & Rows.Count).End(xlUp).Row
For i = 2 To LastRow '<~~ 2 because row 1 has headers
strPath = FolderName & ws.Range("A" & i).Value & ".jpg"
Ret = URLDownloadToFile(0, ws.Range("B" & i).Value, strPath, 0, 0) 
      If Ret = 0 Then 
          ws.Range("C" & i).Value = "File successfully
downloaded" 
      Else 
          ws.Range("C" & i).Value = "Unable to download the
file" 
      End If 
Next i
End Sub
Answer
If you want an imported function that works with both 32-bit and 64-bit, you
need to use compiler directives in the declaration.
Option Explicit
#If VBA7 And Win64 Then
Private Declare PtrSafe Function URLDownloadToFile Lib "urlmon" _ 
    Alias "URLDownloadToFileA" ( _ 
      ByVal pCaller As LongPtr, _ 
      ByVal szURL As String, _ 
      ByVal szFileName As String, _ 
      ByVal dwReserved As LongPtr, _ 
      ByVal lpfnCB As LongPtr _ 
    ) As Long 
  Private Declare PtrSafe Function DeleteUrlCacheEntry Lib
"Wininet.dll" _ 
    Alias "DeleteUrlCacheEntryA" ( _ 
      ByVal lpszUrlName As String _ 
    ) As Long 

#Else
Private Declare Function URLDownloadToFile Lib "urlmon" _ 
    Alias "URLDownloadToFileA" ( _ 
      ByVal pCaller As Long, _ 
      ByVal szURL As String, _ 
      ByVal szFileName As String, _ 
      ByVal dwReserved As Long, _ 
      ByVal lpfnCB As Long _ 
    ) As Long 
  Private Declare Function DeleteUrlCacheEntry Lib
"Wininet.dll" _ 
    Alias "DeleteUrlCacheEntryA" ( _ 
      ByVal lpszUrlName As String _ 
    ) As Long 
#End If
Public Const ERROR_SUCCESS As Long = 0
Public Const BINDF_GETNEWESTVERSION As Long = &H10 Public Const
INTERNET_FLAG_RELOAD As Long = &H80000000 Public Const
folderName As String = "c:\temp\"
Sub downloadImages()
Dim i As Long, ret As Long, sWAN As String, sLAN As String
With Worksheets("Sheet1") 
      For i = 2 To .Cells(Rows.Count, "A").End(xlUp).Row 
          sLAN = folderName & .Cells(i, 1).Value & ".jpg" 
          sWAN = .Cells(i, 2).Value 
          ret = URLDownloadToFile(0&, sWAN, sLAN,
BINDF_GETNEWESTVERSION, 0&) 
          If ret = 0 Then 
              .Cells(i, 3) = "File successfully downloaded" 
          Else 
              .Cells(i, 3) = "Unable to download the file" 
          End If 
      Next i 

End With
End Sub
The #If VBA7 And Win64 Then tells VBA how to compile the imported
function(s). 64-bit versions use PtrSafe. The above was tested on both 32-bit
and 64-bit.
Topic 31
Subject
How to convert excelworksheet to image / html format in asp.net
Question
Multi worksheets excel file I have,
each worksheet have charts and datas inside,
So i want to export each worksheet as image or html format.
How can do that ? I see Aspose.cell dll but its not free tool.
Topic 32
Subject
Converting date from 3 digit format to Julian date in R or excel
Question
I currently have dates in the format mdd (single or double digit month and
double digit day), with the year in a separate column.
Here is an example of what the data looks like:
Year Date
1996 921
1996 923
1996 1001
1996 1127
1997 502
I would like to combine these and convert them to julian dates. Can anyone

help me with this? I don't know why this data has been collected in such an
awkward format.
Thank you so much in advance for your help - code for R or excel will be fine!
Answer
We can use sprintf
as.POSIXlt(sprintf('%04d%04d', df1$Year, df1$Date),
format ='%Y%m%d')$yday
#[1] 264 266 274 331 121
Answer
In Excel
=DATE(A2,INT(B2/100),MOD(B2,100))
Where the year is in A2 and the month/day in B2.
Topic 33
Subject
“COM object that has been separated from its underlying RCW cannot be
used”
Question
I have a little function in my asp / C# site which exports some data through
excel using PIA.
After some research along days about how to use properly all of this,
sometimes I'm getting this error:
COM object that has been separated from its underlying RCW cannot be used.
at
Microsoft.Office.Interop.Excel.ApplicationClass.set_DisplayAlerts(Boolean
RHS)

After that, I always get this another error, but i supose that it's related/caused
by the first error:
Attempted to read or write protected memory. This is often an indication that
other memory is corrupt.
at Microsoft.Office.Interop.Excel.ApplicationClass.Quit()
I'm feeling quite confused because I tested this in three computers, and works
fine in two of them.
The relevant code is the following:
public static class Export{
public static Application objExcel; public static Workbooks objBooks;
public static _Workbook objBook;
public static Sheets objSheets;
public static _Worksheet objSheet;
public static Boolean export (DataSet ds, String path) { 
      try 
      { 
          objExcel = new Application(); 
          objBooks = objExcel.Workbooks; 
          objBook =
objBooks.Add(XlWBATemplate.xlWBATWorksheet); 
          objSheets = objBook.Worksheets; 
          objSheet = (Worksheet)objSheets.getItem(1); 
          Range objRange = null; 
           //Do things . . . 
           MergeCells(objExcel, objSheet); 
           //Do more things . . . 
          catch (Exception ex) 
          { 
              Global.ManageException(ex); 
          } 
          finally 

          { 
              if (objExcel != null) 
                  objExcel.Quit(); 
              ReleaseComObject(objExcel); 
              ReleaseComObject(objBooks); 
              ReleaseComObject(objBook); 
              ReleaseComObject(objSheets); 
              ReleaseComObject(objSheet); 
              ReleaseComObject(objRange); 
          } 
RelecaseComObject() is the following:
private static void ReleaseComObject(object reference) { 
      try 
      { 
          if(reference!=null) 
            
while(System.Runtime.InteropServices.Marshal.ReleaseComObject
> 0) 
              {} 
      } 
      catch (Exception e) 
      { 
          Global.ManageException(e); 
      } 
}
And MergeCells() is something like this:
private static void MergeCells(Application objExcel, _Worksheet objSheet)
{
objExcel.DisplayAlerts = false;
// Do things

objExcel.DisplayAlerts = true;
}
Taking a look to the line of the error, may it be caused by calling
objExcel.DisplayAlerts from inside of that function instead the main function?
(I would like to try it but I have some limitations to deploy the code many
times in the third computer).
How can I manage the code properly to make it safe and avoid this kind of
errors?
Thanks in advance.
Topic 34
Subject
How to add all available value or label filters from a pivot table into a
listbox? (Excel VBA)
Question
Okay, so I have a pivot table where there is a column of provinces and other
columns of sales per years.
I have created macros through vba to apply filtering on the pivot table.
(Recorded macros)
I want to add all available label and value filters into a listbox eg:
Label filters are :
Equals...
Does not equal...
Begins with...
Etc...
I want all of them in a listbox, or combobox, or anything the user can click and
expand to select what filter they want.
Any help please?

jamesalainheffer@gmail.com
Answer
Okay well I seemed to have figured it out. Most people don't know about the
filtering options in excel. And if they do, they probably would go about doing
it in VBA by saying something like
`With
ActiveSheet.PivotTables("pvt_Data").PivotFields("Province")`
.PivotItems("Yukon").Visible = false
and so on... By just making the field or item not visible, doesn't neccessarily
mean you're applying a filter to anything...
So, here's what I found...
dim prov as string
dim letter as string
dim val2 as string
dim pvtPivotTable as PivotTable
dim pfdValueField as PivotField
dim pfdTRowField as PivotField
set pvtPivotTable = ActiveSheet.PivotTables("pvt_Data") set pfdValueField =
ActiveSheet.PivotTables("Sum of Sales") set pfdTRowField =
pvtPivotTable.PivotFields("Province") letter = TextBox4.Value
prov = TextBox1.Value
msg = ", Caption Filters, " & listbox1.value with pvtPivotTable
.AllowMultipleFilters = True
pfdTRowField.PivotFilters.Add2 Type:=Listbox1.Value, Value1:=prove,
Value2:=letter end with
set pfdValueField = nothing
set pfdRowField = nothing
filterlistbox.AddItem(Listbox1.Text & " " & prov & msg
now what this does along with the rest of my projects is it loads every
xlFilterType into 3 listboxes, per categpry of Caption filters (text), Value
Filters (numerical), and date filter (date)

3 listbox's for 3 categories of filter types, each listbox is loaded with them
(filter types [xlBefore, xlCaptionIsEqual]) when you select a filter type, enter a
value into a textbox and push a button and it weill then apply that filter onto my
pivot table.
The listbox where the filter type gets added I did like this:
.addItem("Equall...")
.list(0, 1) = "15"
What this does is add that "Equall" to the list box, the list statement just inserts
15 into the 2nd column on the 1 st index (index starts at 0, 1 is the 2nd column)
Now, the xlFilterTypes have a value as well as a name for example
XlCaptionEqualls is the name and its value is 15, the listbox1.value is this
value becuase i set the bound column to number 2, so the listbox pushes out the
filterTypes value (number) instead of the text I hard coded, you can then use
case statements to get the name from the value and insert them into another
listbox.
this is a bit all over the show but I would like to know if nayone has managed
to add multiple filters onto their pivot table using vba? and the add2 method?
Kick ass.
Topic 35
Subject
vba excel delete data->remain 0
Question
With Range("Q10", Range("Q" & Rows.Count).End(xlUp)) .Replace "-", "",
xlPart, xlByRows, False, False, False .Replace " -", "", xlPart, xlByRows,
False, False, False End With
With Range("X10", Range("X" & Rows.Count).End(xlUp)) .Replace "-", "",
xlPart, xlByRows, False, False, False .Replace " -", "", xlPart, xlByRows,
False, False, False End With
Dim threeCell As Range

For Each threeCell In Range("Q10", Range("Q" & Rows.Count).End(xlUp))
With threeCell
.Value = Trim(.Value)
End With
Next threeCell
Hello everyone im using that code to delete data from a column. That column
contains data like "DE-45" "CZ-DZX" and it works perfect it deletes "DE-"
and it leaves the cells just with what i want the problem is when a cell is
something like this "DE-03" it gives me a "3" instead a "03".
How can i fix this?
Thanks!
Answer
This might be a bit hacky, but it works:
Change .Replace "*-", "", xlPart, xlByRows, False, False, False to:
.Replace "*-", "'", xlPart, xlByRows, False, False, False
Note the single ' as parameter for Replacement. This will result in a value like
'05, which Excel interprets as String - thus not removing any Zeros.
Topic 36
Subject
How to get secondary axis using C# code in Excel?
Question
I used this code, anyone advice me how to get secondary axis in Excel chart
using C#? Manually I got it from Excel options, but not in C# code.
Excel.Range chartRange;
Excel.ChartObjects xlCharts =
(Excel.ChartObjects)xlWorkSheet.ChartObjects(Type.Missing);
Excel.ChartObject myChart = (Excel.ChartObject)xlCharts.Add(200, 100,

500, 250); Excel.Chart chartPage = myChart.Chart;
chartRange = xlWorkSheet.get_Range("A1", "f5");
chartPage.SetSourceData(chartRange, misValue); chartPage.ChartType =
Excel.XlChartType.xlColumnClustered;
chartPage.Export(@"C:Desktop\excel_chart_export.bmp", "BMP", misValue);
xlWorkBook.SaveAs(@"C:Desktop\csharp.net-informations.xls",
Excel.XlFileFormat.xlWorkbookNormal, misValue, misValue, misValue,
misValue, Excel.XlSaveAsAccessMode.xlExclusive, misValue, misValue,
misValue, misValue, misValue); xlWorkBook.Close(true, misValue, misValue);
xlApp.Quit();
releaseObject(xlWorkSheet);
releaseObject(xlWorkBook);
releaseObject(xlApp);
MessageBox.Show("Excel file created , you can find the file
Desktop:\\abcd.xls");
Topic 37
Subject
Excel VBA - Convert string to range
Question
I have a function that stores a range.address in a cell. The value of that cell is
IE: AQ43:BF44
How can I turn this string into a Range?
I have tried:
Dim Cell As Range
Dim pRange As String
Dim projectRange As Range
pRange = Project.Range ' Stored as "AQ43:BF44" in this case projectRange =
Range(pRange)

For Each Cell In projectRange 
      If TargetCell = Cell Then 
         'Do something 
      End If 
Next Cell
This code reports run-time error 91: Object variable or with block variable
not set.
The main purpose of this function is to check if the targetCell(the cell I
doubleclicked) is found within the stored range.address . Answer
The main purpose of this function is to check if the targetCell(the cell I
doubleclicked[sic]) is found within the stored range.address
You are looking to see if the Intersect method produces something that is within
the range described by the text in a cell (e.g. AQ43:BF44 ) and a cell you
double-click (e.g. Target ).
Option Explicit '<~~ see footnote
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel
As Boolean)
Dim pRange As String
pRange = Worksheets("Sheet1").Range("A1").Value2 'alternates
'pRange = Worksheets("Sheet1").Range("A1").value 'pRange =
Worksheets("Sheet1").Range("A1").text If Not Intersect(Target,
Range(pRange)) Is Nothing Then 
      Cancel = False 
      MsgBox Target.Address(0, 0) & " is within " & pRange 
End If
End Sub

You are seeking to retrieve text from a cell; possibly text that is returned from a
formula involving something like the ADDRESS function. For this you can use
the Range.Value property, Range.Text property or Range.Value2 property.
Strictly speaking, the .Value2 property is the fastest but it isn't going to make a
lot of difference here.
It's a little unclear on where the text (e.g. AQ43:BF44 ) resides. I've included
parent worksheet as well as range definition that should be easy to edit.
A global solution could be achieved with the ThisWorkbook's
Workbook_SheetBeforeDoubleClick event macro.
Setting Require Variable Declaration within the VBE's Tools ► Options ►
Editor property page will put the Option Explicit statement at the top of each
newly created code sheet. This will avoid silly coding mistakes like
misspellings as well as influencing you to use the correct variable type in the
variable declaration. Variables created on-the-fly without declaration are all
of the variant/object type. Using Option Explicit is widely considered 'best
practice'.
Answer
Since a Range is an "object" in Excel, you need to use the Set-keyword when
assigning values:
Set projectRange = Range(pRange)
You will, however, encounter an error if the value of pRangedoesn't describe a
valid Range.
Also, you might want to be a bit more specific when iterating over For Each
Cell In projectRange. Depending on what you want to do, you could iterate
over projectRange.Cells, projectRange.Rows, projectRange.Columns...
Topic 38
Subject
can anyone solve this problems? download excel file from pdf page API

Question
Need your help in solving this kind of issue. I had no idea to put a proper and
specifics title for this issue. Which is you need to download the excel file but
need to go to the pdf file and click the symbol in the page. Then, it will give
you a popup download that IE always appear (I think most of the vba user
know this popup). Have all of you faced this issue before? Here is the link as
your reference
"https://www.bcb.gob.bo/webdocs/publicacionesbcb/2015/12/09/Boletin_exte
I try to search it but like I told you before, I'm not sure what is the keywords
that I need to put in "Google". Please help me guys... :( I'm really depressed
right now when thinking of this.
Hope so you guys can help me together to solve this. Many thanks!
Topic 39
Subject
How to close the Active Workbook and Open the New Workbook using VBA
Question
I Want to Close the Current workbook (Template.xlsm) and Open the New
Workbook (UI.xlsm) and to click on the Button (Which is in the UI.xlsm
workbook) programmatically . Below is the Code which I tried.
'In the Template.xlsm Workbook
Private Sub CommandButton21_Click()
Dim UIwb as Workbook
Dim UIst as Worksheet
Set UIwb = Workbooks.Open("C:\Users\inkapb\AppData\Local\Temp\EPC
AutoTool\Start Screen -UI\UI.xlsm") Set UIst = UIwb.Worksheets("Sheet2")
End Sub
'In the UI.xlsm Workbook
Private Sub Workbook_Open()
'************** To Close the Template file if it is opened Dim Wb As
Workbook

For Each Wb In Application.Workbooks
If Wb.name Like "Template" Then
Wb.Close 'The Control is not passing to the next line where I have written the
code to click on a button.
End If
Next
ThisWorkbook.ActiveSheet.CommandButton21.value = True ' To click a
Button in UI.xlsm Workbook
End Sub
Could someone help me out how to achieve this
Topic 40
Subject
Excel: calculate averages based on other column's value
Question
I have a datasheet containing two huge columns, both with integer values. The
values in one column range from 1-11, the other from 0-22. The values aren't
sorted in any way. In a separate sheet (same file) I want to show averages per
step.
Example

A B
2 3
4 0
6 2
2 9
4 12
1 9
1 18
In the other tab, I would like to see:

Values A Average B Values B
Average A
1          14          0          4 
2          6           2          6 
4          6           3          2 
6          2           9          2 
                      12         4 
                      18         1 
I'd like to solve this with a function that looks loops through the values of each
column, and during that loop takes an average of the rows in the column that
correspond to that value. Manually, this would be too much of a hassle.
I tried working with AVERAGEIF but nothing fruitful came out of it. Answer
Try
=AVERAGEIF('analyse-logs'!A:A;A1;'analyse-logs'!B:B)
Regards
Answer
You could try using AVERAGEIFS instead. This worked for me.
=IFERROR(AVERAGEIFS('analyse-logs'!B:B, 'analyse-logs'!A:A, A1), 0)
The code above is for A values. A1 refers to the cell where your value is
referenced (or you could use A=1 like you did in your original function). I used
IFERROR in this case so that references with no matches will return 0 as the
average.
Answer

If you are comfortable building a pivot table, you can build a pivot table on
your data. And use average of B in values when A is the rows field. Should
yield you the result. Vice-versa should yield the right half of the result.
If you want to see both of them at the same time, one tab can have pivot with A
in rows field and average of B in values field. You can build another pivot in
another sheet with B in rows field and average of A in values field.
If you want the results side-by-side (2 columns of first part and the next two
columns of the 2nd part), you can get pivot tables to be positioned next to each
other (Move a Pivot Table) Since the source data is going to be identical, if
there are any changes in the base data, a simple Refresh Pivot (Alt+F5) should
update the values.
(If you haven't done this before) How to get average in Values field: Change
the summary function for a field in a PivotTable report
Topic 41
Subject
Maintain matlab object/figure open after end of sub in excel vba
Question
I have created a very basic VBA script to run a Matlab function to plot a graph.
The graph pops up, but disappears again when the sub ends.
This is my basic code:
Sub runMatlab()
Dim hMatlab As Object
Dim sDir As String, cdsDir As String, s1 As String Set hMatlab =
CreateObject("Matlab.Application") s1 = "'"
sDir = s1 & ActiveWorkbook.Path & s1 cdsDir = "cd(" & sDir & ")"
hMatlab.Execute (cdsDir)
Application.DisplayAlerts = False
hMatlab.Execute ("excel_vba2")
Application.DisplayAlerts = True

End Sub
How can I keep the figure open even after the end of the sub?
Topic 42
Subject
Can I save an xml file as excel file with python
Question
I have a python script that loops through .xls files in a folder and puts the
content into pandas dataframe.
The issue I face is that sometimes, those files have the .xls extension while in
fact they are xml files, so this error is triggered :
xl = pd.ExcelFile(f)
File "C:\Python27\lib\site-packages\pandas\io\excel.py", line 188, in __init__
self.book = xlrd.open_workbook(io)
File "C:\Python27\lib\site-packages\xlrd\__init__.py", line 435, in
open_workbook ragged_rows=ragged_rows,
File "C:\Python27\lib\site-packages\xlrd\book.py", line 91, in
open_workbook_xls biff_version = bk.getbof(XL_WORKBOOK_GLOBALS)
File "C:\Python27\lib\site-packages\xlrd\book.py", line 1230, in getbof
bof_error('Expected BOF record; found %r' % self.mem[savpos:savpos+8])
File "C:\Python27\lib\site-packages\xlrd\book.py", line 1224, in bof_error
raise XLRDError('Unsupported format, or corrupt file: ' + msg)
xlrd.biffh.XLRDError:Unsupported format, or corrupt file: Expected BOF
record; found '<?xml ve'
I kind of circumvent the issue by making a VBA macro in that opens the so
called xls file and save it as a real .xls like this:
Workbooks.Open Filename:=f
'Application.ActiveProtectedViewWindow.Edit ActiveWorkbook.SaveAs
Filename:=f, _
FileFormat:=xlExcel8, Password:="", WriteResPassword:="",
ReadOnlyRecommended:=False, CreateBackup:=False ActiveWindow.Close

But this is horribly slow, so I wondered if someone would have an idea how to
tackle this directly in python so that it's more efficient !
Topic 43
Subject
Excel VBA using SQL Datediff
Question
Hi I have an Excel sheet with quite a number of data inside, and now I want to
perform queries directly in the sheet using VBA. One query is to find the
recurring users, so when I implemented it in MySQL I used the DATEDIFF
function, so is it possible to do this in Excel? I've tried to embed the SQL
statement into VBA, but it failed. Thank you!
My original SQL statement is like this:
select max(logtimestamp), min(logtimestamp), count(logtimestamp), username
from report
group by username
having datediff(max(logtimestamp),min(logtimestamp))>=14 order by
count(logtimestamp) DESC;
And it works in MySQL.
EDIT
I'm currently using ADODB in VBA to embed the SQL queries. Some simple
queries have already been implemented, so I suppose my configuration is
correct; the problem now is I don't know how to get this SQL query into VBA.
It's now giving an error, and it might be related to the DATEDIF (different from
DATEDIFF in SQL) function in Excel.
Topic 44
Subject
VBA Autofill formula with a fixed cell reference
Question
I am trying to autofill a formula to a range using vba. What i am trying to do is

to calculate a percentage contribution for each item. Say i have 2 entries
A1= 4
A2= 6
A3= sum of A1 and A2 =10
What i want is
B1= A1/$A$3 = 40%
B2= A2/$A$3 = 60%
but i am not quite sure how i could locate the last row of A and code it into the
Range("B1").Formula= "=A1/?????"
any ideas would help!
Thanks
Answer
Please try this..
Range("B1").FormulaR1C1 =
"=RC[-1]/INDEX(C[-1],MATCH(1E+99,C[-1]))"
You need to mention the range with circular references by specifying Row and
column no from the active cell respectively like RC[-1]/R3C1
Answer
Find the last cell first, then sum it and add the formula to column B
Sub Button1_Click()
Dim LstRw As Long, rng As Range, Sm As Range 
      LstRw = Cells(Rows.Count, "A").End(xlUp).Row 
      Set rng = Range("A1:A" & LstRw) 

      Set Sm = Cells(LstRw + 1, 1) 
      Sm = Application.Sum(rng) 
      rng.Offset(, 1) = "=a1/" & Sm.Address 
End Sub
Topic 45
Subject
Macro code does not worked out when copy multiple unordered cell range to
another workbook
Question
I want to copy some unordered rows from one workbook (File 1), to another
workbook (File 2). Here is the code that I already write, fyi the code is in File
1:
Private Sub CommandButton9_Click()
Dim CopyRng As Range, PasteRng As Range xTitleId = "For File Internal"
Dim wkb2 As Workbook
Dim sht2 As Worksheet
Set CopyRng = Application.Selection Set CopyRng =
Application.InputBox("Ranges to be copied :", xTitleId, CopyRng.Address,
Type:=8)
Set wkb2 = Workbooks.Open("C:\Users\Downloads\File 2.xlsx") Set sht2 =
wkb2.Worksheets(6)
sht2.Activate
Set PasteRng = Application.InputBox("Paste to (single cell):", xTitleId,
Type:=8)
CopyRng.Copy
PasteRng.Parent.Activate
With sht2.Range(PasteRng.Address) 

      .PasteSpecial xlPasteValuesAndNumberFormats 
      .PasteSpecial xlPasteFormats 
      .PasteSpecial xlPasteColumnWidths 
      Application.CutCopyMode = False 
End With
End Sub
When I copy a consecutive range (ex= E20:J24), this code is worked. The
problem is when i copy an unordered range (ex= E20:$J21,E23:J24), this code
does not worked out. But, when I use this code for copy an unordered range to
same worksheet it just worked. I still cannot figure out where is my mistake.
Answer
When you copy to a direct destination on another worksheet, you lose your
formulas and keep the cell formatting so you do not require the
xlPasteValuesAndNumberFormats or xlPasteFormats operations of the
Range.PasteSpecial method¹.
I suggest you break the multiple .PasteSpecial operations into two operations;
a Worksheet.Copy method with a distinct destination and a single .PasteSpecial
with xlPasteColumnWidths.
Private Sub CommandButton9_Click()
Dim copyRng As Range, pasteRng As Range, xTitleId As String Dim wkb2 As
Workbook, sht2 As Worksheet
xTitleId = "For File Internal"
Set copyRng = Application.Selection Set copyRng =
Application.InputBox("Ranges to be copied :", xTitleId, copyRng.Address,
Type:=8)
Set wkb2 = Workbooks.Open("C:\Users\Downloads\File 2.xlsx") Set sht2 =
wkb2.Worksheets(6)
sht2.Activate

Set pasteRng = Application.InputBox("Paste to (single cell):", xTitleId,
Type:=8)
'copy values and formatting
copyRng.Copy Destination:=pasteRng
'copy column widths
With pasteRng
.PasteSpecial xlPasteColumnWidths End With
End Sub
This works for my xl2010 version 14.0.7165.500 (32-bit). I've had people
contradict this practise stating that copy to another workbook actually does
bring over the formulas but I cannot reproduce that behavior in this version.
¹ See XlPasteType Enumeration for full list of Range.PasteSpecial operations
Topic 46
Subject
Synchronize Data between SQL and Excel in real time (Issue)
Question
I have this requirement of maintaining synchronization between Excel 2013 and
SQL Server,where in my workbook is connected to a Live Data
Source(Smartsheet) and I have to automatically get that data in my SQL server
table.
1. I have tried using the Linked Server,however I keep getting this error
'Microsoft.ace.oledb.12.0 provider is not registered' For which I have
tried installing Access database engine both 32bit and 64bit, Microsoft
Access Database Engine 2010 Redistributable,both didn't make any
difference. FYI Office is 64bit and so is SQL.
2. I cannot use SSIS related features because I have 2012 Express Edition of
SQL installed which doesn't include the extra features.
3. The normal Import Export wizard is my present resort,however its not a
sustainable and automated solution.

Hence can anyone help me with any other solutions or any insights on the listed
ones above,it will be greatly appreciated!
Topic 47
Subject
Compare Two Columns in Excel and Output Matched Results
Question
I'm not entire sure how to write this in VBA using a macro.
I have a single Workbook, Compare.xls. Two sheets in it, Sheet1 and Sheet2.
Basically I'm attempting to take:
Sheet1 
Date    ID  Other   Sub     Chan 
10000   100 Repeat  X       30 
10000   101 Repeat  X       40 
Sheet2 
ttc   event     Chan 
XYZ   L         30 
XYZ   L         40 
XYZ   L         6 
And from this data, I need to compare the Chan column from Sheet1, to a
matching record Chan record in Sheet2, and output joined data from both
sheets on to a new sheet.
Example output would be: 
Date    ID  Other   Sub     Chan   ttc 
10000   100 Repeat  X       30     xyz 
Any suggestions on a snippet on how I can move forward? Answer
Just noticed that you want to use VBA - not too sure why when this can be

easily done with built in formulas?
Because you are sort of going backwards using a VLLOKUP might not be the
best choice try using INDEX and MATCH ...
Here's a simplified version ...
Answer
Your request can be handled by a simple VLOOKUP function:
Step1: In Sheet2, copy and place column C (aka, column "Chan") at the
beginning of the worksheet.
Now your Sheet2 data should look like
Chan ttc event 
30      XYZ    L 
40      XYZ    L 
6       XYZ    L 
Step2: In Sheet1, add a column (should be column F) to the end of Sheet1 and
named it "ttc" (since this is what you want to lookup from Sheet2". Now your
Sheet1 data should look like 
Date    ID  Other   Sub     Chan    ttc 
10000   100 Repeat  X       30 
10000   101 Repeat  X       40 
Step3: enter the following function in column F of Sheet1
=VLOOKUP(E2,Sheet2!$A$2:$C$4,2,)
After you enter this formula the result will instantly comes up
Explanation: the Excel Vlookup function takes the following four arguments,
which are

separated with a comma: 1st argument is the cell (E2) containing the value in
Sheet 1 to look for 2nd argument contains the range of data to look into (which
resides in Sheet2 and the 
               cell range A2 through C4 is where the data
resides. 
               NOTE1:  the VLOOKUP function requires the 1st
column of Sheet2 to be the column 
                       to look into 
               NOTE2:  we don't need to include the 1st row
containing the header 
               NOTE3:  the dollar signs represent absolute
cell range so that when you copy it 
                       down to other rows below them, they
don't change (i.e., your data range 
                       in Sheet2 is always the same 
  3rd argument represents the column # in Sheet2 to return if
there's a match. 
               NOTE:  column 1 starts with column A of Sheet2
4th argument is left blank
Step4: copy this formula to all other rows below for column F
NOTE: subsequent row should have the formula
=VLOOKUP(F2,Sheet2!$A$2:$C$4,2,)
=VLOOKUP(G2,Sheet2!$A$2:$C$4,2,) if you have 3 rows in Sheet1
=VLOOKUP(H2,Sheet2!$A$2:$C$4,2,) if you have 4 rows in Sheet1
etc...
Topic 48
Subject
How do I get data from XML into excel using VBA?
Question
I am a high school student doing a science research project. I am not
experienced at programming in excel though i do have a good understanding of
general programming and logic. This is my first post.

I have done a thorough google search but I can't seem to find what i'm looking
for. Here I need to simply grab elevation data from this webservice:
hhttp://ned.usgs.gov/epqs/ All I need to know is how to have excel grab the
inner text from the xml such as this: http://ned.usgs.gov/epqs/pqs.php?
x=-73.06&y=40.8725&units=Feet&output=xml
Here is my code so far:
Sub elevgrabwebserv()
Dim Doc As HTMLDocument
Dim elev As String
Dim lat As String
Dim longt As String
Dim sht As Worksheet
Dim IE As New InternetExplorer
Set sht = ThisWorkbook.Worksheets("Both")
IE.Visible = False
lr = sht.Cells(sht.Rows.Count, "A").End(xlUp).Row
For i = 3 To lr
If sht.Cells(i, 7) > 0 And IsEmpty(sht.Cells(i, 14)) Then
lat = sht.Cells(i, 7)
longt = sht.Cells(i, 8)
IE.navigate "http://ned.usgs.gov/epqs/pqs.php?x=" & longt & "&y=" & lat &
"&units=Feet&output=xml"
Do
DoEvents
Loop Until IE.readyState = READYSTATE_COMPLETE Set Doc =
IE.document
'here below is the problem
elev = Doc.getElementsByName("elevation").innerText

'from here parse the inner text to fit my needs
End If
Next i
End Sub
Here is the sample data that I need to get. As you can see, I need to run this
web service many times, hence my for loop
Thank you so much in advance for any help! Answer
Add a VBA project reference to the library "Microsoft VML v6.0":
Sub Tester()
Debug.Print Elevation(-73.06, 40.8725) End Sub
Function Elevation(x, y)
Dim http As New XMLHTTP60
Dim doc As New MSXML2.DOMDocument60 http.Open "GET",
"http://ned.usgs.gov/epqs/pqs.php?x=" & x & _
"&y=" & y & "&units=Feet&output=xml" http.send
doc.LoadXML http.responseText
Elevation = doc.getElementsByTagName("Elevation")(0).nodeTypedValue End
Function
Topic 49
Subject
how to upload excel file in mysql databse and check the file validation
Question
I need to upload a file in excel or csv format in mysql database,and code
should also check for validation that each column should get appropriate value,
for eg : name column should only get character input or no column should be
empty. Here's a code which working for csv format,now please help me with
excel file upload. index.php

<!doctype html>
<html>
<head>
<title>Upload your Files</title>
<link rel="stylesheet"
href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script
src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js">
</script> <script
src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js">
</script> <meta charset="utf-8">
<style>
body{
background: url(http://p1.pichost.me/i/13/1356818.jpg); }
p{
font-size: 20px;
}
.hint
{
font-size: 10px;
}
footer
{ 
      text-align: center; 
      width:100%; 
      height:80px; 
      position:absolute; 
      bottom:0; 
      left:0; 
}
</style>
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"> 
    <div class="container"> 
      <div class="navbar-header"> 
        <button type="button" class="navbar-toggle" data-
toggle="collapse" data-target=".navbar-collapse"> 
          <span class="sr-only">Toggle navigation</span> 
          <span class="icon-bar"></span> 
          <span class="icon-bar"></span> 
          <span class="icon-bar"></span> 
        </button> 
        <a class="navbar-brand" href="#">CSV To MySql</a> 
      </div> 
      <div class="navbar-collapse collapse"> 
        <ul class="nav navbar-nav navbar-right"> 
          <li class="active"><a href="#">Home</a></li> 
          <li><a href="#about">About</a></li> 
          <li><a href="#about">How It Works</a></li> 
          <li><a href="#contact">Contact Me</a></li> 
        </ul> 
      </div> 
    </div> 
</nav>
<br>
<br>
<br>
<br>
<div class=" col-md-offset-4 col-xs-offset-4"> <form
enctype="multipart/form-data" action="called.php" method="post"
role="form"> <div class="form-group"> 
      <p>File Upload</p> 
      <input type="file" name="file" id="file" size="150"> 
      <p class="hint">Only CSV File Import.</p> 
</div>
<button type="submit" class="btn btn-default" name="Import"

value="Import">Upload</button> </div>
</form>
<footer>&copy;Parvez Alam</footer>
</body>
</html>
My php file
called.php
<?php
if(isset($_POST["Import"]))
{
$host='localhost';
$db_user= 'root';
$db_password= '';
$db= 'product_record';
$conn=mysql_connect($host,$db_user,$db_password) or die (mysql_error());
mysql_select_db($db) or die (mysql_error()); echo $filename=$FILES["file"]
["tmpname"]; if($_FILES["file"]["size"] > 0)
{
$file = fopen($filename, "r"); 
      while (($emapData = fgetcsv($file, 10000, ",")) !==
FALSE) 
      { 
          $sql = "INSERT into
prod_list_1(name,category,brand,price) values
('$emapData[0]','$emapData[1]','$emapData[2]','$emapData[3]')";
          mysql_query($sql); 
      } 
      fclose($file); 
      echo 'CSV File has been successfully Imported'; 
}
else

echo 'Invalid File:Please Upload CSV File'; }
?>
Answer
First of all, please use PDO or MySQLi.. mysql extension is depreciated.
I have had a similar issue before, though I needed to make sure that the values
are not duplicated, and if there is a duplicate then a page should show me a
notification.
The method I am using is different. I have a simple form to upload a csv file, a
page to analyze the uploaded file, and once I am ok with the analysis, the file is
uploaded to the database.
File 1: csv_upload.php
<form enctype="multipart/form-data" id="csv_upload" name="csv_upload"
action="csv_analysis.php" method="POST"> 
      <table border="0" width="40%" cellpadding="0"
cellspacing="0"> 
      <tr> 
          <th height="30">Select csv File</th> 
      </tr> 
      <tr> 
      <td height="50"><input name="file" type="file" /><br>
</td> 
      </tr> 
      <tr> 
      <td><input type="submit" value="Upload File" /></td> 
      </tr> 
      </table> 
      </form> 
File 2: csv_analysis.php
<?php
session_start();
//DB Connection:
require "dbcon.php";

if(is_uploaded_file($FILES['file']['tmpname'])){
//Process the CSV file
$findings = '
<form method="post" action="csv_upload_action.php"> <table
width="100%">
<tr> 
      <th width="5%">No</th> 
      <th width="19%">att0</th> 
      <th width="19%">att1</th> 
      <th width="19%">att2</th> 
      <th width="19%">att3</th> 
      <th width="19%">att4</th> 
</tr>';
$handle = fopen($FILES['file']['tmpname'], "r"); $data = fgetcsv($handle,
5000, ","); //Remove if CSV file does not have column headings $i = 1; 
$insert_record          = 0; 
$update_record          = 0; 
$file_duplicate_count   = 0; 
$file_duplicate         = array(); 
while (($data = fgetcsv($handle, 5000, ",")) !== FALSE) { 
      $att0   = $data[0]; 
      $att1   = $data[1]; 
      $att2   = $data[2]; 
      $att3   = $data[3]; 
      $att4   = $data[4]; 
//Check if row is in database already : Notification shown but record
overwritten in DB
$stmt = $db->query("SELECT * 
                      FROM    table_name 

                      WHERE   att0 =  '$att0' 
                      AND     att1 = '$att1' 
                      "); 
$count = $stmt->rowCount();
if($count > 0){ 
          $findings = $findings . ' 
      <tr class="'.$class.'"> 
          <td>'.$i.'</td> 
          <td><font color="#FF6600"><b>DB Duplicate<b></font>
</td>'. 
          '<td>'.$att0.'</td>'. 
          '<td>'.$att1.'</td>'. 
          '<td>'.$att2.'</td>'. 
          '<td>'.$att3.'</td>'. 
          '<td>'.$att4.'</td>'. 
          '</tr>'; 
//Update Statement:
$SESSION['insert'] .= "UPDATE tablename 
                              SET 
                              att2    = '$att2', 
                              att3    = '$att3', 
                              att4    = '$att4' 
                              WHERE   att0 =  '$att0' 
                              AND     att1 = '$att1' 
                              ;"; 
$update_record ++;
}
//Check if the record is a part of the file (File Duplicates):
elseif(array_search($att0.strtotime($att1), $file_duplicate) != false) {
$findings = $findings . '
<tr> 

      <td>'.$i.'</td> 
      <td><font color="#FF6666"><b>File Duplicate<b></font>
</td>'. 
      '<td>'.$att0.'</td>'. 
      '<td>'.$att1.'</td>'. 
      '<td>'.$att2.'</td>'. 
      '<td>'.$att3.'</td>'. 
      '<td>'.$att4.'</td>'. 
'</tr>';
$file_duplicate_count ++;
}
//Row is unique
else{ 
      //Add INSERT statement to INSERT queue 
      $SESSION['insert'] .= "INSERT INTO tablename 
                               ( 
                                  att0, 
                                  att1, 
                                  att2, 
                                  att3, 
                                  att4 
                                  ) 
                              VALUES ( 
                                  '$att0', 
                                  '$att1', 
                                  '$att2', 
                                  '$att3', 
                                  '$att4', 
                              );"; 
      $insert_record ++; 
      //Add row for row to findings table and mark unique 
      $findings = $findings . ' 
<tr class="'.$class.'"> 
      <td>'.$i.'</td> 
      <td><font color="#3333CC"><b>OK</b></td>'. 
      '<td>'.$att0.'</td>'. 
      '<td>'.$att1.'</td>'. 
      '<td>'.$att2.'</td>'. 

      '<td>'.$att3.'</td>'. 
      '<td>'.$att4.'</td>'.'</tr>'; 
}
$i++;
//using the array (to be used as a unique identifier for file duplicates):
$file_duplicate[] = $att0.strtotime($att1); }
$findings = $findings . '
<tr>
<td colspan="13">
<br> 
      <center> 
      Please note that entries that are highlighted with
<b>"DB Duplicate"</b> will be updated in the schedule. This
action can not be undone. 
      </center> 
<br>
<div align="center">
<input type="submit" value="Proceed" /></form><br><form
action="upload_action.php"><input type="submit" value="Cancel" /></form>
</div>
</td>
</tr>
</table>
'; 
  $SESSION['updaterecord']      =   $update_record; 
  $SESSION['insertrecord']      =   $insert_record; 
$SESSION['duplicatedrecords'] = $file_duplicate_count;

echo $findings;
}
else{
header("Location:csv_upload.php");
}
?>
**File 3: csv_upload_action.php **
<?php
session_start();
//DB Connection:
require "dbcon.php"; 
  $update_record          =   $SESSION['updaterecord']; 
  $insert_record          =   $SESSION['insertrecord']; 
$file_duplicate_count = $SESSION['duplicatedrecords'];
if(!isset($_SESSION['insert'])){
header("Location:csv_upload.php"); }
$queries = explode(';', $_SESSION['insert']);
foreach($queries as $query){
if($query != ""){ 
      $stmt   =   $db->prepare($query); 
      $stmt->execute(); 
}
}
echo "<center><br><br>CSV File uploaded<br>";

if($insert_record != 0){
echo $insert_record." records added to the database.<br>"; }
if($update_record != 0){
echo $update_record." records were modified.<br>"; }
if($file_duplicate_count != 0){
echo $file_duplicate_count." records were duplicated in the uploaded file,
they were not written to the database.<br>"; }
unset($_SESSION['insert']);
?>
Might not be exactly what you are looking for, but I hope it helps.
Topic 50
Subject
Excel VBA SQL query ADODB
Question
Hi I have an existing Excel sheet with some data inside, and now I want to
perform queries directly from VBA. This is what I have now:
Private Sub CommandButton1_Click()
Dim sSQLQry As String
Dim ReturnArray
Dim Conn As New ADODB.Connection
Dim mrs As New ADODB.Recordset
Dim DBPath As String, sconnect As String Dim newSheet As Worksheet
'DBPath = ThisWorkbook.FullName
DBPath = "C:\someData.xlsm"
sconnect = "Provider=MSDASQL.1;DSN=Excel Files;DBQ=" & DBPath &
";HDR=Yes';" Conn.Open sconnect
sSQLSting = "SELECT username,count(username) FROM [Sheet1$] group by
username order by count(username) desc;" mrs.Open sSQLSting, Conn

Set newSheet = Sheets.Add
ActiveSheet.Range("A1").CopyFromRecordset mrs mrs.Close
Conn.Close
End Sub
This query performs well and gives the desired result, but when I change it to
this one:
Select param0,count(param0) From [Sheet1$] where eventid='addToCart'
group by param0 order by count(param0) desc;
Because the param0 is like this: most of them are numbers, but some of them
are numbers and characters mixed together, so the query result only returns the
pure-number entries. So how can I configure the database so that it recognizes
the param0 field should be text, instead of int? Also, when I perform this
query:
Select eventid,param0,param1,count(*) From [Sheet1$] where
eventid='search' group by param0, param1 order by count(*) desc;
It gives 'automation error'. I searched for it but could not get a suitable
solution. Can anyone help with this? Thank you!
Edit: all the three queries give correct results in MySQL workbench. Now I
need to perform the query directly in Excel sheet. Answer
Your second problem lies within the fact that you are asking for the eventid
field without including it within the aggregate GROUP BY clause.
SELECT eventid, param0, param1, count(*) FROM [Sheet1$]
WHERE eventid='search'
GROUP by eventid, param0, param1
ORDER BY COUNT(*) DESC;
I ran your repaired queries against some sample data that I made up and came
up with this.
Sub grp_param()

Dim cnx As Object, rs As Object, rs1 As Object Dim sWS1 As String, sWS2
As String, sWB As String, sCNX As String, sSQL As String Dim ws1TBLaddr
As String
ws1TBLaddr = Worksheets("Sheet4").Cells(1, 1).CurrentRegion.Address(0,
0) sWS1 = Worksheets("Sheet4").Name
sWB = ThisWorkbook.FullName
'for 64-bit Office
'sCNX = "Provider=Microsoft.Jet.OLEDB.12.0;Data Source=" & sWB _
& ";Extended Properties=""Excel 8.0;HDR=Yes;IMEX=1"";" 'for 32-bit or 64-
bit Office
sCNX = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & sWB _
& ";Extended Properties=""Excel 8.0;HDR=Yes;IMEX=1"";" Debug.Print
sCNX
Set cnx = CreateObject("ADODB.Connection") Set rs =
CreateObject("ADODB.Recordset") Set rs1 =
CreateObject("ADODB.Recordset")
cnx.Open sCNX
'Select param0,count(param0) From [Sheet1$] where eventid='addToCart' '
group by param0 order by count(param0) desc; sSQL = "SELECT param0,
COUNT(param0) " & _ 
         "FROM [" & sWS1 & "$" & ws1TBLaddr & "] " & _ 
         "GROUP BY param0 " & _ 
         "ORDER BY count(param0) DESC;" 
Debug.Print sSQL
rs.Open sSQL, cnx
With Worksheets.Add(after:=Sheets(Sheets.Count)) 
      .Name = "Summary Data" 

      .Range("A1").Resize(1, 2) = Array("param0", "count") 
      .Range("A2").CopyFromRecordset rs 
End With
'Select eventid,param0,param1,count(*) From [Sheet1$] where
eventid='search' 'group by param0, param1 order by count(*) desc; sSQL =
"SELECT eventid, param0, param1, COUNT(*) " & _ 
         "FROM [" & sWS1 & "$" & ws1TBLaddr & "] " & _ 
         "GROUP BY eventid, param0, param1 " & _ 
         "ORDER BY count(param0) DESC;" 
Debug.Print sSQL
rs1.Open sSQL, cnx
With Worksheets(Sheets.Count) 
      .Range("E1").Resize(1, 3) = Array("eventid", "param0",
"count") 
      .Range("E2").CopyFromRecordset rs1 
End With
rs.Close:Set rs = Nothing
rs1.Close:Set rs1 = Nothing
cnx.Close:Set cnx = Nothing
End Sub
I'm unclear on why mySQL allows that last query but my background is in T-
SQl and it would certainly choke on that.
Answer
For the first confusion, I noticed the post here: link , but I don't want to add in
another file for processing, so in the end no other choice, I pre-process the file

by adding in 4 lines of texts right below the header line. (As in my case all
fields can be text; I did this in MySQL) As the amount of data is quite big,
these dummy texts don't affect the result yet help me produce the DB correctly.
Topic 51
Subject
Adding an Expression to a Range in the Excel COUNTIF Function
Question
Simple question that will likely end in me using a different function, but not
entirely sure what would do the same command with an expression added to
the comparison.
Here is my simple function:
=COUNTIF('Service Calls'!E:E,C3)
This will return if an exact match is found, however it is querying a time
column that holds hours and minutes. What I want to pull is only the whole
hour so that I can collect service calls per hour. How would I go about running
the COUNTIF function with an added modifier such as HOUR() for each cell
in the comparison? I could right this in code very quickly, but for some reason
my brain goes blank when it comes to excel.
I have tried this, but obviously this will never work:
=COUNTIF(HOUR('Service Calls'!E:E),C3)
Any thoughts or direction would be great! Thanks guys and gals! Answer
Try,
=sumproduct(--(hour('Service Calls'!E:E)=C3), sign(len('Service
Calls'!E:E)))
The SUMPRODUCT function does not like thrown errors so if some of your
data cannot have the HOUR stripped out of it, additional error control will
have to be added.

SUMPRODUCT will calculate every cell you tell it to. It does not not truncate
full column references to the extents of the data like a COUNTIFS function. Be
wary about using full column references with SUMPRODUCT; always pare
down the cell ranges to a reasonable approximation of the actual scope of the
data.
If your data strictly 'holds hours and minutes' then this may be more
appropriate (and more efficient).
=countifs('Service Calls'!E:E, ">="&time(C3, 0, 0), 'Service Calls'!E:E, "
<"&time(C3+1, 0, 0))
This COUNTIFS solution is not appropriate with datetime values but the
SUMPRODUCT will peel out the hour of values containing both a date and
time.
Topic 52
Subject
Excel VBA, code to count the # of filled cells, then find highest and 2nd
highest and subtract the corresponding column #'s [closed]
Question
I'm looking to count the # of items in a list from A11 to A90. And if that
number is even subtract the max value from the 2nd max and then 3rd max from
4th max, etc.. If it's odd then it would start at the 2nd max minus the 3rd, and
4th to 5th etc.. Until all numbers have been subtracted from their counterpart.
The tricky part is that the numbers which need to be subtracted are in a
different column, C11 to C90.
I'm basically trying to find the number of consecutive negative outcomes from
column C using the 2 closest values from column A.
Any input would be greatly appreciated!! Answer
I solved this by recording a macro that copys and pastes the data values into
another section then I sorted it largest to smallest.
I then created a column with the equation to subtract one from the other.

Topic 53
Subject
Conditional formatting excel textbox
Question
What is the best way to change the font color of a single textbox based on value
of linked cell?
Textbox is located on sheet1 when recording macro it recognizes textbox as
ActiveSheet.Shapes.Range(Array("TextBox 1")).Select
I have inserted an image on sheet1, then I inserted textbox's from the insert
toolbar. All the textbox's are linked to data on the "stylist" sheet. This sheet
gets updated with a macro when the workbook is opened. I'm trying to get the
textbox fonts to be red or green based on comparing the value of the linked cell
to another cell on the stylist sheet.
enter image description here
Answer
Please try this..
' replace Text with your text box name
ActiveSheet.Text.Object.ForeColor = RGB(0, 255, 0)
Answer
With the code you provided and described as having a linked cell, one would
assume you are referring to a TextBox from the ActiveX toolbar.
The code for that textbox is located in the Worksheet module. Right click on the
sheet tab and select View code to open that module.
If your Linked cell is A1 then we could use a Worksheet_Change event to
trigger the code when you change A1.
Private Sub Worksheet_Change(ByVal Target As Range)
If Target.Count > 1 Then Exit Sub

If Target.Address <> "$A$1" Then Exit Sub
Dim x
x = IIf(Target <= 0, vbRed, vbGreen)
Me.TextBox1.ForeColor = x
End Sub
You can also use the TextBox1_Change event, this would trigger when the
textbox changed.
Private Sub TextBox1_Change()
Dim x
x = IIf(TextBox1.Value <= 0, vbRed, vbGreen) Me.TextBox1.ForeColor = x
End Sub
You did not indicate what the conditions were so I made up my own.This
example uses,
if <=0 then red, else green
The results would be
Topic 54
Subject
PivotTable connection timeout was exceeded
Question
I am creating a PivotTable in excel and pulling data from SSAS
multidimensional cube, however when I select a measure to be shown in
PivotTable then OLAP query runs in the background for 60 seconds and then it
throws following error:
The Connection timeout was exceeded

I've increased Analysis server property ExternalConnectionTimeout from 60 to
180 but even then my PivotTable throws same error after 60 seconds.
Please let me know how can I fix this issue?
Topic 55
Subject
How to Transpose Data Using Excel
Question
is there a way that i can do the following transformation ?
Nov-2010
1195
1175
1676
36500.5
$33,607
Dec-2010
1215
1189
1775
46866.5
$38,714
to
Nov-2010 1195 1175 1676 36500.5 $33,607 Dec-2010 1215 1189 1775
46866.5 $38,714
Do i have to fill in the blanks first ? Answer
I am assuming that not every month has exactly five numbers. If it does you
don't need any of the extra checks and you can just paste a much simpler
formula into F4:I9 (explained below). But my formula works if one month has
2 values and another month has 12 values.
If your original data is in A1:B10 and your transposed heading are in E4:E5

like the screenshot of the spreadsheet shows then you can put this in F4 and
copy it to F4:Z10
=IF(IF(ISERROR(MATCH($E5,$A:$A,0)>MATCH($E4,$A:$A,0)+COLUMN
COLUMN($E4)-1),MATCH(9.99999999999999E+307,$B:$B)+1>=MATCH($
COLUMN($E4),MATCH($E5,$A:$A,0)>MATCH($E4,$A:$A,0)+COLUMN()
COLUMN($E4)-1),OFFSET($B$1,MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-2,0),"")
Gow it works:
The integral bit is OFFSET($B$1,MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-2,0) which gets the value from a certain cell based on the
value in E4. (This is what you would paste into F4:I9 if every month had
exactly five values.) But that isn't sufficient if the months could each have a
different number of values. In that case we need to know how to stop it from
getting more values than we want:
If there is another month in E below the current row we can use
IF(MATCH($E5,$A:$A,0)>MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-1,OFFSET($B$1,MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-2,0),"") to optionally display a value.
If there is no other month in E below the current row we can use
IF(MATCH(9.99999999999999E+307,$B:$B)+1>=MATCH($E4,$A:$A,0)+C
COLUMN($E4),OFFSET($B$1,MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-2,0),"") to optionally display a value.
But we need both so we have to use an if to decide which one to use and we
end up with the big one. Here it is spread across multiple lines for clarity - you
can paste it into the formula bar like this but you can't paste it into a cell
directly because of the line feeds.
=IF(
IF( 
    ISERROR(MATCH($E5,$A:$A,0)>MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-1), 

  
MATCH(9.99999999999999E+307,$B:$B)+1>=MATCH($E4,$A:$A,0)+COLUM
COLUMN($E4), 
    MATCH($E5,$A:$A,0)>MATCH($E4,$A:$A,0)+COLUMN()-
COLUMN($E4)-1), 
OFFSET($B$1,MATCH($E4,$A:$A,0)+COLUMN()-COLUMN($E4)-2,0),
"")
Answer
The Nov-2010 would have to be on top of the 1195 in order to use the
worksheet's Copy, Paste Special, Transpose command. The OFFSET function
could work with a little row and column maths but that is a volatile¹ function
and best kept for when nothing else will suffice. The INDEX function provides
a non-volatile alternative to OFFSET.
Your sample data neatly offers 5 associated entries in column B for each date
in column A. It has been my experience that sample data is not always
representative of actual data. You will have to fill every row right to the
maximum that any one date could have associated values.
In E4:F4 as standard formulas,
'in E4
=IFERROR(INDEX(A:A, 
             AGGREGATE(15, 6, ROW(A$1:INDEX(A:A,
MATCH(1E+99,A:A )))/SIGN(LEN(A$1:INDEX(A:A, MATCH(1E+99,A:A
)))), 
             ROW(1:1))), "") 
'in F4
=IFERROR(INDEX(INDEX($B:$B, MATCH($E4,$A:$A,
0)):INDEX($B:$B, 
             IFERROR(MATCH($E5,$A:$A, 0)-1, MATCH(1E+99,$B:$B
))), 
             COLUMN(A:A)), "") 

Fill E4 down until you run out of dates from column A to retrieve. Fill F4 right
until you have reached the maximum of associated values that any date could
have then fill down to the extent of the dates in column E.
     
¹ Volatile functions recalculate whenever anything in the entire workbook
changes, not just when something that affects their outcome changes. Examples
of volatile functions are INDIRECT, OFFSET, TODAY, NOW, RAND and
RANDBETWEEN. Some sub-functions of the CELL and INFO worksheet
functions will make them volatile as well.
Topic 56
Subject
How to return datetime in Excel when SQL table has only time?
Question
I am currently querying against an Informix SQL table that is datetime, however
only holds time, such as "07:30:44". I need to be able to pull this data and have
the send_time show what the actual time was, and not "0:00:00".
Example

Informix Table Data
| send_date | 02/09/2016 | --datetime field
| send_time | 07:30:44 | --datetime field
When I query through Excel via Microsoft Query editor, I can see the correct
value, "07:30:44" in the preview, however what is returned in my sheet is
"0:00:00". Normally I would change the formatting on the cell, however the
literal value for the entire column is "12:00:00 AM".

Excel pulls/displays
| send_date | 02/09/2016 |
| send_time | 12:00:00 AM| --displayed is "0:00:00"
I have cast the field as char to see if it would return correctly, and it does!
However you can't use parameters/build quick reports with this method.
Desired Excel output
| send_date | 02/09/2016 |
| send_time | 07:30:44 |
Is there another way to resolve this? I'd love to give the users an easy way to
build queries without having to cast anything.
Topic 57
Subject
Unable to print MATLAB data in new row in EXCEL
Question
I am trying to get this data to present itself into a new row each time a result is
obtained. However, i am only getting 1 row in excel as of now.
--> I Guess the thing I am being unable to do is that, once one data point is
entered /written, matlab needs to AUTOMATICALLY goto the next line/row ...
which it is currently not doing.
Any help appreciated,
Thanks!

figure;
prices_pred = zeros(size(prices));
prices_pred(750) = prices(750);
time_show = 15000;
for t = 750:length(prices)-1
price180 = prices(t-179:t);
price360 = prices(t-359:t);
price720 = prices(t-719:t);
dp = theta0 + theta(1);
prices_pred(t+1) = prices(t) + dp;
if (t-750 < time_show) 
      x1 = 0:t-750; 
      y1 = prices(750:t); 
      x2 = 0:t-749; 
      y2 = prices_pred(750:t+1); 
end
if (t-750 > time_show) 
      x1 = 0:time_show; 
      y1 = prices(t-time_show:t); 
      x2 = 0:time_show+1; 
      y2 = prices_pred(t-time_show:t+1); 
end
plot(x1,y1,'b',x2,y2,'m');
drawnow;
disp(prices_pred(t+1));
disp(prices(t));
disp(dp);

if (T > 750)
T = {T;table(prices_pred(t), prices(t),dp)}; else
T = table(prices_pred(t), prices(t),dp); end
filename = 'test.csv';
writetable(T, filename);
Answer
An easy way to write to Excel is by using a cell array and the xlswrite
command.
With the variables given below, the steps for that would be as follows...
Variables
eventDate = [{'2016-02-10'};{'2016-02-11'};{'2016-02-12'}]; eventTime =
[931;931;1600];
eventValue = [{'open'};{'open'};{'close'}]; xlsDir = 'c:\xls\';
xlsFilename = [xlsDir,'output.xls'];
1. preallocate your cell array:
nevent = length(eventTime);
xxcell = cell(nevent+1,3);
2) create the headerlines for your cell array:
irow = 1; icol = 1;
xxcell{irow,icol} = 'Date'; icol = icol + 1; xxcell{irow,icol} = 'Time'; icol =
icol + 1; xxcell{irow,icol} = 'Value'; icol = icol + 1;
3) Add your data to the cell array:
for ievent = 1:nevent
irow = ievent + 1; icol = 1;
xxcell{irow,icol} = eventDate{ievent}; icol = icol + 1; xxcell{irow,icol} =

eventTime(ievent); icol = icol + 1; xxcell{irow,icol} = eventValue{ievent};
icol = icol + 1; end
4) write to Excel:
try
xlswrite(xlsFilename, xxcell);
catch
disp('xlswrite error');
end
I haven't tried using the writetable command, but this method works well
enough.
Topic 58
Subject
Excel file export styling for node.js
Question
I am building a reporting server that allows end users to export data into
excel(.xlsx) format. We need to allow the user to define what the export looks
like such as bolded items, conditional background colors, etc.
There are several libraries that offer this functionality as long the report is
being created and executed in the browser.
PROBLEM: I need to be able to save a user defined configuration and
schedule a server job to run on its own without the browser.
I originally tried using Excel-Export Open Office XML and allowing the user
to edit a styles.xml file but the xml is far too complicated for my users to be
able to figure out.
Then I tried using a browser based library server side but most require
window object and really dont want to run a headless browser.
Any ideas?

Topic 59
Subject
Referencing another sheet for data, for use with a duplicate-value checker in
Excel using VLOOKUP
Question
I have this spreadsheet that tells me if a name is not in one of two lists, by
checking if it is there, and if it is not, then putting an X in the correct cell. I
used: =IF(COUNTIFS(E:E,A:A),"","X") in B3, and
=IF(COUNTIFS(G:G,A:A),"","X") in C3 and then auto filled down.
I am trying to have it so that I only have the first three columns in this
spreadsheet, and the "Names1" and "Names2" being referenced from another
sheet. ( to keep this discussion short and to the point, let's just discuss the
names1 column, as the names2 column would be the same concept.) So,
Names1 is just names from a large CSV file on another sheet (I copy pasted it
for testing) that refreshes the cdv excel sheet with new data as data is added to
the CSV file. I need to pull the names in Names1 from that csv excel sheet.
The csv excel file has a numbered list in the first column, and then the names in
the second column. the table_array name is csv on the sheet. This is what I am
using, but I keep getting error codes no matter what I try:
=VLOOKUP(A1,csv,2,FALSE) Also, I need it so that the original list checker
function still works... I am using Excel 2011 for Mac. Any help would be
greatly appreciated guys! I've been stuck on this for waaay too long... Answer
You can keep this really simply by just writing.
=IF(COUNTIFS(Names1!B:B,A3),"","X")
=IF(COUNTIFS(Names2!B:B,A3),"","X")
where Names1 and Names2 are the sheet names for each list.
If you don't need to see separate lists, you can also combine them with this
statement:
=IF(COUNTIFS(Sheet5!B:B,A3)+COUNTIFS(Sheet4!B:B,A3),"","X")

Topic 60
Subject
How to reference current cell in Excel 2013?
Question
I'm trying to make a spreadsheet of my company's sales by state, by month, and
I'd like it to have (under any given month, for any given state), the number of
orders for that month, and then in parentheses, the growth or loss percentage
relative to the previous month. For example:
February 
Florida          10 (+2.75%) 
Georgia          26 (-4.27%) 
So what formula/macros would I need to use in the cells? Any help would be
much appreciated. Thanks!
What I have Now
Answer
You can create a 2nd sheet with the exact same structure as the first and enter
this formula starting in C2 (for May for AL).
=IFERROR(Sheet1!C2&" "&TEXT((Sheet1!C2/Sheet1!B2)-1,"(+0.00%);
(-0.00%)"),"NA")
Then drag it across rows and columns. You can make adjustments for errors
and such as you need.
Topic 61
Subject
Microsoft.SqlServer.Dts.Tasks.ScriptTask.SSISScriptTaskEntryPointAttribute
is not defined
Question
Using a script I found here Problem is it's for 2012 and I'm using 2008.

I've handled all of the personal stuff(connections, variables, URLS, etc.) But I
keep getting an error when I try to run the script.
Microsoft.SqlServer.Dts.Tasks.ScriptTask.SSISScriptTaskEntryPointAttribute
is not defined
Using VB.
Imports System
Imports System.Data
Imports System.Math
Imports Microsoft.SqlServer.Dts.Runtime Imports System.ComponentModel
Imports System.Diagnostics
<Microsoft.SqlServer.Dts.Tasks.ScriptTask.SSISScriptTaskEntryPointAttribute
_ <System.CLSCompliantAttribute(False)> Partial Public Class ScriptMain
Inherits
Microsoft.SqlServer.Dts.Tasks.ScriptTask.VSTARTScriptObjectModelBase
Enum ScriptResults 
      Success =
Microsoft.SqlServer.Dts.Runtime.DTSExecResult.Success 
      Failure =
Microsoft.SqlServer.Dts.Runtime.DTSExecResult.Failure 
End Enum
Protected Sub SaveFile(ByVal url As String, ByVal localpath As String) 
      Dim loRequest As System.Net.HttpWebRequest 
      Dim loResponse As System.Net.HttpWebResponse 
      Dim loResponseStream As System.IO.Stream 
      Dim loFileStream As New System.IO.FileStream(localpath,
System.IO.FileMode.Create, System.IO.FileAccess.Write) 
      Dim laBytes(256) As Byte 
      Dim liCount As Integer = 1 
      Try 
          loRequest =
CType(System.Net.WebRequest.Create(url),
System.Net.HttpWebRequest) 
          loRequest.Credentials =
System.Net.CredentialCache.DefaultCredentials 

          loRequest.Timeout = 600000 
          loRequest.Method = "GET" 
          loResponse = CType(loRequest.GetResponse,
System.Net.HttpWebResponse) 
          loResponseStream = loResponse.GetResponseStream 
          Do While liCount > 0 
              liCount = loResponseStream.Read(laBytes, 0,
256) 
              loFileStream.Write(laBytes, 0, liCount) 
          Loop 
          loFileStream.Flush() 
          loFileStream.Close() 
      Catch ex As Exception 
      End Try 
End Sub
Public Sub Main() 
      Dim url, destination As String 
      destination =
Dts.Variables("FolderDestination").Value.ToString + "\" +
"Report_" + Dts.Variables("ReportParameter").Value.ToString +
"" + Format(Now, "yyyyMMdd") + ".xls" 
      url =
"Execute_SSRS_Report&rs:Command=Render&Productkey">http://local
+ Dts.Variables("ReportParameter").Value.ToString +
"&rs:Format=EXCEL" 
      SaveFile(url, destination) 
      Dts.TaskResult = ScriptResults.Success 
End Sub
End Class
Answer
Figured it out.
The Addin.Addins have been deprecated.
<Microsoft.SqlServer.Dts.Tasks.ScriptTask.SSISScriptTaskEntryPointAttribute
_ <System.CLSCompliantAttribute(False)> _
is fine for 2010 but for 2008

<System.AddIn.AddIn("ScriptMain", Version:="1.0", Publisher:="",
Description:="")> _ <System.CLSCompliantAttribute(False)> _
is needed.
Hope that helps anyone else out.
Topic 62
Subject
Run a loop to check columns based on header name, and insert columns if they
are missing
Question
I am new to VBA and have been tasked with creating a macro to clean up and
save .csv files. So far I have been able to put together the script from other
answered questions here on Stack Overflow, but the final piece is eluding me.
So far I can open, check for columns that need to be deleted, delete them, then
save as a new file. What I need to do is check if columns are missing and insert
them so that the csv files all consistently have the same header row.
For example:
Let's say that all of the necessary columns have the first row cell values as
"Alpha", "Bravo", "Charlie", "Delta", "Echo", "Foxtrot", "Golf"
But sometimes the CSV files we receive only go from "Alpha" to "Echo"
I need to check for this and then insert the columns "foxtrot" and "Golf" in their
respective order. How would I go about doing this?
It seems like with minor tweaks and a little more code, I can modify my
column delete script (which I found here) to do this.
Dim rngFound As Range 
    Dim rngDel As Range 
    Dim arrColumnNames() As Variant 
    Dim varName As Variant 
    Dim strFirst As String 

    arrColumnNames = Array("Hotel","India","Julliet") 
    For Each varName In arrColumnNames 
        Set rngFound = Rows(1).Find(varName, Cells(1,
Columns.Count), xlValues, xlPart) 
        If Not rngFound Is Nothing Then 
            strFirst = rngFound.Address 
            Do 
                If rngDel Is Nothing Then Set rngDel =
rngFound Else Set rngDel = Union(rngDel, rngFound) 
                Set rngFound = Rows(1).Find(varName,
rngFound, xlValues, xlPart) 
            Loop While rngFound.Address <> strFirst 
        End If 
    Next varName 
    If Not rngDel Is Nothing Then rngDel.EntireColumn.Delete 
    Set rngFound = Nothing 
    Set rngDel = Nothing 
    Erase arrColumnNames 
But it's a little beyond me as I've never worked with VBA; can someone
provide some direction? Answer
The easiest way would be to put any missing columns off the right side and
then sort left-to-right (rather than the typical top-to-bottom). However, I'll
assume that your column header labels are not like the nice alphabetic ones
you've provided so that means a custom sort and you would have to provide all
of the column names for that.
The Array Filter method can quickly determine if you have columns that do not
belong however it is a pattern match not an exact match so there is a possibility
of false positives. Your own results will depend on the actual names of the
columns header labels you use. If this is an inappropriate method then simply
loop through each.
Sub fixImportColumns()
Dim c As Long, vCOLs As Variant

vCOLs = Array("Alpha", "Bravo", "Charlie", "Delta", "Echo", _
"Foxtrot", "Golf", "Hotel", "India", "Julliet")
With Worksheets("myImportedCSV") 
      'add non-existent columns from list 
      For c = LBound(vCOLs) To UBound(vCOLs) 
          If IsError(Application.Match(vCOLs(c), .Rows(1),
0)) Then _ 
              .Cells(1,
Columns.Count).End(xlToLeft).Offset(0, 1) = vCOLs(c) 
      Next c 
      With .Cells(1, 1).CurrentRegion 
          'get rid of columns not in list (from right-to-
left) 
          For c = .Columns.Count To 1 Step -1 
              If UBound(Filter(vCOLs, .Cells(1, c), True,
vbTextCompare)) < 0 Then _ 
                  .Columns(c).EntireColumn.Delete 
          Next c 
          'create a custom list for the sort order 
          Application.AddCustomList ListArray:=vCOLs 
          'clear any remembered sort 
          .Parent.Sort.SortFields.Clear 
          'sort the columns into the correct order 
          .Cells.Sort Key1:=.Rows(1), Order1:=xlAscending, _ 
                      Orientation:=xlLeftToRight,
Header:=xlNo, MatchCase:=False, _ 
                    
OrderCustom:=Application.CustomListCount + 1 
      End With 
End With
End Sub
Although not widely used, the Range.Sort method can sort blocks of data from
lef-to-right and use a custom list as the sort order.

Answer
This should take care of it (assuming duplicate column names are not
permitted):
Sub ReorderAddDeleteCols()
Dim arrCols, x As Long, sht As Worksheet, f As Range, s
'All the fields you want in the final version (in the order needed) arrCols =
Array("Col1", "Col5", "Col2", "Col3", "Col6")
Set sht = ActiveSheet
'insert enough columns for the required fields sht.Cells(1, 1).Resize(1,
UBound(arrCols) + 1).Insert Shift:=xlToRight x = 1
For Each s In arrCols 
      Set f = sht.Rows(1).Find(What:=s, LookIn:=xlValues,
lookat:=xlWhole) 
      If Not f Is Nothing Then 
          'column found, move to required location 
          sht.Columns(f.Column).Cut sht.Cells(1, x) 
      Else 
          'not found - add header 
          sht.Cells(1, x).Value = s 
      End If 
      x = x + 1 
Next s
'delete all other remaining columns (100 just an arbitrary value here...)
sht.Cells(1, x).Resize(1, 100).EntireColumn.Delete
End Sub
Answer
This code will work as standalone to do what you want. You can incorporate
into your existing code, or simply add as a separate sub to just do this activity.

It loops through the list backward and adds any missing columns in
alphabetical order.
Sub AddMissingColumns()
Dim arrColumnList() As String
arrColumnList = Split("Alpha,Bravo,Charlie,Delta,Echo,Foxtrot,Golf", ",")
Dim x As Integer
For x = UBound(arrColumnList) To LBound(arrColumnList) Step -1
Dim rngFound As Range
Set rngFound = Sheets("sheet1").Rows(1).Find(arrColumnList(x),
lookat:=xlWhole)
If Not rngFound Is Nothing Then 
      Dim sLastFound As String 
      sLastFound = arrColumnList(x) 
Else 
      If sLastFound = "" Then 
          With Sheets("Sheet1") 
              .Range("A" &
.Columns.Count).End(xlToLeft).Offset(1).Value =
arrColumnList(x) 
          End With 
          sLastFound = arrColumnList(x) 
      Else 
          With Sheets("Sheet1") 
              Dim rCheck As Range 
              Set rCheck = .Rows(1).Find(sLastFound,
lookat:=xlWhole) 
              rCheck.EntireColumn.Insert shift:=xlShiftRight 
              rCheck.Offset(, -1).Value = arrColumnList(x) 
              sLastFound = arrColumnList(x) 
          End With 
      End If 

End If
Next
End Sub
Topic 63
Subject
PowerPivot get excluded data from Access
Question
Sample Data
I have a Access, which has more than 1 million rows of data, as you can see
from the screenshot. I want to dedupe the data in term of BRUIDREQID, as it
has duplicates. Is there any way that when I connect data from Access to
PowerPivot, I can get deduped dataset?
What I am doing now is using Python to dedupe the data and extract it as a csv
file. I want to know whether I can use PowerPivot instead and save more time
to dedupe large data set. Answer
When accessing the Access database, you should be able to write arbitrary
SQL, and you could just do a

SELECT DISTINCT
FROM Table
, which would de-dupe the table.
Power Pivot does not offer any functionality to change the existing data in a
table once imported - you cannot add or remove rows, nor can you alter the
values of any imported fields.
Topic 64
Subject
Inserting column from sheet2 into sheet1 in Excel without zeroes on
unavailable data?
Question
I am trying to get a column from one sheet and putting it in another. I am pulling
the "names" column from this sheet: this is sheet2
and putting it into another sheet (sheet1) by using =sheet2!A3 and =sheet2!A4
and then dragging down to the bottom of the excel page to fill the formulas. The
problem that I am having, is that for data that is not in sheet2 that it is still
trying to get, I am getting zeroes like this, all the way to the bottom of the page:
This is sheet 1 after I pull the column from sheet2
How do I prevent these zeroes from appearing? I would assume there is a way
to "copy data in column until the bottom of the data". Basically, how do I make
it so that as "sheet2" grows in size, "sheet1" will also, but without the zeroes?
(The cell format is in "general" if that helps, and I am using Excel 2011 for
Mac) Answer
=IF(ISBLANK(A1)=TRUE,"",A1)
Formula is... if that if the cell is blank, show an empty cell instead of 0. Hope
this helps!

Topic 65
Subject
telnet script error in vba
Question
So I am writing a script in vba to perform telnet and following is part of the
code.
Dim vPath As String
Dim vFile As String
Dim vFTPServ As String
Dim ServSlot As String
Dim fNum As Long
vPath = Application.InputBox("Enter the File Directory") vFile =
Application.InputBox("Enter the File Name") vFTPServ =
Application.InputBox("Enter the IP Address") ServSlot =
Application.InputBox("Enter the slot #")
Dim WshShell As Object
Set WshShell = CreateObject("WScript.Shell") WshShell.Run "cmd.exe"
WScript.Sleep 1000
it seems as the code works fine till the cmd.exe and then displays the runtime
error "424" - object required. for the Wscript.sleep 1000 line.
Any kind of help will be much appreciated.
Topic 66
Subject
To display number of blank cells from a range by using filters
Question
I used conditional formatting to display blank cells and created macros by
filtering by name of every individual who has blanks on the worksheet. Now I
need to display the number of blank cells for each individual. How do I go
about it .

Sub Displayblanks_John_Doe()
'
' Displayblanks_John_Doe Macro
'
' Keyboard Shortcut: Ctrl+Shift+J
'
Range("A3:L26").Select
Range("A3:L26,N3:N26").Select
Range("N3").Activate
Range("A3:L26,N3:N26,R3:R26").Select
Range("R3").Activate
Range("A3:L26,N3:N26,R3:R26,W3:W26").Select Range("W3").Activate
Selection.FormatConditions.Add Type:=xlExpression, Formula1:= _
"=LEN(TRIM(A3))=0"
Selection.FormatConditions(Selection.FormatConditions.Count).SetFirstPriorit
With Selection.FormatConditions(1).Interior
.Pattern = xlGray8
.PatternColorIndex = xlAutomatic
.ColorIndex = xlAutomatic
End With
Selection.FormatConditions(1).StopIfTrue = False
ActiveSheet.Range("$A$3:$W$26").AutoFilter Field:=7, Criteria1:= _
"John Doe"
Dim mycount As Long
mycount =
Application.WorksheetFunction.CountBlank(ActiveSheet.Range("$A$3:$W$26
MsgBox mycount
End Sub
Answer
Use the Range.SpecialCells method with the xlCellTypeVisible property to
isolate the cells left visible by the AutoFilter method.
The With ... End With statement statement can help you reference specific areas
within your workbook without resorting to .Select¹ and .Activate¹.

Sub Displayblanks_John_Doe()
' Displayblanks_John_Doe Macro
' Keyboard Shortcut: Ctrl+Shift+J
Dim mycount As Long
With Worksheets("Sheet1") 'you should know what worksheet you are on 
      If .AutoFilterMode Then .AutoFilterMode = False 
      With .Range("A3:L26,N3:N26,R3:R26,W3:W26") 
          .FormatConditions.Add Type:=xlExpression,
Formula1:="=LEN(TRIM(A3))=0" 
          With .FormatConditions(.FormatConditions.Count) 
              .Interior.Pattern = xlGray8 
              .StopIfTrue = False 
              .SetFirstPriority 
          End With 
      End With 
      With .Range("A3:W26") 
          .AutoFilter Field:=7, Criteria1:="John Doe" 
          'there has to be visible cells because we haven't
excluded the header row yet 
          With Intersect(.SpecialCells(xlCellTypeVisible), _ 
                         .SpecialCells(xlCellTypeBlanks)) 
              mycount = .Cells.Count 
              MsgBox mycount 
          End With 
      End With 
      If .AutoFilterMode Then .AutoFilterMode = False 
End With
End Sub
The above code counts visible cells that are truly blank; not cells that could be
zero-length strings returned by formulas (e.g. "" ).
I realize that your code is not finished yet; simply because it doesn't actually do
anything but report teh number of blank visible cells. One of the first steps
would be to find the last populated cell in column G and use that as the extent
of the filter range. A quick method of accomplishing this is to reference the
Range.CurrentRegion property is a With ... End With statement as soon as

you've referenced the worksheet; e.g.
With Worksheets("Sheet1") 'you should know what worksheet you are on
With .Cells(1, 1).CurrentRegion
'do all of your work here
End With
End With
This may not be appropriate for your particular situation as you wish to start at
row 3 but the Range.Resize property and Range.Offset property can take care
of this.
With Worksheets("Sheet1") 'you should know what worksheet you are on
With .Cells(1, 1).CurrentRegion 
      With .Resize(.Rows.Count - 2, .Columns.Count).Offset(2,
0) 
          'do all of your work here 
      End With 
End With
End With
Recorded macro code is a good place to start but you will quickly find that it
is very verbose and often records actions that are not desired. Get used to
cleaning your code up after a macro recording session and you will soon find
that you are writing the code from scratch.
¹ See How to avoid using Select in Excel VBA macros for more methods on
getting away from relying on select and activate to accomplish your goals.
Topic 67
Subject
Using Parameters when connecting SQL Server query to Excel
Question

I've done this numerous times in the past when connecting Access queries to
Excel, but now when I try and do it with a SQL Server query, I get an error
message of
[Microsoft][ODBC SQL Sever Driver]Invalid parameter number
before I can even assign the parameter a value.
Once I got this error message I started to look around online for some answers,
and I came across this article here. I followed these steps, which is essentially
what I was doing anyway, and I still get the same error. The article is a few
years old, so I'm not sure if things have changed since the release of Excel
2016 (my current version).
Is this something that cannot be done anymore without using VBA?
Just to summarize my steps, this is what I have done:
From Other Sources > From Microsoft Query Select Database from MS Query
Prompt > Click SQL button Paste SQL > Click Return Data Button
Click Definition in Connection Properties window> Swap criteria code with ?
in Command Text Click OK
Answer
It looks as though I may have found the issue. When doing the initial connection
through MS Query, you are asked to select the data source. Apparently there
are two SQL Server options, one named SQL Server and another named SQL
Server Native CLient 11.0. Originally I chose SQL Server, after trying
numerous ways to fix this issue, I deleted the data source completely from MS
Query, and started over, this time I chose SQL Server Native Client 11.0 and it
worked exactly as it should. I'm not entirely sure what the difference between
the two are, but it seems to have made the difference.
Topic 68
Subject
My datagridview export to Excel has incomplete data
Question

I have managed to import my data from a text file into a datagridview, and the
datagridview data look exactly the same as my text file. But, when I export the
datagridview to Excel, some of the row information is missing.
Here is my code to get the info from my text file into the datagridview.
public void AIO1Res()
{
OpenFileDialog DialogA1 = new OpenFileDialog(); DialogA1.Filter = "AIO
File (*.txt) | *.txt|All Files (*.*)|*.*"; if (DialogA1.ShowDialog() ==
System.Windows.Forms.DialogResult.OK) { 
      string FileName = DialogA1.FileName; 
      var lines = File.ReadAllLines(FileName); 
      if (lines.Count() > 0) 
      { 
          foreach (var cellValues in lines.Skip(0)) 
          { 
              var cellArray = cellValues.ToString() 
                  .Split(new[] { Environment.NewLine },
StringSplitOptions.None); 
              if (cellArray.Length == DGAIO1.Columns.Count) 
                  DGAIO1.Rows.Add(cellArray).ToString(); 
          } 
      } 
Here is my code to then export it to Excel.
newSheet.Name = "Test Results";
newSheet.Cells.NumberFormat = "@";
for (int i = 0; i < DGAIO1.Rows.Count - 1; i++) {
for (int j = 0; j < DGAIO1.Columns.Count; j++) {
newSheet.Cells[i + 1, j + 1] = DGAIO1.Rows[i].Cells[j].Value.ToString(); }
}
datagridview

Excel Export:
Any help is much appreciated.
Topic 69
Subject
Pandas read_excel with Hyperlink
Question
I have an Excel spreadsheet that I am reading into a Pandas DataFrame:
df = pd.read_excel("file.xls")
However, one of the columns of the spreadsheet contains text which have a
hyperlink associated with it. How do I access the underlying hyperlink in
Pandas? Answer
You cannot do that in pandas. You can try with other libraries designed to deal
with excel files.
Answer
as commented by slaw it doesnt grab the hyperlink but only the text
here text.xlsx contains links in the 9th column
workbook = load_workbook('test.xlsx')
worksheet = workbook.active
column_indices = [9]
for row in range(2,worksheet.max_row+1):
for col in column_indices: 
      filelocation = worksheet.cell(column=col, row=row )
#this is hyperlink 
      text = worksheet.cell(column=col+1, row=row) # thi is
your text 
      worksheet.cell(column=col+1,row=row).value =

'=HYPERLINK("'+filelocation.value+'","'+text.value+'")' 
workbook.save('test.xlsx')
Topic 70
Subject
Importing Excel function into my module
Question
I'm working in VBA, Excel specifically, and trying to use the SQRT (square
root) function. I'm writing a module but don't know how to do import the SQRT
function so my function can use it. Answer
this will return a square root:
MsgBox 4 ^ (1 / 2)
Answer
Here is my answer,
Hoping this helps.
Function myFunction(rng As Range) As Double
Dim i As Double
i = rng.Value
myFunction = Sqr(i)
'this function returns the square root of the value of i End Function
With a search and no effort Google show me this
1. MS Excel: How to use the SQR Function (WS)
2. Create SquareRoot Function in VBA - MrExcel.com
And many more.
Topic 71
Subject

Excel VBA assign hyperlink to a cell
Question
Currently I have VBA macro that will generate a page based on some
information that I key into cell T3 on an overview page. What I would like to
do is to have the same 'create page' button also automatically assign a
hyperlink based on the value.
For instance, if I put brownj1 into cell t3, a page will be created and named
'brownj1', what I would also like the macro to achieve is to assign cell 'b3'
which also has the name 'brownj1' to the newly created page. Another way I
think would probably be a better way around it would be to search/loop
through column B to locate the matching cell to T3 and then assign the
hyperlink.
As I mentioned I already have the necessary code to generate the page and
assign the name as the sheet name and all I am looking for is a formula to
assign a hyperlink to a specific name as the page is being generated. Answer
Here's a sample of how to do that:
Sub createLink()
Dim lastRow As Integer, sheetCount As Integer, myRange As Excel.Range, c
As Excel.Range lastRow = Cells.Find("*", SearchOrder:=xlByRows,
SearchDirection:=xlPrevious).Row sheetCount = Application.Sheets.Count
Set myRange = Excel.ThisWorkbook.Sheets("Sheet1").Range("B1:B" &
lastRow)
For Each c In myRange
For x = 1 To sheetCount 
      If Worksheets(x).Name = c.Value Then 
           Excel.ThisWorkbook.Sheets("Sheet1").Hyperlinks.Add
Anchor:=c, Address:="", SubAddress:=c.Value & "!A1" 
      End If 
Next x

Next c
End Sub
Topic 72
Subject
formatting codes for footer not being applied and page orientation data
mismatch
Question
I have a worksheet(adHoc) where cell b28 contains
"&9 2014 YTD Financial Data for PP" & Chr(10) & " &D &T" & Chr(10) & "
Version 1.0" & Chr(10) & " &F"
When I use the above to update the footer of another worksheet in a different
workbook. I don't get the embedded formatting - it displays exactly what is
contained in the cell b28.For example excel should see &9 and make the font 9
points.
I am also getting a datatype mismatch error with the page orientation. The
contents of cell b36 is xlLandscape.
I posted a copy of this question last week on another board but did not get any
answers. I hope someone here has answer.
http://www.mrexcel.com/forum/excel-questions/919033-updating-pagesetup-
using-cells-master-worksheet-orientation-formatting-footer-excel-visual-
basic-applications.html
This is the code I am using.
Sub page_setup()
Dim reportWB As Excel.Workbook
Dim sheet As Excel.Worksheet
'open report workbook - name of workbook is in cell b4 Set reportWB =
Workbooks.Open(Workbooks("macros.xlsm").Sheets("adHoc").Range("b4").Va

Dim leftFooter
leftFooter = Workbooks("macros.xlsm").Sheets("adHoc").Range("b28").Value
For Each sheet In reportWB.Sheets
With sheet
.PageSetup.leftFooter = leftFooter
.PageSetup.Orientation =
Workbooks("macros.xlsm").Sheets("adHoc").Range("b36").Value
End With
Next
End Sub
Answer
Reading in your footer definitions like that they are treated as literal string, not
code. You need to resolve the code to valid footer strings somehow.
For the LeftFooter string, you can use Evaluate to resolve it, but it will need to
be written as if it's a Excel Formula, not VBA, so use
"&9 2014 YTD Financial Data for PP" & Char(10) & " &D &T" & Char(10)
& " Version 1.0" & Char(10) & " &F"
Note the I use Char rather than Chr, the Excel formula equivalent.
For Orientation you are using a named constant, which won't work. Either put
the value on your Excel sheet (2 in this case) or write your own code to
resolve the name to its value
Working version (with corrected source data on sheet as descibed above)
Sub page_setup()

Dim reportWB As Excel.Workbook
Dim sheet As Excel.Worksheet
Dim wsSource As Worksheet
'open report workbook - name of workbook is in cell b4 Set wsSource =
Workbooks("macros.xlsm").Sheets("adHoc") Set reportWB =
Workbooks.Open(wsSource.Range("b4").Value)
Dim leftFooter
leftFooter = wsSource.Range("b28").Value
For Each sheet In reportWB.Sheets 
      With sheet 
          .PageSetup.leftFooter = Evaluate(leftFooter) 
          .PageSetup.Orientation =
wsSource.Range("b36").Value 
      End With 
Next
End Sub
To handle the constants you could add a UDF that resolves the string names to
values and call that from your settings sheet
Eg
Function GetConst(s As String) As Variant
Select Case s 
      Case "xlLandscape" 
          GetConst = xlLandscape 
      Case "xlPortrait" 
          GetConst = xlPortrait 
      ' etc 
End Select

End Function
Put in cell B36 GetConst("xlLandscape") (as a string, not formula), and change
your Orientation line of code to
.PageSetup.Orientation = Evaluate(wsSource.Range("b36").Value)
Add any other named constants you want to the Select Case statement.
Answer
AFAIK, there is no (straightforward) way to do what you're trying to do. When
you put code in a cell, and then call that cell's value in place of actual code,
what VBA is trying to run is not:
.PageSetup.Orientation = xlLandscape
but rather:
.PageSetup.Orientation = "xlLandscape"
which will produce the errors and behavior you're seeing.
As rule of thumb, if your VBA code needs a string (ie, something in ""), or a
number, you can do that calculation on the sheet and have the code pull in the
value.
For everything else (there's Mastercard) put it in the code. For example:
leftfooter = cell1.value & Chr(10) & cell2.value & Chr(10) & cell3.value
(As a side note, I'm not familiar with the formatting it seems you're trying to do
in that string... Those are generally set up through things like
With sheet.PageSetup.leftFooter.
.Font.Size = 9
'etc...

)
Topic 73
Subject
Input validation and repetition in vba
Question
I have the following code and I would like help in 4 areas:
Did I validate the inputbox correctly? It should only take positive numerical
variables. How can I let the input box accept both input with, and without,
symbols such as ($)? How can I link the code so that it can directly request
another number if the user has entered a negative non numeric number? How
can I repeat the procedure in the loop directly without repeating the whole
code?
Option Explicit
Sub IncomeSalaryCalculation()
Dim strSalary As String
Dim dblTaxableSalary As Double
Dim dblTax As Double
Dim dblSalaryAfterTax As Double
Dim strOutput As String
Dim SalaryCalculationRequest As VbMsgBoxResult
strSalary = InputBox("Please indicate your salary", "Salary Calculation")
If Not IsNumeric(strSalary) Then
MsgBox "This is no number! Please enter a non-negatif number", vbOKOnly,
"Error"
ElseIf strSalary < 0 Then
MsgBox "You should enter a positive number", vbOKOnly, "Error"
Else

dblTaxableSalary = CDbl(strSalary)
Select Case dblTaxableSalary 
    Case Is >= 151000 
             dblTax = 2440 * 0.1 + (37400 - 2440) * 0.2 +
(150000 - 37400) * 0.5 + (dblTaxableSalary - 150000) * 0.5 
    Case Is >= 37401 
             dblTax = 2440 * 0.1 + (37400 - 2440) * 0.2 +
(dblTaxableSalary - 37400) * 0.4 
    Case Is >= 2441 
             dblTax = 2440 * 0.1 + (dblTaxableSalary - 2440)
* 0.2 
    Case Else 
             dblTax = 2440 * 0.1 
End Select
dblSalaryAfterTax = dblTaxableSalary - dblTax
strOutput = "The amount of income tax is " & dblTax & vbNewLine & "Your
salary after tax is " & dblSalaryAfterTax
MsgBox strOutput, vbOKOnly, "Final Salary"
Do
SalaryCalculationRequest = MsgBox("Do you want to calculate the tax of a
new income?", vbYesNo, "New income tax salary calculation")
If SalaryCalculationRequest = vbYes Then
strSalary = InputBox("Please indicate your salary", "Salary Calculation")
dblTaxableSalary = CDbl(strSalary) 
       Select Case dblTaxableSalary 
        Case Is >= 151000 
                 dblTax = 2440 * 0.1 + (37400 - 2440) * 0.2 +
(150000 - 37400) * 0.5 + (dblTaxableSalary - 150000) * 0.5 
        Case Is >= 37401 

                 dblTax = 2440 * 0.1 + (37400 - 2440) * 0.2 +
(dblTaxableSalary - 37400) * 0.4 
        Case Is >= 2441 
                 dblTax = 2440 * 0.1 + (dblTaxableSalary -
2440) * 0.2 
        Case Else 
                 dblTax = 2440 * 0.1 
      End Select 
      dblSalaryAfterTax = dblTaxableSalary - dblTax 
      strOutput = "The amount of income tax is " & dblTax &
vbNewLine & "Your salary after tax is " & dblSalaryAfterTax 
      MsgBox strOutput, vbOKOnly, "Final Salary" 
Else
MsgBox "Glad to serve you"
End If
Loop Until SalaryCalculationRequest = vbNo
End If
End Sub
Answer
This should answer your questions without delving into all your code. Tested.
Sub getInput()
Dim ans As String
Do
ans = InputBox("Please indicate your salary", "Salary Calculation") Loop Until
isValid(ans)

''{{{{{{{{
''Do what you need here with the user input (stored in ans variable) ''}}}}}}}}
End Sub
Function isValid(ans As String) As Boolean
Dim cleanAns As variant
cleanAns = IIf(ans Like "*$*", Replace(ans, "$", ""), ans) isValid =
IsNumeric(cleanAns) And cleanAns > 0 If Not isValid Then MsgBox "only
positive numbers allowed" End Function
Topic 74
Subject
Saving an Outlook Item VBA issue
Question
I'm having trouble saving the outlook item. (Hmmm, I just realized I'm working
with Ms Word - does it matter? Can I still post here?) Anyways, the issue is
that, Word is creating the Message and sending it just fine (with attachments,
subject and everything), but it is not saving the file in the designated location
properly. It is saving as 1 KB and not opening. Below is the code and an image
of the error. Thanks much for your help!
Code
Private Sub CommandButton1_Click()
Dim myString As String
Dim myString2 As String
Set myOlApp = CreateObject("Outlook.Application") Set myItem =
myOlApp.CreateItem(olMailItem)
' Doing some texts replacements here.
myString = Label9
myString = Replace(myString, "[Name of Person]", TextBoxNoP.Value)
myString = Replace(myString, "[Name of Establishment]", TextBoxNoE.Value)

myString = Replace(myString, "[Date Received]", TextBoxDR.Value)
myString2 = Label10
myString2 = Replace(myString2, "[Name of Establishment]",
TextBoxNoE.Value) myString2 = Replace(myString2, "[Date Received]",
TextBoxDR.Value)
' Done with texts replacements here. Setting up, saving and sending messages.
Set myAttachments = myItem.Attachments
myItem.To = TextBoxTo.Value
myItem.CC = TextBoxCC.Value
myItem.Subject = myString2
myAttachments.Add "\\di-afs.doi-ad.state.nv.us\LifeHealth\Charitable Gift
Annuities\Charitable Gift Annuities 2016\Pending Charitable Gift Annunites\"
& TextBoxAtt.Value & ".pdf" myItem.Body = myString
myItem.SaveAs "\\di-afs.doi-ad.state.nv.us\LifeHealth\Charitable Gift
Annuities\Charitable Gift Annuities 2016\E-mails sent by Nanci\" & myString2
& ".msg", olMsg myItem.Send
Unload Me
End Sub
Thanks much for your help!!
Answer
Try to call myItem.Save before calling SaveAs.
Answer
I figured it out.
I needed to remove the ", olMsg" part from the end of the SaveAs line. Thanks
anyways!
Topic 75
Subject
Excel VBA Webquey creates new column

Question
for example, following query will create a new column A and the data from A
column will now be in Column B
With ActiveSheet.QueryTables.Add(Connection:="URL;" & u, _
Destination:=Cells(14, 8))
.BackgroundQuery = True
.TablesOnlyFromHTML = True
.Refresh BackgroundQuery:=False
.SaveData = True
.FieldNames = True
.RowNumbers = False
.FillAdjacentFormulas = False
.PreserveFormatting = False
.RefreshOnFileOpen = False
.BackgroundQuery = True
.RefreshStyle = xlOverwriteCells
.SavePassword = False
.SaveData = True
.RefreshPeriod = 0
.WebSelectionType = xlEntirePage
.WebFormatting = xlWebFormattingNone .WebPreFormattedTextToColumns =
True .WebConsecutiveDelimitersAsOne = True .WebSingleBlockTextImport =
False
.WebDisableDateRecognition = False
.WebDisableRedirections = False
.Refresh BackgroundQuery:=False
.AdjustColumnWidth = False
End With
is it possible that the destination of web query remain fixed lets say A1
Answer
Yes. Add .RefreshStyle = xlOverwriteCells inside your With clause. This will
force the external data to A1 instead of adding a new column.

Topic 76
Subject
Array formula in vba [closed]
Question
I'm trying the following code to find the location of several values:
Dim destino as String
Dim origen as String
destino="A"
origen="B"
Dim fila as Integer
fila = Application.WorksheetFunction.Match(1, (Range("F:F") = origen) *
(Range("G:G") = destino), 0)
But it doesn't work. Does anybody know why? Answer
Sub Tester()
Dim f As Integer
Dim destino as String
Dim origen as String
destino = "B"
origen = "R"
f = ActiveSheet.Evaluate("=MATCH(1,(C:C=""" & destino & """) * (D:D="""
& origen & """),0)") Debug.Print f '>> 6
End Sub
Topic 77
Subject
Marshal.ReleaseComObject not releasing for first instance
Question
This project I am working on below is a reference card that pulls text from an
excel file and pictures from the same searched folder. The process is then

"looped" by calling the Subs one after another until the app is exited. The
reference card is supposed to update every 10 minute by researching for the
files and repeating the process. The issue is that I wanted the code to open the
file, pull, and then close the file completely then wait and repeat. This way the
file could be edited before the next update. Instead it says it is still in use,
meaning read only. Even when I close the app and visual studios it still says
still in use. I have to force end process in the task manager.
Using Marshal.ReleaseComObject isn't working. The code starts the Excel
Process, goes through out the code and release does not work. After it loops
through the 2nd time and creates a new process (Now 2 Excel Processes) The
release works but only for the new process not the original and this continues
for each loop through. Please Help Ive been starring at this all day.
The picture below is after the first created process and the first failed object
release and right before 'releaseObject(wbXl)` the second time through the
code. After this the second process is released but never the first and so on.
NOTE that the first process does end if the app is closed.
Code
Imports System
Imports System.IO
Imports System.Text
Imports System.Runtime.InteropServices
Imports Excel = Microsoft.Office.Interop.Excel Imports
System.ComponentModel
Public Class Form1
Dim appXL As Excel.Application
Dim wbXls As Excel.Workbooks
Dim wbXl As Excel.Workbook
Dim shXL As Excel.Worksheet
Dim FldPath As String
Dim PartID As String
Dim RefCard As String
Dim timeUpDate As Double

Private Sub Form1_Load(sender As System.Object, e As System.EventArgs)
Handles MyBase.Load
'Dispaly Brembo Logo
picLogo.SizeMode = PictureBoxSizeMode.StretchImage
ReferenceCardDataPull()
End Sub
Private Sub Wait()
Threading.Thread.Sleep(10000)
End Sub
Private Async Sub ReferenceCardDataPull()
'Prepare For Load
lblTimer.Text = "Updating"
lblError.Visible = False
'Read File Source with part number ****************** PartID =
("19.N111.10")
' Start Excel and get Application object. appXL =
CreateObject("Excel.Application") appXL.Visible = False
'Open Reference
Card*****************************************************************
FldPath = ("\\HOMESHARE01\Public\Kaizens\Kaizen 44 - Missing
Parts\Reference Cards\Completed Reference Cards by Part Number" & "\" &
PartID) If System.IO.Directory.Exists(FldPath) Then 
      If System.IO.File.Exists(FldPath & "\" & PartID &
".xlsm") Then 
          'wbXl = appXL.Workbooks.Open(FldPath & "\" & PartID
& ".xlsm")**** Archive 
          wbXls = appXL.Workbooks 
          wbXl = wbXls.Open(FldPath & "\" & PartID & ".xlsm")
          shXL = wbXl.Worksheets("Sheet1") 
          ' Copys Reference Card Data by Cell To App labels 
          lblCODE.Text = shXL.Cells(6, 5).Value 

          lblREV.Text = shXL.Cells(3, 5).Value 
          lblDate.Text = shXL.Cells(9, 5).Value 
          lblCustomer.Text = shXL.Cells(3, 1).Value 
          lblPart.Text = shXL.Cells(6, 1).Value 
          lblSpindleType.Text = shXL.Cells(9, 1).Value 
          lblPaintType.Text = shXL.Cells(12, 1).Value 
          lblDunnageType.Text = shXL.Cells(15, 1).Value 
          lblPartsLayer.Text = shXL.Cells(3, 3).Value 
          lblLayers.Text = shXL.Cells(6, 3).Value 
          lblTotalParts.Text = shXL.Cells(9, 3).Value 
          lblPackagingInstructs.Text = shXL.Cells(12,
3).Value 
      Else 
          lblCODE.Text = ("Error") 
          lblREV.Text = ("Error") 
          lblDate.Text = ("Error") 
          lblCustomer.Text = ("Error") 
          lblPart.Text = ("Error") 
          lblSpindleType.Text = ("Error") 
          lblPaintType.Text = ("Error") 
          lblDunnageType.Text = ("Error") 
          Lable49.Text = ("Error") 
          lblLayers.Text = ("Error") 
          lblTotalParts.Text = ("Error") 
          lblPackagingInstructs.Text = ("Error") 
          lblError.Visible = True 
          ' Close objects**** Archive 
          ' shXL = Nothing**** Archive 
          ' wbXl.Close()**** Archive 
          'appXL.Quit()**** Archive 
          'appXL = Nothing**** Archive 
      End If 
Else 
      'File not found Error 
      lblCODE.Text = ("Error") 
      lblREV.Text = ("Error") 
      lblDate.Text = ("Error") 
      lblCustomer.Text = ("Error") 
      lblPart.Text = ("Error") 
      lblSpindleType.Text = ("Error") 
      lblPaintType.Text = ("Error") 
      lblDunnageType.Text = ("Error") 

      Lable49.Text = ("Error") 
      lblLayers.Text = ("Error") 
      lblTotalParts.Text = ("Error") 
      lblPackagingInstructs.Text = ("Error") 
      lblError.Visible = True 
End If
'Pulls pictures from designated part folder If System.IO.File.Exists(FldPath &
"\" & "PicSpindle" & PartID & ".JPG") Then 
      picSpindle.Image = Image.FromFile(FldPath & "\" &
"PicSpindle" & PartID & ".JPG") 
      picSpindle.SizeMode = PictureBoxSizeMode.StretchImage 
  Else 
      picSpindle.SizeMode = PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicRotorTop" & PartID & ".JPG")
Then 
      picRotorTop.Image = Image.FromFile(FldPath & "\" &
"PicRotorTop" & PartID & ".JPG") 
      picRotorTop.SizeMode = PictureBoxSizeMode.StretchImage 
  Else 
      picRotorTop.SizeMode = PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicRotorBottom" & PartID &
".JPG") Then 
      picRotorBottom.Image = Image.FromFile(FldPath & "\" &
"PicRotorBottom" & PartID & ".JPG") 
      picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
  Else 
      picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 

End If
If System.IO.File.Exists(FldPath & "\" & "PicDunnageFinal" & PartID &
".JPG") Then 
      picDunnageFinal.Image = Image.FromFile(FldPath & "\" &
"PicDunnageFinal" & PartID & ".JPG") 
      picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
  Else 
      picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicDunnageLayer" & PartID &
".JPG") Then 
      picDunnageLayer.Image = Image.FromFile(FldPath & "\" &
"PicDunnageLayer" & PartID & ".JPG") 
      picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
  Else 
      picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
End If
' Close objects
wbXl.Close()
wbXls.Close()
appXL.Quit()
'Release Objects
releaseObject(shXL)
releaseObject(wbXl)
releaseObject(wbXl)
releaseObject(wbXls)
releaseObject(appXL)
timeUpDate = 9

tmrUpdate.Start()
Application.DoEvents()
Await Task.Run(Sub()
Wait()
End Sub)
ReferenceCardDataPull()
End Sub
Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles
tmrUpdate.Tick
Dim hms = TimeSpan.FromSeconds(timeUpDate) Dim m =
hms.Minutes.ToString
Dim s = hms.Seconds.ToString
If timeUpDate > 0 Then 
      timeUpDate -= 1 
      lblTimer.Text = (m & ":" & s) 
Else 
      tmrUpdate.Stop() 
      lblTimer.Text = "Preparing Update" 
End If
End Sub
Private Sub releaseObject(ByVal obj As Object)
Try 
      Dim intRel As Integer = 0 
      Do 
          intRel =
System.Runtime.InteropServices.Marshal.ReleaseComObject(obj) 
      Loop While intRel > 0 
      'MsgBox("Final Released obj # " & intRel) 

  Catch ex As Exception 
      MsgBox("Error releasing object" & ex.ToString) 
      obj = Nothing 
  Finally 
      GC.Collect() 
End Try
End Sub
End Class
Answer
Try modifying your code to close excel to instead call this function:
Private Sub CloseExcel(ByRef xlApp As Excel.Application, xlWorkBook As
Excel.Workbook, xlWorkSheet As Excel.Worksheet)
Try
xlWorkBook.Close()
Catch ex As Exception
End Try
Try
xlApp.Quit()
Catch ex As Exception
End Try
Try
releaseObject(xlApp)
Catch ex As Exception
End Try
Try
releaseObject(xlWorkBook)
Catch ex As Exception
End Try
Try
releaseObject(xlWorkSheet)

Catch ex As Exception
End Try
End Sub
Private Sub releaseObject(ByVal obj As Object)
Try 
    
System.Runtime.InteropServices.Marshal.ReleaseComObject(obj) 
      obj = Nothing 
  Catch ex As Exception 
      obj = Nothing 
  Finally 
      GC.Collect() 
End Try
End Sub
This solution has worked for me on multiple occasions. I believe the trick is
that you are not setting your Excel object variables to Nothing after calling the
ReleaseComObject function.
Topic 78
Subject
Excel Named Set on Pivot Table
Question
Based on research I've done, I'm guessing there may be no way to do this, but
what I'd like is to be able to create a "Named Set" (under PivotTable Tools >
Analyze > Fields, Items, & Sets > Create Set Based on Row/Column Items)
that can place fields on BOTH rows and columns at the same time. I know that
there is a way to get row and values at the same time, or columns and values at
the same time, but I haven't been able to edit the MDX in any way that would
allow rows/columns/values all at once. Essentially, if this were possible, it
would be great to use this as a way to save different layouts of PivotTables that
users could run easily without having to always build the Pivots.
I could create two named ranges per "layout", but was hoping there was some

trick I wasn't aware of, or haven't been able to find.
FYI - I am building the Pivots off of the Excel Data Model.
Topic 79
Subject
“Command buttons (?)” not working excel 2010
Question
Im asking this question for my sister.
My sister is using someone's excel file to manage her business. The file
contains THESE buttons.
Now for some reason she can't get these buttons to work on her personal
computer, but they do work on her computer at work. (I can't get them to work
either)
I've searched most of the internet for solutions but all I came across was
deleting all .exd file in the %temp% folder. This doesn't work either.
Now Im wondering if any of you have encountered this problem before and/or
if you have a fix for it.
Many thanks,
Raigo
EDIT
I can click the buttons, but they don't actually do anything
Topic 80
Subject
(Excel VBA) loop through range with while or for?
Question
Recently I was pointed out that some Excel functions are volatile, meaning they
are triggered every time there is a change in the worksheet, while others aren't.
Now this brings me to the point that most of my VBA usage is looping through
a range and I am wondering which of the two methods is to be preferred and

why? Case do while-loop;
Dim i as long
i = 1
Do while cells(i,1) <> ""
...
i = i + 1
Loop
Or for-loop
Dim curCell as cell
for curCell = cells(1,1) to cells(1,1).end(xlDown)
...
Next curCell
(please note that the exact code might be incorrect since I currently don't have
access to a computer with Excel)
Edit (after John's remark); As far as I can see in the first example the target cell
value is requested every time the loop is looped, in the second example the
cell will only be requested twice ánd .end(xlDown) does not require the vba
layer but is a standard function thus the second option might be running faster.
Thanks in advance
Answer
There will be no difference in time between Do..While, For Each, or For i = x
to y. If you are wondering how make a not calculate every time you Loop you
can Use Application.Calculation = xlCalculationManual before your loop with
Application.Calculation =xlCalculationAutomaticafter.
When I say no difference there will be very little, nothing to notice.
Topic 81
Subject
Excel Logic Formula?

Question
I have an excel sheet with hire dates listed, at 180 days from hire I would like
Excel to display in another cell 3 (this 3 is for points), than at 365 days after
hire date display 6 instead of 3. (Basically 3 points earn every 6 months from
hire date)
Help?
Answer
Assuming the date is in cell A1, this will work!
=IF(DATEDIF(A1,TODAY(),"d")<180,0,IF(DATEDIF(A1,TODAY(),"d")
<365,3,6))
Topic 82
Subject
Excel if statement for first day of the month
Question
I'm trying to meticulously track interest growth and monthly payments on a loan
in excel. Instead of manually putting in the amount for each first day of the
month, is there a way to write an excel if statement so that it will be a certain
value for the first day of a month and zero on all other days?
Sort of like: =IF("day is first day", $100,$0) That way I can drag the formula
all the way down. Worth noting that inside the quotation marks will be a cell
number that points to the column directly left of the formula with a date in it.
So like this:
| Date | Payment | Balance |
|:--------:|:-------:|:-------:| 
| 01/30/16 |      $0 |   $1000 | 
| 01/31/16 |      $0 |   $1000 | 
| 02/01/16 |    $100 |    $900 | 
| 02/02/16 |      $0 |    $900 | 

Answer
Try this
=IF(A2=Date(Year(A2),Month(A2),1),100,0)
Answer
You need the DAY Function.
=IF(DAY(A2) = 1,100,0)
Answer
You can use the DAY() function to get the day number
=IF(DAY(A1)=1,100,0)
Topic 83
Subject
VBA Create multiple workbooks based off of a list of inputs
Question
I am trying to generate multiple workbooks based on a list of values in a range.
That is, I have a working code that processes my data based on an input (B9,
defined as a variable) in the original file and then creates a single workbook
based on the calculations made using B9. B9 determines how the data is
processed and is also used to generate the name of the new workbook. I am
trying to use this code to create many workbooks, based on different values for
B9, contained in a range B12:B... in the original workbook.
Based on some searches here my thought is to copy the first value in the range
into B9, run my existing code and then after that workbook is completed have
the whole process loop until we run out of values in the B:12:B... range (ie a
blank cell)
I tried to cannibalize Jason's answer from VBA code for moving cells from one
column to another based on specific cell criteria to make this function but I still
only get one spreadsheet at the end (looks like it copies it, but doesn't loop.

Any ideas?
Thanks!
Topic 84
Subject
VBA : How to define a large set of string variables?
Question
I am trying (in VBA) to define a large number of string variables. The brute
force would be :
Dim Port1 as String
Dim Port2 as String
etc…
Unpleasant for say 100 variables. There must be a more intelligent solution. I
have tried :
Dim n As Integer
For n = 1 To 100
Dim "Port" & n as String
Next n
and variations of it without success.
I would greatly appreciate if someone could point me in the right direction or
share an example. Answer
Arrays do exactly this! See this example:
Dim Port(1 to 100) As String
Dim i As Long
Port(1) = "String"
For i = 2 to 100
Port(i) = "String " & i
Next i

It sets Port(1), the first array element to the word "String". Everything else
Port(2) and on, contain "String 2", "String 3", etc. Up to Port(100).
I hope that helps!
Topic 85
Subject
Displaying series name on stacked bar chart with pivot table in excel for only
nonzero entries
Question
I have a stacked bar chart in excel displaying results from a pivot table. I want
to display the series name and total in each bar chart section, but only for
nonzero entries. I managed to do this for the total using a custom number format
that suppresses zeroes (#), but when I try to include the series name, it displays
the series name even when the entry is zero, resulting in an unreadable stack of
text between bars in the chart.
Is there any way to add series names to bars in a stacked bar chart only if the
total corresponding to that series is nonzero?
For example, with the following table in excel: 
      col1    col2    col3 
row1    5       3       4 
row2    0       4       6 
row3    3       6       0 
I get this for the chart:
But I want to suppress the label for row2 in the first column, and the label for
row3 in the last column
Topic 86
Subject
Formula not working for conditional formatting in Excel
Question
I'm trying to setup a formula for a conditional format.

Here's what I want to do:
For any row in column D that has a value different than the same row in
column C, highlight the value in Row D
Some of the values are text so I only want this formula to work for values that
are numeric.
This is the formula I came up with:
=ISNUMBER(AND($D2:$D1308,$D2<>$C2))
Unfortunately, it's not working. I'm not sure where I went wrong. Any
suggestions are appreciated.
Thank you!
Answer
Try this:
=AND(ISNUMBER($D2),$D2<>$C2)
Topic 87
Subject
How to fill color in each cell
Question
I'm using Roo and RubyXL to modify an Excel spreadsheet.
When I comment out the code that fills the color in the Excel sheet, then I do
not get any error.
My full code:
require 'rubyXL'
require 'roo'
workbook = Roo::Spreadsheet.open(file_name) workbook1 =
RubyXL::Parser.parse(file_name)

workbook.default_sheet = 'Location Table Values' worksheet1 =
workbook1['Location Table Values']
for j in (workbook.first_row..workbook.last_row) print "\n"
d = j
for k in (workbook.first_column..workbook.last_column) if (k ==
workbook.first_column) 
    choose("lookupSearch", :option => "Plan") 
    fill_in "searchInput", :with => workbook.cell(j, k) 
    find(:xpath, '//*[@id="searchicon"]').click 
  elsif (k == workbook.last_column) 
    puts " " 
  else 
    print k 
    findXpath = page.find('td', text: workbook.cell(j,k),
:match => :prefer_exact).path 
    splitXpath = (findXpath.split("/")) 
    count = splitXpath.count 
    value = splitXpath.at(count - 1) 
    if (value == "td[1]") 
      finalElementXpath = findXpath.sub("td[1]", "td[2]") 
    elsif (value == "td[2]") 
      finalElementXpath= findXpath.sub("td[2]", "td[3]") 
    end 
    if (workbook.cell(j, k + 1)) == (find(:xpath,
finalElementXpath).native.text) 
      print "#{workbook.cell(j + 1, k)}-value exist \n" 
      worksheet1.sheet_data[d][k].change_fill ('008000') #
Green color 
    else 
      print "object #{workbook.cell(j, k + 1)}not exist #
{workbook.cell(j, k)}" 
      print workbook.cell(j, k + 1) 
      worksheet1.sheet_data[d][k].change_fill ('ff0000') 
    end 
end
end
end

workbook1.write(file_name)
But I get Nil[] Nil class error.
Topic 88
Subject
UserForm.Top value changes from assigned
Question
I've long used this site to find answers to my questions, but I couldn't find
anything regarding this question. Apologies in advance if I missed anything.
So I have a workbook (Office 2013, VBA 7.1) where I'm trying to use a
userform as a menu which will remain stationary on the page and also move
with the workbook. I used a combination of code from
http://www.cpearson.com/excel/SetParent.aspx to lock the form to the window
and http://www.oaltd.co.uk/Excel/Default.htm (the FormFun.zip) to remove the
caption from the form and prevent it from being moved on the page.
This code is working great, but I'm consistently encountering a strange bug,
where the inserted forms ".Top" value is different from what I assigned in my
code. I also had a co-worker run the code and get the same issue. I'll list the
relevant parts of the code below.
I have the following code in a Module (Module1):
Sub CallFormTestA()
With UserForm1
.Show vbModal = False
.StartUpPosition = 0
.Left = 17
.Top = 147
End With
End Sub
And I have the following code in the UserForm (UserForm1):

Option Explicit
Private Declare Function GetWindowLong Lib "user32" Alias
"GetWindowLongA" _
(ByVal hwnd As Long, _
ByVal nIndex As Long) As Long
Private Declare Function SetWindowLong Lib "user32" Alias
"SetWindowLongA" _
(ByVal hwnd As Long, _
ByVal nIndex As Long, _
ByVal dwNewLong As Long) As Long
Private Declare Function FindWindow Lib "user32" Alias "FindWindowA" _
(ByVal lpClassName As String, _
ByVal lpWindowName As String) As Long
Private Declare Function FindWindowEx Lib "user32" Alias
"FindWindowExA" _
(ByVal hWnd1 As Long, _
ByVal hWnd2 As Long, _
ByVal lpsz1 As String, _
ByVal lpsz2 As String) As Long
Private Declare Function SetParent Lib "user32" _
(ByVal hWndChild As Long, _
ByVal hWndNewParent As Long) As Long 
Private Const GWL_STYLE As Long = (-16)          'The offset
of a window's style 
Private Const WS_CAPTION As Long = &HC00000      'Style to add
a titlebar 

Private Sub SetBit(ByRef lStyle As Long, ByVal lBit As Long, ByVal bOn As
Boolean)
If bOn Then
lStyle = lStyle Or lBit
Else
lStyle = lStyle And Not lBit
End If
End Sub
Private Sub Userform_Initialize()
Dim MeHWnd, ApphWnd, DeskhWnd, WindowhWnd, Res, lStyle As Long
'Get the window handle of the main Excel application window. ApphWnd =
Application.hwnd
If ApphWnd > 0 Then
'Get the window handle of the Excel desktop. DeskhWnd =
FindWindowEx(ApphWnd, 0&, "XLDESK", vbNullString) If DeskhWnd > 0
Then 
    'Get the window handle of the ActiveWindow. 
    WindowhWnd = FindWindowEx(DeskhWnd, 0&, "EXCEL7",
ActiveWindow.Caption) 
    If WindowhWnd > 0 Then 
       'OK 
    Else 
       MsgBox "Unable to get the window handle of the
ActiveWindow." 
    End If 
 Else 
    MsgBox "Unable to get the window handle of the Excel
Desktop." 
End If
Else
MsgBox "Unable to get the window handle of the Excel application." End If

MeHWnd = FindWindow("ThunderDFrame", Me.Caption)
If MeHWnd = 0 Then Exit Sub
lStyle = GetWindowLong(MeHWnd, GWL_STYLE) SetBit lStyle,
WS_CAPTION, False
SetWindowLong MeHWnd, GWL_STYLE, lStyle
If (MeHWnd > 0) And (WindowhWnd > 0) Then
Res = SetParent(MeHWnd, WindowhWnd)
If Res = 0 Then
MsgBox "The call to SetParent failed." End If
End If
End Sub
As I said, this code creates the form correctly, but when I run
msgbox userform1.top
in the immediate window, it returns a different value, inconsistent across
multiple attempts, but usually in the range of 250-300, often with a decimal
point of either .25, .5 or .75.
I don't understand most of this code I'm using from Stephen Bullen and Chip
Pearson, but it doesn't look like it could affect the userform1.top value to me.
Can anyone identify whether there is an issue with the code I'm using that will
change the userform1.top value? Is it possible this is a bug instead?
This is my first time asking a question here, so please let me know if there is
any additional information I should include (or leave out).
Thanks!
Edit1: Based on some feedback from Scott Holtzman, I've tried putting some
debug.print lines in the code to identify the value of the .top at each point of the
code. My findings are below, though Scott did get different numbers when he
ran this. This is all contained in the sub CallFormTestA() of module1. I also
found that if I ran the module a second time without resetting the project, I

would get a different result. If I ran the module again after the second time, it
keeps the same result I got the second time.
With UserForm1
Debug.Print .Top 'Returns 139.5 then 286.5 .Show vbModal = False
.StartUpPosition = 0
.Left = 17
.Top = 147
Debug.Print .Top 'Returns 286.5 then 286.5 End With
With UserForm1
Debug.Print .Top '139.5 then 286.5
.Show vbModal = False
.StartUpPosition = 0
.Left = 17
.Top = .Top - .Top 'Changed
Debug.Print .Top '139.5 then 139.5
.Top = 147
Debug.Print .Top '286.5 then 286.5
End With
With UserForm1
Debug.Print .Top 'Returns 139.5 then 286.5 .Show vbModal = False
.StartUpPosition = 0
.Left = 17
.Top = -.Top 'Changed
Debug.Print .Top 'Returns -372 then -147 .Top = 147
Debug.Print .Top 'Returns 286.5 then 286.5 End With
With UserForm1
Debug.Print .Top '139.5 then 286.5
.Show vbModal = False
.StartUpPosition = 0
.Left = 17

.Top = Abs(-.Top) 'Changed
Debug.Print .Top '511.5 then 286.5
.Top = 147
Debug.Print .Top '286.5 then 286.5
End With
With UserForm1
Debug.Print .Top '286.5 then 286.5
.Show vbModal = False
.StartUpPosition = 0
.Left = 17
.Top = 0 'Changed
Debug.Print .Top '139.5 then 139.5
.Top = 147
Debug.Print .Top '286.5 then 286.5
End With
Dim n As Long 'Tried using an integer to store the .top value With UserForm1
Debug.Print .Top '139.5 then 286.5
.Show vbModal = False
.StartUpPosition = 0
.Left = 17
n = .Top 'This drops the decimal, but I don't care about that. Debug.Print .Top
& ", " & n '511.5, 512 then 286.5, 286 .Top = .Top - n
Debug.Print .Top '138.75 then 140.25 .Top = 147
Debug.Print .Top '286.5 then 286.5
End With
Edit2: I've done some more playing around, and isolating certain parts of the
code in particular. I found that if I comment out the following line from the
UserForm1 code, the .Top property is set correctly.
If (MeHWnd > 0) And (WindowhWnd > 0) Then
Res = SetParent(MeHWnd, WindowhWnd)
If Res = 0 Then

MsgBox "The call to SetParent failed." End If
End If
To clarify, the SetParent function is repeated here:
Private Declare Function SetParent Lib "user32" _
(ByVal hWndChild As Long, _
ByVal hWndNewParent As Long) As Long
I still don't see how these lines could affect the form.top property, but I can't
figure out where else the problem might be. I'm going to continue to research
this, but wanted to update this in case anyone is looking at this question.
Edit3: I was able to wrestle with this code and ultimately get it to do what I
want, but I still don't know why. I posted my updated code as an answer, but if
anyone can offer any more insight to what happened here, I would greatly
appreciate the input. Answer
I still don't understand the entirety of what is happening here, but I thought I
should post this answer in case some future person has a similar question.
The key to all of this, as I discovered in my 2nd edit, was the SetParent
function:
Private Declare Function SetParent Lib "user32" _
(ByVal hWndChild As Long, _
ByVal hWndNewParent As Long) As Long
This caused Excel to add a particular value, say XMod, (which can vary by
user and hardware) to the .top property of the form, but also another value,
YMod, to the .left property, which I didn't see in this case. Ultimately, if I set
both .top and .left to 0, the XMod and YMod will cause the form to appear
with the top of the form lining up with the top of the column header, and the left
of the form lining up with the left of the row header. Any number I set will
have the appropriate modifier added for the final result. But this number will
often have a small variation made to it to align with the screen resolution,

which is why I initially thought it was random.
However, this did introduce another problem, as whenever I set either .top or
.left, Excel would add the modifier to both .top and .left. Meaning, if I have the
following code:
With UserForm1
.Show vbModal = False
.StartUpPosition = 0
.Left = 17
.Top = 147
End With
Excel will set the .top = YMod + 147, and the .left = XMod + XMod + 17. In
my initial code, the XMod was 0, so I didn't notice it added it twice. I got
around this by setting a variable to the YMod, and then subtracting that
variable when setting the .Top later, such as the following:
With Navigation
.Top = 0
t = .Top
.Show vbModal = False
.StartUpPosition = 0
.Top = 13 - t
.Left = 19
End With
This gave me the correct results I needed. If anyone else has any problems
getting this to work, I hope this will help. And if I can see someone else
answer the question in a way that makes more sense, I'll definitely mark theirs
as the answer.
Topic 89
Subject
Excel Multiple Dynamic Axis of Clustered Line Chart

Question
I have created a dynamic clustered line chart (see picture 1,
http://imgur.com/a/iXAIS). The inputs for the graph are dependent on a drop
down selection from the dashboard, and I need the axis of the graph to change
for the number of categories included from the user chosen input. In picture 2
you will see the scenario when all categories contain data, so the graph is
formatted correctly with labels and sizing. In picture 3 you will see the
scenario I'm trying to account for, where there are less than the 7 original
categories remaining and the graph is incorrectly formatted.
I know how to use the offset formula for a standard chart to account for a
dynamic axis, but I can't figure out how to apply that same method to this
unique chart layout. I have named ranges for each of the categories going
horizontally, and a named range for the labels going vertically in the first
column, but this is not working.a
Topic 90
Subject
Conditional format a blank cell based on another cells date
Question
First thank you and sorry as I am very new at this.
I need to have a cell come up red if blank, based on another cells entered date
plus "X" number of days.
Example
If A2 shows 2/1/16 and B2 is blank (greater than 2 days from A2) I need
it to come up red. So if today's date is 2/5/16 this cell would become red.
If A2 shows 2/1/16 and B3 is blank (by greater than 4 days from A2's date) I
need it to come up red.
If a cell is blank and it is not greater than the number of days I set, it remains
unchanged. (A2 shows 2/1/16 and today is 2/2/16, B2 would remain blank)
Also if a date is entered and it is greater than the number of days I set as
compared to A2 it would also come up red. (A2 is 2/1/16 and B2 shows
2/5/16)

Thank you in advance!
Topic 91
Subject
import data from different excel files into one table SQL
Question
i have multiple excel file called day1, day2, day3... day30. i want to import all
the data into one table called Monthly all at once. i am using phpmyadmin and i
don't want to import each file separately. Is there a way how to merge all the
data into one table ? another detail, each file contain the column project, task,
owner, hoursSpent, percentage. i want that when all the data will be merged
together so the duplicated row will be remove automatically. Thank you.
Answer
I was doing this kind of task from excel to an Oracle database some time ago
with the tool PlSQL Developer, but I'm sure there are some others tool for
Oracle and others databases. One of those tool can resolve the problem of
import from excel to one single table, after that I just execute an SQL code that
copy the dirty data from that single table to the real table structure, skipping the
duplicated rows. If you know SQL language you can manage to doing that but
still with the problem to import each excel separately. If you want to do the job
to many files at the same time then you need a more complicated to use
software, like for example Pentaho Data Integration or develop your own.
Hope this help you
Topic 92
Subject
Weird Excel issue occurring in my VBScript
Question
intUserAccountControl = objUser.Get("userAccountControl") If
intUserAccountControl And ADS_UF_DONT_EXPIRE_PASSWD Then
ws.Cells(intRowToUse,4).value = "" & "The password does not expire."
'WScript.Echo "The password does not expire." 'WScript.Quit
Else

dtmValue = objUser.PasswordLastChanged pwdLastSet =
DateValue(dtmValue)
If Err.Number = E_ADS_PROPERTY_NOT_FOUND Then 
      ws.Cells(intRowToUse,3).value = "" & "The password has
never been set." 
      'WScript.Echo "The password has never been set." 
      'WScript.Quit 
  Else 
      intTimeInterval = Int(Now - dtmValue) 
      'MsgBox DateValue(dtmValue) & " - " &
TimeValue(dtmValue) 
      ws.Cells(intRowToUse,3).value = "" &
DateTimeToStr(pwdLastSet) 
      ' DOES NOT WRITE THE EXCEL VALUE IF intRowToUse,4 does
write 
End If
Set objDomain = GetObject("LDAP://" &
objADSystemInfo.DomainDNSName) Set objMaxPwdAge =
objDomain.Get("maxPwdAge")
If objMaxPwdAge.LowPart = 0 Then 
      'WScript.Echo "The Maximum Password Age is set to 0 in
the " & _ 
      '             "domain. Therefore, the password does not
expire." 
      'WScript.Quit 
  Else 
      dblMaxPwdNano = 
          Abs(objMaxPwdAge.HighPart * 2^32 +
objMaxPwdAge.LowPart) 
      dblMaxPwdSecs = dblMaxPwdNano * ONEHUNDRED_NANOSECOND 
      dblMaxPwdDays = Int(dblMaxPwdSecs / SECONDS_IN_DAY) 
      'WScript.Echo "Maximum password age is " &
dblMaxPwdDays & " days" 
      pwdExpirationDate = DateValue(dtmValue + dblMaxPwdDays)
      If intTimeInterval >= dblMaxPwdDays Then 
          'WScript.Echo "The password has expired." 
          ws.Cells(intRowToUse,4).value = "" & "The password

has expired." 
      Else 
          'WScript.Echo "The password will expire on " & _ 
          '  DateValue(dtmValue + dblMaxPwdDays) & " (" & _ 
          '  Int((dtmValue + dblMaxPwdDays) - Now) & " days
from today)." 
          ws.Cells(intRowToUse,4).value = "" &
DateTimeToStr(pwdExpirationDate) 
         ' THIS WORKS BUT intRowToUse,3 does NOT work! 
      End If 
End If
End If
So if I try to write
ws.Cells(intRowToUse,4).value = "" & DateTimeToStr(pwdExpirationDate)
then
ws.Cells(intRowToUse,3).value = "" & DateTimeToStr(pwdLastSet)
doesnt write
Topic 93
Subject
VBA Using Sendkey to execute Excel Hotkeys
Question
I know that sendkeys are considered bad and dangerous but I'm struggling to
figure out how to best deal with issues in VBA compared to front end Excel.
I wrote a personal macro for setting up an unknown pivot table to repeat all
labels, set to tabular, sort ascending field list, and finally hide subtotals.
Everything works fine except the subtotals requires a loop, and when there's a
large amount of data this loop can take a long time. Oddly, if you were to just
turn off subtotals the from the front end controls, it's instant. Hence where using
Sendkey would be faster than actually looping. (Sendkey is doing the Hotkey
presses to execute Turn off Subtotals)

Sub formatpivotTable()
Dim pivotName As Variant
Dim pf As pivotField
On Error Resume Next
pivotName = ActiveCell.PivotTable.Name
If pivotName = "" Then
MsgBox "You did not select a pivot table" Exit Sub
End If
ActiveSheet.PivotTables("" & pivotName & "").ManualUpdate = True With
ActiveSheet.PivotTables("" & pivotName & "")
.RepeatAllLabels (xlRepeatLabels)
.RowAxisLayout (xlTabularRow)
.FieldListSortAscending = True
'For Each pf In .PivotFields
' pf.Subtotals(1) = True
' pf.Subtotals(1) = False
'Next
End With
ActiveSheet.PivotTables("" & pivotName & "").ManualUpdate = False
'Remove the Loop and instead use the Front End Hotkey ActiveSheet.Activate
'Normally using activate is bad, but maybe it's good here to ensure your
sendkeys hit excel? not even sure this prevents it Application.SendKeys "%",
True
Application.SendKeys "{J}", True
Application.SendKeys "{Y}", True
Application.SendKeys "{T}", True
Application.SendKeys "{D}", True
End Sub
When it works, it works beautifully. The whole thing is done within less than a
second. But I feel like there's still a danger that your sendkeys could overwrite
pivot information with "JYTD" if something goes wrong. I have commented out
my original loop, which just takes too long when dealing with large amounts of
data.

Any thoughts? Am I just impatient using the loop method? Answer
No, you're not impatient! If you are using 2007 or later, use:
Application.CommandBars.ExecuteMso "PivotTableSubtotalsDoNotShow"
Topic 94
Subject
How to keep only three digits from a string in excel?
Question
How do I automatically keep only three digits from a string and apply it to a
list while not exceeding 5 decimal points as well as rounding the numbers?
Example
0.645945 --> 0.646
0.0003452 --> 0.00035
0.000071533 -->0.00007
Answer
Here is a formula based solution that will work. The final formula is pretty
long, so I broke it into it's parts so you can understand it better.
The point of this solution is it leaves you with the exact number you are
looking for and not a formatted display of the number.
B2 = =TEXT(A2,".00000")
C2 = =LEN(A2)-LEN(SUBSTITUTE(A2,"0","")) D2 =
==CHOOSE(LEN(A2)-
LEN(SUBSTITUTE(A2,"0","")),100,1000,10000,100000,1000000) E2 =
=ROUND(LEFT(B2,C2+4)*D2,1)/D2
F2 = =ROUND(LEFT(TEXT(A2,".00000"),LEN(A2)-
LEN(SUBSTITUTE(A2,"0",""))+4)*CHOOSE(LEN(A2)-
LEN(SUBSTITUTE(A2,"0","")),100,1000,10000,100000,1000000),1)/CHOOS
LEN(SUBSTITUTE(A2,"0","")),100,1000,10000,100000,1000000)

I am sure there are ways to mathematically simply it even more, but this works
as is for values with 4 or less 0 after the decimal
Answer
If you have a set of numbers starting from B2, highlight the range and proceed
as follows:-
(1) Set a default format of three decimal places.
(2) Apply a conditional format rule:-
=ABS(B2)<0.1
and set four decimal places if this applies.
(3) Apply a conditional format rule:-
=ABS(B2)<0.01
and set five decimal places if this applies.
As pointed out by @Scott Craner, the second rule must take precedence. One
way to achieve this is to put the second rule first and tick the 'stop if true' box
in Manage Rules.
Answer
I found the solution:
Do a round of the value with decimal point based on the log of the number
=ROUND(A1,INT(3-LOG(A1,10)))
Answer
Right click -> Format cells and choose number and the decimal places for the
cells you want. Or do you want to do this in vba?
Ok like this then =ROUND(A1,INT(3-LOG(A1,10)))

Topic 95
Subject
Importing from Excel to SQL Server c#
Question
I am trying to import data from an Excel file to a table in SQL Server but it is
throwing errors.
string ssqltable = "mytable"; 
      string myexceldataquery = "select * from [Order
Form$]"; 
      try 
      { 
          string sexcelconnectionstring =
@"provider=microsoft.jet.oledb.4.0;Persist Security
Info=False;data
source='C:\Users\usiddiqui\Desktop\myexcel.xlsx';extended
properties=" + "\'excel 12.0;hdr=yes;\';"; 
          string ssqlconnectionstring = "server=SANJSQL-
DEV;Database=db; User Id=user; Password=pass;"; 
          string sclearsql = "delete from " + ssqltable; 
          SqlConnection sqlconn = new
SqlConnection(ssqlconnectionstring); 
          SqlCommand sqlcmd = new SqlCommand(sclearsql,
sqlconn); 
          sqlconn.Open(); 
          sqlcmd.ExecuteNonQuery(); 
          sqlconn.Close(); 
          OleDbConnection oledbconn = new
OleDbConnection(sexcelconnectionstring); 
          OleDbCommand oledbcmd = new
OleDbCommand(myexceldataquery, oledbconn); 
          oledbconn.Open(); 
          OleDbDataReader dr = oledbcmd.ExecuteReader(); 
          SqlBulkCopy bulkcopy = new
SqlBulkCopy(ssqlconnectionstring); 
          bulkcopy.DestinationTableName = ssqltable; 
          bulkcopy.BatchSize = 100; 
          bulkcopy.WriteToServer(dr); 
          //while (dr.Read()) 
          //{ 
          //    bulkcopy.WriteToServer(dr); 
          //} 

          dr.Close(); 
          oledbconn.Close(); 
          label1.Text = "File imported into sql server."; 
      } 
      catch (Exception ex) 
      { 
          //handle exception 
      } 
the error comes on oledbconn.Open();
this is the error
Could not find installable ISAM.
Answer
You're intermixing escape syntaxes. You're using @ to switch into multiline,
but then you're using \ to escape. Don't escape the \'s and remove the final \ .
string sexcelconnectionstring = @"provider=microsoft.jet.oledb.4.0;data
source=C:\Users\usiddiqui\Desktop\myexcel.xlsx;extended properties=excel
12.0;hdr=yes;";
Topic 96
Subject
VBA Inserting Excel complexe spreadsheet in .doc document
Question
So I've been working on a word .dotm file that will combine several .doc and
.xls documents into a single .pdf file.
Right now, I have two different problems, I will only detail the first one on this
topic:
When inserting a complexe (very complexe) Excel sheet in my .doc document,
the output is only a pile of meta data (Well mostly looks like it, if you prefer
clearer language: it is a complete mess of characters and page breaks) instead
of my file. I've looked for the entire day (really, I wasted my work day looking
for answers) on the internet and even asked on MSDN forum (no answer at all)
about this topic and everyone seems to have his code working like a charm.

Here is my code:
Sub MergeFiles()
Documents.Open FileName:="C:\test_cea\02.doc"
Selection.EndKey Unit:=wdStory
Selection.InsertFile FileName:="C:\test_cea\03.doc"
Selection.EndKey Unit:=wdStory
Selection.InsertFile FileName:="C:\test_cea\04.xls"
ActiveDocument.SaveAs2 FileName:="C:\test_cea\output.pdf",
FileFormat:=wdFormatPDF ActiveDocument.Close
SaveChanges:=doNotSaveChanges End Sub
I've tried a TREMENDOUS amount of things, from switching to opening the
.xls first, to trying every single combination of parameters possible in my
InsertFile() method and nothing works. The most amusing part is: it works
perfectly when trying to do it with Word UI, meaning Word can do it, but I'm
doing it wrong somehow. Answer
Here's the final answer to that question:
As Word cannot interpret an Excel file it is not possible to force file insertion
this way.
Instead use the following code:
Sub MergeFiles()
Dim appExcel As Excel.Application
Dim wdDocument As Word.Document
Set appExcel = CreateObject("Excel.Application") Set wdDocument =
Documents.Open("mydoc.doc")
appExcel.Workbooks.Open("myxls.xls")

appExcel.ActiveWorkbook.Sheets(1).Range("Print_area").CopyPicture 'Copy
picture prevents weird behavior from Word'
Selection.PasteSpecial Placement:=wdInLine,
DataType:=wdPasteMetafilePicture
End Sub
Obviously this is a sample code that will do the whole process but the idea is
to copy the Print Area (one must be defined, you can also use
Sheets(1).UsedRange but this will be a problem if the Excel file is oddly
formatted) as picture and paste it into Word. You can also simply copy it and
paste it but it may mess up your output table formatting.
I don't even know why people down voted my question -_-
Anyway, if you encouter the same issue, simply tell me if this code works.
Topic 97
Subject
Remove Blank Rows in excel using vbscript
Question
We get excel file from source system and we need to convert it to CSV.
Sometimes, last line of excel file we get empty rows. We need to delete that
row before the file is placed as CSV. I use the below code for doing this
conversion but it doesn’t work all the time.It still retains that empty rows
which causes problem when converted to CSV and last line of the CSV just
shows commas.
Below is the script
Dim StrSourcePathFile, StrDestPathFile
set xlApp = CreateObject("excel.application") Set fso =
CreateObject("Scripting.FileSystemObject")
StrSourcePathFile = "c:\temp\var31.XLSX"

StrDestPathFile = "c:\temp\var31.csv"
xlApp.Workbooks.Open StrSourcePathFile
xlApp.DisplayAlerts = False
If xlApp.ActiveSheet.Rows(1).Text = "" Then
xlApp.ActiveSheet.Rows(1).EntireRow.Delete End If
If
xlApp.ActiveSheet.Rows((xlApp.ActiveSheet.UsedRange.Rows.Count)).Text
= "" Then
xlApp.ActiveSheet.Rows((xlApp.ActiveSheet.UsedRange.Rows.Count)).Entire
End If
xlApp.ActiveWorkbook.SaveAs StrDestPathFile,6
xlApp.ActiveWorkbook.Saved = true
xlapp.Quit()
Set fso = Nothing
Set xlApp = Nothing
Thanks in advance.
Topic 98
Subject
Why does my VBA code throw an “Invalid outside procedure” error?
Question
For the life of me I cannot figure out why the following code is throwing a
compile error with the message "Invalid outside procedure". It is highlighting
the error on the starred line below.
Option Explicit
Dim shtThisSheet As Worksheets
**Set shtThisSheet =

Application.Workbook("Formatting2.xlsm").Worksheets("Sheet1")**
Sub Formatting()
With shtThisSheet 
      With Range("A1") 
          .Font.Bold = True 
          .Font.Size = 14 
          .HorizontalAlignment = xlLeft 
      End With 
      With Range("A3:A6") 
          .Font.Bold = True 
          .Font.Italic = True 
          .Font.ColorIndex = 5 
          .InsertIndent 1 
      End With 
      With Range("B2:D2") 
          .Font.Bold = True 
          .Font.Italic = True 
          .Font.ColorIndex = 5 
          .HorizontalAlignment = xlRight 
      End With 
      With Range("B3:D6") 
          .Font.ColorIndex = 3 
          .NumberFormat = "$#,##0" 
      End With 
End With
End Sub
Answer
Set statements aren't allowed outside procedures. Move the Set statement into
the Formatting procedure:
Sub Formatting()
Set shtThisSheet =
Application.Workbook("Formatting2.xlsm").Worksheets("Sheet1") ...

(I'd move the Dim statement into the procedure as well. I prefer to avoid
global variables when possible.)
Answer
You can declare variables as global, but you cannot set them outside of a
procedure such as a sub or function.
If you need this variable as a global, then it's best to set it on.
Workbook_Open()
If you do not need it as a global, then move both the declaration and the set
statement into your procedure
Topic 99
Subject
VBS copy and paste into another excel match destination formatting
Question
I have been searching online for the answer to this without much luck.
1. I have an excel file that has "general" formatting. It has dates etc. etc.
When it is formatted manually within the file to "text" the dates are
messed up. (E.G. 3/2/2015 may turn into 112321.12)
2. When I copy the excel file into another excel file that has all the columns
formatted to "Text" prior and click "match destination formatting" it will
give me the contents of the first excel sheet all in "Text" format.
3. The reason I do this is because I wrote another VBS script to copy the
contents into a delimited file to bulk insert it into SQL Server. However,
when I bulk insert with the file produced by an excel file that isn't all
"text", it will break. When I format it as "text" it works perfectly fine.
4. I need a VBS script to copy the contents of an excel document into another
excel document that is formatted with text and retain its date values.
Can someone point me in the right direction?
Topic 100

Subject
Adding a command click to excel to search for hello
Question
I'm trying to add a Search command click to my code on Sheet 3. i created a
command click and I tried "Clicking" Command Button from other workbook
other-workbook but it didn't work. Can you tell me what i'm doing wrong, I'm
fairly new to vba so any help will be appreciated
Sub Sample()
Dim oRange As Range, aCell As Range, bCell As Range Dim ws As
Worksheet
Dim ExitLoop As Boolean
Dim SearchString As String, FoundAt As String Dim iCount() As String
Dim outws As Worksheet
Dim Sheets As String
Set ws = Worksheets("detail_report")
Sheets("detail_report").Activate
ActiveSheet.cmdRefresh_Click
Set oRange = ws.Range("CZ:CZ")
SearchString = "input"
Set aCell = oRange.Find(What:=SearchString, LookIn:=xlValues, _ 
          LookAt:=xlPart, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
          MatchCase:=False, SearchFormat:=False) 
If Not aCell Is Nothing Then
Set bCell = aCell
FoundAt = aCell.Address
Do While ExitLoop = False

Set aCell = oRange.FindNext(After:=aCell) 
      If Not aCell Is Nothing Then 
          If aCell.Address = bCell.Address Then Exit Do 
          FoundAt = FoundAt & ", " & aCell.Address 
      Else 
          ExitLoop = True 
      End If 
Loop
iCount = Split(FoundAt, ", ")
Set outws = Worksheets("output")
outws.Range("A2").Value = SearchString
outws.Range("B2").Value = UBound(iCount) + 1
Else
MsgBox SearchString & " not Found"
End If
End Sub
Answer
Your IF conditional is likely not behaving the way you'd like it.... Try a With...
End With for speed / clarity.
With Worksheets("detail_report").Range("CZ:CZ")
aCell = .Find(What:=SearchString, LookIn:=xlValues, _ 
      LookAt:=xlPart, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
      MatchCase:=False, SearchFormat:=False)) 
If aCell <> "" Then 'this is probably what you want

'do your manipulation stuff here End if
End With
Topic 101
Subject
Update data in two Sheets Excel VBA
Question
Is it possible to update data on two sheets that is Sheet1 and Sheet2 data is
available in same rows and same column in both sheets
i use this update code
Private Sub cmdUpdate_Click()
Cells(currentrow - 1, 1).Resize(1, 4).Value = Array(TB1.Text,startdate.Text,
enddate.Text, ComboB.Text) End Sub
Answer
Just add the sheet you want it to update before the Cells():
Sheets("Sheet1").Cells(currentrow - 1, 1).Resize(1, 4).Value then just
copy/paste and change to "Sheet2":
Private Sub cmdUpdate_Click()
Sheets("Sheet1").Cells(currentrow - 1, 1).Resize(1, 4).Value =
Array(TB1.Text,startdate.Text, enddate.Text, ComboB.Text)
Sheets("Sheet2").Cells(currentrow - 1, 1).Resize(1, 4).Value =
Array(TB1.Text,startdate.Text, enddate.Text, ComboB.Text) End Sub
Topic 102
Subject
vba copy email body to excel as table
Question
Hi I have the following code which successfully loops through my folder and
pulls the email I want and copies the body (which is in table format) into
excel. however, when I paste it In, the entire body gets pasted in cell A1 when

it should fill the range A1:K92 as it would if I manually copied and pasted it.
is there any way to use vba to paste it in the correct range? Thanks!
Sub GetFXEmail()
Dim olApp As Outlook.Application
Dim olNs As Namespace
Dim Fldr As MAPIFolder
Dim olMi As Variant
Dim i As Integer
Set olApp = New Outlook.Application
Set olNs = olApp.GetNamespace("MAPI")
Set Fldr = olNs.GetDefaultFolder(olFolderInbox) Set Fldr =
Fldr.Folders("MyFolder")
Set inboxItems = Fldr.Items
pnldate = Format((Date - 1), "mm/dd/yyyy")
Set inboxItems = Fldr.Items
inboxItems.Sort "[ReceivedTime]", True
For i = 1 To Fldr.Items.Count Step 1
Set olMi = Fldr.Items(i) 
      If Format(olMi.ReceivedTime, "mm/dd/yyyy") = pnldate
Then 
          Debug.Print olMi.ReceivedTime 
          Debug.Print olMi.Subject 
          If InStr(1, olMi.Subject, "Breakdown") > 0 Then 
              Sheets("Sheet1").Range("A1") = olMi.Body 
              GoTo AllDone 
          End If 
      End If 
Next i
AllDone
End Sub Answer
If you only have 1 table in the email and it's recognized as an actual table this

code (to be placed inside the first If block) will work (and has been tested).
You can modify the parts to suit your exact needs, if need be.
Also note, it requires an Reference to the Microsoft Word Object Library (as
you have already the Outlook Object Library).
If Format(olMi.ReceivedTime, "mm/dd/yyyy") = pnldate Then
With olMi 
      Debug.Print .ReceivedTime 
      Debug.Print .Subject 
      Dim olInsp As Outlook.Inspector 
      Set olInsp = .GetInspector 
      Dim wdDoc As Word.Document 
      Set wdDoc = olInsp.WordEditor 
      Dim tb As Word.Table 
      For Each tb In wdDoc.Tables 'assumes only 1 table 
          Dim y as Long, x as Long 
          For y = 0 To tb.Rows.Count 
              For x = 0 To tb.Columns.Count 
                  Sheets("Sheet1").Range("A1").Offset(y,
x).Value = tb.Cell(y, x).Range.Text 
              Next 
          Next 
      Next 
End With
GoTo AllDone
End If
Answer
Even Scot give you a great answer, I give my answer, may be could help
someone else.
This take the string, and create a table, parsing the data, inside the excel, offset

1 column, but this could be fixed just with a .copy.
Sub convertToTable()
Dim bigString As String
Dim i
Dim lenString
Dim n
Dim typeChar
Dim r
Dim rng As Range
Dim lineLen
Dim a
Dim tLen
Dim textR
bigString = Range("A1").Value 'take the value from A1 lenString =
Len(bigString) 'take the lenght
Do 'go over the string spliting by the new line character (char10) 
      i = i + 1 'just the index 
      Range(Cells(i, 1), Cells(i, 1)).Value = Left(bigString,
InStr(1, bigString, Chr(10))) 
      'important: 
      'use the col 1 to put the values in the sheet, here we
split just into rows 
      'you can change the value of the column as you want 
      bigString = Right(bigString, Len(bigString) - InStr(1,
bigString, Chr(10))) 
      'here adjust the string to the rest of the text 
Loop While i < lenString
r = Range(Cells(1, 1), Cells(1, 1)).End(xlDown).Row 'same as
Range("A1").End Set rng = Range(Cells(1, 2), Cells(r, 2)) 'the whole range of
data in col A
a = 1 'here set 1 to use the column B (a = a + 1)

'if we delete the data there will be a trouble For Each i In rng 'for each
cell/row in the data range in column A 
      tLen = Len(i.Value) 'the lenght 
      textR = i.Value 'the text 
      Do 
          a = a + 1 'the next column... 
          Cells(i.Row, a).Value = Left(textR, InStr(1, textR,
Chr(32))) 
          'Left(textR, InStr(1, textR, Chr(32))) 
          'this split the values using the space char
(Chr(32)), but you can 
          'change it as you need, just find the spliting
character 
          textR = Right(textR, Len(textR) - InStr(1, textR,
Chr(32))) 
      Loop While InStr(1, textR, Chr(32)) <> 0 
      a = 1 
Next i
End Sub
Topic 103
Subject
Get the value of a cell in range, store it a variable, then next cell, next row
(Excel)
Question
I'd like to get the value of a cell in a range and store it as a variable. And then
set the value of another cell in another range as that variable. Then move on to
the cell. After all the cells in the row are captured, I'd like to move to the next
row and start again with the first cell and first variable. I can't figure out how
to move to the next cell and then set the value in the new range to the variable.
Here's what I got so far
Dim rng As Range
Dim row As Range
Dim cell As Range
Dim card1 As String
Dim card2 As String

Dim card3 As String
Dim card4 As String
Dim card5 As String
Dim valueRng As Range
Set rng = Range("A2:D4")
Set valueRng = ("F2:I4")
For Each row In rng.Rows
For Each cell In row.Cells
card1 = cell.Value
'Set first variable
'Code here for setting value of for first cell in valueRng
'Move to second cell
'get value
'set variable card2
'Set value of second cell in valueRng
Next cell
Next row
Answer
Use row and column counters instead of For each:
Dim rng As Range
Dim row As Range
Dim cell As Range
Dim card1 As String
Dim card2 As String
Dim card3 As String
Dim card4 As String
Dim card5 As String
Dim valueRng As Range
Dim x as long
Dim y as long
Set rng = Range("A2:D4")

Set valueRng = Range("F2:I4")
For x = 1 to rng.Rows.Count
for y = 1 to rng.Columns.Count
card1 = rng.cells(x, y).Value
'Set first variable
'Code here for setting value of for first cell in valueRng valueRng.Cells(x,
y).Value = card1
Next y
Next x
Note that there are far simpler ways of populating one array from another when
they are the same size and shape.
Topic 104
Subject
Application-defined or object-defined error IF statement
Question
I get Run-time error '1004' Application-defined or object-defined error. it get's
stuck on this If statement
If Cells(rownumber2, 2).Value <> 1 Then
Any help would be appropriated
Sub stock()
Application.ScreenUpdating = False
Dim rownumber As Long
Dim rownumber2 As Double
Dim rng As Range, i As Range, j As Range, rng2 As Range rownumber = 0
'Machining 900#
rownumber2 = 1 'maximo 900#
Set rng = Range("j1:j1910")
Set rng2 = Range("A2:A62685")

For Each i In rng
rownumber = rownumber + 1
For Each j In rng2
rownumber2 = rownumber2 + 1
If i = j Then 
      If Cells(rownumber2, 2).Value <> 1 Then 
      'If (IsNumber(Search("Active", Cells(rownumber2, 2))))
Then 
          Cells(rownumber, 10).Interior.ColorIndex = 5 
      Exit For 
      End If 
      Exit For 
End If
Next
Next
Application.ScreenUpdating = True
End Sub
Answer
What's the value of rowNumber2 when it fails ?
You never reset its value, so eventually it will exceed the number of rows in a
sheet. Maybe you mean to reset it to 2 each time through the "j" loop...
Answer
So I couldn't figure out why that code was not working so I solved the problem
by changing the code to this.
Sub stock()
Application.ScreenUpdating = False
Dim rownumber As Long
Dim rng As Range, i As Range, j As Range, rng2 As Range rownumber = 0
'Machining 900#
Set rng = Range("j1:j1921")
Set rng2 = Range("A2:A62685")

For Each i In rng
rownumber = rownumber + 1
For Each j In rng2 
      If i = j Then 
          If j.Offset(0, 1) <> "Active" Then 
              Cells(rownumber, 10).Interior.ColorIndex = 3 
              a = j.Offset(0, 1).Value 
              i.Offset(0, 1).Value = a 
          Exit For 
          End If 
          Exit For 
      End If 
   Next 
Next
Application.ScreenUpdating = True
End Sub
Topic 105
Subject
Excel workbook, folder and picture files not closing/ending completely
Question
This project I am working on below is a reference card that pulls text from an
excel file and pictures from the same searched folder. The process is then
"looped" by calling the Subs one after another until the app is exited. The
reference card is supposed to update every 10 minute by researching for the
files and repeating the process. The issue is that I wanted the code to open the
file, pull, and then close the file completely then wait and repeat. This way the
file could be edited before the next update. Instead it says it is still in use,
meaning read only. Even when I close the app and visual studios it still says
still in use. Using Marshal.ObjectRelease isn't working. The code starts the
Excel Process, goes through out the code and release does not work. After it
loops through the 2nd time and creates a new process (Now 2 Excel
Processes) The release works but only for the new process not the original and
this continues for each loop through.

Option Explicit On
Imports System
Imports System.IO
Imports System.Text
Imports Excel = Microsoft.Office.Interop.Excel
Public Class Form1
Dim appXL As Excel.Application
Dim wbXl As Excel.Workbook
Dim shXL As Excel.Worksheet
Dim FldPath As String
Dim PartID As String
Dim RefCard As String
Dim timeUpDate As Double
Private Sub Form1_Load(sender As System.Object, e As System.EventArgs)
Handles MyBase.Load
'Dispaly Brembo Logo
picLogo.SizeMode = PictureBoxSizeMode.StretchImage
End Sub
Private Sub Wait()
Threading.Thread.Sleep(600000)
ReferenceCardDataPull()
End Sub
Private Async Sub ReferenceCardDataPull()
'Read File Source with part number ****************** PartID =
("19.N111.10")
' Start Excel and get Application object. appXL =
CreateObject("Excel.Application") appXL.Visible = False
'Open Reference
Card*****************************************************************

FldPath = ("\\HOMESHARE01\Public\Kaizens\Kaizen 44 - Missing
Parts\Reference Cards\Completed Reference Cards by Part Number" & "\" &
PartID) If System.IO.Directory.Exists(FldPath) Then 
      wbXl = appXL.Workbooks.Open(FldPath & "\" & PartID &
".xlsm") 
      shXL = wbXl.Worksheets("Sheet1") 
      ' Copys Reference Card Data by Cell To App labels 
      lblCODE.Text = shXL.Cells(6, 5).Value 
      lblREV.Text = shXL.Cells(3, 5).Value 
      lblDate.Text = shXL.Cells(9, 5).Value 
      lblCustomer.Text = shXL.Cells(3, 1).Value 
      lblPart.Text = shXL.Cells(6, 1).Value 
      lblSpindleType.Text = shXL.Cells(9, 1).Value 
      lblPaintType.Text = shXL.Cells(12, 1).Value 
      lblDunnageType.Text = shXL.Cells(15, 1).Value 
      lblPartsLayer.Text = shXL.Cells(3, 3).Value 
      lblLayers.Text = shXL.Cells(6, 3).Value 
      lblTotalParts.Text = shXL.Cells(9, 3).Value 
      lblPackagingInstructs.Text = shXL.Cells(12, 3).Value 
      'Pulls pictures from designated part folder 
      If System.IO.File.Exists(FldPath & "\" & "PicSpindle" &
PartID & ".JPG") Then 
          picSpindle.Image = Image.FromFile(FldPath & "\" &
"PicSpindle" & PartID & ".JPG") 
          picSpindle.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picSpindle.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" & "PicRotorTop"
& PartID & ".JPG") Then 
          picRotorTop.Image = Image.FromFile(FldPath & "\" &
"PicRotorTop" & PartID & ".JPG") 
          picRotorTop.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picRotorTop.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" &
"PicRotorBottom" & PartID & ".JPG") Then 

          picRotorBottom.Image = Image.FromFile(FldPath & "\"
& "PicRotorBottom" & PartID & ".JPG") 
          picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" &
"PicDunnageFinal" & PartID & ".JPG") Then 
          picDunnageFinal.Image = Image.FromFile(FldPath &
"\" & "PicDunnageFinal" & PartID & ".JPG") 
          picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" &
"PicDunnageLayer" & PartID & ".JPG") Then 
          picDunnageLayer.Image = Image.FromFile(FldPath &
"\" & "PicDunnageLayer" & PartID & ".JPG") 
          picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      ' Close objects 
      shXL = Nothing 
      wbXl.Close() 
      appXL.Quit() 
      appXL = Nothing 
  Else 
      lblCODE.Text = ("Error") 
      lblCODE.ForeColor = Color.Red 
      lblREV.Text = ("Error") 
      lblREV.ForeColor = Color.Red 
      lblDate.Text = ("Error") 
      lblDate.ForeColor = Color.Red 
      lblCustomer.Text = ("Error") 
      lblCustomer.ForeColor = Color.Red 
      lblPart.Text = ("Error") 
      lblPart.ForeColor = Color.Red 
      lblSpindleType.Text = ("Error") 

      lblSpindleType.ForeColor = Color.Red 
      lblPaintType.Text = ("Error") 
      lblPaintType.ForeColor = Color.Red 
      lblDunnageType.Text = ("Error") 
      lblDunnageType.ForeColor = Color.Red 
      Lable49.Text = ("Error") 
      Lable49.ForeColor = Color.Red 
      lblLayers.Text = ("Error") 
      lblLayers.ForeColor = Color.Red 
      lblTotalParts.Text = ("Error") 
      lblTotalParts.ForeColor = Color.Red 
      lblPackagingInstructs.Text = ("Error") 
      lblPackagingInstructs.ForeColor = Color.Red 
      lblError.Visible = True 
End If
timeUpDate = 599
tmrUpdate.Start()
Application.DoEvents()
Await Task.Run(Sub() 
                     Wait() 
                 End Sub) 
ReferenceCardDataPull()
End Sub
Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles
tmrUpdate.Tick
Dim hms = TimeSpan.FromSeconds(timeUpDate) Dim m =
hms.Minutes.ToString
Dim s = hms.Seconds.ToString
If timeUpDate > 0 Then 
      timeUpDate -= 1 
      lblTimer.Text = (m & ":" & s) 

Else 
      tmrUpdate.Stop() 
      lblTimer.Text = "Updating" 
End If
End Sub
End Class
Updated Code using Marshal.objectrelease
Imports System
Imports System.IO
Imports System.Text
Imports System.Runtime.InteropServices
Imports Excel = Microsoft.Office.Interop.Excel Imports
System.ComponentModel
Public Class Form1
Dim appXL As Excel.Application
'Dim wbXl As Excel.Workbook**** Archive 'Dim shXL As
Excel.Worksheet**** Archive Dim wbXls As Excel.Workbooks
Dim wbXl As Excel.Workbook
Dim shXL As Excel.Worksheet
Dim FldPath As String
Dim PartID As String
Dim RefCard As String
Dim timeUpDate As Double
Dim OpenFolder As Object = CreateObject("shell.application")
Private Sub Form1_Load(sender As System.Object, e As System.EventArgs)
Handles MyBase.Load
'Dispaly Brembo Logo
picLogo.SizeMode = PictureBoxSizeMode.StretchImage
ReferenceCardDataPull()
End Sub

Private Sub Wait()
Threading.Thread.Sleep(10000)
End Sub
Private Async Sub ReferenceCardDataPull()
'Prepare For Load
lblTimer.Text = "Updating"
lblError.Visible = False
'Read File Source with part number ****************** PartID =
("19.N111.10")
' Start Excel and get Application object. appXL =
CreateObject("Excel.Application") appXL.Visible = False
'Open Reference
Card*****************************************************************
FldPath = ("\\HOMESHARE01\Public\Kaizens\Kaizen 44 - Missing
Parts\Reference Cards\Completed Reference Cards by Part Number" & "\" &
PartID) If System.IO.Directory.Exists(FldPath) Then 
      If System.IO.File.Exists(FldPath & "\" & PartID &
".xlsm") Then 
          'wbXl = appXL.Workbooks.Open(FldPath & "\" & PartID
& ".xlsm")**** Archive 
          wbXls = appXL.Workbooks 
          wbXl = wbXls.Open(FldPath & "\" & PartID & ".xlsm")
          shXL = wbXl.Worksheets("Sheet1") 
          ' Copys Reference Card Data by Cell To App labels 
          lblCODE.Text = shXL.Cells(6, 5).Value 
          lblREV.Text = shXL.Cells(3, 5).Value 
          lblDate.Text = shXL.Cells(9, 5).Value 
          lblCustomer.Text = shXL.Cells(3, 1).Value 
          lblPart.Text = shXL.Cells(6, 1).Value 
          lblSpindleType.Text = shXL.Cells(9, 1).Value 
          lblPaintType.Text = shXL.Cells(12, 1).Value 
          lblDunnageType.Text = shXL.Cells(15, 1).Value 
          lblPartsLayer.Text = shXL.Cells(3, 3).Value 
          lblLayers.Text = shXL.Cells(6, 3).Value 
          lblTotalParts.Text = shXL.Cells(9, 3).Value 

          lblPackagingInstructs.Text = shXL.Cells(12,
3).Value 
      Else 
          lblCODE.Text = ("Error") 
          lblREV.Text = ("Error") 
          lblDate.Text = ("Error") 
          lblCustomer.Text = ("Error") 
          lblPart.Text = ("Error") 
          lblSpindleType.Text = ("Error") 
          lblPaintType.Text = ("Error") 
          lblDunnageType.Text = ("Error") 
          Lable49.Text = ("Error") 
          lblLayers.Text = ("Error") 
          lblTotalParts.Text = ("Error") 
          lblPackagingInstructs.Text = ("Error") 
          lblError.Visible = True 
          ' Close objects**** Archive 
          ' shXL = Nothing**** Archive 
          ' wbXl.Close()**** Archive 
          'appXL.Quit()**** Archive 
          'appXL = Nothing**** Archive 
      End If 
Else 
      'File not found Error 
      lblCODE.Text = ("Error") 
      lblREV.Text = ("Error") 
      lblDate.Text = ("Error") 
      lblCustomer.Text = ("Error") 
      lblPart.Text = ("Error") 
      lblSpindleType.Text = ("Error") 
      lblPaintType.Text = ("Error") 
      lblDunnageType.Text = ("Error") 
      Lable49.Text = ("Error") 
      lblLayers.Text = ("Error") 
      lblTotalParts.Text = ("Error") 
      lblPackagingInstructs.Text = ("Error") 
      lblError.Visible = True 
End If

'Pulls pictures from designated part folder If System.IO.File.Exists(FldPath &
"\" & "PicSpindle" & PartID & ".JPG") Then 
      picSpindle.Image = Image.FromFile(FldPath & "\" &
"PicSpindle" & PartID & ".JPG") 
      picSpindle.SizeMode = PictureBoxSizeMode.StretchImage 
  Else 
      picSpindle.SizeMode = PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicRotorTop" & PartID & ".JPG")
Then 
      picRotorTop.Image = Image.FromFile(FldPath & "\" &
"PicRotorTop" & PartID & ".JPG") 
      picRotorTop.SizeMode = PictureBoxSizeMode.StretchImage 
  Else 
      picRotorTop.SizeMode = PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicRotorBottom" & PartID &
".JPG") Then 
      picRotorBottom.Image = Image.FromFile(FldPath & "\" &
"PicRotorBottom" & PartID & ".JPG") 
      picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
  Else 
      picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicDunnageFinal" & PartID &
".JPG") Then 
      picDunnageFinal.Image = Image.FromFile(FldPath & "\" &
"PicDunnageFinal" & PartID & ".JPG") 
      picDunnageFinal.SizeMode =

PictureBoxSizeMode.StretchImage 
  Else 
      picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
End If
If System.IO.File.Exists(FldPath & "\" & "PicDunnageLayer" & PartID &
".JPG") Then 
      picDunnageLayer.Image = Image.FromFile(FldPath & "\" &
"PicDunnageLayer" & PartID & ".JPG") 
      picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
  Else 
      picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
End If
' Close objects
wbXl.Close()
wbXls.Close()
appXL.Quit()
'Release Objects
releaseObject(shXL)
releaseObject(wbXl)
releaseObject(wbXl)
releaseObject(wbXls)
releaseObject(appXL)
timeUpDate = 9
tmrUpdate.Start()
Application.DoEvents()
Await Task.Run(Sub()
Wait()
End Sub)

ReferenceCardDataPull()
End Sub
Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles
tmrUpdate.Tick
Dim hms = TimeSpan.FromSeconds(timeUpDate) Dim m =
hms.Minutes.ToString
Dim s = hms.Seconds.ToString
If timeUpDate > 0 Then 
      timeUpDate -= 1 
      lblTimer.Text = (m & ":" & s) 
Else 
      tmrUpdate.Stop() 
      lblTimer.Text = "Preparing Update" 
End If
End Sub
Private Sub releaseObject(ByVal obj As Object)
Try 
      Dim intRel As Integer = 0 
      Do 
          intRel =
System.Runtime.InteropServices.Marshal.ReleaseComObject(obj) 
      Loop While intRel > 0 
      'MsgBox("Final Released obj # " & intRel) 
  Catch ex As Exception 
      MsgBox("Error releasing object" & ex.ToString) 
      obj = Nothing 
  Finally 
      GC.Collect() 
End Try

End Sub
End Class
Answer
Workink with COM in .Net requires to release com objects. More than that,
you cannot use dots when working with excel interop (or any other COM
object) in .Net since between the dots, temporarly objects are created behind
the scene and need to be released. For example, you wrote:
appXL.Workbooks.Open
You need to split it to
Dim workbooks as Excel.Workbooks
workbooks = appXL.WorkBooks
workbooks.Open
...
When time to release, you need to call
Marhsal.ReleaseComObject(workbooks).
You must do it for all the excel objects you have in the code. An example of the
usage of excel in VB.Net:
Public Function PrintExcel(sPath As String, iFrom As Integer) As String
Implements IPrint.PrintExcel
Dim xlApp As Excel.Application = Nothing Dim xlWorkBooks As
Excel.Workbooks = Nothing Dim xlWorkBook As Excel.Workbook = Nothing
Dim xlWorkSheets As Excel.Sheets = Nothing Dim xlWorkSheet As
Excel.Worksheet = Nothing
Try 
      xlApp = New Excel.Application 
      xlWorkBooks = xlApp.Workbooks 
      xlWorkBook = xlWorkBooks.Open(sPath) 
      xlWorkSheets = xlWorkBook.Sheets 
      xlWorkSheet = xlWorkSheets(1) 
     ' DO SOMETHING 

      xlWorkBook.Close() 
      xlWorkBooks.Close() 
      xlApp.Quit() 
Catch ex As Exception
Finally 
      releaseObject(xlWorkSheet) 
      releaseObject(xlWorkSheets) 
      releaseObject(xlWorkBook) 
      releaseObject(xlWorkBooks) 
      releaseObject(xlApp) 
End Try
Return s
End Function
Private Sub releaseObject(ByVal obj As Object)
Try 
      If obj IsNot Nothing Then 
          Marshal.ReleaseComObject(obj) 
      End If 
Catch ex As Exception
Finally
obj = Nothing
End Try
End Sub
' ----------------------
Following your code with the fix, not checked:

Option Explicit On
Imports System
Imports System.IO
Imports System.Text
Imports Excel = Microsoft.Office.Interop.Excel
Public Class Form1
Dim appXL As Excel.Application
Dim wbXls As Excel.Workbooks
Dim wbXl As Excel.Workbook
Dim shXLs As Excel.Sheets ' FIX 1: Sheets instead of WorkSheets Dim shXL
As Excel.Worksheet
Dim FldPath As String
Dim PartID As String
Dim RefCard As String
Dim timeUpDate As Double
Private Sub Form1_Load(sender As System.Object, e As System.EventArgs)
Handles MyBase.Load
'Dispaly Brembo Logo
picLogo.SizeMode = PictureBoxSizeMode.StretchImage
ReferenceCardDataPull()
End Sub
Private Sub Wait()
Threading.Thread.Sleep(600000)
End Sub
Private Async Sub ReferenceCardDataPull()
'Read File Source with part number ****************** PartID =
("19.N111.10")
' Start Excel and get Application object. appXL =
CreateObject("Excel.Application") appXL.Visible = False
'Open Reference

Card*****************************************************************
FldPath = ("\\HOMESHARE01\Public\Kaizens\Kaizen 44 - Missing
Parts\Reference Cards\Completed Reference Cards by Part Number" & "\" &
PartID) If System.IO.Directory.Exists(FldPath) Then 
      wbXls = appXL.Workbooks 
      wbXl = wbXls.Open(FldPath & "\" & PartID & ".xlsm") 
      shXLs = wbXl.Worksheets 
      shXL = shXLs("Sheet1") 
      ' Copys Reference Card Data by Cell To App labels 
      lblCODE.Text = shXL.Cells(6, 5).Value 
      lblREV.Text = shXL.Cells(3, 5).Value 
      lblDate.Text = shXL.Cells(9, 5).Value 
      lblCustomer.Text = shXL.Cells(3, 1).Value 
      lblPart.Text = shXL.Cells(6, 1).Value 
      lblSpindleType.Text = shXL.Cells(9, 1).Value 
      lblPaintType.Text = shXL.Cells(12, 1).Value 
      lblDunnageType.Text = shXL.Cells(15, 1).Value 
      lblPartsLayer.Text = shXL.Cells(3, 3).Value 
      lblLayers.Text = shXL.Cells(6, 3).Value 
      lblTotalParts.Text = shXL.Cells(9, 3).Value 
      lblPackagingInstructs.Text = shXL.Cells(12, 3).Value 
      'Pulls pictures from designated part folder 
      If System.IO.File.Exists(FldPath & "\" & "PicSpindle" &
PartID & ".JPG") Then 
          picSpindle.Image = Image.FromFile(FldPath & "\" &
"PicSpindle" & PartID & ".JPG") 
          picSpindle.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picSpindle.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" & "PicRotorTop"
& PartID & ".JPG") Then 
          picRotorTop.Image = Image.FromFile(FldPath & "\" &
"PicRotorTop" & PartID & ".JPG") 
          picRotorTop.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picRotorTop.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 

      If System.IO.File.Exists(FldPath & "\" &
"PicRotorBottom" & PartID & ".JPG") Then 
          picRotorBottom.Image = Image.FromFile(FldPath & "\"
& "PicRotorBottom" & PartID & ".JPG") 
          picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picRotorBottom.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" &
"PicDunnageFinal" & PartID & ".JPG") Then 
          picDunnageFinal.Image = Image.FromFile(FldPath &
"\" & "PicDunnageFinal" & PartID & ".JPG") 
          picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picDunnageFinal.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      If System.IO.File.Exists(FldPath & "\" &
"PicDunnageLayer" & PartID & ".JPG") Then 
          picDunnageLayer.Image = Image.FromFile(FldPath &
"\" & "PicDunnageLayer" & PartID & ".JPG") 
          picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
      Else 
          picDunnageLayer.SizeMode =
PictureBoxSizeMode.StretchImage 
      End If 
      ' Close objects 
                        ' FIX 2: remove shXL = Nothing 
      wbXl.Close() 
      wbXls.Close() 
      appXL.Quit() 
                        ' FIX 3: remove appXL = Nothing 
      releaseObject(shXL) 
      releaseObject(shXLs) 
      releaseObject(wbXl) 
      releaseObject(wbXls) 
      releaseObject(appXL) 

Else 
      lblCODE.Text = ("Error") 
      lblCODE.ForeColor = Color.Red 
      lblREV.Text = ("Error") 
      lblREV.ForeColor = Color.Red 
      lblDate.Text = ("Error") 
      lblDate.ForeColor = Color.Red 
      lblCustomer.Text = ("Error") 
      lblCustomer.ForeColor = Color.Red 
      lblPart.Text = ("Error") 
      lblPart.ForeColor = Color.Red 
      lblSpindleType.Text = ("Error") 
      lblSpindleType.ForeColor = Color.Red 
      lblPaintType.Text = ("Error") 
      lblPaintType.ForeColor = Color.Red 
      lblDunnageType.Text = ("Error") 
      lblDunnageType.ForeColor = Color.Red 
      Lable49.Text = ("Error") 
      Lable49.ForeColor = Color.Red 
      lblLayers.Text = ("Error") 
      lblLayers.ForeColor = Color.Red 
      lblTotalParts.Text = ("Error") 
      lblTotalParts.ForeColor = Color.Red 
      lblPackagingInstructs.Text = ("Error") 
      lblPackagingInstructs.ForeColor = Color.Red 
      lblError.Visible = True 
End If
timeUpDate = 599
tmrUpdate.Start()
Application.DoEvents()
Await Task.Run(Sub() 
                     Wait() 
                 End Sub) 
ReferenceCardDataPull()
End Sub
Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles

tmrUpdate.Tick
Dim hms = TimeSpan.FromSeconds(timeUpDate) Dim m =
hms.Minutes.ToString
Dim s = hms.Seconds.ToString
If timeUpDate > 0 Then 
      timeUpDate -= 1 
      lblTimer.Text = (m & ":" & s) 
Else 
      tmrUpdate.Stop() 
      lblTimer.Text = "Updating" 
End If
End Sub
Private Sub releaseObject(ByVal obj As Object) 
      Try 
          If obj IsNot Nothing Then 
              Marshal.ReleaseComObject(obj) 
          End If 
      Catch ex As Exception 
      Finally 
          obj = Nothing 
      End Try 
End Sub
End Class
Topic 106
Subject
Is it possible to preserve cell formatting when importing from Excel to Visio?

Question
I have an Excel 2010 spreadsheet that contains a organizational hierarchy
information (Employee Name, Employee Supervisor, Date Hired, Hourly
Wage, Annual Earnings, etc) that I am trying to import into a Visio 2013
organization chart. However, when I do the import, it doesn't preserve any of
the Excel cell formatting beyond converting text to "Text" and date/currency
formats to simple "Number" format. Is there any way to preserve this
formatting? I have large datasets, so simply converting after it has been
imported is very time-consuming; it would be great if anyone has a
workaround for this. Thanks for any help!
I'm not attaching the spreadsheet because it contains personal information and I
don't see how it would help answer my question, but if it would help, I can
generalize a sample of the data and upload it (just someone please tell me
whether they would like me to do this).
Topic 107
Subject
Kendo grid export to excel header title shows html characters
Question
When I export my grid to excel,headers are like: Product Name,{{'unitsOrder'|
translate}} in excel. My grid supports 2 languages and I am showing it with
angularjs translate way. Any offer?
<script>
$("#grid").kendoGrid({ 
      toolbar: ["excel"], 
      excel: { 
          fileName: "Kendo UI Grid Export.xlsx" 
      }, 
      dataSource: { 
          type: "odata", 
          transport: { 
              read: "http://demos.telerik.com/kendo-
ui/service/Northwind.svc/Products" 
          }, 
          pageSize: 7 
      }, 

      sortable: true, 
      pageable: true, 
      columns: [ 
          { width: 300, field: "ProductName", title: "
<b>Product Name</b>" }, 
          { field: "UnitsOnOrder", title: "{{'unitsOrder'|
translate}}" }, 
          { field: "UnitsInStock", title: "Units In Stock" } 
      ] 
});
</script>
Answer
I had a similar problem but I use i18next translation instead of angular but
maybe it helps you find a solution to your case:
I use the 'excelExport' event to manually update the generated worksheet.
Within the worksheet object I search for the header cells and manually trigger
the translation for the text it contains:
excelExport: function(e) { 
      // First I loop through all rows in the worksheet 
      e.workbook.sheets[0].rows.forEach(function(row){ 
        // Ignore 'data' rows (only use 'header' and
'footer') 
        if(row.type != 'data'){ 
          // Loop through all cells of the row 
          row.cells.forEach(function(cell){ 
            // Here I overwrite the cell value with its
translation 
            // You have to implement translate() so it works
with angular 
            cell.value = translate(cell.value) 
          }); 
        } 
      }); 
    }, 

You now have to write your own translate function which can handle your
angular translation. As I use i18next for translations my solution won't help
here (I use jquery to generate a jquery html object on which I can trigger the
translation)
Topic 108
Subject
Get rows matching criterion from all sheets in a spreadsheet
Question
I have a Google spreadsheet with about 20 sheets (each with a proper name,
not Sheet1,Sheet2 etc) of the following structure -

Task Title | Description | Status |
Comments1 | Comments 2
Task1       |      Xyz      | Stage 1  |             | 
Task2       |      Xyz      | Stage 2  |  abc        | 
Task3       |      Xyz      | Done     |             | 
Task4       |               | Done     |             | 
How do I create a new sheet with the same structure of above for all tasks
(across sheets) that have Status as Done Answer
You can add a new sheet into your workbook and use this formula (replacing
Sheet1, Sheet2, Sheet3 with your actual sheet names):
=QUERY({Sheet1!A:C;Sheet2!A:C;Sheet3!A:C},"where Col3='Done'")
Within the { } you will need to add in the A:C reference for each indiviual
sheet separated by ;
To return the header row as well, add a 1 to the end of the query:
=QUERY({Sheet1!A:E;Sheet2!A:E;Sheet3!A:E},"where Col3='Done'",1)
Or to return individual columns, you can include a select statment:
=QUERY({Sheet1!A:E;Sheet2!A:E;Sheet3!A:E},"select Col1 where
Col3='Done'",1)
Topic 109
Subject
Date Formats Between SQL and Excel ON US SQL Server to UK Desktop
Question

I have a strange one and not sure how to resolve it.
I wrote a stored procedure for a client who is based in London but their SQL
Server is located in the US. In my SP, I convert to 103 to ensure dates are in
the correct format. When I run the code, it is correct. Nice and easy.
I have an Excel workbook that calls the SP and populates a sheet with the data.
I wrote the Excel VBA when onsite in London, so regional settings are UK.
Everything worked fine. I then needed to make changes so I was give remote
access and a desktop, again the server farm is in US but regional settings are
UK. When I run, the dates appear correct.
Now this is where the problem starts. If I copy from my remote desktop to my
local desktop or email to another user, which again is UK, and open the
workbook, the dates are in US format. If its say 15/02/2016 in the raw data it
is showing as 15/02/2016 but if its 09/02/2016 its showing as 02/09/2016.
I have tried formatting the columns using VBA (format(field), "dd/mm/yyyy")
but they stay the same so am a little confused and to what the issue may be. I
have also tried CONVERT with 101 to convert to US to see if it swaps back
but then I get convert errors, which I would expect.
Can anyone shed any light on why this may be happening. Login for the SQL
connection is set to British English.
Thanks very much in advance of any help.
Topic 110
Subject
Export activity table as excel to share point server in java using webservices
Question
I am trying to export excel file into share point server
I referred this link:Upload a file to SharePoint through the built-in web
services.
I am unable to import Uri,SharePointserver2007,security etc... how can i

import these?
public static void UploadFile2007(string destinationUrl, byte[] fileData) {
// List of desination Urls, Just one in this example. string[] destinationUrls = {
Uri.EscapeUriString(destinationUrl) };
// Empty Field Information. This can be populated but not for this example.
SharePoint2007CopyService.FieldInformation information = new
SharePoint2007CopyService.FieldInformation();
SharePoint2007CopyService.FieldInformation[] info = { information };
// To receive the result Xml.
SharePoint2007CopyService.CopyResult[] result;
// Create the Copy web service instance configured from the web.config file.
SharePoint2007CopyService.CopySoapClient CopyService2007 = new
CopySoapClient("CopySoap");
CopyService2007.ClientCredentials.Windows.ClientCredential =
CredentialCache.DefaultNetworkCredentials;
CopyService2007.ClientCredentials.Windows.AllowedImpersonationLevel =
System.Security.Principal.TokenImpersonationLevel.Delegation;
CopyService2007.CopyIntoItems(destinationUrl, destinationUrls, info,
fileData, out result);
if (result[0].ErrorCode !=
SharePoint2007CopyService.CopyErrorCode.Success) {
// ...
}
}
Topic 111
Subject
I have some addresses in column A which is not in proper format, I want to

copy the state in separate cells
Question
I have some 30000 addresses in Column A, which is not in proper format.
I have made a column of all States in Column C, whose range is from C2:C36.
I want something like that, those words in Column A that match with Column C
whose range is C2:C36; should copy in Column B.
You can see the screenshot to understand better.
Please provide me solution, either any formula or VBA macro. Answer
For a formula version, you could try:-
=IFERROR(INDEX($C$2:$C$36,MATCH(TRUE,
(ISNUMBER(FIND($C$2:$C$36,A2))),0)),"")
Is an array formula and must be entered in B2 using CtrlShiftEnter
This is case sensitive: for a non-case-sensitive version, use SEARCH instead
of FIND.
Topic 112
Subject
Update is not working Excel VBA
Question
update button is not functioning properly it is just adding up new row with data
instead of updating
Dim currentrow As Long 
      Private Sub cmdFindNext_Click() 
      Dim lastrow 
      Dim evtname As String 
      lastrow = Sheets("Sheet1").Range("A" &
Rows.Count).End(xlUp).Row 
      evtname = TB1.Text 

      For currentrow = 4 To lastrow 
      If Cells(currentrow, 1).Text = evtname Then 
      TB1.Text = Cells(currentrow, 1).Text 
      ComboB.Text = Cells(currentrow, 4) 
      startdate.Text = Cells(currentrow, 2) 
      enddate.Text = Cells(currentrow, 3) 
      End If 
      Next currentrow 
      TB1.SetFocus 
      End Sub 
      Private Sub cmdFindPrevious_Click() 
      Dim lastrow 
      Dim evtname As String 
      lastrow = Sheets("Sheet1").Range("A" &
Rows.Count).End(xlUp).Row 
      evtname = TB1.Text 
      For currentrow = lastrow To 4 Step -1 
      If Cells(currentrow, 1).Text = evtname Then 
      TB1.Text = Cells(currentrow, 1).Text 
      ComboB.Text = Cells(currentrow, 4) 
      startdate.Text = Cells(currentrow, 2) 
      enddate.Text = Cells(currentrow, 3) 
      End If 
      Next currentrow 
      TB1.SetFocus 
      End Sub 
      Private Sub cmdUpdate_Click() 
      Cells(currentrow - 1, 1).Resize(1, 4).Value =
Array(TB1.Text,     startdate.Text, enddate.Text, ComboB.Text)
      End Sub 
What can i do about that update i added textboxes to make it simple that date
controls but still its same Answer
Try this instead - there is no need to assign variables for the scope of this sub
and you can do the whole thing with a single line of code:
Private Sub cmdUpdate_Click()
Cells(currentrow - 1, 1).Resize(1, 4).Value = Array(TB1.Text, startdate.Text,
enddate.Text, ComboB.Text) End Sub

To get the right row rather than the last row:
You need to exit your loop when the condition has been found, so that
currentrow retains the correct value. In both of your find subs, exit the loop at
the end of your If block:
'// existing code here
Exit For '<~~ add this in both subs.
End If
Once you have done that, change currentrow - 1 back to currentrow to make
sure it's the right row.
Answer
Try this sub
Private Sub cmdUpdate_Click()
Dim evtname As String, sname As String, sdate As String, edate As String
evtname = TB1.Text
Cells(currentrow - 1, 1).Value = evtname sname = ComboB.Text
Cells(currentrow - 1, 4).Value = sname sdate = startdate.Text
Cells(currentrow - 1, 2).Value = sdate edate = enddate.Text
Cells(currentrow - 1, 3).Value = edate End Sub
Topic 113
Subject
How to instruct LoadFromText() to evaluate formulas?
Question
I'm loading CSV data into Excel using EPPlus:
var csvFormat = new ExcelTextFormat() { Delimiter = ',', TextQualifier = '"',
Culture = CultureInfo.CurrentCulture };
sheet.Cells["A3"].LoadFromText(csvData, csvFormat,
OfficeOpenXml.Table.TableStyles.Medium2, FirstRowIsHeader: true);
My csvData looks like this:

"A","B",TRUE,"=SomeExcelFormula"
"C","D",FALSE,"=SomeOtherExcelFormula"
After saving the package with EPPlus and opening the resulting document in
Microsoft Excel neither the boolean values nor the formulas are evaluated
automatically. I have to manually press F2, ENTER to evaluate the cell. This is
unacceptable as I have a report with more than 80K lines.
How to instruct EPPlus to do this evaluation automatically? Neither specifying
data type Number in ExcelTextFormat's DataTypes property nor calling
sheet.Calculate() did the job.
Please help :-)
Topic 114
Subject
SUM incidence matrix - multiply by occurrence
Question
I have an incidence matrix of values like this:
Col A: values to be count
Col B:C: occurences of values
Cells B1,C1: SUM values in Col A if it's 1 in Col B
(=SUMIF(B$2:B$5;">=1";$A$2:$A$5))
But how to SUM it if I need to use occurence number (1) also as multiplier,
like this:
i.e. 15+24+31+12=18 and 15+51=10
Answer
If I understood correctly your question : B1:
=SUMPRODUCT($A$2:$A$5;B2:B5)
Depending on your regional settings you might need to change the ; into ,
Topic 115
Subject

Show “Save As” dialogbox in Mac excel 2011 using vba
Question
How to show save as dialog box with xlsm as default save as file type in mac
excel 2011?
Application.FileDialog(msoFileDialogSaveAs)
works fine in windows. But it throws error in Mac
Thanks in Advance!!!
Answer
There are some features that do not work on MacOS, try this as an alternative:
Dim saveName As Variant
saveName = Application.GetSaveAsFileName()
If Not saveName = False Then
ActiveWorkbook.SaveAs CStr(saveName) Else
MsgBox "File not saved!"
End If
Topic 116
Subject
Cross Browser compatibility of Office Add-In catalog hosted on Sharepoint
online
Question
I have the following scenario:
We have developed an Excel Task-pane Add-In for our users. To make this
Add-In available to our Users in both Excel 2016 and Excel Online, we
followed the instructions on Publishing the Addin via Sharepoint Online.
So far so good. After some initial issues with configuring the Permissions on

the Sharepoint catalog, all Users were able to access the Add-In in Excel
Online somehow.
The issue here is the "somehow" part. Depending on client, trying to access the
add-in catalog worked in some browsers, but not in others.
One user could use the add-in when running Excel Online in Chrome (40) or
IE11, but not in Firefox(43) where Excel claimed It "cannot connect to
catalog".
Yet another User could insert the Task pane in Chrome(40), but not in IE11.
(we didnt try in firefox there, but we could successfully run Excel Online
including the Add-In on other machines using the same version of Firefox)
What's the deal? Is it some configuration issue? What configuration?
Sharepoint? Client? Something with the Manifest?
Any help would be appreciated! The docs are somewhat vague on all of this (I
guess everything office online related just works for everyone else?)
Topic 117
Subject
Excel VBA - Calling Stored Procedure Timeout after x executions
Question
Can someone explain me this behaviour?
We are executing a stored procedure calling it from Excel VBA and placing the
results in a pivot table. We use this code:
Set cnn = New ADODB.Connection
Set rst = New ADODB.Recordset
Set cmd = New ADODB.Command
connectionstring = "Provider=SQLOLEDB.1;Password=***;User
ID=***;Initial Catalog=***;Data Source=***" cnn.Open connectionstring
With cmd

.ActiveConnection = cnn
.CommandType = adCmdText
.commandText = "EXEC spTest '" xxx "', '" & xxx "';" End With
Set rst = cmd.Execute
The stored procedure: contains 200 lines of code that executes in 1 sec with
the correct result.
The problem occurs after x time of successfull executions that we get a timeout
error. The only way I can slove this problem, is to comment out 75% of the
stored procedure and execute it again from Excel. Next we comment out 50%
of the stored procedure and execute it again. Next 25% and the last run we
execute the full stored procedure again and now there is no more timeout error
coming out.
When I call it now it returns the results in about 3 seconds in a pivot table in
Excel. This is not the first time I ran into this problem.
Does anyone else ever had this issue? What can I do about it? What causes this
behaviour?
Thx!
Answer
This usually happens when you have quires which take more than 30 secs, that
is the default timeout for the command.
try changing this
With cmd
.ActiveConnection = cnn
.CommandType = adCmdText
.commandText = "EXEC spTest '" xxx "', '" & xxx "';" End With
to
With cmd

.ActiveConnection = cnn
.CommandTimeout = 1200
.CommandType = adCmdText
.commandText = "EXEC spTest '" xxx "', '" & xxx "';" End With
this will set your timeout to 1200 seconds , This should hopefully solve it.
Topic 118
Subject
Prevent workbook deactivate during ribbon invalidate in Excel
Question
Ribbon calls macros that are available to a specific workbook. If you activate
a different workbook while ribbon invalidate takes place, these macros are no
more available so i get the expected "can not find macros" errors.
Is there anyway to resolve this?
Maybe prevent user to activate another workbook while ribbon invalidates? Is
there any way to cancel deactivate of a workbook?
Topic 119
Subject
SEMANTICKEYPHRASETABLE did not work with Excel
Question
I created a table and followed all the steps shown in this link. But it seems that
it did not work with excel files. Do not know why or any document explain
why?
Topic 120
Subject
VBA Excel Look up sheet name, IF tab has 'started' then loop through these
sheets
Question
I have a function in my VBA script that currently loops through all numerical
sheet names and performs a function. 001, 002, 003 etc.

I'm hoping to refine this so that only sheet names that are marked as 'started' are
looked at. I have a sheet called 'Initiative Index' in the same workbook which
lists the sheet numbers (with hyperlinks, hope this doesn't cause an issue) in
column 1 (A), in the same table there is a 'status'column 5 (E) which for each
sheet contains 'started', 'idea', 'hold'.
The VBA script then goes on to copy and paste certain bits on info from the
relevant tabs in to a new sheet called actions summary.
I'm hoping to simply replace the below section of code to do this. Any ideas?
'Loop through all sheets in the workbook For Each ws In wb.Sheets
'Only look for worksheets whose names are numbers (e.g. "001", "002", etc) If
IsNumeric(ws.Name) Then
UPDATE: For context, full code here:
Sub UpDate_List_v2()
Dim wb As Workbook
Dim ws As Worksheet
Dim wsSum As Worksheet
Dim rLastCell As Range
Dim lCalc As XlCalculation
Dim bHasHeaders As Boolean
'Turn off calculation, events, and screenupdating 'This allows the code to run
faster and prevents "screen flickering" With Application 
      lCalc = .Calculation 
      .Calculation = xlCalculationManual 
      .EnableEvents = False 
      .ScreenUpdating = False 
End With
Set wb = ActiveWorkbook

'Check if Actions Summary sheet exists already or not On Error Resume Next
Set wsSum = wb.Sheets("Actions summary") On Error GoTo 0
If wsSum Is Nothing Then 
      'Does not exist, create it 
      Set wsSum = wb.Sheets.Add(Before:=wb.Sheets(1)) 
      wsSum.Name = "Actions summary" 
      bHasHeaders = False 
  Else 
      'Already exists, clear previous data 
      wsSum.UsedRange.Offset(1).Clear 
      bHasHeaders = True 
End If
'Loop through all sheets in the workbook For Each ws In wb.Sheets
'Only look for worksheets whose names are numbers (e.g. "001", "002", etc) '-
----------------------------------
If IsNumeric(ws.Name) Then 
              l = ActiveSheet.Cells(ActiveSheet.Rows.Count,
"A").End(xlUp).Row 
              For i = 1 To l 
                  If ActiveWorkbook.Worksheets("Initiative
Index").Range("A" & i).Value = ws.Name And
ActiveWorkbook.Worksheets("Initiative Index").Range("E" &
i).Value <> "Started" Then Exit If 
  '-------------------------------------- 
          'Check if the "Actions Summary" sheet already has
headers 
          If bHasHeaders = False Then 
              'Does not have headers yet 
              With ws.Range("A8:M8") 
                  'Check if this sheet has headers in A8:G8 
                  If WorksheetFunction.CountBlank(.Cells) = 0
Then 
                      'This sheet does have headers, copy
them over 
                      .Copy wsSum.Range("A1") 
                      bHasHeaders = True 
                  End If 

              End With 
          End If 
          'Find the last row of the sheet 
          Set rLastCell = ws.Cells.Find("*", ws.Range("A1"),
SearchDirection:=xlPrevious) 
          If Not rLastCell Is Nothing Then 
              'Check if the last row is greater than the
header row 
              If rLastCell.Row > 8 Then 
                  'Last row is greater than the header row so
there is data 
                                  'Check if the "Actions
Summary" sheet has enough rows to hold the data 
                                  If
wsSum.Cells(wsSum.Rows.Count, "A").End(xlUp).Row +
rLastCell.Row - 8 > wsSum.Rows.Count Then 
                                      'Not enough rows,
return error and exit the subroutine 
                                      MsgBox "There are not
enough rows in the summary worksheet to place the data.", ,
"Data Overflow" 
                                      Exit Sub 
                                  Else 
                      'Does have enough rows, copy the data -
Values 
                      ws.Range("A9:M" & rLastCell.Row).Copy 
                      With wsSum.Cells(wsSum.Rows.Count,
"A").End(xlUp).Offset(1) 
                          .PasteSpecial xlPasteValues 
                          .PasteSpecial xlPasteFormats 
                      End With 
                  End If 
              End If 
          End If 
         Next   'here 
      End If 
Next ws 
      'Sheets("Actions
summary").Columns("H:L").EntireColumn.Delete       'Delete
unwanted columns 
      'Sheets("Actions summary").Columns("H:L").Hidden = True
            'Hide unwanted columns 
      Worksheets("Actions summary").Columns("H").Hidden =

True 
      Worksheets("Actions summary").Columns("J").Hidden =
True 
      Worksheets("Actions summary").Columns("L").Hidden =
True 
      Sheets("Actions summary").Columns("H").Style =
"currency"           'Set to £ 
  Application.CutCopyMode = False                        
'Remove the cut/copy border 
'wsSum.Range("A1").CurrentRegion.EntireColumn.AutoFit 'Autofit columns
on the "Actions Summary" sheet
'Turn calculation, events, and screenupdating back on With Application 
      '.Calculation = lCalc 
      Application.Calculation = xlCalculationAutomatic 
      .EnableEvents = True 
      .ScreenUpdating = True 
End With
End Sub
Answer
If IsNumeric(ws.Name) Then
l = ActiveSheet.Cells(ActiveSheet.Rows.Count, "A").End(xlUp).Row For i =
1 To l 
      If ActiveWorkbook.Worksheets("Initiative
Index").Range("A" & i).Value = ws.Name And
ActiveWorkbook.Worksheets("Initiative Index").Range("E" &
i).Value = "Started" Then 
          'run code 
      Else 
          Exit If 
      End If 
Next

End If
Perhaps this could help you. The code first checks if the value you assigned
(001) is in the list specified in Initiative Index. It also checks if the value in
column E is equal to Started. If so, you'll be able to run your desired code. If
not, you can quit the If-statement and don't run the code.
Update 1:
You may also try something like the code below, this way you have to replace
the code you suggested by everything between the -----, the next you'll have to
place here: 
        End If 
      Next   'here 
End If
Next ws
The code:
'----------------------------------- If IsNumeric(ws.Name) Then 
              l = ActiveSheet.Cells(ActiveSheet.Rows.Count,
"A").End(xlUp).Row 
              For i = 1 To l 
                  If ActiveWorkbook.Worksheets("Initiative
Index").Range("A" & i).Value = ws.Name And
ActiveWorkbook.Worksheets("Initiative Index").Range("E" &
i).Value <> "Started" Then Exit If 
  '-------------------------------------- 
              Next 
   End If 
Topic 121
Subject
Excel Complex Conditional
Question
Ok so I did this in LibreOffice but now I have to duplicate it to excel for my

Pay Roll department since they use excel. So I am having to figure out how to
convert the formulas to Excel. This is only 1 of two totaling formulas that did
not convert when I saved it as Excel format. I have the following sheet called
DailyReport
I am currently calculating Column M with =SUMPRODUCT(A2:A200=A2,
G2:G200)
Then on a secondary sheet I have the following second sheet WeeklyReport
Now what I want to do is if WeeklyReport Column A2 == DailyReport
Column A then take the date in DailyReport Column B and test it to fall in the
date range in WeeklyReport Column B and Column C with
=IF(AND(DailyReport.B2>=B2,DailyReport.B2<=C2),1, 0) and if that is true
add the Total Daily Hours to the total in WeeklyReports Column D from
DailyReports Column M
I hope this is clear enough if not please let me know what else I can do to make
my question more clear.
Thanks in advance!
Answer
So, to me it sounds like:
You want a sum of all hours, for a specific employee (defined by the A column
value weekly report), in between the dates specified (also defined by weekly
report, b & c column) - and you want the end result to be in WeeklyReport
column D and all of it to relate to the same row as the result?
sumproduct will do the trick. I am renaming your sheets to DR and WR for my
sanity's sake.
=sumproduct((DR!G$2:G$200)*(DR!A$2:A$200=A2)*
(DR!B$2:B$200>=B2)*(DR!B$2:B$200<C2))
Now, if you want a new daily report sheet every day it gets a bit trickier to do
with formulas alone, you should then have a macro to store the "current" value

and add the "new" value, or for simplicity's sake create more columns (one for
each working day) and duplicate the formula to all daily columns, or have as
many named dailyreports as there are working days in a week and increase the
formula to check multiple sheets. I would add columns - least amount of work
and the dumbest solution often proves the most resilient.
Did that help in any way?
Topic 122
Subject
VBA Checkbox Additional code
Question
I was wandering, if it was possible to add another event to a checkbox in VBA
Excel. I create a checkbox like this:
ActiveSheet.CheckBoxes.Add(.Left, .Top,.Width, .Height).Select With
Selection
.Caption = ""
.LinkedCell = "AN2"
.Value = xlOn
End With
I was wondering if I could add code to it, so that whenever someone checks it,
some cell would get the current date like:
Cells(1,"A").Now()
Cheers!
Answer
As @Rory mentioned, the answear was :
add ".OnAction = "Name of macro" and then you can write a macro that
coresponds to the click:
With Selection

.Caption = ""
.LinkedCell = "AN2"
.Value = xlOff
.OnAction = "DateClicked"
End With
Function DateClicked()
If Cells(2,"AN") = "TRUE" Then
Cells(2,"A") = Now()
Else
Cells(2,"A") = ""
End If
End Function
Topic 123
Subject
how to convert .txt into .xls in python?
Question
with open(output_filename, 'w') as f_output:
for dirpath, dirnames, filenames in os.walk(directory): 
      for filename in filenames: 
           if filename.startswith('VCALogParser_output'): 
              cur_file = os.path.join(dirpath, filename) 
              with open(cur_file, "r") as f_input: 
                  f_input.seek(0, os.SEEK_END) 
                  backup = min(back_up , f_input.tell()) 
                  f_input.seek(-backup, os.SEEK_END) 
                  last_lines = ''.join(f_input.readlines()
[-6:]) 
                  try: 
                      summary = ', '.join(re.search(r'(\d+
warning\(s\)).?(\d+ error\(s\)).?(\d+ scenarios\(s\) FAILED)',
last_lines, re.S).groups()) 
                  except AttributeError: 
                      summary = "VCA DID NOT START" 
                  f_output.write('{}: {}\n'.format(filename,

summary)) 
The above code is parsing through a file and reading some data from the file
and putting that as an output in the form of .txt. but I want to ouput that as a .xls.
Can anyone tell me how to convert the below .txt to .xls?
output in .txt form :
VCALogParser_output_ARW.log: 12 warning(s), 85 error(s), 32 scenarios(s)
FAILED VCALogParser_output_CZC.log:18 warning(s), 33 error(s), 14
scenarios(s) FAILED VCALogParser_output_DUN.log:VCA DID NOT
START VCALogParser_output_FRC.log:12 warning(s), 34 error(s), 12
scenarios(s) FAILED VCALogParser_output_GED.log:39 warning(s), 79
error(s), 27 scenarios(s) FAILED VCALogParser_output_MNT.log:41
warning(s), 76 error(s), 33 scenarios(s) FAILED
VCALogParser_output_NON.log:25 warning(s), 50 error(s), 14 scenarios(s)
FAILED VCALogParser_output_PTB.log:VCA DID NOT START
VCALogParser_output_PTP.log:31 warning(s), 35 error(s), 21 scenarios(s)
FAILED VCALogParser_output_SPM.log:58 warning(s), 150 error(s), 57
scenarios(s) FAILED VCALogParser_output_SWS.log:14 warning(s), 23
error(s), 11 scenarios(s) FAILED Answer
try xlutils module
"Utilities for working with Excel files that require both xlrd and xlwt"
Topic 124
Subject
Excel VBA Paste Special values
Question
I need to edit on this below code to copy data to another workbook as value
only
Sub CopyColumnToWorkbook()
Dim sourceColumn As Range, targetColumn As Range
Set sourceColumn = Workbooks("Source.xls").Worksheets(2).Columns("A:E")

Set targetColumn = Workbooks("Target.xls").Worksheets(1).Columns("A")
sourceColumn.Copy Destination:=targetColumn End Sub
Answer
Try this code:
Sub CopyColumnToWorkbook()
Dim sourceColumn As Range, targetColumn As Range 
   Set sourceColumn =
Workbooks("Source.xls").Worksheets(2).Columns("A:E") 
   Set targetColumn =
Workbooks("Target.xls").Worksheets(1).Columns("A") 
   sourceColumn.Copy 
   targetColumn.PasteSpecial xlPasteValues 
   Application.CutCopyMode = False 
End Sub
Topic 125
Subject
How to specify datatype of a column in excel before MySql exports to it?
Question
My apologies if this question may have been asked before but I'm currently
stumped.
I'm running a query in MySql that looks like this:
SELECT 'ClientID', 'ContractID', 'Capital_Opening_Bal', 'Capital_Financed',
'Transaction_Date', 'Cap_Int_Day', 'Cap_Debit_Orders', 'Vat',
'Other_Entries_Capital', 'Adjustments_Capital', 'Capital_Int_For_Month',
'Capital_Closing_Bal', 'Arrear_Opening_Bal', 'Due', 'Receipts', 'Rejections',
'Other_Entries_Arrears', 'Adjustments_Arrear', 'Arrear_Int_For_Month',
'Arrear_Closing_Bal'
UNION

(SELECT ClientID, ContractID, Capital_Opening_Bal, Capital_Financed,
Transaction_Date, Cap_Int_Day, Cap_Debit_Orders, Vat,
Other_Entries_Capital, Adjustments_Capital, Capital_Int_For_Month,
Capital_Closing_Bal, Arrear_Opening_Bal, Due, Receipts, Rejections,
Other_Entries_Arrears, Adjustments_Arrear, Arrear_Int_For_Month,
Arrear_Closing_Bal
FROM sapor.capital_and_arrear_movement
into OUTFILE "C:/IMPORT FILE/TEST.CSV"
FIELDS ENCLOSED BY '"' TERMINATED BY ';' ESCAPED BY '"' LINES
TERMINATED BY '\r\n');
It exports it to the file correctly but one thing is amiss;
My ClientID and ContractID columns in MySql appear as such:
000356 000321 002415 000021
But in Excel they turn out like this:
356 321 2415 21
From my understanding excel is reading them as integers and removing the
"superfluous" 0s even though the columns' datatypes in MySql are
VARCHAR(6).
Is there any way to prevent Excel from changing the datatype/removing the 0s?
Topic 126
Subject
Excel VBA SQL query autofilters
Question
Hi I need to filter out some data inside an Excel sheet using VBA. As there are
no 'DELETE' statement in VBA I need to apply filters to do this. Now I have
something like this:

Private Sub CommandButton2_Click()
Dim LastRow As Long
Dim r As Excel.Range
With ActiveSheet
LastRow = .Range("E" & .Rows.Count).End(xlUp).Row Set r =
.Range(Cells(2, "E"), Cells(LastRow, "E")) End With
With r
.AutoFilter Field:=1, _
Criteria1:=Array("11732013", "SYNBIO", "LSTILLWELL", _ "MICHAEL",
"REED", "SQA109", "10668051", "10629186"), _ Operator:=xlFilterValues
.SpecialCells(xlCellTypeVisible).EntireRow.Delete End With
End Sub
I have several confusions which I cannot solve even I've tried out different
settings. For cells containing a certain string like "SYNBIO", in the filter do I
put "SYNBIO" or " * SYNBIO * " if some cells are like "SYNBIO123"? Also
sometimes (I don't know when) after I define the filter, I click on the button of
the Macro, then it's supposed to clear all rows of which some cells contain the
specified string; but the reality is: I click the button once, it deletes one row of
that type; I click again, it deletes another one. What could be the reason for this
and how can I make this filter more standard? Thank you!
Topic 127
Subject
How to use column letters in VBA
Question
I'm currently struggling with the following problem
I'm trying to implement an input box where a user can input the character of the
column.
After that, i dont know how to convert this into a number to use it in the
Worksheet.Cells Method

For example: The User inputs "B", so the program saves it in a variable named
x and converts it into a number so it can be used as Worksheet.Cells(Row, X)
Is there any method or does someone has an idea how to do this? Answer
Cells() is your friend.
Don't overthink this.
Cells(1, 1) = "jello" ' changes cell A1 Cells(2, "AZ") = "too much jello" '
changes cell AZ2
The second argument of Cells() can be either a number or the alpha column
header.
Answer
B is the second column, so you can use the expression (based on ASCII):
Sub main()
Dim s As String
s = "AB"
example s
End Sub
Sub example(s As String)
Dim colNum As Integer
Dim i As Integer
i = 1: colNum = 0
While (Mid(s, i, 1) <> "") 
      colNum = colNum * 26 + (Asc(UCase(Mid(s, i, 1))) -
Asc("A") + 1) 
      i = i + 1 
Wend

MsgBox colNum
End Sub
Answer
Function getColNum(colLetter As String) As Long
On Error Resume Next 'will return 0 if letter > last col getColNum =
Range(colLetter & "1").Column End Function
Topic 128
Subject
How do I set focus to an element outside the current frame?
Question
I have a simple userform for entering data into a macro:
Everything works fine, except for one thing - I want the commandbuttons at the
bottom to get focus, after the textboxes are populated from a different form
which pops up when either textbox is clicked.
Stepping through the code this does indeed happen, but somehow focus is
returned to the textbox before the code ends.
Googling about a bit, it seems that the issue may be that there is a frame around
the textboxes, but I can't find any way to actually solve the problem.
The code for the two textboxes is next to similar, and looks like this:
Private Sub tbxTil_Enter()
DATA_TO_CALENDAR = Me.tbxTil.Value
DatePickerForm.Show
Me.tbxTil.Value = Format(DATA_FROM_CALENDAR, "dd.mmm. yyyy") If
Me.cmdOk.Enabled Then
Me.cmdOk.SetFocus
Else
Me.cmdAvbryt.SetFocus
End If

End Sub
Assuming the problem is what I believe it is, is there any way to set the focus
to an element outside the frame you are currently in? If not, what is the actual
issue with my code?
Topic 129
Subject
Transferring data into an open workbook from a closed workbook without
having to specify the file path, considering that both are in the same folder
Question
How can I modify the below code to do so? I tried my luck with
ThisWorkbook.Path. New to VB, any help would be much appreciated.
Private Sub CommandButton1_Click()
Dim WB1 As Workbook
Dim WB2 As Workbook
Set WB1 = ActiveWorkbook
Set WB2 = Workbooks.Open("C:\Users\joseph\Desktop\Required Files\Almost
final\ RawData.xlsm")
WB1.Sheets("CR Details").Columns("A:AW").Value =
WB2.Sheets("sheet1").Columns("A:AW").Value
WB2.Close
End Sub
Answer
Try
Set WB2 = Workbooks.Open(WB1.Path & "\RawData.xlsm")
if WB2 is in the same folder as WB1.
If the macro is running from a third (separate) workbook in the same location
as WB2 then:

Set WB2 = Workbooks.Open(ThisWorkbook.Path & "\RawData.xlsm")
Topic 130
Subject
R 3.2.3 : Unable to save workbook using openxlsx package
Question
I'm using openxlsx package to load an existing Excel workbook, then insert an
image to a sheet and then save it using saveWorkbook. Below goes the codes.
However, I'm getting error when I'm trying to save the workbook.
require(openxlsx)
wb <- loadWorkbook(xlsxFile = "WB.xlsx") insertImage(wb, "SOA Progress",
"CMD.jpg") saveWorkbook(wb, file="writewb.xlsx", overwrite = FALSE)
The error is :
Error in sprintf("<Override
PartName=\"/xl/%s\"ContentType=\"application/vnd.openxmlformats-
officedocument.spreadsheetml.comments+xml\"/>", : object 'fn' not found
Any help?
Topic 131
Subject
Concatenate cell data into another data if values matches
Question
I have two columns A and B in same excel sheet. I am trying that if in Column
B two values matches then it should copy related value A in same row.
For e.g
Table 
Column A      Column B 
xyz              1 
abc              1 
pqr              1 
eee              2 

qqq              3 
www              4 
oop              5 
Desierd Output 
column A         Column B 
xyz,abc,pqr         1 
eee                 2 
qqq                 3 
www                 4 
oop                 5 
Answer
You could probably use a User Defined Function (aka UDF) for this. Put this
into a module sheet.
Public Function conditional_concat_strs(rSTRs As Range, rCRITs As Range,
rCRIT As Range, Optional sDELIM As String = ", ")
Dim c As Long, sTMP As String
Set rSTRs = rSTRs.Cells(1, 1).Resize(rCRITs.Rows.Count,
rCRITs.Columns.Count) For c = 1 To rCRITs.Cells.Count 
      If rCRITs(c).Value2 = rCRIT Then 
          sTMP = sTMP & rSTRs(c).Value & sDELIM 
Next c
conditionalconcat_strs = Left(sTMP, Application.Max(Len(sTMP) -
Len(sDELIM), 0)) End Function
Use like any native worksheet function.
     
Answer

You can also use this one:
Public Sub combine()
Dim row, result, lastRow As Integer Dim isExist As Boolean
With Sheets("sheetname") 
      'get the last use row 
      lastRow =
.Range("A1").SpecialCells(xlCellTypeLastCell).row 
      'Loop from row 1 to last row 
      For row = 1 To lastRow Step 1 
          'set the start row for result. 
          result = 1 
          'Reset flag 
          isExist = False 
          'Loop result count column until blank 
          Do While .Range("F" & result) <> "" 
              'check count 
              If .Range("B" & row) = .Range("F" & result)
Then 
                  isExist = True 
                  'If old, combine 
                  .Range("E" & result) = .Range("E" & result)
& "," & .Range("A" & row) 
                  Exit Do 
              End If 
              'increase row 
              result = result + 1 
          Loop 
          'If new, add new record 
          If Not isExist Then 
              .Range("E" & result) = .Range("A" & row) 

              .Range("F" & result) = .Range("B" & row) 
          End If 
      Next row 
End With
End Sub
Here, testing evidence for my code:
I used column A & B as input and column E & F as output.
If there is any problem, let me know.
Answer
There's a formula solution for this as well (with helper columns):
Assuming data is column A:B ...
In C1 write this formula: =IF(A1<>A2,B2,D1&","&B2) In D1 write this
formula: =IF(A2<>A3,A2,"") Filter on column D for blanks and then deleted
the visible cells.
Topic 132
Subject
Change in size in Excel generation
Question
I have created a very large Excel file using poi library in java. When I open the
Excel file and save it without making any changes, the files shrinks to about
half of its original size. I know it may be because:
Excel performs optimizations to reduce file size when possible, but poi does
not. How can I use this compression while creating file using java?
Topic 133
Subject

Excel graph using c#
Question
I have a quick question. I have this c# program that i want to store data into an
excel chart. So far i have managed to store the values into five different
columns. Each column stands for one kind of calculation: time acceleration
velocity force distance (in that order). I want to create an excel time-distance
chart using c#. I have no idea where to start. Here is my excel creator method:
Any help will be greatly appreciated.
Thank you.
public void exportResults() 
      { 
          Excel.Application xlApp = new
Microsoft.Office.Interop.Excel.Application(); 
          if (xlApp == null) 
          { 
              Console.WriteLine("Excel is not properly
installed!!"); 
              return; 
          } 
          Excel.Workbook xlWorkBook; 
          Excel.Worksheet xlWorkSheet; 
          object misValue = System.Reflection.Missing.Value; 
          xlWorkBook = xlApp.Workbooks.Add(misValue); 
          xlWorkSheet =
(Excel.Worksheet)xlWorkBook.Worksheets.get_Item(1); 
          int i; 
          int j; 
          for (j = 0; j < 5; j++) 
          { 
              xlWorkSheet.Cells[1, 1] = "Time"; 
              xlWorkSheet.Cells[1, 2] = "Acceleration"; 
              xlWorkSheet.Cells[1, 3] = "Velocity"; 
              xlWorkSheet.Cells[1, 4] = "Force"; 
              xlWorkSheet.Cells[1, 5] = "Distance"; 
          } 
          // set each cell 
          for(i = 0; i <= 30; i++){ 
              for (j = 0; j < 5; j++) 
              { 

                  xlWorkSheet.Cells[i+2, j+1] = data[i, j]; 
              } 
          } 
          xlWorkBook.SaveAs(/"c:\\csharp-Excel.xls"/
Directory.GetCurrentDirectory(),
Excel.XlFileFormat.xlWorkbookNormal, misValue, misValue,
misValue, misValue, Excel.XlSaveAsAccessMode.xlExclusive,
misValue, misValue, misValue, misValue, misValue); 
          xlWorkBook.Close(true, misValue, misValue); 
          xlApp.Quit(); 
          releaseObject(xlWorkSheet); 
          releaseObject(xlWorkBook); 
          releaseObject(xlApp); 
          Console.WriteLine("Excel file created , you can
find it in the directory you stored it: {0}",
Directory.GetCurrentDirectory()); 
      } 
Answer
Add the following after creating your cells.
// Add a using statement
// using Excel = Microsoft.Office.Interop.Excel; Excel.Range chartRange;
Excel.ChartObjects xlCharts =
(Excel.ChartObjects)xlWorkSheet.ChartObjects(Type.Missing);
Excel.ChartObject myChart = (Excel.ChartObject)xlCharts.Add(10, 80, 300,
250);
Excel.Chart chartPage = myChart.Chart;
chartRange = xlWorkSheet.get_Range("A1", "C12"); // your data grid range
chartPage.SetSourceData(chartRange, misValue); chartPage.ChartType =
Excel.XlChartType.xlConeCol;//xlCylinderCol;//xlLine;//xlColumnClustered;
//export chart as picture file
chartPage.Export(@"H:\img\excel_chart_export.png", "PNG", misValue);

You can change the type of chart at the line stating.
chartPage.ChartType = Excel.XlChartType
Topic 134
Subject
VBA Insert correlating array formula into cell
Question
I have an input page, where the user can determine the number of accounts they
need and which will display on the overview page. There are six different
types of account. I have accomplished this using the Copy property. My code
pastes each of the six types one at a time.
With Sheet4
.Range("B9", .Cells(Rows.Count, "C").End(xlUp)).Copy Sheet7.[A4] End
With
Next, for each row, I need to insert a specified formula for each account. I have
accomplished this as so:
'then count sheet7 col a
qRow = wsA.Cells(Rows.Count, 1).End(xlUp).Row 'paste the formula
Dim q As Long
For q = 2 To qRow
If wsA.Cells(q, 1).Value > 1000 Then
wsA.Cells(q, 5).Value = "=sum(2+1)" End If
Next q
So far, so good. My problem occurs at this juncture, because the following is
the actual formula I need to insert, and it needs to be an ARRAY formula:
=SUM(SUMIFS(B!$D:$D,B!$E:$E,$A5,B!$B:$B,">="&E$2,B!$B:$B,"
<"&F$2)*1,SUMIFS(B!$D:$D,B!$F:$F,$A5,B!$B:$B,">="&E$2,B!$B:$B,"
<"&F$2)*-1)

I tried messing with the .formulaArray property, but I kept getting "Object
Required"
Any thoughts?
I'm open to changing up my code, if anyone has a better idea on how to
accomplish this. Thanks!
UPDATE 10FEB15
Error code is "mismatch" on the commented line:
If wsA.Cells(q, 1).Value > 1000 Then
'wsA.Cells(q, 5).FormulaArray =
"=SUM(SUMIFS(B!$D:$D,B!$E:$E,$A5,B!$B:$B," >= "&E$2,B!$B:$B," <
"&F$2)*1,SUMIFS(B!$D:$D,B!$F:$F,$A5,B!$B:$B," >= "&E$2,B!$B:$B," <
"&F$2)*-1)" End If
SOLUTION
In VBA we mask double quotes by repeating them.
Dim s As String
's = "He said: "This is a quote." But this is not a valid string literal" s = "He
said: ""This is a quote."" This is a valid string literal"
Normally the VBA editor will recognize such invalid string literals. But here I
was confusing it with comparison operators.
For the string literal within the formula, I required double quotations. Full
answer below. Answer
If a string literal is enclosed in double quotes and we need double quotes in the
string literal, then we must mask those double quotes somehow. If we don't, the
unmasked double quote will end the string literal. This is the case with all
programming languages.
In VBA we mask double quotes by repeating them.
Dim s As String

's = "He said: "This is a quote." But this is not a valid string literal" s = "He
said: ""This is a quote."" This is a valid string literal"
Normally the VBA editor will recognize such invalid string literals. But here
you are confusing it with comparison operators.
s = "Sting literal 1" >= "Sting literal 2"
So s will become the string representation of a boolean value FALSE since the
comparison is false.
The following will work:
.FormulaArray =
"=SUM(SUMIFS(B!$D:$D,B!$E:$E,$A5,B!$B:$B,"">=""&E$2,B!$B:$B,""
<""&F$2)*1,SUMIFS(B!$D:$D,B!$F:$F,$A5,B!$B:$B,"">=""&E$2,B!$B:$B,
<""&F$2)*-1)"
Topic 135
Subject
Excel - Count of entries below cumulative threshold without helper column
Question
I have the following little table. I'd like a formula that finds the number of
values where the cumulative total (of column B) is less than some threshold
(tx).
I tried
{=MIN((SUM(OFFSET(B1,0,0,A1:A17))>tx)*A1:A17)-1}
but OFFSET doesn't seem to be arrayable like that. Obviously, this would be
trivial with a helper column, but for certain reasons that is not possible.
So the correct answer here should be 10.
tx = .8
A B

1 0.112106465
2 0.110981698
3 0.091959216
4 0.082163441
5 0.073292066
6 0.072407529
7 0.071646289
8 0.061646797
9 0.06011448
10 0.057566381
11 0.050341978
12 0.048227061
13 0.043207335
14 0.03940462
15 0.012914194
16 0.007603446
17 0.004417003
Answer
You're not really looking for a MIN; rather it should be MAX that follows your
condition.
In E7 as a standard (non-array) formula,
=AGGREGATE(14, 6, ROW(1:17)/(SUBTOTAL(9, OFFSET(B1, 0, 0,
ROW(1:17), 1))<D7), 1)
     
Answer
I prefer the following array formula** due to its non-volatility:
=MATCH(TRUE,MMULT(0+
(ROW(B1:B17)>=TRANSPOSE(ROW(B1:B17))),B1:B17)>=0.8,0)-1
Regards

Answer
The most succinct way to do it I've found is
=SUM(--(SUBTOTAL(9,OFFSET(B1,,,A1:A17))<0.8))
entered as an array formula, or, equivalently,
=SUMPRODUCT(--(SUBTOTAL(9,OFFSET(B1,,,A1:A17))<0.8))
Topic 136
Subject
How to import data into MS excel 2010 from SQL developer (Oracle) using
VBA macro
Question
I want to import data into MS excel 2010 from SQL developer (Oracle) using
VBA macro
I am using below code but not able to connect to SQL devevloper. Getting
error like Provider not found or not installed.
Kindly help.
Sub ImportData()
Sheets("sheet1").Select
With ActiveSheet.ListObjects.Add(SourceType:=0, Source:=
"OLEDB;Provider=MSDAORA.1;User ID=MYUSER;password=
MY_PW;Data Source=sourceName", Destination _
:=Range("$A$1")).QueryTable
.CommandType = xlCmdSql
.CommandText = "Select Main.[ID],Main.[Count1] From Main Where Main.
[Count1] > 25" .RowNumbers = False
.FillAdjacentFormulas = False
.PreserveFormatting = True
.RefreshOnFileOpen = False

.BackgroundQuery = True
.RefreshStyle = xlInsertDeleteCells .SavePassword = False
.SaveData = True
.AdjustColumnWidth = True
.RefreshPeriod = 0
.PreserveColumnInfo = True
.Refresh BackgroundQuery:=False
End With
End Sub
Answer
Can you confirm you can tnsping the database from your machine?
If so can you confirm you can connect to the database and run that query from
sqlplus?
It looks like sqlserver syntax? I'm not entirely sure it would run in Oracle, I
may be wrong it might well.
If all is ok, can you confirm whether you are running 32/64bit oracle?
MSDAORA would probably need to match.
Assuming all above is correct then these links might help.
http://blog.mclaughlinsoftware.com/microsoft-excel/how-to-query-oracle-
from-excel-2007/
https://support.office.com/en-us/article/Connect-to-an-Oracle-database-
Power-Query-d7fbd231-a705-4eb7-83b3-a66bfb678395
Topic 137
Subject
Textbox restriction error Excel VBA
Question
If textbox is empty and i press backspace it crashed and highlighted line is
TB1 = Left(TB1, Len(TB1) - 1)

what can i change to stop that crash
Private Sub TB1_Change()
Dim strStrings As String, LastLetter As String Application.EnableEvents =
False
LastLetter = Right(TB1, 1)
strStrings = ","
If InStr(1, strStrings, LastLetter) > 0 Then
MsgBox LastLetter & " not allowed"
TB1 = Left(TB1, Len(TB1) - 1)
End If
Application.EnableEvents = True
End Sub
It is a textbox where "," is restricted. Answer
Use the following sub.
Private Sub TB1_Change()
On Error GoTo HarunErrHandler
Dim strStrings As String, LastLetter As String
If TB1 = "" Then
Exit Sub
End If
Application.EnableEvents = False 
      LastLetter = Right(TB1, 1) 
      strStrings = "," 
      If Val(InStr(1, strStrings, LastLetter)) > 0 Then 
          MsgBox LastLetter & " not allowed" 
          TB1 = Left(TB1, Len(TB1) - 1) 
      End If 

Application.EnableEvents = True
Exit Sub
HarunErrHandler:
MessageBox = MsgBox("Error Number: " & Err.Number & vbCrLf &
Err.Description, vbCritical, "Error") End Sub
Topic 138
Subject
VBA - Expected identifier or bracketed expression error when using With
command
Question
I am trying to figure out an problem for class where the idea is to "shorten" the
code using the With command. Below is the code I have so far. I am curious
why you cannot use the shtThisSheet variable under the with command when
there is a parenthesis directly after the .
Thanks all!
Option Explicit
Sub Formatting()
Dim shtThisSheet As Worksheet
Set shtThisSheet = ActiveWorkbook.Worksheets("Sheet1").Range
With shtThisSheet
.Font.Bold = True
.Font.Size = 14
.HorizontalAlignment = xlLeft
. ("A3:A6").Font.Bold = True
.("A3:A6").Font.Italic = True
.("A3:A6").Font.ColorIndex = 5
.Range("A3:A6").InsertIndent 1
.Range("B2:D2").Font.Bold = True
.Range("B2:D2").Font.Italic = True
.Range("B2:D2").Font.ColorIndex = 5 .Range("B2:D2").HorizontalAlignment

= xlRight .Range("B3:D6").Font.ColorIndex = 3
.Range("B3:D6").NumberFormat = "$#,##0"
End With
End Sub
Answer
Option Explicit
Sub Formatting()
Dim shtThisSheet As Worksheet
Set shtThisSheet = ActiveWorkbook.Worksheets("Sheet1")
With shtThisSheet
With .Range("A3:A6") 
      .Font.Bold = True 
      .Font.Size = 14 
      .HorizontalAlignment = xlLeft 
      .Font.Bold = True 
      .Font.Italic = True 
      .Font.ColorIndex = 5 
      .Range("A3:A6").InsertIndent 1 
End With
With .Range("B2:D2") 
      .Font.Bold = True 
      .Font.Italic = True 
      .Font.ColorIndex = 5 
      .HorizontalAlignment = xlRight 
End With
With .Range("B3:D6") 
      .Font.ColorIndex = 3 
      .NumberFormat = "$#,##0" 

End With
End With
End Sub
Topic 139
Subject
To insert new row below when data is not matched after data comparison
Question
I am comparing data from pro.xlsx to trialing.xlsm. When the data is not
matched, it will automatically insert a new row below the data in trialing.xlsm
and copy the unmatched data from pro.xlsx to trialing.xlsm as well as written
the word 'New' in column B. Please be aware that the updated data might be in
the middle of somewhere. Therefore, the row of data in trialing.xlsm must be
in the order. For instance, if data is added at row 3 in pro.xlsx, that added data
also needs to be at row 3 in trialing.xlsm. Please see below the data and note
that the first one is the data from pro.xlsx and the second one should be the
result from the code from trialing.xlsm. However, it doesn't work as that way
from the code as shown in the third one.
1)
A B C
a1 1 b1
a7 7 b7
a9 9 b9
a4 4 b4
a10 10 b10
a8 8 b8
a6 6 b6
a2 2 b2
a5 5 b5
a3 3 b3
2)
B C D E

a1 1 b1
a7 7 b7
New a9 9 b9
a4 4 b4
New a10 10 b10
New a8 8 b8
New a6 6 b6
a2 2 b2
a5 5 b5
a3 3 b3
3)
Sub test()
Dim WbB As Workbook
Set WbB = Workbooks.Open(Filename:="C:\Users\kenny\Desktop\pro.xlsx")
Dim SheetA As Worksheet
Dim SheetB As Worksheet
Set SheetA = ThisWorkbook.Sheets("Sheet1") Set SheetB =
WbB.Sheets("Sheet1")
Dim eRowB As Integer
Dim erow As Long
eRowB = SheetB.Range("A" & Rows.Count).End(xlUp).Row Dim j As
Integer, Z, K As Variant
For j = 1 To eRowB 
      Z = Cells(j, 1) & Cells(j, 2) & Cells(j, 3) 
      On Error Resume Next 
      K = Application.WorksheetFunction.VLookup(Z,
SheetA.Range("F:H"), 1, False) 
      erow = SheetA.Range("C" & Rows.Count).End(xlUp).Row + 1
      If Err.Number <> 0 And SheetA.Cells(erow, 1) = "" Then 
      SheetA.Cells(erow, 1).EntireRow.Insert 
      SheetA.Cells(erow, 2).Value = "New" 
      SheetA.Cells(erow, 9).Value = Date 
      SheetA.Cells(erow, 9).NumberFormat = "dd/mm/yyyy" 
      SheetA.Cells(erow, 3) = SheetB.Cells(j, 1) 
      SheetA.Cells(erow, 4) = SheetB.Cells(j, 2) 

      SheetA.Cells(erow, 5) = SheetB.Cells(j, 3) 
End If
Next j
WbB.Close
End Sub
Sub Con()
Dim SheetA As Worksheet
Dim LastRow As Long
Set SheetA = ThisWorkbook.Sheets("Sheet1") Application.ScreenUpdating =
False
LastRow = SheetA.Range("C" & Rows.Count).End(xlUp).Row
SheetA.Range("F1:F" & LastRow).Formula = "=C1&D1&E1"
ActiveSheet.AutoFilterMode = False
Application.ScreenUpdating = True
End Sub
enter image description here
Topic 140
Subject
How to get tag value by tag name using web scraping in Excel sheet?
Question
I do daily analysis of eCommerce sites and I have to copy their prices.
All i wanna do is, i paste the URL of a website into an Excel worksheet and I
get prices from the tag name in the cell. The source of site looks like this:
<table>
<td>
Price
</td>
<td>
:
</td>
<td>

<input name="Price" type="text" value="148.0000" id="uxMSRPPrice1"
style="width: 250px;" /> (In x.xx format)
</td>
</table>
and I want to get price 148.0000 in my worksheet, using tag name="Price"
price is unique tag in source
One more thing, I can only get source from the URL like this including view-
source (I cant share the original client URL so i change it to xyz):
https://www.xyz com/admin/ProductPage.aspx?ProductID=xxx Answer
Public Sub GetValueFromBrowser()
' Keyboard Shortcut: Ctrl+q
Dim ie As Object
Dim url As String
Dim selling As String
Dim cost As String
url = Selection.Value
Set ie = CreateObject("InternetExplorer.Application")
With ie 
    .Visible = 1 
    .navigate url 
     While .Busy Or .readyState <> 4 
       DoEvents 
     Wend 
End With
Dim Doc As HTMLDocument
Set Doc = ie.document
selling = Trim(Doc.getElementsByName("sellingPrice")(0).Value)
ActiveCell.Offset(0, 1).Value = selling cost =
Trim(Doc.getElementsByName("costPrice")(0).Value) ActiveCell.Offset(0,

2).Value = cost ie.Quit
End Sub
Topic 141
Subject
Returning multiple matches with vlookup, offset, match
Question
Hi everyone I have a table of data that contains multiple matches when using
vlookup. I was following a lesson that used a combination of vlookup, offset
and match to return the second match. However, I am stuck in how I should
return the third match.
I know index and match is probably better for this, but I was unable to follow
how those expressions work.
My lookup table has 3 columns of data. The first column is a name that repeats
with different data in columns 2 and 3. I want to lookup by name and return the
content of column 2 and 3.
My expression for the first match is:
Column 2:=VLOOKUP($A3,Sheet1!$J$2:$L$4554,2,FALSE) Column
3:=VLOOKUP($A3,Sheet1!$J$2:$L$4554,3,FALSE)
The expression for the second match is:
Column 2 data:
=VLOOKUP($A3,OFFSET(Sheet1!$J$2,MATCH($A3,Sheet1!$J$2:$J$4554,0
Column 3 data:
=VLOOKUP($A3,OFFSET(Sheet1!$J$2,MATCH($A3,Sheet1!$J$2:$J$4554,0
How can I use a similar formula to offset for the 3rd match and so on? Answer
Array Formula Requires CTRL+Shift+Enter instead of normal enter

=IFERROR(INDEX(Sheet1!$J$2:$L$10,SMALL(IF(Sheet1!$J$2:$J$10=$A$3
MIN(ROW(Sheet1!$J$2:$L$10))+1),ROWS($1:1)),COLUMNS($A:B)),"")
Topic 142
Subject
VBA get html body from webpage after submit button
Question
I'm trying to parse data from a webpage after submitting information in a form.
I'm able to populate the form, submit the information, and navigate to the
results properly. However, once the results are loaded i'm still getting the html
body from the original page I navigated to, not the page of the results when I
use IE.Document.Body.InnerHtml
If I try to refresh or navigate to the results link, the results are cleared because
the URL doesn't contain the information submitted in the form.
I've tried a wait before IE.Document.Body.InnerHtml, but no matter how long I
wait I still get the original page's html body.
Does anyone know of another way to go about doing this?
here is the relevant code sample:
Sub GetSnowLoad()
Dim IE As Object
Dim htmlBody As Variant
Set IE = CreateObject("InternetExplorer.Application")
IE.Top = 0
IE.Left = 0
IE.Width = 800
IE.Height = 600
IE.Visible = True
IE.Navigate ("http://snowload.atcouncil.org/")

Do
DoEvents
If Err.Number <> 0 Then 
      IE.Quit 
      Set IE = Nothing 
End If
Loop Until IE.ReadyState = 4
IE.Document.getElementsByname("coordinate_lat").Item.innertext = Cells(2,
6).Value IE.Document.getElementsByname("coordinate_lon").Item.innertext =
Cells(2, 7).Value
IE.Document.getElementsByname("optionCoordinate").Item.Click
IE.Document.getElementsByname("btn-submit").Item.Click
htmlBody = IE.Document.Body.InnerHtml
End Sub
Another possible option: is there a way to get the visible text from the new
page?
Topic 143
Subject
Copy range values into array without for loop
Question
I would like to copy Range values into an array, and then copy the array into
new range like below.
Sub Macro1()
'
' Macro1 Macro
Dim Arr As Variant
Arr = Range("A1:A3").Value
Range("C1:E1").Value = Arr

End Sub
But, the result is as below.
What's wrong with this code?
Are there any ways to tranfer range values into new range without for loop?
Answer
Use Transpose()
Replace this line
Range("C1:E1").Value = Arr
With
Range("C1:E1").Value = Application.Transpose(Arr)
Topic 144
Subject
html to excel dont work with very many rows
Question
Good day,
I have a functionality on my report that converts html tables into an excel file.
its working fine to tables with 1,500 rows, but with more than it. It doesnt
work. I am currently using a js plugin called table2excel and its not generating
any error as well.. could it be a memory issue or some sort? thanks for the
tips.. I am trying to export a log-table, and naturally it will generate very many
rows as time passes..
code
<div class="box" id="dataTable">
<?php $excel_title = "GENERAL LEDGER"; $col_no = 9; ?> <table
class="table table-bordered report-table" > 

   <thead> 
      <th width="10%"  >Account</th> 
      <th width="4%">Date</th> 
      <th width="5%"   >Trans #</th> 
      <th width="20%" >Description</th> 
      <th width="9%"  class="ar" >Ref #.</th> 
      <th width="9%"  class="ar" >Debit</th> 
      <th width="9%"  class="ar" >Credit</th> 
      <th width="9%"  class="ar">Amount</th> 
      <th width="9%"  class="ar" >Balance</th> 
    </thead> 
    <tbody> 
     <tr> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
     <th>value#</th> 
    </tr> 
    </tbody> 
    </table> 
</div>
$('#table2xcel').click(function(){
$("#dataTable").table2excel({
exclude: ".xpage",
name: "Worksheet Name",
filename: "{{$excel_title}} -" //do not include extension });
});
Answer
<html>
<head>
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script>

$(document).ready(function () { 
      $("#btnExport").click(function (e) { 
          window.open('data:application/vnd.ms-excel,' +
$('#dvData').html()); 
          e.preventDefault(); 
      }); 
});
</script>
</head>
<body>
<input type="button" id="btnExport" value="Export" /> <div id="dvData">
<table> 
      <tr> 
          <th>Column One</th> 
          <th>Column Two</th> 
          <th>Column Three</th> 
      </tr> 
      <tr> 
          <td>row1 Col1</td> 
          <td>row1 Col2</td> 
          <td>row1 Col3</td> 
      </tr> 
      <tr> 
          <td>row2 Col1</td> 
          <td>row2 Col2</td> 
          <td>row2 Col3</td> 
      </tr> 
      <tr> 
          <td>row3 Col1</td> 
          <td>row3 Col2</td> 
          <td><a
href="http://www.jquery2dotnet.com/">http://www.jquery2dotnet.c
          </td> 
      </tr> 
</table>
</div>

</body>
</html>
Topic 145
Subject
Application.Ontime Cancel Fails to Method 'ONTIME' of Object 'Application'
Question
I am completely lost so any help will be greatly appreciated.
I am attempting to cancel 2 scheduled event that are triggered when the
Workbook is opened, and repeated using the Application.Ontime method.
I know that to terminate the OnTime schedule loop, you must provide the exact
time that it is scheduled to run and that having multiple Application.OnTime
tasks requires multiple variables. This is why I have set two Public variables
(Header of the document below Options Explicit):
Dim dTime as Date
Dim dTime2 as Date
The scheduler use these Variables and everything works properly as the code
runs every minute.
dTime's value is set inside the TaskTracker function to be:
dTime = Now() + TimeValue("00:01:00")
Application.OnTime dTime, "TaskTracker", , True
dTime2's value is set inside the Autoclear function to be:
dTime2 = Now() + TimeValue("00:01:00")
Application.OnTime dTime, "AutoClear", , True
Despite all this, I get a Method 'ONTIME' of Object'Application' error
message when attempting to run the function at the end of the module:
Function AutoDeactivate()
Application.OnTime EarliestTime:=dTime, Procedure:="TaskTracker", _

Schedule:=False
Application.OnTime EarliestTime:=dTime2, Procedure:="AutoClear", _
Schedule:=False
End Function
This is where I absolutely do not get what is going wrong. Triggering the
Debug brings me to the OnTime section of each procedure cancel attempt.
Below is the script that contains these elements. Hopefully this will give you
guys some insight as to why these event can't be canceled. Please bare with me
for this script is lengthy :P
Option Explicit
Dim dTime As Date
Dim dTime2 As Date
'------------------------------------------------------------ 'This is what checks
cells to define if an email notification has to be sent, and what the content of
that email should be. '------------------------------------------------------------
Function TaskTracker()
Dim FormulaCell As Range
Dim FormulaRange As Range 
Dim NotSentMsg      As String 
Dim MyMsg           As String 
Dim SentMsg         As String 
Dim SendTo          As String 
Dim CCTo            As String 
Dim BCCTo           As String 
Dim MyLimit         As Double 
Dim MyLimit2        As Double 
dTime = Now() + TimeValue("00:01:00")
NotSentMsg = "Not Sent"
SentMsg = "Sent"
SendTo = ThisWorkbook.Worksheets("Tasks").Range("D2") CCTo =
ThisWorkbook.Worksheets("Tasks").Range("E2") BCCTo =
ThisWorkbook.Worksheets("Tasks").Range("F2")

MyLimit = Date
MyLimit2 = ((Round(Now * 1440, 0) - 30) / 1440)
Set FormulaRange = ThisWorkbook.Worksheets("Tasks").Range("F5:F35") On
Error GoTo EndMacro:
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If DateValue(CDate(.Value)) = MyLimit Then 
              MyMsg = SentMsg 
              If .Offset(0, 1).Value = NotSentMsg Then 
                  strTO = SendTo 
                  strCC = CCTo 
                  strBCC = BCCTo 
                  strSub = "[Task Manager] Reminder that you
need to: " & Cells(FormulaCell.Row, "B").Value 
              If Cells(FormulaCell.Row, "C").Value = "" Then 
                      strBody = "Greetings, " & vbNewLine &
vbNewLine & _ 
                      "Your task : " & Cells(FormulaCell.Row,
"B").Value & " is nearing its Due Date: " &
Cells(FormulaCell.Row, "F").Value & "." & vbNewLine & "A wise
decision would be to complete this task before it expires!" &
_ 
                      vbNewLine & vbNewLine & "Truly yours,"
& vbNewLine & "Task Manager" 
              Else 
                      strBody = "Hello, " & vbNewLine &
vbNewLine & _ 
                      "Your task : " & Cells(FormulaCell.Row,
"B").Value & " with the mention: " & Cells(FormulaCell.Row,
"C").Value & " is nearing its Due Date: " &
Cells(FormulaCell.Row, "F").Value & "." & vbNewLine & "A wise
decision would be to complete this task before it expires!" &
_ 
                      vbNewLine & vbNewLine & "Truly yours,"
& vbNewLine & "Task Manager" 
              End If 
      If sendMail(strTO, strSub, strBody, strCC) = True Then
MyMsg = SentMsg 
      End If 
          Else 
          MyMsg = NotSentMsg 

          End If 
          If .Value = MyLimit2 Then 
          MyMsg = NotSentMsg 
      End If 
          Application.EnableEvents = False 
          .Offset(0, 1).Value = MyMsg 
          Application.EnableEvents = True 
End With
Next FormulaCell
ExitMacro
Exit Function
EndMacro
Application.EnableEvents = True
MsgBox "Some Error occurred." _ 
   & vbLf & Err.Number _ 
   & vbLf & Err.Description 
Application.OnTime dTime, "TaskTracker", , True
End Function
'------------------------------------------------------------ 'This is the function that
clears the rows of Completed Tasks '-----------------------------------------------
------------- Function AutoClear()
Dim i As Integer
dTime2 = Now() + TimeValue("00:01:00")
With Tasks
For i = 5 To 35 
       If .Cells(i, 4).Value Like "Done" And .Cells(i,
5).Value = "1" Then 

          .Cells(i, 1).ClearContents 
          .Cells(i, 2).ClearContents 
          .Cells(i, 3).ClearContents 
          .Cells(i, 5).ClearContents 
          .Cells(i, 6).ClearContents 
          .Cells(i, 4).Value = "Pending" 
          .Cells(i, 7).Value = "Not Sent" 
      End If 
Next i
End With
Tasks.AutoFilter.ApplyFilter
Application.OnTime dTime2, "AutoClear", , True
End Function
'------------------------------------------------------------ 'ThisWorkbook calls
this to deactivate the Application.OnTime. This "should" prevent the Excel
process from reoppening the worksheets. '-----------------------------------------
-------------------
Function AutoDeactivate()
On Error Resume Next
Application.OnTime EarliestTime:=dTime, Procedure:="TaskTracker", _
Schedule:=False
Application.OnTime EarliestTime:=dTime2, Procedure:="AutoClear", _
Schedule:=False
End Function
Answer
It looks like it was a setup mistake!
Option Explicit
Dim dTime As Date
Dim dTime2 As Date

Application.OnTime dTime, "TaskTracker", , True Application.OnTime
dTime2, "AutoClear", , True
With the AutoDeactivation function called when the workbook closes does
work as intended!
Function AutoDeactivate()
On Error Resume Next
Application.OnTime EarliestTime:=dTime, Procedure:="TaskTracker", _
Schedule:=False
Application.OnTime EarliestTime:=dTime2, Procedure:="AutoClear", _
Schedule:=False
End Function
Workbook BeforeClose
Private Sub Workbook_BeforeClose(Cancel As Boolean) Call AutoDeactivate
End Sub
What was happening is pretty idiotic. I had an issue with canceling the event at
Work, so I took the Excel Sheet home and coded the fix found above. Yet, it
still didn't work. Not because there was a mistake in it, but because I didn't
have Outlook at home! :P
Not having the Outlook application prevented the event from being rescheduled
after running once (resulting in an auto-dismissed ActiveX error message).
So as soon as I took this script back to work (where Outlook is installed) and
everything worked properly :)
Marking this as resolved by myself haha.
Topic 146
Subject
relative paths ms word and excel
Question
at my work, we deal with a large number or projects that we have created a

"Template" folder layout with all the documents etc in the desired sub folders.
In most of these documents we have to enter in the same information about the
project, such as project name, number etc. this just adds time to completing
these documents and I am trying to find a way to speed things up. What I want
to do is to have a single excel file that I can populate all the generic
information in, then update all the word docs and excel docs that are in the
template folder so they just read the information from the link.
I can get this to work by copying and pasting the link to the word doc or excel
file, but this copies the absolute path, meaning when I copy the template folder
to make a new folder for a new project, that the link is still pointing to the one
in the template folder. oh, the other thing is that these folders will be on a
server with multiple people accessing them, but only one person would be
creating the project folder from the template folder. is there anyway that I can
make the path look to the parent directory that will allow me to copy and
folder and bring the links up. our template folder is fairly complex and I cant
really changes this. but bellow is an idea of how I want it to be set up.
"info.xlsx" would be the workbook where I want to edit and link all the other
files to.
Project x
.Info.xlsx
.Documents
..Saftey
..."SWMS.xlsx"
..Reports
...Compliance
...."Form21.docx"
..Purchasing
..."PO-1092.xlsx"
Answer
In a excel you can use this formula to get the directory path where the
workbook is saved.
=LEFT(CELL("filename",A1),FIND("[",CELL("filename",A1),1)-1)
This one will give you 1 directory up from the parent. Changing the -1- to -2-

will give you 2 levels up and so forth.
=MID(CELL("filename",A1),1,SEARCH("^^",SUBSTITUTE(CELL("filename"
LEN(SUBSTITUTE(CELL("filename",A1),"\","")))))
Topic 147
Subject
How to format data copied from the Web and pasted into an Excel sheet
without altering the string itself?
Question
Let us say I need to copy a list of names from a webpage. Since I don't want to
retain the formatting that is there in the webpage, I currently use Paste
Special→"Match Destination format". This is simple and clean.
But Excel also removes any extra spaces present within the string. e.g. ABC
DEF will become ABC DEF.
This is also true for leading and trailing spaces. I believe this is the TRIM
function at work which is part of the default settings.
What can I do to apply new formatting without applying the TRIM function?
(Other than pasting with source formatting and changing the format manually?)
I think the question can be extended to other parts of the default settings. e.g.
the default number formatting in Excel may not be what you want. I looked at
the settings under Excel→Options but could not find the settings that specified
number/text formatting. Answer
Try to set that column formatting as Text (Manually) and performing Paste
Special Values will consider the value as Text without changing anything in the
pasted data.
Topic 148
Subject
What are possible suffixes after variable name in VBA?
Question
As I've already figured out, there is at least six of them:

Topic 149
Subject
Excel VBA error 400
Question
I am attempting to post a string from a Excel cell into an input box on a web
page. I am able to post text, but not the value of the Excel cell, it keeps
returning a 400 error.
'----------------------------------------- Dim xPOSST As String
doc.getElementById("inputMessage").Focus
Application.SendKeys "{UP}", True '## send the "Enter" keystroke
'TEST VALUE ONE - WORKS
doc.getElementById("inputMessage").Value = "This is the TEST text copy"
'this works
'TEST VALUE TWO - FAILS RETURNS 400 ERROR
'xPOSST = ActiveSheet.Cells(x, 7).Value
'doc.getElementById("inputMessage").Value = xPOSST ' this does not work
and returns 400 error
'-----------------------------------------
Topic 150
Subject
Excel - Highlighting Identical Rows
Question
So I have an excel sheet with Five columns. One is an item identification, the
others are prices for each buyer. Each column gives a price for an item on a
row. The prices are mostly identical across all columns, but some columns are
missing a price, or the price is slightly different.

What I want to do is highlight those cells in a row that contain the same price.
Any tips or pointers to a similar question would be appreciated.
EDIT: Solved, I highlighted all four columns and used the Duplicate values
under conditional formatting.
Topic 151
Subject
macro creates graph but doesn't display until manually select data
Question
I have a macro in excel that creates a graph from the data is the first worksheet.
The issue is that the graph is blank until i right click, select data, press ok. I
don't have to actually select the data the values are already populated. Once I
do this the graph looks fine. How do I get the graph to show the values without
having to manually do this?
ActiveSheet.Shapes.AddChart2(240, xlXYScatterLinesNoMarkers).Select
ActiveChart.SeriesCollection.NewSeries
ActiveChart.FullSeriesCollection(1).Name = Sheets(1).Range("C1")
ActiveChart.FullSeriesCollection(1).XValues = Sheets(1).Range("AB:AB")
ActiveChart.FullSeriesCollection(1).Values = Sheets(1).Range("C:C")
Answer
Sometimes the Modules in Excel can get corrupted and the code does strange
things.
Copy your code into notepad or notepad++, delete the module, add a new
module, and paste the code back into the module from notepad. see if that
helps. I've had to do that more than once.
Topic 152
Subject
excel vba macro to sharepoint javascript SDK — conversion of
worksheet_calculate method
Question

What up tho.
I have a working Excel sheet with a VBA macro that starts like this:
Private Sub Worksheet_Calculate()
....
End Sub
I'm porting it to the interwebs, where it apparently has a Javascript SDK. The
events that I get to play with include:
addActiveCellChanged
addActiveSelectionChanged
...
This is no good for me, as my action is taking place within slicers in the same
cell. I'd really like to trigger on Worksheet_Calculate, like the VBA macro.
Using the Excel Javascript SDK, how do I trigger on the event of any
worksheet calculation to perform an action, the way that the VBA macro does?
Thx bruh <3.
Topic 153
Subject
Use Perl to select data from SQL database and place into Excel
Question
I am new to Perl so I'm hoping someone can help me with this I have two Perl
scripts
Connects to my sql2008 database and selects 2 columns from one table as an
array and prints them using foreach. Uses Excel::Writer::XLSX to generate an
Excel file with whatever strings I place in specific rows and columns.
I would like to run script #1 and and have it output into an Excel file. I think I
should just be able to combine these two scripts above but I keep getting
"requires explicit package" errors. (I assume because my variables don't have
my in front of them). I must be way off. Looking for help.

Here is my code that doesn't work:
use strict;
use DBI;
use Excel::Writer::XLSX;
# connect to the db
my $dbh = DBI->connect('dbi:ODBC:dbname', 'dblogin', 'dbpassword');
my $sth1 = $dbh->selectall_arrayref("
select col1, col2 from table");
foreach my $ln (@$sth1)
{ my($col1, $col2) = @$ln; print "$col1 $col2\n";}
my $workbook = Excel::Writer::XLSX->new( 'col1col2test.xlsx' ); my
$worksheet = $workbook->add_worksheet();
$worksheet->write( "A1", "$col1" );
$worksheet->write( "A2", "$col2" );
Answer
The Excel::Writer::XLSX module provides a convenience method called
write_col() for such a scenario as this:
The write_col() method can be used to write a 1D or 2D array of data in one
go. This is useful for converting the results of a database query into an Excel
worksheet. You must pass a reference to the array of data rather than the array
itself. The write() method is then called for each element of the data.
After connecting to the database and initializing your spreadsheet objects, you
can basically reduce the output portion of your code to the following two lines:
my $data = $dbh->selectall_arrayref("select col1, col2 from table");
$worksheet->write_col(0, 0, $data);
Answer

Aside from the other mentions, I realize your query is only intended to return a
single row, but in general if you have multiple rows it's better to iterate the
SQL and then generate the output:
use strict;
use DBI;
use Excel::Writer::XLSX;
# connect to the db
my $dbh = DBI->connect('dbi:ODBC:dbname', 'dblogin', 'dbpassword'); my
$sth1 = $dbh->prepare(q{select col1, col2 from table});
$sth1->execute();
my $workbook = Excel::Writer::XLSX->new( 'col1col2test.xlsx' ); my
$worksheet = $workbook->add_worksheet();
my $col = 0;
while (my ($col1, $col2) = $sth1->fetchrow_array) { $worksheet->write(0,
$col, $col1);
$worksheet->write(1, $col, $col2);
$col++; # maybe you really don't want this... I don't know }
$sth1->finish;
$workbook->close();
As it stands, if your query does return multiple rows, it seems like you will
write the same values over and over to the same cells...
Maybe that's what you wanted, but I thought to mention it.
Answer
Your problem is in variable scope, specifically here
foreach my $ln (@$sth1)

{ my($col1, $col2) = @$ln; print "$col1 $col2\n";}
You're defining col1 and col2 inside the foreach loop, so their scope is only
the loop. Then trying to use them outside, wher they don't exist.
I'd define col1 and col2 up above the foreach, eg
my $col1;
my $col2;
foreach my $ln (@$sth1)
{($col1, $col2) = @$ln; print "$col1 $col2\n";}
A
Topic 154
Subject
Validate if date is in between two dates - Excel
Question
I am trying to pull out a set of data based on a criteria of dates. If the event date
does not fall between the Start and End Date, it should not be pulled into the
results. IF it does fall in between those dates, It would then need to ensure that
the Unique ID matches with the correct program. This would need to pull all
the data associated to those particular events. All Unique ID and Program ID
need to match and be pulled if it is between the Start and End Date.
End result should bunch up to the following Answer
Use following formula to filter data between two date:
=IFERROR(INDEX($B$4:$H$10,SMALL(IF($B$4:$B$10>=$F$13,IF($B$4:
ROW($B$3))),ROWS($B$3:B3)),COLUMNS($B$3:B$3)),"")
As it is a array formula. Press CTRL+SHIFT+ENTER to evaluate the formula.
Put formula in B17 cell (as per example of below screenshot). Then drag and
fill right and down as you need. Make sure you applied date format manually
after filling formulas for date columns.

Topic 155
Subject
VBA to find/replace information from one sheet to another
Question
I am looking for help on writing a VBA that will replace information in one
sheet using a legend that is in another sheet.
I need two things to happen.
1. replace cells in column C in Sheet1 with data from column C in Sheet2 if
column C in Sheet1 = column A in Sheet2. 2. also insert the adjacent cell (Item
Number) that corresponds with the new description.
Here is a simple sample of the spreadsheet.
Sheet 1 BEFORE Code: 
1    A                             B                 C 
2   EQUIPMENT TYPE             ITEM NUMBER      DESCRIPTION 
3   Actives                                        NC400 
4   Full Spectrum EQ- Bank 1                       T2&4 CS12 
5                                                  T2&4 CS09 
6   Full Spectrum EQ - Bank 2                      T8 CS09 
7                                                  T8 CS06 
Sheet 2 (legend) 
1               A                B                  C 
2   Original Description    Item Number     New Description 
3           NC400               5543          Full Features
2x2 
4           T2&4 CS12           5568          Cable Simulator
12db 
5           T2&4 CS09           9956          Cable Simulator
9db 
6           T8 CS09             5547          Return Path 9db 
7           T8 CS06             6689          Return Path 6db 
Sheet 1 AFTER CODE: 
1             A                      B              C 

2   EQUIPMENT TYPE              ITEM NUMBER      DESCRIPTION 
3   Actives                       5543              Full
Features 2x2 
4   Full Spectrum EQ- Bank 1      5568              Cable
Simulator 12db 
5                                 9956              Cable
Simulator 9db 
6   Full Spectrum EQ - Bank 2     5547              Return
Path 9db 
7                                 6689              Return
Path 6db 
I know that I will have to use a series of loops, I would appreciate any help.
Thanks!
Answer
Hey Mate give this a crack:
=INDEX(Sheet2!$B$2:$B$7,MATCH(Sheet1!$C2,Sheet1!C2:C7,0))
Alternative would be a vlookup but index/match is best practice.
Here's a tutorial: LINK
No VBA Necessary...
Topic 156
Subject
excel combo bar chart how to customize label position vba
Question
I have a chart like this. The label is customize data linking to excel cells.I'm
wondering if there's a way to customize the position so it won't overlap each
other but I couldn't find such thing in design view nor could I use callout label
to link to cells.
The labels below are linked to the orange chart and green chart only.When the
data is refreshed, it could look messy.

Im thinking either VBA code or some other method could handle the position?
Topic 157
Subject
Manipulating Excel in Visual Basic
Question
i have a excel file ( csv actually) that I need to delete the first row and then
reformat the first column. I have never worked with excel in Visual basic. Any
help would be appreciated. or at least pointer in the right direction.
Thanks!
Answer
An alternative to deleting a row and reformating it is to use the ClearContent
function.
It is a pretty simple VBA command that looks like this:
Worksheets("Sheet1").Range("A1:G37").ClearContents
' "Sheet1" is the name of your Tab in this scenario
What this does is that it clears the content of A1 to G37 without actually
deleting the cells. This means that Data Validation and Conditional Formatting
rules remain intact.
Let's say you want to clear Row 1 Entirely, you would make the code look
like:
Worksheets("Sheet1").Range("A1:XFD1").ClearContents
'XFD1 in this situation is the last column of an excel sheet. You could just clear
A1:Z1 to clear 26 column worth of text.
I don't know if this is what you are looking for as your request gives very little
information :P Hopefully this will help you out.
If this works out for you, you can attach a trigger to this function. Such as a

Macro button, or a condition. I can walk you through the process if this
solution works for you.
Topic 158
Subject
VBA delete multiple rows by comparing 3 adjacent rows
Question
I am trying to figure out noisy data and delete the whole row of noisy data.
There are 79 rows of data in total and about 6-7 noisy data, the data are all
integers. To define noisy data, I dim 3 variables: row1,row2,row3, and
compare the absolute value of difference between each other, and if
Absolute(row1-row2) and Abslute(row2-row3) are bigger than 5 at the same
time, I will say row2 is a noisy data and delete the whole row. However, I am
having application or object defined error problems. I tried to dim the
variables with integer, variant, long, double. None of them works and it is the
same problem.
Sub project()
Dim a As Long, row1 As Long, row2 As Long, row3 As Long Dim rKill As
Range
a = 2
Do 
      row1 = Cells(a, 2).Value 
      row2 = Cells(a + 1, 2).Value 
      row3 = Cells(a + 2, 2).Value 
      If Abs(row1 - row2) > 5 And Abs(row2 - row3) > 5 Then 
          If rKill Is Nothing Then 
              Set rKill = Cells(a + 1, 2) 
          Else 
              Set rKill = Union(rKill, Cells(a + 1, 2)) 
          End If 
      End If 
      a = a + 1 
Loop Until deltat_value1 = 14700
rKill.EntireRow.Delete
End Sub

The problem is as following:Application-defined or object defined errorand
happens at the line: deltat_value3 = Cells(a + 2, 2).Value Then I am thinking it
may be because I define too many variables. I changed a little bit to:
Sub project()
Dim a As Long, row1 As Long, row2 As Long, row3 As Long Dim rKill As
Range
a = 2
Do 
      row1 = Cells(a, 2).Value 
      row2 = Cells(a + 1, 2).Value 
      If Abs(row1 - row2) > 5 And Abs(row2 - row3) > 5 Then 
          row3 = Cells(a + 2, 2).Value 
          If Abs(row2 - row3) > 5 Then 
          If rKill Is Nothing Then 
              Set rKill = Cells(a + 1, 2) 
          Else 
              Set rKill = Union(rKill, Cells(a + 1, 2)) 
          End If 
      End If 
      End If 
      a = a + 1 
Loop Until deltat_value1 = 14700
rKill.EntireRow.Delete
End Sub
But it still doesn't work, this time the same error shows for the line:
row2 = Cells(a + 1, 2).Value
Answer
Wouldn't something like this do exactly what you want?
Sub delMe()
Dim i As Long, rng As Range
i = 2 'change to the row you want to start While Len(Cells(i + 1, 2).Value)
If Abs(Cells(i - 1, 2).Value - Cells(i, 2).Value) And Abs(Cells(i + 1, 2).Value

- Cells(i, 2).Value) Then If rng Is Nothing Then Set rng = Rows(i) Else Set rng
= Union(rng, Rows(i)) End If
i = i + 1
Wend
rng.Delete
End Sub
Still: I don't know how deltat_value1 will change inside the loop? Wouldn't
run your loop till it hits the end of the sheet?
Topic 159
Subject
Pivot table with 2 different sheets
Question
I have 2 different excel sheets
tab1
A B C D E
1
2
3
and table 2
T U V W X
1
2
3
Let's say in B and U columns we have the same kind of data for instance "name
of owner" and in C and V we have "number of animals owned", in D and W
we have "country of the animal". The oter data are not relevant for my pivot
table but I still want to be able to find them if needed.
I want a single pivot table which uses tab 1 and 2. I want to have D (or W as
they are the same type of data) as filter and to see for every "name of the

owner" the "number of animals owned" according to tab1 in a column and in
another column the "number of animals owned" ccording to tab2.
I tried to use the pivot table helper but I didn't manage to use filters and I could
obtain a pivot table by "name of owner" only if I used the datasets with as a
first column B and U.
Thank you.
Topic 160
Subject
How to check if GetOpenFilename with MultiSelect was canceled?
Question
GetOpenFilename with MultiSelect := True either returns a array of Variant or
Boolean False if the dialog was canceled. How can I make a decent check? If I
check the return value against False, I get a type mismatch error when files are
selected (i.e. the dialog is not canceled) because apparently I cannot check if a
Variant() is False.
I now check for "Boolean" type, which works. But I feel dirty having written
this code. Is there a decent way?
Dim files As Variant
files = Application.GetOpenFilename("Alle-Dateien (*.*),*.*,", , "please
choose files", "open", MultiSelect:=True) If TypeName(files) = "Boolean"
Then
MsgBox "Nothing selected"
Exit Sub
End If
Answer
As mentioned in the comments, I like to use FileDialog(msoFileDialogOpen)
(along with its folder counterpart, msoFileDialogFolderPicker). It behaves
more cleanly than what you are experiencing with GetOpenFileName. I've
sometimes wondered why both dialogs exist:

Private Sub PickSomeFiles()
Dim fdFileDialog As FileDialog
Dim SelectedItemsCount As Long
Dim i As Long
Set fdFileDialog = Application.FileDialog(msoFileDialogOpen) With
fdFileDialog
.Filters.Clear
.Filters.Add "Alle-Dateien (*.*),*.", ".*" .FilterIndex = 1
.InitialView = msoFileDialogViewDetails .Title = "please choose files"
.ButtonName = "open"
.AllowMultiSelect = True
.Show
If .SelectedItems.Count = 0 Then 
      MsgBox "No files selected" 
      Exit Sub 
End If
SelectedItemsCount = .SelectedItems.Count For i = 1 To SelectedItemsCount
MsgBox "You selected: " & .SelectedItems(i) Next i
End With
End Sub
Answer
Can't comment due to low rep but wanted to add that I had the same situation in
a program I wrote and after a fair amount of research at the time I ended up
with essentially the same exact code as you did so at least for your situation it
looks like you have it right.
Topic 161
Subject
Excel VBA Macro: Searching For Blank From Selection
Question

I am trying to search through a selection from a table, find a value and then
return a specific result.
The conditions I am trying are:
IF 'Name' = blank, return "N / A".
IF 'Result' = blank, OR "N/A", return "N / A". IF 'Count' = 0, return "No",
ELSE "Yes".
The code I have tried so far is as follows:
Sub DoStuffIfNotEmpty()
Set M = Selection
If Not IsEmpty(M) Then
MsgBox "I'm not empty!"
Else
MsgBox "Empty Value"
End If
End Sub
Also for reference, here is the test table I have created:
Reference Image
Answer
Test() sets up the worksheet and cells to examine -- if you want to work down
a list of cells you can do it here -- and calls DoStuffIfNotEmpty, which
examines the Name, Result and Count columns in order. Its not even close to
being elegant but there you go...
Sub Test()

Dim cWorksheet As Worksheet
Dim CRange As Range
Set cWorksheet = ActiveWorkbook.Sheets("Sheet1") Set CRange =
cWorksheet.Range("A2:C2") MsgBox DoStuffIfNotEmpty(cWorksheet,
CRange), vbOKOnly End Sub
Function DoStuffIfNotEmpty(CurrWorksheet As Worksheet, CurrRange As
Range) As String
CurrWorksheet.Select
CurrRange.Select
Set m = Selection
If m.Cells(1, 1) = "" Or IsNull(m.Cells(1, 1)) Then
retmsg = "N/A"
Else 
      If m.Cells(1, 2) = "" Or IsNull(m.Cells(1, 2)) Or
m.Cells(1, 2) = "N/A" Then 
          retmsg = "N/A" 
      Else 
          If m.Cells(1, 3) = 0 Then 
              retmsg = "No" 
          Else 
              retmsg = "Yes" 
          End If 
      End If 
End If
DoStuffIfNotEmpty = retmsg
End Function
Topic 162
Subject
Convert datetime string to valid date value and valid time value

Question
This code is returning as an invalid date for conversion:
'Wednesday, September 10, 2014 6:53 AM'
The VBA IsDate function is used to check if an expression is a Date or the
expression can be converted to a valid Date or Time. The function returns true
or false.
How can I get the date to be valid?
'-----------------------------------------
Dim x As Integer
x = ActiveCell.Row
'-----------------------------------------
Dim vDate As Variant
vDate = "Wednesday, September 10, 2014 6:53 AM"
MsgBox vDate
MsgBox IsDate(vDate) 'retuns false
'-----------------------------------------
Dim fDAT As String
fDAT = Left(vDate, Len(vDate) - 7)
MsgBox fDAT
MsgBox IsDate(fDAT) 'retuns false
'-----------------------------------------

''ActiveSheet.Range("a" & x).Value = fDAT Answer
You would change:
fDAT = Left(vDate, Len(vDate) - 7)
To
fDAT = Mid(vDate, InStr(vDate, ",") + 2)
Answer
Get rid of the "Wednesday, " and try something like:
vDate = Format(vDate, "M/D/YYYY H:MM:SS AM/PM") xDate =
IsDate(vDate)
Answer
to get also the correctness you can use something like that:
Sub blabla()
Dim vDate As Variant, xDate As Boolean vDate = "Wednesday, September 10,
2014 6:53 AM" xDate = IsDate(vDate) Or (IsDate(Mid(vDate, InStr(vDate,
",") + 1)) And Left(vDate, InStr(vDate, ",") - 1) = Format(Mid(vDate,
InStr(vDate, ",") + 1), "dddd")) End Sub
this would also be false if it is not the correct weekday ;)
To get a usable value you could use something like:
If Not IsDate(vDate) And IsDate(Mid(vDate, InStr(vDate, ",") + 1)) Then
vDate = Mid(vDate, InStr(vDate, ",") + 1)
Topic 163
Subject
changing first excel worksheet and auto reference graphs
Question

This is what the graphs look like; the slicer is visible on the left and controls
visible data.
I have a table that is used to generate many graphs on a separate worksheet and
I'm using a slicer to filter what data is displayed on the graphs. All of the
graphs are used to analyze every data set. The data sets all have the same
format. Is there a way just to add the new data and have the graphs reference
the first worksheet so that just changing the order updates the graphs?
Or maybe someone knows a better way to do this? I'm able to copy and paste
new data into the first worksheet and the graphs update but the slice is then
removed. Thanks in advance for any help or guidance. Answer
The answer is to use macros!
Start by recording the macro and then modify the script to meet your needs
accordingly. I was able to table the csv, create a new worksheet, and graph all
the data as well as add and resize the slicer. By changing a few variable names
this macro can now be applied to all base worksheets.
Topic 164
Subject
Excel VBA Run-time Error '6' when populating an array
Question
I have resolved this issue. The problem was nothing (directly) to do with the
code. It was to do with the lRow variable. This value was populated by a
formula on my spreadsheet and this was in turn populated by another macro. I
discovered that I had inserted a column and was consequently updating the
wrong column. I changed my code to update a named range rather than an
actual address and the problem disappeared. Still a bit odd that this code was
failing as the values in row 24 appear valid to me.
Thanks for all the input!
Hope someone can help here. I have recently started to get an error when trying
to run my code.
This error arises at this line of code:

NewArr = Sheets("Input Sheet").Range("A" & lRow & ":BJ" & lRow).Value
The variable is declared above as:
Dim NewArr() As Variant
lRow is evaluating as 24 so the idea is that the array called NewArr will be
populated with the values that appear on Input Sheet range A24:BJ24.
I know that the variant data type can handle very large numbers and although
there are some big numbers and text etc in this row, none are over 4 million.
(One is 3380438.98545603). Any ideas as to why I am getting this error?
TIA!
My full code (up to the point where I get the error) is:
Private Sub BT_SUBMIT_Click()
Dim NewArr As Variant
Dim lRow As Long
Dim lCol As Long
Dim PasteRange As Range
Dim bUpdated As Boolean
'Check if the user has ticked the confirm box before writing to the spreadsheet
If Me.XB_CONFIRM.Value = False Then
MsgBox "You must tick the confirm box to indicate you understand that " _ &
"your amendments cannot be undone. Please return to the form, tick the box and
" _ & "resubmit.", vbOKOnly, "Please tick confirmation box" Exit Sub
End If
'Check if the user has selected either yes or no on changes frame If
Me.OB_CHNGS_NO.Value = False And Me.OB_CHNGS_YES.Value = False
Then
MsgBox "You must select either yes or no to indicate if there are changes being
made." _ & " Please correct and resubmit.", vbCritical, "Select Yes or No"

Exit Sub
End If
'Check if the Target Resolution Date is at least today or later and if not 'user
must update
If Sheets("Input
Sheet").Cells(Sheets("Lookups").Range("NEW_IAR_ROW").Value, 38).Value
< Now() And Me.OB_CHNGS_YES.Value = False Then
MsgBox "The Target Resolution Date must be no earlier than today." _ & "
Please correct and resubmit.", vbCritical, "Change Target Resolution Date"
Me.OB_CHNGS_YES.Value = True
Exit Sub
End If
'Check if the values enterered are valid If Me.OB_CHNGS_YES Then
If Control_Error("FR_AMNDMENTS") Then
Exit Sub
End If
If (Len(Me.TB_AMNT_RES.Value) + Len(Me.TB_NO_TRNS_RES.Value) +
Len(Me.TB_CMNT_RES.Value)) > 0 Then 
      bUpdated = True 
      If Control_Error("FR_IAR_RSVD") Then 
          Exit Sub 
      End If 
End If
If (Len(Me.TB_AMNT_WO.Value) + Len(Me.TB_NO_TRNS_WO.Value) +
Len(Me.TB_CMNT_WO.Value)) Then 
      bUpdated = True 
      If Control_Error("FR_IAR_WO") Then 
          Exit Sub 
      End If 

End If
If (Len(Me.TB_AMNT_INC.Value) + Len(Me.TB_NO_TRNS_INC.Value) +
Len(Me.TB_CMNT_INC.Value)) Then 
      bUpdated = True 
      If Control_Error("FR_IAR_INCR") Then 
          Exit Sub 
      End If 
End If
If Not (bUpdated) Then 
      MsgBox "You have not entered any changes for resolved,
write offs or increases.  " _ 
      & "You must update at least one of these sections or
select no changes.", vbCritical, "Error" 
      Exit Sub 
End If
End If
lRow = Sheets("Lookups").Range("NEW_IAR_ROW").Value lCol =
Sheets("Lookups").Range("TOTAL_COLUMNS").Value
'First we load the array with the current values on the sheet. NewArr =
Sheets("Input Sheet").Range("A" & lRow & ":BJ" & lRow).Value
Application.ScreenUpdating = False
'Then there is other code beyond this point End Sub
Topic 165
Subject
Formula to link up Excel Tables with changing Pivot Table
Question
I am wondering whether you can help me here with this pivot data / excel table
question.

Situation: Database analysis of several columns / rows (approx 20000 rows,
30 columns). Only one pivot data sheet that aggregates the complete database.
Objective: Show findings using several excel tables which are all based on
this single pivot data sheet. Problem: It could be that in the future the database
changes its values. Therefore, keeping links between excel tables and the
database (ergo pivot table) is necessary to avoid future manual re-work.
Question: Is there a formula to keep direct links between the excel tables and
the pivot table sheet despite the fact that the aggregation of the pivot table
changes? I know that the "GetPivotData" doesnt help her since it becomes
invalid as soon as the pivot table changes. Does such thing exist? or is the only
solution to create x pivot tables for x excel tables?
I like to thank you already for reading my question and your help!
Best regards,
D
Topic 166
Subject
Load vba to excel module from a url
Question
I would like to know if it's possible to load or link vba code to the module in
excel? ( like in JavaScript src = "script.js")
Thanks
Answer
To call a module:
Sub main()
Call Macro
End Sub
Or you do something like this:
Sub main()

moduleName.subName
End Sub
Topic 167
Subject
Running Excel Macro through Access VBA Runtime Error -2147417851
Question
I created code that will copy the RecordSet to Excel and I want a macro in the
Excel file to run. The code works perfectly until it hits the code to run the
macro. I must not be calling the application correctly but can't figure it out!
Private Sub Command233_Click()
Dim objXLS As Object
Dim wks As Object
Dim rsc As Recordset
Dim idx As Long
Set rsc = Me.RecordsetClone
If Me.RecordsetClone.RecordCount = 0 Then MsgBox ("No Records To
Export")
Else
rsc.MoveLast
rsc.MoveFirst
Set objXLS = CreateObject("Excel.Application") objXLS.Workbooks.Open
FileName:="C:\Comps Macro.xlsm", ReadOnly:=True Set wks =
objXLS.Worksheets(1)
For idx = 0 To rsc.Fields.Count - 1
wks.Cells(1, idx + 1).Value = rsc.Fields(idx).Name Next
wks.Range(wks.Cells(1, 1), wks.Cells(1, rsc.Fields.Count)).Font.Bold = True
wks.Range("A2").CopyFromRecordset rsc, rsc.RecordCount, rsc.Fields.Count
objXLS.Visible = True
objXLS.Run ("Format")
End If
Set objXLS = Nothing
End Sub

The runtime error I am receiving is:
Run-Time Error '-2147417851 (80010105)': Method 'Run' of object
'_Application' failed Answer
You have to reference the Sub or Function correctly. Your Sub named Format is
defined at Workbook- or Sheet- level?
If defined in a Sheet module (for example Sheet1):
objXLS.Run ("Sheet1.Format")
If at Workbook level:
objXLS.Run ("ThisWorkbook.Format")
Hope this helps
Topic 168
Subject
Killing Application.ontime with Workbook_BeforeClose
Question
I looked through every topic I've found in here, but couldn't figure what is
wrong with the below.
I am using Application.OnTime to run a Module every minutes. The problem
is, when I close the worksheet, Excel reopens the sheet the next time the Macro
should run.
I have attempted to use the following fix, to no avail.
Option Explicit
Dim dTime As Date
Public Function AutoRun2()
dTime = Now + TimeValue("00:01:00")
Application.OnTime dTime, "AutoClear"
End Function

Sub StopAutoRun2()
Application.OnTime dTime, "AutoRun2", , False End Sub
and I have the following in ThisWorkbook:
Private Sub Workbook_BeforeClose(Cancel As Boolean) Call StopAutoRun
Call StopAutoRun2
End Sub
What am I doing wrong here?
Answer
Change "AutoRun2" to "AutoClear" in your stop sub as this is the actual macro
that you want to stop being scheduled with the False argument.
Topic 169
Subject
How to find duplicate adjacent cells in Excel
Question
I have 2 columns in Excel (like below) and I would like to identify
(conditionally format) any rows that are exactly the same.
As you can see 326.001 1,000 HOUR are identical for the first 3 rows, I
would like to highlight or mark these rows so I can see that they are not unique.
+---------+------------+
| ID | INTERVAL |
+---------+------------+
| 326.001 | 1,000 HOUR |
| 326.001 | 1,000 HOUR |
| 326.001 | 1,000 HOUR |
| 326.001 | 3,000 HOUR |
| 326.002 | 1 MONTH | 
| 326.002 | 1 YEAR     | 
| 326.002 | 5 YEAR     | 

| 326.002 | 500 HOUR |
| 326.002 | 500 HOUR |
| 326.002 | 500 HOUR |
| 326.002 | 1,000 HOUR |
| 326.002 | 1,000 HOUR |
| 326.002 | 1,000 HOUR |
| 326.002 | 3,000 HOUR |
| 326.009 | 3 MONTH |
| 326.009 | 1 YEAR |
| 326.01 | 3 MONTH |
+---------+------------+
Answer
I would add a third column: EqualityTest, with a formula such as:
=AND([@ID]=A5,[@INTERVAL]=B5)
This assumes the data is sorted.
The above formula is for row 5, with ID and Interval in columns A and B.
Copy-Paste the formula down, and apply conditional formatting to highlight
False for unique values.
Answer
qroberts,
I'm not clear on your question.
If you're actually attempting to remove duplicate rows, Excel offers that as a
function on the basic ribbon bar for the "Data" ribbon: the button (!) is
"Remove Duplicates" in the "Data Tools" section on the "Data" ribbon.
If, instead, you are looking for a highlighter which will identify duplicates,
things are a bit more complicated, as you need a macro which will find
duplicates and then turn on some form of formatting/highlighting (I suggest
formatting a background color).
For a macro which will highlight duplicates, we need to hear a bit more to

understand your needs. If you have two different sets of duplicates, do you
want them highlighted to different colors? If the number of duplicate sets gets
large, this could be a problem.
As another poster has noted, it also matters whether your candidate set is
sorted. A full range search for duplicates would be an interesting bit of coding.
Answer
So use COUNTIFS():
=COUNTIFS($A$2:$A$10000,$A2,$B$2:$B$10000,$B2)>0
It will return true for any that has duplicates in both columns. This formula
does not care if the data is sorted or not.
Topic 170
Subject
Find Lowest Value in CSV File Below A Certain Cell and Output to Excel Cell
Question
I am looking to take data from a CSV file and check for the lowest value under
a certain heading.
I would then like to write that file to an excel file within a certain cell.
As an example:
|18| Distance( ft) | DTF-RL |
|19| 69.63636364 |31.05373|
|20| 69.81818182 |30.85291|
|21| 70.61818182 |31.85291|
The value of interest would be 30.85291, the lowest value in the range.
I would like to write that value to a specific cell within an excel document I

would then like to write the value next to it (the distance) in another cell within
the same excel document.
I have very little programming experience and wanted to reduce a redundant
task. I have no code as of yet, any direction would be much appreciated.
How can I implement this?
Thanks in advance.
Topic 171
Subject
Searching / Copying specific content from an Excel cell
Question
I have 10% Current / 2% PIK Senior Secured Debt (Maturity- September 19,
2019) in a cell, and I want to extract just the date, in this case September 19,
2019, and copy that over into a different cell.
I can search the cell for the months (January, February... etc) but is there a way
to copy the next ~8 characters to complete the date? Answer
With data in cell A1, in another cell:
=MID(A1,FIND("- ",A1)+2,FIND(")",A1)-FIND("- ",A1)-2)
This assumes that there is a dash space before the date and a close parens after
the date.
EDIT#1:
I am not sure I understand, but to make a formula that will work with both dash
space and just dash:
=IF(ISNUMBER(FIND("- ",A1)),MID(A1,FIND("- ",A1)+2,FIND(")",A1)-
FIND("- ",A1)-2),MID(A1,FIND("-",A1)+1,FIND(")",A1)-FIND("-",A1)-1))
But the formula is rapidly losing its beauty.

Answer
If the date is always at the end and in the same format this will pull the last
three "words"
=LEFT(MID(A1,SEARCH("}}}",SUBSTITUTE(A1," ","}}}",LEN(A1)-
LEN(SUBSTITUTE(AP7,"
",""))-2)),999),LEN(MID(A1,SEARCH("}}}",SUBSTITUTE(A1,"
","}}}",LEN(A1)-LEN(SUBSTITUTE(A1," ",""))-2)),999))-1)
Answer
If the text is in cell E2, this formula will work for any month so long as the "-"
is always after Maturity and close parenthesis after date.
=MID(E2,FIND("-",E2)+2,FIND(")",E2,FIND("-",E2)+2)-1-FIND("-",E2)-1)
Topic 172
Subject
Import data from Excel to Ms Access using VB
Question
I'm trying to import Data from Excel file to my Ms Access Database. I have a
ready table in my Ms Access Database and an Import Form where I press the
Import Button (That I designed) then select the Excel file in my computer and
the data is imported. The problem is that my code work for only 1 sheet Excel
file, means that it doesn't work if the file has multiple sheets in it, here is the
code I wrote:
Private Sub ImportButton_Click()
Dim dlg As FileDialog, strFileName As String Set dlg =
Application.FileDialog(msoFileDialogFilePicker) With dlg
.Title = "Select the Excel file to import" .AllowMultiSelect = False
.Filters.Clear
.Filters.Add "Excel Files", ".xls", 1 .Filters.Add "All Files", "*.*",
If .Show = -1 Then
strFileName = .SelectedItems(1)
DoCmd.TransferSpreadsheet acImport, acSpreadsheetTypeExcel8,

"Personnel", strFileName, True Else
Exit Sub
End If
End With
End Sub
So is there a way that I can loop through the sheets in the Excel file one by
one? Thanks in advance.
Update:
this the new working code if anyone needs it.
Private Sub Command0_Click()
' Requires reference to Microsoft Office 11.0 Object Library.
Dim fDialog As FileDialog
Dim varFile As Variant
' Clear listbox contents.
'Me.FileList.RowSource = ""
' Set up the File Dialog.
Set fDialog = Application.FileDialog(msoFileDialogFilePicker)
With fDialog 
    .AllowMultiSelect = False 
    .Filters.Add "Excel File", ".xls" 
    .Filters.Add "Excel File", ".xlsx" 
    If .Show = True Then 
       'Loop through each file selected and add it to our
list box. 
       For Each varFile In .SelectedItems 
       ' Label3.Caption = varFile 
       Const acImport = 0 
       Const acSpreadsheetTypeExcel9 = 8 
       ''This gets the sheets to new tables 
       GetSheets varFile 

       Next 
       MsgBox ("Import data successful!") 
       End If 
End With
End Sub
Sub GetSheets(strFileName)
'Requires reference to the Microsoft Excel x.x Object Library
Dim objXL As New Excel.Application
Dim wkb As Excel.Workbook
Dim wks As Object
'objXL.Visible = True
Set wkb = objXL.Workbooks.Open(strFileName)
For Each wks In wkb.Worksheets 
    DoCmd.TransferSpreadsheet acImport,
acSpreadsheetTypeExcel9, _ 
          "Personnel", strFileName, True, wks.Name & "$" 
Next
'Tidy up
wkb.Close
Set wkb = Nothing
objXL.Quit
Set objXL = Nothing
End Su
b
Note: "Personnel" is the name of the table where I'm importing data to. Answer

this may help you
Option Explicit
Sub AccImport()
Dim acc As New Access.Application
acc.OpenCurrentDatabase "C:\Users\Public\Database1.accdb"
acc.DoCmd.TransferSpreadsheet _ 
          TransferType:=acImport, _ 
          SpreadSheetType:=acSpreadsheetTypeExcel12Xml, _ 
          TableName:="tblExcelImport", _ 
          Filename:=Application.ActiveWorkbook.FullName, _ 
          HasFieldNames:=True, 
          Range:="FolioData_original$A1:B10" 
acc.CloseCurrentDatabase
acc.Quit
Set acc = Nothing
End Sub
Link to question
Topic 173
Subject
Open and edit an excel file using abap open_document_from_table
Question
I'm trying to open an excel inplace, edit the file and save it. I have created a
screen and I'm able to open the excel file in the pbo of the screen 100
c_oi_container_control_creator=>get_container_control ...
gc_control_excel->init_control
gc_control_excel->get_document_proxy
gc_doc_excel->open_document_from_table
I have also create and instance to handle the close_document event SET

HANDLER l_excel->on_close_document FOR gc_doc_excel..
and the file is opened correctly.
The trouble is when I edit and save the excel document. I close the document
IF NOT gc_doc_excel IS INITIAL. 
   CALL METHOD gc_doc_excel->is_destroyed 
     IMPORTING 
       ret_value = is_closed. 
   IF is_closed IS INITIAL. 
     CALL METHOD gc_doc_excel->close_document 
       EXPORTING 
         do_save     = ' ' 
         no_flush    = ' ' 
       IMPORTING 
         has_changed = v_changed 
         error       = gt_errors. 
IF gt_errors->has_failed = 'X'. 
   CALL METHOD gc_error->raise_message 
     EXPORTING 
       type = 'E'. 
ENDIF.
ENDIF.
Clear Document Resources
CALL METHOD gc_doc_excel->release_document EXPORTING
no_flush = ''
IMPORTING
error = gt_errors.
IF gt_errors->has_failed = 'X'.
CALL METHOD gc_error->raise_message 
   EXPORTING 
     type = 'E'. 

ENDIF.</code>
The issues are:
1) The event on_close document is not triggered, although I have the variable
has_changed = 1 and I have closed and released the document. 2) If I try to
recall the screen 100, the container is empty. What do I miss here?
regards.
Topic 174
Subject
Evaluate() not working inExcel VBA as expected
Question
I have a user-defined function in an Excel VBA module. Let's say it's:
Function MyFunc( val1 as Double, val2 as int, val3 as int ) as Double
MyFunc = val1 * val2 + val3
End Function
I also have another Function MyEval:
Function MyEval( formula as string )
MyEval = Evaluate( formula )
End Function
In a worksheet, the cell B1 contains the following string:
"blah blah blah "&MyFunc(VAL,2,0)&" foobar "&MyFunc(VAL,6,5)&" do re
mi"
Note that the quotes are part of the string, not just denoting that it is a string. In
second cell, I have the following:
=MyEval(SUBSTITUTE(B1,"VAL",8))

In general this works. In the above case I would get, as expected, the string:
blah blah blah 16 foobar 53 do re mi
In some cases, however, I would get #VALUE!. When I examined those
examples that failed, I would find that removing different parts would allow
the string to evaluate, but that no specific part caused it to fail, i.e., just the first
half works, just the second half works, and just the middle part works.
Thinking that it might be a length issue (strings are up to 200 characters), I
wrote a new evaluation function, where I break the string into parts on the
concatenate symbol (&), evaluate each part separately, and then concatenate
the results together:
Function MyEval2(formula As String)
If Len(formula) = 0 Then
Eval2 = ""
Else
Dim parts() As String
parts = Split(formula, "&")
Dim result As String
result = ""
Dim index As Integer
Dim part As String
For index = LBound(parts) To UBound(parts) 
      part = parts(index) 
      If (Left(part, 1) = """") And (Right(part, 1) = """")
Then 
          part = Left(part, Len(part) - 1) 
          part = Right(part, Len(part) - 1) 
          result = result & part 
      Else 
          Dim val As Variant 
          val = Evaluate(part) 
          result = result & val 
      End If 

Next index
Eval2 = result
End If
End Function
In this case, sometimes when the variable 'part' was, for example, the string
MyFunc(8,6,5)
the line
val = Evaluate(part)
resulted in 'val' being the string
MyFunc(8,6,5)
instead of the value 53.
Note: I have extensively re-written this to make it clearer. Answer
Remove the quotes...
Evaluate (cube (6))
My answer is not valid. Retained for comment history.
Topic 175
Subject
VBA Excel Macro makes Excel Not Respond and Close
Question
I have this macro stitched together from different people's suggestions online
so please excuse bad practices etc.
The difficulty is this: although it runs, it gets to the end, tries to close

ThisWorkbook and makes the program not respond.
Could someone please point out where I've gone wrong? Many thanks!
Here's the code:
Sub SaveandSendQuote()
Application.ScreenUpdating = False
Dim ws As Worksheet
Dim strPath As String
Set ws = ActiveSheet
If ws.Range("A2").Text = "Special Quotation For (CUSTOMER NAME
HERE)" Then MsgBox "Make sure to change the customer's name highlighted
in red" Exit Sub
End If
''Filepath for PDF
Dim myFile As Variant
Dim strFile As String
Dim Filepath As String
Dim strNameSheetSRC As String
Dim strNameSheetDES As String
Filepath = ThisWorkbook.ActiveSheet.Range("A2") RepName =
Application.UserName
strFile = Range("A2").Value 
      & "" _ 
      & Format(Now(), "dd.mm.yyyy") _ 
      & ".pdf" 
strFile = ThisWorkbook.Path & "\" & strFile myFile =
Application.GetSaveAsFilename _ (InitialFileName:=strFile, _
FileFilter:="PDF Files (*.pdf), *.pdf", _ Title:="Select Folder and FileName
to save") strSrcFile = "C:\Users\j\Documents\Trial.xltm" strDesFile =

"C:\Users\j\Documents\Template.xltm" strNameSheetSRC = 1
strNameSheetDES = 1
''Copy from ThisWorkbook to Template
Dim wbkSRC As Workbook
Dim wbkDES As Workbook
Set wbkDES = Workbooks.Open(strDesFile) Set wbkSRC = ThisWorkbook
Set wbkDES = ThisWorkbook
wbkSRC.ActiveSheet.Range("A4:A800").Copy
With wbkDES.ActiveSheet
Range("B2").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone,
SkipBlanks:= _ True, Transpose:=False
End With
wbkSRC.ActiveSheet.Range("C4:C800").Copy
With wbkDES.ActiveSheet
Range("F2").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone,
SkipBlanks:= _ True, Transpose:=False
End With
Application.CutCopyMode = False
Application.DisplayAlerts = False
ActiveWorkbook.SaveAs Filename:="H:\" & Filepath & ".xlsx",
FileFormat:=51 Application.DisplayAlerts = True
''Open and send email with attachment
Dim OutApp As Object
Dim OutMail As Object
Set OutMail = Nothing
Set OutApp = Nothing
Set OutApp = CreateObject("Outlook.Application") Set OutMail =
OutApp.CreateItem(0)
On Error Resume Next

With OutMail
.To = "j@c.com"
.Subject = Filepath
.Body = "C - attached spreadsheet with values for " & Filepath & vbNewLine
& vbNewLine & RepName .Attachments.Add ActiveWorkbook.FullName
.Send
End With
On Error GoTo 0
If myFile <> "False" Then
ws.ExportAsFixedFormat _
Type:=xlTypePDF, _
Filename:=myFile, _
Quality:=xlQualityStandard, _
IncludeDocProperties:=True, _
IgnorePrintAreas:=False, _
OpenAfterPublish:=False
End If
ActiveWorkbook.Close
ThisWorkbook.Close SaveChanges:=False
Application.ScreenUpdating = True
exitHandler:
Exit Sub
errHandler:
''I don't actually want this but it seems the only way to make the exitHandler
work??? MsgBox "Cancelled"
Resume exitHandler
End Sub
Sorry the block's so long :)
Topic 176
Subject
Excel 2013 After Insert Data in 1 column another column from same sheet
needs updated using macro
Question

I am using Excel 2013 and have two sheets.
"Sheet 1" has the following
Product Com 1 Com 2 Com 3
Radio Head
Tr
Rx
"Sheet 2" has the following
Prod Com 1 Com 2 Com 3
Radio Head
Tr
Rx
Now to my problem:
Whenever I type a value in Com1 from Sheet1, I want value '1' in Com1 for the
Sheet2 for the respective field. Answer
You do not need VBA to achieve what you need. Formula to set 1 if not empty
and 0 if empty. I have used first cell from the Sheet1.
=IF(ISBLANK(Sheet1!A1),0,1)
Topic 177
Subject
Event in Workbook not working when reopening
Question
I have an Excel macro that creates a new custom workbook with events. The
macro also copies the .bas and .cls files onto the new workbook and changes
the link to be the new workbook.
When the new workbook is created, everything, including events works fine.
But when I close it and reopen it, the events do not work anymore. I realize the
new workbook value is been lost. Since I have a button on the sheet I added the
following to try to recreate it but no luck:

Dim Newbook As New eventWB
Dim thisWB As Workbook
Set Newbook.Workbook = ActiveWorkbook
Set thisWB = Newbook.Workbook
// extra code to gather information
Answer
I beleive I found the solution to my problem. I was able to make it work by
adding an extra lin on my workbook class:
Public WithEvents m_events As Application
Every time I open the workbook I call I set it as:
Newbook.m_events = Application
And it does the trick the events work again. Hope this helps anybody with the
same issue! Thank you again!
Topic 178
Subject
How to test the values of two different cells in excel?
Question
How can I test to make sure that the values between two cells are both non-
zero?
This may be an exercise of my rustiness in certain areas of math but I have two
columns of values in an excel spreadsheet. In a third column to the right, I'm
taking 80% of one and 20% of another and getting the sum. However, this is
throwing off the calculation I'm trying to do often because the value in several
cells is zero in one but not the other. How can I only apply the 80% or 20%
when both values are not zero? Answer
If your columns are A and B, the following will work in column C:
=IF(AND(A1<>0,B1<>0),(0.8A1)+(0.2B1),"A value equals zero")

In plain language:
If A and B are both not equal to zero, apply the calculation.
Else, warn the user that a value in column A or B equals zero.
Edit
In response to the comment:
=IF(AND(A1<>0,B1<>0),(0.8A1)+(0.2B1),SUM(A1:B1))
In plain language:
If A and B are both not equal to zero, apply the calculation.
Else, sum the two values. The sum is equal to the non-zero value in column A
or B.
Topic 179
Subject
VBA hit button on IE page
Question
What i am trying to do is to open a site, and then press a button. i can't make it
work though, so i am asking for all of you experienced programmers!
The button xml record is:
z-menu-item-inner-r"><span class="z-menu-item-space"></span></td></tr>
</tbody></table></a></td><td id="z_e6_mm" align="left" z.type="Menuit2"
class="z-menu-item " style="padding-left:4px;padding-right:4px;" z.zcls="z-
menu-item" z.top="true"><a href="/NTS/NTSBatchJobs.zul" class="z-menu-
item-cnt"><table id="z_e6_mm!a" cellspacing="0" cellpadding="0"
border="0" class="z-menu-item-body " style="width: auto;"><tbody><tr><td
class="z-menu-item-inner-l"><span class="z-menu-item-space"></span></td>
<td class="z-menu-item-inner-m"><div><button id="z_e6_mm!b"
type="button" class="z-menu-item-btn">**HIT ME**&nbsp;</button></div>
</td><td class="

The button i am trying to press is named: HIT ME
The code i am using is:
Sub IE_Auto()
Dim i As Long
Dim IE As Object
Dim objElement As Object
Dim objCollection As Object
Set IE = CreateObject("InternetExplorer.Application") IE.Visible = True
IE.Navigate "mysite"
Set elems = IE.Document.getElementsByTagName("button") 
      For Each e In elems 
          If e.Name = "Hit Me" Then 
              e.Click 
              Exit For 
          End If 
   Next e 
End Sub
Answer
Why don't you use the getElementByID("z_e6_mm!b") method to return the
instance of that button. The element id is unique within the document, no need
for iteration.
Dim btn as Object
Set btn = IE.Document.getElementByID("z_e6_mm!b") btn.Click
NOTE: May not work with certain version(s) of IE.
Also worth noting, you could have a simple issue of case-sensitive comparison
returning false, and never clicking the button, because: "Hit Me" != "HIT ME".
You could control for this by forcing a UCASE or LCASE evaluation of the
button's text, but that seems less reliable than using the ID property.

Also note: that's not the element's .Name but it's .InnerText
As you observe, the ID property is changing so you can't reliably program to it.
In that case, you're left with brute force iteration, and comparing some non-
unique property like innerText:
Dim btn as Object
For each btn in IE.Document.getElementsByTagName("button")
If btn.innerText = "**HIT ME**&nbsp;" Then '<~~~ MODIFY AS NEEDED
### 
      btn.click 
      Exit For 'break out of the loop 
End If
Next
Topic 180
Subject
Import Schedule Tasks Commad Line via VBA Excel
Question
Sub imtaskvba()
Dim command As String
Set wShell = CreateObject("Wscript.Shell")
wShell.run "SchTasks /Create /ru User1 /rp Pa$$word /SC ONCE /TN
""Testtask1"" /TR ""Firefox -private-window -new-instance imacros://run/?
m=wwweb1.iim"" /SD 10/02/2016 /ST 01:03", 0
End Sub
Above code works create a task, Now I need to import task with XML file.
there is no error popup, but task not create. I'm on Win8.1 and MS Office 2013
wShell.run "schtasks.exe /Create /ru User1 /rp Pa$$word /TN ""Testtask1""

/XML ""C:\Users\User1\Documents\iMacros\Datasources\importtask.xml"" ",
0
Can anyone show me what code should be? Thanks
Topic 181
Subject
Creating a Workbook Password with a cell value and loop
Question
I am trying to set a Workbook password based on the password in a cell and
within a loop. So for example, I create a new workbook and new password
based on C2, C3, etc. The problem is the variable x is not being recognized in
my loop so all my Workbooks are getting the same password C2. Is there
anything wrong with this code this inhibiting the loop? Thanks!
ActiveWorkbook.Password = Sheets("Password").Range("C" & x).Value
Topic 182
Subject
VLOOKUP from another worksheet
Question
Could someone please assist me with the following VLOOKUP query.
I have data in Column A on one spreadsheet and I need to match the data that is
contained within this column, against Column A in another open spreadsheet
and if they match populate Column B in the first spreadsheet with the data
contained with Column B in the second spreadsheet.
Can anyone assist as I'm not sure of how to achieve this? Answer
in cell B* in sheet2 (where is the row number) =vlookup(A, 'Sheet1'!A:B, 2,
FALSE)
Topic 183
Subject
Excel Cascading Drop down list with tables across multiple pages

Question
I am unable to create dependent drop downs/ Cascading drop downs in excel.
I have data in tables in multiple pages in an Excel work book. Every table has
its name. for the current scenario the data is like this...
There are 3 tables in 3 pages with below TableName. First row of every page
is a blank row with out data.
Account
Project
ProjectAllocation
Account Table

AccountID AccountName
ShortName
101              Account - 1        Acnt - 1 
102              Account - 2        Acnt - 2 
103              Account - 3        Acnt - 3 
104              Account - 4        Acnt - 4 
Project Table

Project-ID Account Project-Name
105            Acnt - 1         Project - 1 
106            Acnt - 1         Project - 2 
107            Acnt - 2         Project - 3 
108            Acnt - 3         Project - 4 
109            Acnt - 4         Project - 5 
Allocation Table

ID Account Project EmpID
1        Acnt - 1      Project - 1       101 
2        Acnt - 1      Project - 1       102 
3        Acnt - 1      Project - 1       103 
4        Acnt - 1      Project - 2       104 
5        Acnt - 2      Project - 3       105 
6        Acnt - 3      Project - 4       106 
7        Acnt - 4      Project - 5       107 
Now in the Project Allocation table...
I can successfully created drop down for the Account to select among the
available options from "Account" Table.
I want to populate the drop down in Project Allocation table in such a way that
all the projects should drop down corresponds to the Account which I select.
I tried to create a data validation but the drop down has become read only or I
ended up with an error (REF, Value etc.).
I watched so many videos in YouTube where they tried to achieve this task
with in a single page but not using multiple tables from multiple pages.
Any help in this regards is much appreciated. Answer
This solution assumes your tables are sorted in the following way. They have
to stay sorted, or be re-sorted when new data comes in, for this to work.
Account > By Account Name
Project > By Account
Allocation > By Project
exactly as appears in your sample data.

Having a Summary sheet like below
Enter the following Named Ranges scoped at the Workbook Level:
account: =OFFSET(account!$C$1,1,0,COUNTA(account!$C:$C)-1,1) project:
=OFFSET(project!$C$1,MATCH(Summary!$C$2,project!$B:$B,0)-1,0,COUN
allocation:
=OFFSET(project!$C$1,MATCH(Summary!$C$2,project!$B:$B,0)-1,0,COUN
Then (using the sheet above), the following data validation:
C2 = account
D2 = project
E2 = allocation
Topic 184
Subject
VBA Automating “UnpivotData”
Question
I have cross-tab table (similar to the example in the image below) that I am
trying to 'unpivot'.
Application.Run "UnpivotData" will start the process, but then requires the
user to input the starting field in the prompt.
The fiels will always be $B$2, but I'm not sure how to get it to automatically
set that and 'click' ok in this context.
Perhaps I'm going about it the wrong way?
Topic 185
Subject
How to format excel data for Adwords
Question
I'm looking for help to get my Excel sheet into a specific format to import into
Adwords. I have a sheet with data in this format:

I need to get it into this format:
What makes this tricky is getting 3 lines for each SKU. One line contains the
Ad Group creation, the next is text ad creation and then the Keyword and bid is
on the next line.
Can someone please help me achieve this? I would greatly appreciate it.
Thanks!
Answer
hope this helps...
(For all)
In a worksheet, set the range names that you can see the in code
ReportAddress
theSiteShort
theSiteLong
First
Second
And use it to reference inside the book. (This is just to not use $A$1)
Follow the comments...
'Take the report and store the address in the 'Range("ReportAddress") to use it
later... Sub takeReport()
'this is to take the reporte and store the address in Cells C6 'that has the name
ReportAddress as you can see Dim i
Dim FD As FileDialog 'to take files Set FD =
Application.FileDialog(msoFileDialogFilePicker)
With FD 'invoke the file dialog 
      If .Show = -1 Then 'if you take any file (1 or more) 
          For Each i In .SelectedItems 'for each file do
this... 

              Range("ReportAddress").Value = i 'and as you
can see, just take one file... 
          Next i 
      End If 
End With
End Sub
'to create the report
Sub do_Report()
Dim dirReport As String
Dim wrkData As Workbook
Dim shtData As Worksheet
Dim tmpReport As Workbook
Dim shtReport As Worksheet
Dim skuNum() 'to store the data
Dim skuName()
Dim vendorPartNum()
Dim manufacturer()
Dim r 'var for rows
Dim c
Dim col
Dim fil
Dim i
Dim counter
Dim shortSite As String
Dim longSite As String
Dim first As String
Dim second As String
'this is to a better handle of the data... shortSite = Range("theSiteShort").Value
longSite = Range("theSiteLong").Value first = Range("First").Value
second = Range("Second").Value
Workbooks.Open Range("ReportAddress").Value 'open the workbook with the
data Set wrkData = ActiveWorkbook

Set shtData = ActiveSheet 'here we can fail, because if the xls has more than 1
sheet and that sheet
'is not the sheet we need, could fail...
Workbooks.Add 'create a new workbook (CTRL+N) Set tmpReport =
ActiveWorkbook 'Store it here Set shtReport = ActiveSheet 'as well the active
sheet
'headlines
Range("A1").FormulaR1C1 = "Ad Group" Range("B1").FormulaR1C1 =
"Bid"
Range("C1").FormulaR1C1 = "Headline" Range("D1").FormulaR1C1 = "Desc
1"
Range("E1").FormulaR1C1 = "Desc 2"
Range("F1").FormulaR1C1 = "Display URL" Range("G1").FormulaR1C1 =
"Final URL" Range("H1").FormulaR1C1 = "Keyword"
wrkData.Activate 'got to the data report shtData.Activate 'activate the sheet
with the data, remember the comment!
r = Range("A1").End(xlDown).Row 'find the last row of data c =
Range("A1").End(xlToRight).Column 'As well the last column
For col = 1 To c 'well may is always the same qty of columns, but i like to
count!!! 
      For fil = 2 To r 'for every row 
          Select Case col 'depends in which column is... 
              Case 1 'the first one use SkuNum... and so
on... (This are the columns of the data source) 
                  ReDim Preserve skuNum(1 To fil - 1) 
                  skuNum(fil - 1) = Cells(fil, col) 
              Case 2 
                  ReDim Preserve skuName(1 To fil - 1) 
                  skuName(fil - 1) = Cells(fil, col) 
              Case 3 
                  ReDim Preserve vendorPartNum(1 To fil - 1) 
                  vendorPartNum(fil - 1) = Cells(fil, col) 
              Case 4 
                  ReDim Preserve manufacturer(1 To fil - 1) 

                  manufacturer(fil - 1) = Cells(fil, col) 
              Case Else 
                  'do nothing 'just in case... 
          End Select 
      Next fil 
Next col
tmpReport.Activate 'go to the new book, that is our final report
shtReport.Activate 'go to the sheet... just in case again... 'This line could be
deletec
counter = 0 'a counter (index) for the vars() For i = 1 To (r * 3) Step 3 ' 
      'i got r lines and i need to put every 3 lines, 
      'then, that why I use Step 3 = (every 3th line), and
that 3 * r. 
      counter = counter + 1 
      If counter > UBound(skuName) Then 'if the counter is
bigger that the 
                                        'qty of vars inside
SkuName (or any other) 
          Exit For 'get out the for loop! 
      End If 
      'here is the magic... almost... 
      Cells(i + 1, 1).Value = manufacturer(counter) & " - " &
vendorPartNum(counter) 
      Cells(i + 1, 2).Value = first 
      Cells(i + 2, 1).Value = manufacturer(counter) & " - " &
vendorPartNum(counter) 
      Cells(i + 2, 3).Value = manufacturer(counter) & " - " &
vendorPartNum(counter) & " On Sale" 
      Cells(i + 2, 4).Value = skuName(counter) 
      Cells(i + 2, 5).Value = "Shop " & manufacturer(counter)
& " now." 
      Cells(i + 2, 6).Value = shortSite &
manufacturer(counter) 
      Cells(i + 2, 7).Value = longSite & skuNum(counter) 
      Cells(i + 3, 1).Value = manufacturer(counter) & " - " &
vendorPartNum(counter) 
      Cells(i + 3, 2).Value = second 
      Cells(i + 3, 8).Value = "+" & manufacturer(counter) & "
+" & vendorPartNum(counter) 

Next i
Cells.EntireColumn.AutoFit 'Autofit all columns... MsgBox "Ready!" 'Finish!
End Sub
Topic 186
Subject
reading excel sheet as multiindex dataframe through pd.read_excel()
Question
I'm struggle to read a excel sheet with pd.read_excel().
My excel table looks like this in it's raw form:
I except the dataframe to look something like: 
              bar                 baz                 foo 
              one       two       one       two       one    
 two 
              A         B         C         D         E      
 F 
baz one         0.085930 -0.848468  0.911572 -0.705026
-1.284458 -0.602760 
  two         0.385054  2.539314  0.589164  0.765126
0.210199 -0.481789 
  three      -0.352475 -0.975200 -0.403591  0.975707
0.533924 -0.195430 
is this even possible?
My failed attempt:
xls_file = pd.read_excel(data_file, header=[0,1,2], index_col=None)
Link to the raw excel file:
https://www.dropbox.com/s/ek646ab4yb1fvdq/ipsos_excel_tables_type_2_trim
dl=0 Answer
You can add parameter index_col=[0,1] to read_excel, because index is
Multindex too:

EDIT
You need also change header from header=[0,1,2] to header=[0,1], and remove
empty rows - row 5 and 7. You can add parameter sheetname:
import pandas as pd
df = pd.read_excel('test/ipsos_excel_tables_type_2_trimed_nosig.xlsx', 
                 header=[0,1], 
                 index_col=[0,1], 
                 sheetname="0001") 
print df 
                                                            
       T  \ 
                                                            
   Total 
Q1. Do you have a social media account (such as... Unweighted
base  2019 
                                                 Weighted
base    2019 
                                                 Yes        
    1519 
                                                 Yes        
      75 
                                                 No          
    494 
                                                 No          
     24 
                                                 Don’t know  
      5 
                                                            
   Gender  \ 
                                                            
     Male 
Q1. Do you have a social media account (such as... Unweighted
base   1011 
                                                 Weighted
base     1000 
                                                 Yes        
      705 

                                                 Yes        
       70 
                                                 No          
     291 
                                                 No          
      29 
                                                 Don’t know  
       4 
                                                            
           \ 
                                                            
   Female 
Q1. Do you have a social media account (such as... Unweighted
base   1008 
                                                 Weighted
base     1019 
                                                 Yes        
      814 
                                                 Yes        
       80 
                                                 No          
     204 
                                                 No          
      20 
                                                 Don’t know  
       1 
                                                            
     Age  \ 
                                                            
   16-24 
Q1. Do you have a social media account (such as... Unweighted
base   321 
                                                 Weighted
base     323 
                                                 Yes        
     293 
                                                 Yes        
      91 
                                                 No          
     28 
                                                 No          
      9 
                                                 Don’t know  
      1 
                                                            

          \ 
                                                            
   25-34 
Q1. Do you have a social media account (such as... Unweighted
base   361 
                                                 Weighted
base     361 
                                                 Yes        
     318 
                                                 Yes        
      88 
                                                 No          
     41 
                                                 No          
     11 
                                                 Don’t know  
      2 
                                                            
          \ 
                                                            
   35-44 
Q1. Do you have a social media account (such as... Unweighted
base   372 
                                                 Weighted
base     370 
                                                 Yes        
     289 
                                                 Yes        
      78 
                                                 No          
     81 
                                                 No          
     22 
                                                 Don’t know  
      - 
                                                            
          \ 
                                                            
   45-54 
Q1. Do you have a social media account (such as... Unweighted
base   376 
                                                 Weighted
base     376 
                                                 Yes        
     258 
                                                 Yes        

      69 
                                                 No          
    118 
                                                 No          
     31 
                                                 Don’t know  
      - 
                                                            
          \ 
                                                            
   55-75 
Q1. Do you have a social media account (such as... Unweighted
base   589 
                                                 Weighted
base     589 
                                                 Yes        
     361 
                                                 Yes        
      61 
                                                 No          
    227 
                                                 No          
     38 
                                                 Don’t know  
      2 
                                                            
   Social grade  \ 
                                                            
             AB 
Q1. Do you have a social media account (such as... Unweighted
base          593 
                                                 Weighted
base            533 
                                                 Yes        
            416 
                                                 Yes        
             78 
                                                 No          
           116 
                                                 No          
            22 
                                                 Don’t know  
             1 
                                                            
         \ 

                                                            
     C1 
Q1. Do you have a social media account (such as... Unweighted
base  588 
                                                 Weighted
base    563 
                                                 Yes        
    417 
                                                 Yes        
     74 
                                                 No          
   147 
                                                 No          
    26 
                                                 Don’t know  
     - 
...        \
Q1. Do you have a social media account (such as... Unweighted base       ... 
                                                 Weighted base         ... 
                                                 Yes                   ... 
                                                 Yes                   ... 
                                                 No                    ... 
                                                 No                    ... 
                                                 Don’t know            ... 
                                                                 Region (4 code scale)  \ 
                                                                                  East 
Q1. Do you have a social media account (such as... Unweighted base                
 341 
                                                 Weighted base                     342 
                                                 Yes                               259 
                                                 Yes                                76 
                                                 No                                 83 
                                                 No                                 24 
                                                 Don’t know                          - 

                                                                          Education  \ 
                                                                 GCSE/O Level/NVQ12 
Q1. Do you have a social media account (such as... Unweighted base              
503 
                                                 Weighted base                  520 
                                                 Yes                            370 
                                                 Yes                             71 
                                                 No                             147 
                                                 No                              28 
                                                 Don’t know                       4 
                                                                                        \ 
                                                                 A Level or equivalent 
Q1. Do you have a social media account (such as... Unweighted base                
 454 
                                                 Weighted base                     461 
                                                 Yes                               359 
                                                 Yes                                78 
                                                 No                                101 
                                                 No                                 22 
                                                 Don’t know                          1 
                                                                                     \ 
                                                                 Degree/Masters/PhD 
Q1. Do you have a social media account (such as... Unweighted base              
914 
                                                 Weighted base                  886 
                                                 Yes                            697 
                                                 Yes                             79 
                                                 No                             189 
                                                 No                              21 
                                                 Don’t know                       - 
                                                                                           \ 
                                                                 No formal qualifications 
Q1. Do you have a social media account (such as... Unweighted base                
    148 

                                                 Weighted base                        152 
                                                 Yes                                   93 
                                                 Yes                                   61 
                                                 No                                    58 
                                                 No                                    38 
                                                 Don’t know                             1 
                                                                 Employment status  \ 
                                                                         Full-time 
Q1. Do you have a social media account (such as... Unweighted base              
774 
                                                 Weighted base                 763 
                                                 Yes                           598 
                                                 Yes                            78 
                                                 No                            162 
                                                 No                             21 
                                                 Don’t know                      3 
                                                                            \ 
                                                                 Part-time 
Q1. Do you have a social media account (such as... Unweighted base       272 
                                                 Weighted base         274 
                                                 Yes                   195 
                                                 Yes                    71 
                                                 No                     79 
                                                 No                     29 
                                                 Don’t know              - 
                                                                                \ 
                                                                 Self-Employed 
Q1. Do you have a social media account (such as... Unweighted base          
166 
                                                 Weighted base             162 
                                                 Yes                       108 
                                                 Yes                        67 
                                                 No                         54 
                                                 No                         33 

                                                 Don’t know                  - 
                                                                              \ 
                                                                 ANY WORKING 
Q1. Do you have a social media account (such as... Unweighted base        1212
                                                 Weighted base          1200 
                                                 Yes                     901 
                                                 Yes                      75 
                                                 No                      295 
                                                 No                       25 
                                                 Don’t know                3 
                                                                 ANY NOT WORKING 
Q1. Do you have a social media account (such as... Unweighted base            
625 
                                                 Weighted base               645 
                                                 Yes                         460 
                                                 Yes                          71 
                                                 No                          183 
                                                 No                           28 
                                                 Don’t know                    2 
[7 rows x 25 columns]
Topic 187
Subject
Order by values in an Excel chart
Question
I'm trying to find a simple way, inside an Excel chart, to order by values
descending. The largest value would appear at the far left in the chart, with all
subsequent values, moving to the right, decreasing in value. I'd like to do this
without having to modify any of the data. Answer
You can accomplish this by using a pivot table and chart. This will not affect
the original data.

Answer
The problem with "I'd like to do this without having to modify any of the data"
is that excel is not set up to do that. The chart is making assumptions, here is an
example. In Cell A1 we have 1. in A2 we have 2 and on up to A20 = 20. If you
chart this using a line chart, you will get a positive curve going from 1 to 20
BECAUSE the data was sorted from least to greatest. If you want the line to
have a specific curve you have to SORT your data in a way that will force that
curve. You do not have to edit the data, per se, but do have to sort it. If you can
provide more specific information on what you are charting I'd be glad to see
if I can help.
Topic 188
Subject
VBA to remove prefix from excel tab names
Question
I have an excel file with many tabs. All tabs are named such as: "pboro
bz.csv", "pboro fd.csv", "pboro ha.csv", etc.
I am looking to rename all of these "bz.csv", "fd.csv", "ha.csv" instead.
Furthermore, depending on the data another VBA imports, the tab names may
have different prefixes. I therefore have a cell (B8) in a sheet titled "Setup"
with the prefix I wish to remove, in this case "pboro "
I am trying to use this code:
Sub RemovePrefix()
Dim WS As Worksheet
Dim Val As String
Val = Setup.Range("B8").Value
Const Prefix As String = Val
For Each WS In Worksheets
If WS.Name Like Prefix & "*" Then WS.Name = Mid(WS.Name, Len(Prefix)
+ 1) Next
End Sub

The code crashes on the line
Const Prefix As String = Val
with the error "Constant expression required"
I suspect this is because I am using Dim with Val, then Const with Prexif.
However when I adapt the code to the following:
Sub RemovePrefix()
Dim WS As Worksheet
Dim Val As String
Val = Setup.Range("B8").Value
For Each WS In Worksheets
If WS.Name Like Val & "*" Then WS.Name = Mid(WS.Name, Len(Val) + 1)
Next
End Sub
I receive the error "Object required" relating to my line of code
Val = Setup.Range("B8").Value
I am unsure where I am going wrong (and being a relative VBA noob probably
isn't helping). Answer
Now it's crashing because you never set Setup as a worksheet.
Dim setup as Worksheet
Set setup = Sheets("Setup")
should do the trick. Also, it looks like Val will change, so you wouldn't want to
set it as a Constant.
Topic 189
Subject
Conditionally Formatting Rows in VBA dynamically colours the cells
incorrectly
Question

I recorded a macro to conditionally format some rows in excel using vba, but
when I try to run it a second time, or when I try looping it for a dynamic
selection of range, it paints the cells the wrong colour and in the wrong
direction. I want the cells to be painted from red to white, high to low, but the
code paints the cells orange to white, low to high. Here is my code:
Sub ConForm()
Sheets("Percentage").Activate
Dim lastRow, currRow As Integer
Dim rng As Range
lastRow = Sheets("Percentage").Range("B250").End(xlUp).Row currRow = 9
For currRow = 9 To (lastRow - 1)
'Range("F" & currRow & ":AL" & currRow).Select
Set rng = Sheets("Percentage").Range("F9:AL9") '"rng_ConForm" &
currRow) rng.Select
rng.FormatConditions.AddColorScale ColorScaleType:=2
rng.FormatConditions(1).ColorScaleCriteria(1).Type = _
xlConditionValueLowestValue
With rng.FormatConditions(1).ColorScaleCriteria(1).FormatColor 
      .Color = RGB(255, 255, 255) 
      .TintAndShade = 0 
End With
rng.FormatConditions(1).ColorScaleCriteria(2).Type = _
xlConditionValueHighestValue
With rng.FormatConditions(1).ColorScaleCriteria(2).FormatColor 
      .Color = RGB(255, 0, 0) 
      .TintAndShade = 0 

End With
rng.FormatConditions(1).ScopeType = xlSelectionScope
Next currRow
End Sub
Does anyone know what's going on here? Thanks
Edit: Here is the data after running. Before being run for the first time, all
conditional formatting is cleared
1. After running once
2. After running twice
Topic 190
Subject
How can I get all Elements by Class type in my vba webbrowser document?
Question
The code below is in an Excel 2010 form with a webbrowser control on it.
The Microsoft HTML Object Library is selected in the VBE references section
and I'm using VBA 7.0.
Option Explicit
Private Sub UserForm_Initialize()
WebBrowser1.Navigate "http://www.google.com/" End Sub
Private Sub WebBrowser1_DocumentComplete(ByVal pDisp As Object, URL
As Variant)
Dim Inputs As IHTMLElementCollection
'returns inputs on page where class name is "gsfi" Set Inputs =
wb.Document.GetElementsByClassName("gsfi") 'returns all inputs on a page

Set Inputs = WebBrowser1.Document.GetElementsByTagName("Input")
Debug.Print Inputs.Length
End Sub
Edit: I am amending this question in light of help from @Tim Williams to
illustrate what I'm actually after. How can I get the all elements with the
TagName "Input" and Class Type of "Text" or "Button" etc. ? Answer
Are you sure there are elements with that class name ? Code below indicates
there are no inputs with that class...
EDIT: "Type" is what you're looking for:
Private Sub WebBrowser1_DocumentComplete(ByVal pDisp As Object, URL
As Variant)
Dim Inputs As IHTMLElementCollection, o As Object
Set Inputs = pDisp.Document.getElementsByTagName("input") Debug.Print
Inputs.Length '>>11
For Each o In Inputs
Debug.Print o.Name, o.tagName, o.Type Next o
End Sub
Topic 191
Subject
VBA Solver Final Values As Double
Question
Here's what I'm trying to do:
I want my solver to only give me final values that are Double NOT Integer.
I realize that this is probably a piece of cake for anybody with more

experience in VBA than myself. I tried to do it with a Dim As Double function.
Here's what I have so far:
Dim finalvalues As Double
finalvalues = Range("G8:G17")
SolverReset
SolverOK SetCell:=Range("H6"), MaxMinVal:=2, ByChange:=finalvalues,
Engine:=1 SolverAdd CellRef:=finalvalues, Relation:=3, FormulaText:="0"
SolverAdd CellRef:=Range("I6"), Relation:=1, FormulaText:="$B$3"
SolverAdd CellRef:=Range("J6"), Relation:=1, FormulaText:="$B$4"
SolverSolve UserFinish:=False
Thanks!
Topic 192
Subject
Filter by multiple conditons pivot VBA
Question
I have four filters on a pivot table,week_of_year(1,2 to 52),date(1/1/2012 to
2/7/2016),year(2012 to 2016),city(newyork to san fransisco)
Sub datefilter()
Dim PvtTbl As PivotTable
Set PvtTbl = Worksheets("test").PivotTables("PivotTable3") Dim pf As
PivotField
Dim pf1 As PivotField
Dim PI As PivotItem
Set pf =
Worksheets("test").PivotTables("PivotTable3").PivotFields("week_of_year")
Set pf1 =
Worksheets("test").PivotTables("PivotTable3").PivotFields("year") Set pf2 =
Worksheets("test").PivotTables("PivotTable3").PivotFields("Date") Set pf3 =
Worksheets("test").PivotTables("PivotTable3").PivotFields("city")
PvtTbl.ClearAllFilters

For Each PI In pf.PivotItems
If PI.Name = "7" Then
PI.Visible = True
Else
PI.Visible = False
End If
Next
For Each PI In pf1.PivotItems
If PI.Name = "2014" Or PI.Name = "2015" Then PI.Visible = True
Else
PI.Visible = False
End If
Next
''Same for the Date,city, have multiple items selected as filter. End Sub
This works but take forever to run, cuz its looping each record. Try to find a
more efficient way to do it. Any one can use currentpage or pivotfield.add to
achieve the same thing? Appreciate!!!Thanks a bunch!
Special request: the pivot table is linked to database. So when new date
flashes in, need to select more date from the filter. For example, if 2/9/16 gets
in,also need to select data <= 2/9/15 and only select data for 2015, neglect
2012,2013,2014. Looping each record is too cumbersome and takes forever to
run. Answer
You could do a little more work with your raw data first. It sounds like you
only want data with a few set conditions.
So, you could write VBA that drops a nested-if statement into a new column
with the following logic:
=if(or("YOUR FIELD"=2014, "YOUR FIELD"=2014),"Yes",if("YOUR
FIELD"=7,"Yes","No"))
Then filter by everything in this new formula column that equals "Yes", and you
reduce the pivot filter to one switch.

If it's a larger data set and you don't want formulas eating up your memory, you
could also use a For loop to accomplish the same effect. That's my preferred
method actually.
Answer
The most efficient solution is to set up a Stored Procedure with dynamic
procedures in the underlying database that will let you filter your data at the
Database end. That SP could then draw on a list in the spreadsheet. See
http://datapigtechnologies.com/blog/index.php/running-a-sql-stored-
procedure-from-excel-with-dynamic-parameters/
If that is not possible, my article at
http://dailydoseofexcel.com/archives/2013/11/14/filtering-pivots-based-on-
external-ranges/ has code that will do what you want, as I've already outlined
at your other thread on this topic
Read that thread, and you will learn how to drastically reduce the amount of
time it takes to loop through PivotItems and change their status.
Also, note that before you iterate through PivotItems you want to set PT.
.ManualUpdate to TRUE while you make your changes, and set it back to
FALSE afterwards to avoid the PivotTable refreshing after each and every
change.
Topic 193
Subject
Keep only one language text in multilingual Excel file
Question
I have a multilingual Excel file with English and Arabic languages text mostly
written together within same cells. I'm trying to process either of the following
options:
Separate English and Arabic Text written in one column in different columns
using "Text to column" command (or using any other tactic) Remove all Arabic
Text from file altogether if possible using may be character-set or any other
option.

Thanks,
Farakh
Topic 194
Subject
Having exact copy of other excel sheet
Question
I was wondering if there is an easy way of creating a exact copy of an external
excel sheet that is on SharePoint. Of course the sheet should be updated
whenever the sheet on SharePoint is. Answer
Ololog,
It sounds like what you're describing is a shortcut to the underlying file. Is this
the case, or are you looking to do something else?
Topic 195
Subject
Outlook date/time function VBA to Excel
Question
I am getting several emails a day with information I am trying to put in an excel
spreadsheet. The code I have works great except I would like to format the
date and time that I am getting in my message in excel. I have tried several
different options but they do not work. When the information is formatted in
outlook and exported to excel then all I get for the time is 12:00:00 AM. Not
the actual number. The body of the email looks like this: NOTIFICATION FOR
THE FILENAME SOV-Intra_Daily-B_START.20160209 POST DAY:
20160209
POST TIME: 123025
I want the POST DAY and POST TIME to actually be date and time in my
excel spreadsheet. These are the different codes I have tried:
xcWks.Cells(lngRow, 4) = Mid(strTmp, 11) 'mystring = Mid(strTmp, 11)
'excWks.Cells(lngRow, 4) = Format(mystring, "hh:mm:ss AMPM")

'excWks.Cells(lngRow, 4) = Format(Mid(strTmp, 11), "hh:mm:ss AMPM")
'Format(excWks.Cells(lngRow, 4), "hh:mm:ss AMPM") = Mid(strTmp, 11)
In excel it looks like this:
FINANCIAL MIS - INTRA MONTHLY-B RUN FINISHED Intra_Daily-
B_START.20160209 20160209 12:00:00 AM.
If I dont put the format in there then I get the string but I want it to show up as a
time. When I try to format it in excel it does not work.
Any help would be greatly appreciated.
Topic 196
Subject
Is there a way to get the paste section of this code to cycle down one row at a
time each time data is pasted?
Question
My aim with this bit of code is to paste the contents of column D into a
different Sheet if the contents in column N on the same row within the initial
Sheet is = "REDUCE ONLY". I'm struggling to find a way to paste all the
entries into the second Sheet with no blank rows between them.
Currently I'm sorting the initial Sheet so all the REDUCE ONLY entries are in
order at the top of the column N so they're ordered correctly in the output sheet
but this isn't very robust if I get a different set of values to what's expected in
column N. Is there a different way to phrase: "cfdSht.Cells(c.Row - 1,
1).PasteSpecial Paste:=xlPasteValues"
So far I've got:
Dim c As Range
Dim rCheck As Range
Dim LRMAIN As Long
Dim cfdSht As Worksheet
Dim mainSht As Worksheet
Set mainSht = ThisWorkbook.Worksheets("Sheet1") Set cfdSht =

ThisWorkbook.Worksheets("ProductSettingNgCfd")
''Set Last Row
LRMAIN = mainSht.Range("A2").CurrentRegion.Rows.Count
''Set Range
Set rCheck = mainSht.Range("B2:N" & LRMAIN)
''Copy any value in column D where the value on the same row in column N is
"REDUCE ONLY". Paste into second Sheet with starting point adjusted up 1
row.
For Each c In rCheck
If c.Value = "REDUCE ONLY" Then 
      mainSht.Cells(c.Row, 4).Copy 
      cfdSht.Cells(c.Row - 1, 1).PasteSpecial
Paste:=xlPasteValues 
End If
Next
Thanks
Answer
Replace this:
mainSht.Cells(c.Row, 4).Copy
cfdSht.Cells(c.Row - 1, 1)
With this
cfdSht.Cells(cfdSht.RowsCount, 1).End(xlUp).Offset(1).value =
mainSht.Cells(c.Row, 4).Value
The first part will start at the bottom of the sheet then go up to the first

occupied cell then move one down to the first unoccupied cell.
I used the direct assign method, because it is less taxing on the process than
copy and paste. As you were looking only for values this will just put the value
of the one cell into the other.
Topic 197
Subject
CreateObject(“Excel.Application”) instance behaves differently than “normal”
(point-click) instance
Question
If I open Excel via double clicking on an Excel file then use VBA to open up
MyExcelFile and run MyMacro, things go fine. But if I use VBA to create a
new instance of Excel using CreateObject, and use VBA to open up
MyExcelFile and run MyMacro, a third-party Add-In I don't have control over
behaves differently (wrong).
I'm wondering if there are settings for Excel instances I can control and should
set explicitly? I got really excited when I saw this, but it didn't solve my
problem: "New" Excel.Application vs Excel.Application
Does opening Excel via point-and-click initiate different settings from
CreateObject("Excel.Application")? Maybe different working directories or
something?
In summary, for my third-party AddIn:
Works
Workbooks.Open("MyExcelFile")
Application.Run "MyExcelFile!MyMacro"
Does not work:
Dim ObjXL
Set objXL = CreateObject("Excel.Application")
objXL.Workbooks.Open("MyExcelFile")

objXL.Application.Run "MyExcelFile!MyMacro"
Within MyMacro, I load the AddIn:
Dim success as Boolean
success = False
success = Application.RegisterXLL("PathToAddIn_x64.xll") If Not (success)
Then
Exit Sub
End If
success = Application.RegisterXLL("PathToOtherAddIn_x64.xll") If Not
(success) Then
Exit Sub
End If
Answer
Add-ins do not load automatically when you create an Excel instance via
automation.
You will need to load any required items using VBA.
See - support.microsoft.com/en-us/kb/213489
Topic 198
Subject
Can we have Worksheet_Change & Worksheet_SelectionChange in the same
worksheet
Question
Can we have Worksheet_Change & Worksheet_SelectionChange in the same
worksheet. If Yes what is the precedence?
Thank you
Jean

Answer
Sure you can:
Option Explicit
Private Sub Worksheet_Change(ByVal Target As Range) Debug.Print
Target.Row
End Sub
Private Sub Worksheet_SelectionChange(ByVal myTarget As Range)
Debug.Print myTarget.Address
End Sub
The selection change happens first, since you change the selection before
changing a cell.
Answer
You could test this super easy by sticking the following in your worksheet's
VBA:
Private Sub Worksheet_Change(ByVal Target As Range) MsgBox "Change"
End Sub
Private Sub Worksheet_SelectionChange(ByVal Target As Range) MsgBox
"selection change"
End Sub
You'll find that the events generally don't fire at the same time unless you enter
new text in a cell and hit enter to move to a new cell. In that case, the "Change"
event will fire first, then the "Selection Change" will fire.
Topic 199
Subject
Execute Excel Macro to Copy All Sheets to Master Sheet When Any Cell in
Active Sheet Column Changes

Question
I have the following code that is executing when a value in F2:F251 changes,
but it is not executing properly (or, more likely, I wrote it incorrectly).
When F2:F251 changes in the active sheet, the contents of A2:F251 of sheets
January through December are supposed to copy to a master sheet so that new
data, or old data that has been changed, will always be current in the master
sheet.
However, what happens is that the data in the active sheet gets overwritten and
I end up in an infinite loop. Is that a problem with the auto-run code, or is it a
problem with the copying code? The copy code when executed alone, on
command, on the master sheet functions properly. Also, this appears to be a
rather verbose way of performing the actions that I want. Is there an apparent
alternative that is more efficient?
Private Sub Worksheet_Change(ByVal Target As Range)
Dim KeyCells As Range
' The variable KeyCells contains the cells that will ' cause an alert when they
are changed. Set KeyCells = Range("F1:F251")
If Not Application.Intersect(KeyCells, Range(Target.Address)) _
Is Nothing Then 
      ' Copies contents A2:G251 from each monthly 
      ' sheet to master record sheet. 
      Sheets("MasterRecord").Activate 
      Sheets("MasterRecord").Cells.ClearContents 
      Dim NextRow As Range 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("January").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 

      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("February").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("March").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("April").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("May").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("June").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("July").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 

      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("August").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("September").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("October").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("November").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
      Set NextRow = Range("A" &
Sheets("MasterRecord").UsedRange.Rows.Count + 1) 
      Sheets("December").Range("A2:G251").Copy 
      Sheets("MasterRecord").Activate 
      NextRow.PasteSpecial Paste:=xlValues, Transpose:=False 
      Application.CutCopyMode = False 
      Set NextRow = Nothing 
End If
End Sub
Answer

To answer the actual question - the reason your code is going in to an infinite
loop is due to two reasons:
You have not disabled events within the event, so by pasting over the range
F2:F251 you are firing the event again and again and again. You are getting the
last row of MasterRecord, but you are not using the Range on MasterRecord,
rather, the sheet the event was fired from.
You must ensure when dealing with ranges that you use the range of the
worksheet you expect. Since all worksheets are really just objects, calling
Range within the Sheet module defaults to Me.Range, thus using that
worksheet.
I believe the following accomplishes what you need, without duplication:
Option Explicit
Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As
Range)
' Target is already a range, no need to get the address explicitly If
(Intersect(Target, Sh.Range("F1:F251")) Is Nothing) Then Exit Sub
Application.EnableEvents = False
Application.ScreenUpdating = False
Dim master As Worksheet: Set master =
ThisWorkbook.Worksheets("MasterRecord") Dim ws As Worksheet
Dim sheets As Variant: sheets = Array("January", "February", "March",
"April", "May", "June", "July", "August", "September", "October",
"November", "December") Dim sheet As Variant
master.Cells.ClearContents
For Each sheet In sheets 
      Set ws = ThisWorkbook.Worksheets(sheet) 
      ws.Range("A2:G251").Copy 
      master.Range("A" & master.Range("A" &

master.Rows.Count).End(xlUp).Row + 1).PasteSpecial
xlPasteValues 
Next
Set master = Nothing
Set ws = Nothing
Application.EnableEvents = True
Application.ScreenUpdating = True
End Sub
Edit
Looks like the only that needs to change if you want to have this happen on all
Worksheets is placing it in the Workbook_SheetChange method in the
ThisWorkbook module. Note that there is no longer Me.Range near the top, but
rather Sh.Range. Since a worksheet is calling this method, I don't think it
would make much of a difference using Sh.Range vs Range, but it never hurts.
Answer
Give this a shot.
Most importantly, notice how I Disable Events if the condition is met (then
enable them when the code is done). If you do not turn off events, each time
you paste new data into the worksheet it will trigger the change event, which
you don't want in this case.
Private Sub Worksheet_Change(ByVal Target As Range)
Dim KeyCells As Range
' The variable KeyCells contains the cells that will ' cause an alert when they
are changed. Set KeyCells = Range("F1:F251")
If Not Application.Intersect(KeyCells, Range(Target.Address)) Is Nothing

Then 
      ' Copies contents A2:F251 from each monthly 
      ' sheet to master record sheet. 
      Application.EnableEvents = False 
      Dim wsMR As Worksheet 
      Set wsMR = ThisWorkbook.Worksheets("MasterRecord") 
      wsMR.Cells.ClearContents 
      Dim ws As Worksheet 
      For Each ws In ThisWorkbook.Worksheets 
          Select Case ws.Name 
               Case Is = "January", "February", "March",
"April", _ 
                      "May", "June", "July", "August",
"September", _ 
                      "October", "November", "December" 
                  Dim NextRow As Long 
                  NextRow = wsMR.Range("A" &
wsMR.Rows.Count).End(xlUp).Row + 1 
                  ws.Range("A2:G251").Copy 
                  wsMR.Range("A" & NextRow).PasteSpecial
xlPasteValues 
              End Select 
      Next 
      Application.EnableEvents = True 
End If
End Sub
Topic 200
Subject
Excel VBA Open a workbook from dropbox then Save/Close Current
Workbook
Question

Ok here is the code I have tried so far:
Dim myFileName As String, DTAddress As String, ans As String,
DBPathEstim As String 
   Dim sPath As String, stPath As String, WB1 As Workbook,
WB2 As Workbook, OriginFile As String 
      ' Send the workbook to clients 
      myFileName =
Worksheets("EstimatingSheet").Range("U11").Value & ".xls" 
      sPath = ActiveWorkbook.Path 
      stPathClients = Left(sPath, InStrRev(sPath, "\") - 1) &
"\Clients\" & myFileName 
      ActiveWorkbook.SaveAs stPathClients 
      ActiveWorkbook.Close 
Ok I would like to open a workbook.  The work book path may be
different for different users because we use dropbox.  So it
will always be .....\Dropbox\SSFiles\Estimating 2016.xls 
Topic 201
Subject
Why Is my setting of font size in my Excel Interop code over[ridden,written]?
Question
I set the font size for a range in my code:
var rowRngRptTitle = _xlSheet.Range[_xlSheet.Cells[2, 1], _xlSheet.Cells[2,
13]]; rowRngRptTitle.Merge(Type.Missing);
rowRngRptTitle.Font.Size = 24;
rowRngRptTitle.Font.Bold = true;
rowRngRptTitle.Value2 = String.Format("Delivery Performance - {0} - {1}",
_delPerfBeginDate.ToShortDateString(),
_delPerfEndDate.ToShortDateString());
...but the value does not take effect, or "stick" - the font size is small (it looks
like 10, the same as that in a non-configured range).
However, if I set it later, after the entire sheet has been programmatically

written, by creating a new range:
var rowRngRptTitle2 = _xlSheet.Range[_xlSheet.Cells[2, 1],
_xlSheet.Cells[2, 13]]; rowRngRptTitle2.Merge(Type.Missing);
rowRngRptTitle2.Font.Size = 24;
rowRngRptTitle2.Font.Bold = true;
...it works - the font size is indeed 24 rather than 10.
What could be canceling out the early setting of the size? There is no other
"Font.Size = " in the entire code that refers to that range. In some more context,
here is the code (with unnecessary effluvia elided):
private void PopulateSheet(string shortName) {
if (_xlSheet != null)
{ 
      var rowRngUnitName = _xlSheet.Range[_xlSheet.Cells[1,
1], _xlSheet.Cells[1, 13]]; 
      rowRngUnitName.Merge(Type.Missing); 
      rowRngUnitName.Font.Bold = true; 
      rowRngUnitName.Font.Size = 16; 
      rowRngUnitName.Value2 = shortName; 
      var rowRngRptTitle = _xlSheet.Range[_xlSheet.Cells[2,
1], _xlSheet.Cells[2, 13]]; 
      rowRngRptTitle.Merge(Type.Missing); 
      rowRngRptTitle.Font.Size = 24; 
      rowRngRptTitle.Font.Bold = true; 
      rowRngRptTitle.Value2 = String.Format("Delivery
Performance - {0} - {1}",
_delPerfBeginDate.ToShortDateString(),
_delPerfEndDate.ToShortDateString()); 
      . . . 
      xlSheet.Columns.AutoFit(); 
}
FreezePane(FIRSTDATA_ROW, SUN_ORDERS_COLUMN);

var rowRngRptTitle2 = _xlSheet.Range[_xlSheet.Cells[2, 1],
_xlSheet.Cells[2, 13]]; rowRngRptTitle2.Merge(Type.Missing);
rowRngRptTitle2.Font.Size = 24;
rowRngRptTitle2.Font.Bold = true;
ConfigureForPrinting(_xlSheet.UsedRange.Rows.Count);
if (null != _xlSheet)
{
Marshal.ReleaseComObject(_xlSheet); }
}
It would be a pain if I have to re-designate ranges wherever I want a different-
than-standard/generic/default font size; is there a way to retain the initial font
size assignment for the range?
I initialize the Excel app this way:
private void InitializeExcelObjects()
{
_xlApp = new Excel.Application
{ 
      SheetsInNewWorkbook = 1, 
      StandardFont = "Calibri", 
      StandardFontSize = 10 
};
_xlBook = _xlApp.Workbooks.Add(Type.Missing);
_xlApp.Windows.Application.ActiveWindow.DisplayGridlines = false;
_xlSheets = _xlBook.Worksheets;
_xlSheet = (Microsoft.Office.Interop.Excel.Worksheet)_xlSheets.Item[1]; }
Topic 202
Subject

Tax calculation in vba, run type error '13' type mismatch
Question
Option Explicit
Private Sub Workbook_Open()
Dim Salary As Double
Dim Income As Double
Dim Tax As Double
Dim SalaryAfterTax As Double
Dim strOutput As String
Salary = InputBox("Please indicate your salary", "Salary Calculation")
Income = CDbl(Salary)
Select Case Income
Case Is >= 151000
Tax = 2440 * 0.1 + (37400 - 2440) * 0.2 + (150000 - 37400) * 0.5 + (Salary -
150000) * 0.5
Case Is >= 37401
Tax = 2440 * 0.1 + (37400 - 2440) * 0.2 + (Salary - 37400) * 0.4
Case Is >= 2441
Tax = 2440 * 0.1 + (Salary - 2440) * 0.2
Case Else
Tax = 2440 * 0.1
End Select
SalaryAfterTax = Income - Tax

strOutput = "Your salary after tax is" & SalaryAfterTax
MsgBox strOutput, "Final Salary"
End Sub
Answer
Change
MsgBox strOutput, "Final Salary"
To
MsgBox strOutput, vbOKOnly, "Final Salary"
Or
MsgBox Prompt:=strOutput, Title:="Final Salary"
You are trying to put a string in where a button type is supposed to be.
Topic 203
Subject
Filter fails if a column is blank
Question
Data is filter based on criteria in Col C. copyRng.AutoFilter Field:=3,
Criteria1:="<>"
Filter data is copied to another sheet. It works perfectly when there is at least
one cell with data in that column but if the whole column is blank it copies all
of the rows, however, it shouldn’t copy anything. What can be done fix this
problem? Thank you
Public Sub CopyCLMData()
Dim ws As Worksheet
Dim maxCell As Range
Dim lRowAccess As Long

Dim lRowThisWS As Long
Dim lColThisWS As Long
Dim copyRng As Range, copyRng2 As Range Dim startRow As Long
Dim startCol As Long
Dim maxXLRows As Long
startRow = 2
startCol = 1
Application.EnableEvents = False
Application.ScreenUpdating = False
'copy header row
wsAll.Rows(1).Copy
wsAccess.Rows(1).PasteSpecial xlPasteValues
'get summary counts only once (outside of the loop) maxXLRows =
wsAccess.Rows.Count 'total rows available in summary sheet
'Copy Colon, Lung, and Melanoma data to summary worksheet (Access) For
Each ws In Worksheets
If ws.name = WS_COLON Or ws.name = WS_LUNG Or ws.name =
WS_MELA Then
lRowThisWS = ws.Range("A" & Rows.Count).End(xlUp).Row
Debug.Print lRowThisWS
lColThisWS = 35
'If last row >= StartRow, copy the range
Set copyRng = ws.Range(ws.Cells(startRow - 1, startCol),
ws.Cells(lRowThisWS, lColThisWS)) 'data range
'copyRng.AutoFilter Field:=1, Criteria1:="<>_QC" 'hide QC rows

copyRng.AutoFilter Field:=3, Criteria1:="<>" 'hide blank rows in col C
If copyRng.SpecialCells(xlCellTypeVisible).Count > 1 Then 'if there is any
visible data left 
                  'copy visible range only 
                  Set copyRng =
copyRng.SpecialCells(xlCellTypeVisible).Range(copyRng.Cells(sta
startCol), copyRng.Cells(lRowThisWS, lColThisWS)) 
                  copyRng.Copy  'copy values and formats 
                  With wsAccess.Cells(lRowAccess + 1, "A") 
                      .PasteSpecial Paste:=xlPasteValues,
Operation:=xlNone, SkipBlanks:=False, Transpose:=False 
                      '.PasteSpecial Paste:=xlPasteFormats 
                      .PasteSpecial Paste:=xlPasteFormulas 
                  End With 
              End If 
              'copyRng.AutoFilter Field:=1 
              copyRng.AutoFilter Field:=3 
          End If 
      End If 
Next
Application.CutCopyMode = False
Application.EnableEvents = True
Application.ScreenUpdating = True
End Sub
Topic 204
Subject
Excel combining variables from multiple columns
Question
I have four separate columns of data (numerical data such as "1, 2, 3" and
numerical/alphabetical data such as "3A, 3B"). Each column has about
100,000 rows.

I am trying to select certain rows from each column and combine them. For
instance, in column AJ I would like to select "1, 2", from column AG I would
like to select "3A, 3B", and so forth. I then want the selected rows to all
appear in one larger column.
Can anybody direct me on how to accomplish?
Here is a screen shot of some columns:
Answer
If cell A1 was "1, 2" and B1 was "3A, 3B" then in C1 you could use the
formula:
=CONCATENATE(A1,B1)
This would create "1, 23a, 3b
" in C1. To fix the gaps change it to:
=CONCATENATE(A1,", ",B1)
Which gives cell C1 as: "1, 2, 3a, 3b". You could then obviously add more
values, use ranges or use dynamic values or column names depending on what
your table structure is.
Answer
This array formula will give you the rows that are true in one or the other
columns:
=IFERROR(SMALL(IF((($AG$2:$AG$19=1)+($AG$2:$AG$19=2)+
($AJ$2:$AJ$19="3A"))>0,ROW($2:$19)),ROW(1:1)),"")
It is an array formula and will need to be confirmed with Ctrl-Shift-Enter
instead of Enter when leaving edit mode.
To add criteria just add another to the if statement part. For example if I
wanted to test for 3B I would add +($AJ$2:$AJ$19="3B") after ...+
($AJ$2:$AJ$19="3A")

Also to enlarge the references, make sure you enlarge all. So all the 19s would
increase to the last row of data.
Now if you want to get a value in another column that corresponds with these
rows then add INDEX. For example if you want the value in Column A then:
=IFERROR(INDEX($A$2:$A$19,SMALL(IF((($AG$2:$AG$19=1)+
($AG$2:$AG$19=2)+
($AJ$2:$AJ$19="3A"))>0,ROW($2:$19)),ROW(1:1))-1),"")
This will use the value returned to grab the corresponding value.
The -1 at the end is because we are starting on the second row and we need a 1
based number to use the INDEX.
EDIT
As per you comments I fixed your formula. There were some weird characters
that excel did not like. I had to retype the whole formula:
=IFERROR(SMALL(IF((($AG$2:$AG$29663=1)+($AG$2:$AG$29663=2)+
($AJ$2:$AJ$29663="3B")+($AJ$2:$AJ$29663="3A")+
($AJ$2:$AJ$29663=3)+($AK$2:$AK$29663=1)+($CK$2:$CK$29663=1)+
($CK$2:$CK$29663=2)+($CK$2:$CK$29663=3)+($CK$2:$CK$29663=4)+
($CK$2:$CK$29663=5)+($DN$2:$DN$29663=1)+($DN$2:$DN$29663=2)+
($DN$2:$DN$29663=3)+
($AK$2:$AK$29663=2))>0,ROW($2:$29663)),ROW(1:1)),"")
EDIT2
=IFERROR(SMALL(IF(((($AG$2:$AG$29663=1)+
($AG$2:$AG$29663=2)+($AJ$2:$AJ$29663="3B")+
($AJ$2:$AJ$29663="3A")+($AJ$2:$AJ$29663=3)+
($AK$2:$AK$29663=1)+($AK$2:$AK$29663=2))*
(($CK$2:$CK$29663=1)+($CK$2:$CK$29663=2)+
($CK$2:$CK$29663=3)+($CK$2:$CK$29663=4)+($CK$2:$CK$29663=5)+
($DN$2:$DN$29663=1)+($DN$2:$DN$29663=2)+
($DN$2:$DN$29663=3)))>0,ROW($2:$29663)),ROW(1:1)),"")

Topic 205
Subject
CountA on a closed workbook not working
Question
I am using a Counta function to retrieve the number of columns in a table in a
closed workbook. That table was created from another table in the same
workbook and has hyperlinks in it. The function returns a zero even though
there are 4 columns/headers. I need that number to ReDim an array but I get
'Run-time error '9'. When I open the workbook and delete all columns from the
right of the table right and all rows from the bottom of the table down, save and
close and then try it again, it works. Has anybody experienced this? Thanks for
the help!
Here is the formula:
=COUNTA('" & FilePath & "[" & fileName & "]" & sheetName & "'!1:1)
Answer
I think your formula looks right. You may need to use the following code to
update external Links.
ActiveWorkbook.UpdateLink Name:=ActiveWorkbook.LinkSources
Answer
The following code helped solve my problem. Apparently, it had something to
do with the tables and the calculation setting. Thanks for everyone's input!
wbCalcState = Application.Calculation
Application.Calculation = xlCalculationSemiautomatic
'code here
If wbCalcState <> 0 Then
Application.Calculation = wbCalcState Else
Application.Calculation = xlCalculationAutomatic End If

Topic 206
Subject
Remove all drop downs form all the sheets vba
Question
I'm trying to remove all drop downs form all the sheets in my workbook here is
what I've got but it's only removing the drop downs on the active sheet that i
run it from.
How can i make it work on all sheets?
Sub WorksheetLoop2()
For Each ws In ThisWorkbook.Sheets
Cells.Select
Selection.Validation.Delete
Range("A1").Select
Next
End Sub
Topic 207
Subject
What is the best way to determine if HSSF or XSSF is needed in Apache POI?
[duplicate]
Question
This question already has an answer here:
Determine MS Excel file type with Apache POI
2 answers
I implement an upload service for Microsoft Excel files and can not be sure
what kind of file is uploaded. Sometimes users upload files with xls extension
that contain xlsx content. To parse the files I use Apache Poi and currently I try
at first to parse the uploaded file as HSSFWorkbook and if I catch an exception

then I try to create a XSSFWorkbook.
Is there any smarter way to detect what version is needed?
/** should parse the uploaded file */
private void handleUpload(File file) {
Workbook wb = tryToHandleHSSF(file);
if (wb==null)
wb = tryToHandleXSSF(file);
if (wb!=null) {
// ... do the parsing stuff
}
}
/** helper for HSSF */
private Workbook tryToHandleHSSF(File file) { try {
return new HSSFWorkbook(new FileInputStream(file)); }
catch(Exception e) {
return null;
}
}
/** helper for XSSF */
private Workbook tryToHandleXSSF(File file) { Workbook workbook;
try {
InputStream fin = new FileInputStream(file); BufferedInputStream in = new
BufferedInputStream(fin); try { 
      if (POIFSFileSystem.hasPOIFSHeader(in)) { 
          // if the file is encrypted 
          POIFSFileSystem fs = new POIFSFileSystem(in); 
          EncryptionInfo info = new EncryptionInfo(fs); 
          Decryptor d = Decryptor.getInstance(info); 
          d.verifyPassword(Decryptor.DEFAULT_PASSWORD); 
          workbook = new
org.apache.poi.xssf.usermodel.XSSFWorkbook(d.getDataStream(fs))
      } 
      else 
          return new
org.apache.poi.xssf.usermodel.XSSFWorkbook(in); 

}
finally {
in.close();
}
}
catch(Exception e) {
return null;
}
}
Answer
You could use the SS Usermodel which can handle both XSSF and HSSF
Workbooks.
To load the workbook from the file in a type agnostic way, you may use the
create method from WorkbookFactory.
import org.apache.poi.ss.usermodel.WorkbookFactory; import
org.apache.poi.ss.usermodel.Workbook;
...
// SS Workbook object
Workbook workbook;
// Handles both XSSF and HSSF automatically workbook =
WorkbookFactory.create(new FileInputStream(file));
//Do your parsing using the workbook object
Topic 208
Subject
Excel – Multiple Columns, Different Combinations
Question
I have 4 columns with 4 different parameters, if that's the right word. Each
parameter has about 3-5 variables. What I want to do is I want to create ALL

possible combinations of the 4 different parameters while maintaining the
different columns. So let's say I have the following as an example:
**Column A | Column B | Column C**
Chicago | Football | Red
New York | Soccer | White
Seattle | Hockey | Blue
What I want is to have, all the combinations I could get out of those columns,
which I can illustrate as:
**Column A | Column B | Column C**
New York | Football | Blue
New York | Football | Red
New York | Football | White
New York | Soccer | Blue
New York | Soccer | Red
New York | Soccer | White
New York | Hockey | Blue
New York | Hockey | Red
New York | Hockey | White
Chicago | Football | Blue
Chicago | Football | Red
Chicago | Football | White...

and so on.
Answer
Sorry, I made a terrible mistake. Didn't check out my whole excel. You need to
apply 4 formulas.
Copy in D1:
=IF(ROW()-
ROW($D$1)+1<=COUNTA(A:A)*COUNTA(B:B)*COUNTA(C:C),INDEX(A
ROW($D$1))/(COUNTA(B:B)*COUNTA(C:C))+1)),"")
Copy in E1:
=IF(ROW()-
ROW($E$1)+1<=COUNTA(A:A)*COUNTA(B:B)*COUNTA(C:C),INDEX(B:
ROW($E$1),COUNTA(B:B))+1),"")
Copy in F1:
=IF(ROW()-
ROW($F$1)+1<=COUNTA(A:A)*COUNTA(B:B)*COUNTA(C:C),INDEX(B:
ROW($F$1),COUNTA(B:B))+1),"")
Finally copy in G1:
=+D1&" "&E1&" "&F1
What is does is counts the cells of each column, and if there is not enough for
each combination (leng(A)*leng(B)*leng(C)), it adds one more element.
Answer
This will give you every combination possible:
Function fifth(arr() As Variant) As Variant()
Dim temp() As Variant
Dim i As Long

Dim j As Long
Dim t As Long
ReDim temp(1 To (UBound(arr, 1)) ^ (UBound(arr, 2) + 1), LBound(arr, 2) To
UBound(arr, 2)) As Variant For i = 1 To (UBound(arr, 1) ^ UBound(arr, 2))
For j = 1 To UBound(arr, 2) 
      t = Int((i Mod ((UBound(arr)) ^ j)) / (((UBound(arr)) ^
j) / (UBound(arr)))) 
      temp(i, j) = arr(t + 1, j) 
Next j
Next i
fifth = temp
End Function
You would call thus:
Sub ArrCombine()
Dim ws As Worksheet
Dim arr1() As Variant
Dim rsltarr() As Variant
Set ws = Sheets("Sheet1") 'Change to your sheet
arr1 = ws.Range(ws.Range("A1"),
ws.Range("A1").End(xlToRight).End(xlDown)).Value
rsltarr = fifth(arr1)
ws.Range("A1").End(xlToRight).Offset(, 1).Resize(UBound(rsltarr, 1) - 1,
UBound(rsltarr, 2)).Value = rsltarr
End Sub
It will output on the active sheet, this:

This will use any size range. The only restriction is that #ofRows ^
#ofColumns is not greater than the number of rows available on the sheet.
Answer
To do it by formula I suggest something like that:
In Row 1 we use helper-cells for now (to speed it up for longer lists)
In Columns A to D i have some variables (3 to 5) and for my list i use columns
F to I. F1 simply has =COUNTA(A:A) (copied till I1 -> =COUNTA(D:D))
F2: =INDEX(A:A,MOD(INT((ROW()-2)/PRODUCT(G$1:$I$1)),F$1)+1)
Can be autofilled to H2
G2: =INDEX(B:B,MOD(INT((ROW()-2)/PRODUCT(H$1:$I$1)),G$1)+1)
H2: =INDEX(C:C,MOD(INT((ROW()-2)/PRODUCT(I$1:$I$1)),H$1)+1)
I2 get a slight different formula:
I2: =INDEX(D:D,MOD(ROW()-2,$I$1)+1)
now select F2 to I2 and auto-fill down till column F shows the first value
again... or do a =PRODUCT(F1:H1)+1 -> this is your last row ;)
it can be simply enhanced because except for the right column, the formulas are
auto-fill-able. simply insert a column before column A and F and type in A
what you also need to be there. Column G can be auto-filled from column H.
Don't forget to extend the list downwards as you need it. if you still have any
questions, just ask.
Doing it via VBA is suggest something like that:
Sub test()
Dim inputRng As Range
Set inputRng = ThisWorkbook.Sheets("Sheet1").Range("A:E") 'change this to
fit your needs

Dim inputVal() As Variant
ReDim inputVal(1 To inputRng.Columns.Count) Dim holder() As Variant
Dim i, j, k, xCol, xRow
j = 1: k = 1
'load in values
For Each xCol In inputRng.Columns
xRow = Cells(1, xCol.Column).End(xlDown).Row ReDim holder(0 To xRow)
holder(0) = xRow
j = j * xRow
For i = 1 To xRow
holder(i) = xCol.Cells(i).Value
Next
inputVal(k) = holder
k = k + 1
Next
Dim outputVal() As Variant
ReDim outputVal(1 To j, 1 To inputRng.Columns.Count) k = 1
For i = UBound(outputVal, 2) To 1 Step -1 For j = 0 To UBound(outputVal) - 1
outputVal(j + 1, i) = inputVal(i)((Int(j / k) Mod inputVal(i)(0)) + 1) Next
k = k * inputVal(i)(0)
Next
Dim outputRng As Range
Set outputRng = ThisWorkbook.Sheets("Sheet1").Range("G1") 'set here the
first cell to start output
outputRng.Resize(UBound(outputVal), UBound(outputVal, 2)).Value =
outputVal
End Sub
It is designed to work with different sizes for each spot and you only need to
change 2 lines to perfectly fit your needs. :)

Warning: If one spot only has 1 item, it will fail! (Excel may not respond
anymore)
Topic 209
Subject
Assistance with implementing Subfolder search into my code
Question
I have written a code that searches for and then copies cells from .xls files
(Proposals). My problem is that I have E:\Bids(Year)(Project). I recently
added code to prompt the user (me) to select the subfolder. I read vba-macro-
that-search-for-file-in-multiple-subfolders but I am new to this. I guess I don't
understand how the functions are implemented into the VBA code. Is there a
site that I can go to to learn about this? I am more asking for lessons on fishing
rather than asking you to provide a fish. Please let me know if I should have
posted this as a comment on the above question rather than making a new post.
Sub BidDB()
Dim SummarySheet As Worksheet
Dim FolderPath As String
Dim NRow As Long
Dim FileName As String
Dim WorkBk As Workbook
Dim sourceRange As Range
Dim DestRange As Range
Dim FileToOpen As String
'Application.ScreenUpdating = False
' Create a new workbook and set a variable to the first sheet. Set
SummarySheet = ActiveWorkbook.ActiveSheet
' Folder than contains the files
'FolderPath = "Z:\Bids\"
' Where to insert new rows in the destination workbook. NRow = 3
' Dir to find all Excel files in the folder path. 'FileName = Dir(FolderPath &

"*.xls")
FileName = Application.GetOpenFilename("Excel workbooks (.xls), .xls")
' Loop until Dir returns an empty string. Do While FileName <> "False"
'Open a workbook in the folder
'Set WorkBk = Workbooks.Open(FolderPath & FileName) Set WorkBk =
Workbooks.Open(FileName)
' Set the cell in column A to be the file name. SummarySheet.Range("A" &
NRow).Value = FileName
' Date
Set sourceRange = WorkBk.Worksheets(1).Range("H4:I4") Set DestRange =
SummarySheet.Range("B" & NRow) Set DestRange =
DestRange.Resize(sourceRange.Rows.Count, _
sourceRange.Columns.Count)
DestRange.Value = sourceRange.Value
' Increase NRow so that we know where to copy data next. NRow = NRow +
DestRange.Rows.Count
' Close the source workbook without saving changes. WorkBk.Close
savechanges:=False
' Use Dir to get the next file name. 'FileName = Dir()
FileName = Application.GetOpenFilename("Excel workbooks (.xls), .xls")
Loop
' Call AutoFit on the destination sheet SummarySheet.Columns.AutoFit
'Application.ScreenUpdating = True
End Sub
Topic 210
Subject
Excel 2010 compatibility with Access 2013

Question
We created an Excel application using Excel 2013 that connects to an Access
2013 database that's stored on a network drive (all associates have access to).
It uses "Microsoft Access Database" connection types for all of the data
connections and I have ran the reverse compatibility check in my Excel 2013
and it found no issues. I am also using VBA code to write back to the Access
database. All connections are using the Microsoft.ACE.OLEDB.12.0 provider.
The application works flawlessly for anyone using Excel 2013, however, our
target audience is a mix of 2010 and 2013, so it needs to work for both.
When a user with 2010 opens the application they first get a prompt: "Do you
want to connect to '\\database address.accdb'?"
If you say yes and then proceed to try and connect it gives you an error: "Test
connection failed because of an error in initializing provider. Your network
access was interrupted. To continue, close the database, and then open again."
I've also tried to create connections in Excel 2010 but this led to connection
issues when using 2013.
So in short, we are simply unable to create a universal connection to our
Access 2013 database that works for both 2010 and 2013 Excel versions.
The connection string is as follows in each of the data connections:
Provider=Microsoft.ACE.OLEDB.12.0
;User ID=Admin
;Data Source='file name'
;Mode=Share Deny None
;Extended Properties=""
;Jet OLEDB:System database=""
;Jet OLEDB:Registry Path=""
;Jet OLEDB:Engine Type=6
;Jet OLEDB:Database Locking Mode=1
;Jet OLEDB:Global Partial Bulk Ops=2
;Jet OLEDB:Global Bulk Transactions=1
;Jet OLEDB:New Database Password=""

;Jet OLEDB:Create System Database=False ;Jet OLEDB:Encrypt
Database=False
;Jet OLEDB:Don't Copy Locale on Compact=False ;Jet OLEDB:Compact
Without Replica Repair=False ;Jet OLEDB:SFP=False
;Jet OLEDB:Support Complex Data=False
;Jet OLEDB:Bypass UserInfo Validation=False ;Jet OLEDB:Limited DB
Caching=False
;Jet OLEDB:Bypass ChoiceField Validation=False
Any help would be greatly appreciated!
Answer
My only resolution that I found was to uninstall Office 2013 and install Office
2010. I then recreated the Access Database in Office 2010 and debugged until
it was working.
Office 2010 uses reference "Microsoft Outlook 14.0 Object Library" while
2013 uses "Microsoft Outlook 15.0 Object Library". This resolved some of the
bugs but it still didn't resolve the connection issues.
After I recreated the Access in 2010 I simply re-established the connections
and this resolved it. Simply put (no-brainer for many) if you want it to work in
early versions, dev in early versions.
Thanks for helping.
Topic 211
Subject
Noob but tricky for Excel experts:about counting cell with condition: if two
paird cell is not empty.
Question
had some problem
well i have a problem in excel
i want to count row if a criteria is met. that criteria is to have both pair of cell
is not empty for example
|foo | |

|foo |bar | //- here
| |bar |
|foo |bar | //- here
|foo | |
|foo |bar | //- here
in this example i have two columns with 6 rows.
and i want to count cell that the both columns is not empty.
so the answer is 3
ive tried to use countif but it seems i cant make it like that.
anyone?
Answer
I believe you could also have used:
=COUNTIFS(A1:A25,"<>"&"",B1:B25,"<>"&"")
Answer
You can also use =SUMPRODUCT(--($A$1:$A$25<>"")*--
($B$1:$B$25<>"")) for compatibility with Excel 2003.
Answer
In a few search, I found a useful formula.
=counta(a1:a25)-COUNTIFS(a1:a25,"",b1:b25,"")
counta will give me the total count of my rows.
Then countifs will count the empty cells paired with two columns (so like
having an "and" operator)
Then subtracting them will give me the total number of non-empty paired
columns.

Topic 212
Subject
Sort Multi-Dimensional Arrays in Visual Basic for Applications
Question
I would like to sort a Multi-Dimensional Array holding a name value in the
first column and a date/time in the second. I would like to retrieve value from a
Microsoft Excel Spreadsheet and perform all manipulations via Visual Basic
for Applications and then place it in another spreadsheet and perform
conditional formatting. The entire array will not be going onto the new
spreadsheet.
Sub ListPlatformSyncDates()
'=========================================================
'Description: Selects the entire row for all selected cells and then hides them.
'Originally written by: Troy Pilewski
'Date: 2015-05-12
'Modified by: Troy Pilewski
'Modified on: 2016-02-01
'=========================================================
'Declaration of variables for use during the procedure Dim wsSheet As
Worksheet
Dim lngLastRow As Long, lngLastNOC As Long, lngLastShip As Long,
RowTotal As Long
'Changes the state of the application events Call TOGGLEEVENTS(False)
'Exits the procedure is no workbook is open If ActiveSheet Is Nothing Then
Exit Sub
End If
'Sets the sheets the variables
Set wsSheet = ActiveSheet
'Determine the last row with values
lngLastRow = wsSheet.Range("A:L").Find( _

What:="*", _
After:=wsSheet.Range("A1"), _
LookAt:=xlByRows, _
SearchOrder:=xlByRows, _
SearchDirection:=xlPrevious _
).Row
lngLastNOC = wsSheet.Range("A1:A" & lngLastRow - 15).Find(
What:="", _
After:=wsSheet.Range("A1"), _
LookAt:=xlPart, _
SearchOrder:=xlByRows, _
SearchDirection:=xlPrevious _
).Row
'Debug.Print lngLastRow
'Debug.Print lngLastNOC
'Set the last row of the reported platforms lngLastShip = lngLastRow - 15
RowTotal = lngLastShip - lngLastNOC
On Error Resume Next
'Declares variables for use with the chooser form Dim ClassificationLevel(1)
As String, ClassificationSelection As String
'Assigns the two classifications to the String Array ClassificationLevel(0) =
"Non-Secure Internet Protocol Router Network" ClassificationLevel(1) =
"Secure Internet Protocol Router Network"
'Prompts the user to select a classification ClassificationSelection =
GetChoiceFromChooserForm(ClassificationLevel(), "Classification Level")
Select Case ClassificationSelection
Dim loopCounter As Long, CharPos As Long Dim ship As Range
Dim FullShipName, strFullShipName As String, SplitShipName, NamePart

Case "Non-Secure Internet Protocol Router Network" 
      ReDim NTable(RowTotal, 1) As String 
      loopCounter = lngLastNOC + 1 
      For Each ship In Range("B" & loopCounter & ":B" &
lngLastShip) 
          With Application 
              .DisplayStatusBar = True 
              .StatusBar = "Working with the " & Range("B" &
loopCounter) 
          End With 
          FullShipName =
Split(Replace(WorksheetFunction.Clean(ship), Chr(160),
Chr(32)), Chr(32)) 
          If UBound(FullShipName) > 0 Then 
              If Left(FullShipName, 2) = "US" Or
Left(FullShipName, 2) = "PC" Then 
                  FullShipName(0) = Chr(32) 
              End If 
              strFullShipName = Trim(Join(FullShipName,
Chr(32))) 
              If InStr(strFullShipName, Chr(46)) > 0 Then 
                  SplitShipName = Split(strFullShipName,
Chr(32)) 
                  For Each NamePart In SplitShipName 
                      If InStr(NamePart, Chr(46)) > 0 Then 
                          NamePart = UCase(NamePart) 
                      End If 
                  Next 
                  strFullShipName = Trim(Join(SplitShipName,
Chr(32))) 
'                    Debug.Print strFullShipName 
                  If InStr(strFullShipName, Chr(40)) > 0 Then
                      CharPos = InStr(strFullShipName,
Chr(40)) 
                      strFullShipName = Left(strFullShipName,
CharPos - 1) & Chr(33) & Mid(strFullShipName, CharPos) 
                      SplitShipName = Split(strFullShipName,
Chr(33)) 
                      If UBound(SplitShipName) > 0 Then 
                          SplitShipName(1) =
UCase(SplitShipName(1)) 
                      End If 
                      strFullShipName =
Trim(Join(SplitShipName)) 
'                        Debug.Print strFullShipName 
                  End If 

                  NTable(loopCounter - 13, 0) =
strFullShipName 
                  NTable(loopCounter - 13, 1) = Range("C" &
loopCounter) 
              ElseIf InStr(strFullShipName, Chr(40)) > 0 Then
                      CharPos = InStr(strFullShipName,
Chr(40)) 
                      strFullShipName = Left(strFullShipName,
CharPos - 1) & Chr(33) & Mid(strFullShipName, CharPos) 
                      SplitShipName = Split(strFullShipName,
Chr(33)) 
                      If UBound(SplitShipName) > 0 Then 
                          SplitShipName(1) =
UCase(SplitShipName(1)) 
                      End If 
                      strFullShipName =
Trim(Join(SplitShipName)) 
'                        Debug.Print strFullShipName 
                  NTable(loopCounter - 13, 0) =
strFullShipName 
                  NTable(loopCounter - 13, 1) = Range("C" &
loopCounter) 
              Else 
                  strFullShipName = StrConv(strFullShipName,
vbProperCase) 
'                    Debug.Print strFullShipName 
                  NTable(loopCounter - 13, 0) =
strFullShipName 
                  NTable(loopCounter - 13, 1) = Range("C" &
loopCounter) 
              End If 
          End If 
          Debug.Print NTable(loopCounter - 13, 0) & Chr(32) &
NTable(loopCounter - 13, 1) 
          loopCounter = loopCounter + 1 
      Next ship 
  Case "Secure Internet Protocol Router Network" 
      ReDim STable(RowTotal, 1) As String 
      loopCounter = lngLastNOC + 1 
      For Each ship In Range("B" & loopCounter & ":B" &
lngLastShip) 
          With Application 
              .DisplayStatusBar = True 
              .StatusBar = "Working with the " & Range("B" &
loopCounter) 
          End With 
          FullShipName =
Split(Replace(WorksheetFunction.Clean(ship), Chr(160),

Chr(32)), Chr(32)) 
          If UBound(FullShipName) > 0 Then 
              If Left(FullShipName, 2) = "US" Or
Left(FullShipName, 2) = "PC" Then 
                  FullShipName(0) = Chr(32) 
              End If 
              strFullShipName = Trim(Join(FullShipName,
Chr(32))) 
              If InStr(strFullShipName, Chr(46)) > 0 Then 
                  SplitShipName = Split(strFullShipName,
Chr(32)) 
                  For Each NamePart In SplitShipName 
                      If InStr(NamePart, Chr(46)) > 0 Then 
                          NamePart = UCase(NamePart) 
                      End If 
                  Next 
                  strFullShipName = Trim(Join(SplitShipName,
Chr(32))) 
'                    Debug.Print strFullShipName 
                  If InStr(strFullShipName, Chr(40)) > 0 Then
                      CharPos = InStr(strFullShipName,
Chr(40)) 
                      strFullShipName = Left(strFullShipName,
CharPos - 1) & Chr(33) & Mid(strFullShipName, CharPos) 
                      SplitShipName = Split(strFullShipName,
Chr(33)) 
                      If UBound(SplitShipName) > 0 Then 
                          SplitShipName(1) =
UCase(SplitShipName(1)) 
                      End If 
                      strFullShipName =
Trim(Join(SplitShipName)) 
'                        Debug.Print strFullShipName 
                  End If 
                  STable(loopCounter - 13, 0) =
strFullShipName 
                  STable(loopCounter - 13, 1) = Range("F" &
loopCounter) 
              ElseIf InStr(strFullShipName, Chr(40)) > 0 Then
                      CharPos = InStr(strFullShipName,
Chr(40)) 
                      strFullShipName = Left(strFullShipName,
CharPos - 1) & Chr(33) & Mid(strFullShipName, CharPos) 
                      SplitShipName = Split(strFullShipName,
Chr(33)) 
                      If UBound(SplitShipName) > 0 Then 
                          SplitShipName(1) =
UCase(SplitShipName(1)) 

                      End If 
                      strFullShipName =
Trim(Join(SplitShipName)) 
'                        Debug.Print strFullShipName 
                  STable(loopCounter - 13, 0) =
strFullShipName 
                  STable(loopCounter - 13, 1) = Range("F" &
loopCounter) 
              Else 
                  strFullShipName = StrConv(strFullShipName,
vbProperCase) 
'                    Debug.Print strFullShipName 
                  STable(loopCounter - 13, 0) =
strFullShipName 
                  STable(loopCounter - 13, 1) = Range("F" &
loopCounter) 
              End If 
          End If 
          Debug.Print STable(loopCounter - 13, 0) & Chr(32) &
STable(loopCounter - 13, 1) 
          loopCounter = loopCounter + 1 
      Next ship 
End Select
End Sub
Answer
Here is a link to a previous question regarding how to sort an array.
Once you sort the array, just create a loop to paste the specific array positions
of your desired values back into the worksheet.
Topic 213
Subject
XLS file downloads without file extension
Question
I have a third party integration on a website and part of it is a downloadable
Excel file. When downloading the file, there seems to be no file extension
which results in the computer not knowing to which program the file should be
opened with. If the extension is added manually it works just fine. This

happens at least with Chrome on OSX.
I'm having trouble understanding where the problem is. Is it somehow possible
to configure the server to add the file extension or is the problem in the
browsers settings? Or is the only solution to ask the third party that serves the
file to do something about it?
Thanks in advance.
Topic 214
Subject
Sorting only positive numbers – Largest to Smallest & Sorting only negative
numbers – Smallest to largest in excel
Question
I have a set of data, composed of positive and negative numbers. For
simplicity let’s say the data looks like this:
I would like to sort the data by only positive and negative numbers for “only
top 3 customers”. So the report would look like this:
I have been experimenting with formulas like this, but this formula doesn't help
me achieving the results.
=IFERROR(LARGE(IF(A2:A13>0,A2:A13,""),ROW()),"")
I have data for more than 3000 lines and need only top 20-30 positive numbers
and Top 20-30 negative numbers.
Any help will be greatly appreciated.
Looking forward for the positive response.
Thanks,
Ganesh
Answer
You are overcomplicating your formulas above - but you are on the right track.
Put this formula in row 2 of the Positive column, and drag down for as many

items as you want to highlight:
=IFERROR(MAX(0,LARGE(A:A,ROW()-1)),"")
Note that I have used ROW()-1, instead of ROW(), because we are starting at
row 2, and therefore row 2 should contain the largest amount, not the 2nd
largest amount. I have also forced it to show a 0 if it would otherwise show a
negative number [ie: if you want the largest 5 numbers, and the 5th largest is a
negative #].
The formula for showing the smallest negative formulas is nearly identical:
=IFERROR(MIN(0,SMALL(A:A,ROW()-1)),"")
Answer
this can easily be achieved by using LARGE(range,k) and SMALL(range,k)
formulas which give you the k-th largest or the k-th smallest number in a range,
respectively.
you can use them in combination with the ROW([range]) function which gives
you the row number of the desired range. if you use ROW(A1) as the k for the
aforementioned functions, then dragging the formulas down will yield
ROW(A2), ROW(A3) and so on, which for each row will give you the desired
k value.
so the formula will look like this:
top positive numbers:
=LARGE($A$2:$A$13,ROW(A1))
bottom negative numbers:
=SMALL($A$2:$A$13,ROW(A1))
then you just need to drag the formula down to the nearby cells and you will get
your result.

there's one problem with this approach - if you want to get 20 top positive
numbers but only have, say, 10 positive numbers in the range, the formula will
give you 20 top numbers regardless if they're positive or negative. however, i
believe in your case, this is the easiest and fastest solution and this shouldn't be
a big deal.
Topic 215
Subject
VBA Data Download From Web w/out Affecting Other Tasks?
Question
Is it possible with VBA Excel to download data from a website without
affecting other tasks? What I want to achieve is to be able to press a button and
keep working on other tasks. Right now, when I run the code below, I can't
perform other tasks or the code will break. Thanks for everyone's help/input!
Public Sub Get_File() 
  Dim sFiletype As String     'Fund type reference 
  Dim sFilename As String     'File name (fund type + date of
download), if "" then default 
  Dim sFolder As String       'Folder name (fund type), if ""
then default 
  Dim bReplace As Boolean     'To replace the existing file
or not 
  Dim sURL As String          'The URL to the location to
extract information 
Dim pURL As String
Dim Cell, Rng As Range
Dim Sheet As Worksheet
Dim oBrowser As InternetExplorer
Set oBrowser = New InternetExplorer
Dim StartTime As Double
Dim SecondsElapsed As Double
StartTime = Timer

'Initialize variables
Set Rng = Range("I2:I15")
Set Sheet = ActiveWorkbook.Sheets("Macro_Button")
For Each Cell In Rng 
      If Cell <> "" Then 
      sFiletype = Cell.Value 
      sFilename = sFiletype & "_" & Format(Date, "mmddyyyy") 
      sFolder =
Application.WorksheetFunction.VLookup(Cell.Value,
Sheet.Range("I2:Z15"), 2, False) 
      bReplace = True 
      sURL = "www.preqin.com" 
      pURL =
Application.WorksheetFunction.VLookup(Cell.Value,
Sheet.Range("I2:Z15"), 16, False) 
      'Download using the desired approach, XMLHTTP / IE 
          If
Application.WorksheetFunction.VLookup(Cell.Value,
Sheet.Range("I2:Z15"), 15, False) = 1 Then 
          Call Download_Use_IE(oBrowser, sURL, pURL,
sFilename, sFolder, bReplace) 
          Else 
          Call Download_NoLogin_Use_IE(oBrowser, pURL,
sFilename, sFolder, bReplace) 
          End If 
      Else: GoTo Exit_Sub 
      End If 
Next
Exit Sub
'Close IE
oBrowser.Quit
'Determine how many seconds code took to run SecondsElapsed =
Round(Timer - StartTime, 2) MsgBox "This code ran successfully in " &
SecondsElapsed & " seconds", vbInformation

End Sub
Private Sub Download_Use_IE(oBrowser As InternetExplorer, _ 
                          ByRef sURL As String, _ 
                          ByRef pURL As String, _ 
                          Optional ByRef sFilename As String
= "", _ 
                          Optional ByRef sFolder As String =
"", _ 
                          Optional ByRef bReplace As Boolean
= True) 
Dim hDoc As HTMLDocument
Dim objInputs As Object
Dim ele As Object
On Error GoTo ErrorHandler
oBrowser.Visible = True
'Navigate to URL
Call oBrowser.navigate(sURL)
While oBrowser.Busy Or oBrowser.readyState <> 4: DoEvents: Wend
'Skips log in step if already signed into website On Error GoTo LoggedIn
'Enter username
oBrowser.document.getElementById("ctl00_ctl00_cphSiteHeader_ucLoginForm
= "XXX"
oBrowser.document.getElementById("ctl00_ctl00_cphSiteHeader_ucLoginForm
= "XXX"
'Submit the sign in
oBrowser.document.getElementById("ctl00_ctl00_cphSiteHeader_ucLoginForm
'Wait for website to load
While oBrowser.Busy Or oBrowser.readyState <> 4: DoEvents: Wend
LoggedIn

'Initial data export
oBrowser.navigate (pURL)
'Wait for website to load
While oBrowser.Busy Or oBrowser.readyState <> 4: DoEvents: Wend 'Set the
htmldocument
Set hDoc = oBrowser.document
'Loop and click the download file button Set objInputs =
oBrowser.document.getElementsbyTagName("input") For Each ele In objInputs
      If ele.Title Like "Download Data to Excel" Then 
          ele.Click 
      End If 
Next
'Wait for dialogue box to load
While oBrowser.Busy Or oBrowser.readyState > 3: DoEvents: Wend
Application.Wait (Now + TimeValue("0:00:02"))
'IE 9+ requires to confirm save
Call Download(oBrowser, sFilename, sFolder, bReplace)
Exit Sub
ErrorHandler
'Resume Debug.Print "Sub Download_Use_IE() " & Err & ": " &
Error(Err) End Sub Answer
Try the
DoEvents
As far i know, is not easy to work with background process and excel.
Cheers.
Answer

You cannot work on the Workbook that is running the macro. You can open
another instance of Excel, or a read only copy of the workbook running the
macro if you would like to work within Excel while the macro is running. This
question has been asked and answered before on here
It is difficult to determine from your question whether you are talking about
"other tasks" as in within Excel or just on your computer in general. My above
paragraph answers whether you can do tasks within Excel while the macro is
running.
Topic 216
Subject
Does Excel for Mac 2016 properly import Unicode in .csv files?
Question
A semi-well-known bug in Excel for Mac 2011 causes it to mangle imported
.csv files containing accented Unicode characters. See: Microsoft Excel
mangles Diacritics in .csv files?
For example, Pérez might get imported as PÃ©rez.
My question: has this been fixed in Excel for Mac 2016? Answer
No this has not been fixed in Excel for Mac 2016 and still miss-imports
"Pérez". You can fix it in Excel by opening a New Worksheet, then "Import"
and specifying UTF8 as the encoding. However there does not seem to be a
way to ensure that a file exported from a websit
Topic 217
Subject
VBA - Ignore part of strBody if cell is blank?
Question
I have a VBA script made in Excel 2010 that sends me an email 30 minutes
before a task reaches its due date. The body of the message "strBody" fetches
the value of three cells to make the message unique. It fetches the Name of the
Task, the Notes of the Task and the Due Date of the task.

What I am wondering is if there is a way for a part of this message to be left
out if one of the referenced cell is blank.
In this template below:
"This email is to notify you that your task : " & Cells(FormulaCell.Row,
"A").Value & " with the following note: " & Cells(FormulaCell.Row,
"B").Value & " is nearing its Due Date: " & Cells(FormulaCell.Row,
"E").Value & "." & vbNewLine & "A wise decision would be to complete this
task before it expires!" & _ vbNewLine & vbNewLine & "Truly yours," &
vbNewLine & "Task Manager"
I would like the following section to be removed if
Cells(FormulaCell.Row,"B") is blank.
" with the following note: " & Cells(FormulaCell.Row, "B").Value & "
This is mainly a cleanup process as having an empty area in a message is far
from pretty, and I am using this as a business tool with multiple people in CC.
Currently, a message with a blank Note area looks like:
Hello,
This email is to notify you that your task : Give Denise a Promotion, with the
following note: is nearing its due date: 02/09/2016. A wise decision would be
to complete the task before it expires!
Many thanks!
Answer
Add in an IF ELSE statement.
If Cells(FormulaCell.Row, "B").Value = "" Then
msg = "This email is to notify you that your task : " & Cells(FormulaCell.Row,
"A").Value & " is nearing its Due Date: " & Cells(FormulaCell.Row,
"E").Value & "." & vbNewLine & "A wise decision would be to complete this
task before it expires!" & _ vbNewLine & vbNewLine & "Truly yours," &
vbNewLine & "Task Manager" Else

msg = "This email is to notify you that your task : " & Cells(FormulaCell.Row,
"A").Value & " with the following note: " & Cells(FormulaCell.Row,
"B").Value & " is nearing its Due Date: " & Cells(FormulaCell.Row,
"E").Value & "." & vbNewLine & "A wise decision would be to complete this
task before it expires!" & _ vbNewLine & vbNewLine & "Truly yours," &
vbNewLine & "Task Manager" End If
Add in ElseIf in there if other fields other than note might be blank too.
Answer
I would have an if statement to see if it is empty and then just skip over it. So
instead of one line of code with all the &, break it up into different sentences.
Check to see if there are any values in the strings, then append them into one
string for sending. It will add more code but will look better. So for instance if
you have a part B then your message would append to the sending sting =
A+B+C But if you dont have a value for B then your if statement will then skip
the b section and append only a and c to your sending string. Something like
that would work for your purposes I think.
Answer
You can do it with only one If statement with conditional concatenation
msg = "This email is to notify you that your task : " & Cells(FormulaCell.Row,
"A").Value
If Cells(FormulaCell.Row, "B").Value <> "" Then
msg = msg & " with the following note: " & Cells(FormulaCell.Row,
"B").Value end if
msg = msg & Cells(FormulaCell.Row, "A").Value & " is nearing its Due Date:
" & Cells(FormulaCell.Row, "E").Value & "." & vbNewLine & "A wise
decision would be to complete this task before it expires!" & vbNewLine &
vbNewLine & "Truly yours," & vbNewLine & "Task Manager"
Topic 218

Subject
Excel copy paste to Java TextArea
Question
I am trying to copy paste excel cells (that contain only text). Now I am trying to
split string to lines with this command:
myStringArray = mystring.split(Character.toChars(10).toString());
But I can not split it correctly. like it does not work how to split. I looked in
the ultra edit and the end of the line should be asci 13 and asci 10, but the split
does not work.
What am I doing wrong?
Topic 219
Subject
Range selection error in VBA
Question
I wrote a VBA-code under ThisWorkBook, so that code will run automatically
when I open the Excel file. The code selects a dynamic range by using xlDown,
then it will add a name to the workbook depending on the selection. Check the
code below:
Private Sub Workbook_Open() 
   Sheets("sheet1").Range("E2",
Sheets("sheet1").Range("E2").End(xlDown)).Select 
   ActiveWorkbook.Names.Add Name:="DateList",
RefersTo:=Selection 
End Sub
I am pretty sure that I am writing correctly, but I get an error message like this:
Run time error '1004': Select method of Range Class failed
This error message is highlighting the second line:

Sheets("sheet1").Range("E2",
Sheets("sheet1").Range("E2").End(xlDown)).Select
And when I use the same selection method to clear the same range, it works
without error like below:
Sheets("sheet1").Range("E2",
Sheets("sheet1").Range("E2").End(xlDown)).Clear Answer
Unless there is data underneath that you don't want - I would go with xlUp
instead to prevent an error when there is only a value in E2:
With Sheets("sheet1")
ActiveWorkbook.Names.Add "DateList", .Range(.Cells(2, 5),
.Cells(.Rows.Count, 5).End(xlUp)) End With
Answer
use this:
With Sheets("sheet1")
ActiveWorkbook.Names.Add "DateList", .Range("E2:E" & .[E:E].Find("*", , ,
, , xlPrevious).Row) End With
Topic 220
Subject
Matlab Readtable Slow in Loop
Question
I have a loop that reads several tabs (as chosen by optionsList) of an xls
workbook. It takes a long time to run. I am not sure if it is because it is opening
and closing excel actxserver for each loop? The code is below:
for ii=1:length(optionsList);
optionsTables.(optionsList{ii})=readtable(inputFile,'Sheet',
optionsList{ii},'ReadRowNames',true);

end
What options do I have to optimise this?
I have tried:
Excel = actxserver ('Excel.Application'); if ~exist(inputFile,'file')
ExcelWorkbook = Excel.Workbooks.Add;
ExcelWorkbook.SaveAs(inputFile,1);
ExcelWorkbook.Close(false);
end
Excel.Workbooks.Open(inputFile);
tic
for ii=1:length(optionsList);
optionsTables.(optionsList{ii})=readtable(inputFile,'Sheet',
optionsList{ii},'ReadRowNames',true);
end
Excel.ActiveWorkbook.Save;
Excel.Quit
Excel.delete
clear Excel
toc
Which does not shorten the run time
Answer
As mentioned in the comments, readtable internally calls xlsread to read in
Excel data. It's down the rabbit hole a bit (readtable -> table -> readfromfile -
> readxlsfile -> xlsread) but you can see it in the profiler. Though it also
utilizes ActiveX for speed, it sets up and destroys this interface for every call.
With repeated calls this often leads to a significant "waste" of CPU time.
One potential alternative is to utilize a single ActiveX connection and use your
loop to read each sheet, then convert into a table. This seems like what you

were attempting with the second example with readtable.
An example of this approach:
% Generate sample data file, lazy approach A = rand(10);
for ii = 1:10
sheetname = sprintf('Tab_%u', ii);
xlswrite('asdf.xlsx', A, sheetname); end
% Set up import parameters
optionsList = {'Tab_1', 'Tab_3', 'Tab_5', 'Tab_7', 'Tab_10'};
% Use single ActiveX instance to read in desired data exl =
actxserver('excel.application');
exlWkbk = exl.Workbooks;
exlFile = exlWkbk.Open(fullfile(cd, 'asdf.xlsx'));
% Read the data from the sheet, then convert to table for ii =
1:length(optionsList)
currentSheet = exlFile.Sheets.Item(optionsList{ii}); optionsTables.
(optionsList{ii}) = cell2table(currentSheet.UsedRange.Value); end
% Clean up
exlFile.Close(false);
exl.Quit();
exl.delete();
clear exl
Which returns:
optionsTables = 
   Tab_1: [10x10 table] 
   Tab_3: [10x10 table] 
   Tab_5: [10x10 table] 
   Tab_7: [10x10 table] 

Tab_10: [10x10 table]
I haven't had the opportunity to benchmark this against the other approach, but
it should be faster.
Topic 221
Subject
ClosedXML - Style Rows and Columns in C#
Question
I'm working on a ASP.net Excel project, and I'm trying to add some different
color (red) to an specific cell (M2,N2,O2,P2,Q2).
using (DataTable dt = new DataTable())
{
sda.Fill(dt);
using (XLWorkbook wb = new XLWorkbook()) {
wb.Worksheets.Add(dt, "Customers"); 
      Response.Clear(); 
      Response.Buffer = true; 
      Response.Charset = ""; 
      Response.ContentType = "application/vnd.openxmlformats-
officedocument.spreadsheetml.sheet"; 
      Response.AddHeader("content-disposition",
"attachment;filename=Excel.xlsx"); 
      using (MemoryStream MyMemoryStream = new
MemoryStream()) 
      { 
          wb.SaveAs(MyMemoryStream); 
          MyMemoryStream.WriteTo(Response.OutputStream); 
          Response.Flush(); 
          Response.End(); 
      } 
}
I'm trying to add some rows after wb.Worksheets.Add(dt, "Customers"); but i
cant find the way.

I'm trying to implement this:
dt.Rows(13, 14, 15, 16, 17).Style.Fill.BackgroundColor = XLColor.Red;
Answer
There are two possible ways for this:
dt.Rows(13, 17)... // first and last row as number
dt.Rows("13, 14, 15, 16, 17").... // string with row numbers like in Excel itself
For specific cells you can use similar calls (M2 ... Q2 like in the question):
dt.Range(2, 14, 2, 18)... // row and column numbers for a rectangular area of
cells
dt.Range("M2:Q2")... // string like in Excel
Topic 222
Subject
VBA returns #REF! when Pasting Values
Question
I need VBA to copy and paste values of a range, from A15:I17 to A14:I16.
Here is my code:
Range("A15:I17").Copy
Range("A14").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone,
SkipBlanks:=False, Transpose:=False
It returns the values as #REF! when using the code, but when I manually
preform this action it pastes perfect.
Here is an example of the formula that is in the cells being pasted:
Range("B17").Formula = "=INDEX('Focus Data
Edited'!$G:$G,MATCH(1e99,'Focus Data Edited'!$G:$G))"
Range("C17").Formula = "=(D17+E17)"

Range("D17").Formula = "=INDEX('Focus Data
Edited'!$H:$H,MATCH(1e99,'Focus Data Edited'!$H:$H))"
Range("E17").Formula = "=INDEX('Focus Data
Edited'!$I:$I,MATCH(1e99,'Focus Data Edited'!$I:$I))"
Range("F17").Formula = "=INDEX('Focus Data
Edited'!$J:$J,MATCH(1e99,'Focus Data Edited'!$J:$J))"
Range("G17").Formula = "=INDEX('Focus Data
Edited'!$K:$K,MATCH(1e99,'Focus Data Edited'!$K:$K))"
Range("H17").Formula = "=INDEX('Focus Data
Edited'!$L:$L,MATCH(1e99,'Focus Data Edited'!$L:$L))"
Range("I17").Formula = "=INDEX('Focus Data
Edited'!$M:$M,MATCH(1e99,'Focus Data Edited'!$M:$M))"
Let me know if you can help me!
Thanks,
Hillary
Answer
You can use the macro recorder in order to save your manual process. Once
you have saved your code, try to run it. If that works, you can slightly modify it
to make it look better.
Topic 223
Subject
Using Dynamic fields/values in SUMIFS
Question
I have one large DATA table that is refreshed from a SQL Server.
Example DATA table, 6 x string values and 5 x numeric values:
AREA | COUNTRY | CATEGORY | SALES GROUP | AAA | BBB | SALES $ |
COSTS | VAL1 | VAL 2 | VAL 3
I have second, SUMMARY table with a number of columns that match field
names in the DATA table. These are broken down so you can see summary
values at different levels:

BREAKDOWN | SALES $ | COSTS | VAL1 | VAL 2 | VAL 3
EUROPE SUMIFS | SUMIFS | SUMIFS|SUMIFS|SUMIFS
ENGLAND
- SMALL BUSINESS
- - Joe Green
- - Molly Mongers
- - Patent Felicity
- CORPORATE
- MAJOR
FRANCE
GERMANY
AUSTRIA
I've got a SUMIFS statement which I want to make more dynamic so it
references column names to retrieve different data:
=SUMIFS(qryDATA[COSTS],qryDATA[AREA],"Europe",qryDATA[COUNTR
"France")
I can change the Criteria VALUES to be dynamic thus:
=SUMIFS(qryDATA[COSTS],qryDATA[AREA],D9,qryDATA[COUNTRY],'EX
VIEW'!AC6)
But if I try the same with SUM field or CRITERIA FIELDS, I get an error
(won't accept entry {There's a problem with this formula}). AD8 contains the
text COSTS:
=SUMIFS("qryDATA[" & AD8 &
"]",qryDATA[AREA],D9,qryDATA[COUNTRY],'EXEC VIEW'!AC6)
How can I get the sum field name (COSTS) from the 1st/2nd examples, to be a
cell reference?
Thnx
Answer

Try this:
=SUMIFS(INDEX(qryDATA,0,MATCH(AD8,qryDATA[#Headers],0)),qryDAT
VIEW'!AC6)
Topic 224
Subject
Getting records from Database using two parameters
Question
I am having difficulties for 3 days now trying retrieving Data from sql Server
using a stored procedure with two Parameters. I am keeping on getting the
ERROR 3704. It is all about the recordset and I don't really kown further.
The funny thing is that this `vba code works without parameters.
Public Sub getRecords()
Dim con As ADODB.Connection
Dim cmd As ADODB.Command
Dim rs As ADODB.Recordset
Dim par As String
Dim WSP1 As Worksheet
Set con = New ADODB.Connection
Set cmd = New ADODB.Command
Set rs = New ADODB.Recordset
Application.DisplayStatusBar = True Application.StatusBar = "Contacting
SQL Server..."
' Remove any values in the cells where we want to put our Stored Procedure's
results.
Dim rngRange As Range
Set rngRange = Range(Cells(20, 1), Cells(Rows.Count, 1)).EntireRow
rngRange.ClearContents
' Log into our SQL Server, and run the Stored Procedure con.Open

"Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security
Info=True;Data Source=myServer;Initial Catalog=myDataBase"
cmd.ActiveConnection = con
cmd.CommandType = adCmdStoredProc
cmd.CommandTimeout = 0
'Set up the parameter for our Stored Procedure cmd.Parameters.Append
cmd.CreateParameter("Periode1", adVarChar, adParamInput, 10,
Range("E9").Text) cmd.Parameters.Append cmd.CreateParameter("Periode2",
adVarChar, adParamInput, 10, Range("E11").Text)
Application.StatusBar = "Running stored procedure..." cmd.CommandText =
"spTest"
Set rs = cmd.Execute(, , adCmdStoredProc)
'Copy the results to cell B7 on the first Worksheet Set WSP1 = Tabelle2
WSP1.Activate
'If rs.EOF = False Then Range(Cells(2, 1), Cells(Rows.Count, 1)).EntireRow
If rs.EOF = False Then WSP1.Cells(2, 1).CopyFromRecordset rs
rs.Close
Set rs = Nothing
Set cmd = Nothing
con.Close
Set con = Nothing
Application.StatusBar = "Data successfully updated."
End Sub
The Runtime Error is on this line:
If rs.EOF = False Then
Will appreciate a help or an alternative Answer

Stored procedure should return table:
CREATE PROCEDURE spTest
@Param1 AS INT,
@Param2 as INT
AS
BEGIN
SELECT TOP 10 * FROM Test
WHERE Param1=@Param1
AND Param2=@Param2
END
This error appears when you don’t return table by procedure but value
Topic 225
Subject
What auto-formatting Excel performs when copying data?
Question
I am trying to move VBA functionality to .NET Excel Add-in project. This is a
data import tool that does some data normalization before importing data. But I
am having problems to understand data normalization that Excel is making
automatically (to capture all the transformations that I need to re-implement in
.NET side).
Specifically - Excel import file has range with strings, that has essentially
numbers with thousand separators - now, copying this range in Excel using
VBA script automatically converts these strings to numbers (and removes those
thousand separators). For date time values there are very many automatic
transformations to recognize date in string value.
I tried to find information on this auto-formatting (a list of what transformations
are made on copying values from Excel to Excel), but so far I managed to find
only some hacks on how to prevent auto-formatting, but no info on what exact
formatting rules/logic is performed on string values.

Can anybody share this information?
Topic 226
Subject
Excel vba, Make cell containing hyperlink appear in email body
Question
I have a code that is sending an email to users when a submittal date is added.
In the body of this email I am referring to a cell that contains a hyperlink to a
folder. the destination of this hyperlink is appearing but it is not active,
meaning it appears only as text. Here is my code, and the hyperlink cell is
referred to in the email body
Private Sub Worksheet_Change(ByVal Target As Range)
Dim KeyCells As Range
' The variable KeyCells contains the cells that will ' cause an alert when they
are changed. Set KeyCells = Range("J3:J1000")
If Not Application.Intersect(KeyCells, Range(Target.Address)) _
Is Nothing Then 
      ' Display a message when one of the designated cells
has been 
      ' changed. 
      ' Place your code here. 
Dim answer As String
Dim SubmitLink As String
SubmitLink = Target.Offset(, -8).Value
answer = MsgBox("Do you wish to save this change. An Email will be sent to
the User", vbYesNo, "Save the change")
If answer = vbNo Then Cancel = True
If answer = vbYes Then

'open outlook type stuff
Set OutlookApp = CreateObject("Outlook.Application") Set OlObjects =
OutlookApp.GetNamespace("MAPI") Set newmsg =
OutlookApp.CreateItem(olMailItem) 'add recipients
'newmsg.Recipients.Add ("Name Here")
newmsg.Recipients.Add Worksheets("Coordinator").Range("Q4").Value 'add
subject
newmsg.Subject = Worksheets("Coordinator").Range("O3").Value 'add body
newmsg.Body = "Dear User, New Submittal ( " & SubmitLink & " ) has been
Added in submittal Log. Please Investigate the Change" & vbLf & vbLf & vbLf
& "Sincerely,"
newmsg.Display 'display
newmsg.Send 'send message
'give conformation of sent message
MsgBox "Modification confirmed", , "Confirmation"
End If
' MsgBox "Cell " & Target.Address & " has changed."
End If
End Sub
Explanatory Image
Answer
At the moment the e-mail you're creating is Plain Text, and because of this it's
essentially down to the client receiving the e-mail as to whether or not it will
automatically attempt to turn things which look like they should be hyperlinks
into actual hyperlinks. A file path in the format C:\Path\to\file.xls is not
something this would ordinarily apply to.
The proper way to do this would be to use the HTMLbody property of your
MailItem newmsg, and to parse your information into HTML specifying what
exactly should be a hyperlink.
A slightly 'cheaty' but quite a simple way of doing this using only Plain Text

would be to amend your path slightly. If you append file:// to your path some e-
mail clients including Outlook will automatically create a hyperlink for you.
So, for example, you would change your newmsg.Body line to read:
newmsg.Body = "Dear User, New Submittal ( file://" & SubmitLink & " ) has
been Added in submittal Log. Please Investigate the Change" & vbLf & vbLf &
vbLf & "Sincerely,"
Which would produce a hyperlink like file://C:\Path\to\file.xls. Obviously if
the e-mail client your recipients are using does not create automatic hyperlinks
as I've described here, then you will need to build a HTMLBody to get
hyperlinks working correctly.
Edit in response to comment, to give a brief explanation of how you would use
HTMLBody. Instead of setting newmsg.Body you instead set
newmsg.HTMLBody to your HTML formatted message. In the very simplest of
terms you could build your existing message as follows.
Dim emailBody As String
' At the very minimum your basic HTML page is made up of: ' <html>
' <body>
' Your message, including any formatting or hyperlniks. ' </body>
' </html>
'
emailBody = "<html><body><font face=""Arial, sans-serif"">" emailBody =
emailBody & "Dear User, New Submittal " emailBody = emailBody & "<a
href=""" & SubmitLink & """>" & SubmitLink & "</a>" emailBody =
emailBody & " has been Added in submittal Log. Please Investigate the
Change<br><br><br>Sincerely," emailBody = emailBody & "</font></body>
</html>"
newmsg.HTMLBody = emailBody
I would suggest taking at a look W3Schools if you want to learn further about
building HTML.
Topic 227

Subject
COUNTIF with a positive and negative criteria
Question
I need to count the number of cells in which the cells in "LIST A" appear in the
set of values contained in column D AND the cells in "LIST B" do not appear
in column E.
I am trying to use something like the following array formula, but so far have
had limited success:
={SUM(COUNTIFS(A2:A21,D2:D5,B2:B21,"<>"&E2:E3))}
Please note that the data contained in this example is different to the data in my
real table. The real table is considerably longer and more complex than this
table.
Any suggestions?
Answer
just for your example the formula like in my comment will be enough
=SUMPRODUCT(COUNTIF(D2:D5,A2:A21)*NOT(COUNTIF(E2:E5,B2:B2
the problem ocures if you have multiple values you want to exclude. then you
need to use a negative countif(s)
=SUMPRODUCT(1*NOT(COUNTIF(E2:E5,B2:B21)))
this would count all lines which contain anything of the exclude list. But the
NOT inside the sumproduct will switch it to opposite (the 1* is needed cus it
would only contain bool which can't be count)
if you have column C with bool (true/false or 1/0) you can simply add that:
=SUMPRODUCT(COUNTIF(D2:D5,A2:A21)*NOT(COUNTIF(E2:E5,B2:B2
or also (C2:C21>12) if that is what you need... but you also could include it to
the include list (if A is A/B/E/F and C is (2/4/6)

=SUMPRODUCT(COUNTIFS(D2:D5,A2:A21,F2:F5,C2:C21)*NOT(COUNTI
But every exclude needs its own countif (B is not X/Y and C is not 8/9/11)
=SUMPRODUCT(COUNTIFS(D2:D5,A2:A21)*NOT(COUNTIF(E2:E5,B2:B2
As already said: Having formulas which return "" may return false counts
(keep that in mind)
Answer
Best to switch to SUMPRODUCT in such cases:
=SUMPRODUCT(0+ISNUMBER(MATCH(A2:A21,D2:D5,0)),1-
ISNUMBER(MATCH(B2:B21,E2:E5,0)))
Regards
Topic 228
Subject
VBA Forms.ComboBox not changing on event
Question
Description
I'm not getting my Forms.ComboBox to change on the Change event. It seems
like the event code doesn't fire. But it does! However, if I step through the
code, it works perfectly. Can't figure out why this happens.
What should happen:
"CauseBox1" changes (user picks from its drop-down list) If the value in
CauseBox1 has the word "reason" in it, then "CommentaryBox1" should be
enabled. If not, then "CommentaryBox1" should be disabled. I'm using a
Boolean named Editing, which I set to True at the beginning of the code (and to
False at the end of the code). The reason for this is that I'm using MsForms
Combobox. Their Change event code runs even though
Application.EnableEvents = False. So it's a precaution for making sure no
other Change event runs when this one does...

Private Sub CauseBox1_Change()
If Editing Then Exit Sub
Editing = True
If InStr(1, CauseBox1.Text, "reason") > 0 Then If CommentaryBox1.Enabled =
False Then CommentaryBox1.Enabled = True Else
If CommentaryBox1.Enabled = True Then CommentaryBox1.Enabled = False
End If
Editing = False
End Sub
Here's where it gets wrong:
CauseBox1 changes and "reason" is found within its value CommentaryBox1
stays disabled. I can't type in it. In order for the CommentaryBox1 to become
enabled, I have to step through the Change event code with F8. Then it
suddenly works.
Why is this happening? What am I missing?
Edit
I'm in a Worksheet, not a Userform. Answer
I had a button that cleared all the OLEObjects (ComboBoxes/TextBoxes) in the
Worksheet. That code was messing things up. The very last piece of code,
oCommentary1.Object.Enabled = False, was what created the error. Since I
use Change events, I don't need to force-disable the Commentary boxes.
Whenever I change the value (as in above code), the events would fire. I can't
really say what's making this error. Is it correct to refer to the
MsForms.ComboBox (ActiveX) as an OLEObject?
Public oDate As OLEObject, oAge As OLEObject, oGender As OLEObject,
oInitials As OLEObject Public oCause1 As OLEObject, oCause2 As
OLEObject, oCause3 As OLEObject Public oCommentary1 As OLEObject,
oCommentary2 As OLEObject, oCommentary3 As OLEObject
Sub ClearForm()
With Worksheets("Form") 

      Set oDate = .OLEObjects("DateBox") 
      Set oInitials = .OLEObjects("InitialBox") 
      Set oGender = .OLEObjects("GenderBox") 
      Set oAge = .OLEObjects("AgeBox") 
      Set oCause1 = .OLEObjects("CauseBox1") 
      Set oCause2 = .OLEObjects("CauseBox2") 
      Set oCause3 = .OLEObjects("CauseBox3") 
      Set oCommentary1 = .OLEObjects("CommentaryBox1") 
      Set oCommentary2 = .OLEObjects("CommentaryBox2") 
      Set oCommentary3 = .OLEObjects("CommentaryBox3") 
End With
oDate.Object.Value = ""
oInitials.Object.Value = ""
oGender.Object.Value = ""
oAge.Object.Value = ""
oCause1.Object.Value = ""
oCommentary1.Object.Value = ""
oCause2.Object.Value = ""
oCommentary2.Object.Value = ""
oCause3.Object.Value = ""
oCommentary3.Object.Value = ""
oDate.Activate ' Selects the date box
' Disables the Commentary Boxes (since the Cause Boxes are empty)
oCommentary1.Object.Enabled = False oCommentary2.Object.Enabled =
False oCommentary3.Object.Enabled = False End Sub
Topic 229
Subject
Excel spreadsheet with maths
Question
hi i am having trouble with working out this problem i have been given on
excel, i am new to it so please could somebody help me :)
here is the question

A company has an asset valued at £4000 which it believes will lose 5% of its
value each year. Create a spreadsheet to show the value of the asset each year
for 12 years and the corresponding amount of depreciation. Ensure that your
spreadsheet allows you to change the initial value of the asset and the
depreciation rate easily.
Use the IF-function to allow you to specify the number of years to list in the
table. Answer
If A1 contained the 4000 and A2 contained the percentage of depreciation then
a formula for the end of that year could be A1/100*(100-A2). Hopefully that
makes sense and you have that part and are just unsure on the IF-statement part.
Basically what they are asking is to enclose the formula above in an IF that
asks if the years are less than those allowed (which you would specify as the
question states)
How to use IF - http://www.exceltrick.com/formulas_macros/excel-if-
statement/
Topic 230
Subject
Excel function to sort two columns into one
Question
I have two txt files. First one has data like so.
A
B
C
D
E
the second one has data like so.
A1
A2
+++
B1
B2

B3
+++
C1
C2
C3
C4
+++
+++
E1
E2
E3
E4
E5
E6
I want them sorted like so.
A,A1
A,A2
B,B1
B,B2
B,B3
...
...
...
D,
E,E1
E,E2
E,E3
E,E4
E,E5
E,E6
Notice that column D from first txt file has no matching sub columns! How can
I sort these data? Answer
This isn't really an Excel question, but having to massage data files was

something I often had to do in the past, and Excel can be put to use on these
one-off data transformation problems.
Load the first into a sheet and add a column called "Type" and populate it with
"Primary", like so:
Import the second file into a sheet, and add a column called "Type", and use a
formula to populate the type column. I'm assuming from your example you have
some "junk" delimiters, and this formula can flag those.
The formula for the example data would look like below. You can change the
literal or logic according to the actual data.
=IF(A7="+++","Ignored","Secondary")
Merge the two tables (cut and paste is fine) into a new sheet, and sort them by
key, so you end up with this sheet:
Now we can get the composite key by adding two columns with formulas. Add
a "Derived Primary" column with this formula.
=IF(ROW(B2)>2,IF(B2="Primary","A2,C1),"")
(The formula above assumes you have a header row like my example and the
data starts on the second row.)
Adding a "Composite Key" column that uses this formula:
=IF(B2="Ignored","",IF(B2="Primary",IF(C2=C3,"", C2 &","),C2 &","&A2))
Basically, the logic above checks for one of three conditions:
"Ignored" type: show nothing in the composite key. "Secondary" type: combine
the "Derived Primary" with the "Key" "Primary" type: if the derived primary
value of the next row matches the current derived primary value, show nothing,
otherwise, show the derived primary value. (i.e. a singleton primary key with
no secondaries.)
Then your sheet will look like this:

You can copy the last column out, and sort it to remove the blanks.
I'm guessing your real situation has a lot more data and the values may vary for
the junk delimiters, so adjust the formulas as necessary. Hope it helps.
Topic 231
Subject
How do I limit the source data for a chart using VBA?
Question
I've written a module to stack plates onto rolltrailers, where the number of
rolltrailers is unknown at start. In the process of outputting the report, it
includes a chart to show how fully utilized the capacity of each trailer is.
However, because the number of RTs is unknown to start with, I'd like to add
some code to adjust the source reference for the chart so it shows all the used
trailers but no empty ones. The total number of rolltrailers is held in the iRTNo
variable.
I first tried recording a macro and trying to include the variable in it, but that
didn't work. My second attempt was this:
With wsReport.ChartObjects("Chart 3")
.SetSourceData Source:=Sheets("RTTRACK").Range(Cells(2, 9),
Cells(iRTNo + 1, 9)) End With
But that doesn't work either. Any suggestions? Answer
SetSourceData should work but you aren't properly qualifying the Cells calls
and you need to use the Chart property of the Chartobject:
With Sheets("RTTRACK")
wsReport.ChartObjects("Chart 3").Chart.SetSourceData
Source:=.Range(.Cells(2, 9), .Cells(iRTNo + 1, 9)) End With
Topic 232
Subject

Google Sheets: How to find maximum value corresponding to another column
Question
I am trying to return Exclude/Include text in column D of the attached google
sheet on the basis of the following criteria:
Column C i.e. 'Team Member' contains duplicate values i.e. Team Member
names are repetitive i.e. name 'Alice Cook' mentioned in cell C2 can occur any
number of times and Column A contains dates. If there are multiple entries for
a team member in column C, then I would like to retrieve the text 'Include' in
column D in case of the latest date for that team member, else return 'Exclude'.
For example. In case of 'Alice Cook' cell D2 should show 'Exclude' as the
latest date for 'Alice Cook' is 8/18/2015 and hence cell D7 will show
'Include'. Answer
It took me a while, but this works. Copy this to C2 then copy the formula down.
=if(and($A2="",$B2=""),"",if($A2=
(ARRAYFORMULA(MAX(if($B$2:$B=$B2,$A$2:$A)))),"Include","Exclude
It will let you add new data in A & B and C will be blank until data is added
(if C is filled down that far)
Answer
Update: single formula
Here's arrayFormula to paste in D2, it'll populate automativally:
=ArrayFormula(
if(A2:A9=VLOOKUP(OFFSET(C2;;;counta(A2:A));QUERY(A2:C;"select C,
max(A) where C <> '' group by C label max(A) ''");2;0);"In";"Ex") )
Please, look at sample spreadsheet.
Topic 233
Subject
VBA - Worksheet dynamic referencing

Question
Following is the piece of code that picks up the "worksheet" name (Rng1) &
"Cell" address (Rng2) from a tab which has mapping in it. The purpose of this
code is to pick up the values from Rng3 & Rng4 when location specified by
Rng1 & Rng2 is empty.
Rng1(i).Value is giving me the correct worksheet name. However, when I'm
trying to use Worksheets(Rng1(i).Value).Name the compiler is unable to pick
up the worksheet name (which should be Rng1(i).Value itself)
Can anyone please advise on this?
Please do let me know if you more briefing on the query
----------------------- Code --------------------------------------
Sub RoundedRectangle1_Click()
Dim Rng1 As Range
Dim Rng2 As Range
Dim Rng3 As Range
Dim Rng4 As Range
On Error Resume Next
Set Rng1 = Worksheets("Final Mapping").Range("E1:E5119") 
    Set Rng2 = Worksheets("Final Mapping").Range("F1:F5119") 
    Set Rng3 = Worksheets("Final Mapping").Range("B1:B5119") 
    Set Rng4 = Worksheets("Final Mapping").Range("C1:C5119") 
For i = 1 To 5119
If ActiveWorkbook.Worksheets(Rng1(i).Value).Range(Rng2(i).Value).Value =
Empty Then MsgBox Worksheets(Rng3(i).Value).Range(Rng4(i).Value).Value
Next i
End Sub
Topic 234

Subject
Copy a reference formula down to stay in line with updating data
Question
I have a macro and one of the columns it produces is a column of dates. I wish
to use this excel formula
=IF(COUNTIF(Sheet2!A9:A102,K2)>0, K2,J1)
But have it copy down so it always goes as far as the column of dates do its
left. Basically when a new date gets added, this formula will copy down
another cell. I tried using this:
Range("J2:J" & LastRow).FormulaR1C1 =
"=IF(COUNTIF(Sheet2!R[7]C[-9]:R[100]C[-9],RC[1])>0, RC[1],R[-1]C)"
But get "method 'range' of object '_global' failed. Answer
This Works. The destination of lastrow was incorrect but this now tracks the
data in the row to the left.
Range("J2:J" & (Range("I" & Rows.Count).End(xlUp).Row)).FormulaR1C1 =
"=IF(COUNTIF(Sheet2!R[7]C[-9]:R[100]C[-9],RC[1])>0, RC[1],R[-1]C)"
Topic 235
Subject
Formatting excel cells - remove all except digits
Question
Is there any way to write some formula which will remove all the characters
from a cell and filter out just digits/numbers?
For example:
po63;22kv to be 6322.
It is a simple question and in some programming languages there is a method
for that, so I suspect that there exist such a thing in excel as well, but so far I
didn't find a solution! Answer

Limited to a total of 15 numerics per string, array formula**:
=NPV(-0.9,IFERROR(MID(A1,1+LEN(A1)-
ROW(INDEX(A:A,1):INDEX(A:A,LEN(A1))),1)/10,""))
Format cell as General (Excel has a habit of assuming the return from NPV
will be currency).
Regards
**Array formulas are not entered in the same way as 'standard' formulas.
Instead of pressing just ENTER, you first hold down CTRL and SHIFT, and
only then press ENTER. If you've done it correctly, you'll notice Excel puts
curly brackets {} around the formula (though do not attempt to manually insert
these yourself).
Answer
After some further thought (see my comments beneath XOR's post) I have an
alternative to XOR's formula - very similar in process but uses different steps
to get there:
=SUBSTITUTE(TEXT(SUM(IFERROR(LEFT(RIGHT(A1,ROW(A:A)))*10^(
As this is an Array Formula, it must be confirmed with CTRL + SHIFT +
ENTER, instead of just ENTER or TAB.
What this does is take the individual characters of the string in A1, starting
with the character furthest to the right [it uses the RIGHT formula to start from
the right-most character, going for an initial length of 1, then 2, etc. to the length
of the string, and then it uses the LEFT character to grab the particular
iteration], and it attempts to multiply that character by 10^[decimal place]. If it
creates a #VALUE error it indicates that the character is a string, not a number.
Otherwise, it puts each character in the decimal place associated with with its
position in the original string.
It then converts the whole thing to a string and substitutes out the "0"s with "",
to correct the fact that the decimal places are not yet correct. As with XOR's

formula, this fails if the final number is > 10^15, because of floating-point
calculation issues with Excel.
I don't think this is necessarily a simpler way to do it, just a different way, that
may help you understand how it works.
Topic 236
Subject
C# Searching through a excel workbook
Question
i want to search an excel file using c# to find a specific sting of text
(ASSEMBLY).I have this little code writed:
private void button1_Click(object sender, EventArgs e) {
string File_name = "C:\\test.xls";
Microsoft.Office.Interop.Excel.Application oXL = new
Microsoft.Office.Interop.Excel.Application();
Microsoft.Office.Interop.Excel.Workbook oWB;
Microsoft.Office.Interop.Excel.Worksheet oSheet; try
{ 
      object missing = System.Reflection.Missing.Value; 
      oWB = oXL.Workbooks.Open(File_name, missing, missing,
missing, missing, 
          missing, missing, missing, missing, missing,
missing, 
          missing, missing, missing, missing); 
      oSheet =
(Microsoft.Office.Interop.Excel.Worksheet)oWB.Worksheets[3]; 
      Microsoft.Office.Interop.Excel.Range oRng =
GetSpecifiedRange("ASSEMBLY", oSheet); 
      if (oRng != null) 
      { 
          MessageBox.Show("Text found, position is Row:" +
oRng.Row + " and column:" + oRng.Column); 
      } 
      else 
      { 
          MessageBox.Show("Text is not found"); 
      } 

      oWB.Close(false, missing, missing); 
      oSheet = null; 
      oWB = null; 
      oXL.Quit(); 
}
catch (Exception ex)
{
}
}
private Microsoft.Office.Interop.Excel.Range GetSpecifiedRange(string
matchStr, Microsoft.Office.Interop.Excel.Worksheet objWs) {
object missing = System.Reflection.Missing.Value;
Microsoft.Office.Interop.Excel.Range currentFind = null;
Microsoft.Office.Interop.Excel.Range firstFind = null; currentFind =
objWs.get_Range("A1", "AM100").Find(matchStr, missing, 
                
Microsoft.Office.Interop.Excel.XlFindLookIn.xlValues, 
                
Microsoft.Office.Interop.Excel.XlLookAt.xlPart, 
                
Microsoft.Office.Interop.Excel.XlSearchOrder.xlByRows, 
                
Microsoft.Office.Interop.Excel.XlSearchDirection.xlNext,
false, missing, missing); 
return currentFind;
}
This works ok, it can find the given string from the workbook. But, the
workbook has many worksheets and now i'm only searching for one (sheet 3).
How to search throught the whole workbook?
Also, this excel document has the word "ASSEMBLY" many times. How to
keep searching and show all the results and not just the first one?

Topic 237
Subject
how to convert mat file into xlsx file
Question
After executing code, I received an error:
load('firstdiff.mat')
xlswrite('test.xlsx', firstdiff)
mat file consist only numeric values (0 and 1)
Undefined function or variable 'firstdiff' Answer
Using load without output arguments is something which often confuses
programmers. I recommend to use it with an output argument:
data=load('firstdiff.mat')
This way you get a struct containing the data of your mat file. A typical next
step would be using fieldnames(data) to check which variables are present or
if you already know, index a variable with an expression like data.x
In this case I assume you only have one variable in your matfile.
data=load('firstdiff.mat');
fn=fieldnames(data); %get all variable names assert(numel(fn)==1); %assert
there is only one variable in your mat, otherwise raise error firstdiff=data.
(fn{1}); %get the first variable xlswrite('test.xlsx', firstdiff); %write it
Topic 238
Subject
Delete Replicates from the first column
Question
i am looking for a way to delete rows in a column that countains replicates in
the first column. The function RemoveDuplicates doesnt seems to work
properly , do you have any idea ? Thanks. Answer

i found this on internet. works great.
deleting duplicate rows based on a column of cells that I highlighted.
Public Sub DeleteDuplicateRows()
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ' DeleteDuplicateRows
' This will delete duplicate records, based on the Active Column. That is, ' if
the same value is found more than once in the Active Column, all but ' the first
(lowest row number) will be deleted. '
' To run the macro, select the entire column you wish to scan for ' duplicates,
and run this procedure.
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' Dim R As Long
Dim N As Long
Dim V As Variant
Dim Rng As Range
On Error GoTo EndMacro
Application.ScreenUpdating = False
Application.Calculation = xlCalculationManual Set Rng =
Application.Intersect(ActiveSheet.UsedRange, _
ActiveSheet.Columns(ActiveCell.Column)) Application.StatusBar =
"Processing Row: " & Format(Rng.Row, "#,##0") N = 0
For R = Rng.Rows.Count To 2 Step -1
If R Mod 500 = 0 Then
Application.StatusBar = "Processing Row: " & Format(R, "#,##0") End If
V = Rng.Cells(R, 1).Value
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ' Note that COUNTIF works oddly with
a Variant that is equal to vbNullString. ' Rather than pass in the variant, you
need to pass in vbNullString explicitly. '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
If V = vbNullString Then
If Application.WorksheetFunction.CountIf(Rng.Columns(1), vbNullString) > 1
Then Rng.Rows(R).EntireRow.Delete
N = N + 1
End If
Else
If Application.WorksheetFunction.CountIf(Rng.Columns(1), V) > 1 Then
Rng.Rows(R).EntireRow.Delete
N = N + 1
End If

End If
Next R
EndMacro:
Application.StatusBar = False
Application.ScreenUpdating = True
Application.Calculation = xlCalculationAutomatic MsgBox "Duplicate Rows
Deleted: " & CStr(N) End Sub
Topic 239
Subject
subtracting integer from a date format VBA
Question
Below is the code i have developed. The objective is to subtract "1" or "2"
from the data, depending on if is a saturday or a sunday, respectively. Column
3 contains the dates in short date format, column 5 contains the same dates but
converted to "dddd" format.
The error occurs within the for loop at the line
if cells(i,5).Value = "Sat" Then
The interesting thing here is that the code runs without an "error" per say, it just
skips over the if statement complelety, at that line.
Sub DataChange()
Dim i
Dim n
n = Cells(Rows.Count, 3).End(xlUp).Row For i = 4 to n 
      If Cells(i,5).Value = "Sat" Then 
          Cells(i,3).Value = Cells(i,3).Value - 1 
      End If 
      If Cells(i,5).Value = "Sun" Then 
          Cells(i,3).Value = Cells(i,3).Value - 2 
      End If 
Next i

End Sub
Answer
Just replace it all with:
For i = 1 To Cells(Rows.Count, 3).End(xlUp).Row
With Cells(i, 3)
.Value = .Value - IIf(Weekday(.Value, vbSaturday) < 3, Weekday(.Value,
vbSaturday), 0) End With
Next
The Weekday() method returns an integer representing a day of the week, based
on the start day that you provide. Weekday(.Value, vbSaturday) will return 1
for Saturday, and 2 for Sunday. Combined with an immediate If IIf() we can
check that the value returned is less than 3 (e.g. 1 or 2) and if it is, subtract that
from the date in column C
Answer
column 5 contains the same dates but converted to "dddd" format
"dddd" exposes "Saturday" not "Sat" that is exposed with "ddd".
Still try to change Cells(i,5).Value with Cells(i,5).Text:
If Cells(i,5).Text = "Sat" Then ....
or
If Cells(i,5).Text = "Saturday" Then ....
Topic 240
Subject
Excel 2010 Cell Validation - Grouped List
Question
Is it possible (without the use of user forms, or form controls) to have a

grouped validation list in-cell, where the group title cannot be selected. So for
example:
Fruit
Apple
Banana
Veg
Potato
Carrot
I feel like I've been searching for an absolute age now, and I'm getting no
where fast. The reason I cannot use form controls as that there are 8 sheets,
each with a few thousand rows (possible) and each entry must have this
selection. I have done this before with dependant lists across multiple columns
but I'd like to trim everything down.
Any ideas? I don't want a clear cut solution if one exists, just a nudge in the
right direction. Any help appreciated. Answer
No you can't do that since no property exist in excel to do your expected task
without Userform.
Topic 241
Subject
Using excel vba to change the value of a dropdown menu on a website2
Question
How i can choose a specific value using excel vba?
<div class="drpSirketler">
<select class="selectBox homepage selectSirketler" style="padding-bottom:
10px; padding-left: 10px; padding-right: 10px; padding-top: 10px"> <option
selected="selected" value="default">Şirket Seçiniz</option> <option
selected="selected" value="-1">Tüm Finansal Tablolar</option> <option
value="1626">ACISELSAN ACIPAYAM SELÜLOZ SANAYİ VE TİCARET
A.Ş.</option> <option value="831">ADANA ÇİMENTO SANAYİİ T.A.Ş.
</option> Answer

Where doc is the HTMLdocument object:
doc.GetElementsByClassName("selectBox homepage selectSirketler")
(0).Value = "default"
should produce the "Şirket Seçiniz" value.
If there are other elements in the document with the same class name, then you
will have to iterate through the collection of those tags and test each one.
Topic 242
Subject
How to insert float values separated by a comma to Excel?
Question
Hello to all once again :)
I have an ArrayList of Strings which contains various data. It is filled with
numbers, decimal numbers, simple strings and so one(but all of them are stored
as a Strings).
The problem is that since a while I have been storing those files only as Strings
in Excel file using POI library with the following code:
cell.setCellValue(listOfResults.get(iterationNumber));
Right now I have to face another problem. From time to time the results of this
ArrayList are Float numbers with format *,* or Integers and, as you can see,
floats numbers are separated by a comma i.e:
0
1
1,23
213,23899
For above data I have to set a cellType to NUMERIC(not as previously as
general). So I was trying with this:
CellStyle style = wb.createCellStyle();

style.setDataFormat(HSSFDataFormat.getBuiltinFormat("0,00"));
cell.setCellStyle(style);
cell.setCellValue(Float.parseFloat(listOfResults.get(iteration))); //after this I
have a negative output with the following Exception
java.lang.NumberFormatException:For input string: "2,26776"
And I know that the problem is connected with this comma value. So please
give me a hint in these two areas:
1.
HSSFDataFormat.getBuiltinFormat("0,00")
how to set it properly that it should be working for my example data ["0", "1",
"1,23","21312,23999"] and so one
2.
cell.setCellValue(Float.parseFloat(listOfResults.get(iteration)))
How to properly parse a float with "," inside. I have tried with
DecimalFormatSymbols but it doesn't work like I want with POI.
Thanks a lot in advance!
Answer
I think you could just write the comma formatted floats into your excel file as a
string. For that you do:
cell.setCellValue(listOfResults.get(iteration));
If you intern to use the cell value for further calculations as numeric values,
then I think you only have to convert the string number to a float.
float value = Float.parseFloat(listOfResults.get(iteration).replace(",", "."));
cell.setCellValue(value);
Topic 243
Subject

Choose function values unmatched in pivot table
Question
I am new to VBA and I am writing this macro to get values from pivot table
and store them in cells near pivot table. The problem is when any value written
in choose function not found in pivot table,it is showing application-defined or
object-defined error, I cannot remove the fields from choose as the value can
be there when in future pivot table will be updated.
Any help will be appreciated in this regard.
For i = 1 To 8
Set rng =
Intersect(pt.PivotFields("Category").PivotItems("Technical").DataRange.Entire
_ pt.PivotFields("Office").PivotItems(Choose(i, "Mum", "blore", "chen",
"delhi", "chandigarh", "hyd", "pune", "noida")) _ .DataRange.EntireRow,
pt.PivotFields("Total").DataRange)
If rng Is Nothing Then
Else
Worksheets(6).Range(Choose(i, "AF29", "AF23", "AF24", "AF25", "AF30",
"AF26", "AF27", "AF28")).value = CInt(WorksheetFunction.Percentile(rng,
0.95))
End If
Next i
Answer
Use Error Handler to handle that issue.
For i = 1 To 8
On Error Resume Next 
      Set Rng =

Intersect(pt.PivotFields("Category").PivotItems("Technical").Da
_ 
      pt.PivotFields("Office").PivotItems(Choose(i, "Mum",
"blore", "chen", "delhi", "chandigarh", "hyd", "pune",
"noida")) _ 
      .DataRange.EntireRow,
pt.PivotFields("Total").DataRange) 
On Error GoTo 0
If Not Rng Is Nothing Then
Worksheets(6).Range(Choose(i, "AF29", "AF23", "AF24", "AF25", "AF30",
"AF26", "AF27", "AF28")).Value = CInt(WorksheetFunction.Percentile(Rng,
0.95)) End If
Next i
Topic 244
Subject
ssis package not executing on its own through sql server jobs
Question
I have an ssis package in which I am converting an excel file into csv file
through the script task in visual studio 13 c-sharp .It should automatically pick
the excel file and convert it into the csv through converter code and push into
sql server db. I have created a job in sql server that should run that ssis
package .But every morning I get an error as below:
System.NullReferenceException:Object reference not set to an instance of an
object.
at
System.Runtime.InteropServices.Marshal.ReleaseComObject(Object o) at
ST_30876fcf7c394e70be7554
when I try to run the job overnight. But when I manually run the job it pick the
file through jobs and push it into the database perfectly. Can you tell me what
could be the issue. Thanks
Topic 245

Subject
Excel duplicate line and apply formula
Question
I need some help with the following please.
I need excel to duplicate the same line 4 additional times and update "Selling
Price" according to the next markup Column. In the picture above "Selling
Price" is using "Class Retail Markup %". Formula: =((N2/100)*L2)+L2
The below is what I'm trying to achieve, but I need it to be automated as this is
one item of thousands.
Any help will be much appreciated.
Answer
will be a lot of work if not done with VBA. but you could do it like that:
Insert the 5 lines manually but have everything as a reference. A3 to A6 will
all have =A2 (same for column B to J and L) (for K directly type the 2 to 5)
then in M3 type =(O2/100+1)*L3 and for M4 =(P2/100+1)*L4. M5 is =
(Q2/100+1)*L5 and M6 becomes =(R2/100+1)*L6.
Now copy the whole rows 3 to 5.
at the next dataset select the line below it and right-click it -> "insert copied
cells" (repeat the copy/paste step for every entry)
to do the copy-paste part via macro:
Sub Macro1()
Dim i As Long
For i = 47861 To 8 Step -1
Rows("3:6").Copy
Rows(i).Insert Shift:=xlDown
Next
End Sub
Make sure to use the correct ranges or at least split it up to do it for a short part

to test it... can take a long time to do all lines in one step...
Answer
Assuming your data in this sheet(aka sheet1) doesn't get used by a formula in
another sheet, you might have an option to create a new sheet (aka sheet2) with
exactly the same headers. (If you have formulae in other sheets reading your
47861 lines of data, then this might not be the method as you will have to relink
all those into sheet2. To check, use "Trace Dependents" in sheet1)
In cell A2 of Sheet2, write this formula:
=HLOOKUP(A$1,Sheet1!$A$1:$R$47862,(INT(ROW(Sheet1!A2)-2)/5)+2,0)
Explanation: It will look up the column head e.g."Internal ID" from sheet2 in
sheet1, in your table (which I presume is 47861 lines, hence
"Sheet1!$A$1:$R$47862" in the formula). In row index no of hlookup, there is
a play around with getting row index no to repeat 5 times.
You can copy that formula downwards in sheet2 to A239306 (since
47861*5=239305). You can copy the row across to all your columns up to R in
sheet2, except K and M (assumption you are okay 5 repetitions in columns N to
R).
In sheet2, cellK2:
=MOD((ROW()-2),5)
You can drag this down to K239306. That populates all columns except M.
In sheet2, from M2 to M6, you can write down 5 formulae with different
calculations of your SP, and then copy 5 of them as a block and paste them all
the way down as a block over 239305 cells, from M2 to M239306.
Topic 246
Subject
prevent value from changing once formula is applied
Question

I have the following formula in my activity sheet in the date column
=IF(ISBLANK(A1),"",TODAY())
This is to automatically populate the cell with the current date if A1 is not
empty, i have applied this formula to all the cells in column A. But everyday i
open the sheet to add my activities the previous days date value automatically
changes to the current date, Is there any way to lock the cells value from
changing once the formula is applied for the first time or is there an alternate
way Answer
Assuming the formula is in B1:
With iterative calculation (options > formulas > check "enable iterative
calculation") you can use this formula:
=IF(A1="","",IF(B1="",TODAY(),B1))
if anything is in A1 then B2 will show the actual date but if B1 alredy has a
value, it shows the old one (open it up days later will still show the old date)
but empty out A1 to reset and a new entry will show the actual date again (just
switching the value wont work, you need to empty A1 to get the actual date)
Answer
Copy the field and inset as value in to the same . This way, the formula gets
replaced with the value and never changes.
Otherwise let the formula reference to a static field which has the date in it.
Topic 247
Subject
Excel VBA - Application.Match not working (IsInArray)
Question
I have written my first proper Excel script but the last step seems not to be
working. I am including the whole code with comments but the important short
block is the last block of code before End, For loop just after this comment:

'-------------------- perform search and write into destination
I'm also thinking that "ByVal" in my function definition also might have
something to do with the problem?
'=========================================================
'This proceedure retrieves 'Amount Spent' per campaign form sheets 'labeled
'jan', 'feb', 'mar', ... and writes them onto 'rawData' Sheet.
'From there, data gets updated in the pivot tables on sheets 'search', 'gdn',
'youtube'.
'=========================================================
Public Month As String
Private SourceSheet As Worksheet
Private CampaignsCount As Integer
Private arrCampaignsAmounts() As Variant Private StringsCount As Long
Private arrStrings() As Variant
Private strBaba As String
Public Function IsInArray(ByVal stringToBeFound As String, arr As Variant)
As Boolean
IsInArray = Not IsError(Application.Match(stringToBeFound, arr, 0)) End
Function
Public Sub stringComparison()
Call OptimizeCode_Begin
'------------------- get user input, which month (sheet) are we working on
ChooseMonthUserform.Show
Set SourceSheet = Worksheets(Month)
With SourceSheet 
          CampaignsCount =

Application.WorksheetFunction.CountA(.Range("F:F")) - 1 
          ReDim arrCampaignsAmounts(1 To CampaignsCount, 1 To
2) 
'------------------- read Campaigns/Amounts from .csv, write into an array 
          For i = 1 To CampaignsCount 
              k = 6 
              For j = 1 To 2 
                  arrCampaignsAmounts(i, j) = .Cells(i + 11,
k).Value 
                      k = 9 
              Next j 
          Next i 
      End With 
'-------------------- load strings to search for into another array
Set SourceSheet = Sheet2
With SourceSheet 
          lastrow = .Cells(Rows.Count, 1).End(xlUp).Row 
          StringsCount = (lastrow - 1) / 12 
          ReDim arrStrings(1 To StringsCount, 1 To 2) 
          k = 1 
              For i = 1 To StringsCount 
                      arrStrings(i, 1) = .Range("A" & i +
k).Value & "" & .Range("C" & i + k).Value & "" & .Range("D" &
i + k).Value & "_" & .Range("E" & i + k).Value 
                      arrStrings(i, 2) = .Range("A" & i +
k).Row 
                          k = k + 11 
              Next i 
      'Sheet11.Range("A1").Resize(UBound(arrStrings, 1),
UBound(arrStrings, 2)) = _ 
      'arrStrings 

'-------------------- perform search and write into destination 
          For i = 1 To UBound(arrStrings) 
              If IsInArray(arrStrings(i, 1),
arrCampaignsAmounts) = True Then 
                  SourceSheet.Range("H" & arrStrings(i, 2)) =
arrCampaignsAmounts(i, 2) 
              Else 
              End If 
          Next i 
      End With 
'=========================================================
'TO DO:
'> search for strings and write 'Amounts' back into 'rawData' '> redesign the
second array so that it takes into account which month '> it is, which row to
start from (jan - row #2, feb - row#3, mar - row #4, ...) '> try and read into
arrays all at once without loops
'=========================================================
Call OptimizeCode_End
End Sub
Answer
Add excel Index() function to retrieve the desired column array of multi
dimensioned array.
IsInArray = Not IsError(Application.Match(stringToBeFound,
Application.Index(arr, , 2), 0))
Topic 248
Subject
FormulaR1C1 does not work
Question
I have the following code:

Dim lastrow As Double
Dim lastrowX As String
lastrow = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
lastrowX = "X2:X" & lastrow
Range(lastrowX).FormulaR1C1 = "=IF(RC[-4]=RC[-19],RC[-15],"""")"
The problem is that instead of working formula, it gives me the following:
=IF(RC[-4]=RC[-19],RC[-15],"""")
Why excel does not want to "convert" RC into reference? Answer
Because the cell formatting is not allowing the formula to be considered as
real formula. Since the cell may be formatted as Text.
Replace the below line of code
Range(lastrowX).FormulaR1C1 = "=IF(RC[-4]=RC[-19],RC[-15],"""")"
With
With Range(lastrowX)
.Clear
.FormulaR1C1 = "=IF(RC[-4]=RC[-19],RC[-15],"""")" End With
Topic 249
Subject
Show in MSgBox all nonempty values from row
Question
I am working on an Excel sheet of row size A:ZZ and there should only be 7
cells with values. I am trying to make a kind of "filter" that will check the
number of non empty cells and in case when there will be more than 7
nonempty cells will print a message in MsgBox (and till this point is working).
But in the MsgBox I would like to se also just those values from the row
(separated eg. with coma) - this is although not working due to some problem

with Intersect syntax. Here is the code
Sub blanks()
Dim a, b As Integer
a = 0
Range("A1").Select
Do
With ActiveSheet.Range(Rows(b)) 
    b = ActiveCell.Row 
    a =
Application.WorksheetFunction.CountA(ActiveSheet.Rows(b)) 
    If a > 7 Then 
      MsgBox ("ERROR" & "/n" &
Application.Intersect(.SpecialCells(xlCellTypeVisible))) 
      Exit Do 
    Else 
      ActiveCell.Offset(1, 0).Select 
    End If 
End With
Loop Until ActiveCell = "stop"
End Sub
What is there wrong?
Answer
This will give you the constant values (i.e. not from a formula):
Sub ShowValues()
Dim rowNum As Long
Dim rowRange As Range
Dim valRange As Range
Dim msg As String
rowNum = 1
With ThisWorkbook.Worksheets("Sheet1") 

      Do While .Cells(rowNum, 1) <> "stop" 
          Set rowRange = .Cells(rowNum, 1).Resize(1, 702) 
          If Application.WorksheetFunction.CountA(rowRange) >
7 Then 
              'Add row number to message. 
              msg = msg & "Row: " & rowRange.Row & ": " 
              'Add values to message separated by comman. 
              For Each valRange In
rowRange.SpecialCells(xlCellTypeConstants) 
                  msg = msg & valRange.Value & ", " 
              Next valRange 
              'Remove last comma. 
              msg = Left(msg, Len(msg) - 2) 
              'Line break. 
              msg = msg & vbCr 
          End If 
          rowNum = rowNum + 1 
      Loop 
End With
MsgBox msg, vbOKOnly + vbInformation End Sub
or this will give you the addresses:
Sub ShowAddressOfValues()
Dim rowNum As Long
Dim rowRange As Range
Dim msg As String
rowNum = 1
With ThisWorkbook.Worksheets("Sheet1") 
      Do While .Cells(rowNum, 1) <> "stop" 
          Set rowRange = .Cells(rowNum, 1).Resize(1, 702) 
          If Application.WorksheetFunction.CountA(rowRange) >
7 Then 
              msg = msg & "Row: " & rowRange.Row & ".

Address: " & _ 
                
rowRange.SpecialCells(xlCellTypeConstants).Address & vbCr 
          End If 
          rowNum = rowNum + 1 
      Loop 
End With
MsgBox msg, vbOKOnly + vbInformation End Sub
Topic 250
Subject
Conditional formating highlighted a Date Range
Question
I’ve been struggling to try and figure this one out, it to do with conditional
formation in Excel. I want to find a way to highlight the next payment schedule
based on the current date. So if today was 10 Feb, the next payment schedule
would be 15th Feb and is therefore highlighted. If today was the 16th Feb, A6
and B6 would be highlighted
Can any one help me with the formula for this, I’m assuming its conditional
formatting with a formula. but the formula stumps me. this formula would need
to be applied to a large range of dates (600 dates)
With grateful thanks,
David
Answer
Simply try this formula:
=COUNTIFS($A$2:$A$9,"<="&$A2,$A$2:$A$9,">"&TODAY())=1
if you want to show also a day which is the actual day then simply add the = to
the today part:
=COUNTIFS($A$2:$A$9,"<="&$A2,$A$2:$A$9,">="&TODAY())=1

but make sure to not miss any $ (or do to much of them) ;)
alternatively you also could use the short formula (which may be slower for
bigger tables:
=$A2=MIN(IF($A$2:$A$9>TODAY(),$A$2:$A$9))
$A$2:$A$9>=TODAY() will include the actual day
Topic 251
Subject
Laravel Excel big export. Server error 500
Question
I try to export 15000+ rows:
Excel::create(...)->export('xls')
I get server error 500. Problem with memory or other? Answer
It was memory limit error, not excel. Problem solved by separate query-
builder results:
$count = $User->count();
$off_ex = 1000;
for($j = 0;$j < $count/$off_ex;$j++){ $users = $User->skip($j*$off_ex)-
>take($off_ex)->get(); //...
}
Topic 252
Subject
How to subtract value from the result of previous calculation
Question
it's kinda basic, but I don't even know how to formulate problem correctly. So
please kindly help.
The task is:
I have a starting value A1 and a step value B1. I subtract B1 from A1 and put a

value into A2. This is done by
=sum(A1-B1)
But then I need to subtract B1 from the result in A2 and so on. That can be done
by
=sum(A2-B1)
I wonder, what is the way to write a self adjusting formula or, at least, how
such functionality would be called, so I can learn it myself. Answer
You can use absolute addressing to "lock in" the address B1 by prepending the
row/column with a $:
=A2-$B$1
This will allow you to copy the formula across; Excel will automatically
update the A2 portion but keep the $B$1 constant.
In this case, it looks like you're copying down, an absolute row is most likely
what you want (i.e. =A2-B$1)
P.S. You know you're not SUMming anything here, right?
Answer
You want to make B1 absolute.
In A2 enter this formula
=A1-$B$1
Then drag the formula down.
Topic 253
Subject
sum of values in next column for top 3 values of previous column

Question
I have 3 columns in excel (A, B and C). A contains sector name, B contains
cash for sector and C contains asset for sector. I am trying to get sum of values
in a column in C in excel based on criteria in column A and B. My criteria are:
1. Criteria is filter sector name for ex. sum for "ABC" 2. Column B has cash
value for sectors. Get top 3 cash values for sector. for ex. top 3 cash for ABC
sector.
Now, I need to get sum of values in column C for based on 1 and 2 criteria.
Image has Column A, B and C
Answer
Use Pivot Table to show the Top 3 Values.
Or
Using Formula
=SUMPRODUCT(LARGE((A2:A5="Abc")*(B2:B5<>"")*C2:C5,{1,2,3}))
Topic 254
Subject
Reading XLSX into MFC Application
Question
I am needing to read in data from an XLSX document into my MFC
application. It has been working fine however I now have the requirement of
reading in foreign language characters and they are getting lost.
Example value which I need to read in are:
Лице и тяло
Мама и бебе
Currently I first convert the xlsx to a csv using the following script which I
found online
if WScript.Arguments.Count < 2 Then

WScript.Echo \"Error!Please specify the source path and the
destination.Usage:XlsToCsv SourcePath.xls Destination.csv Wscript.Quit
End If
Dim numRows
Dim numCols
Dim oExcel
Set oExcel = CreateObject("Excel.Application") oExcel.DisplayAlerts =
False
Dim oBook
Set oBook = oExcel.Workbooks.Open(Wscript.Arguments.Item(0)) Set
oWorksheet = oBook.Worksheets(1)
oWorksheet.Activate
oWorksheet.Cells.Replace ",", ""
Dim celltxt
celltxt = oWorksheet.Cells(1,1).Text
If InStr(1, celltxt, \"Date\") Then
For count = 13 to 17
oWorksheet.Columns(count).NumberFormat = "0" Next
Else
For count = 1 to 4
oWorksheet.Columns(count).NumberFormat = "0" Next
End If
numRows = oWorksheet.UsedRange.Rows.Count numCols =
oWorksheet.UsedRange.Columns.Count Const adTypeText = 2
Const adSaveCreateOverWrite = 2
Dim BinaryStream
Set BinaryStream = CreateObject("ADODB.Stream") BinaryStream.Charset =
"UTF-8"
BinaryStream.Type = adTypeText
BinaryStream.Open
For r = 1 To numRows
s = ""
For c = 1 To numCols 

      s = s & oWorksheet.Cells(r, c).Value 
      If c < numCols Then 
          s = s & "," 
      End If 
Next
BinaryStream.WriteText s, 1
Next
BinaryStream.SaveToFile WScript.Arguments.Item(1),
adSaveCreateOverWrite BinaryStream.Close
oBook.Close False
oExcel.Quit
Once this script runs and i open the resulting csv before any further processing,
the data in the csv looks fine.
Once this csv is processed by the aplication (Loaded using CRecordSet) the
above values look as follows:
¦Ы¦¬TЖ¦¦ ¦¬ TВTП¦¬¦-
¦Ь¦-¦-¦- ¦¬ ¦-¦¦¦-¦¦
What I found is that if I open the csv before processing it and go to "Save As",
the "Save as type" value is on "Unicode Text". If I now overwrite the csv by
saving as "CSV (Comma delimited)", then let the file process into my app, the
resulting values look as follows:
TшЎх ш Є ыю
¦рьр ш схсх
and if I manually saved the csv as "CSV (MS-DOS)" and then let my app
process it, the values come out correctly:
Лице и тяло
Мама и бебе

So on the one hand, I dont understand the differences and why I need the MS-
DOS csv version to get my app to read in the value correctly, and secondly, I
need to be able to process the data correctly without hte manually save as in
between.
Any help greatly appreciated!
Thanks alot
UPDATE
Just to test, I changed my code (which runs the script to convert to csv) to
output to a .txt instead of .csv and again the output file looks right before my
application reads it in but it still imports from there into my application wrong.
Here is the output .txt contents:
From Date,To Date,Store ID,Store Name,Retailer,Retail
Format,Region,Cluster,Market Attr 1 (Numeric),Market Attr 2
(Numeric),Market Attr 3 (Text),Market Attr 4 (Text),Market Attr 5
(Text),Product ID,EAN (Barcode),UPC (Product
Code),Brand,Description,Size & Uom,Size,Uom,Supplier,Shrink
Pack,Minimum Display Depth,KVI,Status,Product Height,Product
Width,Product Depth,Supergroup A,Supergroup B,Category,Sub
Category,Segment,Sub Segment,Product Attr 1 (Numeric),Product Attr 2
(Numeric),Product Attr 3 (Text),Product Attr 4 (Text),Product Attr 5
(Text),Sales (Value),Units (Volume),Sales at Cost,Ranging Indicator,Fact 1
(Numeric),Fact 2 (Numeric),Fact 3 (Numeric),Fact 4 (Text),Fact 5 (Text)
01/01/2014,31/01/2016,130,Maritza,Clicks,Pharmacy,Plovdiv,A
Range,1.99,2.99,Attribute 3,Attribute 4,Attribute
5,1347,7612729000518,ПОЛИНЕЙЛ лечебен лак за нокти 80мг/гр
33мл,Coca Cola,ПОЛИНЕЙЛ лечебен лак за нокти 80мг/гр
33мл,330ml,330,ml,Coca Cola,6,2,1,Active,CONVERT,37,36,Лице и
тяло,Медицинска козметика,Carbonated Soft Drinks,Diet,On The
Go,Cans,1.99,2.99,Attribute 3,Attribute 4,Attribute
5,136.27,12,122.21,1,1.99,2.99,3.99,Yes,No
01/01/2014,31/01/2016,130,Maritza,,Pharmacy,Plovdiv,,,,,,,1349,59032632459
крем антисептичен 125гр,,СУДО крем антисептичен

125гр,,,,,,,,,66,6,6,Мама и бебе,Козметика бебе,,,,,,,,,,,,,,,,,,
01/01/2014,31/01/2016,130,Maritza,,Pharmacy,Plovdiv,,,,,,,1381,,СПРИНЦОВ
1МЛ ТРИСЪСТАВНА инсулинова спринцовка х 1бр,,СПРИНЦОВКА
1МЛ ТРИСЪСТАВНА инсулинова спринцовка х 1бр,,,,,,,,,198,3,1,Мама и
бебе,Храни и напитки бебе,,,,,,,,,,,,,,,,,,
01/01/2014,31/01/2016,130,Maritza,,Pharmacy,Plovdiv,,,,,,,1607,87162006465
AC 400гр,,ФРИЗОПЕП AC 400гр,,,,,,,,,123,10,10,Мама и бебе,Храни и
напитки бебе,,,,,,,,,,,,,,,,,,
Topic 255
Subject
Excell Conditional Data and Text Manipulation
Question
I have an Excel spreadsheet containing a number of columns most important of
which are called "sequence", "modifications" and "signal". Column called
"sequence" contains a number of entries, which repeat itself as long as there is
different "modification". Each particular sequence with given "modification"
assigned certain "signal" value. 
Sequence         Modification                Signal 
ABCDEF           None                        100 
ABCDEF           Carba                       200 
ABCDEF           NEIAA                       300 
ABCDEF           NEIAA,Carba                 400 
ABCDEFG          None                        400 
ABCDEFG          Carba                       600 
ABCDEFG          NEIAA                       700 
ABCDEFG          NEIAA, Carba                800 
ABCDEFG          2XNEIAA                     900 
The task which I am having problem with consist of clustering similar
sequences with different modification together, getting a total sum of signal for
this particular group , dividing signal from individual group components to the
calculated sum for this particular sequence cluster, then grouping obtained
percentage values to entries with and without NEIAA tag, summing values for
all entries with NEIAA tag within the group and reporting it as a final "%
MODIFICATION" value for this particular cluster.

For example Sequence "ABCDEF" have total signal of 1000 with 30% and
40% belonging to entries with NEIAA tag, thus total % Modification for this
particular cluster is 70%. Similarly for sequence "ABCDEFG" total %
MODIF is equal to 100*(700+800+900)/(400+600+700+800+900).
Thanks in advance for all the help I can get. Both formula or VBA would work
for me.
My sample data is as below:
Answer
with
SUMIFS(C:C,A:A,A2)
you can summ all (which you allready got)
and with
SUMIFS(C:C,A:A,A2,B:B,"NEIAA")
you can sum only the ones including NEIAA
put everything together (we want it only once at the first sequence but have it
dragable) just put in F2
=IF(AND(COUNTIF($A$1:A1,A2)=0,LEN(A2)>0),SUMIFS(C:C,A:A,A2,B:B
if you still have questions, just ask
COUNTIF($A$1:A1,A2)=0 just checks to have the value in column A the first
time and LEN(A2)>0) just skips the the blank cells ;)
EDIT
Assuming everything is shifted to the right and column A gains a unique
Keyword, so each combination of column A and B is like it is now for only
column A you can try this pls: (put in G2 and then auto-fill down as you need
it)

=IF(AND(COUNTIFS($B$1:B1,B2,$A$1:A1,A2)=0,LEN(B2)>0),SUMIFS(D
as said:
everything is shifted to the right (insert column in front of everything)
column A now holds the "run" -> sum up everything having the same "run"
AND "sequence" (and the "NEIAA"-part)
If you still have any questions, just ask :)
Topic 256
Subject
I need a pop-up in Excel when I click on a particular row
Question
So the idea is, when I click on any cell belonging to a particular column a
popup should come in which I can enter two values - both of which should be
auto-populated next in separate columns next to the actually clicked column in
the same row.
I know this sounds trivial but I'm hopeless in Excel Macros - is this even
possible? Answer
Copy the below code and do right click on sheet tab and select view code and
paste it.
Close the VBA window (Alt+Q to close VBA window) and return to that sheet
and check.
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
If Target.Column = 5 Then
Dim sF1 As String, sF2 As String
sF1 = InputBox("Enter Field 1 Value", "Field One Value Req.") sF2 =
InputBox("Enter Field 2 Value", "Field Two Value Req.")
With Target 

      .Offset(, 1).Value = sF1 
      .Offset(, 2).Value = sF2 
End With
End If
End Sub
Answer
Regarding allowing the code to work in all the sheets of that workbook
question, remove the given code from the sheet module and apply the below
code in Thisworkbook module as described below.
To Add Excel VBA Code to a Workbook / This Workbook Module
Copy the code that you want to use
Select the workbook in which you want to store the code Hold the Alt key, and
press the F11 key, to open the Visual Basic Editor
In the Project Explorer, find your workbook, and open the list of Microsoft
Excel Objects
Right-click on the ThisWorkbook object, and choose View Code Where the
cursor is flashing, choose Edit | Paste
Private Sub Workbook_SheetSelectionChange(ByVal Sh As Object, ByVal
Target As Range)
If Target.Column = 5 Then
Dim sF1 As String, sF2 As String
sF1 = InputBox("Enter Field 1 Value", "Field One Value Req.") sF2 =
InputBox("Enter Field 2 Value", "Field Two Value Req.")
With Target 
      .Offset(, 1).Value = sF1 
      .Offset(, 2).Value = sF2 

End With
End If
End Sub
Topic 257
Subject
use merge function in PHP Excel give an error at the time of opening excel
Question
I have used Merge function in PHP excel to merge cell.this merging process is
in loop so and as per my code logic this loop is calling 3 times so merging
process is done three times.It allows to download excel successfully. But
while i am opening that excel it will give missing data error and than open
excel. screen shot of this is here.enter image description here
Why It should be like that? And It will also not set width automatically for
column A.
Code is Here(All the data from database are comming correctily, Only
problem with php excel code):
$header = 'a1:ac1';
$objPHPExcel->getDefaultStyle()->getAlignment()-
>setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
$objPHPExcel->getActiveSheet()->getStyle($header)->getFill()-
>setFillType(\PHPExcel_Style_Fill::FILL_SOLID)->getStartColor()-
>setARGB('D0D0D0'); $style = array(
'font' => array('bold' => true,),
'alignment' => array('horizontal' =>
\PHPExcel_Style_Alignment::HORIZONTAL_CENTER,), );
$objPHPExcel->getActiveSheet()->getStyle($header)-
>applyFromArray($style); $objPHPExcel->getActiveSheet()->getStyle( 
      'A1:' . 

      $objPHPExcel->getActiveSheet()->getHighestColumn() . 
      $objPHPExcel->getActiveSheet()->getHighestRow() 
)->getBorders()->getAllBorders()-
>setBorderStyle(PHPExcel_Style_Border::BORDER_THIN); $styleArray =
array(
'font' => array( 
      'bold' => FALSE, 
      // 'color' => array('rgb' => 'FF0000'), 
      'size' => 10, 
      'name' => 'Calibri' 
));
$limit = $objPHPExcel->getActiveSheet()->getHighestColumn(); for ($col =
'A'; $col != $limit; $col++) {
$objPHPExcel->getActiveSheet()->getColumnDimension($col)-
>setAutoSize(true); $objPHPExcel->getActiveSheet()->getStyle($col)-
>applyFromArray($styleArray); }
$objPHPExcel->getActiveSheet()->getStyle($header)->getAlignment();
$objPHPExcel->getActiveSheet()->getColumnDimension('A');
$objPHPExcel->getActiveSheet()->getColumnDimension('B');
$objPHPExcel->setActiveSheetIndex(0);
$alphas = 'C';
$objPHPExcel->getActiveSheet()->SetCellValue('A' . $rowCount, "");
$objPHPExcel->getActiveSheet()->SetCellValue('B' . $rowCount,
"Product/Tester"); foreach ($paramfield as $key => $value) {
$objPHPExcel->getActiveSheet()->SetCellValue($alphas . $rowCount,
$value);
$alphas++;
}
$objPHPExcel->getActiveSheet()->SetCellValue($alphas . $rowCount,

"Total"); $rowCount++;
$i = count($paramcat);
foreach ($paramrow as $value) {
$temp = $value;
$j = $rowCount + $i - 1;
//echo $rowCount . '->' . $j . '<br>'; foreach ($paramcat as $valuecat) { 
      //$i = 2; 
      $total = 0; 
      $alphas = 'C'; 
      $productname = $valuecat; 
      $objPHPExcel->getActiveSheet()->SetCellValue('A' .
$rowCount, $temp)->mergeCells('A'.$rowCount . ':A' . $j); 
      $objPHPExcel->getActiveSheet()->SetCellValue('B' .
$rowCount, $productname); 
      foreach ($joint as $value1) { 
          $que = mysqli_query($conn, "Select SUM(Effort) from
assigned_testsuite_tester where Testsuite_id IN (Select
Testsuite_id from testsuite_master where Product_id IN(Select
Product_id from product_master where
Product_title='$productname') and Cycle_id='$cycle') AND
Tester_name='$value1'"); 
          if ($row = mysqli_fetch_array($que)) { 
              $objPHPExcel->getActiveSheet()-
>SetCellValue($alphas . $rowCount, $row[0]); 
              $total = $total + $row[0]; 
              $alphas++; 
          } else { 
              echo 'Error' . mysqli_error($conn); 
          } 
      } 
      $objPHPExcel->getActiveSheet()->SetCellValue($alphas .
$rowCount, $total); 
      $temp = ""; 
      $rowCount++; 
}
unset($j);
}

Topic 258
Subject
Spilt the Main DB in Excel and Update the Values and Merge Them into one
Question
I have a Database with 23000 Rows, Now we categorized as Like ( intrested,
followup, not intressted) Now i want to create different work sheet for each
category in that i have to update the sheet with other information which should
be updated back in the main DB . Please help me how to do this.
I used Vlookup to do this but it is making my Workbook very slow in such a it
take 1min to update value of single cell..
I tried Using Pivot Table to filter the values.since its dynamic when try to
update the adjacent value to pivot table they are messing up.
in Sheet 1 I have the details of the Customer Like (
name,ph,email,CATEGORY(intrested,follow up, not interested), status, etc)in
the status i have the last follow up.
now in the sheet 2 i have to extract one category(eg. intrested) with
email,name, ph with that ill follow up with those client and enter the informtion
of communication which should go back to the sheet 1 in a new column.
Topic 259
Subject
How do I save data from MySQL db to excel file as Number not text using
Python
Question
Below is the script. I am pulling some data and save to Excel In the output file,
all column are marked "Number stored as Text" What can I do in the script to
change all columns to number (int)? Thanks
wb = openpyxl.Workbook()
db = MySQLdb.connect(host="...",port=...,user="...",passwd="...",db='...')
cursor = db.cursor()

cursor.execute("""
SELECT shopid,userid,count(orderid)as no_of_orders from order_viw
group by shopid,userid
""")
data = cursor.fetchall()
rowNum = 2
col = 1
sheet = wb.get_sheet_by_name("Sheet")
for shopid,userid,no_of_orders in data:
sheet.cell(column=col, row=rowNum, value="%d" % shopid)
sheet.cell(column=col+1, row=rowNum, value="%d" % userid)
sheet.cell(column=col+2, row=rowNum, value="%d" % no_of_orders)
rowNum += 1
wb.save('C:/example.xlsx')
db.close()
Answer
As a forewarning, I'm running on Linux, have not got a MySql database and I
am using libreoffice to check the results. With those caveats in place, the
following looks like it works for me:
import openpyxl
wb = openpyxl.Workbook()
rowNum = 2
col = 1
sheet = wb.get_sheet_by_name("Sheet")
#data = [[42,1,43],[82,2,28]]
data = [['42','1','43'],['82','2','28']] for shopid,userid,no_of_orders in data:
sheet.cell(column=col, row=rowNum).value=int(shopid)
sheet.cell(column=col+1, row=rowNum).value=int(userid)
sheet.cell(column=col+2, row=rowNum).value=int(no_of_orders) rowNum
+= 1
wb.save('example.xlsx')

Topic 260
Subject
What are bit shift operators in VBA ?I am using >> and << for right and left
shift respectively but it gives a compile error
Question
What are bit shift operators in VBA 2013? I am using '>>' and '<<' for right and
left shift respectively but I m getting a compile error. here is my function code.
Sub CommandButton21_Click()
MsgBox ROTR(1, 2)
End Sub
Function ROTR(A As Integer, B As Integer) As Integer ROTR = A >> B
End Function
Answer
Unfortunately, VBA doesn't have Bitwise operators. You will have to either
use VB.NET or create something on your own similar to this:
http://www.excely.com/excel-vba/bit-shifting-function.shtml
Answer
Check BITRSHIFT() or BITLSHIFT() functions which is available in 2013.
Topic 261
Subject
For large file (>10 MB) showing the error “External table is not in the
expected format”
Question
Here is my code part:
public static DataSet GetExcelTable(string FilePath, string Extension,string
isHDR,string Sheetname=null) {
DataSet ds = new DataSet();
DataSet dsData = new DataSet();

ds.DataSetName = Path.GetFileName(FilePath); string conStr = "";
conStr=ConfigurationManager.ConnectionStrings["Excel03ConString"].Connec
conStr = String.Format(conStr, FilePath, isHDR); OleDbConnection connExcel
= new OleDbConnection(conStr); OleDbCommand cmdExcel = new
OleDbCommand();
cmdExcel.Connection = connExcel;
connExcel.Open();
}
My connection string is:
<add name="Excel03ConString"
connectionString="Provider=Microsoft.Jet.OLEDB.4.0;Data Source=
{0};Extended Properties='Excel 8.0;HDR={1}'" />
Note: it's working fine for less than 10Mb files. Error occurs only when file
size is greater than 10Mb, uploading file type is .xls & shows error on
connExcel.Open();
Please provide me a solution for it. Thanks in advance.
Topic 262
Subject
Excel VBA how to include cell content on change in email body
Question
Hello fellow coders and knowledge seekers. I have this code that is sending an
email informing that a date has been added to a cell in J column (Submittal
Date). I just want to include the content of a cell in column B (Submittal title)
corresponding to that date that has been added.
The code is working fine and sending an email when I add a date in a cell in
column J. But I want to add that submittal title in the body of the email. Here is
my code
Private Sub Worksheet_Change(ByVal Target As Range)

Dim KeyCells As Range
Dim SubmitLink As Range
' The variable KeyCells contains the cells that will ' cause an alert when they
are changed. Set KeyCells = Range("J3:J1000")
Set SubmitLink = Range("B3:B1000")
If Not Application.Intersect(KeyCells, Range(Target.Address)) _
Is Nothing Then 
      ' Display a message when one of the designated cells
has been 
      ' changed. 
      ' Place your code here. 
      Dim answer As String 
      answer = MsgBox("Do you wish to save this change. An
Email will be sent to the User", vbYesNo, "Save the change") 
      If answer = vbNo Then Cancel = True 
      If answer = vbYes Then 
          'open outlook type stuff 
          Set OutlookApp =
CreateObject("Outlook.Application") 
          Set OlObjects = OutlookApp.GetNamespace("MAPI") 
          Set newmsg = OutlookApp.CreateItem(olMailItem) 
          'add recipients 
          'newmsg.Recipients.Add ("Name Here") 
          newmsg.Recipients.Add
Worksheets("Coordinator").Range("Q4").Value 
          'add subject 
          newmsg.Subject =
Worksheets("Coordinator").Range("O3").Value 
          'add body 
          newmsg.Body = "Dear User, New Submittal" &
Cells(SubmitLink.Row, "B") & "has been Added in SUBMITTAL Log.
Please Investigate the Change" 
          newmsg.Display    'display 
          newmsg.Send    'send message 
          'give conformation of sent message 
          MsgBox "Modification confirmed", , "Confirmation" 
      End If 
      '     MsgBox "Cell " & Target.Address & " has changed."

End If
End Sub
Thank you for your help
Answer
This is the solution. Just define the cell you want to retrieve the data from
Dim SubmitLink As String
Then identify this cell's offset from the KeyCell
SubmitLink = Target.Offset(, -8).Value
And finally add ( " & SubmitLink & " ) in the text of the email body or title,
and the data in that cell will appear. And here is the full code
Private Sub Worksheet_Change(ByVal Target As Range)
Dim KeyCells As Range
' The variable KeyCells contains the cells that will ' cause an alert when they
are changed. Set KeyCells = Range("J3:J1000")
If Not Application.Intersect(KeyCells, Range(Target.Address)) _
Is Nothing Then 
      ' Display a message when one of the designated cells
has been 
      ' changed. 
      ' Place your code here. 
Dim answer As String
Dim SubmitLink As String
SubmitLink = Target.Offset(, -8).Value

answer = MsgBox("Do you wish to save this change. An Email will be sent to
the User", vbYesNo, "Save the change")
If answer = vbNo Then Cancel = True
If answer = vbYes Then
'open outlook type stuff
Set OutlookApp = CreateObject("Outlook.Application") Set OlObjects =
OutlookApp.GetNamespace("MAPI") Set newmsg =
OutlookApp.CreateItem(olMailItem) 'add recipients
'newmsg.Recipients.Add ("Name Here")
newmsg.Recipients.Add Worksheets("Coordinator").Range("Q4").Value 'add
subject
newmsg.Subject = Worksheets("Coordinator").Range("O3").Value 'add body
newmsg.Body = "Dear User, New Submittal ( " & SubmitLink & " ) has been
Added in Submittal Log. Please Investigate the Change" & vbLf & vbLf &
vbLf & "Sincerely," & vbLf & "logs department"
newmsg.Display 'display
newmsg.Send 'send message
'give conformation of sent message
MsgBox "Modification confirmed", , "Confirmation"
End If
' MsgBox "Cell " & Target.Address & " has changed."
End If
End Sub
Topic 263
Subject
Date-Time format that parses in Excel, Chrome, and Firefox
Question
Is there a date-time format for CSV that's recognized by Excel, Chrome, and
Firefox (and ideally more broadly) and valid across locales in US and EU?
Excel can read CSV with ISO Dates, but does not recognize the ISO Date Time

values in the first column:
Here's an example CSV:
"datetime"
"1985-07-17T09:12Z"
"1985-07-17 09:12"
"1985-07-17"
"12/10/2010 9:12",
"10-Dec-2010 09:11",
"Dec 10, 2010 09:11"
"1985-07-17T09:12Z" parses in Chrome and Firefox but not Excel "1985-07-
17 09:12" parses in Chrome and Excel but not Firefox "1985-07-17" parses in
Chrome, Excel and Firefox but loses the time "12/10/2010 09:12" parses in
Chrome, Excel and Firefox but assumes US Locale "10-Dec-2010 09:11" does
not parse in Firefox "Dec 10, 2010 09:11" parses in Excel, Chrome and
Firefox ... but US only??
Chrome can read lots of locale-specific date time formats, but Firefox is
pickier.
Update: Added a more complete example
Question: Does "Dec 10, 2010 09:11" parse for me in all three only because
I'm in the US, or would this work more generally?
Date format that is guaranteed to be recognized by Excel Parsing an ISO8601
date/time (including TimeZone) in Excel Answer
The following format:
1985/07/17 09:12 - (YYYY/MM/DD HH:mm)
works in Chrome, Firefox, IE, Safari, Edge (parsed with javascript new
Date()). Excel also parses this format (at least in my locale with default
YYYY-MM-DD date format).
Topic 264

Subject
Macro error “Autofill Method of Range Class Failed” in excel
Question
I'm trying to run the below script in a macro and it keeps giving me this error
"Autofill Method of Range Class Failed." Any advice please?
Dim WS_Count As Integer
Dim I As Integer
WS_Count = ActiveWorkbook.Worksheets.Count For I = 9 To WS_Count
Sheets(I).Select
Selection.AutoFill Destination:=Range("C19:C114"), Type:=xlFillDefault
Range("C19:C114").Select
Next I
Answer
Please make sure you sheet names are exactly as Sheet(I) It shows I is a just
number. So your sheet names are number?
Dim WS_Count As Integer
Dim I As Integer
WS_Count = ActiveWorkbook.Worksheets.Count For I = 9 To WS_Count
Sheets(I).Select 
   Range("C19:C20").Select 
    Selection.AutoFill Destination:=Range("C19:C114"),
Type:=xlFillDefault 
Range("C19:C114").Select
Next I
Answer
You could try this which doesn't need to Select anything. It also eliminates
screen flicker and is faster.

Sub AutoFillC()
Dim WS_Count As Integer
Dim I As Integer
Application.ScreenUpdating = False
WS_Count = ActiveWorkbook.Worksheets.Count For I = 9 To WS_Count 
      Sheets(I).Range("C19:C20").AutoFill _ 
          Destination:=Range("C19:C114"), Type:=xlFillDefault
'        Range("C19:C114").Select **There is rarely need to _ 
          use the .Select method! 
Next I
Application.ScreenUpdating = True
End Sub
@harun24hr There is rarely a need to Select any Range on a Sheet. For simple
commands like the OP, specify the Range and the Method you want to apply to
it. If you have multiple Methods to perform on the Range, use a structure like
this. Note the periods "." before each Method
With Range
'.Method
'.Method1
End With
Selecting ranges slows your code down, particularly if you haven't disabled
ScreenUpdating.
Topic 265
Subject
Basic VBA Excel auto fill
Question
it's been a while since I post in SO, anyways nostalgia aside...
I've been trying to learn VBA in Excel, in the most basic ways, supposedly
there's this table:

Each Manager, Supervisor, and Officer has many benefits, now, my goal is to
make an auto-column-fill in Benefit Type B, C, D (which depends on chosen A
value)
e.g.: when I click the Manager Benefit Type A: 750,000, there is a dropdown
with value 750,000, 800,000 and 850,000, which change Benefit Type B, C,
and D value every time I change between Benefit Type A value
(note: I have a some kind of table database containing each Manager,
Supervisor, and Officer value, and it's possible that this database will grow
bigger, below are example for Manager list of Benefit Type value)
I've been trying to use VLOOKUP, HLOOKUP, INDEX MATCH, but I think it
will be easier (scalable, as the benefit type database will grow) with VBA, so
could someone give me a hint or, at least, point me to the right direction? Sorry
if this question is not in SO scope (in case it is).
Thanks!
Topic 266
Subject
Executing an ADO recordset command in VBA is throwing error “Conversion
failed when converting the nvarchar value”
Question
This is driving me absolutely up the wall! If anyone can suggest a fix for this I
will be eternally grateful! And apologies for the length of the post.
PROBLEM
I am trying to execute a SQL stored procedure through VBA using a recordset
with parameters created by looping through an excel range and on execute as
soon as I hit a string value I keep getting the error "Conversion failed when
converting the nvarchar value 'LIU AUS PI Civil Liability Policy Wording (08-
10)' to data type int." - Needless to say that the field ("Wording") which would
contain this value is set to NVARCHAR(255), the Stored Procedure accepts it
as a SQL_VARIANT and then immediately Casts it to an NVARCHAR(255)
AND the recordset parameter records it as an adVARWChar! What is going

on??
VBA CODE
'Create the command set
Set rsCmd = New ADODB.Command
'define the command
rsCmd.CommandType = adCmdStoredProc
rsCmd.CommandText = "dbo.USP_Insert_Policy"
'29/01/2016
'Make sure we have appended the policy ID. rsCmd.Parameters.Append
rsCmd.CreateParameter("PolicyID", adInteger, adParamInput, 10, lPolicyID)
rsCmd.Parameters("PolicyID").Precision = 2
'Get remaining policy details from wksProgData and place into 'command for
submission to db via recordset. For Each rngFields In
wksProgData.Range("PolicyDetailsRange")
If rngFields.Offset(1, 0).value <> 0 Then 
     'Everything gets added as a string value. 
     rsCmd.Parameters.Append rsCmd.CreateParameter( _ 
                                Name:=rngFields.value, _ 
                                Type:=adVarWChar, _ 
                                Size:=Len(rngFields.Offset(1,
0).value), _ 
                                Direction:=adParamInput, _ 
                                value:=rngFields.Offset(1,
0).value) 
End If
Next rngFields
'Make sure we have a connection initialised. If gcnConnection Is Nothing Then
CreateConnection 'Open connection to database.
If gcnConnection.State <> adStateOpen Then gcnConnection.Open 'Set
connection for command

rsCmd.ActiveConnection = gcnConnection
'Execute the command and set to recordset. Set rsData = rsCmd.Execute
SQL TABLE
Column Name Data Type
Submission_ID nvarchar(255)
Rater_ID int
Additional_Insureds_Number int
Funds_Number int
Contractors_Number int
Date_Created datetime
Policy_Number nvarchar(255)
Expiring_Policy_Number nvarchar(255)
Expiring_Change_Details nvarchar(MAX)
Inception_Date datetime
Expiration_Date datetime
Continuity_Date datetime
New_Subsidiary_Asset_Size money
Quote_Options int
Conclusion nvarchar(MAX)
Conclusion_UW_Date datetime
Conclusion_Authorised_Date datetime
Post_Quote_Changes nvarchar(MAX)
Post_Quote_Changes_UW_Date datetime
Post_Quote_Changes_Authorised_Date datetime Current_Status nvarchar(255)
LOB_Code nvarchar(255)
SIC_Division nvarchar(255)
SIC_Description nvarchar(255)
SIC_Code nvarchar(255)
PL_Code_Category nvarchar(255)
PL_Code nvarchar(255)
Class_Code nvarchar(255)
Rater_Code nvarchar(255)
Close_Code nvarchar(255)
Jurisdiction nvarchar(255)
Territorial nvarchar(255)

Terrorism nvarchar(255)
Side_C nvarchar(255)
TRIA nvarchar(255)
Account_Grading nvarchar(255)
Currency nvarchar(255)
Exchange_Rate int
Wording nvarchar(255)
Wording_Discretion int
Wording_Comments nvarchar(MAX)
Wording_Other nvarchar(255)
Wording_Primary nvarchar(255)
Non_LIU_Wording_Comments nvarchar(MAX)
NSW_Building_VIC_EPA_Cover_Comments nvarchar(MAX)
Transaction_Type nvarchar(255)
Policy_Comments nvarchar(MAX)
Received_Date datetime
Layers nvarchar(255)
FAC_Included nvarchar(255)
Lead_Follow nvarchar(255)
Policy_Period int
Professional_Services nvarchar(MAX)
Factiva_Search nvarchar(255)
Factiva_Articles_Found nvarchar(255)
OFAC_Trade_Sanctions_Details nvarchar(MAX) Renewal_Changes_Details
nvarchar(MAX)
XOL_Additional_Comments nvarchar(MAX)
XOL_Primary_Wording_Reinstatements nvarchar(MAX)
XOL_Deeming_Provisions nvarchar(MAX)
XOL_Coverage_For_Partners_Previous_Busines nvarchar(MAX)
Transaction_Date datetime
Premium_Structure nvarchar(255)
Separate_Rated_DO nvarchar(255)
Separate_DO_Premium money
Insuring_Clause_1_1 nvarchar(255)
Override_Discount nvarchar(255)
Non_Standard_Excess nvarchar(MAX)
Breadth_Of_Coverage nvarchar(255)

APRA_Category nvarchar(255)
APRA_Description nvarchar(255)
APRA_Code nvarchar(255)
Bond_Description nvarchar(255)
Bond_Code nvarchar(255)
PRI_XS nvarchar(255)
Rater_Name nvarchar(255)
Policy_ID int
Confirmed bit
Layer bit
STORED PROCEDURE
CREATE PROCEDURE [dbo].[USP_Insert_Policy] @PolicyID
SQL_VARIANT = NULL, 
                  @Submission_ID  SQL_VARIANT =NULL, 
                  @Additional_Insureds_Number
SQL_VARIANT=NULL, 
                  @Funds_Number   SQL_VARIANT=NULL, 
                  @Contractors_Number SQL_VARIANT=NULL, 
                  @Date_Created   SQL_VARIANT=NULL, 
                  @Policy_Number  SQL_VARIANT=NULL, 
                  @Expiring_Policy_Number SQL_VARIANT=NULL, 
                  @Expiring_Change_Details  
SQL_VARIANT=NULL, 
                  @Inception_Date SQL_VARIANT=NULL, 
                  @Expiration_Date    SQL_VARIANT=NULL, 
                  @Continuity_Date    SQL_VARIANT=NULL, 
                  @New_Subsidiary_Asset_Size
SQL_VARIANT=NULL, 
                  @Quote_Options  SQL_VARIANT=NULL, 
                  @Conclusion SQL_VARIANT=NULL, 
                  @Conclusion_UW_Date SQL_VARIANT=NULL, 
                  @Conclusion_Authorised_Date
SQL_VARIANT=NULL, 
                  @Post_Quote_Changes SQL_VARIANT=NULL, 
                  @Post_Quote_Changes_UW_Date
SQL_VARIANT=NULL, 
                  @Post_Quote_Changes_Authorised_Date
SQL_VARIANT=NULL, 
                  @Current_Status SQL_VARIANT=NULL, 
                  @LOB_Code   SQL_VARIANT=NULL, 
                  @SIC_Division   SQL_VARIANT=NULL, 

                  @SIC_Description    SQL_VARIANT=NULL, 
                  @SIC_Code   SQL_VARIANT=NULL, 
                  @PL_Code_Category   SQL_VARIANT=NULL, 
                  @PL_Code    SQL_VARIANT=NULL, 
                  @Class_Code SQL_VARIANT=NULL, 
                  @Rater_Code SQL_VARIANT=NULL, 
                  @Close_Code SQL_VARIANT=NULL, 
                  @Jurisdiction   SQL_VARIANT=NULL, 
                  @Territorial    SQL_VARIANT=NULL, 
                  @Terrorism  SQL_VARIANT=NULL, 
                  @Side_C SQL_VARIANT=NULL, 
                  @TRIA   SQL_VARIANT=NULL, 
                  @Account_Grading    SQL_VARIANT=NULL, 
                  @Currency   SQL_VARIANT=NULL, 
                  @Exchange_Rate  SQL_VARIANT=NULL, 
                  @Wording NVARCHAR(255) =NULL, 
                  @Wording_Discretion SQL_VARIANT=NULL, 
                  @Wording_Comments   SQL_VARIANT=NULL, 
                  @Wording_Other  SQL_VARIANT=NULL, 
                  @Wording_Primary    SQL_VARIANT=NULL, 
                  @Non_LIU_Wording_Comments  
SQL_VARIANT=NULL, 
                  @NSW_Building_VIC_EPA_Cover_Comments  
SQL_VARIANT=NULL, 
                  @Confirmed  SQL_VARIANT=NULL, 
                  @Transaction_Type   SQL_VARIANT=NULL, 
                  @Policy_Comments    SQL_VARIANT=NULL, 
                  @Received_Date  SQL_VARIANT=NULL, 
                  @Layers SQL_VARIANT=NULL, 
                  @FAC_Included   SQL_VARIANT=NULL, 
                  @Lead_Follow    SQL_VARIANT=NULL, 
                  @Policy_Period  SQL_VARIANT=NULL, 
                  @Professional_Services  SQL_VARIANT=NULL, 
                  @Factiva_Search SQL_VARIANT=NULL, 
                  @Factiva_Articles_Found SQL_VARIANT=NULL, 
                  @OFAC_Trade_Sanctions_Details  
SQL_VARIANT=NULL, 
                  @Renewal_Changes_Details  
SQL_VARIANT=NULL, 
                  @XOL_Additional_Comments  
SQL_VARIANT=NULL, 
                  @XOL_Primary_Wording_Reinstatements
SQL_VARIANT=NULL, 
                  @XOL_Deeming_Provisions SQL_VARIANT=NULL, 
                  @XOL_Coverage_For_Partners_Previous_Busines
SQL_VARIANT=NULL, 
                  @Transaction_Date   SQL_VARIANT=NULL, 
                  @Premium_Structure  SQL_VARIANT=NULL, 

                  @Separate_Rated_DO  SQL_VARIANT=NULL, 
                  @Separate_DO_Premium    SQL_VARIANT=NULL, 
                  @Insuring_Clause_1_1    SQL_VARIANT=NULL, 
                  @Override_Discount  SQL_VARIANT=NULL, 
                  @Non_Standard_Excess    SQL_VARIANT=NULL, 
                  @Breadth_Of_Coverage    SQL_VARIANT=NULL, 
                  @APRA_Category  SQL_VARIANT=NULL, 
                  @APRA_Description   SQL_VARIANT=NULL, 
                  @APRA_Code  SQL_VARIANT=NULL, 
                  @Bond_Description   SQL_VARIANT=NULL, 
                  @Bond_Code  SQL_VARIANT=NULL, 
                  @PRI_XS SQL_VARIANT=NULL, 
                  @Layer  SQL_VARIANT=NULL, 
                  @Rater_Name SQL_VARIANT=NULL 
AS
IF @PolicyID <> 0
BEGIN 
      --Update table where policy ID is @PolicyID 
      UPDATE tblPolicy 
      SET             Submission_ID              
=CAST(@Submission_ID AS NVARCHAR(255)), 
                      Additional_Insureds_Number  =CAST(
@Additional_Insureds_Number AS int ), 
                      Funds_Number                =CAST(
@Funds_Number AS int ), 
                      Contractors_Number          =CAST(
@Contractors_Number AS int ), 
                      Date_Created              
=CAST(@Date_Created AS Datetime), 
                      Policy_Number              
=CAST(@Policy_Number AS NVARCHAR(255)), 
                      Expiring_Policy_Number      =  
CAST(@Expiring_Policy_Number AS NVARCHAR(255)), 
                      Expiring_Change_Details    
=CAST(@Expiring_Change_Details AS NVARCHAR(MAX)), 
                      Inception_Date            
=CAST(@Inception_Date AS DateTime ), 
                      Expiration_Date            
=CAST(@Expiration_Date AS DateTime ), 
                      Continuity_Date            

=CAST(@Continuity_Date AS DATETime ), 
                      New_Subsidiary_Asset_Size   =CAST(
@New_Subsidiary_Asset_Size AS money ), 
                      Quote_Options               =CAST(
@Quote_Options AS int ), 
                      Conclusion                
=CAST(@Conclusion AS NVARCHAR(MAX)), 
                      Conclusion_UW_Date          =CAST
(@Conclusion_UW_Date AS DATETIME), 
                      Conclusion_Authorised_Date
=CAST(@Conclusion_Authorised_Date AS DateTime), 
                      Post_Quote_Changes        
=CAST(@Post_Quote_Changes AS NVARCHAR(MAX)), 
                      Post_Quote_Changes_UW_Date
=CAST(@Post_Quote_Changes_UW_Date AS datetime), 
                      Post_Quote_Changes_Authorised_Date
=CAST(@Post_Quote_Changes_Authorised_Date AS datetime), 
                      Current_Status            
=CAST(@Current_Status AS NVARCHAR(255)), 
                      LOB_Code                  
=CAST(@LOB_Code AS nvarchar(255)), 
                      SIC_Division                =  
CAST(@SIC_Division AS nvarchar(255)), 
                      SIC_Description            
=CAST(@SIC_Description AS nvarchar(255)), 
                      SIC_Code                  
=CAST(@SIC_Code AS nvarchar(255)), 
                      PL_Code_Category          
=CAST(@PL_Code_Category AS nvarchar(255)), 
                      PL_Code                    
=CAST(@PL_Code AS nvarchar(255)), 
                      Class_Code                
=CAST(@Class_Code AS nvarchar(255)), 
                      Rater_Code                
=CAST(@Rater_Code AS nvarchar(255)), 
                      Close_Code                
=CAST(@Close_Code AS nvarchar(255)), 
                      Jurisdiction              
=CAST(@Jurisdiction AS nvarchar(255)), 
                      Territorial                
=CAST(@Territorial AS nvarchar(255)), 
                      Terrorism                  
=CAST(@Terrorism AS nvarchar(255)), 
                      Side_C                    
=CAST(@Side_C AS nvarchar(255)), 
                      TRIA                        =CAST(@TRIA
AS nvarchar(255)), 
                      Account_Grading            

=CAST(@Account_Grading AS nvarchar(255)), 
                      Currency                  
=CAST(@Currency AS nvarchar(255)), 
                      Exchange_Rate               =CAST(
@Exchange_Rate AS int ), 
                      Wording                    
=CAST(@Wording AS varchar(255)), 
                      Wording_Discretion          =CAST(
@Wording_Discretion AS int ), 
                      Wording_Comments          
=CAST(@Wording_Comments AS nvarchar(MAX)), 
                      Wording_Other              
=CAST(@Wording_Other AS nvarchar(255)), 
                      Wording_Primary            
=CAST(@Wording_Primary AS nvarchar(255)), 
                      Non_LIU_Wording_Comments  
=CAST(@Non_LIU_Wording_Comments AS nvarchar(MAX)), 
                    
NSW_Building_VIC_EPA_Cover_Comments=CAST(@NSW_Building_VIC_EPA
AS nvarchar(MAX)), 
                      Confirmed                   =CAST(
@Confirmed AS bit ), 
                      Transaction_Type          
=CAST(@Transaction_Type AS nvarchar(255)), 
                      Policy_Comments            
=CAST(@Policy_Comments AS nvarchar(MAX)), 
                      Received_Date              
=CAST(@Received_Date AS datetime ), 
                      Layers                      =CAST(
@Layers AS nvarchar(255)), 
                      FAC_Included                =CAST(
@FAC_Included AS nvarchar(255)), 
                      Lead_Follow                 =CAST(
@Lead_Follow AS nvarchar(255)), 
                      Policy_Period               =CAST(
@Policy_Period AS int ), 
                      Professional_Services       =CAST(
@Professional_Services AS nvarchar(MAX)), 
                      Factiva_Search              =CAST(
@Factiva_Search AS nvarchar(255)), 
                      Factiva_Articles_Found      =CAST(
@Factiva_Articles_Found AS nvarchar(255)), 
                      OFAC_Trade_Sanctions_Details=CAST(
@OFAC_Trade_Sanctions_Details AS nvarchar(MAX)), 
                      Renewal_Changes_Details     =CAST(
@Renewal_Changes_Details AS nvarchar(MAX)), 
                      XOL_Additional_Comments     =CAST(
@XOL_Additional_Comments AS nvarchar(MAX)), 

                      XOL_Primary_Wording_Reinstatements
=CAST( @XOL_Primary_Wording_Reinstatements AS nvarchar(MAX)),
                      XOL_Deeming_Provisions      =CAST(
@XOL_Deeming_Provisions AS nvarchar(MAX)), 
                    
XOL_Coverage_For_Partners_Previous_Busines
=CAST(@XOL_Coverage_For_Partners_Previous_Busines AS
nvarchar(MAX)), 
                      Transaction_Date            =CAST(
@Transaction_Date AS datetime ), 
                      Premium_Structure           =CAST
(@Premium_Structure AS nvarchar(255)), 
                      Separate_Rated_DO           =CAST
(@Separate_Rated_DO AS nvarchar(255)), 
                      Separate_DO_Premium         =CAST(
@Separate_DO_Premium AS money ), 
                      Insuring_Clause_1_1         =CAST
(@Insuring_Clause_1_1 AS nvarchar(255)), 
                      Override_Discount           =CAST
(@Override_Discount AS nvarchar(255)), 
                      Non_Standard_Excess        
=CAST(@Non_Standard_Excess AS nvarchar(MAX)), 
                      Breadth_Of_Coverage         =CAST(
@Breadth_Of_Coverage AS nvarchar(255)), 
                      APRA_Category               =CAST(
@APRA_Category AS nvarchar(255)), 
                      APRA_Description            =CAST(
@APRA_Description AS nvarchar(255)), 
                      APRA_Code                   =CAST(
@APRA_Code AS nvarchar(255)), 
                      Bond_Description            =CAST(
@Bond_Description AS nvarchar(255)), 
                      Bond_Code                   =CAST(
@Bond_Code AS nvarchar(255)), 
                      PRI_XS                      =CAST(
@PRI_XS AS nvarchar(255)), 
                      Layer                       =CAST(
@Layer AS bit ), 
                      Rater_Name                  =CAST(
@Rater_Name AS nvarchar(255)) 
      WHERE tblPolicy.Policy_ID=@PolicyID 
      SELECT * FROM tblPolicy WHERE Policy_ID = @PolicyID 
END;

The only thing I can think of now is that my parameters are not in the same
sequence as my stored procedure. However if they need to be in the same
sequence then why bother to use paramters and just go straight for SQL in my
VBA code. Answer
After much searching around on the idea the parameters needed to be in a
specific order it appears you can do the following to call a stored procedure
using named parameters.
Dim rsCmd As ADODB.Command
Set rsCmd = New ADODB.Command
rsCmd.CommandType = adCmdStoredProc
'Allow execution with names instead of position' rsCmd.NamedParameters =
True
Topic 267
Subject
Excel Reference another sheet from within a function defined by a cell
Question
Ok hopefully i can explain what i am needing to happen. So i have an Excel
Document that keeps track of our staff members individual KPI's that is stored
in their own sheet. What i am wanting to do is create a sheet that acts as the
template for the monthly overview. So that when i enter the month into cell B3
and the staff members name into cell E3 it will goto the staff members sheet
and get the required information from there.
Here is the formula i have so far that works well:
=INDEX('Jack'!F5:M84,MATCH(B3,'Jack'!A5:A84,0),MATCH(A6,'Jack'!F3:M
In the code above 'Jack' is the name of the staff members sheet - B3 is the
month to search for - and A6 refers to the KPI i am looking for. I need to
replace 'Jack' with the text that is entered into E3 so that i don't need to change
the code for every staff member.
Any help is greatly appreciated.
Answer

Try this formula. May be it will work for you.
=INDEX(INDIRECT(E3&"!F5:M84"),MATCH(B3,INDIRECT(E3&"!A5:A84
Topic 268
Subject
Why do the Excel files I upload to QBO via the API (IPP v3) require
(apparently unnecessary) repairs?
Question
I'm successfully uploading a file to the QBO API (v3) using this module.
When I download the file though -- through either the QBO web UI or the API -
- and then I open the file (on a Mac), I get this message:
Excel could not open my_file.xlsx because some content is unreadable. Do you
want to open and repair this workbook?
I respond "Open and Repair," and everything seems to be in order with the file,
so this isn't killing me, it's just ugly and I have a feeling a minor tweak to the
request_body part of the code (or nearby) would do it:
with open(file_name, "rb") as file_handler:
binary_data = file_handler.read()
extension = file_name.rsplit(".", 1)[1]
mime_type = { 
      "pdf" : "pdf", 
      # because here: https://technet.microsoft.com/en-
us/library/ 
      #  ee309278(office.12).aspx 
      #"xlsx":"vnd.openxmlformats-
officedocument.spreadsheetml.sheet", 
      # But then, on subsequent testing with a successful
upload... 
      "xlsx" : "vnd.ms-excel", 
      "pptx" : "vnd.ms-powerpoint"}.get(extension,
"plain/text") 

request_body = textwrap.dedent( 
      """ 
      --%s 
      Content-Disposition: form-data; name="file_content_0";
filename="%s" 
      Content-Type: application/%s 
      Content-Length: %d 
      Content-Transfer-Encoding: binary 
      %s 
      --%s-- 
      """ 
  ) % (boundary, fn, 
       #content_type, 
       mime_type, 
       len(binary_data), 
       binary_data, boundary) 
At first I thought the MIME type was the issue but I don't think it matters which
of the two shown here I use. I get the same result either way.
Ideas about the source of the problem and/or a solution?
Topic 269
Subject
VBA Excel- Worksheet_calc defining variable value of cell that has an
equation, mismatch error
Question
I'm trying to compare the value of the cells in X1 through X5 to something. I.e.
If X4 = "buy" and X3 <= -130 then execute code.
I keep getting a mismatch type error though. The cells in the spreadsheet
contain equations (like vlookup) to obtain their value.
I did this in Worksheet_calculate because I need it update when the X cells
change (which is like every second)
Any help for this newbie would be very much appreciated!!

Private Sub Worksheet_Calculate()
'On Error Resume Next
'Sheets("Basic Orders").Unprotect Password:="password" Dim dir As String
Dim unpl As Integer
Dim pl As Integer
Dim loss As Integer
Dim possize As Integer
Dim notrade As Boolean
Dim ExpirationDate As String
Dim NameExists As Boolean
Dim LastRow As Long
dir = Range("X4").value
unpl = Range("X3").value
pl = Range("X2").value
loss = Range("X5").value
possize = Range("X1").value
If dir = "BUY" And unpl <= -130 And possize <> 0 Then 'stop loss of 130
dollars LastRow = ActiveSheet.Cells(rows.Count, 1).End(xlUp).row
Cells(LastRow + 1, 1).value = "EUR"
Cells(LastRow + 1, 2).value = "CASH"
Cells(LastRow + 1, 8).value = "IDEALPRO" Cells(LastRow + 1, 10).value =
"USD"
Cells(LastRow + 1, 13).value = "SELL"
Cells(LastRow + 1, 14).value = possize
Cells(LastRow + 1, 15).value = "MKT"
ActiveSheet.Cells(LastRow + 1, 1).Select Call
OrderFunctions.order2(Selection.rows, serverCell, extAttribColumn, True)
ActiveCell.offset(0, 25).value = Time
ActiveCell.offset(0, 25).NumberFormat = "h:mm:ss AM/PM" Answer
Type mismatch refers to the value being put into the variable being the wrong
type. As an example, the output of your formula in X1 may be a string, instead
of the required Integer type.
You can test the content of cell X1

var=Range("X1")
Stop
Hold your mouse over "var" and it should show the content of the variable. If
it's a number quotes, it is a string and can't be used as is.
var=Val(Range("X1"))
will give you a numerical output, even if X1 contains a string.
Answer
I figured out the issue, in my X1 sum equation the column u10:u90 would go
between numbers and text.
So I just filtered it out for the numbers only and it works. Thanks guys!
Topic 270
Subject
NEWBIE, is this turning into spaghetti code? [closed]
Question
So I am literally 24hrs into trying to learn this. I know that this can be
simplified into smaller methods and functions, but I not quite that far yet. So
this code, the way it stands works and I haven't made it crash too hard yet. Any
help and suggestions are awesomely grateful. Thanks guys.
Private Sub CommandButton2_Click()
Dim myInOut As String
Dim myToolType As String
Dim myOrderNumber As String
Dim myQTY As Integer
Dim myToolDesc As String

Dim myEmployee As String
Dim myDate As Date
Dim myLastRowA As Long
Dim myLastRowB As Long
Dim myRow As Long
Dim myNewTool As Long
Dim myNewRow As Long
myDate = DateTime.Now
myLastRowA =
ActiveWorkbook.Sheets("Sheet1").Range("A3").End(xlDown).Row - 2
If ActiveWorkbook.Sheets("Sheet1").Cells(3, 2).Value = "" Then
Exit Sub
End If
'Finds the Matching Row for the In/Out Order Number AND Updates QTY
'MsgBox "LastRowA - " & myLastRowA 'Debugging
For a = 1 To myLastRowA
myNewTool = True
myLastRowB =
ActiveWorkbook.Sheets("Sheet2").Range("A3").End(xlDown).Row 'MsgBox
"LastRowB - " & myLastRowB & vbCrLf & "OrderNumber - " &
myOrderNumber 'Debugging 
      With ActiveWorkbook.Sheets("Sheet1") 
          myInOut = .Cells(3, 1).Value 
          myToolType = .Cells(3, 2).Value 
          myOrderNumber = .Cells(3, 3).Value 

          myQTY = .Cells(3, 4).Value 
          myToolDesc = .Cells(3, 5).Value 
          myEmployee = .Cells(3, 6).Value 
          For b = 1 To myLastRowB 
              If ActiveWorkbook.Sheets("Sheet2").Cells(b,
2).Value = myOrderNumber Then 
                  myRow =
ActiveWorkbook.Sheets("Sheet2").Cells(b, 2).Row 
                  'MsgBox "True " & myRow      'Debugging 
                      If myInOut = "IN" Then 
                          'Adds In/Out QTY to the Stock QTY 
                        
ActiveWorkbook.Sheets("Sheet2").Cells(myRow, 4).Value =
ActiveWorkbook.Sheets("Sheet2").Cells(myRow, 4).Value + myQTY 
                        
ActiveWorkbook.Sheets("Sheet1").Rows(3).Delete 
                          myNewTool = False 
                      ElseIf myInOut = "OUT" Then 
                          'Subtracts In/Out QTY to the Stock
QTY 
                        
ActiveWorkbook.Sheets("Sheet2").Cells(myRow, 4).Value =
ActiveWorkbook.Sheets("Sheet2").Cells(myRow, 4).Value - myQTY 
                        
ActiveWorkbook.Sheets("Sheet1").Rows(3).Delete 
                          myNewTool = False 
                      End If 
              End If 
          Next b 
      If myNewTool = True Then 
          myNewRow = myLastRowB + 1 
          'MsgBox "NewTool" & myNewTool        'Debugging 
          If myInOut = "IN" Then 
              ActiveWorkbook.Sheets("Sheet2").Cells(myNewRow,
1).Value = myToolType 
              ActiveWorkbook.Sheets("Sheet2").Cells(myNewRow,
2).Value = myOrderNumber 
              ActiveWorkbook.Sheets("Sheet2").Cells(myNewRow,
3).Value = myToolDesc 
              ActiveWorkbook.Sheets("Sheet2").Cells(myNewRow,
4).Value = myQTY 
              ActiveWorkbook.Sheets("Sheet1").Rows(3).Delete 
          ElseIf myInOut = "OUT" Then 
              MsgBox "THE ORDER NUMBER OF " & myOrderNumber &
" IS NOT IN THE DATABASE" & vbCrLf & myToolType & " " &
myToolDesc & vbCrLf & "DOES NOT EXIST. PLEASE EDIT YOUR
SELECTION." 

              Exit Sub 
          End If 
      End If 
End With
Next a
End Sub
Answer
That is a lot of functionality in one Sub, so yes, it's trending towards spaghetti
code.
People have different opinions over how long a Sub should be, but as a rule of
thumb, you generally want routines, functions, and other units of code to be no
more than 10-20 lines; exceptions should be pretty rare. You have about 60
lines, even after removing comments and blank lines. That's getting up there.
You also have a dozen variables, nested loops, and lots of if statements. The
cyclomatic complexity of your code is thus getting rather high.
Also, as pointed out in the comments, you reuse several identifiers like
ActiveWorkbook.Sheets("Sheet1").Range("A3") multiple times. This makes
the code hard to read and subject to breaking if anything changes and affects
one of those values while your code is running.
So, yes, you should try to break this down into smaller pieces.
Topic 271
Subject
Select and clear contents of an unspecified cell range in newly copy and pasted
worksheet
Question
I am trying to achieve the following:
I have a VBA button that when clicked, copies the active worksheet and pastes
it into a new worksheet (I have this function already working perfectly - see
code below). I then want the newly pasted worksheet to find two specified

cells, which contain the texts ("bus start") and ("bus finish") and clear all the
contents in the cells that are in between the range of the two specified cells.
The rows are dynamic and will change over time as rows get added and
deleted, hence why I cannot define a fixed range. Columns however, will not
be deleted or added and therefore will be fixed.
For reference, here is my copy and paste code:
Private Sub WkCapBtn_Click()
Dim Ws1 As Worksheet
Set Ws1 = ActiveSheet
Ws1.Copy ThisWorkbook.Sheets(Sheets.Count) 
      ActiveSheet.Range("C3").Value = DateAdd("d", 7,
ActiveSheet.Range("C3")) 
          ActiveSheet.Name =
Format(ActiveSheet.Range("A1").Value, ("dd-mmm-yy")) 
End Sub
My initial thinking was to use a .Find function to locate the specified cells and
then use a .Offset to select the cells below and above. Where I am stuck though
is actually trying to define the range between the specified cells.
If any additional information is needed, please let me know. Thank you in
advance! Answer
I corrected your code a little for the beginning:
Static WsCopy As Worksheet
Static Ws1 As Worksheet
Private Sub WkCapBtn_Click()
Set Ws1 = ThisWorkbook.Sheets("ORIGINALSHEETNAME")

Set WSCopy = Ws1.Copy After:=(ThisWorkbook.Sheets(Sheets.Count)) With
WSCopy 
      .Name = Format(.Range("A1").Value, ("dd-mmm-yy")) 
      .Range("C3").Value = DateAdd("d", 7, .Range("C3")) 
End With
End Sub
For your other sub you could set a variable for the cells containing either "bus
start" or "bus finish". Can you try the following code and tell me if it worked?
Private Sub DelBusRange()
Dim BusStart As Range
Dim BusFinish As Range
With WsCopy 
      Set BusStart = .Find(What:="Bus start", _ 
                      After:=.Cells(.Cells.Count), _ 
                      LookIn:=xlValues, _ 
                      LookAt:=xlPart, _ 
                      SearchOrder:=xlByRows, _ 
                      SearchDirection:=xlNext, _ 
                      MatchCase:=False) 
      Set BusFinish = .Find(What:="Bus finish", _ 
                       After:=.Cells(.Cells.Count), _ 
                       LookIn:=xlValues, _ 
                       LookAt:=xlPart, _ 
                       SearchOrder:=xlByRows, _ 
                       SearchDirection:=xlNext, _ 
                       MatchCase:=False) 
      .Range(BusStart, BusFinish).clear 
End With
End Sub
Answer

Chris Neilson's code did the trick once I changed it around.
Private Sub WkCapBtn_Click()
Dim Ws1 As Worksheet
Dim FindBus1 As String
Dim FindBus2 As String
Dim BusMatch1 As Range
Dim BusMatch2 As Range
Set Ws1 = ActiveSheet
Ws1.Copy ThisWorkbook.Sheets(Sheets.Count) 
      ActiveSheet.Range("C3").Value = DateAdd("d", 7,
ActiveSheet.Range("C3")) 
          ActiveSheet.Name =
Format(ActiveSheet.Range("A1").Value, ("dd-mmm-yy")) 
      FindBus1 = "Bus Start" 
      FindBus2 = "Bus Finish" 
      Set BusMatch1 = ActiveSheet.Cells.Find(FindBus1) 
      Set BusMatch2 = ActiveSheet.Cells.Find(FindBus2) 
      ActiveSheet.Range(BusMatch1.Offset(3, 1),
BusMatch2.Offset(-2, 1)).ClearContents 
End Sub
Topic 272
Subject
Convert the date from PST to IST and output the difference in hour
Question
Is there any way to automatically convert PST Date in to IST date. When I put
date in column E and F I have dates in PST time zone. I want to convert in IST
time zone. after i want output in column G. the difference between two dates.
I have solved this with excel formula but I want this to done with VBA.

For eg. 
> E                           F                      G 
1/14/2016  2:49:00 PM     1/14/2016  2:57:00 PM          0:08 
1/14/2016  2:45:00 PM     1/14/2016  2:59:00 PM          0:09 
Answer
Consider
Sub qwerty()
Dim pst As Date, ist As Date
pst = DateSerial(2016, 1, 14) + TimeSerial(14, 49, 0) ist = pst +
TimeSerial(13, 30, 0)
MsgBox pst & vbCrLf & ist
End Sub
Topic 273
Subject
Use Python to search and pull data from Excel
Question
import csv
subject = ['emergency', 'new ticket', 'problem with'] from_to = ['chris',
'timothy', 'daniel', 'david', 'jason']
a = open('D:\testfile.csv', 'w')
New to python. So, here's what I'd like to do.
1. Open an excel csv file
2. Search for specific keywords that are in a list
3. If the keywords are found, pull the data that is in the D,E,F columns only.
(Since that is where the keywords will be)
4. Write this data to a new file

Example. Search testfile.csv for any of the keywords in the from_to list. If
these keywords appear ONLY in the D or E columns of excel AND if the
corresponding column F is not equal to the subject list, then write a new file
that has the columns of D,E,F and the associated lines, however many there
are, with it
Also, I put the stars next to the names/items in the list to denote a wildcard, eg
if the from_to contains chris.gmail.com or daniel@yahoo. Answer
This solution has a list of keywords, an input file that you read line by line,
tokenize each line into a list of strings, then iterate your keyword list to check
if any of them is in the tokenized line. If any keyword is found it writes the line
to the output file.
keywrds = ["word1", "word2", "etc"]
with open ("myfile.csv") as fin:
with open ("outfile.txt") as fout: 
      for line in fin: 
          line_tokens = line.split(",") 
          for word in keywrds: 
              if word in line_tokens: 
                  fout.write(line_tokens[3:6].join(" ") +
"\n") 
Topic 274
Subject
Sum first three (or four) non blank cells in a row
Question
I have a box office sheet. It's far more complex than this, but basically it is:
I want to sum only the first 3 days gross of each film (opening weekend),
jumping the blank cells. To make it a little more complicated, I want to add the
possibility for a 4 or 5-day opening weekend. There could be a column where
I'd enter the number of days.
I'm only familiarized with basic functions and a few complex ones. Is it

possible to keep it simple? Answer
While I usually try to accomplish formula results without array formulas¹, I
don't know any way to accomplish this without one.
In E4 as an array formula¹:
=SUM(INDEX(F4:L4, 0, MATCH(1,SIGN(LEN(F4:L4)),0)):
INDEX(F4:L4, 0, MATCH(1,SIGN(LEN(F4:L4)),0)+D4-1))
Fill down as necessary. Some IFERROR functionality could wrap around that
for circumstanses where the # of days and available columns are mismatched.
       
¹ Array formulas need to be finalized with Ctrl+Shift+Enter↵. Once entered
into the first cell correctly, they can be filled or copied down or right just like
any other formula. Try and reduce your full-column references to ranges more
closely representing the extents of your actual data. Array formulas chew up
calculation cycles logarithmically so it is good practise to narrow the
referenced ranges to a minimum. See Guidelines and examples of array
formulas for more information.
Topic 275
Subject
Use Index Match to Return Value Using Lookup Value from Multiple Columns
Question
I'm trying to return a value from one column using values from a range of 3
columns. When I enter an electrical, plumbing or gas permit number into a
report (D14) I want the corresponding building permit number to be entered
into another cell as the file reference. The report is one worksheet and the list
of permit numbers is another worksheet in the same workbook. It's one permit
one report so I don't think I need anything complicated. VLOOKUP didn't work
because I need to search right to left.
This is the Index Match formula I've used but I can only use 1 column as the

lookup value and I have a column for each type of permit.
=INDEX(Building!$A2:$A25000,MATCH(D14,Building!$D2:$D25000,0))
Answer
Wrap your MATCH function(s) in IFERROR function(s) so that the lookup is
passed to the next column if it is not found.
=INDEX(Building!$A:$A, IFERROR(MATCH(D14, Building!$D:$D, 0), 
                     IFERROR(MATCH(D14, Building!$E:$E, 0), 
                     IFERROR(MATCH(D14, Building!$F:$F, 0),
"nowhere")))) 
Topic 276
Subject
Array comparison - EXcel
Question
I have 3 columns, Name, Team and result. I want to compare results of students
from the same team. If even one student from the same team failed, I want the
"overall result' column to display 'fail'. I have attached what I want below.
how do i compute the 'overall result' column on excel?
**Name Team Result Overall result** 
a1         1    Pass    Fail 
a2         4    Fail    Fail 
a3         2    Pass    Pass 
a4         1    Pass    Fail 
a5         2    Pass    Pass 
a6         5    Pass    Pass 
a7         1    Fail    Fail 
Topic 277
Subject
INDEX, COUNTA? Repeat row value N times for every nonblank cell in
criteria

Question
Questions:
I can't quite figure out the function needed in order to list each vegetable in a
single column (in Table 2 Col C) the same number of times (weeks) it is
harvested in Table 1 (col C-E)? Would I use Index with some other function?
For each time a vegetable is repeated in a row in Table 2, how can I match
each repetition to each of its harvest weeks (1 per row) in a neighboring
column in Table 2? (See Table 2, Col D)
TABLE 1
A B C D E
crop unit aug8 aug15 aug22
1 corn ear 10
2 onion lb 15
3 beets lb 5 5 5
TABLE 2 
      A     B    C     D 
    date1 date2 crop  harvest date 
  1             corn  aug8 
  2             onion aug8 
  3             beets aug8 
  4             beets aug15 
  5             beets aug22 
Thanks in advance for the help.
Topic 278
Subject
Getting first 3 chars from “Job No.” to use as filter - Jet Reports
Question
I am struggling to get the Quantities from the Job Ledger Entries Table which I
need to filter on the first 3 letters of the Job No. pulled from the Item Budget
Entries..

I am new to Jet Reports and using Express.. I have tried the function:
Should I add it as a line of code = to a variable then use the variable?
My table query looks like this so far:
=NL("Table";"Item Budget
Entry";$E$12:$I$12;"Headers=";$E$11:$I$11;"TableName=";"Item Budget
Entry";"Filters=";$C$5:$D$6;"InclusiveLink=Item Budget
Entry";$E$10;"IncludeDuplicates=";"True")
With Filters:
Answer
I think this will be hard to achive with the express version. In the Essentials
version you are able to add Excel formulas to your table.
What I would do is create two tables, one with item budget entry and one with
job ledger entry. And then use excel to calculate the sums.
Or use the Essentials version, which will make your life a lot easier.
Topic 279
Subject
In Excel, return all values from separate sheet for columns with matching
headers
Question
I need to pull all values from columns with matching data headers from a sheet
we'll call "Source" to a sheet we'll call "Destination", under the matching
header.
For instance, there is a column with header "Address" in both sheets. In the
Source sheet, that column contains URLs. I need a way to pull all of these
URLs into the "Address" column in the Destination sheet.
I'm not sure if this will make a difference, but I need to do the same for quite a
few columns in these sheets.

Is there a way to do this?
Thanks in advance!
Answer
You could paste this formula in every cell on the Destination sheet that you
want to pull a value for. You will need to change the forumla from $A:$Z and
from $A$1:$Z$1 to something else depending on how many columns are in the
source sheet:
=IF(ISBLANK(INDEX(Source!$A:$Z,ROW(),MATCH(A$1,Source!$A$1:$Z$
Topic 280
Subject
Sorting and finding duplicates in excel columns
Question
I have five columns in my spreadsheet, three of which are filled with assorted
names( the first, fourth and fifth columns).
I need a way to cross-reference each cell in the A column with the D and E
columns, then have an output that answers the question in the B and C column
(which you can see as the Xs), as to whether it was found. I've tried a
combination of VLOOKUP and MATCH, but this is proving to be out of my
realm. I haven't used excel much lately.
EDIT: Added a picture instead of a diagram Answer
In Cell B3 use =IF(COUNTIFS(D:D,A:A),"","X")
and in C3 use =IF(COUNTIFS(D:D,A:A),"","X")
copy down as far as required
Formula says "If count of names in D:D equal to name in current row in A:A is
> 0 then return blank, else return "X"
Test is case-insensitive.

Topic 281
Subject
Data corrupting on program close in jxl
Question
Im using jxl to store data entered in by the user into an excel spreadsheet. I
want to be able to close my program while its running and open up the excel
spreadsheet and view the data. Whenever I do this, I get a message that says
that it is in a different format than specified in the file extension. Here is my
code.
import java.io.File;
import java.io.IOException;
import java.util.Scanner;
import jxl.;
import jxl.write.;
import jxl.Workbook;
import jxl.read.biff.BiffException;
import jxl.write.Label;
import jxl.write.Number;
import jxl.write.WritableSheet;
import jxl.write.WritableWorkbook;
import jxl.write.WriteException;
import jxl.write.biff.RowsExceededException;
public class ReadWriteTest
{
public static void main(String[] args) throws BiffException, IOException,
RowsExceededException, WriteException {
Scanner scan = new Scanner(System.in);
int i = 1;
Integer iAlliance = -1;

File test = new File("C:\\test.xls");
WritableWorkbook wb = Workbook.createWorkbook(test); 
      while(iAlliance != 0 && i != 5) 
      { 
          WritableSheet sheet = wb.createSheet("Sheet" + i,
i); 
          iAlliance = scan.nextInt(); 
          WriteExcel.addNumber(sheet, 0, 0, iAlliance); 
          iAlliance = scan.nextInt(); 
          WriteExcel.addNumber(sheet, 1, 0, iAlliance); 
          i++; 
      } 
      wb.write(); 
      wb.close(); 
}
}
Answer
"close my program while its running"
Your code needs to handle that. Right now, it just gets killed at any point
(probably in that loop), and nothing after that point happens. The
WriteableWorkbook never gets write() or close() called, and the file is
probably corrupted.
So see this, try adding some simple output at various places, like "got to line
number XXX". Run it, close it, and see how far it got.
You'll probably need to wrap the bulk of your code in a try-catch-finally. The
loop is inside the try, the catch handles the lightning-out-of-the-blue program
closing from that pesky human at the keyboard, and the finally closes up the
workbook file properly.

Topic 282
Subject
Why is my result blank
Question
I'm new to python, I'm using XLRD to read from an excel. I'm attempting to
check the value of the first cell of each row against my variable mid using the
following code
import xlrd
file_location="Z:/DASHBOARD/test.xls"
workbook = xlrd.open_workbook(file_location) sheet =
workbook.sheet_by_index(0)
mid=5348120284087186
for row_count in range(sheet.nrows):
if (sheet.cell_value(row_count, 0)==mid):
print sheet.row_values(row_count)
When I comment out the if statement it runs fine without checking, displaying
the rows. With the if statement I get no results back. 5348120284087186 is the
value in the first cell on multiple lines and the value of mid. Is there additional
formatting I need to use with xlrd in order to find that value? I've attempted to
not use the variable and just use 5348120284087186 as the comparison for the
statement with the same results. Answer
You wrote: Attempted the fix with int() for row_count in range(sheet.nrows):
if (int(sheet.cell_value(row_count, 0))==mid):
print sheet.row_values(row_count)
which resulted in error stating:
ValueError: invalid literal for int() with base 10: 'Run Date: '

That means the value in the cell isn't an integer like you thought, but 'Run Date:
'.
Topic 283
Subject
unhiding rows based on cell value for data entry - refresh error
Question
I've set up a worksheet that will allow the user to select preset options from a
data validation list in a cell (B23). The user's selection off this one cell will
then trigger certain rows to be unhidden, guiding the user to input data into only
the appropriate rows. The VBA code I am using for unhiding the appropriate
rows works fine, EXCEPT for the fact that whenever a user enters data into
one of the unhidden rows, all the rows will hide. The user then needs to
reselect their option from the initial data validation list (cell B23) to unhide
the appropriate rows again. The value they enter is entered and saved in the
cell, but they need to reselect their initial choice between each data entry step,
which is annoying and what I'd like to fix.
I suspect that:
1)the VBA code I hobbled together doesn't account for the fact that users will
be entering data into rows that are hidden / will be triggered to unhide, and/or
2) the crux of the problem is refreshing the cell with the data validation list
(B23) that triggers which rows to be unhidden. I unfortunately have no idea
how to do this.
Any help would be very much appreciated!!
My VBA code to hide rows is below.
Private Sub Worksheet_Change(ByVal Target As Range) Dim allRows As
Range
Set allRows = Rows("27:64")
allRows.Hidden = True
If Not Intersect(Target, Range("B23")) Is Nothing Then

If Target.Value = "A1" Then
Rows("27:31").Hidden = False
ElseIf (Target.Value = "A10-A-S" Or Target.Value = "A10-A-P" Or
Target.Value = "A10-A-T") Then
Rows("32:36").Hidden = False
ElseIf (Target.Value = "A10-B-S" Or Target.Value = "A10-B-P" Or
Target.Value = "A10-B-T") Then
Rows("37:44").Hidden = False
ElseIf (Target.Value = "E19S" Or Target.Value = "E19P" Or Target.Value =
"E19T") Then
Rows("46:54").Hidden = False
ElseIf (Target.Value = "E20S" Or Target.Value = "E20P" Or Target.Value =
"E20T") Then
Rows("56:64").Hidden = False
End If
End If
End Sub
Answer
You're right that as soon as anyone changes anything on the worksheet, the
Worksheet_Change event will fire and hide those rows.
A simple option would probably be to wrap that code around a check that the
change was triggered by your dropdown:
With Target
If .Count = 1 Then 
      If .Row = 23 And .Column = 2 Then ' Assumes your list
result is B23? 
         allRows.Hidden = True 
         ' do your other checks and updates here... 
      End If 

End If
End With
Answer
You should check if the target is B23 and if not Exit Sub. Maybe Something
like this.
If Intersect(Target, Range("B23")) Is Nothing Then
Exit Sub
End If
Topic 284
Subject
Apache POI event API Update existing Excel sheet
Question
I have large excel file with several worksheets. I want to process just one
sheet in file...Read value from two columns and update two columns.
Using this code, I am able to read data from sheet.But unable to figure out, how
to save output back.
public class ExcelFunctions {
private class ExcelData implements SheetContentsHandler {
private Record rec ;
public void startRow(int rowNum) { 
      rec = new Record(); 
      output.put("R"+rowNum, rec); 
}

public void endRow(int rowNum) {
}
public void cell(String cellReference, String formattedValue,
XSSFComment comment) { 
      int thisCol = (new
CellReference(cellReference)).getCol(); 
      if(thisCol==7){ 
          try { 
              rec.setK1(formattedValue); 
          } catch (Exception e) { 
          } 
      } 
      if(thisCol==8){ 
          try { 
              rec.setK2(formattedValue); 
          } catch (Exception e) { 
          } 
      } 
      if(thisCol == 27){ 
          String key = rec.full_key(); 
          System.out.println(key); 
          ///////Process Matched Key...get Data 
          //////Set value to column 27 
      } 
      if(thisCol == 28){ 
          String key = rec.full_key(); 
          System.out.println(key); 
          ///////Process Matched Key...get Data 
          //////Set value to column 28 
      } 
}
public void headerFooter(String text, boolean isHeader, String tagName) { }
}
///////////////////////////////////////
private final OPCPackage xlsxPackage;

private final Map<String, Record> output;
public ExcelFunctions(OPCPackage pkg, Map<String, Record> output) {
this.xlsxPackage = pkg;
this.output = output;
}
public void processSheet( 
      StylesTable styles, 
      ReadOnlySharedStringsTable strings, 
      SheetContentsHandler sheetHandler, 
      InputStream sheetInputStream) 
      throws IOException, ParserConfigurationException,
SAXException { 
DataFormatter formatter = new DataFormatter(); InputSource sheetSource =
new InputSource(sheetInputStream); try { 
      XMLReader sheetParser = SAXHelper.newXMLReader(); 
      ContentHandler handler = new XSSFSheetXMLHandler( 
            styles, null, strings, sheetHandler, formatter,
false); 
      sheetParser.setContentHandler(handler); 
      sheetParser.parse(sheetSource); 
   } catch(ParserConfigurationException e) { 
      throw new RuntimeException("SAX parser appears to be
broken - " + e.getMessage()); 
   } 
}
public void process()
throws IOException, OpenXML4JException, ParserConfigurationException,
SAXException { ReadOnlySharedStringsTable strings = new
ReadOnlySharedStringsTable(this.xlsxPackage); XSSFReader xssfReader =
new XSSFReader(this.xlsxPackage); StylesTable styles =
xssfReader.getStylesTable(); XSSFReader.SheetIterator iter =

(XSSFReader.SheetIterator) xssfReader.getSheetsData(); boolean found =
false;
while (iter.hasNext() && !found) { 
      InputStream stream = iter.next(); 
      String sheetName = iter.getSheetName(); 
      if(sheetName.equals("All Notes") ){ 
          processSheet(styles, strings, new ExcelData(),
stream); 
          found = true; 
      } 
      stream.close(); 
}
}
@SuppressWarnings("unused")
public static void main(String[] args) throws Exception {
File xlsxFile = new File("C:\\Users\\admin\\Downloads\\Unique Name
Macro\\big.xlsm"); if (!xlsxFile.exists()) { 
      System.err.println("Not found or not a file: " +
xlsxFile.getPath()); 
      return; 
}
// The package open is instantaneous, as it should be. OPCPackage p =
OPCPackage.open(xlsxFile.getPath(), PackageAccess.READ_WRITE);
Map<String, Record> output = new HashMap<String, Record>();
ExcelFunctions xlFunctions = new ExcelFunctions(p, output);
xlFunctions.process();
p.close();
if (output != null){ 
      for(Record rec : output.values()){ 
          System.out.println(rec.full_key()); 
      } 

}
}
}
File is very large and I only want to use Event API. I have successfully tested
Using this code. But this loads Whole file in memory(causing application to
crash)...While I only need to edit One sheet.
public static void saveToExcel(String ofn, Map<String, Record> data) {
FileInputStream infile;
try { 
      infile = new FileInputStream(new
File("C:\\Users\\admin\\Downloads\\Unique Name
Macro\\big.xlsm")); 
      XSSFWorkbook workbook = new XSSFWorkbook (infile); 
      XSSFSheet sheet = workbook.getSheet("All Notes"); 
      for(Record rec : output.values()){ 
          Row dataRow = rec.getRow(rev.getRownum-1); 
          setCellValue(dataRow, 26, "SomeValue"); 
          setCellValue(dataRow, 27, "SomeValue"); 
      } 
      FileOutputStream out =  new FileOutputStream(new
File(ofn)); 
      workbook.write(out); 
      infile.close(); 
      out.close(); 
      workbook.close(); 
}
catch (FileNotFoundException e) { 
      // TODO Auto-generated catch block 
      e.printStackTrace(); 
}
}

private static void setCellValue(Row row,int col, String value){
Cell c0 = row.getCell(col);
if (c0 == null){
c0 = row.createCell(col);
}
c0.setCellValue(value);
}
Answer
I don't think there is anything provided in POI out of the box which allows to
do that.
Therefore you might be better off doing this by unzipping the XLSX/XLSM file
(they are actually a bunch of xml-files inside a zip) and reading the xml-files as
text-files or with a normal XML Parser so that you can easily write out the
changed file again to produce the XLSX/XLSM file again.
Topic 285
Subject
Excel Macro to combine cells of data when data matches in another column
Question
The best way I can explain my problem is by showing a few screenshots.
I need to turn data like this:
[
Into something that displays like this:
After Data
There are multiple part numbers in the file, and I need the macro to take all the
data from a matching part number and transform the data into what is displayed
in the second image. All the part numbers are grouped with their data together,
so it wouldn't need to run the loop through the top every single time, but adding
to the entries with each new piece of data. Something also needs to be done for

the years as well, because the way the data is presented, is in a range of years,
and I need an entry for each year in that range.
Additional Information:
I am using this data for prep for category data for a BigCommerce site, that is
working with a year/make/model plugin on the site, to create a vehicle lookup
system. Thus in order for the user to look up their vehicle accurately the
categories need to be listed the way they are in the second picture, which
needs to be the result of the macro.
I thank anyone who takes the time to look into this, it will cut down the time I
spend doing this manually by a huge amount. Answer
You can do this with a formula (without actual VBA):
In cell F2 write: ="YMM/"&C2&"/"&D2&"/"&E2&";" In cell F3 write:
=F2&"YMM/"&C3&"/"&D3&"/"&E3&";" drag down the formula in F3 until
the last row. The last row will contain the entire string of all vehicles.
I just noticed you may have duplicate values. You can use the built in Remove
Duplicates feature to remove those before using the above technique.
Topic 286
Subject
Excel Macro to merge a number of rows and output in a single line
Question
I’d like to know how to write a macro that takes a single column and then turns
X number of rows into a single line, then repeats this action for the entire
spreadsheet (to save someone from running this over 30,000 cells)
For example,
say I want it to select column C, but and concatenate every 5 lines into a single
line.
Then I'd have it output as new rows, containing those 5 pieces of data
I don’t have any code, unfortunately (I’m not a programmer, so bear with me

here). From my understanding, it would use something similar to this, but
include a for-loop somewhere to repeat the action until the end of the
document, which is what I’m confused with the most. Thanks in advance and
apologies for any confusion!
Topic 287
Subject
Need to know why Method Range of Object Worksheet Failed Error is
occuring
Question
The idea of the code below is to look up a few tables, match headers from two
different tables and move the answers from one table to the next.
The Method Range of Object Worksheet Failed is happening on the Find
function:
@ colForAnswer = ws.Range(rngColLookup).Find(curCell, LookIn:=xlValues,
SearchOrder:=xlByRows, SearchDirection:=xlNext).Column.
I have searched all over and cannot find any solutions that solve this problem.
Can someone please help me understand why it is not working.
Thank you!
Sub submitResponses()
'find question name, Grab answer column of table by row, match up to question
column, place answer 'view scoring functions if needed
'Redefine a named range of the column headers and search that
Dim rngHeaders As Range
Dim rngAppQ As Range, rngAppQ2 As Range, rngColLookup As Range Dim
rngAppAnswer As Range, rngAppAnswer2 As Range Dim i As Integer
Dim ws As Excel.Worksheet
Dim answerArea As Integer
Dim colForAnswer As Integer

Dim curCell As Variant
Set ws = ThisWorkbook.Worksheets(appSheet)
Set rngAppQ = Worksheets(aTable).Range("tAppInfo" & "[[#All],
[Questions]]") Set rngAppAnswer = Worksheets(aTable).Range("tAppInfo" &
"[[#All],[Answers]]") Set rngAppQ2 =
Worksheets(aTable).Range("tAppInfo2" & "[[#Headers]]") Set
rngAppAnswer2 = Worksheets(aTable).Range("tAppInfo2") Set rngColLookup
= Worksheets(appSheet).Range(appTable & "[[#Headers]]")
Debug.Print rngColLookup.Address
answerArea = ws.Cells.Find("*", SearchOrder:=xlByRows,
SearchDirection:=xlPrevious).Row + 1
For Each curCell In rngAppQ
Debug.Print curCell
Debug.Print rngColLookup.Address
colForAnswer = ws.Range(rngColLookup).Find(curCell, LookIn:=xlValues,
SearchOrder:=xlByRows, SearchDirection:=xlNext).Column
ws.Cells(answerArea, colForAnswer).Value = curCell
Next
End Sub
Topic 288
Subject
VBA Filter error
Question
I have a filter field called week_of_year (1,2,3,4,5,6,7,8....), another pivot
field year(2012,2013,2014), the vba code belows filter on the current week
and year of 2014/2015 and hide everything else. But the problem is the code
loops each record and runs slow when it comes to big pivot table. Im trying on
a new code but encountering some error.

Sub datefilter()
Dim PvtTbl As PivotTable
Set PvtTbl = Worksheets("LO").PivotTables("PivotTable3") Dim dd As
Integer
dd = Format(Date, "ww")
Dim pf As PivotField
Dim pf1 As PivotField
Dim PI As PivotItem
Set pf =
Worksheets("LO").PivotTables("PivotTable3").PivotFields("week_of_year")
Set pf1 =
Worksheets("LO").PivotTables("PivotTable3").PivotFields("year")
PvtTbl.ClearAllFilters
For Each PI In pf.PivotItems
If PI.Name = CStr(dd) Then
PI.Visible = True
Else
PI.Visible = False
End If
Next
For Each PI In pf1.PivotItems
If PI.Name = "2014" Or PI.Name = "2015" Then
PI.Visible = True
Else
PI.Visible = False
End If
Next
End Sub
New code that I develop is:

Sub datefilter1()
Dim PvtTbl As PivotTable
Set PvtTbl = Worksheets("LO").PivotTables("PivotTable3") Dim dd As
Integer
dd = Format(Date, "ww")
Dim pf As PivotField
Set pf =
Worksheets("LO").PivotTables("PivotTable3").PivotFields("week_of_year")
pf.PivotFilters.Add2 xlValueEquals, 3
End Sub
The code failed at
pf.PivotFilters.Add2 xlValueEquals, CStr(dd)
I also tried:
pf.PivotFilters.Add2 Type:= xlValueEquals, Value1 := CStr(dd)
The error is Invalid procedure call or argument.Any idea How I can fix this
error?????
Any faster way to filter on multiple filter criteria? Thanks! Answer
If you only want to filter on one value, drag the field of interest to the Report
Filter pane, then you can do this very quickly without looping using the
following code:
Sub FilterOnWeek()
Dim pt As PivotTable
Dim pf As PivotField
Set pt = Worksheets("LO").PivotTables("PivotTable3") Set pf =
pt.PivotFields("week_of_year")
pf.CurrentPage = Format(Date, "ww")
End Sub
If for some reason this field absolutely must stay in the PivotTable as a row

field, you can still filter without looping by the following method if you have
Excel 2010 or later
Make a copy of the PivotTable, and drag the 'week_of_year' field in the copy
to the Report Filter area
Set up a slicer on the week_of_year field on one PivotTable, and connect it to
the other PivotTable via the Report Connections dialog. (Right click on the
Slicer, select 'Report Connections') Amend the above code so it runs on the
2nd PivotTable.
The Slicer will then sync the two PivotTables.
If you want to filter on more than one value, drag the field to the ROWS area,
and use this:
Sub FilterOnWeek2()
Dim pt As PivotTable
Dim pf As PivotField
Dim pi As PivotItem
Dim lStart As Long
Dim lEnd As Long
lEnd = Format(Date, "ww")
lStart = Val(Format(Date, "ww")) - 1
Set pt = Worksheets("LO").PivotTables("PivotTable3") Set pf =
pt.PivotFields("week_of_year")
With pf
.ClearAllFilters
.PivotFilters.Add Type:=xlCaptionIsBetween, Value1:=lStart, Value2:=lEnd
End With
End Sub
If for some reason you don't want this field in the PivotTable as a row field,
follow the same general approach as above: make a copy of the PivotTable,

put the field that you want to filter on in the copy as a ROWS field, connect the
fields of interest together as a slicer, hide the slicer somewhere, and amend the
code so it runs on the copy of the PivotTable with the rowfield in it.
I recommend you read my article at
http://dailydoseofexcel.com/archives/2013/11/14/filtering-pivots-based-on-
external-ranges/ if you want to learn more about efficiently filtering
PivotTables.
Topic 289
Subject
HP Quality Center 12.20 Excel Uploader - Test Cases not Showing in Test Lab
Question
I have an excel sheet that I use to write test cases and use the HP ALM QC
uploader Add-In for excel to import them to into Quality Center. All required
fields are mapped (including some additional ones) and all data is validated
before uploading.
I am able to upload successfully and see the test cases and steps all in the Test
Plan. However, when I go to import them into a Test Set in Test Lab, the
uploaded test cases don't show up (All other test cases do).
Am I missing a critical mapping or do I need to be a Local Administrator to be
able to see the test cases when importing into Test Lab?
Mapping File
[Details]
task_name=mapping.tst
export_type=4
field_count=18
[FieldMapping]
mapping1=TS_USER_TEMPLATE_02;TEST;X
mapping2=TS_RESPONSIBLE;TEST;I
mapping3=TS_USER_TEMPLATE_06;TEST;AA
mapping4=TS_USER_TEMPLATE_03;TEST;AB
mapping5=TS_USER_TEMPLATE_04;TEST;Y

mapping6=TS_USER_TEMPLATE_05;TEST;Z
mapping7=TS_SUBJECT;TEST;AE
mapping8=TS_USER_TEMPLATE_07;TEST;AF
mapping9=TS_USER_TEMPLATE_08;TEST;AG
mapping10=TS_NAME;TEST;A
mapping11=TS_USER_TEMPLATE_10;TEST;AH
mapping12=TS_TYPE;TEST;J
mapping13=TS_DESCRIPTION;TEST;B
mapping14=DS_EXPECTED;STEP;F
mapping15=DS_DESCRIPTION;STEP;E
mapping16=DS_STEP_NAME;STEP;D
mapping17=TS_USER_TEMPLATE_09;TEST;AI
mapping18=TS_STATUS;TEST;AJ
.
Answer
The issue was the vales in the data sheet did not match 100% (CASE
SENSITIVE) the required values by Quality Center.
For example: Test Type: Manual needed to be Test Type: MANUAL
Topic 290
Subject
Xlwings - Referencing saved range and appending additional values
Question
I am a pretty inexperienced programmer and have been trying to practice some
basics in Xlwings, a Python library that works with Excel. I am working in 2.7.
I have made a small program with GUI that allows you to simply add entries
down a column in Excel. I noticed immediately upon trying my program that it
overwrites the previously saved values down the column. I am completely lost
in figuring out a workable solution on how to start with a list featuring the
range, and then continuing to append to it.
from Tkinter import *
from xlwings import Workbook, Range

root = Tk()
wb = Workbook()
e1 = Entry()
e1.grid(row=1, column=2)
participant_list = []
"""I realize starting with an empty list will clear the range every time I run the
script, but am not sure what the correct solution should be."""
def pressed_button():
entry = e1.get()
e1.delete(0, END) # clear the entry widget temp = []
temp.append(entry)
participant_list.append(temp)
Range('A1').value = participant_list print participant_list # just to test
b1 = Button(text="Add Participant", command=pressed_button)
b1.grid(row=2, column=2)
mainloop()
Any help in walking me through a solution would be greatly appreciated! I've
tried a few different things, but am too embarrassed to put them in my demo
code ha. Answer
Depending on what you want to do, you could either read in your data first and
assign it to participant_list or you could find out the last used cell in that
column: E.g. if there are no empty rows, something like
rng = Range('A1').vertical.last_cell
Range((rng.row + 1, rng.column)).value = participant_list
could work.
Topic 291

Subject
Working with an OLAP Cube in Excel; determine monthly values within a
larger date range?
Question
I've been working in an OLAP cube as a pivottable in excel for a while now,
but more recently I'm trying to integrate some calculated measures to
streamline some things, and I've hit a wall.
The cube has date filters set up that specify the month & year (they get more
specific, but finer levels aren't used).
The rows will list individual projects, and the values can reflect 2 measures:
one that reflects the average score for the date range, and another that reflects
the number of observations the average is based on.
I would like to create a calculated measure that will display the average score
for each project as long as 2 criteria are met:
There is a minimum of 100 observations for the whole date range there are no
months with zero observations across the date range specified in the
pivottable.
I should also clarify that the date ranges I use will vary and length, and will not
always end with the most recent month, but they will always be in increments
of whole months.
I'm part of the way there, as a calculated measure based on this will provide
me with the average only if there are enough observations for the date range:
IIF([Measures].[OBSERVATIONS]>=100,[Measures].[AVERAGE],"^^")
Now, I need to add the criteria of no months with zero observations.
I have attempted to use COUNT(), but in this form it ignores the date range set
in the pivottable and returns a count of all of the months there is any value for
the project, including zeros.
COUNT(([Calendar].[Calendar].[Month],[Measures].

[OBSERVATIONS]),EXCLUDEEMPTY)
I tried determining the lowest number of observations in a month using this
expression, but again it ignores the date range, and does not reflect empty
cells:
MIN([Calendar].[Calendar].[Month],[Measures].[OBSERVATIONS])
I think CurrentMember is what I need to include, but I can't get it to work for
me.
Assuming it's relevant, and I'm not sure the best way to explain the calendar
hierarchy, so this reflects what I have:
The first calendar listing is the one used to filter the pivot table data, and it is
also pulled into the mdx expressions above.
EDIT
Thanks @SouravA for the reply. I tried a few things, and given that formatting
in comments is limited, here's a rundown of what I did.
I'm getting an error message that says "Query(1,35) Parser: The syntax for
'WITH' is incorrect"
to make sure I'm using this correctly:
After making the changes below, I pasted the whole thing into the MDX:
window from the 'calculated measures' tool in Excel.
I of course changed OBSERVATIONS and AVERAGE to the variable names in
my cube.
I changed '[Project].[ProjectCode]' to '[Project].[ProjectName]', which is how
my cube is set up.
On '[NewMeasure]' I changed it to the name I am using for the calculated
measure.

on '[your cube]' I've tried a couple different things; the cube reference I use in
the cube formulas in excel looks like this: 'Cubename NormativeCube', so I
tried pasting that in the brackets with and without quotes, leaving the
NormativeCube part off, and doing all that without the brackets.
I also modified the last line after 'WHERE' to reflect date ranges like this:
'[Calendar].[Calendar].[Month].&1&[2015]:[Calendar].[Calendar].[Month].&
[12]&[2015]'
I've also set that as '[Calendar].[Month].[Month].&1:[Calendar].[Month].
[Month].&[12]'
Also, one more question; will this work for any date range, or is it intended to
be specified in the MDX? I need it to function based on the date range set by
the cube filters.
EDIT 2:
I just needed to tweak this a tad by changing the '> 0' to '= 0', as the original
solution only showed the average for those that did not have data for each
month in the date range, and adjust one of the calendar set expressions or
whatever.
IIF
(
[Measures].[OBSERVATIONS]>=100
AND
COUNT
( 
   FILTER 
      ( 
      EXISTS 
          ( 
          [Calendar].[Calendar].[Month].MEMBERS 
          ,EXISTING [Calendar].[Calendar].[Month].MEMBERS 
          ) 
      ,[Measures].[OBSERVATIONS] = 0 
      ) 

) = 0
,[Measures].[AVERAGE]
,"^^"
)
EDIT 3:
Found a limitation;
the measure only works if the date range defined for the cube is in a whole
increment of the calendar hierarchy; i.e. a single month, a single quarter, or a
single year. doing 2 months, 2 quarters, 2 years, or breaking across 2 quarters
or years will return the False outcome from the IIF() expression.
I played around with a few different ways to set it up, but can't get it to work.
EDIT 4:
Re: calendar hierarchy
Looking underneath [calendar].[calendar] there are 4 options: Year, Quarter,
Month, & Date Key.
looking at the members under Year, Quarter, & Month, you can drill down all
the way to the individual day.
The member properties under those 3 lists just the next level up the hierarchy
On Date Key, the member properties are as follows: Month Name
Month of Year
Time Calcs (this doesn't do much to my knowledge) Week of Year Week
EDIT 5:
So this is what worked (finally). I must have messed something up at some
point, and editing the original formula caused the secondary issue I was
having. Here's what worked for me.
IIF

(
[Measures].[OBSERVATIONS]>=100
AND
COUNT
( 
   FILTER 
      ( 
      EXISTS 
          ( 
          [Calendar].[Calendar].[Month].Members 
          ,EXISTING [Calendar].[Calendar].Members 
          ) 
      ,[Measures].[OBSERVATIONS] = 0 
      ) 
) > 0
,[Measures].[AVERAGE]
,"^^"
)
Answer
Using the EXISTING clause comes in handy at times when you want your
calculation to recognize a certain selection(context). Following code is self
explanatory. Let me know if it works.
WITH SET ZeroObservationMonths AS
FILTER
(
EXISTS 
      ( 
      [Calendar].[Calendar].[Month].MEMBERS 
      ,EXISTING [Calendar].[Calendar].[Date].MEMBERS 
      ) 
   ,[Measures].[OBSERVATIONS] = 0 
   ) 
MEMBER Measures.NewMeasure AS

IIF
(
[Measures].[OBSERVATIONS]>=100 AND
COUNT(ZeroObservationMonths) > 0 ,[Measures].[AVERAGE]
,"^^"
)
SELECT [Project].[ProjectCode].MEMBERS ON 1, Measures.[NewMeasure]
ON 0
FROM [YourCube]
WHERE ({[Calendar].[Calendar].[Date].&D1: [Calendar].[Calendar].
[Date].&D2})
EDIT
If you're planning on creating the measure inside excel, just have the
below MDX code in the text box for "New calculated measure"
IIF
(
[Measures].[OBSERVATIONS]>=100
AND
COUNT
( 
   FILTER 
      ( 
      EXISTS 
          ( 
          [Calendar].[Calendar].[Month].MEMBERS 
          ,EXISTING [Calendar].[Calendar].[Date].MEMBERS 
          ) 
      ,[Measures].[OBSERVATIONS] = 0 
      ) 
) > 0
,[Measures].[AVERAGE]
,"^^"
)

EDIT 2: If the filtering can happen on any attribute, not just dates, replace
EXISTING [Calendar].[Calendar].[Date].MEMBERS with EXISTING
[Calendar].[Calendar].MEMBERS in the script above.
Topic 292
Subject
CSV file help/ format
Question
New to weka and having this problem. I want to convert my excel data to
weka. So I have done some looking into how to convert to arff. file etc
Excelvan, medichoice & unbranded are 3 pulse oximeters, with PR and SpO2
the readings.
I want to get these into weka and possibly detect the type of brand used etc..
Just enquiring what layout should it be in, on the excel file.
see attached image.
Answer
save as .csv and then add header as:
@relation <some_name>
@attribute person numeric
@attribute spo1 numeric
@attribute pr1 numeric
@attribute spo2 numeric
@attribute pr2 numeric
@attribute spo3 numeric
@attribute pr3 numeric
@data
<your comma separated data will be here>
Answer
From what I understand here, you're dealing with a classification task. To do

that, you need two things for each measure (i.e instance) : what features
describes your instance (the atributes), and to which class it belongs.
You should format your file according to this :
attribute 1 | attribute 2 | ... | class attribute 1 | attribute 2 | ... | class
In your problem, your attributes are SpO2 and PR, and your class, the brand of
the oximeter.
Hence the following kind of table :
SpO2 | PR | Class
xx | yy | Excelvan
aa | bb | Unbranded
....
Finally, you can save it in csv file format, and open it directly from Weka's
experimenter (don't forget to check that the specified format when you open the
file is csv, or you will not be able to open it).
Topic 293
Subject
Image from Excel to vb.net Picturebox
Question
I have found many questions for the opposite vb.net to excel but none for
getting a picture from an excel cell(row,column) into a picture box. My app is
a template that gets strings of text from an excel file. Which works fine but now
I am trying to also transfer pictures. I have tried picSpindle.Image =
shXL.Cells(19, 2).Value but doesn't do anything. Does not error out though!
Will copy and paste work?
Code
Imports System
Imports System.IO
Imports System.Text

Imports Excel = Microsoft.Office.Interop.Excel Public Class Form1
Dim appXL As Excel.Application
Dim wbXl As Excel.Workbook
Dim shXL As Excel.Worksheet
Dim raXL As Excel.Range
Dim PartID As String
Dim RefCard As String
Private Sub Form1_Activated(sender As System.Object, e As
System.EventArgs) Handles MyBase.Activated 
      'Dispaly Brembo Logo 
      picLogo.SizeMode = PictureBoxSizeMode.StretchImage 
End Sub
Private Sub Button1_Click(sender As Object, e As EventArgs) Handles
Button1.Click 
      'Read File Source with part number
******************Example From TXT 
      PartID = ("19.N111.10") 
      ' Start Excel and get Application object. 
      appXL = CreateObject("Excel.Application") 
      appXL.Visible = False 
      'Open Reference
Card***********************************************************
      wbXl =
appXL.Workbooks.Open("C:\Users\aholiday\Desktop\Visual Studios
Projects\Reference Card App\" & PartID & ".xlsx") 
      shXL = wbXl.Worksheets("Sheet1") 
      ' Copys Reference Card Text from Cells To App labels 
      lblCODE.Text = shXL.Cells(3, 9).Value 
      Debug.Print(lblCODE.Text) 
      lblREV.Text = shXL.Cells(3, 13).Value 
      lblDate.Text = shXL.Cells(5, 9).Value 
      lblCustomer.Text = shXL.Cells(8, 2).Value 
      lblPart.Text = shXL.Cells(11, 2).Value 

      lblSpindleType.Text = shXL.Cells(15, 2).Value 
      lblPaintType.Text = shXL.Cells(7, 6).Value 
      lblDunnageType.Text = shXL.Cells(8, 8).Value 
      lblPartsLayer.Text = shXL.Cells(11, 11).Value 
      lblLayers.Text = shXL.Cells(15, 11).Value 
      lblTotalParts.Text = shXL.Cells(20, 11).Value 
      lblPackagingInstructs.Text = shXL.Cells(20, 11).Value 
   'Works up to here! 
      ' Copys Reference Card Pictures from Cells To App
Pictureboxs 
      picSpindle.Image = shXL.Cells(19, 2).Value 
      picRotorTop.Image = shXL.Cells(10, 6).Value 
      picRotorBottom.Image = shXL.Cells(19, 6).Value 
      picDunnageFinal.Image = shXL.Cells(10, 8).Value 
      picDunnageLayer.Image = shXL.Cells(19, 8).Value 
      ' Close objects 
      raXL = Nothing 
      shXL = Nothing 
      wbXl = Nothing 
      appXL.Quit() 
      appXL = Nothing 
End Sub
End Class
Answer
shXL.Cells(19, 2).Value
and so on won't work because pictures aren't store in cells but over them
meaning values of these cells will be nothing
try these links
1
2
3

Answer
The images are not inside a cell. But the coordinates of the top left corner point
to a cell, with this code above you can make your own function that searches
through images.
You can do so:
shXL = wbXl.Worksheets("Sheet1")
' # Loop for all Shapes
' But I don't know what other controls over ' the images are considered
"shapes", ' Perhaps the best way is to verify that ' in the "clipboard" there is
truly a picture For i = 0 To shXL.Shapes.Count - 1
'THIS IS THE MAIN POINT 
      ' # get the pictures and copy to clipboard 
      'shXL.Shapes.Item(i).Copy() 
      ' # paste the picture in the pictureBox from clipboard 
      'PictureBox1.Image = Clipboard.GetImage 
      'AND OTHER PROPERTIS 
      MsgBox(shXL.Shapes.Item(i).Name) ' the name in excel 
      MsgBox(shXL.Shapes.Item(i).AlternativeText) 'the name
of the file 
      MsgBox(shXL.Shapes.Item(i).TopLeftCell.Column) 'the
column position (of the top left corner) 
      MsgBox(shXL.Shapes.Item(i).TopLeftCell.Row) 'the row
position (of the top left corner) 
      MsgBox(shXL.Shapes.Item(i).Width) 'the with in px 
      MsgBox(shXL.Shapes.Item(i).Height) 'the height in px 
      MsgBox(shXL.Shapes.Item(i).Top) 'the top in px 
      MsgBox(shXL.Shapes.Item(i).Left) 'the left in px 
Next
Topic 294
Subject
Can't set a Dynamic Range without Error

Question
I'm trying to select a range in a macro, but I keep getting
"Compile error:"
"Expected: list separator or )"
I'm just trying to set a dynamic range using a variable I created before
With Sheets("Recon")
rownum3 = rownum2 + 2
rownum4 = ActiveSheet.UsedRange.SpecialCells(xlCellTypeLastCell).Row
set r3 = .range("K"&rownum3&":K"&rownum4)
This gives me the error
Thanks in advance
Answer
As silly as it sounds, you need to add white space in your range (and also add
an end with)
With Sheets("Recon")
rownum3 = rownum2 + 2
rownum4 = .UsedRange.SpecialCells(xlCellTypeLastCell).Row set r3 =
.range("K" & rownum3 & ":K" & rownum4) end with
For some reason, when using variables, even when you separate them with the
&, VBA doesn't like variables next to quotes. Just add a space in between your
& connectors and it should work okay.
One way to work around this non-auto-formatting issue is to use
Range(cells(),cells()):
Set r3 =.Range(.Cells(rownum3,11),.cells(rownum4,11))
Cells() is Cells([row #],[col. #]), so wrapping that in a Range() is another way
to do it (any my personal preferred way).

Topic 295
Subject
Set up Excel data connection to SharePoint to use smart card authentication?
Question
I have a SharePoint site where the Admin has configured the web application
in IIS to use smart card authentication.
This works fine when accessing the site in a browser, but it has broken the
"export list as Excel" functionality.
If I go to a list I want to export, I can download the owssvr.iqy file, but if I try
to open it in Excel I get an error that Excel "cannot connect to the server at this
time". My hunch is that it's because the web app is expecting smart card
authentication.
Is there any way to edit the .iqy file to get Excel to use the correct
authentication method?
My .iqy file looks like this:
WEB
1
vtibin/owssvr.dll?
XMLDATA=1&List=">https://my.sharepoint.site/vtibin/owssvr.dll?
XMLDATA=1&List={120ABACD-86D8-43D7-AC3E-
27B681B51200}&View={91EFD595-5E29-4EF3-953D-
83468A77C399}&RowLimit=0&RootFolder=%2fLists%2fMyList
Selection={120ABACD-86D8-43D7-AC3E-27B681B51200}-{91EFD595-
5E29-4EF3-953D-83468A77C399} EditWebPage=
Formatting=None
PreFormattedTextToColumns=True
ConsecutiveDelimitersAsOne=True
SingleBlockTextImport=False
DisableDateRecognition=False
DisableRedirections=False
SharePointApplication=vtibin">https://my.sharepoint.site/vtibin

SharePointListView={91EFD595-5E29-4EF3-953D-83468A77C399}
SharePointListName={120ABACD-86D8-43D7-AC3E-27B681B51200}
RootFolder=/Lists/MyList
Topic 296
Subject
Creating a list of Companies using an API call from Hubspot
Question
I am very new to this and would like to know if i can use the API function of
Hubspot to create a list in excel of all companies in our account with the name,
domain and HubID properties? Can anyone help with this?
Answer
Yes it's Possible
What programming you will use to talk with API ?
Topic 297
Subject
Remove duplicate values within dynamic ranges identified by text strings
Question
Text “endofdata” in col B identifies the boundaries of multiple ranges on a
single sheet. I’m trying to step through each range and remove duplicate values
in columns E and F within each range. I also call a routine that deletes blank
rows that are generated when duplicates are removed. The bottom row with
“endofdata” is always removed when .removeduplicates is executed.
I’ve tried the Do loop but it’s failing. (It works for the first range but fails for
the next range) Please suggest how to make this work. What kind of loop
should I use? How should I search for “endofdata” string? Thank you very
much in advance.
Sub RemoveDupsinRange()
Dim LastRow As Long, i As Long, startRow, EndRow
Call setSheets

LastRow = wsQC.Cells(wsQC.Rows.Count, "A").End(xlUp).Row
Debug.Print LastRow
For i = LastRow To 1 Step -1
Do
If wsQC.Cells(i, 2).Value = "endofdata" Then
startRow = i
End If
i = i - 1
Loop Until wsQC.Cells(i, 2).Value = "endofdata" EndRow = i
i = i - 1
Range(startRow & ":" & EndRow).Select Selection.removeduplicates
Columns:=Array(5, 6), _
Header:=xlNo
Call DeleteBlanks
Next i
End Sub
Answer
I just tested this loop and it worked.
Sub RemoveDupsinRange()
Dim LastRow As Long, i As Long, rStart As Range, rEnd As Range
Call setSheets
LastRow = wsQC.Cells(wsQC.Rows.Count, "A").End(xlUp).Row

Debug.Print LastRow
Set rEnd = wsQC.Cells(LastRow, 2)
For i = LastRow To 2 Step -1
Do
i = i - 1 
      If wsQC.Cells(i, 2).Value = "endofdata" Then 
          Set rStart = wsQC.Cells(i, 2) 
      End If 
Loop Until wsQC.Cells(i, 2).Value = "endofdata"
wsQC.Range(rStart.Offset(, -1), rEnd.Offset(, 4)).RemoveDuplicates
Columns:=Array(5, 6), Header:=xlNo
Set rEnd = rStart
Call DeleteBlanks
Next i
End Sub
Topic 298
Subject
Excel Task Pane add-in to show content from external source
Question
I am trying to build an Excel/Word task pane add-in that should show content
from our site. The content/data is passed in XML format.
What I have tried to do is the following:
Office.initialize = function (reason) {

$(document).ready(function () {
app.initialize();
$.support.cors = true;
var data = ''; 
      $.ajax({ 
          type: "GET", 
          contentType: "application/json; charset=utf-8", 
          url: 'http://addons.mysite.com/excel-taskpane-
data.php', 
          data: data, 
          dataType: "json", 
          success: onQuerySuccess, 
          error: onQueryError 
      }); 
      function onQuerySuccess(res, statusText) { 
          console.log('success!!' + res.statusText); 
      } 
      function onQueryError(res, statusText){ 
          console.log('failed!!' + res.statusText); 
      } 
});
};
As you can understand from the code above I was just checking if connection
could be made to the external source, but I am getting "Access Denied" in the
console.
I am not really sure how should I request data from an external source and
whether it is possible at all?
Please help
Answer
You mentioned 'external' so I bet http://addons.mysite.com/ is not the domain

that serves your web add-in. To make it work you have to check several things.
Serving with Https. As written by Michael make sure you use https. Mixed
content (mixing of http and https) is blocked by most server and Office web
add-ins can only be served with https. Make sur your PHP web api supports
CORS. I am no PHP expert so here is a small link Try to specify
https://addons.mysite.com as AppDomain The sandboxed iFrame allow only
request and navigation on the same domain (the one that you use to serve you
web-addin). But you can specify some exceptions see here. It works with
navigation and I am not sure it works with XHR... If step 3 did not work try to
use JSON/P techniques as described here JSON/P with Office add-ins
Answer
Yes, you can make Ajax HTTP requests from Office web add-ins such as your
Excel/Word task pane. They work exactly the same as they would on a normal
web page, except we have an additional requirement of using "https" rather
than "http" to access the endpoint.
I can't identify the cause of your specific issue without information about the
actual endpoint you're calling. Start by just trying your code on a normal web
page and access it normally with a web browser. Once you have that working,
then point an add-in to the page. That should fix your issue, but if you still have
a problem where the exact same code is working in a normal browser and
failing in an add-in, let us know.
Topic 299
Subject
compare 3 ranges instead of 2
Question
Public Function Compare(r1 As Range, r2 As Range) As Long
Dim r As Range, v As Variant, v2 As Variant Dim rr As Range
For Each r In r1 
    v = r.Value 
    If v <> 0 And v <> "" Then 
       For Each rr In r2 

          v2 = rr.Value 
          If v = v2 Then Compare = Compare + 1 
       Next rr 
    End If 
Next r
End Function
This UDF compares 2 ranges and return the number of matched values. I would
like to compare 3 ranges instead, in order to find how many values appeared in
all 3 ranges simultaneously.
Much appreciate any help.
Answer
Public Function Compare(r1 As Range, r2 As Range, r3 As Range) As Long
Dim r As Range, v As Variant, m1 As Variant, m2 As Variant Dim rv As Long
rv = 0
For Each r In r1 
    v = r.Value 
    If v <> 0 And v <> "" And Not IsError(v) Then 
          m1 = Application.Match(v, r2, 0) 
          m2 = Application.Match(v, r3, 0) 
          If Not IsError(m1) And Not IsError(m2) Then 
             rv = rv + 1 
          End If 
    End If 
Next r
Compare = rv
End Function
Answer
This functions works fine for me, tell me if you need some improvement.
Public Function Compare(r1 As Range, r2 As Range, r3 As Range) As Long

Dim i
Dim v1
Dim v2
Dim v3
Dim counter
counter = 0
For Each i In r1 
      counter = counter + 1 
      v1 = r1(counter).Value 
      v2 = r2(counter).Value 
      v3 = r3(counter).Value 
      If v1 = v2 And v2 = v3 Then 
          'r3(counter).Offset(0, 2).Value = "OK" 'this is for
the test 
          Compare = Compare + 1 
          'I think could be easy to test and return a
value... 
          'Compare = v1 'Because is the same value in the 3
cells 
      Else 
          'r3(counter).Offset(0, 2).Value = "NO"'this is for
the test 
          'Do another code... 
      End If 
Next i
End Function
Edit #1
This could help...
Public Function Compare2(r1 As Range, r2 As Range, r3 As Range) As Long
Dim i
Dim v1
Dim v2

Dim v3
Dim counter
Dim n1 As Range
Dim n2 As Range
Dim n3 As Range
Dim max
counter = 0
max = Application.WorksheetFunction.max(r1.Count, r2.Count, r3.Count) 'With
"max" take the max number of rows in the range to use it
Set n1 = Range(Cells(r1(1).Row, r1(1).Column), Cells(r1(1).Row + max - 1,
r1(1).Column)) Set n2 = Range(Cells(r2(1).Row, r2(1).Column),
Cells(r2(1).Row + max - 1, r2(1).Column)) Set n3 = Range(Cells(r3(1).Row,
r3(1).Column), Cells(r3(1).Row + max - 1, r3(1).Column)) 'Here we set new
ranges, equals all of them, to use them in the for loop and compare 'we use the
ref of the input ranges.
counter = 0
For Each i In n1 
      counter = counter + 1 'this is the index for the new
ranges 
      v1 = n1(counter).Value 'store every value of the new
ranges 
      v2 = n2(counter).Value 
      v3 = n3(counter).Value 
      If v1 = v2 And v2 = v3 Then 'do the comparison, and if
the 3 values are equal 
          'n3(counter).Offset(0, 2).Value = "OK" 'this is
just for the test 
          Compare2 = Compare2 + 1 'add 1 to compare 
      Else 
          'n3(counter).Offset(0, 2).Value = "NO" 
          'this part of the code don't do anything 
          'but if you want to put some code is up to you. 
          'You can delete from Else to this comment 
      End If 
Next i

End Function
Added more comments to the function.
Answer
Here's an alternative for a non-vba solution.
Consider a data layout like so:
In cell E2 is this formula:
=SUMPRODUCT(--(COUNTIF(B2:B16,A2:A23)>0),--
(COUNTIF(C2:C19,A2:A23)>0))
I have highlighted all of the cells that have matches in all three columns for
clarity. There are a total of 8 cells in column A that have duplicates found in
columns B and C. Note that this will count duplicates in column A (but so does
your UDF already).
Topic 300
Subject
Excel - Query for CSV missing columns
Question
So I'm using Office 2016's new Query feature to get data from various CSV
API endpoints. I managed to get it to work with Yahoo Finance's but I can't
seem to get Morningstar's to work. When I visit this link in my browser, I
download a full CSV with all the proper data:
Link: http://financials.morningstar.com/ajax/ReportProcess4CSV.html?
t=MSFT&reportType=is&period=12&dataType=A&order=asc&columnYear=1
However, when I use the query feature, it only loads the first row. I'm guessing
it's because only the first column in the first row in the CSV has data, causing it
to ignore the rest of the columns. Does anyone know how to ignore that first
row and begin importing the CSV from the second?
let

Source =
Csv.Document(Web.Contents("http://financials.morningstar.com/ajax/ReportPro
t=MSFT&reportType=is&period=12&dataType=A&order=asc&columnYear=1
[Delimiter=",",Encoding=1252]) in
Source
Thanks in advance!
Edit: In Csv.Document, it looks like there's an extraValues parameter; maybe
that might help? Answer
The extra values parameter can retrieve your extra rows (using
ExtraValues.List), but the shape of the table will be difficult to work with.
Here's one way to get the values:
let
Source =
Table.FromColumns({Lines.FromBinary((Web.Contents("http://financials.morn
t=MSFT&reportType=is&period=12&dataType=A&order=asc&columnYear=1
#"Removed Top Rows" = Table.Skip(Source,1), #"Split Column by Delimiter"
= Table.SplitColumn(#"Removed Top
Rows","Column1",Splitter.SplitTextByDelimiter(",", QuoteStyle.Csv),
{"Column1.1", "Column1.2", "Column1.3", "Column1.4", "Column1.5",
"Column1.6", "Column1.7"}), #"Changed Type" =
Table.TransformColumnTypes(#"Split Column by Delimiter",{{"Column1.1",
type text}, {"Column1.2", type text}, {"Column1.3", type text}, {"Column1.4",
type text}, {"Column1.5", type text}, {"Column1.6", type text}, {"Column1.7",
type text}}), #"Promoted Headers" = Table.PromoteHeaders(#"Changed
Type") in
#"Promoted Headers"
This query treats the CSV file as a text document of lines. It removes the first
line, which is some header statement that causes the parser to think that the
CSV file has only one column. It then splits the lines into columns based on

comma placement and then makes the first row the column names.
Answer
see https://msdn.microsoft.com/en-us/library/mt260840.aspx?
f=255&MSPPError=-2147217396:
let
Source =
Csv.Document(File.Contents("C:\Projects\Examples\SalesForceContacts.txt"),
[Delimiter=",",Encoding=1252]),
#"First Row as Header" = Table.PromoteHeaders(Source), ...
But if the header row is corrupt, this may not work.
Topic 301
Subject
Exporting Data from Excel to phpmyadmin SQL database
Question
I would appreciate some help solving problems accessing a MySQL database
from Excel.
I've created the database in phpmyadmin. I've also been able to manually
import data via a CSV file into the SQL database on phhpmyadmin.
So, I'm sure that I've got the right IP address, user ID and password for the
database.
I've also read various posts about how to configure ODBC connections from
Windows to SQL and I think I've followed the right instructions.
However, I can't seem to get the code to work from VBA. I keep getting
various errors.
Here's the code I've been using, minus the actual database names and User IDs.

Private Sub cmdInsertData_Click()
Dim oConn As ADODB.Connection
Dim rs As ADODB.Recordset
Dim Pwd As String
Dim SQLStr As String
Dim Svr_Nm As String
Dim UID As String
Dim Dbs_Nm As String
' Input Parameters
Pwd = "mypassword"
UID = "myuser"
srvr_nm = "xxx.xxx.xx.xx:yyyy"
Dbs_Nm = "myname"
Set rs = New ADODB.Recordset
Set oConn = New ADODB.Connection
SQLStr = "DRIVER={MySQL ODBC 5.3 ANSI Driver};" SQLStr = SQLStr
& "SERVER=" & srvr_nm & ";DATABASE=" & Dbs_Nm & ";USER=" &
UID & ";PASSWORD=" & Pwd & ";Option=3" oConn.Open SQLStr
MsgBox "Connected to " & Dbs_Nm & " via " & srvr_nm End Sub
I've reset the code as follows. The error message is generated by the line
"oConn.Open SQLStr". The error generated is
Run-time error ‘-2147467259 (80004005)’: [MySQL][ODBC 5.3(a)
Driver]Unknown MySQL server host ‘209.159.152.202:2083’ (0)
New Code:
Private Sub CheckConnection()
Dim oConn As ADODB.Connection
Dim rs As ADODB.Recordset
Dim Pwd As String
Dim SQLStr As String
Dim Svr_Nm As String
Dim Usr_ID As String
Dim Dbs_Nm As String

' Input Parameters
Pwd = "mypassword"
Usr_ID = "myID"
srvr_nm = "209.159.152.202:2083"
Dbs_Nm = "mydatabase"
Set rs = New ADODB.Recordset
Set oConn = New ADODB.Connection
SQLStr = "DRIVER={MySQL ODBC 5.3 ANSI Driver};" SQLStr = SQLStr
& "SERVER=" & srvr_nm & ";DATABASE=" & Dbs_Nm & ";USER=" &
Usr_ID & ";PASSWORD=" & Pwd & ";Option=3" oConn.Open SQLStr
MsgBox "Connected to " & Dbs_Nm & " via " & srvr_nm End Sub
Thanks for the suggestion about adding the Port= as a separate variable. I've
tried that however (see new code) and it still doesn't work.
Private Sub CheckConnection()
Dim oConn As ADODB.Connection
Dim rs As ADODB.Recordset
Dim Pwd As String
Dim SQLStr As String
Dim Svr_Nm As String
Dim Usr_ID As String
Dim Dbs_Nm As String
Dim Port_Nm As String
' Input Parameters
Pwd = "mypassword"
Usr_ID = "myID"
Svr_Nm = "209.159.152.202"
Dbs_Nm = "mydatabase"
Port_Nm = "2083"
Set rs = New ADODB.Recordset
Set oConn = New ADODB.Connection
SQLStr = "DRIVER={MySQL ODBC 5.3 ANSI Driver};" SQLStr = SQLStr
& "Server=" & Svr_Nm & ";Port=" & Port_Nm & ";Database=" & Dbs_Nm &
";User=" & Usr_ID & ";Password=" & Pwd & ";Option=3" oConn.Open
SQLStr

MsgBox "Connected to: " & Dbs_Nm & " via " & Svr_Nm End Sub
I still get the same error message at the same place.
Topic 302
Subject
read excel into own created object -> assign id -> convert into JSON
Question
I have the following problem; I have to read an excel file in python with the
following values and structure:
DE0000000001 0.649333 Income
DE0000000002 0.318018 Income
DE0000000003 1.278578 Regular
How should I ideally go through these dividends in an excel file and store them
in an object and then convert them in JSON object. Each line represents 1
dividend.
I have created a object cashdividends, which has three set methods:
cashdividend.ISIN, cashdividend.Rate, cashdividend.type
Where I am struggling is how to convert cashdividend into an JSON object and
have a unique id for each line.
So essentially I want to have an object cash dividend which store the values in
the following format.
Cashdividend =
[0 ,DE0000000001 ,0.649333 ,Income]
[1 ,DE0000000002 ,0.318018 ,Income]
[2 ,DE0000000003 ,1.278578 ,Regular]
Thank you for the help.
Topic 303
Subject

Code not working - Fusiontables, HTML table and .xls (javascript)
Question
I have a fusiontables table and my goal is to show the table and print it to a .xls
file. Now i have 2 major pices of code, but can´t link them properly: one pice
shows the table, and the other grabs the table HTML code and makes a .xls
file. The thing is that i don´t know how to link the two pices of code.
Any guess?
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script> </head>
<script>
function dataHandler(resp) {
console.log(resp);
var result = document.getElementById('table'); var htmlTable =
document.createElement('table'); htmlTable.border = 1;
var tableRow = document.createElement('tr'); for (var i = 0; i <
resp.columns.length; i++) { 
      var tableHeader = document.createElement('th'); 
      var header = document.createTextNode(resp.columns[i]); 
      tableHeader.appendChild(header); 
      tableRow.appendChild(tableHeader); 
}
htmlTable.appendChild(tableRow);
for (var i = 0; i < resp.rows.length; i++) { 
      var tableRow = document.createElement('tr'); 
      for (var j = 0; j < resp.rows[i].length; j++) { 
          var tableData = document.createElement('td'); 
          var content = document.createTextNode(resp.rows[i]
[j]); 
          tableData.appendChild(content); 
          tableRow.appendChild(tableData); 
      } 

      htmlTable.appendChild(tableRow); 
}
result.appendChild(htmlTable);
}
function getData() {
// Builds a Fusion Tables SQL query and hands the result to dataHandler var
queryUrlHead = 'https://www.googleapis.com/fusiontables/v1/query?sql=';
var query = "SELECT 'HORA' FROM ";
var tableId = '1wCk_xZvsU-NZDk4LayBcH6ofceFSe7YmbTLffGfv'; var
queryUrlTail = '&key=AIzaSyB2Kl6zww1ZS4Ui89i9IOXIsGve_ecBVI0';
var queryurl = encodeURI(queryUrlHead + query + tableId + queryUrlTail);
var jqxhr = $.get(queryurl, dataHandler); }
getData();
</script>
<script>
function fnExcelReport()
{
var tab_text="<table border='2px'>"; var textRange; var j=0;
tab = document.getElementById('getData()'); // id of table
for(j = 0 ; j < tab.rows.length ; j++) { 
      tab_text=tab_text+tab.rows[j].innerHTML+"</tr>"; 
      //tab_text=tab_text+"</tr>"; 
}
tab_text=tab_text+"</table>";

tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in
your table tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want
images in your table tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, "");
// reomves input params
var ua = window.navigator.userAgent; var msie = ua.indexOf("MSIE ");
if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) // If Internet
Explorer { 
      txtArea1.document.open("txt/html","replace"); 
      txtArea1.document.write(tab_text); 
      txtArea1.document.close(); 
      txtArea1.focus(); 
      sa=txtArea1.document.execCommand("SaveAs",true,"Say
Thanks to Sumit.xls"); 
  } 
  else                 //other browser not tested on IE 11 
      sa = window.open('data:application/vnd.ms-excel,' +
encodeURIComponent(tab_text)); 
return (sa);
}
</script>
<body>
<button id="btnExport" onclick="fnExcelReport();"> Exportar Dados
</button> <br>
<div id="table"></div>
</body>
Topic 304
Subject
Run-time error '1004': Copy method of Range class failed Excel 2013 when
adding a new pivot table
Question
I am getting the error specified in the title of this issue when trying to copy and
paste some columns (and it's data) to a new workbook. The code below used

to work till the moment when I add a new sheet with a new pivot table in my
workbook, and I don't know the reason:
Sub ExtractData_2()
Workbooks.Add
ActiveWorkbook.SaveAs ThisWorkbook.Path & "\extract_Fcst" & ".csv", 6
ThisWorkbook.Worksheets("Forecast Enrichment").Activate
ThisWorkbook.Sheets("Forecast Enrichment").Range("E:S").Copy
Destination:=Workbooks("extract_Fcst.csv").Sheets(1).Range("A:O")
Workbooks("extract_Fcst.csv").Sheets(1).Range("A:O").EntireColumn.AutoFit
End Sub
Does anybody have any idea to how to solve that problem? I have tried a lot of
different solutions found in google but any of it works! Answer
Use object variables and assign properly, then break up your copy/Destination
to see whether the error raises on the Copy or the Paste, as follows:
Sub ExtractData_2()
Dim csvWorkbook as Workbook
Set csvWorkbook = Workbooks.Add
csvWorkbook.SaveAs ThisWorkbook.Path & "\extract_Fcst" & ".csv", 6
' Unnecessary to "Activate" the sheet...", so you can delete this: '
ThisWorkbook.Worksheets("Forecast Enrichment").Activate
'Try using copy/paste as separate statements to see where the failure may occur
ThisWorkbook.Sheets("Forecast Enrichment").Range("E:S").Copy
csvWorkbook.Sheets(1).Range("A1").Select csvWorkbook.Sheets(1).Paste
csvWorkbook.Sheets(1).Range("A:O").EntireColumn.AutoFit
End Sub

If it still raises the error, let me know which line it happens.
Topic 305
Subject
Copy from VB.NET DataGridView into Excel
Question
I'm trying to copy from a DataGridView control and paste into Excel. The copy
works, but the cell widths remain narrow and my data isn't formatted properly.
Even highlighting the column and attempting to auto-size doesn't work. Is there
something I can do in my grid control to make this work better?
VS2013
VB.NET
Framework 4.5.2
Edit
It's a DataGridView with all the defaults. It's loaded from a DataSet with
this statement:
grid.DataSource = _gridData.Tables(0)
(where grid is the DataGridView and _gridData is the DataSet)
Topic 306
Subject
Excel automatically add comment with cell edit history
Question
I have the following code in the "sheet macros" (right click sheet - view code).
It used to work but now it's not adding comments in my specified range
A5:AQ155.
Private Sub Worksheet_Change(ByVal Target As Range)
Application.EnableEvents = False
'If (Target.Row > 3 And Target.Row < 155) Then Cells(Target.Row, "AT") =
Now()

Const sRng As String = "A5:AQ155" ' change as required Dim sOld As String
Dim sNew As String
Dim sCmt As String
Dim iLen As Long
Dim bHasComment As Boolean
With Target(1)
If Intersect(.Cells, Range(sRng)) Is Nothing Then Exit Sub sNew = .Text
sOld = .Text
.Value = sNew
Application.EnableEvents = True
sCmt = "Edit: " & Format$(Now, "dd Mmm YYYY hh:nn:ss") & " by " &
Application.UserName & Chr(10) & "Previous Text :- " & sOld
If Target(1).Comment Is Nothing Then
.AddComment
Else
iLen = Len(.Comment.Shape.TextFrame.Characters.Text) End If
With .Comment.Shape.TextFrame
.AutoSize = True
.Characters(Start:=iLen + 1).Insert IIf(iLen, vbLf, "") & sCmt End With
End With
End Sub
What have I done wrong?
Answer
The code stopped firing because Event Firing was disabled and never turned
back on. The way the code is written, as soon as someone makes a change to
the worksheet outside the range A5:AQ155, the Events become disabled
without being turned back on, which means subsequent event triggers will not
be fired (ie. - the next time you edit a cell).
If you make these slight tweaks in the code it should work as intended going
forward.

However, before you do this type Application.EnableEvents = True in the
immediate window and hit Enter to turn events back on so that the code begins
to fire again.
Private Sub Worksheet_Change(ByVal Target As Range)
Const sRng As String = "A5:AQ155" ' change as required Dim sOld As String
Dim sNew As String
Dim sCmt As String
Dim iLen As Long
If Not Intersect(Target, Me.Range(sRng)) Is Nothing Then
Application.EnableEvents = False
With Target 
      sNew = .Value2 
      Application.Undo 
      sOld = .Value2 
      .Value2 = sNew 
      Application.EnableEvents = True 
      sCmt = "Edit: " & Format$(Now, "dd Mmm YYYY hh:nn:ss")
& " by " & Application.UserName & Chr(10) & "Previous Text :-
" & sOld 
      If .Comment Is Nothing Then 
          .AddComment 
      Else 
          iLen =
Len(.Comment.Shape.TextFrame.Characters.Text) 
      End If 
      With .Comment.Shape.TextFrame 
          .AutoSize = True 
          .Characters(Start:=iLen + 1).Insert IIf(iLen, vbLf,
"") & sCmt 
      End With 
End With

End If
End Sub
Answer
Here is the final code that got me the desired behavior. I changed the first IF
statement according to @Scott Holtzman's comment. The IF statement now
resets Application.EnableEvents = True before ending the macro with End Sub
EDIT: Included "Me." in "Me.range(sRng)"
Private Sub Worksheet_Change(ByVal Target As Range)
Application.EnableEvents = False
'If (Target.Row > 3 And Target.Row < 155) Then Cells(Target.Row, "AT") =
Now()
Const sRng As String = "A5:AQ155" ' change as required Dim sOld As String
Dim sNew As String
Dim sCmt As String
Dim iLen As Long
Dim bHasComment As Boolean
With Target(1)
If Intersect(.Cells, Me.Range(sRng)) Is Nothing Then
Application.EnableEvents = True
Exit Sub
End If
sNew = .Text
sOld = .Text
.Value = sNew
Application.EnableEvents = True
sCmt = "Edit: " & Format$(Now, "dd Mmm YYYY hh:nn:ss") & " by " &
Application.UserName & Chr(10) & "Previous Text :- " & sOld
If Target(1).Comment Is Nothing Then

.AddComment
Else
iLen = Len(.Comment.Shape.TextFrame.Characters.Text) End If
With .Comment.Shape.TextFrame
.AutoSize = True
.Characters(Start:=iLen + 1).Insert IIf(iLen, vbLf, "") & sCmt End With
End With
End Sub
Sub Hide_Comments_in_Workbook_Completely() 'This macro hides the
comments and comment indicators - users wont know there is a comment
within the excel workbook
Application.DisplayCommentIndicator = xlNoIndicator
End Sub
Topic 307
Subject
VBA Loop within a loop
Question
im currently looking to work in this data
say i have
4 rows
the first allways starts with
UO2 in column A
below that will be S72's (i.e the reason for the UO2) what i need to do is have
a reference for the S72s as us currently stands the only way to link the s72 to
the uo2 is knowing that the s72 are directly below the u02 untill the next uo2
what i need to do is duplicate the UO2 entry for every line that the s72 relates
to then shift the s72 across so i dont have duplicates
╔════╦══════════════╦══════╗ ║ tr ║ Community ║ 210 ║

╠════╬══════════════╬══════╣ ║UO2 ║ ----------- ║ 5636
║ 
║S72 ║ Reason       ║  148 ║ 
║S72 ║ reason       ║  101 ║ 
║S72 ║ reason       ║  959 ║ 
╚════╩══════════════╩══════╝
what i need the macro to do is
╔════╦══════════════╦══════╗ ║ tr ║ Community ║ S72 ║
╠════╬══════════════╬══════╣ ║UO2 ║ -----------
║Reason║
║UO2 ║ ----------- ║Reason║
║UO2 ║ ----------- ║Reason║
║UO2 ║ ----------- ║Reason║
╚════╩══════════════╩══════╝
there can be multiple reasons for the s72 and the only reference to stop is the
delcaration of another UO2 Answer
If I understand, you're basically looking to turn Column A into a column only
for UO2's and move the S72 data over 2(?) columns to Column C.
If that's right, you just need two Long variables to control your looping, one for
the current row being looked at, and the other as the reference for the UO2 to
use. Ex:
Dim i as Long
Dim j as Long
'Start them at the same point, assumes row 1 is header i = 2
j = 2
'Assuming that once Column A is blank, we have no more data to process Do
While Range("A" & i).value <> ""

'Check for UO2
If Range("A" & i).value = "UO2" 'Adjust condition appropriately 
      'Update j 
      j = i 
  Else 
      'Shift the data over (If there is data to the right of
Column C already you'll 
      ' need to tweak this code to not overwrite it 
      Range("C" & i).value = Range("B" & i).value 
      'Copy down the UO2 info 
      Range("A" & i).value = Range("A" & j).value 
      Range("B" & i).value = Range("B" & j).value 
End if
'Increment i no matter the case
i = i + 1
Loop
'You then need to loop through and delete the rows that have only UO2 data
(i.e. Column C ' would be blank), but that shouldn't be too difficult
Topic 308
Subject
Excel - Comparison of four columns
Question
I need to compare four columns like the ones in the image.
If A+B contents are identical to C+D, in the E I want to see the correct REF
number (1st Column).
If those are not identical, I want to show N/A or something similar.
What solution do you suggest?
Answer
Try this Array formula:

=MATCH(C1 & D1,$A$1:$A$4 & $B$1:$B$4,0)
It must be confirmed with Ctrl-Shift-Enter instead of Enter to exit edit mode.
Topic 309
Subject
Importing data to excel using C#
Question
I have been trying to find a way to insert data in excel. What I am trying to do
here is whenever I run my automation script some data are entered into excel
worksheet. One more thing is that first column should be incremented when
ever I add my data. Below excel sheet is just an example.
enter image description here
Based on the example. If I had ran my application first row have been created
using first line after header in excel having test case name and other
descriptions. When I run the application again then it should create another
row with incrementing with an id of 2
Please help to find a way to insert data to excel.
Let me know if I am on a wrong post instead to voting down for this post.
string pathfile = @"Logs.xlsx";
DateTime date1 = DateTime.Now;
Console.WriteLine(date1);
XLWorkbook workbook = new XLWorkbook(pathfile); IXLWorksheet
worksheet = workbook.Worksheet("Result"); Console.Write("Enter
UserName:");
string uname = Console.ReadLine();
worksheet.Cell("A2").Value = uname;
Console.Write("Enter Password:");
string pwd = Console.ReadLine();
worksheet.Cell("B2").Value = pwd;
workbook.Save();
DateTime date2 = DateTime.Now;

TimeSpan timediff = date2 - date1;
Console.WriteLine(timediff.Minutes + " minutes and " + timediff.Seconds + "
seconds"); var wb = new XLWorkbook();
wb.Worksheets.Add("Result");
wb.SaveAs("Logs.xlsx");
Answer
I take it you are using the ClosedXML library. You need to find the last row
and add it after, like this :
string pathfile = @"Logs.xlsx";
DateTime date1 = DateTime.Now;
Console.WriteLine(date1);
XLWorkbook workbook = new XLWorkbook(pathfile); IXLWorksheet
worksheet = workbook.Worksheet("Result"); Console.Write("Enter
UserName:");
string uname = Console.ReadLine();
int lastRow = Worksheet.LastRowUsed().RowNumber + 1;
worksheet.Cell(String.Format("A{0}", lastRow)).Value = uname;
Console.Write("Enter Password:");
string pwd = Console.ReadLine();
worksheet.Cell(String.Format("B{0}", lastRow)).Value = pwd;
workbook.Save();
DateTime date2 = DateTime.Now;
TimeSpan timediff = date2 - date1;
Console.WriteLine(timediff.Minutes + " minutes and " + timediff.Seconds + "
seconds"); var wb = new XLWorkbook();
wb.Worksheets.Add("Result");
wb.SaveAs("Logs.xlsx");
Topic 310
Subject
Can't assign to array excel
Question
I've been looking for an answer to this for a little while now. I'm referencing
the last answer (by control freak) to this question Excel VBA - How to Redim
a 2D array? in my compiling problems.

Dim arrMachineVision(10, 4)
arrMachineVision = ReDimPreserve(arrMachineVision, machineVisionCount -
1, 4)
Above is my code line that won't compile and it is telling me that this can't be
assigned to the array. I know in Java you have to make a temporary array and
then copy values over and then reassign the original array to the temp array and
then set that array null. This is what I thought the function was doing but then
after it is done it can't be assigned to the original array. I'm wondering what I'm
doing wrong.
The reason I'm going through this function is because I need to resize the first
dimension in my 2d array and the normal redim won't do that for me.
Topic 311
Subject
'Grant Access' to Mac Automator with Excel
Question
I'm on Mac OS X El Capitan and I'm using Automator v2.6 with Excel for Mac
2015 (v15.18): With Automator, I use a pretty simple folder action for the .xls
spreadsheets that by default come out of my database. When they save into my
"ForSQL" folder, it converts them to .csv UTF-8 and then moves them to my
SQL folder. This works sometimes, but other times I run into this Excel pop-up
where I have to "Grant Access" in order for it to open:
I don't see this pop-up when I open things manually -- and when I do grant it
access, Automator still technically runs (it tries to convert and move it) but it
usually fails. Though there are times when this "Grant Access" pop-up doesn't
come up and when that happens, everything works well. I can't seem to find a
pattern for when it comes up and when it doesn't -- they're almost always all
the same types of files (.xls) and I basically always have Excel open.
Any idea why I might be getting this pop-up -- and what I can do to always
grant access so the automation works?
This is my Folder Action Automator steps:

Topic 312
Subject
scrape website will not pull data into excel Xpath on URL
Question
i am trying to pull data from Instagram with excel by the following class: 10
My XpathonURL for total posts looks like this:
=XPathOnUrl(Sheet1!C13,"//*[@id='react-
root']/section/main/article/header/div[2]/ul/li[1]/span/span[2]")
but it is only pull blanks. Any help would be much appreciated!!!!!!
Topic 313
Subject
Excel 2007 VBA Assigning part of a named range to an array
Question
I have a table of monthly sales figures - FreqData1. Each column represents a
month and is numbered 1 to 12. The user chooses one of these numbers from a
dropdown list.
I have the code to find the column number and I have tried to assign the data in
that column to an array so I can use it copy it to a different spreadsheet but with
my basic VBA knowledge and despite lots of searching I have been unable to
find the code as to how to do this or a different method to carry this out.
Can anyone help please
Sub AnnualFreqMacro()
Dim TPNoInt As Long, BranchNoInt As Long, ColNo As Long Dim
FreqArray()
Worksheets("Freq data").Activate
TPNoInt = Range("B42").Value
BranchNoInt = Range("B41").Value

ColNo = Application.Match(TPNoInt, Range("TPBr1"), 0)
CharaArray = Range("FreqData1").Cells (1, ColNo), Cells(16, ColNo))
End Sub
Many thanks in advance
Answer
I think this is your answer: It's how you're using the range.
Delete your CharArray = ... line and replace with:
With Range("FreqData1")
CharaArray = .Range(.Cells(1, ColNo), .Cells(16, ColNo)) End With
The issue is how you're setting the range, Range().Cells(), Cells() isn't the
context, you'd want something more like Range(Cells(),Cells()).
Let's say "FreqData1" is the range A10:A20. If you use
With Range("FreqData1")
.Cells(1,1).Select
End With
this will select the top left most cell (row 1, column 1) in the range
"FreqData", so cell A10 would be selected.
A final misc. point: Avoid using .Select/.Activate. You can activate a sheet of
course so you can follow your macro, but when setting variables to ranges/cell
values, etc. it's best to qualify which sheet you are referring to.
Sub AnnualFreqMacro()
Dim TPNoInt As Long, BranchNoInt As Long, ColNo As Long Dim
FreqArray()
Dim freqWS As Worksheet
Set freqWS = Worksheets("Freq data")

' Worksheets("Freq data").Activate ' removed this, since we have a variable
for it now.
TPNoInt = freqWS.Range("B42").Value ' see how I added the worksheet that
we want to get B42's value from? BranchNoInt = freqWS.Range("B41").Value
ColNo = Application.Match(TPNoInt, Range("TPBr1"), 0) With
freqWS.Range("FreqData1") ' I'm assuming "FreqData1" is on this worksheet
CharaArray = .Range(.Cells(1, ColNo), .Cells(16, ColNo)) End With
End Sub
I'm not positive if you have to qualify a named range's sheet, since it's a named
range, but I added that just to be safe.
Edit2: Hm, oddly enough, if your named range "myRange" is A1:A10, you can
still do myRange.Range(myRange.cells(1,1),myRange.cells(1,2)), even though
there's no second column in the range, it just expands it. I thought it'd throw an
error, but nope. Just to note.
Topic 314
Subject
Excel - Adding multiple columns after last column in chart
Question
I'm trying to create a macro in Excel that will add three columns to the end of
the chart, identical to the previous columns found in the chart with one of the
columns increasing by one.
For example: 
Column 1         Column 2   Column 3    Column 4        
Column 5   Column 6 
PGM Number 1     Amount     Notes       PGM Number 2    
Amount     Notes 
Is there a way to add three columns (PGM Number +1, Amount and Notes) at
the end of the chart, so it can do the following? 
Column 7      Column 8   Column 9       Column 10      Column

11   Column 12 
PGM Number 3     Amount     Notes       PGM Number 4    
Amount       Notes 
This is the code I have to replicate the last column:
Sub InsertColumn()
Dim lastColumn As Long
lastColumn =
ActiveSheet.Range("A1").SpecialCells(xlCellTypeLastCell).Column
Columns(lastColumn).Copy Destination:=Columns(lastColumn + 1) End Sub
But obviously this is not enough.
Thank you for your help!
Answer
Sub addCols()
Dim lastColumn As Long
Dim f As String
Dim s As String
Dim t As String
Dim c As Long
f = "PGM Number "
s = "Amount"
t = "Notes"
With ActiveSheet
lastColumn = .Cells(1, .Columns.Count).End(xlToLeft).Column c =
(lastColumn + 3) / 3
'assuming first row, otherwise change "1" to desired row .Cells(1, lastColumn
+ 1) = f & c
.Cells(1, lastColumn + 2) = s
.Cells(1, lastColumn + 3) = t

End With
End Sub
Topic 315
Subject
Date logic in Excel 2013
Question
The following formula works from most date combinations:
=IF(INT(B2)=INT(NOW()),"Today",IF(DAYS(NOW(),B2)>365,IF(DAYS(NO
YEAR(B2),0)&" years, ","")&IF(IF(MONTH(NOW())-MONTH(B2)
<0,MONTH(NOW())-(MONTH(B2)-11),IF(DAYS(NOW(),B2)
<28,0,MONTH(NOW())-MONTH(B2)))=0,"",IF(MONTH(NOW())-
MONTH(B2)<0,MONTH(NOW())-(MONTH(B2)-11),IF(DAYS(NOW(),B2)
<28,0,MONTH(NOW())-MONTH(B2)))&" months and ")&IF(DAY(NOW())-
DAY(B2)<0,VLOOKUP(MONTH(B2),
{1,31;2,28;3,31;4,30;5,31;6,30;7,31;8,31;9,30;10,31;11,30;12,31},2)-
DAY(B2)+DAY(NOW()),DAY(NOW())-DAY(B2))&" days")
Except if B2 is 16/02/2015 15:19:00 and NOW() is 08/02/2016 14:54 where
the result is 20 days but should obviously be 11 months and 30 days. I'm
struggling to find the hole in my logic. Answer
Your function appears to be using the Julian year length, rather than the more
complicated Gregorian one. That's one reason why your function's robustness
will be questionable.
Fortunately, Excel has a built-in function DATEDIF which you can use. But, for
some reason, it's a hidden function! (I have absolutely no clue why).
If A1 and A2 contain the two dates, use
=DATEDIF(A1,A2,"y") & " years, " & DATEDIF(A1,A2,"ym") & " months, "
& DATEDIF(A1,A2,"md") & " days"
A1 must be earlier than A2.

Answer
Since DATEDIF(date1,date2,"md") essentially generates random numbers
when
DAY(dates2)<DAY(date1)
here's a possible formula solution (where my start and end dates are in A2 and
B2):-
Years
=DATEDIF(A2,B2,"y")
Months
=DATEDIF(A2,B2,"m")
Days
=IF(DAY(B2)>=DAY(A2),DAY(B2)-DAY(A2),DAY(B2)-
DAY(A2)+DAY(EOMONTH(A2,0)))
Here are a few test cases:-
Answer
For anyone else wanting to do the same, here's my working function:
=IF(DAYS(NOW(),B2)>0,CONCATENATE(IF(DATEDIF(B2,NOW(),"y")=0,
"
year"),IF(DATEDIF(B2,NOW(),"y")>1,"s",""),IF(AND(DATEDIF(B2,NOW()
and ","")=""," and ",",
"),""),IF(DATEDIF(B2,NOW(),"ym")=0,"",DATEDIF(B2,NOW(),"ym")),IF(DA
"
month"),IF(DATEDIF(B2,NOW(),"ym")>1,"s",""),IF(AND(DATEDIF(B2,NOW
and
",""),IF(DATEDIF(B2,NOW(),"md")=0,"",DATEDIF(B2,NOW(),"md")),IF(DA
" day"),IF(DATEDIF(B2,NOW(),"md")>1,"s","")),"Less than a day")

which gives a result like "1 year, 5 months and 15 days".
Topic 316
Subject
Userform Combo boxes Excel VBA
Question
So kind of annoying because I have tried every suggestion that I have read so
far, ut I cannot seem to get my user form combo boxes to be filled via VBA.
I have tried the following methods that seem to work for everyone but me....
Me.Weeks.List = Array("30", "36", "40")
And....
With Weeks 
   .AddItem "30" 
   .AddItem "36" 
   .AddItem "40" 
End With
And so far nothing shows up in the userform when I run it. Is there a setting I
am missing? Of course these are part of the initialize event. :)
MORE CODE PER REQUEST:
Private Sub ToolBoxForm_Initialize()
Weeks.Clear
'MORE STUFF
Me.MinAYWeeks.List = Array("30", "36", "40")
'With MinAYWeeks
' .AddItem "30"
' .AddItem "36"

' .AddItem "40"
'End With
'MORE STUFF
End Sub
There's also stuff that does calculations with the OK button, but nothing that
affects the contents of the combobox, just stuff that references the value of the
selected option.
Thanks in advance guys
Answer
In your userform initialize event add your code, but add a reference to the
userform (Me.Weeks).
With Me.Weeks
.AddItem "30"
.AddItem "36"
.AddItem "40"
End With
Topic 317
Subject
Checking for Null in Linq to SQL query
Question
I have the following code nested in a loop reading Excel Rows, it's supposed
to read and house the current row's cell values.
IEnumerable<String> textValues = from cell in row.Descendants<Cell>()
//where cell.CellValue != null
select (cell.DataType.HasValue && cell.DataType == CellValues.SharedString
        ?
sharedString.ChildElements[int.Parse(cell.CellValue.InnerText)]
        : cell.CellValue.InnerText 
     ); 

Currently it's throwing null Exceptions. I would like to set them to an empty
string, rather than skip them, so I still have something I can load into my object.
Topic 318
Subject
Excel VBA: Fetch Google Map latitude, longitude by clicking
Question
This I have done: I have to show the google map in Excel or Browser by using
a address or location or latitude and longitude by showing it in IE or default
browser and I tried in MS web browser component in excel but that is opening
in compatibility mode. I tried with Microsoft power map that required some
installation.
I need help on: from the opened map I need to select location/address I need
the latitude and longitude value to be update in my excel sheet.
In addition to that simple way, I need to send latitude and longitude to google
map and same time I need receive latitude and longitude from map by clicking
the map. in excel web browser no scripts are running. Answer
To solve this you'll have to overcome two obstacles:
Find an Event on the WebBrowser control that fires when the browser is
loaded with a new URL.
Parse the Lat and Long from the URL
Thankfully, Google's newer Map's URL are super friendly for parsing... AND
Microsoft's WebBrowser control has some nice hooks built in.
You probably have some code that looks something like:
Sub webbrowsergo()
WebBrowser1.Navigate2
("https://www.google.com/maps/@39.1240533,-79.8562553,16z") End Sub
That will send the web browser control to somewhere in West Virginia, I think.

Now, in your WorkSheet's VBA code, you can use the
WebBrowser_NavigateComplete2 event to hook in. This event will fire once a
URL has completely loaded. Like if anyone moves the map or changes the
zoom.
In your Worksheet's VBA code, hit the first drop down box at the top of the
VBE and choose your WebBrowser control (probably named WebBrowser1 or
something). Then in the second drop down box, find the NavigateComplete2
event.
It looks something like:
Your VBE will make a new sub for you and you can add the following:
Private Sub WebBrowser1_NavigateComplete2(ByVal pDisp As Object, URL
As Variant)
Debug.Print "Navigation complete, URL=" & URL
Dim strLat As String, strLong As String
strLat = Split(URL, "@")(1)
strLat = Split(strLat, ",")(0)
strLong = Split(URL, ",")(1)
Debug.Print strLat, strLong
End Sub
So, pretty simple stuff. We use the Navigate2Complete event of the
WebBrowser control which fires every time the WebControl updates, and has
this nice parameter called URL which contains the URL that was just loaded to
the WebBrowser control. We use Split() to parse it and grab the Lat and Long.
Debug.Print just writes out the variables to your VBE's Immediate window. Go
to View>>Immediate Window to turn that on if you don't have it already.
Obviously, you can change that to push the Lat and Long to a worksheet or
something.

Topic 319
Subject
how to change output location for each loop and run multiple loops
Question
I have code here which loops through a list of files; opening them, extracting
data and moving it into the main workbook. What i am looking to do get it so
the data for abel is in columns c and d but then put varo in f and g etc. the
problem that i see is that the placement code is inside the loop so for each i it
will just write over the previous line instead of being in a different column all
together!
Sub Source_Data()
Dim r
Dim findValues() As String
Dim Wrbk As Workbook
Dim This As Workbook
Dim sht As Worksheet
Dim i
Dim tmp
Dim counter
Dim c As Range
Dim firstAddress
Dim rng As Range
ReDim findValues(1 To 3)
findValues(1) = "abel"
findValues(2) = "varo"
findValues(3) = "Tiger"
counter = 0
r = Range("A1").End(xlDown).Row
Set rng = Range(Cells(1, 1), Cells(r, 1)) Set This = ThisWorkbook
For Each tmp In rng

Workbooks.Open tmp
Set Wrbk = ActiveWorkbook
Set sht = ActiveSheet 
      For i = 1 To 3 
          With sht.Range(Cells(1, 1),
Range("A1").SpecialCells(xlCellTypeLastCell)) 
          Set c = .Find(findValues(i), LookIn:=xlValues) 
              If Not c Is Nothing Then 
                  firstAddress = c.Offset(0, 2).Value 
                  Do 
                      This.Activate 
                      tmp.Offset(0, 2).Value = tmp.Value 
                      tmp.Offset(0, 3).Value = firstAddress 
                      Set c = .FindNext(c) 
                      counter = counter + 1 
                  Loop While Not c Is Nothing And c.Value =
firstAddress 
              End If 
          End With 
      Wrbk.Activate 
      Next 
Wrbk.Close
Next tmp
End Sub
**EDIT:**I know it can be done by adding a multiplier of "i" to the offset
value but this makes things bigger than they need to be if i wish to search for
50 keywords Answer
Here is my answer, hope to help you, and as always, if you need an
improvement, just tell me.
Sub Source_Data()
Dim r
Dim findValues() As String
Dim Wrbk As Workbook
Dim This As Workbook
Dim sht As Worksheet
Dim i

Dim tmp
Dim counter
Dim c As Range
Dim firstAddress
Dim rng As Range
Dim ColNum 'the columns number var
ReDim findValues(1 To 3)
findValues(1) = "abel"
findValues(2) = "varo"
findValues(3) = "Tiger"
counter = 0
r = Range("A1").End(xlDown).Row
Set rng = Range(Cells(1, 1), Cells(r, 1)) Set This = ThisWorkbook
For Each tmp In rng
Workbooks.Open tmp
Set Wrbk = ActiveWorkbook
Set sht = ActiveSheet 
      For i = 1 To 3 
          With sht.Range(Cells(1, 1),
Range("A1").SpecialCells(xlCellTypeLastCell)) 
          Set c = .Find(findValues(i), LookIn:=xlValues) 
              If Not c Is Nothing Then 
                  firstAddress = c.Offset(0, 2).Value 
                  Do 
                      This.Activate 
                      Select Case i 'Test var i (the value) 
                          Case "abel" 'in case the value
(that is a string) is equal to... 
                              ColNum = 1 'set the var, with
the number of the column you want 
                          Case "varo" 'in case the value... 
                              ColNum = 2 'Set the column... 
                          Case "Tiger" 
                              ColNum = 3 
                          Case Else 'In case that the i var
not match with anyvalue take this column number 

                              ColNum = 20 'the garbage! 
                      End Select 
                      tmp.Offset(0, ColNum).Value = tmp.Value
'Put the value in the selected columns 
                      tmp.Offset(0, ColNum + 1).Value =
firstAddress 'and put the value to the next column of the 
                                                            
       'selected column 
                      Set c = .FindNext(c) 
                      counter = counter + 1 
                  Loop While Not c Is Nothing And c.Value =
firstAddress 
              End If 
          End With 
      Wrbk.Activate 
      Next 
Wrbk.Close
Next tmp
End Sub
Note
You need to set the ColNum var to the values that you need, put there the
numbers of the columns you really need to store the value of i and the next
line is to put the address of the i var
Answer
You can just change these two lines:
tmp.Offset(0, 2).Value = tmp.Value
tmp.Offset(0, 3).Value = firstAddress
To this
tmp.Offset(0, 2 + (i-1)*2).Value = tmp.Value tmp.Offset(0, 3 + (i-1)*2).Value =
firstAddress
Topic 320
Subject

VBA EVALUATE() Misbehavior
Question
I have a set of code that seeks out vlookups within formulas within a range of a
sheet and calculates them. This worked perfectly and then one morning I came
in and it didnt. Offending Code here:
sValue = Application.Evaluate(sVLOOKUP) If Len(sValue) = 0 Then sValue =
"#N/A"
for example
=VLOOKUP(Box,A1:B2,2,0)
in table
A B
Box 1
Car 2
When manually highlighting the VLOOKUP within the in question sheet and
calculating all is fine, however, this code always pulls NA because the
evaluation always evaluates to ERROR 2042
My question then is what could cause the EVALUATE function to always
evaluate to ERROR 2042 (NA) when the vlookup is without a doubt
evaluatable?
EDIT
it would seem that the underlying issue is that I am using a form tool to
reference the desired sub something to do with
Dim OutputFolder As String, GetBook As String, BookCopy As String, wb As
Workbook OutputFolder = GetFolder("C:\")
GetBook = ActiveWorkbook.Name
BookCopy = OutputFolder & "\Client Copy " & GetBook
ActiveWorkbook.SaveCopyAs BookCopy

Set wb = Workbooks.Open(BookCopy)
Dim wsDataLoad As Worksheet, wsEconomics As Worksheet, wsUI As
Worksheet, wsTypeCurves As Worksheet, wsSWM As Worksheet, wsCC As
Worksheet, wsSummary As Worksheet
Set wsDataLoad = wb.Sheets("DataLoad")
interaction with the formtool vs running the sub directly alters the desired
output of the sub Answer
Application.Evaluate has a counter-part Worksheet.Evaluate - you should use
the latter if you want to be sure your string is evaluated in the context of a
specific sheet, and doesn't just default to whatever sheet is active when you run
your code.
Since you've stated the string sVLOOKUP holds the correct value, this seems
to be the likely explanation for what you're seeing.
Topic 321
Subject
count nonempty cells in a row excel vba
Question
Having trouble with syntax while trying to count nonempty cells in a row(in
this example, row two), excel vba.
Have tried .rows(2:2) .rows(2) .cells(B1:B999) received errors with all three.
Dim intCount As Integer
intCount = CountA(ActiveSheet.Rows(2, 2)) Answer
CountA is not a VBA function, it is a worksheet function. Try this:
Dim intCount as integer
intCount = Application.WorksheetFunction.CountA(Activesheet.Rows(2))
Topic 322
Subject

Keep a fixed ratio between 2 cells Excel vba
Question
Currently im making a model in which I need 2 cells to keep a fixed ratio such
that when the sum off the 2 cells always equals one. In this case the cells are
F13 and F14. To give an example if the value off F13 gets changed to 0.4 then
F14 should become 0.6. Same goes if the value off F14 gets changed to 0.2
then F13 should become 0.8. The code I got so for to get is:
Private Sub Worksheet_Change(ByVal Target As Range)
If Not Intersect(Target, Target.Worksheet.Range("F13")) Is Nothing Then 
      If ActiveCell.Value > 1 Then 
          MsgBox "input value is larger than 1" 
      Else 
          Range("F14").Value = 1 - ActiveCell.Value 
          Exit Sub 
      End If 
      Exit Sub 
End If
Exit Sub
If Not Intersect(Target, Target.Worksheet.Range("F14")) Is Nothing Then 
      If ActiveCell.Value > 1 Then 
          MsgBox "input value is larger than 1" 
      Else 
          Range("F13").Value = 1 - ActiveCell.Value 
          Exit Sub 
      End If 
      Exit Sub 
End If
Exit Sub
End Sub
However this code is not working properly. My question is then therefore how

should I change my code in order to get this working properly? Answer
Maybe this will work for you:
Private Sub Worksheet_Change(ByVal Target As Range)
Dim v As Variant
If Target.Address = "$F$13" Then 
      v = Target.Value 
      If Not IsNumeric(v) Then 
          Range("F13").Value = CVErr(xlErrValue) 
      ElseIf v < 0 Or v > 1 Then 
          Range("F13").Value = CVErr(xlErrValue) 
      Else 
          Range("F14").Value = 1 - v 
      End If 
  ElseIf Target.Address = "$F$14" Then 
      v = Target.Value 
      If Not IsNumeric(v) Then 
          Range("F14").Value = CVErr(xlErrValue) 
      ElseIf v < 0 Or v > 1 Then 
          Range("F14").Value = CVErr(xlErrValue) 
      Else 
          Range("F13").Value = 1 - v 
      End If 
End If
End Sub
If F13 is changed to be a value between 0 and 1 then F14 is automatically
changed to be the complementary value, and vice-versa. If any value other than
a number between 0 and 1 is put in one of those 2 cells then the value in that
cell becomes an error. The event handler only works if the value is put directly
in either of those cells (as opposed to a larger range containing those cells) but
with your use of ActiveCell that seems to be the intention.
Topic 323
Subject
Excel VBA AVERAGEIFS range with variables

Question
I want to put in a variable in the code:
Sheets("Sheet1").range("P1").Value = _
"=AVERAGEIFS(B1:B1101, B1:B1101,"">0"",B1:B1101,""<200"")"
Some thing like:
Sheets("Sheet1").range("P1").Value = _
"=AVERAGEIFS(B1:B" & MyLastRow & ", B1:B1101,"">0"",B1:B1101,""
<200"")"
What is the correct syntax?
Topic 324
Subject
UMR file import to access
Question
I am looking to import my umr files into my access database.
The umr file is comma delimited but isnt recoignised when I click import from
text file , purely because its .UMR instead of .CSV
Its exacally the same in appearance how can i make access think its a text file ?
I am currently in the process of opening them in excel telling excel its
delimmed by commas changing data type then re saving
is there a way of batch opening them to resave them a CSV or directly
uploading the umr version to the database
Topic 325
Subject
Pull latest workbook copy selected workbook and paste in master workbook
Question
I am trying to look in a folder to pull the latest workbook by date, open the

workbook up as my src data, copy the selected worksheet and data from src
and then paste to my master workbook. Finally closing the src workbook
without saving any change. I'm having issues on where I should place my file
paths and filenames.
Function NewestFileName(ByVal path As String, ByVal FileTemplate As
String) As String
Dim FileDateCrnt As Date
Dim FileDateNewest As Date
Dim FileNameCrnt As String
Dim FileNameNewest As String
If Right("G:\AOC\GROUPS1\SAC\TEST", 1) <> "\" Then path =
"G:\AOC\GROUPS1\SAC\TEST" & "\"
End If
FileNameCrnt = Dir$("G:\AOC\GROUPS1\SAC\TEST" & Book1.xlsx) If
FileNameCrnt = "Book1.xlsx" Then
NewestFileName = "Book2.xlsx"
Exit Function
End If
FileNameNewest = FileNameCrnt
FileDateNewest = FileDateTime("G:\AOC\GROUPS1\SAC\TEST" &
FileNameCrnt) Do While True
FileNameCrnt = Dir$
If FileNameCrnt = "" Then Exit Do
FileDateCrnt = FileDateTime(path & FileNameCrnt) If FileDateCrnt >
FileDateNewest Then
FileNameNewest = FileNameCrnt
FileDateNewest = FileDateCrnt
End If
Loop
NewestFileName = FileNameNewest
Call ReadDataFromCloseFile

End Function
Sub ReadDataFromCloseFile()
On Error GoTo ErrHandler
Application.ScreenUpdating = False
Dim src As Workbook
Set src = Workbook.Open("G:\AOC\GROUPS1\SAC\TEST.xlsx", True, True)
Dim iTotalRows As Integer
iTotalRows = src.Worksheets("sheet1").Range("B1:B" & Cells(Rows.Count,
"B").End(xlUp).Row)
Dim iCnt As Integer
For iCnt = 1 To iTotalRows
Worksheets("sheet1").Range("B" & iCnt).Formula =
src.Worksheets("sheet1").Range("B" & iCnt).Formula Next iCnt
src.Close False
Set scr = Nothing
ErrHandler
Application.EnableEvents = True Application.ScreenUpdating = True
End Sub Answer
First things first:
If you have a question or encounter an error, then spell it out. It's hard to find
out where your error is, without knowing on which line it occurs.
Your function in a whole doesn't make that much sense. For taking a good look
at it, commenting would've been very helpful.
Let's go through your code step by step:
If Right("G:\AOC\GROUPS1\SAC\TEST", 1) <> "\" Then path =
"G:\AOC\GROUPS1\SAC\TEST" & "\"
End If

This if-condition will always trigger, because the String you put in there, is
always the same and it'll always miss the "\". So if your path doesn't change
then you can change that to path = "G:\AOC\GROUPS1\SAC\TEST\"
FileNameCrnt = Dir$("G:\AOC\GROUPS1\SAC\TEST" & Book1.xlsx) If
FileNameCrnt = "Book1.xlsx" Then
NewestFileName = "Book2.xlsx"
Exit Function
End If
I'm not sure what you are trying to do here. You are setting FileNameCrnt to a
string in the first line (you are missing the "\" btw). I guess "Book1.xlsx" is the
real name of your workbook, so your String should look either like this:
"G:\AOC\GROUPS1\SAC\TEST\Book1.xlsx" or you could do something like
this
fileName = "Book1.xlsx"
FileNameCrnt = Dir$("G:\AOC\GROUPS1\SAC\TEST" & fileName )
Next: You would(!) always exit the function there, if the line above would
work. You set FilenameCrnt to Book1.xlsx, then check it via an if-clause, the
check will always return true, afterwards you'd always exit.
I get the idea of your loop, but it too is broken. Start by changing this: If
FileNameCrnt = "" Then Exit Do to something else. Your variable will never
be empty so your loop will always cause a runtime error. Start changing the
first parts of your function and get to that later. I think you will have a better
idea how all this should work. And it's always better to try solving some things
by yourself. ;)
EDIT
It's always helpful to make a flow chart on how your program should run.
Something like:
Get my current filename
Get date of my current file
Check if there is a newer file (a file with a higher date than my old date)

Get dates of all files (loop through all files) GET highest date
Compare highest date to date of my current file if there is a file with a higher
date, update current filename to filename with higher date
HTH
Topic 326
Subject
VBA copy paste code only returns first hit from specified criteria
Question
I am trying to copy rows from one excel sheet to another using a criteria. The
desired result: VBA code finds all the matches and pastes them without spaces
into a table. When a user changes a criteria and hits run, all the old results get
removed and new list matching criteria appears.
I have the following code. When I run it though only the first record which
matches the criteria appears. HELP! What am I doing wrong?!
'Module to search all Wards' records that match a Ward name specified in the
drop-down menu
Sub findward()
Dim wardname As String
Dim finalrow As Integer
Dim i As Integer
Sheets("Ward_rank_table").Range("B7:BC157").ClearContents wardname =
Sheets("Ward_rank_table").Range("B3").Value finalrow =
Sheets("Ward_rank_set").Range("B160").End(xlUp).Row
Sheets("Ward_rank_set").Select
For i = 2 To finalrow
If Cells(i, 2) = wardname Then
Range(Cells(i, 2), Cells(i, 55)).Copy Sheets("Ward_rank_table").Select
Range("B7").End(xlUp).Offset(1, 0).Resize(1, 55).PasteSpecial
xlPasteFormulasAndNumberFormats

End If
Next i
Range("B3").Select
End Sub
Answer
Try
sheets("Ward_rank_set").select finalrow =
ActiveSheet.UsedRange.Rows.count
Answer
The problem is that you use the select rather creepy, thus once you do the first
copy, you stay on "Ward_rank_table" and you keep on searching on it.
Probably there is nothing there, thus it does not find anything. A working code
(and a really bad practise) would be:
Sheets("Ward_rank_set").Select
For i = 2 To finalrow
If Cells(i, 2) = wardname Then 
      Range(Cells(i, 2), Cells(i, 55)).Copy 
      Sheets("Ward_rank_table").Select 
      Range("B7").End(xlUp).Offset(1, 0).Resize(1,
55).PasteSpecial xlPasteFormulasAndNumberFormats 
End If
Sheets("Ward_rank_set").Select
Next i
In general - avoid the usage of SELECT and ACTIVATE in VBA. As much as
possible.
Topic 327

Subject
reading out an excel attachment of a specific email using php
Question
I have to write a php script where I can select emails with the subject
'Delivery Report on .. ', to read out their excel attachments. Therefore, I found
a script on the internet and customized it (see code below). Now I want to add
a date format to be more specific with the subject. When I use this function I
don't get any emails. If I just use the normal string the script finds all the
received emails with the subject and prints them out, but still it does't print out
the newest email, just the same email every time with the attachment of this
email and I don't know why...
Where is my mistake?
I would really appreciate your help.
/* try to connect */
$inbox = imap_open($hostname, $username, Email_PASSWORD) or
die('Cannot connect to Mailservice: ' . imap_last_error());
/* get all new emails. If set to 'ALL' instead
of 'NEW' retrieves all the emails, but can be
resource intensive, so the following variable,
$max_emails, puts the limit on the number of emails downloaded. * */
$date = date('M jS'); //Format Feb 8th $sub = 'Subject "Delivery Report
on "'.$date.'"'; //is the subject of an email $emails = imap_search($inbox,
$sub); //var_dump($sub); var_dump($emails); /* useful only if the above
search is set to 'ALL' */ $max_emails = 16;
/* if any emails found, iterate through each email */ if ($emails) {
$count = 1;
/* put the newest emails on top */
rsort($emails);
//var_dump($emails);
/* for every email... */

foreach ($emails as $email_number) { 
      /* get information specific to this email */ 
      $overview = imap_fetch_overview($inbox, $email_number,
0); 
      /* get mail message */ 
      $message = imap_fetchbody($inbox, $email_number, 2); 
      /* get mail structure */ 
      $structure = imap_fetchstructure($inbox,
$email_number); 
      $attachments = array(); 
      //var_dump($structure); 
      /* if any attachments found... */ 
      if (isset($structure->parts) && count($structure-
>parts)) { 
         // var_dump($structure); 
          for ($i = 0; $i < count($structure->parts); $i++) {
              $attachments[$i] = array( 
                  'is_attachment' => false, 
                  'filename' => '', 
                  'name' => '', 
                  'attachment' => '' 
              ); 
              var_dump($attachments[$i]); 
              if ($structure->parts[$i]->ifdparameters) {
//getting deeper in the email structre 
                  foreach ($structure->parts[$i]->dparameters
as $object) { 
                      if (strtolower($object->attribute) ==
'filename') {  // reading out the filename of attribute
(fetchstructre) 
                          $attachments[$i]['is_attachment'] =
true; 
                          $attachments[$i]['filename'] =
$object->value; 
                      } 
                  } 
              } 
              if ($structure->parts[$i]->ifparameters) { 
                  foreach ($structure->parts[$i]->parameters
as $object) { 
                      if (strtolower($object->attribute) ==

'name') { 
                          $attachments[$i]['is_attachment'] =
true; 
                          $attachments[$i]['name'] = $object-
>value; 
                      } 
                  } 
              } 
              if ($attachments[$i]['is_attachment']) { 
                  $attachments[$i]['attachment'] =
imap_fetchbody($inbox, $email_number, $i + 1); 
                  /* 4 = QUOTED-PRINTABLE encoding */ 
                  if ($structure->parts[$i]->encoding == 3) {
                      $attachments[$i]['attachment'] =
base64_decode($attachments[$i]['attachment']); 
                  } 
                  /* 3 = BASE64 encoding */ elseif
($structure->parts[$i]->encoding == 4) { 
                      $attachments[$i]['attachment'] =
quoted_printable_decode($attachments[$i]['attachment']); 
                  } 
              } 
          } 
      } 
      var_dump($attachments); 
      /* iterate through each attachment and save it */ 
      foreach ($attachments as $attachment) { 
          if ($attachment['is_attachment'] == 1) { 
              $filename = $attachment['name']; 
              if (empty($filename)) { 
                  $filename = $attachment['filename']; 
              } 
              if (empty($filename)) { 
                  $filename = time() . ".dat"; 
              } 
             // var_dump($attachments); 
              //var_dump($filename); 
              /* prefix the email number to the filename in
case two emails 
               * have the attachment with the same file name.
               */ 
              $fp = fopen($filename, "w+");    //
$email_number . "-" . 
              fwrite($fp, $attachment['attachment']); 

              fclose($fp); 
              $data = new Spreadsheet_Excel_Reader(); 
              $data->setOutputEncoding('UTF-8'); 
              $data->read($filename); 
              error_reporting(E_ALL); 
              for ($i = 1; $i <= $data->sheets[0]["numRows"];
$i++) { 
                  for ($j = 1; $j <= $data->sheets[0]
["numCols"]; $j++) { 
                      echo "\"" . $data->sheets[0]["cells"]
[$i][$j] . "\","; 
                  } 
                  echo "\n"; 
              } 
          } 
      } 
      if ($count++ >= $max_emails) { 
          break; 
      } 
}
}
Topic 328
Subject
Assorted VBA array iteration woes
Question
Private Sub Workbook_Open()
Dim SourceList(0) As Workbook
Dim PathList() As String
Dim n As Integer
PathList = Split("\data\WeaponInfo.csv", ",")
ThisWorkbook.Activate
Application.ActiveWindow.Visible = False Application.ScreenUpdating =

False
For n = 0 To Ubound(PathList) 
      Workbooks.Open Filename:=ThisWorkbook.Path &
PathList(n) 
      Set SourceList(n) = ActiveWorkbook 
      ActiveWindow.Visible = False 
Next
Application.ScreenUpdating = True
Workbooks.Open Filename:=ThisWorkbook.Path & "\HeroForge Anew 3.5
v7.4.0.1.xlsm", UpdateLinks:=3 ActiveWindow.Visible = True
Application.DisplayAlerts = False
For n = 0 To UBound(SourceList)
SourceList(n).Close
Next
Application.DisplayAlerts = True
End Sub
The line For n = 0 to PathList.GetUpperBound(0) is throwing a "Compile
Error (invalid qualifier) whenever I try to run this macro. Specifically it
highlights PathList as being the problem.
Also, if I cut out the loop and just have the contents run once (replacing the
PathList(n) with "\data\WeaponInfo.csv"), it throws an "Object Variable or
With block variable not set" error on the SourceList(0) = ActiveWorkbook
line. What am I doing wrong?
I'm aware that the loop is currently pointless; it's futureproofing as I'm going to
be using this macro to open multiple data references.
EDIT: Made changes suggested by @Jeremy below, now getting the "Object
variable or With block variable not set" error on the SourceList(n).Close line.
EDIT2: Fixed the loop, again on the advice of @Jeremy, by changing Dim

SourceList(1) As Workbook to Dim SourceList(0) As Workbook Answer
A couple of issues:
In VBA, the GetUpperBound method does not exist, it is for .NET only. Change
it to Ubound function. You may run into a problem with Sourcelist(0) =
ActiveWorkbook. Use the Set keyword when assigning object references.
Source is not defined in your loop. ALWAYS put Option Explicit at the top of
your code module to force you to declare your variables. It will save pain in
the future. What are you trying to do with splitting that string? you will just get
one value, which is the string you are passing in.
Private Sub Workbook_Open()
Dim SourceList(1) As Workbook
Dim PathList() As String
Dim n as Integer
PathList = Split("\data\WeaponInfo.csv", ",")
ThisWorkbook.Activate
Application.ActiveWindow.Visible = False Application.ScreenUpdating =
False
For n = 0 To Ubound(PathList) 
      Workbooks.Open Filename:=ThisWorkbook.Path &
PathList(n) 
      Set SourceList(0) = ActiveWorkbook 
Next
ActiveWindow.Visible = False
Application.ScreenUpdating = True
Workbooks.Open Filename:=ThisWorkbook.Path & "\HeroForge Anew 3.5
v7.4.0.1.xlsm", UpdateLinks:=3 ActiveWindow.Visible = True
For Each Source In SourceList

Source.Close
Next
End Sub
Topic 329
Subject
How to preserve/retain hyperlinks in email body when using RangetoHTML
from Excel
Question
I am using Ron de Bruin's RangetoHTML example to send email from selection
on current worksheet in Excel. All working perfectly, however the two
columns of the sheet that contain hyperlinks are coming as plain text (and are
not clickable). I further tried to implement the suggestion from Mail range with
formatting through vba in excel and added the "For Each HyperL" loop, but
after doing that surprisingly the whole email body comes out completely empty.
I can see that the temp file is not empty, but the hyperlinks are already missing
there too.
below is my example - much appreciating ideas on what I have done wrong!
Function RangetoHTML(rng As Range)
Dim fso As Object
Dim ts As Object
Dim TempFile As String
Dim TempWB As Workbook
Dim Hlink As Hyperlink
TempFile = Environ$("temp") & "\" & Format(Now, "dd-mm-yy h-mm-ss") &
".htm"
'Copy the range and create a new workbook to past the data in rng.Copy
Set TempWB = Workbooks.Add(1)
With TempWB.Sheets(1)
.Cells(1).PasteSpecial Paste:=8
.Cells(1).PasteSpecial Paste:=xlPasteValues .Cells(1).PasteSpecial
Paste:=xlPasteFormats .Cells(1).Select

Application.CutCopyMode = False
On Error Resume Next
.DrawingObjects.Visible = True
.DrawingObjects.Delete
On Error GoTo 0
End With
For Each Hlink In rng.Hyperlinks
TempWB.Sheets(1).Hyperlinks.Add _
Anchor:=TempWB.Sheets(1).Range(Hlink.Range.Address), _
Address:=Hlink.Address, _
TextToDisplay:=Hlink.TextToDisplay
Next Hlink
'Publish the sheet to a htm file
With TempWB.PublishObjects.Add( _ 
   SourceType:=xlSourceRange, _ 
   Filename:=TempFile, _ 
   Sheet:=TempWB.Sheets(1).Name, _ 
   Source:=TempWB.Sheets(1).UsedRange.Address, _ 
   HtmlType:=xlHtmlStatic) 
.Publish (True)
End With
'Read all data from the htm file into RangetoHTML Set fso =
CreateObject("Scripting.FileSystemObject") Set ts =
fso.GetFile(TempFile).OpenAsTextStream(1, -2) RangetoHTML = ts.readall
ts.Close
RangetoHTML = Replace(RangetoHTML, "align=center x:publishsource=", _
"align=left x:publishsource=")
'Close TempWB
TempWB.Close savechanges:=False
'Delete the htm file we used in this function Kill TempFile

Set ts = Nothing
Set fso = Nothing
Set TempWB = Nothing
End Function
Here is the calling subroutine code:
code
Sub SendBugReport()
Dim Source As Range
Dim Dest As Workbook
Dim wb As Workbook
Dim TempFilePath As String
Dim TempFileName As String
Dim FileExtStr As String
Dim FileFormatNum As Long
Dim OutApp As Object
Dim OutMail As Object
Set wb = ActiveWorkbook
Set Source = Nothing
On Error Resume Next
Set Source = Selection.SpecialCells(xlCellTypeVisible) On Error GoTo 0
If Source Is Nothing Then
MsgBox "The source is not a range or the sheet is protected, please correct and
try again.", vbOKOnly Exit Sub
End If
With Application
.ScreenUpdating = False
.EnableEvents = False
End With
Set OutApp = CreateObject("Outlook.Application") Set OutMail =

OutApp.CreateItem(0)
On Error Resume Next
With OutMail 
      .to = Sheets("Email Subject and
Dlist").Range("B1").Value 
      .CC = "" 
      .BCC = "" 
      .Subject = Sheets("Email Subject and
Dlist").Range("B5").Value 
      .HTMLBody = RangetoHTML(Source) 
      .Display 
End With
On Error GoTo 0
' .Close savechanges:=False
Set OutMail = Nothing
Set OutApp = Nothing
With Application
.ScreenUpdating = True
.EnableEvents = True
End With
End Sub
Topic 330
Subject
Vba. 300mb+ optimizing macro
Question
(There is more code after/before the code below, this is the part were i want to
optimize the loops)
Sheets("LeanReport").Activate
Dim lRow As Long

On Error Resume Next
lRow = Application.WorksheetFunction.Match("05 2016", Range("AB:AB"),
0) On Error GoTo 0
If lRow > 0 Then
'code
End If
For i = 2 To LastrowLeanReport
R1 = CStr(Cells(i, 5))
RG1 = CStr(Cells(i, 24))
MatrizRG1(i - 2) = RG1
MatrizR1(i - 2) = R1
Next i
Sheets("Carrier").Activate
For i = 2 To LastrowCarrier
RG2 = CStr(Cells(i, 1))
MatrizRG2(i - 2) = RG2
Next i
For j = 2 To LastrowCarrier
For p = lRow To LastrowLeanReport 
      If MatrizRG2(j) = MatrizRG1(p) Then 
          MatrizRG3(j) = Cells(j, 1) 
          MatrizC1(j) = MatrizR1(p) 
      End If 
Next p
If MatrizRG3(j) = "" Then 
      For x = 0 To lRow 
          If MatrizRG2(j) = MatrizRG1(x) Then 
              MatrizRG3(j) = Cells(j, 1) 

              MatrizC1(j) = MatrizR1(p) 
          End If 
      Next x 
End If
Next j
Is there any way to optimize this macro? Lastrowleanreport has more than
700000 rows How can i change those loops for something else?
It gives me all the time error 6 & 7 out of memory.
Thanks!
Answer
In stead of loading the data into matrices and then operate on the matrices, you
could operate directly on the cells. Then you don't consume memory for the
large matrices.
To achieve this, I first changed your code so I can find equivalent expressions.
For example, you assign something to a matrix element and then later use this
element. That usage is then equivalent to the expression with which you got
data from the sheet and placed into the matrix element.
Once that is done, you can replace the matrix references in your last for loop
with the cell references. Here I see something funny: your source worksheet
has apparently 2 header rows that you skip. But then later in the for loop you
skip them again, but now you also skip the first two matrix elements! I don't
think that is what you mean:
For j = 0 To LastrowCarrier - 2
For p = lRow To LastrowLeanReport 
      If MatrizRG2(j + 2) = MatrizRG1(p) Then 
          MatrizRG3(j + 2) = Cells(j + 2, 1) 
          MatrizC1(j + 2) = MatrizR1(p) 
      End If 

Next p
If MatrizRG3(j + 2) = "" Then 
      For x = 0 To lRow 
          If MatrizRG2(j + 2) = MatrizRG1(x) Then 
              MatrizRG3(j + 2) = Cells(j + 2, 1) 
              MatrizC1(j + 2) = MatrizR1(p) 
          End If 
      Next x 
End If
Next j
In the above, I think that the expression j + 2 should be just j (except in the
Cells expression). I continue on that premises. Note also that p in MatrizR1(p)
is ill-defined as it points beyond the matrix (I leave this error to you to fix).
Next I introduced variables for the worksheets, so it is easier to address them.
I changed the loops to start from zero to the row count - 2. This gives the
following equivalent subroutine:
Dim sheetCarrier As Worksheet
Dim sheetReport As Worksheet
Dim lRow As Long
Set sheetReport = Sheets("LeanReport")
sheetReport.Activate
lRow = Application.WorksheetFunction.Match("05 2016", Range("AB:AB"),
0)
For i = 0 To LastrowLeanReport - 2
MatrizRG1(i) = CStr(sheetReport.Cells(i + 2, 24)) MatrizR1(i) =
CStr(sheetReport.Cells(i + 2, 5)) Next i
Set sheetCarrier = Sheets("Carrier")
For i = 0 To LastrowCarrier - 2

MatrizRG2(i) = CStr(sheetCarrier.Cells(i + 2, 1)) Next i
For i = 0 To LastrowCarrier - 2
For p = lRow To LastrowLeanReport 
      If MatrizRG2(i) = MatrizRG1(p) Then 
          MatrizRG3(i) = sheetCarrier.Cells(i + 2, 1) 
          MatrizC1(i) = MatrizR1(p) 
      End If 
Next p
If MatrizRG3(i) = "" Then 
      For x = 0 To lRow 
          If MatrizRG2(i) = MatrizRG1(x) Then 
              MatrizRG3(i) = sheetCarrier.Cells(i + 2, 1) 
              MatrizC1(i) = MatrizR1(p) 
          End If 
      Next x 
End If
Next I
In the next step, I now only have to replace the matrix references in the last
loop with the cell references from the earlier loops. These equivalences are:
MatrizRG1(i) = CStr(sheetReport.Cells(i + 2, 24)) MatrizR1(i) =
CStr(sheetReport.Cells(i + 2, 5)) MatrizRG2(i) = CStr(sheetCarrier.Cells(i +
2, 1))
(I don't know where your output in MatrizRG3 and MatrizC1 is going, so I
leave that in the code - nice exercise for you.)
The equivalent subroutine without matrices then becomes:
Dim sheetCarrier As Worksheet
Dim sheetReport As Worksheet
Dim lRow As Long

Set sheetCarrier = Sheets("Carrier")
Set sheetReport = Sheets("LeanReport")
sheetReport.Activate
lRow = Application.WorksheetFunction.Match("05 2016", Range("AB:AB"),
0)
For i = 0 To LastrowCarrier - 2
For p = lRow To LastrowLeanReport 
      If CStr(sheetCarrier.Cells(i + 2, 1)) =
CStr(sheetReport.Cells(p + 2, 5)) Then 
          MatrizRG3(i) = sheetCarrier.Cells(i + 2, 1) 
          MatrizC1(i) = CStr(sheetReport.Cells(p + 2, 5)) 
      End If 
Next p
If MatrizRG3(i) = "" Then 
      For x = 0 To lRow 
          If CStr(sheetCarrier.Cells(i + 2, 1)) =
CStr(sheetReport.Cells(x + 2, 24)) Then 
              MatrizRG3(i) = sheetCarrier.Cells(i + 2, 1) 
              MatrizC1(i) = CStr(sheetReport.Cells(p + 2, 5))
 ' note: this 'p' is undefined!! 
          End If 
      Next x 
End If
Next i
If this works (and check it; errors are easily made), then we can go on to see if
we can optimize it a bit more.
Topic 331
Subject
Creating active document in loop?
Question
I am trying to pull a paragraph from multiple documents, by getting a sub to

parse through each document looking for this paragraph that is always between
two terms. However I cannot get the "activedocument" or open document to
work? Previously I have been able to use the open function fine, but now I get
Object Errors each time. The folder directory and filename are inputted by the
user into separate cells, so the text in the cells has to be combined to form the
full document address. Here is the code
Sub findTest()
Dim firstTerm As String, filename As Variant Dim secondTerm As String, J As
Integer Dim myRange As Range
Dim documentText As String
Dim mydoc As String
Dim file As Variant
Dim startPos As Long 'Stores the starting position of firstTerm Dim stopPos As
Long 'Stores the starting position of secondTerm based on first term's location
Dim nextPosition As Long 'The next position to search for the firstTerm J = 2
nextPosition = 1
Do Until J > 600
Documents.Open filename:="Worksheets(1).Cells(5, 5) &
Worksheets(2).Cells(J, 1)", ReadOnly:=True ' I get an error here every single
time.
'First and Second terms as defined by your example. Obviously, this will have
to be more dynamic
firstTerm = "<firstword>"
secondTerm = "<secondname>"
'Get all the document text and store it in a variable. Set myRange =
ActiveDocument.Range
'Maximum limit of a string is 2 billion characters. 'So, hopefully your
document is not bigger than that. However, expect declining performance
based on how big doucment is documentText = myRange.Text
'Loop documentText till you can't find any more matching "terms" Do Until

nextPosition = 0 
      startPos = InStr(nextPosition, documentText, firstTerm,
vbTextCompare) 
      stopPos = InStr(startPos, documentText, secondTerm,
vbTextCompare) 
      Debug.Print Mid$(documentText, startPos +
Len(firstTerm), stopPos - startPos - Len(secondTerm)) 
      nextPosition = InStr(stopPos, documentText, firstTerm,
vbTextCompare) 
Loop
J = J + 1
file = Dir
Close Document
Loop
End Sub
Answer
Don't rely on ActiveDocument. Declare a Word.Document object and assign
the document you open to that. Then work with that object rather than
ActiveDocument - much more reliable!
Dim oDoc as Word.Document
Set oDoc = Documents.Open(filename)
Dim oRng as Word.Range
Set oRng = oDoc.Content
'Preferred over oDoc.Range for getting content of entire document oDoc.Close
Note: I don't know what you're trying to do with Close Document, that could be
part of your problem?
Topic 332
Subject
Excel Date and Time format
Question
I am having trouble with datetime format. I used custom format in order to get

my data to read as 01/02/2016 05:33:23. But instead it is reading as 42401
05:33:23.
Any ideas on how to get it to work?
Thanks
Answer
If you are simply wanting to set a range to this format just go into the Format
option once the range is highlighted; then select "More Number Formats". At
the bottom is a "Custom" option, in the entry box type the following:
dd/mm/yyyy hh:mm:ss
That should be the correct format setting.
Topic 333
Subject
Specific Excel function
Question
I need to format some data in excel and I don't know how to write a very
specific function and even worse, I don't know how to google it. The code in
C-like programming language would be as the following:
if(x>1000)
x = x/100+x%100;
else
x = x;
I know the format of Excel formula, but something like this, certainly doesn't
work:
=IF(A2>1000,A2/100+A2%100,A2)
Any help regarding this problem would be highly appreciated! Answer

Thanks for the clarification. Here is the excel formula.
=IF(A2>1000,INT(A2/100)+((A2/100)-INT(A2/100))*100,A2)
Topic 334
Subject
For Comparing two Excel columns in VBA, is it best to use Union, Intersect, or
CountIf?
Question
I have two worksheets in Excel. One, ("List") has a list of 2000 or so rows.
The other ("Library") has a large array of 2000 or so columns, each with 150
rows. I want to delete each column in "Library" that has nothing in it appear in
"List".
What I have so far (using the CountIf function) is:
Sub DeleteLibrary()
Dim Rng As Range
Dim Keyword As Range
Dim Library As Worksheet
Dim List As Worksheet
Dim Chunk As Range
Dim X As Long
X = 1
Application.ScreenUpdating = True
Set Library = Sheets("Library")
Set List = Sheets("List")
Set Keyword = List.Range("A1:A2000")
Set Chunk = Library.Range("A1:A150").Offset(0, X)
Do While X <= 1500
If Application.WorksheetFunction.CountIf(Keyword, Chunk) >= 1 Then X = X
+ 1
ElseIf Application.WorksheetFunction.CountIf(Keyword, Chunk) = 0 Then

Chunk.Delete Shift:=xlLeft
Else: Stop
End If
Loop
End
End Sub
However, this gives me a type mismatch for the first CountIf line. Am I taking
the right approach? Would Union or Intersect be a better route?
Thanks
Topic 335
Subject
Loop through all the files in the current directory
Question
My macro requires me to physically open a comma delimited file, run my
macro, save the file then repeat.
I require a macro to go through all the files in the current directory make the
changes then save itself.
The file directory is
X:\New Gas Team 2016\Incorrect TTZ Database\Read Flows\UMR
After conversion the file needs to be saved into the following X:\New Gas
Team 2016\Incorrect TTZ Database\Read Flows\UMR\converted
as an Excel macro enabled workbook with the file name the same as before
conversion.
Sub UMR()
'
' UMR Macro
'
Range("A1").Select

ActiveCell.FormulaR1C1 = "Transaction_Type" Range("B1").Select
ActiveCell.FormulaR1C1 = "Meter_Point_Ref" Range("C1").Select
ActiveCell.FormulaR1C1 = "Actual_Read_Date" Range("D1").Select
ActiveCell.FormulaR1C1 = "Meter_Reading_Source" Range("E1").Select
ActiveCell.FormulaR1C1 = "Meter_Reading_Reason" Range("F1").Select
ActiveCell.FormulaR1C1 = "Meter_Serial_Number" Range("G1").Select
ActiveCell.FormulaR1C1 = "Meter_Reading" Range("H1").Select
ActiveCell.FormulaR1C1 = "Meter_ROC_Count" Range("I1").Select
ActiveCell.FormulaR1C1 = "Meter_Read_Verified" Range("J1").Select
ActiveCell.FormulaR1C1 = "Corrector_serialNumber" Range("J1").Select
ActiveCell.FormulaR1C1 = "Corrector_serial_Number" Range("K1").Select
ActiveCell.FormulaR1C1 = "Corrector_Uncorrected_Reading"
Range("L1").Select
ActiveCell.FormulaR1C1 = "Corrector_Corrected_Reading"
Range("M1").Select
ActiveCell.FormulaR1C1 = "Corrector_ROC_Count" Range("N1").Select
ActiveCell.FormulaR1C1 = "Corrector_Usable_IND" Range("O1").Select
ActiveCell.FormulaR1C1 = "Corrector_Read_Verified"
Columns("C:C").ColumnWidth = 8.29
Columns("C:C").EntireColumn.AutoFit
Columns("B:B").EntireColumn.AutoFit
Columns("A:A").EntireColumn.AutoFit
Columns("E:E").Select
Columns("D:D").EntireColumn.AutoFit
Columns("E:E").EntireColumn.AutoFit
Columns("F:F").EntireColumn.AutoFit
Columns("G:G").EntireColumn.AutoFit
Columns("H:H").EntireColumn.AutoFit
ActiveWindow.ScrollColumn = 2
ActiveWindow.ScrollColumn = 3
Columns("I:I").EntireColumn.AutoFit
Columns("J:J").EntireColumn.AutoFit
Range("Q1").Select
Columns("K:K").EntireColumn.AutoFit
Columns("L:L").EntireColumn.AutoFit

Range("R1").Select
Columns("M:M").EntireColumn.AutoFit
Columns("N:N").EntireColumn.AutoFit
Columns("O:O").EntireColumn.AutoFit
Call M_Z99
End Sub
Sub M_Z99()
'Application.ScreenUpdating = False
' Dim aCell As Range
ActiveSheet.Range("A2").Select
Trans_count = Cells(Rows.Count, 1).End(xlUp).Row
i = 0
Do Until i = Trans_count
i = i + 1
If ActiveCell.Value = "Z99" Then
Call Delete_row
ElseIf ActiveCell.Value = "" Then
MsgBox "done"
Else: Call T_Skip
End If
Loop
End Sub
Sub Delete_row()
ActiveCell.EntireRow.Select
Selection.Delete Shift:=xlUp
End Sub

Sub T_Skip()
ActiveCell.Offset(1, 0).Select
End Sub
Answer
You'd use the Dir function. Here's an example of the loop you'd nest your code
in:
'Get a count of the files to be merged
f = Dir(fol & "\" & y & "Office Hrs.xls") Do While Len(f) > 0
fc = fc + 1
f = Dir
'Fail safe escape option
If fc > 600 & Len(f) > 0 Then 
      MsgBox "An error has occurred causing it to appear that
there are more than 600 files in the specified folder.",
vbOKOnly, "Overly Large File Count" 
          Application.Calculation = xlCalculationAutomatic 
          Application.ScreenUpdating = True 
          End 
End If
Loop
Also, you should remove Select from your macro, pretty much everywhere it
appears. Selects aren't required and slow your code down. So for example:
Range("A1").Select
ActiveCell.FormulaR1C1 = "Transaction_Type"
should just be
Range("A1").Value = "Transaction_Type"
Also, as my example kind of alludes to, unless you're actually adding an Excel
formula to a cell, the .Value property is what you should be setting

Topic 336
Subject
How to use a VLOOKUP to get a column value based on another column
value?
Question
I have two Excel sheets, the first one looks like this:
And this is the second one:
Basically, I would like to fill in the column Value in the second sheet with the
text from the Answer Column in the first sheet, but only when the value of the
Question column is 3.
If there was no condition involved, I would simply use a VLOOKUP and be
done, but is it possible to do a conditional VLOOKUP like this? Answer
In J2 Cell of Sheet2
=IFERROR(INDEX(Sheet1!D2:D10,MATCH(TRUE,--
(Sheet1!B2:B10=Sheet2!H2)*Sheet1!C2:C10=SUMPRODUCT(MAX((Sheet1!
Array formula requires CTRL+SHIFT+ENTER instead of normal enter.
Topic 337
Subject
VBA code to subtract first two digits from a range
Question
i have a code to copy data from 31 excel file and merge it to one file, i did the
job i only have one issue; im copying one cell from every source file and past
it in all its records in the destination file (every file from the 31 have a
different value so im copying this value and paste it beside its records) the
issue is i need to substract this value to only copy the first two digits but my
code copy anything in this cell "G2" and past it in column A.. can you please
help me as im not a vba expert i only googeled for this code.
Set Sourcedate = WorkBk.Worksheets(1).Cells.Range("G2") Set Distdate =

SummarySheet.Range("A" & NRow) Set Distdate =
Distdate.Resize(SourceRange.Rows.Count - 1) Answer
'Change Declaration of Sourcedate to String if it is in Range Dim Sourcedate
As String
Sourcedate = Left(WorkBk.Worksheets(1).Cells.Range("G2"), 2)
Topic 338
Subject
Cell reference based on FOR loop index
Question
Here is some of my code:
Dim wbX As Workbook
Dim wbY As Workbook
Set wbX = Application.Workbooks.Open("C:\Converter\aaa.xls") Set wbY =
Application.Workbooks.Open("C:\Converter\bbb.xlsx")
For i = 1 To wbX.Sheets.Count
wbY.Sheets(1).Activate
Range("Y" & i + 2).Select
ActiveSheet.Range("Y" & i + 2).Formula = "=RIGHT(("S" & i + 2); 4)"
The problem is that ("S" & i + 2) is not recognized as a cell - VBA spits out
syntax errors. Answer
Your expression "Y" & i + 2 does not yield a valid cell reference because you
concatenate a number to a string. You must convert the numeric expression to a
string:
"Y" & Str(i + 2)
What I understand from your comment, the assignment should be written as:
"=LEFT(S" & Trim(Str(i + 2)) & "; 4)" ' yields e.g.: =LEFT(S3; 4)
(The LEFT function gets the first characters from a string. This assumes the

cells you reference contains strings, or that VB converts the value to a string
first. And here you must use Trim(Str(i + 2)) because you are constructing a
string to place as a formula in the cell.)
Answer
Maybe this example helps you:
Option Explicit
Sub test()
Dim rngC As Range
For Each rngC In Range("C2:C100")
rngC.Offset(0, 4) = Right(rngC, 4) Next
End Sub
Topic 339
Subject
VBA: Refresh an Excel page linked with Nielsen
Question
I just discovered VBA on Excel and I was wondering if (and how) I could
refresh automatically an Excel page linked with a Nielsen base thanks to a
VBA code.
I have already succesfully created such a VBA code for an Excel document
linked with a VBA base, but i ran out of ideas for that. Do you have any ideas?
Thanks for helping!
Your sincerely,
Laurent
Answer
You should ask your companies Nielsen contact for the NITRO Components
Reference Guide document. It has examples and code to help you on this. The

code is in vb which you will have to translate to vba (minor differences).
Dim acnNitro As New ACNNITRO
Dim acnNitroUpdate As ACNielsenNitro.ACNNitroUpdate Dim WS As
Worksheet
Dim bret as Boolean
acnNitro.ParentApp = Application
acnNitroUpdate = acnNitro.ACNNitroUpdate WS = ActiveSheet 'or Set WS =
WorkSheets("My Sheet") bret = acnNitroUpdate.UpdateAllNRanges(WS,
ntrSelectGet) acnNitro = Nothing
acnNitroUpdate = Nothing
WB = Nothing
Topic 340
Subject
jQuery Datatable DOM positioning for Buttons
Question
I just upgraded my jQuery Datatable version to 1.10. And then i tried to
remove its retired plugin such as "Colvis" and "Tabletools" with the "Button"
extension. Everything works fine here.
But the problem for me is, I could not able to separate "Colvis" button from the
"Tabletool" buttons.
"sDom": "B<'row'><'row'<'col-md-6'l><'col-md-6'f>r>t<'row'<'col-md-4'i>>
<'row'p>B",
"buttons": [ 
      'copyHtml5', 
      'excelHtml5', 
      'csvHtml5', 
      { 
          extend: 'colvis', 
          postfixButtons: [ 'colvisRestore' ], 
          columns: '0,1,2,3,4,5,6' 
      } 

],
language: { 
      buttons: { 
          colvis: 'Change columns' 
      } 
}
Where in the "sDom", the letter "B" denotes for Buttons. So i am getting all
four Buttons (Copy, Excel, CSV and Colvis) in a single row. But i need the
"Colvis" button to be separated from (Copy, Excel and CSV).
So Is there any way to add one button near to search box and another one near
to the pagination?
OR
Is there any configuration available in the "sDom" or in the "Button"?
Thank you!
Answer
You add new elements to the dataTables dom controls by using <'.class'> or
<'#id'>. Example, insert a new <div id="colvis"> element to the left of the
pagination, <'#colvis'> before p :
"sDom": "B<'row'><'row'<'col-md-6'l><'col-md-6'f>r>t<'row'<'col-md-4'i>>
<'row'<'#colvis'>p>"
colvis buttons has the class .buttons-colvis, so you move them permanently to
the injected #colvis element by :
$('.buttons-colvis').detach().appendTo('#colvis')
This is the fast way to move the colvis button to another location.
Regarding @GreeKatrina's suggestion, yes - but the correct placement method
is :

var colvis = new $.fn.dataTable.Buttons( table, {
buttons: [ 
      { 
          extend: 'colvis', 
          ... 
      } 
]
})
colvis.container().appendTo('#colvis')
if you have a #colvis element of course.
My recommendation :
Besides the above hardcoded solution, where you target the colvis buttons
specifically, you could monkey patch dataTables buttons so each extended
button can have a container option. After initialisation, the button is moved to
the specified container :
var org_buildButton = $.fn.DataTable.Buttons.prototype.buildButton;
$.fn.DataTable.Buttons.prototype.buildButton = function(config,
collectionButton) {
var button = org_buildButton.apply(this, arguments); $(document).one('init.dt',
function(e, settings, json) { 
     if (config.container && $(config.container).length) { 
      
$(button.inserter[0]).detach().appendTo(config.container) 
     } 
})
return button;
}
use the container option :

{
extend: 'colvis',
postfixButtons: [ 'colvisRestore' ], container : '#colvis', //<---
columns: '0,1,2,3,4,5'
}
demo -> http://jsfiddle.net/v4bLv83h/
As the example demonstrates, you can now specify an alternative container for
each and every button. Note that container can be any element, it does not have
to be an element injected by dom. Also note (as you may notice in the fiddle)
that you need to do some styling if you want to make injected elements flow
properly along with the native control elements, such as the pagination block.
Answer
I'm not an expert with the data tables library, but the documentation says you
can have multiple collections of buttons and insert them separately. It also has
an example for multiple button groups that you could use instead of putting "B"
multiple times in the dom option, which I don't think is valid.
Combining the examples from the documentation and your example (not
tested):
var table = $('#myTable').DataTable( {
dom: "B<'#colvis row'><'row'><'row'<'col-md-6'l><'col-md-
6'f>r>t<'row'<'col-md-4'i>><'row'p>", buttons: [ 
      'copyHtml5', 
      'excelHtml5', 
      'csvHtml5' 
]
} );
new $.fn.dataTable.Buttons( table, {

buttons: [ 
      { 
          extend: 'colvis', 
          // Shorter than using the language.buttons.colvis
option 
          text: 'Change columns', 
          postfixButtons: [ 'colvisRestore' ], 
          columns: '0,1,2,3,4,5,6' 
      } 
]
} );
// To append it at the bottom of the table // 3 since the colvis button is at the
3rd index in the buttons array table.buttons( 3, null ).container().appendTo(
table.table().container()
);
// To append it on the first row after the buttons, in the #colvis row
table.buttons( 3, null ).container().appendTo(
$('#colvis'), table.table().container() );
If it doesn't work let me know and I'll update my answer.
Topic 341
Subject
C#/WPF: Defining an EXCEL range through row and column number
Question
I have tried this
How do I get an Excel range using row and column numbers in VSTO / C#?
but it throw an undefined com exception
what I would like is something like (pseudocode)

Range myRange = new Range(new cell(1,1), cell(3,3));
so that I can then use it with (pseudocode again)
ws.myRange.Interior.Color = XlRgbColor.rgbDarkGray;
thank you
Answer
Please check that out:
Range range1 = ws.Range[ws.Cells[1, j], ws.Cells[1, j+1]];
Here, Range is :
Microsoft.Office.Interop.Excel.Range
Topic 342
Subject
Prevent Excel VBA code interruption with Esc key
Question
How can I prevent Excel VBA Code from being interrupted by the user by
pressing the Esc Key?
I'm trying the following code on ThisWorkbook:
Private Sub Workbook_Open()
On Error Resume Next
Application.EnableCancelKey = xlDisabled Application.DataEntryMode =
True
Call WebPage
End Sub
But it's not working since if I press Esc when the workbook opens, the code
breaks:

So it seems the code is interrupted even before the workbook opens. Is there a
way to fix this?
Thanks for helping!
Answer
It seems that your workbook is big enough that there is a time delay between
opening and running code, leaving an opportunity for the user to hit esc in the
meantime. Perhaps instead of calling WebPage on the workbook opening, you
could have the file be simply a 'landing page' with instructions and a single
button to click. This gives the user control over executing the macro, but also
gives you time to load your disabling of the escape key before the macro is run.
Also, if you have confidence that your error handling will return all
functionality to normal you could use this instead:
Application.InterActive = False
This would prevent any key instructions being entered, including esc &
command break.
Topic 343
Subject
How can I get a preview image of an excel document?
Question
I've got an excel document and i need to take an image of the first sheet and use
it to put in the icon of JLabel. How can I do it? Answer
I don't think Apache POI provides anything here as it is not concerned about
displaying the data, only about retrieving and updating the data in the Excel
Workbook.
So basically only Excel and other office applications like LibreOffice know
how to actually display the data.
A few alternative options that come to my mind:
Use some other software to display the contents as a web-page and use

Selenium to take a screenshot, see e.g. Take a screenshot with Selenium
WebDriver Programmatically open the file in Excel on a Windows box, then
use some screenshot utility with automation support
Topic 344
Subject
How to generate table from Excel in PowerDesigner?
Question
I have followed this page of Sybase to generate a table from Excel but it
doesn't work. I did:
Select the Excel to import.
Choose "Import table As table in Import Table popup. Imported columns as
attributes of default values that come up in the box.
The result is, PowerDesigner creates as many gibberish tables as the number
of rows in my table in Excel file. But somehow this is the expected behavior
because at the "Import Table" popup, it says (emphasis by me):
Select the kind of PowerDesigner object that you want to create for each table
row.
But I want to create just a single table from my Excel file. How can I do this?
Topic 345
Subject
Compare Values in Excel in all sheets that have the same title/name
Question
Hello fellow netizens of the programming community!
Need some help with a couple of excel worksheets that I'll be working forth
day in and out.
Here's a some info of what I have on hand, and what I want to do..
I have several worksheets (10 of them) of similar (not 100% identical) tables
..

one worksheet may look like this (x, y and z are other unimportant variables)
name - score - x - y - z
jon - 50 - x - y - z
sam - 50 - x - y - z
pad - 50 - x - y - z
fed - 50 - x - y - z
mum - 50 - x - y - z
and another worksheet may look like this
name - score - x - y - z
pad - 50 - x - y - z
mum - 50 - x - y - z
fed - 50 - x - y - z
jon - 50 - x - y - z
sam - 50 - x - y - z
simply put, there are names such as 'jon' and the relevant scores that can occur
across all the worksheets, or names such as 'ped' that can only appear once in
one worksheet.
I would like to compare all the sheets at the same time, finding out the highest
score for jon, sam, pad, fed, mum across all the sheets and have these
information presented in another new sheet itself.
for e.g.
the new sheet should present data as
name - highest score
jon - 39
sam - 22
pad - 42
mum - 22
I hope whatever I'm trying to say is not confusing anyone! If anyone could help,

ill greatly appreciate it! Answer
The solution is available via pivot table formed across multiple sheets. Steps:
Assuming your files is open, and you are in one of your sheets. Alt+D+P
(Opens a dialog box)
Select "Multiple consolidation ranges" and "Pivottable" >>Next Select "Create
a single page field for me" >>Next Here, select in the Range box and Add, all
the table areas one by one. Have one addition per sheet of yours. So you
should have 10 ranges getting inserted here. >>Finish
You will get a pivot table where the Values field will have "Count of score" (it
is mostly this, else it could be Sum of score, etc. Here's how you change it to
max) Click on whatever is in the values field >> Value Field Settings >> Max
>> Ok.
(If you want to choose min/average/count/product/stdDev, this is the place to
make that change)
As a caveat, do check fields in Filters/Columns/Rows are as you want. I have
run a sample pivot on the two tables you have provided, screenshot is attached,
this is how the table should look like.
Sample Pivot screenshot on data provided
Topic 346
Subject
Transpose complex data in excel and google spreadsheet
Question
I have kind of data seen in the first picture I uploaded. When I use transpose in
Excel, by paste special it becomes this :
2
Is there any way to transpose my date like this :
date
order

model
kop
number
address
price
or is there any better way easier to do with my data ? Example it has same
#order, but 3-4 #model, 3-4 #kop, and same address and number ?
I have to list my data like this to manage easier, but its getting hard to print
them to stick on my product.
Please help me T.T
Topic 347
Subject
Error when opening XLSX file made by tealeg xlsx in Go language on Google
App Engine
Question
I'm using https://github.com/tealeg/xlsx to generate xlsx file in Go language.
The application is running on Google App Engine.
var file *xlsx.File
var sheet *xlsx.Sheet
var row *xlsx.Row
var cell *xlsx.Cell
var err error
file = xlsx.NewFile()
sheet, err = file.AddSheet("TEST")
if err != nil {
fmt.Printf(err.Error())
}
row = sheet.AddRow()
cell = row.AddCell()
cell.Value = "I am a cell!"

w.Header().Set("Content-Type", "application/vnd.openxmlformats-
officedocument.spreadsheetml.sheet") w.Header().Add("Content-Disposition",
"attachment; filename=Test.xlsx") file.Write(w)
fmt.Fprint(w, nil)
The variable w is http.ResponseWriter.
I have tested this code and the browser downloaded the xlsx file successfully
and I can open it with LibreOffice on Linux 64 bit. However when I tried to
open the file with Microsoft Excel 2010 on Windows 7 32 bit, it gave me the
following error message:-
Excel found unreadable content in 'Test.xlsx'. Do you want to recover the
contents of this workbook? If you trust the source of this workbook, click Yes.
Once I clicked yes, it showed the content "I am a cell!" correctly then I clicked
on Enable Editing button and it gave me a message:-
Excel completed file level validation and repair. Some parts of this workbook
may have been repaired or discarded.
How to fix this problem by making Microsoft Excel opens xlsx files generated
by tealeg/xlsx without any error message? Answer
Your last line is completely unnecessary, and it corrupts the Excel file (XLSX
is a zip archive):
fmt.Fprint(w, nil)
This will print the bytes of the "<nil>" string to the web response after you
already wrote the content of the Excel file, which I believe you just left there
as an accident. Remove that.
Also File.Write() returns an error, also check that, for example:
if err = file.Write(w); err != nil {
// Handle error, e.g. log it and send back an error response }

If the error still persists, it's not AppEngine related. I suggest first try the Excel
generation locally, saving it to a file using File.Save(), e.g.:
if err = file.Save("MyXLSXFile.xlsx"); err != nil {
fmt.Println("Failed to save file:", err) }
// If no error, try opening "MyXLSXFile.xlsx" on you computer.
Also note the comment from the home page of the library:
The support for writing XLSX files is currently extremely minimal. It will
expand slowly, but in the meantime patches are welcome!
Topic 348
Subject
Strange #VALUE! error
Question
Please have a look at this error:
Here are two functions:
Public Function CompareExtra(r1 As Range, r2 As Range) As Long
Dim r As Integer, v As Variant, v2 As Variant Dim rr1() As String
Dim rr As Range
rr1 = Split(r1, ",")
For r = LBound(rr1) To UBound(rr1) 
    v = --Trim(rr1(r)) 
    If v <> 0 And v <> "" Then 
       For Each rr In r2 
          v2 = rr.Value 
          If v = v2 Then CompareExtra = CompareExtra + 1 
       Next rr 
    End If 
Next r
End Function

Function getLeast(rng As Range, leastXValues As Long, maxValue As Long,
displacement As Long, Optional Sorted As Boolean = True) As String Dim d
As Object, AL As Object
Dim i As Long, j As Long
Dim a As Variant
Set d = CreateObject("Scripting.Dictionary") Set AL =
CreateObject("System.Collections.ArrayList") a = rng.Value
i = UBound(a, 1)
j = UBound(a, 2)
Do
If a(i, j) <> 0 Then d(a(i, j)) = a(i, j) j = j - 1
If j = 0 Then 
    j = UBound(a, 2) 
    i = i - 1 
End If
Loop Until i = 0
For i = 1 To maxValue
d(i) = i
Next i
a = d.Items()
For i = UBound(a) - displacement To UBound(a) - displacement -
leastXValues + 1 Step -1 AL.Add a(i)
Next i
If Sorted Then AL.Sort
getLeast = Join(AL.ToArray, ", ")
End Function
I can't get why if I take the result of getLeast() from a separate cell - everything
works, but if I add it to CompareExtra() directly, it throws an error.. Answer
Simple solution is to use variants:
Public Function CompareExtra(r1 As Variant, r2 As Variant) As Long Function
getLeast(rng As Range, leastXValues As Long, maxValue As Long,
displacement As Long, Optional Sorted As Boolean = True) As Variant

Topic 349
Subject
ImportError when using read_excel into a data frame
Question
I am encountering an ImportError when trying to use the read_excel function of
Pandas.
I have a script which works perfectly reading CSV files and the read_csv
function, using argparse to allow command line arguments. I thought I'd try and
modify this script so that it could read Excel files.
This is the code that works perfectly for the CSV file.
df = pd.read_csv(args.src, header=0, skiprows=Datarow,
na_values=bad_data,
usecols=[timecol, SPcol, PVcol, MVcol], names=['Timestamp', 'SP', 'PV',
'MV'])
My code allows for the user to select the starting row and the columns that they
want to read data from, and parses them into a new data frame. All works
well.
Using the read_excel function, I originally came up with this:
df = pd.read_excel(args.src, skiprows=Datarow, na_values=bad_data,
parse_cols=[timecol, SPcol, PVcol, MVcol], header=Headerrow)
I removed the header argument as it wasn't required. I changed the usecols to
parse_cols as per the Pandas documentation. In the read_csv function I used
custom names for the column headers, but it looked like read_excel couldn't do
this. So I replaced this functionality with the header argument and allowed the
user to set the row number in the Excel source file that contained the column
names.
When I ran this script, I got this Traceback:

Traceback (most recent call last):
File "cleanse.py", line 74, in <module>
parse_cols=[timecol, SPcol, PVcol, MVcol], header=Headerrow) File
"/usr/local/lib/python2.7/site-packages/pandas/io/excel.py", line 163, in
read_excel io = ExcelFile(io, engine=engine)
File "/usr/local/lib/python2.7/site-packages/pandas/io/excel.py", line 187, in
__init__ import xlrd # throw an ImportError if we need to ImportError: No
module named xlrd
I saw on another post that someone encountering this error was replied with
"pip install xlrd", so I did that. Same problem. I then started dropping off the
optional arguments one at a time. Same problem. I went right back to just the
source file argument and still get the same error.
Any hints or advice would be appreciated.
Topic 350
Subject
How to loop through rows, save these as variables and use them as variables
VBA
Question
I'm trying to store values in sheets as a variable, and then go on to reference a
sheet using that variable as well as use it to filter by.
This will be looped through until the program reaches the first empty cell.
The relevant code I have so far is:
Sub Program()
Dim i As Integer
i = 2
Do Until IsEmpty(Cells(i, 1))
Debug.Print i
Sheets("Button").Activate 

      Dim First As String 
      First = Cells(i, 1).Value 
      Debug.Print First 
      Dim Second As String 
      Second = Cells(i, 2).Value 
      Debug.Print Second 
'Filters my Data sheet and copies the data
Sheets("DATA").Activate
Sheets("DATA").Range("A1").AutoFilter _ 
      Field:=2, _ 
      Criteria1:=First 'Filters for relevant organisation 
  Sheets("DATA").Range("A1").AutoFilter _ 
      Field:=6, _ 
      Criteria1:="=" 'Filters for No Response 
Sheets("DATA").Range("A1:H6040").Copy
'This should loop through for each separate group
Sheets(CStr(Second)).Select
Range("A1").Select 
      ActiveSheet.Paste 
      Selection.PasteSpecial Paste:=xlPasteValues,
Operation:=xlNone, SkipBlanks _ 
          :=False, Transpose:=False 
i = i + 1
Loop
Worksheets("DATA").AutoFilterMode = False
End Sub
I have changed the program significantly trying to add notation such as 'CStr' as

there was an error at this line: Sheets(CStr(Second)).Select when it used to say
Sheets(Second)).Select
and the debug.print's to see if it is actually working but it isn't logging to the
Immediate Window.
Additionally, when I actually run it, no error comes up but nothing seems to
happen.
Not sure what else to add, or what else to try. Cheers! Answer
As a first remark, using (at least the first) sheet activation within the loop
seems unnecessary, because the start of the loop is what determines which
sheet is being used to control the flow of the loop.
Furthermore, I would argue that it is better to remove the sheet activation
altogether, re: the discussion about .Select (the cases aren't the same, but the
solution discussed herein works better for both .Select and .Activate in almost
all instances): How to avoid using Select in Excel VBA macros.
Let's also see if we can refer to the table in the "DATA" sheet in a more direct
manner, as well as do some errorchecking.
My suggestion:
Sub Program()
Dim i As Integer
Dim First, Second As String
Dim secondWs As Worksheet
Dim dataTbl As ListObject
i = 2
Set dataTbl = Worksheets("DATA").Range("A1").ListObject.Name ' The
above can be done more elegantly if you supply the name of the table
Sheets("DATA").Activate
Do Until IsEmpty(Cells(i, 1))

Debug.Print i 
      First = Sheets("Button").Cells(i, 1).Value 
      Debug.Print First 
      Second = Sheets("Button").Cells(i, 2).Value 
      Debug.Print Second 
'Filters my Data sheet and copies the data
dataTbl.AutoFilter _ 
      Field:=2, _ 
      Criteria1:=First 'Filters for relevant organisation 
  dataTbl.AutoFilter _ 
      Field:=6, _ 
      Criteria1:="=" 'Filters for No Response 
Sheets("DATA").Range("A1:H6040").Copy
'This should loop through for each separate group
On Error Resume Next
Set secondWs = Worksheets(Second)
On Error GoTo 0
If Not secondWs Is Nothing Then
secondWs.Range("A1").PasteSpecial Paste:=xlPasteValues Else
Debug.Print "Sheet name SECOND was not found" End If
i = i + 1
Loop
Worksheets("DATA").AutoFilterMode = False
End Sub
If you get any errors, please state which line it appears on and what the error

message actually is.
Ref
http://www.mrexcel.com/forum/excel-questions/3228-visual-basic-
applications-check-if-worksheet-exists.html#post13739
Topic 351
Subject
Pass excel Column/cell range to a MySQL/ MS query as parameter
Question
I have a MySQL query which in which I have to pass excel cells/columns as
parameter. i.e Select * from employee where name=? and joining_date=?
The above query has to pick the two parameters from cells in two columns
name & joining_date from sheet 1 and populate in sheet 2.
Is there any way we could give more that one cell or whole column as
parameter in MS query.
Topic 352
Subject
RGB to fill color in excel vba
Question
I have a task to generate a color code . I have the R G B values listed in three
different columns and there are around 256 rows of R G B values. I need to fill
the color corresponding to the R G B values in each row.
list
This is how it has been listed . And i would require to generate the
corresponding color code next to this Answer
Sub ChangeRowColorBasedonAtoCRGBValues() Dim lRw As Long
lRw = Cells(Rows.Count, "A").End(xlUp).Row
For i = 1 To lRw

Range("A" & i).EntireRow.Interior.Color = _
RGB(Cells(i, "A").Value, Cells(i, "B").Value, Cells(i, "C").Value) Next i
End Sub
Topic 353
Subject
Copy dynamic range and paste dynamic range with duplicate value
Question
I want to copy and paste dynamic range. Especially paste with duplicate value
for each source of copy range. Here is code I created from recording a macro:
Sub copyRange()
Range("A2").Select
Range(Selection, Selection.End(xlToRight)).Select Selection.Copy
Range("L2:S7").Select
ActiveSheet.Paste
Range("A3").Select
Range(Selection, Selection.End(xlToRight)).Select Application.CutCopyMode
= False
Selection.Copy
Range("L8:S13").Select
ActiveSheet.Paste
Range("A4").Select
Range(Selection, Selection.End(xlToRight)).Select Application.CutCopyMode
= False
Selection.Copy
Range("L14:S19").Select
ActiveSheet.Paste
Range("A5").Select
Range(Selection, Selection.End(xlToRight)).Select Application.CutCopyMode
= False
Selection.Copy

ActiveWindow.SmallScroll Down:=3
Range("L20:S25").Select
ActiveSheet.Paste
End Sub
this is screenshot output i want:
Answer
Sub CopyPasteData()
Dim lRw As Long, lRw_2 As Long, x As Long, rActive As Range
Set rActive = ActiveCell
lRw = Cells(Rows.Count, "A").End(xlUp).Row
Application.ScreenUpdating = False
Range("K2:R" & Rows.Count).ClearContents
For i = 2 To lRw
x = x + 1
Range("A" & i & ":H" & i).Copy
lRw_2 = Cells(Rows.Count, "K").End(xlUp).Row + 1 With Range("K" &
lRw_2).Resize(6) 
      .PasteSpecial xlPasteAll 
      .Offset(, -1).Value = x 
End With
Next i
Application.CutCopyMode = False
rActive.Select
Application.ScreenUpdating = True
End Sub
Topic 354

Subject
Excel weekly fortnightly monthly budget if statement
Question
My spread sheet has a columns for expenses that are weekly, fortnightly and
month. To assist myself I am trying to simplify everything back to a weekly
amount using IF statement. Example is Weekly (A1), Fortnightly (B1), Monthly
(C1). D1 needs to end with weekly amount overall. A1 is $10 so if has a value
show value otherwise leave blank because either B1 or C1 will have a value.
B1 is $30 so if has a value divide by 2 and show otherwise leave blank
because A1 or C1 has a value. C1 is $85 so if has a value multiply by 12 and
divide by 52 and show otherwise leave blank because A1 or B1 has a value.
Thanks in advance
Answer
This compound IF should do what you need (parens are to emphasize the
calculation and are not necessary):
=IF(B2>0,(B2),IF(C2>0,(C2/2),IF(D2>0,(D2*12/52),"no values")))
Propagate this down through the column you want normalized to a weekly
expense and it should result in something like this: 
      weekly  fortnightly  monthly  normalized 
item a   10.00                             10.00 
item b                30.00                15.00 
item c                         85.00       19.62 
item d                                 no values 
Topic 355
Subject
How to redefine last row within a loop
Question
The following code inserts rows when a blank cell in col B is encountered and
specific values are present in col A. The inserted rows are populated with
values from arrays depending on the condition. Each time rows are inserted I
need the last row value to change, so the code can evaluate the next blank cell

in col B but I can’t figure out how to redefine the last row. How do I make this
work?
What kind of loop do I need to use?
Where do I redefine the last row?
How do I move to the next blank cell in column B?
Thank you very much,
Sub MissingValues()
Dim zArr As Variant
Dim yArr As Variant
Dim LastRow As Long
Dim sht As Worksheet
Dim i As Long
Set sht = ThisWorkbook.Worksheets("QC")
Application.EnableEvents = False
Application.ScreenUpdating = False
yArr = Array(Array("HD300 Removed Alt", "EGFR", "", "", "L861Q", "5"), _
     Array("HD300 Removed Alt", "EGFR", "", "",
"KELRE745delinsK", "5"), _ 
     Array("HD300 Removed Alt", "EGFR", "", "", "L858R",
"5"), _ 
     Array("HD300 Removed Alt", "EGFR", "", "", "T790M",
"5"), _ 
     Array("HD300 Removed Alt", "EGFR", "", "", "G719S",
"5")) 
zArr = Array(Array("HD200 Removed Alt", "BRAF", "", "", "V600E",
"10.5"), _ 
      Array("HD200 Removed Alt", "KIT", "", "", "D816V",
"10"), _ 
      Array("HD200 Removed Alt", "EGFR", "", "",
"KELRE745delinsK", "2"), _ 
      Array("HD200 Removed Alt", "EGFR", "", "", "L858R",

"3"), _ 
      Array("HD200 Removed Alt", "EGFR", "", "", "T790M",
"1"), _ 
      Array("HD200 Removed Alt", "EGFR", "", "", "G719S",
"24.5"), _ 
      Array("HD200 Removed Alt", "KRAS", "", "", "G13D",
"15"), _ 
      Array("HD200 Removed Alt", "KRAS", "", "", "G12D",
"6"), _ 
      Array("HD200 Removed Alt", "NRAS", "", "", "Q61K",
"12.5"), _ 
      Array("HD200 Removed Alt", "PIK3CA", "", "", "H1047R",
"17.5"), _ 
      Array("HD200 Removed Alt", "PIK3CA", "", "", "E545K",
"9")) 
LastRow = sht.Cells(sht.Rows.Count, "A").End(xlUp).Row
i = 3
Do While i <= LastRow
Debug.Print i
Debug.Print LastRow 
      If IsEmpty(Cells(i, 2).Value) = True Then 
        Cells(i, 2).Value = "header" 
          If InStr(1, Cells(i, 1).Value, "HD200", 1) > 0 Then
              Rows(i & ":" & i + 10).Insert Shift:=xlDown
'Insert 11 rows 
              Worksheets("QC").Range("A" & i & ":F" & i +
11).Value _ 
              = Application.Index(zArr, 0) 
               'Recalculate LastRow 
               i = i + 12 
               LastRow = sht.Cells(sht.Rows.Count,
"A").End(xlUp).Row 
          ElseIf InStr(1, Cells(i, 1).Value, "HD300", 1) > 0
Then 
              Rows(i & ":" & i + 4).Insert Shift:=xlDown
'Insert 5 rows 
              Worksheets("QC").Range("A" & i & ":F" & i +
5).Value _ 
               = Application.Index(yArr, 0) 
               i = i + 6 

              'Recalculate LastRow 
              LastRow = sht.Cells(sht.Rows.Count,
"A").End(xlUp).Row 
          Else 
              i = i + 1 
          End If 
        'LastRow = sht.Cells(sht.Rows.Count,
"A").End(xlUp).Row 
      End If 
      'LastRow = sht.Cells(sht.Rows.Count, "A").End(xlUp).Row
Loop
Application.EnableEvents = True
Application.ScreenUpdating = True
End Sub
Answer
Whenever you insert or delete lines in excel worksheet you have to do it from
the last line.
For i = LastRow To 3 Step -1
'Your Code Goes Here...
Next i
Answer
customizing this pseudocode to your specific syntax should work-
if ( i+1 = LastRow)
custom code here...
increment i
Topic 356
Subject
How to increment number in a cell after printing on excel

Question
I was wondering if some one can help me. I need to increment by one a number
in a cell and then clean a few textbox but after the printing. There is an
beforeprint event but doesnt do what I want becuase before the sheet is printed
all the data is cleaned, obviously (I apologize for my english) Is there a way to
do what I need or a better practice for it. Thank you.
Private Sub Workbook_BeforePrint(Cancel As Boolean) [I6] = [I6] + 1
[C11] = ""
[C12] = ""
Range("B16:B27").ClearContents
Range("C16:C27").ClearContents
Range("D16:D27") = ""
Range("H16:H27").ClearContents
End Sub
Answer
To act AFTER printing, you need to print the document via VBA's
ActiveSheet.PrintOut inside of the BeforePrint event and set Cancel to true, so
it doesn't run its own print too.
Private Sub Workbook_BeforePrint(Cancel As Boolean)
Cancel = True
Application.EnableEvents = False
ActiveSheet.PrintOut
Application.EnableEvents = True
[I6] = [I6] + 1
[C11] = ""
[C12] = ""
Range("B16:B27").ClearContents
Range("C16:C27").ClearContents
Range("D16:D27") = ""
Range("H16:H27").ClearContents
End Sub

Topic 357
Subject
How to select the cell when case is true
Question
First off, just starting trying to learn Excel and VBA yesterday....so bear in
mind.
Private Sub CommandButton2_Click()
For a = 1 To myLastRow
Select Case ActiveWorkbook.Sheets("Sheet2").Cells(a, 2).Value 
      Case Is = myOrderNumber 
          ActiveWorkbook.Sheets("Sheet2").Cells(a, 2).Active 
      Case False: MsgBox "False" 
End Select
Next a
End Sub
I want to know which cell or the row of the cell that matches my variable. This
does not do what I want.......
Thanks guys
Answer
Try this
Private Sub CommandButton2_Click()
Dim myLastRow As Long, a As Long, myOrderNumber As Long
myLastRow = 10
For a = 1 To myLastRow
With ActiveWorkbook.Sheets("Sheet2") 
      If .Cells(a, 2).Value = myOrderNumber Then 

          MsgBox "True " & .Cells(a, 2).Row 
      Else 
          Msgbox "False" 
      End If 
End With
Next a
End Sub
Answer
I appreciate you are learning code. But beyond getting the range syntax correct
two better methods (efficiency wise) are shown below
Array
recut
Private Sub CommandButton2_Click()
Dim myLastRow As Long
Dim myOrderNumber As Long
Dim lngCnt As Long
Dim ws As Worksheet
Dim X
myOrderNumber = 2
Set ws = ActiveWorkbook.Sheets("Sheet2")
X = ws.Range(ws.[b1], ws.[b10])
For lngCnt = 1 To UBound(X)
If X(lngCnt, 1) = myOrderNumber Then MsgBox "True " & lngCnt Next
End Sub
Evaluate
From Is it possible to fill an array with row numbers which match a certain
criteria without looping?

myOrderNumber = 2
MsgBox
Join(Filter(Application.Transpose(Application.Evaluate("=IF(B1:B10=" &
myOrderNumber & ",ROW(B1:B10),""x"")")), "x", False), ",")
Answer
For a = 1 To myLastRow
With ActiveWorkbook.Sheets("Sheet2")
If .Cells(a, 2).Value = myOrderNumber Then 
      myRow = .Cells(a, 2).Row 
      MsgBox "True " & myRow 
  Else 
      'MsgBox "False " 
End If
End With
Next a
Topic 358
Subject
Is it possible to only convert the values and format of a Microsoft excel
spreadsheet to a google spreadsheet (so not the formulas)?
Question
I need to convert a Microsoft Excel spreadsheet to a google spreadsheet, but
the Excel sheet is made by linking to external data, which I have no access to.
The values are still visible on the Excel sheet. When I import the Excel sheet
to google drive and convert to a google spreadsheet, all values are '#REF!'
because it can't of course find the source of the data. I can copy/paste the
values from Excel to a new google spreadsheet, but that destroys the
formatting. So is there a way to copy format and values from an Excel sheet to
google spreadsheet, preferably with google apps script so that I can automate
it. (it has to be done on a daily basis) Answer

You should use Excel itself, to replace the formula linked values with plain
values first. You can then import that excel file into google drive if required.
Here's a link from Microsoft showing you how to do it: replace formula with
values
Topic 359
Subject
passing range on another sheet to vlookup
Question
I can't reference a range with a sheet for my function like I can with =vlookup.
This works: =MVLOOKUP(a2,B:C,2,",",", ") This isn't:
=MVLOOKUP(a2,Sheet3!B:C,2,",",", ")
The code:
Public Function MVLookup(Lookup_Values, Table_Array As Range,
Col_Index_Num As Long, Input_Separator As String, Output_Separator As
String) As String
Dim in0, out0, i
in0 = Split(Lookup_Values, Input_Separator) ReDim out0(UBound(in0, 1))
For i = LBound(in0, 1) To UBound(in0, 1)
out0(i) = Application.WorksheetFunction.VLookup(in0(i), Table_Array,
Col_Index_Num, False)
Next i
MVLookup = Join(out0, Output_Separator)
End Function
I don't know basic and I'm not planning to learn it, I rarely even use excel, so
sorry for the lame question. I guess basic is really "basic" it took me 30
minutes to get to this point from the reference(reading included), but other 60
minutes in frustration because the above problem. Help me so I can go back to

my vba free life!
EDIT: Although the code above worked after an excel restart, Jeeped gave me
a safer solution and more universal functionality. Thanks for that.
I was not planning to use it on other than strings but thanks for the addition, I
wrongly assumed there is a check for data type every time and type passed
along in the background and vlookup acting accordingly. I have also learned
how to set default values to function input variables.
See solution.
Thanks again, Jeeped!
Answer
You are confusing 1 with "1" and regardless of your personal distaste for VBA,
I really don't know of any programming language that treats them as identical
values (with the possible exception of a worksheet's COUNTIF function).
Public Function MVLookup(Lookup_Values, table_Array As Range,
col_Index_Num As Long, 
                       Optional InputSeparator As String = ",", 
                       Optional outputSeparator As String = ", ") As String 
Dim in0 As Variant, out0 As Variant, i As Long
in0 = Split(Lookup_Values, Input_Separator) ReDim out0(UBound(in0))
For i = LBound(in0) To UBound(in0) 
      If IsNumeric(in0(i)) Then 
          If Not IsError(Application.Match(Val(in0(i)),
Application.Index(table_Array, 0, 1), 0)) Then 
              out0(i) = Application.VLookup(Val(in0(i)),
tableArray, col_Index_Num, False) 
      Else 
          If Not IsError(Application.Match(in0(i),
Application.Index(table_Array, 0, 1), 0)) Then 
              out0(i) = Application.VLookup(in0(i),

tableArray, col_Index_Num, False) 
      End If 
Next i
MVLookup = Join(out0, output_Separator)
End Function
When you Split a string into a variant array, you end up with an array of string
elements. Granted, they look like numbers but they are not true numbers;
merely textual representational facsimiles of true numbers. The VLOOKUP
function does not treat them as numbers when the first column in your
table_array parameter is filled with true numbers.
The IsNumeric function can reconize a string that looks like a number and then
the Val function can convert that text-that-looks-like-a-number into a true
number.
I've also added a quick check to ensure what you are looking for is actually
there before you attempt to stuff the return value into an array.
Your split strings are one-dimensioned variant arrays. There is no need to
supply the rank in the LBound / UBound functions.
                   Sample data on Sheet3                                  Results from
MVLOOKUP
Answer
This is not a valid range reference ANYWHERE in Excel B:Sheet3!C.
Either use B:C or Sheet3!B:C
Edit. Corrected as per Jeeped's comment.
Topic 360
Subject

Find cells on one sheet and copy the rows to another sheet
Question
I have a sheet called Backlog containing rows and columns of data. I need
code that will search row by row in the 2nd to last column looking for #N/A.
When it finds #N/A it needs to check the last column if it contains a C or not. If
it contains a C then the whole row should be appended to a sheet called
Logoff. If the last column does not contain a C then the whole row should be
appended to a sheet called Denied. The row should be deleted from the
original Backlog sheet once moved to either Logoff or Denied. The code I have
below is not working. After the first For Statement it goes to End Sub, but there
is not any compiling errors.
Private Sub CommandButton2_Click()
Dim IMBacklogSh As Worksheet
Set IMBacklogSh = ThisWorkbook.Worksheets("Backlog") Dim logoffSh As
Worksheet
Set logoffSh = ThisWorkbook.Worksheets("Claims Logged off") Dim deniedsh
As Worksheet
Set deniedsh = ThisWorkbook.Worksheets("Claims Denied")
IMBacklogSh.Select
Dim i As Long
For i = 3 To Cells(Rows.Count, 13).End(xlUp).Row 
      If Cells(i, 13).Value = "#N/A" Then 
          If Cells(i, 14).Value = "C" Then 
          IMBacklogSh.Rows(i).EntireRow.Copy
Destination:=logoffSh.Range("A" & logoffsh.Cells(Rows.Count,
"A").End(xlUp).Row + 1) 
          Else 
          IMBacklogSh.Rows(i).EntireRow.Copy
Destination:=deniedsh.Range("A" & deniedsh.Cells(Rows.Count,
"A").End(xlUp).Row + 1) 
          End If 
      End If 
Next i
End Sub

Answer
Try it as If Cells(i, 13).Text = "#N/A" Then . #N/A is an error code, not a
value; however, the Range.Text property can be examined or the IsError
function could be used to examine the cell's contents for any error.
If Cells(i, 13).Text = "#N/A" Then
'Alternate with IsError
'If IsError(Cells(i, 13)) Then 
      If Cells(i, 14).Value = "C" Then 
          IMBacklogSh.Rows(i).EntireRow.Copy _ 
              Destination:=logoffSh.Range("A" &
logoffsh.Cells(Rows.Count, "A").End(xlUp).Row + 1) 
      Else 
          IMBacklogSh.Rows(i).EntireRow.Copy _ 
              Destination:=deniedsh.Range("A" &
deniedsh.Cells(Rows.Count, "A").End(xlUp).Row + 1) 
      End If 
End If
However, individual cell examination is not necessary and time consuming.
The AutoFilter method can be used to isolate #N/A with C and #N/A with
<>C.
Private Sub CommandButton2_Click()
Dim IMBacklogSh As Worksheet, logoffSh As Worksheet, deniedsh As
Worksheet
Set IMBacklogSh = ThisWorkbook.Worksheets("Backlog") Set logoffSh =
ThisWorkbook.Worksheets("Claims Logged off") Set deniedsh =
ThisWorkbook.Worksheets("Claims Denied")
With IMBacklogSh 
      If .AutoFilterMode Then .AutoFilterMode = False 
      With .Cells(1, 1).CurrentRegion 
          .AutoFilter field:=13, Criteria1:="#N/A" 
          .AutoFilter field:=14, Criteria1:="C" 

          With .Resize(.Rows.Count - 1,
Columns.Count).Offset(1, 0) 
              If CBool(Application.Subtotal(103, .Cells))
Then 
                  .Copy Destination:= _ 
                      logoffSh.Cells(Rows.Count,
"A").End(xlUp).Offset(1, 0) 
                  'optionally delete the originals 
                  .EntireRow.Delete 
              End If 
          End With 
          .AutoFilter field:=14, Criteria1:="<>C" 
          With .Resize(.Rows.Count - 1,
Columns.Count).Offset(1, 0) 
              If CBool(Application.Subtotal(103, .Cells))
Then 
                  .Copy Destination:= _ 
                      deniedsh.Cells(Rows.Count,
"A").End(xlUp).Offset(1, 0) 
                  'optionally delete the originals 
                  .EntireRow.Delete 
              End If 
          End With 
      End With 
      If .AutoFilterMode Then .AutoFilterMode = False 
End With
End Sub
Topic 361
Subject
Display text in cell relative to matching cells in chosen area
Question
This is a problem I have that has been a bother and would be nice if it was
possible. I have a list of numbers (1-58) (A6:A63) and next to them a list of
names (B6:B63) I need a formula that is in cell E4 and looks for cells in range
A6:A63 that match the cell E3, once found it will display what is in the cell
next to the cell that matched E3. I also need this to work from E3:BJ3
The only way I can see would be to use IF function.
=IF(E$3=1,"A",IF(E$3=2,"B",IF(E$3=3,"C",etc))) Is there an easier way? I
have pictures with this here : http://imgur.com/a/nj4h9 Answer

Try this:
E4=INDEX($B$6:$B$63,MATCH(E3,$A$6:$A$63,0))
or this
E4=VLOOKUP(E3,$A$6:$B$63,2,0)
Then copy to E5 and to the right.
Topic 362
Subject
Add a New If Statement within an Existing If Block
Question
I have this code that compares Columns A and B and adds 1 to column B if A
is greater:
Sub test07()
With Sheets("Sheet1")
Dim LastRow As Long, i As Long
LastRow = Cells(Rows.Count, "A").End(xlUp).Row
For i = 12 To LastRow
If Range("A" & i).Value > Range("B" & i).Value Then
Range("B" & i).Value = Range("B" & i).Value + 1
End If
Next i
End With
End Sub

I would like to add the same thing again but with columns C and D, but I am
getting syntax errors, ie:
Sub test07()
With Sheets("Sheet1")
Dim LastRow As Long, i As Long
LastRow = Cells(Rows.Count, "A").End(xlUp).Row
For i = 12 To LastRow
If Range("A" & i).Value > Range("B" & i).Value Then
Range("B" & i).Value = Range("B" & i).Value + 1
If Range("C" & i).Value > Range("D" & i).Value Then
Range("D" & i).Value = Range("D" & i).Value + 1
End If
Next i
End With
End Sub
Can anyone see where I am going wrong? Many thanks Answer
You should also become familiar with ElseIf - ElseIf is the same as doing an
End If followed by a new If statement except that it only runs if the first If
statement resulted in False. ie: assume A1 = 5, and you want to check A1's
value to determine B1's value. You could check values in two ways:
Option 1, using End If followed by a new If statement:
If Range("A1") > 3 Then

B1 = 2
End If
If Range("A1") > 4 Then
B1 = 1
End If 'Because A1 = 5, both If statements are True, and therefore B1 will
equal 1, because that is the last line of code which affects it
Option 2, using ElseIf:
If Range("A1") > 3 Then
B1 = 2
ElseIf Range("A1") > 4 Then
B1 = 1
End If 'Because A1 = 5, the first If statement is True, the ElseIf statement never
runs, and therefore B1 will equal 2, because that is the only line of code which
affects it.
Both methods are valid - you just need to understand the logic pathways that
you are actually after to decide which you want to use.
Answer
As mentioned in the comments, you are missing an End If. However, you are
also not taking full advantage of the explicit parentage that comes with using
the With ... End With statement to identify the worksheet.
Sub test07()
Dim lastRow As Long, i As Long
With Sheets("Sheet1") 
      lastRow = .Cells(Rows.Count, "A").End(xlUp).Row 
      For i = 12 To lastRow 
          If .Range("A" & i).Value > .Range("B" & i).Value
Then 
              .Range("B" & i).Value = .Range("B" & i).Value +
1 

          End If   '<~~might have to be three lines down
depending upon how you want your logic to flow 
          If .Range("C" & i).Value > .Range("D" & i).Value
Then 
              .Range("D" & i).Value = .Range("D" & i).Value +
1 
          End If 
      Next i 
End With
End Sub
Note the use of .Range and .Cells ; not Range and Cells. The prefix period (aka
full stop) associates the ranges and cells with the worksheet referenced in the
With ... End With.
Getting back to the If ... End If issue, if you wish to avoid closing off the If
statements, you can use them like the following.
Sub test07()
Dim lastRow As Long, i As Long
With Sheets("Sheet1") 
      lastRow = .Cells(Rows.Count, "A").End(xlUp).Row 
      For i = 12 To lastRow 
          If .Range("A" & i).Value > .Range("B" & i).Value
Then _ 
              .Range("B" & i).Value = .Range("B" & i).Value +
1 
          If .Range("C" & i).Value > .Range("D" & i).Value
Then _ 
              .Range("D" & i).Value = .Range("D" & i).Value +
1 
      Next i 
End With
End Sub
This method only works with a single relevant code line coming after the If
code line.

Answer
you can simply also copy/paste your code and modify the
Range("A" & i) --> Range("A" & i).Offset(#rows,#cols)
Or even better yet, ditch the "Range" and use "Cells" with two iterators and a
nested FOR loop...
With...
for i in {#rowStart} To {#rowEnd}
for j in {#colstart} To {#Colend}
.Cells(i,j).Value = {put stuff here}
use the Ubound(Range()) to count elements in an array and size up your i & j,
etc....
Topic 363
Subject
Sync Pivot tables - VBA code not working
Question
I am currently working on a dynamic dashboard. I have several pivot tables on
my calculation sheet that are from different sources, but which have same
filtering options (day, agent name, etc.). My overview sheet takes data from
these pivot tables. The idea is that based on few slicers connected to 1 pivot I
can update other pivot tables and manipulate with result on the overview sheet.
I have used the code below to sync filtering options. This code works well,
when I make changes within the sheet where I have pivot tables. However, if I
transform slicers to my overview sheet and try to manipulate with data, only 1
pivot table gets updated on my calc sheet, so there's only half information
appearing right on the overview sheet.
The code is copied on both overview and calc sheets. Please help.

Private Sub Worksheet_PivotTableUpdate(ByVal Target As PivotTable)
Dim wsMain As Worksheet
Dim ws As Worksheet
Dim ptMain As PivotTable
Dim pt As PivotTable
Dim pfMain As PivotField
Dim pf As PivotField
Dim pi As PivotItem
Dim bMI As Boolean
On Error Resume Next
Set wsMain = ActiveSheet
Set ptMain = Target
Application.EnableEvents = False
Application.ScreenUpdating = False
For Each pfMain In ptMain.PageFields
bMI = pfMain.EnableMultiplePageItems For Each ws In
ThisWorkbook.Sheets("CalculationSheet") 
      For Each pt In ws.PivotTables 
          If ws.Name & "" & pt <> wsMain.Name & "" & ptMain
Then 
              pt.ManualUpdate = True 
              Set pf = pt.PivotFields(pfMain.Name) 
                      bMI = pfMain.EnableMultiplePageItems 
                      With pf 
                          .ClearAllFilters 
                          Select Case bMI 
                              Case False 
                                  .CurrentPage =
pfMain.CurrentPage.Value 
                              Case True 
                                  .CurrentPage = "(All)" 
                                  For Each pi In
pfMain.PivotItems 
                                    
.PivotItems(pi.Name).Visible = pi.Visible 
                                  Next pi 

                                  .EnableMultiplePageItems =
bMI 
                          End Select 
                      End With 
                      bMI = False 
              Set pf = Nothing 
              pt.ManualUpdate = False 
          End If 
      Next pt 
Next ws
Next pfMain
Application.EnableEvents = True
Application.ScreenUpdating = True
End Sub
Answer
I believe the problem is this line:
For Each ws In ThisWorkbook.Sheets("CalculationSheet")
That line restricts the code to only considering PivotTables on a sheet called
"CalculationSheet". If you want it to work on ALL sheets in the workbook, then
change it to this:
For Each ws In ThisWorkbook.WorkSheets
...as per the original code listing at
http://blog.contextures.com/archives/2012/01/03/change-all-pivot-tables-with-
one-selection/
Topic 364
Subject
Automatic border colour colour code
Question
What's the color code (ENUM) of the automatic border colour which is 25%
grey? Or at least it's RGB value.

I've been searching for half an hour and couldn't find it anywhere. Here's the
image of the border colour I'm talking about: Answer
Those cells don't have any border and you can Show or hide gridlines on a
worksheet in the Excel settings.
Answer
To change the colour of the gridlines, go into Excel Options, Advanced
(Alt+F,T,A) and scroll down to Display options for this worksheet. You can
toggle gridline display and select a non-standard gridline colour there.
Alternately, you can run this on the Application.ActiveWindow property.
ActiveWindow.GridlineColorIndex = 15 '25% grey
See Window.GridlineColorIndex property.
Topic 365
Subject
data validation for text only in excel
Question
Please suggest me a custom data validation formula which allow text and
space only i.e. true for "John Smith" and "Monty" and false for "12356","45
Smith","John45", "John Smith 5", "78John" etc. Answer
Use this:
=ISNUMBER(SUMPRODUCT(SEARCH("~"&MID(A1,ROW(indirect("1:"
&Len(A1))),1),"abcdefghijk lmnopqrstuvwxyz")))
Topic 366
Subject
VBA to compare columns and fire macro
Question
Hi I have three columns (ABC) with multiple rows.

I need to check if B is greater than C, and if so to add 1 to C and repeat until
the last row. I'm getting a syntax error, any help much apprecicated!
Sub test6()
Dim LastRow As Long, i As Long
LastRow = Cells(Rows.Count, "A").End(xlUp).Row For i = 1 To LastRow
If Range("B" & i).Value > ("C" & i).Value Then Range("C" & i).Value 1
Else: End If
Next i
End Sub
Answer
Delete Else: End If as Scott Craner mentioned in comment and change If
statement:
If Range("B" & i).Value > Range("C" & i).Value Then Range("C" & i).Value =
Range("C" & i).Value + 1
Topic 367
Subject
Compare two ranges: classic range vs range of comma-delimited values in a
single cell
Question
Suppose I've got a range of values:
6 2 4 7 8 7
1 5 1 9 4 6
8 8 1 7 4 2
And separately in a single cell:
"1, 4, 9"
I need to compare these values in a single cell with the given range. In case if
there is a match - type "Yes", if not - "No".
"1, 4, 9" - result: "Yes"

"3, 10, 11" - result: "No"
Here I've got a UDF that simply compares two ordinary ranges and enters
number of times values were matched as a result. Should work as a kind of a
template I suppose.
Public Function Compare(r1 As Range, r2 As Range) As Long Dim r As
Range, v As Variant, v2 As Variant Dim rr As Range
For Each r In r1 
    v = r.Value 
    If v <> 0 And v <> "" Then 
       For Each rr In r2 
          v2 = rr.Value 
          If v = v2 Then Compare = Compare + 1 
       Next rr 
    End If 
Next r
End Function
Answer
I modified the code to split the first cell range:
Public Function Compare(r1 As Range, r2 As Range) As Long Dim r As
Integer, v As Variant, v2 As Variant Dim rr1() As String
Dim rr As Range
rr1 = Split(r1, ",")
For r = LBound(rr1) To UBound(rr1) 
    v = --Trim(rr1(r)) 
    If v <> 0 And v <> "" Then 
       For Each rr In r2 
          v2 = rr.Value 
          If v = v2 Then Compare = Compare + 1 
       Next rr 
    End If 
Next r

End Function
To get the "Yes/No" you would call it like this:
=IF(Compare(A1,$D$1:$D$18)>0,"Yes","No")
Topic 368
Subject
Find '1' in column C, return value from that row in column A
Question
Hi, I'm trying to do some data analysis of some test results. I've got a section of
my spreadsheet which essentially ranks each pupil's performance on that
question.
In cell C57 I want to look for the smallest value in range C40:C55 (e.g. '1') and
return the value from column B which corresponds to that row (in this
example, C51).
Similarly, in C58 I want to find the second lowest value in the C40:C55 range
(e.g '2') and return the corresponding B column value.
If I use VLOOKUP will I have the issue that a) my column with the '1' in is not
the leftmost and, b) that my data are not listed in order?
Also, will I have an issue if there are two '1's in that column? Answer
Here is way to find with respect to the first 1:
=INDEX(A40:A55,MATCH(1,C40:C55,0))
For example:
Topic 369
Subject
Time Chart in Datazen not working properly
Question
I have uploaded an excel to create a dashboard using Datazen.One of my

requirement is to create a time chart. The table looks like this :
http://i.stack.imgur.com/HYmz5.png and my time chart looks like this:
http://i.stack.imgur.com/Twy7y.png that is the date having years 2013,2014 not
shown in the timechart even though the value exists(in first screenshot).Please
help me..
Topic 370
Subject
xlsx.core.min.js:13 Uncaught Error: Unsupported file NaN
Question
I facing a error using alasql with xlsx.core.js. code is
alasql('select * from xlsx("Leads.xlsx")',[],function(data) { console.log(data);
});
error that comes up is.=> Uncaught Error: Unsupported file NaN how can i
resolve this error.
or suggest me any other file from which i can access the data in an excel file.
Library is:
<script type="text/javascript" src="js/alasql.min.js"></script> <script
type="text/javascript" src="js/xlsx.core.min.js"></script>
One important thing, this code was completely run by last night, and when i run
it today, it was giving this error.
Thanks.
don't mind.. i am poor in English. and new to stack overflow.
Topic 371
Subject
How to compare a string within a string list in Excel
Question
There are some food names and prices as you can see between I2 and J22. For
instance AYÇICEK YAĞI(SUNFLOWER OIL IN ENGLISH) is 4$ per kg. In

the left of the sheet, you can see other list. What I need is;
I want to compare all A columns with Strings between I2:I22 and get the
price which is written between J2:J22 then write it to the D columns.
There are more than 500 rows and I need to do it for all rows.
And there are some headings as u can see in bold font, they should be
protected. Answer
You seem to have come up with a formula; now you need a way to dispense it.
Your worksheet design does not lend itself to simply filling down a formula.
However, with the numbers in column C identifying valid entries that require a
formula in columns D and E, a short sub procedure can make quick work of
putting the formulas into the correct places.
Sub fillFormula()
Dim w As Long, vWSs As Variant, vFRMLs As Variant
vWSs = Array("ogle_aksam_gramaj", "kahvalt" & ChrW(305) & "_gramaj",
"araogungramaj")
For w = LBound(vWSs) To UBound(vWSs) 
      With Worksheets(vWSs(w)) 
          With .Columns(3)   '<~~ going to look at column C
for numbers 
              With .SpecialCells(xlCellTypeConstants,
xlNumbers) 
                  .Offset(0, 1).FormulaR1C1 = _ 
                      "=IFERROR(VLOOKUP(RC1, 'urunler'!C1:C2,
2, FALSE), """")" 
                  .Offset(0, 2).FormulaR1C1 = _ 
                      "=IFERROR(RC4*RC3, """")" 
              End With 
          End With 
      End With 
Next w

End Sub
The IFERROR function has been used to 'wrap' the lookup and mulltiplication
formulas. It catches errors and offers alternative results; in this case, zero-
length strings that look blank.
The kahvaltı_gramaj worksheet causes problems in VBA due to the unicode
character. You might try other methods of cycling through the worksheets.
     
That binary (macro-enabled) workbook is available from my own public
dropbox here.
Answer
In the workbook you have attached, VLOOKUP will return #N/A when there is
no available value.
In Sheet ogle_aksam_gramaj Cell D4 use the following Formula:
=SUMIF($I:$I,$A4,$J:$J)
You can then drag it down and it should be giving you the prices based on the
details provided in the same sheet (Range I:J)
The good thing (or bad, depends on you) of sum if is that it will return 0 if
there is nothing to sum. in your sheet, the items must be unique in the list,
otherwise, it will keep summing every instance. So if AYÇICEK YAĞI is there
2 times, it will be summed twice.
You can use Advanced Filter with (unique values only) to make sure that all
the ingredients are accounted for and are mentioned only once.
Thanks.
Topic 372
Subject
offset to anthor column and stop when condition is meet

Question
If I have a dataset is 5x5.
0 0 0 0 0
0 0 0 0 0
0 0 0 0 0
0 0 0 0 0
0 0 0 0 1
I want to move my selection to the cell is 1.
I wrote a macro, but I can only ask it to stop when the cell is 1.
I dont how to tell the excel shift to another row when after 5 column passes.
Can anyone tell me how to do it?
thx.
Sub macro1()
'
Range("A2").Select
Do
ActiveCell.Offset(0, 1).Select
Loop Until ActiveCell.Value = 1
End Sub
Answer
Instead of looping through all the cells, you can Find what you are looking for.
From your code provided, it looks like your data starts at A2.
Sub Find_One()
Dim rng As Range, oC As Range, s As String s = 1 ' this is what you want to
find Set rng = Range("A2:E6")
Set oC = rng.Find(what:=s, lookat:=xlWhole)
If Not oC Is Nothing Then

Cells(oC.Row, oC.Column).Select Else: MsgBox "Not Found"
Exit Sub
End If
End Sub
If "1" is going to show up more than once, then this code would work for you.
Sub Select_1()
Dim FrstRng As Range
Dim UnionRng As Range
Dim c As Range
Set FrstRng = Range("A2:E6")
For Each c In FrstRng.Cells 
      If c = 1 Then 
          If Not UnionRng Is Nothing Then 
              Set UnionRng = Union(UnionRng, c)    'adds to
the range 
          Else 
              Set UnionRng = c 
          End If 
      End If 
Next c
UnionRng.Select
End Sub
Answer
Try this
Sub macro1()
For Each cell In Range("A1:E5")

If cell.Value = 1 Then 
      cell.Select 
      Exit For 
End If
Next cell
End Sub
Topic 373
Subject
Pivot Table: Row Average (Not Sum) of Calculated Field
Question
a bit perplexed with a Pivot Table issue. This should be a (much simplified)
variation on my overall Database: https://goo.gl/UdzNWE
I have a database which contains the ingredients for various recipes as they
were actually prepared. I have 2 different sources of a specific ingredient (in
this example, it's Flour). Sometimes both Flour A and Flour B get used, other
times it's just one or the other. Because my two Flours (A and B) are stored in
separate columns, I have to use a Calculated Field to add them together to
figure out the total amount of flour used.
My Pivot Table Rows are grouped by Recipe, then Batch, then Instance (ie. it
takes 3 Instances of a recipe to make 1 batch of 1 recipe).
I'd like to be able to see Instance averages displayed when the Recipe
groupings are minimized, which works fine on any non-Calculated Field, but
my Calculated field displays as a Sum of all of the Instance values, not an
Average (yes, I have the Value Field Setting as Average). Because I
occasionally use one flour and not the other or both together, the individual
averages for those values are incorrectly weighted, hence the Calculated field.
On every other field, the "Summarize Field as" option can be set to Average,
just not the Calculated Field.
Any help would be appreciated, hope it's a simple fix.

Using Excel 2013.
Topic 374
Subject
Required to Convert Rows Values in Columns, based on ID [duplicate]
Question
This question already has an answer here:
Concatenate cell data into another data if values matches
3 answers
I need to Convert Rows Values in Columns, based on ID. I have bunch of Input
Data and required Output Data as shown in the example below:
Waiting for your solution on priority.
You can provide your solution on in xls of ms-access Answer
Use the transpose function on the cells you want to change
Topic 375
Subject
How to create a new Excel file in TestComplete using DelphiScript?
Question
I am using TestComplete and DelphiScript for Excel automation. I can read an
existing Excel file, but have some issues creating a new Excel file.
What is the way to create a new Excel file?
Topic 376
Subject
Range(Cells(Jour, 13), Cells(Jour, 18)).Interior.Color = 7
Question
I cannot make this line work:
Range(Cells(Jour, 13), Cells(Jour, 18)).Interior.Color = 7

Each time this error message pop-up
Run-time error '1004': Application-defined or object defined error
But This line work:
Range(Cells(Jour, 13), Cells(Jour, 18)).Select
I saw lots of example with Interior.Color = "Whatever" after range.
Why it doesn't work?
Thank you
Answer
Here this should work thanks to @Jeeped for pointing out the error.
Sub color()
Dim Jour As Long
Dim wk As Worksheet
Jour = 1
Set wk = Sheet1 'Change it with your sheet number.
With wk
.Range(.Cells(Jour, 13), .Cells(Jour, 18)).Interior.color = 7 End With
End Sub
Answer
If you set up Jour properly, then this should work.
Sub jour_Jour_Banks()
jour = 1
Range(Cells(jour, 13), Cells(jour, 18)).Interior.Color = 7 End Sub

Topic 377
Subject
Excel 2013 - If cell contains specific text then display named range
Question
Basically what the title says:
SO for example if cell A46 contains the word "Burn" then i would like to
display my named range called "Burn_Treatment" on a separate page.
Any help would be appreciated
Answer
Use following:
=IF(A46="Burn",Burn_Treatment,"")
Topic 378
Subject
Is it Possible to Pop up some data of excel file once Computer is ON, in form
of Notification
Question
Suppose, one Excel file :- abc.xlsx.
In that, Following is the data, I want to Pop Up like notification at right corner
of Computer, When the computer is ON Everyday.
Generally, it tells about Stock of Particular colour on every week. 
        Item S1 S2 S3 S4 S5 
   1.   Red  10  1  1  2  2 
   2. Yellow 15  14  75 14 11 
   3. Purple 15  14  41 41 14 
Main Aim: Instead of open the excel file daily, it should pop up the inside data
on computer.
If it is Possible, then Please help me out or If not, then please suggest some
ideas.

Topic 379
Subject
To find the month corresponding to vnedor name and latest payment
Question
I am having a table for the payments made to different subcontractors and
suppliers in different months and against different invoices. I want to get the
month in a summary sheet for a particular vendor against the latest invoice.
Can anyone give the idea how to get it please? Answer
Consider the following example:
First step would be to sort the data according to the vendor. I have sorted them
according to column A.
Use advanced filter to get the unique values in column F to create your
summary
in column G use the formula =COUNTIF($A:$A,$F2) to get the number of
entries for each invoice.
in column H type the following formula:
=MAX(INDIRECT("C"&ROW(INDEX($A$2:$A$18,MATCH($F2,$A$2:$A$
The formula works as follows:
Sets the range for MAX using INDIRECT
Uses INDEX and ROW inside the INDIRECT formula to find the first row in
the range $A$2:$A$18 that corresponds to the vendor name as a starting point
for the MAX formula. Using the count of the invoice entries in column G you
set the end of MAX formula range.
When you evaluate the formula in cell H2, the end result should be
=MAX($C2:$C5) and this is returned to you as a result.
This works because dates are stored as numbers in excel. If there is more than
one invoice from the same vendor in the same date it will still work.

To show the month, you could format the cell as MMMM YYYY or nest the
formula inside a text formula if the desired output is just a text, something like:
=TEXT(MAX(INDIRECT("C"&ROW(INDEX($A$2:$A$18,MATCH($F2,$A
YYYY")
Implementing it in your workbook should be easy, as long as you sort the entire
table based on the Vendor name.
I hope this helps.
Topic 380
Subject
HLOOK UP SUM with look value refence in text
Question
i want sum with h lookup more than 20 rows without type ,{2,5,9},0)) in the
functions because i have more rows but my look value is reference and is text
`=SUM(HLOOKUP(LookupValue,A1:C10,{2,5,9,10 ,11,12 ,13,,,,101,102},0))
but the values are numbers
Answer
If you want to add up rows 2, 5 and 9 in the table try this: type 2, 5 and 9 in
"some_range"
Then:
=SUM(HLOOKUP(4,$A$1:$C$10,some_range,0)) But save the formula as an
array formula: press CTRL+SHIFT+ENTER instead of just enter
Topic 381
Subject
Count number of rows with conditions met in multiple columns
Question
I can use
=COUNTIFS(range1, criteria1, range2, criteria2…) + COUNTIFS(...) etc
Count number of rows with conditions met in two columns

My data is such that the above will require needing approximately 150+
instances of countifs just for one cell. And I need to do this for 10K or so cells.
So wondering if there is another function/way to do this in a more efficient
manner? Example of data as follows;
1 2 10 6
2 3 9 4
3 4 8 5
7 6 7 2
4 5 1 6
2 1 6 7
5 6 2 8
2 5 3 10
6 7 2 10
And need to count how many times number 2 & 6 occur on the same row.
EDIT: I also need to do this with any number combination. ie 2&6, 1&6, 5&10
etc.
Thanks
Answer
Add a column with a serial no from 1 to n.
Then use a nested if:
SUM(IF(SERIAL_NO = SERIAL NO
IF( IF COLUMN1 =2 AND COLUMN 3 = 6,10))) AS 26
Topic 382
Subject
Excel 2013 - Using multiple Private Sub commands in one worksheet
Question
I use the following code to run one of my macro's depending on the item chosen
in the dropdown field, Below is the code i use:

This works perfectly except i would like to repeat this process again below the
first. It simply pastes information based on the answer in the dropdown field. I
would like to do this again in Cell A136 - any help would be appreciated,
whenever i try i get errors and or it does nothing.
Private Sub Worksheet_Change(ByVal Target As Range) If Not
Intersect(Target, Range("A43")) Is Nothing Then Select Case Range("A43")
Case "Amputation": Amputation
Case "Asthma": Asthma
Case "Burns_No_Smoke_Inhalation_Not_On_Limb":
Burns_No_Smoke_Inhalation_Not_On_Limb Case
"Burns_No_Smoke_Inhalation_On_Limb":
Burns_No_Smoke_Inhalation_On_Limb Case
"Burns_Smoke_Inhalation_Not_On_Limb":
Burns_Smoke_Inhalation_Not_On_Limb Case
"Burns_Smoke_Inhalation_On_Limb": Burns_Smoke_Inhalation_On_Limb
Case "Closed_Fracture": Closed_Fracture Case "CORD": CORD
Case "CPR_Patient_Does_Not_Recover": CPR_Patient_Does_Not_Recover
Case "CPR_Patient_Does_Recover": CPR_Patient_Does_Recover Case
"Dislocation": Dislocation
Case "Hyperthermia": Hyperthermia
Case "Hypothermia": Hypothermia
Case "Open_Fracture_Major_Bleeding": Open_Fracture_Major_Bleeding
Case "Open_Fracture_Minor_Bleeding": Open_Fracture_Minor_Bleeding
Case "Open_Wound_Major_Controlable_Bleeding":
Open_Wound_Major_Controlable_Bleeding Case
"Open_Wound_Minor_Bleeding": Open_Wound_Minor_Bleeding Case
"Open_Wound_Needs_Tourniquet": Open_Wound_Needs_Tourniquet Case
"Spinal_Injury_Conscious_No_KED": Spinal_Injury_Conscious_No_KED
Case "Spinal_Injury_Conscious_With_KED":
Spinal_Injury_Conscious_With_KED Case
"Spinal_Injury_Unconscious_No_KED":
Spinal_Injury_Unconscious_No_KED Case
"Spinal_Injury_Unconscious_With_KED":
Spinal_Injury_Unconscious_With_KED

End Select
End If
End Sub
Answer
You can simplify that code greatly by replacing the whole Select Case
statement with:
Application.Run Range("A43").Value
then your event handler would become:
Private Sub Worksheet_Change(ByVal Target As Range)
If Not Intersect(Target, Range("A43")) Is Nothing Then
Application.Run Range("A43").Value
ElseIf Not Intersect(Target, Range("A136")) Is Nothing Then
Application.Run Range("A136").Value End If
End Sub
For a situation where you needed to do more work than just calling another
macro then you could put the whole Select Case part in a separate function and
pass the relevant cell to it as a Range parameter
Topic 383
Subject
VB.NET GetObject(,“Excel.Application”) fails to get running Excel
Question
I have a single, visible, running instance of Excel 2013. I have already
performed a Quick Repair and an Online Repair, and waited for the Repair to
completely finish.
If I run this VBA from Word, I can get a reference to the running Excel
Application:

Sub WordMacro()
'This works
Dim o As Object
Set o = GetObject(, "Excel.Application") End Sub
But if I run this from Visual Studio 2013 Professional under .NET 4.5, it fails:
Option Strict Off
Module Module1
Sub Main() 
      Dim o As Object 
      'Cannot create ActiveX component. 
      o = GetObject(, "Excel.Application") 
      'But this does create a new, hidden instance 
      o = CreateObject("Excel.Application") 
End Sub
End Module
Is there some security consideration that I'm missing, or do I just need to do a
complete uninstall/reinstall of Office? Answer
In .NET you must run excel.exe before to get instance:
Shell("C:\Program Files (x86)\Microsoft Office\Office14\Excel.exe", _
AppWinStyle.MinimizedFocus) Xc = GetObject(, "Excel.Application")
Topic 384
Subject
Is it possible to reference the numbers in a function/equation?
Question
Example:

=[num1] + [num2] + [num3]
Is it possible to use num# from the equation? I'm trying to separate them.
=1+2+3
to A1 having 1, B1 having 2, etc.
Clearly, if I started from them being separate, I wouldn't have this problem, but
is there a way to do this?
Thank you!
Answer
Are you looking for this?
="="&A1&"+"&B1&"+"&C1
Topic 385
Subject
Excel - compare two columns, if match subtract values of other two columns
from matching rows
Question
I'm trying to compare two columns for identical values in cells. Not all of them
match. For those that match, i.e. cell in col B1 matches a cell in col D2, I
would like to subtract A1-C2. A and B come from one pool of data, and C and
D from another. They should be compared, and values subtracted if the strings
match.
Thank you
Answer
To get a list of matching strings then use this formula. I put it in F1:
=IFERROR(INDEX($D$1:$D$500,AGGREGATE(15,6,ROW($1:$500)/(COU
And copy down as far as you wish. This formula only works if you have 2010
or later.
If you have 2007 or earlier than replace it with this array formula:

=IFERROR(INDEX($D$1:$D$500,SMALL(IF(COUNTIF($B$1:$B$500,$D$
You will need to confirm it with Ctrl-Shift-Enter instead of Enter when leaving
edit mode.
Then in G1 I put:
=IF(F1<>"",SUMIF(B:B,F1,A:A)-SUMIF(D:D,F1,C:C),"")
And copied down the same number of rows.
Answer
Have a look on following formula. It may help you. Formula in E1 cell:
=IF(ISNUMBER(MATCH(D1,$B$1:$B$4,0)),INDIRECT("A"&MATCH(D1,$
C1,"")
Edited after comment.
In case of table with header, use following formula: Its included negative value
which is missing (As my assume)
=IF(ISNUMBER(MATCH([Data4],[Data2],0)),INDIRECT("B"&
(MATCH([Data4],[Data2],0)+ROW($B$3)))-[Data3],[Data3]*(-1))
Topic 386
Subject
Combobox_Change Function in MultiPages in VBA
Question
I have multipage userform. I created a button, when I click to this button it adds
a Combobox and some labels and textbox. Later I need to create a change
funtion for this Combobox. But, I can't use the name of the Combobox.
Private Sub add_ndc_button_Click()
ndc_page_count = Me.ndc_pages.Pages.Count Me.ndc_pages.Pages.Add
("NDC " & ndc_page_count + 1)
Set ndc_no_textbox_pages(ndc_page_count + 1) =

ndc_pages.Pages(ndc_page_count).Controls.Add("Forms.ComboBox.1") With
ndc_no_textbox_pages(ndc_page_count + 1) .Top = firstcy +
space_between_rows .Left = firstcx + space_between_columns .Height =
text_height
.Width = text_width
.RowSource = "=ProductMasterData!F2:F19" End With
End Sub
Then I need to create the following function using the name created with button
click. But, ndc_no_textbox_pages(1)_Change() gives an error.
Public Sub ndc_no_textbox_pages(1)Change() Set SearchRangeNDC =
Worksheets("ProductMasterData").Range("F1:F100") Set FindRowNDC =
SearchRangeNDC.Find(ndcno_textbox.Value, LookIn:=xlValues,
lookat:=xlWhole) If FindRowNDC Is Nothing Then
MsgBox "Please Enter Correct NDC Number or" & vbNewLine & "Select
From Drop Down Menu", vbOKOnly, "Required Field" Else
NDCRow = FindRowNDC.Row
ndc_no_textbox_pages_label(1).Caption =
Worksheets("ProductMasterData").Range("F" & NDCRow) & vbNewLine &
Worksheets("ProductMasterData").Range("N" & NDCRow) End If
End Sub
Topic 387
Subject
issues with calculating Median
Question
Here is my data 
10      A 
12      A 
14      B 
15      B 
15      C 
11      D 
12      D 
10      B 
11      A 

I want to select A and C from Column B and then calculate the median based
on column A.
I have used this function
=MEDIAN(IF(B1:B9="A",B1:B9="C",A1:A9))
But I got a wrong Number. Can we solve this issues? Many thanks for your
help. Answer
Try this, entered as an array formula by holding down ctrl+shift while you hit
Enter
=MEDIAN(IF($B$1:$B$10={"A","C"},$A$1:$A$10))
The IF function returns an array of either the appropriate value in A1:A10, or
FALSE. And the MEDIAN function will ignore the logical values, since they
are produced by a function, and not manually entered.
Here is a screen shot showing the data and the result. You can see the formula
in the formula bar: (Note that the braces {...} around the formula are NOT
added manually. They will be added by Excel when you confirm the formula
with ctrl+shift+enter. With regard to the array constant, however, those braces
you do type in manually.
Answer
Try this aggregate Function:
=AGGREGATE(17,6,$A$1:$A$500/(($B$1:$B$500 = "A")+($B$1:$B$500
= "C")),2)
This is entered as normal formula. It is a non CSE array formula.
Answer
I don't think you can do it all in one equation. I think you need a new column to
create an intermediate value, then solve it.

I put this equation in column C (and dragged it down the column):
=IF(OR(B1="A",B1="B"),A1,"")
And then I tested the values by calculating the Mean (average), Median
(middle number), and Mode (most common value). Because there are 6 values,
Excel takes the middle of the two.
Here are my equations for column F:
=AVERAGE(C1:C9)
=MEDIAN(C1:C9)
=MODE(C1:C19)
Here is the Microsoft link talking about why the "Median" may be a value
between two on the list:
https://support.office.com/en-us/article/MEDIAN-function-D0916313-4753-
414C-8537-CE85BDD967D2
Topic 388
Subject
Convert Excel table to 2d array
Question
I have next Excel table with date in first column and some data in others (B,
C).
1.
2.
And I want to transform it to table like on pic 3:
To do this you need to add up the data from each row and column within an
hour (don't know how to say it right) and multiply by 2400. For example, from
first picture we have (0.0022 + 0.0078 + 0.0021 + 0.0078) * 2400 ≈ 47 —
first element of the table from third picture.

I'm trying to do it with PHPExcel library:
$objPHPExcel = new PHPExcel();
$objPHPExcel = PHPExcel_IOFactory::load("data.xlsx"); $highestRow =
$objPHPExcel->getActiveSheet()->getHighestRow(); $day = 1;
$hour = 1;
$data = array(array());
for ($i = 1; $i < $highestRow + 1; $i++) {
$cell1 = $objPHPExcel->getActiveSheet()->getCellByColumnAndRow(1,
$i)->getValue(); $cell2 = $objPHPExcel->getActiveSheet()-
>getCellByColumnAndRow(2, $i)->getValue(); $data[$day][$hour] += $cell1
+ $cell2; if($i % 2 == 0) { $data[$day][$hour] *= 2400; $hour++; } if($i %
48 == 0) $day++;
if($hour % 24 == 0) $hour = 1;
}
But instead of working code I get errors
Line 22:
$data[$day][$hour] += $cell1 + $cell2;
I think that something with my 2D array and as I can see my array keys is bad
(not 1-24 for hours).
What should be the code to get my data in 2D array like $data[1..29-31][1-24]
or any other? Or may be it is possible to get table from picture #3 some other
way? Answer
As your line number 22 is
$data[$day][$hour] += $cell1 + $cell2;
You are trying to increment $data[$day][$hour] which is not even defined yet.
You need to define it before trying to increment it. I am not sure, it will make
the sheet work like you are expecting. But this will fix the error you are getting.
(Add this before line 22)

if(!isset($data[$day])) {
$data[$day] = array(); //Setting the day which will get the hours in array }
if(!isset($data[$day][$hour])) {
$data[$day][$hour] = 0; //Setting the hours which will contain the incremented
values for each hour. Setting it 0, the next code blocks will increment it. }
Topic 389
Subject
How to change an Excel border through C# WPF
Question
The following code is properly compiled but then no border appears.
Microsoft.Office.Interop.Excel.Application app = new
Microsoft.Office.Interop.Excel.Application(); app.Visible = true;
app.WindowState = XlWindowState.xlMaximized; Workbook wb =
app.Workbooks.Add(XlWBATemplate.xlWBATWorksheet); Worksheet ws =
wb.Worksheets[1];
//BORDERS HERE
ws.Range["A1:C5"].Borders.LineStyle = XlLineStyle.xlContinuous;
ws.Range["A1:C5"].Borders[XlBordersIndex.xlEdgeTop].Weight = 10d;
ws.Range["A1:C5"].Borders.ColorIndex = XlRgbColor.rgbCrimson;
Thank you for any help
Answer
Call the BeginUpdateFormatting method for this range, modify Borders and
call the EndUpdateFormatting method to finalize the modification.
Range range = ws.Range["A1:C5"];
Formatting rangeFormatting = range.BeginUpdateFormatting(); Borders
rangeBorders = rangeFormatting.Borders; rangeBorders.LineStyle =
XlLineStyle.xlContinuous; rangeBorders[XlBordersIndex.xlEdgeTop].Weight
= 10d; rangeBorders.ColorIndex = XlRgbColor.rgbCrimson;
range.EndUpdateFormatting(rangeFormatting);

Topic 390
Subject
Split string by length to Excel
Question
I am currently sending and splitting long lines of data to Excel. Each split
prints in a new row. I want to change this from splitting at a pipe symbol in the
existing data to splitting at a character length of 85, but , there are chances that
at character 85 it may split a word in two. How would I tell it to split further
into the data if is going to split an actual word. I know if at 85 it should also
find a space after. I'm curious on what to add.
// Add Description 
    string DescriptionSplit =
srcAddOnPanel.Controls["txtProductDescAddOn" + AddRow].Text; 
    string[] descriptionParts = DescriptionSplit.Split('|'); 
    int i; 
    for (i = 0; i <= descriptionParts.GetUpperBound(0); i++) 
    { 
        worksheet.Rows[currentRow].Insert();    //applies the
description for the default bundle row 
        worksheet.Rows[currentRow].Font.Bold = false; 
        worksheet.Cells[currentRow, "E"].Value = rowIndent +
descriptionParts[i].Trim(); 
        currentRow++; 
    } 
Answer
You could use this approach (Warning not fully tested)
int x = 85;
int y = 0;
int currentRow = 0;
// Loop until you have at least 85 char to grab while (x + y <
DescriptionSplit.Length) {
// Find the first white space after the 85th char while (x + y <

DescriptionSplit.Length && 
        !char.IsWhiteSpace(DescriptionSplit[x+y])) 
      x++; 
// Grab the substring and pass it to Excel for the currentRow
InsertRowToExcel(DescriptionSplit.Substring(y, x), currentRow);
// Prepare variables for the next loop currentRow++;
y = y + x + 1;
x = 85;
}
// Do not forget the last block
if(y < DescriptionSplit.Length)
InsertRowToExcel(DescriptionSplit.Substring(y), currentRow); ...
void InsertRowToExcel(string toInsert, int currentRow) { 
    worksheet.Rows[currentRow].Insert(); 
    worksheet.Rows[currentRow].Font.Bold = false; 
    worksheet.Cells[currentRow, "E"].Value = rowIndent +
toInsert.Trim(); 
}
Answer
Here's a VBA version that seems to work. As suggested in my comment, it
separates the string by spaces and then tests whether adding a word makes the
length of the current line greater than the maximum (85). As is usual with these
kinds of things getting the last word to populate correctly is hard.
If this works for you it should be simple enough to modify to C#. Let me know
if that's not true:
Sub ParseRows()
Const ROW_LENGTH As Long = 85

Dim Text As String
Dim Words As Variant
Dim RowContent As String
Dim RowNum As Long
Dim i As Long
Text = ActiveCell.Text
Words = Split(Text, " ")
RowNum = 2
For i = LBound(Words) To UBound(Words)
If Len(RowContent & Words(i) & " ") > ROW_LENGTH Then 
      ActiveSheet.Range("A" & RowNum).Value = RowContent 
      RowNum = RowNum + 1 
      If i = UBound(Words) Then 
          RowContent = Words(i) 
      Else 
          RowContent = "" 
      End If 
  Else 
      RowContent = RowContent & Words(i) & " " 
End If
Next i
If RowContent <> "" Then ActiveSheet.Range("A" & RowNum).Value =
RowContent End Sub
Topic 391
Subject
Text entered into Webpage Search Box via Excel VBA is not detected when
clicking Search button
Question
I'm having trouble when trying to click a search button on a webpage via Excel
VBA. Actually, my real issue has to deal with the particular webpage not
seeing that I entered something in the search box. After I click the search button
on the webpage I get the message saying "Provide a number or company name

to search" when there's already something in the search box.
Before the Text is entered into the Search Box:
After the Text is entered into the Search Box & the Search button is clicked:
Here's the portion of the HTML source where the button (and onclick event) is
present. The specific line for the button is <a href="#" class="add-on" data-
bind="click: performSupplierSearch"><i class="icon-search">
<div class="row-fluid"> 
      <div class="span6"> 
          <h4>Search for the supplier you wish to Log in as:
</h4> 
          <span class="helpText-SearchSupplier">Search by
name or number</span> 
      </div> 
</div>
<div class="row-fluid block"> 
      <div class="span4 input-append pull-left"> 
          <input id="supplierSearchTextBox" data-bind="value:
searchQuery, valueUpdate: 'afterkeydown', onEnter:
performSupplierSearch" type="text" class="input-xlarge"
autocomplete="off" placeholder="Search Suppliers" /> 
          <a href="#" class="add-on" data-bind="click:
performSupplierSearch"><i class="icon-search"></i></a> 
      </div> 
</div>
<div class="row-fluid" data-bind="visible: searched() &&
supplierSearchResults().length == 0"> 
      <div class="span12"> 
          <div class="alert "> 
              <strong><i class="icon-warning-sign"></i> 0
results returned </strong> 
          </div> 

      </div> 
</div>
<div class="row-fluid" data-bind="visible: (searchMessage().length > 0)"> 
      <div class="span12"> 
          <div class="alert "> 
              <strong><i class="icon-warning-sign"></i><span
data-bind="text: searchMessage"></span></strong> 
          </div> 
      </div> 
</div>
When I inspect the elements of the HTML and click on the Search button it
invokes y.handle, which I followed to a jquery file and found these two code
snippets that mention said y
(p=y.events)||(p=y.events={})
amidst this function in the jquery file
add:function(n,r,u,f,e){var b,p,k,w,c,l,a,v,h,d,g,y=i._data(n);if(y)
{for(u.handler&&(w=u,u=w.handler,e=w.selector),u.guid||(u.guid=i.guid++),
(p=y.events)||(p=y.events={}),(l=y.handle)||(l=y.handle=function(n){return
typeof i===o||n&&i.event.triggered===n.type?
t:i.event.dispatch.apply(l.elem,arguments)},l.elem=n),r=(r||"").match(s)||
[""],k=r.length;k--;)b=sr.exec(r[k])||[],h=g=b[1],d=
(b[2]||"").split(".").sort(),c=i.event.special[h]||{},h=(e?
c.delegateType:c.bindType)||h,c=i.event.special[h]||
{},a=i.extend({type:h,origType:g,data:f,handler:u,guid:u.guid,selector:e,needsC
(v=p[h])||(v=p[h]=[],v.delegateCount=0,c.setup&&c.setup.call(n,f,d,l)!==!1||
(n.addEventListener?
n.addEventListener(h,l,!1):n.attachEvent&&n.attachEvent("on"+h,l))),c.add&&
(c.add.call(n,a),a.handler.guid||(a.handler.guid=u.guid)),e?
v.splice(v.delegateCount++,0,a):v.push(a),i.event.global[h]=!0;n=null}},remov
I don't know if the jquery code will help at all, but I figure it couldn't hurt to

give as much information as I could to increase the odds of at least one person
being able to help me resolve this.
Here is the portion of my code where I'm attempting to enter the text and click
the button
'Select Search Box
IE.document.GetElementByID("supplierSearchTextBox").Focus
'Fill in Search Box
IE.document.GetElementByID("supplierSearchTextBox").Value = "Test"
delay 3
'Click Search button
Dim searchButton As Object
'6th a tag so index 5
Set searchButton = IE.document.GetElementsByTagName("a")(5)
searchButton.Click
Am I entering the Value in the wrong way/with the wrong method or does it
have something to do with the onclick event that's attached to the search button
that is the problem? How can I get the code to work correctly? Answer
After hours of searching, scouring over each section of code, and much digging
around countless forums I finally found a solution that may help others in the
future. I realized that my issue has to deal with the way the value/textbox
updates (using the valueUpdate: 'afterkeydown', which means the code is
looking for actual keypress events, which is why it wouldn't see the string
when I inserted it into the text field via the vba code. Since I discovered that
.fireEvent() doesn't work on newer versions of Internet Explorer, I felt like all
was lost and that I would have to revert to the unreliable Sendkeys() method
that everyone says to avoid. But, just before I was about to give up for the night
I came across this little gem where user dyanisis2 provides this method after
their long search for the same issue yielded this solution
Set evt = ie.Document.createEvent("keyboardevent")
evt.initEvent "change", True, False PW.all(0).dispatchEvent evt

Replace PW with your object.
Placing this bit of code after entering a value into the field that needs to detect
a keypress will simulate a keypress event, therefore updating the value in the
text field and allowing the code to recognize that there is something in the
field.
Answer
Just want to confirm this worked for me. just replaced PW.all.(0) at the last
line.
IE.Document.forms(0).getElementsByTagName("select")(1).dispatchEvent evt
Topic 392
Subject
Referencing a cell in another sheet based on a formula?
Question
I have a workbook with a few sheets 2 of which are 'Rates Live' and 'Look-
Up'.
'Rates Live' is a copied link from a seperate workbook meant as print-out
calendar.
'Look-Up' has a list of dates.
Cell A2 in 'Look-Up' gives the date of 1/2/16 in general format (42401).
Cell B2 in 'Look-Up' finds the cell address of a matching cell to A2 (42401)
within 'Rates Live'. It uses the forumla:
=CELL("address",INDEX('Rates Live'!A1:A70,MATCH(A2,'Rates
Live'!A1:A70,0)))
The cell address returned is then trimmed down to return a value in C2 'Look-
Up', eg:
$A$6

Within 'Look-Up' there's also a table with 4 columns for different item types
and a total of 29 rows numbered 1-29 (days in February). eg. 
      D         E           F            G           H 
1                 Item a      Item b       Item c      Item d 
2       1 
3       2 
I'm trying to find a formula for E2 that takes the value of cell C2 (eg. $A$6)
and:
1. Changes the column value of the address by the adjacent cell in Column D
(eg. D2 = 1).
2. Changes the row value of the address by the column number of the cell
within the grid
E2:H3
3) Then returns the value of that new cell address within the sheet 'Live Rates'.
So in the example,
Cell C2 returns the cell address of 42401 within 'Live Rates', which is $A$6.
E2 Takes $A$6 and adds both D2 (eg. 1) to the Column (resulting in $B) and
E2's column number within E2:H3 (eg. 1) to the Row (resulting in $7). This
cell address is then found on 'Live Rates' and it's value is displayed within cell
E2.
Is this possible?
Topic 393
Subject
Copy multiple Range from Sheet1 based on a conditionand paste it in
Alongside in Sheet2
Question
I have an issue with my vba code in excel. I am trying to get excel
automatically copy the contents of multiple ranges (B, C, D, F, G) from sheet1
based on a condition to sheet2 as side by side. example how this will look

like:
this is my code which only copy range B to D :
Sub CopyButton()
Dim cell As Range
Dim lastRow As Long, i As Long
lastRow = Range("D" & Rows.Count).End(xlUp).Row i = 5
For Each cell In Sheets(1).Range("D2:D" & lastRow) If cell.Value > 0 Then
r=cell.row
range("B" & r & ":D" & r).Copy Sheets(2).Cells(i, 1) i = i + 1
End If
Next
End Sub
Any help would be appreciated.
Answer
This can easily be accomplished with an AutoFilter method to isolate the rows
and a Union method of the Range.SpecialCells using the xlCellTypeVisible
xlCellType Enumeration option.
Sub xferBCDFG()
With Worksheets("sheet1") 
      If .AutoFilterMode Then .AutoFilterMode = False 
      With .Cells(1, 1).CurrentRegion 
          .AutoFilter field:=4, Criteria1:="<>0" 
          With Union(.Range("B:D"),
.Range("F:G")).SpecialCells(xlCellTypeVisible) 
              .Copy
Destination:=Worksheets("Sheet2").Cells(4, 1) 
          End With 
      End With 
      If .AutoFilterMode Then .AutoFilterMode = False 
End With
End Sub

                    Sample data on Sheet1
                    Results on Sheet2
Topic 394
Subject
IF formula not working - Trying to calculate correct shipping costs on items
(Excel)
Question
I'm having problems trying to do this formula and it just doesn't work. Can
anyone help me?
=IF(JH2="13",CEILING(JD2/0.68+13,0.5)-0.01,""),IF(AND(JH2="6.95",
(JD2/0.68))
<50,CEILING(JD2/0.68+3,0.5)-0.01,CEILING(JD2/0.68+6.95,0.5)-0.01),IF(A
Just a FYI it reads,
IF Freight price is 13 THEN to Divide the Cost price by .68 and ADD the 13.
IF Freight price is 6.95 AND the Cost Price Divide .68 is LESS than $50
THEN add $3.00 ELSE ADD 6.95.
IF M2 (which is Unit of Measurement) has CA AND Column S2 (which is the
category) contains the word "Incontinence" THEN calculate Cost Price Divide
.68 and add 6.95 Regardless.
Everything is rounded up.
But can't get the Damn thing to work.
Answer
First some nagging and whining.
Unreadable source code.
Reference to cells without provided values.
Now the answer (at least a part of it, depending on me missing something

else).
If you start breaking up the formula, you'll notice that the first AND has the
condition of equality first (that's correct) but then you'll see that the second
condition only is a division, whereas the inequality comparison with 50 is put
outside.
I believe that's your error. But that's based on the assumption that I got the
formula correctly.
As a general suggestion for working with complex formulas in Excel, I usually
do a single step at a time (putting the sub-results in separate columns to verify
that they're correct). When done and confirmed, I can merge them into a single
one.
Answer
Try this, it is untested:
=IFERROR(CEILING(IF(JH2=13,JD2/0.68+13,IF(AND(JH2=6.95,JD2/0.68<
Topic 395
Subject
showing data from excel to datagridview using c#
Question
I'm using Excel as a database, I want to show all columns in a DataGridView
using c#, the problem is I have a column which formated as hours (hh:mm) so
when i want to show data in the DataGridView this column appears like this
(30/12/1899 15:20) but all I want is 15:20 excel image
DataGridView image
my code :
OleDbDataAdapter oda = new OleDbDataAdapter(); 
                          DataTable dt = new DataTable(); 
                          cmd.CommandText = "SELECT Inf,
Date,Entrie, Sortie,Coupe,Préparation,Ford,EB,B7,Qualité,

Production, Logistique, Ingenierie, Maintenance, Fournisseurs,
Administration, Motifs, Traitement, Quantité, Commentaire From
[" + sheetName + "] where Matricule =" + textBox4.Text; 
                          cmd.Connection = con; 
                          con.Open(); 
                          oda.SelectCommand = cmd; 
                          oda.Fill(dt); 
                          con.Close(); 
                          dt_All.Merge(dt); 
Answer
After setting the DataTable as the data source for the DataGridView set the
format for that column e.g.
dataGridView1.Columns["YourColumnName"].DefaultCellStyle.Format =
"hh:mm";
Topic 396
Subject
Sum rows in Excel with the same text value until sum of other column = 0
Question
I am trying to sum one column of numbers in Excel where the same text value is
in Column A up until the sum of values in column C = 0. Here is an example: 
   A       B        C          D 
1  Issue   Action quantity      Net 
2  NFLX     Buy       25      some amount 
3  NFLX     Sell     -25      some amount 
4  NFLX     Buy       50      some amount 
5  NFLX     Sell     -25      some amount 
6  NFLX     Sell     -25      some amount 
7  NFLX     Buy       50      some amount 
8  AMZN     Buy       50      some amount 
9  AMZN     Sell     -50      some amount 
What I want to do is sum column D if the value of column A is the same up
until the sum of column C is zero. I know I can use SUMIF to sum column D for
the same values of column A. What I am not sure about is how to include the
condition that the sum of all the values in column C from this row up above =

0. The summing would stop as soon as it reaches 0.
In the example above, it would sum rows 2-3, then rows 4-7, then rows 8-9.
Answer
Put this formula in D2:
=SUMIF($A$2:$A2,A2,$C$2:$C2)
And copy down.
Topic 397
Subject
How to hide gridlines in an excel sheet through C# WPF
Question
Following this
http://www.e-iceblue.com/Tutorials/Spire.XLS/Spire.XLS-Program-
Guide/Worksheet/How-to-hide-or-show-gridlines-on-a-worksheet-in-C.html
to hide gridlines I should do just:
Workbook wb = app.Workbooks.Add(XlWBATemplate.xlWBATWorksheet);
Worksheet ws = wb.Worksheets[1];
ws.GridLinesVisible = false;<----WRONG
but that is wrong.
And also the solution here
How to disable gridlines in Excel using open xml C#?
does not work. So any other method?
thank you in advance.
PAtrick
Answer

With no third party library, using only the simple Excel interop
(Microsoft.Office.Interop.Excel), it should work with this:
Microsoft.Office.Interop.Excel.Application xlApp = new
Microsoft.Office.Interop.Excel.Application();
xlApp.Visible = true;
Workbook wb =
xlApp.Workbooks.Add(XlWBATemplate.xlWBATWorksheet); Worksheet ws =
wb.Worksheets[1];
xlApp.ActiveWindow.DisplayGridlines = false;
Topic 398
Subject
Automating financial table comparisons
Question
I am trying to compare tables that are pulled from FactSet Estimates.
I've set up a button to ask the user for input for a stock ticker.
Sub RoundedRectangle1_Click()
UserValue = InputBox("Which identifier would you like to choose?") Cells(1,
9).Value = UserValue
End Sub
I'm trying to automatically pull the data that I need from the FactSet Estimates
database. There's an option to download tables manually via Excel to an active
worksheet or new worksheet.
However, I want to set up some sort of web / application-scrape such that the
identifier that the user entered will automatically open up that same ticker in
the FactSet workstation and download the respective Excel file into my open
workbook.

I've looked at web-scraping tutorials, but I can't figure out how to web-scrape
from an application such as the FactSet database (if it is even possible).
There is a web based application for FactSet versus the workstation
application itself on my desktop, though there's still a login required.
Topic 399
Subject
Rename Any Kind of File In Specific Part Using Excel Macro
Question
My Question is I have a folder with a name "xyz" somewhere, for example it is
on desktop and there are 2 excel files namely a,b in that xyz folder. I work in
excel workbook "a" which consist of two names i,j in some cell values for
example i is in cellA1, j is in A2.
Now I want to rename excel files a,b with i,j with of without opening or
closing files after renaming. It is possible. If possible please post me the code.
I have no code....please provide from scratch Answer
I think you will find the answer by a simple search of previous questions. I
easily found this which should get you on the right path: Renaming files with
vba
Topic 400
Subject
How to read xlsx files in Java 1.4?
Question
I am looking for a way to read xlsx file using java 1.4, since my system java
jdk can't be upgraded. I have tried several alternatives, but the libraries that I
have found only support xls. Is there a library that works with jdk 1.4 and
reads xlsx files with high performance? Answer
Your best shot would be https://en.osdn.jp/projects/poi-jdk14/releases/ (from
Workarounds for using apache poi 3.9 with JDK 4) but I make no guarantees as
to how well the port went, what bugs it introduced (and it will have introduced
some!), and how well it performs, or even if it's actually what it says it is.

Given that Java 5 was released in 2004, Java 6 in 2006, and Java 1.4 was
officially EOL'd in 2008, I think you're out of luck. You'd have to back-port
Apache POI to 1.4 (which is what you'll find at the above link), or write the
code yourself, neither of which is likely to be a lot of fun.
Topic 401
Subject
Evaluate a Range and Write in Another Column Based on a Row Entry
Question
I want to look in a range and find flag certain values, then populate the same
row in another column based on those values.
Column 1 Column 2
Code1
Code10
If I specify Code1 in the macro, I want to populate column 2.
I have the following code. I get a runtime error. How can I avoid a runtime
error.
Sub Test()
With Sheets("Sheet1")
Set r = .Range("A:A").Find(what:="Old", LookIn:=xlValues) Dim rownum As
Long
rownum = r.Row
Dim rownum2 As Long
rownum2 = rownum - 1
With Sheets("Sheet1") 
      Set r2 = .Range("C6:C" & rownum2) 
      Dim cell As Variant 
      For Each cell In r2 
         If Cells.Value = ("Code1" Or "Code2" Or "Code3" Or
"Code4") Then 

              .Select 
              .Offset(0, 7).Value = "Special" 
          End If 
      Next cell 
End With
End With
End Sub
Answer
I cleaned it up a little:
Sub Test()
Dim r2 As Range
Dim rownum2 As Long
Dim cell As Range
With Sheets("Sheet1")
rownum2 = .Range("A:A").Find(what:="Old", LookIn:=xlValues).Row - 1 Set
r2 = .Range("C6:C" & rownum2)
End With
For Each cell In r2
If cell.Value = "Code1" Or cell.Value = "Code2" Or cell.Value = "Code3" Or
cell.Value = "Code4" Then
cell.Offset(0, 7).Value = "Special" End If
Next cell
End Sub
The main issue was the If statement. See above for the proper method of using
the Or statement.
Topic 402

Subject
Imported Excel sheet not sorted normally
Question
Below code to import data from excel sheet to ASP.Net web page and saving it
at SQL server in my database.
When I import data from required sheet not imported by it's default sorting in
ASP web page or database, and it is affect badly on the final result and lose
data too. For more clarification if first row in excel sheet having first ID is '1' ,
Activities is "New Installation" and so on...in the ASP web page and SQL
Database may appear in ninth row and without full data
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.IO;
using System.Data;
using System.Data.OleDb;
namespace ImpExpExc
{
public partial class Default : System.Web.UI.Page { 
      protected void Page_Load(object sender, EventArgs e) 
      { 
          if (!IsPostBack) 
          { 
              PopulateData(); 

              lblMessage.Text = "Current Database Data!"; 
          } 
      } 
      private void PopulateData() 
      { 
          using (TEDataEntities dc = new TEDataEntities()) 
          { 
              gvData.DataSource =
dc.ImportExportExcels.ToList(); 
              gvData.DataBind(); 
          } 
      } 
      protected void btnImport_Click(object sender, EventArgs
e) 
      { 
          if (FileUpload1.PostedFile.ContentType ==
"application/vnd.ms-excel" || 
              FileUpload1.PostedFile.ContentType ==
"application/vnd.openxmlformats-
officedocument.spreadsheetml.sheet") 
          { 
              try 
              { 
                  string fileName =
Path.Combine(Server.MapPath("~/ImportDocument"),
Guid.NewGuid().ToString() +
Path.GetExtension(FileUpload1.PostedFile.FileName)); 
                  FileUpload1.PostedFile.SaveAs(fileName); 
                  string conString = ""; 
                  string ext =
Path.GetExtension(FileUpload1.PostedFile.FileName); 
                  if (ext.ToLower() == ".xls") 
                  { 
                      conString =
"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + fileName +
";Extended Properties=\"Excel 8.0;HDR=Yes;IMEX=2\""; 
                  } 
                  else if (ext.ToLower() == ".xlsx") 
                  { 
                      conString =
"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + fileName +
";Extended Properties=\"Excel 12.0;HDR=Yes;IMEX=2\""; 
                  } 
                  string query = "Select [ID], [Activities],

[Governorate], [Exchange], [Client], [Technician],
[CircuitNo], [Comment], [Date] from [Sheet1$]"; 
                  OleDbConnection con = new
OleDbConnection(conString); 
                  if (con.State ==
System.Data.ConnectionState.Closed) 
                  { 
                      con.Open(); 
                  } 
                  OleDbCommand cmd = new OleDbCommand(query,
con); 
                  OleDbDataAdapter da = new
OleDbDataAdapter(cmd); 
                  DataSet ds = new DataSet(); 
                  da.Fill(ds); 
                  da.Dispose(); 
                  con.Close(); 
                  con.Dispose(); 
                  //Import to Database 
                  using (TEDataEntities dc = new
TEDataEntities()) 
                  { 
                      foreach (DataRow dr in
ds.Tables[0].Rows) 
                      { 
                          string empID = dr["ID"].ToString();
                          var v =
dc.ImportExportExcels.Where(a =>
a.ID.Equals(empID)).FirstOrDefault(); 
                          if (v != null) 
                          { 
                              //Update here 
                              v.Activities =
dr["Activities"].ToString(); 
                              v.Governorate =
dr["Governorate"].ToString(); 
                              v.Exchange =
dr["Exchange"].ToString(); 
                              v.Client =
dr["Client"].ToString(); 
                              v.Technician =
dr["Technician"].ToString(); 
                              v.CircuitNo =
dr["CircuitNo"].ToString(); 
                              v.Comment =
dr["Comment"].ToString(); 

                              v.Date = dr["Date"].ToString();
                          } 
                          else 
                          { 
                              //Insert here 
                            
dc.ImportExportExcels.AddObject(new ImportExportExcel 
                              { 
                                  ID = dr["ID"].ToString(), 
                                  Activities =
dr["Activities"].ToString(), 
                                  Exchange =
dr["Exchange"].ToString(), 
                                  Client =
dr["Client"].ToString(), 
                                  Technician =
dr["Technician"].ToString(), 
                                  CircuitNo =
dr["CircuitNo"].ToString(), 
                                  Comment =
dr["Comment"].ToString(), 
                                  Date =
dr["Date"].ToString() 
                              }); 
                          } 
                      } 
                      dc.SaveChanges(); 
                  } 
                  PopulateData(); 
                  lblMessage.Text = "Successfully data import
done!"; 
              } 
              catch (Exception) 
              { 
                  throw; 
              } 
          } 
      } 
}
}
Answer

Finally issue of sorting solved by adding additional column with incremental
ID in database but still some of cells which is related to date is empty
Topic 403
Subject
custom data validation in excel for alpha-numeric-alpha value
Question
I want to force users to enter data in a specific cell in a sequence like
ABCDE1234F i.e. first five characters must me letters then four digits and last
must be a letter using custom data validation. Please help. Answer
It is quite long:
=AND(ISNUMBER(SUMPRODUCT(SEARCH("~"&MID(A1,ROW($1:$5),1)
It goes through each of the required text characters and checks if it is a number
or a string. Then it test the full range of numbers for text. It also ensures that it
is ten characters long.
Answer
You may try following formula
=AND(ISTEXT(LEFT(A1,5)),ISNUMBER(MID(A1,6,4)*1),ISTEXT(MID(A1
Topic 404
Subject
C# How do I read Excel cell XML values with character level formatting?
(Multiple <t> elements within <si>)
Question
I am working on a small application that will read the contents of an excel
worksheet and import all the data as strings into a windows form
datagridview.
I have successfully implemented Dietmar Schoder's code example to do this.
Special thanks to him for posting it.

http://www.codeproject.com/Tips/801032/Csharp-How-To-Read-xlsx-Excel-
File-With-Lines-of?
fid=1864959&df=10000&mpp=50&sort=Position&spc=Relaxed&tid=5149734
I am new to XML and have been stuck on this problem for a while now.
The cells with "character level" formatting contain two or more separate <t>
text values within the <si> xml element.
Here is a snippet from the excel file's sharedstrings.xml file
<si>
<r> 
    <rPr> 
      <b/> 
      <sz val="12"/> 
      <color rgb="FFFF0000"/> 
      <rFont val="Arial"/> 
      <family val="2"/> 
    </rPr> 
    <t>Text A</t> 
</r>
<r> 
    <rPr> 
      <b/> 
      <sz val="12"/> 
      <color theme="1"/> 
      <rFont val="Arial"/> 
      <family val="2"/> 
    </rPr> 
    <t xml:space="preserve"> Text B</t> 
</r>
</si>
This cell contains the text "Text A Text B" but returns null because the cell has

character level formatting and therefore two <t> tags. "Text A" has strike-
through, colored differently or bold etc and "Text B" doesn't.
The text values are assigned with the following line of code.
Text = Workbook.SharedStrings.si[Convert.ToInt32(_value)].t;
Is there anyway to concatenate the strings from both <t> elements before
assigning it to the Text variable?
Edit: I think I have no narrowed the problem down to the sharedstrings.cs file
and the deserialization of the sharedstrings.xml
SharedStrings = DeserializedZipEntry<sst>(GetZipArchiveEntry(zipArchive,
@"xl/sharedStrings.xml"));
sst class:
[Serializable()]
[XmlType(Namespace =
"http://schemas.openxmlformats.org/spreadsheetml/2006/main")]
[XmlRoot("sst", Namespace =
"http://schemas.openxmlformats.org/spreadsheetml/2006/main")]
public class sst
{
[XmlAttribute]
public string uniqueCount;
[XmlAttribute]
public string count;
[XmlElement("si")]
public SharedString[] si;
public sst() { }
}

public class SharedString
{
public string t;
}
I have been unable to edit this class in a way that will correctly interpret both t
elements text values. Answer
Solved this one myself after studying more about xml serialization and many
other similar questions to this one on here.
sst class:
public class sst
{
[XmlAttribute]
public string uniqueCount;
[XmlAttribute]
public string count;
[XmlElement("si")]
public SharedString[] si;
public sst() { }
}
public class SharedString
{
public string t;
[XmlElement("r")]
public NestedString[] ns;
public SharedString() { }

}
public class NestedString
{
public string t;
}
And the assignment of cell's text:
if (Workbook.SharedStrings.si[Convert.ToInt32(_value)].t != null) {
Text = Workbook.SharedStrings.si[Convert.ToInt32(_value)].t; }
else if (Workbook.SharedStrings.si[Convert.ToInt32(_value)].ns != null) {
for (int i = 0; i <
Workbook.SharedStrings.si[Convert.ToInt32(_value)].ns.Length; i++) {
Text += Workbook.SharedStrings.si[Convert.ToInt32(_value)].ns[i].t; }
}
Topic 405
Subject
How do I focus on an input inside a table cell?
Question
I have inputs inside my table cells
<td alt="" class="timesheet-highlight"><input type="text" id="C6R1"
name="C6R1" size="7" value="0.00" class="form-control"></td>
When I tab onto the table cell it applied the class timesheet-highlight. What I
am having trouble figuring out is how to focus the input that is inside the cell.
There are multiple inputs in the table and the ID's are generated dynamically so
there is no way to know what it will be. Some cells may not have any inputs.
I can fire an event when I tab onto the cell with this
.on('key-focus', function (e, datatable, cell) {

if ($('td').hasClass('timesheet-highlight')) {
alert('hi');
}
});
I am using Datatables and this is my full code to generate said table:
$(document).ready(function () { 
      var grid = $('#tblTimeSheet').DataTable({ 
          "scrollY": "567px", 
          "paging": false, 
          "sScrollX": "100%", 
          keys: { 
              className: 'timesheet-highlight' 
          } 
      }); 
      grid 
      .on('key-focus', function (e, datatable, cell) { 
          if ($('td').hasClass('timesheet-highlight')) { 
              alert('hi'); 
          } 
      }); 
      /.on('key-blur', function (e, datatable, cell) { 
          $('#details').html('No cell selected'); 
      });/ 
});
Answer
The .on('key-focus'.... function has the cell parameter which is the cell on
which the focus is currently on.
by invoking cell.node() you get the 'td' element So if I understand you correctly,
what you want is this:
.on('key-focus', function (e, datatable, cell) {
var inputFieldInSelectedTd = $(cell.node()).find('input'); if

(inputFieldInSelectedTd) {
inputFieldInSelectedTd.focus();
}
});
Topic 406
Subject
Error handling for merging cells in Excel VBA
Question
I'm currently developing an add-in for Excel which will automatically format a
table. The users has to follow the specific format when preparing the table, or
else the common error of "Merging cells only keeps the upper-left cell value,
and discards the other values." is bound to appear.
I would like to mute this alert from Excel, but would still like to catch this
error and pass a different message to the users to terminate this sub. I've tried
this:
Sub FormatTable()
On Error Goto ErrHandler
Application.DisplayAlerts = False
'Codes for formatting the table
Exit Sub
ErrHandler:
MsgBox "Incorrect formatting. Terminating process to conserve data." End Sub
However, I do realise that using "Application.DisplayAlerts = False" will
cause Excel to choose the default action and proceed to merge the cells which
causes a big mess. It will not go the ErrHandler. Is there some way for making
this happen? Thank you. Answer
You could test for merged cells in the selected range prior to running your
code:

Public Function HasMergedCells(oRng As Range)
Dim oCell As Range
Dim oArea As Range
For Each oArea In oRng.Areas 
      For Each oCell In oArea.Cells 
          If oCell.MergeArea.MergeCells Then 
              HasMergedCells = True 
              Exit Function 
          End If 
      Next 
Next
End Function
Topic 407
Subject
Check if row is within a certain Time Limit
Question
This is a Macro that checks if rows are older than 30 mins of NOW and clears
them if they are not. I am trying to change:
Loop Until > Lastrow
to instead loop only until it reaches the first row within 30 mins of Now (to
reduce the amount of computation as the machine is struggling). I've tried
variations on:
Loop Until .Cells(i, "A") > TimeLimit
But without luck. Any help much appreciated! Context:
Lastrow = Range("A1").SpecialCells(xlCellTypeLastCell).row
With ws1
i = 1

TimeLimit = Time - TimeSerial(0, 30, 0)
Do 
              If .Cells(i, "A") < TimeLimit Then 
                 .Cells(i, "A").EntireRow.ClearContents 
              End If 
          i = i + 1 
      Loop Until i > Lastrow 
End With
End Sub
Here's the timer code it needs to go into:
Sub Update()
With Sheets("DATA") 
      rw = .Cells(.rows.Count, 1).End(xlUp).row + 1 
      .Range(.Cells(rw, 1), .Cells(rw, 6342)).value =
Sheets("DATA").Range("A7:IJZ7").value 
End With
Application.OnTime Now + TimeSerial(0, 0, 1), "update"
End Sub
Answer
Try this:
Option Explicit
Sub Clear()
Dim wb As Workbook
Dim ws1 As Worksheet
Dim Lastrow As Long

Dim i As Long
Dim TimeLimit As Date, ChkTIme As Date
Set wb = ThisWorkbook
Set ws1 = wb.Sheets("Sheet1")
Lastrow = ws1.Cells(Rows.Count, 1).End(xlUp).Row
TimeLimit = Time - TimeSerial(0, 30, 0) For i = 10 To Lastrow 'Since your
data starts from row 10 ChkTIme = CDate(ws1.Range("A" & i).Value) 
   If ChkTIme < TimeLimit Then 
             ws1.Rows(i).EntireRow.ClearContents 
   Else: End If 
Next i
End Sub
Also formatting col A to Time format will be good.
Topic 408
Subject
Excel UDF with ParamArray constraint like SUMIFS
Question
I am trying to code an Excel UDF with a similar syntax to the builtin SUMIFS,
that is with a signature like
Function myUDF(param1 As Type1, ParamArray paramRest() As Variant) As
MyType
but the condition that the ParamArray must have an even number of elements
(ideally even Typed). Is this at all possible?
For example if you try to enter =SUMIFS(A:A,B:B,1,C:C) into a cell, Excel
will complain about using the wrong number of arguments (because the
ParamArray would be Array(Range("B:B"),1,Range("C:C")) and thus have an
odd number of elements). I want the same behaviour for myUDF.

Currently I handle it after the fact:
If UBound(paramRest) Mod 2 <> 1 Then
myUDF = CVErr(xlErrValue)
Exit Function
End If
But that feels "dirty".
Topic 409
Subject
How to calculate the average for every 7 colums with a formula?
Question
I want a formula that would calculate the average for the data in a row, but for
every 7 columns. So for example =AVERAGE(E25:K25) and then the formula
to calculate the next seven =AVERAGE(L25:R25) and then the next seven =
AVERAGE(R25:X25). How can I do that?
Topic 410
Subject
PHPExcel, Copy sheet from one to another xls document with style
Question
I need to create an xls file using lists of other files
I do something like this:
$objReader = PHPExcel_IOFactory::createReader('Excel5'); $file_tmpl =
$objReader->load('doc10.xls');
$file_tmpl - the resulting file
$file1 = $objReader->load('doc11.xls');
$file1 - file that is copied sheet
$file1->setActiveSheetIndex(1);

$sheet = $file1->getActiveSheet();
$file_tmpl->addSheet($sheet,1);
As a result, the sheet is copied, except for the style of the cell: the borders,
fonts, text size, text color. How to move all together with style?
Thank you.
Answer
There is a method built into PHPExcel for this: addExternalSheet() which
copies the styling as well as the content from one workbook to another.
There is a script (43mergeWorkbooks.php) to demonstrate its use in the
/Examples folder of PHPExcel
Topic 411
Subject
Interior.Color Property inverts colors?
Question
I have written a piece of code that allows me to retrieve the shading color of a
specific cell inside a sheet of an excel workbook. I have successfully retrieved
the RGB integer value by starting a COM server using MATLAB's actxserver,
and then accessing the Color Property of the Interior Object of that particular
Cell Object. Then I obtain the equivalent RGB triplet of that integer, so I can
use it later for plotting in MATLAB.
In order to test that my code works properly I designed the following test: I
created an Excel workbook called colorTest.xlsx with 8 different colors:
Then I run my MATLAB code, which extracts the color information on each
cell of the B column. I should get a plot with the colors on the same vertical
order and a table with the int value and the RGB triplet of each color.
However something unexpected happens! Look at the results:
Notice that the integer value that is obtained from the Color Property does not
always match the color of the original cell, for black, white, green and magenta

the integer values are correct, but this is not true for all the other colors. You
can see, for example, that for red color on the Excel, the output int and RGB
triplet correspond to blue color.
I have added the following table with the correct results I should get, for
reference: 
Color        Int         R G B 
--------     --------    ----- 
Black               0    0 0 0 
White        16777215    1 1 1 
Red          16711680    1 0 0 
Green           65280    0 1 0 
Blue              255    0 0 1 
Cyan            65535    0 1 1 
Magenta      16711935    1 0 1 
Yellow       16776960    1 1 0 
I obtained the correct integer values for each color using this RGB Int
Calculator.
If we compare the two tables, we can deduce that the Red and Blue channels
are inverted.
The code:
The function that I execute to run the test is called getCellColor. Have a look at
the code:
function getCellColor()
clear all;
clc;
% Excel
filename = 'colorTest.xlsx';
% Start Excel as ActiveX server process on local host Excel =
actxserver('Excel.Application');
% Handle requested Excel workbook filename path = validpath(filename);

% Cleanup tasks upon function completion cleanUp =
onCleanup(@()xlsCleanup(Excel, path));
% Open Excel workbook.
readOnly = true;
[~, workbookHandle] = openExcelWorkbook (Excel, path, readOnly);
% Initialise worksheets object
workSheets = workbookHandle.Worksheets;
% Get the sheet object (sheet #1)
sheet = get(workSheets,'item',1);
% Print table headers
fprintf('Color \t Int \t R G B\n'); fprintf('--------\t --------\t -----\n');
% Create figure
figure;
hold on;
% Loop through every color on the Excel file for row = 1:8
% Get the cell object with name of color cell = get(sheet, 'Cells', row, 1);
cName = cell.value;
% Get the cell object with colored background cell = get(sheet, 'Cells', row,
2);
% Get the interior object
interior = cell.Interior;
% Get the color integer property
cInt = get(interior, 'Color'); % <-- Pay special attention here(*)
% Get the RGB triplet from its integer value cRGB = int2rgb(cInt);
% Plot the color
patch([0 0 1 1], [8-row 9-row 9-row 8-row], cRGB);

% Print row with color data
fprintf('%-8s\t %8d\t %d %d %d\n', cName, cInt, cRGB); end
% Turn off axes
set(findobj(gcf, 'type','axes'), 'Visible','off')
end
(*) This instruction is responsible of recovering the color integer.
Note: The functions described next, do not cause the problem since they do not
take part in the obtaining of the color integer (they are only used for secondary
tasks). I have included this information only for completeness.
During this process I use three private functions from the MATLAB's iofun
folder, which are: validpath, xlsCleanup and openExcelWorkbook. I simply
copied them into a folder called private inside the project folder.
Finally, to obtain the RGB triplet from the color integer, I use a function which
I adapted from this other function that I found on the net.
Here is the code for my int2rgb function:
function[RGB] = int2rgb(colorInt)
% Returns RGB triplet of an RGB integer.
if colorInt > 16777215 || colorInt < 0
error ('Invalid int value. Valid range: 0 <= value <= 16777215') end
R = floor(colorInt / (256256));
G = floor((colorInt - R256256)/256);
B = colorInt - R256256 - G256;
RGB = [R, G, B]/255;
end
I am trying to make some sense out of this, but I really have no idea of what is
happening. I have done some research, without much luck, but this post and this
other post caught my attention. Maybe it has something to do with my problem.

So does the Interior.Color Property really inverts colors?
If this is the case, should I consider this as normal behavior or is this a bug?
Link to download:
I have packed the entire project on a .zip file and uploaded it, so you can run
this test on your machine straight away. Download the file and unpack.
getCellColor.zip
Answer
There is no "right" or "wrong" here, Matlab and Excel just encode color
differently. You need to account for that in your code.
The closest I can find to an official source is this MSDN article, about half
way down see the example of encoding of "blue"
MSDN article
The following examples set the interior of a selection of cells to the color blue.
Selection.Interior.Color = 16711680
Selection.Interior.Color = &HFF0000
Selection.Interior.Color = &O77600000 Selection.Interior.Color = RGB(0, 0,
255)
Answer
My first thought is check the channels order RGB vs. BGR.
You could probably simplify that int2rgb function by using typecast instead.
Here's an example using the values you posted:
clrs = [0; 16777215; 16711680; 65280; 255; 65535; 16711935; 16776960] for
i=1:numel(clrs)
bgra = typecast(int32(clrs(i)), 'uint8') end
The output:

clrs =
0
16777215
16711680 
     65280 
       255 
     65535 
16711935
16776960
bgra =
0 0 0 0
bgra =
255 255 255 0
bgra =
0 0 255 0
bgra =
0 255 0 0
bgra =
255 0 0 0
bgra =
255 255 0 0
bgra =
255 0 255 0
bgra =
0 255 255 0
Answer
Your int2rgb method inverts R and B. Replace them and you'll get the right
conversion. The Interior.Color property uses the convention where R is the

least significant, while the FileExchange function you used uses the opposite
convention.
To convert from int to RGB:
B = floor(colorInt / (256256));
G = floor((colorInt - B256256)/256);
R = colorInt - B256256 - G256;
colorRGB = [R G B];
To convert from RGB to int:
colorInt = colorRGB [1 256 256256]';
Answer
From the MSDN article on RGB Color Model:
The RGB color model is used for specifying colors. This model specifies the
intensity of red, green, and blue on a scale of 0 to 255, with 0 (zero) indicating
the minimum intensity. The settings of the three colors are converted to a single
integer value by using this
formula
RGB value = Red + (Green256) + (Blue256*256)
As it was suggested in chris neilsen answer, there is no "right" or "wrong" in
terms of color encoding. Microsoft has chosen this particular way to encode
colors for reasons only they know, and I should stick to it.
So the RGB values that I get are totally correct.
In the following table, I have included the RGB values provided in the MSDN
article next to the ones that I get in MATLAB, and they are a perfect match. 
Color        Int         RGB values from MSDN 
--------     --------    -------- 
Black               0           0 
White        16777215    16777215 

Red               255         255 
Green           65280       65280 
Blue         16711680    16711680 
Cyan         16776960    16776960 
Magenta      16711935    16711935 
Yellow          65535       65535 
Topic 412
Subject
Excel - Negative numbers to zero
Question
I have a cell with a negative number, but I want to put 0 instead of negative
number. How can I make this? Any help? Answer
if you write =MAX(0;your formula)
Answer
You can also use
=IF(A1<0,0,A1)
Topic 413
Subject
How do I keep the trailing zero (or zeros) when I round with Excel VBA?
Question
The title says it all. Consider the following example:
Option Explicit
Sub RoundToDecimalsDefinedByEndUser()
Dim DecimNum As Integer
DecimNum = InputBox("How many decimals do you want?", "Enter") Cells(1,
1).Value = Application.WorksheetFunction.Round(Cells(1, 1).Value,
DecimNum) End Sub

Consider a situation where the end user wants to have 2 decimals, and the
number to be rounded is 0.10111. The result should be 0.10, but Excel forces
the result to be 0.1. Any suggestions on how to keep the trailing zero(s)?
Answer
Consider
Option Explicit
Sub RoundToDecimalsDefinedByEndUser()
Dim DecimNum As Double, wf As WorksheetFunction Set wf =
Application.WorksheetFunction DecimNum = InputBox("How many decimals
do you want?", "Enter") With Cells(1, 1) 
    .Value = wf.Round(.Value, DecimNum) 
    .NumberFormat = "0." & wf.Rept("0", DecimNum) 
End With
End Sub
This will leave A1 as a numeric value.
Answer
Below the line of code cells(1,1).value... you could add some more code
based on:
cells(1,1).numberformat...
The number format you use would be #,0.0000000 - somehow you need to
adjust the number of zeros to equal DecimNum
dim x as integer
dim numForm as string: numForm = "#,0." for x = 0 to decimNum
numForm = numForm & "0"
next x

(not tested as I do not have Excel on this machine)
Topic 414
Subject
Dynamically combine data spread through multiple sheets on one sheet
Question
I have been trying to figure it out all morning but no success so far. I have an
excel file where multiple product performances recorded on multiple sheets
(one sheet for each product). Its recorded on a daily basis, meaning that
another entry recorded for each product everyday. I want to combine all this
data on one sheet to run some analysis regularly. I tried combining the data
using the pivot table, but it ended up adding values up for each day, giving me
the total only. I have no idea how to get this done, please help.
Thank you
Common fields on each sheet.
Date Country City Price Open High Low Vol. Change %
Topic 415
Subject
excel date format not inserting in mysql
Question
in my project i inserted data using excel sheet but i can't inserted date format
data to mysql. here's my code. i have given full code for better understanding.
dob and join_date are in date formate.
<?php session_start();
if(!isset($_SESSION['userId']))
header('location:../../');
else {
if((!isset($_POST['streamId']) || $_POST['streamId'] =='') ||
(!isset($_POST['branchId']) || $_POST['branchId'] =='') ||

(!isset($_POST['batchId']) || $_POST['batchId'] =='') ||
(!isset($_POST['divisionId']) || $_POST['divisionId'] =='') ||
(!isset($_POST['semId']) || $_POST['semId'] =='')) {
header('location:../../views/student/list.php'); }
$tmp = explode(".", $FILES["studnetExcel"]["name"]); if((strcmp($tmp[1],
'xls')!=0) && (strcmp($tmp[1], 'xlsx')!=0)) {
echo "string";
}
else { 
      requireonce('../../config/connection.php'); 
      $streamResult = mysql_query("SELECT * FROM streams
WHERE streams_id='".$POST['streamId']."' "); 
      $branchResult = mysqlquery("SELECT * FROM branches
WHERE streams_id='".$POST['streamId']."' AND
branchesid='".$POST['branchId']."' "); 
      $batchResult = mysqlquery("SELECT * FROM batches WHERE
streams_id='".$POST['streamId']."' AND
branchesid='".$POST['branchId']."' AND
batchesid='".$POST['batchId']."'"); 
      $divisionResult = mysqlquery("SELECT * FROM division
WHERE division_id='".$POST['divisionId']."' "); 
      $semResult = mysqlquery("SELECT * FROM edu_system WHERE
streams_id='".$POST['streamId']."' AND
edusys_id='".$POST['semId']."' "); 
      if((mysqlnum_rows($streamResult) == 1) &&
(mysql_num_rows($branchResult) == 1) &&
(mysql_num_rows($batchResult) == 1) &&
(mysql_num_rows($divisionResult) == 1) &&
(mysql_num_rows($semResult) == 1)) { 
          require_once
'../../Classes/PHPExcel/IOFactory.php'; 
          $objPHPExcel =
PHPExcel_IOFactory::load($FILES["studnetExcel"]["tmpname"]); 
          $value=''; 
          foreach ($objPHPExcel->getWorksheetIterator() as
$worksheet) { 
              $worksheetTitle = $worksheet->getTitle(); 
              $highestRow = $worksheet->getHighestRow(); 
              $highestColumn = $worksheet-
>getHighestColumn(); 
              $highestColumnIndex =
PHPExcel_Cell::columnIndexFromString($highestColumn); 

              $nrColumns = ord($highestColumn) - 64; 
              for ($row = 4; $row <= $highestRow; ++ $row) { 
                  $value.="
(NULL,".$_POST['streamId'].",".$_POST['branchId'].",".$_POST['b
                  for ($col = 0; $col < $highestColumnIndex;
++ $col) { 
                      $cell = $worksheet-
>getCellByColumnAndRow($col, $row); 
                      if($col==$highestColumnIndex-1) { 
                          $value .= "'".$cell-
>getValue()."',"; 
                          $value .= $SESSION['role']
['id'].","."'active'"; 
                      } 
                      else { 
                          if($row>2 && strreplace(' ', '',
$worksheet->getCellByColumnAndRow($col, 1)-
>getValue())=="JoinDate") 
                              $value .= "'".date('Y-m-
d',strtotime($cell->getValue()))."',"; 
                          else 
                              $value .= "'".$cell-
>getValue()."',"; 
                      } 
                  } 
                  $value .= '),'; 
              } 
          } 
          if(mysql_query("INSERT IGNORE INTO
students(students_id,streams_id,branches_id,batches_id,division
VALUES".substr($value, 0,-1))) { 
              $_SESSION['message'] = "STUDENT SUCCESSFULY
ADDED"; 
              header("location:../../views/student/add.php?
streamId=".$_POST['streamId']."&branchId=".$_POST['branchId']."
          } 
          else { 
              if(mysqlerrno() == 1062) { 
                  $inc=-1; 
                  if(preg_match('/email/', mysql_error())) { 
                      $inc++;$_SESSION['notify'][$inc] =
"STUDENT/PARENTS EMAIL IS ALREADY EXISTED"; 
                    
header("location:../../views/student/add.php?
streamId=".$_POST['streamId']."&branchId=".$_POST['branchId']."
                  } 
                  else if(pregmatch('/annrl_no/',
mysql_error())) { 

                      $inc++;$_SESSION['notify'][$inc] =
"ENROLMENT NUMBERs REPEATED"; 
                    
header("location:../../views/student/add.php?
streamId=".$_POST['streamId']."&branchId=".$_POST['branchId']."
                  } 
              } 
              else { 
                  echo mysqlerror(); 
                  echo mysql_errno(); 
              } 
          } 
      } 
      else{ 
          header("location:../../views/student/add.php"); 
      } 
}
}
?>
and my excel sheet is.
i am getting 0000-00-00 for all record in dob and join_date. Answer
Normally, an Excel "date" is an MS serialized timestamp, a measure of the
number of days since 1st January 1900 (or 1st January 1904 if created on the
Apple Mac version of MS Excel).... this is not a unix timestamp, nor is it a
formatted date string.
PHPExcel provides a number of methods for converting this date to either a
unix timestamp, or to a PHP DateTime object that you can then format for entry
into an SQL statement.
Assuming that this is the case, then for columns N and P, you'd need to use
$dto = PHPExcel_Shared_Date::ExcelToPHPObject($cell->getValue());
and then you can use the DateTime object's format() method to convert to a Y-
m-d formatted string

or
$dto = PHPExcel_Shared_Date::ExcelToPHP($cell->getValue());
to convert to a unix timestamp, that can then be formatted using date()
Topic 416
Subject
Excel 2007, value distribution
Question
I am working with Excel 2007, I have 10 values in names (lets 5 masonry, 3
RC, 1 Stone and 1 Wood), I want to distribute These values two 100 other
cells with the same frequency. Can anybody help me with any formula?
Answer
From the information you've given us, if you had the original ten values in (say)
A2:A11, it would be sufficient to use the following formula copied down to
pick one of them with the same frequency:-
=INDEX(A$2:A$11,RANDBETWEEN(1,10))
As mentioned, you won't in general get exactly 50,30,10,10 values doing it this
way.
You could make it a bit more general by using COUNTA to get the number of
values (assuming there is a header in A1 then a list of values followed by
blanks):-
=INDEX(A:A,RANDBETWEEN(2,COUNTA(A:A)))
Topic 417
Subject
Read Excel file without signature in PHP
Question
Question: how does one read or modify an Excel file without signature to
allow PHP to parse it properly?

For my project, I want to automatically download and read an Excel file from
the national volleyball association (Nevobo) using PHP. Downloading goes
fine. Reading does not. The issue seems to be related to the fact that there's no
signature in the first 8 bytes that tell PHPExcel that it is an OLE file, as such
PHPExcel identifies it as a CSV file, which it definitely is not. Excel itself can
open the file but will force me to save it in a different format.
I have previously downloaded files from the same source (different content
though), which also lack the signature. However on these files I have managed
to filter all the control characters (\x00 thru \xFF) in PHP and automatically
create a new row when it sees a date (since those are all in column A),
unfortunately that didn't work with this file.
function cleanPart ( $part )
{
$part = trim(preg_replace('/[\x00\x01\x03-\x0A\x0D-\x1F\x80-\xFF]/', '',
trim($part, ' ')), ' '); $part = preg_replace('/\x0B/', "\x0C", $part); $part =
preg_replace('/\"/', "\x0C", $part); $part = preg_replace('/\x0C+/', "\x0C",
$part); $part = preg_replace('/\x0C\x02/', "\x0C", $part); if ( $part ==
"\x02\x0C" || $part == "\x02\x0B" ) return false; $part =
trim(preg_replace('/[\x00-\x1F\x80-\xFF]/', "\x02", $part), ' '); $part =
trim(preg_replace('/\x02+/', "\x02", $part), ' '); $part =
trim(preg_replace('/[\x00\x01\x03-\x1F\x80-\xFF]/', '', $part), ' '); if (
strlen($part) == 0 ) return false; $part = trim(preg_replace('/\x02/', "", $part), '
');
return $part;
}
foreach ( explode("\x04", preg_replace('!\x04+!', "\x04", $data)) as $part ) {
if ( ! ( $part = cleanPart($part) ) ) {
continue;
}
// create array

}
Answer
LibreOffice does read the file as an Excel file, so this must be a known format
by LibreOffice, even if file magic identifies it as Apple BASIC (!) and other
utilities as TARGA (which means little more than "binary data with length
multiple of three").
However, this is a delimited text format. Possibly it is a word processor
format and the strange characters are control characters for tabulation and
typefacing?
To convert more reliably in a CSV type, you can replace all control sequences
with tabulations, skipping the first 12 characters. All control sequences appear
to also be 12 bytes long, prefixed by \x04 \x02, so:
$clean = preg_replace('#\\x04\\x02..........#ms', "\t", substr($dirty, 24));
(I have skipped the first control sequence too, giving 12+12 = 24 byte skip).
You can then split into field chunks, then PHP CSV parse functions should be
able to work, 20 fields per row.
I cannot use CSV parse using the sequences as delimiter because the sequences
are different throughout the file. Also they often include carriage returns, which
forces to use the whitespace/line modifier in the regex.
This parser appears to work:
<?php
$clean = preg_split(
'#\\x04\\x02..........#ms',
substr(file_get_contents('excelgen.xls'), 24) );
$rows = array();
while (!empty($clean)) {
$rows[] = array_splice($clean, 0, 20); }
// $header = array_shift($rows);

print_r($rows);
yields
Array
(
[0] => Array
( 
      [0] => Datum 
      [1] => Tijd 
      [2] => Team thuis 
      [3] => Team uit 
      [4] => Locatie 
      [5] => Veld 
      [6] => Regio 
      [7] => Poule 
      [8] => Code 
      [9] => Zaal code 
      [10] => Zaal 
      [11] => Plaats 
      [12] => Eerste scheidsrechter 
      [13] => Tweede scheidsrechter 
      [14] => Rapporteur / begeleider / Jurylid 
      [15] => Lijnrechter 1 
      [16] => Lijnrechter 2 
      [17] => Lijnrechter 3 
      [18] => Lijnrechter 4 
      [19] => Reserve 
...
...
[54] => Array
( 
      [0] => 2016-04-23 
      [1] => 19:30 
      [2] => Ecare Apollo 8 HS 1 
      [3] => Lycurgus HS 2 
      [4] => de Veste, Borne 
      [5] => 1 

      [6] => Nationaal 
      [7] => 1AH 
      [8] => AL 
      [9] => BNEVE 
      [10] => de Veste 
      [11] => Borne 
      ... 
)
Topic 418
Subject
transpose data from row to column in desired times
Question
I need transpose of a row text in another column row times as below in excel:
(Need to copy A1 to E1 text in related row 2 [here A2 to E3] times) 
  A     B     C       D       E       F 
1   Ab1     Ab2     Ab3     Ab4     Ab5     Total 
2 3 2 1 3 1 10
3
4 Ab1
5 Ab1
6 Ab1
7 Ab2
8 Ab2
9 Ab3
10 Ab4
11 Ab4
12 Ab4
13 Ab5
Please suggest
Thanks in advance
Srinivas

Answer
Sub TransposeData()
Dim SourceData As Variant, Results As Variant, i As Long, j As Long, k As
Long
SourceData = Range("A1:E2").Value
Results = Range("A4:A20000").Value
For i = 1 To UBound(SourceData, 2) 
      For j = 1 To SourceData(2, i) 
          k = k + 1 
          Results(k, 1) = SourceData(1, j) 
      Next 
Next
Range("A4:A20000").Value = Results
End Sub
Answer
This will loop through Row1
Sub Move_It()
Dim sh As Worksheet
Dim col As Long
Dim rng As Range
Dim c As Range, x, y
Set sh = Sheets("Sheet1") 'actual name of worksheet
With sh 
      col = .Cells(1, .Columns.Count).End(xlToLeft).Column 
      Set rng = .Range(.Cells(1, 1), .Cells(1, col)) 

      For Each c In rng.Cells    'loop through row 1 
          x = c.Offset(1) 
          For y = 1 To x 
              .Cells(.Rows.Count, "A").End(xlUp).Offset(1) =
c 
          Next y 
      Next c 
End With
End Sub
Answer
Select the source range -> Right mouse click -> "Copy"; Select top left cell of
the target range -> Right mouse click -> "Paste Special" -> "Paste Special"
dialogue -> Check "Transpose" Checkbox -> Click "OK"
You can record this as a macro.
Topic 419
Subject
How to get address of an excel cell from which a formula is calling the data
from?
Question
As seen , I am trying to get the cell address of the origin data, without
duplicates. The can be done partially by =address(index match). I want C19 to
show the value of B8 in the above picture. Answer
For the Name, use INDEX with AGGREGATE providing the position within
adjusted by the duplicates with COUNTIF.
If you have to have the cell address, adjust the same AGGREGATE formula to
return the actual row on the worksheet but don't use this with INDIRECT to

achieve the Name.
'for the name in C19
=INDEX(A$5:A$12, AGGREGATE(15, 6, ROW($1:$8)/(B$5:B$12=B19),
COUNTIF(B$19:B19, B19))) 'for the cell address in D19
=ADDRESS(AGGREGATE(15, 6, ROW($5:$12)/(B$5:B$12=B19),
COUNTIF(B$19:B19, B19)), COLUMN(B:B), 4, 1)
Fill down as necessary.
   
Answer
Try this Array formula:
=INDEX($A$5:$A$12,MATCH(1,IF(($B$5:$B$12=B19)*
(COUNTIF($C$18:$C18,$A$5:$A$12)=0),1,0),0))
Being an Array formula; copy and paste this into the formula bar for cell C19.
Press Ctrl-Shift-Enter to exit edit mode instead of enter or tab. If Excel puts {}
around the formula, it has been properly entered as an array formula.
Then copy down.
Topic 420
Subject
Check illegal characters on uploaded excel file in asp.net mvc
Question
I'm using asp.net mvc 4 to make a website where user can upload .xlsx file and
save the data to MSSQL table. I want to make sure that there is no illegal
characters such as SQL injection statements in the file before saving the datas.
So far I tested out with $ sign it works fine but it'll only catch if a cell has only
that character, not in between characters. Here is my code,
Controller
public ActionResult BulkReadings()

{ 
      string pathToExcelFile =
System.IO.Path.Combine(Server.MapPath("~/ExcelFiles/"),
"BulkReads.xlsx"); 
      string sheetName = "Sheet1"; 
      var excelFile = new ExcelQueryFactory(pathToExcelFile);
      var getSheet = from a in excelFile.Worksheet(sheetName)
select a; 
      string Subject = ""; 
      string Type = ""; 
      string Reading = ""; 
      foreach (var a in getSheet) 
      { 
          if (a["Subject"] == "$" || a["Type"] == "$" ||
a["Reading"] == "$")  // This is where it checks for the "$"
sign 
          { 
              if (System.IO.File.Exists(pathToExcelFile)) 
              { 
                  System.IO.File.Delete(pathToExcelFile); 
              } 
              TempData["meter_fail"] = "Error! Illegal
Characters!"; 
              return RedirectToAction("MeterManager"); 
          } 
          else 
          { 
              Subject = a["Subject"]; 
              Type = a["Type"]; 
              Reading = a["Reading"]; 
              try 
              { 
                  Reading newEntry = new Reading(); 
                  newEntry.title = Subject; 
                  newEntry.type = Type; 
                  newEntry.reading1 = Reading; 
                  rentdb.Readings.Add(newEntry); 
              } 
              catch 
              { 
                  if (System.IO.File.Exists(pathToExcelFile))
                  { 
                      System.IO.File.Delete(pathToExcelFile);
                  } 

                  TempData["meter_fail"] = "Error! Upload
Failed!"; 
                  return RedirectToAction("MeterManager"); 
              } 
          } 
      } 
      rentdb.SaveChanges(); 
      if (System.IO.File.Exists(pathToExcelFile)) 
      { 
          System.IO.File.Delete(pathToExcelFile); 
      } 
      TempData["meter_success"] = "Reading(s) uploaded
successfully!"; 
      return RedirectToAction("MeterManager"); 
}
How can I check for multiple illegal characters that can be present as single or
with other characters in the cell? Need this help badly! Thanks. Answer
As @Sam Axe stated, the best way to avoid sql injection attacks is to
parameterize your queries. Parameters are placeholders for values instead of
using the user-input values.
For example:
using (SqlConnection conn = new
SqlConnection(NorthwindConnectionString)) {
string query = "SELECT * FROM Products WHERE ProductID = @Id";
SqlCommand cmd = new SqlCommand(query, conn);
cmd.Parameters.AddWithValue("@Id", Request.QueryString["Id"]);
conn.Open();
using (SqlDataReader rdr = cmd.ExecuteReader()) { 
      DetailsView1.DataSource = rdr; 
      DetailsView1.DataBind(); 
}
}

Here is some further reading on it:
https://msdn.microsoft.com/library/bb738521(v=vs.100).aspx
Topic 421
Subject
Store location of command button cell address to variable in VBA
Question
Okay so I'm using Excel and trying to get a cell address based off the location
of the command button I'm clicking. I want to store that cell address in a
variable as I click the button to be used in the next code for the user form that
pops up as a result of clicking that button. Ive looked at this link: Store
location of cell address to variable in VBA , which is similar to what I'm
trying to do but I cant seem to get it to work with the
ActiveSheet.Shapes(Application.Caller).TopLeftCell.Address that gives an
address based off the top left corner of the command button. I'm trying to do it
this way so I can use the same code from the next part for every similar button I
add without having to manually change the code based off where the button is.
I'm pretty new when it comes to Excel and VBA so any help would be
appreciated.
Edit
I tried adding the code but I'm getting a Runtime error '1004' Unable to get
Buttons property of the Worksheet class. I have this
Sub Button2_Click()
Dim BtRng As Range
Set Btnrng = ActiveSheet.Buttons(Application.Caller).TopLeftCell
MsgBox Btnrng.Address
Btnrng.Offset(3, 3) = "Hello"
formAddBill.Show
End Sub

This button is also popping up a userform for information input. the error is
happening on Set Btnrng =
ActiveSheet.Buttons(Application.Caller).TopLeftCell Answer
If you are using application.caller then I assume your buttons are from the
forms.control toolbox. This makes life a lot easier.
Assign each button with this code example:
Sub Rng_Butn_Clicked()
Dim BtRng As Range
Set Btnrng = ActiveSheet.Buttons(Application.Caller).TopLeftCell MsgBox
Btnrng.Address
Btnrng.Offset(3, 3) = "Hello"
End Sub
If you are using command buttons from the activex toolbar, it can get a bit
confusing. Doing it one at a time is easy enough
Private Sub CommandButton1_Click()
Me.CommandButton1.TopLeftCell.Offset(0, 1) = "Hi"
Me.CommandButton1.TopLeftCell.Offset(, 2).Interior.Color = vbBlue MsgBox
Me.CommandButton1.TopLeftCell.Address End Sub
But assigning one code to many activex command buttons is not as easy, I
would prefer to use the Forms Buttons if you want to assign one code to many
buttons.
Edit: If you are getting this error
You probably put the code in a command button. Please reread my answer.
This is what I am referring to:Form Controls & ActiveX Controls
Topic 422
Subject
Plan Date /Actual Date

Question
How to do this in Excel? What will be the code??
If Plan Date (P) is less than Today it Turns into Red If Plan Date (P) is Next
day it Turns into Orange If Plan Date (P) greater than Today Do Noting If any
Actual Date (A) is input then Plan Date (P) Turns into Green
Plan/Actual
Answer
You can use conditional formatting:
Based on your example assuming top left is cell A1. CTRL + Select B1:D1 &
B3:D3, click conditional formatting and new rule. Click "use a formula to
determine cells to format" at the bottom of the list and enter the following
formulas to the selected range:
=B1<Today()-1 & format to fill red & bold font
=B1=Today()-1 & format to fill orange & bold font
=B2<>"" and format to fill green & white bold font
Use new rule for each formula. Adjust ranges to meet your needs.
Note: Conditional formatting will evaluate condition top to bottom, so if cell
meets multiple conditions (ex: date is less than today and actual date is
entered) the highest conditional formatting rule will be applied. So make sure
your green fill format is at the top.
Topic 423
Subject
excel VBA return result of function
Question
Simple Layup for anyone. I've written a function isMac() which looks at the
current operating System, if the first 3 letters are Mac, it is supposed to return
True. I then want to assign the return value of the function to a variable in
another function. I'm currently running a Mac, so when I run the following

code, the MsgBox says True, while the Debug.Print returns False
Function isMac() As Boolean
If Left(Application.OperatingSystem, 3) = "Mac" Then result = True
Else
result = False
End If
MsgBox result
End Function
Sub test()
Debug.Print isMac()
End Sub
How do I correctly return a Boolean from my IF statement so that I can utilize
it in another function? Answer
Try assigning the result to the function.
Function isMac() As Boolean
isMac = CBool(LCase(Left(Application.OperatingSystem, 3)) = "mac") End
Function
Sub test()
Debug.Print isMac()
End Sub
Another approach would be Compiler Directives and Compiler Constants. In a
module code sheet's declarations area as,
#If Mac Then
Public Const bMAC as Boolean = True #Else
Public Const bMAC as Boolean = False #End If
Use bMAC anywhere in your code to determine whether the OS is a Mac or
not.

Topic 424
Subject
Specifying User Permissions in VBA for Protected Excel Sheet
Question
I am working with a spreadsheet that is required to be protected before
distribution for the sheer sake of data integrity. I have written a function that
auto-populates a column based on a drop down list selection. I do not want the
user to edit this column so I have it protected, however in order to auto-
populate my process un-protects and re-protects the spreadsheet. This is where
the issue lies.
I would like users to have all other permissions (e.g. formatting, row insertion,
row deletion, etc). However, when the process re-protects the sheet, all
permissions are revoked.
Is there a way I can both lock the sheet AND specify which user permissions I
would like to grant in VBA? Answer
The Worksheet.Protect method allows to specify everything that would be
available to you when performing the Review ► Changes ► Protect
Worksheet command. The parameters are largely optional so they need to be
specified explicitly or blank parameters can be passed in with commas as
placeholders.
To protect a worksheet with a password and allow column formatting and row
insertion:
With Worksheets("Sheet One")
.Protect Password:="myPassword", Contents:=True, _
AllowFormattingColumns:=True, AllowInsertingRows:=True 'insert a row
.Rows("9:9").EntireRow.Insert CopyOrigin:=xlFormatFromLeftOrAbove End
With
See the Worksheet.Protect method for a full list of available options.

Another option is the UserInterfaceOnly. This stops the user from
predetermined actions on the worksheet but allows VBA procedures to
perform actions that would otherwise be restricted.
With Worksheets("Sheet One")
.Protect Password:="myPassword", UserInterfaceOnly:=True, Contents:=True,
_
AllowFormattingColumns:=True, AllowInsertingRows:=True 'insert a column;
the user cannot do this .Columns(2).EntireColumn.Insert
CopyOrigin:=xlFormatFromLeftOrAbove End With
This latter behavior allow you more freedom in your VBA procedures without
having to continually unprotect and reprotect the worksheet.
Topic 425
Subject
Can I create a variable that saves the result of the formula?
Question
Here is an example code where I set a range equal to a string variable, and
then save a file name based on the formulas result.
Dim vFormula3 As String
'Set up formula into string variable
vFormula3 = "=INDEX($A$7:$AZ$7,MATCH(" & Chr(34) & "Voyage
Number" & Chr(34) & ",$A$6:$AZ$6,0))"
'Then Put formula into a cell range
'Set sheet range here if needed
Range("A3") = vFormula3
'Save code goes here
'blah blah blah save files.
Is it possible to instead rewrite the formula so that I set my variable (eg

vFormula1) to instead be the result of the formula?
Is there a Dim vFormula as Formula approach I could take? Answer
As mentioned in the comments of your last question, look into the
Application.Evaluate method. Alternately, a more direct method might be the
WorksheetFunction object.
You are missing parent worksheet references in your formula; this is not a good
idea when using any method of evaluating a formula within VBA are the parent
references may be lost due to a roving ActiveSheet property.
Dim vFormula3 As String, vResult As Variant
vFormula3 = "INDEX('Sheet One'!$A$7:$AZ$7, " & _
"MATCH(""Voyage Number"", 'Sheet One'!$A$6:$AZ$6, 0))" Debug.Print
Application.Evaluate(vFormula3) vResult = Application.Evaluate(vFormula3)
Debug.Print vResult
'HLOOKUP is a better formula for this
With Worksheets("Sheet One")
Debug.Print Application.HLookup("Voyage Number", .Range("A6:AZ7"), 2,
False) Debug.Print WorksheetFunction.HLookup("Voyage Number",
.Range("A6:AZ7"), 2, False) vResult = Application.HLookup("Voyage
Number", .Range("A6:AZ7"), 2, False) Debug.Print vResult
End With
Note that quotes within quoted string need to be doubled up.
I've offered an alternate formula using the HLOOKUP function. It seems to be
better suited to what you are trying to do.
The Debug.Print results go to the VBE's Immediate window (tap [Ctrl]+G to
show).
Topic 426
Subject

organizing data in excel files with python
Question
I have an excel file that looks something similar to this:
**Part** **Quantity** **Category** **Board** 
part1        4            RES         board1 
part2        3            CAP         board4 
part3        2            CAP         board3 
            3            CAP         board2 
            4            CAP         board4 
part4        3            DIO         board2 
ad infinitum. Ideally, what I want is something that can take the 5-6 boards
listed and create a column for them, and place the respective quantities for
each individual part, so in other words,
**Part** **Category** **Board1** **Board2** **Board3** **Board4** 
part1        RES           4           0           0          
0 
part2        CAP           0           0           0          
0 
part3        CAP           0           3           2          
4 
part4        DIO           0           3           0          
0 
I do not require that the other entries be filled with zeros. They can be left as
unfilled cells. Keep in mind, I start with excel files that are not grouped as
above, which is to say, the part numbers are repeated, and every row is filled.
However, I cannot have duplicte parts which is why I use the pandas groupby
command to organize them and effectively remove the duplicates. Here is the
very simple script I have at present:
import pandas as pd
import numpy as np
import sys
import subprocess

#load csv file
df = pd.read_excel('/home/Linux/.../raw-inventory.xlsx')
#group by part number
organize = df.groupby(['Part','Value','Description','Qty','Board']).sum()
#open to .csv
organize.to_excel('organizedlist.xlsx')
#opening outputted file
subprocess.call(organize, shell=True)
print('Done')
I've been looking around in pandas and xlsxwriter and I haven't yet seen a good
way to do this. Maybe someone on here has an idea?
It may be better to use the original .xlsx file as well, but there would have to be
a way to remove duplicate parts. That's why I use the groupby pandas function.
It preserves all other data, and eliminates multiple instances beneath the 'part'
column. Any suggestions, from simple to complicated, recommended python
packages, etc, would be greatly appreciated!
Topic 427
Subject
Every 5 seconds record the value in 2 cells in another worksheet VBA
Question
Problem:
I have searched extensively for this and cannot seem to get it to work. I have a
timer running when the "StartBtn" is pressed: 
Dim StopTimer           As Boolean 
Dim SchdTime            As Date 
Dim Etime               As Date 
Dim currentcost         As Integer 
Const OneSec            As Date = 1 / 86400# 
Private Sub ResetBtn_Click()

StopTimer = True
Etime = 0
[TextBox21].Value = "00:00:00"
End Sub
Private Sub StartBtn_Click()
StopTimer = False
SchdTime = Now()
[TextBox21].Value = Format(Etime, "hh:mm:ss") Application.OnTime
SchdTime + OneSec, "Sheet1.NextTick" End Sub
Private Sub StopBtn_Click()
StopTimer = True
Beep
End Sub
Sub NextTick()
If StopTimer Then
'Don't reschedule update
Else 
    [TextBox21].Value = Format(Etime, "hh:mm:ss") 
    SchdTime = SchdTime + OneSec 
    Application.OnTime SchdTime, "Sheet1.NextTick" 
    Etime = Etime + OneSec 
End If
End Sub
Then in another cell (say, C16) I have a manually entered value which is the
hourly cost rate. I have a third cell that is calculating total cost by C16*current
timer value.
What I want to do is record every 5 seconds after the "StartBtn" is clicked the
current time and current calculated cost in another sheet. This is what I have

started:
Sub increment()
Dim x As String
Dim n As Integer
Dim Recordnext As Date
n = 0
Record = [TextBox21].Value
Recordnext = [TextBox21].Value + OneSec
Range("B13").Value = Recordnext
Do Until IsEmpty(B4)
If [TextBox21].Value = Recordnext Then ActiveCell.Copy 
  
Application.Goto(ActiveWorkbook.Sheets("Sheet2").Range("A1").O
0)) 
      ActiveSheet.Paste 
      Application.CutCopyMode = False 
      n = n + 1 
      Recordnext = [TextBox21].Value + 5 * (OneSec) 
Exit Do
End If
ActiveCell.Offset(1, 0).Select
Loop
End Sub
But it doesnt work. Any help would be appreciated. Answer
I have tried to simplify your timer method down to what is actually needed.
Sheet1 code sheet
Option Explicit

Private Sub ResetBtn_Click()
bRun_Timer = False
'use the following if you want to remove the last time cycle TextBox21.Value =
Format(0, "hh:mm:ss") End Sub
Private Sub StartBtn_Click()
bRun_Timer = True
dTime_Start = Now
TextBox21.Value = Format(Now - dTime_Start, "hh:mm:ss")
Range("D16").ClearContents
Call next_Increment
End Sub
Module1 code sheet
Option Explicit
Public bRun_Timer As Boolean
Public Const iSecs As Integer = 3 'three seconds Public dTime_Start As Date
Sub next_Increment()
With Worksheets("Sheet1") 
      .TextBox21.Value = Format(Now - dTime_Start,
"hh:mm:ss") 
      .Range("D16") = Sheet1.Range("C16") / 3600 * _ 
                          
Second(TimeValue(Sheet1.TextBox21.Value)) '# of secs ×
rate/sec 
      Worksheets("Sheet2").Cells(Rows.Count,
1).End(xlUp).Resize(1, 2).Offset(1, 0) = _ 
          Array(.TextBox21.Value, .Range("D16").Value) 
End With
If bRun_Timer Then

Application.OnTime Now + TimeSerial(0, 0, iSecs), "nextIncrement" End Sub
Note that the operation of transferring the data to Sheet2 is a direct value
transfer¹ with no .GoTo, ActiveCell or Select.
It was not entirely clear to me what you were trying to do with the value
transfer. I have stacked them one after another on Sheet1.
       
You would benefit by adding Option Explicit² to the top of all your code
sheets. This requires variable declaration and if you misplace a public
variable, you will quickly know.
¹ See How to avoid using Select in Excel VBA macros for more methods on
getting away from relying on select and activate to accomplish your goals.
² Setting Require Variable Declaration within the VBE's Tools ► Options ►
Editor property page will put the Option Explicit statement at the top of each
newly created code sheet. This will avoid silly coding mistakes like
misspellings as well as influencing you to use the correct variable type in the
variable declaration. Variables created on-the-fly without declaration are all
of the variant/object type. Using Option Explicit is widely considered 'best
practice'.
Topic 428
Subject
Excel VBA. How do you get a specific name associated with a range?
Question
I have a cell that has more than one named ranges associated with it. How do I
get it to return a specific name without having to loop through all the names in
the workbook?
Sub Test()
ActiveWorkbook.Names.Add Name:="AUserDefinedName1",
RefersTo:="='Sheet1'!$A$1", Visible:=True ActiveWorkbook.Names.Add

Name:="AUserDefinedName2", RefersTo:="='Sheet1'!$A$1", Visible:=True
ActiveWorkbook.Names.Add Name:="MyName",
RefersTo:="='Sheet1'!$A$1", Visible:=True Dim n As Name
Set n = Range("A1").Name
Debug.Print n.Name
End Sub
If you run the above, for cell A1 it would only return the first name. However,
how would I get it to return the other names associated with cell A1 as well or
a specifically return 'MyName'?
I could loop through all names in the workbook and see if the 'RefersTo'
property of the Name object matches the address for cell A1, but I would like a
more direct solution if possible that's faster.
This thread gave a partial answer, but need what if there are more than one
name? How do you get a Range to return its Name? Answer
Use the Workbook.Names collection and test the address:
For Each n In ActiveWorkbook.Names
If n.RefersToRange.Address = "$A$1" Then
Debug.Print n.Name
End If
Next
There's a whole MSDN article about named ranges too for further reading.
There isn't a Names collection for the range object so the only way to
accomplish this is at workbook level. Unless you have thousands of named
ranges in your workbook there will be no noticeable speed difference in using
this method, just create a UDF to get the names that you need.
Topic 429
Subject
Excel VBA - loop to fill up ranges with formulas referencing to other ranges

Question
I have 2 worksheets (sht1, sht2) with both having similar size ranges and I'd
need to refer with formulas from sht2 to sth1.
Example
on sht2 add formulas to range I10:K11 that link to sht1 range B2:D3 next
on sht2 add formulas to range I20:K21 that link to sht1 range B6:D7 and
so on as long as there are ranges
There are hundreds of these ranges but on both sheet with separate distances
from each other and there is other stuff between the ranges so I can't just
populate whole sheets. Distances between ranges on sht1 are constant as well
as on sht2, just different from each other.
What would be the best way to populate the range on sht2 with formulas to
sht1? Should I just use integer in Cells and then move the integer by known
distance between loops? Answer
Contrary to my comment, the maths behind the stagger may be easier to figure
out with the Range.Offset property. With .Offset providing the starting point,
the Range.Resize property reshapes the target area.
Sub staggerLink()
Dim r As Long, sht1 As Worksheet
Set sht1 = Worksheets("sht1")
With Worksheets("sht2") 
      For r = 0 To 99 
          .Cells(10, 9).Resize(2, 3).Offset(r * 10,
0).Formula = _ 
              Chr(61) & sht1.Cells(2, 2).Offset(r * 4,
0).Address(False, False, external:=True) 
      Next r 
End With
End Sub

You've provided no scope to your project other than 'hundreds of these ranges'
so I simply ran down 100 times. Additionally, you provided no sample or even
description of your 'formula' other than it has to 'link to sht1' so that is the
formula I provided.
Topic 430
Subject
VBA code delete the row of noisy data
Question
Sub project()
Dim a, deltat_value1, deltat_value2, deltat_value3 As Integer a = 2
Do 
      deltat_value1 = Cells(a, 7).Value 
      deltat_value2 = Cells(a + 1, 7).Value 
      deltat_value3 = Cells(a + 2, 7).Value 
      If Abs(deltat_value1 - deltat_value2) > 5 And
Abs(deltat_value2 - deltat_value3) > 5 Then 
      Rows(a + 1).EntireRow.Delete 
      End If 
      a = a + 1 
Loop Until deltat_value1 = 14700
End Sub
I am trying to delete the noisy data, I set if a data point that it has a difference
bigger than 5 from both the points above and below it, that is a noisy data and I
set to delete the whole row of the noisy data. However, I am having this
problem for the line:
deltat_value3=Cells(a+2,7).Value
Runtime Error 1004 "Application-defined or Object-defined error"
And the running takes extremely longer time. I am a new user of VBA
programming and I think my method may be inefficient, there may be other
ways work much better, any advice? Answer

How about:
Sub ytrewq()
Dim a As Long, deltat_value1 As Long, deltat_value2 As Long, deltat_value3
As Long Dim rKill As Range
a = 2
Do 
      deltat_value1 = Cells(a, 7).Value 
      deltat_value2 = Cells(a + 1, 7).Value 
      deltat_value3 = Cells(a + 2, 7).Value 
      If Abs(deltat_value1 - deltat_value2) > 5 And
Abs(deltat_value2 - deltat_value3) > 5 Then 
          If rKill Is Nothing Then 
             Set rKill = Cells(a + 1, 1) 
          Else 
             Set rKill = Union(rKill, Cells(a + 1, 1)) 
          End If 
      End If 
      a = a + 1 
Loop Until deltat_value1 = 14700
rKill.EntireRow.Delete
End Sub
Topic 431
Subject
conditionally auto name excel file using VBA
Question
I have following VB code that uses certain cell values (used to be fixed
location) of a DB default file to name the current worksheet and save it in a
specific folder with the use of an ActiveX button. However, column locations
started varying in original file and VB ranges no longer pick the correct data to
auto name the file. I created formulas (further below) to find the correct values
I need to use to auto name the file. How do I insert those formulas in to my VB
code for it to do job?

Private Sub CommandButton1_Click()
Dim Path As String
Dim FileName1 As String
Dim FileName2 As String
Dim FileName3 As String
Dim str As String, strLeft As String
str = Range("A7")
strLeft = Left(str, 9)
FileName1 = strLeft
FileName2 = RepCh(Range("B7").Value)
FileName3 = RepCh(Range("C7").Value)
Path = "…"
ActiveWorkbook.SaveAs FileName:=Path & FileName1 & "" & FileName2 &
"" & FileName3 & "_" & ".xls", FileFormat:=xlCSV End Sub
Formulae
=LEFT(INDEX($A$7:$AZ$7,MATCH("Departure",$A$6:$AZ$6,0)),
SEARCH("",INDEX($A$7:$AZ$7,MATCH("Departure",$A$6:$AZ$6,0)),9))
=INDEX($A$7:$AZ$7,MATCH("Vessel Name",$A$6:$AZ$6,0))
=INDEX($A$7:$AZ$7,MATCH("Voyage Number",$A$6:$AZ$6,0)) Answer
There's more efficient ways than mine, but sometimes I just write formulas to a
string variable, and save off the string variable.
However when you have " , then you need to split your formula into multiple
strings and concatenate with & each time you have a quotation mark. (i.e -
replace every " with Chr(34))
As an example for your top formula:
Dim vFormula1 As String
Dim vFormula2 As String
Dim vFormula3 As String
'Set up formula into string variable

vFormula1 = "=LEFT(INDEX($A$7:$AZ$7,MATCH(" & Chr(34) &
"Departure" & Chr(34) & ",$A$6:$AZ$6,0)), SEARCH(" & Chr(34) &
Chr(34) & ",INDEX($A$7:$AZ$7,MATCH(" & Chr(34) & "Departure" &
Chr(34) & ",$A$6:$AZ$6,0)),9))" vFormula2 =
"=INDEX($A$7:$AZ$7,MATCH(" & Chr(34) & "Vessel Name" & Chr(34) &
",$A$6:$AZ$6,0))" vFormula3 = "=INDEX($A$7:$AZ$7,MATCH(" &
Chr(34) & "Voyage Number" & Chr(34) & ",$A$6:$AZ$6,0))"
'Then Put formula into a cell range
'Set sheet range here if needed
Range("A1") = vFormula1
Range("A2") = vFormula2
Range("A3") = vFormula3
'Then save code goes here
'blah blah blah save files.
Topic 432
Subject
Import body of all .msg files located in local drive, to and Excel sheet (NOT
OUTLOOK)
Question
I'm trying to import multiple .msg files into an Excel Sheet (msg body per
row)but so far the only reference found was this here, so my code so far let
you:
Select the folder path (where the .msg are located) Loop through all the .msg
files
But I'm unable to figure out how to achieve my objective. Thanks in advance
for the response.
Code
Sub importMsg()
Application.ScreenUpdating = False

Application.EnableEvents = False
Application.DisplayAlerts = False
Dim i As Long
Dim inPath As String
Dim thisFile As String
Dim msg As MailItem
Dim OlApp As Object
Dim ws As Worksheet
Set ws = ThisWorkbook.Worksheets("Main") Set OlApp =
CreateObject("Outlook.Application")
With Application.FileDialog(msoFileDialogFolderPicker) 
     .AllowMultiSelect = False 
          If .Show = False Then 
              Exit Sub 
          End If 
      On Error Resume Next 
      inPath = .SelectedItems(1) & "\" 
End With
i = 1
thisFile = Dir(inPath & "*.msg")
Do While thisFile <> "" 
      i = i + 1 
      Dim MyItem As Outlook.MailItem 
      Set MyItem =
Application.CreateItemFromTemplate(thisFile) 
      'Set MyItem = Application.OpenSharedItem(thisFile) 
      ws.Cells(i, 1).Value = MyItem.Body 
      'MyItem.Body 
      'MyItem.Subject 
      'MyItem.Display 
      thisFile = Dir 

Loop
Application.ScreenUpdating = True
Application.EnableEvents = True
Application.DisplayAlerts = True
End Sub
Answer
I found the error in the Do While Loop the variable thisFile wasn't maintaining
the full path reference so I added the concatenation again and worked, code
below:
Sub importMsg()
Application.ScreenUpdating = False
Application.EnableEvents = False
Application.DisplayAlerts = False
Dim i As Long
Dim inPath As String
Dim thisFile As String
Dim Msg As MailItem
Dim ws As Worksheet
Dim myOlApp As Outlook.Application
Dim MyItem As Outlook.MailItem
Set myOlApp = CreateObject("Outlook.Application") Set ws =
ThisWorkbook.Worksheets("Main")
With Application.FileDialog(msoFileDialogFolderPicker) 
     .AllowMultiSelect = False 
          If .Show = False Then 
              Exit Sub 
          End If 
      On Error Resume Next 
      inPath = .SelectedItems(1) & "\" 
End With
thisFile = Dir(inPath & "*.msg")

i = 4
Do While thisFile <> "" 
      Set MyItem = myOlApp.CreateItemFromTemplate(inPath &
thisFile) 
      ws.Cells(i, 1) = MyItem.Body 
      i = i + 1 
      thisFile = Dir() 
Loop
Set MyItem = Nothing
Set myOlApp = Nothing
Application.ScreenUpdating = True
Application.EnableEvents = True
Application.DisplayAlerts = True
End Sub
Topic 433
Subject
Visual Studio - start external program with different elevation
Question
We have an Excel addin that uses Addin Express. To register the addin, we
must run Visual Studio as administrator. It seems that Windows 10 has some
different behaviour when it comes to elevated rights/UAC than 7 did.
My question:
Is there a way to launch an external program in VS debug (such as Excel) NOT
as an administrator, when VS is running as admin.
The issue is really more of an annoyance, but when you double-click an excel
file it only opens in the existing/opened instance of Excel if Excel is not
elevated.
So I start debugging my Addin, and in Win7 I could just double-click-to-open
.xlsx files, and they'd open in the debugging instance of Excel. In Win10, it
opens a new instance (not being debugged) unless I go through the 3-4 click

file/open process in Excel. Not a big deal, except I do it several hundred times
a day, so I'm trying to save clicks and time.
Any thoughts would be appreciated.
Thanks,
Topic 434
Subject
Need to compare data from string of text in 1 cell to a column of data in
another
Question
I am trying to do an index match function in which I concatenated two text into
a string and compared it to the same text in another table. Once comparing the
two tables, I am able to pull a number result. However, I can't seem to figure a
way to process a long string. In the score on column C it should add up all the
values that are associated with the date and test.
EX
Answer
In your posted sample data, you have discrepancies:
Your example data shows the concatenated values in cell B2 to be "test1" "test
2" and "test 3" However, in column G, it will only find a match for "test1"
because there are no spaces for "test2" and "test3"
Assuming such discrepancies don't exist in your actual data, and that there
would be exact matches because the concatenation is the result of a formula
and not done by hand, you should be able to use this formula in cell C2 and
copy down to get the sums you're looking for. Adjust the ranges to suit your
actual data:
=SUMPRODUCT(--(COUNTIF(B2,""&$G$2:$G$100&"")>0),--
($F$2:$F$100=A2),$H$2:$H$100)
Topic 435
Subject

Check if pptx and xlsx files are already open before attempt to open it
Question
I guess this is a easy one but since I'm very new in VBA I can't figure it out.
I have this peace of code which opens a Power Point presentation and a Excel
spreadsheet. dir_pptx and dir_xlsx are the respective filepaths.
Set ObjPPT = CreateObject("PowerPoint.Application") Set ObjPresentation =
ObjPPT.Presentations.Open("" & dir_pptx & "") Workbooks.Open
Filename:=dir_xlsx
My question: how to modify this code for check if the files are already opened
and, if they are, don't open it again? Answer
Sub wbcheck()
For Each B In Application.Workbooks
If B.name = dir_xlsx Then 
      MsgBox B.name & " already open" 
      'exit sub or some other handler 
  Else 
      Workbooks.Open Filename:=dir_xlsx 
End If
Next
End Sub
Topic 436
Subject
Index/Match with three criteria
Question
I have searched and searched and searched and searched, I can only find
solutions for index/match with two criteria.

does anyone have a solution for index/match with three criteria?
as a sample of my actual data, i would like to index/match the year, type and
name to find the data in the month column Answer
You can match an unlimited number of criteria by using SUMPRODUCT() to
find the proper row:
=INDEX(D2:D9,SUMPRODUCT((A2:A9=2015)*(B2:B9="Revenue")*
(C2:C9="Name 1")*ROW(2:9))-1)
EDIT#1:
Scott's comment is correct! The advantagesof the SUMPRODUCT() approach
is that it is not an array formula and can be expanded to handle many criteria.
The disadvantage is that it will only work if there is 1 matching row. The use
of SUMPRODUCT() is explained very well here:
xlDynamic Paper
Answer
If assuming your data starts in A1 ("Year") and goes to D15 ("????"), you can
use this. You bascically just add your criteria with &, then when doing the
Match() regions, connect their respective ranges with & as well.
=Index(D2:D9,Match(A15&B15&C15,A2:A9&B2:B9&C2:C9,0))
and enter with CTRL+SHIFT+ENTER and make the references absolute (i.e.
$D$2:$D$9), I just didn't to keep the formula a little easier to read.
Answer
Because your question has numerical data, you can simply use SUMIFS.
SUMIFS provides the sum from a particular range [column D in this case],
where any number of other ranges of the same size [the other columns, in this
case] each match a particular criteria. For text results, one of the other
recommended solutions will be needed.

In addition to being a little cleaner, this has the attribute [could be good or bad
depending on your needs] that it will pick up multiple rows of data if multiples
exist, and sum them all. If you expect unique rows, that's bad, because it won't
warn you there are multiples.
The formula in your case would be as follows [obviously, you should adjust
the formulas to reference your ID cells, and pick up the appropriate columns]:
=SUMIFS(D:D,A:A,2015,B:B,"Revenue",C:C,"Name1"))
What this does is:
Sum column D, for each row where: (1) column A is the number 2015; (2)
column B is the text "Revenue"; AND (3) column C is the word "Name1".
Topic 437
Subject
Interact with Active/Single IE11 Session VBA
Question
So I have a loop that exports data from a website. However, for each case, it
starts a new session and closes. Is there a method to navigate and download
for all the cases in just one IE11 session and then closing out? Below is the
code that I have right now:
Public Sub Get_File() 
  Dim sFiletype As String     'Fund type reference 
  Dim sFilename As String     'File name (fund type + date of
download), if "" then default 
  Dim sFolder As String       'Folder name (fund type), if ""
then default 
  Dim bReplace As Boolean     'To replace the existing file
or not 
  Dim sURL As String          'The URL to the location to
extract information 
Dim Cell, Rng As Range
Dim Sheet As Worksheet

'Initialize variables
Set Rng = Range("I2:I15")
Set Sheet = ActiveWorkbook.Sheets("Macro_Button")
For Each Cell In Rng 
      If Cell <> "" Then 
      sFiletype = Cell.Value 
      sFilename = sFiletype & "_" & Format(Date, "mmddyyyy") 
      sFolder =
Application.WorksheetFunction.VLookup(Cell.Value,
Sheet.Range("I2:J15"), 2, False) 
      bReplace = True 
      sURL = "www.preqin.com" 
      'Download using the desired approach, XMLHTTP / IE 
          If
Application.WorksheetFunction.VLookup(Cell.Value,
Sheet.Range("I2:W15"), 15, False) = 1 Then 
          Call Download_Use_IE(sURL, sFilename, sFolder,
bReplace) 
          Else 
          Call Download_NoLogin_Use_IE(sURL, sFilename,
sFolder, bReplace) 
          End If 
      Else 
      Exit Sub 
      End If 
Next
End Sub
Private Sub Download_Use_IE(ByRef sURL As String, _ 
                          Optional ByRef sFilename As String
= "", _ 
                          Optional ByRef sFolder As String =
"", _ 
                          Optional ByRef bReplace As Boolean
= True) 

Dim oBrowser As InternetExplorer
Dim hDoc As HTMLDocument
Dim objInputs As Object
Dim ele As Object
On Error GoTo ErrorHandler
'Create IE object
Set oBrowser = New InternetExplorer oBrowser.Visible = True
'Navigate to URL
Call oBrowser.navigate(sURL)
While oBrowser.Busy Or oBrowser.readyState <> 4: DoEvents: Wend
'Skips log in step if already signed into website On Error GoTo LoggedIn
'Enter username
oBrowser.document.getElementById("ctl00_ctl00_cphSiteHeader_ucLoginForm
= "XXX"
oBrowser.document.getElementById("ctl00_ctl00_cphSiteHeader_ucLoginForm
= "XXX"
'Submit the sign in
oBrowser.document.getElementById("ctl00_ctl00_cphSiteHeader_ucLoginForm
'Wait for website to load
While oBrowser.Busy Or oBrowser.readyState <> 4: DoEvents: Wend
LoggedIn
'All PE
oBrowser.navigate Range("H3").Value 'Wait for website to load
While oBrowser.Busy Or oBrowser.readyState <> 4: DoEvents: Wend 'Set the
htmldocument
Set hDoc = oBrowser.document
'Loop and click the download file button Set objInputs =
oBrowser.document.getElementsbyTagName("input") For Each ele In objInputs

      If ele.Title Like "Download Data to Excel" Then 
          ele.Click 
      End If 
Next
'Wait for dialogue box to load
While oBrowser.Busy Or oBrowser.readyState > 3: DoEvents: Wend
Application.Wait (Now + TimeValue("0:00:02"))
'IE 9+ requires to confirm save
Call Download(oBrowser, sFilename, sFolder, bReplace)
'Close IE
oBrowser.Quit
Exit Sub
ErrorHandler
'Resume Debug.Print "Sub Download_Use_IE() " & Err & ": " &
Error(Err) End Sub Answer
Modify your download_IE procedure to use a Browser that is passed to it:
Private Sub Download_Use_IE(oBrowser As InternetExplorer, _ 
                         ByRef sURL As String, _ 
                      Optional ByRef sFilename As String =
"", _ 
                      Optional ByRef sFolder As String = "",
_ 
                      Optional ByRef bReplace As Boolean =
True) 
Dim hDoc As HTMLDocument
Dim objInputs As Object
Dim ele As Object
On Error GoTo ErrorHandler

'Create IE object
oBrowser.Visible = True
'Navigate to URL
Call oBrowser.navigate(sURL)
......rest of code
Call Download(oBrowser, sFilename, sFolder, bReplace)
'Do not Close IE
Exit Sub
ErrorHandler
'Resume Debug.Print "Sub Download_Use_IE() " & Err & ": " &
Error(Err) End Sub
Then modify your procedure to pass this object:
Public Sub Get_File()
'declare all variables plus:
Dim oBrowser As InternetExplorer
Set oBrowser = New InternetExplorer
.....put additional code here..... 
   If Application.WorksheetFunction.VLookup(Cell.Value,
Sheet.Range("I2:W15"), 15, False) = 1 Then 
       Call Download_Use_IE(oBrowser, sURL, sFilename,
sFolder, bReplace) 
      Else 
      Call Download_NoLogin_Use_IE(oBrowser, sURL, sFilename,
sFolder, bReplace) 
      End If 
    Else 

       Exit Sub 
    End If 
Next 
   'Close IE 
   oBrowser.Quit 
End Sub
You will need to do the same thing for the other procedure.
Topic 438
Subject
Limiting cell values in formulas
Question
I would like to use some kind of limit or over/under rule in a formula. The
premise is if a number exceeds a certain value, then I only want to take that
certain value. Here's an example:
If an employee's hours exceed 80 hours per month, only use 80 hours for
accounting purposes. Let's say my employee Bob's timesheet looks like this:
Jan = 20 hours
Feb = 40 hours
Mar = 100 hours
Apr = 60 hours
etc.
If Bob gets paid $100/hours, then his final payment should be $100/hour total
hours works. Or in excel format, something like =100sum(b1:b12) if hours
are stored in column B.

BUT, I only want to take a Maximum of 80 hours each month... So the hours in
the above example, as far as accounting is concerned, would look like this:
Jan = 20 hours
Feb = 40 hours
Mar = 80 hours
Apr = 60 hours
etc.
I'd rather not build in another column for =if(b1>80,80,b1). And to be honest,
it's bugging me now that I can't figure it out.
Please help!
Answer
Try this array formula:
=100 * SUM(IF(B1:B12>80,80,B1:B12))
This is an array formula and must be confirmed with Ctrl-Shift-Enter when
exiting edit mode instead of Enter or Tab.
Answer
For a regular (non array) formula solution:
=SUMPRODUCT((B1:B4<80)*B1:B4+(B1:B4>=80)*80)
Topic 439
Subject
Opening Excel workbook containing macros (.xlsm) using ADO and getting
macros to run
Question
I've been using ADO to process many Excel .xls and .xlsx workbooks without

any problems. Recently I tried to process a .xlsm workbook to load to an
Access database. The workbook contains several macros that are run every
time a user opens a desktop version of Excel. The macros update "yesterdays"
data with "todays" data. Unfortunately when I read the workbook
programmatically ADO is returning "yesterdays" data. This means to me that
the macros are not running when I open the workbook with ADO. Any
suggestions. Hope I don't need to rewrite the code to open an instance of Excel
to handle the workbook. Answer
ADO accesses only the data saved in the workbook. Nothing vba (or any other)
code does dynamically when the workbook is opened in Excel is available.
Excel macros can only run when the workbook is open in the application
interface.
Either your process needs to duplicate what the macro(s) are doing in order to
update the sheet data or, yes, indeed, you need to first open the workbook in the
Excel environment and execute the macros, then SAVE the changes to the
workbook.
Topic 440
Subject
Excel Formula to Google Docs formatting
Question
I have come here seeking the help of the smarter programers. I am attempting to
create a date controlled document for work. In short, I created formulas for
contact dates. All linked to the Today() function for my computer date. Anyone
contacted < 30 days appears green, >30 but <45 days its yellow and >45 days
its red. I also included some other functions like x= black (remove from list)
and OL = onlist so appear blue. I used to conditional formatting options. I will
show my formulas as they run from B6 to B144 (=$B$6:$B$144) in the
spreadsheet and their order.
Cell value= X
This is the black format.
Cell value= OL
This is the blue format.
Formula=AND(B6 <=TODAY()-30, B6 >TODAY()-45) This is the yellow

format.
Formula=B6<=Today()-45
This is the red format
Formula=B6 > Today()-30
This is the green format.
The problem is I am trying to get cells without a date to show as blank and not
red. For some reason the blank cells appear red. I have tried to use the
Formula=ISBLANK(B6) to format as no fill cell. The cell is not empty but
contains the above formulas. Surely there is a code to make cells without texts
but with formulas appear blank. Excel shows as clear but when I upload to
Google documents, the empty cells appear red. Any help is appreciated.
Answer
You can probably use
=""
as your condition for a 'blank' cell that contains a formula. Alternatively you
could change your condition for red to be
AND(B6<=TODAY()-45, B6>0)
That might help
Topic 441
Subject
Clicking a hyperlink in Excel to set autofilter on a different sheet
Question
I have an Excel workbook with two sheets, basically a one-to-many setup
between the two sheets. The first sheet lists several hundred companies and the
second sheet lists the board of directors of the companies. The second sheet
has an auto filter so users can see board members for a specific company
selected from the filter.
What I am attempting to do is have a user click the cell of the company on the
first sheet so the user is then taken to the next sheet with the auto filter already

populated with the company selected. That way the user has direct access to
the Board Members only for the company selected.
I imagine this would require VBA and was hoping someone could point me in
the right direction for creating this code to solve this. Many thanks. Answer
You can accomplish this by doing something this in the worksheet module:
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel
As Boolean)
'Update Table14 to your table name
'Update Field to column number of the field you are filtering 'Update Sheet7 to
reference the sheet containing your table 'Change on to the column number
where your click should cause this action If ActiveCell.Column = 1 Then
Sheet7.ListObjects("Table14").Range.AutoFilter Field:=1,
Criteria1:=ActiveCell.Value 'Update Sheet7 to reference the sheet containing
your table Sheet7.Activate
End If
End Sub
Answer
You'll need to open the visual basic editor, right click the company worksheet,
view code, paste this in:
Option Explicit
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim CompanyName As String 
      If Selection.Count = 1 Then 
          If Not Intersect(Target, Range("C1").EntireColumn)
Is Nothing Then 
              'This code is triggered when any 
              'ONE cell in column C is selected 
              'Simply change "C1" to "B1" etc etc 
              'This MsgBox returns the selected cell 

              MsgBox Target.Address 
              'You'll probably need to collect some
information 
              'in this section. You can then use this to
affect 
              'the filters on sheet 2. 
              'Perhaps like this 
              CompanyName = Cells(Target.Row, 1).Value 
              MsgBox CompanyName 
              'This changes to "Sheet2" 
              Sheets("Sheet2").Activate 
          End If 
      End If 
End Sub
Hope that helps and you can make something of it
Topic 442
Subject
vba- parse xml that i go from webserver and write it to excel takeing to much
tim
Question
I am trying to write to a excel more 50000 rows that etch row have 11 cells it's
taking me more them 18 minutes to do so. can somebody tell me what am I am
doing wrong?? I am seeing that most of the time is spending on writing into the
Values Variant and not the actual writing into the excel
Thanks Itay
public Sub updateResultsSheet()
Dim ws As Worksheet: Set ws = ActiveSheet Dim NewBook As
Excel.Workbook:Set NewBook = ActiveWorkbook Dim suppDistBranchId As
String
Dim suppProdId As String
Dim reportingDate As String

Dim query As String
Dim nodeCell As IXMLDOMNode
Dim rowCount As Integer
Dim cellCount As Integer
Dim rowRange As Range
Dim cellRange As Range
rowCount = 1
query = "http://******:8080/RS_Excel_API/dailyInvHist/get/1?"
reportingDate = Trim(Range("Parameters!F" + CStr(2)).Value & vbNullString)
   query = query + "reportingDate=" 
   query = query + reportingDate 
Dim Req As New XMLHTTP
Req.Open "GET", query, False
Req.send
Dim Resp As New DOMDocument
Resp.LoadXML Req.responseText
Dim InventoyHistory As IXMLDOMNode
Application.Visible = True
Application.ScreenUpdating = False
Application.DisplayStatusBar = False Application.EnableEvents = False
ws.DisplayPageBreaks = False
Dim OrigCalc As Excel.XlCalculation OrigCalc = Application.Calculation
Application.Calculation = xlCalculationManual
Const BlockSize As Long = 1000
Dim Values() As Variant
ReDim Values(BlockSize, 11)
Dim idx As Long
idx = 1
Dim RowNumber As Long
RowNumber = 2
Dim celInx As Integer
Resp.getElementsByTagName ("DailyInventoryHistory") celInx = 0 

   Dim StartTime As Double 
    StartTime = Timer 
   For Each InventoyHistory In
Resp.getElementsByTagName("DailyInventoryHistory") 
  celInx = 0 
      For Each nodeCell In InventoyHistory.ChildNodes 
          Values(idx, celInx) = nodeCell.nodeTypedValue 
          celInx = celInx + 1 
      Next nodeCell 
      idx = idx + 1 
      If idx = BlockSize - 1 Then 
          With ws 
              .Range(.Cells(RowNumber, 1), .Cells(RowNumber +
BlockSize - 1, 11)).Value = Values 
          End With 
          idx = 1 
          ReDim Values(BlockSize, 11) 
          RowNumber = RowNumber + BlockSize 
      End If 
Next
' write last block
With ws
.Range(.Cells(RowNumber, 1), .Cells(RowNumber + BlockSize - 1,
11)).Value = Values End With
Application.ScreenUpdating = True
Application.Calculation = OrigCalc
Application.Visible = True
Application.DisplayStatusBar = True Application.EnableEvents = True
ws.DisplayPageBreaks = True
MsgBox Format(Timer - StartTime, "0000.00") & " seconds"
End Sub
XMl exmple:
<xML_DailyInventoryHistories>
<DailyInventoryHistory>
<calcOp>0</calcOp>
<calcOq>1</calcOq>

<dmiDistBranchId>0</dmiDistBranchId>
<netQtyAvailable>0</netQtyAvailable> <qtyAvailable>0</qtyAvailable>
<qtyCommittedToSale>0</qtyCommittedToSale>
<qtyOnHand>0</qtyOnHand>
<qtySold>0</qtySold>
<supplierNetPrice>0.599</supplierNetPrice> <usedOp>0</usedOp>
<usedOq>1</usedOq>
</DailyInventoryHistory>
<DailyInventoryHistory>
<calcOp>0</calcOp>
<calcOq>1</calcOq>
<dmiDistBranchId>0</dmiDistBranchId>
<netQtyAvailable>0</netQtyAvailable> <qtyAvailable>0</qtyAvailable>
<qtyCommittedToSale>0</qtyCommittedToSale>
<qtyOnHand>0</qtyOnHand>
<qtySold>0</qtySold>
<supplierNetPrice>0.599</supplierNetPrice> <usedOp>0</usedOp>
<usedOq>1</usedOq>
</DailyInventoryHistory>
</xML_DailyInventoryHistories>
Topic 443
Subject
Jquery - copy excel data into input fields
Question
I am trying to copy excel columns into one input field that will then break up
each excel cell into its own input field. I have it working somewhat but not
with excel data.
For example, if i copy and paste '1 2 3 4 5' into one input field, it will take
each value and paste it into a separate input field.
Example
!http://imgur.com/1UzT1k1
If i copy and paste the data like the example below, it does not work:

!http://imgur.com/fwVAouA
Check out the jsfiddle for an example
https://jsfiddle.net/jdarville/rfsn1sz4/
$("#templateinfo").bind("paste", function(e){ 
          // access the clipboard using the api 
          var pastedData =
e.originalEvent.clipboardData.getData('text'); 
          arr = pastedData.split(' '); 
          for(i=0; i < arr.length; i++){ 
              $("#temp"+i).val(arr[i]); 
          } 
      } ); 
Its splitting the data by ' ' and if i copy and paste excel data it has a space
between information but its not working.
Topic 444
Subject
Are there configuration settings to remember docked toolwindow positions in
the VBE?
Question
I've just installed the Rubberduck add-in.
If I configure my vbe windows so I can see your duck-windows it all looks
lovely but when I restart Excel it is back the way it was before: is there a way
around this so my configuration of the vbe persists? Answer
Yes, it is possible to configure this, but no, it has not been implemented yet.
Essentially, this would involve remembering whether the dockable windows
are currently displayed when the add-in is unloaded.
In order to do this, Rubberduck could store these positions in the settings file
and display them when it is loaded.
If you wish, you can create an issue for this, and the team may implement it in

time for the next release if it has enough support.
Full Disclosure: I am currently working on the Rubberduck Team.
Topic 445
Subject
Writing an IF statement in Excel
Question
I have inserted a check box (form control) with the title "wall". Next to this I
have the cell stating "False" if unticked and "True" if ticked. Next to this are
two cells with the dimensions of the wall "length", "height". - Lastly is the cell
containing "area of the wall".
I want to write an IF statement in the "area of the wall" cell so that when the
check box IS ticked, the area of the wall is printed, and if it is NOT ticked it
prints N/A If have written:
=IF((C2="TRUE"), (D2*E2), ("N/A"))
All that happens is the cell reads N/A, no matter whether the box is ticked or
not. Any help please on how to correct this? Example Answer
True should not be in quotes, it's treating it like a string when it's a boolean.
Removing the quotes should work or writing TRUE()
The final formula should look like this:
=IF((C2=TRUE), (D2*E2), ("N/A"))
Topic 446
Subject
Mismatch Error when adding a new workbook
Question
UPDATE #2: I have split the line from Set ExcelBook = Workbooks.Add to 2
separate lines (Workbooks.Add and Set ExcelBook = ActiveWorkbook) and
am still randomly receiving the error. It does not happen every time, but when
it does it directs me to the line Workbooks.Add (still receiving the same type

mismatch error).
Sub NewWorkbook(CompanyName As String, OutputDirectory As String,
Scenario As String)
Dim ExcelBook As Workbook
Dim CopyArea As Range
Set CopyArea = Range("CopyArea")
Workbooks.Add
Set ExcelBook = ActiveWorkbook
CopyArea.Copy
ExcelBook.Sheets("Sheet1").Range("A1").PasteSpecial xlPasteValues
ExcelBook.Sheets("Sheet1").Range("A1").PasteSpecial xlPasteFormats
ExcelBook.Sheets("Sheet1").Columns(2).EntireColumn.Delete
ExcelBook.Sheets("Sheet1").Rows(6).EntireRow.Delete
ExcelBook.Sheets("Sheet1").Cells.EntireColumn.AutoFit
Application.DisplayAlerts = False
ExcelBook.Close SaveChanges:=True, Filename:=OutputDirectory + "\" +
Replace(Replace(Replace(CompanyName, "\", ""), "/", ""), ":", "") + " - " +
Scenario + ".xlsx" Application.DisplayAlerts = True
Set ExcelBook = Nothing
Set CopyArea = Nothing
End Sub
UPDATE: I have re-worked the code to remove select/activate, but I am still
getting the random mismatch error. When I do receive the error, it does seem to
be creating the new workbook, but stops after that (after receiving the error
and selecting 'End', there is a blank workbook that was not there before).
ORIGINAL DESCRIPTION: I am receiving a mismatch error in the above
code on line 'Set ExcelBook = Workbooks.add'. What is strange is that the
error does not occur every time (I can't seem to find any pattern on why it

happens sometimes and not others).
I have another macro that calls the below code in a 'For' loop. Sometimes it
will finish successfully, other times it will error out on the 1st iteration, other
times on the 5th iteration, etc.
Any thoughts?
Answer
The error could be due to lack of specification on the range assignment,
change:
Set CopyArea = Range("CopyArea")
to
Set CopyArea = ThisWorkbook.Sheets(1).Range("CopyArea")
or change the number to your sheet's name.
Answer
I changed Workbooks.Add to Application.Workbooks.Add and it seems to have
helped.
I still randomly get the mismatch error, but it is a bit less frequent. I'll continue
to try and further refine.
Answer
Try this code. The workbook is created and assigned to the variable in the
same command.
Sub Test()
NewWorkbook "aZ\A", "\\OutputdirectoryServer\Test", "ScenarioA"
End Sub

Sub NewWorkbook(CompanyName As String, OutputDirectory As String,
Scenario As String)
Dim ExcelBook As Workbook
Dim CopyArea As Range
'Create a new workbook with 1 sheet and assign it to the variable. Set
ExcelBook = Workbooks.Add(xlWBATWorksheet)
With ExcelBook.Worksheets(1) 
      'Update this line to look at the correct sheet. 
    
ThisWorkbook.Worksheets("Sheet2").Range("CopyArea").Copy 
      With .Range("A1") 
          .PasteSpecial xlPasteValues 
          .PasteSpecial xlPasteFormats 
      End With 
      .Columns(2).EntireColumn.Delete 
      .Rows(6).EntireRow.Delete 
      .Cells.EntireColumn.AutoFit 
End With
'Save the file using the correct fileformat. 'For an existing file, the default
format is the last file format specified; 'for a new file, the default is the format
of the version of Excel being used. Application.DisplayAlerts = False
ExcelBook.SaveAs OutputDirectory & "\" & _ 
      Replace(Replace(Replace(CompanyName, "\", ""), "/",
""), ":", "") & " - " & Scenario & ".xlsx", _ 
      FileFormat:=51 
ExcelBook.Close False
Application.DisplayAlerts = True
Set ExcelBook = Nothing
Set CopyArea = Nothing

End Sub
Topic 447
Subject
Stored procedure called in VBA keeps going to default value for a parameter
Question
I have a stored procedure which I am calling from Excel. One of the
parameters is a float, and it seems to not be getting to SQL Server. The results
are fine in server and when I hardcode the query in VBA. I traced it in SQL
Server profiler and it's passing in the default, null aka user didn't specify. What
could be going on here?
The stored procedure:
CREATE PROCEDURE um.topStudents
@semesterStart datetime,
@semesterEnd datetime,
@SchoolID AS char(10) = null,
@gradeThreshold AS float = null
AS
BEGIN
SELECT TOP 20 
      sc.schoolname AS School, 
      sd.Last, sd.First, sd.SSN, sd.DOB 
  FROM 
      dbo.StudentRecords sr 
  INNER JOIN 
      dbo.lkpmajor mj ON r.major = mj.code 
  INNER JOIN 
      dbo.tblstudDemo sd ON sr.SchoolID = sd.schoolid AND
r.SSN = sd.SSN 
  INNER JOIN 
      dbo.tblschools sc ON sr.SchoolID = sc.code 
  WHERE 
      r.StartDate between @semesterStart AND @semesterEnd 
      AND ((sr.SchoolID = @SchoolID ) OR (@SchoolID IS NULL))
      AND sr.major = '03' 
      AND sr.program = 'scholarship' 

      AND ((sr.grade>@gradeThreshold ) OR ((@gradeThreshold
IS NULL) AND (gradeThreshold >=3.0))) 
  ORDER BY 
      sr.grade DESC; 
END
The VBA:
Private Sub topStudents_Grades_Thres(semesterstart As String, semesterend
As String, Optional ByVal gradethreshold As Double)
'New ADODB Connection
....
'New ADODB Command
'With ADODB Command 
      'use connection 
      'open stored procedure 
      .Parameters.Append
cm_TopStud.CreateParameter("@semesterStart", adChar,
adParamInput, 8, semesterstart ) 
      .Parameters.Append
cm_TopStud.CreateParameter("@semesterEnd ", adChar,
adParamInput, 8, semesterend) 
      .Parameters.Append
cm_TopStud.CreateParameter("@gradeThreshold", adDouble,
adParamInput, gradethreshold) 
      .CommandTimeout = 300 
End With
'Open command with recordset
'Set range & copy from recordset
'Close recordset & connection
End Sub
Call topStudents_Grades_Thres("20150701", "20160204", 2.75)

UPDATE: trying to figure out why parameters aren't going through to SQL
Server:
CREATE PROCEDURE [UM].[usp_Test]
@intParameter as int = null
as
BEGIN
IF (@intParameter IS NULL)
SELECT 1 + 0 AS [Test]
ELSE
SELECT 1 + @intParameter AS [Test] END
The number not going through:
Private Sub TestSub(Optional ByVal num As Integer)
....
.Parameters.Append cm_numTest.CreateParameter("@intParameter",
adInteger, adParamInput, num) ....
End Sub
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim num As Integer
num = CInt(Worksheets("Sheet1").Range("D1")) If ActiveCell.Address =
"$A$1" Then
Call TestSub(num)
End If
End Sub
Answer
Your VBA code is sending only 3 values (semesterStart, semesterEnd,
gradeThreshold) as SQL Procedure input parameters. The SQL procedure is
expecting 4 input parameters; however, the missing input parameter (SchoolID)
is defined as default NULL in your SQL Procedure.

You have to add ".Parameters.Append cm_TopStud.CreateParameter(...)" to
your VBA for the SchoolID, and modify your [Call
topStudents_Grades_Thres("20150701", "20160204", 2.75)] to something like
[Call topStudents_Grades_Thres("20150701", "20160204", "123456", 2.75)],
assuming "123456" is a School ID.
Answer
Thanks! I got it working! Changed to the correct data type and also changed the
create append parameter lines from this:
.Parameters.Append cm_TopStud.CreateParameter("@semesterStart", adChar,
adParamInput, 8, semesterstart )
to this:
Dim param_semesterStart As ADODB.Parameter Set param_semesterStart =
New ADODB.Parameter
With cm_TopStud
....
Set param_semesterStart= .CreateParameter("@semesterStart", adDBDate,
adParamInput) param_semesterStart.Value = semesterstart .Parameters.Append
param_semesterStart ....
End With
Also plugging into "The Matrix" helped as well :P
Topic 448
Subject
Automatically fill data from another sheet
Question
Main Question
I would like to auto-fill Sheet A with values from Sheet B in Excel 2013. My
data are in two sheets in the same workbook.

Example
=========== Sheet 1 =========== =========== Sheet 2
=========== 
location   year   val1   val2       location   year   val1  
val2 
USA.VT     1999                     USA.VT     1999     6    
3 
USA.VT     2000                     USA.VT     2000     3    
2 
USA.VT     2001                     USA.VT     2001     4    
1 
USA.VT     2002                     USA.VT     2002     9    
5 
USA.NH     1999                     USA.NH     1999     3    
6 
USA.NH     2000                     USA.NH     2002     12    
56 
USA.NH     2001                     USA.ME     1999     3    
16 
USA.NH     2002                     USA.ME     2002     4    
5 
USA.ME     1999 
USA.ME     2000 
USA.ME     2001 
USA.ME     2002 
I would like to use some function or formula to automatically populate Sheet 1
based on the values in Sheet 2 according to: location, year, and the column
(val1 or val2). Non-matches would be zero-filled.
This would result in the following:
=========== Sheet 1 ===========
location year val1 val2 
USA.VT     1999    6      3 
USA.VT     2000    3      2 
USA.VT     2001    4      1 
USA.VT     2002    9      5 
USA.NH     1999    3      6 

USA.NH     2000    0      0 
USA.NH     2001    0      0 
USA.NH     2002    12     56 
USA.ME     1999    3      16 
USA.ME     2000    0      0 
USA.ME     2001    0      0 
USA.ME     2002    4      5 
I have tried VLOOKUP, INDEX, and MATCH, but I'm having no luck.
Any help would be greatly appreciated!
Answer
Put this Array formula in C2:
=IFERROR(INDEX(Sheet2!C$2:C$9,MATCH($A2&$B2,Sheet2!$A$2:$A$9&
Being an array formula you must confirm with Ctrl-Shift-Enter to exit the edit
mode instead of Enter.
Then copy over one column and down.
The picture is not exact because I left it on one sheet.
Topic 449
Subject
Excel VBA Goalseek
Question
I am trying to leverage the goalseek command in VBA in an excel spreadsheet.
I have a value in F3, F7, and F18. When I change the value in F3 I get this
error back:
Run-time error '1004':
Reference is not valid
Here is the code
Private Sub Worksheet_Change(ByVal Target As Range) With

Worksheets("Mdl")
If Target = Range("F3") Then
Range("F3").GoalSeek Goal:=Range("F7"), ChangingCell:=Range("F18")
End If
End With
End Sub
Answer
The Goalseek requires a formula in the cell you are creating it, so if you
change the Range("F3") for a value instead of a formula the error will appear.
Topic 450
Subject
Use Application.Wait immediately after a workbook opens
Question
I need my workbook to display a certain color after I open it. Then after 5
seconds I would like the color to change. So I implemented to following code:
Private Sub Workbook_Open()
Application.ActiveSheet.Cells.Interior.ColorIndex = 4 Application.Wait (Now
+ TimeValue("0:00:05")) Application.ActiveSheet.Cells.Interior.ColorIndex =
5 End Sub
However when I click on my file, it loads for 5 seconds and then opens and
displays only the second color. How would I fix this while still using
application.wait. Answer
I tested this and it worked.
Use this in the Workbook_Open
Private Sub Workbook_Open()
'Schedules a procedure to be run at a specified time in the future '(either at a
specific time of day or after a specific amount of time has passed).

Application.OnTime Now + TimeValue("00:00:01"), "DoThis" End Sub
Put this in a module. Not Thiswork or it won't work
Private Sub DoThis()
Application.ActiveSheet.Cells.Interior.ColorIndex = 4 Application.Wait (Now
+ TimeValue("0:00:05")) Application.ActiveSheet.Cells.Interior.ColorIndex =
5 End Sub
Answer
To directly answer the posed question, here's a workaround without using
OnTime if you really, really had to...
It is possible to fire an event immediately after Workbook_Open. You could
force a Worksheet_Activate event by manipulating the active sheet in the
Workbook_Open sub. Then you could use your original Application.Wait code
inside of Worksheet_Activate.
Private Sub Workbook_Open()
Application.ActiveSheet.Cells.Interior.ColorIndex = 4 Sheets(2).Activate
Sheets(1).Activate
End Sub
Private Sub Worksheet_Activate()
Application.Wait (Now + TimeValue("0:00:05"))
Application.ActiveSheet.Cells.Interior.ColorIndex = 5 End Sub
Topic 451
Subject
Differentiate between named range and table
Question
I have some processing where I am iterating through the names in an Excel
workbook and am grabbing the name of the sheet where the range or table
resides. works fine so long as the name is a named range

Me.TextBox2 = ThisWorkbook.Names(Me.ListBox1.Value).Parent.Name
but when it's a table, I know that you need to code it like this....
Me.TextBox2= Sheets(ictr).ListObjects((Me.ListBox1.Value).Parent.Name
Since the way to get the parent is different for a ListObject than it is for a
named range, is there some way I can test to see which one I am dealing with,
other than checking for an error and then splitting the process from that point?
Sub MySub
Dim errnum As Integer
On Error Resume Next
Me.TextBox1 = Range(Me.ListBox1.Value).Address Me.TextBox2 =
ThisWorkbook.Names(Me.ListBox1.Value).Parent.Name errnum = Err.Number
If errnum <> 0 Then
Me.TextBox2 =
Sheets("TABLE").ListObjects(Me.ListBox1.Value.Parent.Name) End If
end sub
This is what I have come up with, is there a better way?
Topic 452
Subject
Determining values when looping through multiple ranges in VBA
Question
I am working on a macro to set chart max and mins based on a dynamic data
set. When the user chooses their group, the chart updates, and the macro runs to
update the chart max and min values to an appropriate scale.
I am hoping someone can help me as I try to use variables from 3 ranges to:
Choose chart based on cell value in range Set min based on cell value in range
Set max based on cell value in range
At this point I am able to pull out the chart name, but am having trouble getting
the value for min and max from the range.

Any help would be appreciated!
Sub rescale()
ActiveSheet.Calculate
Dim ChrtNmRng As Range
Dim ChrtMinRng As Range
Dim ChrtMaxRng As Range
Dim cell As Range
Set ChrtNmRng = Sheets("Data").Range("o5:o20") Set ChrtMinRng =
Sheets("Data").Range("z5:z20") Set ChrtMaxRng =
Sheets("Data").Range("Aa5:Aa20")
For Each cell In ChrtNmRng
With Sheets("Dashboard").ChartObjects(cell.Value).Chart.Axes(xlValue)
.MinimumScale = ChrtMinRng.Value
.MaximumScale = ChrtMaxRng.Value
End With
Next cell
End Sub
Answer
Do it like this:
Sub rescale()
Dim ChrtNmRng As Range, cell As Range
ActiveSheet.Calculate
Set ChrtNmRng = Sheets("Data").Range("o5:o20")
For Each cell In ChrtNmRng 

      With
Sheets("Dashboard").ChartObjects(cell.Value).Chart.Axes(xlValue
          .MinimumScale = Range("Z" & cell.Row) 
          .MaximumScale = Range("AA" & cell.Row) 
      End With 
   Next cell 
End Sub
The key here is that your ranges for the minimum and maximum values (Z and
AA) line up precisely with column O so you can use the row reference to get
the corresponding values you need.
Answer
As I understand your comments. Column O contains the name of the charts and
the others contain what is wanted as the min and max for each of those charts.
Sub rescale()
ActiveSheet.Calculate
Dim ChrtNmRng As Range
Dim ChrtMinRng As Range
Dim ChrtMaxRng As Range
Dim i As Long
Set ChrtNmRng = Sheets("Data").Range("o5:o20") Set ChrtMinRng =
Sheets("Data").Range("z5:z20") Set ChrtMaxRng =
Sheets("Data").Range("Aa5:Aa20")
For i = 1 To 16
With
Sheets("Dashboard").ChartObjects(ChrtNmRng(i).Value).Chart.Axes(xlValue)
.MinimumScale = ChrtMinRng(i).Value .MaximumScale =
ChrtMaxRng(i).Value End With

Next i
End Sub
Topic 453
Subject
Changing values of a specific column within a range
Question
I want to set the values of a column within the current selected range. For
example, the current selected range (which could vary) is A5:D10, I want the
values in column B of the range to be "Something". I'm guessing it would be
something like:
ActiveCell.Columns("B").Value="Something"
Thanks.
Answer
You could also use the Intersect() function...
Sub Intersetion_Example()
Dim rngB As Range
Dim rngResult As Range
Set rngB = Columns("B")
Set rngResult = Intersect(Selection, rngB)
rngResult.Value = "Something"
End Sub
Topic 454
Subject
Find particular cells to copy to main workbook
Question
I want to find a particular cell in an opened worksheet and copy the data 3

cells to the right into the main workbook (not the one that has just been
opened).
The macro below loops through all the files in a txt doc and opens and closes
them. In each file is a cell called ADA and I want to copy the cells 3 to the
right, however ADA is not always in the same place so I need to search for it.
e.g find the cell ADA and say it is in E6 in that workbook, I need to copy E6
along with H6,I6 and J6 into the original main workbook that I am running the
macro from.
Sub GatherData()
Dim objFSO As Object
Dim objWB As Workbook
Dim strFN As String
Dim objTF As Object
Set objFSO = CreateObject("Scripting.FileSystemObject") Set objTF =
objFSO.OpenTextFile("U:\Time series project\doclist.txt") On Error Resume
Next
Do While Not objTF.AtEndOfStream
strFN = objTF.readline()
Set wb = Workbooks.Open(strFN)
If wb Is Nothing Then
Debug.Print strFN
Else 
      wb.Close False 
      Set wb = Nothing 
End If
Loop
On Error GoTo 0
End Sub
I was thinking of adding something like

Dim c As Range
Dim newcell
Dim tmp
Dim wrkbk As WorkBook
Dim sht As WorkSheet
Set c = .Find(findValues(i), LookIn:=xlFormulas) If Not c Is Nothing Then
newcell = c.Offset(0, 4).Value
Do 
      tmp.Offset(0, 2).Value = tmp.Value 
      tmp.Offset(0, 3).Value = newcell 
End If
but can't get this concept to fit into the first code. Answer
You can simply use
Dim copyrange as Range
Dim originalcell, startingcell, endingcell as String
originalcell = sht.Range("ADA").Address startingcell =
sht.Range("ADA").Offset(0,3).Address endingcell =
sht.Range("ADA").Offset(0,5).Address
copyrange = originalcell & "," & startingcell & ":" & endingcell
Then just copy that range and paste where you would like.
Topic 455
Subject
Automatically colour the absolute complete reference cell
Question
I have Sheet 1 and Sheet 2 . Sheet 2 A2 has the name of cities. I have used
absolute reference (i.e. =) to link the name of cities from sheet 2 A2 to sheet 1

A1.
Now what I am trying to do is whenever I link cities' names from Sheet 2 A2 to
Sheet 1 A1, I want the linked cities cell to automatically turn into red
background colour. This way I can know which city's name from sheet 2 A2
has been linked to Sheet 1 A1.
Can anyone please help me on this. This would really save a lot of time in my
work Answer
You don't need VBA. Use conditional formatting:
Highlight your list of countries in Sheet2 From menu: Conditional formatting >
New Rule > Use a formula... Type this formula in: =$A2:$A10=Sheet1!$A$1
Set the format e.g. bold, red background...
Clearly adjust the formula to match your cell references.
Answer
You can use a Macro 4.0 function to return the formula in the cell and look in
the formula to see if Sheet1! exists. No VBA required.
Select cell A1 on Sheet2.
create a named range called IsReference: =GET.CELL(41,Sheet2!A1) Note
that A1 is a relative reference (no $ in it). Create a conditional format:
Use a formula to determine which cell to format:
=IFERROR(FIND("Sheet1!",IsReference),0)<>0
NB - the 41 in the formula:
41 Returns the formula in the active cell without translating it (useful for
international macro sheets).
http://www.mrexcel.com/forum/excel-questions/20611-info-only-get-cell-
arguments.html
Topic 456
Subject
Vlookup in a Loop Process to Change Save Filename VBA

Question
All - I am looking to write a loop where I can change the filename and folder
location depending on the value that it runs in the loop. For example, if I am
running the macro from cells G2:G7, when the process moves from G2 to G3, I
want the filename and folder location to change according to some reference
table (look image for details). Effectively, I want the filename and foldername
to be lookups to the Fund Types.
Public Sub Get_File()
Dim sFiletype As String 
  Dim sFilename As String     'Save the file as this name, if
"" then default 
  Dim sFolder As String       'Save to this folder, if ""
then default 
  Dim bReplace As Boolean     'To replace the existing file
or not 
  Dim sURL As String          'The URL to the location to
extract information 
Dim cell, Rng As Range
Dim sheet As Worksheet
'Initialize variables
Set Rng = Range("I2:I10")
Set sheet = ActiveWorkbook.Sheets("Macro_Button")
For Each cell In Rng 
      If cell <> "" Then 
      sFiletype = cell.Value 
      sFilename = sFiletype & "_" & Format(Date, "mmddyyyy") 
      sFolder =
Application.WorksheetFunction.VLookup(sFiletype,
sheet.Range("G2:J10"), 4, False) 
      bReplace = True 
      sURL = "www.preqin.com" 

      'Download using the desired approach, XMLHTTP / IE 
      Call Download_Use_IE(sURL, sFilename, sFolder,
bReplace) 
      Else 
      Exit Sub 
      End If 
Next
End Sub
Thanks everyone for your input!
http://i.stack.imgur.com/M6GSs.png
Answer
Therein lies the limitation of VLookUp where matches must align to the
leftmost column and only searches to the right. As advised in the popular web
search, consider an Index/Match replacement which compares column to
column and returns value on matched row (in any direction):
sFolder = Application.WorksheetFunction.Index(sheet.Range("G2:J10"), _
Application.WorksheetFunction.Match(sFiletype, sheet.Range("I2:I10"), 0), 4)
If needing to use VLookUp(), you would need to decrease your lookup range:
sFolder = Application.WorksheetFunction.VLookup(sFiletype,
sheet.Range("I2:J10"), 2, False)
Answer
Instead of vlookup, I suggest placing the exact folders into the code given that
you only have 8 choices. This makes it readily obvious for debugging. You can
do this via a case statement. See here for more information.
Select Case sFilename
Case abc

sFolder = "C:\One\"
Case def
sFolder = "C:\Two\"
Case ghi
sFolder = "C:\Three\"
'so forth for 8 cases...
End Select
Topic 457
Subject
Export large html table to excel
Question
I want to export html table to excel so I'm using this javascript code:
var tableToExcel = (function () {
var tds = document.getElementsByTagName("td"); 
      var uri = 'data:application/vnd.ms-excel;base64,' 
              , template = '<html xmlns:o="urn:schemas-
microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-
com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<meta http-equiv="content-type" content="application/vnd.ms-
excel; charset=UTF-8"><head><!--[if gte mso 9]><xml>
<x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>
{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/>
</x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets>
</x:ExcelWorkbook></xml><![endif]--></head><body><table x:str>
{table}</table></body></html>' 
              , base64 = function (s) { 
                  return
window.btoa(unescape(encodeURIComponent(s))) 
              } 
      , format = function (s, c) { 
          return s.replace(/{(\w+)}/g, function (m, p) { 
              return c[p]; 
          }) 
      } 

      return function (table, name) { 
          if (!table.nodeType) 
              table = document.getElementById(table); 
          var ctx = {worksheet: name || 'Worksheet', table:
table.innerHTML} 
          window.location.href = uri +
base64(format(template, ctx)) 
      } 
})();
At first,this code work fine form me ,but in very large table it does not because
the uri is too long for the window.location.href. Is their any soution to export
large table to Excel ?
Topic 458
Subject
R: Unlist a list of dataframes
Question
This is possibly a really simple question. I have a list of dataframes (df1,
df2.... dfn), i.e. each element of the list is a dataframe. So basically, the list
was created like this:
mylist = list(df1, df2,...., dfn)
But how do I do the reverse, that is unlist so that df1, df2, etc. reside
separately in the workspace? Answer
Use list2env it is specially designed for this:
From a named list x, create an environment containing all list components as
objects, or “multi-assign” from x into a pre-existing environment.
So here :
list2env(mylist ,.GlobalEnv)
Answer

You could simply use a for-loop along with the assign function like that:
# Sample data
df.list <- list(data.frame(x = 1:3, y = c(10, 20, 30)), 
              data.frame(x = 4:6, y = c(40, 50, 60)), 
              data.frame(x = 7:9, y = c(70, 80, 90))) 
# Write out single data frames
for (i in seq(df.list))
assign(paste("df", i, sep = ""), df.list[[i]])
Topic 459
Subject
Excel - sorting and inserting blank cells in two product/quantity columns
Question
I am running a medium sized inventory audit of scanned parts on hand and what
our system thinks we should have. We will scan all parts (not in # order) on a
shelf and insert a second column with the complete inventory (in # order).
When I auto-sort, I need Excel to insert a blank cell where the two columns do
not match so we can see where we need to either add or remove items from
our system. How would I go about getting this done?
It is also possible to have this with a second and fourth column (next to each
part number) with actual part number quantity values so we can see the actual
quantity on hand variances?
The biggest issue is getting the blank cell values where the two do not meet at
all. I'm sure this has an easy solution, but I am still learning...
Thanks in advance.
Topic 460
Subject
COUNTIF with multiple criteria and list

Question
I need to count the number of cells in which 'CRITERIA 1' is satisfied,
'CRITERIA 2' is satisfied and 'CRITERIA 3' falls within the set of values
contained in column E.
I am currently using the following formula:
=SUM(COUNTIFS(A2:A11,"TRUE",B2:B11,"TRUE",C2:C11,
{"2","4","6","9","10"}))
But in my real table, the list of data within 'CRITERIA 3' is longer and more
complicated and I would prefer to reference the cells in column E rather than
the specific data, i.e. something like:
=SUM(COUNTIFS(A2:A11,"TRUE",B2:B11,"TRUE",C2:C11,{"E2:E6"}))
Please note that the data contained in this example is different to the data in my
real table. The real table is considerably longer and more complex than this
table.
Any suggestions?
Answer
Decided to put my comment as an answer so I can show a picture that it works:
You are close. The Range is an array so no need for the {""} wrapper
Just use:
=SUM(COUNTIFS(A2:A11,"TRUE",B2:B11,"TRUE",C2:C11,E2:E6))
This is an array formula and must be confirmed with Ctrl-Shift-Enter.
Answer
You could try SUMPRODUCT
=SUMPRODUCT((A2:A11="TRUE")*(B2:B11="TRUE")*(E2:E6="2"))

Answer
Using COUNTIFS the only way I'd know of to check a value is in a list is to
create a dummy column that has that check and make that column Criteria3
instead of the actual value.
Going from your example, you'd drop in the following formula in Column D
(set text to white so the workbook doesn't look ugly): =IF(COUNTIF(E$2:E$6,
C2)>0, 1, "")
Then your Criteria3 updates such that you have: =SUM(COUNIFS(A2:A11,
"TRUE", B2:B11, "TRUE", D2:D11, 1))
If that's non-ideal, the only other way I can think of would be to use a macro to
get that SUM for you.
Topic 461
Subject
Read data from excel including the style applied to it
Question
I am trying to write a C~ console application which will read data from excel
sheet. I have seen couple of tutorial which tells how we can read data from
excel sheet, but one thing I could not find is how to read the style if any applied
to the text.
.
If you see the excel image it word green is in green colour and Yellow is bold.
I want that C# should be able to pick the style as well so I can convert it into
HTML style.
I am open to any third party library as well Answer
You should be able to use the CellFormat.Font property in order to get a Font
object from which you can get the color and style of the font in the cell.
https://msdn.microsoft.com/en-
us/library/microsoft.office.interop.excel.cellformat.font.aspx

Answer
Using EPPlus:
string filePath = "...";
var file = new System.IO.FileInfo(filePath); using (ExcelPackage p = new
ExcelPackage(file)) {
var ws = p.Workbook.Worksheets[1];
var style = ws.Cells[1, 1].Style;
}
Check EPPlus project site for code samples. They illustrate usage of a library
pretty well.
Answer
If you want to get the style for parts of a cell and not for the whole cell as in
your example you can use the Excel.Range.Characters indexer to obtain a
Characters object. This object has a property Font with which you can access
the actual style information. This could look something like this:
var xlApp = new Application();
var workbook = xlApp.Workbooks.Open("c:\\temp\\exceltest.xlsx");
Worksheet sheet = workbook.Sheets[1];
Range cell = sheet.Cells[1, 1]; // get first cell as an example
int textLength = range.Text.ToString().Length; for (int charCount = 1; charCount
<= textLength; charCount++) {
Characters character = cell.Characters[charCount, 1]; bool bold =
(bool)character.Font.Bold; bool italic = (bool)character.Font.Italic; Color
fontColor =
System.Drawing.ColorTranslator.FromOle((int)character.Font.Color); }
Note that you have to add a reference to Microsoft.Office.Interop.Excel and
you need to have Excel installed.

Topic 462
Subject
VBA - Only Check for Date inside a DD/MM/YYYY - HH/MM/SS value
Question
I've checked through multiple topics but I unfortunately couldn't find the
solution I need.
I have cells which needs to include Date and Time in the following custom
format: dd/mm/yyyy hh:mm
And I have something that check those cells to see if it matches. If it does, it
notifies me that it is approaching its due time.
Dim MyLimit As Double
MyLimit = Date
Set FormulaRange = Range("E5:E35")
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If .Value = MyLimit Then 
              Do the action 
This works properly if I set a date value such as 02/05/2016 in the cells, as it
default to midnight and it triggers the action. Although 02/05/2016 2:45 PM
doesn't work.
So what I need it to do is to check only the first part of the cell for the date
value and trigger the action if it fits with today's date.
I tried a few solutions such as:
Dim MyLimit As Double
MyLimit = CDate(format(Date, "dd-mmm-yyyy"))

Set FormulaRange = Range("E5:E35")
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If .Value = MyLimit Then 
              Do the action 
and
Dim MyLimit As Date
MyLimit = Format((Now), "DD/MM/YYYY")
Set FormulaRange = Range("E5:E35")
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If .Value = MyLimit Then 
              Do the action 
But it doesn't work. It doesn't detect that it should do the action as the date =
today.
Anyone can enlighten me on this?
Actual script:
Option Explicit
Public Function AutoRun()
Application.OnTime Now + TimeValue("00:01:00"), "TaskTracker2" End
Function
Public Sub TaskTracker2()
Dim FormulaCell As Range
Dim FormulaRange As Range 

Dim NotSentMsg      As String 
Dim MyMsg           As String 
Dim SentMsg         As String 
Dim SendTo          As String 
Dim CCTo            As String 
Dim BCCTo           As String 
Dim MyLimit         As Double 
Dim MyLimit2        As Double 
NotSentMsg = "Not Sent"
SentMsg = "Sent"
SendTo = Range("D2")
CCTo = Range("E2")
BCCTo = Range("F2")
MyLimit = Date
MyLimit2 = ((Round(Now * 1440, 0) - 30) / 1440)
Set FormulaRange = Range("E5:E35")
On Error GoTo EndMacro:
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If DateValue(.Value) = MyLimit Then 
              MyMsg = SentMsg 
              If .Offset(0, 1).Value = NotSentMsg Then 
                  strTO = SendTo 
                  strCC = CCTo 
                  strBCC = BCCTo 
                  strSub = "[Task Manager] Reminder that you
need to: " & Cells(FormulaCell.Row, "A").Value 
                  strBody = "Hello Sir, " & vbNewLine &
vbNewLine & _ 
                      "This email is to notify that you that
your task : " & Cells(FormulaCell.Row, "A").Value & " with the
following note: " & Cells(FormulaCell.Row, "B").Value & " is
nearing its Due Date." & vbNewLine & "It would be wise to
complete this task before it expires!" & _ 
                      vbNewLine & vbNewLine & "Truly yours,"
& vbNewLine & "Task Manager" 
                  If sendMail(strTO, strSub, strBody, strCC)
= True Then MyMsg = SentMsg 

              End If 
          Else 
              MyMsg = NotSentMsg 
          End If 
          If .Value = MyLimit2 Then 
              MyMsg = NotSentMsg 
          End If 
      Application.EnableEvents = False 
      .Offset(0, 1).Value = MyMsg 
      Application.EnableEvents = True 
End With
Next FormulaCell
AutoRun
ExitMacro
Exit Sub
EndMacro
Application.EnableEvents = True
MsgBox "Some Error occurred." _ 
   & vbLf & Err.Number _ 
   & vbLf & Err.Description 
End Sub
Answer
So what I need it to do is to check only the first part of the cell for the date
value
Use the DateValue function, e.g.:
If DateValue(.Value) = MyLimit Then
' Do the action

NB: a Date type consists of Date and Time parts.
The DateValue function returns only the Date Part of a Date type. There is also
the TimeValue function which returns only the Time Part from a Date type.
Some revisions for your Mismatch error, tested with the value 2/5/2016 14:45:
Dim MyLimit As Date
MyLimit = Date
Set FormulaRange = Range("E5:E35")
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If DateValue(.Value) = MyLimit Then 
              ' Do something... 
Topic 463
Subject
This VBA script for sorting through Excel data is causing a “Not Responding”.
Can anyone suggest a more efficient alternative?
Question
I'm fairly new to VBA, and most of my scripts tend to be pretty inefficiant,
even when there are neater ways out there. This one currently works if I keep
i<=20 but I need to increase it to i<2000. Even increasing this to 50 causes a
Not Responding response.
The code aims to sort through a list of words ("list") and find them in a large
array called "library." The "library" contains multiple columns with numbers
on each header. What I want is to write a script that will go down the list, and
insert number for the columns each entry occur in throughout the library. This
usually goes as far as i = 20 and then stalls.
Sub ListLibraryCompare()

Dim Rng As Range
Dim Keyword As Range
Dim Chunk As Range
Dim Library As Worksheet
Dim List As Worksheet
Dim Bottom As Range
Dim i As Long
Dim x As Long
i = 1
x = 0
While i <= 20
Set Library = Sheets("Library")
Set List = Sheets("List")
Set Keyword = List.Range("A" & i)
Set Bottom = Library.Range("A150").Offset(0, x) Set Rng =
Library.Range("A1").Offset(0, x) Set Chunk = Library.Range(Rng, Bottom)
Application.ScreenUpdating = False
If IsEmpty(Rng.Value) = True Then 
      i = i + 1 
      x = 0 
  ElseIf Application.WorksheetFunction.CountIf(Chunk,
Keyword) = 0 Then 
      x = x + 1 
  ElseIf Application.WorksheetFunction.CountIf(Chunk,
Keyword) = 1 Then 
      Rng.Copy 
      Keyword.Offset(0, 1).Insert Shift:=xlToRight 
      x = x + 1 
End If
Wend
End Sub

Any feedback would be greatly appreciated. Even a starting point for a new
approach would be welcomed.
Topic 464
Subject
VBA: copy paste from selected workbooks based on cell value
Question
I want to copy data from selected different workbooks based on cell value and
paste it to one single workbook
enter code here
Sub Ram_copypaste()
Dim w As Workbook
Dim A As String
Dim x As Worksheet
Dim j As Integer
Dim i As Integer
j = cells(2, 1).Value
A = "Portfolio"
B = ".xlsx"
For i = 1 To j
Set w = A & i & B
Set x = A & i
w.Worksheets("Download1").Range("A1:H14").Copy Workbooks("TE
copypaste.xlsx").x.cells(1, 1).PasteSpecial xlPasteValues Next i
End Sub
Answer
Try this:
Use Debug.Print at various points to understand your code better.
Sub Ram_copypaste()
Dim w As Workbook
Dim A As String, B As String
Dim x As Worksheet
Dim j As Integer
Dim i As Integer

j = cells(2, 1).Value 'Use Debug.Print to check the value of J A = "Portfolio"
B = ".xlsx"
For i = 1 To j
Set w = workbooks(A & i & B) 'Make sure you already have a workbook
'with the same name as A & i & B opened otherwise this will give error. If
'you don't have it opened but have it on your drive first open it and then set it.
set x = w.sheets(A & i) 'As suggested by Anil Kumar to avoid Type Mismatch
error w.Worksheets("Download1").Range("A1:H14").Copy Workbooks("TE
copypaste.xlsx").x.cells(1, 1).Select Workbooks("TE
copypaste.xlsx").x.cells(1, 1).PasteSpecial xlPasteValues
Application.CutCopyMode = False
Next i
End Sub
Answer
Anil called it, you're declaring x as a worksheet
Dim x As Worksheet
but you're trying to set it equal to a string
A = "Portfolio"
For i = 1
Set x = A & i
You're also doing the same thing with W except as a workbook
Maybe try something like
set w = Workbooks.Open(<path>\<filename>) set x = w.sheets(A & I)
If the value in cells(2,1) is non numeric you'll get a type mismatch error.
This piece at the top will give you some issues
enter code here

This might be more suited to what you mentioned in your comment:
Sub test()
Dim workBookPath As String, filename As String Dim i As Long, j As Long
Dim awb As Workbook, w As Workbook
Dim x As Worksheet
Set awb = ActiveWorkbook
workBookPath = "C:\users\mt390d\Documents\Reports\"
If IsNumeric(Cells(2, 1)) Then 
      j = Cells(2, 1).Value 
      Else: MsgBox ("Cell A2 must contain a number") 
      Exit Sub 
End If
For i = 1 To j
filename = Dir(workBookPath)
If filename <> awb.Name Then 
      Set w = Workbooks.Open(workBookPath & filename) 
      Sheets("Download1").Copy awb.Sheets(1) 
      Set x = ActiveSheet 
      On Error Resume Next 
          x.Name = "Portfolio" & i 
      On Error GoTo 0 
      w.Close 
End If
filename = Dir()
Next i
End Sub
Topic 465

Subject
SUMIF formula doesn't give the correct answer in excel vba
Question
I'm using this SUMIF formula but it gives me a wrong output. Can anybody
help me? I have checked a lot of times but unable to find the mistake! Thanks in
advance!
Range("B10", Range("B10").Offset(0, -1).End(xlDown).Offset(0, 1)).Formula
= "=SUMIF('[" & Destname & "]Cu Part PVO L'!$M$10:$M$2000,A10," &
"'[" & Destname & "]Cu Part PVO L'!$AD$10:$AD$2000)" [Output][1]
Answer
To clarify my VBA only approach here's a rough out:
Dim i as Long
DIM wb as Workbook
SET wb = Applications.Workbooks.Open(Dest_Name) 'Dest_name would
need to be the full file
'path, i.e. C:\<Folder 1>\<Folder 2>\....\<File Name>.<file extension> Dim
CPPL as Worksheet
Set CPPL = Workbooks(Dest_Name).Worksheets("Cu Part PVO L") Dim v as
String 'change the type based on what's in A10 v = Range("A10").Value
Dim t as long
i = 10
Do While i < 2001
If CPPL.Range("M" & i).value = v THen
t = t + CPPL.Range("AD" & i).value End if
i = i + 1
Loop
Range("B10", Range("B10").Offset(0, -1).End(xlDown).Offset(0, 1)).Value = t
As an added bonus, this way, if Dest_Name isn't open the values will still

display instead of erroring.
Topic 466
Subject
Compare two columns for new values
Question
I am trying to come up with a formula that will allow me to compare two
columns of names (A & B) and tell me how many new names there are in
column B, that are not present in column A. That is, names that are not present
in column A, but are present in column B, and return this as a numerical value.
Any ideas??
Answer
Quick an simple way is to drag a box/highlight around all the data you want to
check (eg columns A and B) and then press F5 to open the goto box. Click
special at the bottom and then check the 'Row differences' radio button. Click
OK and it will highlight all differences.
Answer
If you use a helper column then it would easier to achieve that. Suppose your
data in Column A and Column B then use Column C as helper column put this
formula in C2 cell.
=IF(B2="","",IFERROR(MATCH(B2,A:A,0),"New"))
Then put below formula in D2 cell.
=COUNTIF(C:C,"New")
Topic 467
Subject
vba macro to create .txt list of filepaths
Question
I have a macro to list out all the files in subfolders of a particular folder. what
I want to do is create a .txt file in the main folder that has a list of all the

filepaths? Basically a macro to create a txt file which lists column A of my
excel spreadsheet. I know this is easy to do without vba(you just save as a text
file) but i need to find a way to automate it?! Answer
If you already have the data in column A then:
Sub MkFile()
Dim N As Long, i As Long
N = Cells(Rows.Count, "A").End(xlUp).Row Close #1
Open "C:\TestFolder\TestFile.txt" For Output As #1 For i = 1 To N
Print #1, Cells(i, "A").Value
Next i
Close #1
End Sub
Change the folder or file names to suit your needs.
Topic 468
Subject
Is there a way to sort only the selected columns in an Excel Pivot Table?
Question
I want to have the first three columns locked due to the nature of the values, but
when I sort horizontally, the columns I don't want sorted end up in the middle
of the chart. Is there a way around this? Thanks. Answer
In VBA function it would proabbly look something like this then:
Sub SortLTable()
Range("D2:G10").Sort Key1:=Range("D1:G1"), Order1:=xlAscending,
Orientation:=xlLeftToRight End Sub
Where the range is obviously what you want to sort and key determines the
values to be sorted
Topic 469
Subject

Excel using a formula to check a condition and write the count
Question
I have two columns Column M which has a set of details say server type and
another column K which contains the alert types received. Now in the next
sheet I want the result as check for the specific server type in column K and
then to check for a specific alert and write the count of the number of times the
a specific alert occurred. 
Column K                 Column M 
**Sub Component**        **Server Type** 
Unknown                  Application Batch 1 
CPU                      INC 4 
Process                  ASSUMPTIVE 1 
Filesystem               INFRA 
Disk                     INFRA 
FileSystem               INFRA 
Unknown                  ASSUMPTIVE 1 
FileSystem               ASSUMPTIVE 1 
So the result am looking is:
In server Infra how many Filesystem alerts came (answer = 2) In server
Assumptive 1 how many Process alerts came (answer = 1)
So like this for all the servers I need to know the count of the individual alerts
received Answer
Use =Countifs() formula:
=COUNTIFS(B:B,D2,A:A,E2)
Screenshot
You can also use server type and alert type as criteria of =Countifs() formula.
See below...
=COUNTIFS(B:B,"INFRA",A:A,"Filesystem")
But this will return count result only for INFRA server type and Filesystem
alert type.

Answer
If you want to pull out the number of one specific alert, look into COUNTIF. If
you want to count how many of each alert there are, look into Pivot Tables.
Answer
Based on your edits and comments I would say you need something like:
=COUNTIF(a1:a10,"Filesystem")
That will tell you how many times Filesystem appears in that range. If you
want it to look in another worksheet add 'worksheetname'! before the range.
=COUNTIF('sheet2'!a1:a10,"Filesystem")
EDIT - try this
=SUMPRODUCT((B1:B8="filesystem")*(C1:C8="INFRA"))
Topic 470
Subject
Excel Visual Basic almost working
Question
So far I have an Excel spreadsheet to where I have specified ranges that can't
be changed but what I can't figure out how to do is change it so that when I
copy and insert inside the protected area. So that if I have all 20 cells filled out
in the spreadsheet that when I copy and insert then I would have 21 and so on.
Private Sub Worksheet_Change(ByVal Target As Range)
If Not Intersect(Target, Range("C1:C20,E1:E20")) Is Nothing Then
'do not do anything until you know you are going to need it On Error GoTo
Whoa
Application.EnableEvents = False
Dim c As Long, crng As Range, vals As Variant, prevals As Variant Dim e As
Long, erng As Range, valss As Variant, prevalss As Variant 'store the current

values
vals = Range("C1:C20").Value2
valss = Range("E1:E20").Value2
'get the pre-change values back
Application.Undo
prevals = Range("C1:C20").Value2
prevalss = Range("E1:E20").Value2
'in the event of a paste, Target may be multiple cells 'deal with each changed
cell individually For c = LBound(vals, 1) To UBound(vals, 1)
If vals(c, 1) = 0 Then vals(c, 1) = prevals(c, 1) Next c
Range("C1:C20") = vals
For e = LBound(valss, 1) To UBound(valss, 1)
If valss(e, 1) = 0 Then valss(e, 1) = prevalss(e, 1) Next e
Range("E1:E20") = valss
End If
LetsContinue
Application.EnableEvents = True Exit Sub
Whoa
MsgBox Err.Description Resume LetsContinue End Sub
Topic 471
Subject
Search a value in one colum and return values in two different ones
Question
I'm trying to do something I thought simple with VLOOKUP but it seems it
cannot be done with that function.
I have an Excel table:
Categorization table
So that table goes on an on. What I am trying to do is that, if I write something

that is already written in the Comment colum, to duplicate the values in the
colums A (Category) and B (Severity).
So I write "Typo." in F4, the fields in F1 (Category) and F2 (Severity) are
filled out automatically with Constency and Major. If I write "Mistranslation.",
it should return in columns A and B "Linguistic" and "Minor".
Is there any way to do it?
Thanks a lot in advance,
Ricardo
Topic 472
Subject
Excel VBA Find a row in another sheet, then change a cell in the same row
Question
I know there are lots of questions like this, but i couldn't get any of them to
work for me. Basically i'm putting a print button on PRINT sheet. When
clicked i would like to take the order number (which is on the PRINT sheet),
find it on ORDERS sheet then put a text like ,"printed" to another column in the
same row of that order. I've solved the printing part no problems there. But
couldn't get any of the codes to work. I'm a newb. please consider it with your
answers :)
Sub Macro1()
'
' Macro1 Macro
'
'ActiveSheet.PrintOut
Dim ws1 As Worksheet, ws2 As Worksheet Dim aCell As Range, bCell As
Range
Dim lrow As Long
Set ws1 = Sheets("SPRS"): Set ws2 = Sheets("ETÝKET") 
      Set aCell = ws1.Columns(1).Find(What:="26182-2" _ 

              , LookIn:=xlValues, LookAt:=xlWhole,
SearchOrder:=xlByRows, _ 
              SearchDirection:=xlNext, MatchCase:=False) 
                
ThisWorkbook.Worksheets("SPRS").Range(aCell).Value =
"printed" 
End Sub
Answer
In the click buttons function for print add something like:
ThisWorkbook.Worksheets("ORDERS").Range($row).Value = "printed"
Where $row is the cell you want that presumably would correspond to the
PRINT sheet.
Topic 473
Subject
Open Text File and Split() with exclamation mark as delimiter
Question
Should be very simple I think, but can't seem to get it to work. Tried two
methods for opening a text file (.txt) into excel and splitting by the Other
option: "!"
Set workbookbk = Workbooks.OpenText(fullfilepath, xlMSDOS, _
xlDelimited, xlDoubleQuote, False, False, False, False, False, True, "!")
this syntax is fine but then it says "Compile Error: Expected Function or
Variable" what am I missing?!
I also used
Set workbk = Workbooks.Open filename:= fullfilepath, Delimiter:= "!"
This opens the file ok, but doesn't split the file at all
Help much appreciated

Answer
If you're going to skip arguments from a method, then you need explicitly
specify which arguments you are supplying:
Workbook.OpenText syntax (from MSDN)
expression.OpenText(Filename, Origin, StartRow, DataType, TextQualifier,
ConsecutiveDelimiter, Tab, Semicolon, Comma, Space, Other, OtherChar,
FieldInfo, TextVisualLayout, DecimalSeparator, ThousandsSeparator,
TrailingMinusNumbers, Local)
expression A variable that represents a Workbooks object.
In your code, you have missed out some arguments, but the compiler will
assume you have supplied the arguments in the expected order for that method
unless you specify which arguments you are passing. For example:
Workbooks.OpenText Filename:=fuullfilepath, Origin:=xlMSDOS,
DataType:=xlDelimited, Other:=True, OtherChar:="!"
Also, might not be the answer you were hoping for, but I wrote a UDF to
accomplish a similar thing without using the .OpenText() method a while ago:
Function MM_OpenTextFile(vPath As String, delim As String) As Variant
Dim FF As Integer
Dim lineArray As Variant
Dim temp As String
Dim arrayList As Object
Set arrayList = CreateObject("System.Collections.ArrayList")
FF = FreeFile
Open vPath For Input As #FF
While Not EOF(FF) 

      Line Input #FF, temp 
      lineArray = Split(temp, delim) 
      arrayList.Add lineArray 
      Erase lineArray 
Wend
Close #FF
MM_OpenTextFile =
WorksheetFunction.Transpose(WorksheetFunction.Transpose(arrayList.ToArray
arrayList.Clear
Set arrayList = Nothing
End Function
Here's an example of how you would use it:
Sub Foo()
Dim ar As Variant '// Must be a Variant to work
'// Change to a file and delimiter of your choosing... ar =
MM_OpenTextFile("C:\Users\Macro Man\SomeFile.txt", "!")
With Range("A1").Resize(UBound(ar, 1), UBound(ar, 2))
.NumberFormat = "@" '// Change format to "text" .Value = ar '// insert array
values End With
End Sub
Topic 474
Subject
Test multiple criteria against separate lists
Question
I have a large spreadsheet containing multiple sets of information. I have

provided a shortened example of the spreadsheet below. Please note that every
table in the real list contains considerably more terms.
I need to test whether the terms in column A fall within the list in column E and
whether the terms in column B fall within the list in column G.
For example, looking at row 2, does the 'Type 1' data (A) fall within the list in
column E (A,C,D) and does the 'Type 2' data (X) fall within the list in column
G (X,Y). In this instance the answer is yes and therefore 'TRUE' would be
entered in column C.
I have tried to use the formula below but am not getting very far with it.
Any suggestions?
=IF((A2=$E$2:$E$4)*(B2=$G$2:$G$3),TRUE,FALSE) Answer
This should be sufficient no matter how large your actual lists become.
=AND(ISNUMBER(MATCH(A2, E$2:E$4, 0)), ISNUMBER(MATCH(B2,
F$2:F$3, 0)))
Those E$2:E$4 and F$2:F$3 ranges could be full column if desired; e.g. E:E
and F:F.
     
Answer
Based on Jeeped's answer above, I used this formula. This is because I want to
use different terms to "TRUE" or "FALSE".
=IF(AND(ISNUMBER(MATCH(A2,$E$2:$E$4,0)),
ISNUMBER(MATCH(B2,$G$2:$G$3,0))),"TRUE","FALSE")
Topic 475
Subject
Excel can't update links to a csv

Question
I have a spreadsheet that references multiple external data sheets using external
links. I just converted one of the data sheets to a CSV, so that GitHub can
create diffs when it gets edited rather than just viewing it as a binary file.
Unfortunately this has resulted in getting a warning that Excel can't update the
links whenever I open the main file - I need to also open the CSV data sheet to
update the links. Is there any way that it's possible to have automatic link
updates and also have the data sheets diff-able?
Topic 476
Subject
Template for Excel Exports
Question
I am trying to create an excel sheet that pulls data from an export with the click
of a button. I was wondering if there was a way to code something that pulls
from a different export everyday and still uses the same code?
Thanks!
Answer
To make your sub automated I would use auto_open in excel sheet and have a
windows task scheduler set up to run once a day. Follow some tutorials to
write the actual sub that imports the data, ask here if you get stuck.
Topic 477
Subject
Using VBA, how can I search for multiple strings within a defined range?
Question
If I have a long list of text in Column A, and a short list of words in Column C,
what would be the best way to go about searching each cell in A for any of the
words in C, and copy and paste the ones that match out into Column B?
The code I have written so far is as follow
Sub ListKeywordQualifier()

Dim Rng As Range
Dim Keyword As Range
Dim Chunk As Range
Dim x As Long
x = 1
While x <= 5000
Set Rng = Range("A" & x)
Set Chunk = Range("C1", "C100")
Application.ScreenUpdating = True
Range("D1").Value = x
If Application.WorksheetFunction.CountIf(Chunk, Rng) = 0 Then x = x + 1
ElseIf Application.WorksheetFunction.CountIf(Chunk, Rng) = 1 Then
Rng.Copy
Rng.Offset(0, 1).PasteSpecial Paste:=xlPasteValues, Operation:=xlNone,
SkipBlanks _
:=False, Transpose:=False
x = x + 1
End If
Wend
End Sub
However, this will onl;y give me exact matches between the two. Is it possible
to do the same, but have text that appears in Column C, while only making up
part of Column A, trigger the copy/paste line?
Thanks
Answer
Consider
Sub ListKeywordQualifier()

Dim A As Range, C As Range, aa As Range, cc As Range Dim K As Long, va,
vc, boo As Boolean Set A = Range("A1:A" & Cells(Rows.Count,
"A").End(xlUp).Row) Set C = Range("C1:C" & Cells(Rows.Count,
"C").End(xlUp).Row) K = 1
For Each aa In A 
    va = aa.Value 
    boo = False 
    For Each cc In C 
       If InStr(1, va, cc.Value) > o Then boo = True 
    Next cc 
    If boo Then 
       aa.Copy Cells(K, "B") 
       K = K + 1 
    End If 
Next aa
End Sub
Before
and after:
Answer
your countif is not working because it is a worksheet function, to implement
countif.... you need to write it like WorksheetFunction.CountIf . Still your code
is not looking Good , Try This!
Sub ListKeywordQualifier()
Dim Rng(50) As String
Dim Chunk(50) As String
Dim i As Long
i = 1
'' Take a value From 3rd Column this works for 10 cells , For i = 1 To 10
Chunk(i) = Cells(i, 3)

''Search it in 1st Column in 10 cells For j = 1 To 10
Rng(j) = Cells(j, 1)
''If it matches
If Chunk(i) = Rng(j) Then
''Then copy that value to Second Column
Cells(i, 2).Value = Rng(j)
End If
Next j
Next i
End Sub
This is just to give you an idea , you still need make changes Thanks
Topic 478
Subject
Call Excel Add-In function in macro
Question
I am developing Add-in for Excel 2013 and I have created a function in Excel
Add-In as below
public string ExcelReturnString()
{
return "This is the string: hi"; }
I have used below code to call the function, but it throws an error.
Application.Run(ExcelReturnString)
How can I call the Add-in function in macro? Answer

This is about the farthest thing from straight-forward, but this is how you
accomplish the task. I'm going to be as explicit as possible, because the first
two or three times I tried to do this, I missed a LOT.
First, when you create the class that hosts ExcelReturnString(), you need to
decorate the class with an interface that has the following attributes and then
also tag the attributes for each method you want to expose. I made the add-in
class "TestExcelAddIn" for the sake of this example:
using System.Data;
using System.Runtime.InteropServices;
using Excel = Microsoft.Office.Interop.Excel;
namespace TestExcelAddIn
{
[ComVisible(true)]
[InterfaceType(ComInterfaceType.InterfaceIsDual)] public interface
IStringGetter
{
string ExcelReturnString();
}
[ComVisible(true)]
[ClassInterface(ClassInterfaceType.None)] public class StringGetter :
IStringGetter { 
      public string ExcelReturnString() 
      { 
          return "This is the string: hi"; 
      } 
}
}
Then, in the main class, associated with "Excel" in your project, you have to
override RequestComAddInAutomationService in the following manner.

Again, I am including EVERYTHING so you know which class is which (I
didn't when I first read it).
namespace TestExcelAddIn
{
public partial class ExcelTest
{
private StringGetter myAddIn; 
      protected override object
RequestComAddInAutomationService() 
      { 
          if (myAddIn == null) 
              myAddIn = new StringGetter(); 
          return myAddIn; 
      } 
      private void ThisAddIn_Startup(object sender,
System.EventArgs e) 
      { 
      } 
      private void ThisAddIn_Shutdown(object sender,
System.EventArgs e) 
      { 
      } 
      #region VSTO generated code 
      #endregion 
}
}
Now VBA is ready to consume this method in the following manner:
Sub Test()
Dim addin As Office.COMAddIn
Dim automationObject As Object

Dim returnString As String
Set addin = Application.COMAddIns("TestExcelAddIn") Set
automationObject = addin.Object
returnString = automationObject.ExcelReturnString
End Sub
You could have given me 100 years to figure this out, and I would not have.
Actually credit MSDN for the Rosetta stone on it:
https://msdn.microsoft.com/en-us/library/bb608621.aspx?
f=255&MSPPError=-2147217396
Answer
In addition to DaveMac's note above, also keep in mind a couple of points
when calling another routine:
If you're calling a macro from a routine that resides in the same
workbook/addin as that routine, you don't have to use Application.Run. You
can just call it by using its name:
MyMacro
If you're calling a macro that is in a different workbook, then you do need to
use Application.Run, but you will also want to use the workbook name where
the macro resides, otherwise VBA will not know where it should look for the
macro:
Application.Run "'My Fancy Spreadsheet.xlsm!'MyMacro"
Answer
Your code appears to be java.
Excel uses Visual basic, for example.

Function excelreturnstring()
excelreturnstring = "this is the string: hi" End function
Topic 479
Subject
String Array to PDF/EXCEL file javascript
Question
I have array of arrays of strings
var array = [
['bla','bla','bla'],
['bla','bla','bla'],
['bla','bla','bla'],
];
I want convert this array to pdf / excel file. Somebody know how do it?
I know how convert this array to cvs file, but need converting to pdf or excel
Topic 480
Subject
Combining 3 columns into one in excel
Question
I want to be able to combine 3 columns in to one in excel so that i can then
display the data in a pivot table pie chart. I have tried various different
formulas as i don't want to use VBA. (I did try using VBA but my skills aren't
good enough as the lists need to be dynamic) I have used
=IF(ROWS($BD$1:BD1)>ROWS(TLIST),
IF( ROWS($BD$1:BD1)>ROWS(TLIST)+ROWS(ULIST),"",
INDEX(ULIST,ROWS($BD$1:BD1)-ROWS(TLIST))),
INDEX(TLIST,ROWS($BD$1:BD1)))
=IFERROR(INDEX(TLIST, ROWS(BA4:$BA$4)),
IFERROR(INDEX(ULIST, ROWS(BA4:$BA$4)-ROWS(TLIST)),
IFERROR(INDEX(VLIST, ROWS(BA4:$BA$4)-ROWS(TLIST)-

ROWS(ULIST)), "")))
where my lists as named as =OFFSET($T$5,0,0,COUNTA($T$5:$T$1000),1)
For some reason these formulas seem to work but get to a certain row and give
up! I've tried moving around the $ but this doesn't seem to help so far.
Topic 481
Subject
Google sheets importdata csv wasn't there, now is but still getting error
message
Question
I can't upload an image unfortunately to show the problem as the files involved
are confidential for the company I work for.
The problem is that the import data formula I'm using works like this:
if(a1>today(),importdata("ourwesbite/thisyear/daymonth.csv")
However some numb nuts didn't upload the csv he was supposed to and just
left a memo saying his tablet ran out of battery. Now I've uploaded the csv
myself and it is still giving me the message that there's no resource at the URL.
Any ideas how to fix this?
Thanks, this is my first post. But been using stack overflow for ages.
Topic 482
Subject
Microsoft Excel Error: “There was a problem sending the command to the
program.” [closed]
Question
I am getting this error everytime I open MS Excel / Word. I tried unchecking
the checkbox "Ignore other applications that use Dynamic Data Exchange
(DDE)" in Advanced options, but still I'm getting this error. Any suggestions?
Answer
i just feel like to share what worked for me as this thing really annoyed me for

several months.
i researched on several websites/sources and all the solutions i have come
across do not work. such solutions include but are not limited to:
1. clearing of the checkbox of that DDE thing.
2. registry edit (too risky for non-savvy PC users like me)
3. unchecking of "run as administrator"
but just recently, i uninstalled a program called Tune Up utilities and then the
annoying error was gone. so what i would suggest for others is to check which
programs do you think are incompatible with your MS Office. then uninstall
that (those) program (s).
hope that helps.
best,
filousophe
Answer
Hey,
You need to deactivate all add-ins
http://office.microsoft.com/en-us/excel-help/enable-or-disable-add-ins-in-
office-programs-HA010034127.aspx
one of them seems to be having an issue.
Answer
I solved it by right-clicking the document and choosing Open With... and
noticed there were two Microsoft Word choices. I chose the second choice.
And it worked and fixed the issue in the future.
If anyone can explain this in more detail, please do!
(I was using Windows 7 and Microsoft Word 2002.)

Answer
I came across this issue today. An update to the Office Compatibility Pack that
was still on a computer caused the default program for .docx and .xlsx files to
be the Microsoft Open XML Converter program and make the "Default
Programs" in Control Panel think that Excel and Word were actually the
Microsoft Open XML Converter program as well.
Uninstalling the Office Compatibility Pack in Programs and Features and then a
simple reboot fixed the issue.
Answer
Uninstalling the Office Compatibility Pack in Programs and Features and then a
simple reboot fixed the issue.
I am running Office 2013 - Win 7. Un-istalling the Compatibility pack for
Windows 2007 AND rebooting, took care of my issue. After the reboot the
.xlsx extension default is changed form XML converter to EXCEL. If you need
the compatibility pack you may be able to just change the "Default Program"
through Control Panel associated with the xlsx extension.
Answer
"There was a problem sending the command to the program" has appeared on
my Windows 7 machine in the first week of September, 2013. I tried to repair
MS Office 2003 from within the Program and Features, but repair and re-
installation have failed due to "unspecified error". Windows application logs
showed that the repair has failed due to "protected keys" in the Registry.
Windows Installer was blocked from writing to MS Office keys. My antivirus
and firewall were turned off. On the Uninstall or Change programs list I
noticed September 6, 2013 entry "Microsoft Office 2003 Interoperative
Assembly" from Microsoft. I didn't install this, so I uninstalled that item.
Afterwards, both Excel and Word no longer showed an error, and files are
opening normally.
KrysK

Topic 483
Subject
EXCEL sumproduct formula not counting correctly
Question
I have a formula in EXCEL 2013 that counts values where the decimal point =
.16
=SUMPRODUCT(--(MOD(D2:D9,1)=0.16))
so for example 2.16, 15.16 will be a count of 2. However if the value is 32.16
or greater then will not count. This is very weird issue and cannot fathom this
out. Answer
You've hit a floating point error¹. The remainder reads as 0.159999999999997,
not 0.16. Round it to at least four decimals to get an accurate read.
=SUMPRODUCT(--(ROUND(MOD(D2:D9,1), 4)=0.16))
¹ See 15 digit precision floating point errors and Floating-point arithmetic may
give inaccurate results in Excel.
Topic 484
Subject
how extract images from excel sheets
Question
I have an excel file.i tried to extract images from excel using html but images
were extracted twice.i want to extract images and save images with
corresponding names.
Here is my excel file screenshort.
Can anyone please give me an idea.How to extract images from excel file
using (vba or any methods) Answer
The following code will do it (tested on Excel 2010).
Sub extractImgs()

Dim shp As Shape
Dim tempChart As String, wsName As String wsName = ActiveSheet.Name
For Each shp In ActiveSheet.Shapes
If shp.Name Like "Picture*" Then 
      shp.Select 
      Charts.Add 
      ActiveChart.Location xlLocationAsObject, wsName 
      ActiveChart.ChartArea.Height = shp.Height 
      ActiveChart.ChartArea.Width = shp.Width 
      tempChart = Mid(ActiveChart.Name, Len(wsName) + 2, 100)
      shp.Copy 
      ActiveChart.Paste 
      ActiveChart.Export Filename:="C:\images\" &
shp.TopLeftCell.Offset(0, 1).Value & ".jpg", FilterName:="jpg"
      ActiveSheet.Shapes(tempChart).Delete 
End If
Next
End Sub
In case you need initial VBA intro: from the worksheet with the images, right
click on the sheet tab and then "view code", then paste the code there. Make
sure to create a folder named "images" under C:\ before running the code (run
it by hitting F5 when cursor is inside the code).
Topic 485
Subject
Select items in listbox from array
Question
I currently have a cell with a list separated by commas (1, 2, 3) and the list
isn't always the same amount of items. It can be up to 10 items.
I then have a listbox with items 1 - 10 in it.
I want to be able to select the specific items that are in the cell on a form with
the listbox on it.

I have started by splitting the cell into an array like this:
Dim Array() As String
Array= Split(ActiveSheet.Range("A1"), ",")
But I can't figure out how to select items in my listbox that match the array.
Answer
Try the below Code. I tested it. It worked fine for me.
Sub formdisplay()
Dim valsToSelect
valsToSelect = Split(Range("E6").Value, ",") 'E6 is my cell where i have my
value in the form of 5,6,7,9 For Each item In valsToSelect
i = 0 
      For Each listItem In UserForm1.ListBox1.List 
          If CStr(listItem) = item Then 
           UserForm1.ListBox1.Selected(i) = True 
           Exit For 
          End If 
          i = i + 1 
      Next 
Next
UserForm1.Show
End Sub
Topic 486
Subject
why does this line produce a runtime error?
Question
Working with a code to grab specific data from files and this line:
With sht.Range(Cells(1, 1), Range("A1").SpecialCells(xlCellTypeLastCell))

produces: method 'Range' of object '_worksheet' failed.
I have sht dim'd as worksheet and am just trying to select the range as the
whole sheet? Answer
You wrote you "dim'd" sht as worksheet. I assume you are talking about
Dim sht As Worksheet
If you did not do the following, there might be the problem:
set sht = ThisWorkbook.Worksheets("insertnamehere") [the ThisWorkbook.
part asumes the worksheet is at the same workbook as the code]
If that does not solve your Problem, pls make a debugoutput (I prefere
MsgBox, but only personal preference) of the second part, like MsgBox
sht.Range("A1").SpecialCells(xlCellTypeLastCell).Address and post the result
here (An address? A new error? If so, wich?)
Hope it helps at least one step forward.
PS: If you set sht allready (not only dim'd it <- love that phrase :P ) pls also
edit your post and add the code for that (and anything that might relate)
Topic 487
Subject
Check internet connection from Excel VBA
Question
I need to check the Internet connection when an Excel workbook opens. For
that, I'm trying the following code:
Private Declare PtrSafe Function InternetGetConnectedState _
Lib "wininet.dll" (ByRef dwflags As Long, _ ByVal dwReserved As Long) As
Long
Private Const INTERNET_CONNECTION_MODEM As Long = &H1 Private
Const INTERNET_CONNECTION_LAN As Long = &H2 Private Const

INTERNET_CONNECTION_PROXY As Long = &H4 Private Const
INTERNET_CONNECTION_OFFLINE As Long = &H20 Function
IsInternetConnected() As Boolean
Dim L As Long
Dim R As Long
R = InternetGetConnectedState(L, 0&) If R = 0 Then
IsInternetConnected = False
Else 
      If R <= 4 Then 
          IsInternetConnected = True 
      Else 
          IsInternetConnected = False 
      End If 
End If
End Function
It works, but some users are reporting this is breaking Excel (it freezes Excel
forever).
Is there a way to throw an error or somehow correct this code in order to find
out what is the cause of the problem (Firewall, etc.)?
Thank you so much for helping!
Answer
Here are the proper imports with compiler directives.
Option Explicit
#If Win64 Then
Public Flg As LongPtr
Public Declare PtrSafe Function InternetGetConnectedState _ 
          Lib "wininet.dll" (lpdwFlags As LongPtr, _ 
          ByVal dwReserved As Long) As Boolean 

#Else
Public Flg As Long
Public Declare Function InternetGetConnectedState _ 
          Lib "wininet.dll" (lpdwFlags As Long, _ 
          ByVal dwReserved As Long) As Boolean 
#End If
Private Const INTERNET_CONNECTION_MODEM As Long = &H1 Private
Const INTERNET_CONNECTION_LAN As Long = &H2 Private Const
INTERNET_CONNECTION_PROXY As Long = &H4 Private Const
INTERNET_CONNECTION_OFFLINE As Long = &H20
Function IsInternetConnected() As Boolean
Dim R As Long
R = InternetGetConnectedState(Flg, 0&)
If Flg >= INTERNET_CONNECTION_OFFLINE Then
Debug.Print "INTERNET_CONNECTION_OFFLINE" End If
If CBool(R) Then
IsInternetConnected = True
Else
IsInternetConnected = False
End If
End Function
Sub main()
Dim mssg As String

If IsInternetConnected Then
mssg = "Connected"
Else
mssg = "Not connected"
End If
MsgBox mssg
End Sub
I believe at least one of the problems was failing to provide the correct var-
type to receive the lpdwFlags. I've added a public var within the compiler
directives. The Flg var receives the flags from the function. These can be
parsed bitwise against your constants to determine the state. See
InternetGetConnectedState for more information (and a full set of flags).
This has been tested on both 32-bit and 64-bit xl2010.
Topic 488
Subject
VBA or Excel formula for copying/cutting and pasting into new worksheets
Question
I need to create a way of copying rows of data (once & only when they are
completed by the user), and move them to another worksheet automatically.
The problem I have is that I need to the one macro to be able to move multiple
completed rows. All formulas I have found only relate to a limited defined cell
selection, rather than being specific to the individual rows.
I want it to work very much as it would with a standard formula where you can
drag the formula down or across a range of cells and each row/column has its
own formula ready for completion?
Topic 489
Subject
Saving Excel chart as PNG, JPEG, etc. using EPPlus
Question

I am wondering how can I save Excel charts
(OfficeOpenXml.Drawing.ExcelDrawing) as image (PNG, JPG, etc.).
I am using EPPlus Api to do that. I tried to do with Spire.XLS
workbook.SaveChartAsImage() method, but I couldn't manage to handle big
excel files.
Could you please help me to save my charts as image ?
Topic 490
Subject
Excel object is undefined
Question
I'm trying to develop a Office Add-In for Excel (n00b).
I have managed to do some things (creating tables and taking input and so on)
when using Office.context.
But now I want to go into the different cells and all examples seems to run a
method called Run on a object called Excel.
(https://github.com/OfficeDev/office-js-docs/blob/master/excel/excel-add-ins-
programming-overview.md)
However when trying to use Excel it's undefined. I am running Excel 2013.
Can it be that I need to use 2016? Answer
If you need JavaScript APIs that can work in Excel 2013, consult the original
JavaScript API Reference pages.
The APIs you're asking about are only available in Office 2016 and later.
-Michael (PM for Office add-ins)
Answer
As the article says, "Applies to: Excel 2016, Office 2016".
They have added in some new APIs recently that currently only apply to Excel

& Word 2016, for Windows Desktop. And even within the more generic stuff
off of Office.context there's a lot of stuff that only works on some specific
platforms (e.g. only Online, or only Desktop, or not on 2013...). The 2016
desktop products have the most features available.
Topic 491
Subject
Multilanguage excel format conditions formula in c#
Question
It's my first question here so I hope I'm doing everything ok.
I'm trying to apply some format (background color, for example) to the even or
odd rows of an excel range. I'm trying to use the FormatCondition.Add method.
The problem is that the application must work in diferent excel languages (like
spanish). And when I use the formula =MOD(ROW(),2) in the Add method to
apply the format only to even or odd rows it throws me an argument exception.
Here in spanish:
System.ArgumentException:El valor no está dentro del intervalo esperado.
And here my best translation of the exception:
System.ArgumentException:The value isn't between the expected interval.
The problem seems to be the , character in the formula. If I use ; the exception
disappears, but then excel doesn't translate the formula so when I open the
excel file in spanish the conditional format doesn't work. I must use the spanish
version of the formula =RESIDUO(FILA();2) but that won't work in english.
And if a put the formula in some randome cell it works well (so I suppose the
formula isn't wrong):
excelSheet.Cells[1, 1] = "=MOD(ROW(),2)";
My question is: How can I use multilanguage formula in
FormatConditions.Add method?
My code looks like this:

excelRange =
excelRange.FormatConditions.Add(Excel.XlFormatConditionType.xlExpressio
Formula1: "=MOD(ROW(),2)=" + par);
"par" is a variable to distinguish between even or odd.
I've tried changing the thread culture:
System.Globalization.CultureInfo before =
System.Threading.Thread.CurrentThread.CurrentCulture; 
          try 
          { 
            
System.Threading.Thread.CurrentThread.CurrentCulture = new
System.Globalization.CultureInfo("en-US"); 
              excelRange =
excelRange.FormatConditions.Add(Excel.XlFormatConditionType.xlE
Formula1: "=MOD(ROW(),2)=" + par); 
          } 
          finally 
          { 
            
System.Threading.Thread.CurrentThread.CurrentUICulture =
before; 
          } 
and using the Type.InvokeMember method to define the culture info:
Excel.FormatConditions aux = excelRange.FormatConditions; Object[] args =
{ Excel.XlFormatConditionType.xlExpression, Type.Missing,
"=MOD(ROW(),2)=" + par }; excelRange =
aux.GetType().InvokeMember("Add", 
                                    
System.Reflection.BindingFlags.InvokeMethod |
System.Reflection.BindingFlags.Public, 
                                       null, 
                                       aux, 
                                       args, 

                                       culture: new
System.Globalization.CultureInfo("en-US")); 
But the result is the same always.
If you have some clue to help me it'll be very appreciated. Thanks to all.
P.S: Sorry for my english, I hope I've explained it not too bad. Answer
I've found the solution (not the best solution I think, but anyway...).I took the
idea from here
The basic idea is to use a single cell to put the formula in English and then get
the translated formula from the Range.FormulaLocal property:
Excel.Range temp = excelSheet.get_Range("a1"); dynamic tempValue =
temp.Value2;
temp.Formula = "=MOD(ROW(),2)=" + par;
String formula = temp.FormulaLocal;
temp.Formula = "";
temp.Value2 = tempValue;
excelRange =
excelRange.FormatConditions.Add(Excel.XlFormatConditionType.xlExpressio
Formula1: formula);
I hope this can help someone in the future.
Topic 492
Subject
How to copy data into Excel range formatted as table and not lose table
formatting
Question
Does anyone know how to copy data into Excel via C# into a table range and
not lose the table formatting?
Everytime I copy data to the range, it loses the formatting that was set
previously.

private object[,] Get2DArrayData()
{ 
      var obj = new object[2, 4]; 
      obj[0, 0] = "Header1"; 
      obj[0, 1] = "Header2"; 
      obj[0, 2] = "Header3"; 
      obj[0, 3] = "Header4"; 
      obj[1, 0] = 1; 
      obj[1, 1] = 2; 
      obj[1, 2] = 3; 
      obj[1, 3] = 4; 
      return obj; 
}
private void button1_Click(object sender, RibbonControlEventArgs e) { 
      var worksheet =
Globals.ThisAddIn.Application.ActiveSheet; 
      Range range = worksheet.Range["A1:D2"]; 
      Excel.ListObject obj =
worksheet.ListObjects.Add(Excel.XlListObjectSourceType.xlSrcRan
range, null, Excel.XlYesNoGuess.xlYes, null); 
      obj.TableStyle = "TableStyleMedium3"; 
      obj.Name = "MyTableNamedRange"; 
      //table style is lost after setting Value2 on the range
      range.Value2 = Get2DArrayData(); 
}
Everytime I paste the array data to Value2, the ListObject gets cleared. Is there
any way to not lose this formatting? Setting the Value2 property before adding
to the ListObjects property isn't possible. Answer
If you want to populate the ListObject with data, you should set the
ListObject's HeaderRowRange and DataBodyRange to the content array:
obj.HeaderRowRange.Value2 = /* Your array with table headers goes here */
obj.DataBodyRange.Value2 = /* Your array with table data goes here */

Answer
That was exactly what I was after and that does the trick! Thanks a lot
Topic 493
Subject
Leading 0 is trimmed from the excel php [duplicate]
Question
This question already has an answer here:
Correct format for strings / numbers beginning with zero?
4 answers
I am trying a lot to include the leading 0 in the excel which is getting trimmed
from the excel sheet. I used like below for the column value and it is showing
the leading 0, but with a single quote at the begining.
The value i am using like "'$value"
Can anyone please help me in this how to remove this single quote from the
excel with having the leading 0? Answer
I would recommend formatting the data range as a 10 digit number instead of
inserting an '.
You can find out more about Range.NumberFormat here on MSDN.
Where $value is your value and $worksheet is a Worksheet object:
$value = "0000000001"
$workSheet.Range("A1").Value2 = $value
$workSheet.Range("A1").NumberFormat = "0000000000"
Topic 494
Subject
Excel Vba:- Display a cell value if a match is found in a row

Question
My question may be a little confusing.
I am trying to find the count of no of times a number matched in a sheet but it
should not count if a number comes multiple times in a single row. It count it 1
only for each row.
A B C D Status
1 id1 day1 val1 Resolved
2 id2 id1 id1 Not Resolved 3 id3 day1 val3 Not Resolved 4 id1 day2 id1
Resolved
5 id2 day2 val2 Not Resolved 6 id3 day2 val3 Not Resolved
So if i searched for id1 it must give a count of 3 not 5 as it is repeated in 2 &
4th row. And it should also display its status like 2 Resolved 1 Not Resolved
because 1&4th Resolved so count is 2 Resolved and 2nd Row is Not
Resolved.
Any help is greatly appreciated.. And please give suggestion of Vba code..
Answer
Lets say you are looking for "id1", in an array of i rows and j columns, with the
first cell being A1
Dim SearchCriteria as string
Dim CheckRow, CheckCol, i,j, HitCounter as long
SearchCriteria = "id1"
i = 10
j = 10
HitCounter = 0
For CheckRow = 1 to i
For CheckCol = 1 to j 
      If(instr(cells(CheckRow ,CheckCol ),SearchCritera) <> 0
then 'If the criteria is found in the cell 
          HitCounter = HitCounter + 1 

          Exit For 'Exit the column loop and go to the next
row 
      End if 
Next j
Next i
MsgBox "Your criteria was found in " & HitCounter & " different rows"
Topic 495
Subject
Node.JS:export data from mysql to excel using alasql
Question
I'm writing a script to export data from mysql to excel using Node.JS and
alasql. I can see examples in doing this.
var mystyle = {
headers:true,
column: {style:{Font:{Bold:"1"}}},
rows: {1:{style:{Font:{Color:"#FF0077"}}}}, cells: {1:{1:{
style: {Font:{Color:"#00FFFF"}}
}}}
};
alasql('SELECT * INTO XLSXML("restest280b.xls",?) FROM ?',
[mystyle,data]);
However, there is no documentation about what the variable data is and how I
should construct it, particular in my case using recordset from mysql?
conn.query(SQL, function(err, rows, fields) {
ALASQL('SELECT * INTO XLSXML("restest280b.xlsx",?) FROM ?',
[mystyle,rows]); })
I tried to use mysql recordset directly. It wrote a file but can't be opened in
excel. Answer

Here data is a array or JSON objects, for example:
var rows = [{a:1, b:10, c:'One'}, {a:2, b:20, c:'Two'} ]; alasql('SELECT *
INTO XLSXML("restest280b.xlsx",?) FROM ?',[mystyle,rows]);
If you use node-mysql package, your code should work.
XLSXML() function generates XML file, and usually Windows version of MS
Excel produce a warning. You can aliminate it if you will use XLSX() function
with js-xlsx library:
var rows = [{a:1, b:10, c:'One'}, {a:2, b:20, c:'Two'} ]; alasql('SELECT *
INTO XLSX("restest280b.xlsx") FROM ?',[rows]);
Topic 496
Subject
Excel needing to fill blanks
Question
I am having some issues with trying to fill in the blanks in my excel document,
the code I have wrote only works for one blank but doesn't work when there
are multiple blanks and I want to still reference the last value shown.
=IF(ISBLANK(D11),OFFSET(D11,-1,0),D11)
However throughout my document the number of blanks in a row can vary from
25 blanks to 2 blanks
To explain slightly better the example below I would like both blanks to
display 0 Days 0 Hours 0 Minutes
E.g.
Any help would be greatly appreciated.
Thanks
Paula
Answer

It is the OFFSET(D11,-1,0) part that is giving you the issue. If you know that
the first occurrence will definitely be filled in just use that reference instead:
=IF(ISBLANK(D11),D$2,D11)
Answer
You need the last number (aka datetime) from D1:D11.
=IF(ISBLANK(D11), INDEX(D:D, MATCH(1e99, D$1:D11)), D11)
Answer
Thanks for all your help I managed to find another way round it by highlighting
the entire column selecting special and blanks press = and then hold down Ctrl
click on the last cell with information in it and then pressing enter.
This copys the last number and fills down until the number changes again.
Topic 497
Subject
Match value based on criteria in two columns
Question
I have the following values in columns A, B and C.
A B C D
3 3 5
4 4 10
In cell D1, how can I find the value in Column C where A=A+1 and B=B+1
i.e. 10? Answer
Are you looking for something like below?
=VLOOKUP(SUM(A1+1,B1+1),C:C,1,FALSE)
Topic 498
Subject

VBA: How to overcome multiple recipient entries when resolving an Outlook
recipient?
Question
Sorry about the title of this question, I struggled to articulate it!
I have a function that takes a name and resolves it in Outlook to return the alias
for the selected name. This works for the most part, although fails when there
is more than one entry for the selected name in the address book. e.g. "Smith,
Bob" & "Smith, Bob X". If the name I try to resolve is "Smith, Bob X", the
code works fine, but plain old "Smith, Bob" fails.
I presume the reason is when multiple entries are found, Outlook opens the
Check Names dialogue (at least when I manually try resolving names). I'm
hoping this means just an extra line or two of code, but I have no idea what the
code would be.
My question is, when my code finds multiple entries, how do I get it to select
the first one? This is the code:
Function GETTPX(ByVal UserName As String) As String Dim objOL As
Object
Dim oRecip As Outlook.Recipient
Dim oEU As Outlook.ExchangeUser
Dim oEDL As Outlook.ExchangeDistributionList
Set objOL = CreateObject("Outlook.Application")
Set oRecip = objOL.Session.CreateRecipient(UserName) oRecip.Resolve
If oRecip.Resolved Then
Set oEU = oRecip.AddressEntry.GetExchangeUser End If
GETTPX = oEU.Alias
Set oRecip = Nothing
Set objOL = Nothing
End Function

Answer
On the Extended MAPI level (C++ or Delphi only) you can create a PR_ANR
restriction on the contents table of a particular search container (such as GAL).
That is what Outlook does when it resolves a name you typed in the To edit
box - it goes through all containers in the search path and applies the PR_ANR
restriction. If there are multiple matches found, it displays a dialog box with
the list. If there is a single match, it is returned and the search is stopped,
otherwise it continues to the next container in the search path.
Outlook Object Model however does not expose this functionality. If using
Redemption (any language) is an option, it exposes
RDOAddressBook.ResolveNameEx and RDOAddressList.ResolveNameEx,
which return a list of matches.
set Session = CreateObject("Redemption.RDOSession")
Session.MAPIOBJECT = Application.Session.MAPIOBJECT set AdrrEntries
= Session.AddressBook.ResolveNameEx("john") Debug.Print
AdrrEntries.Count & " names were retruned by ResolveNameEx:" Debug.Print
"------------"
for each AE in AdrrEntries
Debug.Print AE.Name
next
Debug.Print "------------"
Topic 499
Subject
How to return just Date Created, not Date and Time?
Question
I Have a line in my code
Cells(i,3).value = File.DateCreated
And it prints the date created but also the time. Is there a simple change so it
prints just the date and not the time too?
I am aware there are other commands DateModified and DateAccessed but am

unaware of any for just the date created?
Topic 500
Subject
How to eliminate devide by zero error in phpexcel?
Question
I am creating excel file using phpexcel.But in some cells i am getting devided
by zero error. So i am trying to put zero instead of devided by zero error.I am
trying to put zero instead of error with the following code.
$this->excel->getActiveSheet()-
>setCellValue('Y'.$ab,'=IFERROR(ROUND((X40*100)/X26,2),"")');
But cell gets empty instead of zero.
So can anyone please suggest me what i am doing wrong.suggestions will be
appreciated
Thanks.
Topic 501
Subject
ADODB.Stream.saveToFile -> Wait until file is saved?
Question
I am wondering about the behaviour of ostream.saveToFile. I download a vba
module from a server and then add it to the current workbook
onWorkbookOpen. But sometimes the module is not added to the workbook
onWorkbookOpen.
I guess the reason could be, that the file is not available for import.
Does the code after stream.saveToFile run asynchronously or does it wait, until
the file is saved to the destination? Is there a callback to check, if the file is
actually saved?
Code Snippet:

Dim WinHttpReq As Object
Set WinHttpReq = CreateObject("WinHttp.WinHttpRequest.5.1")
WinHttpReq.Option(4) = 13056 ' Ignore SSL Errors
WinHttpReq.Open "GET", myURL, False
WinHttpReq.setRequestHeader "Accept", "*/*" WinHttpReq.setRequestHeader
"User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
WinHttpReq.setRequestHeader "Proxy-Connection", "Keep-Alive"
WinHttpReq.Send
myURL = WinHttpReq.ResponseBody
If WinHttpReq.Status = 200 Then
Set oStream = CreateObject("ADODB.Stream") oStream.Open
oStream.Type = 1
oStream.Write WinHttpReq.ResponseBody oStream.SaveToFile
VBA.Environ("TEMP") & "\Module1.bas", 2 oStream.Close
If DoesComponentExist("Modul1") = True Then With
ActiveWorkbook.VBProject
.VBComponents.Remove .VBComponents("Modul1") End With
End If
If DoesComponentExist("Modul1") = False Then
ThisWorkbook.VBProject.VBComponents.Import (VBA.Environ("TEMP") &
"\Module1.bas") End If
Else
MsgBox "Returncode:" & WinHttpReq.Status & " Unable to download Code."
End If
Answer
The ADODB Stream SaveToFile method is documented here by MSDN - no
mention of whether it's synchronous or asynchronous, so I'm guessing that it is
actually synchronous, and returns when the process is complete and the file
handle is released...

...Except that I've learned not to trust that assumption about file writes: not
even local writes to disk, and never over a network: modern file systems are
too 'smart' and there's too much cacheing and intermediate logic.
The underlying issue here is that we don't have anything that can tell us that no
process has the file open. Don't bother looking up API calls: all you'll get is
more complicated errors, without any additional assurance. All that we can do
is infer that he file's available by checking that:
It exists;
It has a nonzero length;
It hasn't changed since you last checked the datestamp.
My recommendation: Check that the file's available using the VBA.FileSystem
functions.
A quick-and-dirty method is to detect a zero file size, as this is the result
returned by querying the file system about a small file that's still being written:
Const MAX_WAIT As Integer = 10
sFile = VBA.Environ("TEMP") & "\Module1.bas" ' Code to check a file
exists:
For i = 1 to MAX_WAIT
If Len(VBA.FileSystem.Dir(sFile)) > 0 Then 
      Exit For 
      Application.Wait Now() + (i/3600/24) 
End If
Next i
If i >= MAX_WAIT Then
' Raise an error and exit
End If
' Code to check a file has nonzero file size: For i = 1 to MAX_WAIT
If VBA.FileSystem.FileLen(sFile) > 0 Then 

      Exit For 
      Application.Wait Now() + (i/3600/24) 
End If
Next i
If i >= MAX_WAIT Then
' Raise an error and exit
End If
Application.Wait is my 'pause' statement of choice in Excel - I prefer it to
Sleep - but you may have your own tools: make sure you're not blocking the
file write thread too!
I doubt that your bas file will be large enough to show any increase in size
until completion, so the zero-or-completed test is probably good enough. For
completeness, here's the code I use for larger objects:
' Code to check that file 'write' operations have stopped: For i = 1 to
MAX_WAIT
If VBA.FileSystem.FileDateTime(sFile) > (Now() + (2.5/3600/24)) Then 
      Exit For 
      Application.Wait Now() + (i/3600/24) 
End If
Next i
If i >= MAX_WAIT Then
' Raise an error.
End If
Note that I'm not using a check on file length - yes, I know you can see it
increasing in File Explorer on a really long operation, and you could check
against the final bit count delivered by the stream - but "It's stopped growing"
And "It's as big as I expect it to get" aren't as reliable as "The file system says

no-one has written to it recently" - and those assumptions about 'recently' and
persistent file locks are the least stupid assumptions on the table.
Yes, 'least stupid' is as good as it gets. One day I'll write a 'Falsehoods
developers believe about...' document for files: but the trouble isn't
misconceptions among coders, its misleading and inconsistent behaviours from
file systems.
Note, also, that I'm not using the Scripting.FileSystemObject classes for my file
operations: I have no documentation that lists their File object's cacheing and
buffering behaviour and I don't quite trust it to give me an immediate 'snapshot'
of the file state. VBA.FileSystem is reassuringly stupid, and you can get more
informative errors off of it - so much so, that you may need to insert an On
Error Resume Next if the file's locked in a particularly onerous way while the
write's in progress.
Postscript
You can, of course, try a file 'move' command as a final check: but that tells
you nothing that you won't discover anyway by walking face-first into the file
lock when you try importing the .bas file into your project. If your problem was
importing partially-written files, with no errors and warnings from the file
locks, then I would actually go down the route of counting the bits and checking
file sizes and moving files to a 'staging' folder. It's worth pointing out that file
locking errors are a protection as well as an annoyance!
Topic 502
Subject
How to properly import excel columns that have wrap text enabled using
Microsoft.ACE.OLEDB and SqlBulkCopy
Question
I'm importing rows from an excel sheet into an sql server table using bulk
insert. Some columns in the excel source have wrap text enable and they are
causing some issues.
If have say "wrapped text (1)" and "wrapped text (2)", they will appear like
below in the excel cell.

wrapped text (1)
wrapped text (2)
The problem i'm getting is, when that row is imported into SQL server,they
will appear like below
wrapped text (1)wrapped text (2)//Note that there is no space between the two
texts
I would wish that they appear like below
wrapped text (1) wrapped text (2)//note the space between them
Below is the peace of code i'm using for the import
public static void insertdata1(string strexcelConnectionString, string
strcommand, string strsqlConnectionString, string strtrunsqlQuery, string
strtablename)
{ 
      using (OleDbConnection connection = new
OleDbConnection(strexcelConnectionString)) 
      { 
          connection.Open(); 
          OleDbCommand command = new OleDbCommand(strcommand,
connection); 
          //truncate the table before inserting new data. 
          SqlConnection cnntrunc = new
SqlConnection(strsqlConnectionString); 
          //open the connection. 
          cnntrunc.Open(); 
          //begin the transaction. 
          SqlTransaction myTrans =
cnntrunc.BeginTransaction();//New a transaction 
          SqlCommand truntble = new SqlCommand(); 
          truntble.Transaction = myTrans; 
          truntble.Connection = cnntrunc; 
          try 
          { 
              //Create DbDataReader to Data Worksheet. 
              using (DbDataReader dr =
command.ExecuteReader()) 

              { 
                  //Bulk Copy to SQL Server. 
                  using (SqlBulkCopy bulkCopy = new
SqlBulkCopy(strsqlConnectionString)) 
                  { 
                      bulkCopy.DestinationTableName =
strtablename; 
                      bulkCopy.WriteToServer(dr); 
                  } 
                  //commit the transaction. 
                  myTrans.Commit(); 
              } 
          } 
          catch (OleDbException ex) 
          { 
             //my error handling code here 
          } 
          catch (InvalidOperationException ex) 
          { 
              myTrans.Rollback(); 
              //more logging here 
              throw ex; 
          } 
          finally 
          { 
              cnntrunc.Close(); 
          } 
      } 
}
And blow is my excel connection string
strexcelConnectionString = @"Provider=Microsoft.ACE.OLEDB.12.0;Data
Source=" + Server.MapPath(strfilename) + "; Extended Properties=\"Excel
12.0 XML;HDR=YES;IMEX=1;\""; Answer
After my BulkInsert, i'm updating my problematic columns as described here.
How to check my data in SQL Server have carriage return and line feed?
Topic 503
Subject
VLOOKUP is mapping some values correctly, but is not consistent -->

randomly returns "#N/A
Question
[Example: See 1> where I have selected "colleges & Universities" -->
"Education" (which is correct), but then notice how 3 rows down VLOOKUP
returns "#N/A" for the same scenario...why is this?1
See 2> I am pulling the table_array from another sheet in the same workbook
image of table_array
Answer
Try this as a standard formula,
=IFERROR(VLOOKUP('data mapping'!C2&"", mapping!A:B, 2, FALSE), "")
A VLOOKUP function requires FALSE on unsorted data. While the data you
showed appeared sorted, there must be unsorted data further down.
The IFERROR function has been around since xl2007 and drastically reduces
the formula needed for error control over IF(ISERROR(....
Answer
You used relative referencing in setting the range of your VLOOKUP. Try using
an absolute reference instead:
=VLOOKUP('data mapping'!C2&"",mapping!$A$1:$B$46,2)
Then simply copy down.
Topic 504
Subject
Refer to same cell n times then next cell
Question
So I have a list of persons on sheet1 but then on sheet two i need to refer to a
cell 4 times in a row then next cell 4 times, and son on so on sheet 2 i want this
=Shee1(A1)

=Shee1(A1)
=Shee1(A1)
=Shee1(A1)
=Shee1(A2)
=Shee1(A2)
=Shee1(A2)
=Shee1(A2)
if i try to auto complete that it will go like =Shee1(A1)
=Shee1(A1)
=Shee1(A1)
=Shee1(A1)
=Shee1(A2)
=Shee1(A2)
=Shee1(A2)
=Shee1(A2)
=Sheet1(A9)
(because im now 9 cells down from first cell)
Now i could just write all this for 400 cells - but there has to be a better way :)
Answer
Use the following formula:
=INDEX(A:A,FLOOR(((ROW(1:1)-1)/ 4)+1,1))
If you put formula in Sheet2 then just refer sheet2 in index array, like:-
=INDEX(Sheet1!A:A,FLOOR(((ROW(1:1)-1)/ 4)+1,1))
Answer
finaly figured it out - after 4 days for ARGHHH
=INDEX(Sheet1!$A$1:$A$999,INT((ROWS(A$1:A1)-1)/4)+1)
Topic 505
Subject

Bold Partial Text String in Excel w/o Formula
Question
I using the CONCATENATE function to merge multiple columns with some
text and carriage returns. The result is being pasted as values in the next
column. The result will look like this:
Section 1-1
Y = -77.687
X = (-3.454,13.500)
I want the first line of the result to be bold. I dont want to use code as I'm not
comfortable with it.
Can anyone please help find a way in which I can use a formula/ conditional
formatting/ replace or other non-code options to make the text string bold
AFTER PASTING IT AS VALUES.
PS: The operation needs to be carried out in approx 1000 cells and every time
the first line will be "Section ..." ( the "1-1" part may/may not change)
Thanks in advance!
Answer
You could use Conditional Formatting to solve this. Simply set new rules for
the column to format only cells beginning with "Section". You can see how I
did it here. Then format the font that it becomes bold.
Topic 506
Subject
sub or function not defined : Solver not helping
Question
I am writing a macro in vba to lookup values from one sheet and return the data
and save it in another sheet. But i am getting a compile error "Compile Error :
Sub or function not defined".

I tried by selecting the "Solver" under references but still i am getting this
error.
Here is my code ::
For i = 1 To j
temp_var = config_sht_name(i)
MsgBox temp_var
For Each cell In Worksheets(Sheet_Name).Range("A9:A37") 
      On Error Resume Next 
      'Ret = Application.WorksheetFunction.VLookup(cell,
Worksheets("config_sht_name[i]").Range("A9:E37"), 5, 0) 
      Ret = VLookup(cell, Indirect(Concatenate("'", temp_var,
"'!")), 5, 0) 
      On Error GoTo 0 
      If Ret <> "" Then 
          Application.ActiveCell.Offset(0, i) = Ret 
      End If 
      MsgBox Ret 
Next
Next i
I am getting error for "Concatenate" and "Indirect" function. Please suggest
what am I missing.
--Sanjeev
Answer
If you are sure with the logic of the below line
Ret = VLookup(cell, Indirect(Concatenate("'", temp_var, "'!")), 5, 0)
I suggest instead of Conconate function use
str1 = "'" & temp_var & "'!"

Ret = VLookup(cell, Range([Indirect(str1)]), 5, 0)
Topic 507
Subject
Microsoft Excel - SumIF with WeekNum
Question
I want to sum the values with-in a data range, subtract value within a specific
day. I'm able to do first part - SUM but got a problem when I tried to subtract.
Formula used on "Exclude Sunday" table
F3 =SUMIFS(B3:B17,A3:A17,">="&D3,A3:A17,"<="&E3)
Help on this above formula to subtract Sundays hours.
On Sunday Only table, help to add hours of Sundays only of each months.
I tried SUMIFS with WEEKNUM, but couldn't get the result. Answer
Weeknum() returns the number of the week, which is not useful in your
scenario, since you want to evaluate the week day. That is what the Weekday()
function does quite nicely. With the defaults, Weekday() returns 1 for a Sunday,
2 for Monday, and so on.
You can use Sumproduct to calculate a sum of all hours between two dates
where the weekday is not Sunday like this in cell F3 of your screenshot.
=SUMPRODUCT((WEEKDAY($A$3:$A$17)<>1)*($A$3:$A$17>=$D3)*
($A$3:$A$17<=$E3)*B3:B17)
Copy down.
In order to sum all Sunday hours in January, you can use Sumproduct and
compare the date formatted as "mmm" with the text in cell D10, and also use a
condition to calculate only dates where the weekday is Sunday (i.e. 1). Cell
E10 has the formula
=SUMPRODUCT($B$3:$B$17*(TEXT($A$3:$A$17,"mmm")=$D10)*

(WEEKDAY($A$3:$A$17)=1))
Topic 508
Subject
Looping through different size tables Excel VBA
Question
Previous question was answered providing me the foundation of this Loop.
VBA Excel - Loop through worksheet creating tables
However, I ran into an issue where I may have a table header with no data in
the line right under it. In this case I simply want to make a table with just the
header.
I have tried this code-simply assigning the row below rngStart as oneDown.
And then creating an if/then to check if len(oneDown) is > 0.
`Dim ws As Worksheet
Set ws = ActiveSheet
With ws
'find last row of data in column A
Dim lRow As Long
lRow = .Range("A" & .Rows.Count).End(xlUp).Row Dim rngStart As Range
Set rngStart = .Range("A3")
'set counter variable for naming tables Dim i As Long
i = i + 1
Dim oneDown As Long
Set oneDown =rngStart.Offset(1)
Do
if Len(oneDown) > 0 Then
'create table range
Set rngTable = .Range(rngStart.End(xlToRight),rngStart.End(xlDown)) 'create

table
.ListObjects.Add(xlSrcRange, rngTable.Resize(rngTable.Rows.Count,
rngStart.End(xlToRight).Column), , xlYes).Name = "Table" & i 'set style
.ListObjects("Table" & i).TableStyle = "TableStyleLight9" 'find next table
range start
Set rngStart = rngTable.End(xlDown).Offset(2) Else
'create table range
Set rngTable = .Range(rngStart.End(xlToRight)) 'create table
.ListObjects.Add(xlSrcRange, rngTable.Resize(rngTable.Rows.Count,
rngStart.End(xlToRight).Column), , xlYes).Name = "Table" & i
.ListObjects("Table" & i).TableStyle = "TableStyleLight9" Set rngStart =
rngTable.End(xlDown).Offset(2)
End If
i = i + 1
Loop Until rngStart.Row > lRow
End With`
I'm getting the same results with my data as if I didn't have the if/then in place.
Answer
I had to change part of your code but this worked with I test it so give it a try:
Dim ws As Worksheet
Set ws = ActiveSheet
With ws
'find last row of data in column A
Dim lRow As Long
lRow = .Range("A" & .Rows.Count).End(xlUp).Row Dim rngStart As Range
Set rngStart = .Range("A3")
'set counter variable for naming tables Dim i As Long
i = i + 1

Do
Dim oneDown As String
oneDown = rngStart.Offset(1)
'Proceed to next cell if rngstart is empty If rngStart.Value = "" Then
Set rngStart = rngStart.Offset(1)
ElseIf Len(oneDown) > 0 Then
'create table range
Set rngtable = .Range(rngStart.End(xlToRight), rngStart.End(xlDown)) 'create
table
.ListObjects.Add(xlSrcRange, rngtable.Resize(rngtable.Rows.Count,
rngStart.End(xlToRight).Column), , xlYes).Name = "Table" & i 'set style
.ListObjects("Table" & i).TableStyle = "TableStyleLight9" 'find next table
range start
Set rngStart = rngtable.End(xlDown).Offset(1) i = i + 1
Else
'create table range
Set rngtable = .Range(rngStart.End(xlToRight), rngStart) 'create table
.ListObjects.Add(xlSrcRange, rngtable.Resize(rngtable.Rows.Count,
rngStart.End(xlToRight).Column), , xlYes).Name = "Table" & i
.ListObjects("Table" & i).TableStyle = "TableStyleLight9" Set rngStart =
rngtable.End(xlDown).Offset(1) i = i + 1
End If
Loop Until rngStart.Row > lRow
End With
Topic 509
Subject
repeated data validation in multiple cells
Question

If I have two worksheet, called 1 and 2, and now I want to restrict the input
data in my worksheet 2 only exact like the data in worksheet 1.
So, I ask the Cell B2 in worksheet 2 should be Cell B2 in worksheet 1/
I have recorded the macro, but I want to apply to cell B2 to SD30 in worksheet
2.
The following is the recorded code, how could I add some loop code to get my
desired results.
thx.
Sub vba()
'
'
'
Sheets("2").Select
Range("B2").Select
With Selection.Validation 
      .Delete 
      .Add Type:=xlValidateCustom,
AlertStyle:=xlValidAlertStop, Operator:= _ 
      xlBetween, Formula1:="='1'!B2" 
      .IgnoreBlank = True 
      .InCellDropdown = True 
      .InputTitle = "" 
      .ErrorTitle = "" 
      .InputMessage = "" 
      .ErrorMessage = "" 
      .IMEMode = xlIMEModeNoControl 
      .ShowInput = True 
      .ShowError = True 
End With
End Sub
Topic 510

Subject
How not to show data in a Pivot Table
Question
This table has 3 cases. First, where data for the group and each region and
state under it is present, second, data for the group is absent but for each region
and state is present, and third, data for group is present but the same is absent
for each region and state. I have created a pivot below the data from the same.
What I would like to do is, not to show the group data when data for group,
region and state are all present because then it is taking the group as a separate
entity and adding it to the total (towards the bottom of the pivot, for US group).
Is there a way I can do that? Answer
Im not quite sure what you want, since you are only stating what you do not
want... What should show up... region + rev
Topic 511
Subject
Excel VBA Replacing Loop with Array for Performance Gains
Question
Earlier today I got some help in developing a bit of code that would take the
contents of a cell and place it in a comment that could display when being
moused over.
It works great, but on a 6000 row spreadsheet it can take a while. I read here
that you can potentially replace looping logic with array logic to speed up the
process.
Any idea where I'd start in turning this from loop-based to array-based?
Dim iCell As Range On Error Resume Next 'included because of an error
when the .Formula function was triggered
For Each iCell In Selection 
      With iCell 
          If CStr(.Value) <> "" Then 
              .ClearComments 

              .AddComment 
              .Comment.Visible = False 
              .Comment.Text Text:=CStr(.Value) 
              .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
              .Comment.Shape.ScaleHeight 5.87, msoFalse,
msoScaleFromTopLeft '2.26 was the original height 
          End If 
          If .Formula <> "" Then 
              .ClearComments 
              .AddComment 
              .Comment.Visible = False 
              .Comment.Text Text:=CStr(.Formula) 
              .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
              .Comment.Shape.ScaleHeight 5.87, msoFalse,
msoScaleFromTopLeft 
          End If 
      End With 
Next
End Sub
As with last time, any and all help is appreciated, be it guidance or examples
or a solution - I intend to try and reverse engineer it to teach myself more about
this stuff. Thanks! Answer
This is an example of how you could improve your necessary range loop:
Using SpecialCells to work on formulae without looking at each cell.
Optimising Application settings.
Taking the line that hide comments out of the loop.
code
Sub Recut()
Dim rng1 As Range
Dim rng2 As Range
Dim lngCalc As Long
'look only at formulae

On Error Resume Next
Set rng1 = Selection.SpecialCells(xlFormulas) On Error GoTo 0
If rng1 Is Nothing Then Exit Sub
'Improve application settings for speed With Application
lngCalc = .Calculation
.ScreenUpdating = False
.Calculation = xlCalculationManual
.DisplayAlerts = False
End With
For Each rng2 In rng1.Cells
With rng2 
     .ClearComments 
     .AddComment 
     .Comment.Text Text:=CStr(.Formula) 
     .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
     .Comment.Shape.ScaleHeight 5.87, msoFalse,
msoScaleFromTopLeft 
End With
Next
'take comment display out of the loop
Application.DisplayCommentIndicator = xlCommentIndicatorOnly
With Application
.ScreenUpdating = True
.Calculation = lngCalc
.DisplayAlerts = True
End With
End Sub

Topic 512
Subject
Will excel run out of table names ever?
Question
I have a vba code that first deletes any tables that are in the workbook and
creates new tables in excel in a loop and right now it is making about 1000s of
them at once Currently I have the following table no.Table59860171 as the
name of a table.
Question is will excel at any point run out of unique names for a table ?
This question arised because I'll be running this same process again and again
so can this be a problem ?
If yes how can I avoid it ?
Answer
Yes, Excel will run out of table names. As Jules notes (and can be confirmed
by trying long names in Excel), Excel table names are limited to 255 characters
(as of the time of writing- I'm using Excel 2010). So, there is a finite number of
table names available.
However, the number of possibilities is very, very high. It is not quite every
combination of letters and numbers up to a 255 character string since some
combinations are not allowed, such as names that could also be a cell
reference (the table name "T100" is not allowed as it could also mean cell
T100).
Assuming that you continue naming tables from "Table1" to "TableN": Your
largest table name would be
Table9999999999999999999999999999999999999999999999999999999999
If you added 100 Billion tables every second, you could add tables for
1,157,407,407,407,407,407,407,407,407,407,407,407,407,407,407,407,407,40
days.

According to Sydney Observatory, the Earth will be engulfed by the Sun long
before you ever run out of table names.
Feel free to check my math- correct me if I've made a mistake:
9,999,999,999,999,999,999,999,999,999,999,999,999,999,999,999,999,999,99
/ (100,000,000,000 * 60 * 60 * 24)
Topic 513
Subject
Copy PDF table into Excel using VBA
Question
I am a rookie in VBA and I have a task, which is writing codes using VBA to
copy tables from PDF into Excel needs to be done.
I have searched on Google about this task, and the answers that I could get is
that the requirement has to be Acrobat Professional. However, I am using
Acrobat Reader.
Here is the concept flow that I have come out with.
Declare variables
Initialize Variables
Open PDF
Search "keywords"
Copy everything below the "keywords"
Activate Excel and go to the cells
Paste the table
However, I have met some obstacles in searching "keywords" and copy the
table.
Please help. Thanks in advance!
Topic 514
Subject
URL to a specific sheet for a Excel “Save a web page” export

Question
When a Excel file with multiple worksheets saving as web page, the htm
(loading in sharepoint) shows the sheets as tag at the bottom.
When you click the tab you will see the sheet.
But what is the URL that can go directly to that sheet in IE/Chrome?
Topic 515
Subject
Get Large and Small for every group where a column value is equal and return
a 3rd column value
Question
I have a large set of data (approx. 500,000 rows) with water level information.
There are 3 columns.
1. the water level (i.e. 0.7)
2. the date (i.e. 03/01/16)
3. the time (i.e 6:06:00)
I need to get the 2 largest and 2 smallest values from A for every day B and
return A & C.
So basically for all the rows where the date is equal find the largest and
smaller tell me those values and give me the associated time.
Here is a bit of data:
2.730 | 03/04/16 | 3:54:00
2.734 | 03/04/16 | 3:36:00
2.735 | 03/04/16 | 3:48:00
2.736 | 03/04/16 | 3:42:00
0.046 | 03/05/16 | 10:30:00
0.047 | 03/05/16 | 10:36:00
0.048 | 03/05/16 | 10:24:00
0.050 | 03/05/16 | 10:42:00
0.052 | 03/05/16 | 10:18:00

0.056 | 03/05/16 | 10:48:00
There are approximately 240 rows for every day for 5 years. In the end I want
a table with just the highs and lows from every day with the time.
I have tried various solutions like
=LARGE(A2:A241,1)
on column A and
=VLOOKUP(F2,A2:C241,2,FALSE)
to grab the associated data, but I have no idea how to do it for multiple days
without manually selecting each day and doing the formula 1826 times. Please
Help. Thanks. Answer
With such a large data set you want to avoid array formulas, so an approach
that limits the lookup range for a Small() or Large() is better.
Consider the screenshot and the results of the formulas. I entered the first date
in E2 and used the fill handle to drag down and auto-increment. My dates
display in DMY order.
The formulas are
F2
=LARGE(INDEX($A:$A,MATCH($E2,$B:$B,0)):INDEX($A:$A,MATCH($E
G2
=LARGE(INDEX($A:$A,MATCH($E2,$B:$B,0)):INDEX($A:$A,MATCH($E
H2
=SMALL(INDEX($A:$A,MATCH($E2,$B:$B,0)):INDEX($A:$A,MATCH($E
I2
=SMALL(INDEX($A:$A,MATCH($E2,$B:$B,0)):INDEX($A:$A,MATCH($E
.... copied down. This approach requires that the data is sorted ascending by

the dates in column B.
To return the matching value from column C, wrap the formula in an Index on
column C with a Match on column A, for example the time for the 2nd Smallest
is
=INDEX($C:$C,MATCH(SMALL(INDEX($A:$A,MATCH($E2,$B:$B,0)):IN
Answer
Try this:
In E2 the only Array formula:
=IFERROR(INDEX($B$1:$B$10,MATCH(0,IF(COUNTIF($E$1:$E1,$B$1:$B
This one formula must be confirmed with Ctrl-Shift-Enter.
In F2:
=IF(E2<>"",AGGREGATE(15,6,$A$1:$A$10/($B$1:$B$10=E2),1),"")
In G2:
=IF(E2<>"",INDEX($C$1:$C$10,MATCH(AGGREGATE(15,6,$A$1:$A$10/(
In H2:
=IF(E2<>"",AGGREGATE(14,6,$A$1:$A$10/($B$1:$B$10=E2),1),"")
In I2:
=IF(E2<>"",INDEX($C$1:$C$10,MATCH(AGGREGATE(14,6,$A$1:$A$10/(
Then copy down. The aggregate function was introduced in 2010.
Then copy the formula down as far as needed. In the picture the formulas are
copied down to row 15.

This method does not care if the list is ordered or not.
If it is ordered than I believe that @teylyn answer is a quicker compute.
Answer
I am adding this as another answer, not trying to provide a solution to the
question, but because I want to show my findings about the calculation speed
comparison between the Index and the Aggregate approaches provided in
previous answers.
Setup
Excel "data" sheet with 500,000 rows of data, columns "value", "date", "time"
Each date is represented multiple times. The data ranges from 1/Jan/2000 to
5/Apr/2014. There are 98 entries for each day.
On another sheet Column E has the 5209 dates, one date per row. Two different
formulas are used in columns F and G to find the largest value for each date in
the "data" sheet.
Column H compares the output of the two formulas and cell K1 counts the
differences in the results. There is no difference. Both formulas provide
exactly the same result.
The sheet has 5209 rows with formulas. Each of these formulas evaluates
500,000 rows of data.
The formula in the "Index" columns is
=LARGE(INDEX(data!$A:$A,MATCH($E3,data!$B:$B,0)):INDEX(data!$A:$
Note: This approach depends on the source data to be sorted ascending by the
date column. Chances are that the data is generated by some monitoring system
that will put one reading after the other. Unless there is human or programmatic
intervention, I will assume that the data is sorted by date.
The formula in the "Aggregate" column is

=AGGREGATE(14,6,data!$A$2:$A$500000/(data!$B$2:$B$500000=E2),1)
The goal is to work out which formula is more efficient, i.e. calculates faster. I
am using code written by Charles Williams, who specializes in performance of
formulas and VBA. I have used his Range Timer, as published in this MSDN
article.
Here is a screenshot of my setup:
I selected the column with the Index formula and ran the timer three times. The
results were in the range of 19 seconds.
I then selected the column with the Aggregate formula and ran the timer. The
first pass took 411 seconds, which is 6:52 minutes. The second pass took 425
seconds (7:05 mins).
I did not run a third pass on the Aggregate formula results, because my laptop
fan was going into overdrive and getting quite hysterical and high-pitched.
Why am I posting this?
I would like to draw attention to a few things:
data samples in questions often contain only a few rows of data hence,
formulas suggested here are often only tested on a small data sample, but when
used in the real environment may not perform as well as expected. the
suggested Index formula looks complicated and is quite a mouthful. The
suggested Aggregate formula is much shorter and looks much neater, BUT, the
formula with Index performs a LOT better than the formula with Aggregate.
Hence: a shorter formula does not always result in a faster calculation
My sample file can be accessed here, if you want to give it a spin. Just be
aware that it's around 20 MB, since it has so much data. To run the macro,
select a range and click the blue button.
Topic 516
Subject
Display the First Last Instance Of an Item in A Given Quarter

Question
In my spreadsheet I have a line similar to the one below for each day of the
year. I am trying to write a formula that will find the first and last instance of
"work" in column B and display the number of weeks between those two dates.
If anyone could provide some suggestions it would be greatly appreciated, I
have been fighting with this for the last few hours.
|Date|Work Status|Tasks|
|01-Jan-16 (Fri) | Work | 7 |
|02-Jan-16 (Sat) | Day Off | 0 |
|03-Jan-16 (Sun) | Day Off | 0 |
Answer
Create a new column that adds up time whenever the task column has anything
else than "work".
=IF(B2<>"Work",1,0)
Then for a given period you do a sumifs() over that column with the period you
are interested in, or a pivotchart if you are more familiar with that.
Answer
Try this formula
{=
(DATEVALUE(MID(INDEX(A2:$A$15,MAX(("Work"=MID(A2:A15,20,4))M
DATEVALUE(MID(INDEX(A2:$A$10,MATCH(""&"Work"&"*",A2:$A$10,0
The first part returns the date associated with the last instance of "Work" in the
list and the second part returns the first instance. There may be a way to
simplify this a bit if you play around with the formula.
Topic 517
Subject
Write multiple excel/csv files from a large data.frame
Question

I have a large data frame of over 500,000 rows. I wish to export it to multiple
excel/csv files with a certain row limit (e.g. 100,000 rows).
My solution is:
library(openxlsx)
write.xlsx(df[1:100000,], "path")
write.xlsx(df[100001:200000,], "path")
write.xlsx(df[200001:300000,], "path")
write.xlsx(df[300001:400000,], "path")
write.xlsx(df[400001:500000,], "path")
Is there any elegant way to do it?
Thanks
Answer
You could try something like...
breaks <- split(1:nrow(df), ceiling(seq_along(1:nrow(df))/1e5))
lapply(breaks,
function(x) 
   write.xlsx( 
        df[x,], 
        paste0("path",substr(x[1],1,1),".xlsx") 
)
Change 1e5 to change the number of rows to include in each break. Should
output something like path1.xlsx,path2.xlsx, ...
Answer
batchSize=100; # number of rows in single output file filename="file_name"; #
prefix of output file
chunks=split(df, floor(0:(nrow(df)-1)/batchSize)) for (i in 1:length(chunks))
{

write.xlsx(chunks[[i]],paste0(filename,i,'.xlsx')) }
Above will create file_name1.xlsx, file_name2.xlsx, .... etc. in your working
directory.
Topic 518
Subject
Find exact match of text in excel array (from another sheet) and display a
specific cell value from the same row
Question
I am comparing two separate spreadsheets. I need to write a formula that will
find the exact text in the other sheet (if it exists), and will then display a value
in the corresponding row only 5 cells over.
I have tried various iterations of Index Match to no avail. Any help would be
greatly appreciated. The sheets are formatted roughly the same way.
Let me know if I am not being clear enough.
I used this formula, but it is displaying data regardless of whether or not the
cell data matches data in the other sheet's row.
=IF(ISERROR(INDEX(product_performance!$A$2:$E$850,SMALL(IF(produ
Answer
You cannot ask for the 8th column within $A$2:$E$850 because that only
references 5 columns. The formula you are using seems to be for returning a
first, second, third, etc. matching value but your narrative gives no mention of
multiple returns. For single returns, a VLOOKUP function or INDEX/MATCH
function pair would be best.
'vlookup
=IFERROR(VLOOKUP($A13, product_performance!$A$2:$H$3450, 8,
FALSE), "") 'index/match
=IFERROR(INDEX(product_performance!$A$2:$H$3450, MATCH($A13,
product_performance!$A$2:$A$3450, 0), 8), "")
=IFERROR(INDEX(product_performance!$H$2:$H$3450, MATCH($A13,

product_performance!$A$2:$A$3450, 0)), "")
For multiple returns, throw out the SMALL function in favor of the newer
AGGREGATE¹ function. As a standard (non-array) formula,
=IFERROR(INDEX(product_performance!$H:$H, AGGREGATE(15, 6,
ROW($1:$3450)/(product_performance!$A$1:$A$3450=$A$13),
ROW(1:1))), "")
Fill down for subsequent returns.
The IFERROR function has been around sinbce xl2007 and drastically reduces
the formula needed for error control of IF(ISERROR(....
Topic 519
Subject
Pentaho Filter Regexp Excel Input
Question
Ok, so what I'm trying to do now is take all the information off an Excel Input
(all String columns), and then of these columns I want to make an specific filter
for one of them, more specific on column NO_BIEN, this specific expression.
[0-9]+(.[0-9][0-9]?)?
I make a Filter Rows operation and click on the REGEXP filter but I don't see
where can I paste the expression because all I can see if to add a String.
Answer
Place the regular expresssion in the filter-field "value"
Topic 520
Subject
How do I prevent unlocked cells from being selected/editable? (VBA)
Question
I have a very specific question that I am looking for help in answering. I have
been researching for hours and I feel like I am not able to find what I am
looking for. Below is a quick overview of the criteria that my document must

follow:
I am using Excel 2013
I will just be using rows for data input (instead of an excel object table).
The very top/first row will act as my "column header". This top row will have
AutoFilter enabled. THE DOCUMENT MUST BE PROTECTED (a must-
have)! I will be using VBA code
Now, the final issue I am having with finishing this document are the last two
criteria points that I must have:
The first/top row (column headers) must NOT BE EDITABLE. Each column
must be able to SORT AND FILTER.
Now, in a perfect world, I would just "Lock Cells" for the entire first row that
acts as my column headers and when I protect the worksheet I would make sure
to check the "Sort" and "Use AutoFilter" boxes.
However, this option does not work because there seems to be an issue when I
try to sort the data. If I just filter the data there is no problem, but when I try to
sort a column in ascending/descending order I will get an error informing me
that I can't sort locked cells while in Protected mode. This is because when
excel uses the Sort function, it counts the header as part of the data that is being
sorted (I found this out through my research) even though I really just want the
data below it to be sorted.
I have been trying to brainstorm on how to get past this issue as well as
researching different methods, and I am having trouble coming to a final
conclusion. However I have narrowed it down to 2 possible solutions:
I want to be able to keep the cells in the first row officially unlocked to allow
the AutoFilter's sort command to work as intended, but make it "behave" like
the cells are locked when a user tries to make changes to it (AKA, make the
entire row un-editable or un-selectable). The other option would be to keep the
first row locked but somehow have an event in VBA that can tell when a user
tries to "Sort" the column, which will then temporarily unprotect the
worksheet, follow through with the intended sort command, then protect the
worksheet again (apparently though, upon my research there is no such event

that can trigger off the AutoFilter's sort command alone).
These 2 solutions are the most logical I can think of based off my research, but
if someone out there is an Excel genius and knows another way I am open to
suggestions.
Thanks in advance for your help/suggestions,
Travo
Answer
Consider using two header rows. The top row would be protected and the
second row would facilitate filtering and sorting of the data in rows 3 and
below.
Topic 521
Subject
Get Sum Of Columns Values Filtered Based On Another Columns Date
Question
I have a spreadsheet that basicly have several hundred rows that look like this
|01-Jan-16 (Fri) | Work | 0 | 0 | 3 | 0 | 9 | 7 | 0 | 0 |
I have been trying to generate a query that will calculate the total of each of the
columns during any given quarter. So it will essentially select all the dates for
month 1-3, 4-6, 7-9, 10-12 and calculates the total of value in all the 8
columns.
I have tried sumsif, and sumproduct but I can't get it to work, I am currently
playing around with
=SUMPRODUCT( (MONTH('2016'!$A4:$A999)=1) *
(MONTH('2016'!$A4:$A999)=2) * (MONTH('2016'!$A4:$A999)=3) *
('2016'!$C4:$C999) )
=SUMIFS('2016'!C4:C999, '2016'!A4:A999, "<=3", '2016'!A4:A999, ">=1")
=SUMPRODUCT((MONTH('2016'!$A4:$A999)>=1)*

(MONTH('2016'!$A4:$A999)<=3)*('2016'!B4:B999)) Answer
This worked for me.
=SUMPRODUCT( (MONTH('2016'!$A4:$A999)=1) *
(MONTH('2016'!$A4:$A999)=2) * (MONTH('2016'!$A4:$A999)=3) *
('2016'!$C4:$C999) )
Answer
The date field is not a date value but a string so that is what is causing the
problem. To get it to work you will need to pull out the date value for the
match. I tested this with data created based off your example and it worked.
=SUMPRODUCT((MONTH(DATEVALUE(MID(A2:A5,1,9)))<=3)*(C2:J5))
Topic 522
Subject
Using Split function to find last folder in file path with only one line
Question
I have a function that looks like
Dim arrFold() As String
Dim lastFold As String
arrFold = Split(filePath, "\")
lastFold = arrFold(ubound(arrFold))
I am looking for a way to simplify this into just finding the last element on the
first line, rather than having to define an array initially, what can be done to
avoid adding that to memory? Answer
debug.print mid(filePath, instrrev(filePath, chr(92))+1) debug.print
trim(right(replace(filePath, chr(92), space(999)), 999))
Answer
Sub findLast()

Dim myString As String
myString = "\File\lesser\evenless\least" MsgBox InStrRev(myString, "\")
End Sub
Topic 523
Subject
How to find minimum and maximum values in Column B based on a specific
string in column A?
Question
I have a list of items in Column A and have corresponding year and month
values in Column B and C respectively. I am looking to find the minimum and
maximum year in Column B (based on specific value in Column A), then find
the corresponding month in Column C (only for max and min value) and then
generate and fill in a Start and End date in Column E and F respectively. E.g.
IF @Item = Laptop THEN FIND MIN,MAX of @YEAR and THEN FIND
adjacent value in @Month. Finally formulate and display a date accordingly.
Could i achieve this using a formula or is it out of scope and is better achieved
using a macro? Answer
For the Start date, in E2:
=IF(A2<>A1,DATE(AGGREGATE(15,6,$B$1:$B$1000/($A$1:$A$1000=A2
($B$1:$B$1000 =
AGGREGATE(15,6,$B$1:$B$1000/($A$1:$A$1000=A2),1))),1),1),"")
And for the end date in F2:
=IF(A2<>A1,EOMONTH(DATE(AGGREGATE(14,6,$B$1:$B$1000/($A$1:$
($B$1:$B$1000 =
AGGREGATE(14,6,$B$1:$B$1000/($A$1:$A$1000=A2),1))),1),1),0),"")
Then copy down the desired rows.
The aggregate function was introduced in 2010 so it will not work in excel
2007 or earlier.
I over thought they can be simplified to:

=IF(A2<>A1,AGGREGATE(15,6,DATE($B$1:$B$1000,$C$1:$C$1000,1)/($
And
=IF(A2<>A1,AGGREGATE(14,6,EOMONTH(DATE($B$1:$B$1000,$C$1:$C
Thanks to @Jerry for showing a more succinct method.
Answer
Here is something that I think should work for any version of Excel, and thanks
to the comment from @ScottCarver you can now copy it down and it will put
the dates on the first row of each Item:
Enter this in E2 as an array formula and then copy down:
=IF(A2<>A1,MIN(IF(A:A=A2,DATE(B:B,C:C,1))),"")
Enter this in F2 as an array formula and then copy down:
=IF(A2<>A1,MAX(IF(A:A=A2,DATE(B:B,C:C+1,0))),"")
Because these are array formulas you need to press control-shift-enter instead
of just enter. After they are entered they will be surrounded by { } to indicate
that they are array formulas.
Original Answer:
Here is something that I think should work for any version of Excel, but you
can't copy it down - you have to enter one separately for every Item. If you
really want them spread out so that the dates are on the row of the first
occurance of the Item (like in your screenshot) then this won't really work for
you.
For the start date of the Laptop Item:
=MIN(IF(A:A="Laptop",DATE(B:B,C:C,1)))

For the end date of the Laptop Item:
=MAX(IF(A:A="Laptop",DATE(B:B,C:C+1,0)))
These are array formulas so you need to press control-shift-enter instead of
just enter. After they are entered they will be surrounded by { } to indicate that
they are array formulas.
Topic 524
Subject
LinqtoExcel: Not able to use where clause to select a row data
Question
I am using linqtoexcel for my automation project. This file contains different
site URL and its credentails. If I use only one row I am able to login to that
site. But if there are two rows then I am having problem in using where clause.
Please help if you can if you do not understood anything please ask question.
My excel Sheet
Below is my code.
string pathfile = @"..\..\Data.xlsx";
string sheetName = "Login";
var excelFile = new ExcelQueryFactory(pathfile); var abc = from a in
excelFile.Worksheet(sheetName).AsEnumerable() where Row.Field<String>
("ID").Trim() == "2" select a;
PropertiesCollection.driver.Manage().Window.Maximize(); foreach (var a in
abc)
{
PropertiesCollection.driver.Navigate().GoToUrl(a["URL"]); }
foreach (var a in abc)
{
objLogin.Login(a["uname"], a["paswd"]); }
I know I am wrong as per my code. Also I know, I have an error in
Field<String>

Please guide what will the better way to use where clause in linqtoexcel.
Answer
This will help a specific row as per you condition. You just have to make
changes in where clause.
string pathfile = @"..\..\Data.xlsx";
string sheetName = "Login";
var excelFile = new ExcelQueryFactory(pathfile); var abc = from a in
excelFile.Worksheet(sheetName).AsEnumerable() 
        where a["ID"] == "2" 
        select a; 
PropertiesCollection.driver.Manage().Window.Maximize(); foreach (var a in
abc)
{
PropertiesCollection.driver.Navigate().GoToUrl(a["URL"]); }
foreach (var a in abc)
{
objLogin.Login(a["uname"], a["paswd"]); }
Topic 525
Subject
Googlesheet - Auto complete cell
Question
I have a table like this in one sheet:
And in my other sheet, I have this:
I choose some people from the first list and I'd like the cell E9 and E10 to be
completed with the content of the relative column B cell of my previous list
choice.
How can this be accomplished?
Topic 526

Subject
How do I generate Unicode Text files with UTF-8 encoding from Excel?
Question
I need to generate a text file from my workbook. The text file should be in
Unicode to preserve exotic characters, and should also follow UTF-8
encoding.
Below is the code that I am using. however, the generated text file is always
encoded in UCS-2 LE BOM.
ActiveWorkbook.WebOptions.Encoding = msoEncodingUTF8
ActiveWorkbook.SaveAs
Filename:="C:\Users\User1\Desktop\testunicode.txt", _
FileFormat:=xlUnicodeText, CreateBackup:=False
Topic 527
Subject
Exclude zero values from array comparison
Question
I've got this formula, which checks if there are any consecutive numbers within
the range:
{=IF(SUM(--(ABS(C31:BI31-TRANSPOSE(C31:BI31))=1)),"Yes","No")}
It works perfectly, but I want to exclude zero values from conparison process.
4 6 2 8 0 9 - Result: "Yes"
0 1 7 5 9 2 - Result: "Yes", but it should be "No", since 0 and 1 should not be
counted as consecutive numbers. Answer
=IF(SUMPRODUCT(COUNTIFS(C31:BI31,1+1/(1/C31:BI31))),"Yes","No")
Regards
Answer

I'm not 100% sure that your original array formula is 'working perfectly'; you
might want to double-check the results. Try this standard formula using the
newer AGGREGATE function¹ to provide cyclic processing.
=IF(AGGREGATE(15, 6, ABS(C31:BH31-D31:BI31)/((C31:G31<>0)*
(D31:BI31<>0)), 1)=1, "yes", "no")
¹ The AGGREGATE function was introduced with Excel 2010. It is not
available in earlier versions.
Topic 528
Subject
data validation list with a vba array [duplicate]
Question
This question already has an answer here:
Create data validation list when some of the values have commas?
3 answers
i am trying to create a data validation list using vba code. The array generate
itself depending on many variable.
here is the code i am using
For iter4 = 2 To nbWsheet
If Wsheet.Cells(iter4, 2) = Cat And Wsheet.Cells(iter4, ColMod) = "x" And
Wsheet.Cells(iter4, ColStd) = "oui" Then 
              TableValue = Wsheet.Cells(iter4, 4).Value & " -
" & Wsheet.Cells(iter4, 7).Value 
              Table = Table & "," & TableValue 
          End If 
      Next iter4 
      'Ajout de la list 
      With Cells(iGlob, 5).Validation 

          .Delete 
          .Add Type:=xlValidateList,
AlertStyle:=xlValidAlertStop, Operator:= _ 
          xlBetween, Formula1:=Table 
          .IgnoreBlank = True 
          .InCellDropdown = True 
          .InputTitle = "" 
          .ErrorTitle = "" 
          .InputMessage = "" 
          .ErrorMessage = "" 
          .ShowInput = "" 
          .ShowError = "" 
      End With 
The problem with this code, is the text in the table contain ",". When the data
validation list is generated, every time it see a "," it put the text on a new line...
Is there a way to keep the "," inside the table
Exemple of what i want to display : 123456 - Engine, 300HP
Hope i was clear,
Thanks,
Answer
I don't think there is an escape character for the comma in custom list.
According to MSDN Validation.Add, the comma always separate the entries.
One workaround is to use Dynamic Named Range.
Use a spare column in a hidden sheet or somewhere, lets use Column A for
demo In A1, put in "DV_ListTable", Define the cell with name DV_ListTable
Highlight Column A, Define it as DV_ListColumn Define another name using
Name Manager as DV_List with RefersTo as
=OFFSET(DV_ListTable,1,0,IF(COUNTA(DV_ListColumn)-1=0,1,COUNTA(D
Now the Data Validation will be (cell D1):
Then the macro to change this dynamic range contents will be:

Option Explicit
Sub ChangeDataValidationList()
Dim i As Long, Table As String, TableValue As String Dim oRng As Range,
oValues As Variant
With ThisWorkbook 
      ' Build up the new table list 
      Table = .Names("DV_ListTable").RefersToRange.Value '
Header 
      ' For Demo, the data is from Columns next to the
DV_ListTable 
      Set oRng =
.Names("DV_ListTable").RefersToRange.Offset(0, 1) 
      Do Until IsEmpty(oRng) 
          TableValue = oRng.Value & " - " & oRng.Offset(0,
1).Value 
          Table = Table & vbCrLf & TableValue 
          Set oRng = oRng.Offset(1, 0) 
      Loop 
      Set oRng = Nothing 
      ' Clear the contents in the column 
      .Names("DV_ListColumn").RefersToRange.ClearContents 
      ' Paste in the values separated by vbCrLf 
      oValues = Application.Transpose(Split(Table, vbCrLf)) 
    
.Names("DV_ListTable").RefersToRange.Resize(UBound(oValues))
= oValues 
      Set oValues = Nothing 
End With
End Sub
Sample screenshot after "ChangeDataValisationList" executed:
Hope this helps you on the right direction for a work around.
Answer
Replace "," with Chr(44). The Chr function returns a string based on the VBA

character code. I find it also comes in handy when you want to insert a double-
quote (Chr(34) for a double quote).
Topic 529
Subject
Operation not permitted when object is closed
Question
I'm rather new to the VBA - SQL Server interaction. Currently I try to read in
data from Excel and add it to a table in SQL Server. I don't understand why I
get the error that the object is closed. If there are any other mistakes or things
that can be coded more easily or in a better way, feel free to share!
Sub UpdateBG_Results()
Dim dbConnectStr As String
Dim connect As ADODB.Connection
Dim results() As Variant
Dim rec As ADODB.Recordset
Dim fieldsArray() As String
Sheets("Operational KPI's ROUND").Select fieldsArray() =
GetStringArray(ActiveSheet.Range("Y12:AO12")) results =
ActiveSheet.Range("Y14:AO14").Value
dbConnectStr = "Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist
Security Info=False;Data Source=HOME27C4K12\SQLEXPRESS"
Set connect = New ADODB.Connection
connect.Open dbConnectStr
Set rec = New ADODB.Recordset
rec.Open "USE Current_state1 SELECT * FROM BG_Results", connect,
adOpenKeyset, adLockOptimistic
rec.AddNew fieldsArray, results
rec.Update

rec.Close
End Sub
Topic 530
Subject
Write 2 columns in a csv file from an array
Question
I'm trying to write in 2 differents columns in a csv file but everything I've found
set all the values in the first column with a separator.
Here is a small modification of the script example on php.net
<?php
$list = array (
['City', 'Country'],
['Brussels', 'Belgium'],
['Paris', 'France'],
['Berlin', 'Germany']
);
$fp = fopen('file.csv', 'w');
foreach ($list as $fields) {
fputcsv($fp, $fields);
}
fclose($fp);
?>
And here is my csv file (I use Excel)
My question: is it possible to have the cities in A column and the countries in B
column?
Thanks you for your help

Answer
You need to tell your spreadsheet program that the columns are separated by
commas.
You will probably get the option to nominate a delimiter on opening the file.
I think you also have an option on a column - something like "Text to columns"
Answer
You can tell fputcsv() to use a different string as the delimiter instead of
comma. This will use TAB, which is probably Excel's default:
fputcsv($fp, $fields, "\t");
Topic 531
Subject
How to append columns from csv file to pipe-delimited text file based on
common identifier
Question
I have a number of pipe-delimited text files, all containing the same fields but
each for a different period. For example, xxxxxxxx100 is for 1/1/2016,
xxxxxxxx200 is for 2/1/2016, and so on.
I also have a .csv file that includes an identifier and the period in
"mm/dd/yyyy" format, as well as columns not found in the text files.
I'd like to add these new columns to the pipe-delimited text files, and the
criteria are to match (a) the identifier, and (b) the correct file, where *101 =
"1/1/2016" and so on.
Is that best accomplished in PowerShell, or is there a better way to do this?
Topic 532
Subject
VBA - Remove Seconds from NOW function

Question
I have something that notify me an hour before it happens. For that, I use the
NOW function in VBA as I need it to check for the Date as well.
The problem is the script runs every 20 seconds so I can't have it consider
seconds for the NOW function.
Is there a way to remove those? To have only like
(DAY,MONTH,YEAR,HOUR,MINUTE)?
Something along those lines:
MyLimit = NOW(DAY,MONTH,YEAR,HOUR,MINUTE)
For Each FormulaCell In FormulaRange.Cells With FormulaCell 
          If .Value = MyLimit Then 
          Call Notify 
Here is the script in which I attempt to detect the date and time.
Option Explicit
Public Function AutoRun()
Application.OnTime Now + TimeValue("00:00:20"), "TaskTracker2" End
Function
Public Sub TaskTracker2()
Dim FormulaCell As Range
Dim FormulaRange As Range 
Dim NotSentMsg      As String 
Dim MyMsg           As String 
Dim SentMsg         As String 
Dim SendTo          As String 
Dim CCTo            As String 
Dim BCCTo           As String 
Dim MyLimit         As Date 

NotSentMsg = "Not Sent"
SentMsg = "Sent"
SendTo = Range("D2")
CCTo = Range("E2")
BCCTo = Range("F2")
MyLimit = Format((Now), "DD/MM/YYYY HH:MM")
Set FormulaRange = Range("E5:E35")
On Error GoTo EndMacro:
For Each FormulaCell In FormulaRange.Cells
With FormulaCell 
          If .Value = MyLimit Then 
              MyMsg = SentMsg 
              If .Offset(0, 1).Value = NotSentMsg Then 
                  strTO = SendTo 
                  strCC = CCTo 
                  strBCC = BCCTo 
                  strSub = "[Task Manager] Reminder that you
need to: " & Cells(FormulaCell.Row, "A").Value 
                  strBody = "Hello Sir, " & vbNewLine &
vbNewLine & _ 
                      "This email is to notify that you that
your task : " & Cells(FormulaCell.Row, "A").Value & " with the
following note: " & Cells(FormulaCell.Row, "B").Value & " is
nearing its Due Date." & vbNewLine & "It would be wise to
complete this task before it expires!" & _ 
                      vbNewLine & vbNewLine & "Truly yours,"
& vbNewLine & "Task Manager" 
                  If sendMail(strTO, strSub, strBody, strCC)
= True Then MyMsg = SentMsg 
              End If 
          Else 
              MyMsg = NotSentMsg 
          End If 
      Application.EnableEvents = False 
      .Offset(0, 1).Value = MyMsg 
      Application.EnableEvents = True 
End With

Next FormulaCell
AutoRun
ExitMacro
Exit Sub
EndMacro
Application.EnableEvents = True
MsgBox "Some Error occurred." _ 
   & vbLf & Err.Number _ 
   & vbLf & Err.Description 
End Sub
Answer
You could just round MyLimit to the nearest minute:
MyLimit = Round(Now * 1440, 0) / 1440
Consider, when comparing it to the contents of a cell, that you might need to
use a <= or >= comparison to avoid problems if the time changes at the
"wrong" time for an equality to hold true.
Answer
To strip the seconds off Now, you can use some maths or to-and-from text
conversion.
CDate(format(Now, "dd-mmm-yyyy hh:mm")) '... or,
CLng(Now * 1440)/1440
Both of those return a true, numerical datetime value with the seconds stripped
off. They do not average the seconds to the nearest minute; simply remove
them.
Answer
Another method would be this:

MyLimit = now-second(now)/60/60/24
second(now) returns the seconds, and the /60/60/24 converts it to days, which
every date and time is stored in. Use this or Jeeped's answer, any one of these
should work.
Edit
To avoid the tiny but existing possibility of error, use this:
MyLimit = now
MyLimit =MyLimit -second(MyLimit)/60/60/24
Answer
Try limit = Format((Now), "DD/MM/YYYY HH:MM")
Answer
Use the Date function instead of the NOW function
https://msdn.microsoft.com/en-us/library/aa227520(v=VS.60).aspx
UPDATE
Topic 533
Subject
Copy lines from email to Excel into specific array
Question
I am needing to copy some data from emails into a spreadsheet with a VBA,
here is how the data is formatted in the email:
Items/Cost:
Item Description 1: $38.88
Quantity: 1

Item Description 2: $39.99
Quantity: 1
The Item Description is always different. Here is how I would like the output
to be formatted when copied to Excel:
And here is my current code that I've tried:
Sub CopyToExcel()
Dim xlApp As Object
Dim xlWB As Object
Dim xlSheet As Object
Dim xl
Dim olItem As Outlook.MailItem
Dim vText As Variant
Dim sText As String
Dim vItem As Variant
Dim i As Long
Dim rCount As Long
Dim bXStarted As Boolean
Dim rTime As Date
Const strPath As String = "C:\Tracking.xlsx" 'the path of the workbook
If Application.ActiveExplorer.Selection.Count = 0 Then
MsgBox "No Items selected!", vbCritical, "Error" Exit Sub
EndIf
On Error Resume Next
Set xlApp = GetObject(, "Excel.Application") If Err <> 0 Then
Application.StatusBar = "Please wait while Excel source is opened ... " Set
xlApp = CreateObject("Excel.Application") bXStarted = True
End If
On Error GoTo 0
'Open the workbook to input the data
Set xlWB = xlApp.Workbooks.Open(strPath) Set xlSheet =
xlWB.Sheets("Sheet1")

xlWB.Sheets(1).Cells.Delete
'Process each selected record
rCount = xlSheet.UsedRange.Rows.Count
'cCount = xlSheet.UsedRange.Columns.Count For Each olItem In
Application.ActiveExplorer.Selection sText = olItem.Body
rTime = Format(olItem.ReceivedTime, "mmmm d, yyyy") vText = Split(sText,
Chr(13))
'Find the next empty line of the worksheet rCount = rCount + 1
'Check each line of text in the message body For i = UBound(vText) To 0 Step
-1 
      If InStr(vText(i), "Items/Cost:") Then 
          'ParseText = vText(i + 1) & vbCrLf 
          xlSheet.Range("A" & rCount) = Trim(vText(2)) 
          vItem = Split(vText(4), Chr(58)) 
          xlSheet.Range("B" & rCount) = Trim(vItem(1)) 
          xlSheet.Range("A" & rCount + 1) = Trim(vText(6)) 
          vItem = Split(vText(8), Chr(58)) 
          xlSheet.Range("B" & rCount + 1) = Trim(vItem(1)) 
          xlSheet.Range("A" & rCount + 2) = Trim(vText(10)) 
          vItem = Split(vText(12), Chr(58)) 
          xlSheet.Range("B" & rCount + 2) = Trim(vItem(1)) 
          xlSheet.Range("A" & rCount + 3) = Trim(vText(14)) 
          vItem = Split(vText(16), Chr(58)) 
          xlSheet.Range("B" & rCount + 3) = Trim(vItem(1)) 
          xlSheet.Range("A" & rCount + 4) = Trim(vText(18)) 
          vItem = Split(vText(20), Chr(58)) 
          xlSheet.Range("B" & rCount + 4) = Trim(vItem(1)) 
      End If 
Next i
xlWB.Save
Next olItem
Set xlApp = Nothing
Set xlWB = Nothing
Set xlSheet = Nothing
Set olItem = Nothing

End Sub
Also I'm no expert at VB so any help is greatly appreciated.
UPDATE
I figured out how to extract it the way I want to but it's sloppy and not
dynamic. Sometimes there are 2 items and sometimes 5, so i need it to be
adaptable. Can someone help me clean it up by chance? Answer
Try the following
Option Explicit
Sub EmailToCsv()
Dim olItem As Outlook.MailItem
Dim xlApp As Excel.Application
Dim xlWB As Excel.Workbook
Dim xlSheet As Excel.Worksheet
Dim vText As Variant
Dim sText As String
Dim vItem As Variant
Dim i As Long
Dim RowCount As Long
Dim xlStarted As Boolean
Dim FilePath As String
'// Update File location
FilePath = "C:\Temp\Tracking.xlsx"
'// Process Selections
If Application.ActiveExplorer.Selection.Count = 0 Then 
      MsgBox "No Items selected!", vbCritical, "Error" 
      Exit Sub 
End If
On Error Resume Next

Set xlApp = GetObject(, "Excel.Application")
If Err <> 0 Then 
      Application.StatusBar = "Please wait while Excel source
is opened ... " 
      Set xlApp = CreateObject("Excel.Application") 
      xlStarted = True 
End If
On Error GoTo 0
'// Open the workbook to input the data Set xlWB =
xlApp.Workbooks.Open(FilePath) Set xlSheet = xlWB.Sheets("Sheet1")
'// Process each selected record
For Each olItem In Application.ActiveExplorer.Selection 
      sText = olItem.Body 
      vText = Split(sText, Chr(13)) ' Chr(13)) carriage
return 
      '// Find the next empty line of the worksheet 
      RowCount = xlSheet.Range("A" &
xlSheet.Rows.Count).End(xlUp).Row 
      RowCount = RowCount + 1 
      '// Check each line of text in the message body 
      For i = UBound(vText) To 0 Step -1 
          '// Item Description 1 
          If InStr(1, vText(i), "Item Description 1:") > 0
Then 
              vItem = Split(vText(i), Chr(58)) ' Chr(58) ":" 
              xlSheet.Range("A" & RowCount) = "Item
Description 1: " & Trim(vItem(1)) 
          End If 
          '// Quantity 
          If InStr(1, vText(i), "Quantity:") > 0 Then 
              vItem = Split(vText(i), Chr(58)) 
              xlSheet.Range("B" & RowCount) = Trim(vItem(1)) 
          End If 

          '// Item Description 2 
          If InStr(1, vText(i), "Item Description 2:") > 0
Then 
              vItem = Split(vText(i), Chr(58)) 
              xlSheet.Range("A" & RowCount + 1) = "Item
Description 2: " & Trim(vItem(1)) 
          End If 
          '// Quantity 
          If InStr(1, vText(i), "Quantity:") > 0 Then 
              vItem = Split(vText(i), Chr(58)) 
              xlSheet.Range("B" & RowCount + 1) =
Trim(vItem(1)) 
          End If 
      Next i 
Next olItem
'// SaveChanges & Close
xlWB.Close SaveChanges:=True
If xlStarted Then
xlApp.Quit
End If
Set xlApp = Nothing
Set xlWB = Nothing
Set xlSheet = Nothing
Set olItem = Nothing
End Sub
Topic 534
Subject
Reformatting macros so they repeat
Question
I found this code elsewhere on the web and adjusted it to my needs.
I have 20000 rows to go through. How could I modify this code to repeat every
105 lines, and place the results in the same columns spaced beneath the

previous. I also need the line by line data in percentage format as well.
Sub SumSectorWeight()
Dim rng As Excel.Range
Dim arrProducts() As String
Dim i As Long
Set rng = Sheet2.Range("A" & i & ":B" & i + 104)
arrProducts = getSumOfCountArray(rng)
Sheet2.Range("E1:E1").Value = Array("Sector", "Sector Weight")
' go through array and output to Sheet2 For i = 2 To 5000 Step 105 
      Sheet2.Cells(i + 2, "E").Value = arrProducts(0, i) 
      Sheet2.Cells(i + 2, "F").Value = arrProducts(1, i) 
Next
End Sub
Answer
I'm guessing the problem is that the relevant code was not inside the loop.
Please see\try the below:
Sub SumSectorWeight()
Dim Rng As Excel.Range
Dim arrProducts() As String
Dim i As Long
Sheet2.Range("E1:E1").Value = Array("Sector", "Sector Weight") ' go through
array and output to Sheet2 For i = 2 To 5000 Step 105 
      Set Rng = Sheet2.Range("A" & i & ":B" & i + 104) 
      arrProducts = getSumOfCountArray(Rng) 
      Sheet2.Cells(i + 2, "E").Value = arrProducts(0, i) 
      Sheet2.Cells(i + 2, "F").Value = arrProducts(1, i) 

Next
End Sub
Topic 535
Subject
Regexp producing #NAME? error in UDF
Question
I've found many things online that show me how to create the function and how
to implement it, but nothing is helping me figure out why it won't accept the
function's name.
I opened the Visual Basic section under developer. I've entered my code and I
assume that is it? Ctrl + S only makes me save the sheet, not the code.
The purpose of my code is to take a string and remove the first 7 characters,
one of which will be a ; and the following 6 will be random numbers. I have
some more fixing to do, such as removing 4 random characters from the end,
but I wanted to test it out first.
Here is my code:
Function simpleCellRegex(Myrange As Range) As String Dim regEx As New
RegExp
Dim strPattern As String
Dim strInput As String
Dim strReplace As String
Dim strOutput As String
strPattern = "^[;][0-9]{6}"
If strPattern <> "" Then
strInput = Myrange.Value
strReplace = ""

With regEx 
      .Global = True 
      .MultiLine = True 
      .IgnoreCase = False 
      .Pattern = strPattern 
End With
If regEx.test(strInput) Then
simpleCellRegex = regEx.Replace(strInput, strReplace) Else
simpleCellRegex = "Not matched" End If
End If
End Function
I'm not sure if there is a step that I am missing that will allow excel to accept
my code.
Thanks for any help!
Answer
Check out this thread. You most likely missed to add a reference to Microsoft
VBScript Regular Expressions 5.5. You find it under "How to use":
How to use Regular Expressions (Regex) in Microsoft Excel both in-cell and
loops
Answer
I have recut the code below to clean up the variables and use late binding
Also your current code doesnt test for the user taking more than one cell into
the range.
Function simpleCellRegex(Myrange As Range) As String Dim regEx As
Object
Dim strPattern As String

Dim strReplace As String
Set regEx = CreateObject("vbscript,regexp")
strPattern = "^[;][0-9]{6}"
If Len(strPattern) = 0 Then Exit Sub
simpleCellRegex = "Not matched"
strReplace = vbNullString
With regEx
.Global = True
.MultiLine = True
.IgnoreCase = False
.Pattern = strPattern
If .test(Myrange) Then simpleCellRegex = .Replace(Myrange.Value2,
strReplace) End With
End Function
Topic 536
Subject
IF statement in conditional fromating that involves date +10 days
Question
I need a conditional formatting If formula that reads like this. If the return date
is 10 days or more from the out date then red. Mine looks like this:
=IF(I2>H2=10) format red. I know this is simple but I cannot seem to figure
out what I'm missing here. Please help.
Topic 537
Subject
Excel 2013 complex countif formula
Question
I have a source sheet set up like this: 
Days Open     Month 

10             1 
4              1 
6              1 
2              1 
4              2 
2              2 
-1             2 
4              3 
6              3 
7              4 
3              4 
etc
I'm trying to set up a formula to count rows based on the following criteria:
cells in Days Open column <=5 and <>-1 where the month is either 2, 3, or 4
(the worksheet will eventually have month numbers up to 12, and I need to
group results quarterly). The total must then be divided by the total of ALL
rows in which 2, 3, or 4 appears in the Month column.
I can't seem to get the first part of the COUNTIFS to work with both criteria...
this is what I have so far that I'm trying to make work:
=COUNTIFS('Cumulative Complaints'!K:K,"<=5",'Cumulative
Complaints'!K:K,"<>-1")/(COUNTIF('Cumulative
Complaints'!L:L,"2")+COUNTIF('Cumulative
Complaints'!L:L,"3")+COUNTIF('Cumulative Complaints'!L:L,"4"))
I've been looking around here and other excel forums and think maybe
SUMPRODUCT is the way to go? I haven't been able to get that to work
though, given the criteria needed on the Days Open column (<=5 and <>-1).
Answer
Wrapping a COUNTIF or COUNTIFS function in a SUM function allows you
to use an array of constants as OR citeria.
=SUM(COUNTIFS('Cumulative Complaints'!K:K, "<>"&-1,'Cumulative
Complaints'!K:K, "<="&5,'Cumulative Complaints'!L:L,
{2,3,4}))/SUM(COUNTIF('Cumulative Complaints'!L:L, {2,3,4}))

This is not an array formula and does not require CSE.
Answer
Try this SUMPRODUCT() FORMULA:
=SUMPRODUCT(('Cumulative Complaints'!K:K<=5)*('Cumulative
Complaints'!K:K<>-1)*('Cumulative Complaints'!L:L>=2)*('Cumulative
Complaints'!L:L<=4))/SUMPRODUCT(('Cumulative Complaints'!L:L>=2)*
('Cumulative Complaints'!L:L<=4))
When using the SUMPRODUCT the condition AND is replaced with the . It
requires all four conditions to be True to return a 1; 11*11 = 1 if any are
false they return 0 so 11*0*1 = 0. So as it iterates through the rows it returns a
1 or a 0 to the be added to the sum.
Answer
My answer would be to take a different approach.
Excel has a very powerful feature called Pivot Tables, and I think it might be a
good fit for your problem and other similar problems you may face.
First, I would add a couple columns to your table, like so:
Days Open Month Quarter RecentlyOpened 
  10          1       1       FALSE 
  4           1       1       TRUE 
  6           1       1       FALSE 
  2           1       1       TRUE 
  4           2       1       TRUE 
  2           2       1       TRUE 
  -1          2       1       FALSE 
  4           3       1       TRUE 
  6           3       1       FALSE 
  7           4       2       FALSE 
  3           4       2       TRUE 
The formula for Quarter is: =CEILING(B2/3,1) The formula for

RecentlyOpened is: =AND(A2<>-1,A2<=5)
Second, select the table, and do Insert > Pivot Table.
Third, drag from the fields to the boxes, like so:
Drag Quarter to the ROWS box
Drag RecentlyOpened to the FILTERS box
Drag Month to the VALUES box
Fourth, click Sum of Month, and select Value Field Settings to change Sum to
Count.
Fifth, set the RecentlyOpened filter to TRUE.
The result is this:
Pivot Tables often provide a solution that is more flexible and easier to read
and understand versus complex formulas.
Topic 538
Subject
Inserting Formula ONLY visible Cells
Question
I have data in 3 Columns
A B & C, in which a Filter is active on column A, I want to apply a code so
that the formula is applied on Column C - from the 2nd visible row till the last
visible row.
Here is the code I have written, However It doesn't work if I change the
Range("C:C") or Range("C2:C")
Sub Test()
Dim rng As Range
Range("C1").Select

Set rng = Application.Intersect(ActiveSheet.UsedRange,
Range("**C2:C2000**"))
rng.Select
Selection.Formula = "=RC[-1]+RC[-2]"
End Sub
Answer
With an active AutoFilter method, presumably your first row contains column
header labels and the data is below that. The Range.CurrentRegion property is
a better fit for this situation than the Worksheet.UsedRange property.
The Range.SpecialCells method with xlCellTypeVisible will reference the
visible cells. I find that the worksheet's SUBTOTAL function provides a nice
non-destructive method of seeing iof there are visible cells before trying to
access them.
A few With ... End With statements will help you progressively isolate the
cells you are looking for.
Sub test()
'note that not a single var is necessary
With Worksheets("Sheet1") '<~~ surely you know what worksheet you are on 
      With .Cells(1, 1).CurrentRegion 
          With .Resize(.Rows.Count - 1,
.Columns.Count).Offset(1, 0) '<~~one row down 
              If CBool(Application.Subtotal(103, .Cells))
Then 
                  'there are visible cells 
                  With
.Columns(3).SpecialCells(xlCellTypeVisible) 
                      .Cells.FormulaR1C1 = "=RC[-1]+RC[-2]" 
                  End With 
              End If 
          End With 
      End With 

End With
End Sub
I've used the Range.FormulaR1C1 property (as opposed to your original
Range.Formula property) single you were using xlR1C1 not xlA1 formula
syntax.
Topic 539
Subject
VBA Dynamic Filtering and Copy Paste into new worksheet
Question
I am trying to write a vba script that will filter on two columns, column A and
column D. Preferably, I want to create a button that will execute once I have
chosen the filter criteria. Sample of input data below.
Sub Compiler()
Dim i
Dim LastRow As Integer
LastRow = Sheets("Sheet1").Cells(Rows.Count, "A").End(xlUp).Row
Sheets("Sheet4").Range("A2:J6768").ClearContents 
   For i = 2 To LastRow 
        If Sheets("Sheet1").Cells(i, "A").Values =
Sheets("Sheet3").Cells(3, "B").Values And
Sheets("Sheet1").Cells(i, "D").Values =
Sheets("Sheet3").Cells(3, "D").Values Then 
           Sheets("Sheet1").Cells(i, "A" &
"D").EntireRow.Copy Destination:=Sheets("Sheet4").Range("A" +
Rows.Count).End(xlUp) 
        End If 
   Next i 
End Sub
Sample Data to run vba script

Answer
I have included my previous answer's changes into the full code block that is
now provided below.
Sub Compiler()
Dim i
Dim LastRow, Pasterow As Integer
Dim sht As Worksheet
Set sht = ThisWorkbook.Sheets("Sheet4")
LastRow = Sheets("Sheet1").Cells(Rows.Count, "A").End(xlUp).Row
Sheets("Sheet4").Range("A2:J6768").ClearContents
For i = 2 To LastRow 
      If Sheets("Sheet1").Range("A" & i).Value =
Sheets("Sheet3").Range("B3").Value And
Sheets("Sheet1").Range("D" & i).Value =
Sheets("Sheet3").Range("D3").Value Then 
         Pasterow = sht.Cells(sht.Rows.Count,
"A").End(xlUp).Row + 1 
         Sheets("Sheet1").Rows(i).EntireRow.Copy
Destination:=Sheets("Sheet4").Range("A" & Pasterow) 
      End If 
   Next i 
Sheets("sheet4").Rows(1).Delete
End Sub
Answer
Sheets("Sheet1").Cells(i, "A").Values
Sheets("Sheet3").Cells(3, "B").Values
etc

You keep using values. Don't you mean value?
Answer
This answered the question I was asking, I tried to work with Dan's answer but
didn't get very far.
Private Sub CommandButton1_Click()
FinalRow = Sheets("Sheet1").Cells(rows.Count, 1).End(xlUp).Row
Sheets("Sheet4").Range(Sheets("Sheet4").Cells(1, "A"),
Sheets("Sheet4").Cells(FinalRow, "K")).ClearContents
If Sheets("Sheet4").Cells(1, "A").Value = "" Then
Sheets("Sheet1").Range("A1:K1").Copy
Sheets("Sheet4").Range(Sheets("Sheet4").Cells(1, "A"),
Sheets("Sheet4").Cells(1, "K")).PasteSpecial (xlPasteValues) End If
For x = 2 To FinalRow
ThisValue = Sheets("Sheet1").Cells(x, "A").Value ThatValue =
Sheets("Sheet1").Cells(x, "D").Value If ThisValue = Sheets("Sheet3").Cells(3,
"B").Value And ThatValue = Sheets("Sheet3").Cells(3, "D").Value Then
Sheets("Sheet1").Range(Sheets("Sheet1").Cells(x, 1),
Sheets("Sheet1").Cells(x, 11)).Copy Sheets("Sheet4").Select
NextRow = Sheets("Sheet4").Cells(rows.Count, 1).End(xlUp).Row + 1 With
Sheets("Sheet4").Range(Sheets("Sheet4").Cells(NextRow, 1),
Sheets("Sheet4").Cells(NextRow, 11)) .PasteSpecial (xlPasteFormats)
.PasteSpecial (xlPasteValues)
End With
End If
Next x
Worksheets("Sheet4").Cells.EntireColumn.AutoFit
End Sub

Topic 540
Subject
Data transfer using vb.net
Question
I am new to vb.net and very confused at this point. I have experience with vba
within excel and have taken a basic vb class at my university but I am clue less
when it comes to this.
I have multi projects I would like to try, but I am stuck on how to transfer data,
text string from one program to the other using a vb.net app!
I believe the process I am looking for is data binding? is that correct?
The 3 processes I am trying to accomplish.
Excel to Excel text or cell transfer/ copy and paste.
I have file A which is an excel file with rows and columns of data in cells.
Then I have file B which is a template with graphs and some other formulas. I
am trying to use a vb.net app to open file A copy all the data and paste into a
sheet in file B. I have figured out how to open the files but as for the data
transfer method I have not found anything.
Private Sub btn_Do_Click(sender As Object, e As EventArgs) Handles
btn_Do.Click
Dim txtpath As String
Dim csvpath As String = "C:\Temp"
Dim FileTXT As String
Dim folderpath As String
Dim FinalFile As String
folderpath = "C:\Users\aholiday\Desktop\Data Dump" FileTXT =
cbo_FileList.Text
csvpath = "C:\Temp\" & FileTXT & ".csv" txtpath = folderpath & "\" &
FileTXT & ".txt" FinalFile = "C:\Users\aholiday\Desktop\Book1"

File.Copy(txtpath, csvpath)
Process.Start("EXCEL.EXE", csvpath) Process.Start("EXCEL.EXE",
FinalFile)
File.Delete(csvpath)
End Sub
Access database to a chart in vb.net app.
Next I have an vb.net app that has a chart in it. How would I get data from an
excel file into it. I have no code for this because I am not sure what the method
I need is. I need this to be "live" meaning if someone changes something in the
excel file it will update on the chart in the app. But the the first step is getting
the data out of excel and into the chart. This is the only example I could find
and its for Microsoft access as the data source. It didn't work.
Imports System.Data.OleDb
Public Class Form1
Private Sub Button1_Click(sender As System.Object, e As
System.EventArgs)Handles Button1.Click
Chart1.Series.Add("Numbers")
Dim Conn As OleDbConnection = New OleDbConnection Dim Provider =
"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" Dim dataFile =
"C:\Users\aholiday\Desktop\Database11.accdb" Conn.ConnectionString =
Provider & dataFile Conn.Open()
'Adds data to chart
Dim cmd As OleDbCommand = New OleDbCommand("Select [Month],
[Number] FROM [Table1]", Conn) Dim dr As OleDbDataReader =
cmd.ExecuteReader While dr.Read
Chart1.Series("Table1").Points.AddXY(dr("Month").ToString,
dr("Number").ToString) End While
dr.Close()
cmd.Dispose()
End Sub

End Class
Excel to vb.net pictures and text string transfer.
And last. I have an vb.net app that have textbox and picture boxes in the design
layout. I have an excel file with strings of text and pictures within cells. I
would like code to copy the text and pictures and place them in the textbox and
Picturebox.
I would like to learn how one would accomplish any of those.Please post any
helpful content from sources. Any suggestions and especially examples would
be awesome. Please nothing from Microsoft unless it crystal clear. I have spent
about a day researching and googled everything I could think of and have found
very little. None that work when I try to use it.
Thank you
Topic 541
Subject
VBA Create a grid of shapes
Question
I'm working in VBA and Excel. I have created a button that opens a form and
gets a title and a link from the user, then makes a rectangle with that title that,
when clicked, opens the link (a makeshift button - didn't want to use command
buttons). I now need to make a grid of those rectangles, so that the user can
place the rectangle at any point in the grid, and if there is an existing rectangle
there, the old one is replaced with the new one.
How might I go about doing this? It doesn't matter if the grid starts full of
default rectangles. I'd prefer that the user place by filling out the form, but a
back-up plan that might be easier would be to allow the user to modify the
rectangles by right clicking with a drop-down button that opens the form (and
replaces the rectangle they clicked).
Thank you for your help! It is greatly appreciated.
Topic 542

Subject
Excel - Transpose Dynamic Columns into Rows in different sheet and copy
necessary data items
Question
I have data in the format below in Sheet 1:
I want to reorganize the data in format below in Sheet 2: The length for
"Identifier" will be dynamic. I have tried building macros for transpose with
loops and copy range but havent been successful. Any help is greatly
appreciated. Answer
This works. But you would have to rearrange the final results' columns to move
the "Identifier" column to the start of the result set.
Sub test()
Dim wb As Excel.Workbook
Dim ws As Excel.Worksheet
Dim A, B, R, C As Long
Dim x() As Variant
Dim y() As Variant
Set wb = ThisWorkbook
Set ws = wb.Sheets("Sheet1")
With ws
Range("A1").Select 
      A = Range("A" & Rows.Count).End(xlUp).Row 
      x = Range("A1", "I" & A) 
      y = Range("J1", "Z" & A) 
      For R = 1 To UBound(y, 1) 
          B = R + 0 
          For C = 1 To UBound(y, 2) 
              If (y(R, C)) <> "" Then 
                  Range("A" & B, "H" & B).Copy 
                  Range("A" & A + 1).PasteSpecial 
                  Application.CutCopyMode = False 

                  Range("I" & A + 1).Value = y(R, C) 
                  A = A + 1 
              Else 
              GoTo xxx: 
              End If 
          Next C 
xxx: 
      Next R 
      Range("A1").Select 
End With
End Sub
Answer
If I understand what you are after, here is a macro that does that. When it starts
it asks you to select the top left corner of the source data (it defaults to the
active cell) and then it asks for the top left corner of the destination - while the
selection box is up you can select the cell with the mouse if you don't want to
type it in. Put this code in a Module:
Sub TransposeByLastColumn()
'get the top left corner of the source
Dim Source As Range
On Error Resume Next
Set Source = Application.InputBox("Select Source:", "Source", "=" &
ActiveCell.Address, Type:=8) On Error GoTo 0
If Source Is Nothing Then Set Source = ActiveCell
'get the top left corner of the destination Dim Destination As Range
On Error Resume Next
Set Destination = Application.InputBox("Select Destination:", "Destination",
Type:=8) On Error GoTo 0
If Destination Is Nothing Then Exit Sub
'calculate the number of headers

Dim HeaderColumns As Long
HeaderColumns = 0
While Source.Offset(0, HeaderColumns).Value <> vbNullString
HeaderColumns = HeaderColumns + 1
Wend
'copy the headers
Dim HeaderIndex As Long
Destination.Offset(0, 0).Value = Source.Offset(0, HeaderColumns - 1).Value
For HeaderIndex = 1 To HeaderColumns - 1
Destination.Offset(0, HeaderIndex).Value = Source.Offset(0, HeaderIndex -
1).Value Next
'copy the data
Dim SourceRowIndex As Long
Dim DestinationRowIndex As Long
Dim DataColumnIndex As Long
Dim IdentifierColumnIndex As Long
SourceRowIndex = 1
DestinationRowIndex = 1
While Source.Offset(SourceRowIndex, HeaderColumns - 1).Value <>
vbNullString
IdentifierColumnIndex = 1
While Source.Offset(SourceRowIndex, HeaderColumns - 1 +
IdentifierColumnIndex - 1).Value <> vbNullString 
      Destination.Offset(DestinationRowIndex, 0).Value =
Source.Offset(SourceRowIndex, HeaderColumns - 1 +
IdentifierColumnIndex - 1).Value 
      For DataColumnIndex = 1 To HeaderColumns - 1 
          Destination.Offset(DestinationRowIndex,
DataColumnIndex).Value = Source.Offset(SourceRowIndex,
DataColumnIndex - 1).Value 
      Next 
      IdentifierColumnIndex = IdentifierColumnIndex + 1 
      DestinationRowIndex = DestinationRowIndex + 1 

Wend
SourceRowIndex = SourceRowIndex + 1 Wend
'show the result
Destination.Worksheet.Activate:Destination.Select
End Sub
Topic 543
Subject
Excel macro: Inserting row based on user input
Question
In an excel file of which column A is filled with different dates, sorted in
ascending order, the macro should generate a user prompt which asks for a
date. The macro should then insert a row between the two dates that are
smaller and larger than the date given by the user.
So far, I only achieved to prompt the user for a specific row below which the
macro then inserts a new row. Can anyone help me out with the next steps?
Sub addRow()
Dim row
row = InputBox("Maturity date of new bond", "Input maturity date") If Not row
= vbNullString Then
ActiveSheet.Range("A" & row + 1).EntireRow.Insert End If
End Sub
Answer
Kudos to Taelsin for his answer, but I did notice a few issues with his macro
(for example, there is no accounting for the possibility of an invalid date
format entered by the user).
Plus, I figured you might want to actually learn what exactly is going on with
the code. So, I created the following subroutine with plenty of comments and
explanations. I hope it finds you well.

Good luck!
Sub addRow()
'
=========================================================
' This is sort of the easy part, taken somewhat from the code you provided.
We're going to create some ' variables to use later, and give our user an input
field for the maturity date. ' NOTE: You said the date was in column A, but in
case that isn't always true, I also use a ' range-selector input box to allow the
user to specify the range / column containing maturity dates. '
=========================================================
Dim d As Date ' Create our maturity date Dim dateColumn As Range ' Create a
variable to store our date column Dim isAscOrder As Boolean ' Create a
variable to store a value that will indicate in what direction the dates are
sorted Dim i As Long, j As Long, k As Long, c As Range, r As Range ' Create
a few misc variables (I always do this just in case I need them later on)
On Error GoTo cancel ' We want to assume any errors on the next line are
caused by the user pressing the "Cancel" button. Set dateColumn =
Application.InputBox("Column containing maturity dates", "Specify maturity
date column", Type:=8) ' Show the range-selector input box and store it in our
date-column variable
retryDate: ' this is called a "Line Label". We can send user here to retry the
next action On Error GoTo invalidDate ' If the next line causes an error, we
will send user to our "invalidDate" label (see below) d = InputBox("Maturity
date of new bond", "Input maturity date") ' Show the input-box and store the
date value specified by the user On Error GoTo 0 ' Set the error-handling back
to its default
'
=========================================================
' Here comes the slightly more advanced part. The general idea here is that we
want to find the spot in which ' this date should fit, but we don't even know in
what direction the dates are currently sorted. ' ------------------------------------
--------------------------------------------------------------------- ' (1) So, first
we'll determine the sort direction by comparing the first cell to the last cell. 

'       Also note that I am specifying "Column(1)" in case the
user entered a range with multiple 
'       columns by mistake. 
' (2) Next, I'll loop through each cell in the range using the
"For each" statement. Within each 
'       of these iterations, I will check if the cell's date
is greater/less than (this will 
'       depend on the sort direction) the maturity date
specified by the user. 
' (3) Finally, when I find a cell that is greater/less than
our maturity date, I will insert a 
'       new row before that row. 
' ---------------------------------------------------------------------------------------
------------------ ' Sound good? Okay, here we go . . .
'
=========================================================
isAscOrder = (CDate(dateColumn.Cells(1, 1).Value) <
CDate(dateColumn.Columns(1).End(xlDown).Value)) ' compare the first and
last cells of the first column to determine the sort direction For Each c In
dateColumn.Columns(1).Cells ' begin the "For Each" loop; this will loop
through each cell in the first column of our range
If c.Row() > dateColumn.Parent.UsedRange.Rows.Count() Then Exit Sub '
Proceed only if we have not reached end of the "Used Range" (i.e., the end of
our worksheet) If isAscOrder Then ' If this is in ascending order, then ... 
      If CDate(c.Value) > d Then ' ... we will check for the
first cell greater than our maturity date. 
          c.EntireRow.Insert shift:=xlShiftDown ' When/if we
find it, then insert the new row above the current one, and
then ... 
          Exit Sub ' ... exit the sub (because we are done). 
      End If 
  Else ' If this is not in ascending order, then we will
assume descending order (duh), and then ... 
      If CDate(c.Value) < d Then ' ... we will check for the
first cell less than our maturity date. 
          c.EntireRow.Insert shift:=xlShiftDown ' When/if we
find it, then insert the new row above the current one, and
then ... 

          Exit Sub ' ... exit the sub (because we are done). 
      End If 
End If
Next c ' No greater/less than date was found; proceed to the next iteration of
our "For Each" loop (i.e., the next cell).
'
=========================================================
' Our code execution shouldn't come down this far (since we handle all
possible scenarios above, and each one ' results in exiting the sub. However,
we do need to specify some code to handle our errors. '
=========================================================
Exit Sub ' We shouldn't ever get to this point, but exit the sub just in case.
invalidDate:
If MsgBox("Please enter a valid date (i.e.,""mm/dd/yyyy"")", vbRetryCancel,
"Invalid Date") = vbCancel Then ' Display the "invalid date" error, and ask the
user if he or she would like to retry. If "Cancel" is clicked, then ...
Exit Sub ' ... exit the sub.
Else ' If the user clicked "Retry", then ...
GoTo retryDate ' ... send them back to the date input box (i.e., the "retryDate"
label). End If
cancel
Exit Sub
End Sub
Answer
As I said in the comments I would just iterate through your date column until
you find a date that is larger (I said smaller in the comments, but if it's
ascending order the larger date will be towards the bottom).
Sub addRow()

Dim givenDate As Date
givenDate = InputBox("Maturity date of new bond", "Input maturity date") If
givenDate <> vbNullString Then 
      Dim iter As Range 
      Set iter = ActiveSheet.Range("A1") 
      Do 
          Set iter = iter.Offset(1) 
      Loop While iter.Value <= givenDate 
      iter.EntireRow.Insert xlDown 
      Set iter = iter.Offset(-1) 
      iter.Value = givenDate 
End If
End Sub
You'll probably need to do more error checking, but this should do the trick.
Topic 544
Subject
Pragmatically Get Count of Pivot Table Data
Question
Suppose I have some sample data like so:
and I create a Pivot Table and order by Product > Sales Rep > Sales
If I want the # of sales John had for Product1 I would do
=GETPIVOTDATA("Sales",$A$3,"Product","Product1","Sales Rep","John")
But how would I get a count of the entries there are. i.e. for Product1, John had
4 and Kevin had 2
Is it possible to get this count using GETPIVOTDATA()? Answer
To get this you need to add another Sales field to the values section and change
the "Summarize By" to Count. Then the formula will
=GETPIVOTDATA("Count of Sales",$A$3,"Product","Product1") will get you
the count of Product Overall.

Topic 545
Subject
Excel counting certain cell range in row if other cell matches column
Question
So I inherited an Excel file that is used to schedule and track PTO and OT time
for about 100 employees. They have a column for every day of the year and
have the year split over two sheets.
I am trying to create a totaling sheet that shows a grouping for each employee
and counts up each of the types of time codes that are used in the tracking
sheets. Each time type has a code that is used for condidtional formating NM1,
NM2,...
I am trying to create a formula that will check the employee's name against the
name column on the tracking sheet and then count just part of the row for cells
that contain NM1, etc
Here is one of the cells as it is now:
=COUNTIF('2015MarNov'!$E$88:$AH$88,""&"NM1"&"")
the employee name is in column D and this is counting NM1 for just January
(columns E through AH). Answer
Use this:
=COUNTIF(INDEX('2015MarNov'$E:$E,MATCH("NAME",'2015MarNov'$D
Change the "NAME" to the cell on the summary sheet the has the Employee
name. You could also change the "NM1" to a cell reference.
Answer
Try this:
=COUNTIF(OFFSET($E$1:$AH$1,MATCH(<target employee
cell>,$D:$D,0)-1,0),"NM1")

In this example I assumed that row 1 contains the header and that row 2 starts
with the employees. If that is not the case try something like this:
=COUNTIF(OFFSET($E$5:$AH$5,MATCH(<target employee
cell>,$D$6:$D$106,0),0),"NM1")
Edit, explanation:
Match(<target employee cell>,<range of employees>,0)
This function returns the relative row in which the target employee is found,
i.e. if the employee is in D7 and the range is D6:D106 then the returned value
is 1, since this the relative offset from the starting range (starting at 0)
OFFSET(<range>,<rows>,<columns>)
This function shifts any given range by the number of rows and columns as
specified. In the previous function the range is offset by 1 row (shifted 1 row
down).
COUNTIF(<range>,<criteria>)
The <range> is determined by the shifted range from the OFFSET function.
Topic 546
Subject
dynamic array with n rows and columns
Question
I have to read an excel which can have 'n' rows and 'n' columns and store the
data in an array for processing.
For example the below:
Author Book No Value 
ABC       A       1     100 
DEF       D       2     20 

I want to take the headers in a separate array and the Information rows in
another.
Here is what I have so far:
Assuming the data starts from Row 13 in the excel worksheet-
var i, j, k ,l,m ,n;
i=13; j=1, k=0; m=0; n=0; // i represents the row and j represents excel
column(A) while(EApp.ActiveSheet.Cells(12,j).Value!="") {
j=j+1; // Counting the Number of Columns (Header) }
j=j-1; //decrementing the counter j by 1 k=j;
while(j!=0)
{
ArrField[j]=EApp.ActiveSheet.Cells(12,j).Value; j=j-1;
}
This is what I tried, output is as expected, but is there a better way to code
this? preferably with lesser variables.
while(EApp.ActiveSheet.Cells(i,1).Value!="undefined") {
m=k;
j=0;
ArrData[i]=new Array(m);
while(m!=0)
{ 
      ArrData[n][j]=EApp.ActiveSheet.Cells(i,m).Value; 
      m=m-1; 
      j=j+1; 
}
n=n+1;
i=+1;
}

Also I need to read the arrays and store them into corresponding fields of
another system. I'm a bit lost over here.
Sample Code: (Something like this)
SetFieldValue(ArrField[0],ArrData[0][0]);
Array Output:
Value,No,Book,Author (Header got in reverse order)
100,1,A,ABC,20,2,D,DEF (2 rows of Data also got in reverse order)
Any suggestions experts?
Answer
you can use csv's as dynamic arrays in a quite nice way. Here is my example
code. I suggest to rewrite it to your needs and add some errorhandling.
Here is the table data:
ID AUTHOR BOOK NO VALUE 
1   ABC     A       1   100 
2   DEFG    D       2   20 
3   XYZ     Q       3   55 
Here is the code:
Sub test1()
Dim arrayname As String
Dim mytestW As Variant
Dim mytestR As Variant '-->your array you can work with 'give your array a
arrayname = authorbook (for example) arrayname = "authorbook"
mytestW = dataintoarray(arrayname)
mytestR = AsArray(arrayname, 2) '-->get the second row End Sub

And here are the functions:
Function dataintoarray(myarray As String) As Variant
Dim res As Variant
Dim wb As Workbook, ws As Worksheet
Dim LastRow As Long, LastCol As Long
Dim iRow As Integer, jCol As Integer
Dim OutputFileNum As Integer
Dim PathName As String
Dim Line As String
Line = ""
Set wb = ThisWorkbook
Set ws = wb.Worksheets("Sheet1")
PathName = Application.ActiveWorkbook.Path OutputFileNum = FreeFile
Open PathName & "\" & myarray & ".csv" For Output Lock Write As
#OutputFileNum
LastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row LastCol =
ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
For iRow = 1 To LastRow 
    For jCol = 1 To LastCol 
       Line = Line & ws.Cells(iRow, jCol).Value & "," 
    Next jCol 
    Print #OutputFileNum, Line 
    Line = "" 
Next iRow
Close OutputFileNum
End Function

Function AsArray(myarray As String, index As Integer) As Variant
Dim res As Variant
Dim wb As Workbook, ws As Worksheet Dim objFSO As Object, objFile As
Object Dim sLine As String
Set wb = ThisWorkbook
Set ws = wb.Worksheets("Sheet1")
Set objFSO = CreateObject("Scripting.FileSystemObject") Set objFile =
objFSO.OpenTextFile(Application.ActiveWorkbook.Path & "\" & myarray &
".csv", 1) Do Until objFile.AtEndOfStream 
        sLine = objFile.ReadLine 
        'the col of the ID = 0 
        If Split(sLine, ",")(0) = index Then 
            AsArray = Split(sLine, ",") 
        End If 
Loop
objFile.Close
End Function
Now you have your dynamic array saved in mytestR. You can play with it like
so:
?mytestR(0)
2
?mytestR(1)
DEFG
?mytestR(2)
D
?mytestR(3)
2
?mytestR(4)
20
Topic 547

Subject
Error 9 using ReDim Preserve
Question
This function returns a error 9, why? I already read couple of similar questions
here but nothing really explained me well.
I'm really trying to understand why ReDim Preserve doesnt work in this case
because from "j+1" onwards no input is made(i already checked my cells), so
isnt overwriting nothing.
Heres the code
Function DadosAnoIndenizações()
ReDim dados(1 To 10000, 1 To 2)
j = 0
For i = 5 To 10000
If (IsNumeric(Worksheets(2).Cells(i, 8).Value) And Not
IsEmpty(Worksheets(2).Cells(i, 8).Value)) Then 
      Ano = CInt(Right(Worksheets(2).Cells(i, 8).Value, 4)) 
      SD = Worksheets(2).Cells(i, 11).Value 
      j = j + 1 
      dados(j, 1) = Ano 
      dados(j, 2) = SD 
End If
Next i
ReDim Preserve dados(1 To j, 1 To 2)
DadosAnoIndenizações = dados
End Function
Thanks for any help guys
Answer
You are trying to change the first dimension of the array. Redim preserve can
only change the last dimension of the array, which is why you're getting the
error. You can find this information listed MSDN's website: ReDim Statement

(Visual Basic), specifically the "Resizing with Preserve" section:
Resizing with Preserve. If you use Preserve, you can resize only the last
dimension of the array. For every other dimension, you must specify the bound
of the existing array.
For example, if your array has only one dimension, you can resize that
dimension and still preserve all the contents of the array, because you are
changing the last and only dimension. However, if your array has two or more
dimensions, you can change the size of only the last dimension if you use
Preserve.
Typically the way around that is to have the first dimension be your 1 to 2 and
the second dimension be your 1 to j and then do a Application.Transpose when
writing the results to the worksheet.
Topic 548
Subject
How to make Excel references non-absolute using REGASM32 (early binding)
Question
I have a requirement to create a new installed for an Excel add-in. I've created
many of these and this question is not necessarily about the install building
process. It is about how to properly reference a .dll in Excel so that it can be
referenced on the receiving machine properly.
The Excel add-in references (tools/references) the file ZOPLib.dll (a .net dll
of our own design). It references it in C:\folder A. We used REGASM32 to
register the .dll and everything works fine on the development machine.
Moving the add-in over to a VM I place the ZOPLib.dll in C:\folder B and
register it there.
Because the add-in was pointed at C:\folder A, even though I REGASM32 the
dll, the addin fails to find it (the dll). I have to REGASM32 /uninstall the dll,
REGASM32 register it in C:\folder B and then go into the add-in and tell it that
the dll is in C:\folder B.
Why is the link to the dll absolute?

How can I make Excel reference this dll or register it in such a way that the
add-in can find it in the new folder? If I can get the .net developer of this dll to
produce it as an activex dll, would that relieve my trouble?
InstallShield does not handle registering dlls that are not activex/ocx because it
uses REGSVR32.
Thanks for any help!
Topic 549
Subject
Set Text style in Webdriver using Java (Color, bold or italic)
Question
I have this code that writes Pass or Fail in the excel sheet result column. I
wanted to make it little fancy and add aether green/red color to text or make it
bold or both.
DOMConfigurator.configure("log4j.xml"); sTestCaseName = this.toString();
sTestCaseName = Utils.getTestCaseName(this.toString());
Log.startTestCase(sTestCaseName);
ExcelUtils.setExcelFile(Constant.Path_TestData +
Constant.File_TestData,"Sheet1"); iTestCaseRow =
ExcelUtils.getRowContains(sTestCaseName,Constant.Col_TestCaseName);
driver = Utils.OpenBrowser(iTestCaseRow);
<some method here...>
//here to write Pass or Fail
ExcelUtils.setCellData("Pass", iTestCaseRow, Constant.Col_Result);
}catch (Exception e){
ExcelUtils.setCellData("Fail", iTestCaseRow, Constant.Col_Result);
Log.error(e.getMessage());
throw (e);
Can you suggest how can I handle this?

Answer
If you want to do this in Excel, then the easiest and most automatic way is to
use Conditional Formatting. In Excel 2010 or higher, under the Home tab,
you'll find the Conditional Formatting button.
I would suggest adding two conditions, one for PASS and one for FAIL.
Choose New Rule, and then use the second option from the top that read
"Format only cells that contain". This option will let you specify if the cell
equals a value, contains a value, does not equal a value, etc.
Once you've decided on the rule, click the "Format" button to bring up the cell
format dialog box. Format each one whichever shades of green and red you
want, then apply it to the range that is going to get the result. Then click Apply
or OK to finish it out.
Topic 550
Subject
Power Query Excel File Missing Data Issue
Question
I'm new to Power Query and running into a strange issue that I haven't been
able to resolve.
I'm creating a query to to extract data from roughly 300 Excel files. Each file
has one sheet, 115 Columns and around 100 rows. However, the query is only
returning the data from the first two columns and rows and I'm not sure why the
query won't return all of the data on the sheet.
Ex
Header 1 Header 2 Data Data
I converted one file to a .csv file and the query will return all data from the
file. I've scoured Google and I haven't been able to find anything that seems to
relate to this issue. Is there an excel file limitation that I'm not aware of?
I'm assisting someone that is not technical savvy so I would like to try to avoid
VB code and Access if possible. Also, I can't really provide a file I'm working

with because the data contains PHI.
Thank you in advance!
Topic 551
Subject
VBA Search for VLOOKUP in cells in range and Calculate
Question
If one wanted to loop through cells and lookinto a formula for a vlookup and
calculate one might do as follows:
Dim r As Range
For i = 1 To 100
With wsSWM.Columns(i).SpecialCells(xlCellTypeFormulas) 
      For Each r In .Cells 
          If Left(r.Formula, 8) = "=VLOOKUP" Then r.Value =
r.Value 
      Next r 
End With
Next i
However if one has vlookups nestled in between other calculations then one
would want the ability to do find replace on VLOOKUP within a desired range
but the replace portion would be the calculated lookup hardcoded.
ie
H4 + A10*VLOOKUP("This",A:1:B3,2,0)A1/B2+C3 = H4 +
A10"lookupvalue"*A1/B2+C3
How would one go about completing this
Answer
This will cover multiple vlookups in the formula, and will cover embedded

formulas within the vlookup. It will also simply use #N/A if there are any
errors evaluating the vlookup:
Sub tgr()
Dim ws As Worksheet
Dim rFound As Range
Dim sFirst As String
Dim sSecond As String
Dim sTemp As String
Dim sVLOOKUP As String
Dim sValue As String
Dim lOpenParenCount As Long
Dim lCloseParenCount As Long
Dim i As Long
Set ws = ActiveWorkbook.ActiveSheet
With ws.UsedRange 
      Set rFound = .Find("VLOOKUP", .Cells(.Cells.Count),
xlFormulas, xlPart) 
      If Not rFound Is Nothing Then 
          sFirst = rFound.Address 
          Do 
              If Left(rFound.Formula, 1) = "=" Then 
                  Do While InStr(1, rFound.Formula,
"VLOOKUP", vbTextCompare) > 0 
                      sVLOOKUP = vbNullString 
                      sValue = vbNullString 
                      For i = InStr(1, rFound.Formula,
"VLOOKUP", vbTextCompare) To Len(rFound.Formula) 
                          sTemp = Mid(rFound.Formula, i, 1) 
                          sVLOOKUP = sVLOOKUP & sTemp 
                          Select Case sTemp 
                              Case "(": lOpenParenCount =
lOpenParenCount + 1 
                              Case ")": lCloseParenCount =
lCloseParenCount + 1 
                                        If lCloseParenCount =
lOpenParenCount Then Exit For 
                          End Select 
                      Next i 

                      On Error Resume Next 
                      sValue = Evaluate(sVLOOKUP) 
                      On Error GoTo 0 
                      If Len(sValue) = 0 Then sValue = "#N/A"
                      rFound.Formula =
Replace(rFound.Formula, sVLOOKUP, sValue) 
                  Loop 
              Else 
                  If Len(sSecond) = 0 Then sSecond =
rFound.Address 
              End If 
              Set rFound = .FindNext(rFound) 
              If rFound Is Nothing Then Exit Do 
          Loop While rFound.Address <> sFirst And
rFound.Address <> sSecond 
      End If 
End With
End Sub
Answer
In order to do this, you will need to (1) Take the formula string; (2) Break out
the portion related to Vlookup vs the portion[s] which relate to everything else,
storing each as its own string variable; (3) Run the Vlookup portion 'manually'
in VBA to find the value; and (4) Replace the formula in the cell with the
vlookup value followed by everything else.
Because your check formula assumes that VLOOKUP will be at the beginning
of the cell, this makes the process somewhat simpler, as we don't need to check
for the 'other portion' being before the VLOOKUP.
My proposed code to perform these steps would be as follows [I have tested
and confirmed that this works]:
Dim r As Range
Dim lookupString as String 'stores the portion of the formula which represents
the Vlookup Dim lookupValue as Double 'Stores the value of the lookup Dim
otherString as String 'stores the rest of the string Dim formulaBrackets as
Integer 'used to count how many brackets are contained within the Vlookup, to

find where it ends
For i = 1 To 100
With wsSWM.Columns(i).SpecialCells(xlCellTypeFormulas) 
      For Each r In .Cells 
          If Left(r.Formula, 8) = "=VLOOKUP" Then 
              formulaBrackets = 0 
              For j = 1 to Len(r.Formula) 
                  If Mid(r.Formula,j,1) = "(" Then 
                      formulaBrackets = formulaBrackets + 1 
                  ElseIf Mid(r.Formula,j,1) = ")" Then 
                      formulaBrackets = formulaBrackets - 1 
                      If formulaBrackets = 0 Then 
                          lookupString = Mid(r.Formula,2,j-1)
'picks up the string starting from the V in Vlookup [excludes
the '='], up to the final bracket 
                          otherString =
Mid(r.Formula,j+1,Len(r.Formula)) 'picks up the string
starting AFTER the ending bracket, to the end of thes formula 
                          r.Formula = "="&lookupString 'sets
up the formula in the cell to calculate the vlookup as written
                          lookupValue = r.value 
                          r.Formula = "=" & lookupValue &
otherString 'recreates the formula, having replaced the
vlookup with its calculated value 
                          Exit For 
                      End If 
                   Else 
                       'No action required 
                   End If 
               Next j 
           End If 
      Next r 
End With
Next i
Answer
I'm late to the party on this one, but here is my solution. It's not so different
from the two already posted, but it did approach the problem from the idea of

using a function specifically designed to extract the evaluated value of a
LOOKUP in a function, and returns the altered formula in the function. That
way, if you are looping through a range of cells, you can choose to call the
function based on specific criteria, for example if the cell has a formula, or is
hidden, or something like that.
Here's the function:
Function ExtractVLOOKUPValue(rng As Range) As Variant ' This will extract
the returned value of the first instance ' of a VLOOKUP formula in a cell.
' Constant declarations.
Const sVLOOKUP As String = "VLOOKUP" Const lVLOOKUP_LEN As
String = 7
Const sOPEN_PAREN As String = "("
Const sCLOSE_PAREN As String = ")"
' Variable declarations. 
Dim lVlookupPos     As Long 
Dim lCnt            As Long 
Dim lParenCnt       As Long 
Dim sVlookupFormula As String 
Dim sResult         As String 
' Check first if the cell is a formula, and then ' if a VLOOKUP formula exists in
the cell. If rng.HasFormula Then
lVlookupPos = InStr(rng.Formula, sVLOOKUP) If lVlookupPos <> 0 Then 
      ' Isolate the VLOOKUP formula itself. 
      For lCnt = lVlookupPos To Len(rng.Formula) 
          ' Count the open parentheses we encounter so that
we can use 
          ' the apporpriate number of closing parentheses. 
          If Mid(rng.Formula, lCnt, 1) = sOPEN_PAREN Then
lParenCnt = lParenCnt + 1 
          ' If we get to closing parenthese, start taking
counts away from the 

          ' parencnt variable so we can keep track of the
correct number of 
          ' parenthesis in hte formula. 
          If Mid(rng.Formula, lCnt, 1) = sCLOSE_PAREN Then 
              lParenCnt = lParenCnt - 1 
              ' If we get done to zero in the parencnt, then
extract the formula. 
              If lParenCnt = 0 Then 
                  sVlookupFormula = Mid(rng.Formula,
lVlookupPos, lCnt + 1 - lVlookupPos) 
                  Exit For 
              End If 
          End If 
      Next lCnt 
End If
End If
' Now that we have the formula, we can evalutate the result. On Error Resume
Next
sResult = Evaluate(sVlookupFormula)
' If we errored out, return the #N/A in the function. If Err.Number <> 0 Then
sResult = "#N/A"
End If
' Replace the VLOOKUP in the formula with the result, then return it to the
function. sResult = Replace(rng.Formula, sVlookupFormula, sResult)
' Return the result, having replaced the VLOOKUP function.
ExtractVLOOKUPValue = sResult
End Function
And here's how you might call it:

Sub ReplaceFormulaWithValue()
Dim rng As Range
Dim rCell As Range
Set rng = Selection
For Each rCell In rng
rCell.Formula = ExtractVLOOKUPValue(rCell) Next rCell
End Sub
Topic 552
Subject
Excel VBA find a cell on worksheet with specific value (string)
Question
I need help finding a text value on a worksheet and offset from there two rows
down.
I have a cell with "Bottom of Range" title in it. Two cells below that is the
actual value. The issue is "Bottom of Range" could be in 7 possible places
depending on the worksheet template.
How can I find the cell with "Bottom of Range" in it? I can then
.Offset(2,0).value2 to get what I want.
In the grander scheme of things. I am cycling through hundreds of workbooks
and then through each of their worksheets collecting data and centralizing it.
Because the values I am looking for could be anywhere I need to look for their
title/definition before getting to the values. Answer
Here you go! You want to use .Find:
Sub t()
Dim bottomCell As Range
Dim offsetCell As Range
With Sheets("Sheet1")

Set bottomCell = .Cells.Find(what:="Bottom of Range") Set offsetCell =
bottomCell.Offset(2, 0) ' Now, your offsetCell has been created as a range, so
go forth young padawan! End With
End Sub
Topic 553
Subject
Looping Through Txt Files using VBA - DIR() issue
Question
I have the following code where I am trying to modify some Txt files in a
specific folder. I first want to check that the Loop works. However when I run
the macro the code can only read the first file and then there is a runtime 5
error at strFileName = Dir(). I am not sure what the problem is. The only issue
I can think of is that I am moving the code between two module sheets. The
folder location is being saved in a txt box in Sheet 1 of an excel workbook.
Sub Txt_File_Loop()
Public TextFile As String
Dim FolderLocation As String
Dim strFielName As String
Dim SaveLocation As String
'Location is present in a Text box
FolderLocation = Sheets(1).FolderLocationTXTBX.Text strFileName =
Dir(FolderLocation & " \ * ") Do Until strFileName = ""
TextFile = FolderLocation & "\" & strFileName Module2.Macro1
strFileName = Dir() 'ERROR is Here
Loop
End Sub
Sub Macro1()
Dim x As String
Open TextFile For Input As #1
Do Until EOF(1)
Line Input #1, textline
x = x & textline
Loop

Close #1
MsgBox x
End Sub
Answer
Have a look at these modifications. They seem to correct several things and
run through well.
Option Explicit
Sub Txt_File_Loop()
Dim FolderLocation As String
Dim strFileName As String
Dim SaveLocation As String
'Location is present in a Text box
FolderLocation = Sheets(1).FolderLocationTXTBX.Text 'Environ("TMP")
strFileName = Dir(FolderLocation & "\*.txt") Do Until strFileName = "" 
      Debug.Print FolderLocation & "\" & strFileName 
      Module2.Macro1 FolderLocation & "\" & strFileName 
      strFileName = Dir() 'ERROR is Here 
Loop
End Sub
Sub Macro1(sFPFN As String)
Dim x As String, textline As String Debug.Print sFPFN
Open sFPFN For Input As #1
Do Until EOF(1) 
      Line Input #1, textline 
      x = x & textline 
Loop

Close #1
MsgBox x
End Sub
I passed the folder and filename name across as a string-type parameter. Also,
I don't know why you had the extra spaces in (FolderLocation & " \ * " ; I
tightened that up. There were a few misspellings and undeclared variables;
these can be avoided with Option Explicit¹ at the top of the module code sheet.
Get into the practise of standard indentation with your code. It certainly
improves readability if nothing else.
¹ Setting Require Variable Declaration within the VBE's Tools ► Options ►
Editor property page will put the Option Explicit statement at the top of each
newly created code sheet. This will avoid silly coding mistakes like
misspellings as well as influencing you to use the correct variable type in the
variable declaration. Variables created on-the-fly without declaration are all
of the variant/object type. Using Option Explicit is widely considered 'best
practice'.
Topic 554
Subject
Using a Script to hide rows in excel spreadsheet
Question
I have the following script in an Excel cell. I'm assuming this is a vba script.
{ if (value == "") {hideRow("34");Text_Boiler_Location(2)}
I've done some research and I'm not sure how to hide the active row without
hardcoding the row id. I'm using a form building application that I can build
custom reports. However if I change the form then it will throw of the row id
in the script. I will many of these little scripts and I do not want to change the
row id every time I change the form. So basically I just need to hide the active
row if the value is an empty string without hardcoding it. Answer
Can try below

ActiveCell.EntireRow.Hidden=True
Answer
This is neither vb or vba. It is a script created by the form application I use.
They do not have the ability at this time to identify the active row. It has to be
hard coded. Thanks for everyone's response.
Topic 555
Subject
How to make cell range dynamic in DDE in SAS
Question
I am trying to format a weekly report using DDE in sas which opens a excel
file kept on my desktop location. I want to format the font some of these cells. I
have a total column which needs to be formatted every time the new data
comes in. But every time this data would come out the range of the "Total" cell
would be different. Please refer to the code i am writing
options noxsync noxwait;
filename sas2xl dde 'excel|system';
data null;
length fid rc start stop time 8;
fid=fopen('sas2xl','s');
if (fid le 0) then do;
rc=system('start excel');
start=datetime();
stop=start+10;
do while (fid le 0);
fid=fopen('sas2xl','s');
time=datetime();
if (time ge stop) then fid=1;
end;
end;
rc=fclose(fid);
run;

data null;
file sas2xl;
put '[open(myfilepath\file.xlsx")]';
run;
**I had created a macro using call symput and i am using it here for
dynamically changing the row number** %macro xyz;
data null;
file sas2xl;
%do i= 1 %to 3;
put '[error(false)]';
put '[workbook.activate("Sheet1")]';
put '[select("r&&rownum&i..c1")]';
put '[format.font("Arial",true,false,false,false,1,false,false)]'; put
'[column.width(0,"c1:c6",false,3)]'; %end;
run;
ERROR
The code is not working and give me a error like this DDE session not ready.
FATAL:
Unrecoverable I/O error detected in the execution of the DATA step program.
Aborted during the EXECUTION phase.
Can you please tell me how can i go ahead in this
Topic 556
Subject
XML Schema Mapping in Excel - Creating and XML file from a .xsl, with
repeating elements
Question
I have a table to data within a .xls document (a basic example can be seen in
my first image).
Having the .xls open in Excel, I've then imported an .xml document, which I've
created, via the developer tab.
I can successfully map the required elements from the imported .xml to the

corresponding header.
An example of the export can be seen below, along with an example of the
required export, which has been created manually. Unfortunately only the
column headers are included in the actual export, and the rows do not repeat.
Topic 557
Subject
Looping through workbook and deleting VeryHidden worksheets
Question
One of the modules in a larger project is creating redundant veryHidden sheets.
I am attempting to loop through every worksheet in the workbook and delete
sheets that are marked as veryHidden. I've used almost identical code in other
projects and it has worked so I am unsure why it is not working in this
situation. Here is what I've tried:
Dim sheet As Worksheet
For Each sheet In ActiveWorkbook.Worksheets
If sheet.Visible = xlSheetVeryHidden Then
sheet.Delete
End If
Next sheet
I've also tried that same code using:
For Each sheet In ActiveWorkbook
And I've also tried:
Dim i As Integer
Dim sheetCount As Integer
For i = 1 To sheetCount
If Worksheets(i).Visible = xlVeryHidden Then
Worksheets(i).Delete

End If
Next i
And also:
For i = sheetCount To 3 Step -1
If Worksheets(i).Visible = xlVeryHidden Then
Worksheets(i).Delete
End If
Next i
In all attempts Application.DisplayAlerts is changed to False before running
and changed to True after running. Results in run-time error 1004. Answer
If you unhide the sheet before deleting it, it should work.
Dim sheet As Worksheet
For Each sheet In ActiveWorkbook.Worksheets
If sheet.Visible = xlSheetVeryHidden Then 
      sheet.visible = xlSheetVisible 
      sheet.Delete 
End If
Next sheet
Topic 558
Subject
Adding File version Excel VBA
Question
I want to Add and change file version in Cell P76 every time there is a change
in file. i tried this function but it is showing Excel version and it is not
changing
Function ExcelVersion()

ExcelVersion = Application.Version
End Function
and in cell P76 (Sheet2)
=ExcelVersion()
I want it to show like VERSION 001 and every time (sheet2) update of change
it change to next eg VERSION 001 to VERSION 002 and so on and in cell
P77(Sheet2) Dates and time of update.
I also try to add this
Private Sub submit_Click()
Dim i As Integer
i = 1
Cells(P76).value = "VERSION 00" & i + 1 End Sub
but not working
Answer
Place this in "ThisWorkbook". It will add the version number without the
"Version" string. I would recommend adding "Version" in an adjacent cell in
order to keep it simple.
Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As
Boolean)
Sheets("Sheet2").Range("P76").Value = Sheets("Sheet2").Range("P76").Value
+ 1 Sheets("Sheet2").Range("P77").Value = Now
End Sub
If you need "version" to be in the same cell as the number itself, comment and I
will edit my response to reflect that functionality.
Also, this will not prevent users from editing the version number, time etc. just
so you are aware.

Topic 559
Subject
Delete sheet based on a cell value
Question
I want to delete a sheet based on a cell value.
For example, I want cell "T3" to have the value of the sheet I am looking to
delete. There are 50+ sheets and all have number values of 4 digits (1234).
Sub Rectangle2_Click()
'deactivate alerts - stop 'are you sure you want to delete pop up'
Application.DisplayAlerts = False
'set worksheet you want to delete
sheettodelete = Range("T3").Value
'deletes sheet
Worksheets(sheettodelete).Delete
're-enable alerts
Application.DisplayAlerts = True
End Sub
The code above is one that I found that is supposed run the macro, however, it
errors out at "Worksheets(sheettodelete).delete" with an error Run-tim Error
'9': Subscript out of range. I checked and confirmed that the sheet does exist on
the workbook. Answer
It executes fine here, however, on a second attempt it will obviously fail since
the object won't exist anymore. Also if there is a typo in T3 you will receive
this error.
Here's a slight improvement that won't generate the error:
Sub test()
Dim sheetToDelete as String
Dim ws as Worksheet

Application.DisplayAlerts = False
sheetToDelete = Worksheets("SheetThatHoldsTheCell").Range("T3").value
On Error Resume Next 'To avoid the subscript out of range error Set ws =
Worksheets(sheetToDelete)
On Error Goto 0
If not ws is nothing then ws.delete 'Test if the sheet exists.
Set ws = Nothing
Application.DisplayAlerts = True
End Sub
Answer
Another solution that works is to cycle through your sheets and delete
worksheet with matching name.
Sub RemoveSheet()
Dim ws As Worksheet
Application.DisplayAlerts = False
For Each ws In Worksheets 'Checks each worksheet
If ws.Name = Range("T3").Value Then Worksheets(ws.Name).Delete Next
Application.DisplayAlerts = True
End Sub
Topic 560
Subject
Add weekday only dates to a pivot table where zero instances in the source
data and assign zero count to show up in graph
Question

I have the data:
And the Pivot Table:
Producing the graph:
I need to insert the missing weekdays with a count of zero without Macros.
Restated: If the date does not appear in the data and is a weekday it should be
inserted with count zero. Thank You in advance
Topic 561
Subject
RANGE for non-adjected cells only excepts “;” instead of “,” as delimiter
now, No changes in sw/hw/code
Question
EDIT5: The problem is solved. Not posted as answer, because I have no idea
how. All I did: ->mess up excel by 2h loop, ->don't wana wait, kill excel via
Taskmanager, ->restart PC (again) ...ofc I changed my whole project to ';'
before -.-
Because I have still no Idea what happend I am still glad if anyone finds out
what happend. I hate coding stuff I do not understand.
[For main problem see edit3 pls]
Hy Comunity,
I am coding a project. In an older, allready tested and working function some
commands stopped working. RANGE("A1,B3"). ... does not work any more,
RANGE("A1;B3"). ... does started working out of the blue.
First version is what I call "English Notation", the second version I call
"German Notation" for they are also use in formulas of those languages (e.g.
=SUM(1,2,3) vs =SUMME(1;2;3)).
I can confirm that the code WAS WORKING before, with the desired result.
Now it stoped working (runtimeerror '1004' - The method 'range' for the object
'_global' failed [freely translated from german]). Trial/Error brought me to the

point were I realised that the second notation (using ";" instead of ",") that
previously threw the same error now seems to work.
Any Idea? A simple matter of check a box in the options? I have no clue, and
2h+ of "helplines" (mostly MS itself) without result or even a clue kind of
making me depressive. -.-
Thanks in advance!
greetings, jack
EDIT1
The original code line:
Range( _
Cells((longFirstRow + 2), (longFirstColumn + 0)).Address & "," & _
Cells((longFirstRow + 3), (longFirstColumn + 2)).Resize(4, 1).Address & ","
& _ Cells((longFirstRow + 3), (longFirstColumn + 14)).Resize(4, 1).Address
& "," & _ Cells((longFirstRow + 3), (longFirstColumn + 25)).Resize(3,
1).Address & "," & _ Cells((longFirstRow + 9), (longFirstColumn +
2)).Resize(16.1).Address & "," & _ Cells((longFirstRow + 8),
(longFirstColumn + 14)).Address & "," & _ Cells((longFirstRow + 8),
(longFirstColumn + 20)).Address & "," & _ Cells((longFirstRow + 8),
(longFirstColumn + 26)).Address) _ .NumberFormat = "@"
The resulted string would be something like:
"$A$3,$C$4:$C$7,$O$4:$O$7,$Z$4:$Z$6,$C$10:$C$25,$O$9,$U$9,$AA$9"
I accept if you say it is unusual...may be. But it worked perfect.
EDIT2: Thanks for the quick replies. Even if there was no solution jet.
EDIT3: The VBA-Environment changed behavior. That is my main problem I
want to understand how/why and change back. The RANGE command is only a
symptom I can easily fix by replacing all ',' by ';' or by the great approach of
SCOTT using union()
EDIT4: It seems I did not make one point clear before, sry for that: My OS is
set to German, and always was. So is my Excel.

=SUMME(1;2;3) - worked/works if manually inserted in cell at worksheet |
did/does NOT work if used in vba (e.g..Formula = " ... ") =SUM(1,2,3) -
does/did NOT work if manually inserted in cell at worksheet | did/does work
if used in vba (e.g..Formula = " ... ") RANGE("A1,B3") - did work in vba, not
any more RANGE("A1;B3") -
does work in vba, DID NOT before
Answer
You want to use the Union() function:
Union( _
Cells((longFirstRow + 2), (longFirstColumn + 0)), _ Cells((longFirstRow +
3), (longFirstColumn + 2)).Resize(4, 1), _ Cells((longFirstRow + 3),
(longFirstColumn + 14)).Resize(4, 1), _ Cells((longFirstRow + 3),
(longFirstColumn + 25)).Resize(3, 1), _ Cells((longFirstRow + 9),
(longFirstColumn + 2)).Resize(16.1), _ Cells((longFirstRow + 8),
(longFirstColumn + 14)), _ Cells((longFirstRow + 8), (longFirstColumn +
20)), _ Cells((longFirstRow + 8), (longFirstColumn + 26)))
This allows you to join a list of range objects.
This
Sub hhh()
Dim t As Range
Dim longFirstRow
Dim longFirstColumn
longFirstRow = 1
longFirstColumn = 1
Set t = Union( _
Cells((longFirstRow + 2), (longFirstColumn + 0)), _ Cells((longFirstRow +
3), (longFirstColumn + 2)).Resize(4, 1), _ Cells((longFirstRow + 3),
(longFirstColumn + 14)).Resize(4, 1), _ Cells((longFirstRow + 3),
(longFirstColumn + 25)).Resize(3, 1), _ Cells((longFirstRow + 9),
(longFirstColumn + 2)).Resize(16.1), _ Cells((longFirstRow + 8),
(longFirstColumn + 14)), _ Cells((longFirstRow + 8), (longFirstColumn +
20)), _ Cells((longFirstRow + 8), (longFirstColumn + 26)))

Debug.Print t.Address
End Sub
Returned
$A$3,$C$4:$C$7,$O$4:$O$7,$Z$4:$Z$6,$C$10:$C$25,$O$9,$U$9,$AA$9
in the immediate window.
Answer
When referencing a range, it should be done with a colon:
Range("A1:B3")
or if you are selecting individual cells as a range:
Range("A1","B3")
Edit (due to OP edit(s)): It seems as if your main issue is the difference
between German and English formula formats. When using a German Excel
file, the correct notation uses ";" rather than ",". So if you say your document
was working previously with the delimiters being "," it is most likely a change
in what language the file was opened in. If it was in English originally, the ","
delimiter would work, but if it only now works with ";" then it would now
appear that Excel's language settings were changed when reopening the file.
Edit 2: If language settings seem to be consistent, and you're on a Windows OS
go to
Control Panel > Change the date, time or number format > Additional Settings
> List Separator , check and see if the list separator is set to "," or ";
Topic 562
Subject
Tweaking VBA Autocomment Script
Question
I'm really new to VBA (decided to try and start learning it in depth yesterday),

and so I've set myself a little project.
I found this code (from here), and am trying to logic my way through it, but I'm
stuck - I want to point it at just the currently selected range, not loop it through
all the worksheets and all the Used Cells in those worksheets. I keep getting
type errors when I try define 'iCell' as the current Selection.
Sub CommentTheHeckOuttaIt() 
  Dim WS                          As Worksheet 
  Dim iCell                       As Range 
  For Each WS In ActiveWorkbook.Worksheets 
      For Each iCell In WS.UsedRange 
          With iCell 
              If CStr(.Value) <> "" Then 
                  .ClearComments 
                  .AddComment 
                  .Comment.Visible = False 
                  .Comment.Text Text:=CStr(.Value) 
                  .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
                  .Comment.Shape.ScaleHeight 2.26, msoFalse,
msoScaleFromTopLeft 
              End If 
              If .Formula <> "" Then 
                  .ClearComments 
                  .AddComment 
                  .Comment.Visible = False 
                  .Comment.Text Text:=CStr(.Formula) 
                  .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
                  .Comment.Shape.ScaleHeight 2.26, msoFalse,
msoScaleFromTopLeft 
              End If 
          End With 
      Next 
Next
End Sub
Sub AllCommentsMustDIE() 
  Dim WS                          As Worksheet 
  Dim iCell                       As Range 

  For Each WS In ActiveWorkbook.Worksheets 
      For Each iCell In WS.UsedRange 
          iCell.ClearComments 
      Next 
Next
End Sub
I'm happy to read if you know of a reference that'd be relevant here, not
necessarily looking for someone to solve it for me. I just don't know how to
phrase the search. Answer
You would need to remove the outer for loop to not do it for all worksheets.
Then you need to loop through the selected range; such as below. I will let you
fix the second sub.
Sub CommentTheHeckOuttaIt()
Dim iCell As Range
For Each iCell In Selection 
      With iCell 
          If CStr(.Value) <> "" Then 
              .ClearComments 
              .AddComment 
              .Comment.Visible = False 
              .Comment.Text Text:=CStr(.Value) 
              .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
              .Comment.Shape.ScaleHeight 2.26, msoFalse,
msoScaleFromTopLeft 
          End If 
          If .Formula <> "" Then 
              .ClearComments 
              .AddComment 
              .Comment.Visible = False 
              .Comment.Text Text:=CStr(.Formula) 
              .Comment.Shape.ScaleWidth 5.87, msoFalse,
msoScaleFromTopLeft 
              .Comment.Shape.ScaleHeight 2.26, msoFalse,
msoScaleFromTopLeft 
          End If 
      End With 

Next
End Sub
Topic 563
Subject
Multiple OFFSET functions in a single line in Excel VBA don't work - Why?
Question
Simply put, I'm trying to get what seems like a fairly simple macro to work in
Excel. It needs to run equally well on Macs and PCs, but I need to loop through
all the rows in Column A and then create a file folder for each row in the
format:
I know there's more I can do (checking to see if the folder already exists, etc),
but for the moment I just want to get the mkdir line functioning. Can anyone
help with this? Thank you.
Text of Column A Text of Column B - Text of Column C
Sub CreateDirs()
Dim R As Range
Dim RootFolder As String
RootFolder = ThisWorkbook.path
For Each R In Range("A7:A64000") 
      If Len(R.Text) > 0 Then 
          On Error Resume Next 
          MkDir RootFolder & Application.PathSeparator &
R.Text & " " & R.Offset(0, 1).Text & " - " & R.Offset(0,
2).Text 
          On Error GoTo 0 
      End If 
Next R
End Sub
Answer

Your code executes fine under Windows when tested here. However, since you
also need to execute on a Mac, you might want to step away from MkDir. You
also want to check whether the folder exists or not.
The complete answer to your problem is readily available on Ron de Bruin his
website here: http://www.rondebruin.nl/mac/mac010.htm
His code as published on the above link:
Sub MakeFolderTest1()
'Make folder on the Desktop
MakeFolderIfNotExist (MacScript("return (path to desktop folder) as string")
& "TestFolder1") End Sub
Sub MakeFolderTest2()
'Add folder in the same path as your workbook with this code
MakeFolderIfNotExist (ThisWorkbook.Path & Application.PathSeparator &
"TestFolder2") End Sub
'Change the path of the two macro below before you test them
Sub MakeFolderTest3()
'Enter the complete path
MakeFolderIfNotExist
("YosemiteLacie256:Users:rondebruin:Desktop:TestFolder3") End Sub
Sub MakeFolderTest4()
'Do not include the harddisk name if you use a posix path
MakeFolderIfNotExist ("/Users/rondebruin/Desktop/TestFolder4") End Sub
Function MakeFolderIfNotExist(Folderstring As String) 'Ron de Bruin, 22-
June-2015
' http://www.rondebruin.nl/mac/mac010.htm
Dim ScriptToMakeFolder As String

Dim str As String
If Val(Application.Version) < 15 Then 
      ScriptToMakeFolder = "tell application " & Chr(34) & _ 
                           "Finder" & Chr(34) & Chr(13) 
      ScriptToMakeFolder = ScriptToMakeFolder & _ 
              "do shell script ""mkdir -p "" & quoted form of
posix path of (" & _ 
                      Chr(34) & Folderstring & Chr(34) & ")"
& Chr(13) 
      ScriptToMakeFolder = ScriptToMakeFolder & "end tell" 
      On Error Resume Next 
      MacScript (ScriptToMakeFolder) 
      On Error GoTo 0 
Else 
      str = MacScript("return POSIX path of (" & _ 
                      Chr(34) & Folderstring & Chr(34) & ")")
      MkDir str 
End If
End Function
His website is a great resource for Excel VBA development in general.
Topic 564
Subject
How to change fixed numbers into ranges in VBA
Question
I have a VBA code in which figures from 0 to 13 are selected (fixed), and from
here a map will be provided with the corresponding color. But... I want to
change this into a range per color. For example, I don't want having a "1"
coupled to dark blue, a "2" coupled to light blue etc., but I want a range. Like:
figures between 0 - 50 --> dark blue, 50 - 100 --> light blue etc.
In the VBA code below you can see that figures higher than 13 (intStateValue)
are provided with another protocol. But there's no range in the code (For
intState = 1 To rngStates.Rows.Count). How can I create ranges as described

above (0 - 50, 50 - 100, 100 - 150 etc.)?
Hope anyone can help me on this one! Thanks in advance!!
Option Explicit
Sub Kleurgemeenten()
'
' Using the values from named range POSTCODEGEBIEDEN ' And the
colours from named range KLEUREN ' re colour the map on sheet MainMap
'
Dim intState As Integer
Dim strStateName As String
Dim intStateValue As Integer
Dim intColourLookup As Integer
Dim rngStates As Range
Dim rngColours As Range
Set rngStates = Range(ThisWorkbook.Names("GEMEENTE").RefersTo) Set
rngColours = Range(ThisWorkbook.Names("KLEUREN").RefersTo)
With Worksheets("MainMap")
For intState = 1 To rngStates.Rows.Count 
      strStateName = rngStates.Cells(intState, 1).Text 
      intStateValue = rngStates.Cells(intState, 2).Value 
      If intStateValue > 13 Then 
          ' stripped 
          With .Shapes(strStateName) 
              intColourLookup =
Application.WorksheetFunction.Match(CInt(Left(CStr(intStateValu
1)), Range("KLEUREN"), True) 
              .Fill.Patterned msoPatternWideUpwardDiagonal 
              .Fill.ForeColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 
              intColourLookup =
Application.WorksheetFunction.Match(CInt(Right(CStr(intStateVal
1)), Range("KLEUREN"), True) 
              .Fill.BackColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 

          End With 
      Else 
          ' single colour 
          intColourLookup =
Application.WorksheetFunction.Match(intStateValue,
Range("KLEUREN"), True) 
          With .Shapes(strStateName) 
              .Fill.Solid 
              .Fill.ForeColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 
          End With 
      End If 
Next
End With
End Sub
Answer
I am not sure if I understand your problem correctly, but I think this might help
you.
You have add the code that creates the table I talk about in the comments
Option Explicit
Sub Kleurgemeenten()
'
' Using the values from named range POSTCODEGEBIEDEN ' And the
colours from named range KLEUREN ' re colour the map on sheet MainMap
'
Dim intState As Integer
Dim strStateName As String
Dim intStateValue As Integer
Dim intColourLookup As Integer
Dim rngStates As Range
Dim rngColours As Range
Set rngStates = Range(ThisWorkbook.Names("GEMEENTE").RefersTo) Set

rngColours = Range(ThisWorkbook.Names("KLEUREN").RefersTo)
Dim colorTable(1 To 2, 1 To 13) As Long ' creaing the table
With Worksheets("MainMap")
For intState = 1 To rngStates.Rows.Count 
      strStateName = rngStates.Cells(intState, 1).Text 
      intStateValue = rngStates.Cells(intState, 2).Value 
      Dim colorNumber As Long, i As Long 
      colorNumber = 14 
      For i = 1 To 13 
          If intStateValue >= colorTable(1, i) And
intStateValue < colorTable(2, i) Then colorNumber = i 
      Next i 
      If colorNumber > 13 Then 
          ' stripped 
          With .Shapes(strStateName) 
              intColourLookup =
Application.WorksheetFunction.Match(CInt(Left(CStr(colorNumber)
1)), Range("KLEUREN"), True) 
              .Fill.Patterned msoPatternWideUpwardDiagonal 
              .Fill.ForeColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 
              intColourLookup =
Application.WorksheetFunction.Match(CInt(Right(CStr(colorNumber
1)), Range("KLEUREN"), True) 
              .Fill.BackColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 
          End With 
      Else 
          ' single colour 
          intColourLookup =
Application.WorksheetFunction.Match(colorNumber,
Range("KLEUREN"), True) 
          With .Shapes(strStateName) 
              .Fill.Solid 
              .Fill.ForeColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 

          End With 
      End If 
Next
End With
End Sub
Answer
In fact, it was even less complex... Here is the final answer! :-) -->
Option Explicit
Sub Kleurgemeenten()
'
' Using the values from named range POSTCODEGEBIEDEN ' And the
colours from named range KLEUREN ' re colour the map on sheet MainMap
'
Dim intState As Integer
Dim strStateName As String
Dim intStateValue As Long
Dim intColourLookup As Integer
Dim rngStates As Range
Dim rngColours As Range
Dim WS_Control As Worksheet
Dim i As Long
Set WS_Control = Worksheets("Control")
Set rngStates = Range(ThisWorkbook.Names("GEMEENTE").RefersTo) Set
rngColours = Range(ThisWorkbook.Names("KLEUREN").RefersTo)
With Worksheets("MainMap") 
      For intState = 1 To rngStates.Rows.Count 
          strStateName = rngStates.Cells(intState, 1).Text 
          intStateValue = rngStates.Cells(intState, 2).Value 
          If intStateValue >= WS_Control.Range("E14").Value

Then 
              'if value is higher than last number of the
defined range 
              With .Shapes(strStateName) 
                  .Fill.Solid 
                  .Fill.ForeColor.RGB = WS_Control.Cells(14,
6).Interior.Color 
              End With 
          Else 
              'if value is inside the defined range 
              'Loop through value ranges 
              For i = 3 To 14 
                  'if relavent range found 
                  If intStateValue < WS_Control.Range("E" &
i).Value Then 
                      intColourLookup = i - 2  'Had to reduce
2 because name range "rngColours" is defined from "E2" 
                      Exit For 
                  End If 
              Next i 
              With .Shapes(strStateName) 
                  .Fill.Solid 
                  .Fill.ForeColor.RGB =
rngColours.Cells(intColourLookup, 1).Offset(0,
1).Interior.Color 
              End With 
          End If 
      Next 
End With
End Sub
Topic 565
Subject
How can I call R functions from an Excel vba script on both Mac and
Windows?
Question
I'm writing a macro-enabled Excel workbook to automate some data
processing for the people in my lab. I'd like to be able to call R functions from
my vba scripts, but some of the users will be working on Macs. In my search,

I've seen plenty of ways to call R functions from Excel on a Windows machine,
but not much for Macs.
So far, I think my best shot is to get them all to install F# R Type Provider and
F# Excel Provider. Then, I'll have the Excel vba script execute an F# script to
get the data I want from Excel, call my R function on it, and then return the
result to excel. (Although, this might end up being way over my head)
Is there another, more straightforward way to get a single vba script to call R
functions on Macs and PCs?
Topic 566
Subject
Create Password protected Excel file using java code
Question
I have Created an Excel file using java code now i need to make it as
password protected When i open Excel file it should prompt for password :
code :
`String fileName = "My excel file" + "_"+ dateFormatter.format(new Date())
+".xls";
enter code hereString filePathName = "D:/ExcelLocation/"+fileName;
FileOutputStream out = new FileOutputStream(filePathName);
workBook.write(out);
out.close();`
I have successfully created an excel file into the given folder, now my
requirement is to make that file password protected ,can any one suggest how
to achieve this.
Topic 567
Subject
Excel PivotTables with Dynamic field names
Question
I need to complete a large number of pivottable formula using

criteria/fieldnames that are above/to left of cells. The base, static formula is as
follows:
=GETPIVOTDATA("BDGT",'Pipeline PVT'!$A$6,"FiscalQuarter","FY16-
Q3","AreaName","Western Europe")
I want to grab the value field (BDGT in this example) from the formula
heading, which will be BDGT. But when I replace "BDGT" with a cell
reference (ie: A4), I get #REF.
Any ideas why this is not working?
Answer
=GETPIVOTDATA(A4 & "",'Pipeline PVT'!$A$6,"FiscalQuarter","FY16-
Q3","AreaName","Western Europe")
The & "" after A4 is the important bit...
Topic 568
Subject
Synchronize Sharepoint List with multiple Excel files
Question
I have a list on Sharepoint,and I would like to update that list from any excel
sheet/file I create "Having same formatting of course". Can I achieve that? I
know that you can create a List on sharepoint from an excel sheet "Table
Format" but I couldn't find any solution to sync sharepoint list from any excel
sheet. Shall I do some scripting to achieve that ? I'm using Excel 2010 and
Sharepoint 2010 Answer
Do you need to actually do any further interactions with the SharePoint list? If
not, a solution could be to just display the excel sheeet as a Range within a
page. https://msdn.microsoft.com/en-us/library/office/ee556820.aspx
Answer
Don't think you get my point. Suggesting that you do not use a list at all. Just
display the excel sheet directly. If you do need to update a list from excel, you

must use scripting of some kind. Question is if you can call the script from
within excel, or it must happen when uploading the excel sheet. Perhaps if you
tell the complete scenario, it is easier to help.
Answer
Since I need further interaction with the list, I have decided to go with Access,
which provides an out of the box solution. Simply create a blank database and
link it with the desired list on SharePoint and that would be it.
Topic 569
Subject
Adding file date created to list
Question
I've been trying to edit a bit of code which gives a list of all files in all
subfolders to also give me the date created in the next column but am unsure
how. Here is the code i'm working with: It gets the file paths fine but not the
file DateCreateds
Sub startIt()
Dim FileSystem As Object
Dim HostFolder As String
HostFolder = "C:\folderthing"
Set FileSystem = CreateObject("Scripting.FileSystemObject") DoFolder
FileSystem.GetFolder(HostFolder)
End Sub
Sub DoFolder(Folder)
Dim SubFolder
For Each SubFolder In Folder.SubFolders DoFolder SubFolder
Next
i = Cells(Rows.Count, 1).End(xlUp).Row + 1 Dim File

For Each File In Folder.Files 
    ActiveSheet.Hyperlinks.Add Anchor:=Cells(i, 1), Address:=
_ 
        File.Path, TextToDisplay:=File.Path 
    ActiveSheet.Add TextToDisplay:=File.DateCreated 
    i = i + 1 
Next
End Sub
Answer
If you want the Date in column B, then:
Sub startIt()
Dim FileSystem As Object
Dim HostFolder As String
HostFolder = "C:\TestFolder"
Set FileSystem = CreateObject("Scripting.FileSystemObject") DoFolder
FileSystem.GetFolder(HostFolder)
End Sub
Sub DoFolder(Folder)
Dim SubFolder
For Each SubFolder In Folder.SubFolders DoFolder SubFolder
Next
i = Cells(Rows.Count, 1).End(xlUp).Row + 1 Dim File
For Each File In Folder.Files 
    ActiveSheet.Hyperlinks.Add Anchor:=Cells(i, 1), Address:=
_ 
        File.Path, TextToDisplay:=File.Path 

    Cells(i, 2).Value = File.DateCreated 
    i = i + 1 
Next
End Sub
Topic 570
Subject
How to transfer text from one excel file to another using vb.net
Question
I have done this process many times in macros in excel but this is the first time
trying to do it using vb.net and can't figure it out. I have an xlsx with rows and
columns of data in it. I would like to transfer the data over to a template that I
made that has graphs waiting for the data. The data needs to go to the sheet2,
this file is a xlsm (read only). Nothing that I have tried from vba will work in
vb.net. different syntax. Help.
The code I have so far:
Imports System
Imports System.IO
Imports System.Text
Imports Excel = Microsoft.Office.Interop.Excel Imports Office =
Microsoft.Office.Core
Public Class Form1
Private Sub cbo_FileList_Click(sender As Object, e As EventArgs) Handles
cbo_FileList.Click
Dim folderpath = "C:\Users\aholiday\Desktop\Data Dump"
cbo_FileList.Items.Clear()
For Each file As String In System.IO.Directory.GetFiles(folderpath)
cbo_FileList.Items.Add(System.IO.Path.GetFileNameWithoutExtension(file))
Next
End Sub

Private Sub btn_Do_Click(sender As Object, e As EventArgs) Handles
btn_Do.Click
Dim txtpath As String
Dim csvpath As String = "C:\Temp"
Dim FileTXT As String
Dim folderpath As String
Dim FinalFile As String
folderpath = "C:\Users\aholiday\Desktop\Data Dump" FileTXT =
cbo_FileList.Text
csvpath = "C:\Temp\" & FileTXT & ".csv" txtpath = folderpath & "\" &
FileTXT & ".txt" FinalFile = "C:\Users\aholiday\Desktop\Book1"
File.Copy(txtpath, csvpath)
Process.Start("EXCEL.EXE", csvpath) Process.Start("EXCEL.EXE",
FinalFile)
'Need to have copy past and close here
'File.Delete(csvpath)
End Sub
End Class
Answer
Take a look at EPPlus (you can get this via nuget package manager) ... It´s a
complete xlsx handling lib very useful for handling that.
There are also closed source libs, and also Excel Interop would be possible -
but would need installed Office.
I used it already to make some customers happy
Answer
Try this code to copy data from one workbook to another:
Public Sub CopyData()

Dim ExcelApp As New Microsoft.Office.Interop.Excel.Application
Dim WB1, WB2 As Workbook
Try 
      'optional 
      ExcelApp.Visible = False 
      'open both workbooks 
      WB1 =
ExcelApp.Application.Workbooks.Open("C:\...\File1.xlsx") 
      WB2 =
ExcelApp.Application.Workbooks.Open("C:\...\File2.xlsx") 
      'rows 
      For r As Integer = 1 To 5 
          'columns 
          For c As Integer = 1 To 5 
              'copy the value of the cell 
              WB2.Sheets(2).Cells(r, c).Value =
WB1.Sheets(1).Cells(r, c).Value 
              'or text: 
              'WB2.Sheets(2).Cells(r, c).Text =
WB1.Sheets(1).Cells(r, c).Text 
          Next 
      Next 
      'save the second workbook 
      WB2.Save() 
      'close the workbooks 
      WB1.Close() 
      WB2.Close() 
      'and quit the Excel application 
      ExcelApp.Quit() 
Catch ex As Exception

MessageBox.Show(ex.Message)
ExcelApp.Quit()
End Try
End Sub
Topic 571
Subject
Office 2016 JavaScript API - Remove Table Filter Buttons
Question
In the Office 2013 version of Office Javascript API, I would create a table as
follows:
Office.context.document.setSelectedDataAsync(
tbl, { 
                      coercianType:
Office.CoercionType.Table, 
                      cellFormat: tableCellFormats, 
                      tableOptions: { filterButton: false } 
        }); 
Now with the new way of converting a range to a table, I am missing one thing.
That is, how can I create it with the filter buttons off. I don't see a
Table.options property where I can set filterbutton = false. (see below
snippet):
Excel.run(function (ctx) {
ctx.workbook.tables.add('Sheet1!A1:E7', true); return ctx.sync();
}).catch(function (error) {
console.log(error);
});

Can someone please post a javascript snippet on how to do this? Answer
Turns out I was able to accomplish this using a binding. The code is as
follows. I added a .then() to the Excel.Run so that after the table is created, I
can then get add a binding and set the table options:
.then(function (ctx) {
Office.context.document.bindings. 
     addFromNamedItemAsync('tblRawEmpInfo',
Office.BindingType.Table, 
         { id: "tblRawEmpInfoBinding" }, function
(asyncResult) { 
                      if (asyncResult.status !=
Office.AsyncResultStatus.Failed) { 
                        
Office.select("bindings#tblRawEmpInfoBinding").setTableOptions
filterButton: false }); 
                          return ctx.sync(); 
                      } 
                      else 
                          return ctx.sync(); 
                  }); 
Hopefully this helps someone and I have to say, this javascript api seems like a
work in progress. I think a Table.options property should be added, I'll add this
comment to the github site.
Topic 572
Subject
Excel download not working after populating the values in java
Question
In my application using spring and angularjs and java, On clicking a button
,there is an ajax call which fetches the data from db and the data needs to be
written to an excel file and the same file needs to be downloaded in the
browser itself. I am attaching the code snippet for the same .
Now the problem is, even though the data is being fetched and I am able to

bind it as worksheet using poi , the excel file never comes in the browser as
download.
kindly help me in finding a right solution. Thank You.
fileName.append(Calendar.get(Calendar.SECOND)); 
        
fileName.append(oCalendar.get(Calendar.MILLISECOND)); 
          Sheet sheet = workbook.createSheet("Transaction" +
fileName.toString()); 
CellStyle style = workbook.createCellStyle(); 
          style.setFont(font); 
          Row header = sheet.createRow(0); 
          header.createCell(0).setCellValue("Name"); 
          header.createCell(1).setCellValue("ACC"); 
          header.createCell(2).setCellValue("Date"); 
        
header.createCell(0).setCellValue("TRANSACTION_RECONCILIATION_
        
header.createCell(1).setCellValue("ORIGINAL_RECONCILIATION_IDE
        
header.createCell(2).setCellValue("STR_TRANSACTION_Date"); 
response.setHeader("Content-Disposition", "attachment;
filename=\"TransactionDetails.xls\""); OutputStream outputStream =
response.getOutputStream();
workbook.write(outputStream); Answer
After writing the output stream you should use
response.flushBuffer();
Answer
Looks like you're missing the contentType definition. Before calling the write()
method try setting the contentType like this:
response.setContentType("application/octet-stream");

This should tell the browser that a download is expected from the server. A
relevant question was asked here:
response.setContentType("APPLICATION/OCTET-STREAM")
In my code I write like this:
response.setContentType("application/octet-stream");
response.setHeader("Cache-Control", "no-cache");
response.setHeader("Content-Disposition",
"attachment; filename=TransactionDetails.xls");
workbook.write(response.getOutputStream());
Hope this helps
Topic 573
Subject
Excel SUMIFS which adds values if column a, or column b contains a
specified value
Question
I've had a look around and can't find a solution, and I don't even know if this is
possible.
I have two worksheets. I would like Sheet1!G5 to display the sum of values in
Sheet2!D:D where Sheet2!A:A OR Sheet2!B:B is equal to Sheet1!D5.
I know its a bit complex, and like I say I don't even know if it is possible, or if
SUMIFS is the correct formula to be using.
see images below for dummy data in the spreadsheets.. basically I want
someone to be able to search how many Desktop or how many HP Elitedesk
800 G1 there are (there are more different models of desktops, laptops and
monitors etc, but I just don't have them in the dummy data...that's why I want to
be able to search both fields. Answer
If my logic is correct you should be able to get away with two separate
SUMIF's, one for column A and one for column B, added together:-

=SUMIF(Sheet2!A:A,D5,Sheet2!D:D)+SUMIF(Sheet2!B:B,D5,Sheet2!D:D)
It doesn't look as if it's possible to have the same thing in column A and B for
any row, but if so you could make a correction to avoid double-counting as
follows:-
=SUMIF(Sheet2!A:A,D5,Sheet2!D:D)+SUMIF(Sheet2!B:B,D5,Sheet2!D:D)-
SUMIFS(Sheet2!D:D,Sheet2!A:A,D5,Sheet2!B:B,D5)
The first formula can easily be modified to work with more than two criteria
columns (e.g. if you wanted to match on serial number as well), but the second
one can't.
To get the total quantity based on more than two columns, where a string can
occur more than once in the same row, you would need an array formula like
=SUM(SIGN((Sheet2!A2:A10=D5)+(Sheet2!B2:B10=D5)+
(Sheet2!C2:C10=D5))*Sheet2!D2:D10)
which must be entered with CtrlShiftEnter
Topic 574
Subject
VBA autocomplete drop down list not picked up by data validation
Question
Here is a challenge : I have created a dropdown list with an autocompletion
feature using a ComboBox (I have used the instructions from this article
http://www.extendoffice.com/documents/excel/2401-excel-drop-down-list-
autocomplete.html). This feature is invoqued with double clicking on the cell
that contains the list and it works fine.
I have also added a data validation warning feature to the cell so that when the
user enters a name that is not recognized he is warned and can either proceed
(if he needs to type a new name) or cancel and re start typing. This also works
fine : when entering a wrong name, the warning appears as it should.
Here is the problem : when double clicking on the cell, the autocomplete

dropdown appears, then I can type an incorrect name, press enter and ... this is
not picked up by the data validation warning feature.
I am clueless and hope one of you guys can crack this one !
Samy
Topic 575
Subject
Referencing a worksheet in Visual Basic
Question
I'm working on a project for work, and am trying to color bars inside a bar
graph. Multiple worksheets with different charts are made, but they all follow
the same color scheme. I'm very new to VB (just picked it up 2 days ago) and I
have what will probably be a basic question, but I can't find the answer
anywhere. I have a separate function to color each chart, but I want to
condense my code to make them reference one function. Here's an example of
what I have:
Private Sub color_chart()
Dim chartIterator As Integer, pointIterator As Integer, _
seriesArray() As Variant
For chartIterator = 1 To ActiveSheet.ChartObjects.Count
seriesArray = ActiveWorkbook.Sheets("Chart").ChartObjects(chartIterator). _
Chart.SeriesCollection(1).Values
For pointIterator = 1 To UBound(seriesArray) 
      ' ***** If percent is greater than or equal to 90,
color is green. ***** 
     If seriesArray(pointIterator) >= 0.9 Then 
        
ActiveWorkbook.Sheets("Chart").ChartObjects(chartIterator). _ 
        

Chart.SeriesCollection(1).Points(pointIterator).Interior.Color
= _ 
         RGB(0, 153, 0) 
     ' ***** If percent is greater than or equal to 50, color
is yellow. ***** 
     ElseIf seriesArray(pointIterator) >= 0.5 Then 
        
ActiveWorkbook.Sheets("Chart").ChartObjects(chartIterator). _ 
        
Chart.SeriesCollection(1).Points(pointIterator).Interior.Color
= _ 
         RGB(239, 226, 42) 
     ' ***** If percent is less than 50, color is red ***** 
     Else 
        
ActiveWorkbook.Sheets("Chart").ChartObjects(chartIterator). _ 
        
Chart.SeriesCollection(1).Points(pointIterator).Interior.Color
= _ 
         RGB(229, 41, 41) 
     End If 
Next pointIterator
Next chartIterator
End Sub
That's the code I want to use to reference to from all charts. But I get an error
on the other ones, because the worksheet name isn't "chart" for all of them.
How can I change this code so that multiple worksheets can call this function?
Is there a way to make changes to a worksheet without explicitly using its
name? Answer
The "Sheets" property is just a collection of worksheet items, and so it can be
referenced by specific name or by its ordinal, like
ActiveWorkbook.Sheets(0).Chartobjects
https://msdn.microsoft.com/en-us/library/office/ff822101.aspx

Edit to expand on your case, since you say you just took VB recently:
Use a For Each to iterate the worksheets collection, for example like this:
For Each wsheet As WorkSheet in ActiveWorkbook.Sheets
wsheet.ChartObjects(chartIterator). _ 
        
Chart.SeriesCollection(1).Points(pointIterator).Interior.Color
= _ 
         RGB(239, 226, 42) 
Next
Topic 576
Subject
Automation Error Creating Shortcut
Question
I have created the following, and it is causing me trouble at the moment!
I can't see any reason why this wouldn't work, it works for a generic URL - just
not if I try and make a URL open in a specific browser
Function Quote(inputText As String) As String Quote = Chr(34) & inputText &
Chr(34) End Function
Sub CreateShortCut()
Dim oWSH As Object
Dim oShortcut As Object
Dim sPathDeskTop As String
Dim tPath As String
tPath = Quote("C:\Program Files (x86)\Microsoft Application Virtualization
Client\sfttray.exe") & " /exe ff.exe " & Quote("Mozilla Firefox
38.3.0.0.1.V04") & " https://dwp.reach-interactive.com/account/login/"
Set oWSH = CreateObject("WScript.Shell") sPathDeskTop =
oWSH.SpecialFolders("Desktop")

Set oShortcut = oWSH.CreateShortCut(sPathDeskTop & "\" & _ "Example
Shortcut" & ".url")
With oShortcut
.TargetPath = tPath
.Save
End With
Set oWSH = Nothing
MsgBox "Shortcut Created!"
ActiveWorkbook.Close
End Sub
Topic 577
Subject
Excel Cell Range Name Clears After Saving File
Question
I have a problem regarding excel cell range. So I have an excel file containing
cell ranges but when I save it and reopened the same file some cell ranges
were missing. I have tried "save as" but still same results. I have also done
researching but still no luck. Hope someone helps me. Thank you in advanced.
I'm losing time figuring it out. Any help would be really appreciated!
Is there a VBA code or macro equivalent for my problem? Answer
As a starting point, what I suggest you try is to get into the VBA and set a 'stop'
in the open and close event handlers.
Option Explicit
Private Sub Workbook_BeforeClose(Cancel As Boolean)
Stop
End Sub
Private Sub Workbook_Open()
Stop

End Sub
These should be placed in the ThisWorkbook class in the VBIDE.
If these handlers already exist then just put the Stop at the first line in the
handler code.
Then just as you open and just as you close you will be able to see if the data
exists at those times.
That may give you a chance to see if there's any VBA clearing out your data
ranges.
Topic 578
Subject
VB2010 - Delete Cells Not Containing Strings
Question
I have made a "search" engine on VB2010 (Windows Forms) that checks a
network drive for a specific excel workbook - depending on the input, it opens
it and searches all worksheets and then copies certain cells to a new empty
workbook.
My problem is that once the cells have been copied, there are some empty
rows between the results. This happens because I have used the following
conditions to delete a row. For example:
If wb.Sheets(I).range("C19").value <> "" Or wb.Sheets(I).range("C19").value
<> " " Or IsNothing(wb.Sheets(I).range("C19").value) = False Then 
     wb.Sheets(I).Range("C19").Copy() 
     oBook.Sheets("Sheet1").Range("A2").Pastespecial() 
Else 
     oBook.Sheets("Sheet1").range("A2").EntireRow.Delete() 
End If
In my new workbook, the empty rows look empty but when you click on them
they contain a formula shown on the top window, below the EXCEL toolbar.

The HasFormula command has been tried and does not work so i was
wondering if you have a solution to my problem. Answer
Just look to the property FormulaLocal of you cell !
Using someting like this in condition
If wb.Sheets(I).range("C19").value <> "" Or wb.Sheets(I).range("C19").value
<> " " Or IsNothing(wb.Sheets(I).range("C19").value or
wb.Sheets(I).range("C19").formulaLocal <> "" ) = False Then
If should countain the forumula that you are looking for
Topic 579
Subject
Pivot tables: Choosing table range or data source connection. Differences in
both
Question
Excel 2010.
Pivot tables:
Can someone clarify the diffrences (and pros and cons) in selecting a data
range or selecting an external data source when creating a pivot table?
I have a SQL query that I want to show in excel. I need the data details and
multiple pivots. I'm not sure if I should create one table and connect my pivots
to that table or create multiple pivot connections.
There will be a weekly refresh of the data in SQL.
If I create a table range and my data is updated in SQL and refreshed with more
rows then I selected for my range will my pivot table capture those new rows?
Topic 580
Subject
How to find and average based on the neighbor's value
Question

I was preparing an excel workbook to keep the progress of my studying, there
are three different kinds of data (skill scores) and I would like to have an
average of each kind. For example, for the skill A, there are many scores in
that sheet and I need to find them and calculate the average, the way they can
be found is based on their neighbor's value eg: (cell a): skill 1, (cell b): 17
Any idea how could it be done?
Thanks in advance.
Answer
Use AverageIf():
=AVERAGEIF(A:A,"skill 1",B:B)
If you want multiple criteria than look into the AVERAGEIFS()
Topic 581
Subject
how to create customer name search box in excel
Question
please help me some one .I have a spread sheet with lots of customer names
located in sheet name called index it is very painful to find each customer by
scrolling down so i want to create a google search box in new sheet.
Topic 582
Subject
Automate editing of column headers
Question
I need to automate the editing of the column headings of a spreadsheet (the top
row -- A1, B1 etc). The goal is to retain the first token (having the form
KI_xxxxxx) and to remove the bracketed terms (strings bracketed by
parentheses (()) or square brackets ([])).
Here are some before-and-after examples: on the left of the arrow (->) is an
example before it has been edited, and on the right of the arrow is the

corresponding desired result:
KI_Categories (Commodities Provided) [UniqueName] -> KI_Categories
KI_2256522 (Unique TAX ID (US)) -> KI_2256522 KI_2408691 (Company
VAT Number (EUROPE)) -> KI_2408691 Answer
Try the below code
Sub RemoveJunk() 
   Dim rng As Range 
   Set rng = Range("A1").EntireRow 'Assuming headings are in
Row1 
   For Each cell In rng.Cells 
      If (cell.Value = "") Then Exit For 
      cell.Value = (Split(cell, "(")(0)) 
   Next 
End Sub
Topic 583
Subject
How to add comment inside complex excel formula
Question
Is it possible to add a comment within the cell of an excel formula? I have an
exceedingly long expression inside a cell that could better understood if I can
comment within it.
Excel 2010 is my version. Here is an example cell I'd like to notate:
=MID(
A4,
((FIND("n ",A4,FIND(G4,A4))+75)+LEN(H4)+78), (FIND("n ",A4,(FIND("n
",A4,FIND(G4,A4))+75))) - ((FIND("n ",A4,FIND(G4,A4))+78)) )
Answer
The N() function allows you add comments directly inside your cells on your

formulas. To use the function to add a comment, simply add a plus sign (+) to
the end of your formula, and then enter some text in quotes inside the
parentheses, passing that text to the N() function.
Example: =YourFormula+N("comment")
Or you can use "add comment" in the Comments section of the Review tab.
http://www.howtogeek.com/162231/add-comments-to-formulas-and-cells-in-
excel-2013/
Answer
Like this:
=SUM(A1:A4)+N("This is a comment")
http://www.howtogeek.com/162231/add-comments-to-formulas-and-cells-in-
excel-2013/
Topic 584
Subject
Formatting numbers in Proc Tabulate for ODS Excel
Question
I have a simple PROC TABULATE that is working fine and produces output in
Excel by ODS. However, all my numbers are shown in a kind of 'general'
format without points or decimals between thousands. I tried formats such as
COMMA12.2 COMMAX12.2 but only DOLLAR12.2 is working (but I don't
want the dollar sign). I've tried putting the format on different places, with the
same result.
Here is my code:
ods tagsets.excelxp;
proc tabulate data=Capital; 
   var  Aantal_Producten Kapitaal; 
   class Soort; 
   table 

      soort all = 'Totaal' *[style=[backgroundcolor=light
grey]], 
      Kapitaal  * sum =' ' * f = comma12.2 
      Aantal_Producten = 'Aantal Producten'  * sum =' '  * f
= dollar12.2 
      /indent = 4; 
run; quit;
ods tagsets.excelxp close;
Topic 585
Subject
Cell background using decision rules
Question
I've made an Excel sheet with 3 pivot tables using Panda's Excelwriter. Those
pivot table's were also Python objects. One pivottable contains pro age the
number of people in the Netherlands at 1-1-2013, the second at 1-1-2014 and
the third the increase pro age in %. Imagine, there's a decision rule that says
that when the increase is more than 5% , give that cell a background colour.
What's the best way to do this? Reading the excel file and then using xlwt or
can this be done another way? Answer
One way would be to apply a conditional format to the output of the Pandas
using XlsxWriter as the Excel engine. See for example Pandas Excel output
with conditional formatting.
After that you just need to define a suitable conditional format. For that see
XlsxWriter: Working with Conditional Formatting.
Topic 586
Subject
Text indent with Excel to Word Macro
Question
I have a Excel to Word Macro specified as follows:
Sub CopyToWordDoc()

Dim objWord
Dim objDoc
Dim objSel
Dim sht As Worksheet
Dim p As Integer
Set objWord = CreateObject("Word.Application") 'open new word document
Set objDoc = objWord.Documents.Add
Set objSel = objWord.Selection
objWord.Visible = True
For x = 1 To Worksheets.Count - 1 'loop through data sheets and export
contents to Word
On Error Resume Next
Set sht = Sheets("X" & x)
On Error GoTo 0
If sht Is Nothing Then Exit Sub
With sht 
      If x = 1 Then 'add version, date, userinfo, projectinfo
etc. to first page of Word 
          objSel.Style = objDoc.Styles("Heading 1") 
          objSel.TypeText (Range("Client").Value2) 
          objSel.TypeParagraph 
          objSel.Style = objDoc.Styles("Heading 1") 
          objSel.TypeText ("Scope of Tax Due Diligence") 
          objSel.TypeParagraph 
          objSel.Style = objDoc.Styles("Normal") 
          objSel.TypeText ("Review Period: " &
Range("Period").Value2) 
          objSel.TypeParagraph 
          If .Range("C3").Value2 = True Then 'check if Level
1 titel has to be added 
              objSel.Style = objDoc.Styles("Heading 2") 
              objSel.TypeText (.Range("B2").Value2) 
              objSel.TypeParagraph 
          Else 
              p = 1 

          End If 
      Else 
          If p = 1 And .Range("C3").Value2 = True Then 
              objSel.Style = objDoc.Styles("Heading 2") 
              objSel.TypeText (.Range("B2").Value2) 
              objSel.TypeParagraph 
              p = 0 
          ElseIf p = 0 And .Range("C3").Value2 = True Then 
              If .Range("B2").Value2 <> Sheets("X" & x -
1).Range("B2").Value2 Then 
                  objSel.Style = objDoc.Styles("Heading 2") 
                  objSel.TypeText (.Range("B2").Value2) 
                  objSel.TypeParagraph 
              End If 
          ElseIf p = 0 And .Range("C3").Value2 = False Then 
              If .Range("B2").Value2 <> Sheets("X" & x -
1).Range("B2").Value2 Then p = 1 
          End If 
      End If 
      objWord.Run
MacroName:="sdWordEngine.mBulletsAndNumbering.FormatBulletDefau
      If .Range("C3").Value2 = True Then 'add level 2 title 
          objSel.Style = objDoc.Styles("Heading 3") 
          objSel.TypeText (.Range("B3").Value2) 
          objSel.TypeParagraph 
      End If 
      objWord.Run
MacroName:="sdWordEngine.mBulletsAndNumbering.FormatBulletDefau
      For y = 4 To
Application.WorksheetFunction.CountA(.Range("B1:B50")) 'loop
through data sheet and add info if in scope 
          If .Range("C" & y).Value2 = True Then 
              If .Range("A" & y).Value2 = 3 Then 
                  objSel.Range.SetListLevel Level:=1 
                  objSel.TypeText (.Range("B" & y).Value2) 
                  objSel.TypeParagraph 
              Else 
                  objSel.Range.SetListLevel Level:=2 
                  objSel.TypeText (.Range("B" & y).Value2) 
                  objSel.TypeParagraph 
              End If 
          End If 
      Next 

End With
Next
objWord.Run
MacroName:="sdWordEngine.mBulletsAndNumbering.FormatBulletDefault"
objSel.InsertBreak Type:=wdPageBreak
For x = 1 To Worksheets.Count - 1 'same as above but for info request instead
On Error Resume Next
Set sht = Sheets("X" & x)
On Error GoTo 0
If sht Is Nothing Then Exit Sub
With sht 
      If x = 1 Then 
          objSel.Style = objDoc.Styles("Heading 1") 
          objSel.TypeText ("Information Request for Tax Due
Diligence") 
          objSel.TypeParagraph 
          If .Range("C3").Value2 = True Then 
              objSel.Style = objDoc.Styles("Heading 2") 
              objSel.TypeText (.Range("B2").Value2) 
              objSel.TypeParagraph 
          Else 
              p = 1 
          End If 
      Else 
          If p = 1 And .Range("C3").Value2 = True Then 
              objSel.Style = objDoc.Styles("Heading 2") 
              objSel.TypeText (.Range("B2").Value2) 
              objSel.TypeParagraph 
              p = 0 
          ElseIf p = 0 And .Range("C3").Value2 = True Then 
              If .Range("B2").Value2 <> Sheets("X" & x -
1).Range("B2").Value2 Then 
                  objSel.Style = objDoc.Styles("Heading 2") 
                  objSel.TypeText (.Range("B2").Value2) 
                  objSel.TypeParagraph 
              End If 

          ElseIf p = 0 And .Range("C3").Value2 = False Then 
              If .Range("B2").Value2 <> Sheets("X" & x -
1).Range("B2").Value2 Then p = 1 
          End If 
      End If 
      objWord.Run
MacroName:="sdWordEngine.mBulletsAndNumbering.FormatBulletDefau
      If .Range("C3").Value2 = True And
Application.WorksheetFunction.CountIf(.Range("G2:G50"), True)
<> 0 Then 
          objSel.Style = objDoc.Styles("Heading 3") 
          objSel.TypeText (.Range("B3").Value2) 
          objSel.TypeParagraph 
      End If 
      objWord.Run
MacroName:="sdWordEngine.mBulletsAndNumbering.FormatBulletDefau
      For y = 2 To
Application.WorksheetFunction.CountA(.Range("F1:F50")) 
         If .Range("C3").Value2 = True Then 
              If .Range("G" & y).Value2 = True Then 
                  If .Range("E" & y).Value2 = 1 Then 
                      objSel.Range.SetListLevel Level:=1 
                      objSel.TypeText (.Range("F" &
y).Value2) 
                      objSel.TypeParagraph 
                  Else 
                      objSel.Range.SetListLevel Level:=2 
                      objSel.TypeText (.Range("F" &
y).Value2) 
                      objSel.TypeParagraph 
                  End If 
              End If 
          End If 
      Next 
End With
Next
objSel.TypeBackspace
objSel.WholeStory
objSel.Font.Name = "Arial"

End Sub
In the Excelfile I have all the infos that are put together into a Word document:
Excel File picture
How can I make sure that all level 4 text, once generated in Word, has a text
indent of about 2cm?
In advance, many thanks for your support!
So I put the following code in:
For y = 4 To Application.WorksheetFunction.CountA(.Range("B1:B50")) 'loop
through data sheet and add info if in scope 
          If .Range("C" & y).Value2 = True Then 
              If .Range("A" & y).Value2 = 4 Then 
                  objSel.Range.SetListLevel Level:=1 
                  objSel.TypeText (.Range("B" & y).Value2) 
                  objSel.TypeParagraph 
                  objSel.Paragraphs.LeftIndent = 72 
              Else 
                  objSel.Range.SetListLevel Level:=2 
                  objSel.TypeText (.Range("B" & y).Value2) 
                  objSel.TypeParagraph 
              End If 
          End If 
When I compile the Word document it sets level 4 lines with left indent 72.
However, only from the second level 4 line it starts formatting the lines that
way. It always leaves out the first level 4 line (keeps it without left indent).
Does someone know why that is? Many thanks for your help! Answer
How about:
Selection.Paragraphs.LeftIndent = 72
Change the 72 to fit want you want.
Select the whole document, then put that line of code after it.

aParagraph_inaMacro.html">http://word.tips.net/T001468_Setting_the_Left_In
Topic 587
Subject
What i can't figure out is how to display the searched word and number of
times its shows up on a different worksheet on excel [closed]
Question
Sub Sample()
Dim oRange As Range, aCell As Range, bCell As Range Dim ws As
Worksheet
Dim ExitLoop As Boolean
Dim SearchString As String, FoundAt As String Dim iCount() As String
iCount = Split(FoundAt, ", ")
Set ws = Worksheets("detail_report")
On Error GoTo Err
Set oRange = ws.Cells
SearchString = "leak"
Set aCell = oRange.Find(What:=SearchString, LookIn:=xlValues, _ 
              LookAt:=xlPart, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
              MatchCase:=False, SearchFormat:=False) 
If Not aCell Is Nothing Then 
      Set bCell = aCell 
      FoundAt = aCell.Address 
      Do While ExitLoop = False 
          Set aCell = oRange.FindNext(After:=aCell) 
          If Not aCell Is Nothing Then 
              If aCell.Address = bCell.Address Then Exit Do 

              FoundAt = FoundAt & ", " & aCell.Address 
          Else 
              ExitLoop = True 
          End If 
      Loop 
       iCount = Split(FoundAt, ", ") 
      MsgBox "The Search String has been found " &
UBound(iCount) + 1 & " times at these locations:" 
Else
MsgBox SearchString & " not Found" End If
MsgBox "The Search String has been found in these locations: " & FoundAt
Exit Sub
Err:
MsgBox Err.Description
End Sub
Answer
Currently your code is showing up as a Msgbox. It is not clear what you are
asking but if you need to put the results into another sheet then you could add
this to your code.
Instead of:
MsgBox "The Search String has been found " & UBound(iCount) + 1 & " times
at these locations:"
You could set an output worksheet and write the values. Create a sheet called
output or name it whatever.
Dim outws as worksheet
Set outws = Worksheets("output")
# You can set more sophisticated routine here like going to last empty row #

Lots of stack overflow code for that if you search
# Simple paste in A1 the string and B1 the count # I am showing you two ways
to reference cells outws.Range("A1").Value = SearchString
outws.Sheets(outws).Range(Cells(1,2)).Value = UBound(iCount) + 1
Hope this helps
Topic 588
Subject
Open web-generated text file in excel
Question
I generate text files in a web application, and I would like the client (mainly
IE11 running on Windows 7 and 8) to directly open the files in Excel.
I serve the files as:
Content-Type: application/vnd.ms-excel
Content-Disposition: filename="myfile.txt"
and the content of the file is something like this:
abc <tab> def <tab> ghi
123 <tab> 456 <tab> <789>
When a Windows IE11 user downloads this file, the file extension will be
forcibly changed to ".xls" when the data content is 4096 bytes or larger. Thus,
Excel will then complain about "invalid file format" (of course) when trying to
open the file, having text-only content.
When the file is less than 4096 bytes, the extension ".txt" will be un-touched,
and Excel will happily open the file.
The same thing happens if I use a ".htm" extension (using a HTML data
content).
Any solutions to this, how to make Excel open the file without problems?

If I instead use extension ".csv" (Content-Disposition: filename="myfile.csv")
it never gets renamed - probably as CSV is a file format that kind of belongs to
Excel. However ".csv" files need to use "," or ";" as field delimiters,
according to the user locale, and I'd prefer using <tab> instead. (also, I'd
actually really prefer to use HTML data content as well)
So - why does Windows/IE11 rename the file to ".xls" when it is 4096 bytes or
larger? And/or, is there any "best practice" to get Excel to automatically open a
text file delivered from the web?
Topic 589
Subject
Divide cells in row if it contains specific text
Question
I want to see if range "A2:A500" contains the text "US", if it does I want to
divide cell C and B in that specifik row. So for example if Cell A5 contains
US then only B5/C5 should be divided. Is this possible?
my formula
=IF(A2:A500="US*"; "$B2/$C500";"")
Answer
Yes this is possible, with one assumption(1) there will only be one instance of
"US", if any. Technically if there are multiple cells with "US", it could be
done, but it isn't clear what you'd want to do in that case (divide the sum of
those B rows by the sum of those C rows?)
First, we will use the MATCH function to determine if there is an instance of
"US" in column A:
=MATCH("US*",A:A,0)
Then, we will nest that formula inside an INDEX formula, to pull the values
from columns B & C, from the row which we determined from the MATCH
function.

=INDEX(B:B,MATCH("US",A:A,0))/INDEX(C:C,MATCH("US",A:A,0))
Finally, we will nest the entire formula inside of an IFERROR function. This
will allow us to show a different value, if an error arises for any reason:
=IFERROR(INDEX(B:B,MATCH("US",A:A,0))/INDEX(C:C,MATCH("US",A:
Note - this will also show an error if, for example, there is a match for US, but
the value in that row for column C is a 0 - because it will create a divide by
zero error. If you want to see that a divide by 0 error may exist, you will need
to restructure your formula so that it first checks for a match in column A, and
then calculates the division, like so:
=IF(ISERROR(MATCH("US",A:A,0)),"",INDEX(B:B,MATCH("US",A:A,0))/IN
Answer
I seen to be very simple, just take the first two characters of the cell to test if is
US no matter what the string has using LEFT formula
Well you have this:
+----+-------+-------+-------+
| | Col A | Col B | Col C |
+----+-------+-------+-------+
| 1 | AG | 26 | 17 |
| 2 | JH | 25 | 22 |
| 3 | UY | 16 | 24 |
| 4 | JH | 11 | 11 |
| 5 | HY | 28 | 14 |
| 6 | BV | 25 | 27 |
| 7 | US | 15 | 18 |
| 8 | HY | 30 | 21 |
| 9 | HN | 21 | 22 |
| 10 | UY | 20 | 12 |
| 11 | BV | 10 | 23 |
| 12 | TD | 24 | 12 |
| 13 | US | 30 | 26 |

| 14 | UY | 24 | 19 |
| 15 | BG | 15 | 29 |
| 16 | TF | 30 | 23 |
| 17 | US | 27 | 24 |
| 18 | PO | 13 | 14 |
| 19 | US | 20 | 14 |
| 20 | MN | 28 | 20 |
+----+-------+-------+-------+
And inside the cells D1:D20 you write this
=IF(LEFT(A1,2)="US",B1/C1,0)
This is:
IF the first two characters of the cell A#(Cells from column A, any number)
are equial to "US" (IF(LEFT(A1,2)="US"), THEN divide B between C (the
Same row), otherwise give a 0
Result
+----+-------+-------+-------+-------+
| | Col A | Col B | Col C | Col D |
+----+-------+-------+-------+-------+
| 1 | AG | 26 | 17 | 0.000 |
| 2 | JH | 25 | 22 | 0.000 |
| 3 | UY | 16 | 24 | 0.000 |
| 4 | JH | 11 | 11 | 0.000 |
| 5 | HY | 28 | 14 | 0.000 |
| 6 | BV | 25 | 27 | 0.000 |
| 7 | US | 15 | 18 | 0.833 |
| 8 | HY | 30 | 21 | 0.000 |
| 9 | HN | 21 | 22 | 0.000 |
| 10 | UY | 20 | 12 | 0.000 |
| 11 | BV | 10 | 23 | 0.000 |
| 12 | TD | 24 | 12 | 0.000 |
| 13 | US | 30 | 26 | 1.154 |
| 14 | UY | 24 | 19 | 0.000 |

| 15 | BG | 15 | 29 | 0.000 |
| 16 | TF | 30 | 23 | 0.000 |
| 17 | US | 27 | 24 | 1.125 |
| 18 | PO | 13 | 14 | 0.000 |
| 19 | US | 20 | 14 | 1.429 |
| 20 | MN | 28 | 20 | 0.000 |
+----+-------+-------+-------+-------+
Info for LEFT and LEFTB functions and the IF Function
Edit #1
On my example, just put two characters in the columns A, but if the cells of
column A has any string, and any of that strings has US at the begining, the
formula must divide B/C, because of the LEFT function, that take the first tw
characters of the string.
Answer
Sub test()
Dim i As Integer
Dim myRange As Excel.Range
For i = 2 To 500
If ActiveSheet.Cells(i, 1) = "US" Then Set myRange = ActiveSheet.Cells(i, 2)
myRange.Select
Selection.UnMerge
End If
Next
End Sub
EDIT - ops, it contains US
Sub test()
Dim i As Integer
Dim sToCheck As String
Dim myRange As Excel.Range
For i = 2 To 500
sToCheck = ActiveSheet.Cells(i, 1)

If InStr(1, sToCheck, "US", vbTextCompare) > 0 Then Set myRange =
ActiveSheet.Cells(i, 2)
myRange.Select
Selection.UnMerge
End If
Next
End Sub
Topic 590
Subject
Copying cells from multiple workbooks to a single worksheet
Question
I want to extract say column A1:A5 from multiple workbooks and copy it to a
single worksheet. Copying each workbook into the adjacent column.
For example:
Workbook one (A1:A5) will copy to Master workbook (A1:A5) Workbook
two (A1:A5) will copy to Master workbook (B1:B:5)
I have this code which sums all the values.
Sub SUM_Workbooks()
Dim FileNameXls, f
Dim wb As Workbook, i As Integer
FileNameXls = Application.GetOpenFilename(filefilter:="Excel Files, .xls",
MultiSelect:=True)
If Not IsArray(FileNameXls) Then Exit Sub
Application.ScreenUpdating = False
For Each f In FileNameXls
Set wb = Workbooks.Open(f)
Dim rngPaste As Range
With ThisWorkbook.Sheets(1)

Set rngPaste = .Range("A" & .Columns.Count).End(xlToLeft).Offset(, 1) End
With
rngPaste.Value = wb.Name
wb.Worksheets("Page 3").Range("P18:P22").Copy
rngPaste.Offset(1).PasteSpecial Paste:=xlPasteValues wb.Close
SaveChanges:=False
Next f
Application.CutCopyMode = False
Application.ScreenUpdating = True
End Sub
What I need is to paste the value from the workbooks into adjacent columns.
Answer
Change this line:
ThisWorkbook.Sheets(1).Range("A1").PasteSpecial Paste:=xlPasteValues,
Operation:=xlAdd, SkipBlanks:=True, Transpose:=False
To this bit of code:
For Each f In FileNameXls
Set wb = Workbooks.Open(f)
Dim rngPaste as Range
With ThisWorkbook.Sheets(1)
Set rngPaste = .Range("A" & .columns.Count).End(xlToLeft).Offset(,1) End
With
rngPaste.Value = wb.Name
wb.Worksheets("Page 3").Range("P18:P22").Copy
rngPaste.Offset(1).PasteSpecial Paste:=xlPasteValues wb.Close
SaveChanges:=False
Next f
What this will do is go to the last column each time and then move all the way
to left to find the last column with actual data, then offset that by 1 column. In

row 1 of that column, the name of the workbook will be entered. The data will
be entered starting in row 2.
Answer
With ThisWorkbook.Sheets(1)
.Range("A" & .Columns.Count).End(xlToLeft), Operation:=xlAdd,
SkipBlanks:=True End With
You need to put this between "For" loop in order to extract data from all the
excel sheets/workbooks.
Topic 591
Subject
Force download .xls file in Laravel 4.2
Question
I have the following route:
Route::get('/download/{id}/{filename}', function($id, $filename)
{ 
      // Check if file exists in app/storage/file folder 
      $file_path = storage_path() .'/orders/'.'/'.$id.'/'.
$filename; 
      if (file_exists($file_path)) 
      { 
          // Send Download 
          return Response::download($file_path, $filename, [ 
              'Content-Type: application/vnd.ms-excel;
charset=utf-8' 
          ]); 
      } 
      else 
      { 
          // Error 
          exit('Requested file does not exist on our
server!'); 
      } 

})->where('filename', '[A-Za-z0-9\-\_\.]+');
That downloads an excel file form /app/storage in Laravel (previously
uploaded). The problem I'm facing is that the downloaded excel file is
unreadable by excel. If I download the uploaded file from FTP it's ok. I tried
all types of headers for Content-Type but nothing seems to work. Is there a
special header for excel files? Thanks a lot.
Answer
i am using this code in CI please find helper file or library for Laravel
$this->load->helper('download');
if(file_exists("user_files/test.txt")){
$data = file_get_contents("user_files/test.txt"); force_download("test.txt",
$data);
}else{
echo "Error";
}
Topic 592
Subject
VBA to create desktop shortcut that opens in x program
Question
Good afternoon, I am trying to write a program that will 'install' a desktop
shortcut on a users desktop - this has to be opened with the following
paramaters. I can get the desktop shortcut to work for purely the website, but
not the relevant arguments
FileName = "Example" 
      Set Shortcut =
CreateObject("WScript.Shell").CreateShortcut(CreateObject("WScr
& "\" + FileName + ".lnk") 
          Shortcut.Description = "Reach Interactive SMS" 
          Shortcut.TargetPath = "https://example.com/" 
          Shortcut.Save 
          MsgBox "Shortcut has now created on your desktop",

0, "Example" 
Here is the arguments my version of the shortcut uses.
C:\Program Files (x86)\Microsoft Application Virtualization Client\sfttray.exe"
& " " & "/exe ff.exe" & " " & "Mozilla Firefox 38.3.0.0.1.V04" & " " &
"https://dwp.reach-interactive.com/account/login/"
What is the correct way around this?
Topic 593
Subject
Link to Excel from Access
Question
I was wondering is there a way to link an Access query to an Excel sheet that
automatically updates when the query changes? I know you can link and Excel
sheet to an Access table and it updates automatically. I'm just wondering if it
can be done the other way with a link?
Topic 594
Subject
Excel: How to refer to entire column in a formula by column title?
Question
I want to write a formula like =SUM(tab2!A:A) but instead use the column title
of A which is say "count". How can I modify this to look more like:
=SUM(tab2!"count")?
The reason I want to do this is because I copy and paste a spreadsheet from
another source in tab2 and the column referring to "count" may be in a different
column. I want the formula to give me the correct calculation as soon as I paste
the new spreadsheet by automatically finding the column to sum up by title
name.
I must be missing something because this seems like a very basic question and
I can't find the answer anywhere...

Thanks for your help!
Answer
Check out the name manager for naming ranges :)
Answer
You didn't say whether you would consider a macro solution. If so, this may
work. If the sheet you are pasting into is Sheet2 and the sheet you want the
result in is Sheet1, then this macro, if placed in the Worksheet_Activate event
of Sheet1 will give you the result as soon as you click on the Sheet1 tab afetr
pasting your data into Sheet2:
Private Sub Worksheet_Activate()
Dim r As Range
Dim rCol As Range
Dim rFound As Range
Dim ws As Worksheet
Dim lTotal As Long
Set ws = Sheet2
Set r = ws.Cells
Set rFound = r.Find("count")
If Not rFound Is Nothing Then
Set rCol = rFound.EntireColumn
lTotal = Application.WorksheetFunction.Sum(rCol) End If
Cells(1, 1) = lTotal
End Sub
It does assume there is only one cell with the word "count" in it on Sheet2.
Answer
I like the idea of naming ranges proposed by @Doug, but if the issue is that you
are dumping your data in [and you don't know in advance which column is
going to be where] and would need to rename your range every time, there are

other options - I suggest using OFFSET. OFFSET allows you to dynamically
create a range, starting at a particular point and moving down/up / right/left for
as many rows and columns as you determine.
In your case, you will need to combine that with a method for searching the
columns to see which one says "Count". I am assuming that your column
headings are always in row 1. If they aren't [or if they aren't always in row 2,
or any row you know in advance]... you can get around that but then I'd
recommend you try to make your data more uniform instead of creating
unnecessary Excel workarounds.
In total your formula would look like this:
=SUM(OFFSET(A1,,MATCH("Count",1:1,0)-1,ROWS(A:A),1))
What this does is first determine which column the word "Count" is found in,
in row 1. Then it subtracts 1 from that number - this now equals the number of
columns to the right that it is, from column A. It uses offset to create a
reference to that column, for all rows, and sums those rows together.
Topic 595
Subject
Getting some issue while export table value to excel sheet using Angular.js and
PHP
Question
I need some help.i am exporting my table data to a excel sheet using Angular.js
and PHP.Here i need to remove some column from excel sheet and displaying
image on the excel sheet.I am explaining my code below.
productView.html:
<span class="input-group-addon" id="basic-addon1">Product Name</span>
<input type="text" class="form-control" placeholder="Product Name" ng-
model="searchProduct.Product_name"> <span class="input-group-btn">
<button class="btn btn-default" type="button" ng-
click="exportData();">Export</button> <div id="exportable">
<table class="table table-bordered table-striped table-hover" id="dataTable"

> <thead>
<tr>
<th>Sl. No</th>
<th>Product Name</th>
<th>Image</th>
<th>Discount</th>
<th>Edit</th>
<th>Remove</th>
</tr>
</thead>
<tbody id="detailsstockid">
<tr dir-paginate="pro in productDataList | filter:searchProduct |
itemsPerPage:5"> <td>{{$index+1}}</td>
<td>{{pro.Product_name}}</td>
<td><img ng-src="upload/{{pro.image}}" name="pro" border="0"
style="width:50px; height:50px; border:#808080 1px solid;" /></td> <a ui-
sref="productview">
<input type='button' class='btn btn-xs btn-green' value='Edit' ng-
click="editProductViewData(pro.pro_data_id);"> </a>
</td>
<td ng-if="pro.pro_status==1">
<a ui-sref="productview">
<input type='button' class='btn btn-xs btn-red' value='Deactive' ng-
click="deleteProductInfoData(pro.pro_data_id,pro.pro_status);" > </a>
</td>
<td ng-if="pro.pro_status==0">
<a ui-sref="productview">
<input type='button' class='btn btn-xs btn-green' value='Active' ng-
click="activeProductInfoData(pro.pro_data_id,pro.pro_status);" > </a>
</td>
</tr>
</tbody>
</table>
</div>
My controller side code is given below.

$scope.exportData=function(){ 
     if($scope.searchProduct != '' || $scope.searchProduct
!=null){ 
        // console.log('hello'); 
         var blob = new
Blob([document.getElementById('exportable').innerHTML], { 
             type: "application/vnd.openxmlformats-
officedocument.spreadsheetml.sheet;charset=utf-8" 
         }); 
         saveAs(blob, "Report.xls"); 
     } 
}
Here my problem is i can able to export the excel sheet but image is not
coming,lines inside the sheet is also not coming.I need to also remove the edit
and remove part of table from excel sheet.My downloaded excel sheet is
looking like a white sheet and data are displaying.Here i need to display the
image and remove the edit and remove part from excel sheet.Please help me.
Topic 596
Subject
google spreadsheet scripts auto fill last cell on new row
Question
Using a form and google sheet for budget keeping. The form has category,
vendor, and amount. After submit the sheet includes a time stamp column. I've
added an additional column with the formula:
=year(A2) & "-" & if(len(month(A2))=1,"0" & month(A2),month(A2))
I need this formula to automatically be added to the same column in the new
row (cell at last column and last row) each time the form is submitted.
Suggestions are greatly appreciated.
Answer
I believe you're looking for an OFFSET type of function. You'll need to offset
by row and by column.

I'm not going to write everything for you, but here is basic offset syntax
NameOfDIM.Cells(NameOfDIM.Rows.Count, 1).End(xlUp).Offset(1, 0)
The two number at the end represent (Vertical, Horizontal) offset :) This
should get you close to be able to play around with it till you figure it out
Topic 597
Subject
Ms-Excel - Extracting specific word from a cell and put it to another cell?
Question
I have an Excel data which contains 312 student records. In cell B2 I have Full
name of students.
What I want to do is specifically as follows:
Extract first name from B2 and put it in D2 Extract Last name from B2 and put
it in E2 Extract GFname from B2 and put it in F2 Finnaly by dragging I want to
get all rows done.
Note: For Example the first row is done manually.
Is there any spcial help because I'm loosing my time and effort if it is not
solved.
Thanks in Advance!
Answer
Try using functions like TRIM, FIND, MID, LEFT or RIGHT
Topic 598
Subject
Querying Analysis Server with MDX from Excel using MSOLAP returns
different results than from SSMS
Question
So. I have prepared an MDX query in SQL Server Management Studio (SSMS)
which shows me the result that I want. However, I would like to query it from

Excel instead of from SSMS, so that I can work with the figures and create
graphs and such.
My MDX could look like the following:
SELECT 
      [Dates].[By Month].[Month].&[2015-02] 
      ON 0, 
      ( 
      [Region-Office].[Region Hierarchy].AllMembers * 
      [Measures].[Earnings] 
      ) ON 1 
FROM [Model]
When querying this MDX in SSMS, I get the result that I want: namely that both
Region and Office is printed to only one column:
Above MDX query returned from SSMS, note that both region and office is in
the same column
When I turn to Excel and create an MSOLAP.6 connection with the following
connection string:
Provider=MSOLAP.6;Integrated Security=SSPI;Persist Security
Info=True;Initial Catalog=CubeData;Data Source=CubeServer;Extended
Properties="VisualMode=2";MDX Compatibility=2;Safety Options=2;MDX
Missing Member Mode=Error
I get a different result: namely that region is printed to one separate column and
office printed to another separate column:
Above MDX query returned to Excel table using MSOLAP.6, note that region
and office is printed in two separate columns, which is not what I want
Can I in any way control what the Excel table returns so that I can retrieve the
same output as the one I query in SSMS?

Thank you very much in advance!
Answer
The connection string you supplied is the same as I have when using excel's
out-of-the-box SSAS connection wizard to a pivot table, so I'll assume nothing
more complicated than that.
If in a pivot I add a multi-level dimension to rows I get behaviour like the
following - for a "classic" pivot:
I can create a custom set in Excel like the following:
That set then becomes available to use and all members are in a single column:
Topic 599
Subject
Importing from multiple workbooks
Question
I have completed some code to open multiple workbooks and copy data into
one master workbook. I can't figure out how the code "chooses" which
workbook to open first to import. Anybody have any ideas what is the method
excel uses to select the files? Answer
Take a look at this post over here. There is a link in the responses to a blog
which talks about Window natural sorting method. Unless you specify in the
code which files to open, VBA will normally open the files based on the
natural sorting method.
Topic 600
Subject
SimpleInjector ActivatorException when resolving COM interop type
Question
When attempting to resolve a type from my Simple Injector container it is
throwing an ActivatorException saying that my type is not registered although I
am fairly sure that it has been.

ThisAddin.cs
private void ThisAddIn_Startup(object sender, EventArgs e) { 
   var container = new Container(); 
  
container.RegisterSingleton<Microsoft.Office.Interop.Excel.Appl
(() =>
this.GetHostItem<Microsoft.Office.Interop.Excel.Application>( 
          typeof(Microsoft.Office.Interop.Excel.Application),
"Application")); 
   var application =
container.GetInstance<IApplicationAdapter>(); 
}
In another Assembly, in this case ExcelInterface.
ApplicationAdapter.cs
internal class ApplicationAdapter : IApplicationAdapter {
public Application(Microsoft.Office.Interop.Excel.Application
excelApplication) {
}
}
IApplicationAdapter.cs
public interface IApplicationAdapter
{
}
But when it comes to resolve the Excel.Application I get the exception as:
So trying to debug this I thought that it hadn't actually been registered correctly,
but when checking the added registrations in the container I can see that the
Excel.Application has been added:
I've also checked and made 100% sure that the two classes are referencing the

same Excel.Application assembly which they are.
Finally I would have added the Excel.Application instance to the container but
since this is a __COMObject I am unable to register it as an
Excel.Application.
I'm totally at a loss to why Simple Injector is unable to correctly resolve the
interface. Answer
I'm not sure why this happens. I can confirm that an exception occurs when
trying to register this as in your example.
With what you're trying to do, I agree with Steven's comment, yuck!! Creating
your own, possible multiple, abstractions over the application object should be
the way to go.
However what you want is possible with some minor changes. Instead of
registering the application object itself, which throws for some strange reason,
you could register a IApplicationProvider like this:
internal interface IApplicationProvider {
Excel.Application CurrentApplication { get; } }
class ApplicationProvider : IApplicationProvider {
public ApplicationProvider(Excel.Application application) {
this.CurrentApplication = application; }
// c# 6 syntax
public Excel.Application CurrentApplication { get; } }
Which you can register as:
var container = new Container();
var app = this.GetInstance<Microsoft.Office.Interop.Excel.Application>
("Application"); var appicationProvider = new ApplicationProvider(app);
container.RegisterSingleton<IApplicationProvider>(appicationProvider);

//Make other registrations....
container.Verify();
I made a little helper method for readability:
public TInstance GetInstance<TInstance>(string key) where TInstance : class {
return this.GetHostItem<TInstance>(typeof (TInstance), key); }
Everywhere you now need the application object you can just inject the
IApplicationProvider and use like this:
class SomeService
{
private readonly IApplicationProvider applicationProvider;
public SomeService(IApplicationProvider applicationProvider) {
this.applicationProvider = applicationProvider; }
public int GetWorkbookCount()
{
return this.currentApplication.Workbooks.Count; }
// c# 6 syntax
private Excel.Application currentApplication =>
this.applicationProvider.CurrentApplication; }
Tested with Office 2016 and this works as expected.
Topic 601
Subject
Passing variables between Outlook and Excel
Question

I have code that opens a spreadsheet from Outlook. I am trying to add a section
that filters the sheet to the user ID of the sender of a selected mail item.
Half way down the code the variable disappears. It looks like it is not being
passed to Excel from Outlook.
When adding the variable to Watch. It ceases to exist from the line:
Set xlapp = CreateObject("Excel.Application")
.
Option Explicit
Sub openkeyfile()
'Excel variables
Dim xlapp As Object
Dim xlWB As Object
Dim xlsheet As Object
'Outlook variables
Dim currentExplorer As Explorer
Dim Selection As Selection
Dim olItem As Outlook.MailItem
Dim obj As Object
Dim user As String
'Get sender
Set currentExplorer = Application.ActiveExplorer Set Selection =
currentExplorer.Selection For Each obj In Selection
Set olItem = obj
If olItem.sender.AddressEntryUserType = olExchangeUserAddressEntry Or _
olItem.sender.AddressEntryUserType = olExchangeRemoteUserAddressEntry
Then 
      Dim exchangeUser As exchangeUser 

      Set exchangeUser = olItem.sender.GetExchangeUser 
End If
user = exchangeUser.Alias
Next
Dim strPath As String
strPath = "<snip>"
Set xlapp = CreateObject("Excel.Application")
With xlapp
.Visible = True
.ScreenUpdating = False
'Set xlWB = xlapp.Workbooks.Add
Set xlWB = xlapp.Workbooks.Open(strPath)
With xlWB
'Code for workbook here 
      Columns("A:C").EntireColumn.Delete 
      Columns("B:F").EntireColumn.Delete 
      Columns("C:E").EntireColumn.Delete 
      Columns("D:D").EntireColumn.Delete 
      Columns("F:F").EntireColumn.Delete 
      Columns("H:I").EntireColumn.Delete 
      Columns("N:O").EntireColumn.Delete 
      Columns("A:M").EntireColumn.AutoFit 
End With
.ScreenUpdating = True
End With

End Sub
Topic 602
Subject
Remove cells that do not contain partial string? error
Question
I have a long list of file paths and names in an excel column. I am working on a
code to remove every cell that does not contain any partial strings that I have
put in an array. I get an error "delete method of range class failed". I am very
new to VBA so any tips are appreciated, here's what i've got so far:
Sub Tester()
Dim dontDelete As Variant
Dim sKeep As String, x As Long
Dim rngSearch As Range, c As Range
Dim i As Long, j As Long
dontDelete = Array("abel", "varo") 
   For x = Range("A" & Rows.Count).End(xlUp).Row To 1 Step -1
       For j = LBound(dontDelete) To UBound(dontDelete) 
           Set c = Range("A" & x).Cells 
           If InStr(c.Value, dontDelete(j)) = 0 Then 
               c.Delete shift:=xlShiftUp 
           End If 
       Next j 
   Next x 
End Sub
I believe it is the "c.Delete shift:=xlShiftUp" that is causing the problem but i
don't know why? Answer
Code that only deletes cells if none of the strings in the array are contained
instead of deleting every cell that does not contain all of them:
Sub Tester()

Dim dontDelete As Variant
Dim sKeep As String, x As Long
Dim rngSearch As Range, c As Range
Dim i As Long, j As Long
dontDelete = Array("abel", "varo")
Dim deleteCell As Boolean 
       For x = Range("A" & Rows.Count).End(xlUp).Row To 1
Step -1 
           Set c = Range("A" & x).Cells 
           deleteCell = True 
           For j = LBound(dontDelete) To UBound(dontDelete) 
               If InStr(c.Value, dontDelete(j)) Then 
                   deleteCell = False 
               End If 
           Next j 
           If deleteCell Then c.Delete shift:=xlShiftUp 
       Next x 
End Sub
This does not solve the error, but the error wasn't caused by the code itself, so
it was solved in another way.
Topic 603
Subject
Reflect the value changes in an input table in another table in another
wordbook
Question
I am looking for your help as for two days I have been trying to create a VBA
code that would allow me to do the following:
I start with one workbook that contains "table 1" (see image table 1). This
table is where I want to summarize all the data I get from other workbooks (I'll
call them external workbooks).
External workbooks have a similar format to "table 1" but only contain data for
one Cost Center (e.g. A) (see image table 2).

As you can see from this two images, table 2 contains similar information to
that shown in table 1 for Cost Center A. Nonetheless there are some
differences. Fow example column % could have different values in table 2 or
more Cost Centres (see image differences table 2 and 1).
What I would like is to automatically transfer these changes from table 2 to
table 1 adding/deleting one line underneath the last Cost Centre A row in table
1 to reflect changes. I also need to reflect any changes made to % for each
Object in each Cost Centre (see image desired outcome).
I am working with large amounts of data I have to do this process everyday so
I would really appreciate if someone could help me to solve my problem. If
you have any questions regarding my example please let me know!!
Thank you in Advance.
Topic 604
Subject
IF “Green” is picked from down down list clear other cell
Question
Excel:
In D23 I have a drop down list with the options of Red, Amber, Green,
Complete, Cancelled, On Hold. In E23 I enter a date of when the project will
go Green if it is in any of the other states.
I would like E23 to be empty if D23 is Green. Otherwise E23 should be able
to have a date typed in i.e 10/02/2016... any ideas how to do this? Answer
Using Excel conditional formatting you can get this job done..
for more about conditional formatting refer this page related to what your
looking for : http://www.excel-formulas.in/2015/08/excel-conditional-
formatting-excel.html
Topic 605
Subject

Excel VBA - extract parts of string to form a list?
Question
I'm trying to extract some details from some SQL code in order to make a list -
specifically: I'm trying to extract nominal codes from a case statement to make
a human readable list of nominal codes...I'm wondering if there's a way for
VBA to extract the string parts and also output a list?
Here's the code that, for example, we'll say is in cell a1...
when ProfitAndLoss.acno in
('P01200','P01201','P01205','P01206','P01210','P01211','P01220','P01221','P0
'DirSals'
What I need is...
P01200
P01201
P01205
etc
Answer
You want to use the Split function.
Option Explicit
Sub makeList()
Dim parts As Variant
Dim nextLine As Long
Dim i As Long
nextLine = 2
parts = Split(Cells(1, 1).Value, "'") For i = LBound(parts) + 1 To
UBound(parts) - 2 Step 2 Cells(nextLine, 1).Value = parts(i) nextLine =
nextLine + 1
Next i
End Sub

This splits the string up into sections with ' as the delimiter. Then it loops
through each part, skipping the first part - when ProfitAndLoss.acno in ('- and
the last two parts - ')then' and 'DirSals'. I used step two because each second
slice is '-'. Each part is output onto a new line, incremented each time.
Topic 606
Subject
Convert yyyy-MM-ddTHH:mm:ssZ date to yyyy-MM-dd HH:MM:ss in Excel
Question
I imported xml file to excel and the date format is yyyy-MM-ddTHH:mm:ssZ ,
How could i change the format to yyyyy-mm-dd HH:MM:ss or to Unix format?
Thanks!
Answer
Go to ur excel and do this
search for ur format type and done
Update 1: Okay try that
Sub ChangeDateFormat()
Application.ScreenUpdating = False
Dim CurrentCell As Range
Dim LastRow As Long
Dim RegEx As Object
Set RegEx = CreateObject("vbscript.regexp") RegEx.Global = True
LastRow = Range("A" & Rows.Count).End(xlUp).Row 'Get The Last Row in
Column Change A as Needed
For Each CurrentCell In Range("A1:A" & LastRow) ' Loop through all cells.
Change Column as needed
If InStr(CurrentCell.Value, "/") <> 0 Then 'To make sure only convert non

converted ones 
   RegEx.Pattern = "(\d{4})/(\d{2})/(\d{4}) (\d{2}):(\d{2}):
(\d{2})" ' Seperate all parts of imported Data into groups 
     CurrentCell.Value = RegEx.Replace(CurrentCell.Value,
"$3.$2.$1 $4:$5") ' Change order of groups and place into
cell. 
End If
Next
Application.ScreenUpdating = True
End Sub
Change the code as u need
Update 2: try that
format(now(), "yyyy-MM-dd hh:mm:ss")
Topic 607
Subject
VBA Active X button to take user to first cell of updated row
Question
I have a spread sheet which has a button that transfers all the entered data into
another sheet. I have then made a second button that takes you to this log should
you want to view it, however it takes you too the last cell filled. The log has a
lot of columns so i want to make the 'go to log' button to take you to the first
cell in the last row that was filled. all i have at the moment is a simple formula
to take you there.
Private Sub CommandButton2_Click()
ThisWorkbook.Sheets("Log").Activate
End Sub

Answer
If you are sure that your code is taking you to last Cell filled, and you are
expecting the control to go to the first cell of the row then below piece will do.
Cells(ActiveCell.Row, 1).Select
Topic 608
Subject
Inserting rows additional to requirements
Question
I've compiled a macro which uses an input box to allow the user to insert a
specified number of rows in multiple places on three different sheets within the
same workbook. It then subsequently populates these new rows with the
appropriate data using autofill based on an example first row.
It does all of the above correctly. However, it also inserts the user specified
number of rows into the 'Front Sheet' which is always the activesheet when the
macro is run. It is not one of the destinations I specify to insert the rows.
From user testing the unwanted rows are not inserted in a consistent place but
appear in different places within the sheet, seemingly varying with the number
specified in the input box. It doesn't populate these excess rows as it does the
desired ones.
Sub AddPlots()
Dim j As Integer, r As Range,
'Set Number of Rows to be added
j = InputBox("How many open market units does the development have?")
' Add Rows On Master Appraisal
With Worksheets("Master Appraisal") 
      Set r = Range("FirstPlot") 
      Do 
          Range(r.Offset(1, 0), r.Offset(j - 1,

0)).EntireRow.Insert 
          Set r = Cells(r.Row + j + 1, 1) 
          If r.Offset(1, 0) = "" Then Exit Do 
      Loop 
End With
'Add Rows On Cashflow
With Worksheets("Cashflow") 
      Set r = Range("FirstPlot2") 
      Do 
          Range(r.Offset(1, 0), r.Offset(j - 1,
0)).EntireRow.Insert 
          Set r = Cells(r.Row + j + 1, 1) 
          If r.Offset(1, 0) = "" Then Exit Do 
      Loop 
End With
'Add Rows On Fees (NHBC section)
With Worksheets("Fees etc") 
      Set r = Range("FirstPlot3") 
      Do 
          Range(r.Offset(1, 0), r.Offset(j - 1,
0)).EntireRow.Insert 
          Set r = Cells(r.Row + j + 1, 1) 
          If r.Offset(1, 0) = "" Then Exit Do 
      Loop 
End With
'Add Rows On Fees (Marketing section)
With Worksheets("Fees etc") 
      Set r = Range("FirstPlot4") 
      Do 

          Range(r.Offset(1, 0), r.Offset(j - 1,
0)).EntireRow.Insert 
          Set r = Cells(r.Row + j + 1, 1) 
          If r.Offset(1, 0) = "" Then Exit Do 
      Loop 
End With
'Populate New Rows with Data
Worksheets("Cashflow").Range("Topline2").AutoFill
Destination:=Range("Topline2").Resize(j), Type:=xlFillDefault
Worksheets("Master Appraisal").Range("Topline").AutoFill
Destination:=Range("Topline").Resize(j), Type:=xlFillDefault
Worksheets("Fees etc").Range("Topline3").AutoFill
Destination:=Range("Topline3").Resize(j), Type:=xlFillDefault
Worksheets("Fees etc").Range("Topline4").AutoFill
Destination:=Range("Topline4").Resize(j), Type:=xlFillDefault
End Sub
Answer
When you are using a WITH....END WITH code block any ranges that you
want to reference the correct worksheet must start with a period (.) otherwise
it will reference the active sheet.
So Range(r.Offset(1, 0), r.Offset(j - 1, 0)).EntireRow.Insert references the
active sheet, while .Range(r.Offset(1, 0), r.Offset(j - 1, 0)).EntireRow.Insert
references the sheet used in your WITH statement.
Edit
Also Cells(r.Row + j + 1, 1) should be .Cells(r.Row + j + 1, 1) - these
lines will update your r reference from the sheet used in the named range
FirstPlot to look at the active sheet rather than the WITH sheet.
Topic 609
Subject
Excel VBA copy cell into final column

Question
I am was hoping for some help on a VBA Query for an action on a
ClickButton...
When I open a workbook, on the example i've got shows a monthly history
running through Row 3...
I currently manually copy the previous month from B3 to I6 and then move A3
to B3.
The logic I would like would be to use Range("B2").Value but it would need
an If statement for the destination of the location to be within range D3:O3,
pasting the value into the first blank cell.
Then on the same ClickButton action to transfer the value from A3 to B3
because I will then manually need to enter into A3 on a monthly basis...
Example attached with increments of 5 used, real sheet will not be so simply...
spreadsheet
Any help would be greatly appreciated!
P
Topic 610
Subject
xls vba range asign LongLong array error
Question
When I try to assign one LongLong array to a range I get a "Run-time error
"1004" Application defined or object defined error" code:
Private Sub CommandButton1_Click()
Dim var(10) As LongLong
Dim i As Integer

For i = 0 To 9
var(i) = i
Next i
Range("B3", "K3").Value = var
End Sub
If I declare array of type Long or I try to write only one value of type LongLong
I do not get any error.
Topic 611
Subject
SHAPE, inserted in the cell, hinders cell selection
Question
I have a code that inserts a shape in the cell.
Suppose I insert shape in cell A1 and would like to write in that cell "5".
After the shape is inserted, the cell on-mouse-over cannot be selected because
the shape is overlapping with it. I can only select the shape. Or, if I make shape
unselectable, I cannot select neither shape, nor cell.
In order to write "5" in A1, I have to select e.g. cell B1 and with keyboard
arrow <- move to cell A1. Then it works.
Is it possible to insert shape that is not only unselectable, but also is
completely ignored on-mouse-over? It means the shape should be some kind of
"behind the cell", but still visible. So that when you select the cell with shape,
the selection priority is 100% taken by the cell.
Set Shp = ActWS.Shapes.AddShape(msoShapeOval, _
ActWS.Cells(rActPlan - 1, vReturnColumn).Left, _ ActWS.Cells(rActPlan - 1,
vReturnColumn).Top, _ ActWS.Cells(rActPlan - 1, vReturnColumn).Width, _
ActWS.Cells(rActPlan - 1, vReturnColumn).Height) Shp.Fill.Visible =
msoFalse

With Shp.Line
.Visible = msoTrue
.ForeColor.RGB = RGB(0, 255, 0)
.Transparency = 0
.Weight = 2.25
End With
Answer
In case you do only need to select specific cells, you can define the cells to be
editable like below. Afterwards you protect the sheet and allow solely to
select locked and/or unlocked cells. Do let me know if you require a
programmatic solution to this as well.
Topic 612
Subject
Unix - conversion from xls to csv - delay for big files
Question
for a new project I have to import Excel files to an Oracle database (globally,
using Java). After several researches on the web, the easiest way seems to
transform xls to csv. The template of the file allows it. I saw that several
commands exist on Unix, like xls2csv. And the architecture of the project
allows it.
My question : for big xls files, between 500.000 and 1.000.000 lines, do you
know how long is the conversion, is it in seconds, minutes, hours ? And if it's
exponential ? If 1 line takes 1 second, do 1.000 lines take 1.000 seconds ?
Regards,
Julien.
Topic 613
Subject
How to change number format in excel sheet through VB.net?
Question

I have a program to convert DataGrid into excel sheet.It is working. But now
my problem is if my data is "763040059412" in Datagrid,after converting in
my excel sheet it is showing as "7.6304E+11". I dont know what to do..Please
help me. Thanking you Answer
Using Excel automation set NumberFormat of the range as shown below where
I am using your value shown. If I were to insert that value w/o setting
NumberFormat the result is same as you got but using NumberFormat the
number is formatted correctly.
Here I am working with a Excel file in the executable folder, you would adjust
to point to your existing or newly created Excel file.
Dim FileName As String = IO.Path.Combine(Application.StartupPath,
"Formatting.xlsx") Dim value As Long = 763040059412
OpenExcelDoFormat(FileName, "", "Sheet1", "G2", 763040059412)
Backing code where I open the file via process.start to instantly see results.
Note the parameter SaveFileName means nothing here as I tweaked another
demo I did for another question.
Option Strict On
Imports Excel = Microsoft.Office.Interop.Excel Imports Microsoft.Office
Imports System.Runtime.InteropServices
Module OpenWorkSheets4
Public Sub OpenExcelDoFormat( 
      ByVal OpenFileName As String, 
      ByVal SaveFileName As String, 
      ByVal SheetName As String, 
      ByVal CellAddress As String, 
      ByVal NewCellValue As Long) 
      If IO.File.Exists(OpenFileName) Then 
          Dim Proceed As Boolean = False 
          Dim xlApp As Excel.Application = Nothing 
          Dim xlWorkBooks As Excel.Workbooks = Nothing 
          Dim xlWorkBook As Excel.Workbook = Nothing 

          Dim xlWorkSheet As Excel.Worksheet = Nothing 
          Dim xlWorkSheets As Excel.Sheets = Nothing 
          Dim xlCells As Excel.Range = Nothing 
          xlApp = New Excel.Application 
          xlApp.DisplayAlerts = False 
          xlWorkBooks = xlApp.Workbooks 
          xlWorkBook = xlWorkBooks.Open(OpenFileName) 
          xlApp.Visible = False 
          xlWorkSheets = xlWorkBook.Sheets 
          For x As Integer = 1 To xlWorkSheets.Count 
              xlWorkSheet = CType(xlWorkSheets(x),
Excel.Worksheet) 
              If xlWorkSheet.Name = SheetName Then 
                  Proceed = True 
                  Exit For 
              End If 
            
Runtime.InteropServices.Marshal.FinalReleaseComObject(xlWorkSh
              xlWorkSheet = Nothing 
          Next 
          If Proceed Then 
              xlCells = xlWorkSheet.Range(CellAddress) 
              xlCells.Select() 
              xlCells.NumberFormat = "0" 
              xlCells.Value = NewCellValue.ToString 
              Dim xlColumns As Excel.Range = Nothing 
              xlColumns = xlCells.EntireColumn 
              xlColumns.AutoFit() 
            
Runtime.InteropServices.Marshal.FinalReleaseComObject(xlColumn
              xlColumns = Nothing 
          Else 
              MessageBox.Show(SheetName & " not found.") 
          End If 
          xlWorkSheet.SaveAs(OpenFileName) 
          xlWorkBook.Close() 
          xlApp.UserControl = True 

          xlApp.Quit() 
          ReleaseComObject(xlCells) 
          ReleaseComObject(xlWorkSheets) 
          ReleaseComObject(xlWorkSheet) 
          ReleaseComObject(xlWorkBook) 
          ReleaseComObject(xlWorkBooks) 
          ReleaseComObject(xlApp) 
          Process.Start(OpenFileName) 
      Else 
          MessageBox.Show("'" & OpenFileName & "' not
located. Try one of the write examples first.") 
      End If 
End Sub
Private Sub ReleaseComObject(ByVal obj As Object) 
      Try 
          If obj IsNot Nothing Then 
            
System.Runtime.InteropServices.Marshal.ReleaseComObject(obj) 
          End If 
          obj = Nothing 
      Catch ex As Exception 
          obj = Nothing 
      End Try 
End Sub
End Module
Answer
Go till the cell or range level and apply NumerFormat = "#,##0.00"
Topic 614
Subject
Excel / VBA: How to copy data from multiple Excel files
Question
I would like to loop through all Excel files in a folder in order to do something
with each file (all files have the same layout and only data on Sheet1).

So far I have the following code which gives me a list of the Excel files in a
specific folder. What I couldn't figure out myself is how I can copy data from
each file - specifically I would need to copy the data in range A10:E50 from
each file and then paste it on a page in my current file (all below each other).
Can someone help me with this ?
My current code:
Sub FindFiles()
Dim objFSO As Object
Dim objFolder As Object
Dim objFile As Object
Dim ws As Worksheet
Set objFSO = CreateObject("Scripting.FileSystemObject") Set ws =
Worksheets.Add
Set objFolder = objFSO.GetFolder("C:\Users\mo\Desktop\Test-Import\")
'ws.Cells(1, 1).Value = "The folder " & objFolder.Name & " contains the
following Excel files:"
For Each objFile In objFolder.Files
ws.Cells(ws.UsedRange.Rows.Count + 1, 1).Value = objFile.Name Next
Set objFolder = Nothing
Set objFile = Nothing
Set objFSO = Nothing
End Sub
Many thanks in advance for any help,
Mike
Answer
Try the below...
Sub FindFiles()

Dim objFSO As Object
Dim objFolder As Object
Dim objFile As File
Dim ws As Worksheet
Dim srWS As Worksheet
Dim wb As Workbook
Dim path As String
Set objFSO = CreateObject("Scripting.FileSystemObject") path = " " 'Enter
your path here
Set objFolder = objFSO.GetFolder(path)
'ws.Cells(1, 1).Value = "The folder " & objFolder.Name & " contains the
following Excel files:"
Set ws = Worksheets.Add
For Each objFile In objFolder.Files
rowCount = ws.UsedRange.Rows.Count
If (objFile.Type = "Microsoft Excel Worksheet" Or objFile.Type = "Microsoft
Excel Macro-Enabled Worksheet") Then 
   Set wb = Application.Workbooks.Open(path & objFile.Name) 
   Set srWS = wb.Sheets(1) 
   srWS.Range("A10:E50").Copy 
   ws.Activate 
   If rowCount = 1 Then 
      ws.Cells(1, 1).Value = objFile.Name 
      ws.Cells(rowCount + 1, 1).Select 
   Else 
      ws.Cells(rowCount + 1, 1).Value = objFile.Name 
      ws.Cells(rowCount + 2, 1).Select 
   End If 
   ActiveSheet.Paste 
   Application.DisplayAlerts = False 
   wb.Close 
End If
Next
Application.DisplayAlerts = True

Set objFolder = Nothing
Set objFile = Nothing
Set objFSO = Nothing
End Sub
Answer
try
Sub FindFiles()
Dim objFolder As String, objFile As String, r As Integer, c As Integer 'r=row,
c=column Dim ws As Worksheet
Set ws = Worksheets.Add
objFolder = "C:\Users\mo\Desktop\Test-Import\" objFile = Dir(objFolder)
r = 10: c = 1
While objFile <> vbNullString And c < 6
ws.Cells(r, c).Value = objFile
r = r + 1
If r = 51 Then 
      r = 10 
      c = c + 1 
End If
objFile = Dir
Wend
End Sub
notice this will list only number of files that fit into A10:E50 (200 files). If you
have more than 200 files, macro will not include them. You can remove
condition "And c < 6" if you'd like to see more, or edit "r" value to list files on
more rows
Topic 615

Subject
Using VBA in Excel to assign title to date ranges
Question
I've searched and not found any results that help me with this specific query.
I want to use VBA to create a new field in a spreadsheet that assigns a title
based on a date range.
I have a spreadsheet with dates from October 6 to yesterday, and I want to be
able to create a new column to indicate the sales cycle of each row in Excel.
What I can't figure out is how to set the code to check and assign dates between
sales cycles.
For reference, this is what I have right now, which works fine if there are only
two dates to work with:
Sub salescycle_date()
Dim msheet As Worksheet
Dim sc1 As Date
Dim sc2 As Date
Dim sc3 As Date
Set msheet = ActiveSheet
sc1 = "06/10/2015"
sc2 = "24/11/2015"
sc3 = "24/01/2016"
Range("AJ1").Select
ActiveCell = "sales_cycle"
For i = 6 To msheet.UsedRange.Rows.Count Select Case msheet.Cells(i, 33)
Case Is < sc2
msheet.Cells(i, 36) = "Sales Cycle 1" Case Is >= sc2
msheet.Cells(i, 36) = "Sales Cycle 2" End Select

Next
MsgBox "done!"
End Sub
Any tips on how to set the code so that it can recognize sales cycle 2 as being
in between the start of SC2 and SC3, and then have SC3 as a separate option?
Answer
Have you tried something like this:
Sub salescycle_date()
Dim msheet As Worksheet
Dim sc1 As Date
Dim sc2 As Date
Dim sc3 As Date
Set msheet = ActiveSheet
sc1 = "06/10/2015"
sc2 = "24/11/2015"
sc3 = "24/01/2016"
Range("B1").Select
ActiveCell = "sales_cycle"
For i = 2 To msheet.UsedRange.Rows.Count Select Case msheet.Cells(i, 1)
Case Is >= sc3
msheet.Cells(i, 2) = "Sales Cycle 3"
GoTo ExitSelect
Case Is >= sc2
msheet.Cells(i, 2) = "Sales Cycle 2"
Case Is < sc2
msheet.Cells(i, 2) = "Sales Cycle 1"
End Select
ExitSelect

Next MsgBox "done!"
End Sub
Here, I've reversed the conditions of select cases with an additional GoTo
statement.
Topic 616
Subject
Fetching data from a URL and saving it as a XML file using batch scripting or
excel
Question
I have a Jenkins URL that displays result using Jenkins REST API:
URL: http://localhost:8080/job/Build_2/lastBuild/api/xml
The data displayed is:
****This XML file does not appear to have any style information associated
with it. The document tree is shown below.
<freeStyleBuild>
<action>
<cause>
<shortDescription>Started by user Nishant Kansal</shortDescription>
<userId>admin</userId>
<userName>Nishant Kansal</userName>
</cause>
</action>
<building>false</building>
<displayName>#9</displayName>
<duration>1631</duration>
<estimatedDuration>1470</estimatedDuration> <fullDisplayName>Build_2
#9</fullDisplayName> <id>9</id>
<keepLog>false</keepLog>
<number>9</number>
<queueId>7</queueId>

<result>FAILURE</result>
<timestamp>1454666236907</timestamp>
<url>http://localhost:8080/job/Build_2/9/</url>; <builtOn/>
<changeSet/>
</freeStyleBuild>
My requirement: I want to save the data here as a XML file in my local, say
"BuildOutput.xml" for further parsing. I can use either batch scripting or excel
to fetch the data from the URL and save it as a XML. I tried with excel and data
is coming fine, however, in one single line. And, that is not serving my purpose
as I want data to be saved in "BuildOutput.xml" as shown above.
Could anyone please help me in resolving it?
Thanks
Answer
You can use wget in order to save the content in a file on disk:
wget -OBuildOutput.xml http://localhost:8080/job/Build_2/lastBuild/api/xml
-O is used to give a name to a file, otherwise wget uses the last part of the url
as the filename.
Topic 617
Subject
Can anybody tell the code to import only selected data(rows and columns)
from Excel to SQL through asp.net? [closed]
Question
Like here if I want to import from row 5 and column C
protected void Button1_Click(object sender, EventArgs e) {
String csvPath = Path.Combine( Server.MapPath("~/Files/") +
Path.GetFileName(FileUpload1.PostedFile.FileName));
FileUpload1.SaveAs(csvPath);
DataTable dt = new DataTable();

dt.Columns.AddRange( 
     new DataColumn[3]{ 
         new DataColumn("KPI", typeof(string)), 
          new DataColumn("KPIPN", typeof(string)), 
          new DataColumn("KPIPV", typeof(string)) 
          }); 
string csvData = File.ReadAllText(csvPath); Answer
You can use the LinqToExcel project
https://github.com/paulyoder/LinqToExcel
Topic 618
Subject
How to read formated cell display of datetime using python
Question
I have the excel cell with the format: [>=1] dd hh:mm:ss; hh:mm:ss
When python reads it, it just reads the cell value but not the cell display format.
I want to read the cell display format with which the excel configured.
Can anyone provide me a solution?
Topic 619
Subject
How to return the value of vlookup in same cell in which the value to be
looked up is entered?
Question
I want to return the result of vlookup in the same cell in which the value to be
looked up is entered. Figure 1 shows the value which is to be looked up
Figure 1
I want the value in A1 to change to vlookup value of t001 when I press enter as

shown in figure 2
Figure 2
the lookup table is present in sheet2 t001 trew
t002 rty
Following code i have written but it is not working kindly help me in this
regard
Sub Worksheet_Change(ByVal Target As Range) If Target.Count > 1 Then Exit
Sub
If Not Intersect(Target, Range("A1:A114")) Is Nothing Then
If WorksheetFunction.IsNumber(Target.Value) Then 
      Application.EnableEvents = False 
      Table2 = Sheet2.Range("C2:D3") 
      Target.Value =
Application.WorksheetFunction.VLookup(Target.Value, Table2, 2,
False) 
      Application.EnableEvents = True 
End If
End If
End Sub
Answer
By using
If WorksheetFunction.IsNumber(Target.Value) Then
End If
You are making sure that the interior of the 'if' clause will not be executed if the
target value is not a number. For example having Table2

abc ¦ not working
123 ¦ working
after typing 'abc' nothing happens and after typing 123 the number disappears
and 'working' appears
Topic 620
Subject
VBA to close excel file when Windows7 computer is locked
Question
I have an excel file on a shared drive used by 6/7 people, however only one
person can edit at a time. The frustration comes when one person opens the file
for editing then disappears for lunch for an hour, leaving the excel file open
and un-editable for other users.
Is it possible for VBA to listen for when a station is locked, and activate a
macro accordingly?
Sorry I am not posting any of my own attempts as I'm a bit of a fish out of water
with this level of VBA.
Any points that may help get me started would be really useful. Answer
You have a few options:
Kill the co-workers who do this
Have other users create a copy and save-as to then merge latter (quite hacky)
Or you try a timeout - so if the user selects nothing i 10 minutes the workbook
closes. Selecting lock would be a issue with security I think and windows
wouldnt let you have that kind of power.
So to timeout call a function every ten minutes to check if user has selected any
other cells in the worbook.

If difference("n", lastaction , Now) > 10 Then
ThisWorkbook.Close SaveChanges:=True End If
You can use NOW function in vba to find current date and time and the work
out difference with when an action was made to find the value of 'lastaction'.
To do this use:
Sub AnAction(ByVal Sh As Object, ByVal Target As Range)
lastaction = now
End Sub
Hopefully that answers your question.
Topic 621
Subject
SQL Server BCP Utility
Question
My question is regarding sql server bcp utility:
How do I export data from sql server into excel sheet with the following
extensions e.g. xls,xlsx, and xlsb using bcp tool, because I can export to .csv
file and .txt file extensions but with excel it can not be open after exporting
with bcp.
Any worker around to export into excel sheet will do help alot.
Thanks for your help in advance
Answer
First of all there BCP don't support xls or xlsx formats. BCP only support
xml,txt and csv;
If you have to import data from excel you have .net or java or Php to create a
data table with the same excel. Then use that datatable to create corresponding
table in Sql

if you are using sql and C# then this might help you
string con =
@"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=D:\temp\test.xls;" +
@"Extended Properties='Excel 8.0;HDR=Yes;'"; using(OleDbConnection
connection = new OleDbConnection(con)) {
connection.Open();
OleDbCommand command = new OleDbCommand("select * from [Sheet1$]",
connection); using(OleDbDataReader dr = command.ExecuteReader()) { 
       while(dr.Read()) 
       { 
           var row1Col0 = dr[0]; 
           Console.WriteLine(row1Col0); 
       } 
}
}
or
private void GetExcel() 
      { 
          string fullPathToExcel = "<Path to Excel file>";
//ie C:\Temp\YourExcel.xls 
          string connString =
string.Format("Provider=Microsoft.ACE.OLEDB.12.0;Data Source=
{0};Extended Properties='Excel 12.0;HDR=yes'",
fullPathToExcel); 
          DataTable dt =
Function_Library.DatabaseFunctions.GetDataTable("SELECT * from
[SheetName$]", connString); 
      } 
Topic 622
Subject
How can I find range between two varying values and populate the range in the

previous column?
Question
I want code to find the range between top row and the bottom row, then
populate the previous column with 'aed'
visual description
here's my code so far
Cells.Find(What:="currency code : aed", After:=ActiveCell, LookIn:= _
xlFormulas, LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:= _
xlNext, MatchCase:=False, SearchFormat:=False).Activate
Cells.FindNext(After:=ActiveCell).Activate
that's as far as I have gone
Topic 623
Subject
how to make a for Loop in an array in vba
Question
I have been try this over and over again but got the same output. I would like to
make a loop in an array of strings but the code only visits the first value. This
is my code I've tried:
name = Environ("username")
user1= Array("name.name1", "name.name2") user2= Array("name1.name1",
"name1.name2")
For i = 0 To Size ' I used Size coz I will add more names
If name = user1(i) Then
MsgBox "User1"
ElseIf name = user2(i) Then
MsgBox "User2"
Else

errorLog
End If
Next
Thank you in advance for your help!
Answer
Unless you've provided an explicit declaration and starting value for Size,
when it's used in a for loop, it will assume a variant numeric type with a value
0.
So you get For i = 0 To 0: i.e. the loop will iterate once.
Writing Option Explicit at the top of your module helps reduce bugs like this.
If you want to get the size of an array, use LBound and UBound.
Answer
This is what I've done to solve my problem.
name = Environ("username")
Dim found as Boolean
found = false
user1= Array("name.name1", "name.name2") user2= Array("name1.name1",
"name1.name2")
'to check for user2
For i = 0 To UBound(user1)
If name = user1(i) Then 
      MsgBox "User1" 
      found = true 
End If
Next
'to check for user2

For i = 0 To UBound(user2)
If name = user2(i) Then 
      MsgBox "User2" 
      found = true 
End If
Next
'Else if the username is not on the list, I have added a Boolean found. if found
= false then
MsgBox "Unidentified Access!"
end If
Thank you so much for all your guidance!
Topic 624
Subject
VBA Auto Key In Data
Question
I have 2 main sheets at play here:
S1 &
S2
S1 is a supply allocation form that has loads of past records and has a date cell
which I can change. S2 is basically just where i would manually copy and
paste my allocation of supply into. It is a long page filled with dates at the top
which I have to manually check for in order to paste the supply allocation at
the right date slot.
How can I have it so that the VBA checks for the date I set at S1 on a row of
dates in S2. Then, copy and pasted my column of order(from S1) one cell
below the date matched in S2?
Topic 625

Subject
Fastest way to append to an existing excel file through visual studio
Question
I am very new to visual studio (currently using Visual Studio 2013) and I am
trying to append strings from my list to an existing excel file. Example item in
list = "item1,item2,item3,item4" I am trying to append each item to each cell
starting from the last row of the excel file. The below code works but it is
taking too much time on a lower spec pc, Any idea on how to make it faster?
Or are there any better way to append from my list? I am not familiar at all
dealing with excel.application object
Here are my codes: 
              Dim excelApp As New Excel.Application 
              Dim excelWB As Excel.Workbook 
              Dim excelWS As Excel.Worksheet 
              excelWB = excelApp.Workbooks.Open(filename) 
              excelWS = excelWB.Worksheets("Data") 
              Dim lastrow =
excelWS.Range("A1").SpecialCells(Excel.XlCellType.xlCellTypeLas
              'adding data from list2 to excel file 
              For l_index As Integer = 0 To
Global_Variable.list2.Count - 1 
                  lastrow += 1 
                  Dim splitter =
Global_Variable.list2.Item(l_index).Split(",") 
                  excelWS.Cells((lastrow), (1)).Value =
splitter(0) 
                  excelWS.Cells((lastrow), (2)).Value =
splitter(1) 
                  excelWS.Cells((lastrow), (3)).Value =
splitter(2) 
                  excelWS.Cells((lastrow), (4)).Value =
splitter(3) 
                  excelWS.Cells((lastrow), (5)).Value =
splitter(4) 
                  excelWS.Cells((lastrow), (6)).Value =
splitter(5) 
                  excelWS.Cells((lastrow), (7)).Value =
splitter(6) 
                  excelWS.Cells((lastrow), (8)).Value =
splitter(7) 

                  excelWS.Cells((lastrow), (9)).Value =
splitter(8) 
                  excelWS.Cells((lastrow), (10)).Value =
splitter(9) 
                  excelWS.Cells((lastrow), (11)).Value =
splitter(10) 
              Next 
              Dim Outputname =
System.IO.Path.GetDirectoryName(filename) + "\RESULT_" +
System.IO.Path.GetFileName(filename) 
              System.IO.File.Delete(Outputname) 
              excelWB.SaveAs(Outputname) 
              excelWB.Close(, Outputname) 
              excelApp.Quit() 
Answer
If you convert list2 to a 2 dimensional array before opening Excel (or better
yet just create it that way in the first place), you can simply define a Range
variable that has the same dimensions & the correct location (`"A" & lastrow')
and then set the range's value to the arr.
Ex. With list2 as an array variable that contains 100 items with your 11
attributes (BTW you say VS2013, but you don't say if you're using C#/VB/etc.
Based on the use of DIM I assumed VB)
Dim rng as Microsoft.Office.Interop.Excel.Range = Nothing
'Set the range
rng = excelWS.Range("A" & lastrow & ":K" & lastrow + list2.GetLength(0))
'Fill the range with the array
rng.Value = list2
Short, sweet and generally runs fairly quick
Topic 626
Subject
Excel VBA to SQL Database
Question

I've just started looking into interacting with an SQL database via Excel VBA,
and I started off with the basic connection code from MSDN:
Sub GetDataFromADO()
'Declare variables'
Set objMyConn = New ADODB.Connection Set objMyRecordset = New
ADODB.Recordset Dim strSQL As String
'Open Connection'
objMyConn.ConnectionString = "Provider=SQLOLEDB;Data
Source=localhost;Initial Catalog=fatcoin;User ID=root;Password=root;"
objMyConn.Open
'Set and Excecute SQL Command'
strSQL = "select * from productlist"
'Open Recordset'
Set objMyRecordset.ActiveConnection = objMyConn objMyRecordset.Open
strSQL
'Copy Data to Excel'
ActiveSheet.Range("A1").CopyFromRecordset (objMyRecordset) End Sub
The issue I'm having is while I have an SQL instance running on my machine,
on port 3306, which I can access using for example, HeidiSQL, every time I
run this code I get an error message:
[DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or
access denied
I have also tried adding a port:
objMyConn.ConnectionString = "Provider=SQLOLEDB;Data
Source=localhost,3306;Initial Catalog=fatcoin;User ID=root;Password=root;"

And other such things. I can't see any reason it shouldn't work, but I haven't
played with this much at all. I've tried searching through other threads to no
avail.
Any ideas?
I am working with Excel 2010, on a 64-bit Machine, using MySQL 5.7 I should
mention the above coding is being inputted into the "Module1" section of the
VBAProject on Excel. Thanks
Answer
Thanks for the answers.
I solved my own question via a helpful link I found that suggested I go into
ODBC 32-bit (because Excel is 32-bit) and create a System DSN. Then, I used
the connections string below:
objMyConn.ConnectionString = "Provider=MSDASQL.1;Persist Security
Info=False;User ID=root;Data Source=localhost;Initial Catalog=fatcoin"
It worked a treat.
Topic 627
Subject
Microsoft.ACE.OLEDB.12.0' provider is not registered on the local machine.
for excel upload
Question
I have Microsoft office 2007 and I installed AccessDataBaseEngine 2010 and
also AccessDataBaseEngine 2007 data connectivty, but i can't able upload
excel files to my web application. My Application throws an error message as
The 'Microsoft.ACE.OLEDB.12.0' provider is not registered on the local
machine.
Topic 628
Subject
C# not finding space in string copied from Excel
Question
Help! I have a list of records in Excel that I'm copying/pasting into an

ASP.NET web page. From there, the C# code parses the records.
This code below works for one of the names, but not another. If, however, I
copy/replace the empty space in Excel with a typed space or if I actually
backspace and type the name into the webpage with the keyboard, it does
work.
It's as if Excel has some odd ghost character in the file I was given for the
space on this record. I've pasted in Notepad++ and showed all characters, and
I don't see anything special here that's different among the records.
This one works and detects the spaces: Carolyn Bentivegna This one does not:
Allan D. Blake
if (fullName.IndexOf(" ") > -1)
Answer
Try the tabspace:
if (fullName.IndexOf("\t") > -1)
Cells copied via excel are separated by a TabSpace and Rows are separated
via newlines and carriage return.
Topic 629
Subject
How to highlight (cells from other sheet) while editing formula?
Question
I was searching regarding highlighting cells from other sheet (in edit mode) but
could not find any solution to it. When a cell is selected and in edit mode, the
cells used in the formula gets highlighted if they are from same sheet. For
example (see following image) cell K6 is selected from sheet "data" and cells
used in the formula are highlighted with red, blue and purple color rectangles.
But when formula contains the cell from other sheet it will not be highlighted.
For example (see following image) cell D5 from sheet"Chart" is selected. The
cell uses X6 cell from sheet "data" but it is not highlighted when we are editing

formula in cell D5 from sheet "Chart". It will be very helpful to debug the
sheets if it was possible to highlight cells from other sheet while editing the
formulas in cell. Is there any way to do this? Answer
You can use Spreadsheet Inquire in excel-2013 and excel-2016.
It can go beyond the direct dependents and precedents of that cell, and show
the cells that underpin the direct cells etc.
Answer
A work around:
1. click the cell with the formula you want to trace
2. go to the Formulas menu (in the top menu)
3. click on "Trace Dependents" under "Formula Auditing"
4. you will see blue arrows from referenced cells in the same sheet, and a
black dashed arrow to a little drawing representing other sheets
5. double click the dashed line, the "Go to" window pops up
6. select a reference in the list
7. click OK, it will take you to the referenced cell in the other sheet
Topic 630
Subject
Formatting Cells in VBA Excel like magic
Question
To begin with, I have two cells named A1 and B1.It is well documented that
Excel uses four types of format code sections and that you can apply
conditional formats to create custom number formats, as in the example:
#.###,55; #.###,44; 0; "hello"@
#.###,55 = Format for positive numbers #.###,44 = Format for negative
numbers 0 = Format for zeros "hello"@ = Format for text If you format A1 and
B1 as of #.###,55; #.###,44; [X]; "hello"@ and assign A1 and B1 as zeros,
cells A1 and B1 will visually be equal to [X] and Excel is going to interpret
them as 0, so that A1+B1 = 0. [QUESTION] However, I want Excel to
interpret the symbol [X] as a number and it must interpret that as the value of 1.

By doing so, A1+B1 would give me the total value of 2 and, not, the message
"#value!".
How to achieve that in VBA? Thank you very much in advance.
Topic 631
Subject
How to write words to excel file (rows and columns) and in unicode
characters?Using Java Program
Question
My program is to find the repeated words from a text file and displaying the
repeated words count from max to min order.And to save it in a workbook.
"ஶழந்ைத 6
அவ௬ைடய 4"
These are my sample present output from a file.I saved them as .xls format. The
Problem is when I open these in excel It doesn't recognize unicode
format,When I open through excel(changing UTF8)in the options it does.I need
to open and display directly unicode format.
BufferedWriter writer = Files .newBufferedWriter(Paths.get(fileNameOutput),
StandardCharsets.UTF_8))
I used UTF8 still it doesn't change into unicode format.
And I need to include Serial no words count as column heading
serial no word count
1 ஶழந்ைத 6
2 அவ௬ைடய 4
Like this I needed
Here is my full code

import java.io.*;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets; import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.StringTokenizer;
import java.util.Map.Entry;
public class maxoccurrence2 {
final static Charset ENCODING = StandardCharsets.UTF_8; public
Map<String, Integer> getWordCount(String fileName) { FileInputStream fis =
null;
DataInputStream dis = null;
BufferedReader br = null;
Map<String, Integer> wordMap = new HashMap<String, Integer>(); try {
fis = new FileInputStream(fileName);
dis = new DataInputStream(fis);
br = new BufferedReader(new InputStreamReader(dis)); String line = null;
while ((line = br.readLine()) != null) { StringTokenizer st = new
StringTokenizer(line, " "); while (st.hasMoreTokens()) {
String tmp = st.nextToken().toLowerCase(); if (wordMap.containsKey(tmp)) {
wordMap.put(tmp, wordMap.get(tmp) + 1); } else {
wordMap.put(tmp, 1);
}
}
}
} catch (FileNotFoundException e) {
e.printStackTrace();
} catch (IOException e) {
e.printStackTrace();
} finally {
try {

if (br != null) br.close();
} catch (Exception ex) {
}
}
return wordMap;
}
public List<Entry<String, Integer>> sortByValue(Map<String, Integer>
wordMap) { Set<Entry<String, Integer>> set = wordMap.entrySet();
List<Entry<String, Integer>> list = new ArrayList<Entry<String, Integer>>
(set); Collections.sort(list, new Comparator<Map.Entry<String, Integer>>() {
public int compare(Map.Entry<String, Integer> o1, Map.Entry<String, Integer>
o2) { return (o2.getValue()).compareTo(o1.getValue()); }
});
return list;
}
public static void main(String a[]) throws IOException { String path =
"D:\\Projectpath\\";
String fileNameIn;
File folder = new File(path);
File[] listOfFiles = folder.listFiles();
for (int i = 0; i < listOfFiles.length; i++) {
if (listOfFiles[i].isFile()) {
fileNameIn = path + listOfFiles[i].getName();
maxoccurrence2 mdc = new maxoccurrence2(); Map<String, Integer>
wordMap = mdc.getWordCount(fileNameIn);
List<Entry<String, Integer>> list = mdc.sortByValue(wordMap); String
fileNameOutput = path + "\\Projectoutput\\"+listOfFiles[i].getName()
.substring(0, listOfFiles[i].getName().length() - 4) + "output.xls"; try
(BufferedWriter writer = Files
.newBufferedWriter(Paths.get(fileNameOutput), StandardCharsets.UTF_8)) {
for (Map.Entry<String, Integer> entry : list) {
writer.write(entry.getKey() + " " + entry.getValue()); writer.newLine();

}
}
}
} }
}
Topic 632
Subject
Macro to rearrange data
Question
In the picture ( http://i.stack.imgur.com/bVuc3.png ) I am given data as seen in
columns A-C and need to pull specified portions and display them as seen in
columns E and F. In this example the Fund ABC's values from the various
Investments listed in columns E and F.
Can someone help me with a macro that would (1) prompt user for Fund of
interest
(2) pull values of given Fund from the various Investments and line them up
next to the name of the investment as seen in columns E and F.
I have posted this in other forums but no response yet. Ozgrid
http://www.ozgrid.com/forum/showthread.php?t=198481
Steve
Answer
INdex/Match should work wonders for you. It's easier than a macro and can be
done in sheet
{=INDEX('range where the return value is', MATCH('value needing found',
'range where to look',0))}
Remember to enter it with control+shift+enter
Topic 633
Subject
Python xlsxwriter: Changing individual cell highlight colour

Question
I am writing code in Python using the xlsxwriter module. My problem is
somewhat like other questions here, but with a small twist. I am wanting to
change the highlight colour of SPECIFIC INDIVIDUAL cells in Excel. Some
cells will already have data entered into them, and I wish to keep that data.
The following is my approach so far:
## Highlights appropriate cells
row = 0
col = 0
blue_fmt = workbook.add_format()
blue_fmt.set_pattern(1)
blue_fmt.set_bg_color('#0000FF')
yellow_fmt = workbook.add_format()
yellow_fmt.set_pattern(1)
yellow_fmt.set_bg_color('#FFFF00')
black_fmt = workbook.add_format()
black_fmt.set_pattern(1)
black_fmt.set_bg_color('#000000')
I am lost as to how I can instruct my program to highlight specific cells without
removing its contents. At the moment, I am thinking some form of iteration
would do the trick, but I am worried about losing data already entered into
certain cells.
Before
enter image description here
After
enter image description here
Any help or hints are much appreciated.
Thanks in advance.
Answer

how can I instruct my program to highlight specific cells without removing its
contents.
You can't* write formatting and data separately in XlsxWriter. You will need to
write the cell format to the cell when you write the data.
(*) It is possible to add conditional formatting to a range of cells after you
have written them.
Topic 634
Subject
Excel vba: Auto run the routines
Question
I have various routines in two different modules. Some clears the report, some
populates it, fill the blank spaces with zeroes. I am currently running them
using F5. But I want when the user opens the sheet, he gets all populated data
without having to run that particular sub routine. Is it possible to run the
routines in various modules automatically when the excel is opened? Answer
This is pretty easy. Instead of putting code in the module, you will put it in
ThisWorkbook and use the Workbook_Open event. You don't necessarily have
to move your code. You can just call the existing macros.
Topic 635
Subject
Import date from excel file to database using php
Question
Please there're an esay way to Import date from excel file to database using
php ?
I have made it by excel_reader2
but the last char don't load and I get problem with arabic language
This is my code
<?php

require_once 'excel_reader2.php';
$data = new Spreadsheet_Excel_Reader($url); $page_sheet = 1;
if(count($data->sheets[$page_sheet][cells])>0) // checking sheet not empty {
$rows = count($data->sheets[$page_sheet][cells]);
for($j=5;$j<=count($data->sheets[$page_sheet][cells]);$j++) // loop used to
get each row of the sheet { 
      $data->sheets[$page_sheet][cells][$j][1]; 
      $rowid = $data->sheets[$page_sheet][cells][$j][1]; 
      $phone = $data->sheets[$page_sheet][cells][$j][2]; 
      $season = $data->sheets[$page_sheet][cells][$j][3]; 
      $row = $data->sheets[$page_sheet][cells][$j][4]; 
      $name = $data->sheets[$page_sheet][cells][$j][5]; 
     echo "$name<br />"; 
}
}
Sorry for my bad english please
Topic 636
Subject
Unable to do autocomplete in Excel
Question
There are data:
AutoFill need it with this order. I change cell format to:
then made autocomplete, but the result is the number of filled not by 7 units,
and 9 or 10 pieces:
how to make autocomplete in order to each number were 7 pieces? Answer
Try the following in the top cell,
'EN-US

=INT((ROW(1:1)-1)/ 7)+1
'RU-RU
=ЦЕЛОЕ((СТРОКА(1:1)-1)/ 7)+1
Fill down as necessary.
Answer
Just use the formulas:
+--------+
| 1 |
| =A1 |
| =A2 |
| =A3 |
| =A4 |
| =A5 |
| =A6 |
| =A7+1 |
| =A8 |
| =A9 |
| =A10 |
| =A11 |
| =A12 |
| =A13 |
| =A14+1 |
| =A15 |
| =A16 |
| =A17 |
| =A18 |
| =A19 |
| =A20 |
| =A21+1 |
| =A22 |
| =A23 |
| =A24 |
| =A25 |
| =A26 |

| =A27 |
| =A28+1 |
| =A29 |
| =A30 |
| =A31 |
| =A32 |
| =A33 |
| =A34 |
| =A35+1 |
| =A36 |
| =A37 |
| =A38 |
| =A39 |
| =A40 |
| =A41 |
+--------+
Beginning in cell A1, where you put a 1, in A2 just =A1 to take the value of the
above cell, to A7, and in A8 you put =A7+1. This way you get seven 1's, seven
2's and so on.
Topic 637
Subject
How can we verify whether an excel file is checked in server or not using vb
macros?
Question
How can we verify whether an excel file is checked in server or not using vb
macros?
I am trying to trigger an event After CheckIn.Could anyone please help me.
Topic 638
Subject
Number of booked rooms on a particular date
Question
I store details of all the customers and their checkin and checkout date in an

Excel sheet. I want the list of customers staying in the hotel on a particular date
in a separate sheet.
Example -- Sheet 1 has below Data
Sr.No | Customer Name | Check in | Check out
1 -- kamal -- 2/23/2016 -- 2/25/2015
2 -- abhishek -- 2/26/2016 -- 2/28/2016
3 -- nitn -- 2/24/2016 -- 3/01/2016
4 -- aman -- 3/01/2016 -- 3/03/2016
5 -- vivek -- 3/05/2016 -- 3/06/2016
6 -- harsh -- 3/08/2016 -- 3/09/2016
I want to enter any date in sheet 2 like '2/24/2016' and based on the entries in
sheet 1 I should get the list/details of customers who are staying in hotel on
'2/24/2016'. Based on the above example the output should be:
Sr.No -- Customer Name -- Check in -- Check out
1 -- kamal -- 2/23/2016 -- 2/25/2015
2 -- nitn -- 2/24/2016 -- 3/01/2016
as Kamal checked in on '2/23/2016' and staying till '2/25/2016' and nitn
checked in on 2/24/2016. Answer
I shown in same sheet, you can easily deploy in sheet2. Use this array formula,
=IFERROR(INDEX($A$3:$D$13,SMALL(IF($C$3:$C$13<=$H$1,IF($D$3:$
ROW($C$2))),ROWS($C$3:$C3)),COLUMNS($A$3:A$3)),"")
Press CTRL+SHIFT+ENTER to evaluate the formula.

Drag and drop Down and Right.
Topic 639
Subject
Can anyone speed up this code
Question
This code 8 cells from a data entry form and copies those cells to the next
empty row on another worksheet that is used as a database. It works perfectly
except that it takes 15 seconds to run. I know that I can speed up the code if it
didn't copy to another sheet. It that scenario it think that I timed it at <7
seconds. Is there a way to significantly speed up this code without merging the
two sheets which, at this point is a logistical nightmare?
sub UpdateLogWorksheet1()
Application.ScreenUpdating = False
Application.EnableEvents = False
Dim historyWks As Worksheet
Dim inputWks As Worksheet
Dim nextRow As Long
Dim oCol As Long
Dim myRng As Range
Dim myCopy As String
Dim myclear As String
Dim myCell As Range
ActiveSheet.Unprotect "sallygary"
myCopy = "e4,g26,g16,g12,g18,g20,g22,g24" Set inputWks =
Worksheets("Dept 1 Input") Set historyWks = Worksheets("1_Data")
With historyWks
nextRow = .Cells(.Rows.Count, "A").End(xlUp).Offset(1, 0).Row End With
With inputWks

Set myRng = .Range(myCopy)
End With
With historyWks
With .Cells(nextRow, "A") 
      .Value = Now() 
      .NumberFormat = "mm/dd/yyyy" 
End With
.Cells(nextRow, "B").Value = Application.UserName oCol = 3
For Each myCell In myRng.Cells 
      historyWks.Cells(nextRow, oCol).Value = myCell.Value 
      oCol = oCol + 1 
Next myCell
End With
With inputWks
On Error Resume Next
End With
On Error GoTo 0
ActiveSheet.Protect "sallygary"
Range("g12").Select
Application.ScreenUpdating = True
Application.EnableEvents = True
End Sub
Answer
Don't copy cell by cell. Copy Entire tables with one operation. For example to
copy a 100×3 table
Sheet2.Range("A2").Resize(100,3).Value2 =

Sheet1.Range("G2").Resize(100,3).Value2
Topic 640
Subject
Convert files of .ddf Format to other formats in c#
Question
I've got some .ddf format files from a webservice.
I found multiple softwares to open and read the files manually , but Is there any
way I can Convert files of .ddf Format to some other formats like ".csv" or
".xls" ( using c#? )
Can anyone give some advices? Thanks.
Topic 641
Subject
Loop through a list of word documents and export a table in each document
into worksheets 3,4,and 5 in my master workbook.
Question
I have a master workbook with 5 worksheets. My goal is look into a folder that
has 3 word documents and open them one at a time. Once the first word
document is open I want to copy Table(2) in the word document and paste it
into Worksheet 3 in my master workbook. Once that is done I want to grab the
second word document and copy Table(2) in that document and paste into
Worksheet 4. Lastly, I want to get the third word document and copy Table(2)
and paste into worksheet 5.
I wrote code that has several loops, however, it opens the first word document
and paste Table(2) into worksheet 3 and then just keeps looping through the
same word document.
Sub ImportWordTable()
Dim FileName As Variant
Dim FolderPath As String
Dim wdApp As Object

Dim wdDoc As Word.Document
FolderPath = "C:\Users\Excel Practice\" FileName = Dir(FolderPath &
".xml")
Set wdApp = CreateObject("Word.Application") wdApp.Visible = True
Do While FileName <> ""
Set wdDoc = wdApp.Documents.Open(FolderPath & FileName)
wdDoc.Activate
With wdDoc
Set wrdTbl = .Tables(2)
ColCount = wrdTbl.Columns.Count
RowCount = wrdTbl.Rows.Count 
     For c = 3 To 5 
          For i = 1 To RowCount 
              For j = 1 To ColCount 
                  Worksheets("c").Cells(i, j) =
wrdTbl.Cell(i, j).Range.Text 
              Next j 
          Next i 
      Next c 
End With
wdDoc.Close Savechanges:=False
Loop
End Sub
Answer
It looks like you only open the file at the start of your code. You then loop
through all 3 worksheets with a for loop from c=3 to 5. This will call the

Documents.Open() function only once and copy that data to all 3 worksheets.
Instead, do as @Siva suggested and iterate through the files with a foreach
loop. This should do the trick.
Dim FSO As Object
Dim fldr As Object
Dim file As Object
Dim wdApp As Object
Dim wdDoc As Word.Document
Sub getTables()
Set wdApp = CreateObject("Word.Application") wdApp.Visible = True
Set FSO = CreateObject("Scripting.FileSystemObject") Set fldr =
FSO.GetFolder("C:\Users\Excel Practice\") sheetIndex = 3 'index of the 3rd
worksheet in your workbook For Each file In fldr.Files 
      If file.Type = "Microsoft Word Document" Then 
          Set ws = ThisWorkbook.Sheets(sheetIndex) ' set
active worksheet 
          Set wdDoc = wdApp.Documents.Open(file.Path) 'open
word document 
          Set wrdTbl = wdDoc.Tables(2) 
          ColCount = wrdTbl.Columns.Count 
          RowCount = wrdTbl.Rows.Count 
          For i = 1 To RowCount 
              For j = 1 To ColCount 
                  ws.Cells(i, j) = wrdTbl.Cell(i,
j).Range.Text 
              Next j 
          Next i 
          sheetIndex = sheetIndex + 1 ' increment worksheet
index 
      End If 
Next file
End Sub
Topic 642
Subject
How do I add control objects on a userform to a collection, and then loop
through the collection and access their properties?

Question
I have the following code in a UserForm. I'm attempting to add a certain subset
of the comboboxes on the form to a collection, and then loop through that
collection. It seems to be adding the value of the combobox to the collection
rather than the control object itself...? What identifier or property do I need to
use to be able to access the .Text property of the combobox object after it is
added to the collection?
'Put comboboxes in a collection
Dim oColl As Collection
Set oColl = New Collection
Dim cb As Control
For Each cb In Me.Controls
If TypeName(cb) = "ComboBox" Then 
      ' I suspect it may be this line going wrong: 
      If IsNumeric(cb.Text) Then oColl.Add (cb) 
End If
Next
' Trying to loop through the collection of comboboxes ' I've tried to declare ctrl
as MSForms.ComboBox, ComboBox, Control, Object, ' and Variant, results
are the same...
Dim ctrl As MSForms.ComboBox
Dim i As Integer
For i = 1 To oColl.count
For Each ctrl In oColl 
      ' This line produces an object required error on ctrl 
      If CInt(ctrl.Text) = line Then 
Answer
You're so close. It's just some syntax errors, i.e. collection.add with the
brackets behind it.

Example: Loops through all comboboxes on userform, stores the ones that have
a number in them in a collection. Loops through collection and displays
message for each combobox.text. Fires upon CommandButton1 click event.
Code goes in the userform itself, since we reference me.controls
Private Sub CommandButton1_Click()
Dim oColl As Collection
Set oColl = New Collection
Dim cb As Control
For Each cb In Me.Controls 
   If TypeName(cb) = "ComboBox" Then 
       If IsNumeric(cb.Text) Then oColl.Add cb 'Indeed here
you had unneeded brackets. Alternative would be "Call
oColl.Add(cb)" 
   End If 
Next cb
For Each cb In oColl
MsgBox cb.Text
Next cb
End Sub
Edit: You can just declare a variable ComboBox, but when you loop through
all controls (For Each Control in Me.Controls) you will get a type mismatch
error.
Topic 643
Subject
Any way to improve the speed of this VBA loop to insert data into SQL?
Question
I have a VBA loop that inserts around 120,000 rows into a SQL table.
I have read that using a loop for large datasets is quite time consuming (which

I've found, this takes over 10 minutes to complete)
If someone could suggest something to me to maybe bulk insert this data as a
range or something?
Thanks guys!
Sub export_to_sql()
Dim conn As New ADODB.Connection
Dim RowNo As Long
Dim C1, C2, C3, C4 As String
Dim wbk As Workbook
Dim strFile As Variant
Dim shtname As String
ChDir "xxx"
strFile = Application.GetOpenFilename
If strFile = False Then
Exit Sub
Else: End If
' *** Open workbook first ***
Set wbk = Workbooks.Open(strFile)
shtname = ActiveWorkbook.Worksheets(1).Name lastrow =
wbk.Sheets(1).Cells(Rows.Count, "A").End(xlUp).Row + 1 With
Sheets(shtname)
'Open a connection to SQL Server
conn.Open "Provider=SQLOLEDB;Data Source=SERVER\SQL2008R2;Initial
Catalog=xxxxx;User ID=xx; Password=xxxxxxxx; "
' Delete table data
conn.Execute "DELETE FROM EcommerceTablename"
'Skip the header row
RowNo = 2
'Loop until empty cell in Col 1

Do Until .Cells(RowNo, 1) = "" 
      C1 = .Cells(RowNo, 1) 
      C2 = .Cells(RowNo, 2) 
      C3 = .Cells(RowNo, 3) 
      C4 = .Cells(RowNo, 4) 
      'Generate and execute sql statement to import the excel
rows to SQL Server table 
      conn.Execute "insert into EcommerceTablename
([Col_1_C], [Col_2_C], [Col_3_C], [Col_4_C]) values ('" & C1 &
"', '" & C2 & "', '" & C3 & "', '" & C4 & "')" 
      RowNo = RowNo + 1 
Loop
conn.Close
Set conn = Nothing
End With
End Sub
Answer
The cost part is the roundtrip on the connection, so try to send multiple insert
on each execute
create a counter variable i so you insert 10 row each time
Do Until .Cells(RowNo, 1) = ""
i = i+1;
save the command in a string, separate each instruction with semicolon ;
strSQL = strSQL + "insert into EcommerceTablename ([Col_1_C], [Col_2_C],
[Col_3_C], [Col_4_C]) values ('" & C1 & "', '" & C2 & "', '" & C3 & "', '" &
C4 & "');"

execute 10 insert each time.
if i mod 10 = 0 then
conn.Execute strSQL
after loop end insert the remaining rows.
loop
conn.Execute strSQL
Answer
If you really want speed, you should consider using the bulk copy utility, bcp.
Have your VBA generate output to a file and then have bcp slurp the file into
the database.
My syntax might be a bit off on the BCP, but I think with a little tweaking you
can get it exactly the way you want:
Dim outputArray(4) As String
Dim col As Integer
Set wbk = Workbooks.Open(strFile)
Open "c:\Temp\UploadData.dat" For Output As #1
With wbk.Sheets(1)
lastrow = .Cells(Rows.Count, "A").End(xlUp).Row + 1 RowNo = 2
Do Until .Cells(RowNo, 1) = "" 
    For col = 1 To 4 
      outputArray(col) = .Cells(RowNo, col) 
    Next col 
    Print #1, Join(outputArray, "|") 
    RowNo = RowNo + 1 

Loop
conn.Open "<your connection string>" conn.Execute "DELETE FROM
EcommerceTablename" conn.Close
Set conn = Nothing
End With
Close #1
System ("bcp EcommerceTablename in c:\Temp\UploadData.dat -S
SERVER\SQL2008R2 " & _
"-c -t""|"" -U xx -P xxxxxxxxxx")
Again, you may want to look these up to verify, but the basic syntax is:
bcp <table> <in/out (upload/download> <file> <options>
The options I listed, to the best of my knowledge are:
-S server
-U Userid
-P Password
-c character input (-n[ative] is useful for making backups) -t delimiter
Also, provided you have permissions on the table to do so, truncate is
significantly faster than delete from if all you really want to do is wipe and
reload the table. If you don't have permissions, see if your DBA will give you
access to a stored procedure that will do the truncate.
As a final alternative, I'd recommend the use of a transaction and bind
variables. Both of these will enable you to significantly improve the speed of
your inserts through normal ADO commands (without bcp). I think if you test
bcp, you probably won't want to do anything else.
Topic 644
Subject
MSXML2.XMLHTTP responsetext doesn't match http at the URL (Excel VBA)

Question
I am trying to write some brute force code to get shipping status from FedEx
using VBA. The example url is: https://www.fedex.com/apps/fedextrack/?
action=track&tracknumbers=852426136339213
Using VBA I pulled in the page as a string using:
Sub Test()
strurl = "https://www.fedex.com/apps/fedextrack/?
action=track&tracknumbers=852426136339213"
Set xmlhttp1 = CreateObject("MSXML2.XMLHTTP") xmlhttp1.Open "GET",
strurl, False
xmlhttp1.Send
'Wait for request to finish
Do While xmlhttp1.readyState <> 4
DoEvents
Loop
a = xmlhttp1.responsetext
'Just so I can see the result
Set FSO = CreateObject("Scripting.FileSystemObject") Set oFile =
FSO.CreateTextFile("C:\DeleteMe.txt")
oFile.Write a
oFile.Close
Set xmlhttp1 = Nothing
End Sub
When I scroll through the HTML when I pull this link up in a browser I can
locate the tracking number and status, however this doesn't exist in the
xmlhttp1.responsetext.

Why isn't it pulling through and does anyone know how to get this?
Thanks in advance.
Topic 645
Subject
C# html decode before export to excel
Question
I have a problem with some text going around my app, thing is after user add a
text with formatting, I save that type of formatting (HTML) in my database, for
later use. So once i show it back to the user I can still keep the format
Example of text :
bla<br>bla<br>bla bla<br>
And for showing on my controls, that works, I am using:
Context.Server.HtmlDecode(e.Row.Cells[i].Text);
Context.Server.HtmlEncode(e.Row.Cells[i].Text);
But problem shows up, when I want that same text to export to Excel file ...
foreach (DataRow row in dr)
{
for (col = 0; col < dtMainSQLData.Columns.Count; col++) {
rowData[rowCnt, col] = HttpUtility.HtmlEncode(row[col].ToString()); }
rowCnt++;
}
oSheet.get_Range("A2", lastColumn + (rowCnt + 1).ToString()).Value2 =
rowData;
And once I open excel file ... that text shows up like this
bla&lt;br&gt;bla&lt;br&gt;bla bla&lt;br&gt;

Does anyone know some way to export this text to excel file, but to keep
formatting of text?
Thank you
Answer
It's probably not the best solution, but you could replace the string text:
foreach (DataRow row in dr)
{
for (col = 0; col < dtMainSQLData.Columns.Count; col++) { 
    string outputData = row[col].ToString().Replace("&lt;", "
<"); 
    outputData = outputData.Replace("&gt;", ">"); 
    rowData[rowCnt, col] = outputData; 
}
rowCnt++;
}
Answer
Install HTML Agility Pack.
Then you can create a method like this to get the text value.
HtmlDocument doc = new HtmlDocument();
doc.LoadHtml("bla<br>bla<br>bla bla<br>"); var buffer = new
StringBuilder();
foreach (var descendant in doc.DocumentNode.Descendants()) {
buffer.Append(descendant.InnerHtml); }
Console.WriteLine(buffer);
Topic 646
Subject
Search in a column for multiple unique values from a list in excel and copy the

matching rows
Question
Using a macro in excel I would like to search through a table of data for a
searchterm, the searchterm will be a list of items.
There is a similar code written in the following website:
http://www.techonthenet.com/excel/macros/search_for_string.php
However instead of "Mail Box", I would like to search through a range in a
separate work sheet from, for example, "A2:A120".
Topic 647
Subject
Excel Pivot Table Count Unique Values
Question
I have a pivot table like so 
Field       Count of Field 
Value1      1 
Value2      4 
Value3      6 
The field that shows the summation of the count shows 11 which is correct but
how do I just show the unique values in Field (which is 3 in this case) Answer
Count the values in the Excel column and subtract 1 for the Pivot header and 1
for the Grand Total (if showing).
Topic 648
Subject
Excel Type Provider Error
Question
I have tried to use the Excel Type Provider located here but it seems to throw
the following error?
Referenced assembly 'C:\Projects2012\DBA

Projects\CustomerCountAnalysis\CustomerCountAnalysis../packages/ExcelProv
has assembly level attribute
'Microsoft.FSharp.Core.CompilerServices.TypeProviderAssemblyAttribute'
but no public type provider classes were found
Is there any way to fix this? Full screenshot of the error in Visual Studio can be
seen below:
Topic 649
Subject
Excel 2007 Refresh Imported CSV File From Web
Question
Log data from a test is uploaded to a web service, and the processed CSV is
downloaded back into Excel for viewing in charts. At the moment, this is done
via copy and paste for short CSV files and the Data > From Text feature for
larger CSV files. Unfortunately, this takes a bunch of time for every test, and I
need to make the process very simple for someone else to update the Excel
spreadsheet.
The Excel spreadsheet contains 5 raw-data pages which are used to store the
CSV from the server. I have no issues selecting Data > From Text, entering the
website URL, and completing the format to import. This process can be
repeated (same as the Copy and Paste) for all 5 pages to import the data.
This process only allows me to put in one filename, so I am using the same
URL for the data, and having PHP return the CSV of the latest (or a specifically
configured) test whenever the website is accessed. I've verified that this
process is working correctly.
Unfortunately, when I do 'Refresh All', it prompts for a filename unless I go to
Data > Connections > Properties, and uncheck 'Prompt for file name on
refresh'.
However, even when I do that, I'm getting mixed results. Sometimes only one
of the pages will update. (Seems to be the last one I set up.) Sometimes none of
them do. I need a solution which updates all 5 pages based on the current CSV
from the server without having to set up the connections again every time.

Ideally I'd like to just hide these raw data sheets so we can have an Excel file
that's just the final charts.
Surely this is a common function and I am doing something wrong, yet all the
guides I try on the Internet don't seem to work. For example, this one:
http://www.kimgentes.com/worshiptech-web-tools-page/2010/8/19/web-
connecting-csv-files-as-external-data-to-excel-spreadshe.html Seems like they
only set up one connection. I can get one working to refresh, but not more than
one.
Topic 650
Subject
I need to be able to sort a protected worksheet that has locked column headers
in excel (VBA)
Question
I am working on an excel document at the moment and everything is turning out
quite nicely. However, I am coming down to the very last issue that I am having
a problem resolving: being able to sort my columns in ascending/descending
order while the worksheet is protected and the column headers are locked. I
will state some facts about my worksheet first, the goal that I am trying to
accomplish, then possible solutions that I have researched and why those
solutions do not seem to apply to my situation.
First, I am NOT using an excel table object (just plain rows/columns).
The top row has AutoFilter applied (to work as column headers). All of the
cells in the worksheet are unlocked, EXCEPT for the entire first row which is
locked (aka, the column headers). The worksheet will be protected.
I do NOT want users to be able to edit data in the first row (this is important,
these must not be editable no matter what). For my protected sheet settings, I
have "Select locked cells","Select unlocked cells","Insert rows","Delete
rows","Sort", and "AutoFilter" checked.
I am using VBA for my worksheet.
I am using Excel 2013
Now, assuming the worksheet is protected, users are currently able to use the
AutoFilter at the top to actually "filter" the data as intended. The issue is
whenever they try to "sort" the data in ascending/descending order that I get an

error saying that you must unprotect the sheet first.
After researching I have seen that this is due to the fact that when you sort, the
AutoFilter automatically counts the column header as part of the range being
sorted... but because this column header (row 1) is locked, it is causing this
error. However, this row HAS to be locked, my VBA code specifically reads
the values in these column headers and under no circumstances can they be
changed.
So filtering works just fine, it is just the sorting I am trying to figure out now.
My "ideal" solution would be to somehow capture an event when a user clicks
on the AutoFilter arrow and selects "Sort" where I can then, in VBA, unprotect
the sheet, sort according to their selection, then protect the sheet again.
However, again upon research, it seems that there really isn't an option when it
comes to an event for this AutoFilter button (I could be wrong, sometimes it
can be confusing reading other's suggestions).
I am hoping someone out there can help me out with this situation, I would also
LIKE to avoid using an excel table object, however if it is the only solution
that works that meets all my above criteria then so-be-it.
Thanks in advance for your help.
Answer
If you already use VBA, you can plug this code into the Sheet module. This
assumes the headers are in row 1. Change to suit.
Private Sub Worksheet_Change(ByVal Target As Range)
If Not Intersect(Target, Range("1:1")) Is Nothing Then 
      Application.EnableEvents = False 
      Application.Undo 
      Application.EnableEvents = True 
End If
End Sub

The sheet now does not need to be protected.
Answer
Borrowing a bit from @Teylyn's and adapted it to disallow selection of the
header row, when it is selected, it selects the cell below it directly and
displays an error message. The code sits in the sheet module, if it needs to be
applied to more sheets, it may be better to use Private Sub
Workbook_SheetSelectionChange(ByVal Sh As Object, ByVal Target As
Range), in that case, replace all instances of Me with Sh in the code below.
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
If Not Intersect(Target, Me.Range("1:1")) Is Nothing Then 
      Target.Offset(1, 0).Select 
      MsgBox "You cannot select or edit the headerrow, please
use the autofilter button to sort and filter.", vbCritical,
"Invalid Selection" 
End If
End Sub
Note
Unlocking the cells which is required for the sorting and then allowing
unlocked cells to be selected when protecting the worksheet, which is needed
to be able to edit the data, makes the worksheet protection effectively useless.
Also wit the code above, there is still a loophole through which cells can be
edited. If you select an allowed cell, drag it to the header row, and choose to
replace the data in the cell then the header cell to which the allowed cell was
moved is selected and editable.
End of note
Select the data range which needs to be sorted and unlock the cells.
When protecting the worksheet, be sure to allow

sort
autofilter
To prevent users from changing the cell contents, disallow the selection of
unlocked cells.
Topic 651
Subject
Looping an “If..And…Then…” statement with automated email in VBA MS
Excel
Question
I'm very new to coding on any platform and have been working hard to get this
code up and running. I have a conditional statement that is attached to an
automatic email function that sends an email if the condition is met. This
portion of the code works, but only for the row of the spreadsheet the code is
specific to (row 2). I need it to cycle through all available rows and create a
specific email for each row where the condition is met. Here is the code I have
Sub macro1() 'prelim dictation
Set cdomsg = CreateObject("CDO.message") With
cdomsg.Configuration.Fields
.Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2 'NTLM
method .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") =
"smtp.gmail.com"
.Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587
.Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
.Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
.Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout"
= 60 .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") =
"imcool@gmail.com"
.Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") =
"imcoolpasscode" .Update
End With
If Cells(2, 2) + 5 <= Cells(2, 17) And Cells(2, 4) = "INCOMPLETE" Then

With cdomsg
.To = "danielcarnam@yahoo.com"
.From = "danielcarnam@gmail.com"
.Subject = "Work to be done"
.TextBody = Cells(2, 1) & Space(3) & Cells(1, 3) .Send
End With
Set cdomsg = Nothing
Else
End If
End Sub 
 A         B     C(x1)     D        E(x2)        F        
............. Q 
1  Patient  Date       "Incomplete"       "Incomplete"        
   =TODAY() 
2  John Doe 1/25       "Incomplete"       "Incomplete" 
3  Jane Doe 1/30       "Incomplete"       "Incomplete" 
.
.
Above is an example of my spreadsheet.
When the portion of the report is completed I enter that date into column "C"
and column "D" changes to "complete". Essentially what my code says is, If
todays date is within 5 days of date of service (B2), and column D is
"incomplete", Then send an email, where the text body is the patients name and
the title of column D ("x1") (Cells 1,3). The code will have 10+ sections for
each patient (Expanding out similar to columns E and F) and at least 30
patients per month. I need a code that loops through the patients to the end of
the list and sends a correlating email (patients name and specific section of the
report thats delayed (x1,x2...) when conditions are met. So far i have written
three sperate modules for each section (x1,x2,x3) and a master to run them all
at once. a secondary question i would like to ask is if i can place them all in
one module so that i dont crash the computer or have to run the code for an
hour to get results. I apologize for the length of my query, but i couldnt figure
out how to word it more briefly. Any help is hugely appreciated and ill of
course be happy to answer any questions you may have. Thanks a million. -Dan
Answer

You need to create variables for the rows (and columns if needed) and then a
loop to process.
dim row as integer
row = 2
while cells(row, 1) <> ""
INSERT YOUR CODE HERE, REPLACE HARD CODED ROW #S WITH
VARIABLE "row" e.g. if cells(row, 2) + 5...
row = row + 1
wend
Topic 652
Subject
Unique formulas in table managed by code
Question
I have a workbook with an "Index" sheet/tab that maintains a list of all projects
tracked in the workbook. Each project has its own tab. I'm attempting to
manage this programmatically with VBA using the following code:
Dim template As Worksheet
Dim newSheet As Worksheet
Dim newName As String 
newName = Application.InputBox("Enter Project Name")      
'get name 
Worksheets("P0").Visible = True                            
'Unhide template 
Set template = ActiveWorkbook.Sheets("P0")                
'identify template 
template.Copy After:=Sheets(Sheets.Count)                  
'create copy 
Set newSheet = ActiveSheet                                
'identify new sheet 
newSheet.Name = newName                                    
'rename sheet 
'deleteNames (newSheet.Name)                              
'delete copied named ranges with worksheet scope 
newSheet.Range("C5").Value = newName                      
'Change header on new sheet 
Worksheets("P0").Visible = False                          

'Hide template 
Worksheets("Dashboard").Activate                          
'switch back to dashboard 
Dim Tbl As ListObject
Dim StrFormula1, StrFormula2 As String
Dim NewRow As ListRow
StrFormula1 = "=HYPERLINK(""#'" & newName & "'!A1"",'" & newName &
"'!C5)" StrFormula2 = "='" & newName & "'!C18"
Set Tbl = Range("tblProjects").ListObject Set NewRow =
Tbl.ListRows.Add(AlwaysInsert:=True) NewRow.Range =
Array(StrFormula1, StrFormula2)
The probelm is the last line. It works great the first time. It creates a new row
with a formula like this:
=HYPERLINK("#'Test Project'!A1",'Test Project'!C5)
But when I add a second one, it changes the previous row:
=HYPERLINK("#'Another Project'!A1",'Another Project'!C4)
It should I would like it to still be referencing cell C5. Someone said I could
"enter a constant into one cell of the column. Now change the formula in
another cell of the column. Change the first cell back to its original formula."
but I'm hoping for a cleaner solution. Is there a setting or something to disable
this behavior?
I need (would like) it to be a table so I can easily sort and filter and eventually
add functionality to delete projects or manipulate the table in other ways.
Answer
Why don't you add another column where the sheet name is entered.
Then create a formula that references the column in the hyperlink function.
When you add a new row, you only need to add the sheet name in the sheet
name column. The Excel Table default behavior is to apply formulas to new

rows.
=HYPERLINK(INDIRECT("'"&A2&"'!A1"),INDIRECT("'"&A2&"'!C5"))
The VBA code now just needs to add a value in a new row and populate the
"sheet" column with the sheet name and you don't need to edit the formula at
all.
Edit: On the other hand: If the behavior of an Excel Table is causing problems,
why do you want to use a table at all? If you don't use a table, there won't be
errors. If you are setting the formulas for each row with VBA, then just us a
regular range, not a table.
Topic 653
Subject
Excel: Copy every nth line from one sheet to another
Question
In Excel, I'm trying to copy data from one sheet into another. Each data point is
separated by nine rows. On the new sheet, I begin from the sixth row and I
continue this for 20 rows. For example:
B6=Scenarios!H7
B7=Scenarios!H16
B8=Scenarios!H25
...
I wouldn't mind doing this manually, but I have a lot of columns to fill, based
on this pattern.
C6=Scenarios!H8
C7=Scenarios!H17
C8=Scenarios!H26
...
I manually fill a couple columns and skip a couple 'Scenario' sheet rows
before continuing this pattern.

F6=Scenarios!H11
F7=Scenarios!H20
F8=Scenarios!H29
...
E6=Scenarios!H12
E7=Scenarios!H21
...
I have looked around and I know that the INDIRECT or OFFSET command can
help, like
F5=INDIRECT("Scenarios!H"&((ROW(H11)*9)))
or
F5=INDIRECT("Scenarios!H"&((ROW($H7)*1)+4))
Yet I'm unable to get a formula going that works correctly in a manner where I
can simply copy down cells and have it fill correctly. Can anyone help me on
the math for this, or otherwise provide a better solution? Answer
B6 = =INDEX(Scenarios!H:H, ROWS($B$6:B6)*9-2)
C6 = =INDEX(Scenarios!H:H, ROWS($B$6:B6)*9-1)
F6 = =INDEX(Scenarios!H:H, ROWS($B$6:B6)*9+2)
E6= =INDEX(Scenarios!H:H, ROWS($B$6:B6)*9+3)
Copy formulas down and you get the idea of math if you have other columns to
fill.
Topic 654
Subject
C# read excel data using oledb and format it in specified format and insert into
SQL Server database
Question

net and C#. I need to write a program to browse and read an excel and then
parse it in specified format and finally insert into sql server database.
I have used oledb to read excel and I created DataTable from excel. Now I'm
having a trouble to parse it in required format. Here is the link for the picture
of what is excel input and what is expected format to insert into database. Input
and expected output format
Right now I'm doing with simple data in future I need to do in for large excel
data around (3000 columns) to parse into some 250000 records. Please also
give me advise in terms of performance wise. Right now I'm using oledb is it
fine or do I need to use anything else.
Here is my sample code c# code file
OleDbConnection Econ;
SqlConnection con;
string constr, Query, sqlconn;
protected void Page_Load(object sender, EventArgs e) {
}
// excel connection
private void ExcelConn(string FilePath) { 
      constr =
string.Format(@"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=
{0};Extended Properties=""Excel 12.0 Xml;HDR=YES;""",
FilePath); 
      Econ = new OleDbConnection(constr); 
}
// sql connection
private void connection()
{ 
      sqlconn =
ConfigurationManager.ConnectionStrings["SqlCom"].ConnectionStri
      con = new SqlConnection(sqlconn); 

}
// read data from excel and creating a datatable private void
ExcelToDataTable(string FilePath) {
ExcelConn("C:\\Users\\username\\Desktop\\EmpEx.xlsx"); 
      Query = string.Format("Select * FROM [Sheet1$]"); 
      OleDbCommand Ecom = new OleDbCommand(Query, Econ); 
      Econ.Open(); 
      OleDbDataAdapter oda = new OleDbDataAdapter(Ecom); 
      DataTable dtExcel = new DataTable(); 
      Econ.Close(); 
      oda.Fill(dtExcel); 
     // DataTable parseTable = ParseDataTable(dtExcel); 
      //connection(); 
      // printing data table 
      foreach (DataRow dataRow in dtExcel.Rows) 
      { 
          foreach (var item in dataRow.ItemArray) 
          { 
              Response.Write(item); 
          } 
      } 
      Response.Write("<br> Colums: " +
dtExcel.Columns.Count.ToString() + "<br>"); 
      Response.Write("Rows: " + dtExcel.Rows.Count.ToString()
+ "<br>"); 
      //print on screen 
      foreach(DataRow row in dtExcel.Rows) 
      { 
          foreach(DataColumn col in dtExcel.Columns) 
          { 
              Label1.Text = Label1.Text  +
row[col].ToString() + "\t"; 
          } 

      } 
}
// Method to make data table in specified format public DataTable
ParseDataTable(DataTable dtExcel) { 
      var dt = new DataTable("sourceData"); 
      dt.Columns.Add(new DataColumn("id", typeof(String))); 
      dt.Columns.Add(new DataColumn("name", typeof(String)));
      dt.Columns.Add(new DataColumn("variable",
typeof(String))); 
      dt.Columns.Add(new DataColumn("year", typeof(String)));
      dt.Columns.Add(new DataColumn("value",
typeof(String))); 
      // NOT GETTING TO PARSE In specified format 
      /**** NEED HELP HERE *****/ 
      return dt; 
}
protected void Button1_Click(object sender, EventArgs e) { 
      string CurrentFilePath =
Path.GetFullPath(FileUpload1.PostedFile.FileName); 
      ExcelToDataTable(CurrentFilePath); 
}
Please help me how can I achieve this. How can I parse input excel data in
specified format as mentioned in the attached picture in the link (screenshot).
Please suggest me any way to fix my problem. Answer
I solved this problem with using C# OLEDB ACE engine. Currently it supports
only around 250 columns. It satisfies my requirement so far.
Solution is I'm able to get the sheet name and sheet range through code for the
input file. I copied input file into a C# oledb datatable inputtable , using that

datatable I created another formatted datatable which holds the values from
inputtable based on conditional logic. I used linq to query the datatable in
order to generate the formatted result.
on button click:
string rangeStringwithSHeet = sheetName + excelComm.GetRange(sheetName,
excelConn);
dataQuery = string.Format("SELECT Institution" + queryIn + " FROM [{0}] ",
rangeStringwithSHeet); 
      // connect to excel with query and get the initiall
datatable from excel input 
      dataExcelTable =
excelComm.FillDataTableWithQuery(dataQuery, excelConn); 
       formattedDataTableExcel(dataExcelTable); 
The actual conversion logic I included in formattedDataTableExcel() method,
where I created this for my web application. I wrote logic according to my
business logic. I'm not posting the actual logic here. If anyone have a similar
issue let me know I can help with the conversion process.
Answer
My recommendation would be to re-think your tool. This would be much
easier in a tool like SQL Server Integration Services (SSIS) or other tools
whose sole purpose is this.
From the SSIS Wiki article, "SSIS is a platform for data integration and
workflow applications."
From the C# Wiki article "C# (pronounced as see sharp) is a multi-paradigm
programming language".
Answer
I have created a solution for unpivoting the data in F# which can be found here.
Since F# works on the .NET CLR you could call this from C# or could

translate it to C# using linq equivalent operations.
// Sample Input as a jagged array
let sampleInput =
[| [| "id"; "name"; "variable1"; "variable1"; "variable2" |] 
     [| ""; ""; "Fall 2000"; "Fall 2001"; "Fall 2000" |] 
     [| "1"; "abc"; "1400"; "1500"; "1200" |] 
     [| "2"; "xyz"; "1200"; "1400"; "1100" |] |] 
let variables = sampleInput.[0].[2 ..]
let falls = sampleInput.[1].[2 ..]
let idNameValues = sampleInput.[2 ..] |> Array.map (fun value -> (value.[0],
value.[1], value.[2 ..]))
// Output as an array of tuples
let output =
idNameValues
|> Array.collect (fun (id, name, values) -> 
      Array.zip3 variables falls values // Zip up the
variables, falls and values data arrays for each old id, name
combination 
      |> Array.mapi (fun i (variable, fall, value) -> (i, int
id, name, variable, fall, value)) // Flatten out over the row
id, old id index and name 
)
|> Array.sortBy (fun (row, id, _, _, _, _) -> (row, id)) // Sort by row id and old
id index |> Array.mapi (fun i (_, _, name, variable, fall, value) -> (i + 1, name,
variable, fall, int value)) // Add new id index
printfn "SampleInput =\n %A" sampleInput printfn "Output =\n %A" output
I have actually had a go at translating the F# code to C#. I am sure you could
probably write more idiomatic C# code here and performance is probably
lacking a bit too with the massive amounts of linq but it seems to work!

You can see it working in .NET Fiddle here.
using System;
using System.Linq;
public class Program
{
public static string[][] SampleInput() { 
      return new string[][]{ 
          new string[] { "id", "name", "variable1",
"variable1", "variable2" }, 
          new string[] { "", "", "Fall 2000", "Fall 2001",
"Fall 2000" }, 
          new string[] { "1", "abc", "1400", "1500", "1200"
}, 
          new string[] { "2", "xyz", "1200", "1400", "1100" }
      }; 
}
public static Tuple<int, string, string, string, int>[] Unpivot(string[][]
flattenedInput) { 
      var variables = (flattenedInput[0]).Skip(2).ToArray(); 
      var falls = (flattenedInput[1]).Skip(2).ToArray(); 
      var idNameValues =
flattenedInput.Skip(2).Select(idNameValue =>
Tuple.Create(idNameValue[0], idNameValue[1],
idNameValue.Skip(2))).ToArray(); 
      return 
          idNameValues 
              .SelectMany(idNameValue => variables 
                  .Zip(falls, (variable, fall) =>
Tuple.Create(variable, fall)) 
                  .Zip(idNameValue.Item3, (variableFall, val)
=> Tuple.Create(variableFall.Item1, variableFall.Item2, val)) 
                  .Select((variableFallVal, i) =>
Tuple.Create(i + 1, Convert.ToInt32(idNameValue.Item1),
idNameValue.Item2, variableFallVal.Item1,
variableFallVal.Item2, variableFallVal.Item3)) 

              ) 
              .OrderBy(rowId_ => Tuple.Create(rowId_.Item1,
rowId_.Item2)) 
              .Select((_NameVariableFallValue, i) =>
Tuple.Create(i + 1, _NameVariableFallValue.Item3,
_NameVariableFallValue.Item4, _NameVariableFallValue.Item5,
Convert.ToInt32(_NameVariableFallValue.Item6))) 
              .ToArray(); 
}
public static void Main()
{ 
      var flattenedData = SampleInput(); 
      var normalisedData = Unpivot(SampleInput()); 
      Console.WriteLine("SampleInput ="); 
      foreach (var row in SampleInput()) 
      { 
          Console.WriteLine(Tuple.Create(row[0], row[1],
row[2], row[3], row[4]).ToString()); 
      } 
      Console.WriteLine("\nOutput ="); 
      foreach (var row in normalisedData) 
      { 
          Console.WriteLine(row.ToString()); 
      } 
}
}
Edit: Below is an example of converting an excel file represented by a file
path to a jagged string array. In this case I have used the Nuget Package
ExcelDataReader to get the data from Excel.
using System;
using System.IO;
using System.Data;
using System.Collections.Generic;

using System.Linq;
using Excel; // Install Nuget Package ExcelDataReader
public class Program
{
public static string[][] ExcelSheetToJaggedArray(string fileName, string
sheetName) { 
      using (var stream = File.Open(fileName, FileMode.Open,
FileAccess.Read)) 
      { 
          using (var excelReader =
ExcelReaderFactory.CreateOpenXmlReader(stream)) 
          { 
              var data = 
                  excelReader.AsDataSet().Tables 
                      .Cast<DataTable>() 
                      .FirstOrDefault(sheet =>
sheet.TableName == sheetName); 
              return 
                  data.Rows 
                      .Cast<DataRow>() 
                      .Select(row => 
                          row.ItemArray 
                              .Select(cell =>
cell.ToString()).ToArray()) 
                      .ToArray(); 
          } 
      } 
}
public static void Main()
{ 
      // Sample use of ExcelSheetToJaggedArray function 
      var fileName = @"C:\SampleInput.xlsx"; 
      var jaggedArray = ExcelSheetToJaggedArray(fileName,
"Sheet1"); 
      foreach (var row in jaggedArray) 
      { 

          foreach (var cell in row) 
          { 
              Console.Write(cell.ToString() + ","); 
          } 
          Console.WriteLine(); 
      } 
}
}
Topic 655
Subject
Epoch time python and excel
Question
I am trying to automate some data processing on an excel file and in the data
processing file I use a macro that I guess converts the date column from
"mm/dd/yyyy" into the days since January 1, 1900 as per excel convention. So
when I try to do a similar thing in Python 2.7.4. It seems to be 2 days off. For
example, 2/25/2015 becomes 42060 when done by the excel macro. When I
run this code:
import datetime
gotDay = datetime.date(2015,2,25)
epoch = datetime.date(1900,1,1)
print((gotDay-epoch).days)
I get 42058.
I could totally just add 2 to everything in Python, but I was wondering why this
happens.
Thanks!
Answer
The correct answer is 42058, so there's something wrong w/the excel macro.

My guess is that excel is counting both the start and end date as a day, when
really you're only interested in the time between those dates.
It's like saying how many days between today and tomorrow. You could say
one, which is what python is doing, or you could say 3 (today, the day between,
and tomorrow) which is what I'm guessing your excel macro is doing.
Topic 656
Subject
In 2016, what is the correct way to create a commercial MS Office Add In?
[closed]
Question
I've been writing VB6 code for Outlook and Excel for at least 10 years, but it's
generally written in the VB Editor and saved as the default project or a
worksheet module, therefore not very portable.
I'm at the stage now where I want to switch to .net and write proper add-ins,
that I can distribute and potentially sell (so would need to be protected and
installable).
However, there seems to be a lot of conflicting advice out there about how to
do this, and what software to use.
I'd really like to know the definitive way to do this in 2016;
What software to use (I presume, either the paid or free version of VS) What
language to use (I assume a flavour of .net) What I need to do to be able to
distribute or sell the addin (do they still need to be signed?) any advice on
definitive resources to make the switch from hacker-style projects to stand
alone projects
Apologies if this sounds vague, or isn't the correct format for SO; I'm a web
developer, mainly open source technologies, so the MS stack (Office aside)
has always been a different world for me.
Thanks,
Dave

Answer
The tools of choice for .NET are VSTO, XL DNA and Addin Express. VSTO
is OK if you don't need performance (the Interop layer gives a high overhead)
and does not support UDFs. Its slightly problematic across XL versions.XL
DNA is free, fast (both XLL and COM-Interop), supports UDFs and is open
source. Addin Express is not free, but also fast, supports UDFs and good
cross-version support. All .NET addins require obfuscation for IP protection
and support both 64-bit and 32-bit Excel (which VB6 does not).
Topic 657
Subject
R: subset() function altered character data into strange code
Question
i read some data into R with the read.xlsx() in openxlsx package, and here's my
code for reading the data:
data_all = read.xlsx(xlsxFile = paste0(path, EoLfileName), sheet = 1,
detectDates = T, skipEmptyRows = F)
now, when i access one name cell in my data, it will print the name in
characters:
> data_all[1,'name']
[1] "76-ES+ADVIP-20G"
now, lets say i want to subset out some rows based on a condition on another
colum:
data_sub = subset(data_all, !is.na(data_all$amount))
however, then if i print this subset data, i'd get:
> data_sub[1,'name']
[1] "A94198.10"
i've also tried to do subsetting using the following method:

data_sub = data_all[!is.na(data_all$amount),]
but i get the same thing: the expected output of "76-ES+ADVIP-20G" would be
turned into "A94198.10"
I've checked many times with mode() and str() for data_all$name and
data_sub$name, both return character, so they are in correct format.
here's a link to smaple data to play with:
https://drive.google.com/file/d/0BwIbultIWxeVY1VtdDU5NFp1Tkk/view?
usp=sharing
Please please help me! I am quite stuck, and i dont see other posts with similar
problem. Why is this happeneing? subsetting shouldnt change data formatting
correct? Thank you in advance for your help!
additional note (if its helpful):
so when i tried to debug, i noticed that, when i was viewing the data_all in
RStudio, and if i copy and paste the name "76-ES+ADVIP-20G" into the filter
bar, it actually cannot find it; i'd have to type in "76-ES" and as soon as i type
in the next character which is "+", RStudio data view filter would say "no
matching records found"
Topic 658
Subject
Midnight as 24:00 not 00:00 in Excel
Question
Ok this isn't explicitly a programming question but maybe I can get around it
with VBA.
I have some times I'm working with that go over midnight and Excel is not
displaying them because they would be 'negative values'. Eg: 00:30 - 23:30 (or
12:30 am - 11:30pm). This is causing many errors.
Is there a way to get around this? I've tried changing the format to [hh]:mm:ss
and this doesn't help. I've also changed the time format to 1904 but this causes
problems with other errors I'm using.

Any help is appreciated!
Answer
If you are doing calculations With times going cross midnight, you need to add
a date, thereby Excel will know which timestamp that is the latest.
i.e.
00:30 - 23:30 does not work
jan 02 2000 00:30 - jan 01 2000 23:30 Works fine
use the actual date or whatever date is suitable, the important thing is just that
00:30 is the day after 23:30
or if you have the from-time in b2 and the to-time in c2:
if(c2>b2;c2;c2+1)-b2
change if and ; to whatever Excel wants in your locale
Topic 659
Subject
Excel VBA Find Matched Values in 2 columns
Question
I have 2 Excel Columns, A and B, in a very large, very error-prone list. The
first value is an Account number, and the second is a String (Name). Each
number in A should be matched with 1 and only 1 String... And each string
SHOULD be matched with 1 and only 1 Account.
There are a large number of rows, and the same Account can correctly appear
100 times with the correct name, followed by another account 100 times with
another name.
But then the real world happens and I get a previously used Accounts with the
Wrong Name, or worse, a Name appears with the wrong Account number.
Is there a good VBA method to check that all Account 100, for example

appears in the list matched with only one name (John Smith), and ALSO that
each Name (John Smith) ONLY appears with Account 100?
I used a function "CountUniqueNames()" and figured out how to check that
there are only 200 unique Names, and another function
"CountUniqueAccounts()" to determine that there are 200 unique Accounts in a
list of 25000 rows... however I can't conceive of how I can make the next leap
to ensure that the numbers match with one and only one name, and vice-versa!
Thanks for reading!
Jamie
Topic 660
Subject
Sub-windows created by an add-in
Question
I have seen several times that an add-in can create sub-windows in Excel.
Here is an exemple:
Does anyone know which technique allows the add-in to create the sub-
windows on the right hand side? Answer
This technique is CustomTaskPanes
Topic 661
Subject
excel equation to matlab
Question
I would appreciate a double checking of my translation of an excel equation
into matlab. The excel equation is part of a time series and comes for line 6 in
the sheet.
=IF(M6>$AD$17,$AD$5+$AD$8,IF(N6>0,$AD$5+(O5-
$AD$5)*EXP((IF(F6>273.16,$AD$11,$AD$14))*0.04167),0))
This is what I think it should/could be:

if T(t)>273.16
Z(t)=DPp
else
Z(t)=DPn
end
if Ps(t)>SS; %Albedo
Albedo(t)=Amin+Aadd
else
if SnowAge(t)>0
Albedo(t)=Amin+(Albedo(t-1)-Amin)*exp(Z(t)*0.04167) else
Albedo(t)= 0
end
end
I took the embedded If statement in the excel equation and turned it into
variable Z(t). Is my matlab an appropriate translation of the excel equation?
Thank you
Topic 662
Subject
Add row to table then add formulas to multiple columns in row
Question
Dim Tbl As ListObject
Dim StrFormula1, StrFormula2 As String
Dim NewRow As ListRow
StrFormula1 = "=HYPERLINK(""#'" & newName & "'!A1"",newName &
""!A1)" StrFormula2 = "=" & newName & "!C9"
Set Tbl = Range("tblProjects").ListObject Set NewRow =
Tbl.ListRows.Add(AlwaysInsert:=True) NewRow.Range =

Array(StrFormula1, StrFormula2)
For the last line I keep getting an error. This is based on the question Add new
row to excel Table (VBA)
I've tried a few other options for the last line but none of them work. I don't
know if it's because they're formulas or what. In another spreadsheet I have I'm
using Range(ResultCol & UCRow).Formula = StrFormula but in that case the
range is not based on a table but static cell values.
So, how can I apply a couple formulas to NewRow? Answer
corrected formula:
StrFormula1 = "=HYPERLINK(""#'" & newName & "'!A1""," & newName &
"!A1)"
You may also want to wrap newName in a single quote in the second
reference, in case the newName contains a space.
StrFormula1 = "=HYPERLINK(""#'" & newName & "'!A1"",'" & newName &
"'!A1)"
Topic 663
Subject
How do I clear the cell contents of the same row in column C through F when
the content in column B is changed to a specific content?
Question
I'm trying to figure out if there's a code or formula I can use to clear column C -
F in the same row when the contents of column B is changed specifically to
one text.
Example
Column B is Location and when I changed the location specifically to
Room 1, I want all contents in column C-F in that same row to clear out.
**I am not an excel expert.

Topic 664
Subject
How to loop thru an excel workbook using VBA
Question
I'm attempting to loop thru each sheet in an excel workbook. My code is only
running thru the first sheet and it does not recognize where the last row is. Any
help would be greatly appreciated.
Private Sub calculateValue()
For i = 2 To Rows.Count
If Cells(i, 4).Value < 10 Then
Cells(i, 6).Value = 20
End If
If Cells(i, 4).Value > 9 And Range("D2").Value < 40 Then
Cells(i, 6).Value = 70
End If
If Cells(i, 4).Value > 39 Then
Cells(i, 6).Value = 120
End If
If Cells(i, 4).Value = Empty Then Exit For
Next i
Cells(i, 6).Value = ""
End Sub
Answer
This first sub below iterates over each worksheet. The second is a placeholder
for your code.

Sub forEachWs()
Dim ws As Worksheet
For Each ws In ActiveWorkbook.Worksheets
Call calculateValue(ws)
Next
End Sub
Sub calculateValue(ws As Worksheet)
'Worksheets(ws).Activate
'iterate over cells
'your code goes here
End Sub
Topic 665
Subject
VBA - Due Date with Hours and Minutes?
Question
Let's say I want a msgbox to pop up when something is an hour away from
happening, how would this be done?
I'm thinking something along the line:
MyLimit = Now
If .Value = MyLimit Then
msgbox "Do that thing cause it is due right now"
or
MyLimit = Date
If .Value = MyLimit Then
msgbox "Do that thing cause it is due right now"
and have the formula refer to cell with a Date Formatting of "m/d/yy h:mm

AM/PM"
Something like that doesn't work and I wonder why. Answer
Try Application.OnTime Method
Sub setAlarm()
Application.OnTime Range("deadline").Value - TimeValue("01:00:00"),
"my_Procedure" End Sub
Sub my_Procedure()
MsgBox "Do that thing cause it is due right now" End Sub
The msgbox pops up one hour before the deadline
Topic 666
Subject
Reading xlsx checkbox values in Java
Question
I'm reading a xlsx file in Java and I need to check some checkboxes. Right now
I am using Apache POI for this, but I can't see how I can access these
checkboxes (They are inserted in excel using the Developer tab -> Insert ->
Form Control).
For xls files I managed to access them with the hint from: Reading Excel
checkbox values in Java Apache POI
In the "XSSF and SAX (Event API)" section from the poi how-to page
(https://poi.apache.org/spreadsheet/how-to.html) I can see how to use a
SAXParser to go through the document. This way I also can see that
checkboxes are on the sheet, but I can't get to their value. What I have is this:
public XMLReader fetchSheetParser(SharedStringsTable sst) throws
SAXException {
XMLReader parser =

XMLReaderFactory.createXMLReader("org.apache.xerces.parsers.SAXParser
ContentHandler handler = new SheetHandler();
parser.setContentHandler(handler);
return parser;
}
private static class SheetHandler extends DefaultHandler {
private boolean inControl;
public void startElement(String uri, String localName, String name, Attributes
attributes) throws SAXException { 
      if (inControl || "control".equals(localName)) { 
          System.out.print(name + ": "); 
          for (int i = 0; i < attributes.getLength(); i++) { 
              System.out.print(attributes.getQName(i) + "=" +
attributes.getValue(i) + "; "); 
          } 
          inControl = true; 
          System.out.println(); 
      } 
}
public void endElement(String uri, String localName, String name) throws
SAXException { 
      if (inControl) { 
          if ("control".equals(localName)) { 
              inControl = false; 
          } 
      } 
}
public void characters(char[] ch, int start, int length) throws SAXException { 
      if (inControl) { 
          System.out.println("  value: " + new String(ch,
start, length)); 

      } 
}
}
When I use this on an xlsx file with two checkboxes on it I get the following in
my console:
control: shapeId=1025; r:id=rId4; name=Check Box 1; controlPr:
defaultSize=0; autoFill=0; autoLine=0; autoPict=0; anchor: moveWithCells=1;
from:
xdr:col:
value: 1
xdr:colOff:
value: 371475
xdr:row:
value: 1
xdr:rowOff:
value: 85725
to:
xdr:col:
value: 2
xdr:colOff:
value: 542925
xdr:row:
value: 2
xdr:rowOff:
value: 104775
control: shapeId=1026; r:id=rId5; name=Check Box 2; controlPr:
defaultSize=0; autoFill=0; autoLine=0; autoPict=0; anchor: moveWithCells=1;
from:
xdr:col:
value: 1
xdr:colOff:
value: 323850
xdr:row:
value: 3

xdr:rowOff:
value: 9525
to:
xdr:col:
value: 2
xdr:colOff:
value: 495300
xdr:row:
value: 4
xdr:rowOff:
value: 28575
So the checkboxs are there, but I do not know its values... Can someone help
me out on this?
Answer
You are right, POI cannot read these values currently because it requires a
newer version of the OOXML spec
("http://schemas.microsoft.com/office/spreadsheetml/2009/9/main") than used
right now: http://schemas.openxmlformats.org/spreadsheetml/2006/main
The relation for manual XML parsing seems to be from worksheets/sheetX.xml
via worksheets/_rels/sheetX.xml.rels and from there to
ctrlProps/ctrlPropX.xml which contains the actual checked-property.
In the sheetX.xml, the r:id in the control tag points to the relation:
<mc:AlternateContent>
<mc:Choice Requires="x14"> 
    <controls> 
      <mc:AlternateContent> 
        <mc:Choice Requires="x14"> 
          <control name="Check Box 1" r:id="rId3"
shapeId="1025"> 
            <controlPr autoFill="0" autoLine="0" autoPict="0"
defaultSize="0"> 
              <anchor moveWithCells="1"> 
                <from> 

                  <xdr:col>1</xdr:col> 
                  <xdr:colOff>190500</xdr:colOff> 
                  <xdr:row>0</xdr:row> 
                  <xdr:rowOff>171450</xdr:rowOff> 
With this id you can identify the related ctrlProp.xml-file via the relations-file:
<Relationship Id="rId3" Target="../ctrlProps/ctrlProp1.xml"
Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/c
Via this you can the file ../ctrlProps/ctrlProp1.xml which contains the checked-
status:
<formControlPr
xmlns="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main"
checked="Checked" lockText="1" noThreeD="1" objectType="CheckBox"/>
Topic 667
Subject
How to show the number of completed tasks in Excel
Question
I have a task to do list. Each task has a status of "Open"; "in Progress" or
"Completed".
How do I display the total number of tasks as a number and show the number
with the status of "completed.
For example I want the results to read in this format: 200/150 completed.
Thanks.
Answer
Why don't you just populate a cell with that information as you go...
Dim j As Integer
For j = 1 To 200
Range("B3").Value = "200/" & j & " completed" Next j

It really should be that simple.
If you need a formula, COUNTIFS should work for you
=COUNTIFS(B3:B12,"completed") & " of 200 complete"
Replace the range with whatever works.
Also - with the way you're trying to do it, you'll need the count of cells that are
not blank too:
=COUNTA(A:A) & " / " & COUNTIFS(A:A,"completed") & " completed"
Topic 668
Subject
Create Data Validation list with cells that meet certain conditions
Question
This is a problem that I know can be coded easily in VBA, but I'm trying to
implement it in a formula.
I'm trying to build a list (using Data Validation), but I want this list to only take
part of the range, which fits a certain condition.
So let's say I want the list to be stored in C5, and let's say I have a range in
another sheet called Example_Range. I'd like the list to consist of cells from
the Example_Range, such that the two cells above them are identical to two
other cells that are above C5.
So in short, I need to only take cells from Range_Example that are below cells
that are identical to cells that are above C5 (where I want the list to go).
Notice that the Example_Range is in a different sheet than the sheet that
contains C5.
I know that I can insert formulas into the Source field in Data Validation, but I
do not know how to build this type of formulas. Any help would be
appreciated!
Here's a practical example:

I have this data in "Sheet2":
And I want to create a list, using Data Validation, in the red cell in "Sheet1":
I need the list to contain 20,15,10, because in "Sheet1", above the red square,
that's the input I received. If however, the two cells above the red one had
"Mazda" and "Lantis", I would want the list to be populated only with 45.
So my range is the whole 4th row in "Sheet2", but I do not want all the items
from that range, only those who have cells above it that are identical to the
cells above the red cell (where the list will appear) in "Sheet1". Answer
It's a bit convoluted but I found a process to accomplish this:
In sheet 2
cell A6: =IF(AND(A2=Sheet1!$A$2,A3=Sheet1!$A$3),A4,"x"), drag over to
column E cell A7: =IF(A6="x","-",1)
cell B7: =IF(B6="x","-",MAX($A7:A7)+1), drag over to E7 cell G7:
=IFERROR(INDEX($A$6:$E$6,MATCH(G6,$A$7:$E$7,0)),"X"), drag over
to K7 create a Workbook scope defined name range as list that refers to:
=OFFSET(Sheet3!$G$7,0,0,1,COUNT(Sheet3!$G$7:$K$7))
Then use list as the data validation in sheet 1 cell A4.
Screenshot for full picture view (example is Mazda Lantis, but I tested for
others as well.):
Topic 669
Subject
Excel Row Select
Question
I'm writing a macro to color code some rows of a data sheet I have.
Part of this macro involves selecting a series of rows, let's say from row nA to
row nB. I have tried:
Rows(nA:nB).select

which causes
Compile Error:
Expected: list seperator or )
and
Rows("nA:nB").select
which causes
runtime error
type mismatch
Any advice on how to solve this?
Answer
You probably need
Rows(nA & ":" & nB).Select
to match exactly what you want to achieve.
Answer
definitely do the record macro like was suggested.
Range("B3:C10").Select
Selection.Copy
another example:
rowstart = 3
rowend = 10
colstart = "B"
colend = "C"
rcstart = colstart & rowstart
rcend = colend & rowend

Range(rcstart, rcend).Select
' or you can combine like below
Range(colstart & rowstart, colend & rowend).Select
Selection.Copy
Topic 670
Subject
fetching data from excel when cell contains null value
Question
I am fetching data from excel and I need to count rows where some cell
contains null value. The code is returning nothing. For lines which contains
some values in this cell it is working correctly. Can you help me how to handle
cells with null value?
The code is following:
HSSFSheet sheet = workbook.getSheetAt(1); 
      // Get iterator to all the rows in current sheet 
      Iterator<Row> rowIterator = sheet.iterator(); 
      // Iterate through rows 
      while (rowIterator.hasNext()) { 
          Row row = rowIterator.next(); 
          // Index of column D is 3 (A->0, B->1, etc) 
          Cell cellD = row.getCell(3); 
          Cell cellG = row.getCell(6); 
          // 
          String key = null; 
          Integer value = null; 
          // finding cell type 
          int cellTypeG = cellG.getCellType(); 
          // getting value from first cell 
          key = cellD.getStringCellValue(); 
          // fetching value to the Double, to be able to
compare data 

          if (Cell.CELL_TYPE_NUMERIC == cellTypeG) { 
              value = new
Double(cellG.getNumericCellValue()).intValue(); 
               if (value != null) { 
                  if (map.containsKey(key)) { 
                      map.put(key, map.get(key) + 1); 
                  } else { 
                      map.put(key, 1); 
                  } 
              } 
          } 
      } 
      // cycle which is filling the map 
      for (Entry<String, Integer> e : map.entrySet()) { 
          System.out.println(e.getKey() + ": " +
e.getValue()); 
      } 
Answer
Can you help me how to handle cells with null value?
Simply check if a cell is null/black using StringUtils.isEmpty().
For Example, StringUtils.isEmpty(cellD.getStringCellValue()). This will
return true if the cell is empty or null.
Topic 671
Subject
Application Defined or Object Defined Error on QueryTable
Question
I'm trying to take data from a table in SQL and export it to a worksheet using
VBA.
I have been unable to figure out how to do this without creating a new data
connection each time.
Here is what I have been doing as of now:

I am putting the SQL query into a cell and giving the variables names like '#ID'
and "Date". In the macro, I am replacing the data within those variables with
the actual information. That has not given me any problems thus far as the
query runs without issue when using SQL. To export the data from SQL to my
worksheet, I am using code that works in other workbooks; however when I
run it in this workbook, I am getting the error "Application Defined or Object
Defined Error". Here is the full macro:
Sub CurrentBreakout()
Dim SQLString As String
Dim ID As String
Dim Date As String
Dim year As String
Dim daycount As String
SQLString = Range("CurrentBreakout") 'This is the range where the query is
stored ID = Range("ID")
Date = Range("CurrMonth")
year = Range("CurrYear")
daycount = Range("CurrDayCount")
SQLString = Replace(SQLString, "#ID", ID) SQLString = Replace(SQLString,
"#Date", Date) SQLString = Replace(SQLString, "#CurrDayCount", daycount)
SQLString = Replace(SQLString, "#CurrYear", year)
With ActiveSheet.ListObjects.Add(SourceType:=0, Source:= _
"ODBC;DSN=____________;UID=________;Trusted_Connection=Yes;APP=M
Office 2010;WSID=________;DATABASE=_______;" 
      , Destination:=Range("CurrCon")).QueryTable 
      .CommandText = SQLString 
      .RowNumbers = False 
      .FillAdjacentFormulas = False 
      .PreserveFormatting = True 
      .RefreshOnFileOpen = False 
      .BackgroundQuery = True 
      .RefreshStyle = xlInsertDeleteCells 
      .SavePassword = False 
      .SaveData = True 

      .AdjustColumnWidth = True 
      .RefreshPeriod = 0 
      .PreserveColumnInfo = True 
      .ListObject.DisplayName = "TableCurrCon" 
      .Refresh BackgroundQuery:=False 
End With
End Sub
I am getting the error at ".Refresh BackgroundQuery:=False". This is probably
not the best way to complete this task, but it is the only way I know.
Topic 672
Subject
Calculating median using two columns
Question
I have the following columns 
12      A 
11      M 
12      B 
12      C 
11      A 
9       M 
13      N 
11      M 
12      C 
11      B 
15      M 
I want to calculate median based on only Ms. I have done by selecting ranges.
I want to use columns rather than ranges. Is there any solution? Thanks for your
help Answer
If you have 2010 or later use this formula:
=AGGREGATE(17,6,(A:A/(B:B="M")),2)

If you have 2007 or earlier, try this array formula:
=MEDIAN(IF(B:B="M",A:A))
This is an array formula and must be confirmed with Ctrl-Shift-Enter.
Though the use of full column references will slow the calculation times
because it will iterate through all the rows, all 1.04 million. It is good practice
to limit the references to the max data range to help offset this drain. Change
the C:C to something like $C$1:$C$10000 then it will loop only 10,000 times.
Answer
Well as a VBA user I love to use VBA, other can use your skill using formulas,
and is completly right if you are good on formulas. Here is my answer and I
hope help you.
Imagine you have this:
+----+------------+--------------------+---------------+ | 1 | Values (A) | Criteria
Range (B) | Criteria ( C) | +----+------------+--------------------+---------------+ 
|  2 |         14 | B                  | A             | 
|  3 |          1 | M                  |               | 
|  4 |         15 | A                  |               | 
|  5 |         15 | E                  |               | 
|  6 |         10 | A                  |               | 
|  7 |          3 | M                  |               | 
|  8 |         11 | A                  |               | 
|  9 |          8 | M                  |               | 
| 10 |         14 | A                  |               | 
| 11 |          5 | M                  |               | 
| 12 |          9 | M                  |               | 
| 13 |         10 | M                  |               | 
| 14 |         11 | N                  |               | 
| 15 |          9 | A                  |               | 
| 16 |          2 | M                  |               | 
| 17 |         15 | M                  |               | 
| 18 |         11 | A                  |               | 
| 19 |         12 | S                  |               | 
| 20 |          9 | M                  |               | 
| 21 |         11 | A                  |               | 
| 22 |         15 | V                  |               | 

+----+------------+--------------------+---------------+
And inside the cell E2 you have this
=MedianIf($A$2:$A$22,$B$2:$B$22,C2) and the result must be 11
Because in a regular module of VBA you put this function.
Function MEDIANIF(RangeIf As Range, Criteria_Range1 As Range, Criteria1
As String) As Double
Dim i
Dim Counter
Dim tmp()
Dim subCouter
subCouter = 0
For Each i In Criteria_Range1 
      Counter = Counter + 1 
      If i.Value = Criteria1 Then 
          subCouter = subCouter + 1 
          ReDim Preserve tmp(1 To subCouter) 
          tmp(subCouter) = RangeIf(Counter) 
      End If 
Next i
Dim a
MEDIANIF = Application.WorksheetFunction.Median(tmp()) End Function
And the function works like this:
RangeIF = is the range with the values that you want to get the MEDIAN
Criteria_Range1 = Is the range where you have all the criteria, is the same size
as RangeIF Criteria1 = Is the criteria you use to filter the data.
Answer
How about this low-tech solution:

In Column C, formulate: =IF(B2="M",A2,"") (in rows 2-12, based on your
data, and assuming row 1 contains headers) In cell D2 (or anywhere else),
formulate: =MEDIAN(C:C)
Topic 673
Subject
How to print “Nothing here” to excel if df or groupby is blank?
Question
I am calculating some metrics and printing them to excel using
writer = pd.ExcelWriter('File.xlxs', engine = 'xlsxwriter')
'metric'.to_excel(writer, sheetname = 'x')
Sometimes my metrics will be blank (e.g. the filter has filtered everything out).
Is there a way to print to excel that would let me print "Nothing here" if the
metric was blank using the xlsxwriter method? Answer
You can get the underlying xlsxwriter workbook to write custom output to the
file. More examples in the xlsxwriter docs
if metric.empty:
sheet = writer.book.add_worksheet('y') sheet.write_string('A1', 'Nothing here')
Answer
One possible solution would be to add a conditional format to highlight cells
with no data.
See the following example of using XlsxWriter with Pandas and conditional
formatting.
Topic 674
Subject
VBA PArse <li> Items from <ul> Element
Question
I am attempting to parse data from a website using VBA in excel. The data I am

after are located in the li tags with in a specific ul tag . See html below. I
would like to extract each individual li tag and place in individual cells in
excel. Any help would be appreciated. Thanks in advance!!
<div class="supplier-category-wrapper"> <span class="supplier-guide-
section-title">Categories</span> <ul class="supplier-category-list">
<li>Convention - Convention & Special Event Service</li> <li>Convention -
Marketing/Communications</li> <li>Convention - Printing & Copy
Service</li> <li>Convention - Sign Company</li>
<li>Convention - Stationery/Invitations</li> <li>Convention - Tradeshow
Exhibits</li> </ul>
</div>
Topic 675
Subject
How to save excel file in Classic ASP
Question
I create an excel file in ASP with:
Response.ContentType = "application/vnd.ms-excel" Response.AddHeader
"Content-Disposition", "attachment; filename=excel.xls"
Response.ContentType = "application/download"
It's possible to SAVE the xls file on server - to download next?
another question - When I open the xls file on excel I receive an error about the
file format. why?
the code:
<html xmlns:x="urn:schemas-microsoft-com:office:excel"> <head>
<style>
<!--
@page
{
mso-header-data:"&CDate\: &D\000A<%=strHeader%>"; mso-footer-
data:"&CPage &P";

mso-page-orientation:landscape;
margin:1in .3in .6in .4in;
}
br
{
mso-data-placement:same-cell;
mso-width-source:auto;
}
.wborder {
border-color: #FFF;
}
-->
</style>
<!--[if gte mso 9]><xml>
<x:ExcelWorkbook>
<x:ExcelWorksheets>
<x:ExcelWorksheet>
<x:Name>EXCEL</x:Name>
<x:WorksheetOptions>
<x:Print>
<x:ValidPrinterInfo/>
</x:Print>
<x:Panes>
<x:Pane>
<x:Number>3</x:Number>
</x:Pane>
</x:Panes>
</x:WorksheetOptions>
</x:ExcelWorksheet>
</x:ExcelWorksheets>
</x:ExcelWorkbook>
</xml><![endif]-->
</head>
<body topmargin="0" leftmargin="0" marginheight="0" marginwidth="0">
<table border="1">
<tr>

<td class="wborder" width="100"></td> </tr>
</table>
</body>
</html>
tks!!
Topic 676
Subject
Dynamically Filter Pivot Table based on matching value of a cell
Question
I am trying to filter a pivot table based on a cell value. The code I have
generated using Macro Recording is working but it only filters if I have exact
same pivot items in the cell. I want the code to filter even with matching cell
value.
Like if I write "POW" it should filter "Power" and all the items containing
"POW".
Hope my question is understandable.
The code is:
Sub Search_Pivot()
Dim text As Variant
text = Worksheets("Performance Dashboard").Range("A1").Value
Worksheets("Performance
Dashboard").PivotTables("PivotTable5").PivotFields("Proposal Name"). _
ClearAllFilters
Worksheets("Performance
Dashboard").PivotTables("PivotTable5").PivotFields("Proposal Name"). _
CurrentPage = text
End Sub

Topic 677
Subject
vba and Closing Microsoft Word Object
Question
I created an Excel function in order to use the functionality of Microsoft Word
Before exit the function I've set up an order to Quit the object Nevertheless, the
object remains open...
Any ideas how to Quit?
function word_functionality (ByVal sentence As String)
'Open Word Document from Excel
Dim objWord As Object
Set objWord = CreateObject("Word.Application") objWord.Visible = false
' do somthing...
objWord.Quit
Set objWord = Nothing
End function
Topic 678
Subject
Difference in mlr output between R and excel
Question
I'm attempting to perform a multiple regression in R using data that originally
came from excel. I perform the regression in R using the lm() function, but
when I perform the same regression on the same set of variables using the
Regression feature in the Solver add-in in Excel, I get a materially different
result - very different R^2 value, and different coefficients on my independent
variables. Does anyone know of a reason for this problem?
I'll clarify my steps here:
Create my data in excel, arranged where each row is an event and each column

is a variable. Save a copy of the excel file as a tab delimited text file.
frame1<-read.table("Data_file.txt")
x1<-frame1[,2]
x2<-frame1[,3]
x3<-frame1[,4]
x4<-frame1[,5]
x5<-frame1[,6]
x6<-frame1[,7]
x7<-frame1[,8]
x8<-frame1[,9]
y<-frame1[,8]
lm1<-lm(y~x1+x2+x3+x4+x5+x6)
summary(lm1)
I've run as.numeric(x1) on all the x* and y, to check that R is importing each as
a number, which it does (returns TRUE).
In excel, I open the solver add-in, select "Regression", select the y and x
ranges, and view the outputs. I've manually viewed the vectors in R to make
sure the values are the same, and I tried rounding the values in my excel file to
make sure that rounding when they are saved into a text file or imported into R
isn't the problem - it doesn't fix it.
Anyone with any insight would be greatly appreciated.
EDIT: R output:
Call
lm(formula = lnAssdFCexpanded ~ UNRATE + Housing + SP500 +
Outstanding +
CPI + GDP + libor12 + ACR) Residuals
Min 1Q Median 3Q Max -0.069644 -0.017137 0.004542 0.014124 0.050276
Coefficients
Estimate Std. Error t value Pr(>|t|) (Intercept) 5.403e-01 2.096e+00 0.258

0.79798 x1 3.509e-03 5.179e-02 0.068 0.94635 x2 -4.282e-03 4.328e-03
-0.989 0.32893 x3 -4.812e-05 2.515e-04 -0.191 0.84930 x4 2.788e-04
3.102e-04 0.899 0.37459 x5 -1.859e-03 7.254e-03 -0.256 0.79917 x6 4.769e-
06 1.206e-04 0.040 0.96866 x7 -1.619e-01 1.042e-01 -1.554 0.12871 x8
1.510e-02 5.427e-03 2.783 0.00844 ** --- Signif. codes: 0 ‘***’ 0.001 ‘**’
0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
Residual standard error: 0.02888 on 37 degrees of freedom Multiple R-
squared: 0.324, Adjusted R-squared: 0.1778 F-statistic: 2.217 on 8 and 37 DF,
p-value: 0.04849
Excel output:
SUMMARY OUTPUT
Regression Statistics
Multiple R 0.6585439
R Square 0.433680069
Adjusted R Square 0.311232516
Standard Error 0.026435745
Observations 46
ANOVA
df SS MS F
Regression 8 0.019801242 0.002475155 3.541761833 Residual 37
0.025857398 0.000698849 Total 45 0.04565864
Coefficients Standard Error t Stat P-value Intercept -0.540575382 1.95242173
-0.276874291 0.783417585 X Variable 1 0.00497459 0.047237193
0.105310868 0.916697997 X Variable 2 -0.000348463 0.004154182
-0.083882529 0.933602042 X Variable 3 -0.000140051 0.000229284
-0.610818478 0.545054069 X Variable 4 0.000111365 0.000280844
0.396536602 0.693987066 X Variable 5 -0.002129205 0.006640379
-0.3206451 0.750283376 X Variable 6 5.79194E-05 0.000111833
0.51790939 0.607604647 X Variable 7 -0.16469405 0.093923869
-1.753484509 0.087800642 X Variable 8 0.034494338 0.008515322
4.050855618 0.000250969

Topic 679
Subject
translate excel equation to matlab
Question
I need help translating an excel equation to matlab.
I have translated a simple if-statements in excel such as:
Ps(t)=IF(T(t)<Tp,P,0)
into matlab as:
if Ps(t)=T(t)<Tp;
p;
0;
end
Is this correct? and if so how do I translate a more complicated excel equation
such as:
=IF(F6>273.16,(IF(AND(AB5>0,Y6>0),MIN(Y6*3600/$AE$11,AB5),0)),0)
Answer
If you have Ps(t)=IF(T(t)<Tp,P,0) in Excel then in Matlab you could do:
Ps = zeros(1, length(T));
Ps(T<Tp) = p;
where T is a vector.
This reads, define Ps as an array of zeros having the same length as T. For
those indexes of T where T(i)<Tp set those in Ps to p. This is logical indexing.
The other expression:
=IF(F6>273.16,(IF(AND(AB5>0,Y6>0),MIN(Y6*3600/$AE$11,AB5),0)),0)
has to be analyzed in terms of how this equation operates in Excel. Is this
formula copied along the rows of the same column? From which cell is this

formula?
Let's say this was taken from cell J6, then iterating over row i you get:
AE11 = 100; %this is the constant from cell AE11
for i= 2:length(F)
if F(i) > 273.16 
    if  AB(i) > 0 & Y(i) >0; 
      J(i) = min( Y(i)*3600/ AE11 ,AB(i-1)); 
    else 
      J(i) = 0; 
    end 
  else 
    J(i) = 0; 
end
end
This could be improved with a vectorized version, even though there seems to
be a reference to a different row (AE5, when everything is about row 6).
Answer
=IF(M5>$AD$17,$AD$5+$AD$8,IF(N5>0,$AD$5+(O4-
$AD$5)*EXP((IF(F5>273.16,$AD$11,$AD$14))*0.04167),0))
How would this excel equation be translated to matlab? I am very unclear of
how to handle the final nested If statement.
Topic 680
Subject
Missing Text Data from a mix data type column in the Excel while exporting to
Access
Question
Sorry I couldn't made the title concrete even I tried much.

I have an Excel sheet where I have Mix Data Type Column A having numbers
as well as text. The column has data like the following
|Column A |
|99878787979898|
|ABCDSDDSFDFSDF|
|79878797798789|
|akfjaslkfjlksk|
I am exporting an excel sheet to Access Database via Oledb using this
statement
INSERT INTO [MS Access;Database=AccessFilePath].[Product_Fields]
SELECT MixDataTypeField FROM [sheet1$]"
The Access field where the Column A data will go has "DataType=Text".
When I run the code, it insert the numbers only, the cells where alphabetic data
exist do not get copied.
Any help will be highly appreciated.
Topic 681
Subject
(VBA) How To Assign A Columns Cell To Corresponding Group, and Paste
Group Cells into Group Sheet?
Question
Trying to create a vba script-
Link to workbook here
I have a list of Keywords in Column B, and each Keyword corresponds to a
Group in Column A:
How do I group each list of Keywords into it's corresponding Group's
worksheet, using VBA code?
Examples for Groups "Stainless Steel" and "Glass Dispenser":

Group "Stainless Steel":
Group "Glass Dispenser":
Any help would be greatly appreciated!
EDIT
Trying to create a macro based on @BruceWayne formula.
Getting an error for the line:
Selection.FormulaArray = _
"=IFERROR(INDEX('Script to organize
Group'!R2C[1]:R469C[1],SMALL(IF('Script to organize
Group'!R2C:R469C=MID(CELL(""filename"",R[-1]C),FIND(""]"",CELL(""fil
to organize Group'!R2C:R469C)-ROW('Script to organize
Group'!R2C)+1),ROWS('Script to organize Group'!R2C[1]:RC[1]))),"""")"
Note: Also tried using Range("A2").FormulaArray = _ instead of
Selection.FormulaArray = _, but still getting the same error.
My attempt at VBA code, using the formula, below:
Sub CategorizeKeywordsIntoGroups()
Dim ws As Worksheet 
Set ws = ActiveWorkbook.ActiveSheet     'Set the exact sheet,
not just the one that is active _ 
                                      'and then you will go
through all the sheets 
Range("A2").FormulaArray = _
"=IFERROR(INDEX('Script to organize
Group'!R2C[1]:R469C[1],SMALL(IF('Script to organize
Group'!R2C:R469C=MID(CELL(""filename"",R[-1]C),FIND(""]"",CELL(""fil
to organize Group'!R2C:R469C)-ROW('Script to organize

Group'!R2C)+1),ROWS('Script to organize Group'!R2C[1]:RC[1]))),"""")"
Selection.AutoFill Destination:=Range("A2:A9999"), Type:=xlFillDefault
Range("A2:A29").Select
End Sub
Answer
In each of your worksheets that is named after a Group, place this in A2:
=IFERROR(INDEX(Sheet1!B$2:B$7,SMALL(IF(Sheet1!A$2:A$7=MID(CELL
ROW(Sheet1!A$2)+1),ROWS(Sheet1!B$2:B2))),"")
This assumes you have the file saved somewhere. Enter this as an array (with
CTRL+SHIFT+ENTER) and drag down. You will have to adjust the ranges of
course. But, as you add Group/Keywords, the lists will update automatically.
Also, to return say Currency or Avg. Month, just change the first Index range
from B$2:B$7 to whatever new range, i.e. C$2:C$7.
edit: Change "Sheet1" to the main sheet with all your data:
=IFERROR(INDEX('Script to organize Group'!B$2:B$469,SMALL(IF('Script
to organize
Group'!A$2:A$469=MID(CELL("filename",A1),FIND("]",CELL("filename",A
to organize Group'!A$2:A$469)-ROW('Script to organize
Group'!A$2)+1),ROWS('Script to organize Group'!B$2:B2))),"") and again,
don't just press ENTER, press and hold CTRL+SHIFT, then ENTER.
Topic 682
Subject
Shortest code to load an excel sheet with header?
Question
I have an excel file, from which I want to load a specific sheet. Assuming I
know its name, and that there is only one row of header, what is the shortest
code capable of doing this? Answer
Using pandas' read_excel function you can do this:
import pandas as pd

df = pd.read_excel(FILENAME)
Your document will load into the df dataframe.
There are additional options you can pass to read_excel if you need to skip
rows, manipulate headers, parse dates, etc. too.
Answer
If you have pandas, it's really easy:
import pandas as pd
xl = pd.ExcelFile('file_name.xlsx')
sht = xl.parse('Sheet1')
Answer
Assuming you have xlrd installed,
from xlrd import open_workbook
# Load file
filename = 'file.xls'
sheet = open_workbook(filename).sheet_by_name('Data')
# Read data
header = [sheet.row(0)[i].value for i in range(sheet.ncols)] data =
[[sheet.row(i)[j].value for j in range(sheet.ncols)] for i in range(1,
sheet.nrows)]
Topic 683
Subject
Display x axis on chart in percentage with custom format in excel 2010
Question
We are trying to plot the follow data into a line chart showing x axis as 10%,
20% and etc. What's the right way to do it in excel 2010? We end up having
either 1% or 100% with #% or #\%. Many thanks.

x y
10.00 100000.00
20.00 50000.00
30.00 33333.33
40.00 25000.00
50.00 20000.00
Topic 684
Subject
User defined function in ms excel 2010 for fetching environ variable user name
does not work
Question
I created a user defined function in ms excel 2010 for fetching current logged
in user thru environvariable "USERNAME".
However, on some machines running ms excel2010 on win7, this function does
not update current user name.
I had packaged it in a protected worksheet and distributed to several users.
The udf code goes this way :
Public Function UserName()
UserName = Environ$("UserName")
End Function
Then the function is called using the formula:
=Username()
Answer
Consider
Public Function WhoAmI() As String
Application.Volatile
WhoAmI = "The NT Logon User is " & Environ("username") WhoAmI =
WhoAmI & vbCrLf & "The Office Username is " & Application.UserName

End Function
Should work on any Windows system.
Topic 685
Subject
Alternative way to disable shortcut in Excel
Question
In Excel 2007-2013 I used Application.OnKey to disable shortcuts
Application.OnKey("{F5}", "")
But in Excel 2016 it provokes crashes of Excel (it explodes later, then I press
F5). I suppose it is some bug in new Excel, maybe someday it is going to be
fixed, but right now I need a workaround, another way to disable shortcuts.
Any suggestions? Answer
I found how to avoid crashes:
First step is to set something else, not empty string in Application.OnKey
Application.OnKey("{F5}", " ")
If you just leave it alone, Excel will show the message about wrong macro
name.
I removed this message temporarily setting Application.DisplayAlerts = false
when key event happens:
static int HookCallback(int nCode, IntPtr wParam, IntPtr lParam) {
if (nCode < 0) {
return (int) WinApi.CallNextHookEx(hookID, nCode, wParam, lParam); }
if (nCode == HCACTION) { 
      ExcelAddIn.ExcelApp.DisplayAlerts = false; 
      ExecuteAsync(() => { 
          ExecuteInUIThread(() => { 

              OnKeyPress((uint) wParam); 
              Application.DisplayAlerts = true; 
          }); 
      }); 
}
return (int) WinApi.CallNextHookEx(_hookID, nCode, wParam, lParam); }
But after that I found that this bug is fixed already and fix version is goning to
be released soon (if not yet).
Topic 686
Subject
How use Perl to compare two Excel files cell by cell and print any differences
Question
For example
File 1:
Column x:1, 2, 6,….
Column y: 21, 2, 5..
File 2:
Column x: 1, 2, 6….
Column y: 21, 2, 1…
Output
mismatch in column y, 3rd row
Answer
Without writing the entire script for you, basically, what you want to do is:
Open both files.
Run through each cell and compare it to the cell in the other file. If there is a
mismatch, push that cell number to an array. When the file is done being read,
you either say there is no mismatch if the array is empty or you print each

element of the array line by line.
I encourage you to try it on your own as that is the best way to learn. If you
have any questions, we are more than happy to answer them.
To get you started, here is the command to open the files:
open(my $fh1, "<", "excel_file_1.xls") or die "Cannot open excel_file_1.xls:
$!"; open(my $fh2, "<", "excel_file_2.xls") or die "Cannot open
excel_file_2.xls: $!";
Topic 687
Subject
VBA Excel - Loop through worksheet creating tables
Question
Created this macro to go through the entire worksheet and format each section
as a table with a specific format.
I'm trying to loop through the entire worksheet where and format each section
as a table.
Each section is separated by one blank row.
Any ideas?
Sub Macro8()
Range("A3:B4").Select
ActiveSheet.ListObjects.Add(xlSrcRange, Range("$A$3:$B$4"), ,
xlYes).Name = _
"Table6"
Range("Table6[#All]").Select
ActiveSheet.ListObjects("Table6").TableStyle = "TableStyleLight9"
Selection.End(xlDown).Select
Selection.End(xlDown).Select
Range("A6:B7").Select
ActiveSheet.ListObjects.Add(xlSrcRange, Range("$A$6:$B$7"), ,

xlYes).Name = _
"Table7"
Range("Table7[#All]").Select
ActiveSheet.ListObjects("Table7").TableStyle = "TableStyleLight9"
Selection.End(xlDown).Select
Selection.End(xlDown).Select
Range("A9:D22").Select
ActiveSheet.ListObjects.Add(xlSrcRange, Range("$A$9:$D$22"), ,
xlYes).Name = _
"Table8"
Range("Table8[#All]").Select
ActiveSheet.ListObjects("Table8").TableStyle = "TableStyleLight9"
Selection.End(xlDown).Select
Selection.End(xlDown).Select
Range("A24:D37").Select
ActiveSheet.ListObjects.Add(xlSrcRange, Range("$A$24:$D$37"), ,
xlYes).Name = _
"Table9"
Range("Table9[#All]").Select
ActiveSheet.ListObjects("Table9").TableStyle = "TableStyleLight9"
End Sub
Answer
Give this a shot:
Sub MakeTables()
Dim ws As Worksheet
Set ws = Worksheets("Sheet1") 'change as needed
With ws
'find last row of data in column A

Dim lRow As Long
lRow = .Range("A" & .Rows.Count).End(xlUp).Row
Dim rngStart As Range
Set rngStart = .Range("A3")
'set counter variable for naming tables Dim i As Long
i = i + 1
Do 
      'create table range 
      Set rngTable = .Range(rngStart, rngStart.End(xlDown)) 
      'create table 
      .ListObjects.Add(xlSrcRange,
rngTable.Resize(rngTable.Rows.Count,
rngStart.End(xlToRight).column), , xlYes).Name = "Table" & i 
       'set style 
      .ListObjects("Table" & i).TableStyle =
"TableStyleLight9" 
      'find next table range start 
      Set rngStart = rngTable.End(xlDown).Offset(2) 
      i = i + 1 
Loop Until rngStart.Row > lRow
End With
End Sub
Topic 688
Subject
How to check for ending period in Excel?
Question
What formula can I use to check if there is a period on the end of my cell. If
there isn't add one. Thanks! Answer

Place this formula next to your cells you want to check (I used A1 as example).
=If(A1<>"",If(Right(A1,1)=".",A1,A1&"."),"")
If A1 is not empty (A1<>"") Then:
If the right most digit (Right(A1,1)) is a period =".", then return A1. If not a
period, then add a period to the text A1 & ".".
otherwise, if the cell is empty, just leave the space empty (,"")).
Topic 689
Subject
Applescript + InDesign Selecting Body Rows In Table
Question
I am currently trying to automate some data formatting. The source data is
formatted in Excel. The inDesign template is already formatted. I can right
click the table and select body rows then paste the data and it looks beautiful. I
am looking to remove this step but am unable to figure out how to get
applescript to select the table and body rows of the inDesign template. Neither
of the following seem to work.
set selection to body rows of table 1 of active document
select body rows of table 1 of active document
Any help on this would be great.
Answer
Unfortunately the select command only works for a single row, and not all of
the rows in a selected table.
Essentially, you must go row by and decide the row type. Once you've decided
the row is a body row, you can select it.
The syntax for adding a selected row to another selected row is super tricky,
especially without an example. See the complete script below.

tell application "Adobe InDesign CC 2015"
set allBodyRows to every row of every table of every story of active document
whose row type is body row
set bodyRow to {}
repeat with i from 1 to (count allBodyRows) 
      set bodyRow to item i of allBodyRows 
      if i = 1 then 
          select bodyRow 
      else 
          select bodyRow existing selection add to 
      end if 
end repeat
end tell
Answer
I think you need to reference your table differently. Try this:
set allTables to every table of every story of active document
set myTable to item 1 of allTables
Then you should be able to select rows:
tell table myTable
select first row
end tell
Topic 690
Subject
Export a multidimentional string array to a new Excel speadsheet
Question

Using Interop I managed to import an excel document (that contains a
population) to a multidimensional string array of this format :
public string[,] DataArray;
I used this method to populate the array :
try
{
Excel.Application xlApp = new Excel.Application(); xlWorkBook =
xlApp.Workbooks.Open(FilePath); Excel._Worksheet xlWorksheet =
xlWorkBook.Sheets[1]; Excel.Range xlRange = xlWorksheet.UsedRange;
rowCount = xlRange.Rows.Count;
colCount = xlRange.Columns.Count;
InitialiserTableauPopulation(rowCount, colCount); for (int x = 1; x <=
colCount; x++)
{
for (int y = 1; y <= rowCount; y++) {
DataArray[x - 1, y - 1] = xlRange.Cells[y, x].Value2.ToString(); }
}
xlApp.Workbooks.Close();
}
catch (Exception ex)
{
MessageBox.Show(ex.message);
}
While debugging, I can see that the format is correct, for every X (column
name), I have multiple Y (row data).
Example : DataArray[0,0] = NAME, DataArray[0,1] = JAMES,
DataArray[0,2] = ERIC, etc.
Now what I'm trying to do is take a sample of this population, make a new
multidimensional string array then export this "sample" to a new excel
document : but I'm lost.
How should I proceed to export an existing two dimensional string array to a

new excel sheet, keeping the same Array[column][row] format? Answer
You just need to create a new Excel.Application, add a new Excel.Workbook
and get the Excel.Worksheet from the Excel.Workbook.
Then you can iterate over your DataArray with a nested for-loop and add your
values as needed using the Cell-Property of the Excel.Worksheet.
Then you save your new workbook and close it appropriately. This could look
something like this
private void SaveDataArray(string excelFileName, string[,] dataArray) {
var xlApp = new Application();
var xlWorkBook = xlApp.Workbooks.Add(); var xlWorkSheet =
(Worksheet)xlWorkBook.Worksheets.Item[1];
for (int i = 0; i < dataArray.GetLength(0); i++) {
for (int j = 0; j < dataArray.GetLength(1); j++) {
xlWorkSheet.Cells[j + 1, i + 1] = dataArray[i, j]; }
}
xlWorkBook.SaveAs(excelFileName);
xlWorkBook.Close(true);
xlApp.Quit();
}
And then call the method like this
// create some sample data ...
string[,] dataArray = new string[1, 3];
dataArray[0, 0] = "NAME";
dataArray[0, 1] = "JAMES";
dataArray[0, 2] = "ERIC";
SaveDataArray("c:\\temp\\exceltest.xlsx", dataArray);
Answer

While I dont have a great answer for you, you didnt exactly give us the interop
you are using. First I would ask why you are trying to do this the hard way?
Can you not use a 3rd part lib like http://epplus.codeplex.com/
Topic 691
Subject
Determining summation of connecting flows with Excel table
Question
I am analyzing a field of interconnected pipelines. I need to determine the flow
rate inside each pipeline. There are 5 sources that contribute to all flow within
the pipelines. All flow eventually converges at a plant. The diagram looks like
this:
This diagram is derived from a table that is given, which looks something like
this:
From this data, and knowing the flow production from each source, I can
calculate the flow in each line. The flows are additive, and this is a simple
example. I.e. if source 3 and source 4 produce 300 m3/day and 200 300
m3/day respectively, then line 5 will have 500 m3/day of flow in it. For more
complex problems I am using excel sumproduct() to find the flow in it, in this
manner:
This method works, wherein I put a 1 under every column (source) which
contributes to each line and then these 1s are used to calculate the additive
total flow in each line. The problem is that I am doing this entry by hand, by
visual inspection of the diagram or start-end data. Is there a way to automate
the creation of the last table, directly from the data provided in the first table
(showing start/end points)? Or another method that would be able to calculate
each line's flow, without need for the final matrix calculation table?
Topic 692
Subject
C#: Insert Data to excel with different testcase
Question
I am trying to add an excel file for my automation service which keeps track of

my every test I have ran before. Below is an example of how I want to have my
excel file
Below are some things which is just for your knowledge related to my project.
Excel file to keep track.
Nunit 2.6.4 to run my project (Test cases). Microsoft access database engine
2010 for Login script. Selenium and Chrome Drivers.
ClosedXML Driver.
1. Using C# for automation
[Test]
public void TestExcel()
{
var wb = new XLWorkbook();
var dataTable = GetTable("Result");
// Add a DataTable as a worksheet
wb.Worksheets.Add(dataTable);
wb.SaveAs(@"..\..\Logs.xlsx");
FunctionTest objAbcTest = new FunctionTest(); objAbcTest.xlTest();
}
[Test]
public void SurfGoogle()
{
PropertiesCollection.driver.Navigate().GoToUrl("www.google.com"); }
private DataTable GetTable(String tableName) {
DataTable table = new DataTable();
table.TableName = tableName;
table.Columns.Add("Dosage", typeof(int)); table.Columns.Add("Drug",
typeof(string)); table.Columns.Add("Patient", typeof(string));
table.Columns.Add("Date", typeof(DateTime));

table.Rows.Add(25, "Indocin", "David", DateTime.Now);
table.Rows.Add(50, "Enebrel", "Sam", DateTime.Now); table.Rows.Add(10,
"Hydralazine", "Christoff", DateTime.Now); table.Rows.Add(21,
"Combivent", "Janet", DateTime.Now); table.Rows.Add(100, "Dilantin",
"Melanie", DateTime.Now); return table;
}
B. My excel File
C. Question
In which way I can add my function which the inserts data to excel via
ClosedXML function which I have added. Also how can I increment Id number
so that it adds incremented number in excel file and insert new data when ever
I run the NUnit.
Please advice what any other best way to do so. Also Excel is my requirement
Topic 693
Subject
How to apply conditional formatting formula to large range faster
Question
I created a conditional formatting formula
=AND(SUMPRODUCT(($A$2:$A$" & lastRow & "=$A2)*($CT$2:$CT$" &
lastRow & "=$CT2)*($CU$2:$CU$" & lastRow & "=$CU2)*($CV$2:$CV$"
& lastRow & "=$CV2)*($CW$2:$CW$" & lastRow & "=$CW2))>1,$CT2 <>
"""")"
To find & highlight duplicate upcharges based on multiple criteria: Product's
XID (Column A), Upcharge Criteria 1 (Column CT), Upcharge Criteria 2
(Column CU), Upcharge Type (Column CV), and Upcharge Level (Column
CW). The formula works like a charm highlighting upcharges that are
duplicates; however, much of the time I have to apply it to a large number of
rows (upwards of 15000) and it takes 10+ minutes to apply the conditional
format formula. I was curious if there is a quicker way of applying this formula
to that many cells. My entire code for reference is

'File Complete, highlights duplicate upcharges for products and skips over
blank upcharge rows Sub dupUpchargeCheck()
Dim lastRow As Integer
lastRow = ActiveSheet.Cells(Rows.Count, "CS").End(xlUp).Row
ActiveSheet.Range("CS2:CS" & lastRow).Select With
ActiveSheet.Range("CS2:CS" & lastRow)
.FormatConditions.Add Type:=xlExpression,
Formula1:="=AND(SUMPRODUCT(($A$2:$A$" & lastRow & "=$A2)*
($CT$2:$CT$" & lastRow & "=$CT2)*($CU$2:$CU$" & lastRow &
"=$CU2)*($CV$2:$CV$" & lastRow & "=$CV2)*($CW$2:$CW$" &
lastRow & "=$CW2))>1,$CT2 <> """")"
.FormatConditions(.FormatConditions.Count).Interior.ColorIndex = 3 End
With
End Sub
Any advice is appreciated!
EDIT
After toying around a bit, I've realized my problem isn't with the application of
the conditional formatting formula to the range of cells, but actually when I
click the drop down to filter on the color (after the code is ran and the
conditional formatting is applied) it takes forever for the filter dropdown box
to appear (I assume because all of the formulas calculating at that time?). Any
idea how I can get around that issue? I've tried one of @Nate suggestions of
calcState = Application.Calculation, placing it right before the line where I
filtered (via vba) in hopes that it would stop the calculations from running as
the system attempted to show the filter box, but it still takes forever. With the
addition Application.ScreenUpdating = False the processing time takes slightly
less time (timed around 551 seconds for 15000 rows). I'm afraid that might be
the best I'll be able to get it unless someone else has any suggestions? Answer
Try turning off some Excel features before your code then turning them back on
when it is done.

' turn off unnecessary excel features, put before your code screenUpdateState =
Application.ScreenUpdating statusBarState = Application.DisplayStatusBar
calcState = Application.Calculation
eventsState = Application.EnableEvents
displayPageBreakState = ActiveSheet.DisplayPageBreaks
Application.ScreenUpdating = False
Application.DisplayStatusBar = False
Application.Calculation = xlCalculationManual Application.EnableEvents =
False
ActiveSheet.DisplayPageBreaks = False
Then
' Turn features back on
Application.ScreenUpdating = screenUpdateState
Application.DisplayStatusBar = statusBarState Application.Calculation =
calcState
Application.EnableEvents = eventsState
ActiveSheet.DisplayPageBreaks = displayPageBreaksState
Answer
This didn't help me before, but I hope it help you as this link said :
This is particularly useful when condition is applied over a large range as
performance can be slow in these cases.
ActiveSheet.EnableFormatConditionsCalculation = False
'.....
ActiveSheet.EnableFormatConditionsCalculation = True
Maybe this not work on MAC.
ActiveSheet.EnableFormatConditionsCalculation Not Supported in VBA for
Excel 2011 on the Mac
Topic 694

Subject
Parse HTML file and fill rows in excel using only a VBA macro
Question
I have a folder full of HTML files that have extensive info in the headers. I'd
like to grab and drop into an Excel worksheet using only VBA (yes, I know this
is more easily done in Python or C++ or anything else but nope - it must be
done as an excel macro).
Setup: I need the header title as column text and the header fields (stuff that
follows the <Header>) from each file to fill the rows in the worksheet (so one
row for each file).
Begin Sample Header (also available
http://www.sec.gov/edgar/searchedgar/sampleheader.htm)
<SEC-HEADER>0000000011-99-000001.hdr.sgml : 19990105
<ACCESSION-NUMBER>0000000011-99-000001
<TYPE>24F-2NT
<PUBLIC-DOCUMENT-COUNT>1
<PERIOD>19981130
<FILING-DATE>19990104
<FILER>
<COMPANY-DATA>
<CONFORMED-NAME>MEGAHEPTA SUPER GROWTH FUND
<CIK>0000000011
<ASSIGNED-SIC>
</COMPANY-DATA>
<FILING-VALUES>
<FORM-TYPE>24F-2NT
<ACT>33
<FILE-NUMBER>033-11111
<FILM-NUMBER>11100011
</FILING-VALUES>
<BUSINESS-ADDRESS>
<STREET1>123 MAIN STREET
<STREET2>SUITE 1111-Q
<CITY>FILINGTON

<STATE>NY
<ZIP>12121
</BUSINESS-ADDRESS>
<FORMER-COMPANY>
<FORMER-CONFORMED-NAME> MEGA SUPER GROWTH FUND
<DATE-CHANGED>19950801
</FORMER-COMPANY>
</FILER>
</SEC-HEADER>
Topic 695
Subject
VBA move files - not working
Question
I am trying to move files with VBA code. I am using the code below within a
loop:
(...)
If Dir(OldFile) <> "" Then
MsgBox "File exists."
Else
MsgBox "File doesn't exist."
End If
Dim objFSO As Object
Set objFSO = CreateObject("scripting.filesystemobject") objFSO.MoveFile
Source:=OldFile, Destination:=PIDFilePath & SubFolderName & "\" &
NewFileName
'Name OldFile As PIDFilePath & SubFolderName & "\" & NewFileName
(...)
Some files are being moved within the loop but on certain files the code

generates error:
'76' Path not found (using object.movefile) or
'56' File not found (using Name command)
The test above the moving code is always positive and says the file exist.
The files that work with the code and those that not are of the same type and
similar name structure
Any ideas why it does not work?
Topic 696
Subject
Dynamic For Loop Range and Text To Columns after last row with data
Question
I'm using Excel VBA to access an API and download a CSV file based on a
Load ID parameter.
Within the API URL is the Load ID parameter which identifies the correct CSV
to be downloaded. Another macro I have created downloads all the Load ID's
that I require and pastes them into a range on the spread sheet starting at A4.
The number of Load ID's is variable, and the load ID's are obtained from a
different API URL. The macro that fetches the load ID's works fine but I'll put
the code here so I can refer to it later:
Function onlyDigits(s As String) As String Dim retval As String
Dim i As Integer
retval = ""
For i = 1 To Len(s)
If Mid(s, i, 1) >= "0" And Mid(s, i, 1) <= "9" Then
retval = retval + Mid(s, i, 1)
End If

Next
onlyDigits = retval
End Function
Sub getLoadIdsAfter()
Dim LoadIDsAfter As String
Dim LoadIDsAfterUrl As String
Dim startLoadID As String
startLoadID = Worksheets("Config").Range("C1").Value LoadIDsAfterUrl =
"https://blahblah.com/?" + startLoadID
proxyServer = Worksheets("Config").Range("F1").Value
Set httpReq = CreateObject("WinHttp.WinHttprequest.5.1")
httpReq.Open "GET", LoadIDsAfterUrl, False
httpReq.setRequestHeader "Content-Type", "text/xml" httpReq.setProxy 2,
proxyServer, ""
httpReq.setTimeouts -1, -1, -1, -1
httpReq.send request
LoadIDsAfter = httpReq.ResponseText
Dim loadID As String
loadID = onlyDigits(LoadIDsAfter)
'MsgBox loadID
Dim i As Integer
For i = 1 To (Len(loadID) / 10)
Worksheets("Config").Range("A" & (3 + i)).Value = Mid(loadID, ((i * 10) -
9), 10) Next
End Sub

The part I am stuck on is looping through the range of load ID's created by the
above script and for each load ID, download the CSV and apply text to
columns to insert it into the new worksheet created by the macro. Each CSV
downloaded needs to be inserted in the same worksheet below the previous
data.
Problems
1) Defining a dynamic for loop range 2) Inserting the downloaded data
below the previously inserted data, or the next row after the last one that
contains data.
Sub getData()
ActiveWorkbook.Sheets.Add after:=Worksheets(Worksheets.Count)
ActiveSheet.Name = "Data"
Dim loadID As Range
Dim currentLoadID As String
For Each loadID In Sheets("Config").Range("A4:A10")
Worksheets("Config").Range("F2").Value =
Application.WorksheetFunction.Text(loadID.Value, loadID.NumberFormat)
currentLoadID = Worksheets("Config").Range("F2").Value
With ActiveSheet.QueryTables.Add(Connection:= _
"URL;https://blahblah.com/?" + currentLoadID + "blahblah/" _ ,
Destination:=Range("$A$1"))
.FieldNames = True
.RowNumbers = False
.FillAdjacentFormulas = False
.PreserveFormatting = True
.RefreshOnFileOpen = False
.BackgroundQuery = True
.RefreshStyle = xlInsertDeleteCells .SavePassword = False
.SaveData = True
.AdjustColumnWidth = True
.RefreshPeriod = 0

.WebSelectionType = xlAllTables
.WebFormatting = xlWebFormattingNone .WebPreFormattedTextToColumns =
True .WebConsecutiveDelimitersAsOne = True .WebSingleBlockTextImport =
False
.WebDisableDateRecognition = False
.WebDisableRedirections = False
.Refresh BackgroundQuery:=False
End With
Columns("A:A").Select
Selection.TextToColumns
Destination:=Range("A1048576").End(xlUp).Offset(1, 0),
DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
Semicolon:=False, Comma:=True, Space:=False, Other:=False, FieldInfo _
:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 1),
Array(6, 1), _ Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11,
1), Array(12, 1), Array(13, 1 _ ), Array(14, 1), Array(15, 1), Array(16, 1),
Array(17, 1), Array(18, 1), Array(19, 1), Array _ (20, 1), Array(21, 1),
Array(22, 1)), TrailingMinusNumbers:=True Cells.EntireColumn.AutoFit
Range("A1").Select
Next
End Sub
Finally as a side note, if anyone can find a way to combine these two scripts so
that I don't have to paste the load ID's into a range on the worksheet that I then
have to refer to using the second script, that would be rather elegant. The
problem I have is that the API which provides the Load ID's gives them in this
raw JSON format that looks like this:
{"loadid":"1454517300"}
And if there are multiple ones, and in most cases there are over 300 of them,
the first macro treats the array as a string, extracts the numbers using the
function at the top and then splits them because each one is 10 digits long.

Topic 697
Subject
Which mechanism allows Excel to communicate users' manipulations to
outside?
Question
Excel provides several options for developing applications that interface with
it. But it seems that all these options permits of controlling Excel workbooks
from outside. However, I want the other way around, precisely I would like to
"listen to" users' manipulations on Excel workbooks. For example, the listener
may be an add-in in Excel; when a user enter a value in a cell, the listener
could catch this action, and print on the screen "enter value XXX in cell
XXX". Does anyone know which mechanism is available to realise this?
Edit 1:
Thanks for the inputs of @Nathan_Sav and @Rik Sportel . So if I understand
well, they are using VBA to listen to events and generate messages, and almost
all the events can be caught.
Let me elaborate what I really want to do. Actually, I want to have an
application outside Excel (e.g., written in Python or .NET), and the application
can do some operations according to users' manipulations on workbooks. If the
application has to read the messages generated by the VBA listener, then parse
them, then do corresponding operations, I am afraid that would be slow. Is
there a direct (or inner) way to let the application connected to Excel and
listen to users' manipulations. Answer
Nathan is already pointing in the right direction. However it could be done
cleaner.
First, you're gonna need the Listener class. Place the following in a class
module that you call "EventLogger"
Private WithEvents ExcelListener As Excel.Application
Private Sub Class_Initialize()
Set ExcelListener = Application

End Sub
Private Sub excelListener_SheetChange(ByVal Sh As Object, ByVal Target As
Range)
MsgBox Sh.Name & "!" & Target.Address & " changed into " & Target.Value
End Sub
'Hook into any other events you wish.
In the Workbook Module place the following in Workbook_Open()
Public Sub Workbook_Open()
Set evLogger = New EventLogger
End Sub
Private Sub Workbook_BeforeClose(Cancel As Boolean)
Set evLogger = Nothing
End Sub
Since the Initialize event of the class already sets the application, no more is
needed.
Lastly you need a regular module that has the global variable EventLogger:
Public evLogger As EventLogger
Now instead of the messagebox you could open a logfile and write every
event, just append a huge string in memory and write it to a text file on close,
log every single event, or whatever you want. Just expand the class to hold
username, etc., be creative :)
Save the whole workbook as an add-in and install in into user's Excel. Enjoy!
When you only wish to track changes for a specific workbook, you can always
use the native change tracker as documented here:
https://support.office.com/en-us/article/Track-changes-in-a-shared-workbook-
22aea671-cac7-4fa3-845d-eeb23725bd15

Answer
You can event sink the Excel application,(in an addin to control all Excel
sheets), via using an class with an Excel application object, using the with
events statement
so something like (not tested as no access to vba at mo)
in a class clsExcelListner
private withevents excelListner as Excel.Application
public sub initialise(ExcelApp as Excel.Application)
set excelListner =ExcelApp
end sub
Then in Workbook Open
public cls_ExcelListner as clsExcelListner public sub Workbook_Open()
set cls_ExcelListner = new clsExcelListner
cls_ExcelLister.Initialise(application)
end sub
In the class, you can then use the worksheet change event. These events that
will help you do what you need are already in the workbook, things like
worksheet change etc, may just be best to use those, as a listner would need to
take into account all documents, and say the user savesAs, then how do you
check its a doc to be listened to?
Topic 698
Subject
Searching for specific data, and copying it to current document
Question
I have created one macro to list all of the files that I need to grab data from in
the first column of an Excel spreadsheet. Is it possible to search each of the

files in the column and locate specific data using key words. For example the
first column of my master document is:
file1
file2
file3
I want to search file1 then file2... for a keywords "alpha" "beta" "gamma" and
then copy the numbers below those cells into a table in the master document. Is
this possible, if so what avenue should I go down? Answer
Well, i would like to give another answer but, @RickSportel give a very good
advice.
Hope this will help.
Sub findDataIntoFiles()
Dim r
Dim findValues() As String 'heres goes all the values you want to search Dim
Wrbk As Workbook 'to store every workbook Dim This As Workbook 'to store
this workbook, where you got the macro Dim sht As Worksheet 'to store every
sheet of the workbooks Dim i
Dim tmp
Dim counter
Dim c As Range
Dim firstAddress
Dim rng As Range 'the range with the files full path of the file names 
                   'Not just the names 
                   'or 
                   'if all the files are in the same folder,
you can put the path 
                   'on a var, and concatenate the path with
each file name 
ReDim findValues(1 To 3) 'here redim the var, but you can declare it with the
capacity you want findValues(1) = "Alpha"
findValues(2) = "Beta"

findValues(3) = "Gamma"
counter = 0
r = Range("A1").End(xlDown).Row 'to search the last row of the data with the
workbooks names Set rng = Range(Cells(1, 1), Cells(r, 1)) 'all the data is in
column A Set This = ThisWorkbook 'storing this workbook
For Each tmp In rng 'run this for every cell with the workbooks names 
      Workbooks.Open tmp 'the open the workbook 
      Set Wrbk = ActiveWorkbook 'store it ot use it 
      For Each sht In Wrbk.Worksheets 'here, for every sheet
inside the workbook that i opened 
          For i = 1 To 3 'the qty of data inside findValues
var'for every data inside the var 
              With sht.Range(Cells(1, 1),
Range("A1").SpecialCells(xlCellTypeLastCell)) 
              'find inside the cells A1 and the LastCell of
the sheet 
              Set c = .Find(findvalue(i), LookIn:=xlFormulas)
'you can chage ir to "xlValues" 
                  If Not c Is Nothing Then 
                      firstAddress = c.Address 
                      Do 
                          'This.Activate'go back to the macro
workbook and store the data found 
                          tmp.Offset(0, 1).Value = tmp.Value
'the name/fullpath/path of the workbook 
                          tmp.Offset(0, 2).Value = sht.Name &
"\" & c.Address 'Sheet and address of the cell 
                          Set c = .FindNext(c) 'go to the
next one 
                          counter = counter + 1 'and index
for the columns where you will store the data 
                      Loop While Not c Is Nothing And
c.Address <> firstAddress 
                  End If 
              End With 
          Next 
      Next sht 
Next tmp
End Sub

And this is basic, you need to itenerate over the cells with the workbooks
names, if there is the full path just take that, but if not take the path (directory)
where the files are and then concatenate and open the workbooks with
Workbook.Open
And go over every sheet of each worbook, and find the data you want.
Edit #1
As you ask in the comments this could give you the next cells where you found
the seach string
c.Address ===> Gives you the address (string) of the found cell ex. $G$4
c.offset(2,2).address ===> gives you the cell moving two rows and two
columns from `c` and returns $I$6. If you put negative numbers you rest rows
and columns.
Answer
This is possible. Just use Workbooks.Open as documented here:
https://msdn.microsoft.com/en-us/library/office/ff194819.aspx As a filename,
just pass the cell value that holds said filename.
Very basic example: Say cell A1 on Worksheets(1) holds the filepath +
filename of the file you want to open.
Sub OpenFile()
Dim wb as WorkBook
Dim fRange as range
Set wb = Application.Workbooks.Open(Worksheets(1).Range("A1").value)
With wb
set fRange = .Sheets(1).Range("1:1").find("Alpha") 'Assuming Alpha is a
header in row 1 'Do stuff with the cells below the found range End With
Set fRange = Nothing
Set wb = Nothing
End Sub

You might want to store the ActiveWorkbook / ActiveSheet / Any reference to
your mastersheet in a variable as well in order to make sure you can copy-
paste from the right place to the right place.
Topic 699
Subject
Find and Comparison in Excel
Question
Lets say I have 4 columns and there names are A,B,C and D. My datas in
column A are Apple,Orange and Mango and My Datas in column B is 1,2 and
3.
On otherside my data in column C are Grapes,Apple and Banana and in column
D is 1,1 and 3.
My Question here is this, How can column C find the same data that it has in
column A? And in case the data finds it how can the data in column D compare
the data in column C?
Example
Find the Apple in column A and check if both of them has the same exact
value in B and D.
As of now I dont know what formula to be use.
Note
-If comparison is true then message is Match else Not Match. -Failed will
be the message if the data in column C doesent find anything in column A
Answer
in column E write:
=IF(ISERROR(VLOOKUP(C1,A:A,1,0)),"Fail",IF(VLOOKUP(C1,A:B,2,0)=D
Match"))
Topic 700
Subject

Error 400 when protecting a worksheet
Question
Based on the value of a particular cell I need to, potentially, unprotect a
worksheet, set a range to locked and reprotect the worksheet. Conversely if the
value of the cell (in this case cell B4 is equal to "work") then I need to
unprotect the worksheet, unlock the cells, and then reprotect the worksheet.
The reason for this is that I want to stop the user tabbing to cells A8:B19 when
cell B4 is not equal to work. When B4 = "work" the user can input numbers
into cells A8:B19. There are limited options to input when B4 <> "work" and I
have the setting to only tab between unlocked cells checked which makes input
easier.
Currently I have this:
Private Sub Worksheet_Change(ByVal Target As Range) If Not
Intersect(Target, Range("B4")) Is Nothing Then If Range("B4").Value = "work"
Then
Shapes("Rectangle 1").Visible = False Application.EnableEvents = False
ActiveSheet.Unprotect
ActiveSheet.Range("A8:B19").Locked = True ActiveSheet.Protect ‘When the
code hits this line it throws error 400 Application.EnableEvents = True
End If
If Range("B4").Value <> "work" Then
Shapes("Rectangle 1").Visible = True Application.EnableEvents = False
ActiveSheet.Unprotect
ActiveSheet.Range("A8:B19").Locked = True ActiveSheet.Protect ‘When the
code hits this line it throws error 400 Application.EnableEvents = True
End If
End If
End Sub
Clearly it depends on the value of cell B4 as to which "ActiveSheet.Protect"
causes the error to occur, but it always does. Commenting out the offending
line allows the VBA code to run as expected aside however it leaves the
worksheet unlocked. I've tried moving the "ActiveSheet.Protect" line to further

down the sub, calling it in a different sub etcetera and no luck, it always causes
error 400. I'm aware that Elseif would no doubt be better practise however I
changed from If, ElseIf End If to see if it made any difference. It didn't.
Curiously, I tried a similar thing to prove the principle in another Excel sheet
with the following code:
Private Sub Worksheet_Change(ByVal Target As Range) If Not
Intersect(Target, Range("A1")) Is Nothing Then
Dim i As Integer
If Cells(1, 1) = "unlock" Then 
      i = 1 
      Shapes("Oval 1").Visible = False 
      Application.EnableEvents = False 
      ActiveSheet.Unprotect 
      For i = 1 To 5 
          Cells(i, 2) = i 
      Next i 
      ActiveSheet.Range("C1:C5").Locked = False 
      ActiveSheet.Protect 
  ElseIf Cells(1, 1) <> "unlock" Then 
      i = 1 
      Shapes("Oval 1").Visible = True 
      Application.EnableEvents = False 
      ActiveSheet.Unprotect 
      For i = 1 To 5 
          Cells(i, 2) = "" 
          Cells(i, 3) = "" 
      Next i 
      ActiveSheet.Range("C1:C5").Locked = True 
      ActiveSheet.Protect 
End If
Application.EnableEvents = True
End If
End Sub
This works exactly as I'd expect, and doing a similar thing. Aside from the
different cells and a for loop I can't see any difference between the two
samples of code above with regards to the unprotect, change locked variable,

protect process.
Baffled, any help much appreciated.
Answer
Use the UserInterfaceOnly argument - this protects the sheet, but still allows
any programmatic changes to occur without the need to unprotect and reprotect:
Sheets("Some Sheet").Protect Password:="Pass123", UserInterfaceOnly:=True
Sheets("Some Sheet").Range("A1").Value = "Foo" '// code runs without error
You can use the Workbook_Open event to ensure any required sheets are
locked in this way and then there's no need to manage it in any further code:
Private Sub Workbook_Open()
For Each ws In ThisWorkbook.Sheets
ws.Protect UserInterfaceOnly:=True
Next
End Sub
Topic 701
Subject
VBA Excel getattr function doesnt work for web URLs?
Question
I want to learn if a file is in use at Onedrive. For that purpose I am using getattr
function like this:
Dim strFullFilename As String
strFullFilename =
"https://d.docs.live.net/679d90ashug46/Excelshare/samplefile_V1.xlsx"
If (GetAttr(strFullFilename) And vbReadOnly) = 1 Then MsgBox ("File is
read only!")
Exit Sub
End If

But it gives Error 52 (bad file name)
Any suggestions?
Topic 702
Subject
Need to select Excel range of cells from A1 to found text from imported text
file
Question
First time poster -
I have just imported a un-formatted text file into a worksheet. I need to select
and delete the rows of data from Cell A1 to the words "NoRx Report"
What would be the code to do that????
Thanks in advance for your assistance
James
Answer
This will delete the rows up to and including the row with the text:
Sub dural()
Range(Range("A1"), Range("A:A").Find(what:="NoRx Report",
after:=Range("A1"))).EntireRow.Delete End Sub
Topic 703
Subject
Loading Set Macro's and Removing Set Macros
Question
When I open Excel, automatically a workbook is loaded containing macros. I
think a binary file? or in a personal macro set? How can I edit this? How do I
stop these from loading and perhaps load other general macros instead?
My purpose is to load my most common macros across any workbook at any
time so I don't have to go hunting for them each time.

Topic 704
Subject
Can't get my SQL server to work with Excel 2013
Question
I want to view my database and tables in the Excel.
So I have my SQL server all set up (it shows on the SQL workbench that the
server is "Running"). However, when I try to connect to my SQL server through
Excel Power Query, after typing down my server ip it gives me an error,
"Unable to connect" (provider:Names Pipes Provider, error 40 - Could not
open a connection to SQL server).
I have tried googling and I couldn't find something relevant. I mean it says that
the server is clearly running at the SQL workbench, also, most of the answers I
found are outdated.
I am running Windows 7 64 bit, Excel 2013, SQL server 5.7
UPDATE
I have installed Visual Studio Tools for Office, so that I can install 'MySQL for
Excel' Add-in. When I did I could connect to my database and export it to
Excel! :)
Thank you everyone for trying to help! You are AWESOME :D
Topic 705
Subject
how to get real formula from EXCEL formula
Question
| A | B
------|-----|--------
1 | x | 1
2 | y | 2
3 | z | 3

4 | a | =B1*B2+B3
imagine the above stuff is part of an excel sheet, and B4 has a formula
=B1*B2+B3.
Is it possible to extract the real formula from excel formula? i.e. in the above
example, the real formula is a=x*y+z
the reason why i want to do the "transformation" is that I have many excel
sheets filled with data and formulas, and now I want to quit Excel and use
javascript for calculation, so I want to have the real formulas . Answer
After defining what it is that you are after, I think a VBA solution is the way to
go. And since you noted that it was acceptable, I have provided one for you.
The following Function will return the string a=x*y+z and will work so long as
all your formulas are set up exactly in the manner given in your example.
Function ListRealFormula(rng As Range, ws As Worksheet) As String
Dim sFormula As String
sFormula = rng.Offset(, -1) & rng.Formula
With rng
Dim d As Range
For Each d In .DirectPrecedents 
      Dim sValue As String, sAdd As String 
      sAdd = d.Address(0, 0) 
      sValue = ws.Range(sAdd).Offset(, -1).Value2 
      sFormula = Replace(sFormula, sAdd, sValue) 
Next
End With
ListRealFormula = sFormula

End Function
You can call the function like so:
Sub GrabFormula()
Dim s As String
s = ListRealFormula(Sheet1.Range("B4"), Sheet1) Debug.Print s
End Sub
Answer
@Wyatt, you have the first part right, but it's not sufficient: once you have
clicked the "Show Formulas", you also need to to "Goto Special, Formulas"
(Ctrl+G, Special, Formulas). As you have clicked the "Show Formulas", you
now do copy/paste into some text editor, and you have all the formulas, used in
your Excel sheet.
Topic 706
Subject
Unwanted Cells being added to CSV
Question
I am attempting to upload a large csv file into a wordpress newsletter plugin.
The problem I am having is that when I export the data I need from the db
(mysql) and I look at in in excel, it seems that all of the info is in the right
columns and rows. However, when I upload it to the plugin some of the data
shifts and empty cells seem to have been added, so that the info does not
import into the correct fields in the plugin. About 10% of the data seems to be
getting corrupted. I have reached out to the plugin creator about this, but I was
wondering if this is something that other people have seen, could it be an excel
issue or something I'm missing? Is it possible that hidden cells are being added
when I view/sort the data in the csv file before uploading? Any help would be
appreciated!
Topic 707

Subject
vb.net to insert txt file values into template Excel to different columns
Question
Related to -> Vb.net to insert txt.file into template Excel
As you can see in my previous post, i want to add text file values to sheet1 of
my previous templated excel. The code i had was something like this :
Private Sub Button1_Click(sender As Object, e As EventArgs) Handles
Button1.Click Dim inFile As String() = File.ReadAllLines(TextBox1.Text) -
>path to txt source
xlWorkBook = xlApp.Workbooks.Open(TextBox2.Text) ->path to templated
Excel xlApp.Visible = True
xlWorkSheet = xlWorkBook.Sheets("data") For x As Integer = 0 To
inFile.Length - 1
xlWorkSheet.Rows(x + 1).Cells(1).value = inFile(x) Next
End Sub
But at this point i found out that using that method i'm not able (or am i?) to
define which txt lines go to which rows, with which delimiter and so on.. I've
been looking for info about excel.application.workbooks.open method but i
don't see how to insert txt values to an existing excel file ( yet i can choose my
rows and so on, formatting the data the way i need).
Dim oApp As Excel.Application
Try
oApp = DirectCast(CreateObject("Excel.Application"), Excel.Application)
oApp.Workbooks.OpenText(Filename:=TextBox1.Text, _
Origin:=Excel.XlPlatform.xlMSDOS, _
DataType:=Excel.XlTextParsingType.xlDelimited, _ 
                              Comma:=False, Semicolon:=True,
_ 
                              StartRow:=1) 

oApp.Visible = True
oApp.Workbooks.Item(TextBox2.Text).SaveAs(Filename:=TextBox2.Text +
"xls", _ FileFormat:=Excel.XlFileFormat.xlWorkbookNormal)
oApp.Workbooks.Item(TextBox2.Text + "xls").Close(SaveChanges:=False)
oApp.Quit()
oApp = Nothing
'MessageBox.Show("Done", "Done", MessageBoxButtons.OK) ' Catch ex As
Exception
' MessageBox.Show(ex.Message.ToString, "Error", MessageBoxButtons.OK)
End Try
This code works properly, yet i can't add the values to an exisiting excel file.
can someone guide me here? i don't mind make another project from scratch if
you think there's a better way . Thank you ! Answer
Well, here's what i kinda did.
I changed some code in order to complete my objective. I added a
datagridview to store the text file values ( i know it's possible simply inserting
to a querytable ) and then inserted the values from it to the excel template.
'inserting the values to datagridview
Dim sw = System.Diagnostics.Stopwatch.StartNew()
Using stream As System.IO.FileStream =
System.IO.File.OpenRead(TextBox1.Text) 'path
Using reader As New System.IO.StreamReader(stream)
Dim line As String = reader.ReadLine() 
          While (line IsNot Nothing) 
              Dim columns = line.Split(";") 
              line = reader.ReadLine() 
              Dim index = Me.DataGridView1.Rows.Add() 
              Me.DataGridView1.Rows(index).SetValues(columns)

          End While 
      End Using 
End Using
sw.Stop()
'inserting datagridview values to excel Dim misValue As Object =
System.Reflection.Missing.Value
Dim i As Integer
Dim j As Integer
xlApp = New Microsoft.Office.Interop.Excel.Application xlWorkBook =
xlApp.Workbooks.Open(TextBox2.Text) xlWorkSheet =
xlWorkBook.Worksheets("dados") For i = 0 To DataGridView1.RowCount - 1 
      For j = 0 To DataGridView1.ColumnCount - 1 
          For k As Integer = 1 To DataGridView1.Columns.Count
              xlWorkSheet.Cells(i + 1, j + 1) =
DataGridView1(j, i).Value 
          Next 
'(...)
xlWorkBook.Close()
xlApp.Quit()
Topic 708
Subject
Why does ActiveSheet fail
Question
WB.Sheets(2).Activate
WB.Sheets(2).Select 
       With WKS 
          .Range(.Cells(3, 3), .Cells(ClientRows, SavedColumn
- 1)).Locked = False 
          .Range(.Cells(3, 3), .Cells(ClientRows, SavedColumn

- 1)).FormulaHidden = False 
      End With 
      With WKS 
          .Range(.Cells(3, 1), .Cells(ClientRows, 1)).Locked
= False 
          .Range(.Cells(3, 1), .Cells(ClientRows,
1)).FormulaHidden = False 
      End With 
      ActiveSheet.Protect DrawingObjects:=True,
Contents:=True, Scenarios:=True 
      ActiveSheet.EnableSelection = xlUnlockedCells 
I am looping through a data table and producing multiple Excel worksheets.
The attached code works perfectly the first time but the fails with "Object
Variable or With Block variable not set". Can anyone help. Thanks Answer
Here is my answer:
Option Explicit
Sub TestActivesheet()
Dim WB As Workbook 'Declare de vars Dim WKS As Worksheet
Set WB = ThisWorkbook 'Or any other workbook || set the var
WB.Sheets(2).Activate
WB.Sheets(2).Select
Set WKS = WB.Sheets(2) 'Again set the var
With WKS 
      .Range(.Cells(3, 3), .Cells(ClientRows, SavedColumn -
1)).Locked = False 
      .Range(.Cells(3, 3), .Cells(ClientRows, SavedColumn -
1)).FormulaHidden = False 
End With
With WKS 

      .Range(.Cells(3, 1), .Cells(ClientRows, 1)).Locked =
False 
      .Range(.Cells(3, 1), .Cells(ClientRows,
1)).FormulaHidden = False 
End With
'ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
WKS.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
'ActiveSheet.EnableSelection = xlUnlockedCells WKS.EnableSelection =
xlUnlockedCells End Sub
Always in the top of every module, is a good practice to use this Option
Explicit, this way when you use a variable, the compiler ask you to declare it,
and avoid this errors.
Topic 709
Subject
Google Sheets - Adding multiple cells from 1 sheets referencing a list from
another
Question
So, I've been looking and trying to work this out for a while, but still haven't
got anywhere, so asking for help.
I've got two Google Sheets.
Data
The Query
The idea is to total the number in the 2nd column on the example numbers sheet
with reference to the list on the example query 2nd tab number list and put the
total in the relevant month on the example query data tab.
As you can see, I've got it working with a query=
QUERY( ImportRange(
"1wgi_Q9wTHvVx37p6qNUyZzaXSeLJsS2Zl7KI1v0xgJo" , A2 & "!A:B" ) ,

"select Col2 where Col1 = "&'number list'!$A$2 , 0 )
But, this only looks for the first number in 'number list'!$A$2
Topic 710
Subject
Reading an open Excel file
Question
I am trying to read an Excel file with odbcConnectExcel2007 function from
RODBC package. It works fine when the file is not in use. But when it is, I get
the error:
Warning messages: 1: In odbcDriverConnect(con, tabQuote = c("[", "]"), ...) :
[RODBC] ERROR: state HY000, code -1028, message [Microsoft][ODBC
Excel Driver] Cannot open database '(unknown)'. It may not be a database that
your application recognizes, or the file may be corrupt. 2: In
odbcDriverConnect(con, tabQuote = c("[", "]"), ...) : ODBC connection failed
I have also tried to include readOnly = TRUE in the function specification, but
still no luck. Any ideas anyone? Answer
Try using the read_excel() function from the readxl package - it will allow you
to read an Excel file into R while the file is in use.
Topic 711
Subject
Excel- counter for every hour
Question
I have some dates with time in my excel sheet, i was just wondering if there
was a day to have a counter for each time it occurred in that hour. For example,
01-Jan-2015 05.04.18
01-Jan-2015 05.55.24
01-Jan-2015 06.01.45

02-Jan-2015 09.11.32
So there is 2 occurrences in the 05 hour of 1st Jan, 1 occurrence in 06 hour etc.
I would count it manually but there are over 10,000 lines.
Any idea how I could use a formula to set a counter, would I use COUNTIF, or
concatenate it first?
I’m sorry if this sounds a little bit stupid, I am just a beginner.
Thanks for your help
Answer
If you have all the date occurrences in Sheet1, column A. You could have a list
of hours in column A of a second sheet (01-Jan-2015 05.00, 01-Jan-2015
06.00, 01-Jan-2015 07.00 etc.). In column B in that sheet you place a
COUNTIFS formula which counts all date occurrences between the date and
hour in column A and column A + 1 hour:
=COUNTIFS(Sheet1!A:A,">=" & A1,Sheet1!A:A,"<" & A1+(1/24))
See COUNTIFS function for reference.
Topic 712
Subject
colour is not getting set to workbook
Question
I am using java workbook xls but i am unable to set the color.I am using the
following code.
CellStyle cellStyle = sheet.getWorkbook().createCellStyle();
cellStyle.setFillBackgroundColor(HSSFColor.DARK_RED.index);
Cell celli = row0.createCell((short) i);
celli.setCellValue(list.get(i).toString()); celli.setCellStyle(cellStyle);
I am using the cellstyle but color is not being set. Answer

You should use
cellStyle.setFillForegroundColor(HSSFColor.DARK_RED.index);
cellStyle.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND);
instead of
cellStyle.setFillBackgroundColor(HSSFColor.DARK_RED.index);
Topic 713
Subject
Position picture horizontaly in center
Question
I want to position picture in center of range, but it just doesn't work for me.
Maybe anybody knows how to do it? Here is my code:
Sub InsertPictureInRange(PictureFileName As String, TargetCells As Range)
Dim p As Object, t As Double, l As Double, r As Double, b As Double Dim
aspect
Dim w, h
If TypeName(ActiveSheet) <> "Worksheet" Then Exit Sub If
Dir(PictureFileName) = "" Then Exit Sub l = 1: r = 22 ' co-ordinates of top-
left cell t = 47: b = 88 ' co-ordinates of bottom-right cell Set TargetCells =
Range("A47:V88")
Set p = ActiveSheet.Pictures.Insert(PictureFileName) With p 
   With .ShapeRange 
        .LockAspectRatio = msoTrue    ' lock the aspect ratio
(do not distort picture) 
        aspect = .Width / .Height     ' calculate aspect
ratio of picture 
        .Left = Cells(t, l).Left      ' left placement of
picture 
        .Top = Cells(t, l).Top        ' top left placement of
picture 
   End With 
   w = (Cells(b, r).Left + Cells(b, r).Width - Cells(t,
l).Left)  ' width of cell range 
   h = Cells(b, r).Top + Cells(b, r).Height - Cells(t, l).Top
   ' height of cell range 

   If (w / h < aspect) Then 
      .ShapeRange.Width = w           ' scale picture to
available width 
   Else 
      .ShapeRange.Height = h          ' scale picture to
available height 
   End If 
   .Placement = 1 
End With
Set p = Nothing
End Sub
Answer
Found out answer:
Sub InsertPictureInRange(PictureFileName As String, TargetCells As Range)
Dim p As Object, t As Double, l As Double, r As Double, b As Double Dim
aspect
Dim w, h
If TypeName(ActiveSheet) <> "Worksheet" Then Exit Sub If
Dir(PictureFileName) = "" Then Exit Sub l = 1: r = 22 ' co-ordinates of top-
left cell t = 47: b = 88 ' co-ordinates of bottom-right cell Set TargetCells =
Range("A47:V88")
Set p = ActiveSheet.Pictures.Insert(PictureFileName) With p 
       With .ShapeRange 
            .LockAspectRatio = msoTrue    ' lock the aspect
ratio (do not distort picture) 
            aspect = .Width / .Height     ' calculate aspect
ratio of picture 
            .Left = Cells(t, l).Left + TargetCells.Width / 2
- p.Width / 2     ' left placement of picture 
            .Top = Cells(t, l).Top        ' top left
placement of picture 
       End With 
       w = (Cells(b, r).Left + Cells(b, r).Width - Cells(t,
l).Left)  ' width of cell range 
       h = Cells(b, r).Top + Cells(b, r).Height - Cells(t,
l).Top     ' height of cell range 
       If (w / h < aspect) Then 

          .ShapeRange.Width = w           ' scale picture to
available width 
       Else 
          .ShapeRange.Height = h          ' scale picture to
available height 
       End If 
       .Placement = 1 
End With
Set p = Nothing
End Sub
Topic 714
Subject
Excel VBA Script to Copy and Paste Data from a Predefined List of URLs
Question
I'm pulling my hair out over this. I've seen other topics that almost address this
question, but their methods are normally too specific. I don't need anything as
complicated as scraping
I have about 64,000 URLs in column A of my file. I want Excel to go to each
URL and once it loads, copy the entire page and then paste it into Excel. I
would like all the pasted data in the same workbook and same sheet pasted one
after the other. Answer
Well here's the finished code, if anyone was wondering.
Sub Macro3()
'
' Macro3 Macro
'
'
Dim Erw, Frw, Lrw
Drw = 1
Frw = 1
Lrw = Range("A" & Rows.Count).End(xlUp).Row For Erw = Frw To Lrw

With ActiveSheet.QueryTables.Add(Connection:= _ 
      "URL;" & Range("A" & Erw).Value, Destination:=Range("G"
& Drw)) 
      .Name = "" 
      .FieldNames = True 
      .RowNumbers = False 
      .FillAdjacentFormulas = False 
      .PreserveFormatting = True 
      .RefreshOnFileOpen = False 
      .BackgroundQuery = True 
      .RefreshStyle = xlInsertDeleteCells 
      .SavePassword = False 
      .SaveData = True 
      .AdjustColumnWidth = True 
      .RefreshPeriod = 0 
      .WebSelectionType = xlSpecifiedTables 
      .WebFormatting = xlWebFormattingNone 
      .WebTables = "6" 
      .WebPreFormattedTextToColumns = True 
      .WebConsecutiveDelimitersAsOne = True 
      .WebSingleBlockTextImport = False 
      .WebDisableDateRecognition = False 
      .WebDisableRedirections = False 
      .Refresh BackgroundQuery:=False 
End With
Drw = Drw + 80
Next Erw
End Sub
Topic 715
Subject
Excel find IDs in List and append them comma separated
Question
I am trying to search an ID in a Column (which will have this ID possibly
multiple times) and then take the next Column of the found ID and put the text in
a field comma separated. I think this Image is showing it better than I can with
my broken english.

All this should happen automatically. With VBA or a Formula if possible.
The left list should be translated to the right. Any clues on how to achieve
something like this? Answer
To do this without VBA, you can use a helper column which will pick up each
additional letter to add to the list for a particular number, and then search for
the full concanated cell associated with each number, for your result.
Note that I suggest you do your helper column from the bottom and copied up -
this will make it easier for you to pull the concanated values at the end, without
using an Array Formula.
Put the formula in C21 [assuming 21 is your last data row], and copy it up to
the top of your list:
=IFERROR(INDEX($C$22:C22,MATCH(A21,$A$22:A22,0)),"")&","&B21
What this does is search column C for all rows beneath the current row, to see
what the most recent concanated result for that number is. It then pulls that text
value ["" if there is no prior match], and adds on the value in column B for the
current row. As you copy it up, each individual number's 'concanenated text'
will continue to grow, adding letters where the number values match.
Then to pull those results into your table on the right, simply do the following
in E1 and copy down:
=INDEX(C:C,MATCH(D1,A:A,0))
This pulls in the first matching row which has the number value you're
searching for, and returns the value on that row from column C. Since the first
matching value would be the one which includes all concanenated values
before it, this will be a complete listing of matches to that number.
Note also that this method puts the bottom rows' letter values at the begining of
the concatenation string.
Answer

A pivot table can be usefull to you if order of your the data is not important.
To create a pivot table label your two columns in row 1 and follow below
instructions i got from google.
On the Insert tab, in the Tables group, click PivotTable. ... In the Create
PivotTable dialog box, make sure that Select a table or range is selected, and
then in the Table/Range box, verify the range of cells. ... Do one of the
following: ...
Click OK.
Choose the ID column for your ROWS(drag drop in the pivottable fiedls) and
the data column (column2) for your COLUMNS.
Be refreshing the pivot table (by right click) whenever you modify your data
Topic 716
Subject
Find and replace multiple excel files multiple values
Question
I have a lot of xls files in one folder and also in sub folders. I'd like a vba that
find in every file a word for example: Orange 100 and change it to another
word, ex. Pink 150 but I would like also to change
Red 12 in Rose 94
Green 111 in Yellow 212
etc etc etc
So...
Orange 100 Red 12 Green 111
respectively
in
Pink 150 Rose 94 Yellow 212
any help please?
Thank you so much.
Something like this but in multiple files in folder and subfolders:
Sub Multi_FindReplace()

Dim sht As Worksheet
Dim fndList As Variant
Dim rplcList As Variant
Dim x As Long
fndList = Array("Orange 100", "Red 12", "Green 111") rplcList = Array("Pink
150", "Rose 94", "Yellow 212")
'Loop through each item in Array lists
For x = LBound(fndList) To UBound(fndList) 'Loop through each worksheet in
ActiveWorkbook 
    For Each sht In ActiveWorkbook.Worksheets 
      sht.Cells.Replace What:=fndList(x),
Replacement:=rplcList(x), _ 
        LookAt:=xlPart, SearchOrder:=xlByRows,
MatchCase:=False, _ 
        SearchFormat:=False, ReplaceFormat:=False 
    Next sht 
Next x
End Sub
Answer
Well I get this error running the code... no idea I get this error
Answer
Your code looks ok. What you miss is the openining of multiple workbooks in
folders and subfolders. So this is the code I add for you.
We are using recursion to iterate your file system using the FileSystemObject
so add a reference to Microsoft Scripting Run time to your project/workbook.
in Excel code window menus >>tools>>references.
Option Explicit
Private Sub Multi_FindReplace(wb As Workbook)

Dim sht As Worksheet
Dim fndList As Variant
Dim rplcList As Variant
Dim x As Long
fndList = Array("Orange 100", "Red 12", "Green 111") rplcList = Array("Pink
150", "Rose 94", "Yellow 212")
'Loop through each item in Array lists 
    For x = LBound(fndList) To UBound(fndList) 
      'Loop through each worksheet in ActiveWorkbook 
        For Each sht In wb.Worksheets 'changed Active
workbook to the workbbok passed as argument 
          sht.Cells.Replace What:=fndList(x),
Replacement:=rplcList(x), _ 
            LookAt:=xlPart, SearchOrder:=xlByRows,
MatchCase:=False, _ 
            SearchFormat:=False, ReplaceFormat:=False 
        Next sht 
    Next x 
End Sub
Public Sub FindReplace()
Dim folderPath As String
Dim FSO As New FileSystemObject
folderPath = "C:\workbooks\" 'start folder modify to fit your case
recurseFolderReplacing FSO.GetFolder(folderPath) End Sub
Private Function recurseFolderReplacing(myfolder As Folder)
Dim myfile As File, mySubFolder As Folder Dim wb As Workbook
For Each myfile In myfolder.Files 
      'filter to ensure we only touch excel files 
      If Right(myfile.Name, 5) = ".xslx" Or
Right(myfile.Name, 4) = ".xsl" Then 
          Set wb = Workbooks.Open(myfile.Path, False, True) 
          Multi_FindReplace wb 
          wb.Close True 
          Debug.Print "Processed " & myfile.Path 

      End If 
Next
'the recursive calls to subfolders
For Each mySubFolder In myfolder.SubFolders
recurseFolderReplacing mySubFolder Next
End Function
I have not tested the code so tell me how it goes.
Bikxs
Topic 717
Subject
c# print.preview method with excel file
Question
I'm looking to print through a C# application an already created file where I
add in some cells the needed information. Here's the code of my button (in a
form opened by the main form):
private static Excel.Workbook MyBook = null; private static
Excel.Application MyApp = null; private static Excel.Worksheet MySheet =
null;
private void btnPrint_Click(object sender, EventArgs e) {
MySqlConnection connexion = OpenConnection(); MySqlCommand reqPrint =
new MySqlCommand("select * from client, panne WHERE client.idClient =
panne.idClient AND client.idClient = @ID;", connexion);
reqPrint.Parameters.Add("@id", MySqlDbType.String);
reqPrint.Parameters["@id"].Value = idCli; MySqlDataReader resultat =
reqPrint.ExecuteReader();
while (resultat.Read()) {
MySheet.Cells['B', 2] = resultat["dateEntree"].ToString(); MySheet.Cells['B',
4] = resultat["nomCli"]; MySheet.Cells['B', 5] = resultat["prenomCli"];

MySheet.Cells['B', 6] = resultat["cpCli"]; MySheet.Cells['B', 7] =
resultat["telCli"].ToString(); MySheet.Cells['B', 11] = resultat["appareil"];
MySheet.Cells['B', 17] = resultat["description"].ToString(); }
MySheet.Cells['G', 2] = txtIntervenant.Text; MySheet.Cells['B', 8] =
txtFixe.Text; MySheet.Cells['C', 13] = txtSave.Text; MySheet.Cells['C', 15] =
txtMDP.Text; MySheet.Cells['G', 17] = txtHD.Text;
MySheet.Cells['G', 20] = txtMEM.Text; MySheet.Cells['C', 23] = txtInter.Text;
MySheet.PrintPreview();
CloseConnection(connexion);
}
My problem is that every time I press the button, my application freezes and
that's all. No error message, no exception. I noticed that when I try to reboot
my computer after trying this code, Excel (2007) doesn't want to stop and I
have to force crash it. Also if I try to open an Excel file I can't. It opens for like
0.1 seconds and then closes itself.
I tried some other code to show the preview like:
bool dialogResult =
MyApp.Dialogs[Excel.XlBuiltInDialog.xlDialogPrintPreview].Show(
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing);
But the issue is the same.
Topic 718
Subject
I'm trying to add a count to the number of searches found in my code

Question
My code follows:
Dim ws As Worksheet
Dim ExitLoop As Boolean
Dim SearchString As String, FoundAt As String
Set ws = Worksheets("detail_report")
On Error GoTo Err
Set oRange = ws.Cells
SearchString = "front input"
Set aCell = oRange.Find(What:=SearchString, LookIn:=xlValues, _ 
          LookAt:=xlPart, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
          MatchCase:=False, SearchFormat:=False) 
If Not aCell Is Nothing Then
Set bCell = aCell
FoundAt = aCell.Address
Do While ExitLoop = False
Set aCell = oRange.FindNext(After:=aCell) 
      If Not aCell Is Nothing Then 
          If aCell.Address = bCell.Address Then Exit Do 
          FoundAt = FoundAt & ", " & aCell.Address 
      Else 
          ExitLoop = True 
      End If 
Loop
Else

MsgBox SearchString & " not Found"
End If
MsgBox "The Search String has been found these locations: " & FoundAt Exit
Sub
Err:
MsgBox Err.Description
End Sub
I added the below code but don't know how to add the counter part:
Dim S As String
Dim count As Integer
Answer
With the current code you have you don't even need to use a counter. Instead
you can load FoundAt into an array and then use the Ubound to get the total
count. Note you have to add 1 since the array is 0 based.
Add these lines before your final Msgbox
Dim iCount() as String
iCount = Split(FoundAt,", ")
MsgBox "The Search String has been found " & UBound(iCount)+1 & " times
at these locations: " & FoundAt
Topic 719
Subject
How can I preserve the format while exporting data from excel to evernote
Question
I have the following code in excel which imports the data from every row and
column into a single note for every row.
But it doesn't formats the data as it is in excel but just prints the cell contents as
it is.

This is how it looks now when I impor the .enex file
This is how it looks in excel.
Code
Option Explicit
Sub OutputNotesXML()
Dim iRow As Long
Close #1
With ActiveSheet
'For iRow = 2 To 2
Open ThisWorkbook.Path & "\evernote-import.enex" For Output As #1 
      Print #1, "<?xml version=" & Chr(34) & "1.0" & Chr(34)
& " encoding=" & Chr(34) & "UTF-8" & Chr(34) & "?>" 
      Print #1, "<!DOCTYPE en-export SYSTEM " & Chr(34) &
"http://xml.evernote.com/pub/evernote-export.dtd" & Chr(34) &
">" 
      Print #1, "<en-export export-date=" & Chr(34) &
"20120202T073208Z" & Chr(34) & " application=" & Chr(34) &
"Evernote/Windows" & Chr(34) & " version=" & Chr(34) & "4.x" &
Chr(34) & ">" 
For iRow = 2 To .Cells(.Rows.Count, "A").End(xlUp).Row 
      Print #1, "<note><title>" 
      Print #1, .Cells(iRow, "A").Value 'Title 
      Print #1, "</title><content><![CDATA[<?xml version=" &
Chr(34) & "1.0" & Chr(34) & " encoding=" & Chr(34) & "UTF-8" &
Chr(34) & "?>" 
      Print #1, "<!DOCTYPE en-note SYSTEM " & Chr(34) &
"http://xml.evernote.com/pub/enml2.dtd" & Chr(34) & ">" 
      Print #1, "<en-note style=" & Chr(34) & "word-wrap:
break-word; -webkit-nbsp-mode: space; -webkit-line-break:
after-white-space;" & Chr(34) & ">" 
      Print #1, CBr(.Cells(iRow, "B").Value) & vbNewLine
'Note 
      Print #1, CBr(.Cells(iRow, "C").Value) & vbNewLine

'Note 
      Print #1, CBr(.Cells(iRow, "D").Value) & vbNewLine
'Note 
      Print #1, CBr(.Cells(iRow, "E").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "F").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "G").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "H").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "I").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "J").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "K").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "L").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "M").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "N").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "O").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "P").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "Q").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "R").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "S").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "T").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "U").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "V").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "W").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "X").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "Y").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "Z").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "AA").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "AB").Value) 'Note 
      Print #1, CBr(.Cells(iRow, "AC").Value) 'Note 
      Print #1, "</en-note>]]></content><created>" 
      'Print #1, .Cells(iRow, "D").Text 'Created Date in
Evernote Time Format... 
      'To get the evernote time, first convert your time to
Zulu/UTC time. 
      'Put this formula in Column D: =C2+TIME(6,0,0) where 6
is the hours UTC is ahead of you. 
      'Then right click on your date column, select format,
then select custom. Use this custom code: yyyymmddThhmmssZ 
      Print #1, "</created>
<updated>201206025T000001Z</updated></note>" 
Next iRow
Print #1, "</en-export>"
Close #1

End With
End Sub
Function CBr(val) As String
'parse hard breaks into to HTML breaks CBr = Replace(val, Chr(13), "")
CBr = Replace(CBr, "&", "&amp;")
End Function
'I modified this code from Marty Zigman's post here:
http://blog.prolecto.com/2012/01/31/importing-excel-data-into-evernote-
without-a-premium-account/ Answer
The contents for an Evernote note are in ENML, which is a superset of
xHTML. You'll see that the list of permitted elements includes tags like
<table>, <tr> and <td>, so you can use those to construct an html table for the
note content.
An alternative solution would be to do it via CSS. The caveat there is that the
CSS will have to go in the style attribute for each element, as an inline style.
Note that the <br/> tag is also supported.
Answer
I'd suggest that you start by manually building a Note in Evernote that looks just
like you want it to, and then export that Note to ENEX. You can then examine
the ENEX file to see how things need to be formatted.
One key thing I have noticed is that the Evernote app itself uses the HTML
<div> tag extensively, rather than <p> or <br>, to achieve lines without spaces
between the lines.
If you want the EN Note to display the data as table, like in Excel, then you
will need to use the HTML <table> tags in your output.
Topic 720
Subject
I need to convert a tear range to comma separated range

Question
I have a single column in my worksheet that has year ranges in each cell. (i.e
1995-2005) I know formulas pretty well, but I do not know VBA. Could
someone tell me a scripts I can use to change this range into a comma
separated year range in a single cell. (i.e 1995,1995,1997, etc) Answer
The below code converts as cell value like '1995-2000' to
'1995,1996,1997,1998,1999,2000'. This will continue for all the cells
specified in the Range
Sub commaYear()
Dim rng As Range
Dim ws As Worksheet
Dim cellValue As Range
Dim strtYear As Integer
Dim endYear As Integer
Dim tempCelValue As String
Set rng = Range("A1:A10") 'Specify your Coloumn range
For Each cellValue In rng.Cells
If (cellValue.Value <> "") Then 
      strtYear = CInt(Trim(Split(cellValue.Value, "-")(0))) 
      endYear = CInt(Trim(Split(cellValue.Value, "-")(1))) 
      'tempCelValue = "'" 
      While (strtYear <= endYear) 
          If (strtYear = endYear) Then 
              tempCelValue = tempCelValue & strtYear 
              strtYear = strtYear + 1 
          Else 
              tempCelValue = tempCelValue & strtYear & "," 
              strtYear = strtYear + 1 
          End If 
      Wend 
      cellValue.Value = tempCelValue 
End If
Next

End Sub
Answer
For example: http://prntscr.com/9yhns8
=CONCATENATE(A1;",";A2;",";A3;",";A4;",";A5;",";A6;",";A7;",";A8;",";A9;
Topic 721
Subject
Automatically Coping Columns between workbooks
Question
I need help creating a piece of code that will.
Identify two separate workbooks: workbook1 (the source file) & workbook2
(active.workbook). take the column title in workbook1, find that column title in
workbook 2 and copy the content of the column from workbook1 into
workbook 2. move to the next column in workbook1 until its title is blank.
Answer
This code works for me. Note the comments.
Sub copyA2B()
Dim wb As Workbook
Dim wbSrc As String
Dim cel As Range
'assuming you don't know the source workbook name, looping through the
workbooks, otherwise no loop needed For Each wb In Workbooks
If wb.Name <> ActiveWorkbook.Name Then 
      wbSrc = wb.Name 
      Exit For 
End If
Next
With Workbooks(wbSrc).ActiveSheet

'assuming the column order is different between the two files, looping through
the titles, otherwise no loop needed For Each cel In .Rows(1).Cells 'assuming
the titles are in the first row in both workbooks 
      If cel <> "" And cel(2) <> "" Then 
          .Range(cel(2), cel(1).End(xlDown)).Copy
Rows(1).Find(cel.Value)(2) 
      End If 
Next
End With
End Sub
Topic 722
Subject
Excel: Autofill to last row from previously last used cell?
Question
So I have a database I am managing. It is growing quite large. Every single day
I add the new data, which is about 100 rows of information. Then I have about
20 columns that autofill with calculations, etc. A few of those columns pull
from a VERY large file using Vlookups. That takes forever b/c it's pulling the
entire column everyday b/c my current autofill macro starts in row 2. Is there
any way to write the macro so that it autofills from the previous "last row" so
it's only autofilling 100 or so new rows instead of several thousand (and
growing)? All my attempts to do so have failed. :(
Topic 723
Subject
Excel COM Interop, process not finishes if I edit cells
Question
I am trying to work with Excel via COM interop. It works fine but Excel
process is still hanging after DoStuff method is finished (though it disappears
when my program finishes).
If I remove the code that fills cell I do not have this issue.

using System;
using System.Reflection;
using System.Runtime.InteropServices;
using Excel = Microsoft.Office.Interop.Excel;
namespace ConsoleApplication13
{
class Program
{ 
      static void DoStuff() 
      { 
          string workbookPath = @"C:\....xlsx"; 
          var excelApp = new Excel.Application(); 
          excelApp.Visible = true; 
          var workbooks = excelApp.Workbooks; 
          var workbook = workbooks.Open(workbookPath, 
              0, false, 5, "", "", false,
Excel.XlPlatform.xlWindows, "", 
              true, false, 0, true, false, false); 
          var workheets = workbook.Worksheets; 
          var mainWorksheet = (Excel.Worksheet)
workheets.Item[1]; 
          var cell = (Excel.Range)mainWorksheet.Cells[4,
"U"]; 
          cell.set_Value(Missing.Value, 99); 
          ReleaseObject(cell); 
          ReleaseObject(mainWorksheet); 
          ReleaseObject(workheets); 
          workbook.Close(false, Missing.Value,
Missing.Value); 
          ReleaseObject(workbook); 

          ReleaseObject(workbooks); 
          excelApp.Quit(); 
          ReleaseObject(excelApp); 
      } 
      private static void ReleaseObject(object obj) 
      { 
          if (obj != null && Marshal.IsComObject(obj)) 
          { 
              Marshal.ReleaseComObject(obj); 
          } 
      } 
      static void Main(string[] args) 
      { 
          DoStuff(); 
          Console.ReadKey(); 
      } 
}
}
I am trying to store all references to COM objects and release it as was
suggested here How to properly clean up Excel interop objects? but it doesn't
work for Cells and I don't understand why. Answer
I ended up doing something like this with the GC approach. Looks like it works
fine.
using System;
using System.Reflection;
using Excel = Microsoft.Office.Interop.Excel;
namespace ConsoleApplication13
{
class ExcelWorker : IDisposable
{

private Excel.Application _excelApp; 
      private Excel.Workbook _workbook; 
      private Excel.Worksheet _mainWorksheet; 
      private readonly string _workbookPath; 
      public ExcelWorker(string workbookPath) 
      { 
          _workbookPath = workbookPath; 
      } 
      public void Start() 
      { 
          _excelApp = new Excel.Application(); 
          _excelApp.Visible = true; 
          var workbooks = _excelApp.Workbooks; 
          _workbook = workbooks.Open(_workbookPath, 
              0, false, 5, "", "", false,
Excel.XlPlatform.xlWindows, "", 
              true, false, 0, true, false, false); 
          var workheets = _workbook.Worksheets; 
          _mainWorksheet = (Excel.Worksheet)
workheets.Item[1]; 
      } 
      public void DoStuff() 
      { 
          var cell = (Excel.Range)_mainWorksheet.Cells[4,
"U"]; 
          cell.set_Value(Missing.Value, 99); 
      } 
      public void Stop() 
      { 
          if (_workbook != null) 
          { 
              _workbook.Close(false, Missing.Value,
Missing.Value); 
              _workbook = null; 

              _mainWorksheet = null; 
          } 
          if (_excelApp != null) 
          { 
              _excelApp.Quit(); 
              _excelApp = null; 
          } 
          GC.Collect(); 
          GC.WaitForPendingFinalizers(); 
      } 
      public void Dispose() 
      { 
          Stop(); 
      } 
}
class Program
{ 
      static void Main(string[] args) 
      { 
          using (var excelWorker = new
ExcelWorker(@"C:\.....xlsx")) 
          { 
              excelWorker.Start(); 
              excelWorker.DoStuff(); 
              excelWorker.DoStuff(); 
          } 
          Console.ReadKey(); 
      } 
}
}
Topic 724

Subject
Store data in database from an uploaded Excel file
Question
I have a code which handles uploading an Excel file, by reading it and storing
it in the database. The code follows, and it is compiling but giving an error.
Please see the code below:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html
xmlns="http://www.w3.org/1999/xhtml">
<head> 
      <meta http-equiv="Content-Type" content="text/html;
charset=utf-8" /> 
      <title></title> 
      <link href="http://fonts.googleapis.com/css?
family=Source+Sans+Pro:200,300,400,600,700,900|Quicksand:400,70
rel="stylesheet" /> 
      <link href="css/default.css" rel="stylesheet"
type="text/css" media="all" /> 
      <link href="css/fonts.css" rel="stylesheet"
type="text/css" media="all" /> 
      <%@ page import="java.sql." %> 
      <%@ page import="com.oreilly.servlet." %> 
      <%@ page import="java.io."%> 
      <%@ page import="java.util."%> 
      <%@ page import="com.oreilly.servlet." %> 
      <%@page import=" org.apache.poi.hssf.usermodel."%> 
      <%@ page import ="org.apache.poi.poifs.filesystem." %> 
      <%@ page import="org.apache.poi.ss.usermodel.Row" %> 
      <%@ page import ="java.util.Date" %> 
      <%@ page import ="java.io." %> 
</head>
<body> 
      <div id="header-wrapper"> 
          <div id="header" class="container"> 
              <div id="logo"> 

                  <h1><span class="icon icon-cog"></span><a
href="#">MPSTME Exam Portal</a></h1> 
                  <div id="menu"> 
                      <ul> 
                          <li><a href="homepage_teacher.html"
accesskey="1" title="">Homepage</a></li> 
                          <li><a href="#" accesskey="2"
title="">New Teacher</a></li> 
                          <li><a href="#" accesskey="3"
title="">New Student</a></li> 
                          <li class="current_page_item"><a
href="admin_timetable.jsp" accesskey="5" title="">Upload
Timetable</a></li> 
                          <li><a href="index.html"
accesskey="6" title="">Logout</a></li> 
                      </ul> 
                  </div> 
              </div> 
          </div> 
      </div> 
      <div id="page-wrapper"> 
          <div id="page" class="container"> 
              <div class="title"> 
                  <h2>Upload Timetable</h2> 
              </div> 
          </div> 
      </div> 
      <div class="wrapper"> 
      <div id="three-column" class="container"> 
      <% 
       MultipartRequest m = new
MultipartRequest(request,"/Users/Documents/workspace/exam_porta
       out.print("uploaded"); 
       %> 
      <% 
      Class.forName("com.mysql.jdbc.Driver"); 
      Connection conn =
DriverManager.getConnection("jdbc:mysql://localhost:3306/exampo
      %> 
      <% 
      String
filename="/Users/hemshah/Documents/workspace/exam_portal/WebCon
      ArrayList dataHolder = readExcelFile(filename); 
      String sql = "insert into timetable
values(?,?,?,?,?,?)"; 
      ps = conn.prepareStatement(sql); 
      int count = 0; 
      ArrayList cellStoreArrayList = null; 

      System.out.println("dataHolder.size() = " +
dataHolder.size()); 
      for (int i = 1; i < dataHolder.size(); i++) { 
            
System.out.println("dataHolder.size()="+dataHolder.get(i)); 
              cellStoreArrayList =
(ArrayList)dataHolder.get(i); 
              ps.setString(1,
((HSSFCell)cellStoreArrayList.get(0)).toString()); 
              ps.setString(2,
((HSSFCell)cellStoreArrayList.get(1)).toString()); 
              ps.setString(3,
((HSSFCell)cellStoreArrayList.get(2)).toString()); 
              ps.setString(4,
((HSSFCell)cellStoreArrayList.get(3)).toString()); 
              ps.setString(5,
((HSSFCell)cellStoreArrayList.get(4)).toString()); 
              ps.setString(6,
((HSSFCell)cellStoreArrayList.get(5)).toString()); 
              count= ps.executeUpdate(); 
             //
System.out.print(((HSSFCell)cellStoreArrayList.get(5)).toString
+ "\t"); 
      } 
      %> 
      <%! 
      PreparedStatement ps=null; 
      public static ArrayList readExcelFile(String filename)
{ 
          ArrayList cellArrayListHolder=new ArrayList(); 
          ArrayList cellStoreArrayList=new ArrayList(); 
          ArrayList test = null; 
          try { 
              FileInputStream myInput = new
FileInputStream(filename); 
              POIFSFileSystem myFileSystem = new
POIFSFileSystem(myInput); 
              HSSFWorkbook myWorkbook = new
HSSFWorkbook(myFileSystem); 
              HSSFSheet mySheet = myWorkbook.getSheetAt(0); 
              Iterator rowIter = mySheet.rowIterator(); 
              while (rowIter.hasNext()) { 
                  HSSFRow myrow = (HSSFRow) rowIter.next(); 
                  Iterator cellIter = myrow.cellIterator(); 
                 //ArrayList cellStoreArrayList = new

ArrayList(); 
                  while(cellIter.hasNext()) { 
                      HSSFCell myCell = (HSSFCell)
cellIter.next(); 
                      cellStoreArrayList.add(myCell); 
                  } 
              } 
          } catch(Exception e) { } 
          return cellStoreArrayList; 
      } 
      %> 
      <% if(count>0) { %> 
          Following details from Excel file have been
inserted in student table of database 
          <table> 
              <tr> 
                  <th>Subject ID</th> 
                  <th>Subject Name</th> 
                  <th>Faculty</th> 
                  <th>Date</th> 
                  <th>Time</th> 
                  <th>Class</th> 
              </tr> 
              <% for (int i = 1; i < dataHolder.size(); i++)
{ 
                  cellStoreArrayList = (ArrayList)
dataHolder.get(i); %> 
                  <tr> 
                      <td><%=
((HSSFCell)cellStoreArrayList.get(0)).toString() %></td> 
                      <td><%=
((HSSFCell)cellStoreArrayList.get(1)).toString() %></td> 
                      <td><%=
((HSSFCell)cellStoreArrayList.get(2)).toString() %></td> 
                      <td><%=
((HSSFCell)cellStoreArrayList.get(3)).toString() %></td> 
                      <td><%=
((HSSFCell)cellStoreArrayList.get(4)).toString() %></td> 
                      <td><%=
((HSSFCell)cellStoreArrayList.get(5)).toString() %></td> 
                  </tr> 
              <%} }%> 
          </table> 
      </div> 

</body>
</html>
Here is the stacktrace for the error:
org.apache.jasper.JasperException: An exception occurred processing JSP
page /admin_timetable_upload.jsp at line 80
77: for (int i=1;i < dataHolder.size(); i++) 78: { 
79:        
System.out.println("dataHolder.size()="+dataHolder.get(i)); 
80:        cellStoreArrayList=(ArrayList)dataHolder.get(i); 
81:         ps.setString(1,
((HSSFCell)cellStoreArrayList.get(0)).toString()); 
82:         ps.setString(2,
((HSSFCell)cellStoreArrayList.get(1)).toString()); 
83:         ps.setString(3,
((HSSFCell)cellStoreArrayList.get(2)).toString()); 
Stacktrace
org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServ
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.j
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:395)
org.apache.jasper.servlet.JspServlet.service(JspServlet.java:339)
javax.servlet.http.HttpServlet.service(HttpServlet.java:731) root cause
java.lang.ClassCastException: org.apache.poi.hssf.usermodel.HSSFCell
cannot be cast to java.util.ArrayList
org.apache.jsp.admin_005ftimetable_005fupload_jsp.jspService(005ftimetable
org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)
javax.servlet.http.HttpServlet.service(HttpServlet.java:731)
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:4
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:395)
org.apache.jasper.servlet.JspServlet.service(JspServlet.java:339)
javax.servlet.http.HttpServlet.service(HttpServlet.java:731)
How do I solve this?

Answer
You don't need to cast this:
cellStoreArrayList = (ArrayList) dataHolder.get(i);
into an ArrayList, it already returns an HSSFCell, so you would just do:
HSSFCell cell = dataHolder.get(i);
Topic 725
Subject
Copy a table from one worksheet to another while maintaining column size
Question
Copy a table from one worksheet to another where the column size from the
original worksheet is to be maintained as the new sheet already has a table
with smaller sized columns.
Dim i, lastRow
lastRow = Sheets("Closed").Range("A" & Rows.Count).End(xlUp).Row
For i = 1 To lastRow
Sheets("Closed").Cells(i, "A").Copy
Destination:=Sheets("Misc.Dashboard").Range("A" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "B").Copy
Destination:=Sheets("Misc.Dashboard").Range("B" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "C").Copy
Destination:=Sheets("Misc.Dashboard").Range("C" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "D").Copy
Destination:=Sheets("Misc.Dashboard").Range("D" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "E").Copy
Destination:=Sheets("Misc.Dashboard").Range("E" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "F").Copy
Destination:=Sheets("Misc.Dashboard").Range("F" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "G").Copy

Destination:=Sheets("Misc.Dashboard").Range("G" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "H").Copy
Destination:=Sheets("Misc.Dashboard").Range("H" &
Rows.Count).End(xlUp).Offset(1) Sheets("Closed").Cells(i, "I").Copy
Destination:=Sheets("Misc.Dashboard").Range("I" &
Rows.Count).End(xlUp).Offset(1)
Next i
Answer
As it seems you're copying all data from the "Closed" worksheet and adding it
to the bottom of the "Misc.Dashboard" Sheet, instead of writing a loop, which
becomes very slow if amount of data increases, try to copy the range in one go.
Dim lastRow As Long, lastColumn As Long
With ThisWorkbook
With .Worksheets("Closed") 
      lastRow = .Cells(.Rows.Count, 1).End(xlUp).Row 
      lastColumn = .Cells(1,
.Columns.Count).End(xlToLeft).Column 
      .Range(.Cells(1, 1), .Cells(lastRow, lastColumn)).Copy 
End With
With .Worksheets("Misc.Dashboard") 
      .Range(.Cells(.Rows.Count, 1).End(xlUp).Offset(1, 0),
.Cells(.Rows.Count, lastColumn).End(xlUp).Offset(1 + lastRow,
0)).PasteSpecial (xlPasteColumnWidths) 
      .Range(.Cells(.Rows.Count, 1).End(xlUp).Offset(1, 0),
.Cells(.Rows.Count, lastColumn).End(xlUp).Offset(1 + lastRow,
0)).PasteSpecial (xlPasteValues) 
End With
End With
Application.CutCopyMode = False

Topic 726
Subject
How to reduce the weight of an Excel workbook after gridview export in
vb.net
Question
I've the following code to export my gridview in Excel :
Protected Sub ExportToExcel(sender As Object, e As EventArgs) Handles
ExportExcel.Click 
      Try 
          Response.Clear() 
          Response.Buffer = True 
          Response.AddHeader("content-disposition",
"attachment;filename=ExportEthias.xls") 
          Response.Charset = "" 
          Response.ContentType = "application/vnd.ms-excel" 
          Using sw As New StringWriter() 
              Dim hw As New HtmlTextWriter(sw) 
              GvActifs.BackColor = Color.White 
              For Each cell As TableCell In
GvActifs.HeaderRow.Cells 
                  cell.BackColor = Color.DarkBlue 
                  cell.BorderStyle = BorderStyle.Solid 
                  cell.ForeColor = Color.White 
              Next 
              For Each row As GridViewRow In GvActifs.Rows 
                  row.BackColor = Color.White 
                  For Each cell As TableCell In row.Cells 
                      If row.RowIndex Mod 2 = 0 Then 
                          cell.BackColor =
GvActifs.AlternatingRowStyle.BackColor 
                      Else 
                          cell.BackColor =
GvActifs.RowStyle.BackColor 
                      End If 
                      cell.CssClass = "textmode" 
                      cell.BorderStyle = BorderStyle.Solid 
                  Next 
              Next 
              GvActifs.RenderControl(hw) 

              'Le format de base est le texte pour éviter les
problèmes d'arrondis des nombres 
              Dim style As String = "<style> .textmode { }
</style>" 
              Response.Write(style) 
              Response.Output.Write(sw.ToString()) 
              Response.Flush() 
              Response.End() 
          End Using 
      Catch ex As Exception 
          lblMessage.Text = "Erreur export Excel : " &
ex.Message 
      End Try 
End Sub
Public Overrides Sub VerifyRenderingInServerForm(control As Control)
' Verifies that the control is rendered End Sub
It Works fine but the Excel do 14,7 MB for 5k lines. It's to much :) How to
reduce the weight of the export in Excel ?
Thanks in advance.
Answer
I have found that Excel files bloat when you do a lot of formatting. Even if you
delete the formatting (colors, fonts) later it keeps the file size large. I see that
you are formatting individual cells. Your file size will drastically reduce if you
manage to write your code in such a way that you can format a range of cells at
the same time. This is because this (pseudo-code):
Cell A1: Bold
Cell A2: Bold
Cell A3: Bold
...
Cell Z3: Bold
takes much more room to store in a file than:
Range A1-Z5: Bold

In this portion of your code:
If row.RowIndex Mod 2 = 0 Then
cell.BackColor = GvActifs.AlternatingRowStyle.BackColor Else
You are coloring EVERY INDIVIDUAL cell, even though all your doing is
alternating the row color. So why not color the row instead?
HTH!
Topic 727
Subject
VBA - Excel Showing form after double click on a Cell
Question
I've encountered a strange Problem. I have an Input Form for the User in Excel.
This Form provides basic CRUD functions to edit a List in a Table. Now this
Userform also has a ListBox which shows all the entrys with Id and some
basic infos (so you know which entry is which ). Now what I want is, that if
you select a row in the normal excel table, and then open the InputForm, the
selected row in the table should also be selected in the listBox of the
InputForm.
I do this like this:
If Selection.Row >= StartRow() Then
ListBoxAll.listIndex = Selection.Row - StartRow() Else
ListBoxAll.listIndex = 0
End If
This works great if I open the Ui per Button click. But if I try to open the form
with the Before Double Click Event. I got an Offset.
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel
As Boolean)
UserFormInput.Show

End Sub
Now for the strange part. If I check what value the Selection.Row has, by
showing it with a MessageBox, it all works fine! But as soon as I remove the
MessageBox its broken all over again.
If Selection.Row >= StartRow() Then 
      ListBoxAll.listIndex = Selection.Row - StartRow() 
      MsgBox Selection.Row 
  Else 
      ListBoxAll.listIndex = 0 
End If
It does not matter where in the if I put the Messagebox.
So the Question has anybody ever got the same Problem ? And does anybody
know a solution or a workaround to it ? (I don't want to show a Messagebox!)
So I added some screenshots to make it easier to understand.
Update I think it has something to do with the Focus after a double click, which
is (maybe) on the doubleclicked Cell. And gets changed if I put out a MsgBox
Answer
(I'll write this as an answer but this is only a part of the code... :)
Oh, german ^.^
I believe each time you call your userform you'll have to compare the selected
data to the listbox data. As you have a multicolumn listbox you could do this by
the following (I believe, but untested):
Dim ThisRow As Integer
ThisRow = ActiveCell.Row
Dim ThisValue As String
ThisValue = ActiveWorkbook.Sheet("Tabelle1").Cells(ThisRow, 1).Value

This "1" should be the column which contains the same kind of information as
is displayed in the first column of your listbox.
Dim i As Integer
For i = 1 to UserFormInput.Listbox1.Listcount
If UserFormInput.Listbox1.List(i, 0).Value = ThisValue Then
UserFormInput.Listbox1.List(i).Select End If
Next i
Topic 728
Subject
How to multiply 2 cells and sum the result?
Question
I have 2 cells C12 and D23 that I want to multiply and then 2 other cells A12
and E32 which i also want to multiply and the result of those to be summed to a
different cell A1.
Does anyone knows how to do that?
Answer
in A1 cell write:
=C12C23 + A12E32
Topic 729
Subject
VBA haversine formula
Question
I am trying to implement Haversine formula into excel function. Its looks like
this:
Public Function Haversine(Lat1 As Variant, Lon1 As Variant, Lat2 As Variant,
Lon2 As Variant) Dim R As Integer, dlon As Variant, dlat As Variant, Rad1 As
Variant Dim a As Variant, c As Variant, d As Variant, Rad2 As Variant
R = 6371

dlon = Excel.WorksheetFunction.Radians(Lon2 - Lon1) dlat =
Excel.WorksheetFunction.Radians(Lat2 - Lat1) Rad1 =
Excel.WorksheetFunction.Radians(Lat1) Rad2 =
Excel.WorksheetFunction.Radians(Lat2) a = Sin(dlat / 2) * Sin(dlat / 2) +
Cos(Rad1) * Cos(Rad2) * Sin(dlon / 2) * Sin(dlon / 2) c = 2 *
Excel.WorksheetFunction.Atan2(Sqr(a), Sqr(1 - a)) d = R * c
Haversine = d
End Function
But when im testing it I am getting wrong distance... I dont understand why. For
coordinates used in this topic : Function to calculate distance between two
coordinates shows wrong I am getting 20013,44 as output. Anyone knows what
is wrong here? Cant find my mistake... Answer
Atan2 is defined back to front in Excel compared to JavaScript i.e. Atan2(x,y)
rather than Atan2(y,x).
You need to reverse the order of the two arguments:-
c = 2 * Excel.WorksheetFunction.Atan2(Sqr(1 - a), Sqr(a))
See this
So
=haversine(59.3293371,13.4877472,59.3225525,13.4619422)
gives
1.65 km
which is the correct distance as the crow flies.
Topic 730
Subject
How to convert Array formula to equivalent regular formula in excel?
Question
I need to convert the below array formula to equivalent regular formula.

{=SUM(IF(ROUND(A1:A5,0)>0,1,0))}
How to replace this array formula to regular formula for same behaviour
Answer
If you have to convert it to regular formula, then you have to first use =Round()
formula on A1:A5 cells then you have to use Countif() formula.
=COUNTIF(B2:B6,">0")
Answer
Are you referring to do this for some VBA manipulation? Or is it just a cell
formula.
If its the manual changing of an array formula cells...
Select the whole data range that the formula is defined. An easy way to do this
is select any cell in the array formula, and Press CTRL + G, select Special
Cells, then Current Array. With the whole array selected press F2 to edit the
formula, then press CTRL and ENTER. This will remove the array constraints
and you can change the formula accordingly.
Topic 731
Subject
Delete a procedurally generated button
Question
I have the following line of code in a VBA project:
ActiveSheet.Shapes("Button 1").Delete
Where it says "Button 1" I would like it to be linked to a variable of some sort.
The reason I ask is that I have a link on an "Index" worksheet that creates a
new worksheet (a copy of a separate, template worksheet) using VBA and the
newly created worksheet contains the above button. When I click that button on
the new, copied worksheet, it should perform an action and then the button
should be deleted.

The problem I'm facing is that the button name changes on each individual
worksheet that is created.
In worksheet 5, it would be called "Button 5", in worksheet 6, it would be
called "Button 6" etc. Due to this, the line of code above doesn't work as it's
still referencing "Button 1".
Does anyone have any ideas on how to reference this correctly?
Thanks for the help.
Answer
If you are deleting the button from code called by the button, it would be:
ActiveSheet.Shapes(Application.Caller).Delete
Answer
EDIT
After rereading your question more carefully I thought of this. It catches all
shapes on a sheet that start with "Button" regardless of the number.
Dim frmButton As Shape
For Each frmButton In ThisWorkbook.Worksheets("Sheet1").Shapes
If frmButton.Name Like "Button*" Then
frmButton.Delete
End If
Next
You could wrap the code above with the code below to go through multiple
sheets.
Dim ws As Worksheet
For Each ws in ThisWorkbook.Worksheets
If Not ws.Name = "Sheet2" Then 'Exclude certain sheets "Sheet2" is excluded

in this case.
'Code
End If
Next ws
END OF EDIT
For an ActiveX control try:
ThisWorkbook.Worksheets("Sheet1").OLEobjects("CommandButton1").Delete
Replace "Sheet1" and "CommandButton1" with the actual names as found in
the properties, do not confuse this with the caption, especially for the button.
For a form control button try:
ThisWorkbook.Worksheets("Sheet1").Shapes("Button 1").Delete
Replace the ThisWorkbook with Workbooks("Book1") if you are referring to a
different workbook than the workbook the code resides in. Replace "Book1"
with the actual name of the workbook.
Since the "Button 1" is a string, you can replace it with a variable containing a
string, but beware you'll get an error if there is no shape with the name
contained by the variable.
Topic 732
Subject
Time (Year) vertices insertion in NodeXL
Question
I have my data in this form:

Author CoAuthor Year
677     901706      2005 
677     838459      2007 
677     901706      2007 
677     1695352     2007 
677     901706      2009 
677     372089      2011 
1359    403400      2005 
1359    478885      2005 
1359    811513      2006 
1359    1171090     2007 
...
...
Similarly Author and Venue edges whereas Author, CoAuthor and Venues are
vertices. I'm unable to sort out that how to insert vertices, edges according to
the Year information in NodeXL.
Please help! Thanks.
Topic 733
Subject
VBA copy from sheet to another based on condition
Question
I have a set of data from one table in a sheet range being H11:BG25. I want to
run a bit of code to look into each column and if the sum of that col is > 0, then
copy the whole range for that column. If the sum is < 0, do nothing. So far I
have the following code but it does not copy the range it only copies non 0
values.
Sub CopyActuals()

For iCol = 8 To 59
For iRow = 11 To 25
With Worksheets("Project - Actual (Hours)").Cells(iRow, iCol) ' Check that
cell is not empty.
If 'Condition to be if there is any data in the rows 11-25 for each column, then
copy the whole column 
      Else 
              Worksheets("Project - Actual
(Hours)").Cells(iRow, iCol).Copy 
              Worksheets("Project - Budget
(Hours)").Cells(iRow, iCol).PasteSpecial Paste:=xlPasteValues 
              Worksheets("Project - Budget
(Hours)").Cells(iRow, iCol).PasteSpecial Paste:=xlPasteFormats
      End If 
End With
Next iRow
Next iCol
End Sub
Answer
Sub CopyActuals()
Dim ActlSheet As Worksheet
Dim BbgtSheet As Worksheet
Dim rowCount As Integer
Dim SumValue As Integer
Dim rng As Range
Set ActlSheet = ActiveWorkbook.Sheets("Project - Actual (Hours)") Set
BbgtSheet = ActiveWorkbook.Sheets("Project - Budget (Hours)") rowCount =
ActlSheet.UsedRange.Rows.Count For iCol = 8 To 59
Set rng = Range(Cells(11, iCol), Cells(rowCount, iCol)) SumValue =
Application.WorksheetFunction.Sum(rng) If (SumValue > 0) Then 
   rng.Select 

   rng.Copy 
   'put your next action 
Else 
   'put your next action 
End If
Next iCol
End Sub
Topic 734
Subject
Lastrow not being identified due to merged cells
Question
I have a data set where some cells are merged.
There is not one column where they are not merged, and some columns have no
entries.
I want to find the last row so that I can add a formula to a column up until the
last row.
At the moment my last row is a merged cell with 2 entries. My formula has
been added up until the second to last row.
This is my code to find the last row, based on column A (which has merged
cells).
lastrow = Range("A" & Rows.Count).End(xlUp).Row
IT's just not picking up the last row due to the merged cells. There's no way I
can unuse them.
I want to use the last row for the following code:
Range("AB5") = "Age Year/Month"
Range("AB6:AB" & lastrow).Formula =

"=DATEDIF(RC[-2],TODAY(),""Y"") & "" Years, "" &
DATEDIF(RC[-2],TODAY(),""YM"") & "" Months """
which works for everything other than my last row which hasn't been picked
up.
I would also like to put the today() somewhere on my sheet and reference the
cell in the above formula, rather than use today() all the time which I know is
volatile.
Any advice on the last row with the merged cells issue? Sorry, for some reason
it's not letting me add comments.
I can't add a picture as it is confidential data I'm using. Column A is the most
complete column, just the last 2 rows in col A are merged. So it's not picking
up that the last row is in fact the last row, it's picking up the first of the two
merged cells as the last one Answer
Why not try
lastrow = Sheets("UrSheet").UsedRange.Rows.Count
Try the below
Dim cel As Range
lastrow = Range("A" & Rows.Count).End(xlUp).Row Set cel = Cells(lastrow,
1)
lastrow = lastrow + cel.MergeArea.Rows.Count - 1 MsgBox lastrow
Topic 735
Subject
ASP.NETC# error while importing data from excel
Question
i created web application using c# to import excel file into Microsoft
Dynamics CRM. I used Fileupload to import the excel file.
Here is the code snippet:

Import Button:
if (FileUpload1.PostedFile != null)
{ 
      string FilePath =
Path.GetFileName(this.FileUpload1.FileName); 
      string FileName =
Server.MapPath(Path.GetFileName(FilePath)); 
      string Extension =
Path.GetExtension(this.FileUpload1.FileName); 
      DataTable dt = ImportData(FileName, Extension); 
And this is the ImportData code:
private DataTable ImportData(string Filepath, string Extension) {
string connString = "";
DataTable dt = new DataTable();
switch (Extension)
{ 
      case ".xls": 
          connString =
ConfigurationManager.ConnectionStrings["Excel03ConString"].Conn
          break; 
      case ".xlsx": 
          connString =
ConfigurationManager.ConnectionStrings["Excel07ConString"].Conn
          break; 
}
connString = string.Format(connString, Filepath, 1);
try
{ 
      OleDbConnection excelConn = new

OleDbConnection(connString); 
      OleDbCommand excelCmd = new OleDbCommand(); 
      OleDbDataAdapter oda = new OleDbDataAdapter(); 
      excelCmd.Connection = excelConn; 
      excelConn.Open(); 
      DataTable dtexcelschema; 
      dtexcelschema =
excelConn.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, null); 
      string SheetName = dtexcelschema.Rows[0]
["TABLE_NAME"].ToString(); **The Error Come from this line** 
      excelConn.Close(); 
      excelConn.Open(); 
      excelCmd.CommandText = "Select * from [" + SheetName +
"]"; 
      oda.SelectCommand = excelCmd; 
      oda.Fill(dt); 
      excelConn.Close(); 
}
catch (Exception ex)
{
Label1.Text = ex.Message;
}
return dt;
}
When i tried to import excel to CRM. I got this message : "There is no row at
position 0."
I dont know what happen here. Actually before i create web application, i
created windows application using this code, and succes to import data. But
when i copy this code into web application, i got that message.
EDITED
This is connection string inside web config:
<add name ="Excel03ConString"

connectionString="Provider=Microsoft.Jet.OLEDB.4.0;Data Source=
{0};Extended Properties='Excel 8.0;HDR={1}'"/> <add name
="Excel07ConString"
connectionString="Provider=Microsoft.ACE.OLEDB.12.0;Data Source=
{0};Extended Properties='Excel 12.0;HDR={1}'"/> Answer
Use This:
string Filename = Path.GetFileName(FileUpload1.PostedFile.FileName); 
      string Extension =
Path.GetExtension(FileUpload1.PostedFile.FileName); 
      string Folderpath =
ConfigurationManager.AppSettings["FolderPath"]; 
      string Filepath = Server.MapPath(Folderpath +
Filename); 
      FileUpload1.SaveAs(Filepath); 
      DataTable dt = ImportData(Filepath, Extension); 
Topic 736
Subject
Find files in different folders and gather info from them
Question
I am starting a project that does the following:
I need to push a button in the current worksheet and it searches all files (with a
certain name structure e.g file_date.xls) in all folders within a specific
directory. I then need to pull specific numbers from the files (for example find
a cell called 'title' and take the cell underneath it). All this info then gets placed
in the current workbook in a table.
Basically its searching all files in all folders with a certain name and then
taking specific data and putting it in a table in the current worksheet.
I am just looking for ideas/examples on what to look at and where to go with it.
Answer

I would suggest you look at the Scripting.FileSystemObjects first to see if this
is good enough for your requirements.
How do I use FileSystemObject in VBA?
Chances are its what you want.
Topic 737
Subject
First sendkeys automated email doesn't actually get sent from Outlook
Question
this has got me confused...
I have a set of Excel reports I run in the morning that generates six emails each
with attachments, plus a seperate report set run on a Wednesday that generates
just the one email.
To make these reports fully automated and run without supervision and get past
the Outlook security pop-up, I have used the Sendkeys function like this (this is
from the 'Wednesday' report):
Dim OutApp As Object
Dim OutMail As Object
Set OutApp = CreateObject("Outlook.Application") Set OutMail =
OutApp.CreateItem(0)
With OutMail 
      .To = distlist 
      .CC = "" 
      .BCC = "" 
      .Subject = "30+ Days and Early Warning lists for " &
Format(Now, "dd mmm") 
      .Body = "Latest lists attached" 
      .Attachments.Add ("C:\Users\" & whoami & "\Desktop\" &
outputdirectoryname & "\" & outputfile1 & "") 
      .Attachments.Add ("C:\Users\" & whoami & "\Desktop\" &
outputdirectoryname & "\" & outputfile2 & "") 
      .Display 
      Application.Wait (Now + TimeValue("0:00:06")) 

      Application.SendKeys "%s" 
End With
Set OutMail = Nothing
Set OutApp = Nothing
Sheets("Run Buttons").Select
...works nicely.
Now, my issue is not that this code doesn't work as such, but that the first email
never actually gets sent by Outlook but remains displayed and 'stuck' in the
Outbox. If I fail to manually intervene and 'Send' this first email, then the
subsequent ones also get 'stuck', but, if I do manually 'Send' it, the others flow
through as expected.
So, for example, the Wednesday scenario goes like this...
Run the Wednesday report - it's email fails to get sent so click 'Send' Run the
other, usual morning reports - all emails go through automatically
And for the Mon, Tue, Thu, Fri runs...
First email fails to get sent so click 'Send' Rest of emails are sent
automatically.
If I reverse the running of the reports, so that the Wednesday report is run last,
its email goes through automatically as expected.
My laptop is locked down tighter than a.... so any software 'additions' are not
going to happen, likewise directly accessing the SMTP/Exchange server so
right now Sendkeys is the only email automation available to me. All the
occurences of the Sendkeys code is identical.
As I say, confused!
So do I have an issue with Excel or with Outlook?
...and how do I 'fix' it?

Many thanks for your help and time.
Answer
SendKeys might work only if the inspector is active in the foreground. Why not
try other workarounds (ClickYes, Redemption)? See
http://www.outlookcode.com/article.aspx?id=52
Answer
Add following code before .Display
If Application.VBE.MainWindow.Visible = True Then
Application.VBE.MainWindow.Visible = False
Topic 738
Subject
How to add a new cell in an existing row in .xlsx file using open xml sdk?
Question
I have an .xlsx file, which already has some data. I want to enter some data on
I1 cell.
Update
I tried this:
WorkbookPart workbookPart = spreadsheetDocument.WorkbookPart;
WorksheetPart worksheetPart = workbookPart.WorksheetParts.First();
SheetData sheetData = worksheetPart.Worksheet.Elements<SheetData>
().First();
Row row1 = new Row()
{
RowIndex = (UInt32Value)1U
};
Cell cell = new Cell() { CellReference = "I1" }; CellFormula cellformula =
new CellFormula(); cellformula.Text = "IF(A2 = A1,1,0)";
CellValue cellValue = new CellValue();

cellValue.Text = "0";
cell.Append(cellformula);
cell.Append(cellValue);
row1.Append(cell);
sheetData.Append(row1);
But it is not working.
Please provide sample code with your answer. Answer
You are creating a new Row object even though one already exists in your
document. You then give it a RowIndex which also already exists which means
you'll end up with a corrupted file (you can't have two rows with the same
index).
You need to find the existing Row and add your new Cell to that rather than
creating a brand new Row. The easiest way to do that is to call
GetFirstChild<Row> on sheetData.
As an aside, I would also not write the CellValue to the Cell as you are using a
formula. In that instance the Value is used by Excel to prevent it having to
recalculate the formula when the sheet loads. In your example though your
value is wrong. Omitting the value altogether is probably the easiest way to
guarentee correctness as Excel will then calculate the formula when the sheet
loads.
That leads to the following code:
using (SpreadsheetDocument spreadsheetDocument =
SpreadsheetDocument.Open(filename, true)) {
WorkbookPart workBookPart = spreadsheetDocument.WorkbookPart;
WorkbookPart workbookPart = spreadsheetDocument.WorkbookPart;
WorksheetPart worksheetPart = workbookPart.WorksheetParts.First();
SheetData sheetData = worksheetPart.Worksheet.Elements<SheetData>
().First();

//find the first row in the sheet data Row row1 =
sheetData.GetFirstChild<Row>();
//create a new cell
Cell cell = new Cell() { CellReference = "I1" }; CellFormula cellformula =
new CellFormula(); cellformula.Text = "IF(A2 = A1,1,0)";
cell.Append(cellformula);
//append the cell to the row
row1.Append(cell);
}
Topic 739
Subject
Search for a date within a Date range in excel
Question
I'm looking for a way to search for a cell within range of cells in a table using
excel, so i need to look for Date-Time within a Range in table that has large
amount of rows,
These pics attached show it all; the first pic shows what is the current
scenario; I'm using the IF statement to know if the Date was
found/Contained/included in range and If it was found then put "1" other than
this put "0" I have used this If statement before:
=IF(AND(AC5>=AE5,AC5<=AF5),"1","0")
But the thing is its comparing each Row by Row, not Cell by Row, That is
unwanted, The thing is i want to compare each cell by all of the ranges in the
table and upon this it puts "1" or "0".
Please find the attached screenshots to clarify the question : Current Scenario
Example
My Question
Any Solutions please?
Answer

Can you try with COUNTIFS function? In the example attached here, I have
cell A & B for dateranges. E has Dates. I used to COUNTIFS in column F1 =
COUNTIFS(A:A,"<="&E1,B:B,">="&E1) to identify whether dates in E
within range A & B. If countifs return 1 or more, then it means data in E are
within range.
Topic 740
Subject
How to generate excel file with multiple worksheets and pivot tables and
charts without using any external dlls?
Question
I need to generate an excel reports which consists of a worksheet A which has
data and another worksheet B which has pivot table based on data on A.
Worksheet B also has a 2D column chart based on pivot table. Then the
worksheets A and B are repeated(iterated) based on data for different entities
in the SQL server database. This is the requirement.
I achieved this by creating a C# console application. I had to use EPPLUS dll
since the target server doesn't have MS-Excel installed. Now the twist is my
company only allows certain approved third party software to be used and
EPPLUS isn't among them(Yes! Stupid of me to invest time without checking
this first). I can request them to consider but I don't know if they approve or
how long they may take to approve. My colleagues suggested me to look for
alternatives. Here are the option I have in my mind.
Get MS-Excel installed on the server and modify C# application to get the
work done without EPPLUS. The question I have here how hard is it to
generate pivot tables and charts using this option. SSIS. I'm fairly proficient
and generated excels before. But I don't know how pivot tables and charts can
be generated using SSIS.
I hope this is clear. Any help is appreciated. Thanks in advance Answer
You can create the desired layout as an SSRS report, and use the "Export to
Excel" option.
Naturally there will be a learning curve if you've never used SSRS.

Topic 741
Subject
How to avoid overwriting of cell in excel using python?
Question
I am using python-2.7 and xlsxwriter for writing in excel sheet.
Following is my code...
workbook = Workbook('D:\S_details.xlsx') sheet =
workbook.add_worksheet()
rownum = 2
colnum = 2
for a in student_result: 
   for r, row in enumerate(student_result): 
           for c, col in enumerate(row): 
                  bold = workbook.add_format({'bold': 1}) 
                  sheet.write('A1','Student_ID',bold) 
                  sheet.write('B1','Student_Link',bold) 
                  sheet.write('C1','Student_Name',bold) 
                
sheet.write('D1','Student_Qualification',bold) 
                  sheet.write('E1','Student_Address',bold) 
                  sheet.write('F1','Student_City',bold) 
                  sheet.write('G1','Student_State',bold) 
                  sheet.write('H1','Student_Country',bold) 
                  sheet.write('I1','Student_Stream',bold) 
                  sheet.write('J1','Student_Gender',bold) 
                  sheet.write(r,c,col) 
                  rownum = rownum + 1 
                  colnum = colnum + 1 
the code runs well but the very first entry which is retrieved from database is
overwritten by the header of each column.
Hence only first entry is overwritten and rest of the entries are visible
perfectly.
I am also printing the data before writing it to excel sheet but it is not showing
any error nor the records are duplicated or so.

Can anyone please guide where I am going wrong...
Guidance / Help in any form is welcome.
Thank-you in advance :)
Answer
There are a few issues with the code example:
The headers are re-written for every iteration of the inner loop. This part of the
code should be outside the loop. The for a in student_result loop is unused.
The row_num and col_num variables are incremented but not used. The
enumerate() returns a 0 row value which overwrites or is overwritten by the
A1, B1 entries in the headers.
Fixing these issues would give something like this:
import xlsxwriter
workbook = xlsxwriter.Workbook('S_details.xlsx') sheet =
workbook.add_worksheet()
# Generate some sample data.
student_result = []
for num in range(1, 11):
student_result.append([num] * 10)
# Make the columns wider so that the text is visible. sheet.set_column('A:J',
20)
# Add some formatted headers.
bold = workbook.add_format({'bold': 1}) sheet.write('A1','Student_ID',bold)
sheet.write('B1','Student_Link',bold)
sheet.write('C1','Student_Name',bold)
sheet.write('D1','Student_Qualification',bold)
sheet.write('E1','Student_Address',bold) sheet.write('F1','Student_City',bold)
sheet.write('G1','Student_State',bold)
sheet.write('H1','Student_Country',bold) sheet.write('I1','Student_Stream',bold)

sheet.write('J1','Student_Gender',bold)
# Write the data.
for row_num, row_data in enumerate(student_result):
for col_num, col_data in enumerate(row_data):
sheet.write(row_num + 1, col_num, col_data)
workbook.close()
Answer
You preset rownum and colnum, but you're not using them in the write
statement. How about:
sheet.write(rownum,colnum,col)
Also you probably don't want to advance rownum in the col for loop, so:
for a in student_result: 
   for r, row in enumerate(student_result): 
           for c, col in enumerate(row): 
                  bold = workbook.add_format({'bold': 1}) 
                  sheet.write('A1','Student_ID',bold) 
                  sheet.write('B1','Student_Link',bold) 
                  sheet.write('C1','Student_Name',bold) 
                
sheet.write('D1','Student_Qualification',bold) 
                  sheet.write('E1','Student_Address',bold) 
                  sheet.write('F1','Student_City',bold) 
                  sheet.write('G1','Student_State',bold) 
                  sheet.write('H1','Student_Country',bold) 
                  sheet.write('I1','Student_Stream',bold) 
                  sheet.write('J1','Student_Gender',bold) 
                  sheet.write(rownum,colnum,col) 
                  colnum = colnum + 1 
            rownum += 1 
Topic 742
Subject

Getting null at workbook
Question
I am beginner in selenium webdriver, I have created a main class in these I
have created an object of writable class and in these I get the "testSuitName"
and then it goes to the writable class.
In writable class I have created an constructor and pass the string, in these I get
the value.
After that when I try to get the workbook it displayed the null but the way I
have given an path is correct according to windows OS. Also, in
"testSuitePath" I get my workbook.
Below are the snapshot which I have taken at the time of debug:
I am not able to get the problem that, where I am going wrong? Can any one
please help to resolving it.
Below are constructor where this line has written:
public WritableData(String testSuitePath, String
OBJECT_REPOSITORY_PATH) throws RowsExceededException,
WriteException
{
// TODO Auto-generated constructor stub 
       try { 
      Workbook wbook = Workbook.getWorkbook(new
File(testSuitePath)); 
      WritableWorkbook wwbCopy= Workbook.createWorkbook(new
File(testSuitePath),wbook); 
       System.out.println("writable workbookC-->" +wwbCopy); 
      WritableSheet shSheet=wwbCopy.getSheet("Login"); 
       System.out.println("writable sheetC-->" +shSheet); 
        } catch (Exception e) { 
           // TODO: handle exception 
           System.out.println("Exception message" +
e.getMessage()); e.printStackTrace(); } 

}
Answer
At that point you have paused BEFORE executing the
Workbook.getWorkbook(...) method, so the value is still null.
If you step one more line you should see a value there.
Topic 743
Subject
Microsoft.Office.Interop.Excel.Worksheet doesnot contain a definition for
'InsertRow'
Question
I want to dynamically insert few rows in an excel sheet , but when i tried to use
the below code as suggested in many of the answers in stack over flow, but its
throwing an error.
//Inserting 10 rows into the worksheet starting from 3rd row
worksheet.Cells.InsertRows(2,10);
Microsoft.Office.Interop.Excel.Worksheet doesnot contain a definition for
'InsertRow' and no extension method 'InsertRow' acceping a 1st argument of
type 'Microsoft.Office.Interop.Excel.Worksheet'
can any one help me in this...
As per suggestion given below , i tried to update my code
private void Insert_Empty_Rows()
{ 
      Excel.Application Excel_App = new
Microsoft.Office.Interop.Excel.Application(); 
      Excel.Workbook MyWorkBook =
Excel_App.Workbooks.Open(textBox1.Text.ToString(),
Type.Missing, Type.Missing, Type.Missing, Type.Missing,

Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing); 
      Excel.Worksheet MyWorksheet = null; 
      MyWorksheet =
(Microsoft.Office.Interop.Excel.Worksheet)MyWorkBook.Sheets[(1)
      Excel.Range Excel_Range; 
      Excel_Range = MyWorksheet.UsedRange; 
      for (var x = 0; x < 10; x++) 
      { 
          ((Excel.Range)MyWorksheet.Rows[2]).Insert(); 
      } 
}
still getting Error "No overload for method 'this' takes '1' arguments " Answer
Something like this should do the trick, as suggested here for instance: Excel
insert rows (not Add) 
      for (var x = 0; x < 10; x++) 
      { 
          ((Range) worksheet.Rows[2]).Insert(); 
      } 
Answer
private void Insert_Empty_Rows()
{ 
      Excel.Application Excel_App = new
Microsoft.Office.Interop.Excel.Application(); 
      Excel.Workbook MyWorkBook =
Excel_App.Workbooks.Open(textBox1.Text.ToString(),
Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing); 
      Excel.Worksheet MyWorksheet = null; 
      MyWorksheet =
(Microsoft.Office.Interop.Excel.Worksheet)MyWorkBook.Sheets[(1)
      Excel.Range Excel_Range; 

      Excel_Range = MyWorksheet.UsedRange; 
      for (var x = 0; x < 10; x++) 
      { 
        
((Excel.Range)MyWorksheet.Rows[2,Type.Missing]).Insert(Excel.X
Type.Missing); 
      } 
      SaveFileDialog SaveFileDialog1 = new SaveFileDialog(); 
      SaveFileDialog1.Title = "Browse to Save Excel Files"; 
      SaveFileDialog1.DefaultExt = "xls"; 
      SaveFileDialog1.Filter = "Excel files (*.xls or
*.xlsx)|.xls;.xlsx|All files (*.*)|*.*"; 
      SaveFileDialog1.FilterIndex = 2; 
      if (SaveFileDialog1.ShowDialog() == DialogResult.OK) 
      { 
          Excel_App.DisplayAlerts = false; 
          MyWorkBook.SaveAs(SaveFileDialog1.FileName,
Excel.XlFileFormat.xlWorkbookNormal, misValue, misValue,
misValue, misValue, Excel.XlSaveAsAccessMode.xlExclusive,
misValue, misValue, misValue, misValue, misValue); 
          MyWorkBook.Close(true, misValue, misValue); 
          Excel_App.Quit(); 
      } 
      Excel_App.Quit(); 
      MessageBox.Show("SOTP Updated Successfully"); 
}
if anyone has better solution than the above mentioned one ,Please post it...as
this piece of code worked for me .....
Topic 744
Subject
Change PivotStyle every next time of Macro Run
Question
I want to change the pivot stayle every next time when run dashboard, please
suggest for the same coding is:
Set rng = ws.Range("A1:" & Split(Cells(, lastcol).Address, "$")(1) &
lastrow) srcdata = rng.Address(ReferenceStyle:=xlR1C1) Set pvtch =
ActiveWorkbook.PivotCaches.Create(xlDatabase, srcdata) Set pvtbl =

pvtch.CreatePivotTable(tableDestination:=ptws.Range("A3"),
tablename:="PivotTable1") pvtbl.PivotFields("TAT Status").Orientation =
xlRowField pvtbl.PivotFields("RequestType").Orientation = xlRowField
pvtbl.PivotFields("Case Owner").Orientation = xlColumnField
pvtbl.AddDataField pvtbl.PivotFields("Reference no"), "Count_Ticket_ID",
xlCount ptws.Range("A4").Value = "Ticket Type with TAT" pvtbl.TableStyle2
= "PivotStyleDark1" 'Here I want to change the style every next time when
pivot table create.
Topic 745
Subject
Display the result of an optionButton in a messageBox
Question
I have a problem in displaying the selected option in the user form. I have 2
option buttons named opt750 and the value is 750 and the other one is opt1000
and the value is 1000.After selecting from the options, it should be displayed
in the msg box. The code I've tried is as follows, this is the whole message to
be displayed when the user click the ok button:
MsgBox "Date Received : " & vbTab + vbTab + date.Value + vbNewLine & _
"Amount Received : " & vbTab + amount.Value + vbNewLine & _ "Received
Type: " & vbTab + vbTab + acnType.Value + vbNewLine & _ vbNewLine & _
"Received the amount of : " 'this is where I should 'call the result of the
selected option button
I like the result to be displayed in the msgbox as:
Date Received : 01/01/2011
Amount Received: 10000
Received Type: ATM
Received the total amount of : 750 'if the button selected is 750 otherwise,
1000
Thanks a lot!
Answer
Assuming you have a user form with some option like below...

On Click of OK button message box will be displayed for my below code
based on the user selection option.
Private Sub CommandButton1_Click() 
      Dim amt As Integer 
      If (opt750) Then 
        amt = 750 
      ElseIf (opt1000) Then 
        amt = 1000 
        Else 
        amt = 0 
      End If 
      MsgBox "Received the amount of :" & amt 
End Sub
Topic 746
Subject
How do I count how many matches from a row appear in a column in excel?
Question
I need to count how many Secondary Names repeat in the Compared List for
each Primary List name. So for example: For Name 1, no secondary names
repeat in the compared list. I would like that to show a 0% in the % Match
column. For Name 3, two names in the secondary name category repeat. I
would like the % Match to show a 66% in that column.
Here is the snap FYR..
Is there way to do it using function combination?
Please note the actual list has ~20 secondary names for each Primary list name.
There are 90 primary list names. And the compared list has 800+ names.
Update
Format of sheet Answer
Based on your example picture, here is the formula for cell H2 to calculate
match% for Name 1, adjust ranges as needed for your actual data.

=SUM(IF(B2:D2=$F$2:$F$7,1,0))/COUNTA(B2:D2)
Note: This is an array formula, so you must confirm with
CTRL+SHIFT+ENTER.
Then, just drag it down assuming your actual data is laid out in the same
format.
Topic 747
Subject
Custom hh:mm:ss to decimal seconds
Question
I have some time data that has been imported into excel. For example, the cell
will have:
10:01:55 AM
The format is Custom as hh:mm:ss AM/PM.
I want to convert this into seconds so I can run some calculations. I've tried
playing with the format to no avail.
I've also tried this but it results in 0.
HOUR(A1)*3600 + MINUTE(A1)*60 + SECOND(A1)
Any idea will be appreciated!
Answer
Your formula seems correct to me, though there might be a more direct way to
do the conversion. I think your confusion is arising because the cell into which
you entered the formula is still formatted as hh:mm:ss AM/PM. If you change
the formatting of the cell to Number (CTRL + 1 then select "Number"), then
you get the output you want:
Update
Based on the detective work from @micuzzo, an alternative to the lengthy

formula is to simple use:
A1 * 86400
where 86400 is the number of seconds in a 24 hour day.
Answer
I just had to change the format of the cell to get what you wanted. You can right
click on the cell and select Format cell then choose General.
Jim
Topic 748
Subject
Using local SQL Server Database vs Access with Excel Addin
Question
I have an Excel addin which reads/writes from/to a MS access db that is
installed on the user's local machine. So each user that installs the addin also
needs their own stand alone Access db as well.
I'd like to do this with a SQL server db instead. How can I do that without
needing to install SQL server instance on every computer. Is that possible?
I jsut want to add the mdf file on the local/client machine as well as any
drivers and then via vba read/write from/to that mdf file
Topic 749
Subject
Issue with conditional formatting
Question
=AND(INDIRECT(ADDRESS(ROW(), COLUMN()-1))=1, TRUE)
When I use this in an excel formula, it correctly evaluates to true or false,
depending on the previous column value.
But when I try to use it as part of the formula of conditional formatting, it

always returns false and unable to set my conditional formatting based on the
value.
The same conditional formatting works with excel 2003 Answer
I believe you need to try this
=INDIRECT(ADDRESS(ROW(), COLUMN()-1))=1
instead of
=AND(INDIRECT(ADDRESS(ROW(), COLUMN()-1))=1, TRUE)
Topic 750
Subject
Pivot table with multiple items per transaction
Question
I am trying to create a pivot table and pivot chart in excel 2016 based off of
cattle auction data. Data for each auction includes: Head of Cattle, total
weight, avg weight, price per lb, and price a head. I am trying to show the avg
price per head of particular weights. The trouble is when one transaction is for
30 head @ $800 and the next is for 1 @ $700 it shows average price of $750.
But I want to show the average weight of the 31 cattle at $796 not the average
of the transactions @ $750. Any ideas? Answer
From what you've laid out in your question, it sounds like you should do some
calculations in your data before you pivot it. Basically, make a new column
that is [transaction] * [the head of cattle], so in this case the new column values
are 24000 and 700, respectively.
From there, you can insert a pivot table and use a custom calculation. While in
the pivot table click on 'Options' and then click on "Fields, Items, & Sets".
Then set the calculation in the formula bar to your new field divided by head of
cattle.
Topic 751
Subject

Excel Formula Flag Triggering
Question
What I'm trying to do in Excel is to figure out a way to trigger a flag after a
certain condition has been met.
E.g. I have numbers A and B. A is static while B changes. I also have a Flag f
that is initially false. When B>A, f changes to true and stays true regardless of
any future value of B.
I was trying to do this with a circular reference, but couldn't get an initial value
out of it. Is this possible while only using formulas? I've been trying to avoid
using VBA. Any help or point in the right direction would be appreciated.
Thanks
Answer
A formula based solution with circular references and allowing iterations will
be messy. If you can find someone who can create it in the first place, after a
while nobody will remember what it does and how to maintain it.
VBA that writes the value into the cell as soon as the condition is met is a
much more reliable and maintainable way.
The code would be along the lines of
Private Sub Worksheet_Change(ByVal Target As Range) If Not
Intersect(Target, Range("B1")) Is Nothing Then
If Range("F1") = False Then
If Range("B1") > Range("A1") Then Range("F1") = True End If
End If
End Sub
Topic 752
Subject
Import A CSV File into Excel (Requires Login/Pass)

Question
I've looked at dozens of similar topics here without finding what I'm looking
for. If I was doing it manually, I would navigate to the URL, given some
parameters:
https://the.website.com/mobile/rest/reportservice/exportReport?
name=shared%2FMV+Report.ppr&format=csv&showTotals=false&valueDate=
When I go there, it requests a username and password in a pop-up box, which I
enter, and it downloads the CSV.
This Python code works perfectly:
import requests
from requests.auth import HTTPBasicAuth
USERNAME = "i_cant_tell_you_guys"
PASSWORD = "definitely_cant_share_this"
auth = HTTPBasicAuth(USERNAME, PASSWORD)
URL = "https://the.website.com/mobile/rest/reportservice/exportReport?
name=shared%2FMV+Report.ppr&format=csv&showTotals=false&valueDate=
resp = requests.get(URL.format(USERNAME, PASSWORD), auth=auth,
verify=False)
print resp.content
But I can't seem to replicate it in VBA. Is it possible? If not, could I have Excel
and Python work together somehow?
Thanks!
Edit: Several people suggested this approach: VBA WinHTTP to download
file from password proteced https website but since the URL I'm pulling isn't
the actual file URL, it won't work.
Edit

Finally got it working. The website had a certificate mismatch, so I had to
tell WinHTTP to ignore SSL errors. Here's the new code:
Sub SaveFileFromURL()
Const Option_SSLErrorIgnoreFlags = 4 Const SslErrorFlag_Ignore_All =
13056 Const HTTPREQUEST_SETCREDENTIALS_FOR_SERVER = 0
Dim FileNum As Long
Dim FileData() As Byte
Dim WHTTP As Object
mainUrl = "https://website.com"
fileUrl = "https://website.com/myfile.csv" filePath = "C:\myfile.csv"
myuser = "login"
mypass = "pass"
Set WHTTP = CreateObject("WinHTTP.WinHTTPrequest.5.1")
WHTTP.Open "POST", mainUrl, False
WHTTP.SetCredentials myuser, mypass,
HTTPREQUEST_SETCREDENTIALS_FOR_SERVER
WHTTP.SetRequestHeader "Content-Type", "application/x-www-form-
urlencoded" WHTTP.Option(Option_SSLErrorIgnoreFlags) =
SslErrorFlag_Ignore_All
WHTTP.Send
WHTTP.Open "GET", fileUrl, False
WHTTP.Send
FileData = WHTTP.ResponseBody
Set WHTTP = Nothing
FileNum = FreeFile
Open filePath For Binary Access Write As #FileNum

Put #FileNum, 1, FileData
Close #FileNum
MsgBox "File has been saved!", vbInformation, "Success"
End Sub
Now I'm getting "Run-time error '75': Path/File access error"
Topic 753
Subject
Relative paths for VBScript file
Question
I have a VBScript file to open an Excel file and run a macro. This Excel file is
located in the same folder as the VBScript file. I would like to use relative
paths to call it, so that I can move that folder around without rewriting the
paths in the script. Right now my VBScript looks like this:
Option Explicit
On Error Resume Next
ExcelMacroExample
Sub ExcelMacroExample() 
    Dim xlApp 
    Dim xlBook 
    Set xlApp = CreateObject("Excel.Application") 
    Set xlBook =
xlApp.Workbooks.Open("C:\Users\Ben\Desktop\GeocodingBatchFile\F
    xlApp.Run "Export" 
    xlApp.Quit 
    Set xlBook = Nothing 
    Set xlApp = Nothing 
End Sub

Rather than using the full file path, it would be great if I could do something
like this:
Set xlBook = xlApp.Workbooks.Open(".\GeocodingStart.xlsm") Answer
You can use the FileSystemObject to get the path to the script file, like this
Sub ExcelMacroExample()
Dim xlApp
Dim xlBook
Dim fso
Set fso = CreateObject("Scripting.FileSystemObject") Dim fullpath
fullpath = fso.GetAbsolutePathName(".") Set fso = Nothing
Set xlApp = CreateObject("Excel.Application") Set xlBook =
xlApp.Workbooks.Open(fullpath & "\GeocodingStart.xlsm") xlApp.Run
"Export"
xlApp.Quit
Set xlBook = Nothing
Set xlApp = Nothing
End Sub
Answer
Try this...
Dim oFSO
Set oFSO = CreateObject("Scripting.FileSystemObject") sScriptDir =
oFSO.GetParentFolderName(WScript.ScriptFullName) Set xlBook =
xlApp.Workbooks.Open( sScriptDir & "\GeocodingStart.xlsm")
Topic 754
Subject
Excel VBA formula as text issue
Question
In my Excel 2016 VBA I have this code:

Range("M2").Select
ActiveCell.FormulaR1C1 = "=IFERROR(IF(E2=""Sgl"",K2,L2),"")"
when it gets placed in the cell it is the formula not the result. To manually fix
this I have to change from Text to General and also the actual code needs
changing:
Cell M2 says: =IFERROR(IF(E2="Sgl",K2,L2),") It should say:
=IFERROR(IF(E2="Sgl",K2,L2),"") with the extra " at the end before the
closing parenthesis
This was recorded (I removed the RC to the absolute cell reference initially
when it wouldn't work), so I'm not sure what caused this or how to resolve it.
Any help would be appreciated.
Thanks
Answer
I think you just need to add the extra quote at the end. Because the quote
denotes a string, you need to make two of them to yield one -- which means you
need four to yield two.
Range("M2").Formula = "=IFERROR(IF(E2=""Sgl"",K2,L2),"""")"
Other notes of interest:
You don't need to Range().Select and then work against ActiveCell. Just invoke
the methods/properties directly on the Range Object I think in your case
Formula will work. R1C1 is handy when the formulas are relative, but in this
case, you are referencing actual cells. There is nothing wrong with what you
did, but FYI
Answer
To generate the two double quotes ("") in IFERROR, you need to put 4 double
quotes ("""") in the vba string literal.
Answer

I fixed this by removing the IFERROR part as if there was no value in the
proceeding columns it simply left it blank anyway rather than showing an error
message:
Columns("M:P").Select
Selection.NumberFormat = "General"
Range("M2").Select
ActiveCell.FormulaR1C1 = "=IF(RC[-8]=""SGL"",RC[-2],RC[-1])"
Range("M2").Select
Topic 755
Subject
VBA Class with Static Variables
Question
I'm running into an issue. I'm trying to define a couple variables that are used in
several methods in a class module.
I keep getting an invalid outside procedure error. Can anyone point me in the
right direction? I feel like it is a scope issue but, I'm unsure on how to validate
this.
' class file_ops
' attributes
Private pdb_file As String
Private pdb_path As String
pdb_file = "db.xlsx"
pdb_path = ThisWorkbook.Path + "\"
Public Sub open_db(pdb_file, pdb_path)
Workbooks.Open Filename:=pdb_path + pdb_file
End Sub
Public Sub close_db(pdb_file)

pdb_file.Close SaveChanges:=False
End Sub
Topic 756
Subject
excel 2010 vba pivot table report filter update
Question
I have 16 pivot tables on the same sheet, "Analytics Admin", I recorded and
cleaned up the macro below (the code right before updates the info the pivot
tables source). It's basically the same code 16 times, the only thing that changes
is the pivot table name ( MSP, MSP30, FSP, FSP30, etc). Is it possible to
change the report filter for all the pivot tables at once?
Worksheets("Analytics Admin").Activate
'refreshes all data, clears all filters then filters 0 and blanks out of all custom
range pareto pivot tables
ActiveSheet.PivotTables("MSP").PivotCache.Refresh
ActiveSheet.PivotTables("MSP").PivotFields("count").ClearAllFilters
ActiveSheet.PivotTables("MSP").PivotFields("count").ShowAllItems = True
With ActiveSheet.PivotTables("MSP").PivotFields("count") 
      .PivotItems("0").Visible = False 
      .PivotItems("(blank)").Visible = False 
End With
ActiveSheet.PivotTables("MSP").PivotCache.Refresh
ActiveSheet.PivotTables("FSP").PivotCache.Refresh
ActiveSheet.PivotTables("FSP").PivotFields("count").ClearAllFilters
ActiveSheet.PivotTables("FSP").PivotFields("count").ShowAllItems = True
With ActiveSheet.PivotTables("FSP").PivotFields("count") 

      .PivotItems("0").Visible = False 
      .PivotItems("(blank)").Visible = False 
End With
ActiveSheet.PivotTables("FSP").PivotCache.Refresh Answer
Something along the lines of (not tested, just typed into here)
dim ws as Worksheet
set ws = ThisWorkbook.Worksheets("Analytics Admin") dim pt as PivotTable 
      For Each pt In ws.PivotTables 
'            Debug.Print Pivot.Name 
          pt.PivotFields("count").ClearAllFilters 
          pt.PivotFields("count").ShowAllItems = True 
          With pt.PivotFields("count") 
            .PivotItems("0").Visible = False 
            .PivotItems("(blank)").Visible = False 
          End With 
          pt.PivotCache.Refresh 
          pt.refreshTable 
          pt.Update 
      Next 
Answer
If you have Excel 2010 or later, and most (hopefully all) of these Pivots share
the exact same data source, you can do this with little or no looping. Simply set
up a Slicer on the "count" field and then connect it to all the PivotTables (right
click on the Slicer, and select "Report Connections". Then you only need to run
the code on one of those PivotTables, and all the others will update
automatically.
You can hide the Slicer somewhere if you don't want users to click it.
Topic 757
Subject
Save and Reopen Excel file every X minutes

Question
I am trying to save and reopen an excel file every X minutes.
I ended up with the following code, but it works only once. File is saved,
reopened but that's it.
Sub Update()
Application.DisplayAlerts = False
ThisWorkbook.Save '保存
Workbooks.Open ActiveWorkbook.Path & "\" & ActiveWorkbook.Name
Application.DisplayAlerts = True
Call Auto_Open
End Sub
Sub Auto_Open()
Application.OnTime Now + TimeValue("00:02:00"), "Update" End Sub
What is wrong with my macro ? Is it possible ?
I took inspiration here and here.
EDIT - For those who wonder why I would do this: I have linked data from
referenced Excel files. When I update excel files within Excel everything is
fine, linked data is refreshed in real time.
Problem is when referenced files are edited within Excel Online, data is not
refreshed. It works when I use the button "Refresh values" but my requirement
is to refresh data automatically.
When I reopen the excel file data is refreshed, this is why I try to reopen the
document automatically.
Topic 758
Subject
Create JSON with through Excel Hierarchy
Question

I have a table with a tree products. Category, group and subgroup.
When you export the json the Excel file out without hierarchy: As this example:
[
{
"id_cat": 4,
"desc cat": "Acessorios para Veiculos", "id_gr": 1,
"desc gr": "Acessorios Nautica",
"id_sub": 15,
"desc sub": "Bombas"
},
{
"id_cat": 4,
"desc cat": "Acessorios para Veiculos", "id_gr": 1,
"desc gr": "Acessorios Nautica",
"id_sub": 16,
"desc sub": "Cabos"
},
{
"id_cat": 4,
"desc cat": "Acessorios para Veiculos", "id_gr": 1,
"desc gr": "Acessorios Nautica",
"id_sub": 17,
"desc sub": "Helices"
},
Must generate a file like this:
[
{
"category": { 
    "id": 4, 
    "name": "Acessorios para Veiculos", 
    "group": [ 
      { 
        "id": 1, 
        "name": "Acessorios Nautica", 

        "subgroup": [ 
          { 
            "id": 15, 
            "name": "Bombas" 
          }, 
          { 
            "id": 16, 
            "name": "Cabos" 
          }, 
          { 
            "id": 17, 
            "name": "Helices" 
          } 
        ] 
      }, 
      { 
        "id": 2, 
        "name": "Acessorios de Carros", 
        "subgroup": [ 
          { 
            "id": 26, 
            "name": "Exterior" 
          }, 
          { 
            "id": 27, 
            "name": "Interior" 
          } 
        ] 
      } 
    ] 
}
}
]
the to do this with Excel? Anyone know the best way I can create a file that
through my table format? Answer
You can use JS object as a Hash table to keep track of the category id, group id
and subgroup id.
I came up with a quick implementation below (assuming that all items in the
initial array have id_cat, id_gr and id_sub value), have a look at this jsFiddle

function grouping(items) {
var catHash = {}, 
      catList = [], 
      i = 0; 
for (i = 0; i < items.length; i++) { 
      var hash = catHash[items[i]["id_cat"]] || {}; 
      hash.groupHash = hash.groupHash || {}; 
      var groupHash = hash.groupHash[items[i]["id_gr"]] ||
{}; 
      groupHash.subgroupHash = groupHash.subgroupHash || {}; 
      var subgroupHash = groupHash.subgroupHash[items[i]
["id_sub"]] || {}, 
          cat = hash.category || {}, 
          group = groupHash.group || {}, 
          subgroup = subgroupHash.subgroup || {}; 
      if (!cat.id) { 
          cat.id = items[i]["id_cat"]; 
          catList.push(cat); 
          hash.category = cat; 
          catHash[cat.id] = hash; 
      } 
      if (!cat.name) { 
          cat.name = items[i]["desc cat"]; 
      } 
      if (!cat.group) { 
          cat.group = []; 
      } 
      if (!group.id) { 
          group.id = items[i]["id_gr"]; 
          cat.group.push(group); 
          groupHash.group = group; 
          hash.groupHash[group.id] = groupHash; 
      } 
      if (!group.name) { 
          group.name = items[i]["desc gr"]; 
      } 

      if (!group.subgroup) { 
          group.subgroup = []; 
      } 
      if (!subgroup.id) { 
          subgroup.id = items[i]["id_sub"]; 
          group.subgroup.push(subgroup); 
          subgroupHash.subgroup = subgroup; 
          groupHash.subgroupHash[subgroup.id] = subgroupHash;
      } 
      if (!subgroup.name) { 
          subgroup.name = items[i]["desc sub"]; 
      } 
}
return catList;
}
Topic 759
Subject
Transferring from IE 10 to IE 11 in excel VBA
Question
I have some code to go to a website and log in. It worked fine until yesterday,
when I got the error
'Run time error '429':
ActiveX object can't create object
I checked, and somehow now Internet Explorer is gone from my programs.
This is my code:
Dim IE As Object
Dim strURL As String
Dim objelement As Object
Sub login()
' Add reference to Microsoft Internet Controls ' Add reference to Microsoft
HTML Object Library

Set IE = New SHDocVw.InternetExplorer
IE.Visible = True
IE.navigate "https://minecraft.net/profile"
While IE.Busy
DoEvents
Wend
Do Until Not IE.Busy And IE.readyState = 4 DoEvents
Loop
IE.document.getElementById("username").Value = "bobbybobwob"
IE.document.getElementById("password").Value = "ceylon878"
Dim htmlForm As HTMLFormElement
Set htmlForm = IE.document.getElementById("loginForm") htmlForm.submit
'
**********************************************************************
'IE.Document.getElementById("username").Value = "ddddd" '
IE.Document.getElementById("password").Value = "dddddd" '
IE.Document.getElementById("signin").Click
'*********************************************************************
'Pause while page loads
Application.Wait (Now + #12:00:03 AM#)
IE.navigate "https://minecraft.net/profile/password" Do Until Not IE.Busy And
IE.readyState = 4 DoEvents
Loop
IE.document.getElementById("oldPassword").Value = "dsfsdf"
IE.document.getElementById("password").Value = "sdafsadfsdfsdafsdfsfsdf"
IE.document.getElementById("passwordConfirmation").Value =
"sdafsadfsdfsdafsdfsfsdf" IE.document.getElementById("submit").Click End
Sub
Topic 760
Subject
Excel matching and comparing
Question

So this seems a bit perplexing to me being that I'm new to Excel.
I have one-to-many relationship with SKU and Part#.
I want to see if each parts' price is equal to each other, but only if they share
the same SKU #.
And, if they are not the same price, to return a result of essentially, "different
price".
SKU# Part# Price
1000-002-581 56465 12800
1000-002-581 800335 13300
1000-002-582 56455 12800
1000-002-582 800325 13300
1000-002-584 56445 12800
1000-002-584 800315 13300
Above is the results I currently have.
i.e. SKU 1000-002-581 has Part #: 56465 and 800335. And the Price for each
part is different (12800 vs 13300). I want to retrieve a message because this is
different.
At the end of the day, I would only want to display the lines with part price
differences to each associated SKU.
Any thoughts on which collective functions would work? Answer
Add a column to the table with the formula
=IF(SUMIF(A:A,A2,C:C)/COUNTIF(A:A,A2)<>C2,"different","")
Turn on Autofilter and filter by the last column.
Topic 761
Subject
Trying to find a string in a file

Question
I'm looking for a free tool that I can use to find a string in an Excel file. I tried
Notepad++, and that didn't work. I tried Agent Ransack, and that's didn't work.
The intentionally entered a string into an XLSB file, and ran both Notepad++
and Agent Ransack, and neither utility can find the string. It found it in a Word
doc, but not in an Excel file.
Is there a free utility that I can download to find a string within an Excel file?
Thanks.
Answer
If you rename your XLSX file extension to zip, you can access the zip content
and you'll find an xml called sharedStrings.xml and you can search in it by
using Notepad++, Notepad, or other text editor.
Hope this helps you.
Topic 762
Subject
adding data from different sheets based on multiple cell input
Question
i'm trying to use an excel document to track where i've left off in all my tv-
shows. i wanted it to not only be easy for me to edit and add new shows, but
also show some statistics about how many episodes i still have left to watch
(both in the current season and in the entire show and how far i am in that show
in percentages).
i wanted to do this by making one sheet called 'where did i leave of?' with
three columns called name, season and episode. Next to those three would be
all the statistics. then for every show i wanted to make a new sheet with a list
of every season, howmany episodes that season has and howmany episodes all
the previous seasons had combined (thought that would make things easier
when trying to calculate howmuch % of the show i had already watched), with
at the bottom(row 100) the total amount of episodes in the show.

so my question is: how can i make excel look at a cell that says what show that
row is, go to that shows sheet. Look at what season i am in the main sheet, look
up howmay episodes all previous seasons had combined in that column and
then subtract that from the total number of episodes that show has and print it to
the cell in the main sheet?
Topic 763
Subject
VBA Solver code issue
Question
I am currently using a loop is which I access the excel solver. But every time
the solver solves an optimization problem, I have to click ok. I tried record
macro, but no code came up when I click the OK button. I will always accept
the solution suggested by the solver.I do not want to keep pressing Ok button
all the time. There could potentially be 2000+ optimization problems being
solved. Is there a way of making this work?
Also, is there a way of solving unbalanced transportation problem is a solver
without having to make dummy supplies or demand nodes?
Thank you.
The codes is as follows:
SolverReset
SolverOk SetCell:="$B$18", MaxMinVal:=2, ValueOf:=0, _
ByChange:="$M$5:$T$12", Engine:=2, EngineDesc:="Simplex LP"
SolverAdd CellRef:="$U$5:$U$12", Relation:=1,
FormulaText:="$V$5:$V$12"
SolverAdd CellRef:="$M$13:$T$13", Relation:=2,
FormulaText:="$M$14:$T$14" SolverSolve
Answer
The documentation at Solver.com (the website of the company that made the
Solver add-in) contains:

SolverSolve(UserFinish, ShowRef)
UserFinish Optional Variant. True to return the results without displaying the
Solver Results dialog box. False or omitted to return the results and display the
Solver Results dialog box.
ShowRef Optional Variant. You can pass the name of a macro (as a string) as
the ShowRef argument. This macro is then called, in lieu of displaying the
Show Trial Solution dialog box, whenever Solver pauses for any of the
reasons listed below.
Thus it seems that you need to replace the line SolverSolve by
SolverSolve True
But -- it is probably a better idea to read the rest of the documentation about
the return value of SolverSolve and perhaps do something like
retValue = SolverSolve(True)
and then check retValue with some error-handling if it isn't one of the values
which correspond to a successful run. People can be optimistic. Code should
be pessimistic.
Topic 764
Subject
Excel VBA - How to copy and paste groups of data following blank cells?
Question
I have data in B6 and M6 that correspond directly with each other. The data
goes from B6:B12 and then there are two blank cells in B13:B14. The data
then goes on from B15:B23 and then there are two blank cells and this pattern
repeats down the page...(the same goes for column M).
I researched finding blank cells and was able to use this code to grab that first
set of data from B6:B12 and M6:M12 and paste it on to a new worksheet in the
location I wanted. Here is the code:
Sub CopyandPaste()

NextFree = Range("B6:B" &
Rows.Count).Cells.SpecialCells(xlCellTypeBlanks).Row Range("B" &
NextFree).Select
NextFree2 = Range("M6:M" &
Rows.Count).Cells.SpecialCells(xlCellTypeBlanks).Row Range("M" &
NextFree2).Select
Sheets("Sheet 1").Range("B6:B" & NextFree).Copy
Destination:=Sheets("Sheet 2").Range("B13")
Sheets("Sheet 1").Range("M6:M" & NextFree2).Copy
Destination:=Sheets("Sheet 2").Range("J13")
End Sub
This works to grab the first group before the blank the two blank cells but I
cannot find a way to grab the second, third, and so on groups that follow two
blank cells. Any help would be appreciated. Answer
If you know the pattern of blocks (block - 2 spaces - block) you can do a
nested loop.
Sub grabBlocks()
Dim cFirst As Range, cLast As Range
Dim sh As Worksheet
Set sh = ThisWorkbook.Sheets(1)
Set cFirst = sh.Range("B6") 'First Cell of each new block Set cLast = cFirst
'This becomes last cell of the block
Do While Not cFirst = ""
'Get Last Cell of Block
Do While Not cLast.Offset(1, 0) = ""
Set cLast = cLast.Offset(1, 0)

Loop
'Do copy with this address
Debug.Print Range(cFirst.Address & ":" & cLast.Address).Address '... copy
code goes here...
'Go to next block
Set cFirst = cLast.Offset(3, 0) 'First cell of new block is 2 + 1 cells below the
last Set cLast = cFirst
Loop
End Sub
This code will terminate when the next block is more than 2 cells away,
expecting no more blocks to come.
Beware that these loops can become nasty if your termination condition can not
be satisfied (e.g. your cells contain 'invisible' data like spaces)
Answer
Sub copynPaste()
Dim i As Integer, j As Integer
j = 1
'loops from 1 to the last filled cell in column 2 or "B" For i = 1 To
Sheets("Sheet1").Cells(Rows.Count, 2).End(xlUp).Row 
     'checks if the cell has anything in it 
      If IsEmpty(Sheets("Sheet1").Range("B" & i)) = False
Then 
          'this is where the copying and pasting happens
(well basically) 
          Sheets("Sheet2").Range("B" & j).Value =
Sheets("Sheet1").Range("B" & i).Value 
          Sheets("Sheet2").Range("M" & j).Value =
Sheets("Sheet1").Range("M" & i).Value 
          j = j + 1 
      End If 

Next i
End Sub
Topic 765
Subject
Extract Top 5 Values for Each Group in a List Based on Specific Criteria
without VBA
Question
I have developed a formula to extract the top value from a list. Now I would
like to update the formula with the ability to filter the list to identify the top
value if Column Q contains "Y".
=INDEX('Inventory Turnover'!$B:$B,MATCH(1,INDEX(('Inventory
Turnover'!$K:$K=LARGE('Inventory Turnover'!$K:$K,ROWS('Inventory
Turnover'!C$1:C1)))*(COUNTIF('Inventory Turnover'!C$1:C1,'Inventory
Turnover'!$B:$B)=0),),0))
Thanks in advance for your time and consideration! Please let me know if my
request is unclear and/or if you have any specific questions. Appreciate any
support! Answer
Something like that can be done by a pivot table with a few clicks. Insert a
pivot table that points to the data, drag a label to the rows panel, drag the value
field to the values panel. Filter the pivot table to show the top ten or adjust to
show top x numbers.
Now use a slicer or a page filter to filter the pivot table on any other field.
Topic 766
Subject
Update Bloomberg API static data
Question
I want to copy and paste data from one sheet to another sheet. The original data
is from Bloomberg API function. I found the Bloomberg data cell only updates
after the macro finishes running. I tried to build a private function to let the
static data update before I copy it. Here is my code:

Private Sub ProcesData()
Application.Run
Call Application.OnTime(Now + TimeValue("00:00:01"), "ProcessData")
End Sub
Sub Macro3()
Dim i As Integer
i = 1
Do Until i > 2
Sheets("Sheet1").Activate
Cells(1, 3).Value = Cells(i, 1)
i = i + 1
Call Application.OnTime(Now + TimeValue("00:00:01"), "ProcessData")
Range("C4:E181").Select
Selection.Copy
Sheets("Sheet2").Select
Range("A1").Select
lMaxRows = Cells(Rows.Count, "A").End(xlUp).Row Range("A" &
lMaxRows + 1).Select
Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks
_
:=False, Transpose:=False
Loop
End Sub

Answer
Ah, Bloomberg API... many an issue.
So, when you do a Bloomberg request using a function call, the cell call site
receives a call back and refreshes the data.
The problem is, w.r.t. automation, the data can come back in parts and you
have to wait till it completes before continuing to process your data.
So, there are 3 approaches to this solution.
Last time I looked, this is the one that Bloomberg recommends. Have a routine
that refreshes the call to the cell formula. This has a timer and recursively
invokes itself until the data has been retrieved. The trick to this is to know
when the data has been retrieved correctly. The data area is checked for errors
which say it hasn't been completed yet. The other solution is to invoke the call
using Application.Run where you build the formula in code and invoke with
VBA. This allows you to not deal with functions as such in the worksheet. But
is effectively the same thing as 1. You can set a reference to the Bloomberg
API and use COM to do the request. This is a much cleaner approach and you
can easier integrate this into your code effectively creating a Bloomberg data
call API.
I would suggest, if possible going for option 3. Although a little more effort, te
code becomes much cleaner. Options 1. and 2. can be tricky to debug when
your workbooks become more complex in terms of structure etc.
If you search your Bloomberg help (the ever tremendous old 'F1 F1' help
service should be able to point you in the right direction. Simply the most
impressive help system ever done in my opinion!) Bloomberg does have some
examples which demonstrate the methods highlighted above.
So, with the issue at hand and to finally answer your question :) I would
restructure your code to actually do function call that initially does a
Calcuation (which will invoke your requests to Bloomberg). Then enter into a
recursive function which calls itself until there are no errors in the data. After
this you then copy your data.

Hope that helps.
Topic 767
Subject
how to select rows with duplicate content with criteria in excel?
Question
As you can see in the Data table, the ID is not unique, I would like to select the
unique ID and Value with the latest date. The results looks like the Results
table. Can anyone provide some VBA codes in excel to help with? Any help
will be greatly appreciated.
Data Table
ID Dates Value
10021 1/1/2012 591.00
10021 1/1/2014 591.00
10021 8/1/2015 621.00
10060 1/1/2006 240.00
10060 1/1/2011 385.00
10060 1/1/2014 446.00
10060 8/1/2015 468.00
10061 1/1/2006 501.00
10061 1/1/2011 658.00
10061 1/1/2014 796.00
10061 8/1/2015 836.00
Results Table
ID Dates Value
10021 8/1/2015 621.00
10060 1/1/2014 468.00
10061 8/1/2015 836.00
Answer
I sorted by Dates, from newest to oldest, I then used Remove duplicates
command. I think it automatically keep the first one, which is the newest one

Topic 768
Subject
Convert inputbox data entry to cell data entry
Question
I want to create a guessing game without using input boxes. I want the code to
read my guesses on column A and then tell me if it was right or wrong in
column C. The macro is for numbers 1 - 10 and the macro should go through
each guess.
Here's my code -
Sub VBAGuessingGame()
Dim Secret As Integer
Dim Guess As Integer
Dim Tries As Integer
Randomize 'Initializes random-number generator
Secret = Int((10 * Rnd) + 1) 'Generates a random number between 1 and 10
Guess = 0
Tries = 0
Do While Guess <> Secret
Guess = InputBox("Guess a number between 1 and 10.") If Guess = Secret
Then 
      Tries = Tries + 1 
      MsgBox ("You guessed the number!") 
      MsgBox ("It took you " & Tries & " to guess the
number") 
ElseIf Guess > Secret Then 
      Tries = Tries + 1 
      MsgBox ("Wrong. Too high. Try again.") 
  Else 
      Tries = Tries + 1 

      MsgBox ("Wrong. Too low. Try again.") 
End If
Loop
End Sub
Answer
Put this behind Sheet1(Sheet1), if that's the sheet you're using:
Private Sub Worksheet_Change(ByVal Target As Range) Dim Guess As
Integer, Secret As Integer ThisColumn = Target.Column
ThisRow = Target.Row
If IsNumeric(Target.Cells.Value) Then
Guess = Target.Cells.Value
Else: Guess = 0
End If
Randomize
Secret = Int(10 * Rnd) + 1
If ThisColumn = 1 Then
If Guess = Secret Then
Cells(ThisRow, 3).Value = "Right" Else
Cells(ThisRow, 3).Value = "Wrong" End If
Cells(ThisRow, 4).Value = Secret End If
End Sub
Topic 769
Subject
DAX - Rank values with RANK.EQ (difference Powerpivot and SSAS
Tabular model ?)
Question

I am a little bit troubled by the use of the RANK.EQ function between
Powerpivot (Excel 2013) and the SSAS Tabular Model (SQL Server 2014)
(which both use the Vertipaq engine, so same DAX synthax...right ?)
Explanation :
the synthax for RANK.EQ function is quite simple :
https://msdn.microsoft.com/fr-fr/library/gg492169%28v=sql.120%29.aspx
Typical case of use is to populate a calculated column inside your model.
Inside a table, just type the following formula :
=RANK.EQ(table[column] ; table[column])
For test purpose, I imported the same data model in both Powerpivot and
SSAS Tabular. If I type this above formula inside column of Powerpivot data
model, no problem and I get my rank. When I copy/paste the same formula into
in new column of my fresh SSAS Tabular datamodel I get the following error :
"We found a problem with this formula. Try clicking Insert function on the
Formulas tab to fix it, or click help for more info on common formulas
problems."
Weird...is anybody knows the reason of a such behavior difference between my
models ?
I greatly appreciate your help with this!
Thank's all
Topic 770
Subject
Excel VBA Search for Value in Column A Select Row Value is Found and
Column F as Active Cell
Question
I am a VBA newbie...
I am looking for value "A" in column A. I would then like to use the row
number which value "A" is located at, and copy the existing function in Column

F into Column E.
This is what I tried and which clearly does not work...
Dim A_Row As Long
A_Row = Application.WorksheetFunction.Match("A", Range("A:A"), 0)
Range("E" & A_Row).Select
ActiveCell.Select
ActiveCell.Offset(0, 5).Select
Selection.Copy
ActiveCell.Offset(0, -1).Select
ActiveSheet.Paste
Thank you in advance for your help!
Answer
In my opinion, if you are going to use vba then avoid using worksheet functions
unless totally necessary.
Sub caroll()
Dim ws As Worksheet
Dim A_row As Long
Dim rng As Range
Set ws = ActiveSheet
'Loop through column A
For Each rng In ws.Range(ws.Cells(1, 1), ws.Cells(ws.Rows.Count,
1).End(xlUp)) 
      'Test whether cell = "A","B", or "Z" 
      If VarType(rng) <> vbError Then 
          If rng.Value = "A" Or rng.Value = "B" Or rng.Value
= "Z" Then 
              'If true copy column F of that row into Column
E 
              rng.Offset(, 5).Copy rng.Offset(, 4) 
          End If 
      End If 

'loop
Next rng
End Sub
Topic 771
Subject
How to inner-join in Excel (eg. using VLOOKUP)
Question
Is there a way to inner join two different Excel spreadsheets using VLOOKUP?
In SQL, I would do it this way:
SELECT id, name
FROM Sheet1
INNER JOIN Sheet2
ON Sheet1.id = Sheet2.id;
Sheet1
+----+------+
| ID | Name |
+----+------+
| 1 | A |
| 2 | B |
| 3 | C |
| 4 | D |
+----+------+
Sheet2
+----+-----+
| ID | Age |
+----+-----+
| 1 | 20 |
| 2 | 21 |
| 4 | 22 |

+----+-----+
And the result would be:
+----+------+
| ID | Name |
+----+------+
| 1 | A |
| 2 | B |
| 4 | D |
+----+------+
How can I do this in VLOOKUP? Or is there a better way to do this besides
VLOOKUP?
Thanks.
Answer
First lets get a list of values that exist in both tables. If you are using excel
2010 or later then in Sheet 3 A2 put the following formula:
=IFERROR(AGGREGATE(15,6,Sheet2!$A$1:$A$5000/(COUNTIF(Sheet1!$A
If you are using 2007 or earlier then use this array formula:
=IFERROR(SMALL(IF(COUNTIF(Sheet1!$A$1:$A$5000,Sheet2!$A$1:$A$5
Being an array formula, copy and paste into the formula bar then hit Ctrl-Shift-
Enter instead of Enter or Tab to leave the edit mode.
Then copy down as many rows as desired. This will create a list of ID'd that
are in both lists. This does assume that ID is a number and not text.
Then with that list we use vlookup:
=IF(A2<>"",VLOOKUP(A2,Sheet1!A:B,2,FALSE),"")
This will then return the value from Sheet 1 that matches.

Answer
You can acheive this result using Microsoft Query.
First, select Data > From other sources > From Microsoft Query
Then select "Excel Files*".
In the "Select Workbook" windows, you have to select the current Workbook.
Next, in the query Wizard windows, select sheet1$ and sheet2$ and click the
">" button.
Click Next and the query visual editor will open.
Click on the SQL button and paste this query :
SELECT `Sheet1$`.ID, `Sheet1$`.Name, `Sheet2$`.Age FROM`Sheet1$`,
`Sheet2$`
WHERE `Sheet1$`.ID = `Sheet2$`.ID
Finally close the editor and put the table where you need it.
The result should look like this :
Topic 772
Subject
Remove characters from a string after a certain word - excel
Question
Ive got a list of imported data that is formatted as the following in a excel /
google spreadsheet. In column A i have the full data and in B im trying to strip
out the data to the left of the word ON.
FULL DATA | STRIPPED DATA 
NNK GOV ON 31 AUG CDE          |      NNK GOV 
GIFFGAFF.COM ON 30 AUG CDE     |      GIFFGAFF.COM 
TMRCO STORES  ON 12 AUG   CDE  |      TMRCO STORES 

I was using the following forumal, but it falls down where there is non uniform
white space as there is on the last entry.
=LEFT(a1, LEN(a1)-14)
Is there a more robust way i can write this, so it dosnt fall over when there is
non uniform whitespace or additional wording after "CDE" ?
Ive created a shared google spreadsheet here as a scratch pad :
https://docs.google.com/spreadsheets/d/1iieR_hAk8qJpy8W6Qq7ww9-640o-
HZMFLNNjecps6m4/edit#gid=0
Im using google spreadsheets, although ive marked this question as excel also
as ive found there to be many shared functions. Answer
In excel:
=TRIM(LEFT(A1,FIND(" ON",A1)))
This will work in Google sheets also but there may be an easier way in google
sheets that uses Regex.
Answer
This works:
=REGEXEXTRACT(A3,"(.) ON .")
I also added it on your sheet in the stripped column
Topic 773
Subject
Macros using conditional formatting for highlighting blanks
Question
I used conditional formating for selecting blanks and chose a pattern style for
displaying only blanks. However when I use the macro shortcut the whole
rows containing the blank is highlighed. How can only the cells be highlighted
by a pattern style. Code is given below

Range("A3:L26").Select
ActiveWindow.ScrollColumn = 7
ActiveWindow.ScrollColumn = 8
ActiveWindow.ScrollColumn = 9
ActiveWindow.ScrollColumn = 10
ActiveWindow.ScrollColumn = 11
ActiveWindow.ScrollColumn = 12
Range("A3:L26,N3:N26").Select
Range("N3").Activate
ActiveWindow.ScrollColumn = 13
ActiveWindow.ScrollColumn = 14
ActiveWindow.ScrollColumn = 15
ActiveWindow.ScrollColumn = 16
Range("A3:L26,N3:N26,R3:R26,W3:W26").Select Range("W3").Activate
ActiveWindow.ScrollColumn = 15
ActiveWindow.ScrollColumn = 14
ActiveWindow.ScrollColumn = 12
ActiveWindow.ScrollColumn = 10
ActiveWindow.ScrollColumn = 8
ActiveWindow.ScrollColumn = 7
ActiveWindow.ScrollColumn = 6
Selection.FormatConditions.Add Type:=xlExpression, Formula1:= _
"=LEN(TRIM(W3))=0"
Selection.FormatConditions(Selection.FormatConditions.Count).SetFirstPriorit
With Selection.FormatConditions(1).Interior
.Pattern = xlGray8
.PatternColorIndex = xlAutomatic
.ColorIndex = xlAutomatic
End With
Selection.FormatConditions(1).StopIfTrue = False
ActiveSheet.Range("$A$3:$W$26").AutoFilter Field:=7, Criteria1:= _
"John Doe"
ActiveWindow.ScrollRow = 14
ActiveWindow.ScrollRow = 13

ActiveWindow.ScrollRow = 9
ActiveWindow.ScrollRow = 7
ActiveWindow.ScrollRow = 5
ActiveWindow.ScrollRow = 4
End Sub
Topic 774
Subject
Excel VBA How to Prevent/Trap Data Type Mismatch Error in Arguement
Question
I have an Excel VBA user defined function where I've declared a datatype for
one of the function's arguments. I want to be able to trap potential errors in
case someone doesn't put in the right datatype. Seems like it should be simple,
but unable to figure it out.
See sample below where I've used a sub procedure to demonstrate the issue.
Sub MyTest()
MsgBox myfunction("123a")
End Sub
Function myfunction(mynum As Double) As String
On Error Resume Next
If IsNumeric(mynum) Then
myfunction = "ok"
Else
myfunction = "not ok"
End If
End Function
Extra Note: Though I'm using a sub procedure to demonstrate the issue, in
reality I'm using a user defined function and calling the function from my

worksheet. So it's not a simple as just adding protection in the "MyTest"
procedure before calling the "MyFunction" procedure.
Topic 775
Subject
Excel freezes while debugging an add-in in VS 2013
Question
I have developed an excel application level add-in in VB.Net using VS 2013.
When I debug the program, excel opens up in a different window. When I click
the button on the ribbon in excel (the one I created) to run the code, the code
runs.
If the code runs properly without any exceptions, everything works perfectly
and excel does not freeze. However, if the code encounters an exception or hits
a breakpoint, then I cannot do anything in excel. It just freezes. I cannot scroll
or move the excel window or minimize/maximize excel.
Why doe this happen? Any ideas to avoid this? Or am I doing something
wrong?
Topic 776
Subject
Auto expansion of formatted table in Excel using C#
Question
I was trying to insert a new row at the end of a worksheet using OLEDB. The
worksheet has a format table in a Range (a1:xx), with format and formula
stored. But OLEDB insert does not come with any format.
I have read the post How to copy format of one row to another row in Excel
with c# talking about get the format, but doesn't work for me. Also, I don't think
it will get the formula.
In the Excel UI, at the lower right corner of a formatted table, a double arrow
would appear, and we can drag it to expand the format table range.

Anything we could do through C#?
Thanks. 
      Excel.Range last =
xlWS.Cells.SpecialCells(Excel.XlCellType.xlCellTypeLastCell,
Type.Missing); 
      Excel.Range RngToCopyOri = xlWS.get_Range("A1",
last).EntireRow; 
      Excel.Range RngToCopy =
RngToCopyOri.Resize[RngToCopyOri.Rows.Count + 1,
RngToCopyOri.Columns.Count]; //because insert will add only 1
row, so the range would be one row larger 
      Excel.Range RngToInsert = xlWS.get_Range("A1",
Type.Missing).EntireRow; 
    
RngToInsert.Insert(Excel.XlInsertShiftDirection.xlShiftDown,
RngToCopy.Copy(Type.Missing)); 
I tried to copy Range(A1,lowerleft cell) to its original location, but nothing
changed. Answer
I tried Range.resize, autofill, autoformat. All of them has sort of problems. I
finally gave up using OLEDB to insert data. Instead, i used
worksheet.UsedRange.Item[rowNo,getColumnIndex(worksheet,columnTitle)]=v
private int getColumnIndex(Excel.Worksheet sheetname, string header) { 
      int index=0; 
      Excel.Range activeRange=sheetname.UsedRange; 
      for (int i = 1; i <= activeRange.Columns.Count; i++) { 
          if (header == (string)(activeRange.Item[1,i] as
Excel.Range).Value) { 
              index = i; 
          } 
      } 
      if(index==0) 
          throw some exception you like; 
      return index; 
}

The getColumnIndex function aims to locate the column in SELECT [column]
from...
In this way, the format table will automatically expand to the range you input
the value.
Topic 777
Subject
Excel VBA - LCM - Sub or Function not defined
Question
The following code:
Sub lcm_()
If Selection.Areas.Count <> 1 Then Exit Sub
Dim a As Range
Set a = Selection.Areas(1)
a.Item(1).Value = Lcm(a.Item(1).Value, a.Item(2).Value)
End Sub
produces the error: Compile error: Sub or Function not defined, and I cannot
figure out why. I have looked at similar problems, and it seems like the issue is
that Excel cannot find the builtin function LCM, but the documentation makes it
seem like it doesn't require any special libraries. I am very new to VBA, so it
is entirely possible that this is something very simple, but I cannot figure out
what.
EDIT
It is worth noting that if I simply click on a cell and type =LCM(A8,A9), then it
works fine. Answer
Try this:
Sub lcm_()

If Selection.Areas <> 1 Then Exit Sub
Dim a As Range
Set a = Selection.Areas(1)
a.Item(1).Value = WorksheetFunction.Lcm(a.Item(1).Value, a.Item(2).Value)
End Sub
Topic 778
Subject
Asp.net web pages (razor) page to import Excel Data to SQL Server 2014
table
Question
Background: I have a asp.net web pages (razor) application on a 2008R2 web
server that has a page with an excel upload button which allows the user to
post excel data to a SQL Server 2014 table. In order to get it to work on the
dev server I had to install the Microsoft Access Database Engine 2010 as
outlined in this MikesDotNetting blog post. However, I have been encouraged
to find a way to import data to the production server that doesn't require
installing Microsoft Access Database Engine on the server. I have a C#
Windows Forms app that does the same thing but I am not good at converting
Windows Forms app code to my razor web sites.
I actually didn't expect this code below to work since I am posting data to SQL
Server 2014 and according to MS OleDB has been deprecated and has not
been supported since SQL Server 2012.
Q1 - Does deprecated just mean 'use at your own risk' or does it mean it
shouldn't work on 2014 at all?
The code below (which occurs right after my if...ISPOST) works great for
getting an excel file uploaded to my web server then inserted into a SQL
Server 2014 table. I just need to find a way to make it work without installing
Microsoft Access Database Engine to the production server 2008 R2 IIS7.
Q2 - Is there some Nuget Package or other workaround that might help?

Q3 - Is there a quick fix to convert that OLE DB connection string to ODBC?
Q4 - Is there a namespace / assembly I could add to the project that would not
require the access database engine install on the server?
Code
try 
              { 
                  // import code 
                  var excel = Request.Files[0]; 
                  var file =
Path.Combine(Server.MapPath("~/Upload_Folder/"),
excel.FileName); 
                  excel.SaveAs(file); 
                  var excelConnectionString =
"Provider=Microsoft.ACE.OLEDB.12.0;Data Source={0};Extended
Properties=\"Excel 12.0 Xml;HDR=Yes;IMEX=1\""; 
                  var sqlConnectionString =
ConfigurationManager.ConnectionStrings["MYCONNECTIONSTRING"].To
                  var excelData = new DataTable(); 
                  using (var myConnection = new
OleDbConnection(string.Format(excelConnectionString, file))) 
                  { 
                      var myCommand = new
OleDbCommand("SELECT * FROM [Sheet1$]", myConnection); 
                      var myAdapter = new
OleDbDataAdapter(myCommand); 
                      myAdapter.Fill(excelData); 
                      using (var destinationConnection = new
SqlConnection(sqlConnectionString)) 
                      { 
                          destinationConnection.Open(); 
                          using (var bulkCopy = new
SqlBulkCopy(destinationConnection)) 
                          { 
                              bulkCopy.DestinationTableName =
"MYTABLE"; 
                            
bulkCopy.ColumnMappings.Add("CODE", "code"); 
                            
bulkCopy.ColumnMappings.Add("TITLE", "title"); 
                            
bulkCopy.ColumnMappings.Add("LAST_NAME", "last_name"); 
                            

bulkCopy.ColumnMappings.Add("FIRST_NAME", "first_name"); 
                          } 
                      } 
                      if
(Directory.Exists(Path.GetDirectoryName(file))) 
                      { 
                          File.Delete(file); 
                      } 
                  } 
              } 
              catch (Exception ex) 
              { 
                  throw ex; 
              } 
Answer
I didn't get any responses to this question after nearly 50 views which made me
think it was too general a question with many different solutions. However to
make it as useful a post as possible I just wanted to document my own
solutions (with links) to the 4 original questions proposed (see comments 1-4
above). --Tim
Topic 779
Subject
Listbox Item selection based on other Listbox item selection
Question
There two (ActiveX) listboxes on sheet (Monthlist & Yearlist). Each is
populated with unique values from columns H(months) and I(years) (see code
below). The user will select month(s) available in Monthlist. I would like the
available items in ‘Yearlist’ to reflect the selection in ‘Monthlist’. For
example, if there is data on sheet for May, 2015 and June, 2016, and the user
selects ‘May’ from Monthlist, ‘2015’ should only be available on ‘Yearlist’ for
selection. (‘2016’ should be grayed out or not present).
The obvious solution is to apply filter to column H that would reflect the
selection in Monthlist, then collect unique visible values from column I into an
array and display them in Yearlist. Perhaps there is more elegant solution to
this problem? Thanks for your help.

Sub UniqueMonthsAndYears(ByVal ws As Object)
Dim LastRow, i, j, k As Long
Dim c As Range
Dim MyArUniqVal() As Variant
Dim i2, j2, k2 As Long
Dim c2 As Range
Dim MyArUniqVal2() As Variant
Dim MonthList As MSForms.ListBox
Dim YearList As MSForms.ListBox
ReDim MyArUniqVal(0)
ReDim MyArUniqVal2(0)
Dim rng As Range
Dim cl As Range
LastRow = ActiveSheet.Range("H" & Rows.Count).End(xlUp).Row
Set rng = Range("H9:H" & LastRow)
With ThisWorkbook.ActiveSheet 
      For Each cl In rng 
          If cl.EntireRow.Hidden = False Then '//Use Hidden
property to check if filtered or not 
                Debug.Print cl 
              If cl.Value <> cl.Offset(1, 0).Value Then
'~~~~~MonthArray 
                  MyArUniqVal(UBound(MyArUniqVal)) = cl.Value
                  ReDim Preserve
MyArUniqVal(UBound(MyArUniqVal) + 1) 
              End If 
              If cl.Offset(0, 1).Value <> cl.Offset(1,
1).Value Then 'Year Array 
                  MyArUniqVal2(UBound(MyArUniqVal2)) =
cl.Offset(0, 1).Value 
                  ReDim Preserve

MyArUniqVal2(UBound(MyArUniqVal2) + 1) 
              End If 
         End If 
      Next cl 
      ReDim Preserve MyArUniqVal(UBound(MyArUniqVal) - 1) 
      ReDim Preserve MyArUniqVal2(UBound(MyArUniqVal2) - 1) 
End With
'Fill the listbox
ws.YearList.Clear
For k2 = 0 To UBound(MyArUniqVal2)
ws.YearList.AddItem (MyArUniqVal2(k2))
Next k2
ws.MonthList.Clear
For k = 0 To UBound(MyArUniqVal)
ws.MonthList.AddItem (MyArUniqVal(k))
Next k
End Sub
Topic 780
Subject
VBA and Excel: Why does my TRIM script results in #VALUE on large data
sets?
Question
The following script works on smaller data sets (less than 30k rows or so), but
results in "#VALUE" errors for every cell in the selected range when the range
is larger than that.

Dim FirstCell As Range, LastCell As Range, MyRange As Range
Set LastCell = Cells(Cells.Find(What:="", SearchOrder:=xlRows, _ 
    SearchDirection:=xlPrevious, LookIn:=xlValues).Row, _ 
    Cells.Find(What:="", SearchOrder:=xlByColumns, _ 
    SearchDirection:=xlPrevious, LookIn:=xlValues).Column) 
Set FirstCell = Cells(Cells.Find(What:="", After:=LastCell,
SearchOrder:=xlRows, _ 
    SearchDirection:=xlNext, LookIn:=xlValues).Row, _ 
    Cells.Find(What:="", After:=LastCell, SearchOrder:=xlByColumns,
_ 
    SearchDirection:=xlNext, LookIn:=xlValues).Column) 
Set MyRange = Range(FirstCell, LastCell) 
    MyRange.Select 
    If MyRange Is Nothing Then Exit Sub 
    Application.ScreenUpdating = False 
    Application.Calculation = xlCalculationManual 
  With Selection 
      .Value = Evaluate("if(row(" & .Address &
"),clean(trim(" & .Address & ")))") 
End With
Application.ScreenUpdating = True
Application.Calculation = xlCalculationAutomatic MsgBox "Finished
trimming " & vbCrLf & "excess spaces", 64
VBA TRIM Error
Answer
I managed to replicate your issue, and using a variant array as shown below
overcomes the issue for large data sets

Dim FirstCell As Range, LastCell As Range, MyRange As Range Dim
DataRange() As Variant
Dim lRows As Long
Dim lCols As Long
Dim i As Long, j As Long
Dim value As String
Set LastCell = Cells(Cells.Find(What:="", SearchOrder:=xlRows, _ 
    SearchDirection:=xlPrevious, LookIn:=xlValues).Row, _ 
    Cells.Find(What:="", SearchOrder:=xlByColumns, _ 
    SearchDirection:=xlPrevious, LookIn:=xlValues).Column) 
Set FirstCell = Cells(Cells.Find(What:="", After:=LastCell,
SearchOrder:=xlRows, _ 
    SearchDirection:=xlNext, LookIn:=xlValues).Row, _ 
    Cells.Find(What:="", After:=LastCell, SearchOrder:=xlByColumns,
_ 
    SearchDirection:=xlNext, LookIn:=xlValues).Column) 
Set MyRange = Range(FirstCell, LastCell) MyRange.Select
If MyRange Is Nothing Then Exit Sub
Application.ScreenUpdating = False
Application.Calculation = xlCalculationManual lRows =
MyRange.Rows.Count
lCols = MyRange.Columns.Count
ReDim DataRange(1 To lRows, 1 To lCols) DataRange = MyRange.value
For j = 1 To lCols
For i = 1 To lRows
DataRange(i, j) = Trim(DataRange(i, j)) Next i
Next j
MyRange.value = DataRange
Application.ScreenUpdating = True

Application.Calculation = xlCalculationAutomatic MsgBox "Finished
trimming " & vbCrLf & "excess spaces", 64
For reference, I used this article to help come up with the answer:
https://blogs.office.com/2008/10/03/what-is-the-fastest-way-to-scan-a-large-
range-in-excel/
Topic 781
Subject
Can Excel 2013 add a SUM() function when data is entered into new row?
Question
I am creating a Excel template and would like for it to add a SUM() function to
a newly added row. For example, I could have data already entered with
column U as the Total column for each row. Total for row 1 would be in U1
(=SUM(M1:T1)) and 2 would be in U2 (=SUM(M2:T2)) and so on. In this
example when data is entered in row 3, is there any way Excel can create the
SUM() function for U3 (=SUM(M3:T3)) without manually doing it?
Topic 782
Subject
Nested IF / AND / OR statement
Question
I have a formula that I can seem to get most of the way there, but can't make the
final jump. Here is the scenario. If any cell in an array (B2:B4) is not blank,
then cell B9 should populate a text value OR if any cell in a different array
(D6:D9) has a text value, then again cell B9 should populate with a different
text value. Finally, if both arrays meet the specific criteria, then cell B9 should
populate with a third text value.
Here is what I have that works. This formula returns a value of "Correct" id
B2:B4 is not blank OR if D7:D9 contains the text "Plus" it returns a value of
"Plus". Otherwise it leaves cell B9 blank.
=IF(OR(B2<>"",B3<>"",B4<>""),"Correct",IF(OR(D7="Plus",D8="Plus",D6=
This AND formula returns "Correct+Plus" if both of the criteria above are met.

=IF(AND(OR(B2<>"",B3<>"",B4<>""),
(OR(D7="Plus",D8="Plus",D6="Plus”))),”Correct+Plus”,”Correct or Plus or
Nothing")
I can't seem to get the formula that combines both. If array 1 is not blank, return
"Correct". If array 2 is "Plus" return "Plus". If array 1 is not blank AND array
2 is "Plus", return "Correct+Plus". Answer
Your narrative is different than you formula, You state that array 1 need to not
have any blanks, yet you use an OR which states that if any are not blank it will
return true and only false when all three are blank. If that is the case use this:
=IF(AND(COUNTBLANK(B2:B4)
<3,COUNTIF(D6:D8,"Plus")),"Correct+Plus","Correct or Plus or Nothing")
But if you want to ensure that non of the first array are blank then use this:
=IF(AND(COUNTBLANK(B2:B4)=0,COUNTIF(D6:D8,"Plus")),"Correct+Plu
or Plus or Nothing")
Answer
Here is what I found that works.
=IF(AND(OR(B2<>"",B3<>"",B4<>""),
(OR(D7="Plus",D8="Plus",D6="Plus"))),"Correct+Plus",IF(OR(B2<>"",B3<>
Answer
Alternate formula that will work for you:
=CHOOSE((COUNTBLANK(B2:B4)<3)+
(COUNTIF(D6:D8,"plus")>0)*2+1,"Blank","Correct","Plus","Correct+Plus")
Topic 783
Subject
Determine average of values in a column based upon a column with a unique
identifier via Excel 2010

Question
I am trying to determine the average of values in a column based upon a
column with a unique identifier. I have included a picture for clarification.
Column A represents block groups, of which there are 27 unique groups.
Column E represents the year a structure was built within that block group.
There are multiple instances of the same block group number in Column A and
I would like to aggregate each of these block group numbers and determine the
average year built for all of the structures in each of the 27 block groups.
For example, there are 18 cases of block group '240419601001' and my goal is
to average the years associated with this block group number and then have
that result appear in a new column.
My end goal is to take these averages and use them to fill in rows where there
is no year built associated with a specific block group.
Thanks.
Answer
You want AverageIf():
=AVERAGEIF(A:A,"240419601001",E:E)
so in an empty column put this formula in row 2:
=IF(E2="",AVERAGEIF(A:A,A2,E:E),E2)
Then copy and past just the values over column E.
Topic 784
Subject
VBA, How to make formula into Macro
Question
I have the following basic formula,
=LEFT(A1,FIND(".",A1)-1)

How can I make this into a macro, so on my selected cell it pastes this
formula? Just instead of copying and pasting over and over it may be easier to
make this a shortcut to a macro. Also is this something that can be applied
among-st any formulas?
Thanks
Answer
Sub qwerty()
ActiveCell.Formula = "=LEFT(A1,FIND(""."",A1)-1)" End Sub
NOTE
We double-up on the double-quotes!
Answer
You can also create custom function: 
   Function MyLeft(my_Cell_String) As String 
       MyLeft = Left(my_Cell_String, InStr(1, my_Cell_String,
".") - 1) 
   End Function 
Then your formula in the cell will be:
=MyLeft(A1)
Topic 785
Subject
How to find the average of every six cells in Excel
Question
This is a relatively common question so I don't want to be voted down for
asking something that has been asked before. I will explain as I go along the
steps I took to answer this question using StackOver Flow and other sources so
that you can see that I have made attempts to solve it without solving a
question.

I have a set of values as below:
O P Q "R" Z
6307 586 92.07 1.34
3578 195 94.83 6.00
3147 234 93.08 4.29
3852 227 94.43 15.00
3843 171 95.74 5.10
3511 179 95.15 7.18
6446 648 90.87 1.44
4501 414 91.58 0.38
3435 212 94.19 6.23
I want to take the average of the first six values in row "R" and then put that
average in the sixth column in the sixth row of Z as such:
O P Q "R" Z
6307 586 92.07 1.34
3578 195 94.83 6.00
3147 234 93.08 4.29
3852 227 94.43 15.00
3843 171 95.74 5.10
3511 179 95.15 7.18 6.49
6446 648 90.87 1.44
4501 414 91.58 0.38
3435 212 94.19 6.23 
414     414 91.58   3.49 
212     212 94.19   11.78 
231     231 93.44   -1.59 3.6 
191     191 94.59   2.68 
176     176 91.45   .75 
707     707 91.96   2.68 
792     420 90.95   0.75 
598     598 92.15   7.45 
763     763 90.66   -4.02 
652     652 91.01   3.75 
858     445 58.43   2.30  2.30 

I have utilized the following formula I obtained
=AVERAGE(OFFSET(R1510,COUNTA(R:R)-6,0,6,1))
but I received an answer that was different from what I obtained by simply
taking the average of the six previous cells as such:
=AVERAGE(R1505:R1510)
I then tried the following code from a Stack OverFlow (excel averaging every
10 rows) conversation that was tangentially similar to what I wanted
=AVERAGE(INDEX(R:R,1+6(ROW()-ROW($B$1))):INDEX(R:R,10(ROW()-
ROW($B$1)+1)))
but I was unable to get an answer that resembled what I got from taking a rote
==AVERAGE(R1517:R1522)
I also found another approach in the following but was unable to accurately
change the coding (F3 to R1510, for example)
=AVERAGE(OFFSET(F3,COUNTA($R$1510:$R$1517)-1,,-6,))
Doing so gave me a negative number for a clearly positive set of data. It was
-6.95. Answer
Put this in Z1 and copy down:
=IF(MOD(ROW(),6)=0,AVERAGE(INDEX(R:R,ROW()-5):INDEX(R:R,ROW
Topic 786
Subject
How to stop a For…Next in Excel with button?
Question
The code below was something I modified from a solution found online. The
context of the form.

The form has a combo box with 3 buttons(Add, Next, Done)
Add will paste whatever is selected from combo box Next is supposed to
move to next empty cell in column (code below) Done should close the form
so the spreadsheet can be viewed.(code below)
What I'm running into is that when I hit the "done" button, it doesn't close out if
I've run "next". The For...Next loop goes until all spaces are filled. What I
want is a way to stop the for loop when I hit "done" I've tried adding a
statement to show if current cell has characters to exit for but then it just killed
the code and it wouldn't run at all. So I'm at a loss right now, if anyone would
be able to help that would be great. Thanks.
Private Sub nxtBtn_Click()
Dim sourceCol As Integer, rowCount As Integer, currentRow As Integer Dim
currentRowValue As String, cString As String
sourceCol = 7 'column G has a value of 7 rowCount = Cells(Rows.count,
sourceCol).End(xlUp).Row
'for every row, find the first blank cell and select it
For currentRow = 4 To rowCount
currentRowValue = Cells(currentRow, sourceCol).Value If
IsEmpty(currentRowValue) Or currentRowValue = "" Then 
      Cells(currentRow, sourceCol).Select 
      End If 
Next
End Sub
Private Sub done_bn_Click()
'Refresh the workbook/pivot tables
ThisWorkbook.RefreshAll

'Close form
Unload Me
End Sub
Answer
Instead of using a loop to find the first blank cell in column F, simply use the
Range.Find method. You can replace your entire loop with this one line:
Columns("F").Find(vbNullString, Range("F3"), xlValues, xlWhole).Select
That way you don't have to exit code execution, because this will find the first
blank cell in column F after cell F3 (which I'm guessing is a header) with no
looping required.
Answer
You're going to need to pause the loop and check for any events sent to the
program.
In VBA, there is the function DoEvents. This, in layman's terms, allows the
program to "catch up to itself". So, what I'd suggest is adding a DoEvents to
your loop, and then check for keystrokes. You want to trap the Ctrl/Break keys,
which is what would pause VBA.
I'm thinking something like this:
Private Sub nxtBtn_Click()
Dim sourceCol As Integer, rowCount As Integer, currentRow As Integer Dim
currentRowValue As String, cString As String
sourceCol = 7 'column F has a value of 7 rowCount = Cells(Rows.count,
sourceCol).End(xlUp).Row
'for every row, find the first blank cell and select it
For currentRow = 4 To rowCount

currentRowValue = Cells(currentRow, sourceCol).Value If
IsEmpty(currentRowValue) Or currentRowValue = "" Then 
      Cells(currentRow, sourceCol).Select 
      End If 
'Allow the code to catch up, so it can determine if Ctrl/Break were sent
DoEvents
Next
End Sub
Private Sub done_bn_Click()
'Send the Ctrl/Break keys to Excel
Application.SendKeys("^{BREAK}")
'Refresh the workbook/pivot tables
ThisWorkbook.RefreshAll
'Close form
Unload Me
End Sub
Topic 787
Subject
How to incorporate a changing variable into a text Msgbox in VBA?
Question
I am currently trying to make a simple VBA program that would multiply two
numbers together and then prompt a message box that says "The value of
(variable1) and (variable 2) is (The answer).
Here is my current attempt that isn't perfect:
MsgBox prompt:=intmlt, Title:="The Value of " & intFirstNum &
intSecondNum

The two big issues I have is how to you put a space inbetween the intFirstNum
and intSecondNum? and How do you add an is to the end of that prompt?
Topic 788
Subject
How do i make this code search across the work sheet, right now it only
searches row A
Question
Sub Sample()
Dim oRange As Range, aCell As Range, bCell As Range Dim ws As
Worksheet
Dim ExitLoop As Boolean
Dim SearchString As String, FoundAt As String
On Error GoTo Err
Set ws = Worksheets("Sheet3")
Set oRange = ws.Columns(1)
SearchString = "2"
Set aCell = oRange.Find(What:=SearchString, LookIn:=xlValues, _ 
              LookAt:=xlWhole, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
              MatchCase:=False, SearchFormat:=False) 
If Not aCell Is Nothing Then 
      Set bCell = aCell 
      FoundAt = aCell.Address 
      Do While ExitLoop = False 
          Set aCell = oRange.FindNext(After:=aCell) 
          If Not aCell Is Nothing Then 
              If aCell.Address = bCell.Address Then Exit Do 
              FoundAt = FoundAt & ", " & aCell.Address 
          Else 
              ExitLoop = True 

          End If 
      Loop 
  Else 
      MsgBox SearchString & " not Found" 
End If
MsgBox "The Search String has been found these locations: " & FoundAt Exit
Sub
Err:
MsgBox Err.Description
End Sub
Answer
Try this:
Sub Sample()
Dim oRange As Range, aCell As Range, bCell As Range Dim ws As
Worksheet
Dim ExitLoop As Boolean
Dim SearchString As String, FoundAt As String
Set ws = Worksheets("Sheet3")
On Error GoTo Err
Set oRange = ws.Cells
SearchString = "2"
Set aCell = oRange.Find(What:=SearchString, LookIn:=xlValues, _ 
              LookAt:=xlWhole, SearchOrder:=xlByRows,
SearchDirection:=xlNext, _ 
              MatchCase:=False, SearchFormat:=False) 
If Not aCell Is Nothing Then 

      Set bCell = aCell 
      FoundAt = aCell.Address 
      Do While ExitLoop = False 
          Set aCell = oRange.FindNext(After:=aCell) 
          If Not aCell Is Nothing Then 
              If aCell.Address = bCell.Address Then Exit Do 
              FoundAt = FoundAt & ", " & aCell.Address 
          Else 
              ExitLoop = True 
          End If 
      Loop 
  Else 
      MsgBox SearchString & " not Found" 
End If
MsgBox "The Search String has been found these locations: " & FoundAt Exit
Sub
Err:
MsgBox Err.Description
End Sub
Answer
Your range is referring to Column A , set range to All Cells in the sheet
Set oRange = ws.Cells
Topic 789
Subject
Axlsx Gem:Ruby - Creating A dropdown
Question
wb.add_worksheet(name: 'Report') do |sheet|
sheet.add_data_validation("D25", {
:type => :list,
:formula1 => 'list!D11:D17',

:showDropDown => false,
:showInputMessage => true,
:promptTitle => 'blah blah',
:prompt => 'Please select a valid blah' })
end
I have no idea how to populate the dropdown. The template shows a caret
which tells me that it knows I want this to be a dropdown. Answer
With your formula1 => 'list!D11:D17' you reference on another Worksheet
named list.
If you reference only D11:D17 you get the values from the selected area:
require 'axlsx'
Axlsx::Package.new do |p|
wb = p.workbook
wb.add_worksheet(name: 'Report') do |sheet| 
    sheet.add_data_validation("A10", { 
      :type => :list, 
      :formula1 => 'A1:A9', 
      :showDropDown => false, 
      :showInputMessage => true, 
      :promptTitle => 'blah blah', 
      :prompt => 'Please select a valid blah' 
      }) 
  end 
    p.serialize('simple.xlsx') 
    puts "Wrote simple.xlsx" 
end
You can use your list!-reference, but then you must name your sheet list.
Example
require 'axlsx'

Axlsx::Package.new do |p|
wb = p.workbook
wb.add_worksheet(name: 'list') do |sheet| 1.upto(10){|i| sheet.add_row([i])}
end
wb.add_worksheet(name: 'Report') do |sheet| 
    sheet.add_data_validation("A1", { 
      :type => :list, 
      :formula1 => 'list!A1:A9', 
      :showDropDown => false, 
      :showInputMessage => true, 
      :promptTitle => 'blah blah', 
      :prompt => 'Please select a valid blah' 
      }) 
  end 
    p.serialize('simple.xlsx') 
    puts "Wrote simple.xlsx" 
end
Topic 790
Subject
Trailing Newlines in excel using MATLAB's writetable()
Question
I'm trying to write a MATLAB table containing strings to excel using
writetable(). I'd like the text in excel to end in a newline, that is a blank line
with nothing written on it. However, I can't seem to get trailing newlines to
write.
format_spec = 'r %6.4f\ng %6.4f\nb %6.4f\n'; vals = rand(4,5,3);
temp_str = cellfun(@(x) sprintf(format_spec,x) ,...
squeeze(mat2cell(permute(vals,[3 1 2]), ... [size(vals,3)],
[ones(1,size(vals,1))],[ones(1,size(vals,2))])) ,... 'UniformOutput',false);
temp_table = cell2table( temp_str );
writetable(temp_table,'test_table.xlsx'); %//where's my trailing newline?

xlswrite('test_cell.xlsx',table2cell(temp_table)); %//trailing newline preserved
With xlswrite the trailing newline is handled correctly, but to get the same
functionality as writetable I have to add additional code to write the
RowNames and VariableNames, and offset the excel location of the table
contents by one row and one column. I guess I already have work around using
xlswrite, but my question is if/how this can be done with writetable. Answer
I reached out to the Mathworks regarding this issue and was told it is a bug.
For now xlswrite must be used to preserve trailing newlines.
Topic 791
Subject
Add sheet to Excel through Access VBA
Question
When running this code, I receive an "Object Required" error on
activeworkbook.sheets.add command
Also tried objexcel.sheets.add("Test") and received "Add method of Sheets
class failed."
Public Sub InitialConditions(FileName As Variant) 
      Dim objexcel As Object 
      Dim wbexcel As Object 
      Set objexcel = CreateObject("excel.Application") 
      Set wbexcel = objexcel.workbooks.Open(FileName) 
      activeworkbook.sheets.Add ("Test") 
      objexcel.Visible = True 
End Sub
Answer
Your code uses late binding. But the Excel object model is rich and complex.
So I think you would be better off to use early binding during development and
testing. That way you can take advantage of Intellisense to guide you and the

compiler will be able to identify problems more thoroughly.
Public Sub InitialConditions(FileName As String)
'* enable these 4 lines for deployment ' Dim objexcel As Object
' Dim wbexcel As Object
' Dim objsheet As Object
' Set objexcel = CreateObject("excel.Application")
' enable these 4 lines for development and testing ' (requires reference to
Excel Object Library) Dim objexcel As Excel.Application
Dim wbexcel As Excel.Workbook
Dim objsheet As Excel.Worksheet
Set objexcel = New Excel.Workbook
Set wbexcel = objexcel.Workbooks.Open(FileName) '
ActiveWorkbook.Sheets.Add ("Test")
Set objsheet = wbexcel.Sheets.Add
objsheet.Name = "Test"
objexcel.Visible = True
End Sub
When you're ready to deploy your application, you can switch back to late
binding. That allows you to remove the Excel reference which reduces the
possibility of reference issues in production use.
Answer
try
activeworkbook.sheets.add
after:=activeworkbook.sheets(activeworkbook.sheets.count)
activeworkbook.sheets(activeworkbook.sheets.count).Name = "Test"
Topic 792
Subject
Excel Formula Count Issue

Question
Background Summary
I have a really simple excel file with 2 sheets:
Sheet #1 (Date) = A single column of time and date stamps. Sheet #2 (Rep) =
A report table broken down by day of the month and hour(12 AM -11:59 PM) .
Basically on Sheet #2, It counts the number of date/time occurrences that fall
between the referenced hour. For example, for the 12:00 AM hour, it counts all
occurrences that fall between 12:00 AM - 12:59 AM. For the next hour, it will
count all occurences that fall between 1:00 AM - 1:59 AM and so on. Please
see the attached excel spreadsheet. In short, the table allows me to see the total
number of occurences hourly and for the entire month
The ISSUE
The issue I'm having is that there is a total of 208,784 date instances. However,
when I calculate the total number of instances for the given month it only counts
208,171. I cannot figure out why 613 instances are not being counted. Please
see details below
My Forumuala used to count each hour (5:00 AM hour example below)
=COUNTIFS(Date!A1:A208790, ">=" & "11/5/2015 5:00
AM",Date!A1:A208790, "<=" & "11/5/2015 5:59 AM")
Excel File Download
https://drive.google.com/file/d/0B8m6eCe12n37MTJ2MTY2WGZCakU/view?
usp=sharing Answer
The 613 are falling in the space between 12:59 and 1:00. You will find that
this is a floating decimal issue.
Even though you see no seconds, way down in the decimal where it would not
effect the time, are numbers that make it larger than 59 minutes but less than the
hour.
Change your formula to this:

=COUNTIFS(Date!A1:A208790, ">=" & "11/5/2015 5:00
AM",Date!A1:A208790, "<" & "11/5/2015 6:00 AM")
By getting everything less than the full hour and greater than or equal to the
previous full hour you should not lose any.
Answer
I found the issue. I was leaving the seconds value out in the formula. In other
words my time references in the formula SHOULD HAVE looked like this:
Start = 5:00:00 AM
End = 5:59:59 AM
Referencing the seconds value within the formula was the missing piece here.
Thanks guys!
Topic 793
Subject
Excel cell has NA and only refreshed when you focus into the cell and hit Enter
Question
I have a very strange Excel issue and wondering if anyone has experienced
such problem before.
I received a file from a colleague that some of the cells are showing #N/A
values when the file is opened. If I focus into the cell, then the formula text box
at the top and press Enter key then the cell is re-calculated with the proper
value.
The cell formula is a simple VLOOKUP function:
=VLOOKUP(A174, OTHERSHEET!$B$4:$G$580, 6, FALSE)
Couple other observations:
If I click on the yellow exclamation button and Evaluate the formula then it still
resolves to #N/A The workbook calculation settings is already set to
Automatic. Pressing F9 or Recalculate Now/Sheet from the Formulas ribbon

does not fix it.
The file was created from Excel 2013 64-bit version. Answer
The file may have a bad dependency tree. Try using:
Ctrl + Alt + Shift + F9
Topic 794
Subject
Telerik Kendo grid-export to excel is not responding when trying to export
more than 4000 records to excel
Question
Kendo grid-export to excel is not responding when trying to export more than
4000 records to excel... And its not even throwing an error message ... Can
someone please advice or suggest a work around for this.
Here is the code for Kendo grid 
                          @(Html.Kendo().Grid(Model) 
      .Name("Billinggrid") 
      .Columns(columns => 
      { 
          columns.Bound(c =>
c.groupid).Width(75).Filterable(true).Sortable(true).HeaderHtml
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.groupname).Width(125).Filterable(true).Sortable(true).HeaderH
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.groupeffectivedate).Width(90).Filterable(true).Sortable(true)
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.recipientdatareceived).Width(95).Filterable(true).Sortable(tr
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.recipientsent).Width(100).Filterable(true).Sortable(true).Hea
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.accountmanager).Width(125).Filterable(true).Sortable(true).He
{ style = "overflow: visible; white-space: normal" }); 

          columns.Bound(c =>
c.billinggroup).Width(75).Filterable(true).Sortable(true).Heade
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.reportyearmonth).Width(85).Filterable(true).Sortable(true).He
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.recordcount).Width(55).Filterable(false).Sortable(true).Heade
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c =>
c.datafilecount).Width(50).Filterable(false).Sortable(true).Hea
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c => c.datacharge).Format("
{0:c}").Filterable(false).Sortable(false).HeaderHtmlAttributes
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c => c.printcharge).Format("
{0:c}").Filterable(false).Sortable(false).HeaderHtmlAttributes
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c => c.insertcharge).Format("
{0:c}").Filterable(false).Sortable(false).HeaderHtmlAttributes
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c => c.envelopecharge).Format("
{0:c}").Filterable(false).Sortable(false).HeaderHtmlAttributes
{ style = "overflow: visible; white-space: normal" }); 
          columns.Bound(c => c.postage).Format("
{0:c}").Filterable(false).Sortable(false); 
          columns.Bound(c => c.total).Format("
{0:c}").Filterable(false).Sortable(false); 
          columns.Bound(c =>
c.postageremaining).Width(95).Format("
{0:c}").Filterable(true).Sortable(true).HeaderHtmlAttributes(ne
{ style = "overflow: visible; white-space: normal" }); 
      }) 
      .Resizable(resizable => resizable.Columns(true)) 
      .Reorderable(reorderable => reorderable.Columns(true)) 
      .Pageable(pager => pager.PageSizes(new int[] { 10, 25,
50, 100, 500 }) 
          .Messages(messages => messages.ItemsPerPage(" items
displayed")) 
          ) 
      .Sortable() 
      .Scrollable(scr => scr.Height("auto")) 
      .HtmlAttributes(new { style = "Font-size:x-small" }) 
      //.ToolBar(tools => tools.Excel()) 
      .Excel(excel => excel 
          .FileName("Billing_Report-" + DateTime.Now +

".xlsx") 
          .AllPages(true) 
          //.Filterable(true) 
          .ProxyURL(Url.Action("Excel_Export_Save",
"Report")) 
          ) 
      //.Filterable(ftb => ftb.Mode(GridFilterMode.Row)) 
      .ToolBar(toolbar => 
Answer
From the post in telerik forum System Out of Memory
When OpenAccess executes a query the actual retrieval of results is split into
chunks. There is a fetch size that determines the number of records that are
read from the database in a single pass. With a query that returns a lot of
records this means that the fetch size is not exceeded and not all 40 000
records will be retrieved at one time in memory. Iterating over the result data
you will get several reads from the database until the iteration is over.
However, when you iterate over the result set subsequent reads are
accumulated when you keep references to the objects that are iterated. An out
of memory exception may be caused when you operate with all the records
from the grid. The way to avoid such an error would be to work with the data
in chunks. For example, a paging for the grid and an option that exports data
sequentially from all pages will achieve this. The goal is to try to reduce the
objects kept in-memory at a time and let the garbage collection free unneeded
memory. A LINQ query with Skip() and Take() is ideal in such cases where
having all the data in-memory is costly.
Topic 795
Subject
Excel linked to Word, changing Excel file name
Question
I have an Excel file linked in a Word document via paste special -> paste as
unformatted text link. When I move the Excel file to a different folder, Word
knows its been moved and updates the source location. However, if I change
the Excel file name, Word simply clears all the links I embedded, removing the

possibility of updating the source location manually. Is there any way to
circumvent this problem?
Topic 796
Subject
Highlight duplicates not next to each other using conditional formatting (Larger
Dataset)
Question
We have a list of product numbers in Excel in a certain order. For reasons I
won't get into, we need to highlight when there are duplicates that aren't next to
each other.Currently, I'm using this formula in a conditional format to do the
job.
=AND(COUNTIF($A$2:$A$82,$A2)>1,$A1<>$A2,$A2<>$A3)
This mostly works well except in cases where there are pairs of duplicates
like in the example below, we would want FO-1694 to be highlighted, because
they aren't all next to each other. But we would not want NIS0257 to be
highlighted because they are.
Currently
Ideally, this is what we want to see...
Expected
I originally asked this same question January 30th (link) and I received what
seemed to be a working solution with the conditional formatting formula
=NOT(AND(A2=OFFSET(A2,COUNTIF($A2:$A$82,A2)-1,0),A2=OFFSET(
(COUNTIF($A$2:$A2,A2)-1),0)))
While this original answer appears to work for a small group of data
(example), it does not function as needed on much larger datasets like the ones
I'll be dealing with (images below are of the issues with the larger dataset).
I've adjusted the formula as necessary to accommodate the larger range, so the
conditional formatting formula you see in the larger dataset pictures & file is

=NOT(AND(A2=OFFSET(A2,COUNTIF($A2:$A$5422,A2)-1,0),A2=OFFSE
(COUNTIF($A$2:$A2,A2)-1),0)))
Cells with the arrow pointing at them should be highlighted
For the last picture, even though it's the end of the range the cells should still
be highlighted since they're blank and I need all blank cells in the range to be
highlighted too.
The full file with the larger dataset can be downloaded from my dropbox
account using this link. Answer
I should have thought of those problems:
=NOT(AND(IFERROR(COUNTIF(OFFSET(A1,0,0,-
COUNTIF($A$1:$A1,A2)),A2),0)=IFERROR(COUNTIF($A$1:$A1,A2),0),IF
Should do it.
Answer
I'm not sure if this would work for you
=IF(COUNTIF($A$1:$A$8,A2)>2,1,IF(AND(COUNTIF($A$1:$A$8,A2)=2,A
I've tested it on a test bit of data, and seems to work. You need to check for the
1st row, as you cant check the previous cell, so the A1<>A2 part..
1 being true condition on my test so would need tweaking for conditional
formatting. Enjoy.
Topic 797
Subject
VB.NET ExportToExcel - how to remove links from column headers
Question
I have a GridView that I am exporting to Excel using the following code
'Excel Export

Protected Sub ExportToExcel(ByVal sender As Object, ByVal e As EventArgs)
Response.Clear()
Response.Buffer = True
Response.AddHeader("content-disposition",
"attacment;filename=GridViewExport.xls") Response.Charset = ""
Response.ContentType = "application/vnd.ms-excel"
Using sw As New StringWriter()
Dim hw As New HtmlTextWriter(sw)
GLGridView.HeaderRow.BackColor = Drawing.Color.White 
      'Hide "Details" column 
      GLGridView.Columns.Item(0).Visible = False 
      'Hide "Quick Match" checkbox column 
      GLGridView.Columns.Item(1).Visible = False 
      For Each cell As TableCell In
GLGridView.HeaderRow.Cells 
          'would like to remove the link in the column header
          'and be left with just the text 
      Next 
      For Each row As GridViewRow In GLGridView.Rows 
          row.BackColor = Drawing.Color.White 
          For Each cell As TableCell In row.Cells 
              If row.RowIndex Mod 2 = 1 Then 
                  cell.BackColor = Drawing.Color.White 
              Else 
                  cell.BackColor = Drawing.Color.AliceBlue 
              End If 
              cell.CssClass = "textmode" 
          Next 
      Next 
      GLGridView.RenderControl(hw) 
      'style to format numbers to string 
      Dim style As String = "<style> .textmode { } </style>" 
      Response.Write(Style) 
      Response.Output.Write(sw.ToString()) 
      Response.Flush() 
      Response.End() 

End Using
End Sub
Public Overrides Sub VerifyRenderingInServerForm(ByVal control As
Control)
' Verifies that the control is rendered End Sub
The result is an worksheet containing the data I am expecting.
My only issue is that the Excel column headers contain links that call
javascript. This is because the column headers have a sorting function:
<a href="javascript:__doPostBack('GLGridView','Sort$local_or_cco')"
style="color:#333333;">Local or CCO</a>
My question is how would I make it so the column headers in the Excel
spreadsheet are the inner HTML (remove the hyperlink before the export)?
Appreciate any help. Thanks.
Topic 798
Subject
Excel nested if array
Question
I am doing a nested min if array, and am having issue with it reading blanks.
=MIN(IF(Sheet1!$C:$C<=A24,IF(Sheet1!$AE:$AE>A24,Sheet1!$C:$C),IF(Sh
So in English, I'm asking that if the dates in sheet 1 column C are less than or
equal to the value in A24, and the date in sheet 1 column AE is after the date in
A24, OR the value in sheet 1 column AE is blank, give me the earliest date of
what's left from column C. I hope that makes sense!
Any help would be greatly appreciated as I have spent literally hours on this
trying isblanks, further nested if, all with no joy. Answer

If you have Excel 2010 this AGGREGATE() Function will work:
=AGGREGATE(15,6,(Sheet1!C:C/((Sheet1!C:C<=A24)*
((Sheet1!AE:AE>A24)+(Sheet1!AE:AE="")))),1)
If you have 2007 or earlier then the array formula should do it:
=MIN(IF(((Sheet1!C:C<=A24)*((Sheet1!AE:AE>A24)+
(Sheet1!AE:AE=""))),Sheet1!C:C))
Being and array it must be entered with Ctrl-Shift-Enter instead of just Enter or
Tab.
The issue is when using the or in arrays one should use +. So now if
(Sheet1!AE:AE>A24) or (Sheet1!AE:AE="") are true it will return a 1
because 0+1=1.
Where the and portion is * because 0 * 1= 0. So both would need to be true to
return the 1, or true.
Answer
Do you have to use nested if's?
Why not have the if statement evaluate all three conditions. An OR function to
check two conditions (check for blanks OR value in col AE is greater an A24.
Then, have the result of the OR function feed into an AND function along with
the third check (column C less than or equal to A24). Then if the entire logical
check of the IF function returns TRUE, use a MIN function to give you the
minimum value in Column C. Likewise, if the logical check of the IF function
evaluates to False, do something else (ex. "No Match")
something like this:
=(IF(AND(COL_C <= $A$24, OR(COL_AE > $A$24,
ISBLANK(COL_AE))),MIN(COL_C,"No Match"))
Topic 799
Subject

VBA Compiler Won't Allow Use of Parentheses Around Method Arguments
Question
I'm curious why Excel's VBA editor will accept this line of code:
ActiveSheet.Outline.ShowLevels rowlevels:=1, columnlevels:=1
But I get a "Compile Error: Expected:=" message box when I type this line of
code:
ActiveSheet.Outline.ShowLevels(1,1)
Excel's help says that the ShowLevels method's syntax is
expression.ShowLevels(RowLevels, ColumnLevels) and the editor lists this as
the correct syntax when I right click and choose Parameter Info.
Does anyone know why this occurs? I'd prefer to use the parentheses just
because it looks cleaner and takes up less space.
Thank you all in advance!
Answer
You also use parenthesis when returning a value, as this function returns a
variant, you can still say a=Activesheet.Outline.ShowLevels(1,1), but not
Activesheet.Outline.ShowLevels 1,1
Topic 800
Subject
Copying sheets from various workbooks and pasting into a sheet in a different
workbook
Question
I have 7 workbooks which are all of an identical format on each sheet. I want
to grab "Sheet2" from each of the workbooks and paste them into a master
sheet in a separate workbook. I have managed to do this but the pasting keeps
overwriting the the last paste. How can I paste below the last pasted entry?
I have this for each of the 7 sheets

Sub MoveHR()
Dim x As Workbook
Dim y As Workbook
'## Open both workbooks first:
Set x = Workbooks.Open("\\ukkh1-afp-sv1o\Shared\Sales\Field Sales -
ERN\DSRs\. DSR's February 2016\HRehman February.xlsm") Set y =
Workbooks.Open("\\ukkh1-afp-sv1o\Shared\Sales\Field Sales -
ERN\DSRs\Trackers\SIMPosa Tracker.xlsm")
'Now, copy what you want from x:
x.Sheets("SIMPosa").Range("A:J").Copy
'Now, paste to y worksheet:
y.Sheets("Current Month").Range("A1").PasteSpecial xlPasteValues
'Close x:
Application.CutCopyMode = False
x.Close False
y.Close True
End Sub
Answer
Try to add a loop to find the next empty row, like this:
dim i as integer
i=1
do until y.sheets("Current Month").cells(i,1).value=""
i=i+1
loop
y.Sheets("Current Month").Cells(i,1).PasteSpecial xlPasteValues
Answer
Change this line:

y.Sheets("Current Month").Range("A1").PasteSpecial xlPasteValues
to this:
y.Sheets("Current Month").Range("A" & y.Sheets("Current
Month").Rows.Count).End(xlup).Offset(1)).PasteSpecial xlPasteValues
The 2nd line is the equivalent of going to the last row in the sheet and hitting
Ctrl+Up and to find the last row with data, then offsetting that by 1 row to
paste the new data.
Topic 801
Subject
Changing lower bound of array with ReDim gives subscript error
Question
I have a situation where it would be useful to re-dim an array by changing the
lower bound of the array, but it gives me a subscript error. Just wondered if
anyone else had come across this behaviour?
Sub test()
Dim arr() As Integer
ReDim arr(1 To 10)
ReDim Preserve arr(2 To 11)
End Sub
Answer
You cant do that, as this would mean an array with a base of 2, which isnt
allowed as you've declared it as starting at 1, you could create a new array and
transfer 1 to 10 in the position of 2 to 11. I believe that to be correct any how :)
Topic 802
Subject
Excel VBA macro to replace all previously saved worksheets as CSV files?
Question
Here is the code I have for saving all worksheets in my workbook as
individual CSV files to a specific path that the user can pick through the folder

picker. However if I make any changes to any of the spreadsheets and run the
macro again, it prompts me with the 'File already exists at this path.....Do you
want to replace'. If I click Yes, the prompt comes up for every single
worksheet. If I click no, the macro throws an error - see screenshot.
Is there a way I could modify the macro for me to just replace all the csv files
and vaoid the prompt altogether?
Sub CSVAutomation()
Dim ws As Worksheet, wb As Workbook
Dim pathh As Variant
Set wb = ActiveWorkbook
With Application.FileDialog(msoFileDialogFolderPicker)
.AllowMultiSelect = False
If .Show = -1 Then 'a folder was picked
pathh = .SelectedItems(1)
End If
End With
If pathh = False Then Exit Sub 'no folder picked; pathh is false
Application.ScreenUpdating = False
For Each ws In wb.Sheets(Array("01 - Currencies", ...."14 - User Defined
Fields"))
ws.Copy
With ActiveWorkbook 
      'Application.DisplayAlerts = False   'to avoid
overwrite warnings 
      '  pathh is a string (variant) of the path of the
folder; does not 
need pathh.Path 
      .SaveAs pathh & "\" & ws.Name, xlCSV 
      .Close SaveChanges:=False 

End With
Next ws
Application.ScreenUpdating = True
End Sub
Answer
Check my comment and (as Portland Runner says) you could turn off some
alerts I used this
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.AutomationSecurity = msoAutomationSecurityForceDisable
Application.AskToUpdateLinks = False
Using a procedure to put inside and used every time to turn it of and another to
turned on helpme a lot with all the alerts.
Sub Alerts(ScreenUpdate As Boolean, DisplayAlerts As Boolean,
AutoSecurity As Boolean, AskToUpdate As Boolean) 
      Application.ScreenUpdating = ScreenUpdate 
      Application.DisplayAlerts = DisplayAlerts 
      Application.AutomationSecurity = IIf(AutoSecurity,
msoAutomationSecurityForceDisable, msoAutomationSecurityByUI) 
      Application.AskToUpdateLinks = AskToUpdate 
End Sub
Topic 803
Subject
VBA downloading files from a public website
Question
I need some advise downloading files from a public website. Its a CME
(Chicago Mercantile Exchange) public domain and can be accessed via:
ftp://ftp.cmegroup.com/pub/span/data/

The files follow the naming convention: cme.YYYYMMDD.s.pa2.zip
Then I want to save these files to my C drive.
I basically want to download all data files from 07/01/15 to 2/1/2016. This is
public data so no authentication needed.
I was thinking of a loop of some kind between pre-inputted start and end date
in excel file, or a present list of dates, and using these dates to download the
zipped data files by editing the names.
I am not a programmer, but have done some basic/internediate VBA in the past,
but that's usually only about interacting between multiple excel files or
automating some calculations, etc. Never done anything relating to
downloading files though. Any advise would be greatly helpful.
Topic 804
Subject
Return a median value in excel where there are multiple rows of data
Question
In Excel how do I return a median value for a set of data where there are
multiple rows and columns? I have a set of data where the first column
contains a reference number and the second column contains a list of readings
over a number of days. How do I calculate the median value for each reference
number using a formula?
number volume
1 3072
1 2304
1 2016
1 2496
1 2144
1 2528
1 3312
1 3360
1 2976
1 2768

1 2688
1 3040
1 3008
1 2560
2 574
2 574
2 574
2 574
2 576
2 574
2 575
2 574
2 576
2 574
2 574
2 574
2 574
2 574
3 2880
3 2880
3 2912
3 2976
3 1536
3 288
3 2976
3 2944
3 2880
3 1536
3 2976
3 1536
3 2880
3 2880
4 2267
4 2267
4 2267
4 2267
4 2267

4 2267
4 2268
4 2267
4 2267
4 2267
4 2267
4 2267
5 800
5 800
5 1984
5 416
5 416
5 416
5 416
5 416
5 416
5 416
5 416
5 416
5 416
5 1984
6 800
6 832
6 832
6 832
6 800
6 832
6 832
6 832
6 832
6 832
6 832
6 832
6 832
6 832
The reference number is Column A and the reading is Column B. In this

example I have used just six reference numbers but my real data has several
hundred. Answer
Consider the array formula:
=MEDIAN(IF($A$2:$A$83=ROWS($1:1),$B$2:$B$83))
pick a cell, enter the formula and copy down:
Array formulas must be entered with Ctrl + Shift + Enter rather than just the
Enter key.
Answer
Try this array formula:
=MEDIAN(IF(A:A=1,B:B))
This is an array formula and must be confirmed with Ctrl-Shift-Enter.
For a non CSE Array formula, one entered normally, if you have 2010 or later
then use this:
=AGGREGATE(17,6,(B:B/(A:A=1)),2)
Where 1 is the reference number. You can make it dynamic by adding a cell
reference, so as that cell changes so will the answer.
Topic 805
Subject
Excel VBA, Parsing Response from a HTTP request
Question
This feels like it should be really simple but I'm a bit stuck. I want to access an
API url using Excel VBA. The API gives me a very simple JSON response
containing a load id which is used as a parameter in the calling of another API,
the other API isn't a problem because I can get the response in either XML or
CSV and parse it into Excel.

API Response:
{"loadid":"1234567890"}
All I need to extract from this response is the number "1234567890".
This is what I've tried so far:
Sub getLoadID()
Dim loadID As String
Dim loadIDUrl As String
loadIDUrl = "blah blah"
proxyServer = Worksheets("Sheet1").Range("A1").Value
Set httpReq = CreateObject("WinHttp.WinHttprequest.5.1")
httpReq.Open "GET", loadIDUrl, False
httpReq.setRequestHeader "Content-Type", "text/xml" httpReq.setProxy 2,
proxyServer, ""
httpReq.setTimeouts -1, -1, -1, -1
httpReq.send request
httpReq.ResponseText = loadID
Worksheets("Sheet1").Range("A2").Value = loadID
End Sub
I've tried to put the whole string into a cell just to make sure that Excel is able
to obtain the string from the response but going forward will just be happy to
store the value as a variable and not write it to the sheet.
The above code runs with no errors, I just don't get the string in cell A2...
Every time I've searched about parsing JSON using Excel VBA everyone
recommends to use external libraries but I'm trying to do this at work so I can't
use the external libraries.

Cheers
Topic 806
Subject
Formatting all cells on a spreadsheet to the same designated height and width
Question
I'm trying to format an entire Excel worksheet to have the same width and
height for all cells.
The following code does not work, but does not give an error either:
transposeSheet.Cells.UseStandardHeight = 15
transposeSheet.Cells.UseStandardWidth = 15
There is a lot of code out there for doing individual ranges, but I cannot find
how to do the entire sheet to a specified height and width. Answer
Note I just created a MSDN code sample on the following.
Here is an example that ensures that all objects are disposed of properly which
is why there is a fair amount of code else we could do this with less code
where many gleam off the web that will do the work but leave remnants of un-
disposed objects in computer memory sometimes if lucky will be disposed of
when the app closes other times not.
Call example
Dim FileName As String =
IO.Path.Combine(AppDomain.CurrentDomain.BaseDirectory,
"WorksheetsTest.xlsx") Dim SheetName As String = "Sheet1"
SetWidthHeight(FileName, SheetName, 10, 50)
Code module for above
Option Strict On
Imports Excel = Microsoft.Office.Interop.Excel Imports Microsoft.Office
Imports System.Runtime.InteropServices

Module OpenWorkSheets4
Public Sub SetWidthHeight(ByVal FileName As String, ByVal SheetName As
String, ByVal RowHeight As Integer, ByVal ColumnHeight As Integer) 
      If IO.File.Exists(FileName) Then 
          Dim Proceed As Boolean = False 
          Dim xlApp As Excel.Application = Nothing 
          Dim xlWorkBooks As Excel.Workbooks = Nothing 
          Dim xlWorkBook As Excel.Workbook = Nothing 
          Dim xlWorkSheet As Excel.Worksheet = Nothing 
          Dim xlWorkSheets As Excel.Sheets = Nothing 
          Dim xlCells As Excel.Range = Nothing 
          xlApp = New Excel.Application 
          xlApp.DisplayAlerts = False 
          xlWorkBooks = xlApp.Workbooks 
          xlWorkBook = xlWorkBooks.Open(FileName) 
          xlApp.Visible = False 
          xlWorkSheets = xlWorkBook.Sheets 
          For x As Integer = 1 To xlWorkSheets.Count 
              xlWorkSheet = CType(xlWorkSheets(x),
Excel.Worksheet) 
              If xlWorkSheet.Name = SheetName Then 
                  Proceed = True 
                  Exit For 
              End If 
            
Runtime.InteropServices.Marshal.FinalReleaseComObject(xlWorkSh
              xlWorkSheet = Nothing 
          Next 
          If Proceed Then 
              xlCells = xlWorkSheet.Cells 
              Dim EntireRow As Excel.Range =
xlCells.EntireRow 
              EntireRow.RowHeight = RowHeight 
              EntireRow.ColumnWidth = ColumnHeight 
              ReleaseComObject(xlCells) 

              ReleaseComObject(EntireRow) 
          Else 
              MessageBox.Show(SheetName & " not found.") 
          End If 
          xlWorkSheet.SaveAs(FileName) 
          xlWorkBook.Close() 
          xlApp.UserControl = True 
          xlApp.Quit() 
          ReleaseComObject(xlWorkSheets) 
          ReleaseComObject(xlWorkSheet) 
          ReleaseComObject(xlWorkBook) 
          ReleaseComObject(xlWorkBooks) 
          ReleaseComObject(xlApp) 
      Else 
          MessageBox.Show("'" & FileName & "' not located.") 
      End If 
End Sub
Private Sub ReleaseComObject(ByVal obj As Object) 
      Try 
          If obj IsNot Nothing Then 
            
System.Runtime.InteropServices.Marshal.ReleaseComObject(obj) 
              obj = Nothing 
          End If 
      Catch ex As Exception 
          obj = Nothing 
      End Try 
End Sub
End Module
Answer
You'll want to use the below
Cells.Select // Selects all cells on active sheet Selection.RowHeight =
Yournumberhere // Changes height of selected rows Selection.ColumnWidth =

Yournumberhere // Changes width of selected columns
Topic 807
Subject
DragDrop.DoDragDrop not returning when doing a drop operation into Excel
Question
My application has a simple feature where it hooks up to Excel and will do
drag drop operations between them. Specifically, I am just taking some text
values from my application, dragging them into Excel, and dropping them.
This works 90% of the time, but strangely at certain times, my application just
freezes. I attach the debugger and pause the execution and it gets stuck at
DragDrop.DoDragDrop - this function never returns and my application will
forever hang.
Is there a way to ensure the DoDragDrop can return? Or some sort of timeout?
This happens only sometimes when I drop the data into Excel, so for what I
know, the drop is being completed and the function should return within my
application.
Here's the code I use:
DragDrop.DoDragDrop(sender as DependencyObject,
draggable.GetDragDropString(), DragDropEffects.Copy);
GetDragDropString() is just a function that returns the string of data to drop in
Excel. sender is just the UI component that I'm dragging. Like a grid, or edit
box, text box, etc. Could be any of those.
Thanks for any help!
EDIT: Since there's an issue with DragDrop.DoDragDrop returning in certain
cases, perhaps someone can help with writing a proper timeout? I've tried
starting a new Thread and having it timeout, which works in simple cases and
when the work within the thread doesn't require UI resources. However, when
I call DoDragDrop in a new thread with a timeout, it will throw an exception
saying the thread cannot access the object because a different thread owns it.

So I need to call this function within the same thread. So essentially I need a
timeout on the UI thread when this function fails to return in a certain amount of
time. Answer
I think the following should do the job but I will break it down as I go along
public class DragDropTimer
{
private delegate void DoDragDropDelegate(); private System.Timers.Timer
dragTimer; private readonly int interval = 3000;
public DragDropTimer()
{ 
      dragTimer = new System.Timers.Timer(); 
      dragTimer.Interval = interval; 
      dragTimer.Elapsed += new
ElapsedEventHandler(DragDropTimerElapsed); 
      dragTimer.Enabled = false; 
      dragTimer.AutoReset = false; 
}
void DragDropTimerElapsed(object sender, ElapsedEventArgs e) {
Initiate();
}
public void Initiate()
{ 
      // Stops UI from freezing, call action async. 
      DoDragDropDelegate doDragDrop = new
DoDragDropDelegate(DragDropAction); 
      // No async callback or object required 
      doDragDrop.BeginInvoke(null, null); 
}

private void DragDropAction()
{
dragTimer.Enabled = false;
// Do your work here. or do work before and disable your timer upto you.
}
}
So we have a basic class DragDropTimer. We set the interval we want on
constructor, you may want to change that if you wish and we call the
DragDropTimerElapsed on timer elapsed.
Initiate is the function you need to start the drag, its creates a simple delegate
and we ask it to execute the DragAction steps, this is where you do all your
work and the timer gets disabled. You may choose to disable the timer only if
you DragDrop succeeds. If the timer elapses we call Initiate again to start all
over again.
Answer
Another options is to execute drop in a separate thread in the following manner
Task.Factory.StartNew( () => { ... } );
Topic 808
Subject
Create a GUI which updates information itself in python
Question
I am creating a python program for a competition displaying the price of shares
and the share prices are meant to be updated every minute. I have an excel
sheet through which I need to sync prices every minute. To achieve this, I have
used openpyxl external library.
I have created the core program successfully but I am badly stuck when it is
coming to implementing it on GUI. I don't have any idea how to create a tkinter

GUI which updates price at the end of every while loop iteration,
Here's the code till now (I know it can be better but I have to deliver it
tomorrow and it's only one-time thing so it won't matter) -
UPDATE
There is no need of user interacting with software. I only require formatting for
sleek looks.
#GUI
app = Tk()
app.title("Trading Times 2016")
app.geometry('768x720')
#Execution
Raw = 3
timer = 1
int(Raw)
while Raw != 141:
os.system('CLS')
#timer
print("Time - %i" %timer)
timer += 1
#Currency
print("\n")
print("Dollar -", currency["C%d" %Raw].value) print("Pound -",
currency["E%d" %Raw].value) print("Euro -", currency["G%d"
%Raw].value) print("Yuan -", currency["I%d" %Raw].value) #Commodity
print("\n")
print("Gold per 100gm -", commodity["C%d" %Raw].value) print("Wheat per
Quintal -", commodity["E%d" %Raw].value) print("Silver per Kg -",
commodity["G%d" %Raw].value) print("Crude per Barrel -",
commodity["I%d" %Raw].value) #Bonds
print("\n")
print("Bonds -", bonds["C%i" %Raw].value) percent = bonds["E%i"
%Raw].value
int(percent)
print("RBI Bonds Yield(In Per Cent) - %i" %percent) #ETF's

print("\n")
print("Small Cap Index -", etf["B%d" %Raw].value) print("Junior BEES -",
etf["C%d" %Raw].value) print("Bank BEES -", etf["D%d" %Raw].value)
print("PSUBNK BEES -", etf["E%d" %Raw].value) print("CPSTTEF -",
etf["F%d" %Raw].value) print("Infra BEES -", etf["G%d" %Raw].value)
print("Nifty BEES -", etf["H%d" %Raw].value) print("SENSEX -", etf["I%d"
%Raw].value) #Mutual Funds
print("\n")
print("ABC -", mutual_funds["B%d" %Raw].value) print("DEF -",
mutual_funds["C%d" %Raw].value) print("TNC -", mutual_funds["D%d"
%Raw].value) print("KFJ -", mutual_funds["E%d" %Raw].value)
print("YWU -", mutual_funds["F%d" %Raw].value) print("QNV -",
mutual_funds["G%d" %Raw].value) print("NBV -", mutual_funds["H%d"
%Raw].value) print("KAS -", mutual_funds["I%d" %Raw].value) print("AYD
-", mutual_funds["J%d" %Raw].value) print("IT FUND -",
mutual_funds["K%d" %Raw].value) print("PHARMA -", mutual_funds["L%d"
%Raw].value) print("FMCG -", mutual_funds["M%d" %Raw].value) #Shift
Raw
Raw += 1
time.sleep(60)
app.mainloop()
Can anyone please help me in implement a GUI which can update itself every
minute. Thanks
Answer
Tkinter widgets support a method after which invokes a function after a given
interval im milliseconds. It is only approximate but might be good enough for
you. This might show you what I mean. Forgive any formatting problems - this
is my first post here.
import tkinter as tk
class App(tk.Tk):
def __init__(self):
tk.Tk.__init__(self)

self.counter = 0
self.str_counter = tk.StringVar()
tk.Label(self,textvariable = self.str_counter).pack()
self.after(1000,self.bump)
self.mainloop()
def bump(self):
self.counter += 1
self.str_counter.set(str(self.counter))
self.after(1000,self.bump)
App()
Answer
Use Tkinter's after command to run a function (see this or this) after X number
of milliseconds. As for the GUI itself, you'll need to use either a series of
labels that get updated or, preferably, the ttk.TreeView widget which would
look better.
Answer
You seem to have a fundamental misunderstanding of how GUI programs work.
You shouldn't be creating your own while loop. Tkinter (and other GUI
toolkits) have a custom while loop that needs to run.
The reason is that, in order for the GUI to work, it needs to be able to process
events. Even something as simple as redrawing the window when another
window moves across it is a response to an event.
In Tkinter, this event processor is mainloop. If mainloop isn't running (before
you call it, if your program is sleeping, if you have your own long running code
executing, ...), it can't handle events. If it can't handle events then it can't update
the screen.
You can think of mainloop as being nothing more than an infinite loop that

looks like this:
while the_app_is_running:
event = wait_for_next_event()
process_event(event)
Note: you don't actually write the above code, but metaphorically that's what
calling mainloop does.
In your case, it appears you want the display to update once every minute. This
is very easy to do by leveraging this event loop. The event loop is already
running so all you need to do is tell it to wake up once a minute and update its
data. You do this with the after method. Give this method the name of a function
to call and a delay, and it will call that function after the delay. It does this by
placing a time-based event on the event queue.
The first step is to set up the display with all of your widgets. For example:
app = Tk()
dollar_label = Label(app, text="")
pound_label = Label(app, text="")
...
The next step is to create a function that will fill in all the labels with the
values you want them to have. It's important to do this in a separate step from
when you create the labels, since you want to be able to do this every minute.
def refresh_display():
# First, get the new data
currency = ...
commodity = ...
...
# next, update the widgets
dollar_label.configure(text="Dollar: %s" % currency["dollar"]
pound_label.configure(text="Pound: %s" % currency["pound"] ...

Finally, you want to call this function every minute. You can do that by writing
a function that calls the refresh_display function, then schedules itself to run
again in 60 seconds:
def call_every_60_seconds():
refresh_display()
app.after(60000, call_every_60_seconds)
The final step is to start the updating by calling this function once, before you
start the mainloop. This will update the display with the initial values, and then
start the schedule running every minute after that.
call_every_60_seconds()
app.mainloop()
That's the basics of what you have to do. It's pretty straight forward, it just
requires a bit of organization to your code.
Topic 809
Subject
Automatic reminder first working day of the month
Question
I have an Excel tool that is used daily by a lot of people - each month they are
expected to run a macro to report data to a central point.
Is there a way that I can call a macro such as this as the document is opened?
How would you go about doing this in the Workbook_Open event? Would you
make it optional or give users no choice (i.e. auto submit on said day?)
This would potentially help me from chasing people up monthly
As a side note, if I gave users the 'option' - is there a less crude way of
reminding them? For example if answer = vbNo Then range("A1") = "1" and
then having an if statement within workbook open until they press yes which
would set range ("A1") to 0 or similar?

Thanks
Answer
You are very much on the right track.
Make a reference worksheet in the workbook with the end-of-month dates
listed in A1:A12, then place this code in the Workbook_Open event.
Private Sub Workbook_Open()
Dim dDate as Date
dDate = Application.WorksheetFunction.EoMonth(Date, 0)
With Worksheets("reference")
Dim rFound As Range
Set rFound = .Range("A1:A12").Find(dDate, lookat:=xlWhole,
LookIn:=xlValues)
If Not rFound Is Nothing Then
If rFound.Offset(, 1) = 0 Then 
          Dim ret As Variant 
          ret = MsgBox("Would you like to submit data now?",
vbYesNo) 
          If ret = vbYes Then 
              'run macro to submit data 
              rFound.Offset(, 1) = 1 
              'you may want to set this cell to 1 also if the
user submits data manually so it knows for next time 
          Else 
              'set to zero to check for next time 
              rFound.Offset(, 1) = 0 
          End If 
      End If 

End If
End With
End Sub
This is optional for the user, but will repeatedly ask them each time they open
the book until they do submit for that month. Then it will wait until next month
to ask again.
The problem with making it auto-submit on a given day is that what if the user
never opens the workbook on said day?
Topic 810
Subject
Shortcut to Apply the “number format” with two decimal places (negative
numbers appear in red with parentheses)
Question
Is there any shortcut to Apply the "number format" with two decimal places
(negative numbers appear in red with parentheses). I am aware of Ctrl + Shift
+ $ but this gives the number in currency format and not number format. I am
also aware of CONTROL + SHIFT + % but this does not give the number in
red with parentheses. Answer
There is no such shortcut listed on the Excel Shortcut and Function Keys
NOTE If an action that you use often does not have a shortcut key, you can
record a macro to create one.
You have a few options:
Copy/Paste Cell format
Use the Ctrl+1 hotkey with a range of cells to bring up the Cell Formatting
dialog and apply manually to the selected range Record a macro and assign
your own hotkey (suggested by Microsoft at the link above) Apply the
formatting manually to a single cell, then select a range of cells and press F4
Topic 811

Subject
Get the sum of rows when a rule is triggered
Question
In google drive I have an excel file with many rows. In one column you can
choose from a list of values office, home, other and in another column I have
some numbers. How can I choose all theses rows which have the value home
and then get the sum of the next column which has the numbers? Answer
Thx to @Robin the answer is
https://support.google.com/docs/answer/3238496?hl=en
=SUMIFS(C2:C36, B2:B36, "=home")
Topic 812
Subject
QueryTables.Add x Get external data
Question
I'm using querytables.add to get data from a report and then manipulate it. But
the Querytables isn't retrieving all the data, some columns returns 0 but when i
do the same process through the excel - get external data - from web it's return
the correct data. The question is: QueryTables.Add and get external data from
web run the same process? If not, how can I do the "get external data - from
web" through vba?
With Sheet1.QueryTables.Add(Connection:= _ "URL;"REPORT LINK HERE",
_
Destination:=Range("$A$1"))
.Name = "Report"
.FieldNames = True
.RowNumbers = False
.FillAdjacentFormulas = False
.PreserveFormatting = True
.RefreshOnFileOpen = False
.BackgroundQuery = True
.RefreshStyle = xlInsertDeleteCells .SavePassword = False
.SaveData = True

.AdjustColumnWidth = True
.RefreshPeriod = 0
.WebSelectionType = xlEntirePage
.WebFormatting = xlWebFormattingNone .WebPreFormattedTextToColumns =
True .WebConsecutiveDelimitersAsOne = True .WebSingleBlockTextImport =
False
.WebDisableDateRecognition = False
.WebDisableRedirections = False
.Refresh BackgroundQuery:=False
End With
Topic 813
Subject
Copying Table from Excel into Powerpoint using a predefined template
Question
I have written the below code to copy and paste two tables over two pages
into Powerpoint as an image, what I would like to do however is if I have a
table template already set up in Powerpoint with one blank row, copy the table
rows from Excel into Powerpoint and if it goes over say 20 rows in
Powerpoint start a new page with the same template.
I have looked through lots of codes but nothing seems to be dynamic for what I
am after in terms of copying to a pre set template. Thanks in advance
Sub CopytoPowerpoint
Dim PPApp As PowerPoint.Application
Dim PPSlide As PowerPoint.Slide
Dim PPPres As PowerPoint.Presentation
Set PPApp = CreateObject("Powerpoint.Application") Dim SlideNum As
Integer
Set Xlapp = GetObject(, "Excel.Application")
'input Powerpoint template
Dim strPresPath As String, strExcelFilePath As String, strNewPresPath As
String 'path of the Powerpoint template

strPresPath = "C:\Documents and
settings\Desktop\Product\ProductTemplate.pptx" 'save the new Presentation to
be created
strNewPresPath = "C:\Documents and Settings\Desktop\Product\ Monthly
Reporting Pack-" & Format(Date, "dd-mmm-yyyy") & ".pptx" PPApp.Visible =
True
Set PPPres = PPApp.Presentations.Open(strPresPath)
PPPres.Application.Activate
''define destination slide
SlideNum = 2
PPPres.Slides(SlideNum).Select
Set PPSlide =
PPPres.Slides(PPApp.ActiveWindow.Selection.SlideRange.SlideIndex)
''define source sheet
Sheets("Sheet1").Activate
'copy/paste from
Xlapp.Range("Table1").Copy
PPSlide.Select
With PPSlide.Shapes.PasteSpecial(ppPasteEnhancedMetafile) 
          .Item(1).ScaleHeight 0.75, msoCTrue,
msoScaleFromMiddle 
          .Item(1).ScaleWidth 0.62, msoCTrue,
msoScaleFromMiddle 
          .Item(1).Left = 10 
          .Item(1).Top = 120 
End With
''define destination slide
SlideNum = 3

PPPres.Slides(SlideNum).Select
Set PPSlide =
PPPres.Slides(PPApp.ActiveWindow.Selection.SlideRange.SlideIndex)
''define source sheet
Sheets("Sheet1").Activate
'copy/paste from
Xlapp.Range("Table2").Copy
With PPSlide.Shapes.PasteSpecial(ppPasteEnhancedMetafile) 
          .Item(1).ScaleHeight 0.75, msoCTrue,
msoScaleFromMiddle 
          .Item(1).ScaleWidth 0.62, msoCTrue,
msoScaleFromMiddle 
          .Item(1).Left = 10 
          .Item(1).Top = 120 
End With
' Close presentation
PPPres.SaveAs strNewPresPath
'PPPres.Close
'Quit PowerPoint
'PPApp.Quit
Xlapp.Visible = True
Application.CutCopyMode = False
MsgBox "Presentation Created", vbOKOnly + vbInformation
' Clean up
Set PPSlide = Nothing
Set PPPres = Nothing
Set PPApp = Nothing
End Sub
Answer

Using the ExecuteMso method (not well documented, but it comes in very
handy for pasting data between applications, etc.), you should be able to do
this:
Here is the Excel table:
And here is the output to PowerPoint:
This assumes that the table in PPT is sized with the correct number of columns.
If it is not, you may need additional logic to add/remove columns
conditionally. This does not preserve any formatting from Excel, so it is
relying on the table Style as specified in the PowerPoint table/template.
Sub copyTableRowsToPPT()
Dim tbl As ListObject
Dim tblRows As Range
Dim r As Long 'row counter
Dim c As Long 'col counter
Dim ppt As Object 'PowerPoint.Application Dim ppPres As Object
'PowerPoint.Presentation Dim ppSlide As Object 'PowerPoint.Slide Dim
ppShape As PowerPoint.Shape 'PowerPoint.Shape Dim ppTable As
PowerPoint.Table 'PowerPoint.Table 'Handle the Table in Excel
Set tbl = ActiveSheet.ListObjects("Table1") ' Rename based on your table
name 'Get the ROWS from the Table in Excel Set tblRows =
tbl.DataBodyRange.Rows
'Get PowerPoint objects...
Set ppt = GetObject(, "PowerPoint.Application") Set ppPres =
ppt.presentations(1)
Set ppSlide = ppPres.Slides(1)
Set ppShape = ppSlide.Shapes("Content Placeholder 5") ' Rename based on
your Shape name Set ppTable = ppShape.Table
' Copy the rows (but not headers) from Excel tbl.DataBodyRange.Copy
ppTable.Rows.Add.Cells(1).Select
' Paste in to PowerPoint, keeping the PowerPoint theme/formatting

ppt.CommandBars.ExecuteMso ("PasteExcelTableDestinationTableStyle")
End Sub
If you would prefer to use the Excel style, that can also be done using
"PasteExcelTableSourceFormatting". As you may have gathered, you could just
use this method to copy/paste the entire table in to PowerPoint, rather than
trying to insert to an existing "template" table.
I believe this could be modified to "split" the table over additional slides in
PowerPoint, if needed. If you're stuck on that implementation, let me know and
I can update the answer with more detail.
Topic 814
Subject
Create Hyperlink based on part of name
Question
I am trying to make an Excel macro that would scan directories for a matching
name and then create an hyperlink to that directory. for example:
On cell E2, I have S414 and in D:\Test\ I would have S414 (4123) and I want
to create an hyperlink to D:\TEST\S414 (4123)\
So how would I go to do that? How could I scan through the directory using
VBA?
So far I have:
Sub CreateHyperlink()
Path = "D:\TEST\"
Dim r As Range, cell As Range, mynumber As Long
Set r = Range("E2:E239")
For Each cell In r 

      fName = cell.Value 
      LResult = Dir(Path & fName & "*", vbDirectory) 
      If LResult > 0 Then 
      FullPath = Path & LResult 
      With cell.Offset(0, 3) 
          .Hyperlinks.Add Anchor:=cell.Offset(0, 3), _ 
          Address:="" & FullPath & "", _ 
          TextToDisplay:="" & fName & "" 
      End With 
      End If 
Next
End Sub
but it does not add any hyperlinks..
Topic 815
Subject
Dynamic Cell Reference in vba code
Question
I am saving some data from a sheet to access db. This excel sheet contains no
of cells (Approx. 260). I am saving all these cell values in some tables in
Access. In my code, I am using each cell's address to fetch the value. But if I
insert a row at the top, the cell address changes. So every time there is change
in structure of this excel file, I need to go thru the code and update the cell
references. So to avoid this work, I thought of defining the cells with name.
(Named Range). So that even if the structure changes, there wont be any need
to update the VBA code. Is this the correct approach or is there any other
workaround for this issue. Also if this is fine, will the 260 named ranges will
increase the excel file size???? Any help is very appreciated.
Topic 816
Subject
Using VS 2015 to manipulate Excel 2003 work sheets - How to?
Question
I know that this must be extremely base level and I feel like its silly to have to

come here for help on what should be simple, I just cant seem to get anything to
not be an error. Even just a pointer to an existing tutorial would be great.
I'm trying to open a template work book, edit a few cells, then save it to a new
location under a new name and possibly even print it to PDF.
I have nothing working at the moment, not even the references seem to be
working. Any and all help would be greatly appreciated. Using vb would be
ideal but anything Visual Studio can use is doable.
Edit: More research done, and it seems like I don't have the right edition, nore
will I be able to get one. Disregard this, I'll find another way.
Topic 817
Subject
Macro that pastes formatted tables from excel into ppt presentation crashes
irregulary
Question
I created macro in excel that uses excel report to copy and paste large number
of tables into power point presentation. Tables are pasted using 'Keep source
formatting' method and after pasting macro changes font size to 7 if the font is
smaller and places the table in correct position on the slide. The problem is
that the macro is skipping between the two applications and each pasting is
time consuming so sometimes the macro crashes/frozen - for example when
running the macro for the same report various number of times I receive
different results - sometimes presentation is produced successfully, few
minutes later the macro crashes on slide 15 and in another run it crashes on
slide number 41 for exactly the same report. Is there a way to run the macro as
a background process to enable excel performance with no errors or any way
to avoid excel crushing from time to time...I would appreciate any
advise/suggestions!
Below is the code of supporting macro that I use to paste the table and change
font size when required table range is copied:
Sub PastewithSourceFormatting_table(iSlide As Integer, table_name As
Object) Dim shapes_number As Integer

Dim shapes_number_new As Integer
Dim v_size As Byte
Dim row_num As Integer
Dim col_num As Integer
shapes_number_new = 0
shapes_number = 0
v_size = 0
row_num = 0
col_num = 0
Set PPSlide = PPPres.Slides(iSlide)
PPSlide.Select
shapes_number = PPSlide.Shapes.Count
Do Until shapes_number_new = shapes_number + 1 With PPSlide
PPApp.CommandBars.ExecuteMso ("PasteSourceFormatting")
Application.Wait (Now + TimeValue("0:00:01"))
PPApp.CommandBars.ReleaseFocus
shapes_number_new = .Shapes.Count
End With
Loop
Application.Wait (Now + TimeValue("0:00:01"))
Application.CutCopyMode = False
Set table_name = PPSlide.Shapes.Item(shapes_number_new)
'---------check font size
v_size = table_name.Table.Cell(1, 1).Shape.TextFrame.TextRange.Font.Size
row_num = table_name.Table.Rows.Count
col_num = table_name.Table.Columns.Count
If v_size < 7 Then
Dim i, j As Integer

For i = 1 To row_num
For j = 1 To col_num
If table_name.Table.Cell(i, j).Shape.TextFrame.HasText = msoTrue Then
table_name.Table.Cell(i, j).Shape.TextFrame.TextRange.Font.Size = 7 End If
Next j
Next i
Else
End If
Application.Wait (Now + TimeValue("0:00:01"))
End Sub
Topic 818
Subject
SSIS Merging Excel columns into a single column
Question
I have a batch of Excel files that have a number of sets of columns. There are
repeating sets of 4 columns, each column holding a different amount of data. I
need to merge all of the data from all sets of columns across all Excel files into
a single set of 4 columns in Sql Server. Can SSIS do this or is it better to load
all files and manually merge the data ?
Topic 819
Subject
Convert image to BMP 24bit with Imagick at PHP
Question
I need insert image to Excel file with Spreadsheet_Excel_Writer, so I must
convert it to BMP 24-bit. I using code:
$preview_file = DIR_CACHE . $productId . '-1.bmp'; $preview = new
Imagick(DIR_IMAGE . $row['image']); $preview->resizeImage(100, 100,
imagick::FILTER_UNDEFINED, 1); $preview->setFormat('BMP3');
$preview->writeImage($preview_file);

$worksheet->insertBitmap( $i, $j++, $preview_file, 0, 0, 1, 1 );
But in Excel image show bugged. I have tried to resave it with Paint and add to
Excel - it became good. So, I have compared both files and see:
How I can fix this?
UPDATE
Link for result BMPs:
https://dl.dropboxusercontent.com/u/17397112/613-1.bmp
https://dl.dropboxusercontent.com/u/17397112/613-2.bmp
Bug in excel showed as:
Topic 820
Subject
How to compress this code further?
Question
in the below code i am comparing values in 4 different columns with
predefined values, and returning the value of the highest row in column named
"size". is there a better way to write this code using arrays?
Sub CalculatetierJP()
Dim i, n, lth, wth, ht, wt, dwt, tier, flth, fwth, fht, fwt, ftier, dmwt As Integer
i = 2
n = 1
lth = 33
wth = 34
ht = 35
wt = 28
dwt = 36
tier = 37
GL = 17

Cells(1, 37) = "Size"
Cells(1, 50) = "Non-media/Media"
Cells(1, 51) = "Final tier"
Cells(1, 52) = "flth"
Cells(1, 53) = "fwth"
Cells(1, 54) = "fht"
Cells(1, 55) = "fwt"
Cells(1, 56) = "ftier"
' 1-Small
' 2- Standard
' 3- Oversize
' 4- Heavy Bulky
Do While Not Cells(i, n).Value = ""
If Cells(i, 7).Value = "y" Then
'Set all to zero
flth = 0
fwth = 0
fht = 0
fwt = 0
ftier = 0
'''**********************************
''Calcualte the tier based on length
'''**********************************
If Cells(i, lth) < 30.48 Then
flth = 1
ElseIf Cells(i, lth) >= 30.48 And Cells(i, lth) < 50.48 And Cells(i, wt) <
12000 Then
flth = 2
ElseIf Cells(i, lth) >= 30.48 And Cells(i, lth) < 50.48 And Cells(i, wt) >=

12000 Then
flth = 3
End If
Cells(i, 52).Value = flth
'''**********************************
''Calcualte the tier based on width
'''**********************************
If Cells(i, wth) < 20.32 Then
fwth = 1
ElseIf Cells(i, wth) >= 20.32 And Cells(i, wth) < 40.64 And Cells(i, wt) <
12000 Then
fwth = 2
ElseIf Cells(i, wth) >= 20.32 And Cells(i, wth) < 40.64 And Cells(i, wt) >=
12000 Then
fwth = 3
End If
Cells(i, 53).Value = fwth
'''**********************************
''Calcualte the tier based on height
'''**********************************
If Cells(i, ht) < 10.16 Then
fht = 1
ElseIf Cells(i, ht) >= 10.16 And Cells(i, ht) < 25.4 And Cells(i, wt) < 12000
Then
fht = 2

ElseIf Cells(i, ht) >= 10.16 And Cells(i, ht) < 25.4 And Cells(i, wt) >= 12000
Then
fht = 3
Cells(i, 54).Value = fht
End If
'''**********************************
'''Calcualte the tier based on weight
'''**********************************
If Cells(i, wt) < 1000 Then
fwt = 1
ElseIf Cells(i, wt) >= 1000 And Cells(i, wt) < 12000 Then
fwt = 2
ElseIf Cells(i, wt) >= 12000 Then
fwt = 3
End If
Cells(i, 55).Value = fwt
'''**********************************
'''Calcualte the final tier
'''ftier = Max(flth, fwth, fht)
'''**********************************
ActiveWorkbook.Worksheets("audit").Activate 'Set myrange =
Worksheets("audit").Range("AV2:AX2") ftier =
Application.WorksheetFunction.Max(flth, fwth, fht, fwt) Cells(1, 56).Value =
ftier
' 1-Small

' 2- Standard
' 3- Oversize
' 4- Heavy Bulky
If ftier = 1 Then
Cells(i, 37) = "small"
ElseIf ftier = 2 Then
Cells(i, 37) = "standard"
ElseIf ftier = 3 Then
Cells(i, 37) = "oversize"
ElseIf ftier = 0 Then
Cells(i, 37) = "Did not calculate"
End If
Cells(i, 39).Value = Cells(i, 47).Value
End If
Dim row1 As Integer
row1 = ActiveSheet.UsedRange.Rows.Count
For i = 2 To row1
i = i + 1
Next i
Loop
End Sub
Answer

Your issue is with your code incrementing the i count variable at the end. The
first issue is that you are incrementing twice: once on the i=i+1 and once on
Next i. the other issue is that in that for loop, you are just running though all of
the used range. To fix this, you need to remove the for loop and just keep the
i=i+1
Topic 821
Subject
Excel VBA Heap Corruption
Question
I've inherited a large VBA project and have been making changes to it. A few
weeks ago the Excel started crashing - just bombing out with no warning part
way through and crashing Excel completely. I google around and came across a
few links pointing to heap corruption. The only way to fix it seems to step
through each line of code (this takes about 20 mins) and then it seems to be
fine. For a while. it's now impacting my ability to deliver as it seems to be just
randomly entering this 'state' of corruption.The error in the event log is:
Faulting application name: EXCEL.EXE, version: 14.0.7015.1000, time
stamp: 0x51cca83a Faulting module name: ntdll.dll, version: 6.1.7601.22436,
time stamp: 0x521eaab0 Exception code: 0xc0000374
Fault offset: 0x000c38b7
Faulting process id: 0x180c
Faulting application start time: 0x01d15dbcd51b14ca Faulting application
path: C:\Program Files\Microsoft Office\Office14\EXCEL.EXE Faulting
module path: C:\WINDOWS\SYSTEM32\ntdll.dll Report Id: 3fe3c694-c9b0-
11e5-9dca-28d244b88aae
Am I doomed to Shift F8 through the code every time this happens ? I can't
install any other tools either.
Topic 822
Subject
R_trigger macro excel if button is clicked
Question
Hi I am new to this with macro in Excel. I want to create a macro for a

rounded rectangle which when I click will write a bool value (true) to a cell.
Then when a value in another cell is changed should the macro write the
another bool variable (false) to the same cell which it wrote to earlier. Answer
Try this and Assign this macro to your figure by right clicking and Assign
macro
Sub AssignBool()
Dim IncValue As Integer
IncValue = Worksheets("UrsheerNamehere").Range("UrIncrcell").Value 'like
Worksheets("Sheet1").Range("A1").Value
Worksheets("UrSheet").Range("").Value = True 'like
Worksheets("Sheet1").Range("B1").Value = True Application.Wait(Now +
TimeValue("0:00:10")) 'Waits for 10 seconds If (IncValue = IncValue + 1)
Then
Worksheets("UrSheet").Range("").Value = True End If
End Sub
Topic 823
Subject
Excel SumIf / CountIf etc wont work properly
Question
I have an issue with my sumif excel formula. For some reason , it wont work
properly. Context: here my excel data :
When i use this formula: "=SUMIF(A3:A6,"TT",B3:B6)", i got 0 everytime. I
can change the data format , the sheet , the content or even the data itself , it
changes nothing , always 0. Halp :'( Answer
Make sure there are no spaces or any other "hidden" whitespace alongside
your data in column A. Delete the contents of the cell and re-type it to make
sure.
Also make sure you have auto calculations turned on - File -> Options ->
Formulas -> Workbook Calculation set to Automatic
Answer

Nothing wrong with the formula, it might be worth checking the values in
column A for any trailing spaces.
Topic 824
Subject
Mouse Control VBA Issues
Question
Good Morning!
I am writing a pretty dumb program to control the mouse and loop if the user is
unresponsive. So far It's somewhat workable but running into a couple of issue
The first iteration doesnt automatically hit enter, or select yes. Any advice on a
better approach to this would be nice. And No I do not want to turn
Application Updates to false. When I manually hit enter, or select yes in the
message box, the loop continues without prompting the message box again.
Seems like this ought to be done in a loop uh? Hadnt considered that until this
second (might try it while i wait for feedback).
Code for reference:
Public Sub SingleClick()
Dim answer As Integer
SetCursorPos 100, 100
SetCursorPos 90, 90
Application.Wait Now + TimeValue("00:00:01")
SetCursorPos 85, 85
SetCursorPos 72, 72
Application.Wait Now + TimeValue("00:00:01")
SetCursorPos 60, 60
SetCursorPos 50, 50
Application.Wait Now + TimeValue("00:00:01")

answer = MsgBox("Do you want to restart the loop?", vbYesNo + vbQuestion,
"Loop Prompt")
If answer = vbNo Then Exit Sub
Application.Wait Now + TimeValue("00:00:03")
SendKeys "{Enter}"
If answer = vbYes Then Call SingleClick
End Sub
Topic 825
Subject
AND+OR function not working as supposed to
Question
I've got the following formula
=IF((AND(OR(AND($D5<-9;$F5>=150;$H5>=150);
AND($D5<-6;$F5>=185;$F5>190));
NOT(EXACT(I5;"MEAC"));
NOT(EXACT(I5;"AE"));
NOT(EXACT(I5;"Asun"));
NOT(EXACT(I5;"BSth"));
NOT(EXACT(I5;"SWAC"));
NOT(EXACT(I5;"Pat"));
NOT(EXACT(I5;"NEC"));
NOT(EXACT(I5;"Slnd"));
NOT(EXACT(I5;"C-USA"))));
B5&" +"&ABS(D5);" ")
What I want it to do is
IF $D5<-9;$F5>=150;$H5>=150 OR $D5<-6;$F5>=185;$H5>190
AND if one of the above is True, filter for the NOT(EXACT strings

Should I use AND(AND(AND instead of AND(OR(AND ? I know the formula
looks messy but I'm not an excel wizard.
EDIT: added screenshot
So for good measure:
Both rankings should be above 150 and opening line should be above -9,5
BUT if both rankings are above 190 (185 for away team) then the opening line
should only be -6,5 to qualify as a good value.
enter image description here
Topic 826
Subject
php exporting to excel using utf8
Question
I have a piece of php code that exports data from mysql to excel. even using
utf-8 for charset, Persian(arabic) are saved weird and they are not
recognizable.
If you can help me I will be grateful.
<?php
$con=mysqli_connect("localhost","root","","myDB"); $SQL =
mysqli_query($con,"SELECT * FROM view1");
$header = '';
$result ='';
$exportData = mysql_query ($SQL ) or die ( "Sql error : " . mysql_error( ) );
$fields = mysql_num_fields ( $exportData );
for ( $i = 0; $i < $fields; $i++ )
{
$header .= mysql_field_name( $exportData , $i ) . "\t"; }
while( $row = mysql_fetch_row( $exportData ) ) {

$line = '';
foreach( $row as $value )
{ 
      if ( ( !isset( $value ) ) || ( $value == "" ) ) 
      { 
          $value = "\t"; 
      } 
      else 
      { 
          $value = str_replace( '"' , '""' , $value ); 
          $value = '"' . $value . '"' . "\t"; 
      } 
      $line .= $value; 
}
$result .= trim( $line ) . "\n";
}
$result = str_replace( "\r" , "" , $result );
if ( $result == "" )
{
$result = "\nNo Record(s) Found!\n"; }
header("Content-type: application/octet-stream"); header("Content-
Disposition: attachment; filename=export.xls"); header("Pragma: no-cache");
header("Expires: 0");
print "$header\n$result";
?>
Answer
Php native support for this is not that good.
Have you tried php-gd-farsi?
include('php-gd-farsi-master/FarsiGD.php');
$gd = new FarsiGD();

// Create a 300x100 image
$im = imagecreatetruecolor(300, 100); $red = imagecolorallocate($im, 0xFF,
0x00, 0x00); $black = imagecolorallocate($im, 0x00, 0x00, 0x00);
// Make the background red
imagefilledrectangle($im, 0, 0, 299, 99, $red);
// Path to our ttf font file
//$font_file = './Vera.ttf';
$font_file = './cour.ttf';
// Draw the text 'PHP Manual' using font size 13 $text =
imagecreatetruecolor(200, 60); imagefilledrectangle($text, 0, 0, 200, 60,
$red); $str = '**ﻣﺎه**';
$tx = $gd->persianText($str, 'fa', 'normal'); imagefttext($text, 24, 10, 10, 50,
$black, $font_file,$tx ); $im = $text;
// Output image to the browser
header('Content-Type: image/png');
imagepng($im);
imagedestroy($im);
Topic 827
Subject
Would I reverse this calculation?
Question
I have a spreadsheet which works out margin price etc.
I'm wondering if I can reverse my Margin Calculator?
Presently it works out the Margin %
=((I1-F1)-H1-K1-N1)/I1
(I=Net Price, F=Cost, H=Carriage, K=Fees, N=Promotions)
I want to be able to type a Margin % and it calculates the price and if possible

add the round up feature? so everything ends in .99.
Using
=ROUNDUP(SUM(I864*M864)+(I864),0.1)-0.01
(M being Margin field) it calculate using the margin, but it differs from the
original price
e.g. Price 69.99=19% Margin
Reverse Calculation 19%=66.99
Difference of 3, i'm really confused and cannot get my head around this, can
someone please shed some light?
Topic 828
Subject
Python Reading values from Excel as DataFrame and Writing to a particular
variable of a file
Question
I am reading all the values from an excel as python Dataframe, now i need to
write the values to a particular variable of a config file
Eg
import pandas as pd
if __name__ == "__main__":
input = pd.ExcelFile('C:/Users/ABC/SampleExcel.xlsx') dfs = {sheet:
seg_sheet.parse(sheet) for sheet in seg_sheet.sheet_names} values =
dfs['Sheet1'].to_dict('records')
I am able to read the values, but now I need to write the values to a particular
variable of a config (another python file).
Output File ---------
output.py

var1 =
var2 =
var3 =
So i need to read the excel files of multiple sheets and write it to a particular
variable of a python output file
If the variable in output file - already has a value , I need to overwrite the
values Answer
You could use ConfigParser. StringIO is used to simulate a file in the following
example. Its some kind of workaround to add and remove the [Section] tag
again. Without the [Section] tag, the generated file is a runable python script.
You only need to be careful with strings, because the ConfigParser does not
add question marks to strings.
import ConfigParser
import StringIO
config = ConfigParser.ConfigParser()
cfgfilepath = 'C:/temp/output.py'
#read and add "[Section]"
with open(cfgfilepath, 'rb') as configfile:
filecontent = configfile.read()
bufin = StringIO.StringIO("[Section]\r\n%s"%(filecontent,))
config.readfp(bufin)
bufin.close()
#set values
var1 = 1
var2 = [3,2]
var3 = "'sdaf'"
#set new value or replace existing
config.set('Section','var1',var1)

config.set('Section','var2',var2)
config.set('Section','var3',var3)
bufout = StringIO.StringIO()
config.write(bufout)
filecontent = bufout.getvalue().split("\n") bufout.close()
#remove "[Section]" and save to file
with open(cfgfilepath, 'wb') as configfile:
for linenr, line in enumerate(filecontent): 
      if linenr >= 1: 
          configfile.write("%s\r\n"%(line,)) 
The script above produces following file (output.py).
var1 = 1
var2 = [3, 2]
var3 = 'sdaf'
Answer
I have parsed the excel sheet using pandas and mapped each sheet name to
values in that sheet and written the output to a python file (.py). This solution
works for all cases. Can I know like whether the below solution is good to go.
import pandas as pd
if __name__ == "__main__":
output_file = 'E:/temp/output.py'
input_sheet = pd.ExcelFile('E:/temp/Excel1.xlsx')
input_sheet_config_list = []
for sheet in input_sheet .sheet_names:

sheet_vals = input_sheet .parse(sheet).to_dict('records')
input_sheet_config_list .append(sheet + " = " + str(sheet_vals))
with open(output_file, 'w') as f:
for item in input_sheet_config_list :
f.write("%s\n" %item)
f.close()
Topic 829
Subject
Image from sheet in imagebox control (VBA)
Question
I'm looking for a simple way to have an image loaded to the image control in a
userform, vba project in excel.
Is it possible to load directly a pasted linked image from the sheet it self, and
then have that object serving as source for the image control?
I found that it is possible to do so, but it takes exporting the image (or saving
the image as image) and then load it to the image control, but I am looking for a
way that does not involve external data from the excel file.
Thanks.
Answer
Well, after searching with google, I found this solution:
For the example you will need:
+----------------+----------------+
| Control | Name |
+----------------+----------------+ 
| User Form      | UserForm1      | 
| Image          | Image1         | 

| Command Button | CommandButton1 |
+----------------+----------------+
And 2 normal modules, and I use this Names:
+---------------+
| Module Names |
+---------------+
| Functions_VBA |
| Image_Job |
+---------------+
Inside the UserForm1 use this code:
Option Explicit
Private Sub CommandButton1_Click()
Paste_ThePicture 'I will explain later... 
   Me.Image1.Picture = LoadPicture(thePath) 'Just this...
load the picture 
   'If you want to delete the picture from directory 
   'Uncomment this: 
   'Kill thePath 
End Sub
Inside the Image_Job Module put this:
Option Explicit
Public thePath As String
Sub Paste_ThePicture() 'The procedure inside UserForm1 Dim fname As
String
Dim objPicture As Variant
With ActiveSheet.Shapes("Picture 1") 'The name of the picture inside the excel
sheet 

                                       'you can loop over the
pictures or do somenthing 
                                       'to take the picture
you want 
      .CopyPicture xlScreen, xlBitmap 
      Set objPicture = PastePicture(xlBitmap) 'Store the
picture inside the var 
      fname = ThisWorkbook.Path & "\" & .Name & ".bmp"
'Create the path for the picture full path 
End With
thePath = fname 'Store the full path to use it later SavePicture objPicture,
fname 'save the picture in the directory 
                            'you can delete it later 
                            'Look inside the userForm code 
End Sub
And the magic come heres! Inside the Functions_VBA put this:
Option Explicit
Option Compare Text
''' User-Defined Types for API Calls
'Declare a UDT to store a GUID for the IPicture OLE Interface Private Type
GUID
Data1 As Long
Data2 As Integer
Data3 As Integer
Data4(0 To 7) As Byte
End Type
'Declare a UDT to store the bitmap information Private Type uPicDesc
Size As Long
Type As Long
hPic As Long

hPal As Long
End Type
'''Windows API Function Declarations
'Does the clipboard contain a bitmap/metafile?
Private Declare Function IsClipboardFormatAvailable Lib "user32" (ByVal
wFormat As Integer) As Long 'Open the clipboard to read
Private Declare Function OpenClipboard Lib "user32" (ByVal hwnd As Long)
As Long 'Get a pointer to the bitmap/metafile
Private Declare Function GetClipboardData Lib "user32" (ByVal wFormat As
Integer) As Long 'Close the clipboard
Private Declare Function CloseClipboard Lib "user32" () As Long 'Convert
the handle into an OLE IPicture interface. Private Declare Function
OleCreatePictureIndirect Lib "olepro32.dll" (PicDesc As uPicDesc, RefIID
As GUID, ByVal fPictureOwnsHandle As Long, IPic As IPicture) As Long
'Create our own copy of the metafile, so it doesn't get wiped out by subsequent
clipboard updates. Declare Function CopyEnhMetaFile Lib "gdi32" Alias
"CopyEnhMetaFileA" (ByVal hemfSrc As Long, ByVal lpszFile As String) As
Long 'Create our own copy of the bitmap, so it doesn't get wiped out by
subsequent clipboard updates. Declare Function CopyImage Lib "user32"
(ByVal handle As Long, ByVal un1 As Long, ByVal n1 As Long, ByVal n2 As
Long, ByVal un2 As Long) As Long 'The API format types we're interested in
Const CF_BITMAP = 2
Const CF_PALETTE = 9
Const CF_ENHMETAFILE = 14
Const IMAGE_BITMAP = 0
Const LR_COPYRETURNORG = &H4
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ''' Subroutine: PastePicture
'''
''' Purpose: Get a Picture object showing whatever's on the clipboard. '''
''' Arguments: lXlPicType - The type of picture to create. Can be one of: 
'''                          xlPicture to create a metafile
(default) 
'''                          xlBitmap to create a bitmap 
''' 
''' Date        Developer           Action 
''' ----------------------------------------------------------

---------------- 
''' 30 Oct 98   Stephen Bullen      Created 
''' 15 Nov 98   Stephen Bullen      Updated to create our own
copies of the clipboard images 
'''
Function PastePicture(Optional lXlPicType As Long = xlPicture) As IPicture
'Some pointers
Dim h As Long, hPicAvail As Long, hPtr As Long, hPal As Long, lPicType As
Long, hCopy As Long 'Convert the type of picture requested from the xl
constant to the API constant lPicType = IIf(lXlPicType = xlBitmap,
CF_BITMAP, CF_ENHMETAFILE) 'Check if the clipboard contains the
required format hPicAvail = IsClipboardFormatAvailable(lPicType) If
hPicAvail <> 0 Then
'Get access to the clipboard
h = OpenClipboard(0&)
If h > 0 Then 
      'Get a handle to the image data 
      hPtr = GetClipboardData(lPicType) 
      'Create our own copy of the image on the clipboard, in
the appropriate format. 
      If lPicType = CF_BITMAP Then 
          hCopy = CopyImage(hPtr, IMAGE_BITMAP, 0, 0,
LR_COPYRETURNORG) 
      Else 
          hCopy = CopyEnhMetaFile(hPtr, vbNullString) 
      End If 
      'Release the clipboard to other programs 
      h = CloseClipboard 
      'If we got a handle to the image, convert it into a
Picture object and return it 
      If hPtr <> 0 Then Set PastePicture =
CreatePicture(hCopy, 0, lPicType) 
End If
End If
End Function

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ''' Subroutine: CreatePicture
'''
''' Purpose: Converts a image (and palette) handle into a Picture object. '''
''' Requires a reference to the "OLE Automation" type library '''
''' Arguments: None
'''
''' Date Developer Action ''' ---------------------------------------------------------
----------------- ''' 30 Oct 98 Stephen Bullen Created '''
Private Function CreatePicture(ByVal hPic As Long, ByVal hPal As Long,
ByVal lPicType) As IPicture
' IPicture requires a reference to "OLE Automation" Dim r As Long, uPicInfo
As uPicDesc, IID_IDispatch As GUID, IPic As IPicture
'OLE Picture types
Const PICTYPE_BITMAP = 1
Const PICTYPE_ENHMETAFILE = 4
' Create the Interface GUID (for the IPicture interface) With IID_IDispatch
.Data1 = &H7BF80980
.Data2 = &HBF32
.Data3 = &H101A
.Data4(0) = &H8B
.Data4(1) = &HBB
.Data4(2) = &H0
.Data4(3) = &HAA
.Data4(4) = &H0
.Data4(5) = &H30
.Data4(6) = &HC
.Data4(7) = &HAB
End With
' Fill uPicInfo with necessary parts.
With uPicInfo
.Size = Len(uPicInfo) ' Length of structure. .Type = IIf(lPicType =
CF_BITMAP, PICTYPE_BITMAP, PICTYPE_ENHMETAFILE) ' Type of
Picture 

  .hPic = hPic                                              
            ' Handle to image. 
  .hPal = IIf(lPicType = CF_BITMAP, hPal, 0)                
            ' Handle to palette (if bitmap). 
End With
' Create the Picture object.
r = OleCreatePictureIndirect(uPicInfo, IID_IDispatch, True, IPic) ' If an error
occured, show the description If r <> 0 Then Debug.Print "Create Picture: " &
fnOLEError(r) ' Return the new Picture object.
Set CreatePicture = IPic
End Function
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' ''' Subroutine: fnOLEError
'''
''' Purpose: Gets the message text for standard OLE errors '''
''' Arguments: None
'''
''' Date Developer Action ''' ---------------------------------------------------------
----------------- ''' 30 Oct 98 Stephen Bullen Created '''
Private Function fnOLEError(lErrNum As Long) As String
'OLECreatePictureIndirect return values Const E_ABORT = &H80004004
Const E_ACCESSDENIED = &H80070005
Const E_FAIL = &H80004005
Const E_HANDLE = &H80070006
Const E_INVALIDARG = &H80070057
Const E_NOINTERFACE = &H80004002
Const E_NOTIMPL = &H80004001
Const E_OUTOFMEMORY = &H8007000E
Const E_POINTER = &H80004003
Const E_UNEXPECTED = &H8000FFFF
Const S_OK = &H0
Select Case lErrNum
Case E_ABORT
fnOLEError = " Aborted"
Case E_ACCESSDENIED

fnOLEError = " Access Denied"
Case E_FAIL
fnOLEError = " General Failure"
Case E_HANDLE
fnOLEError = " Bad/Missing Handle"
Case E_INVALIDARG
fnOLEError = " Invalid Argument"
Case E_NOINTERFACE
fnOLEError = " No Interface"
Case E_NOTIMPL
fnOLEError = " Not Implemented"
Case E_OUTOFMEMORY
fnOLEError = " Out of Memory"
Case E_POINTER
fnOLEError = " Invalid Pointer"
Case E_UNEXPECTED
fnOLEError = " Unknown Error"
Case S_OK
fnOLEError = " Success!"
End Select
End Function
With all that, you will:
Open the UserForm1 and click the CommandButton1 this will take from the
ActiveSheet the shape name "Picture 1" (it is your picture) and Save it in the
same path of the Workbook, after that, take that path (the stored picture) and
insert it into Image1. If you want you can delete the picture from the path.
I try to take the picture directly from the clipboard, but I don not know if that is

possible, if you can do it, please let me know how you did it, by now this is my
help in your question.
Note: I take the magic code from here: Stephen Bullen
Topic 830
Subject
VBA: Excel to Powerpoint Copy + Paste Selected Charts into Active PPT
Slide
Question
I am looking to copy + paste selected charts in Excel into an active PPT slide.
I have a code that creates a new workbook and pastes all charts that are within
the workbook but would like to limit the command to just selected charts.
Here's the code:
Option Explicit
Sub CopyChartsToPowerPoint()
'Excel Application objects declaration
Dim ws As Worksheet
Dim objChartObject As ChartObject
Dim objChart As Chart
Dim objCht As Chart
Dim lngSlideKount As Long
'Powerpoint Application objects declaration Dim pptApp As
PowerPoint.Application
Dim pptPres As PowerPoint.Presentation
Dim pptSld As PowerPoint.Slide
'Create a new Powerpoint session
Set pptApp = CreateObject("PowerPoint.Application")
pptApp.Visible = msoTrue
'Create a new presentation
Set pptPres = pptApp.Presentations.Add
Set pptPres = pptApp.ActivePresentation

pptApp.ActiveWindow.ViewType = ppViewSlide
lngSlideKount = 0
For Each ws In ActiveWorkbook.Worksheets 'Verify if there is a chart object to
transfer If ws.ChartObjects.Count > 0 Then
For Each objChartObject In ws.ChartObjects 
      Set objChart = objChartObject.Chart 
      'ppLayoutBlank = 12 
      Set pptSld = pptPres.Slides.Add(lngSlideKount + 1, 12) 
      pptApp.ActiveWindow.View.GotoSlide pptSld.SlideIndex 
With objChart 
      'Copy + paste chart object as picture 
      objChart.CopyPicture xlScreen, xlBitmap, xlScreen 
      pptSld.Shapes.Paste.Select 
      'Coordinates will change depending on chart 
      With pptApp.ActiveWindow.Selection.ShapeRange 
          .Left = 456 
          .Top = 20 
      End With 
End With
lngSlideKount = lngSlideKount + 1 Next objChartObject
End If
Next ws
' Now check CHART sheets:
For Each objCht In ActiveWorkbook.Charts
'ppLayoutBlank = 12
Set pptSld = pptPres.Slides.Add(lngSlideKount + 1, 12)
pptApp.ActiveWindow.View.GotoSlide pptSld.SlideIndex With objCht 
      'Copy chart object as picture 
      .CopyPicture xlScreen, xlBitmap, xlScreen 
      'Paste copied chart picture into new slide 
      pptSld.Shapes.Paste.Select 
      pptApp.ActiveWindow.Selection.ShapeRange.Align

msoAlignCenters, True 
      pptApp.ActiveWindow.Selection.ShapeRange.Align
msoAlignMiddles, True 
End With
lngSlideKount = lngSlideKount + 1
Next objCht
'
'Activate PowerPoint application
pptApp.ActiveWindow.ViewType = ppViewNormal pptApp.Visible = True
pptApp.Activate
If lngSlideKount > 0 Then
If lngSlideKount = 1 Then
MsgBox "1 chart was copied to PowerPoint", vbOKOnly + vbInformation,
"Information" Else
MsgBox lngSlideKount & " charts were copied to PowerPoint", vbOKOnly +
vbInformation, "Information" End If
End If
End Sub
Appreciate the help everyone!
Answer
There doesn't appear to be a nice easy .IsSelected property in Excel for Charts
so you need to analyse the selection as in this function which you can call from
your procedure to get a collection of selected charts (testing to make sure it's
not Nothing before processing each Item in the Collection):
Option Explicit
' *********************************************************** ' Purpose:
Get a collection of selected chart objects. ' Inputs: None.
' Outputs: Returns a collection of selected charts. ' Author: Jamie Garroch
' Company: YOUpresent Ltd. http://youpresent.co.uk/ '

*********************************************************** Function
GetSelectedCharts() As Collection Dim oShp As Shape
Dim oChartObjects As Variant
Set oChartObjects = New Collection
' If a single chart is selected, the returned type is ChartArea ' If multiple charts
are selected, the returned type is DrawingObjects Select Case
TypeName(Selection)
Case "ChartArea"
oChartObjects.Add ActiveChart
Case "DrawingObjects" 
    For Each oShp In Selection.ShapeRange 
      If oShp.Type = msoChart Then 
        Debug.Print oShp.Chart.Name 
        oChartObjects.Add oShp.Chart 
      End If 
    Next 
End Select
Set GetSelectedCharts = oChartObjects Set oChartObjects = Nothing
End Function
Answer
So here's a solution that worked for me. The macro copy + pastes selected
range or chart into the active PowerPoint slide into a certain position. This
reason I wanted to do this is that each quarter/month we generate reports for
our clients and this helps to reduce the time required for copying + pasting and
making the deck look nice. Hope this helps anyone else who make a ton of
PPTs!
'Export and position into Active Powerpoint
'Prior to running macro, enable Microsoft Powerpoint Object Library in Tools
- Reference
'Identifies selection as either range or chart Sub ButtonToPresentation()

If TypeName(Selection) = "Range" Then
Call RangeToPresentation
Else
Call ChartToPresentation
End If
End Sub
Sub RangeToPresentation()
Dim PPApp As PowerPoint.Application
Dim PPPres As PowerPoint.Presentation
Dim PPSlide As PowerPoint.Slide
'Error message if range is not selected If Not TypeName(Selection) = "Range"
Then
MsgBox "Please select a worksheet range and try again." Else
'Reference existing instance of PowerPoint Set PPApp = GetObject(,
"Powerpoint.Application") 'Reference active presentation
Set PPPres = PPApp.ActivePresentation 'Reference active slide
Set PPSlide =
PPPres.Slides(PPApp.ActiveWindow.Selection.SlideRange.SlideIndex)
'Copy the range as a picture
Selection.CopyPicture Appearance:=xlScreen, _ Format:=xlBitmap
'Paste the range
PPSlide.Shapes.Paste.Select
'Align the pasted range
PPApp.ActiveWindow.Selection.ShapeRange.Align msoAlignCenters, True
PPApp.ActiveWindow.Selection.ShapeRange.Align msoAlignMiddles, True
' Clean up
Set PPSlide = Nothing
Set PPPres = Nothing

Set PPApp = Nothing
End If
End Sub
Sub ChartToPresentation()
'Uses Late Binding to the PowerPoint Object Model 'No reference required to
PowerPoint Object Library
Dim PPApp As Object 'As PowerPoint.Application Dim PPPres As Object 'As
PowerPoint.Presentation Dim PPSlide As Object 'As PowerPoint.Slide
'Error message if chart is not selected If ActiveChart Is Nothing Then
MsgBox "Please select a chart and try again." Else
'Reference existing instance of PowerPoint Set PPApp = GetObject(,
"Powerpoint.Application") 'Reference active presentation
Set PPPres = PPApp.ActivePresentation 'PPApp.ActiveWindow.ViewType = 1
' 1 = ppViewSlide 'Reference active slide
Set PPSlide = PPPres.Slides _
(PPApp.ActiveWindow.Selection.SlideRange.SlideIndex)
'Copy chart as a picture
ActiveChart.CopyPicture Appearance:=xlScreen, Size:=xlScreen, _
Format:=xlPicture
'Paste chart
PPSlide.Shapes.Paste.Select
'Align pasted chart
PPApp.ActiveWindow.Selection.ShapeRange.Align msoAlignCenters, True
PPApp.ActiveWindow.Selection.ShapeRange.Align msoAlignMiddles, True
' Clean up
Set PPSlide = Nothing
Set PPPres = Nothing
Set PPApp = Nothing

End If
End Sub
Topic 831
Subject
Automatically add column based on a cell
Question
I have a question, i have 50 meters long rail alignment. I can distribute that
alignment depend on the space, for instance i distribute the alignment every 10
meters to the columns. Looks like this; 
Column A: Column B:   Column C:  Column D:    Column E:    
Column F: 
0         10             20          30           40          
50 
Also i have location of the rail variable. I want to distribute the 50 meters long
alignment every 10 meters space into the columns and i want to add rail
location to the 21 m. Looks like this. 
Column A: Column B:   Column C:  Column D:    Column E:    
Column F: Column G: 
0         10             20          21         30          
40            50 
I mean when i enter the value of location of the rail to the cell, excel must
control that value and add a new column if it is not exist on excel sheet. .must
be look like above.
Is it possible to do that? thanks in advance! Answer
You do not mention where you input data. If you enter data end of previous data
then use following sub.
Sub AddColumn()
Dim LastClmn
LastClmn = Range("A1").End(xlToRight).Address

Range("A1:" & LastClmn).Select
ActiveWorkbook.Worksheets("Sheet1").Sort.SortFields.Clear
ActiveWorkbook.Worksheets("Sheet1").Sort.SortFields.Add
Key:=Range("A1:" & LastClmn), _
SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
With ActiveWorkbook.Worksheets("Sheet1").Sort 
      .SetRange Range("A1:" & LastClmn) 
      .Header = xlGuess 
      .MatchCase = False 
      .Orientation = xlLeftToRight 
      .SortMethod = xlPinYin 
      .Apply 
End With
End Sub
(1) Existing data
(2) Add new data
(3) After running the sub (I used Command Button).
Topic 832
Subject
XML to excel - Reverse geocoding
Question
I am using mapzen to reverse geocode coordinates for a list of coordinates (in
the first 2 columns) in MS Excel. The output should be the returned string from
mapzen to be pasted in the third column. Mapzen returns the result in geoJSON.
I have referenced XML v6.
Mapzen api return
I will then use search in Excel to match addresses so the long string returned
does not need parasing. The code so far compiles the http string. I dont have
any experience in XML but here is my attempt so far.

Sub Map()
' Map Macro
'
Public Function geoRevGeocode(lat As String, lng As String) As String Dim
strQuery As String
Dim strLatitude As String
Dim strLongitude As String
'Dim address As String
'Assemble the query string
strQuery = "https://search.mapzen.com/v1/reverse?api_key=search-
rK7fDCA&point." strQuery = strQuery & "lat=" & lat
strQuery = strQuery & "&point.lon=" & lng strQuery = strQuery &
"&username=claudiowyss" 'MsgBox (strQuery)
'define XML and HTTP components
Dim MapzenResult As Object
Set MapzenResult = CreateObject("MSXML2.DOMDocument") Dim
MapzenService As Object
Set MapzenService = CreateObject("MSXML2.XMLHTTP")
Dim oNodes As MSXML2.IXMLDOMNodeList
Dim oNode As MSXML2.IXMLDOMNode
'create HTTP request to query URL - make sure to have 'that last "False" there
for synchronous operation MapzenService.Open "GET", strQuery, False
MapzenService.send
MapzenResult.LoadXML (MapzenService.responseText)
'Need help copying mapzen returned string, to be pasted in the 3rd column in
excel sheet
End Function
With the final output to be something like this.

Desired Output
Any help would be much appreciated!
Answer
So I found a video on json vba interaction on the youtube channel called red
stanpler. This works perfectly for my needs.
Sub Map()
'
' Map Macro
'
Public Function geoRevGeocode(lat As String, lng As String) As String Dim
strQuery As String
Dim strLatitude As String
Dim strLongitude As String
strQuery = "https://search.mapzen.com/v1/reverse?api_key=search-
rK7fDCA&point." strQuery = strQuery & "lat=" & lat
strQuery = strQuery & "&point.lon=" & lng strQuery = strQuery & ".json"
Set MyRequest = CreateObject("WinHttp.WinHttpRequest.5.1")
MyRequest.Open "Get", strQuery
MyRequest.send
geoRevGeocode = MyRequest.responseText
End Function
Topic 833
Subject
VBA: Copy-Paste Into One Worksheet Macro Error
Question
I am trying to copy the columns from all tabs (worksheets) in a workbook into
the first empty column in Sheet1. Last week, I wrote the below macro:
Option Explicit

Dim i As Integer
Sub GICF_Confimit_CopyPaste_Sheet()
For i = 2 To 50 Step 1 
      Sheets(i).Activate 
      Range("C1").Select 
      Range(Selection,
ActiveCell.SpecialCells(xlLastCell)).Select 
      Selection.Copy 
      Sheets("Sheet1").Activate 
      Range("A1").End(xlToRight).Offset(0, 1).Select 
      ActiveSheet.Paste 
Next i
End Sub
This worked fine then, but now it is throwing an error saying that it cannot
paste and that I should select one cell and click paste or select a shape of the
same size. It is a lot of data (150+ columns from each tab), but this worked for
me last week and now seems to have broken, despite my not changing anything.
Would anyone be able to help?
Answer
The Error Message is very clear that the Copied range is not same as the
selected paste. So i suggest Just select Cell and paste it.
Option Explicit
Dim i As Integer
Sub GICF_Confimit_CopyPaste_Sheet()
For i = 2 To 50 Step 1
Sheets(i).Activate
Range("C1").Select
Range(Selection, ActiveCell.SpecialCells(xlLastCell)).Select Selection.Copy
Sheets("Sheet1").Activate

Range("A1").Select
ActiveSheet.Paste
Next i
End Sub
Topic 834
Subject
Excel: sum using OR criteria using Index / Match formula
Question
I want to use a formula to give me the sum of the numbers in the matrix below
for a particular letter for a combination of several months, e.g. What is the sum
for row E for the months of May, Jun and Jul?
I'm trying to use a formula like:
=SUM(INDEX(B2:M11,MATCH("E",A2:A11,0),MATCH({"May","Jun","Jul"}
but not having much luck.
Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec A 11 12 13 14 15 16 17
18 19 20 21 22 B 21 22 23 24 25 26 27 28 29 30 31 32 D 31 32 33 34 35 36
37 38 39 40 41 42 E 41 42 43 44 45 46 47 48 49 50 51 52 F 51 52 53 54 55
56 57 58 59 60 61 62 G 61 62 63 64 65 66 67 68 69 70 71 72 H 71 72 73 74
75 76 77 78 79 80 81 82 I 81 82 83 84 85 86 87 88 89 90 91 92 J 91 92 93 94
95 96 97 98 99 100 101 102 K 101 102 103 104 105 106 107 108 109 110
111 112
Thanks in advance
Answer
Perhaps best is:
=SUMPRODUCT((A2:A11="E")*ISNUMBER(MATCH(B1:M1,
{"May","Jun","Jul"},0))*B2:M11)
though you can also continue to use INDEX/MATCH with a small amendment:
=SUM(INDEX(B2:M11,MATCH("E",A2:A11,0),N(IF(1,MATCH({"May","Jun

(http://excelxor.com/2014/09/05/index-returning-an-array-of-values/)
Note that, were you to instead use a range of worksheet cells in which to store
your month criteria (as opposed to them being hard-coded within the formula,
as here), SUMPRODUCT would be required in the latter in place of SUM.
Regards
Topic 835
Subject
How do I select specific cells from ALL worksheets without knowing the exact
number of worksheets?
Question
I'm a total beginner. Here's a part of my code:
Workbooks("xxx").Worksheets(1).Activate Range("A1").Select
Selection.Copy
Workbooks("yyy").Worksheets(1).Activate Range("B2").Select
ActiveSheet.Paste
Workbooks("xxx").Worksheets(2).Activate Range("A2").Select
Selection.Copy
Workbooks("yyy").Worksheets(1).Activate Range("B3").Select
ActiveSheet.Paste
Each xxx workbook contains an unknown number of worksheets. It can be 3, it
can be 50. If I manually copy & paste the code above eg. 50 times, if the
number of worksheets is equal to 30 the macro will display an error and stop.
How can I automate this? Pls, keep in mind that I'm new at this so keep your
answers simple. Answer
Try below Code.
Dim wbX As Workbook
Dim wbY As Workbook
Set wbX = Application.Workbooks("xxx")

Set wbY = Application.Workbooks("yyy")
For i = 1 To wbX.Sheets.Count
wbX.Sheets(i).Activate
Range("A" & i).Select
Selection.Copy
wbY.Sheets(1).Activate
Range("B" & i + 1).Select
ActiveSheet.Paste
Next
Answer
Answered by Siva. THANK YOU!
Dim wbX As Workbook
Dim wbY As Workbook
Set wbX = Application.Workbooks("xxx")
Set wbY = Application.Workbooks("yyy")
For i = 1 To wbX.Sheets.Count
wbX.Sheets(i).Activate
Range("A1").Select
Selection.Copy
wbY.Sheets(1).Activate
Range("B" & i + 1).Select
ActiveSheet.Paste
Next
Topic 836
Subject
filtering data in a pivot table by year and month
Question
I'm managing a spreadsheet that was set-up by someone else, pivot tables and
all. I don't have much experience with pivot tables, myself but am getting

progressively better.
The problem I'm having is that these pivot tables (which pull their data from a
separate workbook) seem to only allow me to filter by month, now that we've
progressed into a new year, this is throwing up issues by bulking all the data
from 2015 and 2016 into months (I select "Jan" and it throws both years'
January results at me).
Is there a way to make it so that the dropdown filter list that allows me to
select months also organises by year (for example, instead of just saying "Jan,
Feb, Mar, Apr ..." etc. I first select "2016" and it opens up into "Jan, Feb, Mar,
Apr ...") to separate these values out.
I currently have found a way of grouping the data, but some of the pivot tables
put these fields (sometimes into "Report Filter" (which is fine), but other times
into "Column labels" or "row labels") which is causing further issues with
filtering the results because when I select "2015" and "2016" in "Year", and
"Nov", "Dec" and "Jan" in the "month", it throws me Jan 2015s results which
are unwanted for a report for the last three months
Topic 837
Subject
Collate information based on other columns
Question
There are 3 columns containing data. Column 'C' contains a list of data in 3
different number formats (in this instance the formats are a 2, 3 or 6 digit
number).
Column 'C' will always contain data and column 'A' and 'B' will only contain
data if column 'C' is in the incorrect format. Only one of 'A' and 'B' will ever
contain data.
I need all the 3 digit numbers in the 'COLLATED' column (column 'D').
I have tried to use an IF function as follows to little avail:
=IF(AND(A2="-",B2="-"),D2=C2,IF(B2="-",D2=A2,D2=B2))

Am I close or completely off the mark?
Answer
If the 3 digit values display for sure in any one column then the below will do.
Place below formula in D2 and drag it down for all the cells you want.
=IF(A2<>"-",A2,IF(B2<>"-",B2,C2))
Topic 838
Subject
Writing script arguments passed to an Excel file
Question
I'm trying to write a script that will take arguments passed to it, and write them
to an Excel file. I have four variables, one for the sheet, row, column and
value. for simplicity I'm using Command Prompt for testing, and passing a
series of two's, so on Sheet 2, Row 2, Column B, write "2".
Dim DCRT '(0)=Day/Sheet, (1)=Column, (2)=Row, (3)=Time Set DCRT =
WScript.Arguments
Set objExcel = CreateObject("Excel.Application")
objexcel.Workbooks.Open("C:\temp\test.xlsx") objexcel.Visible = True
objExcel.Sheets(DCRT(0)).Cells(DCRT(1), DCRT(2)).Value = DCRT(3)
The error I get is
(7, 2) Microsoft VBScript runtime error: Subscript out of range"
If I echo the arguments, I get back 2 2 2 2, so I know it is getting passed.
To try and get around this, I came up with
Dim SHEET, COLUMN, ROW, VALUE
SHEET = DCRT(0)
COLUMN = DCRT(1)
ROW = DCRT(2)
VALUE = DCRT(3)

and
objExcel.sheets(SHEET).Cells(COLUMN, ROW).Value = VALUE
This also throws a "Subscript out of range" error.
If I set the SHEET, COLUMN, ROW and VALUE variables to "2" everything
runs fine. and I get a "2" in my spreadsheet.
Any Suggestions?
Answer
I don't have access to Excel right now, but I suspect that the issue is caused by
a type conflict. The Arguments elements are strings, but should be integers if
you want to access collection items by index rather than name.
Change
objExcel.sheets(DCRT(0)).Cells(DCRT(1), DCRT(2)).Value = DCRT(3)
into
objExcel.sheets(CLng(DCRT(0))).Cells(CLng(DCRT(1)),
CLng(DCRT(2))).Value = CLng(DCRT(3))
Topic 839
Subject
Excel table sorting function
Question
In Excel, I'm working on a music survey thing for a project in school. This is a
screenshot of some of the results (the responses are not in english, sorry about
that):
The cells to the right is the musical time period(s) the respondents prefer.
Currently, I have a table that sorts how many times any gender has picked the
specific time period. For instance, 20 people picked the 80's as one of their
preffered time periods:

Below is the function I used.
=COUNTIF(CellStart:CellEnd;"80'erne")
Is it possible to also sort by gender based on the information I have? (basically
fill out the "men" and "women" rows) Answer
I think you want to change the formula to a COUNTIFS.
Do the same thing you do for a countif, except add a second criteria range and
set the criteria as "Male" or "Female" so you can then look at the time period
and the sex of the respondent.
=COUNTIFS(CellStart:CellEnd,"80'erne",CellStart:CellEnd,"Enter Sex
Here")
Topic 840
Subject
Saving images names with their sizes to a file in Windows
Question
In windows, I have a folder ImageDir with images inside it. I want to save all
the images names with their sizes in a text file or excel file.
How could I achieve this?
Answer
Well you can try something very simple:
Open the cmd (Winkey + R -> cmd Enter). cd to the ImageDir directory. (I.e.
something like cd C:/users/folder/ImageDir) Enter dir > my_text_file.txt and
press Enter.
Now you will have the complete output of the dir command in that directory,
which includes the size and names of your images.
Edit: if you want only the file names and sizes, then instead of dir >
my_text_file.txt use:

(for %F in (*) do @echo %F %~zF) > my_text_file.txt
Topic 841
Subject
Ms. Excel , point cell with value of another cell
Question
table
Problem
I have 1 table with 'row a to d' and 'column 1 to 4' these had a value, example :
'row a and column 1 had value 1000 (on cell B3)' , 'row a and column 2 had
value 1100 (on cell B4)' , etc
so my question is , how can i get the value from 'row a and column 1 (cell B3)'
if i write code like 'a/1' on cell J3. And if i write 'a/2' on cell J3, i can get
value from 'row a and column 2 (cell B4)' (make dynamic) Answer
Going with the text of your question rather than the image:
=INDIRECT(SUBSTITUTE(ADDRESS(1,MID($J$3,FIND("/",$J$3)+1,LEN($
& CELL("col",INDIRECT(LEFT($J$3,FIND("/",$J$3)-1)&"1"))+2)
This part of the formula returns the real column letter:
=SUBSTITUTE(ADDRESS(1,MID($J$3,FIND("/",$J$3)+1,LEN($J$3))+1,4),
e.g. 1 = B, 2 = C, 26 = AA, 1000 = ALM
This part of the formula returns the real row number:
=CELL("col",INDIRECT(LEFT($J$3,FIND("/",$J$3)-1)&"1"))+2 e.g. A=3, B
= 4, AA = 29, ALM = 1003
Stick both formula together to get the cell reference:
=SUBSTITUTE(ADDRESS(1,MID($J$3,FIND("/",$J$3)+1,LEN($J$3))+1,4),
& CELL("col",INDIRECT(LEFT($J$3,FIND("/",$J$3)-1)&"1"))+2
Use INDIRECT to turn it into a real cell reference.
I don't think that's what you're after though - but A/1 returns B3, A/2 returns C3
(ok, it falls over there but I figured it out so I'm going to post it!).

Answer
Just write on cell J3 '=cell_to_reference', without quotes obviously.
Topic 842
Subject
How to avoid repeating same block of formula n times
Question
Explanation
I found my issue to be common for things that I'm working on right now and that
I have done in the past.
I'm writing an Excel formula that for a given input from column Lookup value
will scan 10 different Excel files for a value to be returned using MATCH and
INDEX functions.
[A] [B]
Lookup value Returned value
123 val
Column Returned value has a following formula (sketch):
=IFNA(
INDEX('[File1.xlsx]Sheet1'!$A:$B;MATCH(A2;'[File1.xlsx]Sheet1'!$B:$B;0)
INDEX('[File1.xlsx]Sheet2'!$A:$B;MATCH(A2;'[File1.xlsx]Sheet2'!$B:$B;0)
)
Basic idea for this is to look for a value from the first column in a row where
the given value (input) is present in any of two sheets in a file. And do the
exact same thing for 10 times with different file names.
I'm using IFNA function to keep going until a value is found in any file or all
files have been processed.
Question

Without repeating the given sketch 10 times for every file in File1, ... File10
how could I approach this issue simpler, as of not repeating the code 10 times?
The simpler the better. Answer
I would suggest doing it in VBA instead. Then you can easily loop through the
files instead, e.g:
Function FindValue()
Dim fileNames
fileNames = Array("FileName1", "FileName2", "FileName3")
For i = 1 To UBound(fileNames)
'Generic code for finding value using fileName(i) Next i
End Function
Update
This seems to work for me. Error handling could probably have been done
better though. Might need to change behaviour depending on what you want to
do if there is no match.
Function FindValue(LookupString)
Dim fileNames
Dim tempRange
Dim tempRange3
fileNames = Array("VBATesting2.xlsm", "VBATesting3.xlsm") On Error GoTo
ErrorHandler
For i = 0 To UBound(fileNames) 
      tempRange =
Workbooks(fileNames(i)).Worksheets("Sheet1").Range("A:B").Find
1) 
      If tempRange <> "" Then 
          FindValue = tempRange 
          Exit Function 

      Else 
          tempRange =
Workbooks(fileNames(i)).Worksheets("Sheet2").Range("A:B").Find
1) 
          If tempRange <> "" Then 
              FindValue = tempRange 
              Exit Function 
          Else 
              FindValue = "No Match" 
          End If 
      End If 
Next i
ErrorHandler
tempRange = "" Resume Next End Function
Topic 843
Subject
Count one column if unique values in another column VBA
Question
I have a spreadsheet that I need to sum how many values "UDL" there is in
column(N:N), but the problem is they should only be counted for every unique
number in column (C.C)
So for every number that also has "UDL" in column N they should only be
counted once as there can be a lot of duplicates.
Hope you can help :)
Answer
Seems like a loop & delimited string would be a quick way to get what you're
wanting. Assuming Column A is always filled & has a header in row 1,
something like:
Dim u as string
Dim i as long
dim t as long
i = 2

Do While Range("A" & i).value <> ""
If Range("N" & i).value = "UDL" Then 
      If InStr(1, u, "|" & Range("C" & i).value & "|") = 0
Then 
          t = t + 1 
          u = u & "|" & Range("C" & i).value & "|" 
      End If 'else the value in C is non-unique 
End If 'else not UDL so no action needed i = i + 1
Loop
Range("A" & i + 1).value = t 'Outputs t to column A with a blank row between
it & your data
That'll need some adjusting based on what column should control the loop,
what row the loop should start on, and where you want the count to go.
Topic 844
Subject
Add new context menu item without using events vba excel
Question
Is there any way of adding custom context menu (right click menu) item without
using events? The reason why am i asking this is because some other code is
setting
Application.EnableEvents
to false and I cannot rely on any event but still I want to add the new item to the
context menu
Alternatively is there any other way of enabling the events in automated (not
running the command in immediate window) way?
Topic 845
Subject
Manipulating times on excel

Question
I have a sheet with my employee names listing all the jobs they have done in a
month. It contains the start time, and completion time and the format is hh:mm.
I then have a formula that subtracts start time from finish time to give me the
total time spent on each job. the service we run is 24/7 so sometimes they start
jobs before midnight and complete them after so the formula I created to take
this in to account and not have errors with negative times was this one:
=IF(V6>R6,V6-R6,24-R6+V6) (R is started time, V is completed time). again
the number format is hh:mm
The issue I am now having is trying to average the time per job, as it now
counts any cells with 00:00 as a 24hr long job and is skewing all the averages.
Any advice on how I should format these numbers, should I keep them in
decimal the whole way until the final figures, or is there a better formula for
subtracting times from each other without leaving zero time jobs as 00:00?
Answer
I imagine the table like this:
Employee Start End | Total (Formula = IF(...))
Foo bar 19:00 08:00 | 13:00
Foo bar 09:00 13:15 | 04:15
Foo bar 10:00 15:30 | 05:30
Foo bar 21:00 11:45 | 14:45
Average: 09:23 (Formula = AVERAGE(...))
Change the condition from V6>R6 to R6<V6:
IF(R6<V6,V6-R6,24-R6+V6)
09:00 & 13:15 ==> 04:15
19:00 & 08:00 ==> 13:00
00:00 & 00:00 ==> 00:00

The zero-duration jobs would still be included in the average though, if you're
okay with that.
Topic 846
Subject
Tablib export corrupting files
Question
I'm writing a simple code to transform csv back to xls with Tablib on python.
As I understand, Tablib does conversion for you if you import the csv.
import tablib
imported_data = tablib.import_set(open('DB.csv',encoding='utf8').read()) f =
open('workfile.xls', 'wb')
f.write(imported_data.xls)
f.close()
This code handles small sample of the database, but fails at one point (~600
lines) meaning that is compiles successfully but Excel cannot open the file at
that point.
I'm not sure how to proceed - is this tablib failing or does Excel fail to read
encoded data? Answer
As an alternative approach, you could just ask Excel to do the conversion as
follows:
import win32com.client as win32
import os
excel = win32.gencache.EnsureDispatch('Excel.Application')
src_filename = r"c:\my_folder\my_file.csv" name, ext =
os.path.splitext(src_filename) target_filename = name + '.xls'
wb = excel.Workbooks.Open(src_filename) excel.DisplayAlerts = False
wb.DoNotPromptForConvert = True
wb.CheckCompatibility = False

wb.SaveAs(target_filename, FileFormat=56, ConflictResolution=2)
excel.Application.Quit()
Microsoft has a list of File formats that you can use, where 56 is used for xls.
Answer
this two functions allow you to import from csv, after export to excel file
import csv
from xlsxwriter import Workbook
import operator
# This function for import from csv
def CSV2list_dict(file_name): 
   with open(file_name) as f: 
      a = [{k: int(v) for k, v in row.items()} 
      for row in csv.DictReader(f, skipinitialspace=True)] 
   return a 
# file_name must be end with .xlsx
# The second parameter represente the header row of data in excel, # The type
of header is a list of string, # The third paramater represente the data in list
dictionaries form # The last paramater represente the order of the key def
Export2excel(file_name, header_row, list_dict, order_by):
list_dict.sort(key=operator.itemgetter(order_by)) wb=Workbook(file_name)
ws=wb.add_worksheet("New Sheet") #or leave it blank, default name is
"Sheet 1" first_row=0
for header in header_row: 
       col=header_row.index(header) # we are keeping order. 
       ws.write(first_row,col,header) # we have written first
row which is the header of worksheet also. 
row=1
for art in list_dict: 

      for _key,value in art.items(): 
          col=headerrow.index(_key) 
          ws.write(row,col,_value) 
      row+=1 #enter the next row 
wb.close()
csv_data = CSV2list_dict('DB.csv')
header = ['col0','col1','col2']
order = 'col0' # the type of col0 is int Export2excel('workfile.xlsx', header,
csv_data, order)
Topic 847
Subject
Auto-update (calculate) the Excel sheet when a cell is changed
Question
I am using Excel 2010 and I want that the Excel sheet will be updated
(calculated) automatically when the value of a cell (Range("B7")) is changed
(The Range("B7") is a drop-down list). I am trying to use the intersect-target
method like:
Private Sub Worksheet_Change(ByVal target As Range)
If Not Intersect(target, Range("B7")) Is Nothing Then ActiveSheet.Calculate
End If
End Sub
I have two questions about this:
Does it matter if I put this Private Sub under any module? Or am I supposed to
write it in the exact sheet under the Microsoft Excel -object menu in VBA?
The second question is how I can make this work? The sheet doesn't update
(calculate) automatically when I change the Range("B7"). It only updates when
I save the Excel file. Answer
The function should be in the sheet which B7 belongs to, e.g. if the B7 you are

updating is in "Sheet1" then the code for the Worksheet_Change event should
be under Sheet1 too. You can right click the tab for the sheet, and select show
code to get to the right place in VBE.
Excel should be aware that any cell using B7 needs to be recalculated when
changed, so that should be handled automatically.
Answer
Your code will work if you place it in the sheets event not in Modlue please
find the below image for your reference.
Select the respective sheet in VB window and double click on it, it will open
the worksheet event window (code window) where you need to copy paste the
codes. Now try changing the validation cell it should work :)..
Topic 848
Subject
Issue with Microsoft.Office.Interop.Excel assembly on windows 2008 R2
server
Question
Our task is to run the excel macro programatically.
In a local environment it was working fine when we follow the below steps:
1.
Microsoft.Office.Interop.Excel.Application appExcel =
new Microsoft.Office.Interop.Excel.Application();
2.
Microsoft.Office.Interop.Excel.Workbook workBook =
appExcel.Workbooks.Open("FilePath", 
                 Type.Missing, Type.Missing, Type.Missing,

Type.Missing, 
                 Type.Missing, Type.Missing, Type.Missing,
Type.Missing, 
                 Type.Missing, Type.Missing, Type.Missing,
Type.Missing, 
                 Type.Missing, Type.Missing);` 
3
appExcel.Run("Macro name", "$W$5", 1, 0, "$Q$11:$Q$112",
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
Type.Missing);
Note
On localhost everything is working fine and the macro is getting executed. But
the functionality is not working as expected when hosted in IIS(version 7.5).
For this to work the changes which we have done are:-
Control Panel -> Administrative Tools -> Component Services Computers ->
My Computer -> DCOM Config -> Microsoft Excel Application -> Properties
1.1. Here in the security tab we have Customized all the permissions by adding
user(IUSR) and giving him all access permissions.
After doing these changes we are able to create instance of Interop.Excel. But
we could not open the workbook.
1.2. In Identity tab of Microsoft Excel Application peroperties, by default "The
launching user" is selected.
After changing the value to "The interactive user" we are able to open the
workbook.

But we could not run the macro.
1.3. C:\Windows\System32\config\systemprofile
In this location we have created Desktop folder. For this folder properties, in
the security tab we have created user(IUSR) and given full control.
Now we are able to run the macro and getting the desired output even when
running the application on IIS hosted site.
Issue
After making all the changes when we have moved the changes to production
server, there we could not find Microsoft Excel Application in DCOM Config.
Microsoft Office is not completely installed in production server. Only Excel
software was installed on the server.
We are getting null reference exception at below line of code.
Microsoft.Office.Interop.Excel.Workbook workBook =
appExcel.Workbooks.Open("FilePath", 
                 Type.Missing, Type.Missing, Type.Missing,
Type.Missing, 
                 Type.Missing, Type.Missing, Type.Missing,
Type.Missing, 
                 Type.Missing, Type.Missing, Type.Missing,
Type.Missing, 
                 Type.Missing, Type.Missing); 
Our production server is running on Windows 2008 R2.
Could any one please suggest the right way to resolve this issue.
Topic 849
Subject
read excel put values in xml
Question

I have an empty request xml:-
<?xml version="1.0" encoding="UTF-8"?>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org
/soap/envelope/" xmlns:mes="http://MessageView/"> <soapenv:Header />
<soapenv:Body>
<mes:abcRq> 
   <RqID>?</RqID> 
   <MsgRqHdr> 
      <ARqID>?</ARqID> 
      <SRole>?</SRole> 
      <SSession>?</SSession> 
      <IP>?</IP> 
      <PTy>?</PTy> 
      <TID>?</TID> 
      <TDt>?</TDt> 
      <TSsDt>?</TSsDt> 
      <IP>?</IP> 
      <TPId>?</TPId> 
      <LP>?</LP> 
      <MxRLim>?</MxRLim> 
      <CRLt>?</CRLt> 
      <IP>?</IP> 
      <PTy>?</PTy> 
   </MsgRqHdr> 
</mes:abcRq>
</soapenv:Body>
</soapenv:Envelope>
For this xml i have calculated the xpath of elements :-
RqID RqID[1]
ARqID MsgRqHdr[1]/ARqID[1]
SRole MsgRqHdr[1]/SRole[1]
SSession MsgRqHdr[1]/SSession[1]
IP MsgRqHdr[1]/IP[1]
PTy MsgRqHdr[1]/PTy[1]
TID MsgRqHdr[1]/TID[1]
TDt MsgRqHdr[1]/TDt[1]

TSsDt MsgRqHdr[1]/TSsDt[1]
IP_1 MsgRqHdr[1]/IP[2]
TPId MsgRqHdr[1]/TPId[1]
LP MsgRqHdr[1]/LP[1]
MxRLim MsgRqHdr[1]/MxRLim[1]
CRLt MsgRqHdr[1]/CRLt[1]
IP_2 MsgRqHdr[1]/IP[3]
Pty_1 MsgRqHdr[1]/PTy[2]
Now i have another sheet called the Test data sheet, i put values of as
according to my Test case in there , ex:-
TestDataID RunTestForData TestRequestRequired RqID ARqID SRole
SSession IP Pty TID TDt TSsDt IP_1 TPId LP MxRLim CRLt IP_2 PTy_1 
1.1.1   Yes Yes                         3               01
Top     99      NnECn 
1.1.2   Yes Yes                         2               02
Top     100     ECn 
Now , Is there a way i can read the values of test data excel and put it in the
xml somehow ?? Answer
First of all create bean class and put all values that you want to insert into xml
there are some api already provided for reading excel and storing values in
custome object
please look into below link : http://examples.javacodegeeks.com/core-
java/writeread-excel-files-in-java-example/
after storing all values from excel to object then used Dom parser to insert
values from object to XML file.
you can get node from current xml and put values using setTextContent() of
node object.
hope i will help you.

Topic 850
Subject
Excel formula sum if string contains value
Question
I want to ask if it is possible to calculate cells B9 and B10 automatically in the
following picture? Answer
You formula should look something like: B9:
=sumif($A$2:$A$6;"apple";$B$2:$B$6). $ - is to lock the cell, apple - means
that the cell contain string "apple"
Topic 851
Subject
How to give unique numbers to a set of repeated column values in MS- Excel
Question
I have a column field called State and it contains 38 different states, which
keeps repeating( total column count is 154000). I have sorted the column field.
Now I want to add another column named State id, which should function in
such a way that for each State there should be a unique State id
For example, if 1st state is repeating 5000 times and 2nd state is repeating
25000 times - the State Id value should have 1 repeating 5000 times for 1st
state and 2 repeating 25000 times for 2nd State and the same logic should be
applicable for other states as well
Is it possible using excel?
Answer
you could set up a lookup table on another tab
state id
Texas 1
Delaware 2
Kentucky 3
then in your main list use =vlookup formula to match the state names and return

the id.
Answer
You can also use an if to verify if that state already have an id and then create a
new one. All this inside a loop, of course.
Topic 852
Subject
Unable to get ComboBox control design in Excel document using C#
Question
I am trying to push data into an excel document from a database. In the excel
document there are some ComboBox which I need to select. I am able to set the
values in an excel cell, but for those cells who have a ComboBox, I am unable
to get the instance of ComboBox.
I tried several links including this one, but no luck.
I am using Microsoft Excel 12.0 Object Library.
My Code :
Microsoft.Office.Interop.Excel.Application oXL = null;
Microsoft.Office.Interop.Excel.Workbook oWB = null;
Microsoft.Office.Interop.Excel.Worksheet ws = null;
oXL = new Microsoft.Office.Interop.Excel.Application(); oWB =
oXL.Workbooks.Open(@"password.xlsm"); //its .xlsm and not xlsx ws =
(Microsoft.Office.Interop.Excel._Worksheet)oWB.Sheets["Input"];
oWB.Unprotect("password");
ws.Unprotect("password");
Microsoft.Office.Interop.Excel.Shape shp =
(Microsoft.Office.Interop.Excel.Shape)ws.Shapes.Item("ComboBox1");
//oXL.ActiveWorkbook.Sheets["Input"].DropDowns("ComboBox1"); Object
ole= (Microsoft.Office.Interop.Excel.OLEObject)shp.OLEFormat.Object;
//MSForm.ComboBox newBox =(MSForm.ComboBox)
(((Microsoft.Office.Interop.Excel.OLEObject)ole).Object);

Strange thing is that the Form namespace is missing from using MSForm =
Microsoft.Vbe.Interop.Forms;
A similar type of thread is posted here also. Can anybody throw some
knowledge?
Topic 853
Subject
HTML to excel image base 64
Question
I have a html page which i create through javascript and save it with an
extension of .xls .Excel opens this file successfully and it shows the table and
rows and columns. But i cannot get the images to show up in excel when i put
the src as base64 string. It says "the image cannot currently be displayed".
Example:
<html xmlns:o='urn:schemas-microsoft-com:office:office'
xmlns:x='urn:schemas-microsoft-com:office:excel'
xmlns='http://www.w3.org/TR/REC-html40'><head> <!--[if gte mso 9]>
<xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
<x:Name>{worksheet}</x:Name><x:WorksheetOptions>
<x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>
</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>
<body><table><tr><td colspan="7">
<img
style="width:500px;height:50px;"
src="data:image/gif;base64,R0lGODdh7APwA/AAAAAAAP///ywAAAAA7A
/>
</td></tr>
</table></body></html>
Topic 854
Subject
Reading non-standard excel file with C#
Question

What do i mean by 'non-standard'?
Take a look at these images: http://imgur.com/a/tFqHQ
The first one is the non-standard excel file. I'm pretty sure it's not an excel file,
but the file's extension is .xls and for some reason Excel can open it, and
understand it's structure.
The second image is the same file after it was opened in excel, and saved out
to .xls (97-2003).
If excel can open it, and view it correctly, i should be able to do as well. Any
tips how to approach this?
I have to mention that, my app have to use and read the non-standard excel
files, because otherwise the user have to open the files one-by-one in
(excel/libre office) and save it out in a correct format, which i would like to
avoid for convenience.
Topic 855
Subject
Excel VBA - OpenHyperlink in new sheet
Question
im opening a CSV file from the internet using the =FollowHyperlink() function.
However the CSV gets opened in a new workbook. Is it possible to open the
.csv file in the same workbook but on a new sheet, or even better directly in
the same worksheet so that i can use the data from the file.
Best, JD
Answer
do you mean like this?
ActiveCell.FormulaR1C1 = "=HYPERLINK(""
[Workbook.xlsx]Sheet1!A1"",""CLICK HERE"")"
Topic 856
Subject

Identify and extract noun and modifier
Question
Any idea how to Identify and extract noun and modifier using VBA (excel)
Example
ball valve 2in for green pump with gasket
Should be: ball valve
Any help will be appreciated
Answer
There are some different approaches, depending on the type of sentence you
expect. In your example, the two words you want to extract are on the
beginning of the sentence, and separated by whitespaces. If you expect this to
be always the case, then you could use something simple as
Function getNoun(ByVal sentence As String)
getNoun = ""
pos1 = InStr(1, sentence, " ") 'find the first whitespace If pos1 <= 0 Then 
      getNoun = sentence 'if no whitespace, then assume there
is only the noun 
      Exit Function 
End If
pos2 = InStr(pos1 + 1, sentence, " ") 'find the second whitespace If pos2 <= 0
Then 
      getNoun = sentence 'if no second whitespace, then
assume there is only the noun and qualifier 
      Exit Function 
End If
getNoun = Left(sentence, pos2 - 1) 'if there are two or more spaces, get all

chars before the second one End Function
Tests in immediate window:
? getNoun("ball valve 2in for green pump with gasket") ball valve
? getNoun("ball valve")
ball valve
? getNoun("ball")
ball
If your scenario is more complex and you need to use specific criteria to
determine which words are the desired noun and qualifier, you would probably
find use for the Regex COM class (see this topic for example).
EDIT: Based on the comments, I understand that positions are variable, and
that it is acceptable to use the MS Word thesaurus as a reference. If the code
will run in Microsoft Word, the following function will tell you whether or not
a word is a noun:
Function is_noun(ByVal wrd As String)
Dim s As Object, l As Variant
is_noun = False
Set s = SynonymInfo(wrd)
Let l = s.PartOfSpeechList
If s.MeaningCount <> 0 Then 
    For i = LBound(l) To UBound(l) 
        If l(i) = wdNoun Then 
            is_noun = True 
        End If 
    Next 
End If
End Function
If you are not running on MS Word (your tags suggest MS Excel) but MS Word
is installed in the target system, then you can adapt the above code to use MS
Word COM automation object.

Then you can extract the first noun, and the next word - if any -, from a
sentence, with something like this
Function getNoun(ByVal sentence As String)
getNoun = ""
Dim wrds() As String
wrds = Split(sentence)
For i = LBound(wrds) To UBound(wrds) 
      If is_noun(wrds(i)) Then 
          getNoun = wrds(i) 
          If i < UBound(wrds) Then 
              getNoun = getNoun & " " & wrds(i + 1) 
          End If 
          Exit Function 
      End If 
Next
End Function
Notice, however, that with this you are trusting blindly in MS Word's word
database and may get weird results if your sentences contain, for example,
words that may be a verb or a noun depending on context. Also, the above
example will use the default language of your setup of MS Word (it is possible
to use a different one - if installed - by including a language parameter in
SynonymInfo)
Topic 857
Subject
How do I declare a global variable in VBA?
Question
I wrote the following code:
Function find_results_idle()
Public iRaw As Integer
Public iColumn As Integer

iRaw = 1
iColumn = 1
And I get the error message:
"invalid attribute in Sub or Function"
Do you know what I did wrong?
I tried to use Global instead of Public, but got the same problem.
I tried to declare the function itself as `Public, but that also did no good.
What do I need to do to create the global variable? Answer
You need to declare the variables outside the function:
Public iRaw As Integer
Public iColumn As Integer
Function find_results_idle()
iRaw = 1
iColumn = 1
Answer
This is a question about scope.
If you only want the variables to last the lifetime of the function, use Dim (short
for Dimension) inside the function or sub to declare the variables:
Function AddSomeNumbers() As Integer
Dim intA As Integer
Dim intB As Integer
intA = 2
intB = 3
AddSomeNumbers = intA + intB

End Function
'intA and intB are no longer available since the function ended
A global variable (as SLaks pointed out) is declared outside of the function
using the Public keyword. This variable will be available during the life of
your running application. In the case of Excel, this means the variables will be
available as long as that particular Excel workbook is open.
Public intA As Integer
Private intB As Integer
Function AddSomeNumbers() As Integer
intA = 2
intB = 3
AddSomeNumbers = intA + intB
End Function
'intA and intB are still both available. However, because intA is public, ' 'it
can also be referenced from code in other modules. Because intB is private,' 'it
will be hidden from other modules.
You can also have variables that are only accessible within a particular
module (or class) by declaring them with the Private keyword.
If you're building a big application and feel a need to use global variables, I
would recommend creating a separate module just for your global variables.
This should help you keep track of them in one place.
Answer
To use global variables, Insert New Module from VBA Project UI and declare
variables using Global
Global iRaw As Integer
Global iColumn As Integer
Answer
If this function is in a module/class, you could just write them outside of the

function, so it has Global Scope. Global Scope means the variable can be
accessed by another function in the same module/class (if you use dim as
declaration statement, use public if you want the variables can be accessed by
all function in all modules) :
Dim iRaw As Integer
Dim iColumn As Integer
Function find_results_idle()
iRaw = 1
iColumn = 1
End Function
Function this_can_access_global()
iRaw = 2
iColumn = 2
End Function
Answer
Create a public integer in the General Declaration.
Then in your function you can increase its value each time. See example
(function to save attachements of an email as CSV).
Public Numerator As Integer
Public Sub saveAttachtoDisk(itm As Outlook.MailItem) Dim objAtt As
Outlook.Attachment
Dim saveFolder As String
Dim FileName As String
saveFolder = "c:\temp\" 
   For Each objAtt In itm.Attachments 
          FileName = objAtt.DisplayName & "" & Numerator & ""
& Format(Now, "yyyy-mm-dd H-mm-ss") & ".CSV" 
                    objAtt.SaveAsFile saveFolder & "\" &

FileName 
                    Numerator = Numerator + 1 
        Set objAtt = Nothing 
   Next 
End Sub
Topic 858
Subject
Check if file is open, including subfolders in VBA
Question
I need to check if a file is already open in order to speed up my code.
Currently, it loops through a list, opens a file with a path and the file name
comes from the list, there's a few lines of code that means if the file I want to
open is in a folder within this path, it can still do that:
If Not IsFileOpen("G:\BS\Josh Whitfield\1. Work work\Credit_Chasing\NEW
PROCESS\" & file) Then
If filevar <> "" Then
Workbooks.Open "G:\BS\Josh Whitfield\1. Work work\Credit_Chasing\NEW
PROCESS\" & file Else
Workbooks.Open "G:\BS\Josh Whitfield\1. Work work\Credit_Chasing\NEW
PROCESS\" & Range("F" & i).Value & "\" & file End If
End If
I also have a function that will detect if the file is already open, but I would
like a better one or some help getting this current one to work with subfolders:
Function IsFileOpen(filename As String)
Dim filenum As Integer, errnum As Integer
On Error Resume Next ' Turn error checking off. filenum = FreeFile() ' Get a
free file number. ' Attempt to open the file and lock it. Open filename For Input

Lock Read As #filenum 
  Close filenum          ' Close the file. 
  errnum = Err           ' Save the error number that
occurred. 
  On Error GoTo 0        ' Turn error checking back on. 
' Check to see which error occurred. Select Case errnum 
      ' No error occurred. 
      ' File is NOT already open by another user. 
      Case 0 
       IsFileOpen = False 
      ' Error number for "Permission Denied." 
      ' File is already opened by another user. 
      Case 70 
          IsFileOpen = True 
      ' Another error occurred. 
      Case Else 
          Error errnum 
End Select
End Function
Thanks for any help!
Answer
Managed to solve it with a different function:
Function IsWorkBookOpen(FileName As String)
Dim ff As Long, ErrNo As Long
subCheck = False
On Error Resume Next
ff = FreeFile()
Open FileName For Input Lock Read As #ff Close ff
ErrNo = Err
On Error GoTo 0

IsWorkBookOpen = ""
Select Case ErrNo
Case 0: IsWorkBookOpen = False
Case 70: IsWorkBookOpen = True
Case Else: IsWorkBookOpen = ""
End Select
End Function
and the setup for the sub:
ret = IsWorkBookOpen("G:\BS\Josh Whitfield\1. Work
work\Credit_Chasing\NEW PROCESS\" & file)
retSub = subCheck
If ret <> True Then 
      If ret = False Then 
          Workbooks.Open "G:\BS\Josh Whitfield\1. Work
work\Credit_Chasing\NEW PROCESS\" & file 
      ElseIf ret = "" Then 
          'subCheck = True 
          Workbooks.Open "G:\BS\Josh Whitfield\1. Work
work\Credit_Chasing\NEW PROCESS\" & Range("F" & i).Value & "\"
& file 
      End If 
End If
THIS CODE WONT WORK FOR EVERYONE IF YOU WANT TO CHECK
IF THE FILE IS OPEN, it works for my purposes because I don't mind 3 types
of files being open, this is not an entirely reliable method.
Topic 859
Subject
VBA - Excel : If value What parameter in Find(What:=“value”) doesn't exists
in a sheet for all the IDs
Question

I have a problem with VBA for Excel.
I want to search for a specific value(for a specific ID) in a column of a sheet
and pass the value in another table row (of that ID). What happens If the value
in the What:="value" parameter of the Find() method doesn't exists for all the
IDs in the column?
If the ID (of the first sheet) doesn't have that value I dont want to pass any
value to the other sheet (of that ID).I want to set a "#N/A" value instead. In fact
it passes the value of the predecessor ID.
What should I do?
Answer
I use this technique for my VLOOKUP formulas which is just basic Excel and
not VBA.
Say we have a simple two column table with ID in Column A, Values in
Column B in Sheet 1 and we are looking up ID in Sheet 2.
IF(ISERROR(VLOOKUP(A1, Sheet1!A1:B100,2,FALSE)),"NA",
VLOOKUP(A1, Sheet1!A1:B100,2,FALSE))
So do the lookup if you cannot find ID, then ISERROR is true and set NA, else
get lookup value.
Such a construct may work in your case.
EXTENSION
DATA
Sheet looking like this, with ID in A1. So ID 3 is missing.
ID KEY
1 100
2 200

4 400
CODE
I have written two procedures. findme two searches for ID = 2 and 3, and
findcode function looks up ID and then looks in next column offset 1 to find the
value. I am getting back the error codes when search for 3 which is not in your
list.
Sub findme()
Dim rng As Range
Dim i As Long
Dim y As Variant
Set rng = ThisWorkbook.Sheets(1).Range("A1:A100")
' Example look for 2 - get 200
i = 2
y = findcode(CStr(i), rng)
MsgBox ("id=" & CStr(i) & ". y = " & CStr(y))
' Look for 3 it should fail
i = 3
y = findcode(CStr(i), rng)
MsgBox ("id=" & CStr(i) & ". y = " & CStr(y))
End Sub
Public Function findcode(i As String, rng As Range) As Variant
Dim x As Variant
Set x = rng.Find(What:=CStr(i), After:=ActiveCell, LookIn:=xlValues,
LookAt:= _ 

      xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext,
MatchCase:=False _ 
      , SearchFormat:=False) 
If x Is Nothing Then 
       i = CInt(CVErr(xlErrNA)) 
       findcode = CVErr(xlErrNA) 
  Else 
       findcode = x.Offset(0, 1).Value 
End If
End Function
So msgbox shows id = 2, y = 200 and then error code on second run.
Topic 860
Subject
Copy only visible cell
Question
I have found the below macro on the internet and it works perfekly for me. The
only thing I would like to change is what is copied to the new sheets. I would
like the macro to copy on visible cells, not evertyting on the workbook. Before
running this macro I will filter the data i want to work with, the rest can be left
out. Found similar post regarding this "issue" but was not able to apply the
changes on the below. it can be found here: Copying only the visible cells from
visible worksheets into a new workbook, excell 2007 VBA
Thanks in advance
Sub Copy_To_Worksheets()
'Note: This macro use the function LastRow
Dim My_Range As Range
Dim FieldNum As Long
Dim CalcMode As Long
Dim ViewMode As Long

Dim ws2 As Worksheet
Dim Lrow As Long
Dim cell As Range
Dim CCount As Long
Dim WSNew As Worksheet
Dim ErrNum As Long
'Set filter range on ActiveSheet: A1 is the top left cell of your filter range 'and
the header of the first column, D is the last column in the filter range. 'You can
also add the sheet name to the code like this :
'Worksheets("Sheet1").Range("A1:D" & LastRow(Worksheets("Sheet1"))) 'No
need that the sheet is active then when you run the macro when you use this. Set
My_Range = Range("A1:N" & LastRow(ActiveSheet))
My_Range.Parent.Select
If ActiveWorkbook.ProtectStructure = True Or
MyRange.Parent.ProtectContents = True Then MsgBox "Sorry, not working
when the workbook or worksheet is protected", _
vbOKOnly, "Copy to new worksheet" Exit Sub
End If
'This example filters on the first column in the range(change the field if
needed) 'In this case the range starts in A so Field:=1 is column A, 2 = column
B, ...... FieldNum = 11
'Turn off AutoFilter
My_Range.Parent.AutoFilterMode = False
'Change ScreenUpdating, Calculation, EnableEvents, .... With Application
CalcMode = .Calculation
.Calculation = xlCalculationManual
.ScreenUpdating = False
.EnableEvents = False
End With
ViewMode = ActiveWindow.View

ActiveWindow.View = xlNormalView
ActiveSheet.DisplayPageBreaks = False
'Add a worksheet to copy the a unique list and add the CriteriaRange Set ws2
= Worksheets.Add
With ws2
'first we copy the Unique data from the filter field to ws2
My_Range.Columns(FieldNum).AdvancedFilter _ 
          Action:=xlFilterCopy, _ 
          CopyToRange:=.Range("A1"), Unique:=True 
'loop through the unique list in ws2 and filter/copy to a new sheet Lrow =
.Cells(Rows.Count, "A").End(xlUp).Row For Each cell In .Range("A2:A" &
Lrow) 
      'Filter the range 
      My_Range.AutoFilter Field:=FieldNum, Criteria1:="=" & _
       Replace(Replace(Replace(cell.Value, "~", "~~"), "*",
"~*"), "?", "~?") 
      'Check if there are no more then 8192 areas(limit of
areas) 
      CCount = 0 
      On Error Resume Next 
      CCount =
My_Range.Columns(1).SpecialCells(xlCellTypeVisible) _ 
               .Areas(1).Cells.Count 
      On Error GoTo 0 
      If CCount = 0 Then 
          MsgBox "There are more than 8192 areas for the
value : " & cell.Value _ 
               & vbNewLine & "It is not possible to copy the
visible data." _ 
               & vbNewLine & "Tip: Sort your data before you
use this macro.", 
                 vbOKOnly, "Split in worksheets" 
      Else 
          'Add a new worksheet 
          Set WSNew =
Worksheets.Add(After:=Sheets(Sheets.Count)) 

          On Error Resume Next 
          WSNew.Name = cell.Value 
          If Err.Number > 0 Then 
              ErrNum = ErrNum + 1 
              WSNew.Name = "Error" & Format(ErrNum, "0000") 
              Err.Clear 
          End If 
          On Error GoTo 0 
          'Copy the visible data to the new worksheet 
          My_Range.SpecialCells(xlCellTypeVisible).Copy 
          With WSNew.Range("A1") 
              ' Paste:=8 will copy the columnwidth in Excel
2000 and higher 
              ' Remove this line if you use Excel 97 
              .PasteSpecial Paste:=8 
              .PasteSpecial xlPasteValues 
              .PasteSpecial xlPasteFormats 
              Cells.Select 
              Application.CutCopyMode = False 
              Selection.AutoFilter 
          End With 
      End If 
      'Show all data in the range 
      My_Range.AutoFilter Field:=FieldNum 
Next cell
'Delete the ws2 sheet
On Error Resume Next
Application.DisplayAlerts = False
.Delete
Application.DisplayAlerts = True
On Error GoTo 0
End With
'Turn off AutoFilter
My_Range.Parent.AutoFilterMode = False
If ErrNum > 0 Then

MsgBox "Rename every WorkSheet name that start with ""Error_"" manually"
_ 
       & vbNewLine & "There are characters in the name that
are not allowed" _ 
       & vbNewLine & "in a sheet name or the worksheet
already exist." 
End If
'Restore ScreenUpdating, Calculation, EnableEvents, ....
My_Range.Parent.Select
ActiveWindow.View = ViewMode
With Application
.ScreenUpdating = True
.EnableEvents = True
.Calculation = CalcMode
End With
End Sub
Function LastRow(sh As Worksheet)
On Error Resume Next
LastRow = sh.Cells.Find(What:="*", _ 
                          After:=sh.Range("A1"), _ 
                          Lookat:=xlPart, _ 
                          LookIn:=xlValues, _ 
                          SearchOrder:=xlByRows, _ 
                          SearchDirection:=xlPrevious, _ 
                          MatchCase:=False).Row 
On Error GoTo 0
End Function
Topic 861
Subject

Find both duplicates in the same ROW VBA
Question
Somehow after few days of googleing I didn't find any satisfying answer. I
have to find duplicates in the same column and copy them both (or more) to the
new sheet to show where are the issues.
The only way I managed to do that was
For i = 2 To lastCell
If dataArray(i, 3) <> "" Then 
      For j = i + 1 To lastCell 
          If dataArray(i, 3) = dataArray(j, 3) Then 
          results.Range("A" & k & ":" & lastCol & k).Value =
checkbook.Range("A" & i & ":" & lastCol & i).Value ' 
          results.Range(commentAddress & k).Value =
"Duplicate ID" 
          k = k + 1 
          results.Range("A" & k & ":" & lastCol & k).Value =
checkbook.Range("A" & j & ":" & lastCol & j).Value 
          results.Range(commentAddress & k).Value =
"Duplicate ID" 
          k = k + 1 
          End If 
      Next j 
End If
Next I
But this is taking too long! I found that dictionary could be very helpful but
don't really know how to use this - and it only shows the SECOND value (I
need both)
So are there any other solutions to find duplicates? I need the fastest one as the
file I am working on has 100K+ rows (loop in a loop is killing me) Answer
You could try something similar to this to recreate the column with blanks
replacing the duplicate values. Then you can just filter on blank values in the
column to find which values or IDs are duplicates. Or write a formula that

loops through column and collects addresses of cells that are empty.
=IF(A1="";"";IF(COUNTIF(A1:A100;A1)=1;A1;""))
Replace A1:A100 with the range your data occupy, or the whole column if you
prefere.
Topic 862
Subject
Filter text in Excel
Question
I have a list of clients in excel together with their addresses and contacts. I
want to separate company names of people's names. e.g. names with "LTD" or
"PLC" are company names. I want to filter them separately in another sheet.
How do i do that?
Topic 863
Subject
Calling a sub in a Sheet
Question
I have a problem displaying the contents of the Combo box content in the user
Form. I have added a command button in the worksheet. Every time the user
click on the command button, the user form should be displayed and its combo
box should also display the added Items into it. This is my code every time the
user click the button
Private Sub formShow_Click()
form.Show
UserForm_Initialize
End Sub
While this is the content of the Sub UserForm_Initialize which in the Module1:
Public Sub UserForm_Initialize()
With atForm.ComboBoxType1 

      .AddItem "ATM" 
      .AddItem "Cash" 
      .AddItem "Check" 
End With
With atForm.ComboBoxTypeP2 
      .AddItem "ATM" 
      .AddItem "Cash" 
      .AddItem "Check" 
End With
End Sub
It shows the form but the combo box content is blank. Thank you!
Best Regards
Topic 864
Subject
Error check doesn't work for batch run in VBA Excel
Question
I have a VBA-code which runs a batch file (bat file). The code runs without
error when I run the batch file directly, and I get the correct result:
Public Sub RunSASCodeViaBatFile() 
   Dim cmdString As String: cmdString = batPath & batFile & "
" & SASFilePath & " " & SASFile & " " & SASOutputPath & " " &
YearMonth 
   Dim wsh As Object 
   Set wsh = VBA.CreateObject("WScript.Shell") 
   Dim waitOnReturn As Boolean: waitOnReturn = True 
   Dim windowStyle As Integer: windowStyle = 2 
   wsh.Run cmdString, windowStyle, waitOnReturn 

End Sub
However, when I try to run the script with an error check method like below,
then the message box gives a message like:
Program exited with error code 1001
Public Sub RunSASCodeViaBatFile() 
   Dim cmdString As String: cmdString = batPath & batFile & "
" & SASFilePath & " " & SASFile & " " & SASOutputPath & " " &
YearMonth 
   Dim wsh As Object 
   Set wsh = VBA.CreateObject("WScript.Shell") 
   Dim waitOnReturn As Boolean: waitOnReturn = True 
   Dim windowStyle As Integer: windowStyle = 2 
   Dim errorCode As Integer 
   errorCode = wsh.Run(cmdString, windowStyle, waitOnReturn) 
   If errorCode <> 0 Then 
       MsgBox "Program exited with error code " & errorCode &
"." 
   End If 
End Sub
I get that message, but I also get "the correct result" as I want in anyway. So it
seems like that if-loop gives that message in anyway. It is a bit difficult to
understand, because I have seen many other other people who used the same
method; like example
Topic 865
Subject
VBA Check if cells of a row consist of same text continously
Question
i have a row of 24 cells having value Null and "ON". i want to write a macro
to check this row if it contains 2 block of 6 "ON" continuously. Please help
Answer
You didn't specify if there needed to be any empty cells in between the blocks,

or if more than 2 blocks of 6 consecutive ONs fulfills the criteria aswell. I
have assumed only 2 blocks fulfills the criteria and that the two blocks can be
after each other, i.e. 12 ONs in a row.
Function CheckForOn()
Dim myRange
Dim numberOfONs
Dim numberOfBlocks
Set myRange = Worksheets("Sheet2").Range("A1:X1") numberOfONs = 0
numberOfBlocks = 0
For Each cell In myRange 
      If cell.Value = "ON" Then 
          numberOfONs = numberOfONs + 1 
          If numberOfONs = 6 Then 
              numberOfBlocks = numberOfBlocks + 1 
              numberOfONs = 0 
          End If 
      Else 
          numberOfONs = 0 
      End If 
Next cell
If numberOfBlocks = 2 Then
CheckForOn = True
Else
CheckForOn = False
End If
End Function
Topic 866
Subject
Merging one field on two different fields

Question
In my database I have one table with multiple fields and two of them: a and b
are just numbers that do not give any information. In another table, I have the
definition of these two fields but the definitions are in the same table and same
field. Here is how the second table is constructed:
TNAME: what the code is used for (a or b) TCODE: numbers used in the first
table
HEADING: defintion of the numbers
I'm trying to merge fied "a" on TCODE where TNAME is "a" and to merge
field "b" on TCODE where TNAME is "b". I tried to create two temporary
table so I could work on new fields with different names but once the table is
cretated I cannot drop it (I tried different wyas but nothing work).
Does anyone know how I could solve this problem? I'm working in MS Excel
with my databases.
Thanks!
Answer
Sorry for the unclear description.
So my table A contains two fields:
XUSRCAT_CIG which has a code that define the kind of customer it is
XUSRREP_CIG which has a code that indicates the reprensative of the
customer.
My table B is constructed this way:
Definition_table
As you can see, this table contains the following fields:
TNAME: name of the group
TCODE: the number linked to the two other fields in table A HEADING: the
defintion of the TCODE
The matter is that I need to link both fields of table A on the field TCODE of

table B but based on the criteria of field TNAME.
So: XUSRCAT_CIG = TCODE where TNAME = 'CLICAT' and
XUSRREP_CIG = TCODE where TNAME = 'REPRES'
I hope it is clear and thnaks for help
Topic 867
Subject
How to clear existing figure in excel using matlab?
Question
I have an excel that is connected to matlab through active server. I am
generating a graph via matlab and export it to excel. However, I need to clear
the existing graphs first so it won't overwrite and make a stacked of graphs.
My idea is to find the existing graph first, and clear it. But, so far, I still don't
know how to do it.
Anyone knows? I am open to any suggestions.
Thank you so much!
Elizabeth
edit
this is a matlab script
Excel = actxserver ('Excel.Application'); filename = 'xxx'
invoke(Excel.Workbooks,'Open',filename); Sheets =
Excel.ActiveWorkBook.Sheets;
Sheets.Item('Graphs').Activate;
ActiveSheets = Excel.Activesheet;
plotpie(cost,init_stage)
Shapes = ActiveSheets.Shapes;
ActiveSheets.Shapes.AddPicture('location', 0, 1, 400, 325, 345, 230)
Topic 868

Subject
Can we perform graph action by opening any excel file from any android
device
Question
I would like to know if it is possible to change graph values of any excel sheet
automatically when the user gives input in the same sheet on Android.
It is working fine on PC, and I am able to open the file in some android apps
but it is not performing the input action.
Topic 869
Subject
How to display the file name from the path name in combobox
Question
I have written a code which will extract all the sub folders which is present
inside a particular folder/Directory. Here is the code.
ComboBox10.List = Split(CreateObject("wscript.shell").exec("cmd /c Dir
""C:\Users\inkapb\AppData\Local\Temp\EPC AutoTool\Projects\*."" /b
/s").stdout.readall, vbCrLf)
Here in the above code all the sub folder path is getting populated instead of
the subfolder name. Can any one help me to achieve my requirement Answer
I have a different piece of suggestion to serve your requirement.
Sub AddHighPlusOne()
Dim cb As ComboBox
Set cb = ActiveSheet.ComboBox1
Dim objFS As Object
Dim folders As Object
Set objFS = CreateObject("Scripting.FileSystemObject") Set folders =
objFS.GetFolder(Application.ActiveWorkbook.Path) cb.Clear
For Each Folder In folders.SubFolders
cb.AddItem (Folder.Name)
Next

End Sub
Answer
In your command button code you could use something like this.
When I use this, just the folder names show up, not the path.
I used C:\ as the main folder in this example.
Private Sub CommandButton1_Click()
Dim fs, f, f1, fc, s
Dim folderspec
folderspec = "C:\"
Set fs = CreateObject("Scripting.FileSystemObject") Set f =
fs.GetFolder(folderspec)
Set fc = f.SubFolders
ComboBox1.Clear
For Each f1 In fc
ComboBox1.AddItem f1.Name
Next f1
ComboBox1.Activate
Application.SendKeys "^{F4}"
End Sub
Once clicked this will be the result
When you do select a sub-folder, then second combobox will show the files.

Private Sub ComboBox1_Change()
Dim fs, f, f1, fc, s
Dim folderspec
folderspec = "C:\" & ComboBox1
Set fs = CreateObject("Scripting.FileSystemObject") Set f =
fs.GetFolder(folderspec)
Set fc = f.Files
ComboBox2.Clear
For Each f1 In fc
ComboBox2.AddItem f1.Name
Next f1
ComboBox2.Activate
Application.SendKeys "^{F4}"
End Sub
Those results will look like this
Answer
You could try a Replace() function with the full path name. Hence:
pathName = "C:\Users\inkapb\AppData\Local\Temp\EPC AutoTool\Projects\"
ComboBox10.List = Split(Replace(CreateObject("wscript.shell").exec("cmd
/c Dir ""C:\Users\inkapb\AppData\Local\Temp\EPC AutoTool\Projects\*."" /b
/s").stdout.readall, vbCrLf), pathName, "")
Topic 870
Subject
Filter excel sheet based on dropdown selection

Question
I'd like to filter an Excel sheet by selecting from a dropdown menu.
The worksheet layout looks like this:
___________|Product1|Product2|Product3|Product4| 
Shop1      |    X     |     X    |          |          | 
Shop2      |          |     X    |     X    |          | 
Shop3      |    X     |          |          |     X    | 
         |          |          |          |          | 
Ingredient1|          |     X    |          |     X    | 
Ingredient2|    X     |     X    |     X    |     X    | 
Ingredient3|    X     |          |     X    |          | 
I'd like to have a dropdown with all shops and depending on the selection only
the products marked with an 'X' should be visible (all other columns should be
hidden).
Played around with data validation lists but couldn't achieve more than a
normal dropdown with the shop names listed inside. Answer
For people coming at this site seeking for the same answer, I did it like this
now and it works perfectly fine for me. May not be the best solution but at least
it's functional:
Created a data validation list with all shops (Shop1, Shop2, Shop3) and a
'Show all' entry. Depending on the selection I call a different macro. To do this
I added this code to the worksheet (right-click on the worksheet name -> view
code):
Private Sub Worksheet_Change(ByVal Target As Range) '$F$2 points to the
field containing the data validation list If Target.Address(True, True) = "$F$2"
Then
Select Case Target 
      'this matches against the shop name (string) in the
data val. list 
      Case "Shop1" 

          'this is the macro name 
          Call Shop1 
      Case "Shop2" 
          Call Shop2 
      Case "Shop3" 
          Call Shop3 
      Case "Show all" 
          Call ShowAll 
      Case Else 
          'Do nothing 
End Select
End If
End Sub
And created 3 different macros named Shop1, Shop2, Shop3 and ShowAll
with the following code:
'name your function
Sub Shop1()
Dim LastColumn As Long, x As Long
LastColumn = ActiveSheet.Cells(3, Columns.Count).End(xlToLeft).Column
'begins to count at column number 2
For x = 2 To LastColumn
'counts all X in the row number 7
If UCase(Cells(7, x).Value) = "X" Then Columns(x).Hidden = False
Else
Columns(x).Hidden = True
End If
Next
End Sub
I just changed the row number to the matching one in the worksheet for every
macro (Cells(7, x).Value) For the 'show all' event I just inserted this:
Sub ShowAll()
For x = 4 To 40
Columns(x).Hidden = False

Next
End Sub
Topic 871
Subject
Column chart with time on x-axis
Question
I have hourly data that I want plotted.
The time values are at 00:30, 01:30, 02:30, etc., and I want to have "whole
hours" as axis labels, like in the following figure (where this is just another
scatter plot instead of a column chart):
So thus, the range is from 00:00 to 24:00 (the next 00:00), and the values are
plotted in-between the labels.
Now, I want to make a stacked column chart with range 00:00 to 24:00, with
the bars plotted in-between the labels, and overlayed with another scatterplot.
The scatterplot plots just fine, but the column chart uses the time values as text.
The only other option in "Axis options", is date, which does not work, since
my data is in time (hourly) format.
Screenshots
Column chart with x-labels as text. See the scatterplot is fine, but squished,
since the column chart's labels are not the same
Column chart with x-labels as date. Broken.
How can I go about this?
Topic 872
Subject
Excel - function in a MEDIAN-function
Question
I want to use the command MEDIAN in Excel but I want to make the program
so that it takes the value in a column from 1 to a row that depens on a

calculation in a different column and row.
For example:
=MEDIAN(G1:G(L1))
where L1 is a calculted value
The calculated value in L1 will vary and therefore this procedure will repeat
itself for many couple of times. Therefore, I don't want to write the number (of
G) direct into the MEDIAN-function.
Please help me! :)
Answer
If I understand it corerctly you want to write a formula that calculate the
median for a specific column, but you only want to calculate it from values in
the range G1:X, where X is another cell in column G, which you calculate
based on some criteria. If so then this would solve it:
=MEDIAN(G1:(INDIRECT(ADDRESS(X;7))))
Where X is your formula that calculates which row, i.e. cell is the last to be
included in the column G.
Answer
Try this formula.
=MEDIAN($G$1:(INDIRECT(ADDRESS($L$1,COLUMN($G$1)))))
Topic 873
Subject
Launching WPF modeless dialog from Excel
Question
I want to launch a custom Find and Replace modeless WPF dialog from Excel.
I'm able to launch a WPF window as a modeless dialog, and used
WindowInteropHelper to assign Excel as parent for the dialog. The issue what
i'm facing is, if I enter text in dialog textbox, it is getting entered in the active

cell in Excel. I found solution for this issue in the link "WPF modeless dialog
from MS Excel add-in"
Link is suggesting to create separate thread for the dialog. If I do so, then Excel
is not displaying the selection in the worksheet when focus is in dialog. I want
to mimic the Excel Find and Replace dialog behavior, that is, though the focus
is in Excel Find and Replace dialog, the selection in the worksheet should be
displayed. If I'm not using separate thread for the WPF dialog creation(creating
dialog in the main thread) I could able to achieve the selection behavior as
expected, but keyboard inputs are not reflecting in the dialog.
Please help me in resolving the keyboard input issue with the modeless WPF
dialog without the usage of a separate thread for dialog creation.
Using C# .Net 4.0
Thanks in advance.
Topic 874
Subject
Excel VBA - How to convert an Object into a String
Question
I like to convert an Object into a string. I found this topic but I can not get it to
work in Excel 2010 ("Cast.xxx", "CArray()" and "Array()" seems to be
unknown to Excel?)
I know how to convert a variant e.g. "toString = CStr(x)" but not how to do it
the best way for an object
Function toString(ByVal x As Variant) As String If TypeOf x Is Object Then
toString = ???
Else
toString = CStr(x)
End If
End Function

any suggestions?
Answer
Are you referring to the IFormattable interface. For example in VB.NET?
Excel VBA isn't a language that will provide you with a ToString method since
it doesn't support inheritance.
In your example, you are simply converting whatever the variant is to a string,
but an object in VBA wont support this directly.
If you have an external COM object, this would need to be exposed in the
interface to access this method to call it from VBA.
For your own classes, you could implement your own IFormattable interface
for your objects, but you would have assign to that interface before being able
to call the objects ToString method - possible with a helper method. You could
of course just supply a ToString method for every class which will through the
class interface, but if you want to include this functionality for all objects, then
an interface is probably the way to go.
Hope that helps.
Topic 875
Subject
How to call the textbox on the form in a module?
Question
I'm having trouble calling the textbox on the form inside a module. Every time I
run it, it throws a Compile Error: Method or data not found. This is my code:
Sub formInitialize()
ThisWorkbook.txtDate.Value = ""
End Sub
Thank you for your great help!
Answer

Thank you for your time. I have already figured out my problem. I should not
be using the ThisWorkbook, I should be calling the formName. The code is as
follows:
Sub formInitialize()
formName.txtDate.Value = ""
End Sub
Thank's again!
Topic 876
Subject
Perl 'can't locate object method “worksheets” via package
“Spreadsheet::ParseExcel::Workbook”'
Question
I am trying to open two Excel .xls files for comparing. I included
use Spreadsheet::ParseExcel;
then, I continue my code as follow:
my $parser_r = Spreadsheet::ParseExcel->new(); my $resultbook = $parser_r-
>parse($absPathResult); my $parser_i = Spreadsheet::ParseExcel->new(); my
$resultideal = $parser_i->parse($absPathIdeal);
@worksheetsListResult = $resultbook->worksheets(); @worksheetsListIdeal
= $resultideal->worksheets();
the first error I encountered was "can't locate object method "parser"...", but
that was solved by changing "parser" to "Parser".
When I execute the script again, I am getting the error: can't locate object
method "worksheets" via package "Spreadsheet::ParseExcel::Workbook".
I am running the script in Linux, Perl v5.8.5.
Any idea what is the possible problem here? I am new to Perl language. All

comments are very much appreciated.
PS: When I run the similar code in Windows, everything is working perfectly.
Answer
The workbooks() method was added in 0.43, six years ago. Since your version
of Perl is rather old (11 years), it's likely your version of
Spreadsheet::ParseExcel is also rather old.
You can check with:
perl -MSpreadsheet::ParseExcel -wle 'print
$Spreadsheet::ParseExcel::VERSION'
In general, don't use the web documentation for Perl modules unless you're
keeping up to date. It probably won't be for your installed version. Instead use
perldoc.
Topic 877
Subject
Removing duplicate value from excel file using vbs
Question
I am trying to remove duplicate value from column U in excel file, while all
other columns are empty. Since i am using UsedRange function i am
encountering a runtime error. I am using the following code:
Set objXL = CreateObject("Excel.Application") Set objWB =
objXL.Workbooks.Open(basedir & ss) Set objWS =
objWB.Worksheets("Report 2") objWB.Saved = True
objWB.ActiveSheet.UsedRange.RemoveDuplicates Array(20), 1
objWS.Rows("1:2").Delete
objWS.Columns("A:T").Delete
call objWB.SaveAs(temp_file_bu2,24)
objWB.Saved=True
I tried using Range function also for choosing column and it is not working. If

all column under range of UsedRange are filled with duplicate value only the
function is working. Answer
If all other columns are empty replace this;
objWB.ActiveSheet.UsedRange.RemoveDuplicates Array(20), 1
with this
objWB.ActiveSheet.UsedRange.RemoveDuplicates Columns:=1,
Header:=xlYes
Answer
Replace this;
objWB.ActiveSheet.UsedRange.RemoveDuplicates Array(20), 1
with this
objWB.ActiveSheet.UsedRange.RemoveDuplicates Columns:=21,
Header:=xlYes
Topic 878
Subject
VBA on arrays runs too slow
Question
The file I work on contains about 80,000 rows
I need to perform some basic checks and copy the results to the new sheet. The
whole thing takes about 8 minutes and I think its too long, is there any faster
way?
Application.Calculation = xlCalculationManual Application.ScreenUpdating =
False
lastCell = checkbook.UsedRange.Rows.Count
ReDim dataArray(2 To lastCell, 1 To 4)

For i = 2 To lastCell
dataArray(i, 1) = checkbook.Range(streetAddress & i).Value dataArray(i, 2) =
checkbook.Range(cityAddress & i).Value dataArray(i, 3) =
checkbook.Range(stateAddress & i).Value dataArray(i, 4) =
checkbook.Range(postCodeAddress & i).Value Next I
For i = 2 To lastCell
If dataArray(i, 1) = "" Then 
      results.Range("A" & results.UsedRange.Rows.Count + 1 &
":" & lastCol & results.UsedRange.Rows.Count + 1).Value =
checkbook.Range("A" & i & ":" & lastCol & i).Value 
      results.Range(commentAddress &
results.UsedRange.Rows.Count).Value = "BLANK Street" 
End If
If dataArray(i, 2) = "" Then 
      results.Range("A" & results.UsedRange.Rows.Count + 1 &
":" & lastCol & results.UsedRange.Rows.Count + 1).Value =
checkbook.Range("A" & i & ":" & lastCol & i).Value 
      results.Range(commentAddress &
results.UsedRange.Rows.Count).Value = "BLANK City" 
End If
If dataArray(i, 3) = "" Then 
      results.Range("A" & results.UsedRange.Rows.Count + 1 &
":" & lastCol & results.UsedRange.Rows.Count + 1).Value =
checkbook.Range("A" & i & ":" & lastCol & i).Value 
      results.Range(commentAddress &
results.UsedRange.Rows.Count).Value = "BLANK State" 
End If
If dataArray(i, 4) = "" Then 
      results.Range("A" & results.UsedRange.Rows.Count + 1 &
":" & lastCol & results.UsedRange.Rows.Count + 1).Value =

checkbook.Range("A" & i & ":" & lastCol & i).Value 
      results.Range(commentAddress &
results.UsedRange.Rows.Count).Value = "BLANK PostCode" 
End If
Next i
Application.Calculation = xlCalculationAutomatic
Application.ScreenUpdating = True
Answer
I feel your pain, I had a sheet like that as well. Working cell by cell will be
slow.
Try
1. Can you try copy the whole Sheet not cell by cell so you have a backup
before processing your blanks.
Some of my old code that you can use to modify, copy whole range in one go
and put values in a brand new sheet:
Dim s1 As Worksheet
Dim s2 As Worksheet
Set s1 = ThisWorkbook.Sheets(strSourceSheet) ' What is range of source data
lastrow = s1.UsedRange.Rows.Count
lastcol = s1.UsedRange.Columns.Count
' copy across
s1.Range(s1.Cells(1, 1), s1.Cells(lastrow, lastcol)).Copy
' Create new empty worksheet for holding values Set s2 = Worksheets.Add
s2.Range("A1").PasteSpecial Paste:=xlPasteValuesAndNumberFormats,
SkipBlanks:=True
Application.CutCopyMode = False

' You can rename this s2 sheet
2) Then try SEARCH for your blank cells in each column and do a REPLACE.
(Use Macro recorder to help get the syntax).
Some sample code below, you will need to clean this up by setting the range
instead of using a select on whole column (which will add to blanks below
your last row).
' go through each of your columns. Did street example here
Columns("A:A").Select
Selection.Find(What:="", After:=ActiveCell, LookIn:=xlFormulas, LookAt _
:=xlWhole, SearchOrder:=xlByRows, SearchDirection:=xlNext, MatchCase:=
_ False, SearchFormat:=False).Activate ActiveCell.Replace What:="",
Replacement:="BLANK street", LookAt:=xlWhole _
, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
ReplaceFormat:=False
Hope this helps. You seem to know how to code, but if you are stuck then let
me know.
Answer
I found an answer to the problem
instead of
results.Range(commentAddress & results.UsedRange.Rows.Count)
define for e.g. j and iterate it everytime you add new value to the sheet so
results.Range("A" & k & ":" & lastCol & k ).Value = checkbook.Range("A" &
i & ":" & lastCol & i).Value results.Range(commentAddress & k).Value =
"BLANK Street" k = k + 1
from 8 mins to 5 seconds :)

Answer
As per my Knowledge, a Sheet to sheet Traverse is always a time taking
process.
i would suggest to use an array to save the details of check and then use them
while assigning the values.
results.Range("A" & results.UsedRange.Rows.Count + 1 & ":" & lastCol &
results.UsedRange.Rows.Count + 1).Value = array(Value)
The other recommendation is to identify the blank cells during the array
assignment only and store the locations in the separate array. so directly you
can iterate through only blank values instead of going through all you 80,000
Topic 879
Subject
Excel Nested Function
Question
i'm trying to write an if statement with nested functions that states if a the value
in column d is "CDRN PORTAL PROSPECT" or the date in column m plus 90
days or the date in column l plus 90 days is greater than or equal to the date in
cell x1, then take the dollar value from column w otherwise it is zero.
however, the formula seems to work for some cells but not others. can
someone help? here is the formula as it is written:
=IF(AND($D3="CDRN Portal Prospect",($M3+90)>=X$1,
($L3+90)>=X$1),$W3,0)
Topic 880
Subject
Formula to calculate thickness from size/schedule information in excel
Question
I am new to excel world and trying to learn excel formulas.
I have thickness data against size/schedule in an excel file as below

First column represents the size while the first row is the thickness. I need a
formula to calculate thickness against size/schedule. For example in the above
image if size is 6 and schedule is 10 then thickness should be returned as 3.40.
In short: I need a formula to fill in this below sheet(image below) from the
above sheet (image above)
What I have tried is, I have tried to make a vlookup table (called it Test) for
the image 1's sheet which is the table that contains thickness against
size/schedule and tried to put the vlookup formula like below
=VLOOKUP(L2, Test, 1, FALSE).
But this gives me the column 1 against the entry which will be found, so
definitely this is not the right way, so can some 1 guide me to the right way
here please? Answer
I guess this should work for you
=VLOOKUP(L2, Test, MATCH(O2,Test,0), FALSE).
Topic 881
Subject
Invoking the Activate dialog for sheets
Question
I want to invoke the Activate dialog for sheets in a workbook such as below.
This dialog can be called manually by right clicking on the arrow button at the
bottom left of Excel (2013).
I tried this:
Application.Dialogs(xlDialogActivate).Show
But instead of showing the list of sheets, it shows the list of open workbooks:
How do I call the Activate dialog for sheets? Answer
You could create your own dialog box if you want. Create a userForm and

populate it with the names of the Worksheets upon activation. You can see what
the user selected through the selected function, e.g.
ListBox1.Selected(i)
You can then call a sub with the name of the Sheet and activate it, e.g.
Sub ChangeSheet(SheetName)
Worksheets(SheetName).Activate
End Sub
Answer
An alternative is to show the Sheet Command bar:
Sub ShowSheets()
Application.CommandBars("Workbook tabs").ShowPopup End Sub
Content salvaged from comments by Scott Holtzman and Davesexcel.
Topic 882
Subject
Pivot Table Error 1004 when adding Fields
Question
I have this macro that creates a pivot table from a ranged data ("PvtData"). I
keep getting run time error 1004 (Application defined or Object defined error)
when the code is trying to add PivotFields.
Below is a portion of the code;
Workbooks(PivotFile).PivotCaches.Create(SourceType:=xlDatabase,
SourceData:= _
"PvtData", Version:=xlPivotTableVersion14).CreatePivotTable _
TableDestination:="PvtResult", TableName:="PivotTable1", DefaultVersion _
:=xlPivotTableVersion14

'Work up to here
With ActiveSheet.PivotTables("PivotTable1").PivotFields("COB")
.Orientation = xlColumnField
.Position = 1
End With
With ActiveSheet.PivotTables("PivotTable1").PivotFields("Product")
.Orientation = xlRowField
.Position = 1
End With
With ActiveSheet.PivotTables("PivotTable1").PivotFields("Book")
.Orientation = xlRowField
.Position = 2
End With
I've tried recording the macro, which gives the same code line.
Changing the table destination to empty ("") does not help. Answer
After adding the fields try your piece of code as it is.
pvtTable.AddFields("COB")
With pvtTable.PivotFields("COB")
.Orientation = xlColumnField
.Position = 1
End With
Topic 883
Subject
How to put java results into a file (i.e. Excel)
Question
So the code below when ran lists all the url links to a website as well as the
page's url that each set of links come from. So how would I be able to store

these links somewhere like say an Excel file or any type of file if it can't be
excel?
public class Crawler {
/**
@param args the command line arguments
@throws java.io.IOException */ public static void main(String[] args)
throws IOException {
Set<String> visitedUrls = new HashSet<>(); String url =
"http://www.claflin.edu";
crawl(url, visitedUrls);
private static void crawl(String url, Set<String> visited) throws IOException {
if(url.isEmpty() || visited.contains(url)) {
return;
}
print("Fetching %s...", url);
visited.add(url);
Document doc;
try {
doc = Jsoup.connect(url).timeout(10000).get(); } catch
(UnsupportedMimeTypeException e) {
System.out.println("Unsupported Mime type. Aborting crawling for URL: " +
url); return;
} catch (MalformedURLException e) {
System.out.println("Unsupported protocol for URL: " + url); return;
} catch (HttpStatusException e) {
System.out.println("Error (status=" + e.getStatusCode() + ") fetching URL: " +
url); return;
} catch (IOException e) {

System.out.println("Timeout fetching URL: " + url); return;
}
Elements media = doc.select("[src]");
Elements imports = doc.select("link[href]"); Elements links1 =
doc.select("a[href$=\".pdf\"]"); Elements links = doc.select("a[href]");
print("\nOther Links: (%d)", links1.size()); for (Element link: links1){
print(" * a: <%s> (%s)", link.attr("abs:href"), trim(link.text(), 35)); }
print("\nLinks: (%d)", links.size());
for (Element link: links)
{
print(" * a: <%s> (%s)", link.attr("abs:href"), trim(link.text(), 35)); }
for(Element link : links) {
String href = link.attr("abs:href"); URL hrefURL = null;
try {
hrefURL = new URL(href);
} catch (MalformedURLException e) {
//nothing
}
if(hrefURL != null && hrefURL.getHost().equals(new URL(url).getHost())) {
crawl(href, visited);
}
}
}
private static void print(String msg, Object... args) {
System.out.println(String.format(msg, args)); }
private static String trim(String s, int width) { if (s.length() > width)

return s.substring(0, width-1) + "."; else
return s;
}
}
Answer
You could make use of Apache POI. It supports creation of Excel files (xsl,
xslx). Here you can finde more information about the used XSSF and HSSF
format. Code examples can be found here
Topic 884
Subject
How to wait for test execution to finish in Selenium Webdriver?
Question
I have a test framework in Selenium Java where I run the test as a TestNG
project.
Now, I have flags set in excel sheet as Y or N where it reads every Y row and
gets the corresponding data, logs in with that data and opens up an .exe file.
The problem I have is as soon as the .exe opens up, the code reads the next Y
flag and reads the data. What i want to so is to read the first Y from excel,,
execute the test case and then read the next Y flag and so on.
Any suggestion would be of great help. Thanks!!
Topic 885
Subject
VBA conditionally run a macro?
Question
Is it possible to have multipe buttons, lets say 'Button 1' and 'Button 2' run the
same macro but yield a different result based on the button that was pressed?
For instance when I press button 1 I want it to go to a website, load data and

put it on to Sheet 1. But when I press button 2, it goes to the same site and
loads it to Sheet 2.
I know I can have multiple instances of the same macro (with different names)
however I am hoping to simplify the code and prevent it from being overly
complicated.
Thanks in advance.
Answer
Create one sub to do the work and pass the sheetname as an argument to that
sub. I did it with a string variable, but you can do it with a worksheet variable
as well.
Sub Button1_Click()
LoadWebsiteToSheet "Sheet1"
End Sub
Sub Button2_Click()
LoadWebsiteToSheet "Sheet2"
End Sub
Sub LoadWebsiteToSheet(sName as String)
'... code to load website to Worksheets(sName)
End Sub
Answer
If you are using a Forms button you can assign the same macro and use
Application.Caller to return the name/id of the calling button.
Sub Test()
MsgBox Application.Caller & " was pressed" End Sub

Answer
I was leaning more towards brettdj's solution as well
If you assign the same macro to many buttons, you will get different results
based on the button name.
You could name the button to the sheet you wanted. Practice with this. Add
several buttons and assign this code to them. Click each button to see what
happens.
Sub GetButtonName()
Dim Btn As String
Btn = ActiveSheet.Shapes(Application.Caller).Name MsgBox Btn
End Sub
Topic 886
Subject
Outlook VBA will not write to Excel doc
Question
From a number of posts here on stack overflow, I created an Outlook VBA that
should pull information from the body of a selected Outlook email, and put that
information into a pre-created Excel workbook matching lines from the email
to headers of columns in the Excel doc.
However, I am running into an issue where the information is not being written
into the Excel doc.
I went through and put in a couple of MsgBox "Here" statements, and it ran
through the entire code.
Could the issue be with the selection process for the emails? I ran a different
VBA with a different selection process (force setting the selection rather than
relying on Outlook) and it worked fine, so I am not sure.

The Excel workbook is not locked or protected.
EDIT
Here is what the email body looks like:
Name
Do you currently reside in the United States?
Address
City
State
Zip Code:
Phone
Email
Citizenship
Grade
Essay Word Count: School / Organization Name: Teacher Name: Teacher
Email: Is your school / sponsoring organization based in the United
States? School / Organization Address: School / Organization City:
School / Organization State: School / Organization Zip Code: School /
Organization Phone: School / Organization Email: How did you find out
about this contest? Essay Document:
The issue I am having is that the code runs with no bugs or errors, but when I
open the excel sheet, no information has been brought over from Outlook; i.e.
the cells are blank. I was wondering if it was an issue with how I was
selecting emails.
I am also wondering if the paragraph section is working like I want it to, but
that is outside of the scope of the question I asked so I am not expecting an
answer.
Here is the full code:
Option Explicit
Sub CopyToExcel()
Dim xlApp As Excel.Application
Dim xlWB As Excel.Workbook
Dim xlSheet As Excel.Worksheet

Dim olItem As MailItem
Dim vText As Variant
Dim vPara As Variant
Dim sText As String
Dim vItem As Variant
Dim i As Long
Dim aa As Long
Dim rCount As Long
Dim sLink As String
Dim bXStarted As Boolean
Const strPath As String = "C:\Users\labuser\Desktop\studentinfo.xlsx" 'the path
of the workbook'
If Application.ActiveExplorer.Selection.Count = 0 Then MsgBox "No Items
selected!", vbCritical, "Error" End If
On Error Resume Next
Set xlApp = GetObject(, "Excel.Application") If Err <> 0 Then
Application.StatusBar = "Please wait while Excel source is opened ... " Set
xlApp = CreateObject("Excel.Application") bXStarted = True
End If
On Error GoTo 0
'Open the workbook to input the data
Set xlWB = xlApp.Workbooks.Open(strPath) Set xlSheet =
xlWB.Sheets("Sheet1")
'Process each selected record
For Each olItem In Application.ActiveExplorer.Selection sText = olItem.Body
vText = Split(sText, Chr(13))
vPara = Split(sText, Chr(13))
'Find the next empty line of the worksheet rCount =
xlSheet.UsedRange.Rows.Count rCount = rCount + 1
'Check each line of text in the message body For i = UBound(vText) To 0 Step
-1
If InStr(1, vText(i), "Name:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("A" & rCount) = Trim(vItem(1)) 

End If
If InStr(1, vText(i), "Do you current reside in the United States?") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("B" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Address:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("C" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Address 2:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("D" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "City:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("E" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "State:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("F" & rCount) = Trim(vItem(1)) 
End If

If InStr(1, vText(i), "Zip Code:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("G" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Country:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("H" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Phone:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("I" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Email:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("J" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Citizenship:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("K" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Grade:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 

      xlSheet.Range("L" & rCount) = Trim(vItem(1)) 
End If
If InStr(1, vText(i), "Essay Word Count:") > 0 Then 
      vItem = Split(vText(i), Chr(58)) 
      xlSheet.Range("M" & rCount) = Trim(vItem(1)) 
End If
Next i
For aa = UBound(vPara) To 0 Step -1 If InStr(1, vPara(aa), "School /
Organization Name: ") > 0 Then 
      vText = Split(vPara(aa), Chr(58)) 
      xlSheet.Range("N" & rCount) = Trim(Replace(vItem(1),
"School / Organization Name: ", "")) 
      xlSheet.Range("O" & rCount) = Trim(Replace(vText(2),
"Teacher Name: ", "")) 
      xlSheet.Range("P" & rCount) = Trim(Replace(vText(3),
"Teacher Email: ", "")) 
      xlSheet.Range("Q" & rCount) = Trim(Replace(vText(4), "
Is your school / sponsoring organization based in the United
States?", "")) 
      xlSheet.Range("R" & rCount) = Trim(Replace(vText(5), "
School / Organization Address: ", "")) 
      xlSheet.Range("S" & rCount) = Trim(Replace(vText(6), "
School / Organization City: ", "")) 
      xlSheet.Range("T" & rCount) = Trim(Replace(vText(7), "
School / Organization State: ", "")) 
      xlSheet.Range("U" & rCount) = Trim(Replace(vText(8), "
School / Organization Zip Code: ", "")) 
      xlSheet.Range("V" & rCount) = Trim(Replace(vText(9), "
School / Organization Phone: ", "")) 
      xlSheet.Range("W" & rCount) = Trim(Replace(vText(10), "
School / Organization Email: ", "")) 
End If
Next aa
xlWB.Save

Next olItem
xlWB.Close SaveChanges:=True
If bXStarted Then
xlApp.Quit
End If
Set xlApp = Nothing
Set xlWB = Nothing
Set xlSheet = Nothing
Set olItem = Nothing
End Sub
Topic 887
Subject
COUNTIFS in a spreadsheet while ignoring duplicates in a separate column
Question
I'd like to find how to use the COUNTIFS function in excel to count the rows in
a spreadsheet while ignoring duplicate values in a separate column. Here is a
sample of the data:
     []
I would like to count the number of rows that are "One" on status and "Blue" on
category. However, I only want to count the duplicates for these respective
values in "ID" once.
Here's what I've tried:
=SUM(IF(FREQUENCY($A$2:$A$12,$A$2:$A$12)>0,1))
Same problem as the previous example. - this works for giving me the number
of duplicates in column A, but I can't work any IF statements in effectively.
=IF(B2:B12="One",IF(C2:C12="Blue",SUM(IF(FREQUENCY($A$2:$A$12,$
When I add IF statements in, I get the same number as the earlier formula.

For your copy/pasting pleasure: 
ID     Status  Category 
1423    One     Blue 
1423    One     Blue 
1423    One     Red 
5124    One     Blue 
5124    One     Blue 
2341    Two     Blue 
1111    One     Red 
1212    Two     Red 
1212    One     Blue 
1111    One     Red 
5124    One     Red 
The ideal result would be 3.
Answer
There is a standard COUNTUNIQUE method using SUMPRODUCT and
COUNTIF functions; (e.g. SUMPRODUCT(1/COUNTIF(A2:A12,
A2:A12&"")) ). This can be expanded to include conditions by changing to a
COUNTIFS function but care must be made to ensure that no #DIV/0! error can
occur.
In E4 as a standard formula,
=SUMPRODUCT(((B2:B12="one")*(C2:C12="blue"))/(COUNTIFS(A2:A12,
A2:A12, B2:B12, "one", C2:C12, "blue")+((B2:B12<>"one")+
(C2:C12<>"blue"))))
The numerator of the division operation provides half of the conditional
processing. The COUNTIFS denominator of the division operator must be the
opposite (non-zero) of the numerator when the numerator is zero.
     
Topic 888
Subject
VBA - Array calculation with Function and Loops

Question
I am writing a program in VBA that is acting as a Workforce Management Tool.
In this particular problem I am trying to take a set of numbers (widgets
produced and widget errors) and create a total reject rate --> (Widgets
ErrorsA / (Widgets ProducedA + Widget ErrorsA). Each row needs to have it's
own reject rate pasted at the end of the row.
The data is set up like this: 
                 ProductA  ErrorA  ProductB  ErrorB |
RejectRate 
date1  Name1 Team1     4        2      4         0        
0.16% 
I need to be able to do this calculation through automation. I have very very
basic knowledge with Arrays and with help from another post was able to
create 1 array before which is in my code. Working off of that however I have
been unsuccessful in figuring out how to store these variables in order to do the
necessary calculations.
Could somebody help please?
The steps seem to be: Hold the first production number in a variable x, hold
the second production number in a variable y and run the equation (y/(x+y).
Hold the answer in an array. Then step 2 over to the next pair and repeat. At
the end, average all the numbers that are stored in the array and paste it at the
end of the row.
Do this for each row.
We also need to keep in mind that mathematically we cannot divide by zero,
and in these numbers there will be zeros in the production variable to contend
with (the rejects being zero should not be an issue).
Here is my code. I have made a note to the area that I am stuck on. Thanks!
Sub
InsertColumnsAndFormulasUntilEndOfProductivityTable_MakeProductivityNu

With Sheet6
Set EmployeesRange = .Range("A1", .Range("B1").End(xlDown)) End With
With Sheet1
Set ActivityRange = .Range("A1", .Range("B1").End(xlDown)) End With
'insert column (For i = 1...) and then vlookup (FormulaRange1.Formula...)
With Sheet4
y = .Cells(.Rows.Count, 1).End(xlUp).Row Dim j As Long
x = (.Cells(1, .Columns.Count).End(xlToLeft).Column) * 2 Startrow = 2
StartColumn = 2
j = ActiveCell.Row
For i = 1 + StartColumn To (x + 1) Step 2 
      .Columns(i).EntireColumn.Insert 
      Set FormulaRange1 = .Range(.Cells(Startrow, i),
.Cells(y, i)) 
         If i = 3 Then 
              'insert title for usernames and then vlookup 
              Cells(Startrow - 1, i).Value = Cells(Startrow -
1, i - 1).Value & "'s Team" 
              FormulaRange1.FormulaR1C1 =
"=VLookup(R[0]C[-1],'" & EmployeesRange.Parent.Name & "'!" &
EmployeesRange.Address(1, 1, xlR1C1) & ", 2, False)" 
          ElseIf i <= x Then 
              'insert title for activities and then vlookup
lock row 1 
              Cells(Startrow - 1, i).Value = Cells(Startrow -
1, i - 1).Value & " Cycle Time" 
              FormulaRange1.FormulaR1C1 =
"=VLookup(R1C[-1],'" & ActivityRange.Parent.Name & "'!" &
ActivityRange.Address(1, 1, xlR1C1) & ", 2, False)" 
          Else 
              'Sum totals of productivity per person per day 
              Cells(Startrow - 1, i - 1).Value = "Totals" 
              For j = 2 To y 
              Set dataRange2 = .Range(.Cells(j, StartColumn +
2), .Cells(j, i)) 

              Cells(j, i - 1).Value =
CalcProductivity(dataRange2) 
              Next 
         End If 
Next
'THIS IS WHERE PROBLEMS START 
              i = x + 1 
              Cells(Startrow - 1, i).Value = "Reject Rates" 
              For j = 2 To y 
              Set dataRange2 = .Range(.Cells(j, StartColumn +
2), .Cells(j, i)) 
              Cells(j, i + 1).Value = RejectRates(dataRange2)
              Next 
End With
End Sub
Public Function RejectRates(dataRange As Range) As Double
Dim dataArray As Variant
Dim i As Long, t As Long
Dim runningSum2 As Double
dataArray = dataRange
runningSum = 0#
For i = 1 To UBound(dataArray, 2) Step 4
runningSum2 = runningSum2 + (dataArray(1, i + 3) / (dataArray(1, i + 1) +
dataArray(1, i + 3))) Next
RejectRates = runningSum2
End Function
Public Function CalcProductivity(dataRange As Range) As Double

'--- input range is 'n' pairs of activity,cycle data. ' productivity is calculated by
the sum of all activity * cycle pairs Dim dataArray As Variant
Dim i As Long, t As Long
Dim runningSum As Double
dataArray = dataRange 'copy to memory array for speed
runningSum = 0#
For i = 1 To UBound(dataArray, 2) Step 2
runningSum = runningSum + (dataArray(1, i) * dataArray(1, i + 1)) Next
CalcProductivity = runningSum
End Function
Answer
I'm not entirely sure I understand what you're doing, but I think you want a
running average reject rate going down the rows?
If this is right, then you could use a formula to do this
Assuming Product A count in col A, errorA in col B, Product B in col C, Error
B in col D Running Average reject rate for prod A in col E would be
=SUM($B$2:B2)/(SUM($A$2:$B2))
and then simply copy this formula down.
Note here, that I've locked the first cells, but as you copy down, the range will
get larger, so you end up with a running average.
Sadly, though, I'm still guessing that this is what you're looking for...
Topic 889
Subject
Using UNION and Ranges To Speed Up Deleting Columns? [duplicate]
Question

This question already has an answer here:
Improving the performance of FOR loop
3 answers
Trying to use Union and ranges to speed up deleting empty columns, across all
sheets in my workbook, except "AA" and "Word Frequency"
Sample workbook
Example of sheet before:
Example of sheet after (note, I will need to write separate script to shift
keywords up, you can't see all the keywords, but only the columns with data in
them are left):
In my search for a method to speed up deleting columns in a sheet if the column
is empty (except the header), I was directed by @chrisneilsen to reference the
thread Improving the performance of FOR loop.
That thread shed light on the fact that deleting columns individually slows
down performance significantly. Script speed can be improved by defining a
"master" range to include all the ranges (columns) to be deleted (by using
Union), and then simply deleting the "master" range.
As a VBA noob, I used to following references to learn about Ranges, Union,
UBound and LBound to understand the code in the thread mentioned above:
Excel-Easy.com: Using UBound and LBound, Dynamic Arrays (Using ReDim)
Youtube: Using UNION method to select (and modify) multiple ranges
My old (slow) script that works, but takes about about 3 hours to run across
~30 sheets and deleting ~100 columns each sheet:
Sub Delete_No_Data_Columns()
Dim col As Long
Dim h 'to store the last columns/header

h = Range("E1").End(xlToRight).Column 'find the last column with the
data/header
Application.ScreenUpdating = False
For col = h To 5 Step -1
If Application.CountA(Columns(col)) = 1 Then Columns(col).Delete Next col
End Sub
Almost working script (for one sheet), using the same approach as
@chrisneilsen code in thread mentioned above. When I run it, it doesn't do
anything, however @chrisneilsen noted there were 2 syntax errors (Column.
instead of Columns.) and that I was mixing an implicit ActiveSheet (by using
Columns without a qualifier) with an explicit sheet Worksheets("Ball Shaker").
Errors in code are commented below.
Sub Delete_No_Data_Columns_Optimized()
Dim col As Long
Dim h 'to store the last columns/header Dim EventState As Boolean, CalcState
As XlCalculation, PageBreakState As Boolean Dim columnsToDelete As
Range
Dim ws as Worksheet '<<<<<<<<< Fixing Error (qualifying "Columns."
properly)
On Error GoTo EH:
'Optimize Performance
Application.ScreenUpdating = False
EventState = Application.EnableEvents Application.EnableEvents = False
CalcState = Application.Calculation Application.Calculation =
xlCalculationManual
PageBreakState = ActiveSheet.DisplayPageBreaks
ActiveSheet.DisplayPageBreaks = False
' <<<<<<<<<<<<< MAIN CODE >>>>>>>>>>>>>>

Set ws = ActiveSheet
h = Range("E1").End(xlToRight).Column 'find the last column with the
data/header
'<<<<<<<<<<<<<< Errors corrected below in comments >>>>>>>>>>>> For
col = h To 5 Step -1 
      If Application.CountA(Column(col)) = 1 Then 
      '<<<<< should be Application.CountA(ws.Columns(col)) =
1 
          If columnsToDelete Is Nothing Then 
          Set columnsToDelete = Worksheets("Ball
Shaker").Column(col) 
              'should be columnsToDelete = ws.Columns(col) 
          Else 
              Set columnsToDelete =
Application.Union(columnsToDelete, Worksheets("Ball
Shaker").Column(col)) 
              'should be columnsToDelete =
Application.Union(columnsToDelete, ws.Columns(col)) 
          End If 
      End If 
Next col
'<<<<<<<<<<<<<< End Errors >>>>>>>>>>>>>>>>
If Not columnsToDelete Is Nothing Then
columnsToDelete.Delete
End If
' <<<<<<<<<<<< END MAIN CODE >>>>>>>>>>>>>>
CleanUp
'Revert optmizing lines On Error Resume Next
ActiveSheet.DisplayPageBreaks = PageBreakState
Application.Calculation = CalcState Application.EnableEvents =
EventState Application.ScreenUpdating = True Exit Sub

EH
' Handle Errors here
Resume CleanUp
End Sub
Working code that runs across all sheets in workbook, in about ~6 minutes
(except "AA" and "Word Frequency" worksheets, which I don't need to
format):
Option Explicit
Sub Delete_No_Data_Columns_Optimized_AllSheets()
Dim sht As Worksheet
For Each sht In Worksheets
If sht.Name <> "AA" And sht.Name <> "Word Frequency" Then 
      sht.Activate    'go to that Sheet! 
      Delete_No_Data_Columns_Optimized sht.Index  'run the
code, and pass the sht.Index _ 
                                                  'of the
current sheet to select that sheet 
End If
Next sht 'next sheet please!
End Sub
Sub Delete_No_Data_Columns_Optimized(shtIndex As Integer)
Dim col As Long
Dim h 'to store the last columns/header Dim EventState As Boolean, CalcState
As XlCalculation, PageBreakState As Boolean Dim columnsToDelete As
Range
Dim ws As Worksheet

Set ws = Sheets(shtIndex) 'Set the exact sheet, not just the one that is active _
'and then you will go through all the sheets
On Error GoTo EH:
'Optimize Performance
Application.ScreenUpdating = False
EventState = Application.EnableEvents Application.EnableEvents = False
CalcState = Application.Calculation Application.Calculation =
xlCalculationManual
PageBreakState = ActiveSheet.DisplayPageBreaks
ActiveSheet.DisplayPageBreaks = False
' <<<<<<<<<<<<< MAIN CODE >>>>>>>>>>>>>>
h = ws.Range("E1").End(xlToRight).Column 'find the last column with the
data/header
For col = h To 5 Step -1 
      If ws.Application.CountA(Columns(col)) = 1 Then
'Columns(col).Delete 
          If columnsToDelete Is Nothing Then 
              Set columnsToDelete = ws.Columns(col) 
          Else 
              Set columnsToDelete =
Application.Union(columnsToDelete, ws.Columns(col)) 
          End If 
      End If 
Next col
If Not columnsToDelete Is Nothing Then
columnsToDelete.Delete
End If

' <<<<<<<<<<<< END MAIN CODE >>>>>>>>>>>>>>
CleanUp
'Revert optmizing lines On Error Resume Next
ActiveSheet.DisplayPageBreaks = PageBreakState
Application.Calculation = CalcState Application.EnableEvents =
EventState Application.ScreenUpdating = True Exit Sub
EH
' Handle Errors here
Resume CleanUp
End Sub
Note: Trying to delete columns and shift to left, so columns with data inside
will all be grouped together neatly after script is run.
Is this the best way to utilize Union and ranges for deleting columns? Any help
would be greatly appreciated. Answer
The special cells method actually will not serve you so well here. Instead, find
the last row of data in your sheet and delete only the cells in the column up to
the that row and shift everything to the left. This will be much faster than
deleting an entire column!
Sub Delete_No_Data_Columns()
Dim col As Long, lRow as Long
Dim h as Long'to store the last columns/header
lRow = Range("E" & Rows.Count).End(xlUp).Row ' assumes column E will
have last used row ... adjust as needed
h = Range("E1").End(xlToRight).Column 'find the last column with the
data/header
For col = h To 5 Step -1 
      If Application.CountA(Columns(col)) = 1 Then 
        Range(Cells(2,col),Cells(lRow,col)).Delete

shift:=xlToLeft 
      End If 
Next col
Application.ScreenUpdating = False ' i think you want this at the beginning of
the program, no?
End Sub
Topic 890
Subject
how do i make a code that counts the number of workbooks
Question
my homework, already completed step 1
How do I write code that counts the number of workbooks and worksheets I
have? Whenever I put .count it says its not useable
This is what happens after I press f5:
so i have
sub workbookworksheetcount()
Debug.Print worksheet.count
end sub
Answer
Sub workbookworksheetcount()
Debug.Print Application.Worksheets.Count End Sub
Try this Code
Topic 891
Subject
how to use the library Microsoft.Office.Interop.Excel

Question
I have read the first article about how Embed object in Excel enter link
description here
 and I also apply to do but when I used it first encountered difficulties
offenses: I look for the Width and Height OLEObjects I should add. but when I
look at the height and width that OLEObjects unchanged. remains the same old
size. and I also do not consider the position I need to put in the file
OLEObjects excel. someone can help me this part?
and here is my code
OLEObjects oleObjects = (Microsoft.Office.Interop.Excel.OLEObjects)
excelWorkBook.ActiveSheet.OLEObjects(Type.Missing); 
              oleObjects.Add( 
                  Type.Missing,   // ClassType 
                  path,           // Filename 
                  true,           // Link 
                  false,          // DisplayAsIcon 
                  true,   // IconFileName 
                  Type.Missing,   // IconIndex 
                  Type.Missing,   // IconLabel 
                  Type.Missing,   // Left 
                  Type.Missing,   // Top 
                  20,   // Width 
                  10    // Height 
and someone just help me how to consider the width to height should be
considered in the excel cell that?
Topic 892
Subject
How to create a reverse sort on an Excel array
Question
I have an array of 250 elements "myArray (1 to 250)". Is there a built-in excel
for mac function that can give me a reverse number list? For example if I
wanted to loop through the array from the last number to the first (250 to 1), the
last number could have a pointer as the 1st item processed in my loop ie. 250

is the 1st processed, 249 is the second processed, 248 is the third, etc? My
goal is using a built-in function vs creating a logic loop. Answer
Is there a special requirement in VBA / MAC that precludes negative Step
counters?
If not, just do something like:
For X = Ubound(myArray) to Lbound(myArray) Step -1
Do Something
Next X
Topic 893
Subject
VBA-Change color of cells based on value in particular cell
Question
I want to change the background colors of cells A2:C2 based on the value of
cell D2.
This also applies to the relative cells in rows 3,4, and 5.
If the value in cell D# is 1, I'd like color x. If the value is 2, I'd like color y, if
the value is 3, I'd like the color z.
If it makes a difference, the target range (A2:D6) will be in a table format.
I'd like this subroutine to execute upon opening the workbook. I know where to
put that subroutine so don't sweat instructing me how.
I've done this with conditional formatting, but it'd be nice to have some VBA I
can copy-pasta into future reports. Answer
You should use Conditional formatting, but this works:
Sub ColorMeElmo()
Dim i As Long, r1 As Range, r2 As Range

For i = 2 To 5 
    Set r1 = Range("D" & i) 
    Set r2 = Range("A" & i & ":C" & i) 
    If r1.Value = 1 Then r2.Interior.Color = vbRed 
    If r1.Value = 2 Then r2.Interior.Color = vbBlue 
    If r1.Value = 3 Then r2.Interior.Color = vbYellow 
Next i
End Sub
Topic 894
Subject
Automatically import new csv file data into a “Database” Excel workbook
Question
My situation:
At a competition, we will have 6 "scorers" each using a separate android
tablet. For every game (there will probably be 70 or 80 throughout the
tournament), each person will score accordingly on a custom app that will
create a .csv file. (To be clear, each match will result in 6 separate, 1 row, csv
files.) The format of the data will be the same from game to game, and from
scorer to scorer. I can have control over the names of these files such as "
[Scorer#]_[Match###].csv". These tablets will all be connected to a central
computer via USB.
What I would like to do:
I would like to be able to have the data from all of those files automatically
populate a "database" table on a single sheet. If possible, I would like a folder
to act as a "watch folder" of sorts, where, as a new file shows up in a folder,
that data is automatically ingested into the table. If that is not possible, I would
be happy with a single function I could run to check for new data after each
game ended.
I had considered possibly trying to use power query, but wasn't sure if that
could lead me to a usable solution.
Any suggestions would be greatly appreciated!

(and I apologize if anything is unclear. I'm happy to clear up any confusion)
Answer
Power Query is a good fit in that scenario. You can set up a query that loads all
files in a specific folder and appends the contents. Refresh the query when new
files have been added to the folder.
For detailed instructions how to set up such a query, take a look here:
http://excelunplugged.com/2015/02/10/get-data-from-folder-in-power-query/
Topic 895
Subject
How can I remove duplicates in Excel?
Question
I have a column with 3 of the same keywords taking up 3 rows. I need to clear
the values in the first two rows in each instance.
I have highlighted the rows as an example in the screenshot:
Thanks for your time and help!
Answer
If you want to replace the duplicate keywords with blanks, you can make a new
column to the right of your Keyword column and use an IF-function
=IF(B2=B1,"",B2). If you copy that down, your original Keyword column will
be copied except the duplicates will be blank.
Answer
You might want to try the below:
On the Home Tab, Click
Conditional Formatting under Styles Group Highlight Cell Rules
Duplicate Values
This will highlight all the duplicates in Pink(Default Color). You can then

Filter by Color. Copy the unduplicated data and paste into another column.
Answer
Use Remove Duplicates excel built in command. Under Data tab you will find
remove duplicates command.
(1) First select desired column of range. (2) Hit on Remove Duplicates.
(3) Follow the on screen instructions and do as necessary.
Answer
Here is vba Function that will remove duplicates and does not shift the value
up
Option Explicit
Sub ClearDuplicates()
Dim i As Long
Dim lRng As Long
lRng = Range("A65536").End(xlUp).Row
For i = lRng To 1 Step -1 
      If Application.WorksheetFunction.CountIf(Range("A1:A" &
i), _ 
          Range("A" & i).Value) > 1 Then 
          Range("A" & i).ClearContents 
      End If 
Next i
End Sub
Example
Topic 896
Subject

How can write a formula in an excel 2010 cell that returns an answer based on
3 different conditions?
Question
I am trying to get my invoice to autofill a cell when I pick a category from a
combobox and then fill in a number in another cell. If the category is
Residential, Duplex or Multi-Family the cost is the value entered into B28xthe
value of the constant in F28 and this does work.
If I pick Deck I need it to use the same formula unless the Product is less than
60 in which case it should enter 60 as a minimum which does happen.
It's when I need it to return a value greater than 60 which would mean B28 is
>400 that the problem arises. The value won't go over 60.
N41 is kind of a holding cell for the value for Deck. When the combobox is
empty the formula returns false which I don't want to show in the cell.
Here is my formula
=IF(I13="Residential",(B28F28),IF(I13="Duplex",(B28F28),IF(I13="Multi-
Family",
(B28*F28),IF(I13="Deck",IF(N41=0,MAX(0),IF(N41<112.5,MAX(60),IF(N4
Answer
Min() and Max() are usually used with two arguments, to deliver the smaller
or the bigger of two values respectively. You use it with one parameter only,
which will return exactly that number. That does not make any sense.
Also, consider using OR() to bundle the first three IFs into one.
It is not clear what the last part of the formula is meant to achieve.
=IF(OR(I13="Residential",I13="Duplex",I13="Multi-
Family"),B28*F28,IF(I13="Deck",IF(N41=0,0,<here is where it gets
unclear>))))
Please edit your question and clarify, making sure to post the values and
formulas of the contributing cells.

Topic 897
Subject
reading cell as “cell coordinate” (excel)
Question
Suppose I have written "a5" in B2, I'd like writing A1:B2, with B2 linking to
its cell value, the actual result should be A1:A5.
The reason I want to do this is that I have a function which outputs a cell
coordinate, then I have to use this cell coordinate in other function throughout
the sheet. Any help is welcomed. Answer
Enter into A1 the formula:
=INDIRECT(B2)
Enter into B2: "A5"
Enter anything into A5. This will display in A1 as described.
In VBA:
Function FakeIndirect(address as String)
FakeIndirect = Range(address).value End Function
Topic 898
Subject
How to condense columns and copy them into another worksheet?
Question
I have data across multiple excel files that looks like this:
I want to collapse column B so that it just lists the numbers with no spaces
between them and removes column C. I also need column L to move to column
J and remove the empty spaces so it look identical to columnn B.
This is what the final solution looks like:
So far I have been copy and pasting and then searching for blank cells and
deleting them. I am having trouble writing a code because the amount of data in

each category and spaces between them change on every file. Thanks for any
help. Answer
You can loop through and delete rows with something like below. You'll have
to adapt it four categories with multiple choice to move the x to the right row.
Sub FormatCollapse()
For i = 1 to 1000
If IsEmtpy(Range("A" & i ).Value) And IsEmtpy(Range("B" & i ).Value) Then
Rows(i).delete
End If
Next
End sub
You can use this same concept to loop across columns and sheets
Topic 899
Subject
Trying to automatically add indent in Excel
Question
I'm using the data bars in Excel, and I want the negative numbers to come on
the left side of the midpoint, and the postive numbers on the right side of it. I'm
currently using
.Offset(Rowcount, 13).Value = Me.TextBox13.Value
Is there any way how I can achive this with, for example, indents?
Example, something like this:
-15| 
    |20 
    |12 

-17|
Answer
Try this:
With the data bars already in place, format the cells to center the contents.
Then apply a custom number format to the cells, using
0;-0
The trick is to apply a few leading spaces in front of the positive number
format, and a few trailing spaces after the negative number format. That will
offset the numbers from the center line. You may need to play around with the
number of space characters required for the optimum result.
Topic 900
Subject
Display date of last refresh from OLEDB
Question
I've got an excel doc that refreshes data into a pivot from an external source.
How would I go about displaying the last refresh data in a cell on the sheet?
Answer
If you have control over the external source, or over the query that retrieves the
data from the external source, then you might be able to include a column with
the current datetime. E.g., in T-SQL you would add a field like getdate() AS
[refreshDate].
Then you would reference that new field using an Excel formula. For example,
if you're using the Excel Power Pivot Data Model you could use something like
this:
="Last Refresh Date: " & TEXT(CUBEVALUE("ThisWorkbookDataModel","
[Measures].[refreshDate]"), "mm/dd/yyyy")
Or if your data ends up on its own sheet:
="Last Refresh Date: " & Text(DataSheet!A2, "mm/dd/yyyy")

Topic 901
Subject
Comparing Date and Time Values Taken from Now() Function
Question
I have a table that users can log their use of a laboratory instrument. For the
most basic function of logging current use, I have an error check that goes
through a column that references the start and end times of the instrument use.
Basically, I want to compare the current time and the end time of the instrument
use with previously submitted reservations/current instrument use. If the code
detects that the current user input would interfere with a reservation, it changes
the string value of "strCheckTime" from "ok" to "error".
Then a If Then statement later on registers that and prompts the user with a
message box.
The code is listed below.
So far, I have not gotten it to work. No matter what Now() returns and what
reservations are currently present, it will run through the If Then statement and
change the string value of "strCheckTime" from "ok" to "error".
Any help would be most welcome!
'Defines and sets variables for current use/reservation check Dim shtInstrument
As Worksheet
Set shtInstrument = Worksheets(strShtName) shtInstrument.Activate
Dim intCountEntries As Integer
intCountEntries = shtInstrument.Cells(shtInstrument.Rows.Count,
"B").End(xlUp).Row Dim CurrentTime As Date
Dim StartDate As Date
Dim StartTime As Date
Dim EndDate As Date
Dim EndTime As Date
Dim rngStart As Range
Dim rngEnd As Range

Dim strCheckTime As String
strCheckTime = "Ok"
'Checks if desired instrument use falls in time frame of current use or
reservation
For Each rngStart In shtInstrument.Range("H9:H" & intCountEntries) StartDate
= DateValue(rngStart.Value)
StartTime = TimeValue(rngStart.Value)
EndDate = DateValue(rngStart.Offset(0, 1).Value) EndTime =
TimeValue(rngStart.Offset(0, 1).Value) If StartDate <= Date <= EndDate Then
If StartTime <= Now() <= EndTime Then
strCheckTime = "Error"
ElseIf StartTime <= CurrentTime + TimeSerial(0, txtSample.Text *
txtTime.Text, 0) <= EndTime Then
strCheckTime = "Error"
Else
strCheckTime = "Ok"
End If
Else
'Do nothing
End If
Next rngStart
Answer
The problem is in this line:
If StartTime <= Now() <= EndTime Then
The function "Now()" returns the entire date, including the time. This value is
inherently always greater than the StartTime variable which represents only a
time.
The second problem (that you figured out and mentioned in a comment) is that

you can't use the equality operators like this.
The statement:
If x <= y <= z
will be evaluated as such:
If (x <= y) <= z
So this will be evaluated to:
If (TRUE/FALSE) <= z Then
But TRUE = -1 and FALSE = 0 so as long as z is bigger than z (which in your
case it always is), your function will return true. You need to split the
statements (again, per your comment).
You need to use either:
If StartTime <= Time() AND Time() <= EndTime Then
or
If StartTime <= TimeValue(Now()) AND TimeValue(Now()) <= EndTime
Then
Better yet, you don't need to use the Date and Time separately:
StartTime = [cell where date and time are located] EndTime = [cell where
date and time are located]
If StartTime <= Now() AND Now() <= EndTime Then 'both time variables are
defined by both the date and time
Note that to figure out problems like this, it is best to use a line such as:
debug.print StartTime
debug.print Now()

debug.print EndTime
debug.print (StartTime <= Now() <= EndTime)
to pinpoint where the problem is.
One additional comment is that if you are using things such as the Time
throughout code, the Time function is evaluated when the code runs. So if you
have a procedure that takes a bunch of time and at the beginning you check the
time vs something and then at the end you use the Time/Date function to get the
time to record somewhere, these values will be different. The best way to
prevent this is to create a variable at the beginning of the code (or wherever
you want to check the time:
currTime = Now()
and then use this variable throughout your code. In this particular case, the
difference will either be extremely negligible or nonexistent as the check is in
the same line of code, but in other cases it could be an issue.
EDIT***To include the additional problem of not being able to use equalities
like this.
Topic 902
Subject
Searching within a list of strings with anything in another list of strings in
Excel
Question
Example Data
I need to find anything in column B within the strings in Column A and output
the cell in Column A in Column C.
I know if it is a short list I can do the highlight cell if a text contains x with
Conditional Formatting. However, I have a long list of items that I need to
check within the strings of another list.
Let me know if anymore detail needs to be provided. Any help is appreciated.

Thanks. Answer
Try this Array formula with wildcards:
=IF(ISNUMBER(MATCH(1,
IF(ISNUMBER(SEARCH(""&$B$1:$B$3&"",A1)),1,0),0)),"Y","N")
It is an array and need to be confirmed with Ctrl-Shift-Enter.
The search area represented in this small example, $B$1:$B$3 when enlarged
must be to the exact range of lookups or it will not return correct values.
Answer
You can do this with array formula, type the following in cell C1, then press
Ctrl + Shift + Enter:
=INDEX(B:B,MATCH(TRUE,FIND(B:B,A1)<>"#VALUE!",0))
Drag it down column C to match number of rows in column A. You can then put
a conditional formatting/filter to see what row in A has substring in B.
If you simply want a yes/no result, enter the following into D1:
=IF(COUNTIF(C1:C6,"<>0")>0,"Found","Not Found")
Topic 903
Subject
Run-time error '91' in vba macro
Question
I am trying to use multiple ifs to find certain data points, then paste the value
from a certain column into another sheet. I am getting run-tim Error 91. Any
help would be greatly appreciated. If I remove the And statement and change
from Rows to cells it works fine, but the way I introduced And seems to be the
problem.
Sub Macro2()
Dim Line As Long

Dim NewRange As Range
Dim MyCount As Long
MyCount = 1
For Line = 1 To 10000 Step 1
If Cells(Line, 2) = "Farm2" And Cells(Line, 12) = "new" Then 
    Set NewRange = Cells(Line, 1) 
    End If 
Next Line
NewRange.Copy Destination:=Worksheets("Farm2").Range("B18:B" &
Rows.Count).SpecialCells(xlCellTypeBlanks) Answer
Your code assumes that both the conditions are met and that NewRange has
been set. If the conditions aren't met and NewRange hasn't been set then the
final line will cause an error because there is no range object to copy.
You can test for this by using something like:
If Not NewRange Is Nothing Then
NewRange.Copy Destination:=Worksheets("Farm2").Range("B18:B" &
Rows.Count).SpecialCells(xlCellTypeBlanks) Else
MsgBox "NewRange has not been set!" End If
More importantly, consider Jeeped's comment about the structure of your code
- specifically about how you're working within your loop.
Topic 904
Subject
Reformatting excel tables
Question
I have some excel tables which come from ripping text from pdf files into
excel. I need to reformat the tables into tables better suited for sqlite querying

in an android app. Here's an example of one of the pages ripped from pdf into
excel: 
320E L, 320E LRR                320E L, 320E LRR with
Super Long Reach      320F L 
  with VA Boom                        with Reach Boom 
Stick  2.9 m 9'6"    2.5 m  7'6"    6.28 m  20'6"   2.9 m  
9'6" 
     mm   ft         mm   ft          mm  ft        m ft 
A   8410 27'7"   8070 26'6" 11 290 37'0" 6.49 21'4" B 10 200 33'6"   9800
32'2" 15 720 51'6" 9.86 32'4" C   6680 21'11"   6270 20'7" 11 690 38'4" 6.72
22'1" D   5290 17'4"   4890 16'1" 10 670 35'0" 5.06 16'7" E   6580 21'7"   
6170 20'3" 11 590 38'0" 6.55 21'6" F — — — — — — — — G 11 520
37'10" 11 180 36'8" 13 590 44'6" 9.37 30'9"
Here's a screenshot of how the full page of data ripped from the pdf looks in
excel. Sorry, I'm not sure how to get the formatting correct in SO.
And here's how I would like to reformat it:
This is just one page sample out of hundreds of pages. I'm not sure how I
should go about doing this. I'm more familiar with using java, but I have used
VBA Macros before so I am open to using a macro and/or a combination of
both. Python would also be a good scripting option. I'm also not sure if
something like this is even possible, since there's not a "set in stone" formatting
in the original pdf. The tables from the pdf will be pretty dynamic as you can
see.
Full pdf rip of the first screenshot: 
320E L, 320E LRR                320E L, 320E LRR with
Super Long Reach      320F L 
      with VA Boom                        with Reach Boom 
  Stick   2.9 m   9'6"    2.5 m   7'6"    6.28 m  20'6"   2.9
m   9'6" 
      mm  ft  mm  ft  mm  ft  m   ft 
A   8410 27'7"   8070 26'6" 11 290 37'0" 6.49 21'4" B 10 200 33'6"   9800

32'2" 15 720 51'6" 9.86 32'4" C   6680 21'11"   6270 20'7" 11 690 38'4" 6.72
22'1" D   5290 17'4"   4890 16'1" 10 670 35'0" 5.06 16'7" E   6580 21'7"   
6170 20'3" 11 590 38'0" 6.55 21'6" F — — — — — — — — G 11 520
37'10" 11 180 36'8" 13 590 44'6" 9.37 30'9" 
  323D2 L                     323D2 L 
  with Reach Boom                     with Mass Boom 
Stick 1.9 m 6'3" 2.5 m 8'2" 2.92 m 9'7" 1.9 m 6'3"
m ft m ft m ft m ft
A 5.99 19'8" 6.59 21'7" 6.77 22'2" 5.53 18'2" B 8.98 29'5" 9.44 31'0" 9.86
32'4" 8.46 27'9" C 5.78 19'0" 6.2 20'4" 6.65 21'10" 5.35 17'7" D 3.74 12'3"
5.09 16'8" 5.52 18'1" 3.88 12'9" E 5.51 18'1" 5.99 19'8" 6.47 21'3" 5 16'5" F
— — — — — — — — G 8.94 29'4" 9.38 30'9" 9.58 31'5" 8.56 28'1"
Additional screenshot:
Answer
Here is what I've got so far.
Option Explicit
Sub extractData()
Dim i As Long, j As Long
Dim wsDat As Worksheet
Dim wbRes As Workbook
Dim rngRowCell As Range, rngColCell As Range Dim strModelAndBoom As
String, strBoom As String Dim arrModels As Variant, arrTemp As Variant
ReDim arrModelandBoom(0) As Variant ReDim arrResult(1 To 10, 0) As
Variant
Application.ScreenUpdating = True
Set wbRes = Workbooks.Add
With wbRes.Worksheets 

      If .Count > 1 Then 
          For i = 2 To .Count 
              .Item(i).Delete 
          Next i 
      End If 
      .Item(1).Name = "Results" 
      With .Item(1) 
          With .Range(.Cells(1, 1), .Cells(1, 10)) 
              .WrapText = True 
              .HorizontalAlignment = xlCenter 
              .ColumnWidth = 12.5 
              .Font.Bold = True 
          End With 
          .Cells(1, 1) = "Model Number" 
          .Cells(1, 2) = "Boom Variations" 
          .Cells(1, 2).ColumnWidth = 15 
          .Cells(1, 3) = "Stick Length Variations (m)" 
          .Cells(1, 4) = "A (m)" 
          .Cells(1, 5) = "B (m)" 
          .Cells(1, 6) = "C (m)" 
          .Cells(1, 7) = "D (m)" 
          .Cells(1, 8) = "E (m)" 
          .Cells(1, 9) = "F (m)" 
          .Cells(1, 10) = "G (m)" 
      End With 
End With
For Each wsDat In ThisWorkbook.Worksheets 
      With wsDat 
          wsDat.Cells.UnMerge 
          For Each rngRowCell In .Range(.Cells(1, 2),
.Cells(.Rows.Count, 2).End(xlUp)) 
                  If Not rngRowCell.Offset(0, 1) = Empty And
rngRowCell.Offset(2, 0) = "Stick" Then 
                      For Each rngColCell In
.Range(rngRowCell.Offset(0, 1), .Cells(rngRowCell.Row,
.Columns.Count).End(xlToLeft)) 
                          Select Case rngColCell 
                              Case Empty 
                                  If
Join(Array(rngColCell.End(xlToLeft),
rngColCell.End(xlToLeft).Offset(1, 0)), " ") = strModelAndBoom
And InStr(rngColCell.Offset(2, 0), "m") > 0 Then 

                                      For i =
LBound(arrModels) To UBound(arrModels) 
                                          If
UBound(arrResult, 2) = 0 Then 
                                              ReDim
arrResult(1 To 10, 1 To 1) 
                                          Else 
                                              ReDim Preserve
arrResult(1 To 10, 1 To UBound(arrResult, 2) + 1) 
                                          End If 
                                          arrResult(1,
UBound(arrResult, 2)) = arrModels(i) 
                                          arrResult(2,
UBound(arrResult, 2)) = strBoom 
                                          arrResult(3,
UBound(arrResult, 2)) = Val(rngColCell.Offset(2, 0)) 
                                          For j = 4 To 10 
                                              If
rngColCell.Offset(3, 0) = "mm" Then 
                                                  If Not
rngColCell.Offset(j, 0) = Chr(151) Then 
                                                    
arrResult(j, UBound(arrResult, 2)) = Val(rngColCell.Offset(j,
0)) / 1000 
                                                  End If 
                                              ElseIf
rngColCell.Offset(3, 0) = "m" Then 
                                                  If Not
rngColCell.Offset(j, 0) = Chr(151) Then 
                                                    
arrResult(j, UBound(arrResult, 2)) = Val(rngColCell.Offset(j,
0)) 
                                                  End If 
                                              End If 
                                          Next j 
                                      Next i 
                                  End If 
                              Case Else 
                                  strModelAndBoom =
Join(Array(rngColCell, rngColCell.Offset(1, 0)), " ") 
                                  arrTemp =
Split(strModelAndBoom, "with") 
                                  arrModels =
Split(arrTemp(0), ", ") 
                                  strBoom = Trim(arrTemp(1)) 
                                  If InStr(1, strBoom,
"Boom", vbTextCompare) > 0 Then 
                                      strBoom =

Trim(Left(strBoom, InStr(1, strBoom, "Boom", vbTextCompare) -
1)) 
                                  End If 
                                  For i = LBound(arrModels)
To UBound(arrModels) 
                                      If UBound(arrResult, 2)
= 0 Then 
                                          ReDim arrResult(1
To 10, 1 To 1) 
                                      Else 
                                          ReDim Preserve
arrResult(1 To 10, 1 To UBound(arrResult, 2) + 1) 
                                      End If 
                                      arrResult(1,
UBound(arrResult, 2)) = arrModels(i) 
                                      arrResult(2,
UBound(arrResult, 2)) = strBoom 
                                      arrResult(3,
UBound(arrResult, 2)) = Val(rngColCell.Offset(2, 0)) 
                                      For j = 4 To 10 
                                          If
rngColCell.Offset(3, 0) = "mm" Then 
                                              If Not
rngColCell.Offset(j, 0) = Chr(151) Then 
                                                
arrResult(j, UBound(arrResult, 2)) = Val(rngColCell.Offset(j,
0)) / 1000 
                                              End If 
                                          ElseIf
rngColCell.Offset(3, 0) = "m" Then 
                                              If Not
rngColCell.Offset(j, 0) = Chr(151) Then 
                                                
arrResult(j, UBound(arrResult, 2)) = Val(rngColCell.Offset(j,
0)) 
                                              End If 
                                          End If 
                                      Next j 
                                  Next i 
                          End Select 
                      Next rngColCell 
                  End If 
          Next rngRowCell 
      End With 
Next wsDat

With wbRes.Worksheets(1).Cells(2, 1).Resize(UBound(arrResult, 2),
UBound(arrResult, 1)) 
      .Value = Application.Transpose(arrResult) 
      .HorizontalAlignment = xlCenter 
End With
With wbRes 
      With .Worksheets(1).Sort 
          With .SortFields 
              .Clear 
              .Add
Key:=wbRes.Worksheets(1).Range(wbRes.Worksheets(1).Cells(1,
1), wbRes.Worksheets(1).Cells(wbRes.Worksheets(1).Rows.Count,
1).End(xlUp)), SortOn:=xlSortOnValues, Order:=xlDescending,
DataOption:=xlSortNormal 
              .Add
Key:=wbRes.Worksheets(1).Range(wbRes.Worksheets(1).Cells(1,
2), wbRes.Worksheets(1).Cells(wbRes.Worksheets(1).Rows.Count,
2).End(xlUp)), SortOn:=xlSortOnValues, Order:=xlAscending,
DataOption:=xlSortNormal 
              .Add
Key:=wbRes.Worksheets(1).Range(wbRes.Worksheets(1).Cells(1,
3), wbRes.Worksheets(1).Cells(wbRes.Worksheets(1).Rows.Count,
3).End(xlUp)), SortOn:=xlSortOnValues, Order:=xlAscending,
DataOption:=xlSortNormal 
          End With 
          .SetRange wbRes.Worksheets(1).UsedRange 
          .Header = xlYes 
          .MatchCase = False 
          .Orientation = xlTopToBottom 
          .SortMethod = xlPinYin 
          .Apply 
      End With 
      .SaveAs Application.ThisWorkbook.Path & "\Results " &
Format(Now, "dd-MM-yy HHmmss"), 51 
End With
With Application 
      .DisplayAlerts = False 
      .Workbooks.Open (.ThisWorkbook.FullName) 
      .DisplayAlerts = True 

      .ScreenUpdating = True 
End With
End Sub
Topic 905
Subject
Run-time error '1004' Insert method of Range class failed while adding column
Question
It seems pretty easy, but not able to find workaround.
Excel 2010.
Aim: adding 22 empty columns starting from B
Error
Run-time error '1004': Insert method of Range class failed
Code
Application.DisplayAlerts = False Application.ScreenUpdating = False
Sheets(1).Select ActiveSheet.Tab.ColorIndex = xlColorIndexNone
Dim WbPresent As Workbook Set WbPresent = ActiveWorkbook
Dim FileData As String FileData = "160125"
Dim TabName As String TabName = "IB Hire Plan - Hierarchy " & FileData
Workbooks.Open Filename:= _
"\\chca6030.eur.beluni.net\m137557$\Documents\Makro
VBA\ATR\Taleo\*.xlsm" Sheets("IB Hire Plan - Hierarchy").Select
Sheets(3).Activate
Sheets("IB Hire Plan - Hierarchy").Copy Before:=WbPresent.Sheets(1)
Sheets("IB Hire Plan - Hierarchy").Select
For colx = 2 To 23

Columns(colx).Insert Shift:=xlToRight Next*
Was checking similar question, but did not find the good answer for that.
Topic 906
Subject
Parsing apart a decimal into two integers in either Stata or Excel
Question
I'm working with a dataset that has really terrible ID numbers that are an
integer followed by a 13 digit decimal. However, the first 6-7 decimal places
are zeroes. For example:
10.0000000960554
This is making my life difficult. So I want to parse the IDs apart at the decimal
into two integers, drop the leading zeros, and put them back together as one
giant integer. However, everything I find for how to do this in Excel keeps the
numbers after the decimal after the decimal. For Stata, I've tried to convert the
numeric into a string so I can then parse it, but Stata won't let me because it's a
decimal:
encode ScrambledID, generate StringID
Here's the error:
not possible with numeric variable
r(107);
An added issue, I can't just split the decimal in Excel and then multiply by
1e+12 because it messes with the values (long story with how they were
derived).
Like I said, I'm fine with doing this in either Stata or Excel. Either way this is
driving me nuts. Answer
In Excel:
In one column put:

=int(A1)
In the next put:
=--MID(A1,FIND(".",A1)+1,999)
As @Grade'Eh'Bacon stated, I have use a few shortcuts in the above formula.
The -- at the beginning change text that are numbers into numbers. It replaces
the VALUE() function.
The 999 is a superfluous number in that it is assumed the length of the string
being split is not longer than 999 characters. It can be replaced with the LEN()
function which would return the actual length of the string.
So putting the two together:
=VALUE(MID(A1,FIND(".",A1)+1,LEN(A1))
Where A1 is the location of the number
Answer
Your story is truly shocking.
I'd advise extreme caution in any software. For a start, numbers with decimal
parts will be rendered differently depending on whether they are imported as
4-byte or 8-byte reals, in Stata terms as floats or doubles. The underlying
problem is that many decimal numbers have no exact binary representation.
In Stata terms, encode is indeed out of the question for a numeric variable (and
your example would also fail for other reasons). But ideally you should import
the identifiers as strings in the first place. Otherwise you should try a
conversion such as generate stringID = string(numid, "%16.13f").
. di %21s string(10.0000000960554, "%16.13f")
10.0000000960554
. di %21s string(10.00000009605539, "%16.13f")

10.0000000960554
. di %21s string(10.00000009605544, "%16.13f")
10.0000000960554
. di %21s string(10.00000009605535, "%16.13f")
10.0000000960554
Topic 907
Subject
Cells not being colored after row 96 on output excel sheet
Question
I am using Apache POI to output my program's logging to an excel sheet. Some
cells need to be colored, so I am setting and changing styles to choose the
color I want.
HSSFCellStyle style5 = (HSSFCellStyle) wb.createCellStyle(); 
    
style5.setFillForegroundColor(HSSFColor.BRIGHT_GREEN.index); 
      style5.setFillPattern(CellStyle.SOLID_FOREGROUND); 
      cell.setCellStyle(style5); 
I included the above code inside my
setBackgroundColor(Rows aRow, Cell cell){}
function. "Rows" is a custom class I created, and "cell" is the cell I pass to it
so it knows which cell I am refering to. This is all the code related to adding
color to a cell. I have a flag that prints out to the console every time this
function is called, to keep track of how many times it goes into this part of the
code and to compare it to how many times it SHOULD go into this part of the
code. The console printouts indicate everything is working fine and the color
should have been added to the cells.
However, every time I run my program, no cells are colored past row #96 of

the excel sheet. I have no idea why this is happening. If the output excel sheet
is under 96 rows, then everything is colored fine as it should be. But if the file
is bigger, (bigger than 96 rows) it will stop coloring after row 96.
I would really appreciate your help.
Topic 908
Subject
How do I unload a userform without closing everything else?
Question
I have two userforms (frmDatastation1 and frmDatastation2). When the user
clicks on cmdbutton on frmDatastation1, the first form becomes hidden
(frmDatastation.hide) and the second appears (frmDatastation.show). That
works fine. When the user is done with frmDatastation2, I'd like to go back to
frmDatastation1 and unload frmdatastation2 (to erase all it's content to use it
again later from frmDatastation1). But when I unload frmDatastation2,
everything closes (even frmDatastation1).
Here's my code in frmDatastation2:
frmDatastation1.TextBox1.Text = "" 'this is to reset my textbox not sure it's
needed Me.Hide 'hiding frmDatastation2
Unload frmDatastation1
frmDatastation1.Show vbModeless ' to be able to continue with the next step
frmDatastation1.TextBox1.SetFocus
Unload frmDatastation2 'when this line is executed, it closes everything (even
frmDatastation1) Answer
Use objects instead of using the global/default instance.
Sub DoSomething()
Dim parentForm As frmDatastation1
Set parentForm = New frmDatastation1 parentForm.Show vbModal
End Sub
There's no need to really Unload anything then - the object reference

parentForm will die when execution exits DoSomething and the object goes out
of scope.
Sub ShowChildForm()
Dim childForm As frmDatastation2
Set childForm = New frmDatastation2 childForm.Show vbModal
End Sub
To make your two objects "talk" to each other, you need to pass object
references around. Say the child form needs a reference to the parent, it could
have a property like this:
Private parentForm As frmDatastation1
Public Property Get Parent() As frmDatastation1
Set Parent = parentForm
End Property
Public Property Set Parent(ByVal value As frmDatastation1)
Set parentForm = value
End Property
And then the parent form could do this:
Sub ShowChildForm()
Dim childForm As frmDatastation2
Set childForm = New frmDatastation2 Set childForm.Parent = Me
childForm.Show vbModal
textbox1.Text = childForm.textbox12.Text
End Sub
...While the child form could access its parent form like this:

Sub DoSomething()
Me.Caption = Parent.textbox1.Text
End Sub
If you want to be able to access the properties of a form that's closed but not
yet unloaded/discarded, don't close it - just hide it instead (you'll need to
implement the behavior in QueryClose to prevent discarding the object when
the user "X-out"'s of the form).
Topic 909
Subject
VBA - Change Cell Value based on two other cells
Question
I need this script to empty 4 cells, and change a cell from Done to Pending
when both conditions are met.
I am still very inexperienced in VBA so apologies for the very basic and ugly
code :P
If Range("C5").Value Like "Done" And Range("D5").Value = "1" Then 
   Range("A5:B5").ClearContents 
   If Range("C5").Value Like "Done" And Range("D5").Value =
"1" Then 
       Range("D5:E5").ClearContents 
       If Range("C5").Value Like "Done" And Range("D5").Value
= "1" Then 
           Range("C5").Value = "Pending" 
       End If 
   End If 
End If
I don't get why the C5 Cell doesn't change itself to Pending in this situation,
since the D5 Cell does clear itself.

Could it be because I use Data Validation for the cell C5? It fetches a list
named =TaskState
TaskState consists of the following 4 choices: Pending
In Progress
On Hold
Done
Many Thanks
Answer
Try this:
If Range("C5").Value Like "Done" And Range("D5").Value = "1" Then
Range("A5:B5").ClearContents
Range("D5:E5").ClearContents
Range("C5").Value = "Pending"
End If
The issue is as soon as you clear the contents on Column D it is no longer = 1
and the third If returns false. So it never fires on the third if statement.
The other if statements are not needed if they are testing the same thing.
Topic 910
Subject
Is running a Vba script or Macro in Excel thread safe
Question
Just a general question but would like to know if I run vba scripts or Macros in
Excel are they considered to be thread safe? Answer
Not that I have found:
In Excel 2007 and later on a multi-core PC this can speed up execution
significantly. VBA functions cannot be made thread-safe.

But in the end, I suspect it'll come down to how well written the code actually
is.
Topic 911
Subject
Excel If Then with AND Operator - Troubleshooting Formula
Question
I have an set of data that I need to use an IF statement that contain the AND
operator and compares rows 1 to 2, then 3 to 4, etc. I am most concerned with
the failure in my formula. It works (generates no errors), but doesn't return The
value I expected. I've done searches on here and I have written my formula
based on the advice others have posted, but I can't explain the discrepancy in
the result. My data looks like this:
+------+------+------+
| ColA | ColB | ColC |
+------+------+------+
| 60 | 160 | 38 |
| 22 | 22 | -38 |
+------+------+------+
I have formulas in Column D, row 1 and 2.
Row 1 formula looks like this and returns the expected value of 5:
=IF(C1>=12,5,IF((C1<=11*AND(B1>B2)),3,0))
Row 2 formula looks like this, but returns a value of 3 instead of the expected
0: =IF(C2>=12,5,IF((C2<=11*AND(B2>B1)),3,0))
I assume I am doing something wrong with my AND. As it reads(to me),
neither statement should be true and a 0 should be returned. The first part is
true, C2 is less than 11, it is -38. The second part is not true, B2 is not greater
than B1.
Any help is appreciated.
Answer

The proper way to use AND():
=IF(C1>=12,5,IF(AND(C1<=11,B1>B2),3,0))
in Row 2:
=IF(C2>=12,5,IF(AND(C2<=11,B2>B1),3,0))
Answer
The AND function (as well as the OR function) uses syntax that isn't structured
like it might "read." For example, in some programming the "AND" is an
operator and goes between two logical tests, like so:
If a=b AND a=c Then...
Which is easily "read" as "If a equals b and a equals c then..."
However, in Excel formulas, AND is a function that requires arguments, which
are the logical tests to be performed. So, the same test above would be written
as an Excel formula like:
=IF(AND(a=b,a=c), "Both were equal", "Not both were equal")
So, if I've understood the purpose of your formula correctly, I believe that your
formula =IF(C1>=12,5,IF((C1<=11*AND(B1>B2)),3,0)) should be written as:
=IF(C1>=12,5,IF(AND(C1<=11,B1>B2),3,0))
Which would read as "If C1 is greater than or equal to 12, then return 5. If not,
then if C1 is less than or equal to 11 and B1 is greater than B2, then return 3. If
not, return 0."
Topic 912
Subject
VBA - Hide/unhide row based on hidden/unhidden status of another row
Question
I'm trying to write some VBA code that will unhide an entire row if another

specific row is hidden. This macro also hides a range of rows based on the
value in a specific column. This aspect works fine - I have reliable code. I
can't get the first function I described to work. Should be easy to do, just don't
know the syntax. This subroutine should execute upon opening the workbook.
Private Sub Workbook_Open()
Application.ScreenUpdating = False
Dim targ As Range
Dim msg As Range
targ = "DETAILS!B6"
msg = "DETAILS!B42"
msg.EntireRow.Hidden = True
With Range("DETAILS!B6:B40")
.EntireRow.Hidden = False 
      For Each cell In Range("DETAILS!B6:B40") 
      Select Case cell.Value 
      Case Is = 0 
      cell.EntireRow.Hidden = True 
      End Select 
      Next cell 
End With
If targ.EntireRow.Hidden = True Then
msg.EntireRow.Hidden = False
End If
Application.ScreenUpdating = True
End Sub
Answer

Though you can call range objects like this : Range("DETAILS!B6:B40")
In vba it is better accepted to call it like this:
Sheets("DETAILS").Range("B6:B40")
I fixed a few more syntax errors:
Private Sub Workbook_Open()
Application.ScreenUpdating = False
Dim targ As Range
Dim msg As Range
Set targ = Sheets("DETAILS").Range("B6") Set msg =
Sheets("DETAILS").Range("B42")
msg.EntireRow.Hidden = True
With Sheets("DETAILS").Range("B6:B40")
.EntireRow.Hidden = False
End With
For Each cell In Sheets("DETAILS").Range("B6:B40")
Select Case cell.Value 
      Case 0 
          cell.EntireRow.Hidden = True 
End Select
Next cell
If targ.EntireRow.Hidden = True Then
msg.EntireRow.Hidden = False
End If
Application.ScreenUpdating = True

End Sub
Answer
You need to set the variables like below
Private Sub Workbook_Open()
Application.ScreenUpdating = False
Dim targ As Range
Dim msg As Range
Set targ = "DETAILS!B6"
Set msg = "DETAILS!B42"
msg.EntireRow.Hidden = True
With Range("DETAILS!B6:B40")
.EntireRow.Hidden = False
For Each cell In Range("DETAILS!B6:B40") Select Case cell.Value
Case Is = 0
cell.EntireRow.Hidden = True
End Select
Next cell
End With
If targ.EntireRow.Hidden = True Then
msg.EntireRow.Hidden = False
End If
Application.ScreenUpdating = True
End Sub
Answer

Oh! Just put Set before targ and msg since they're a Range. When declaring
ranges, you have to have Set, i.e. Set myRng = Range("A1:A10").
You might need to do Set targ = Range("Details!B6") if just Set Targ =
"DetailsB6" doesn't work.
On second thought, I don't think Set Targ = "Details!B6" will work if you are
Dim Targ as Range. You're dim'ing as a Range, but are declaring it as like a
string. You need this to be a Range, to use it like targ.EntireRow.Hidden, etc.
Topic 913
Subject
Datatype for a column with both numbers and text in SQL Server?
Question
I am exporting data from Excel to a SQL Server table using SSIS. I have a
column in Excel which contains numbers and text.
What is the best datatype that I could use in the created table in SQL Server for
this column to make the export of data smooth?
The reason that I am asking this is because I tried the data transformation and
only the data with numbers in the above mentioned column got loaded
properly.
BTW I used nvarchar(255) for the above column.
Thank you
Edit: My table kind of looks like this
The rows with text in col3 and col4 are not copied into the table Answer
If your excel column contains combined values of characters, numbers and
alphanumeric, add IMEX=1 to the extended properties of excel connection
manager.
https://www.youtube.com/watch?v=s3d-XIYuB7k

Thanks
Topic 914
Subject
Get names of tabs (not worksheets) in Excel Add In
Question
I know of this.RibbonUI.ActivateTabMso("some_tab") to active tabs, but is
there a way to view the available tabs in Excel code behind? I cannot find it in
the docs or after digging through the Ribbon instance in the debugger.
Topic 915
Subject
Find String and Offset Data VBA
Question
I'm at a standstill here. What I'm trying to do is search Column A for a cell that
begins with a number. Then from that location, look in the cells above it until it
finds one that begins with "L". Finally, move the cell that begins with a number
to the next blank cell to the right of the "L" cell. And then repeat until there are
no more cells that begin with a number left in Column A. Here's what I have so
far:
Sub Code_Relocate()
Dim ws1 As Worksheet
Dim codecheck As Boolean 
Dim lastrow     As Long 
Dim i           As Long 
Set ws1 = ThisWorkbook.Sheets("Sheet1") lastrow =
ws1.Cells(ws1.Rows.Count, "A").End(xlUp).Row
For i = 1 To lastrow
codecheck = Range("A" & i).Value Like "[0-9]*"

If codecheck = True Then
'Search from this point up, find first cell that begins with "L" and move code to
the next blank cell on the right End If
Next i
End Sub
Here's what the before and after would look like: Answer
Try this:
Sub Code_Relocate() 
Dim ws1         As Worksheet 
Dim temp        As String 
Dim lastrow     As Long 
Dim i           As Long 
Dim tempArr()   As String 
Dim j           As Long 
Set ws1 = ThisWorkbook.Sheets("Sheet1") lastrow =
ws1.Cells(ws1.Rows.Count, "A").End(xlUp).Row
For i = lastrow To 1 Step -1
If IsNumeric(ws1.Range("A" & i)) And Len(ws1.Range("A" & i)) > 0 Then 
      temp = ws1.Range("A" & i) & " " & temp 
      ws1.Range("A" & i).ClearContents 
  ElseIf Left(ws1.Range("A" & i), 1) = "L" Then 
      tempArr = Split(Trim(temp)) 
      For j = LBound(tempArr) To UBound(tempArr) 
          If tempArr(j) <> "" Then 
              ws1.Cells(i, 2 + j) = --tempArr(j) 
          End If 
      Next j 
      temp = "" 
      Erase tempArr 

End If
Next i
End Sub
Topic 916
Subject
VBA to extract dat in excel
Question
HI team i am trying to extract div data to excel i try lot but not able to get
output can u please help me to get desire output: 
      Finalized 
      (Claim Status as of 02/01/2016) 
<div class="span pull-right spacing-sides" style="color: black; margin-top:
8px">
<span class="label">Claim ID:</span> 153441610500
<span class="label spacing-small-left" style="padding-left: 20px;">Service
Dates:</span>
12/07/2015 to 12/07/2015
</div>
i have tried
Dim finalout As Variant
Dim dd As HTMLObjectElement
Set TDelements = objIE.document.getElementById("ClaimStatusBar") 'assign
web elements to a HTML document object finalout =
objIE.document.getElementsByClassName("status")(2).innerText 'now we
have a bunch of required webtags in dd, out of which get your data by using
methods and proper syntax MsgBox finalout

Topic 917
Subject
Closing a workbook without stopping vba?
Question
I keep running into an issue where the worksheet in question gets updated, and
then doesn't reflect the changes until I close and re-open the book. It's not
really a big deal, I just want to simplify it a bit into a single button click.
I was told that this is impossible to do because closing a workbook will
immediately stop execution of code, so you can't reopen the book. But since, I
have learned about the PERSONAL.xlsb, and figured since it's a persistent
workbook, it could handle the code execution to save, close, and reopen the
workbook.
Basically, here's what I've got in the main worksheet:
Public Sub Refresh()
ActiveWorkbook.Save
Application.Run
"PERSONAL.xlsb!Module1.RefreshCurrentSheet",ThisWorkbook.Name,_
ThisWorkbook.FullName End Sub
Which then calls the personal.xlsb macro "Refreshcurrentsheet":
Private Sub RefreshCurrentSheet(ByVal sheetname, Optional ByVal
sheetfullname = 0)
Workbooks(sheetname).Close
MsgBox "So far so good!" 'I never see this box
Workbooks(sheetfullname).Open
MsgBox "No errors here..." 'I never see this box End Sub
This successfully closes the workbook in question, but code execution stops
and it doesn't reopen. Is there a way around this? Some way to run the second
macro in the persistent sheet without code execution stopping? Answer

We can reopen the workbook using this code inside it (there is no need to use
other workbook):
Sub test()
Application.DisplayAlerts = False
Workbooks.Open ThisWorkbook.FullName
Application.DisplayAlerts = True
End Sub
Topic 918
Subject
Excel Highlight Duplicates and Filter by color alternative
Question
My spreadsheet has about 800,000 rows with 30 columns. Customers are
interested in duplicate values only in one column. They need the entire row
back. For e.g.
MemberId|Name|Address|CircleScore
H111|John Doe|123 W Main|2.4
H222|Jane Doe|124 W Main|3.2
H333|Bob Doe|125 W Main|2.5
H444|Jake Doe|126 W Main|2.1
H555|Mike Doe|127 W Main|2.4
They want the entire rows where there are duplicates in CircleScore. So my
filtered excel should only contain:
MemberId|Name|Address|CircleScore
H111|John Doe|123 W Main|2.4
H555|Mike Doe|127 W Main|2.4
I tried highlighting duplicate CircleScore and filtering, but the filtering part
takes for ever. I have waited for 15 minutes but still no luck. The duplicates
could be around 150k.
Is there an alternative?
Answer

I would create an Is_Duplicated indicator column and use that to filter the
duplicated CircleScores:
UPDATE (per comments):
Alternatively, you can sort the CircleScore column and make the formula a bit
less taxing on your system (NOTE CircleScore must be sorted beforehand):
Answer
Please disregard this submission if you are a) getting paid by the hour and feel
underpaid, b) planning on a nap while the routine processes, or c) both a) and
b).
With any data set approaching 800K rows (with 30 columns) you are going to
want to step into the variant array arena. With processing typically 5-7% of the
time it takes to work with the worksheet values, it is very appropriate for large
data blocks.
Anytime that the word 'duplicates' comes into play, I immediately start thinking
about how a Scripting.Dictionary object's unique index on its Keys can benefit.
In this solution I used a pair of dictionaries to identify the rows of data with a
repeated Circle Score value.
Twenty-four million cells of data is a lot to store and transfer. Bulk methods
beat individual methods every time and the bulkiest method of peeling off the
data would be to stuff all 800K rows × 30 columns into a variant array. All
processing becomes in-memory and the results are returned to a report
worksheet en masse.
isolateDuplicateCircleScores code
Sub isolateDuplicateCircleScores()
Dim d As Long, v As Long, csc As Long, stmp As String Dim ky As Variant,
itm As Variant, vVALs As Variant, dCSs As Object, dDUPs As Object Dim w
As Long, vWSs As Variant
'early binding

'dim dCSs As new scripting.dictionary, dDUPs As new scripting.dictionary
appTGGL bTGGL:=False
'late binding - not necessary with Early Binding (see footnote ¹) Set dCSs =
CreateObject("Scripting.Dictionary") Set dDUPs =
CreateObject("Scripting.Dictionary")
'set to the defaults (not necessary) dCSs.comparemode = vbBinaryCompare
dDUPs.comparemode = vbBinaryCompare
'for testing on multiple row number scenarios 'vWSs =
Array("CircleScores_8K", "CircleScores_80K", "CircleScores_800K") 'for
runtime
vWSs = Array("CircleScores") '<~~ your source worksheet here
For w = LBound(vWSs) To UBound(vWSs) 
      'ThisWorkbook.Save 
      Debug.Print vWSs(w) 
      Debug.Print Timer 
      With Worksheets(vWSs(w)) 
          On Error Resume Next 
          Worksheets(vWSs(w) & "_dupes").Delete 
          On Error GoTo 0 
          ReDim vVALs(0) 
          dCSs.RemoveAll 
          dDUPs.RemoveAll 
          'prep a new worksheet to receive the duplicates 
          .Cells(1, 1).CurrentRegion.Resize(2).Copy 
          With Worksheets.Add(after:=Worksheets(.Index)) 
              .Name = vWSs(w) & "_dupes" 
              With .Cells(1, 1) 
                  .PasteSpecial
Paste:=xlPasteAllUsingSourceTheme, Operation:=xlNone 
                  .PasteSpecial Paste:=xlPasteColumnWidths,
Operation:=xlNone 
                  .Value = .Value2 
                  .Offset(1, 0).EntireRow.ClearContents 
              End With 
          End With 

          'finish prep with freeze row 1 and zoom to 80% 
          With Application.Windows(1) 
              .SplitColumn = 0 
              .SplitRow = 1 
              .FreezePanes = True 
              .Zoom = 80 
          End With 
          'grab all of the data into a variant array 
          ReDim vVALs(0) 
          csc = Application.Match("CircleScore", .Rows(1), 0)
'CircleScore column number needed later 
          vVALs = .Range(.Cells(2, 1), _ 
                         .Cells(.Cells(Rows.Count,
csc).End(xlUp).Row, _ 
                                .Cells(1,
Columns.Count).End(xlToLeft).Column)).Value2 
          'Debug.Print LBound(vVALs, 1) & ":" & UBound(vVALs,
1)  '1:~800K 
          'Debug.Print LBound(vVALs, 2) & ":" & UBound(vVALs,
2)  '1:~30 
      End With    'done with the original worksheet 
      'populate the dDUPs dictionary using the key index in
dCSs 
      For v = LBound(vVALs, 1) To UBound(vVALs, 1) 
          If dCSs.exists(vVALs(v, csc)) Then 
              stmp = vVALs(v, 1) 
              For d = LBound(vVALs, 2) + 1 To UBound(vVALs,
2) 
                  stmp = Join(Array(stmp, vVALs(v, d)),
ChrW(8203)) 
              Next d 
              dDUPs.Add Key:=v, Item:=stmp 
              If Not dDUPs.exists(dCSs.Item(vVALs(v, csc)))
Then 
                  stmp = vVALs(dCSs.Item(vVALs(v, csc)), 1) 
                  For d = LBound(vVALs, 2) + 1 To
UBound(vVALs, 2) 
                      stmp = Join(Array(stmp,
vVALs(dCSs.Item(vVALs(v, csc)), d)), ChrW(8203)) 
                  Next d 
                  dDUPs.Add Key:=dCSs.Item(vVALs(v, csc)),
Item:=stmp 
              End If 
          Else 
              dCSs.Item(vVALs(v, csc)) = v 
          End If 

      Next v 
      'split the dDUPs dictionary items back into a variant
array 
      d = 1 
      ReDim vVALs(1 To dDUPs.Count, 1 To UBound(vVALs, 2)) 
      For Each ky In dDUPs.keys 
          itm = Split(dDUPs.Item(ky), ChrW(8203)) 
          For v = LBound(itm) To UBound(itm) 
              vVALs(d, v + 1) = itm(v) 
          Next v 
          d = d + 1 
      Next ky 
      'put the values into the duplicates worksheet 
      With Worksheets(vWSs(w) & "_dupes") 
          .Cells(2, 1).Resize(UBound(vVALs, 1), UBound(vVALs,
2)) = vVALs 
          With .Cells(1, 1).CurrentRegion 
              With .Resize(.Rows.Count - 1,
.Columns.Count).Offset(1, 0) 
                  .Rows(1).Copy 
                  .PasteSpecial Paste:=xlPasteFormats,
Operation:=xlNone 
              End With 
              .Cells.Sort Key1:=.Columns(csc),
Order1:=xlAscending, _ 
                          Key2:=.Columns(1),
Order2:=xlAscending, _ 
                          Orientation:=xlTopToBottom,
Header:=xlYes 
          End With 
      End With 
      Debug.Print Timer 
Next w
dCSs.RemoveAll:Set dCSs = Nothing
dDUPs.RemoveAll:Set dDUPs = Nothing
appTGGL
End Sub

Public Sub appTGGL(Optional bTGGL As Boolean = True)
With Application 
      .ScreenUpdating = bTGGL 
      .EnableEvents = bTGGL 
      .DisplayAlerts = bTGGL 
      .AutoRecover.Enabled = bTGGL   'no interruptions with
an auto-save 
      .Calculation = IIf(bTGGL, xlCalculationAutomatic,
xlCalculationManual) 
      .CutCopyMode = False 
      .StatusBar = vbNullString 
End With
Debug.Print Timer
End Sub
Sample Data and Results
         800K rows × 30 columns of random sample data
         ~123K rows × 30 columns of duplicate rows (sorted and formatted in
about a minute-and-a-half)
Timed Results
tbh, I never got the 32-bit version of Excel on the older laptop to run the 800K
pass run more than once without restarting Excel. Once restarted the results
were consistent with what is shown. The 64-bit Excel ran repeatedly without a
hiccup.
       
Large Worksheet Addendum
When dealing with worksheets containing large data blocks there are a few
general improvements that can limit your wait times. You're using Excel as a
medium sized database tool so treat the data worksheet as the raw data that it
should be.

If you are not working with a 64-bit version of Excel then you are wasting time
with everything you do. See What version of Office am I using? and Choose the
32-bit or 64-bit version of Office. Save as an Excel Binary Workbook (e.g.
.XLSB). The file size is typically 25-35% of the original. Load times are
improved and some calculation is quicker (sorry, do not have empirical timed
data on the latter). Some operations that crash an .XLSX or .XLSM work fine
with an .XLSB. Disable Auto-Save/Auto-Recover in the options for the
workbook. ([alt]+F, T, S, [alt]+D, [OK]). There are few things more irritating
than waiting for an auto-save to complete when you are trying to do something.
Get used to Ctrl+S when YOU want to save. Avoid volatile functions¹ at all
costs; particularly in formulas that are used in the full scope of the data. A
single TODAY() in a COUNTIF formula filled down for the extent of the rows
will have you sitting on your thumb more often than not. Speaking of formulas,
revert all formulas to their result values whenever possible. Merged cells,
conditional formatting, data validation and making cells look pretty with
formatting and styles slows you down. Minimize the use of anything that takes
away from raw data. It isn't like anyone is actually going to look through 800K
rows of data. After removing data use Home ► Editing ► Clear ► Clear All
on the vacant cells. Tapping the Del only clears the contents and may not reset
the Worksheet.UsedRange property; Clear All will facilitate resetting the .Used
Range on the next save. If you have hooped your computer with one or more
Excel [Not Responding] scenarios, reboot your machine. Excel never fully
recovers from these and simply restarting Excel to start over is slower and
more likely to enter the same Not Responding condition later.
¹ If you can convert the late binding of the Scripting.Dictionary to early
binding, you must add Microsoft Scripting Runtime to the VBE's Tools ►
References.
² Volatile functions recalculate whenever anything in the entire workbook
changes, not just when something that affects their outcome changes. Examples
of volatile functions are INDIRECT, OFFSET, TODAY, NOW, RAND and
RANDBETWEEN. Some sub-functions of the CELL and INFO worksheet
functions will make them volatile as well.
Answer
Try this Vba-code (and learn a little bit Dutch)

Sub DuplicatesInColumn()
'maakt een lijst met de aangetroffen dubbelingen Dim LaatsteRij As Long
Dim MatchNr As Long
Dim iRij, iKolom, iTeller, Teller As Long, ControlKolom As Long iRij = 1 
iKolom = 5                   'number of columns in the sheet,
Chance if not correct 
ControlKolom = 4             'column number where to find the
doubles, Chance if not correct 
LaatsteRij = Cells(65000, iKolom).End(xlUp).Row: iTeller = iKolom
Sheet1.Activate
For iRij = 1 To LaatsteRij
If Cells(iRij, ControlKolom) <> "" Then
MatchNr = WorksheetFunction.Match(Cells(iRij, ControlKolom),
Range(Cells(1, ControlKolom), Cells(LaatsteRij, ControlKolom)), 0) If iRij
<> MatchNr Then
iTeller = iKolom
For Teller = 1 To iTeller
Cells(iRij, iKolom + Teller).Offset(0, 2).Value = Range(Cells(iRij, Teller),
Cells(iRij, Teller)).Value Next Teller
End If: End If
Next
End Sub
Topic 919
Subject
Vb.net to insert txt.file into template Excel
Question
I've been struggling with a minor project, yet it's supposed to be easy. I have a
windows form app in vba to insert values into a excel file. It used to work in
my company cause we had just a "couple" of data to enter. But now we are
using txt files to gather the data to insert them in the excel file..

My problem is that we can't use macros anymore because there's always
someone that changes something in the code.
My code WAS something like this:
Dim oApp As Excel.Application
Try 
      oApp = DirectCast(CreateObject("Excel.Application"),
Excel.Application) 
      oApp.Workbooks.OpenText(Filename:=TextBox1.Text, _ 
                            
Origin:=Excel.XlPlatform.xlMSDOS, _ 
                            
DataType:=Excel.XlTextParsingType.xlDelimited, _ 
                              Comma:=False, Semicolon:=True,
_ 
                              StartRow:=1) 
      oApp.Visible = True 
    
oApp.Workbooks.Item(TextBox4.Text).SaveAs(Filename:=TextBox2.T
_ 
                                            
FileFormat:=Excel.XlFileFormat.xlWorkbookNormal) 
    
oApp.Workbooks.Item(TextBox3.Text).Close(SaveChanges:=False) 
      'Quit Excel 
      oApp.Quit() 
      oApp = Nothing 
      MessageBox.Show("Success.", "Success!",
MessageBoxButtons.OK) 
  Catch ex As Exception 
      MessageBox.Show(ex.Message.ToString, "Error",
MessageBoxButtons.OK) 
End Try
NOW i want to use a template Excel, and insert the data in sheet1, cause sheet2
has all the graphs and stuff..
Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As

System.EventArgs) Handles Button2.Click
xlWorkBook = xlApp.Workbooks.Open(TextBox2.Text) xlApp.Visible = True
xlWorkSheet = xlWorkBook.Sheets("data")
**With xlWorkSheet 
      '~~> Directly type the values that we want 
      .Range("A1").Value = "1" 
      .Range("A2").Value = "2" 
   End With** 
End Sub
and i have no idea how to implement that. i don't know how to take the txt file
and "place it" in sheet1.. Thank you all!
Answer
To insert a text file line by line into excel.
Dim inFile as string() = file.ReadAllLines("yourFileName") xlWorkBook =
xlApp.Workbooks.Open(TextBox2.Text) xlApp.Visible = True
xlWorkSheet = xlWorkBook.Sheets("data")
for x as integer = 0 to inFile.length - 1
dim splitLine as String() = infile(x).split(";"c) For y as integer = 0 to
splitLine.length - 1
xlWorkSheet.rows(x + 1).Cells(y + 1).value = splitLine(y) Next
Next
if you just want to attach the file with an icon showing then I would use this.
xlWorkSheet.Shapes.AddOLEObject("Word.Document.8", "YourfilePath",
False, False)
I believe should work.

Topic 920
Subject
Applicatoin.SumProduct/Countifs in VBA
Question
I'm trying to use the Application SumProduct & Countifs in vba rather than the
.Formula method. Below is an example of the report I run every month:
I need to be able to organize this data by multiple criteria. Below is a picture
of the spreadsheet where I'm attempting to organize this data by the given
criteria:
I've created macros so the user of this spreadsheet enters the criteria on one
tab, and then this tab is automatically formatted based on their input. The data
needs to be organized as follows:
Adjuster Home Office Name>Data Set (Column C from the report)>Claim
Type (Column E from the report)>State (Column G from the report)
after making several attempts at this, I know that the countifs within
sumproduct formula will achieve this. Below is a snippet of the code I've
written so far:
Dim linerngs As Range
Dim lineitem As Range
Dim lastlinerow As Long
Dim Tab1LastRow As Long
Dim claimstab As String
Dim wsf
Dim SpecialStates As Range
Dim DedicatedUnits As Range
Dim HomeOffice As String
Dim DataSet As String
claimstab = Sheet2.Range("C2") & " Claims" priorclaimstab =
Sheet2.Range("C3") & " Claims"

Tab1LastRow = Sheets(claimstab).Cells(Sheets(claimstab).Rows.Count,
"A").End(xlUp).Row
Set wsf = Application.WorksheetFunction
Set SpecialStates = Sheet2.Range("E2:AA2") Set DedicatedUnits =
Sheet2.Range("E5:BB5")
lastlinerow = Sheet2.Range("D" & Rows.Count).End(xlUp).Row
Set linerngs = Sheet2.Range("D12:D" &
lastlinerow).SpecialCells(xlCellTypeConstants, 23)
For Each lineitem In linerngs
HomeOffice = lineitem.Offset(0, -3).Value DataSet = lineitem.Offset(0,
-1).Value
firsttype = lineitem.Offset(0, 1).Address(False, False) lasttype =
lineitem.Offset(0, 6).Address(False, False)
firststate = lineitem.Offset(0, 7).Address(False, False) laststate =
lineitem.Offset(0, 15).Address(False, False)
ClaimTypes = Sheet2.Range(firsttype & ":" & lasttype) StateJuris =
Sheet2.Range(firststate & ":" & laststate)
If InStr(1, lineitem.Value, "Indemnity") > 0 And InStr(1, lineitem.Value,
"AOS") = 0 Then
lineitem.Offset(0, 16) =
Application.WorksheetFunction.SumProduct(wsf.CountIfs(Sheets(claimstab).Ra
& Tab1LastRow), HomeOffice, Sheets(claimstab).Range("C2:C" &
Tab1LastRow), DataSet, Sheets(claimstab).Range("E2:E" & Tab1LastRow),
ClaimTypes, Sheets(claimstab).Range("G2:G" & Tab1LastRow), StateJuris))
End If
Next lineitem

This is returning me a value of zero for everything. I started poking around and
found that if I replace the variable "ClaimTypes" with "IN" and replace the
variable "StateJuris" with "TX" or any other state abbreviation within the
Countifs code, it gives me a correct calculation. I know in the spreadsheet
formula version of countifs, you can reference a horizontal line of cells and
evaluate them at once. For instance, if you look at row 12 of the second image,
i'd need to be able to evaluate Column G of the report in the first image for the
states "AK";"CA";"HI";"TX" .
I cant figure out how to make this work with the VBA Application version of
countifs & sumproduct. any help on this would be appreciated.
EDIT
In order to not count what states are in range E5:W5 in the second image i
posted, i tried something like this: 
      If InStr(1, lineitem.Value, "Indemnity") > 0 And
InStr(1, lineitem.Value, "AOS") > 0 Then 
      c = 0 
      For Each ClaimType In ClaimTypes 
          For Each DedState In DedicatedUnits 
          c = c +
Application.WorksheetFunction.SumProduct(wsf.CountIfs(Sheets(cl
& Tab1LastRow), HomeOffice, Sheets(claimstab).Range("C2:C" &
Tab1LastRow), DataSet, Sheets(claimstab).Range("E2:E" &
Tab1LastRow), ClaimType.Value, Sheets(claimstab).Range("G2:G"
& Tab1LastRow), "<>" & DedState.Value)) 
          Next DedState 
      Next ClaimType 
      lineitem.Offset(0, 16) = c 
      End If 
however, this isn't working and i didn't think that i would. I'm assuming i need
to do something like:
If InStr(1, lineitem.Value, "Indemnity") > 0 And InStr(1, lineitem.Value,
"AOS") > 0 Then
c = 0

nc = 0
For Each ClaimType In ClaimTypes
c = c +
Application.WorksheetFunction.SumProduct(wsf.CountIfs(Sheets(claimstab).Ra
& Tab1LastRow), HomeOffice, Sheets(claimstab).Range("C2:C" &
Tab1LastRow), DataSet, Sheets(claimstab).Range("E2:E" & Tab1LastRow),
ClaimType.Value))
Next ClaimType
For Each ClaimType In ClaimTypes
For Each DedState In DedicatedUnits
nc = nc +
Application.WorksheetFunction.SumProduct(wsf.CountIfs(Sheets(claimstab).Ra
& Tab1LastRow), HomeOffice, Sheets(claimstab).Range("C2:C" &
Tab1LastRow), DataSet, Sheets(claimstab).Range("E2:E" & Tab1LastRow),
ClaimType.Value, Sheets(claimstab).Range("G2:G" & Tab1LastRow),
DedState.Value))
Next DedState
Next ClaimType
lineitem.Offset(0, 16) = c - nc
End If
Answer
First of all, you can just use SUM() here instead of SUMPRODUCT() - you are
only supplying one argument to SUMPRODUCT(), so it is only returning the
sum anyway.
Secondly, if you really wanted to do an array formula in VBA, wrap the entire
formula in EVALUATE([formula]). But this won't work for you because...

Thirdly, even if you entered this as an array formula in an excel worksheet, it
would not work correctly if there was multiple criteria for both claim types
and states, as it would only add the number of occurrences of claim1 and state1
and claim2 and state2 etc. (If either column only has one, then the formula
would work, however.)
So, if you want to do this, what I would do is a nested FOR loop, where for
each Claim Type-State combination, you do another COUNTIFS() using that
particular Claim Type and State and increment a running total.
Update: For example, something like
c = 0
for each claimType in claimTypes
for each state in StateJuris
c = c + wsf.CountIfs(Sheets(claimstab).Range("B2:B" & Tab1LastRow),
HomeOffice, Sheets(claimstab).Range("C2:C" & Tab1LastRow), DataSet,
Sheets(claimstab).Range("E2:E" & Tab1LastRow), ClaimType.value,
Sheets(claimstab).Range("G2:G" & Tab1LastRow), State.value) next state
next claimType
lineitem.Offset(0, 16) = c
Topic 921
Subject
Making a new spreadsheet using data from specific cells on a different
spreadsheet
Question
I need help with an exercise spreadsheet I'm trying to make in excel. In my file
I have 3 spreadsheets and one graph. The fist spreadsheet is called "Routine"
and it has repeating tables with a section for date, exercise, weight, repetition,
and a section for notes. The exercise column is linked to a different
spreadsheet via data validation called "Exercise". On the "Exercise"
spreadsheet I have a list of exercises and the muscle group those exercises
work out. I was able to create a list linking the name of the exercise in this

spreadsheet to a drop down box in the "Routine" spreadsheet.
What I would like to do now is have a new spreadsheet for just the raw data. I
want to be able to enter a date on one of my tables, select an exercise with my
drop down box and insert a weight. In the new spreadsheet for data I'd like it
to automatically pull new data when I put a date in an unused table. Once I put
the date in I would like to fill in the "Date" column and if record the weight in
a set "Exercise". With this data I'd then like to have a line graph showing me
my progress with the date in the horizontal axis and weight increase in the
vertical axis. I'd like to also be able to select either a specific exercise or
multiple exercises at any given time to be represented on the line graph. I am
leaving a link to imgur when I have taken screenshots of what I've done so far.
http://imgur.com/1zYAFcG
edit
here is a new set of screenshots, I hope this better explains when I'm
trying to accomplish.
http://imgur.com/qfP7CrG
Thank you all in advance,
Mark
Topic 922
Subject
Show/Hide Rows Per Dropdown Selection
Question
I found code online as an example that I have tweaked to show or hide specific
rows depending on the selection I choose within a dropdown in my Excel file.
The macro is not working no matter what I try.
My code is as follows (also attached screenshot of rows under question 2 (2a -
2d) that are not showing/hiding)
Private Sub Worksheet_Change(ByVal Target As Range)

If Target.Address = "$F$13" Then
If Range("F13").Value = "Yes" Then
Rows("14:17").EntireRow.Hidden = False
End If
If Range("F13").Value = "No" Then
Rows("14:17").EntireRow.Hidden = True
End If
If Range("F13").Value = " " Then
Rows("14:17").EntireRow.Hidden = True
End If
End Sub
Answer
There is an End If missing. I assume the value of the target cell (F13) needs to
be tested for it's value. If the value is "Yes", it should unhide row 14:17, if it is
" " (spacebar) it should hide them and if it is "No" is should hide them as well.
Other values will not affect the hiding/unhiding of the rows. There should be a
second End If before End Sub, so that all the if-statements above are wrapped
within the Address check.
Also note that this code should be placed in the worksheet itself, since you
want to hook into the Worksheet_Change event.
Try this in a worksheet module:
Private Sub Worksheet_Change(ByVal Target As Range) If Target.Address =
"$F$13" Then 'Check if the changed value is indeed in F13
If Target.Value = "Yes" Then
ActiveSheet.Rows("14:17").EntireRow.Hidden = False 'Show the rows if the
value is Yes ElseIf Target.Value = "No" Then
ActiveSheet.Rows("14:17").EntireRow.Hidden = True 'Hide them when it's
No ElseIf Target.Value = " " Then

ActiveSheet.Rows("14:17").EntireRow.Hidden = True 'Or space End If
End If
End Sub
Other remarks:
Instead of ActiveSheet you can also use Me (Me.Rows...) In this scenario they
probably do the same. However, if you change the value on a worksheet from
another worksheet (e.g. formula that recalculates), Me will reference the
changed worksheet that fires the event, whereas activeworksheet will affect the
currently active sheet. Use Target instead of referencing the Range again.
Target is a range object that is already in memory. Hence execution will be
faster compared to accessing the worksheet again.
Answer
This is a good example of properly intending your code helping you identify an
issue. You're missing an End IF statement. Try this:
Option Explicit
Private Sub Worksheet_Change(ByVal Target As Range)
If Target.Address = "$F$13" Then
If Range("F13").Value = "Yes" Then
Rows("14:17").EntireRow.Hidden = False End If
If Range("F13").Value = "No" Then
Rows("14:17").EntireRow.Hidden = True End If
If Range("F13").Value = " " Then
Rows("14:17").EntireRow.Hidden = True End If
End If
End Sub

You may also want to use:
If Range("F13").Value = ""
instead of
If Range("F13").Value = " "
Topic 923
Subject
Marco - After the calculation is done, I wish to paste the values in the
calculated rows, but preserve the formulas in the rows below
Question
Here is what I have so far. It's a macro to run a text to columns of pasted
material. This is then pulled into another sheet that has vlookups. After the v-
look up successfully pulls the formula I want to copy paste special value those.
But not the cells below it in columns D through J that have vlookups to pull
formulas for data copied later. Please assist. I am very new at macros.
Sub Macro1()
'
' Macro1 Macro
'
' Keyboard Shortcut: Ctrl+v
'
Selection.TextToColumns Destination:=Range("A1"), DataType:=xlDelimited,
_ 
      TextQualifier:=xlDoubleQuote,
ConsecutiveDelimiter:=True, Tab:=True, _ 
      Semicolon:=False, Comma:=False, Space:=True,
Other:=False, FieldInfo _ 
      :=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4,
1)), TrailingMinusNumbers:= _ 
      True 
Sheets("Bags").Select

Columns("D:J").Select
Selection.Copy
Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks
_
:=False, Transpose:=False
End Sub
Answer
I take it you store some data in column A, do the text to columns part and then
copy-paste only the rows in Column D:J where there actually is data in column
A:C. In other words: After the calculation is done, you wish to paste the values
in the calculated rows, but preserve the formulas in the rows below.
The problem lies in the fact that you do not determine the last row that holds
the data, so your selection will encompass only those cells. Instead you just
copy paste the entire columns.
The example below will leave the entered formulas in Columns D:J intact for
rows that don't have data in Column A:C.
Sub Macro1()
Dim lastRow as integer 'We need a variable to store the row number in.
'
' Macro1 Macro
'
' Keyboard Shortcut: Ctrl+v
'
Selection.TextToColumns Destination:=Range("A1"), DataType:=xlDelimited,
_ 
      TextQualifier:=xlDoubleQuote,
ConsecutiveDelimiter:=True, Tab:=True, _ 
      Semicolon:=False, Comma:=False, Space:=True,
Other:=False, FieldInfo _ 
      :=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4,
1)), TrailingMinusNumbers:= _ 

      True 
'Let's assume this first part works correctly, since your question does not
address this. 'However - Keep in mind that the text to columns have a
destination that will always be A1 in your example.
lastRow = Sheets("Bags").Range("A65535").end(xlUp).Row 'Determine the
last row in column A that has a value in it. Sheets("Bags").Range("D2:J" &
lastRow).Select 'Select only the rows that have values in column A.
Selection.Copy
Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks
_
:=False, Transpose:=False
End Sub
Comments on this answer:
This will fix your immediate problem, however it is still not a very clean way
to do it. Also I do not think the above code will do exactly what you want. The
question answered is: How to edit your code, so it will now overwrite the
formulas in D:J in rows that have no data in A.
Other notes / pointers:
Next: If possible try to avoid selections at all. There's a great question +
asnwers as to how and why in an old threat here: How to avoid using Select in
Excel VBA macros
Also I recommend reading up on how to reference ranges / cells:
https://msdn.microsoft.com/en-us/library/office/aa221357(v=office.11).aspx
http://excelmatters.com/referring-to-ranges-in-vba/
http://spreadsheetpage.com/index.php/tip/referring_to_ranges_in_your_vba_co
Knowing how this works is a good start when new to Macro's. Good luck!
Topic 924

Subject
INDEX and MATCH for multiple DATES (Excel)
Question
maybe you can help me on this.
I need a Excel formula to lookup for all multiple events on a same day:
Type the day you want to search
Return several lines with the same date, but indicating the event.
So this: 
  DATE    EVENT           SEARCH DATE HERE> 21/01 
  21/01     A 
  21/01     B 
  21/01     A 
  21/01     A 
  22/01     A 
  22/01     B 
  23/01     B 
Would become this:
DATE EVENT 
  21/01     A 
  21/01     B 
  21/01     A 
  21/01     A 
I was trying to use this:
{=IFERROR(INDEX($A$1:$B$8,SMALL(IF(A2:A8=$F$1,ROW(A2:A8)-1),R
Which works well looking for values, but not looking for dates..
Any idea why?
Thank you!
Answer

Applying a filter would be best but if you want a formula:
=IFERROR(INDEX(A:A,AGGREGATE(15,6,
(1/($A:$A=$D$1))*ROW($1:$1040000),ROW(1:1))),"")
Copy over and down as many rows as wanted. The picture the formula was
copied down 8 rows.
The Aggregate function is new to Excel 2010 so any that are older than that it
will not work.
Answer
I got what you asking for simply using:
=IF($A2=$F$1,$A2,"")
and
=IF($A2=$F$1,$B2,"")
under the date and event columns, respectively in the filtered result list.
Also, in your formula, the "if" only has 2 parameters. Is this intentional?
You can also filter by the following:
Select the date and events cells
Click Format as Table, check My table has headers and hit OK.
Click on the down arrow next to the column header, and choose Filter.
Topic 925
Subject
CSV parsing, newline/linebreak issues
Question
I'm trying to create a parser for multiple CSV files, that will eventually output
to another CSV file in Excel-compatible format. The CSV files are exported by
a commercial tool that takes a Firewall configuration and gives us a report of

any issues it finds.
So far I have figured out how to read a directory of files in, look for certain
values, determine the type of device I have and then spit it out to screen or to a
CSV, but only if each line has single cell entries. If the source IP 'cell' (or any
other) contains more than one IP, separated by a newline, the output breaks on
that newline and pushes the remainder onto the next line.
The code I have so far is:
require 'csv'
require 'pp'
nipperfiles = Dir.glob(ARGV[0] + '/*.csv')
def allcsv(nipperfiles)
filearray = []
nipperfiles.each do |csv|
filearray << csv
end
filearray
end
def devicetype(filelist)
filelist.each do |f|
CSV.foreach(f, :headers => true, :force_quotes => true) do |row| 
    if row["Table"] =~ /audit device list/ && row["Device"]
=~ /Cisco/ 
      return "Cisco" 
    elsif row["Table"] =~ /audit device list/ &&
row["Device"] =~ /Dell/ 
      return "Sonicwall" 
    elsif row["Table"] =~ /audit device list/ &&
row["Device"] =~ /Juniper/ 
      return "Juniper" 
    end 
end

end
end
def adminservices(device, filelist)
administrative = []
filelist.each do |f|
CSV.foreach(f, :headers => true, :col_sep => ",", :force_quotes => true,
:encoding => Encoding::UTF_8) do |row| 
    if row["Table"] =~ /administrative service rule/ 
      if row["Dst Port"] != "Any" and row["Service"] != "
[Host] Any" 
        if device == "Cisco" 
          administrative << row["Table"] + ',' + row["Rule"]
+ ',' + row["Protocol"] + ',' + row["Source"] + ',' +
row["Destination"] + ',' + row["Dst Port"] 
        elsif device == "Sonicwall" 
          administrative << row["Table"] + ',' + row["Rule"]
+ ',' + row["Source"] + ',' + row["Destination"] + ',' +
row["Service"] 
        elsif device == "Juniper" 
          administrative << row["Table"] + ',' + row["Rule"]
+ ',' + row["Source"] + ',' + row["Destination"] + ',' +
row["Service"] 
        end 
      end 
    end 
end
end
administrative
end
def writecsv(admin)
finalcsv = File.new("randomstorm.csv", "w+") finalcsv.puts("Administrative
Services Table:\n", admin, "\r\n") finalcsv.close
end

filelist = allcsv(nipperfiles)
device = devicetype(filelist)
adminservices(device, filelist)
admin = adminservices(device, filelist) writecsv(admin)
Is there a way to get it to ignore the newlines that are inside cells, or is my
code complete balls and needs to be started again?
I have tried writing a CSV file with the CSV library, but the results are the
same and I figured this code was slightly clearer for demonstrating the issue.
I can sanitise an input file if it would help. Answer
newlines are OK inside of fields as long they are quoted:
CSV.parse("1,\"2\n\n\",3")
=> [["1", "2\n\n", "3"]]
Try writing directly to a string or a file like in the documentation which will
ensure your fields with newlines are quoted:
def writecsv(admin)
csv_string = CSV.generate do |csv|
admin.each { |row| csv << row }
end
finalcsv = File.new("randomstorm.csv", "w+") finalcsv.puts("Administrative
Services Table:\n", csv_string, "\r\n") finalcsv.close
end
Also ensure you are writing your fields as an array inside of adminservices():
administrative << [row["Table"], row["Rule"], row["Protocol"],
row["Source"], row["Destination"], row["Dst Port"]]
Topic 926
Subject
Excel 2011 - How to AutoFit Wrapped Cell Referring to Another Cell?

Question
I am working in Excel 2011 for Mac. I have a cell in my spreadsheet with
wrapped text, and whenever I add to the text of that cell, the row height
automatically readjusts based on the number of rows in the text of the cell.
However, when I reference that cell in another cell, the height of my second
cell doesn't readjust as I change the text in the original cell. I know that I can
manually do this by selecting the cell and AutoFitting it, but I'd like the row
height to adjust automatically. Is there a way I can do this? I've attached a
photo below to illustrate my problem. As you can see, the A1 is my original
cell, which has wrapped text and automatically adjust the row height. I then
referenced cell A1 in cell A4 and then wrapped text in cell A4, which, as I had
hoped for, AutoFit the wrapped text from A1 into A4. However, when I added
text to A1, the height of A4 didn't change, as you can see as the bottom 3 lines
are cut off.
Thanks for the help!
Answer
AFAIK, you'll always need manual intervention (or VBA) to autofit the row
when the content is created with a formula. It's the same in Excel for Windows,
so I'm not surprised to see that behaviour in Excel for Mac.
Topic 927
Subject
SSIS Excel Source error: [Excel Source [1]] Error: SSIS Error Code
DTSEOLEDBERROR. An OLE DB error has occurred. Error code:
0x80004005
Question
I have a very simple SSIS Data Flow that Unions two Excel Sources together,
does a small data conversion, and loads into a staging table.
However, my two Excel Sources are failing immediately as the Execute Phase
begins.
I am only receiving the following nondescript errors:
[LA Report Source [627]] Error: SSIS Error Code DTSEOLEDBERROR. An

OLE DB error has occurred. Error code: 0x80004005.
[SSIS.Pipeline] Error: SSIS Error Code DTSEPRIMEOUTPUTFAILED. The
PrimeOutput method on component "LA Report Source" (627) returned error
code 0xC0202009. The component returned a failure code when the pipeline
engine called PrimeOutput(). The meaning of the failure code is defined by the
component, but the error is fatal and the pipeline stopped executing. There may
be error messages posted before this with more information about the failure.
[NOLA Report Source [640]] Error: SSIS Error Code DTSEOLEDBERROR.
An OLE DB error has occurred. Error code: 0x80004005.
[SSIS.Pipeline] Error: SSIS Error Code DTSEPRIMEOUTPUTFAILED. The
PrimeOutput method on component "NOLA Report Source" (640) returned
error code 0xC0202009. The component returned a failure code when the
pipeline engine called PrimeOutput(). The meaning of the failure code is
defined by the component, but the error is fatal and the pipeline stopped
executing. There may be error messages posted before this with more
information about the failure.
This package had been working for several days, and suddenly started giving
this error message a couple days ago, with no real changes to the data source.
In addition, when I go to preview the Excel Data Source, I get this weird error:
Any ideas? Using Visual Studio 2008.
Answer
I want to share the solution I came up with:
I was over-zealous with my SQL Query in the Excel Source. I had a WHERE
filter on my select statement, which worked for a little while, but an anomaly
in the data must have thrown something off - SSIS didn't like it at all.
I've removed the WHERE portion, just leaving the SELECT portion, and I've
handled the filter with a Conditional Split instead. Problem solved!
Topic 928

Subject
Double Click Excel worksheet to open a pivot with Sikuli in Windows
Question
I have SikuliX over Windows and I need to open an Excel file with macros,
pivots and next, double click the last cell (down and right) to open a hidden
sheet with data. The problems are:
1.) this last cell sometimes are located in the column k,l,m or n. 2.) the row
number sometimes are 80, 81 or 82. 3.) the value of this last cell is not ever the
same (rotates over time).
I tried with ¨Go to¨ keystroke in Excel but is not working properly because the
column changes between different file versions.
Here an image with the zone to click (in this case, i want to double click the
cell with the number 2484)
https://www.dropbox.com/s/m4lbaz9h0d8a27z/error.png
Any clues?
Topic 929
Subject
Excel VBA extrapolate values
Question
I have a file that has data stored in it the following way (weekly data example)
+----------+----------+----------+----------+----------+----------+ | | WK1 | WK2 |
WK3 | WK4 | WK5 | +----------+----------+----------+----------+----------+------
----+ | DT Begin | 29.12.14 | 05.01.15 | 12.01.15 | 19.01.15 | 26.01.15 | | DT
End | 04.01.15 | 11.01.15 | 18.01.15 | 25.01.15 | 01.02.15 | | XData | 50 | 10 | 10 |
10 | 50 | +----------+----------+----------+----------+----------+----------+
My problem ist to aggregate the XData on a monthly basis. For that I want to
break the data down for days and then calculate the average.
Edit: I changed the table as it was not clear what I meant. This averages to

((504)+(1021)+(5*50))/31 = 22.90
+------------+-------+
| Date | Value |
+------------+-------+
| 01.01.2015 | 50 |
| 02.01.2015 | 50 |
| 03.01.2015 | 50 |
| 04.01.2015 | 50 |
| 05.01.2015 | 10 |
| 06.01.2015 | 10 |
| 07.01.2015 | 10 |
| 08.01.2015 | 10 |
| 09.01.2015 | 10 |
| 10.01.2015 | 10 |
| 11.01.2015 | 10 |
| 12.01.2015 | 10 |
| 13.01.2015 | 10 |
| 14.01.2015 | 10 |
| 15.01.2015 | 10 |
| 16.01.2015 | 10 |
| 17.01.2015 | 10 |
| 18.01.2015 | 10 |
| 19.01.2015 | 10 |
| 20.01.2015 | 10 |
| 21.01.2015 | 10 |
| 22.01.2015 | 10 |
| 23.01.2015 | 10 |
| 24.01.2015 | 10 |
| 25.01.2015 | 10 |
| 26.01.2015 | 50 |
| 27.01.2015 | 50 |
| 28.01.2015 | 50 |
| 29.01.2015 | 50 |
| 30.01.2015 | 50 |
| 31.01.2015 | 50 |
+------------+-------+

| Average | 22.90 |
+------------+-------+
After having done this calculation I want to summarize the data as follows for
the entire year:
+-------+-------+-------+------+------+ | | Jan | Feb | Mar | ... | +-------+-------+--
-----+------+------+ | XData | 22.90 | 22.00 | 23.1 | ... | +-------+-------+-------+-
-----+------+
Being a newbie in Excel VBA, I have extreme trouble doing this.
I know how to get to the value of a cell (Range.Value) but not how to find data
in a particular week (as WK1 is there for 2014 as well) Range.Find with a
date other than the one in the cell itself does not seem to work.
Whar I am asking for is a way to approach this problem. My particular
difficulties are to:
Find the data in the worksheet
split the week values into day values (see table above) Copy the data or hold it
in some sort of data structure calculate the average (this should be ease then)
fill in the data on a monthly basis
As you can see, I have trouble even getting started - any hints would be greatly
appreciated. Maybe I'm thinking of this entirely too complicated? Thank you!
Topic 930
Subject
Error while sending an email through a for loop for expiry date reminder
Question
I have a sheet that has expiry dates + contractors names.
I'm trying to send an email, whenever the expiry date is to expire within 90 and
60 days.
It sends for the first cell that satisfies the condition but after that it shows me an
error with the omail.to or omail.subject and omail.send saying "the item has

been moved or deleted".
This is the code:
Sub reminderautomail()
' reminderautomail Macro
Dim mydate1 As Long
Dim datetoday1 As Date
Dim datetoday2 As Long
Dim x As Long
Dim aax As String
Dim olApp As Outlook.Application
Set olApp = CreateObject("outlook.application") Dim olmail As
Outlook.MailItem
Set olmail = olApp.CreateItem(olMailItem)
For x = 4 To 29
aax = Cells(x, 3)
mydate1 = Cells(x, 9)
datetoday1 = Date
datetoday2 = datetoday1
expi = (mydate1 - datetoday2)
If expi <= 90 And expi >= 60 Then 
      Cells(x, 10) = "YES" 
      Cells(x, 11) = expi 
      olmail.To = "email address" 
      olmail.Subject = " An Agreement is about to expire soon
" 
      olmail.Body = " This agreement is about to expire in "
& Cells(x, 11) & " days from today's date" & " the agreement
is for " & aax 
      'olmail.Display 
      olmail.Send 

ElseIf expi <= 60 And expi > 0 Then 
      Cells(x, 10) = "YES" 
      Cells(x, 11) = expi 
      olmail.To = "email address" 
      olmail.Subject = " An Agreement is about to expire soon
" 
      olmail.Body = " This agreement is about to expire in "
& Cells(x, 11) & " days from today's date" & " the agreement
is for " & aax 
      'olmail.Display 
      olmail.Send 
ElseIf Cells(x, 10) < 0 Then
Cells(x, 11) = "Expired !!"
End If
Next
Set olApp = Nothing
Set olmail = Nothing
End Sub
Here is the error
Here the code already in the previous iteration sent me an email reminder with
no errors, but when it goes to the next iteration it shows this error. Answer
The Object olMail will be missing after it has been send on the first succesfull
iteration and sending the e-mail.
"the item has been moved or deleted" is most likely the error you receive.
To prevent this, make sure you create a new E-mail object every time you
match the criteria as follows:
If expi <= 90 And expi >= 60 Then
Set olmail = olApp.CreateItem(olMailItem)

'Do your things
olmail.Send
ElseIf expi <= 60 And expi > 0 Then
Set olmail = olApp.CreateItem(olMailItem)
'Do your things
olmail.Send
ElseIf Cells(x, 10) < 0 Then
Cells(x, 11) = "Expired !!"
End If
Topic 931
Subject
Reading excel file in python with pandas and multiple indices
Question
I am a python newbie so please excuse this basic question. My .xlsx File looks
like this
Unnamend:1 A Unnamend:2 B
2015-01-01 10 2015-01-01 10
2015-01-02 20 2015-01-01 20
2015-01-03 30 NaT NaN
When I read it in Python using pandas.read_excel(...) pandas automatically
uses the first column as the time index.
Is there a one-liner that tells pandas to notice, that every second column is a
time index belonging to the time series right next to it?
The desired output would look like this:
date A B
2015-01-01 10 10
2015-01-02 20 20

2015-01-03 30 NaN
Answer
In order to parse chunks of adjacent columns and align on their respective
datetime indexes, you can do the following:
Starting with df:
Int64Index: 3 entries, 0 to 2
Data columns (total 4 columns):
Unnamed: 0 3 non-null datetime64[ns] A 3 non-null int64
Unnamed: 1 2 non-null datetime64[ns] B 2 non-null float64
dtypes: datetime64[ns](2), float64(1), int64(1)
You could iterate over chunks of 2 columns and merge on index like so:
def chunks(l, n):
""" Yield successive n-sized chunks from l.""" for i in range(0, len(l), n):
yield l[i:i + n]
merged = df.loc[:, list(df)[:2]].set_index(list(df)[0]) for cols in chunks(list(df)
[2:], 2):
merged = merged.merge(df.loc[:, cols].set_index(cols[0]).dropna(),
left_index=True, right_index=True, how='outer')
to get:
A B
2015-01-01 10 10
2015-01-01 10 20
2015-01-02 20 NaN
2015-01-03 30 NaN
pd.concat unfortunately doesn't work as it can't handle duplicate index entries,
otherwise one could use a list comprehension:

pd.concat([df.loc[:, cols].set_index(cols[0]) for cols in chunks(list(df), 2)],
axis=1)
Answer
I use xlrd for import the data, after i use pandas to display
import xlrd
import pandas as pd
workbook = xlrd.open_workbook(xls_name) workbook =
xlrd.open_workbook(xls_name, encoding_override="cp1252") worksheet =
workbook.sheet_by_index(0)
first_row = [] # The row where we stock the name of the column for col in
range(worksheet.ncols):
first_row.append( worksheet.cell_value(0,col) ) data =[]
for row in range(10, worksheet.nrows):
elm = {}
for col in range(worksheet.ncols):
elm[first_row[col]]=worksheet.cell_value(row,col) data.append(elm)
first_column=second_column=third_column=[] for elm in data :
first_column.append(elm(first_row[0]))
second_column.append(elm(first_row[1]))
third_column.append(elm(first_row[2]))
dict1={}
dict1[first_row[0]]=first_column
dict1[first_row[1]]=second_column
dict1[first_row[2]]=third_column
res=pd.DataFrame(dict1, columns=['column1', 'column2', 'column3']) print res
Topic 932
Subject
Range(“”).Value = “Percentage%” Error

Question
I am looking for a simple line of VBA that erases certain cells when other cells
equals a certain value.
The following code works great with Text and Numeric value, but it fails to
check and clear the cells if the value equals a percentage.
Sub Module1()
If Range("C5").Value Like "Done" And Range("D5").Value = "100%" Then
Range("B5").ClearContents
End If
End Sub
It still doesn't work if I remove the % sign from the D5 Value checkup. The cell
itself is Formatted as a Percentage. Answer
A percentage is a number formatted like text.
Change
Range("D5").Value = "100%"
to its decimal value.
Range("D5").Value = 1
Topic 933
Subject
Excel separating data into different columns
Question
I have an Excel workbook I imported with 24,000 business names and
addresses. I can't figure out how to separate them into different cells because
no commas exist and the some businesses have multiple spaces in the name.
Here is an example of what is in each column. Each line is in a separate row.

P & S DELI GROCERY 730 COLUMBUS AVENUE New York NY 10025
ANGELIKA FILM CENTER 18 WEST HOUSTON STREET New York NY
10012 SHASHEMENE INT'L RESTAURA 195 EAST 56 STREET New York
NY 11203 CARVEL ICE CREAM 1006 EAST 233 STREET New York NY
10466 LEXLER DELI 405 LEXINGTON AVENUE New York NY 10174
SNACK TIME GRILL 87-69 LEFFERTS BOULEVARD New York NY 11418
MITCHEL LONDON FOODS 22 EAST 65 STREET New York NY 10065
SPOON BREAD CATERING 364 WEST 110 STREET New York NY 10025
TERMINAL CAFE/YANKEE CLIPPER 0 GUARDIA AIRPORT PARKING
New York NY 11371 PLAZA BAGELS & DELI 73 NEW DORP PLAZA New
York NY 10306 B & M HOT BAGEL & GROCERY 203 GIFFORDS LANE
New York NY 10308 TEXAS ROTISSERIE 94 FULTON STREET New York
NY 10038 Answer
One easy way to get going is to use the `Text to Columns function under the
Data tab.
Highlight your cells that you want to split up, and click "Text to Columns".
Choose a Delimiter, click "Next", then choose "Space".
Now, it'll take a word, put it in a cell, then take the next word (after a space),
and put it in the cell next to that, etc.
The problem I forsee is this isn't going to be a one shot solution. As you
mention, the restaurant names can be one word, of up to infinity words. Unless
you see some logic in how it's spread out, I think this is your best bet.
For instance, is it safe to assume that if we are reading from left to right, and
come across a number, that number starts the address and all preceding text is
the restaurant name? ...I doubt it actually, what if my restaurant is called
"Bruce's 21 Jump Street Eatery"? As @Johankr points out, this is probably
more rare, but you should be aware of this possibility if you're just going to run
the macro, save and close (without any human review). You could get a list of
major cities, zip codes, etc. and use that to help parse through though and
determine where the address starts/ends.
Answer

Copy it an paste into Google Spreadsheet and then use regular expressions
(REGEXEXTRACT).
So for example to extract everything before the number use:
=REGEXEXTRACT(A1, "(\D*)\d")
It will extract P & S DELI GROCERY. Then to get the number use:
=REGEXEXTRACT(A1, "\D+(\d+)\D*")
It will get you 730. And so on...
Answer
This vba Should work for most of what you want:
Sub splitaddress()
Dim ws As Worksheet
Dim rng As Range
Dim oArr() As Variant
Dim lastrow As Long
Dim spltstr() As String
Dim i As Long
Dim j As Long
Dim h As Boolean
Set ws = Sheets("Sheet1")'Change to your sheet name. lastrow =
ws.Range("A" & ws.Rows.Count).End(xlUp).Row ReDim oArr(1 To lastrow,
1 To 5)
j = 1
h = False
For Each rng In ws.Range("A1:A" & lastrow)
spltstr = Split(rng)
For i = LBound(spltstr) To UBound(spltstr) 
      If i = UBound(spltstr) Then 

          oArr(j, 5) = spltstr(i) 
      ElseIf i = UBound(spltstr) - 1 Then 
          oArr(j, 4) = spltstr(i) 
      ElseIf Not h And spltstr(i) = UCase(spltstr(i)) And
InStr("1234567890", Left(spltstr(i), 1)) = 0 Then 
          oArr(j, 1) = oArr(j, 1) & spltstr(i) & " " 
      ElseIf InStr("1234567890", Left(spltstr(i), 1)) > 0 Or
(h And spltstr(i) = UCase(spltstr(i))) Then 
          h = True 
          oArr(j, 2) = oArr(j, 2) & spltstr(i) & " " 
      ElseIf spltstr(i) <> UCase(spltstr(i)) Then 
          oArr(j, 3) = oArr(j, 3) & spltstr(i) & " " 
      End If 
Next i
oArr(j, 1) = Trim(oArr(j, 1))
oArr(j, 2) = Trim(oArr(j, 2))
oArr(j, 3) = Trim(oArr(j, 3))
h = False
j = j + 1
Next rng
ws.Range("B1").Resize(lastrow, 5).Value = oArr
End Sub
If the street address does not start with a number it will not work.
Answer
If all the contacts only exists as a string, i.e. all data in the same cell, no
solution is likely to be able to be able to split all contacts properly.
Here are some starting points though, all based on the assumption that the rest
of the data looks fairly similar at least.
Very few business are likely to contain numbers in the names, so you can
probably safely split address using the first occurance of a number as the
divider between name and adress. Create a lookup table for State and
abbreviation. Should be possible to split the adress part of the string into two

parts/lines using that.
Answer
Assumptions: The City is always = "New York"; the State is always = "NY".
Place your data in column A starting at row 2. In columns C thru L, at row 1,
type numbers 0 to 9, where each column gets 1 of the digits (0,1,2 ... 9).
Paste the following into cell C2:
=IF(TYPE(FIND(C$1,$A2,1))=16,LEN($A2),FIND(C$1,$A2,1)) Select and
copy cell C2, select range D2:L2 and paste the copied formula from cell B2.
Paste the following into cell B2: =MIN(C2:L2) Paste the following into cell
M2: =TRIM(MID(A2,1,B2-1)) Paste the following into cell N2:
=TRIM(MID(A2,B2,FIND("New York_ NY",A2,1)-1-B2))
Type "New York" in cell O2.
Type "NY" in cell P2.
Paste the following into cell Q2: =RIGHT(A2,5) Next select copy range
B2:Q2 and paste it in rows B3 to end of your data.
Topic 934
Subject
VBA Excel to Mac - file path
Question
The person that previously had my job used VBA in Excel on PC to create
reports to track the finances in the office. It takes info from multiple
workbooks. I would like to run it on a Mac. I moved all the relevant files to my
computer. I know I need to update the file paths but I am lost even doing that.
The current file path looks like:
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFSPPSUM - " & SpecifiedDate & ".xls")
I have copied the path from my Mac using Get Info. Would this be correct?
Application.Workbooks.Open ("/Users/robert/Documents/Reporting/Dept
MathCS Financials/Accounting Files/Dept. Fund Tracking/Daily Compass
Report Files/" & "CFSPPSUM - " & SpecifiedDate & ".xls")

OS X El Capitan Version 10.11.3
Microsoft Excel for Mac 2011 Version 14.5.9
Below is the code from the main module.
Sub Test()
Application.ScreenUpdating = False
Application.Calculation = xlCalculationManual
Dim i As Integer
i = 6
Dim SpecifiedDate As String
SpecifiedDate = Cells(4, ActiveCell.Column) SpecifiedDate =
Format(SpecifiedDate, "mm/dd/yyyy") SpecifiedDate =
Replace(SpecifiedDate, "/", "-")
Dim TWB As Workbook
Set TWB = ThisWorkbook
Col = ActiveCell.Column
'CFSPPSUM Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFSPPSUM - " & SpecifiedDate & ".xls")
While TWB.Worksheets("Import-Data").Cells(i, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(i, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(i, 3).Value, _ Workbooks("CFSPPSUM - " & SpecifiedDate &
".xls").Worksheets("Output Data Sheet").Range("$E$9:$AA$100"), 23, False)
i = i + 1
Wend

Cells(6, ActiveCell.Column).Select
Windows("CFSPPSUM - " & SpecifiedDate & ".xls").Close (False)
Application.Calculation = xlCalculationAutomatic
Application.ScreenUpdating = True
End Sub
Sub Test_Final_Build()
Application.ScreenUpdating = False
Application.Calculation = xlCalculationManual
If ActiveCell.Row = 6 Then
Dim SpecifiedDate As String
SpecifiedDate = Cells(4, ActiveCell.Column) SpecifiedDate =
Format(SpecifiedDate, "mm/dd/yyyy") SpecifiedDate =
Replace(SpecifiedDate, "/", "-")
Dim TWB As Workbook
Set TWB = ThisWorkbook
Col = ActiveCell.Column
Dim NSPLoc As String, NSPL As Integer
NSPLoc = Application.WorksheetFunction.Match("NSP SUM",
Range("B1:B200"), 0) NSPL = NSPLoc
Dim D831020Loc As String, D831020L As Integer D831020Loc =
Application.WorksheetFunction.Match("Dept. 831020", Range("B1:B200"), 0)
D831020L = D831020Loc
Dim SPPISUMLoc As String, SPPISUML As Integer, NSPISUMLoc As String,
NSPISUML As Integer SPPISUMLoc =
Application.WorksheetFunction.Match("SPP I-SUM", Range("C1:C200"), 0)
SPPISUML = SPPISUMLoc
NSPISUMLoc = Application.WorksheetFunction.Match("NSP I-SUM",
Range("C1:C200"), 0) NSPISUML = NSPISUMLoc

Dim i As Integer, j As Integer, k As Integer, l As Integer, m As Integer, n As
Integer, o As Integer, p As Integer, q As Integer, r As Integer, s As Integer, t As
Integer, u As Integer i = 6 'SPP Sum Location
j = 6 'NSP Sum Location
k = 6
l = 6
m = 6
n = 6
o = 6
p = 6
q = 6
r = 6
s = 6
t = 6
u = 6
'CFNSPSUM Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPSUM - " & SpecifiedDate & ".xls") While
TWB.Worksheets("Import-Data").Cells(j, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(j, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(j, 3).Value, _ Workbooks("CFNSPSUM - " & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$11:$BI$150"), 57, False) j = j + 1
Wend 
  Windows("CFNSPSUM - " & SpecifiedDate & ".xls").Activate  
 'Sum Total Check Figure Import 
      Sheets("Sheet1").Select 
          Range("BI106").Copy 
  TWB.Sheets("Import-Data").Activate 
      Cells(NSPISUML, ActiveCell.Column).PasteSpecial
xlPasteValues 
Windows("CFNSPSUM - " & SpecifiedDate & ".xls").Close (False)

'CFSPPSUM Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFSPPSUM - " & SpecifiedDate & ".xls") While
TWB.Worksheets("Import-Data").Cells(i, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(i, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(i, 3).Value, _ Workbooks("CFSPPSUM - " & SpecifiedDate &
".xls").Worksheets("Output Data Sheet").Range("$E$9:$AA$100"), 23, False)
i = i + 1
Wend
Windows("CFSPPSUM - " & SpecifiedDate & ".xls").Activate 'Sum Total
Check figure import
Sheets("Output Data Sheet").Select
Range("AA80").Copy
TWB.Sheets("Import-Data").Activate
Cells(SPPISUML, ActiveCell.Column).PasteSpecial xlPasteValues
Windows("CFSPPSUM - " & SpecifiedDate & ".xls").Close (False)
'Dept. 831020 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "Dept. 831020 - " & SpecifiedDate & ".xls") While
TWB.Worksheets("Import-Data").Cells(k, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(k, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(k, 3).Value, _ Workbooks("Dept. 831020 - " & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$10:$AY$100"), 47, False) k = k + 1
Wend
Windows("Dept. 831020 - " & SpecifiedDate & ".xls").Close (False)

'Dept. 831021 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "Dept. 831021 - " & SpecifiedDate & ".xls") While
TWB.Worksheets("Import-Data").Cells(l, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(l, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(l, 3).Value, _ Workbooks("Dept. 831021 - " & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$10:$AY$100"), 47, False) l = l + 1
Wend
Windows("Dept. 831021 - " & SpecifiedDate & ".xls").Close (False)
'Dept. 831022 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "Dept. 831022 - " & SpecifiedDate & ".xls") While
TWB.Worksheets("Import-Data").Cells(m, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(m, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(m, 3).Value, _ Workbooks("Dept. 831022 - " & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$10:$AY$100"), 47, False) m = m + 1
Wend
Windows("Dept. 831022 - " & SpecifiedDate & ".xls").Close (False)
'Dept. 831023 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "Dept. 831023 - " & SpecifiedDate & ".xls") While
TWB.Worksheets("Import-Data").Cells(n, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(n, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(n, 3).Value, _ Workbooks("Dept. 831023 - " & SpecifiedDate &

".xls").Worksheets("Sheet1").Range("$E$10:$AY$100"), 47, False) n = n + 1
Wend
Windows("Dept. 831023 - " & SpecifiedDate & ".xls").Close (False)
'CFNSPS01 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS01 - PROVOST BAYH-DOLE RESTRICTED S" &
SpecifiedDate & ".xls") While TWB.Worksheets("Import-Data").Cells(o,
3).Value <> "END" On Error Resume Next
TWB.Worksheets("Import-Data").Cells(o, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(o, 3).Value, _ Workbooks("CFNSPS01 - PROVOST BAYH-
DOLE RESTRICTED S" & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57, False)
= o + 1 Wend Windows("CFNSPS01 - PROVOST BAYH-DOLE
RESTRICTED S" & SpecifiedDate & ".xls").Close (False)
'CFNSPS02 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS02 - N16 SCIENCE HIRE INITIATIVE" &
SpecifiedDate & ".xls") While TWB.Worksheets("Import-Data").Cells(p,
3).Value <> "END" On Error Resume Next
TWB.Worksheets("Import-Data").Cells(p, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(p, 3).Value, _ Workbooks("CFNSPS02 - N16 SCIENCE HIRE
INITIATIVE" & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57, False) p = p + 1
Wend
Windows("CFNSPS02 - N16 SCIENCE HIRE INITIATIVE" & SpecifiedDate
& ".xls").Close (False)
'CFNSPS03 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept

MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS03 - MICHELANGELO GRIGNI START-UP F" &
SpecifiedDate & ".xls") While TWB.Worksheets("Import-Data").Cells(q,
3).Value <> "END" On Error Resume Next
TWB.Worksheets("Import-Data").Cells(q, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(q, 3).Value, _ Workbooks("CFNSPS03 - MICHELANGELO
GRIGNI START-UP F" & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57, False) q = q + 1
Wend
Windows("CFNSPS03 - MICHELANGELO GRIGNI START-UP F" &
SpecifiedDate & ".xls").Close (False)
'CFNSPS04 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS04 - CLS J Taylor" & SpecifiedDate & ".xls")
While TWB.Worksheets("Import-Data").Cells(r, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(r, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(r, 3).Value, _ Workbooks("CFNSPS04 - CLS J Taylor" &
SpecifiedDate & ".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57,
False) r = r + 1
Wend
Windows("CFNSPS04 - CLS J Taylor" & SpecifiedDate & ".xls").Close
(False)
'CFNSPS05 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS05 - Equipment - Taylor" & SpecifiedDate &
".xls") While TWB.Worksheets("Import-Data").Cells(s, 3).Value <> "END"
On Error Resume Next
TWB.Worksheets("Import-Data").Cells(s, Col) =

Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(s, 3).Value, _ Workbooks("CFNSPS05 - Equipment - Taylor" &
SpecifiedDate & ".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57,
False) s = s + 1
Wend
Windows("CFNSPS05 - Equipment - Taylor" & SpecifiedDate & ".xls").Close
(False)
'CFNSPS06 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS06 - SOM Equipment" & SpecifiedDate & ".xls")
While TWB.Worksheets("Import-Data").Cells(t, 3).Value <> "END" On Error
Resume Next
TWB.Worksheets("Import-Data").Cells(t, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(t, 3).Value, _ Workbooks("CFNSPS06 - SOM Equipment" &
SpecifiedDate & ".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57,
False) t = t + 1
Wend
Windows("CFNSPS06 - SOM Equipment" & SpecifiedDate & ".xls").Close
(False)
'CFNSPS07 Data Transfer
Application.Workbooks.Open ("C:\Users\Chris Treeman\My Documents\Dept
MathCS Financials\Accounting Files\Dept. Fund Tracking\Daily Compass
Report Files\" & "CFNSPS07 - JACKSON MATH AND SCIENCE FUND" &
SpecifiedDate & ".xls") While TWB.Worksheets("Import-Data").Cells(u,
3).Value <> "END" On Error Resume Next
TWB.Worksheets("Import-Data").Cells(u, Col) =
Application.WorksheetFunction.VLookup(TWB.Worksheets("Import-
Data").Cells(u, 3).Value, _ Workbooks("CFNSPS07 - JACKSON MATH AND
SCIENCE FUND" & SpecifiedDate &
".xls").Worksheets("Sheet1").Range("$E$11:$BI$200"), 57, False) u = u + 1
Wend
Windows("CFNSPS07 - JACKSON MATH AND SCIENCE FUND" &

SpecifiedDate & ".xls").Close (False)
TWB.Sheets("Import-Data").Activate
Cells(6, CLoc).Select
TWB.Sheets("Dept. NSPs & SPPs").Activate Application.Calculation =
xlCalculationAutomatic Columns(ActiveCell.Column).AutoFit
Else
MsgBox ("Please select the correct cell for Import") End If
Application.ScreenUpdating = True
End Sub
Topic 935
Subject
How to use range of column found using array as input and compare the range
to a number to get output as “true” or “false” in a different column?
Question
In the below code I found the column number of the values in the array. How to
use that range to compare values to a with a variable?
Public Sub JpFee() 
      Dim rng As Range, rws As Long, w As Long, Str As
Variant, Count As Integer, x(20) As Integer, Lt() As Variant,
ht As Variant, Wdt As Variant, W8t As Variant 
      Dim row1, i, y As Integer 
      row1 = ActiveSheet.UsedRange.Rows.Count 
      MsgBox row1 
      Str = Array("length (cm)", "width (cm)", "height (cm)",
"unit weight(kg)", "surface area L+W+H", "size") 
      For w = LBound(Str) To UBound(Str) 
      Set rng = Rows("1:1").Find(What:=Str(w),
LookAt:=xlWhole, MatchCase:=False) 
      x(i) = rng.Column 

      i = i + 1 
      MsgBox rng.Column 
      Next w 
End Sub
Answer
I would use a collection for something like this. You could also use a
dictionary. (Whichever you prefer).
Here's an example of using a collection with what you're trying to do:
Sub tgr()
Dim ws As Worksheet
Dim HeaderCell As Range
Dim cHeaders As Collection
Set ws = ActiveWorkbook.ActiveSheet Set cHeaders = New Collection
On Error Resume Next 'Collections will error if there are duplicates, this
prevents that error
'Loop through each headercell
For Each HeaderCell In ws.Range("A1").CurrentRegion.Resize(1).Cells 
      'If the headercell contains text, add its column number
to the collection and set the key to the headertext 
      If Len(HeaderCell.Text) > 0 Then cHeaders.Add
HeaderCell.Column, CStr(HeaderCell.Text) 
  Next HeaderCell 'Advance the loop 
  On Error GoTo 0         'Clear the On Error Resume Next
condition 
'Now you can get the column number of a known header by referencing the
header in your collection 'This will show the column number of the header
"size" 'Note that the header does not need to be case sensitive, but must be the
exact text MsgBox cHeaders("size")

'So if you want to put in a value in the bottom row of a column:
ws.Cells(ws.Rows.Count, cHeaders("size")).End(xlUp).Offset(1).Value = 2
End Sub
Topic 936
Subject
how to open a local excel file in a Xamrian iOS app using TMS FlexCel
Studio
Question
Hello I have a local excel document that I need to be able to open in a iOS app
i'm making. I also need to be able to add entries to the excel file from the
mobile app. I'm using Xamarin and the TMS FlexCel Studio component is the
best option to do this. I have a project set up and have the excel file project
added to the project as well as adding the TMS FlexCel Studio component to
my project. but I don't know how to load the excel project this is the current
code I have:
using FlexCel.Core;
using FlexCel.XlsAdapter;
using Foundation;
using System;
using System.CodeDom.Compiler;
using System.IO;
using UIKit;
namespace Justice_Compliance_Monitoring_App {
partial class SurveyView : UIViewController { 
      public SurveyView (IntPtr handle) : base (handle) 
      { 
      } 
      public override void ViewDidLoad() 
      { 
          XlsFile xls = new
XlsFile(System.IO.Path.Combine(Environment.GetFolderPath(Enviro

"servey.xlsx")); 
          xls.ActiveSheetByName = "Sheet1";  //we'll read
sheet1. We could loop over th existing sheets by using
xls.SheetCount and xls.ActiveSheet 
          for (int row = 1; row <= xls.RowCount; row++) 
          { 
              for (int colIndex = 1; colIndex <=
xls.ColCountInRow(row); colIndex++) //Don't use xls.ColCount
as it is slow: See Performance.Pdf 
              { 
                  int XF = -1; 
                  object cell = xls.GetCellValueIndexed(row,
colIndex, ref XF); 
                  TCellAddress addr = new TCellAddress(row,
xls.ColFromIndex(row, colIndex)); 
                  Console.Write("Cell " + addr.CellRef + "
has "); 
                  if (cell is TRichString)
Console.WriteLine("a rich string."); 
                  else if (cell is string)
Console.WriteLine("a string."); 
                  else if (cell is Double)
Console.WriteLine("a number."); 
                  else if (cell is bool) Console.WriteLine("a
bool."); 
                  else if (cell is TFlxFormulaErrorValue)
Console.WriteLine("an error."); 
                  else if (cell is TFormula)
Console.WriteLine("a formula."); 
                  else Console.WriteLine("Error: Unknown cell
type"); 
              } 
          } 
      } 
}
}
The app launches on the emulator but crashes on startup what am I doing
wrong?
Thanks in advance!

Topic 937
Subject
Compile Error, Next without for
Question
I am new to writing code in excel vba and I am receiving the compile error
Next Without For.....however I have a for and a next, could you please tell me
what I am doing wrong, please see my code below, thanks!
Dim i As Integer
For i = 19 To 49
If Cells(3, i) > 499999 Then
Cells(4, 3) = 499999
ElseIf Cells(3, i) < 499999 Then
Cells(4, 3) = Cells(3, i)
End If
If Cells(4, 3) < 499999 Then
Cells(4, 5) = 0
If Cells(3, i) > 999999 Then
Cells(4, 4) = 500000
ElseIf Cells(3, i) < 999999 Then
Cells(4, 4) = Cells(3, i) - 499999 End If
If Cells(4, 4) = 0 Then
Cells(4, 5) = 0
ElseIf Cells(3, i) > 1999999 Then
Cells(4, 5) = 1000000
ElseIf Cells(3, i) < 1999999 Then

Cells(4, 5) = Cells(3, i) - 999999 End If
If Cells(4, 5) = 0 Then
Cells(4, 6) = 0
ElseIf Cells(3, i) > 4999999 Then
Cells(4, 6) = 3000000
ElseIf Cells(3, i) < 4999999 Then
Cells(4, 6) = Cells(3, i) - 1999999 End If
If Cells(4, 6) = 3000000 Then
Cells(4, 7) = Cells(3, i) - 4999999 ElseIf Cells(4, 6) < 3000000 Then
Cells(4, 7) = 0
End If
Range(7, i).Value = (Cells(5, 3) + Cells(5, 4) + Cells(5, 5) + Cells(5, 6) +
Cells(5, 7)) / Cells(3, i)
Next i
End Sub
Answer
In the second If block, replace
If Cells(4, 3) < 499999 Then
Cells(4, 5) = 0
If Cells(3, i) > 999999 Then
with
If Cells(4, 3) < 499999 Then
Cells(4, 5) = 0

ElseIf Cells(3, i) > 999999 Then
This is what is confusing the VBA interpreter.
Answer
If Cells(4, 3) < 499999 Then
Cells(4, 5) = 0
If Cells(3, i) > 999999 Then *****needs to elseif
Cells(4, 4) = 500000
ElseIf Cells(3, i) < 999999 Then
Cells(4, 4) = Cells(3, i) - 499999 End If
You get a type mismatch with your code in the last If blcok
Topic 938
Subject
Excel conditional formatting same cell with a wild card
Question
Hi I would like to search cell A1 for the letter B if the letter b is there then
nothing else can be in the same cell and so the cell should change color. I
cannot get this to work this is the formula i have.
=AND(ISNUMBER(SEARCH("B",A1)), A1<>"")
but this doesnt work
please help.
Answer
=AND(ISNUMBER(SEARCH("B",A1)), LEN(A1)>1) will do it here ;) still
"BB" will also count... if you are only looking for "b" and something
"DIFFERENT" then you need this:
=AND(ISNUMBER(SEARCH("B",A1)),LEN(SUBSTITUTE(LOWER(A1),"b"

while it also can be written as:
=ISNUMBER(SEARCH("B",A1))*LEN(SUBSTITUTE(LOWER(A1),"b",""))
When using it as formula for conditional formatting
Topic 939
Subject
Calculate most recent payment date from multiple rows of payment information
in excel
Question
My data are in the following format:
This information is regarding accounts that have been outsourced to a
collection agency. As you can see, we have multiple rows for each agency, and
multiple rows for each date in which those accounts were withdrawn and
assigned. For example, the first agency, Bob Agency, was assigned on 3/12/15,
withdrawn on 6/12/15, and assigned to Carla Agency on 6/30/15. Each agency
is shown in a different column, and the first two corresponding columns in
"Agency Date" refer to their assignment and withdrawl. If the cells are blank,
that means that the accounts have not been withdrawn/assigned respectively.
I want to calculate the difference in days between when the account is assigned
to any given agency, and the date of the most recent assignment. So using the
previous example, the difference between 6/30/15 and 3/12/15.
My problem is that I can't work around the blank dates. Some accounts have
multiple assignments and withdrawals, and others have just one.
Thank you for your help!
Answer
Assuming column L is empty, place this formula there:
=IF(MAX(G2:K2)=0,TODAY()-F2,MAX(G2:K2)-F2)
It will calculate the most recent assignment date and subtract it from the initial
date. If no re-assignment date is there, it will use today's date.

Topic 940
Subject
Merging tables and arrays from multiple sheets into one consolidated table
Question
I am very new to VBA and struggling!
I've tried searching the forums but can't find anything close enough to my
situation...
I have 30+ sheets titled 001, 002 ...0nn I want to create a new sheet title
'Actions summary' I want this sheet to contain compiled information from each
sheet with sheet name '0nn' (or i tried limiting the code to sheet names that are
integers) - - From each sheet i want to copy the information from columns A to
G, And rows 9 to last row with information in. I would also like the heading
(A8:G8) at the top of the new 'actions summary' sheet.
SCREEN SHOT typical sheet 0nn format
Been going a bit mad and would really appreciate some simple help, ideally
the code required with explanations for what each bit is doing so i can learn.
My Attempt below:
Function LastRow(sh As Worksheet)
On Error Resume Next
LastRow = sh.Cells.Find(What:="*", _ 
                      After:=sh.Range("A1"), _ 
                      lookat:=xlPart, _ 
                      LookIn:=xlFormulas, _ 
                      SearchOrder:=xlByRows, _ 
                      SearchDirection:=xlPrevious, _ 
                      MatchCase:=False).Row 
On Error GoTo 0
End Function
Function LastCol(sh As Worksheet)

On Error Resume Next
LastCol = sh.Cells.Find(What:="*", _ 
                      After:=sh.Range("A1"), _ 
                      lookat:=xlPart, _ 
                      LookIn:=xlFormulas, _ 
                      SearchOrder:=xlByColumns, _ 
                      SearchDirection:=xlPrevious, _ 
                      MatchCase:=False).Column 
On Error GoTo 0
End Function
Sub CopyRangeFromMultiWorksheets()
Dim sh As Worksheet
Dim DestSh As Worksheet
Dim Last As Long
Dim CopyRng As Range
With Application
.ScreenUpdating = False
.EnableEvents = False
End With
' Delete the summary sheet if it exists. Application.DisplayAlerts = False
On Error Resume Next
ActiveWorkbook.Worksheets("Actions Summary").Delete On Error GoTo 0
Application.DisplayAlerts = True
' Add a new summary worksheet.
Set DestSh = ActiveWorkbook.Worksheets.Add DestSh.Name = "Actions
Summary"
' Loop through all worksheets and copy the data to the ' summary worksheet.
For Each sh In ActiveWorkbook.Worksheets
'If LCase(Left(sh.Name, 1)) = "0" Then If IsNumeric(sh.Name) = True Then
Debug.Print (sh.Name) 

      ' Find the last row with data on the summary worksheet.
      Last = LastRow(DestSh) 
      'LastRow = Cells.SpecialCells(xlCellTypeLastCell).Row 
Debug.Print (Last) 
      ' Specify the range to place the data. 
      Set CopyRng = sh.Range("A9").CurrentRegion 
      Set CopyRng = Range(Cells(9, 1), Cells(Last, 7)) 
      ' Test to see whether there are enough rows in the
summary 
      ' worksheet to copy all the data. 
      If Last + CopyRng.Rows.Count > DestSh.Rows.Count Then 
          MsgBox "There are not enough rows in the " & _ 
             "summary worksheet to place the data." 
          GoTo ExitTheSub 
      End If 
      ' This statement copies values and formats from each 
      ' worksheet. 
      CopyRng.Copy 
      With DestSh.Cells(Last + 1, "A") 
          .PasteSpecial xlPasteValues 
          .PasteSpecial xlPasteFormats 
          Application.CutCopyMode = False 
      End With 
      ' Optional: This statement will copy the sheet 
      ' name in the H column. 
      ' DestSh.Cells(Last + 1,
"H").Resize(CopyRng.Rows.Count).Value = sh.Name 
End If
Next
'ExitTheSub:
Application.Goto DestSh.Cells(1)
' AutoFit the column width in the summary sheet. DestSh.Columns.AutoFit
With Application
.ScreenUpdating = True

.EnableEvents = True
End With
End Sub
Sub selectA1_and_insertRow()
'
' selectA1_and_insertRow Macro
Worksheets("Actions Summary").Rows("1:1").Select Selection.Insert
Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove Selection.Insert
Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
Columns("B:B").ColumnWidth = 36.43
Rows("1:1").Select
'Range.Copy to other worksheets
Worksheets("001").Range("A8:G8").Copy Worksheets("Actions
Summary").Range("A1:G1")
End Sub
Many thanks in advance.
Tom
UPDATE: WHY ARE THE HEADINGS NOT COPYING ACROSS??
CODE
Here's the new code:
Sub UpDate_List_v2()
Dim wb As Workbook
Dim ws As Worksheet
Dim wsSum As Worksheet
Dim rLastCell As Range
Dim lCalc As XlCalculation
Dim bHasHeaders As Boolean
'Turn off calculation, events, and screenupdating 'This allows the code to run

faster and prevents "screen flickering" With Application
lCalc = .Calculation
.Calculation = xlCalculationManual
.EnableEvents = False
.ScreenUpdating = False
End With
Set wb = ActiveWorkbook
'Check if Actions Summary sheet exists already or not On Error Resume Next
Set wsSum = wb.Sheets("Actions summary") On Error GoTo 0
If wsSum Is Nothing Then
'Does not exist, create it
Set wsSum = wb.Sheets.Add(Before:=wb.Sheets(1)) wsSum.Name = "Actions
summary"
bHasHeaders = False
Else
'Already exists, clear previous data wsSum.UsedRange.Offset(1).Clear
bHasHeaders = True
End If
'Loop through all sheets in the workbook For Each ws In wb.Sheets
'Only look for worksheets whose names are numbers (e.g. "001", "002", etc) If
IsNumeric(ws.Name) Then 
      'Check if the "Actions Summary" sheet already has
headers 
      If bHasHeaders = False Then 
          'Does not have headers yet 
          With ws.Range("A8:M8") 
              'Check if this sheet has headers in A8:G8 
              If WorksheetFunction.CountBlank(.Cells) = 0
Then 
                  'This sheet does have headers, copy them
over 
                  .Copy wsSum.Range("A1") 

                  bHasHeaders = True 
              End If 
          End With 
      End If 
      'Find the last row of the sheet 
      Set rLastCell = ws.Cells.Find("*", ws.Range("A1"),
SearchDirection:=xlPrevious) 
      If Not rLastCell Is Nothing Then 
          'Check if the last row is greater than the header
row 
          If rLastCell.Row > 8 Then 
              'Last row is greater than the header row so
there is data 
                              'Check if the "Actions Summary"
sheet has enough rows to hold the data 
                              If
wsSum.Cells(wsSum.Rows.Count, "A").End(xlUp).Row +
rLastCell.Row - 8 > wsSum.Rows.Count Then 
                                  'Not enough rows, return
error and exit the subroutine 
                                  MsgBox "There are not
enough rows in the summary worksheet to place the data.", ,
"Data Overflow" 
                                  Exit Sub 
                              Else 
                  'Does have enough rows, copy the data -
Values 
                  ws.Range("A9:M" & rLastCell.Row).Copy 
                  With wsSum.Cells(wsSum.Rows.Count,
"A").End(xlUp).Offset(1) 
                      .PasteSpecial xlPasteValues 
                      .PasteSpecial xlPasteFormats 
                  End With 
              End If 
          End If 
      End If 
End If
Next ws 
  'Sheets("Actions
summary").Columns("H:L").EntireColumn.Delete       'Delete
unwanted columns 
  'Sheets("Actions summary").Columns("H:L").Hidden = True    
        'Hide unwanted columns 

Worksheets("Actions summary").Columns("H:j").Hidden = True
Worksheets("Actions summary").Columns("L").Hidden = True Sheets("Actions
summary").Columns("H").Style = "currency" 'Set to £
Application.CutCopyMode = False 'Remove the cut/copy border
'wsSum.Range("A1").CurrentRegion.EntireColumn.AutoFit 'Autofit columns
on the "Actions Summary" sheet
'Turn calculation, events, and screenupdating back on With Application
.Calculation = lCalc
.EnableEvents = True
.ScreenUpdating = True
End With
End Sub
Answer
Something like this should work for you. I have commented the code for
clarity.
Sub tgr()
Dim wb As Workbook
Dim ws As Worksheet
Dim wsSum As Worksheet
Dim rLastCell As Range
Dim lCalc As XlCalculation
Dim bHasHeaders As Boolean
'Turn off calculation, events, and screenupdating 'This allows the code to run
faster and prevents "screen flickering" With Application 
      lCalc = .Calculation 
      .Calculation = xlCalculationManual 
      .EnableEvents = False 
      .ScreenUpdating = False 

End With
Set wb = ActiveWorkbook
'Check if Actions Summary sheet exists already or not On Error Resume Next
Set wsSum = wb.Sheets("Actions summary") On Error GoTo 0
If wsSum Is Nothing Then 
      'Does not exist, create it 
      Set wsSum = wb.Sheets.Add(Before:=wb.Sheets(1)) 
      wsSum.Name = "Actions summary" 
      bHasHeaders = False 
  Else 
      'Already exists, clear previous data 
      wsSum.UsedRange.Offset(1).Clear 
      bHasHeaders = True 
End If
'Loop through all sheets in the workbook For Each ws In wb.Sheets 
      'Only look for worksheets whose names are numbers (e.g.
"001", "002", etc) 
      If IsNumeric(ws.Name) Then 
          'Check if the "Actions Summary" sheet already has
headers 
          If bHasHeaders = False Then 
              'Does not have headers yet 
              With ws.Range("A8:G8") 
                  'Check if this sheet has headers in A8:G8 
                  If WorksheetFunction.CountBlank(.Cells) = 0
Then 
                      'This sheet does have headers, copy
them over 
                      .Copy wsSum.Range("A1") 
                      bHasHeaders = True 
                  End If 
              End With 
          End If 
          'Find the last row of the sheet 
          Set rLastCell = ws.Cells.Find("*", ws.Range("A1"),
SearchDirection:=xlPrevious) 

          If Not rLastCell Is Nothing Then 
              'Check if the last row is greater than the
header row 
              If rLastCell.Row > 8 Then 
                  'Last row is greater than the header row so
there is data 
                  'Check if the "Actions Summary" sheet has
enough rows to hold the data 
                  If wsSum.Cells(wsSum.Rows.Count,
"A").End(xlUp).Row + rLastCell.Row - 8 > wsSum.Rows.Count Then
                      'Not enough rows, return error and exit
the subroutine 
                      MsgBox "There are not enough rows in
the summary worksheet to place the data.", , "Data Overflow" 
                      Exit Sub 
                  Else 
                      'Does have enough rows, copy the data -
Values 
                      ws.Range("A9:G" & rLastCell.Row).Copy 
                      With wsSum.Cells(wsSum.Rows.Count,
"A").End(xlUp).Offset(1) 
                          .PasteSpecial xlPasteValues 
                          .PasteSpecial xlPasteFormats 
                      End With 
                  End If 
              End If 
          End If 
      End If 
Next ws
Application.CutCopyMode = False 'Remove the cut/copy border
wsSum.Range("A1").CurrentRegion.EntireColumn.AutoFit 'Autofit columns on
the "Actions Summary" sheet
'Turn calculation, events, and screenupdating back on With Application 
      .Calculation = lCalc 
      .EnableEvents = True 
      .ScreenUpdating = True 
End With

End Sub
Topic 941
Subject
Reworking an existing macro into a for loop
Question
I have an Excel macro to analyze data pulled from a webpage. I study water
quality and run a monitoring network. At these sites I have automated water
samplers that fire off during storms.
I use this macro to pull descriptive data from our website. It was originally set
up in a static manner creating a new sheet for each site (there are 9 sites in
total) and the code is long and repetitive. I want to rewrite it using a for loop
to have a relatively small amount of code that executes for each site and returns
the same information in the same format that I already have setup.
There are several parts to the original script that are essentially hard-coded for
each site in that they have the site name and number.
I want to make the site numbers and names swap in a new one each time the for
loop goes through.
I have a web URL in the code, which is the same for each site except for the
site number at the end.
How can I keep that as a URL but substitute the site number during each for
loop iteration? How do I define my list of site numbers and names?
The old macro starts by making a sheet("sheet1").select ... and then runs
through the rest of the code. The next site is hard coded as
sheet("sheet2").select , etc.
I assume I will need to redo this so each iteration of the loop creates the next
numbered sheet in sequence.
Below is a sample of the code I am working with:
Workbooks.Add

Worksheets.Add().Name = "Rivers Ridge Summary"
Worksheets.Add().Name = "Sheppard Data" Worksheets.Add().Name =
"Sheppard Summary" Worksheets.Add().Name = "Lucas Creek Data"
Worksheets.Add().Name = "Lucas Creek Summary" Worksheets.Add().Name =
"Ramsgate Data" Worksheets.Add().Name = "Ramsgate Summary"
Worksheets.Add().Name = "Professional Place Data" Worksheets.Add().Name
= "Professional Place Summary"
Sheets("Sheet1").Select
Sheets("Sheet1").Name = "Rivers Ridge Data" Sheets("Rivers Ridge
Data").Select
With ActiveSheet.QueryTables.Add(Connection:=
"URL;72199=on&cb_63680=on&cb_99234=on&format=rdb&period=1&site_n
cb_72199=on&cb_63680=on&cb_99234=on&format=rdb&period=1&site_no=
_ , Destination:=Range("$A$1"))
.Name = 
"uv?
cb72199=on&cb_63680=on&cb_99234=on&format=rdb&period=1&site_no=0
...etc. etc.. all the rest of the code here.. and then the next site
Sheets("Sheppard Data").Select
With ActiveSheet.QueryTables.Add(Connection:=
"URL;72199=on&cb_63680=on&cb_99234=on&format=rdb&period=1&site_n
cb_72199=on&cb_63680=on&cb_99234=on&format=rdb&period=1&site_no=
_ , Destination:=Range("$A$1"))
.Name = 
"uv?
cb72199=on&cb_63680=on&cb_99234=on&format=rdb&period=1&site_no=0
..followed by all of the code...
and so on for each site..

"rivers Ridge Data" is one site (Sheppard is another), and "0204279245" is the
site number. I want these to swap out during each iteration of the loop.
Please follow up if you need more information or a sample of what I am
working on. Answer
I would suggest using a setup tab with 2 columns, the site name and site
number. Then you can loop through that list. In the loop, you can create data
and summary sheets, then concatenate the number into the web address. It might
look something like this.
Sub CollectAndReport()
Dim sWeb as string, sWeb2 as string
Dim i as integer
Dim sName as String
sWeb="www.google.com"
For i =2 to 10
sName = Sheets("Setup").Range("A"&i).Value Worksheets.add sName
sWeb2 = sWeb & Sheets("Setup").("B"& i).Value
...your other code here
Next i
End Sub
Topic 942
Subject
Communicating data between all users with a database
Question
I'm currently working on a program for my company that will be used to
communicate various information between users, among other things that aren't
important at the moment. One of the things that is going to be communicated is
a daily tasks checklist. Basically, the intent is to have a check list that syncs
between all users, so if one user checks off a task, everyone else can see that

the task has been completed.
So far what I have done is I have created a DataGrid object to hold the check
boxes. The box starts empty, but when the program loads, the following code is
run, which populates the list.
Private Sub chkListPop()
If System.IO.File.Exists(chkListPath) Then 
      Dim newChk As CheckBox 
      Dim xlApp As Microsoft.Office.Interop.Excel.Application
      Dim xlWorkBooks As
Microsoft.Office.Interop.Excel.Workbook 
      Dim xlWorkSheet As
Microsoft.Office.Interop.Excel.Worksheet 
      Dim rng As Microsoft.Office.Interop.Excel.Range 
      Dim r As Byte 
      xlApp = New Microsoft.Office.Interop.Excel.Application 
      xlWorkBooks = xlApp.Workbooks.Open(chkListPath) 
      xlWorkSheet = xlWorkBooks.Worksheets("Tasks") 
      rng = xlWorkSheet.Range("A2") 
      r = 0 
      Do While rng.Offset(r).Value <> "" 
          chkListContainer.Items.Add(New Controls.CheckBox) 
          newChk = chkListContainer.Items.Item(r) 
          newChk.Content = rng.Offset(r).Value 
          Try 
              If rng.Offset(r, 1).Value = True Then 
                  newChk.IsChecked = True 
              End If 
          Catch 
          End Try 
          r = r + 1 
      Loop 
      xlApp.DisplayAlerts = False 
      xlWorkBooks.Save() 
      xlWorkBooks.Close() 
      xlApp.DisplayAlerts = True 
      xlApp.Quit() 
End If
End Sub

Basically, the sub reads an excel file and, for each line in the file, creates a
checkbox with the true false value in the second column. I imagine there has to
be a more elegant solution to do this. I am not a programmer by training, so I
have limited knowledge on topics this "complex". Whats a better way to do
this other than using an excel file? Should I use an Access database or and SQL
database instead? This code works, but I just feel like its wrong somehow.
Additionally, I am having trouble figuring out how to update the file when
someone checks off a task. For now I just have a timer running, and every X
minutes, the program updates the excel file. Here's the code for how that
works:
Public Sub chkListSendData()
If System.IO.File.Exists(chkListPath) Then 
      Dim newChk As CheckBox 
      Dim xlApp As Microsoft.Office.Interop.Excel.Application
      Dim xlWorkBooks As
Microsoft.Office.Interop.Excel.Workbook 
      Dim xlWorkSheet As
Microsoft.Office.Interop.Excel.Worksheet 
      Dim rng As Microsoft.Office.Interop.Excel.Range 
      Dim r As Byte 
      xlApp = New Microsoft.Office.Interop.Excel.Application 
      xlWorkBooks = xlApp.Workbooks.Open(chkListPath) 
      xlWorkSheet = xlWorkBooks.Worksheets("Tasks") 
      rng = xlWorkSheet.Range("A2") 
      r = 0 
      Do While rng.Offset(r).Value <> "" 
          Try 
              newChk = chkListContainer.Items.Item(r) 
          Catch 
              chkListContainer.Items.Add(New
Controls.CheckBox) 
              newChk = chkListContainer.Items.Item(r) 
              newChk.Content = rng.Offset(r).Value 
          End Try 
          If newChk.IsChecked Then 
              rng.Offset(r, 1).Value = True 
          End If 
          r = r + 1 
      Loop 
      xlApp.DisplayAlerts = False 

      xlWorkBooks.Save() 
      xlWorkBooks.Close() 
      xlApp.DisplayAlerts = True 
      xlApp.Quit() 
End If
End Sub
Public Sub chkListGetData()
If System.IO.File.Exists(chkListPath) Then 
      Dim newChk As CheckBox 
      Dim xlApp As Microsoft.Office.Interop.Excel.Application
      Dim xlWorkBooks As
Microsoft.Office.Interop.Excel.Workbook 
      Dim xlWorkSheet As
Microsoft.Office.Interop.Excel.Worksheet 
      Dim rng As Microsoft.Office.Interop.Excel.Range 
      Dim r As Byte 
      xlApp = New Microsoft.Office.Interop.Excel.Application 
      xlWorkBooks = xlApp.Workbooks.Open(chkListPath) 
      xlWorkSheet = xlWorkBooks.Worksheets("Tasks") 
      rng = xlWorkSheet.Range("A2") 
      r = 0 
      Do While rng.Offset(r).Value <> "" 
          Try 
              newChk = chkListContainer.Items.Item(r) 
          Catch 
              chkListContainer.Items.Add(New
Controls.CheckBox) 
              newChk = chkListContainer.Items.Item(r) 
              newChk.Content = rng.Offset(r).Value 
          End Try 
          Try 
              If rng.Offset(r, 1).Value = True Then 
                  newChk.IsChecked = True 
              End If 
          Catch 
          End Try 
          r = r + 1 
      Loop 
      xlApp.DisplayAlerts = False 
      xlWorkBooks.Close() 

      xlApp.DisplayAlerts = True 
      xlApp.Quit() 
End If
End Sub
Private Sub chkTimer()
Dim dispatcherTimer As DispatcherTimer = New DispatcherTimer()
AddHandler dispatcherTimer.Tick, AddressOf OnTimedEvent
dispatcherTimer.Interval = New TimeSpan(0, 1, 0) dispatcherTimer.Start()
End Sub
Private Sub OnTimedEvent(ByVal sender As Object, ByVal e As EventArgs)
chkListGetData()
chkListSendData()
End Sub
In my testing, this has worked fine, but I have a feeling that when lots of people
are using the program, this will not work so well when multiple people attempt
to update the file at the same time. If I'm wrong and this code is perfect, that's
great, but I doubt that is the case. If there's a better way to handle this kind of
thing, I would love to learn how to implement it in this program.
Thanks, in advance, for your help.
Topic 943
Subject
Fill down based on contents of adjacent cell or other sheet
Question
I have data in Column A, from A5 to A50 but the end point is subject to
change.
I want to select B5 to Y5 and fill down to the end of column A (in this case to
row 50, but this will change every time).

The amount of rows depends on another sheet.
As an alternative to my question above, is there is a way to go to the other
sheet, and count the rows in column A, from A4 down and then fill down in my
other sheet that amount?
Summary
- I have one sheet with the data, starting at A4 and going down for an amount
that will be changing.
I would like to fill down on another sheet the number of rows there are in
the first sheet.
Edit
The code I tried with macro recorder is listed below. Right now it just selects
the area that I need for this case. The A5:Y5 Select will always be the same
but the amount of rows to fill down will be variable. I was hoping there is a
way to count A5:A1000 of another sheet and then just fill down that number of
rows.
Sub Macro1()
Macro1 Macro
Sheets("Stress Test").Select
Range("A5:Y5").Select
Range("A5:Y50").Select
Selection.FillDown
End Sub
Answer
Put the name of the other sheet into this and adjust as needed:
lastRow = Sheets("name of the other sheet").Cells.Find(What:="*", After:=
[A1], _ SearchOrder:=xlByRows, _
SearchDirection:=xlPrevious).Row
Range("A5:Y" & lastRow).Select

Topic 944
Subject
Excel workday calculation
Question
I am using the following formula for a workday calculation where GB bank
holidays are listed in sheet 'Bank Holidays' cell range B13:Z13.
=IF(F2<E2,IF(L2="GB",WORKDAY(E2,2,'Bank
Holidays'!B13:Z13)),IF(L2="GB",WORKDAY(F2,2,'Bank
Holidays'!B13:Z13)))
In the 'Bank Holidays' sheet I have 31 countries bank holidays listed across
rows, column A has the list Country codes, columns B to Z have the holiday
dates.
In my active worksheet ('ALL Data') I have rows of orders shipments including
the country code (column L).
What I would like to do is when calculating the workday I want to exclude the
holiday relevant to the country code.
In effect I need to do a vlookup using the country code on sheet 'ALL Data'
Column L to the holiday days listed against the same country code on sheet
'Bank Holidays' column A.
But vlookup only returns the first value found. Is there a type of vlookup that
will return all the dates against the relevant country code (range: column B:Z).
I believe an index match would work but, I'm not familiar with this and I
cannot get this to work. Answer
I actually OFFSET and MATCH would work easier for this particular case
(but maybe it's just how I think about things in Excel):
=OFFSET('Bank Holidays'!A1,MATCH(L2,'Bank Holidays'!A:A,0)-1,1,1,24)
will get you the specific holidays for the country code in L2 in the Bank
Holidays sheet.

So the entire formula becomes:
=IF(F2<E2,WORKDAY(E2,2,OFFSET('Bank
Holidays'!A1,MATCH(L2,'Bank
Holidays'!A:A,0)-1,1,1,24)),WORKDAY(F2,2,OFFSET('Bank
Holidays'!A1,MATCH(L2,'Bank Holidays'!A:A,0)-1,1,1,24)))
The 24 column width argument assumes no holiday dates go beyond column Z
for any given country.
Topic 945
Subject
Exporting data from specific Excel cells into XML file
Question
I want to export/read data from an Excel File into a XML-File. I already found
this article about that topic: Exporting data from Excel sheet into XML file
I tried this suggested solution:
http://www.codeproject.com/Articles/6950/Export-Excel-to-XML-in-VBA
My problem is that the data isn't available in one big uniform table. In the
Excel File there are different data blocks, headings and informations. So I have
to check the Excel-File for specific headings or cell names and then read the
data from the following cell containing the correlate number. Next I want to
save the numbers in an already existing XML-File with a specific xml-
structure. For a specific set of xml tags the already existing number should be
overwritten with the new excel cell value. At first I planned to write an c++
program which checks and reads the Excel file and after that writes in the xml
file. But I couldn't manage to read from specific cells in excel. Does anybody
have an idea how to solve my problem or what are the c++ commands
therefor? What's the best way to do it? I heard c++ might be too complicated
for that?
I'm not very experienced in programming, so I hope u can help me ;-)
Greetings

Topic 946
Subject
how to select particular cells in excel using VBA?
Question
im trying to select cell B4 and all the cells from column A to Z and row 10 and
below, so basically A10:Z150. And trying to unlocked it before i protect the
sheet. Right now im using Sheets("DR02").Range("B4", "A10:Z200").Locked
= False but its not working. Its only unlocking cells above row 4 instead of
only cell B4. Answer
Try to use:
With Sheets("DR02")
.Unprotect "password"
.Range("B4,A10:Z200").Locked = False .protect "password"
End With
Or (to get the last row in column "A"):
With Sheets("DR02")
.Unprotect "password"
.Range("B4,A10:Z" & .Range("A" & .Rows.Count).End(xlUp).Row).Locked =
False .protect "password"
End With
EDIT
From comments it seems that cell B4 is merged with other cells if so then we
can use:
With Sheets("DR02")
.Unprotect "password"
Union(.Range("B4").MergeArea, .Range("A10:Z" & .Range("A" &
.Rows.Count).End(xlUp).Row)).Locked = False .Protect "password"
End With
Answer

Union(Range("B4").MergeArea, Range("A10:Z" & Range("B" &
Rows.Count).End(xlUp).Row)).Locked = False
Topic 947
Subject
pear write() function doesn't unload all rows
Question
When I try to unload data to excel file with Spreadhset_Excel_Writer library, it
doesn't unload more than 10-15 rows..
$worksheet->write($line, 1, $row['line'],$fmt_text_mid); //this row is unload
to excel file
So, why this library doesn't upload more than 10-15 rows, what is wrong
here?!
Topic 948
Subject
VBScript to Open an Excel File and then do a Save As
Question
I am trying to write a vba script to automatically open an excel file increase the
day by one in a certain cell and then wait 2 minutes for all other field to
populate information from the current day. Once the other field are populated I
want the script to close the file and save as the day it ran the script. I am going
to add this script to windows task manager to run daily at 2 am. so far I have
something like this.
Set objExcel = CreateObject("Excel.Application") Set objWorkbook =
objExcel.Workbooks.Open("c:\Users\dr\Desktop\test.xlsx")
objExcel.Application.Visible = True
objExcel.Workbooks.Add
objExcel.Cells(3, 2).Value = "=today()"
WScript.Sleep 120000

wb.SaveAs Format( Now(), “DD-MMM-YY”) Answer
Not very sure to fully understand your question, but I already see one or 2
fixes:
Set objExcel = CreateObject("Excel.Application") Set objWorkbook =
objExcel.Workbooks.Open("c:\Users\dr\Desktop\test.xlsx")
objExcel.Application.Visible = True
'objExcel.Workbooks.Add
objWorkbook.Sheets("sheetName").Cells(3, 2).Value = "=today()"
WScript.Sleep 120000
objWorkbook.SaveAs "F" & format(date(), "yyyymmdd") & ".xlsm", 52
Anyway, changing the formula in B3 to "=Today()" everyday is totally useless,
since it was already that same formula the day before.
Edit: if you are running this from an Excel VBA procedure, you don't need to
create a new instance of Excel:
dim sFolder as string
sFolder = "c:\Users\dr\Desktop\"
Set objWorkbook = Workbooks.Open(sFolder & "test.xlsx")
objWorkbook.Sheets("sheetName").recalc
objWorkbook.SaveAs sFolder & format(date(), "yyyymmdd") & ".xlsx"
objWorkbook.Close
Answer
Your script needs to open the Workbook, then update the day, calculate
("populate the other cells"), save and close. My advice is to not use Sleep for
this, but just force the Workbook to calculate and then close it. Like @iDevlop
says: Changing the formula in B3 is unneccessary. The same goes for actually
showing the Excel application.
The following opens the workbook, recalculates (so the B3 value will be
today's date and the rest of the workbook will calculate accordingly), and

saves:
Set objExcel = CreateObject("Excel.Application") Set objWorkbook =
objExcel.Workbooks.Open("c:\Users\dr\Desktop\test.xlsx") objExcel.Calculate
objWorkbook.SaveAs Format( Now(), “DD-MMM-YY”)
For info on .calculate see https://msdn.microsoft.com/EN-
US/library/office/ff195517.aspx
Topic 949
Subject
named column range vba
Question
I was wondering if anyone could help. I have the following code below which
pulls information based on a specific condition ("Electric") in Column I from
the cost report ("i") into the Test sheet ("e"). I would like to avoid using the
static reference of column "I" and change it to my named reference "MPT"
within the sheet.
Public Sub Main()
Set i = Sheets("Cost Report")
Set e =Sheets ("Test")
Dim d
dim j
d = 1
j=2
Do until IsEmpty(i.Range("I" & j))
IF i.Range("I" & j) = "Electric" Then
d = d+1
e.rows(d).Value-i.Rows(j).Value
End if
j=j+1
Loop
End sub

I have tried to insert the code below and replace the reference of column "I"
with "IC" but can't get the macro to work.
Dim rG As Range
Dim IC AS Long
Set rG=Range("MPT")
IC=rG.Column
Do Until IsEmpty(i.Range("IC" & j))
If i.Range("IC" & j) = "Electric" Then
Answer
I am assuming that the MPT range only has 1 column. If not, let me know.
In this case, you can qualify the range object and loop through each cell in the
range to test the condition.
I also got rid of the j counter, because it was superfluous.
Public Sub Main()
Set i = Sheets("Cost Report")
Set e = Sheets("Test")
Dim rG as Range, cG as Range
Set rg = i.Range("MPT")
Dim d as Long
d = 2
For each cG in rG
If cG.Value2 = "Electric" Then 
    e.rows(d).Value-i.Rows(d).Value 
    d = d+1 
End if
Loop

End sub
Answer
Below is a sample of one can do it. For more information, you could refer to
the following website http://www.thespreadsheetguru.com/blog/the-vba-guide-
to-named-ranges. Hope it helps.
'Single Cell Reference (Worksheet Scope) RangeName = "Year"
CellName = "A2"
Set cell = Worksheets("Sheet1").Range(CellName)
Worksheets("Sheet1").Names.Add Name:=RangeName, RefersTo:=cell
Topic 950
Subject
C# with Excel Interop error format when i write data [duplicate]
Question
This question already has an answer here:
Excel Interop cell formatting of Dates
1 answer
I have a c# software who use the excel-interop.
When I write the date I have this problem.
But in excel there is this result
Could you help me ?
Thank you
Answer
You need to ensure that both are formatted as dates and that it's sent as a date
not a string. You can start by trying something like xlWorkSheet.Cells[i + 2, j +
1].NumberFormat = "dd/mm/yyyy";

and instead of called .ToShortDateString() call .ToADate()
Topic 951
Subject
C#: Insert into Excel as log file
Question
Is there any specific way to create a log file for my functions. All these
functions are as testcases. I am using the below code to add the data.
string pathfile = @"data source location"; XLWorkbook workbook = new
XLWorkbook(pathfile); IXLWorksheet worksheet =
workbook.Worksheet("Common"); worksheet.Cell("A2").Value = "1";
worksheet.Cell("B2").Value = "Test Case # 1"; worksheet.Cell("C2").Value =
"1/29/2016 6:18:56 PM"; worksheet.Cell("D2").Value = "1/29/2016 6:19:56
PM"; worksheet.Cell("E2").Value = "1 minute"; workbook.Save();
Now I have to specify this every time in my every function. Is there any other
better and good way to create excel log file?
Example of Excel Log File
+------+-------------------+-------------------------+---------------------------+----
-----------+ | ID | Testcases No. | Start Time | End Time | Total Time | +------+---
----------------+-------------------------+---------------------------+---------------
+ | 1 | Test Case # 1 | 1/29/2016 6:18:56 PM | 1/29/2016 6:19:56 PM | 1 minute
| +------+-------------------+-------------------------+---------------------------+---
------------+ | 2 | Test Case # 2 | 1/29/2016 6:20:50 PM | 1/29/2016 6:25:50
PM | 5 minutes | +------+-------------------+-------------------------+--------------
-------------+---------------+
Program uses:
Selenium
Unit test class
Nunit to run my application
Answer

An alternative to Takarii's suggestion.
If you store your data in a DataTable or List<> then using my free C# library,
you can create a real .xlsx file using the Microsoft OpenXML libraries.
Export to Excel
You just need to add one line of code, saying where your data is stored, and
what you want to call the Excel file:
List<YourLogEntryClass> listOfLogRecords = new List<YourLogEntryClass>
();
. . .
CreateExcelFile.CreateExcelDocument(listOfLogRecords, "LogFile.xlsx");
P.S. A more sensible idea might be to not to store the log entries in an Excel
file, but to use something like log4net which looks after all this logging
info/error strings for you...
Answer
As a developer you should have or should be building up a project(s) of utility
classes. Routines you can live without or even a framework for your project /
companies.
ie Cryptography, Email, Data Access, LOGGING
This way your company or you personally can drop in this project(s) into your
project and have a wealth of functionality instantly at your disposal.
I find the use of Excel for this simple logging task to be a bit heavy
So why your not using 1 of the best i.e. Net4Logger
http://www.codeproject.com/Articles/140911/log-net-Tutorial
Answer

A nice simple way is to simply create a datatable and then export it to excel
using closedxml (which you already tagged, so i assume you have the library
already)
XLWorkbook workbook = new XLWorkbook(); DataTable dt = //insert your
datasource here workbook.Worksheets.Add(dt,"WorksheetName");
Reference Here
Answer
Is there any reason not to take that block of code, and break it out into a
separate function that takes file location, id, etc. as arguments?
e.g.
public void LogTest(string fileLocation, int id, float minutes) {
// your code
}
Topic 952
Subject
Excel document didn't get generated in windows server 2012 R2 using c#
Question
I have one automation(windows application) which used to export data form
database to excel document. This is developed using c# and hosted in window
server 2012 R2. Here we have installed office 14( Microsoft excel 2010 ) and
its version is 14.0.7162.5000(32-bit) same version dll is used in automation
also. Problem is excel document is not generated and there is no error in log
also. Every time when automation ran excel process is created in task manager
but excel document not get generated.
Topic 953
Subject
Excel : Find only Hexa decimals from 1 cell
Question

I'm a newbie on Excel.
So I have a list of some names ending with Hexa decimals. And some names,
that doesn't have any. My mission is to see only those names with Hexa
decimals. (Mabye somehow filter them out)
Column
BFAXSPOINTDEVBAUHOFLAN2AD
BFAXSQLBAUHOFLAN207
BFAXSQLDEVBAUHOFLAN27A
BFREPDEVBAUHOFLAN258
BFREPORTINGBAUHOFLAN20B
COBALTSEA02900
COBALTSEAVHOST900
DIRECTO8000
DIRECTO9000
DIRECTODCDIRECTOLA009
DYNAMAEBSSISE006
SURVEYEBSSISE006
KVMSRV00",
KVMSRV01",
KVMSRV02",
ASR
CACTI
DBSYNC",
DTV
and so on...
Answer
The Function HEX2DEC will help you achieve what you want - it attempts to
convert a number as a hexidecimal, into a decimal. If it is not a valid Hex
input, it will produce an error.
The key is understanding how many digits you expect your decimal to be - is it
the last 5 characters; the last 10; etc. Also note that there is a risk that random
text / numbers will be seen as hexidecimal when really that's not what it
represents [but that's a problem with the question as you have laid it out; going

solely based on the text provided, all we can see is whether a particular cell
creates a valid Hexidecimal].
The full formula would look like this[assuming your data starts in A1, and that
your Hexidecimal numbers are expected to be 6 characters long, this goes in
B1 and is copied down]:
=ISERROR(HEX2DEC(RIGHT(A1,6)))
This takes the 6 rightmost characters of a cell, and attempts to convert it from
Hex to Decimal. If it fails, it will produce TRUE [because of ISERROR]; if it
succeeds, it will produce FALSE.
Then simply filter on your column to see the subset of results you care about.
Answer
Consider the following UDF:
Public Function EndsInHex(r As Range) As Boolean
Dim s As String, CH As String
s = r(1).Text
CH = Right(s, 1)
If CH Like "[A-F]" Or CH Like "[0-9]" Then
EndsInHex = True
Else
EndsInHex = False
End If
End Function
For the string to end in a hex, the last character must be a hex.
Topic 954
Subject
Excel VBA loop until

Question
I am using the following if code to filter col A and col B by the value in F1
Once sorted I copy the the filtered values in col A and paste them under the
range value.
Then I move on to the next range and repeat the filter using a different range
value (in this case cell G1).
I need to repeat this from cell F1 through to cell AH1.
Can I use a loop to do this?
If Range("F1").Value <> "" Then
Selection.AutoFilter
ActiveSheet.Range("$A$2:$B" & LastRow).AutoFilter Field:=2,
Criteria1:=Range("F1").Value
Columns("A:A").Select
Application.CutCopyMode = False
Selection.Copy
Range("F2").Select
ActiveSheet.Paste
Application.CutCopyMode = False
Selection.AutoFilter
Range("A1").Select
End If
If Range("G1").Value <> "" Then
Selection.AutoFilter
ActiveSheet.Range("$A$2:$B" & LastRow).AutoFilter Field:=2,
Criteria1:=Range("G1").Value
Columns("A:A").Select
Application.CutCopyMode = False
Selection.Copy

Range("G2").Select
ActiveSheet.Paste
Application.CutCopyMode = False
Selection.AutoFilter
Range("A1").Select
End If
Answer
Try the loop below. I have refactored your code to not use ActiveSheet and
Select statements. Instead I qualify all objects and methods to their parent
object and work directly with the object. It will avoid many pitfalls and errors
in expected versus actual results of the code.
Dim LastRow As Long
'assume LastRow already set
Dim ws As Worksheet
Set ws = Worksheets("Sheet1") 'change as needed
With ws
Dim cel As Range
For Each cel In .Range("F1:AH1") 
      If Len(cel) > 0 Then 
          ws.UsedRange.AutoFilter 
          .Range("A2:B" & LastRow).AutoFilter Field:=2,
Criteria1:=cel.Value 
          .Range("A2:A" &
LastRow).SpecialCells(xlCellTypeVisible).Copy
Destination:=cel.Offset(1) 
      End If 
Next
End With
See How to Avoid Select

Topic 955
Subject
How to Run VB macro Script using C#?
Question
I have a VB Script Macro used in excel File and its works well (Manual). I am
trying to convert it to small APP using:
private static void RunMacro()
{
Excel.Application book = null;
Excel.Workbooks workbooks = null;
Excel.Workbook macroWorkbook = null; Excel.Workbook
destinationWorkbook = null;
try
{
book = new Excel.Application(); 
      workbooks = book.Workbooks; 
      macroWorkbook =
workbooks.Open(System.Windows.Forms.Application.StartupPath +
"\\NewMacro.xltm"); 
      destinationWorkbook =
workbooks.Open(System.Windows.Forms.Application.StartupPath +
"\\TEST.csv"); 
      book.Run("NewMacro.xltm"); 
      macroWorkbook.Close(false); 
      destinationWorkbook.Close(true); 
}
catch (Exception ex)
{
throw ex; // the finally will be executed before this is thrown }
finally

{
book.Quit(); 
    
System.Runtime.InteropServices.Marshal.ReleaseComObject(macroW
    
System.Runtime.InteropServices.Marshal.ReleaseComObject(destin
    
System.Runtime.InteropServices.Marshal.ReleaseComObject(workbo
    
System.Runtime.InteropServices.Marshal.ReleaseComObject(book);
      macroWorkbook = null; 
      destinationWorkbook = null; 
      workbooks = null; 
      book = null; 
}
}
I get the following error:
Additional information: Cannot run the macro 'NewMacro.xltm'. The macro
may not be available in this workbook or all macros may be disabled.
Answer
book.Run("NewMacro.xltm");
This means your trying to open a macro enabled spreadsheet and not the macro
itself.
http://filext.com/file-extension/XLTM
An old question...something like this would work
Running an Excel Macro via C#: Run a macro from one workbook on another?
Answer
public void WebTest_CodedStep()

{
// Object for missing (or optional) arguments. object oMissing =
System.Reflection.Missing.Value;
// Create an instance of Microsoft Excel Excel.ApplicationClass oExcel = new
Excel.ApplicationClass();
// Make it visible
oExcel.Visible = true;
// Define Workbooks
Excel.Workbooks oBooks = oExcel.Workbooks; Excel._Workbook oBook =
null;
// Get the file path
string path =
System.Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments)
path = path + "\\Worksheet02.csv";
//Open the file, using the 'path' variable oBook = oBooks.Open(path, oMissing,
oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing,
oMissing, oMissing, oMissing, oMissing, oMissing, oMissing);
// Run the macro, "First_Macro"
RunMacro(oExcel, new Object[]{"Worksheet01.xlsm!First_Macro"});
// Quit Excel and clean up.
oBook.Close(false, oMissing, oMissing);
System.Runtime.InteropServices.Marshal.ReleaseComObject (oBook); oBook
= null;
System.Runtime.InteropServices.Marshal.ReleaseComObject (oBooks);
oBooks = null;
oExcel.Quit();
System.Runtime.InteropServices.Marshal.ReleaseComObject (oExcel); oExcel
= null;
//Garbage collection
GC.Collect();

}
private void RunMacro(object oApp, object[] oRunArgs) {
oApp.GetType().InvokeMember("Run",
System.Reflection.BindingFlags.Default |
System.Reflection.BindingFlags.InvokeMethod, null, oApp, oRunArgs); }
Topic 956
Subject
Why do .Net and Excel not agree on this math? [duplicate]
Question
This question already has an answer here:
Why integer division in c# returns an integer but not a float?
6 answers
I'm having some really strange behaviour from some C# and Excel ...
Having done the math myself I believe that excel may be giving the correct
answer but my math aint great so it may be that the .Net compiler knows
something I don't.
So here we go ...
Given this data in the form of an excel sheet: 
total     sale val  days    irr 
2431.65   2424.56   21      5.01 
The formula for irr (cell D2) is as follows:
=ROUND(100 * ((A2 - B2) / B2) * (360 / C2), 2)
When I run this C# I get the result 4.97 ...
var totalIncludingTax = 2431.65M;

var saleValue = 2424.56M;
var daysRemaining = 21;
var result = Math.Round(100.0m * ((totalIncludingTax - saleValue) /
saleValue) * (360 / daysRemaining), 2);
Can anyone explain how I can force C# / .Net and Excel to agree / how I might
rewrite this formula so that the two agree? Answer
360 / daysRemaining
This becomes an integer division in C#: 360/21 = 17 and not 17.14285714 as
it will be in Excel.
Change it to 360.0 /daysRemaining to make it a floating point operation (or
360m as it has also been pointed out).
Topic 957
Subject
How to update a cell in Excel VBA with NOW time for a another cell update
which in turn was updated via other cell changes?
Question
I need to update Cell E2 with Now(), for any value change in cell D2.
Note D2 value depends on many other cells like A2, B2 and C2.
I tried Worksheet_Change, but this triggers for manual update, also the cell
which I need to update E2 is updated automatically (i.e. not via manual
update).
Any solution, where cells A2, B2 and C2 are getting live feeds and `D2 has a
formula based on them, is acceptable.
Now if D2 changes, I need E2 with Now() date and time. Answer
You can use the Calculate event with a memory variable:
Public OldD2 As Variant

Private Sub Worksheet_Calculate()
If Range("D2").Value <> OldD2 Then 
    Application.EnableEvents = False 
       Range("E2").Value = Now 
       OldD2 = Range("D2").Value 
    Application.EnableEvents = True 
End If
End Sub
Answer
I solved the problem by using the Precedent property of the Range object.
I checked if the changed cell is part of my precedent, if so then using the Row
of the Target (changed cell), i moved to my required Column (which is static)
did my logic.
Thanks,
Sara
Private Sub Worksheet_Change(ByVal Target As Range) Dim keycells As
Range
Set keycells = Sheets("FUT_CALLS-1").Range("AD1:AD1").EntireColumn
If Not Intersect(Target, keycells.Precedents) Is Nothing Then
If (Sheets("FUT_CALLS-1").Cells(Target.Row, 30).Value = "BUY" Or
Sheets("FUT_CALLS-1").Cells(Target.Row, 30).Value = "SELL") And
Sheets("FUT_CALLS-1").Cells(Target.Row, 30).Value <>
Sheets("MyCodeSheet").Cells(Target.Row, 1).Value Then
Sheets("FUT_CALLS-1").Cells(Target.Row, 32).Value = Now()
Sheets("MyCodeSheet").Cells(Target.Row, 1).Value = Sheets("FUT_CALLS-
1").Cells(Target.Row, 30).Value
End If

End If
End Sub
Topic 958
Subject
Insert tab into html
Question
I know this has been asked several times. I followed these links also
HTML: Tab space instead of multiple non-breaking spaces ("nbsp")? How to
get a tab character?
But non of them give me the method I want. When I use above ones it give me
correct result in HTML page. But the problem is I have to export that data to a
excel sheet. So when I'm exporting that data I want to get them in different
cells.
For example
<td>
<strong>Name</strong> User Name
</td>
In here I want to print those in different cells (same row). If I use </br> it will
goes to next row correctly. I couldn't find way to go to next cell. Answer
To get the Name and username in different cells, you should <td> both.Try t
<tr>
<td><strong>Name</strong></td><td>User Name</td> </tr>
Topic 959
Subject
Use of Sheet 1 one column value of excel in Sheet 2 [closed]
Question

I have two 2 sheets in one excel (sheet1 and sheet2) In sheet 1 the following
details are there, There are two columns which are following. Student Class
Student Name
And in sheet 2 I have only one column in which there is some text . Eg :-
This Project Statement is subject to the Master Agreement effective as of the
date written above between Student Class and Student name.
Question :- I need to put Student Class from sheet 1 in the bold part of column
1 sheet 2 . Please help me.
Answer
If i'm understanding you correctly, you could use CONCATENATE. For
example:
=CONCATENATE(Sheet1!A1, "Text" Or Cell reference from sheet 2,
Sheet1!B1)
and if you need to separate the values add in " " or "-" or something like this:
=CONCATENATE(Sheet1!A1," ","Text" Or Cell reference from sheet 2,"
",Sheet1!B1)
Topic 960
Subject
Copy range from workbook to another without open
Question
I'm trying to copy a range of values from a workbook to another by using a
dialog box to select the file I'd like to copy the data from.
I'd like also not to open the "copyFrom" workbook in the process. The problem
lies in passing the file path in the string "filename" to the workbook variable
"copyFrom".
Option Explicit
Private Sub butt_copy_Click()
Call copy1

End Sub
Private Sub copy1()
Dim fileName As String, copyFrom As Workbook
fileName = Application.GetOpenFilename()
copyFrom = filename
Sheet1.Range("A1:A20") = copyFrom.Sheets(Sheet1).Range("A1:A20")
End Sub
Answer
Try Below. But i have some Clarification like where will you run the code
from
Application.Visible=False
Set copyFrom = Application.Workbooks.Open(fileName)
Then Try below. Worked Perfectly for me
Private Sub copy1()
Dim app As New Excel.Application
Dim fileName As String, copyFrom As Workbook app.Visible = False
fileName = app.GetOpenFilename()
Set copyFrom = app.Workbooks.Open(fileName) MsgBox
copyFrom.Sheets(1).Cells(1, 1) 'Sheet1.Range("A1:A20") =
copyFrom.Sheets(Sheet1).Range("A1:A20")
End Sub
Topic 961
Subject
How to find a cell with any value and then find the next value that is different
in VBA

Question
I have a list of data with various different columns.
What I am trying to achieve is for excel to look through one of the columns and
find the first value that occurs, copy that cell and then paste it in another cell.
The data starts in row three (Rows 1 and 2 are headers). Let's say I want to
paste the first value in G3.
Then, I need excel to find the next value that is different from the first in the
same column and perform the same action as before: copy the value, and paste
it in the next row in column G.
I have tried coding this but I'm not getting anywhere with it, and I haven't found
a way to find a cell and then the next cell if the value within the cell is not
defined (as the .Find function requires a value to search for). I know how to
code the copy/paste functions but I cannot figure out how to get it to find the
cell in the first place.
Any help would be much appreciated. Many thanks in advance. Answer
In this sample, we are looking for values in column A:
Sub FillG()
Dim i As Long
i = Rows.Count
Range("A3:A" & i).Copy Range("G3:G" & i) ActiveSheet.Range("G3:G" &
i).RemoveDuplicates Columns:=1, Header:=xlNo If Range("G3").Value = ""
Then Range("G3").Delete Shift:=xlUp End Sub
The method is to copy all of column A to G, then remove duplicates, then
remove an empty in G3 if it exists.:
Topic 962
Subject
VBA code for excel to find quartile one and quartile three my way
Question

Say I had the data 1,2,3,4,5. I need VBA code or some clever excel work to
find the median (3) and then find the medians for either one and two, or four
and five depending on the parameter.
If the data was 1,2,3,3,4,5 I would want to find the medians of 1,2,3, and 3,4,5.
But if the data was 1,2,3,4,5 I want it to ignore the 3 and find the medians of
the data on either side of the 3. depending on the parameter.
I hope that makes sense, I know some C# but vba and excel are new to me.
Thanks. Answer
My first thought was that you could use the quartile, but that doesn't always
give the same answer.
If you wanted to ignore the middle value (for an odd number of points) and the
middle two values (even number of points) you could try finding the median of
a subrange something like this:-
=MEDIAN(INDEX(A2:A10,1):INDEX(A2:A10,INT((COUNT(A2:A10)-1)/2)
to get the lower median
=MEDIAN(INDEX(A2:A10,COUNT(A2:A10)-
INT((COUNT(A2:A10)-1)/2)+1):INDEX(A2:A10,COUNT(A2:A10)))
to get the upper median.
Assumes the data are in ascending order.
To ignore the middle value but include the middle two values:-
=MEDIAN(INDEX(A2:A10,1):INDEX(A2:A10,INT(COUNT(A2:A10)/2)))
and
=MEDIAN(INDEX(A2:A10,COUNT(A2:A10)-
INT(COUNT(A2:A10)/2)+1):INDEX(A2:A10,COUNT(A2:A10)))
Topic 963

Subject
Loop VBA script
Question
I borrowed code to split text from one cell by carriage returns, and it works
excellently, but it works on the active cell only and I have a document with
about 500 rows.
I tried to implement a loop function but the program just stops (hangs).
How do I implement a loop function or range function properly?
This is code I'm using:
Option Explicit
Private Sub CommandButton1_Click()
On Error Resume Next
Call SplitText
End Sub
Sub SplitText()
Dim str() As String
If Len(ActiveCell.Value) Then ' CHECK IF THE ACTIVE CELL IS NOT
EMPTY. 
      ' SPLIT THE ACTIVE CELL'S VALUE WITH LINE FEED (vbLf). 
      str = VBA.Split(ActiveCell.Value, vbLf) 
      ' REARRANGE TEXT TO MULTIPLE COLUMNS. 
      ActiveCell.Resize(1, UBound(str) + 1).Offset(0, 1) =
str 
End If
End Sub

This is how the table looks:
Table
Answer
Try this:
Option Explicit
Sub SplitText()
Dim str() As String
Dim i As Long
i = 1 ' start at row 1 
      Do 
          If Len(Cells(i, "A").Value) Then     ' CHECK IF THE
ACTIVE CELL IS NOT EMPTY. 
              str = VBA.Split(Cells(i, "A"), vbLf) ' SPLIT
THE ACTIVE CELL'S VALUE WITH LINE FEED (vbLf). 
              Cells(i, "A").Resize(1, UBound(str) +
1).Offset(0, 1) = str  ' REARRANGE TEXT TO MULTIPLE COLUMNS. 
          End If 
          i = i + 1 
      Loop Until IsEmpty(Cells(i, "A")) ' Loop until the
first empty row 
End Sub
Answer
You can
rewrite SplitText() to receive a range parameter and act on it do a loop in the
calling program going across all selected cells
example
Private Sub CommandButton1_Click()
Dim C As Range

On Error Resume Next
' work on each cell within selected range For Each C In Selection.Cells
SplitText C
Next C
End Sub
Sub SplitText(Target As Range)
Dim str() As String
If Len(Target.Value) Then ' CHECK IF THE ACTIVE CELL IS NOT EMPTY. 
      ' SPLIT THE ACTIVE CELL'S VALUE WITH LINE FEED (vbLf). 
      str = VBA.Split(Target.Value, vbLf) 
      ' REARRANGE TEXT TO MULTIPLE COLUMNS. 
      Target.Resize(1, UBound(str) + 1).Offset(0, 1) = str 
End If
End Sub
Answer
Unclear exactly what range you want to loop through. You can easily use
something like this though to loop through all the cells in a range:
Sub ProcessCells()
Dim CellRange
'Replace with whatever range you want to iterate over Set CellRange =
Range("C13:F19")
For Each cell In CellRange
cell.Value = 10
Next cell

End Sub
Just add the operations you want to perform on the cell inside the for loop,
using cell to refere to the cell that is currently being processed, e.g.
str = VBA.Split(cell.Value, vbLf)
Topic 964
Subject
Excel VBA Perform command on filtered rows only
Question
I have some code which should filter children who are 20 and above, and
highlight their ages yellow.
First the code filters on whether the person is a Child, Partner etc, then
whether they are over 20.
However, I don't think my code does do that! I've just had an instance where
there were no children at all in the data, so my code filtered on Child and no
rows were visible.
However, when the next bit came to filter on those above 20, it took the filter
off, and highlighted a Partner who was 51. I would like it to not highlight
anything in the case that there are no children.
This is what I have so far. I'm also worried that sometimes I will get different
data that does not have data up to row 291 (or will have more). I'm not sure
how to not restrict the range I select in row 3 and 4?
Dim lastrow As Long
lastrow = Range("X" & Rows.Count).End(xlUp).Row
ActiveSheet.Range("A5:AA291").AutoFilter
ActiveSheet.Range("$A$5:$AA$291").AutoFilter Field:=24,
Criteria1:="Child"
Range("AB5") = "Child Age Year/Month"
Range("AB7:AB" & lastrow).Formula =

"=DATEDIF(RC[-2],TODAY(),""Y"") & "" Years, "" &
DATEDIF(RC[-2],TODAY(),""YM"") & "" Months """
Columns("AB:AB").EntireColumn.AutoFit
Range("AC5") = "Child Age Year Only"
Range("AC7:AC" & lastrow).Formula =
"=DATEDIF(RC[-3],TODAY(),""Y"")"
Columns("AC:AC").EntireColumn.AutoFit
Range("AD5") = "Child 21st Birthday"
Range("AD7:AD" & lastrow).Formula = "=DATE(YEAR(RC[-4])+24,
MONTH(RC[-4]),DAY(RC[-4]))" Columns("AD:AD").EntireColumn.AutoFit
Range("A5:AD5").AutoFilter
ActiveSheet.Range("$A$5:$AD$290").AutoFilter Field:=29,
Criteria1:=">=20", _
Operator:=xlAnd
To be honest, looking at my code, I can't see where it finds the command to
filter those who are above 20 in yellow. Yet it does it.
Any help would be really appreciated.
Topic 965
Subject
Excel Query looking up multiple values for the same name and presenting
averages
Question
Apologies if this has been asked before. I would be surprised if it hasn't but I
am just not hitting the correct syntax to search and get the answer.
I have a table of raw data for my staff, it contains data on the name of the
employee who completed a job and the start and finish times, among other
things. I have no unique ID's other than name, and I cant change that as I'm part
of a large organisation and I have to make do with the data I'm given.

what I would like to do it present a table (Table 2) that shows the name of the
employee and then takes the start/finish times for all of their jobs on table 1
and presents the average time taken across all of their jobs.
I have used Vlookup in the past but I'm not sure it will cut it here. the raw data
table contains approx 6000 jobs each month.
On table 1 i work out the time taken for each job with this formula;
=IF(V6>R6,V6-R6,24-R6+V6) (R= started Time) (V= Completed Time) in
24hr clock. I have gone this route as some jobs are started before midnight and
completed afterwards. Although my raw data also contains dates
(started/completed) in separate columns so I am open to an experts feedback
on this and if there is a better way to work out the total time form start to
completion. Answer
I believe the easiest way to tackle this would be with a Pivot Table. Calculate
the time taken for each Name and Job combination in Table 1; create a pivot
table with the Name in the Row Labels and the Time in the Values -- change the
Time Values to be an average instead of a sum:
Alternatively, you could create a unique list of names, perhaps with Data >
Remove Duplicates and then use an =AVERAGEIF formula:
Answer
Thanks this give me the thread to pull on, I have unique names as its the
persons full name, but ill try pivot tables to hopefully make it a little more
future proof for other things to be reports on later.
Topic 966
Subject
Excel macro Select Case
Question
SM1 = "5000"
SM = "SPOTMARKET"
SM = "" & SM & ""

Select Case Cells(H + 2, 24).Value 
          Case SM,SM1 
           C(j) = "SPOTMARKET" 
      End Select 
I'm trying to make something like that but the "SM" doesn't work as it suppose
to. I want that C(J) = "SPOTMARKET" when Cells(H + 2, 24) has the word
spotmarket in it. it could be WRER-SPOTMARKET or the opposite
SPOTMARKET-WRER.
This lines are inside For j=0 to XXX and For H=0 to XXX. C is an array.
THANK YOU
Answer
You should use InStr to test for whether "SPOTMARKET" is found.
If InStr(Cells(H + 2, 24), "SPOTMARKET") > 0 Then
C(j) = "SPOTMARKET"
ElseIf InStr(Cells(H + 2, 24), "FORWARDMARKET") > 0 Then
C(j) = "FORWARDMARKET"
End If
InStr returns 0 if no match and an integer > 0 if found.
Answer
Edit: Now it should work:
Public Sub Testing()
Dim sm1
Dim k
k = "lalal SPOTMARKET ale"

sm1 = "5000"
Select Case True 
      Case k Like "SPOTMARKET", sm1 
          Debug.Print "Found" 
End Select
End Sub
Here is an article with good examples for like:
https://msdn.microsoft.com/en-us/library/swf8kaxw.aspx
Topic 967
Subject
In Excel how to separate a string in one column into one word per column
Question
I need to Extract the counties from this list, and wondered if you could
possibly help me as I have tried the Substitute command but as you see the red
arrows show where this has failed.
So for example, Lodge Farm Industrial Estate,, Sheaf Cl, Northampton NN5
7UZ, United Kingdom <<<<<<< this is not a completely delimited list.
1)how do I change this string to 100% comma separated as it's missing a
comma in the string ? 2) how do I transform this list from text to columns?
Is there some simple way to substitute each white space for a comma that
works? :o)
many many, thanks for being a great forum Best
LC
Please View Printscreen
Answer

As the data seems to be , delimited, what you could do is go to the data tab and
use the text to column. This way you can easily select the county as you
requested. For more information look here: http://www.excel-
easy.com/examples/text-to-columns.html
Topic 968
Subject
Excel connections slow to refresh
Question
I hava an Excel spreadsheets that extracts data from an Oracle database with
an Excel connection and SQL. When I refresh the excel connection, it takes
about 15 minutes to refresh, but when i run the SQL query in SQL developer it
take about a second.
What steps can i take in order to improve the speed at which the connections
refresh.
My connection string looks something like this,
Provider=OraOLEDB.Oracle.1;Password=jason;Persist Security
Info=True;User ID=jason;Data Source="(DESCRIPTION=(ADDRESS_LIST=
(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521)))
(CONNECT_DATA=(SID=xe)))";Extended Properties="DeferUpdChk=true"
Topic 969
Subject
Excel SQL Query from ODBC "Error - No Value given for one or more
required parameters when using question mark `WHERE XXX = ?`
Question
I have an Excel file with an SQLOLEDB connection to a MS SQL server,
When I do this with an Oracle link I can simply put WHERE XXX = ? in my
query to prompt for values in Excel, however doing it with MSSQL I am
getting the following error:
No Value given for one or more required parameters

When trying to parameterise a basic excel query from a value to ?
If i use values like this I get results:
SELECT *
FROM srv.stats
WHERE srv.stats.[year] = '2016'
AND srv.stats.[quarter] = '1'
When I add in the parameter ? I get the above error.
SELECT *
FROM srv.stats
WHERE srv.stats.[year] = ?
AND srv.stats.[quarter] = ?
I want to be able to do this without using VB. Answer
Since MS SQL sources from ODBC connections don't inherently allow you to
use the WHERE xxx = ? code in your SQL query (unlike Oracle connections)
you need to spoof Excel to allow parameters from a MS SQL data source by
building a Microsoft Query and then overwriting it.
Open a new Excel file and go to the Data tab, choose the From Other Sources
drop down and select From Microsoft Query.
The Choose Data Source window will appear. Choose an existing datasource
or set up a new connection to your server by selecting <New Data Source> and
click OK.
Once done you will see the query wizard window open to select tables and
columns, as you're going to be adding your own SQL query later just select one
table that is in your query and add it to the Columns in your query: section by
using the > button. For the next 2 windows just click Next and then finally
Finish.
You will then be prompted to select how you want to view the data in the
Import Data window, first of all click the Properties... button.

And then the Definition tab, in the Command text: box you will have a
SELECT statement, below there you will need to add WHERE clauses for the
amount you have in your actual query. These need to be added in the format of:
WHERE 1 = ?
AND 2 = ?
AND 3 = ?
Once this is done click OK to go back to the Import Data window and select
your output type; Table, PivotTable report or PivotChart and PivotTable Report
depending on what how you want to display your data.
You will then be prompted to enter a value for each parameter. If you are
getting these values from Cells choose the location of them now in the order
you will be putting in your actual parameters. When you have entered your
parameter sources go back to the Data tab and click connections and then into
the definition tab.
Now in the Command text: box paste in your actual SQL query with your
parameters in the WHERE clause = ? and in the same order your defined the
sources and click OK, Your data should now populate as it usually does with
your parameters being used.
Answer
There is no way to prompt for inputs directly in SQL Server in the same way
that you can in Access for example. You can make the values that are passed
into queries like this.
DECLARE @year SMALLINT
SET @year = 2016
DECLARE @quarter TINYINT
SET @quarter = 1
SELECT *
FROM srv.stats
WHERE srv.stats.[year] = @year

AND srv.stats.[quarter] = @quarter;
You then just need to find a way that suits your solution (Excel?) to pass these.
This might, for example, take the form of a stored procedure.
CREATE PROCEDURE testProcedure @year SMALLINT, @quarter
TINYINT AS
SELECT *
FROM srv.stats
WHERE srv.stats.[year] = @year
AND srv.stats.[quarter] = @quarter GO;
Topic 970
Subject
Capping Values Within A Range
Question
I am using Excel 2013 and I am stuck! I have spent many hours researching on
the web and cannot find the answer so I am hoping there is a genius out there
who can.
I have a range of data containing payments made for insurance claims
(AV2:AV50000) and these range from £0-£300,000. I am trying to sum the
values within this column but capping larger claims at £50,000.
This works where there is a claim above £50,000 but not where there isn't one
=SUMIFS('Raw Data'!$AV$2:$AV$50000,
'Raw Data'!$O$2:$O$50000,
"<=100",
'Raw Data'!$AV$2:$AV$50000,
"<50000")
+ IF('Raw Data'!$AV$2:$AV$50000, ">50000", 50000)
This works where there isn't one but not where there is
=SUMIFS('Raw Data'!$AV$2:$AV$50000,

'Raw Data'!$O$2:$O$50000,
">100",
'Raw Data'!$O$2:$O$50000,
"<=200",
'Raw Data'!$AV$2:$AV$50000,
"<50000")
+ IF('Raw Data'!$AV$2:$AV$50000,
">50000",
50000*IF('Raw Data'!$AV$2:$AV$50000, ">50000", 'Raw
Data'!$AV$2:$AV$50000))
Solutions without a helper column gratefully received. Answer
An array formula might work for you here...
So select some data cell and enter this formula...
=SUM(IF(AV:AV>50000;50000;AV:AV))
Then create an array formula by pressing Ctrl + Shift + Enter.
You should see curly braces around the formula...
Might be a bit slow, but should work...
Topic 971
Subject
Mantain leading zeros with transfer command (ABAP)
Question
I'm writing a xls file into an application server folder (al11).
I need to keep leading zeros for some fieds, so i tried to concatenate ' character
before value. Data is written in server file using OPEN DATASET,
TRANSFER, ecc...
When I download the file into local folder, the cell in excel is not formatted as
a text cell, but ' is shown in the cell. So my codes are not what I expected

because of ' character.
How to fix this problem?
Topic 972
Subject
Changelink of object failed - caused by switching from Vista to Windows 7
(VBA)
Question
I have a macro that generates a large number of metric documents for new
projects and generates them based on a template set of excel sheets. Once it
has edited the name of the template document it changes any documents that
have any links to it to the correct name using the changelink function.
This works perfectly fine on Vista and Excel 2010, but it fails on Windows 7
and Office 2013. There's a snippet of the code below - I've had a look on
Google if anyone else has had this problem or how to solve it and haven't had
much success.
OldHubLink = "sharepoint link"
NewHubLink = HubFilePath & Proj & " name.xlsx"
Set wbOpen = Workbooks.Open("template location on sharepoint")
wbOpen.Unprotect ""
wbOpen.ChangeLink Name:=OldHubLink, NewName:=NewHubLink,
Type:=xlExcelLinks
Topic 973
Subject
excel return Row for duplicate values found for expanding table
Question
I have large database with multiple tables rows & columns, nothing can be
sorted.
I need to calculate the difference between the current row & a previous row

that contains a given value in an expanding table. And possibly need to take
into account multiple columns.
ie pseudo code;
=ROW()-if(any of all previous rows contain given value then return row of the
most recent/last that contains this value)
Values can be duplicated & rows can be blank (""). I can't use simple lookup,
I've tried using index & match but can't seem to get it working so open to
suggestions.
Thanks
Answer
Ok so managed to finally figure this out;
=IF($GI$8=AY13,ROW()-ROW($GI$9)-
MATCH($AY$8+1,$AY$9:AY12,1)+1,"")
This forces match to return the last item as there's no proper match.
I was trying to make a 'perfect' match, which is why I wasn't getting the results
I wanted.
Topic 974
Subject
VB function won't go into a loop (Excel)
Question
I'm working on an Excel project where I need to import monthly .csv files,
parse a column in these and return numbers from adjacent columns back into a
summary sheet. Here's the idea:
read column to parse into a VB array
concatenate string to search for, place it into a variable search for this variable
in array
if found, write 1 into a second array (named arrTrueFalse) if not found write 0
into arrTrueFalse

when done, multiply true/false array with a third array (range from .csv with
amounts) basically do a SUMPRODUCT on them
Here is the code, I'll try to mark where it breaks
Private strBaba As String
Private arrCampaigns() As Variant
Private arrAmounts() As Variant
Private arrTrueFalse() As Variant
Public Function IsInArray(stringToBeFound As String, arr As Variant) As
Boolean
IsInArray = Not IsError(Application.Match(stringToBeFound, arr, 0)) End
Function
Public Sub stringComparison()
Dim i As Long, j As Long
j = 1
Call OptimizeCode_Begin
With Sheet14 
      arrCampaigns = .Range("F2:F1000").Value 
      arrAmounts = .Range("I2:I1000").Value 
End With
ReDim arrTrueFalse(1 To UBound(arrCampaigns) - LBound(arrCampaigns) +
1, 1 To 1)
For i = 2 To Sheet2.Cells(Sheet2.Rows.Count, 1).End(xlUp).Row
strBaba = Sheet2.Range("A" & i).Value & "" & Sheet2.Range("C" & i).Value
& ""

Call IsInArray(strBaba, arrCampaigns)
'=> Works up to this line (where I call IsInArray); after that, loop never gets
executed? 
      If IsInArray(strBaba, arrCampaigns) = True Then 
          arrTrueFalse(j) = 1 
      Else 
          arrTrueFalse(j) = 0 
      End If 
      j = j + 1 
Next i
Call OptimizeCode_End
End Sub
What am I doing wrong?
Topic 975
Subject
Powershell could not saveas excel after data written
Question
I am a brand newbie to powershell. I am trying to generate a report to gather
all printers' information in our environment. The report is well generated by
opening Excel worksheet; however, it fails to save and simply jumps onto
close
Below script I used to generate a report:
Add-Type -AssemblyName Microsoft.Office.Interop.Excel $xlFixedFormat =
[Microsoft.Office.Interop.Excel.XlFileFormat]::xlWorkbookDefault $xl =
New-Object -ComObject Excel.Application $xl.Visible = $True
$xls = $xl.Workbooks.Add()
$Sh = $xls.Worksheets.Item(1)
$Sh.Name = "Printer Info"
.

.
.
.
$xls.SaveAs("C:\temp\Test.xlsx", $xlFixedFormat) $xls.Close()
$xl.Quit()
Error message received is what below:
PS C:\WINDOWS\system32> $Sh.Name = "Printer Info" PS
C:\WINDOWS\system32> $xls.SaveAs("C:\temp\Test.xlsx", $xlFixedFormat)
Exception calling "SaveAs" with "2" argument(s): "SaveAs method of
Workbook class failed" At line:1 char:1
+ $xls.SaveAs("C:\temp\Test.xlsx", $xlFixedFormat) +
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ CategoryInfo : NotSpecified: (:) [], MethodInvocationException +
FullyQualifiedErrorId : ComMethodTargetInvocation
The script works find in Windows Server 2008 R2 without any issues;
however, it simply fails to work in Windows 7 64 bit.
I would really appreciate if I get an assistance asap.
Topic 976
Subject
How to turn off subtotals in Pivot Table programmatically - poi java
Question
I'm programmatically creating a pivot table in excel.
Basically i want to set 'Subtotals' to None in Field Settings for a cell.
Right Click on a cell -> select 'Field Settings' -> in the popup window set
'Subtotals' to 'None' as shown in the attached image.
Any help is highly appreciated.
Topic 977
Subject

xml spreadsheet pivot table PT source file name issue
Question
I create an Excel document with a Pivot Table using Spreadsheet XML. The
data source for the Pivot table is a worksheet in the same Excel Document as
the Pivot table. I refer to the Pivot Table's data source with the file name of the
Excel Document :
<PTSource>
<ConsolidationReference>
<FileName>DataSource</FileName>
<Reference>R1C1:R8C3</Reference>
</ConsolidationReference>
</PTSource>
unfortunately,Internet Explorer add the path of the tempory excel document
before the file name
ex : '\Users\AppData\Local\Microsoft\Windows\Temporary Internet
Files\Content.IE5\REA6T1JC\DataSource'!$A$1:$E$3
...So I lost the source of the pivot table
Thanx for helping
Topic 978
Subject
[excel-vba]Insert new rows after a certain amount of old rows, and before next
values in a table
Question
I am working on a sheet that takes data from remote sheets, copies them into a
single sheet, and then merges those into a single table (all incoming data is
using connections from excel files, and puts the data into tables)
What I need to do is then be able to update the single table when the remote
data refreshes, without deleting the old rows, but only inserting the new ones.
there is a column in each table that is numeric, and has unique values there are

cells that use a worksheet formula (countifs) to determine the number of rows
that fall between those ranges (ex, table1 in sheet1 has column A that always
has values between 10002 and 20001, sheet 2 has values between 20002, and
30001, and so on) when copying those sheets and their data over, how do I
copy only the new rows?
for reference, the remote sheets are working sheets that are used daily by other
users, and so the update and insert macro will be used regularly, and the single
table they merge into is also something that has data that updates, hence the
need to not delete the old rows, but only append - I am skilled enough with
VBA to get into this kind of trouble, but I am far from an expert. This is my first
question on here, though I have happily used the site for answers for a long
time
example code below:
With Application 
      .ScreenUpdating = False 
      .EnableEvents = False 
      .Calculation = xlCalculationManual 
      .DisplayAlerts = False 
End With
ShtIndex = ActiveWorkbook.Sheets("Ann Q1").Index With ActiveWorkbook 
      Asheet = .Sheets(ShtIndex) 
      Bsheet = .Sheets(ShtIndex + 1) 
      Csheet = .Sheets(ShtIndex + 2) 
      Xsheet = .Sheets(ShtIndex + 3) 
      Ysheet = .Sheets(ShtIndex + 4) 
End With
Set Dsheet = ActiveWorkbook.Sheets("Jim_ALL") Set Dtable =
Dsheet.ListObjects("Audit_Final") Set Atable = Asheet.ListObjects(1)
Set Btable = Bsheet.ListObjects(1)
Set Ctable = Csheet.ListObjects(1)

Set Xtable = Xsheet.ListObjects(1)
Set Ytable = Ysheet.ListObjects(1)
ANN = Atable.ListRows.Count
DNA = Btable.ListRows.Count
KTHY = Ctable.ListRows.Count
NRMA = Xtable.ListRows.Count
SHMKA = Ytable.ListRows.Count
On Error Resume Next
J = ShtIndex
Do While J < ShtIndex + 5 
      Set Ssheet = Worksheets(J) 
      Set Stable = Ssheet.ListObjects(1) 
      LastR = Stable.ListRows.Count 
      LastC = Stable.ListColumns.Count 
' Stable.DataBodyRange.Copy
Destination:=Ssheet.Range("A65536").End(xlUp) 
      If J = ShtIndex Then 
          ANN1 = LastR 
          J1 = Sheets("Macros").Range.Cells("G1").Value 
          R1 = ANN - J1 
      ElseIf J = ShtIndex + 1 Then 
          DNA1 = LastR 
          J2 = Sheets("Macros").Range.Cells("H1").Value 
          R1 = DNA - J2 
      ElseIf J = ShtIndex + 2 Then 
          KTHY1 = LastR 
          J3 = Sheets("Macros").Range.Cells("I1").Value 
          R1 = KTHY - J3 
      ElseIf J = ShtIndex + 3 Then 
          NRMA1 = LastR 
          J4 = Sheets("Macros").Range.Cells("J1").Value 
          R1 = NRMA - J4 
      ElseIf J = ShtIndex + 4 Then 
          SHMKA1 = LastR 
          J5 = Sheets("Macros").Range.Cells("K1").Value 
          R1 = SHMKA - J5 

      End If 
J = J + 1
Loop
On Error GoTo 0
With Application 
      .ScreenUpdating = True 
      .EnableEvents = True 
      .Calculation = xlCalculationAutomatic 
      .DisplayAlerts = True 
End With
End Sub
Topic 979
Subject
Array formula in EPPLUS
Question
I'm trying to generate an excel file with EPPlus that contains a formula
summing elements if a condition is met. If read the documentation correctly,
last versions (I'm using EPPlus 4.0.5 installed by Nuget) should support such
formulas.
Here is a short example
var pck = new ExcelPackage (fileinfo);
var sheet = pck.Workbook.Worksheets.Add ("My sheet");
sheet.Cells [1, 1, 1, 5].Value = 1;
sheet.Cells [1, 6, 1, 10].Value = 0;
sheet.Cells [2, 1, 2, 10].Value = 1;
//sheet.Cells [3, 1].Value = "=SUM(IF(A1:J1>0;A2:J2))"; sheet.Cells [3,

1].CreateArrayFormula ("SUM(IF(A1:J1>0;A2:J2))");
pck.Save ();
pck.Dispose ();
When I open the file with Excel, Excel ask for repairing the file (and just
empty the cell containing the array formula).
If I only set the value and execute the formula as array formula in Excel,
everything works fine (so formula is not the culprit).
Any idea of what is wrong? Or any idea on how to workaround? Answer
Ok. Formula is the culprit. Never that anything for granted.
It appears that input format and format used internally in the file are different.
sheet.Cells [3, 1].CreateArrayFormula ("SUM(IF(A1:J1>0;A2:J2))");
does not work but
sheet.Cells [3, 1].CreateArrayFormula ("SUM(IF(A1:J1>0,A2:J2))");
(Note the comma vs. semi-colon)
On my computer, I need to encode the formula with a semi-colon, not a comma.
Answer
Try this one.
sheet.Cells [3, 1].CreateArrayFormula ("IF(SUM(A1:J1)>0,SUM(A2:J2))");
Topic 980
Subject
Can I Convert multiple excel books in one pdf? (no using itextsharp)
Question
I want to convert multiple excel books (not sheets) to 1 PDF file. I don't want

to use itextsharp because I need to purchase for commercial. Does anybody
have any idea?
Answer
Well, this is a little complex, what I think is that maybe you can convert the
excel docs to PDF first and then merge them to a single PDF doc. what is your
thought? How is your plan going?
You can refer the following article, the main thought is to convert office files to
pdf then merge them.
http://www.dotnetspider.com/resources/46252-Convert-and-Merge-Office-
Files-to-One-PDF-File-in-C.aspx
To get better help, perhaps show more information like diNN's comment above
is helpful.
Answer
Here is what I used:
public static class ExcelMergeExtension {
public static ExcelFile Merge(this ExcelFile destination, string sourcePath) { 
      var sourceFileName =
Path.GetFileNameWithoutExtension(sourcePath); 
      var source = ExcelFile.Load(sourcePath); 
      foreach (var sourceSheet in source.Worksheets) 
          destination.Worksheets.AddCopy( 
              string.Format("{0}-{1}", sourceFileName,
sourceSheet.Name), 
              sourceSheet); 
      return destination; 
}
}

class Program
{
static void Main(string[] args)
{
var options = new PdfSaveOptions() { SelectionType =
SelectionType.EntireFile }; 
      ExcelFile.Load("Book1.xlsx") 
               .Merge("Book2.xlsx") 
               .Merge("Book3.xlsx") 
               .Save("Books.pdf", options); 
}
}
The code uses GemBox.Spreadsheet library which has free and commercial
version, however note that free one does have some size limitations. Anyway it
worked great for me and I hope it helps you too.
Topic 981
Subject
Generate CSV(MS-DOS) file using Java
Question
File file = new File("F:\\New Projcts\\Ex\\hello.csv"); file.createNewFile();
It generate only .CSV(Comma delimited) but not in .CSV(MS-DOS)
how to create .CSV(MS-DoS) file in java Answer
I assume that your issue is about the charset and not about the choice of CSV
pattern. In Java, output stream uses the default charset, i.e. dixit
Charset.defaultCharset() javadoc: the default charset is determined during
virtual-machine startup and typically depends upon the locale and charset of
the underlying operating system.
Unless you are working with a very old MSDOS os, it'd never be the case. The

charset has to be specified with something like:
OutputStreamWriter os = new OutputStreamWriter(
new FileOutputStream("FileFromNonJavaProgram.txt"), "Cp850" /* MS-DOS
Latin-1 */);
Topic 982
Subject
Microsoft.Jet.OLEDB.4.0 installation issue
Question
I am using Microsoft.Jet.OLEDB.4.0 provider with oledbconnection to read
data from Excel and populate into sql database.I know i can use other excel
packages available,but at this moment i cannot make a change.My production
server is not having Microsoft.Jet.OLEDB.4.0 installed. Is there way i can
keep the dll of Microsoft.Jet.OLEDB.4.0 in my solution and use it.Or is it
compulsory to download and install this provider. If So what is the best way to
do so?
Topic 983
Subject
vba code to change column formula by dynamic dragging
Question
i need to write vba code wherein cell GQ4 has formula
ActiveCell.Formula = "=SUM(CO4:CQ4)"
Now there is new month added every month in excel data hence the formula
will also change dynamically every month. ie next month it will be
"=SUM(CP4:CR4)"
in short it is dragging its column selection by 1 column
Please help me write a vba code that will dynamically change the formula.
Answer

Note sure if it is possible to return a formula from a custom function, but a
solution might be to write a custom function that returns the range you want,
and then have the formula in GQ4 take the range as an argument.
Or you can solve it with a normal worksheet formula.
=SUM(INDIRECT(ADDRESS(4;15));INDIRECT(ADDRESS(4;16));INDIREC
Replace the column numbers with a base + offset that you can get by using a
date function. E.g.
=SUM(INDIRECT(ADDRESS(4;14 +
=MONTH(TODAY())));INDIRECT(ADDRESS(4;15 +
=MONTH(TODAY())));INDIRECT(ADDRESS(4;16 +
=MONTH(TODAY()))))
Topic 984
Subject
Runtime error 3705, operation is not allowed when object is open
Question
I am getting error 3705 after adding the line
[MTSU_Data].[Tool no]=" CInt(WsInput.Range("J" & c).value) & ";"
The highlighted line where the error occurs is at
.ActiveConnection = conn
Full code
Dim conn As ADODB.Connection
Dim Accdata As ADODB.Recordset
Dim Accfield As ADODB.Field
Dim wsQueryR As Worksheet, wsFinal As Worksheet
Set wsFinal = Worksheets("Final")

Set conn = New ADODB.Connection
Set Accdata = New ADODB.Recordset
conn.ConnectionString = "Provider=Microsoft.ACE.OLEDB.12.0;Data
Source=C:\Users\wongki7\Desktop\MTSU Db.accdb;" conn.Open
'G:\BusUnits\MTSU\MTSU\Mold Tool Set Up\MTSU Reports\Shift
Reports\MTSU Db.accdb;" ' On Error GoTo CloseConnection
For c = 2 To WsInput.Range("J" & Rows.Count).End(xlUp).Row With
Accdata 
    .ActiveConnection = conn 
    .Source = "SELECT * FROM [MTSU_Data] Where [MTSU_Data].
[Date]>= #" 
                  & Format(CDate(WsInput.Range("A2").value),
"mm/dd/yyyy") & " # AND [MTSUData].[Date]<= #" 
                  & Format(CDate(WsInput.Range("A3").value),
"mm/dd/yyyy") & " # AND [MTSUData].[LT] = " 
                  & CInt(WsInput.Range("M2").value) & " AND
[MTSUData].[Tool no]=" _ 
                  & CInt(WsInput.Range("J" & c).value) & ";" 
    .LockType = adLockReadOnly 
    '.CursorType = adOpenForwardOnly 
    .Open 
End With
Next
Worksheets("Result").Select
Sheets("Result").Range("a2").CopyFromRecordset Accdata
Accdata.Close
conn.Close
Any help is appreciated. Thanks and have a good day ahead. Answer
Can you not try to move the line

.ActiveConnection = conn
To outside the loop. Obviously fully qualifying it..
Accdata.ActiveConnection = conn
That looks to me that you are trying to make the connection for each iteration
and I think it is only necessary once... maybe.
Answer
To best fit your code, Id try something like:
Sub SomeRoutine()
Dim conn As ADODB.Connection
Dim Accdata As ADODB.Recordset
Dim Accfield As ADODB.Field
Dim wsQueryR As Worksheet, wsFinal As Worksheet Dim c As Long
Set wsFinal = Worksheets("Final")
Set conn = New ADODB.Connection
Set Accdata = New ADODB.Recordset
conn.ConnectionString = "Provider=Microsoft.ACE.OLEDB.12.0;Data
Source=C:\Users\wongki7\Desktop\MTSU Db.accdb;" conn.Open
Accdata.ActiveConnection = conn
Accdata.LockType = adLockReadOnly
For c = 2 To WsInput.Range("J" & Rows.Count).End(xlUp).Row
Call Accdata.Open("SELECT * FROM BLah Blah")
Sheets("Result").Range("a2").CopyFromRecordset Accdata Accdata.Close
Next
conn.Close
End Sub
You may be able to look at the way you build the SQL request to build a query
to get the data in one go and and do a single paste to Excel with the

CopyFromRecordset.... but that's a different issue.
Answer
A mistake I've made many times before. When assigning objects, you need to
use Set. Change the line to
Set .ActiveConnection = conn
.Source and .LockType are scalar properties, so they don't need Set, but
.Activeconnection does.
Topic 985
Subject
Disabling the Unprotect button in the Ribbon in excel
Question
Is it possible to disable the Unprotect button on the Ribbon in Excel 2013?
Thank you for your help!
Answer
Yup ramedju's link it really where to start.
You should be able to include XML to deal with the Ribbon. Something similar
to:
Events not getting fired/executed in combobox in Excel Ribbon
So, basically -> create some XML for the Ribbon, and put some VBA in a
module to handle / control the Ribbon.
Hope that helps.
Topic 986
Subject
Preserving distinct values VBA excel - deleting all the rest
Question
I have a column with random values that has repeats data in a certain format:

Column 1
A
A
A
A
B
B
C
C
C
A
A
D
D
E
F
F
F
G
...
I tried using
Dim i As Integer
Dim noRows As Integer
'count rows
noRows = Range("B2:B10000").Rows.Count
'delete row entries that are duplicates.. For i = 1 To noRows
If Range("H2").Cells(i + 1, 1) = Range("H2").Cells(i, 1) Then
Range("H2").Cells(i + 1).Resize(1, 2).Clear End If
Next i
Which I quickly realised would not work at all.

how could I write a code so the output would be:
Column 1
A
[..]
[..]
[..]
B
[..]
C
[..]
[..]
[..]
A
D
[..]
[..]
E
F
[..]
[..]
G
...
Where the [..]s are nulls or zero
Disregard the second "66.63" field which is green, it should be red Answer
Keep the previous value in a variable and compare it against the cell's value.
Dim sPrv
Dim oRng
Dim i
sPrv = "" '<- previous value
Set oRng = ActiveSheet.Range("H2", ActiveSheet.Range("H2").End(xlDown))
'<- set range of one column starting from H2 to the end of row

Debug.Print oRng.Rows.Count '<- Row count.
For i = 1 To oRng.Rows.Count
Debug.Print i, sPrv, oRng.Cells(i,1), sPrv = oRng.Cells(i,1) '<- print counter,
previous value, cell value, sPrv = Cell ?
If sPrv = oRng.Cells(i, 1) Then '<- current value the same as previous
oRng.Cells(i, 1).Value = "" '<- Set the cell value to blank Else
sPrv = oRng.Cells(i, 1).Value '<- Keep the new value for the next comparison
and leave the cell value as is End If
Next
Topic 987
Subject
Read data from Excel using Node.JS
Question
I'm writing a node.js script to read data from some static excel file. I have tried
alasql and excel.js and I am open to any other package that can meet my
requirement.
Here're two hurdles I'm facing.
Read attached file in excel. User can dump a PDF/word/excel file into one cell
in the excel file and my script has to be able to detect such attachment and read
contents inside. List and iterate through worksheets in the excel file. My data
file is not guaranteed to be single-worksheet excel, so I have to be able to list
and iterate through each available worksheet to read and process data.
Appreciate any advice.
Update
I have managed to solve hurdle 2 with XLSX.js.
For hurdle 1, I do have realized one issue is that the attachment is actually an

object not associated with any cell, so in addition to the issue raised early, I
also need to be able to detect the object's position and check try to associate it
with an appropriate row in the excel.
Topic 988
Subject
Auto-detection of being called with an argument VS separately called for a
subroutine?
Question
I have three subroutines, sometimes run successively, sometimes separately,
but will use a same argument ("TestNumber"). My original code looks like:
Sub Main1()
Dim TestNumber As String
TestNumber = InputBox("Please enter TestNumber") ' Some codes running on
TestNumber
' Prompt users whether to continue to Main2 Dim Continue As String 
      Continue = MsgBox("Continue to Main2?", vbYesNo) 
      If Continue = vbYes Then 
              Call Main2 
          Else 
      End If 
End Sub
Sub Main2() ' Similar to Main1, just that it will prompt if user wants to
continue to Main3
Dim TestNumber As String
TestNumber = InputBox("Please enter TestNumber") ' Some codes running on
TestNumber
Dim Continue As String 
      Continue = MsgBox("Continue to Main3?"), vbYesNo) 

      If Continue = vbYes Then 
              Call Main3 
          Else 
      End If 
End Sub
Sub Main3() ' The last call of the series
Dim TestNumber As String
TestNumber = InputBox("Please enter TestNumber") 'Some codes running on
TestNumber
End Sub
Then, I consider it to be a bit troublesome and risky to re-enter TestNumber for
each call, so I changed my code to something like:
Sub Main1()
Dim TestNumber As String
TestNumber = InputBox("Please enter TestNumber") ' Some codes running on
TestNumber
' Prompt users whether to continue to Main2 Dim Continue As String 
      Continue = MsgBox("Continue to Main2?", vbYesNo) 
      If Continue = vbYes Then 
              Call Main2(TestNumber) 
          Else 
      End If 
End Sub
Sub Main2(TestNumber As String) ' Similar to Main1, just that it will prompt
if user wants to continue to Main3
If TestNumber = "" Then 
          TestNumber = InputBox("Please enter TestNumber") 

      Else 
End If
' Some codes running on TestNumber
Dim Continue As String 
      Continue = MsgBox("Continue to Main3?"), vbYesNo) 
      If Continue = vbYes Then 
              Call Main3(TestNumber) 
          Else 
      End If 
End Sub
Sub Main3(TestNumber As String) ' The last call of the series
If TestNumber = "" Then 
          TestNumber = InputBox("Please enter TestNumber") 
      Else 
End If
' Some codes running on TestNumber
End Sub
This works just fine if I work all the way through Main3 starting from Main1.
But if I start from Main2 or Main3, neither script runs. Instead, the system
prompts for which subroutine to run.
Is there a way for a subroutine to auto-detect whether it is called with an
argument or it is called separately? Answer
You can mark the parameter as optional and supply a default value like this:
Sub Main2(Optional TestNumber As String = "")
or you can change the parameter to a variant, mark it as optional and then test if
the parameter was supplied using IsMissing like this:

Sub Main2(Optional TestNumber As Variant)
If IsMissing(TestNumber) Then
' do stuff
Else
' do other stuff
Topic 989
Subject
Excel sumifs and rank / sort output
Question
I am trying to do the following:
Essentially, I want to use a sumifs function on a bunch of criteria which then
calculates to see whether its $ value is > 10% of a total value. I want to return
the top 10 values.
1. Name 2. Category $ Value % of total A 1 4 2.5% B 2 5 7.5% C 3 7 10.0%
D 4 2 10.0% E 5 8 5.0% C 6 3 5.0% G 7 5 10.0% K 8 9 10.0% I 9 1
10.0% J 10 2 10.0% K 11 7 10.0%
Is this obtainable? The data set I will eventually use may have 100k+ rows. So
I want a quick way to group all the names together, sum up their $values and
%, and if they exceed 10% rank them based on the top 10. Answer
Use a pivot table. Group by name, i.e. drag name to the row panel, sum the
values, i.e. drag value to the values panel and set to sum. Drag values to the
values panel again and set to show as a percentage of the grand total. Sort by
that percentage, filter to show top ten.
That's what pivot tables were invented for. Just a few clicks to aggregate, sort,
rank.
Not a single Sumifs in sight. Don't pre-load a question with an unsuitable
function.

Topic 990
Subject
How can I import code to a Activex Control Button on another page?
Question
I have use a button (by clicking) to create a new sheet and insert a button on it,
but I want to import codes to the new button (here is MyPrecodedButton).
Private Sub CommandButton1_Click()
Dim z As Integer
Dim wb As Workbook
Dim ws2 As Worksheet, wsnew As Worksheet
Set wb = ThisWorkbook
Set ws2 = wb.Sheets("Sheet2")
z = ws2.Cells(2, 1).Value
Set wsnew = Sheets.Add ' Declare your New Sheet in order to be able to work
with after wsnew.Name = "PIAF_Summary" & z
z = z + 1
With wsnew.Range("A1:G1") 
      .Merge 
      .Interior.ColorIndex = 23 
      .Value = "Project Name (To be reviewed by WMO)" 
      .Font.Color = vbWhite 
      .Font.Bold = True 
      .Font.Size = 13 
End With
ws2.Cells(2, 1).Value = z
Dim Rngc As Range: Set Rngc = wsnew.Range("F35") With
ActiveSheet.OLEObjects.Add(ClassType:="Forms.CommandButton.1",
Link:=False, DisplayAsIcon:=False, Left:=Rngc.Left, Top:=Rngc.Top,
Width:=205, Height:=20)

.Name = "MyPrecodedButton" ' change the name End With
End sub
Here is the code for MyPrecodedButton
Public Sub MyPrecodedButton_Click()
MsgBox "Co-Cooo!"
End Sub
Answer
Let's demonstrate briefly what you can do with VBA to Add buttons.
Below code will Add a button to cell B2 if the ActiveSheet is not "Sheet1".
Option Explicit
Sub SayHello()
MsgBox "Hello from """ & ActiveSheet.Name & """" End Sub
Sub AddButton()
Dim oRng As Range
Dim oBtns As Buttons ' Add "Microsoft Forms 2.0 Object Library" to
References if you want intellisense If ActiveSheet.Name <> "Sheet1" Then '
Only works if it's not "Sheet1" 
      Set oRng = Range("B2") 
      Set oBtns = ActiveSheet.Buttons 
      With oBtns.Add(oRng.Left * 1.05, oRng.Top * 1.05,
oRng.Width * 0.9, oRng.Height * 2 * 0.9) 
          .Caption = "Say Hello!" 
          .OnAction = "SayHello" 
      End With 
      Set oBtns = Nothing 
      Set oRng = Nothing 
End If
End Sub

Before and After screenshots:
Now Clicking on the button:
So, if you code is generic enough (to work with all your possible situations),
there is no need to Add Codes via code. i.e. have your codes ready, then just
assign the button's OnAction property to call the correct Sub.
Topic 991
Subject
Is there a version of DataNitro for Excel that uses Python 3.5?
Question
Is there a version of DataNitro for Excel that uses Python 3.5? I noticed the
trial version uses (and installs) Python version 2.7.9. I've been using Python
3.5 for all of my new Python projects and I'm not really too keen on having yet
another version of Python on my machine. Answer
DataNitro works with Python 3.5 out of the box. To use it, skip the 2.7.9
installation (uncheck the box in the first screen of DataNitro's installer). Once
DN is installed, go to Settings in the DN ribbon toolbar, uncheck "use default
Python", and put in your Python 3.5 directory. After restarting Excel everything
should work.
Topic 992
Subject
Nesting Excel Logic Tests
Question
I'm having issues nestling logic tests in Excel. I'm trying to get a cell to return a
value based on whether it meets an "AND" or "OR" or neither.
Something like:
If Value A = "True" and Value B = "True" and Value C = "True" then "Return
Value"

else
If Value A = "True" or Value B = "True" or Value C = "True" then "Return
Value"
else
"Return Value"
Answer
Use AND() and OR() function within your if statements. For example:
=IF(AND(Value A,Value B,Value C), Return Value(IF), IF(OR(Value A,Value
B,Value C), Return Value (ElseIF), Return Value (Else)))
Topic 993
Subject
Render all rows of a common value from one sheet to another
Question
I need a sheet in my workbook to render all rows of the same two values.
The sheet I am referencing from has a number of columns for product types and
condition.
I need a second sheet to show information for all products with the condition
'new' and type 'hats'
I know I can do this by adding filters. However, I need the ability to have the
sheet pull product with these two specifications without adding filters.
Topic 994
Subject
Dynamic range calculations macro
Question
I have an Excel document consisting of 12 sheets. Every sheet contains a lot of
data, ranging from column A to X and with a variable range in rows. I'm trying
to calculate the mean and the Standard error of every column, for every sheet.
Preferably with an output on a summary sheet.

My thinking process:
I managed to let every cell under the last row calculate the average. When I
tried to do the same with the standard error, the problem is that the average
calculated in step 1) was included in the calculations. After all, it seems more
convenient to display the results of these calculations in a separate 'summary'
tab.
Here's the code I tried, which works for the averages to be produced right
below the last value in the columns.
Sub ColumnAverageFormula()
For i = 3 To 24
Columns(Columns(i).Address).Select
Cells(1, ActiveCell.Column).End(xlDown).Offset(1, 0).Formula =
"=Average(" & Cells(1, ActiveCell.Column).Address(0, 0) & ":" & Cells(1,
ActiveCell.Column).End(xlDown).Address(0, 0) & ")" Next i
For j = 3 To 24
Columns(Columns(j).Address).Select
Cells(1, ActiveCell.Column).End(xlDown).Offset(1, 0).Formula = "=stdev.p("
& Cells(1, ActiveCell.Column).Address(0, 0) & ":" & Cells(1,
ActiveCell.Column).End(xlDown).Address(0, 0) & ")" Next j
End Sub
Tl;dr: I'd like to write code that calculates the average and the standard error
of every column of every sheet in my Excel file, and the results should be
produced on a 'summary' sheet. Answer
The formula you were inserting referenced a range starting at row 1. Typically
a data set like you have described has some sort of text based column header
label in the first row. If this was the case, you would want to start at row 2, not
row 1. The following starts at row 1.
Sub ColumnAverageFormula()

Dim c As Long, sr As Long
With Worksheets("Sheet1") 
      sr = .Cells(Rows.Count, 3).End(xlUp).Row 
      For c = 3 To 24 
          .Cells(sr + 1, c).Formula = "=average(" &
.Range(.Cells(1, c), .Cells(sr, c)).Address(0, 0) & ")" 
          .Cells(sr + 2, c).Formula = "=stdev.p(" &
.Range(.Cells(1, c), .Cells(sr, c)).Address(0, 0) & ")" 
      Next c 
End With
End Sub
'as an alternate, you might consider putting all of the formulas in at once Sub
ColumnAverageFormula()
Dim c As Long, sr As Long
With Worksheets("Sheet1") 
      sr = .Cells(Rows.Count, 3).End(xlUp).Row 
      .Cells(sr + 1, 3).Resize(1, 22).Formula = "=average(" &
Range(.Cells(1, 3), .Cells(sr, 3)).Address(0, 0) & ")" 
      .Cells(sr + 2, 3).Resize(1, 22).Formula = "=stdev.p(" &
Range(.Cells(1, 3), .Cells(sr, 3)).Address(0, 0) & ")" 
End With
End Sub
If you want to start at row 2, change .Range(.Cells(1, c), ... to .Range(.Cells(2,
c), ....
Topic 995
Subject
How does the VBA PageSetup.LeftHeader formatting work?
Question
I want to write a function that will setup the header / title for every worksheet,

base on the worksheet's name. I used the online resource and macro recorder to
write this. But can someone explain how the quotation marks and & symbol
work? Does it always require to have "&" leading the format, and can all the
styling go under one set of ""?
Sub SetAllHeader()
Dim ws As Worksheet
Dim wsName As String
For Each ws In ThisWorkbook.Worksheets 
      wsName = ws.name 
      ws.PageSetup.LeftHeader =
"&""Calibri,Regular""&22&K000000" & wsName 
Next ws
End Sub
I experimented and try to manually clean up the code by doing
ws.PageSetup.LeftHeader = "&Calibri,Regular&22&K000000" & wsName
But this does something totally different. I would like to learn and write this by
hand if possible.
Topic 996
Subject
Protecting a worksheets using a password in excel 2013 using VBA
Question
I've been trying to protect a worksheets in excel using VBA that would ask the
user to input password each time he try to edit it or unprotect the sheet. I've
tried this could below but its not working well. Thank you for your great help.
Function protectSheet()
ThisWorkbook.Sheets("User").Protect Password:="trial", true, true End

Function
Answer
The problem with your code is you are using function instead of sub :) Rest
you seem to be Good. Thanks
Answer
Use this sub.
Sub shtProtect()
Sheet1.Protect Password:="trial" 'Use your sheet name instead Sheet1 End Sub
Topic 997
Subject
MATCH() function can't locate hours (GOOGLE SHEETS)
Question
I've created a Time Sheet for my dog walkers to fill in. They enter TIME
STARTED and TIME ENDED for each of their dog walks and then a TOTAL
TIME is generated using the =X-Y formula. This TOTAL TIME is formatted to
be displayed in hh:mm but its true VALUE is a long integer.
Using the MATCH and INDEX functions, I've set up a formula to match the
TOTAL TIME value generated to an index on the "Payment Schedule" sheet
and locate the respective payment.
I keep getting errors that state the total time VALUES can't be matched but I
know that formatting isn't the issue and the values are clearly on the "Payment
Schedule" sheet. And when the MATCH function does return a row it returns
the incorrect row, which locates the incorrect payment/rate.
Here is the google sheet I'm having trouble with.
Any help would be appreciated.
Answer
Found the answer:

it's floating point rounding error on the time values. I don't fully understand
what's happening, but I was able to reproduce it on my system, and I found a
work-around: Change your formula to
=INDEX(B:B, MATCH($I$4+TIME(0,0,1), A:A)) This adds one second
(TIME(0,0,1); the arguments are TIME(hours,minutes,seconds)) to the I4
value; that seems to be enough to get it "over the hump", so that it tests as being
≥ the value in A4 (or A7 or A10). BTW, I tried TIME(0,0,0.9), but apparently
TIME() won't honor fractional seconds, and so it just treats that as
TIME(0,0,0); i.e., just plain zero. If you want to get a millisecond, you can use
TIME(0,0,1)*0.001.
P.S. You had an unnecessary pair of parentheses in your formula; I removed it,
above.
link
Topic 998
Subject
Export each sheet from Excel to each pdf page
Question
I want to export specified Excel sheet to specified page on PDF. For example,
Sheet1 from Excel to Page1 on PDF. Sheet2 from Excel to Page2 on PDF...so
on. I know how to export whole Excel book to PDF but I can't specify which
sheet needs to be exported to which page. Does anybody have any idea?
Topic 999
Subject
Excel VBA: Update the formatting for all worksheets [duplicate]
Question
This question already has an answer here:
How to avoid using Select in Excel VBA macros
8 answers

I read through a few online tutorials, and use the macro record to learn how to
set formats. But I am wondering is there a way to do the following, without
using .Select? Or what is the preferred way by programmers?
Requirement for the simple macro:
Loop through all the worksheets (visible only) Set bold format to the top row,
and set the background to grey Reset the selection to A1 position
()
Sub SetAllTopRowBold()
Dim ws As Worksheet
On Error Resume Next
For Each ws In ThisWorkbook.Worksheets
If ws.Visible Then 
      ws.Activate 
      Rows(1).Select 
      Selection.Font.Bold = True 
      Selection.Interior.Color = RGB(190, 190, 190) 
      Range("A1").Select 
End If
Next ws
End Sub
Answer
You can do it directly against the range object:
For Each ws In ThisWorkbook.Worksheets
If ws.Visible Then 
      ws.Rows(1).Font.Bold = True 
      ws.Rows(1).Interior.Color = RGB(190, 190, 190) 
      ws.Select 
      ws.Range("A1").Select 

End If
Next ws
Topic 1000
Subject
In excel, how to make a matrix out of data lists?
Question
I want to make a 20 x 20 matrix in excel, given 3 lists of data
For example, the lists are:
And I want to make a matrix like this:
So for example, the first row of the data reads: TYR MET 3. In the matrix,
where the column(green) reads TYR and the row(red) reads MET, I put a 3.
I am making several of these matrices, and it take a lot of time to plug in each
value manually. Do you have any ideas for formula, code, or tool that would
help make this matrix in excel?
Many thanks!!!
Topic 1001
Subject
Copy paste from pdf wrap line
Question
I have a PDF file when I copy and paste from PDF to Excel the wrap line
occurs multiple times for each numerical.
Would be something like "if active cell [start with number and end with ;]"
concatenate
[
Topic 1002

Subject
Excel spreadsheet VBA code not working all the way
Question
The code that is running on my excel spreadsheet that I am working on is
working fine, expect for when I copy and import information into the protected
cells it gives me a type mismatch error and can not figure out how to fix the
code.
Option Explicit
Private Sub Worksheet_Change(ByVal Target As Range)
On Error GoTo Whoa
Application.EnableEvents = False
If Not Intersect(Target, Range("C1:C20")) Is Nothing Then
If Len(Trim(Target.Value)) = 0 Then Application.Undo End If
LetsContinue
Application.EnableEvents = True Exit Sub
Whoa
MsgBox Err.Description Resume LetsContinue End Sub Answer
When you paste a number of values into two or more cells within the C1:C20
range, the Target is more than 1 and you cannot use the Range.Value property of
Target.
Typically, you would use something like the following.
Private Sub Worksheet_Change(ByVal Target As Range)
If Not Intersect(Target, Range("C1:C20")) Is Nothing Then 
      'do not do anything until you know you are going to
need it 
      On Error GoTo Whoa 
      Application.EnableEvents = False 

      Dim crng As Range 
      'in the event of a paste, Target may be multiple cells 
      'deal with each changed cell individually 
      For Each crng In Intersect(Target, Range("C1:C20")) 
          If Len(Trim(crng.Value)) = 0 Then Application.Undo 
          'the above undoes all of the changes; not just the
indivual cell with a zero 
      Next crng 
End If
LetsContinue
Application.EnableEvents = True Exit Sub
Whoa
MsgBox Err.Description Resume LetsContinue End Sub
However, your desire to use Application.Undo presents some unique problems
because you do not want to undo all of the changes; just the ones that result in
zero. Here is a possible solution.
Private Sub Worksheet_Change(ByVal Target As Range)
If Not Intersect(Target, Range("C1:C20")) Is Nothing Then 
      'do not do anything until you know you are going to
need it 
      On Error GoTo Whoa 
      Application.EnableEvents = False 
      Dim c As Long, crng As Range, vals As Variant, prevals
As Variant 
      'store the current values 
      vals = Range("C1:C20").Value2 
      'get the pre-change values back 
      Application.Undo 
      prevals = Range("C1:C20").Value2 
      'in the event of a paste, Target may be multiple cells 
      'deal with each changed cell individually 
      For c = LBound(vals, 1) To UBound(vals, 1) 
          If vals(c, 1) = 0 Then vals(c, 1) = prevals(c, 1) 
      Next c 
      Range("C1:C20") = vals 

End If
LetsContinue
Application.EnableEvents = True Exit Sub
Whoa
MsgBox Err.Description Resume LetsContinue End Sub
The new values are stored in a variant array and then the paste is undone. The
old values are stored in another variant array. The new values are walked
through and if a zero comes up, it is replaced with the old value. Finally, the
revised set of new values is pasted back into the C1:C20 range.
Answer
Your sheet must be protected, so you need to unprotect your sheet first:
Option Explicit
Private Sub Worksheet_Change(ByVal Target As Range)
Sheets("NameOfYourSheet").Unprotect Password:="YourPassWord" ' Change
the name of the sheet which is locked
On Error GoTo Whoa
Application.EnableEvents = False
If Not Intersect(Target, Range("C1:C20")) Is Nothing Then
If Len(Trim(Target.Value)) = 0 Then Application.Undo End If
Sheets("NameOfYourSheet").Protect Password:="YourPassWord"
LetsContinue
Application.EnableEvents = True Exit Sub
Whoa
MsgBox Err.Description Resume LetsContinue End Sub

Topic 1003
Subject
In Google Sheets, is it possible to conditionally format based on the value
being repeated a certain number of times in the previous columns?
Question
In Google Sheets, is it possible to conditionally format a cell based on the
value being repeated a certain number of times in the previous columns?
For example, consider the following data:
A B C D
dog car fish win
fur dog cat blue
red fish dog hike
sky ski sky sky
In this case, I'd like to format a cell if the value exists at least twice in the
previous 3 columns.
In this case, dog would be formatted because it exists in A1, B2, C3 (so C3
would trigger that it exists at least twice in the previous 3 columns).
In this case, sky would also be formatted because it exists in A4, C4 and D4.
D4 would trigger that it exists in at least 2 of the previous 3 columns.
I have tried to use COUNTIF, but it doesn't seem to be working properly: I
applied this formula to the cells E:E:
=AND(NOT(ISBLANK(A1)),COUNTIF(B:D,A1)>1)
Topic 1004
Subject
Excel Row Majority Voting

Question
I have a excel file with value that are between 1 and 8, this is the first two
lines of my file. I would like to create a new column that return the value with
the highest occurence for each row For example you can see here in the 1st
row 3 has the highest occurence so I return 3 in the second it's 7 ...
3 3 3 3 4 3 3 3 3 3 3 3 *3* 7 6 6 7 7 6 7 7 7 8 6 7 *7*
Could you help me please
Thanks
Answer
This formula work also
=MODE(A1:L1)
Answer
Try it with the excel formula max highest value in row 1 is 4 en for row 2 is it
Answer
Try this formula:
=MATCH(1, IF(COUNTIF(A1:L1,
{1,2,3,4,5,6,7,8})=MAX(COUNTIF(A1:L1,{1,2,3,4,5,6,7,8})),1,0),0)
Or this one:
=SUMPRODUCT((COUNTIF(A1:L1,
{1,2,3,4,5,6,7,8})=MAX(COUNTIF(A1:L1,{1,2,3,4,5,6,7,8})))*
{1,2,3,4,5,6,7,8})
Topic 1005
Subject
How to write an IF statement in excel for times and dates in the same cell
Question
I am trying to find out if an event occurs between two other events.

For all three events, I have the date in one column, the time in another column
and then the date followed by the time in a third column. Column C is
formatted like this =TEXT(B1,"dd/mm/yyyy ")&TEXT(A1,"hh:mm:ss")
The table looks like this:
| a | b | c |
1 | time | date |time/date|
2 | time | date |time/date|
3 | time | date |time/date|
Row 1,2 and 3 are each event. Let's say we're trying to work out if event 3
occurs within event 1 and 2. The formula I have so far goes in D1 and looks
like this:
=IF(AND(DATEVALUE(C3)>=DATEVALUE(C1),DATEVALUE(C3)
<=DATEVALUE(B3)),TRUE,FALSE)
I have various different sets of events that I want to check in a similar way, but
it's not working for me. I have made sure that each cell I'm referring to is
formatted correctly i.e date is dd/mm/yyy and time is hh:mm:ss etc but it's not
working for some reason.
Haven't found an answer to this anywhere so I would really appreciate some
help.
Thanks in advance!
Topic 1006
Subject
Get ?? when taking chinese characters from excel sheet and exporting to mysql
via vba
Question
Let me preface this question by saying that I know that this subject is tackled
from various angles in numerous posts. However, I have spent hours and hours
on this and still cannot get it to work, so asking for help.

I have some chinese characters in cells in an Excel sheet. I am using VBA to
export the content of these cells into a mysql table. From the mysql command
line, I am able to insert the chinese characters into the table successfully (I am
using utf8mb4 charset).
I have also set charset=utf8mb4 in the VBA connection string.
However, I cannot get VBA to include the chinese characters in the query
string, which is as follows:
SQLStr = "INSERT INTO " & VBA.Trim(databaseName) &
".translationTable" & " VALUES ('" & _ timestamp & "','" & _
Replace(Worksheets("translationTable").Range("IORange").Cells(Counter, 2),
Chr(10), "") & "','" & _
Replace(Worksheets("translationTable").Range("IORange").Cells(Counter, 3),
Chr(10), "") & "','" & _
Replace(Worksheets("translationTable").Range("IORange").Cells(Counter, 4),
Chr(10), "") & "','" & _
Replace(Worksheets("translationTable").Range("IORange").Cells(Counter, 4),
Chr(10), "") & "')" rs.Open SQLStr, oConn
I know that VBA editor will not display the chinese characters in any case.
However, chinese characters inserted from VBA are showing up as ?? in the
database as well.
It seems that something that I am doing is converting the chinese characters to
ASCII, before the INSERT statement is executed.
What am I doing wrong?
Answer
The usual cause of multiple question marks:
you had utf8-encoded data (good)
SET NAMES latin1 was in effect (default, but wrong) the column was
declared CHARACTER SET latin1 (default, but wrong)
If those tips don't suffice, then show us what is in the tables, using something

like
SELECT col, HEX(col) FROM tbl...
Chinese cannot be "converted to ascii".
Addenda
Try setting the DNS's 'Connect Options'->'Initial Statement' to 'SET NAMES
utf8mb4'. -- MySQL ODBC 3.51 Driver UTF-8 encoding
Topic 1007
Subject
Using Excel to count text occurences over two columns
Question
I have a long Excel spreadsheet with names in 2 columns and I am trying to be
able to count the number of times a name appears in column A with a particular
name appearing in the same row in column B but I am getting caught up with
formulas.
For example, if I have:
Col A, Col B
Wilson, Ted
Wilson, Alice
Poole, Frank
Wilson, Ted
Poole, Alice
Frank, Ted
I would like to be able to construct a formula that would tell me that Wilson,
Ted appears two times. I've tried COUNTIFS in the following configuration
but it returns 0 as an answer:
COUNTIFS(A1:B6,"Wilson",A1:B6,"Ted")
Am I missing something completely or is Excel just not built for this? Answer

Try this:
COUNTIFS(A1:A6,"Wilson",B1:B6,"Ted")
You need to divide each column into their own search.
Answer
COUNTIFS(A1:A6,"=Wilson",B1:B6,"=Ted")
Topic 1008
Subject
List all possible percentage splits for >3 inputs
Question
I want to create a list of all possible percentage splits between different
number of stocks (a task required to build a proper investment opportunity set).
I was able to create a macro tailored for 3 different inputs (the code is below).
Is it be possible to upgrade that macro so that it will automatically take into
consideration the number of inputs (i.e. stock tickers) without the necessity to
adjust the code every time? So that if input is 5 tickers instead of 3, it will
create the list of all possible splits for 5 tickers?
Spreadsheet layout is simple: in row 1 I have a separate ticker in each column
(3 tickers at the moment), and the split is provided below as:
ColumnA ColumnB ColumnC
row1 Ticker1 Ticker2 Ticker3 
row2    0       0      100 
row3    0       1      99 
etc.
Here's what I'm using for 3 inputs:
Sub PercentageSplits()

Dim Lastcol As Integer
Lastcol = Sheet1.Cells(1, Columns.Count).End(xlToLeft).Column
Sheet1.Cells(1, Lastcol + 1).Value = "Total" Sheet1.Cells(1, Lastcol +
1).Font.Bold = True
Dim row As Integer: row = 2
Dim i As Integer, j As Integer, k As Integer
For i = 0 To 100: For j = 0 To 100: For k = 0 To 100
If i + j + k = 100 Then 
      Sheet1.Cells(row, 1).Value = i 
      Sheet1.Cells(row, 2).Value = j 
      Sheet1.Cells(row, 3).Value = k 
      Sheet1.Cells(row, Lastcol + 1).Value = i + j + k 
      row = row + 1 
End If
Next: Next: Next
End Sub
Answer
I put a quick program together to calculate these and for a total of 100 split
across 5 tickers, I got more than 4.5 million results (4,598,126 to be precise).
That's way too many to fit on an Excel sheet.
To make sure that the output would fit on an Excel sheet, I halved the precision
by calculating combinations of 5 tickers which added to 50 and then doubling
the results. This gives 316,251 results.
If you need full precision then you could adapt the code to output the data in
chunks of 1 million rows per worksheet
I don't often use recursion in VBA but it seemed the obvious way to answer
this particular question. I'll explain some details below the code:

Option Explicit
' We'll store each result here
Dim splitList As Collection
Sub main()
Dim splitResult As Variant
Dim splitArray As Variant
Dim splitEntry As Variant
Dim outputArray() As Variant
Dim outputRow As Long
Dim outputCol As Long
' Initial set-up
Const TOTAL_TO_SPLIT As Integer = 50
Const NO_OF_TICKERS As Integer = 5
Set splitList = New Collection
' Generate the list
findSplit TOTAL_TO_SPLIT, 1, NO_OF_TICKERS, ""
MsgBox splitList.Count
' Output the list
ReDim outputArray(1 To splitList.Count, 1 To NO_OF_TICKERS) outputRow
= 1
With Worksheets("Sheet1")
.UsedRange.Clear
For Each splitResult In splitList 
      outputCol = 1 
      If Len(splitResult) > 0 Then 
          splitArray = split(splitResult, ";") 
          For Each splitEntry In splitArray 
              outputArray(outputRow, outputCol) = splitEntry
* 2 
              outputCol = outputCol + 1 
          Next splitEntry 

      End If 
      outputRow = outputRow + 1 
Next splitResult
.Cells(2, 1).Resize(splitList.Count, NO_OF_TICKERS).Value = outputArray
End With
End Sub
' This sub is intended to be called recursively and will add an entry ' to
splitList after each recursion concludes Sub findSplit(amountToSplit As
Integer, currentTicker As Integer, _
totalTickers As Integer, resultSoFar As String)
Dim i As Integer
' Call DoEvents to prevent Excel from showing as "Not Responding" DoEvents
' Check if this is the last ticker
If (currentTicker = totalTickers) Then
splitList.Add resultSoFar & amountToSplit Else
For i = 0 To amountToSplit 
      ' Otherwise, generate all the possible splits by
recursion 
      findSplit (amountToSplit - i), (currentTicker + 1), _ 
          totalTickers, (resultSoFar & i & ";") 
Next i
End If
End Sub
Notes

this is not going to run quickly. I suggest that you bring up the Locals window
(View > Locals window) in the Visual Basic editor before running the macro
so you can periodically use Ctrl-Break to check on progress you could
eliminate the collection and just write directly into the 2D array but I was
trying to keep the recursive part of the code as simple as possible
It's probably easiest to understand the recursive sub (findSplit) by working
backwards. If we are on the final ticker (so currentTicker = totalTickers) then
we only have one possibility: the amount left over after all of the previous
tickers needs to be allocated to the final ticker.
If we back up a level, if we are on the second-last ticker and the amount left
over is 1 then we have two choices. Allocate 0 to the second-last ticker and
pass 1 on to the last ticker OR allocate 1 to the second-last ticker and pass 0
on to the last ticker. Extending things to more tickers and/or greater amounts is
just a repetition of these same two rules:
if this is the last ticker, allocate whatever's left to this ticker if this is not the
last ticker, try every possible allocation of whatever was left to this ticker and
pass whatever is left over on to the next ticker
Each ticker adds the amount it was allocated to a string which is added to the
collection by the last ticker. An entry of 14;6;0;13;17 shows that the ticker 1
was allocated 14, ticker 2 was allocated 6 and so on. As stated above, I
reduced the number of results by calculating allocations against a total of 50
and then doubled the result. So the 14;6;0;13;17 combination would output as
28;12;0;26;34 (and you'll find it in row 228559 on the output worksheet).
The code in the main sub using Split and the For Each ... Next loops converts
the strings stored in the collection into a 2D array of numbers that we can drop
directly on to the worksheet
Topic 1009
Subject
Multiply numbers in Excel or LibreOffice cell contents by a constant when they
are mixed with text?
Question

I have a long series of cells written like this (example text):
Example Number (3502, 456)
How would I multiply the numbers by 4 without having to delete the text?
I also have cells in the format [sic below]:
Example Number (3502,456) (4560,250) (2345,223)
et cetera, there are on average ten parentheses per text string.
Occasionally, the text might also be only one word long, e.g.
Example (3205, 456)
or
Example (3205,456) (4560,250) (2345,223)
et cetera.
(all above is [sic]).
As a sort of newbie to Excel (well, really Libre Office Calc but it's essentially
the same), how would I do this? I don't want to go through and manually
multiply all the numbers myself. The number I want to multiply by is 4. I've
tried just running a find-and-replace to replace all ,'s and )'s with *4's, but the
program I need these numbers for can't evaluate expressions, it needs single
numbers.
There are some 110+ items on each list I need to change, and just one math
error on any of the three lists (!) and the program won't run correctly (I'm
resizing an image, and the points I plotted on the image didn't scale up with it).
I don't want to risk it. Answer
It should be possible to do this with a macro but unless I'm mistaken
LibreOffice macro code is quite different from Excel VBA.

However if you can afford to use several columns of your spreadsheet to figure
the values out, you can do so using formulae. If cell A1 contains
Example Number (3502,456) (4560,250) (2345,223)
and B1 contains
=MID(A1,FIND("(",A1)+1,9999)
then this formula will return the 3502 as a number:
=NUMBERVALUE(LEFT(B1,FIND(",",B1)-1))
(9999 is chosen to be much larger than the likely length of any line, so the MID
function will always return the whole of the rest of the text after the search
character).
You should be able to combine MID and FIND functions in further cells to
isolate the other numbers, assuming these are always found in the format
(xxx,yyy) as per your example. Then you can use a final formula to rebuild the
string from the multiplied numbers:
="Example Number (" & 4C1 & "," & 4E1 & ")"
and so on.
If your data has a variable number of numbers to find, some of your FIND
functions may return a #VALUE error. You may need to use an IF function to
exclude these, for example:
=IF(ISERROR(G1),"",G1)
would return the value of G1 if it contains data, but blank if it contains an
error.
Answer
Here is a Python LibreOffice macro that does what you want. It assumes all of
the values are in column A, and it writes the results to column B.

import re
def do_calculations():
document = XSCRIPTCONTEXT.getDocument() sheet =
document.getSheets().getByIndex(0) cellrange =
sheet.getCellRangeByName("A1:A10000") row_tuples =
cellrange.getDataArray() row = 1
for row_tuple in row_tuples: 
      if row_tuple: 
          row = output_values(row, row_tuple[0], sheet) 
def output_values(row, pairs_string, sheet):
"""Multiply pairs of values by 4 and output each pair to B column. :param
row: the row number in the B column :param pairs_string: a string like
"Example Number (123, 456) (789, 1011)" :param sheet: the current
spreadsheet Returns the next row number in the B column. """
pairs = re.findall(r'\([^)]+\)', pairs_string) for pair in pairs: 
      match_obj = re.match(r'\((\d+),\s*(\d+)\)', pair) 
      x, y = match_obj.groups() 
      result = "(%d,%d)" % (int(x) * 4, int(y) * 4) 
      cell = sheet.getCellRangeByName("B" + str(row)) 
      cell.setString(result) 
      row += 1 
return row
# Functions that can be called from Tools -> Macros -> Run Macro.
g_exportedScripts = do_calculations,
Save the code to a text file, for example calc_multiply_numbers.py. Put it in
Scripts/python in your LibreOffice user directory. On my Windows system it is
C:\Users\JimStandard\AppData\Roaming\LibreOffice\4\user\Scripts\python. If
the python directory doesn't exist yet, create it.
To run it, open the spreadsheet and go to Tools -> Macros -> Run Macro.

Under My Macros, click calc_multiply_numbers and then press the Run button.
EDIT
I don't think you need to worry about the JRE error. On my system I can
uncheck "Use a Java runtime environment" in Tools -> Options -> LibreOffice
-> Advanced, and it still works. I just click "No" when it asks if I want to
enable the use of a JRE now, and then it runs my python macro.
The reason it is not showing up under My Macros is because python is not able
to interpret the file correctly. To find the error, test it with python using the
following steps (assuming Windows):
Open a command prompt, for example by pressing Win, typing cmd, and
clicking "Command Prompt" from the start menu. Type cd "path-to-
libreoffice/program". On my 64-bit system this is cd "C:\Program Files
(x86)\LibreOffice 5\program" I use the normal Windows File Explorer to find
the exact path. Type "python.exe python-script". On my system it is python.exe
"C:\Users\JimStandard\AppData\Roaming\LibreOffice\4\user\Scripts\python\cal
The python interpreter will give an error message about the problem. If you are
not able to figure out the message, write it in the comments below and I will
help you.
Topic 1010
Subject
Excel VBA for countifs with one criteria dependent on another criteria
Question
I'm doing some coding for a basketball team where I have thousands of lines of
data which contain 2 columns that represent X, Y coordinates where shots have
been taken on a half court. I need to be able to count the number of coordinates
in each area of the court. For example; calculating shots taken in the paint is
easy because the paint is a rectangle area, I.e using countifs(X:X, AND(X>=
120, X<= 320), Y:Y, AND(Y<=280).
But I need to calculate shots taken from the right wing and left wing, which the
coach defines as taking a straight line from underneath the basket through the

top right corner of the key, and a second straight line from underneath the
basket through the top left corner of the key. These lines are diagonal, and I'm
having trouble figuring out how to code it correctly in VBA, since the Y
coordinate value is dependent on the X coordinate value. let's say in this case,
the linear equation of the line is Y=-2.48X +500, and so I need the Countif to
count all the shots taken where the Y Coordinate is < 500 - (2.48 * X
coordinate).
Anyone have any ideas? I'm stuck here, conceptually it would look like this but
I know this doesn't work!
=countifs("Y:Y", "<500 - 2.48 * (""X:X"")")
**realize my =countifs only contains 1 criteria, using Countifs because there
are other criteria I need to use as well but omitting them for ease of exercise.
Other criteria I'm using include stuff like checking a column to see if the
columns value = Team Name, so that it only counts rows where Team A takes a
shot, or another column which indicates shot made or missed with a + or -
Answer
You are going to require an array formula¹ or SUMPRODUCT, neither of
which handles 'thousands of rows' well due to the logrythmic taxation of cyclic
processing. Full column references should be avoided at all costs.
In a cell as a standard formula,
=SUMPRODUCT(--(Y$2:INDEX(Y:Y, MATCH(1E+99,Y:Y ))<500-
2.48*X$2:INDEX(X:X, MATCH(1E+99,Y:Y ))))
The MATCH function uses an approximate match for an impossibly high
number. This returns the row number of the last number in column Y. It is used
to limit both X and Y columns to the extent of the data. The last number in
column Y is used in both cases as SUMPRODUCT requires that the ranges be
the same size (although not necessarily the same rows).
In a cell as an array formula¹,
=SUM(IF(X$2:INDEX(X:X, MATCH(1E+99,Y:Y )), --(Y$2:INDEX(Y:Y,

MATCH(1E+99,Y:Y ))<497.52), --(Y$2:INDEX(Y:Y, MATCH(1E+99,Y:Y ))
<500)))
¹ Array formulas need to be finalized with Ctrl+Shift+Enter↵. Once entered
into the first cell correctly, they can be filled or copied down or right just like
any other formula. Try and reduce your full-column references to ranges more
closely representing the extents of your actual data. Array formulas chew up
calculation cycles logarithmically so it is good practise to narrow the
referenced ranges to a minimum. See Guidelines and examples of array
formulas for more information.
Topic 1011
Subject
Best Practice in passing variables between caller and called sub procedures
and functions
Question
Is it good or bad coding practice to keep variables the same when passing
between sub procedures?
Option Explicit
Sub Callee(ByRef K As Integer, ByVal L As Integer) K = K + 1
L = L + 1
End Sub
Sub Caller()
Dim K As Integer, L As Integer
K = 1
L = 2
Callee K, L
Debug.Print K, L
End Sub
What would the problem be doing it this way, if there is one? Also, is it
personal preference or best practice to put called objects above the caller?
Topic 1012

Subject
Excel use a pivot table with VBA
Question
I have got a series of numbers, dates and times, I want to have the number with
the last date and time. With a pivot table it works fine, but is this possible with
VBA?
1 01/10/15 08:51
1 01/10/15 08:53
1 01/10/15 08:54
1 01/10/15 08:56
1 01/10/15 08:57
1 01/10/15 09:01
1 01/10/15 09:02
1 01/10/15 10:00
1 01/10/15 09:35
2 01/10/15 09:37
2 01/10/15 09:38
2 01/10/15 09:39
2 01/10/15 09:41
2 01/10/15 09:42
2 01/10/15 09:45
2 01/10/15 09:46
Topic 1013
Subject
Excel VBA to clear selected rows
Question
Hi I am trying to build a timer that fills rows using Application.Ontime but
clears them if they are more than 30 minutes old. This is so I can run the timer
indefinitely without accumulating more than 30 minutes of data and crashing
my system. So far I can create a new data row every second successfully.
I have a time column on A and Column B is a tag with a 1 or 0 representing if
the row is more than 30 mins old. Other Columns have data. I would like my
macro to look down from the first data row (row 10) and find the first row that

is not blank (has not already been cleared) and has a 1 in Column B (is more
than 30 minutes old) then clear the row. All other rows should be unaffected,
and remain beneath the newly blanked space.
There should only ever be one row with a tag as this will run every second.
I would like to keep it clean and use rows.clear as selecting and deleting
seems to slow the process down a lot..
Any help much appreciated, thanks.
EDIT: Sorry for lack of clarity, getting fuzzy. Answer
You can try this:
Sub Clear()
Dim wb As Workbook
Dim ws1 As Worksheet
Dim Lastrow As Long
Dim i As Long
Set wb = ThisWorkbook
Set ws1 = wb.Sheets("Sheet1") 'Change the name of your sheet
Lastrow = ws1.Range("A1").SpecialCells(xlCellTypeLastCell).Row
With ws1
i = 10
Do 
          If .Cells(i, "B") = 1 Then 
              .Cells(i, "B").EntireRow.ClearContents 
              '.Cells(i, "B").EntireRow.Delete 
          End If 
      i = i + 1 

Loop Until i > Lastrow
End With
End Sub
EDIT#1
Based on the comments below:
Sub Clear()
Dim wb As Workbook
Dim ws1 As Worksheet
Dim Lastrow As Long
Dim i As Long
Set wb = ThisWorkbook
Set ws1 = wb.Sheets("Sheet1") 'Change the name of your sheet
Lastrow = ws1.Range("A1").SpecialCells(xlCellTypeLastCell).Row
With ws1
i = 1
TimeLimit = Time - TimeSerial(0, 30, 0)' Time limit NOW - 30 minutes
Do 
          If .Cells(i, "A") < TimeLimit Then ' If value in
column A is less then the Timelimit then 
              .Cells(i, "A").EntireRow.ClearContents 
          End If 
      i = i + 1 
Loop Until i > Lastrow
End With
End Sub

Topic 1014
Subject
How to correctly format an alpha-numerical in an exported csv file opened in
excel
Question
On exporting a csv file and opening it in microsoft excel, I find there is a
column containing 25 or more alpha-numericals/numericals. Some of the
entries do not have even one alphabet and are pure numbers.
On trying to format the cells to numbers or text, the excel converts the last 9
digits into zeros thus distorting the value.
Please suggest and help.
Answer
You have several options.
Instead of opening the CSV file with File > Open, try using Data > From Text.
This will start the import wizard, where in Step 3 you can select each column
and define it as Text. This will store the numeric characters as text and will
retain each character. Use Power Query to get the data. Power Query is a free
add-in for Excel 2010 and 2013 and is built into Excel 2016 as "Get &
Transform". You can load the CSV file and define the data type of each column.
Each step taken to set up the query will be recorded in a script. Once set up,
the query can be refreshed and the script is run. This approach is especially
suitable if the import happens repeatedly.
Topic 1015
Subject
Openpyxl - Apply Borders to Cells
Question
I am hoping someone can help me as I have been unable to figure this one out
for myself unfortunately.
I am trying to put a thin border around a cell using openpyxl 2.3.3 and python
3.4. I have the following code:

from openpyxl.styles import Border
ws.cell('A1').border = Border(top = Side(border_style='thin',
color='FF000000'), 
                            right = Side(border_style='thin',
color='FF000000'), 
                            bottom =
Side(border_style='thin', color='FF000000'), 
                            left = Side(border_style='thin',
color='FF000000')) 
Oddly this is throwing the following error:
NameError: name 'Side' is not defined
I have looked at the official documentation here:
http://openpyxl.readthedocs.org/en/2.4/styles.html
http://openpyxl.readthedocs.org/en/2.4/_modules/openpyxl/styles/borders.html
I have also looked at the following articles with no luck:
https://bitbucket.org/openpyxl/openpyxl/issues/365/styling-merged-cells-isnt-
working
Applying borders to a cell in OpenPyxl
Apply borders to all cells in a range with openpyxl
Apply Border To Range Of Cells Using Openpyxl
Is anyone able to help me out?
Thanks in advance,
Eamon
Answer
You haven't imported the Side object.

from openpyxl.styles import Border, Side
Topic 1016
Subject
Excel Countif - Need no. of cells in a row that have a date greater than specific
date
Question
I have a table like this, where I want to insert formulas in column B to arrive at
the indicated values.
The logic is this - I want to count every alternate cell in that particular row,
starting from column C till column AA, and get the number of cells that contain
a date value greater than or equal to Target date. 
Cols/Rows      A        B     C      D     E         F      G 
1       Target Date   X   X Date   Y    Y Date     Z    Z
Date 
2       13-12-2015    2               13-12-2015       13-01-
2016 
3       24-11-2015    1               25-11-2015       20-10-
2015 
4       23-01-2016    0 
5       30-01-2016    0               06-06-2016       14-04-
2015 
To begin with, before I put the condition on the date, I first tried to get the
number of alternate columns in this range by using the array formula
=IF(MOD(COLUMN($C4:$AA4),2)=0,COLUMNS($C4:$AA4))
But this returns FALSE for some reason. Only if this returns a numeric value, I
can proceed with adding a condition for dates.
How do I modify the formula? Any help is appreciated! Answer
You want to use SUMPRODUCT():
=SUMPRODUCT((MOD(COLUMN($C4:$AA4),2)=0)*
($C4:$AA4>=DATEVALUE"13/1/2015")*
($C4:$AA4<=DATEVALUE"13/1/2016"))

This will return a count of every other column that has a date between
13/1/2015 and 13/1/2016
Answer
I don't have access to Excel at the moment to check, but I suspect the issue is
that you're calling COLUMN with arguments. I think if you remove the range,
and do =IF(MOD(COLUMN(), 2)=0, COLUMNS($C4:$AA4) the if will at
least get true on even columns. COLUMN returns the numeric index of the
current column, so you might need to fiddle with things to get this working.
Answer
The brute-force approach, write as many of these as you need,
=1(C5>A5) + 1(E5>A5) + 1(G5>A5) + 1(I5>A5) and so on.
Topic 1017
Subject
Selecting (clicking on) a line graph (Excel) and having the specific coordinate
stored in a cell or a variable that can be used for a VBA code
Question
I would like it for the user to be able to select a linear section of this graph:
So that we can obtain a reduced section, like this one:
This with the aim of performing additional calculations only on the values or
data points corresponding to the reduced section. Answer
@Jose Gabriel, I was going to wait until you responded to my question in the
comments, but I believe the following will get you the pieces you need and you
can simply customize them to your needs.
The basic process you are asking about involves Three functions.
First, to report the location on the chart that the users clicks and the
corresonding point of the series.

(I would suggest a double-click actually, as a single click is generally used for
selection and double-click is used for actions).
Second, to find the selected point within the seriescollection values to create
the two (or more) points necessary to create your reduced chart.
Third, to modify the source data for the presentation of the chart.
Step One - Report location within the chart series
Below is a link to a comprehensive, yet absolute beginner walk through of
identifying which point/segment of a chart was selected by the user.
It includes much more than that, but might also be helpful to give you enough of
an understanding of what is available to you that it should all be useful.
http://peltiertech.com/chart-events-microsoft-excel/
The direct segment you are looking for on a single line series is about a third
of the way down the page. Here is an excerpt with only the code applicable to
your question:
Private Sub Chart_Select(ByVal ElementID As Long, _
ByVal Arg1 As Long, ByVal Arg2 As Long)
Dim sElement As String
Dim sArg As String
Select Case ElementID
'... several other case options 
      Case xlSeries 
          sElement = "Series " & Arg1 
          If Arg2 > 0 Then sArg = "Point " & Arg2 
      '... several other case options 
      End Select 
   MsgBox sElement & IIf(Len(sArg) > 0, vbCrLf & sArg, "") 

End Sub
(note: just below that is a section to discover the coordinates x & y)
So, now you have the segment that the user selected in a series. The point
selected is always the higher of the two points of the segment.
Step Two - discover where the selected point falls in the series collection
In order to build the reduced chart, you must identify the selected point within
the seriescollection values and then select the point just before that one to
create the reduced chart.
Here is a link (and solution code below link) to a similar question, although it
will loop through all series of all charts and sets the last value. You can limit
this by identifying just your chart(s)/Series if needed.
Also, you don't need to add the last value, instead, I suggest you store the
previous point in a variable and check to see if the current point is the point the
user selected. If so, you have your segment and can reset your chart.
VBA looping through all series within all charts
(Remember, you will need to add a loop to iterate through each Point in the
series Points)
Step Three - Modify chart series data
Now, all there is left is to reset the chart to the new points identified from step
2
Here is a link, but you may not even need it. https://msdn.microsoft.com/en-
us/library/office/ff197014.aspx
Here is the code example used to demonstrate assigning constant values:
Charts("Chart1").SeriesCollection(1).Values = Array(1, 3, 5, 7, 11, 13, 17, 19)

If you want the user to be able to go back and forth from the original to reduced
charts, I suggest using a named range for the original chart and allowing the
user to double click the chart (may a specific section of the chart) to revert
back to the full data series.
Hope that does it for you.
Topic 1018
Subject
Detect formattings in Excel
Question
Is there a way to detect a formatting in excel, like the color name or code?:
I am currently using Roo to parse the excel and wonder if it's possible with
Roo or other gems you can recommend.
Thanks!
Answer
Just examine the Color property of the Range object:
Sub dural()
MsgBox ActiveCell.Interior.Color
End Sub
Topic 1019
Subject
Attach a .net control to a worksheet without VSTO (but Excel-DNA)
Question
I'm trying to do something that I'm not sure is possible. I want to use a .net 3rd
party library that gives nice winform chart controls, to replace some (very
complex and ugly) VBA generated charts in an Excel worksheet.
I'm using Excel-DNA (which is great BTW), and I managed to do all sorts of
things with it, like displaying Winform forms in both sync and async way
(thanks to https://github.com/Ron-Ldn/DotNetRefEdit)

So far, I managed to make my non modal form with the charts appear when I
activate a particular worksheet, and by setting it's parent and topMost
properties, it kinda have the expected behavior. But placing it is a real pain
(different screen sizes) and I was wondering if there is a way to properly do it
So here's the question : Can I attach in some way a .Net form or a custom
control to a worksheet, maybe even have it positionned relatively to a
particular cell ? It must be non modal and it will display only if we are on a
particular sheet.
I know with VSTO you could add a control to a worksheet, but I don't want to
use VSTO. I also know that I could probably create my own ActiveX control
and have it registered, and then place it in Excel like I would with another
button control for example, but that seems hazardous according to what I read
about it
Thank you for all ideas or suggestions
Topic 1020
Subject
Merging data into workbooks in Excel
Question
In Excel I have two Workbooks:
partial.xls with two columns: Name and City general.xls with more columns:
Name; Address; City.
In general.xls there are records in the column Name. In partial xls there are
records in the columns Name and City. In the Name columns in both files are
more identical items arranged different. Please, how could I merge records
from partial.xls to general.xls?
For example:
In general.xls:
Column Name has the records: Name1; Name2; Name3 (in this order) Columns

Address and City are empty.
In partial.xls:
Column Name has the records Name3; Name1; Name2 (in this order) Column
City has the records: City3; City1; City2 (in this order) Answer
Use a lookup formula like Vlookup or Index/Match.
In General.xls
=Vlookup(A1,[Partial.xls]Sheet1!$A$1:$C$1000,3,False)
In words: Find the name in A1 in Sheet1 of the Partial.xls workbook, A1 to
A1000 and return the value from column C of the row where an exact match is
found.
Topic 1021
Subject
How to reference an array address of a VBA Max or Ubound function?
Question
How do I reference an array address where the WorksheetFunction.Max has
found the largest value within the array? There can be multiple highs within the
array.
Dim myArraySum(1 to 4) as long
Dim myArrayAddress(1 to 4) as integer
myArraySum(1) = 2
myArraySum(2) = 5
myArraySum(3) = 7
myArraySum(4) = 7 
         myArrayHigh =
Application.WorksheetFunction.Max(myArraySum) 
         myArrayAddress = 'code needed 
My desired output is

myArrayHigh = 7
myArrayAddress(1) = 3
myArrayAddress(2) = 4
Answer
The most straightforward way is to use a loop to check the values of every
array element.
Function GetMaxIndicesArray(ByRef myArraySum() As Long, ByRef
myArrayAddress() As Integer) As Integer Dim i As Integer, j As Integer, iLow
As Integer, iUp As Integer Dim lMax As Long
iLow = LBound(myArraySum)
iUp = UBound(myArraySum)
lMax = Application.WorksheetFunction.Max(myArraySum) j = 1
For i = iLow To iUp
If (myArraySum(i) = lMax) Then 
    myArrayAddress(j) = i 
    j = j + 1 
End If
Next
GetMaxIndicesArray = j - 1
End Function
Sub test()
Dim myArraySum(1 To 4) As Long
Dim myArrayAddress(1 To 4) As Integer
Dim i As Integer, n As Integer
myArraySum(1) = 2
myArraySum(2) = 5
myArraySum(3) = 7

myArraySum(4) = 7
myArrayHigh = Application.WorksheetFunction.Max(myArraySum)
'myArrayAddress = "" 'code needed
n = GetMaxIndicesArray(myArraySum, myArrayAddress)
Debug.Print "myArrayHigh = " & myArrayHigh For i = 1 To n
Debug.Print "myArrayAddress(" & i & ") = " & myArrayAddress(i) Next
End Sub
Then in you debugger window, just type
test
The Result is like:
myArrayHigh = 7
myArrayAddress(1) = 3
myArrayAddress(2) = 4
Answer
Use a simple loop:
Sub dural()
Dim myArraySum(1 To 4) As Long
Dim myArrayAddress(1 To 4) As Integer Dim myArrayHigh As Long, k As
Long, msg As String
myArraySum(1) = 2
myArraySum(2) = 5
myArraySum(3) = 7
myArraySum(4) = 7
myArrayHigh = Application.WorksheetFunction.Max(myArraySum)

k = 1
For i = LBound(myArraySum) To UBound(myArraySum) 
    If myArraySum(i) = myArrayHigh Then 
       myArrayAddress(k) = i 
       k = k + 1 
    End If 
Next i
msg = ""
For i = LBound(myArrayAddress) To UBound(myArrayAddress)
msg = msg & vbCrLf & i & vbTab & myArrayAddress(i) Next i
MsgBox msg
End Sub
Topic 1022
Subject
Using vba to automate a Microsoft Word document with data imported from an
Excel sheet, using a variable to filter what data to actually insert
Question
I'm trying to populate a Word document with information from Excel. The table
on excel looks really simple.
QUESTION |YES| DATA
Prewritten question 1 | X | Prewritten data 1
Prewritten question 2 | X | Prewritten data 2
Prewritten question 3 | X | Prewritten data 3
How would I then automate populating a new word document with the data
with the variable X under YES, only pasting the prewritten data held in the
data column?

I almost got this working on Word just using the step by step mail merger
feature , but while I was able to populate the Word document, the Prewritten
data would paste, but each pasted selection from the data column would take
its own page on Word, even if it was a short 3 word phrase. Answer
The simplest way for you would be without code, using a Word field.
In Excel, select the range of data and assign it a name (Range name) In Word
Insert/Text/Quick Parts/Field
from the list, choose Database. An Insert Database button will appear, click
that. In the dialog box, Step 1, navigate to the location of the Workbook and
select it. You'll be prompted for the connection protocol (OLEDB is fine).
Select the Range Name from the list. Choose "Query Options" in Step 2. Tab
"Select Fields": In the list on the right, select the fields you do NOT want and
click "Remove". Tab "Filter Records": Choose the "Yes" column and set
Comparison "Equal to" and type X in the third box. In Step 3 click "Insert
Data"; be sure to activate "Insert Data as Field" checkbox to get an active link
back to the Workbook.
This will insert a Database field in the Word document with syntax something
like the following. Press Alt+F9 to toggle between field result and field
display views. If you've done any work with data connections some of it will
look familiar to you. In any case, you should recognize the file path near the
beginning and the SQL select statement at the end.
{ DATABASE \d "C:\\Test\\ExcelDataRange.xlsx" \c
"Provider=Microsoft.ACE.OLEDB.12.0;User ID=Admin; Data
Source=C:\\Test\\ExcelDataRange.xlsx;Mode=Read; Extended
Properties=\"HDR=YES;IMEX=1;\"; Jet OLEDB:System database=\"\";Jet
OLEDB:Registry Path=\"\"; Jet OLEDB:Engine Type=35;Jet OLEDB:Database
Locking Mode=0; Jet OLEDB:Global Partial Bulk Ops=2;Jet OLEDB:Global
Bulk Transactions=1; Jet OLEDB:New Database Password=\"\";Jet
OLEDB:Create System Database=False; Jet OLEDB:Encrypt Database=False;
Jet OLEDB:Don't Copy Locale on Compact=False; Jet OLEDB:Compact
Without Replica Repair=False; Jet OLEDB:SFP=False;Jet OLEDB:Support
Complex Data=False; Jet OLEDB:Bypass UserInfo Validation=False" \s
"SELECT `Data` FROM `Test` WHERE ((`Yes` = 'X'))" }

If the data in the workbook changes, click in the table and press F9 to update
the field. (If you add rows to the range be sure to adjust the Range Name to
include them all!)
Topic 1023
Subject
Set Auto Filtering multiple wildcards
Question
Right now I am doing coding to set a filter for a data chart. Basically, I don't
know how to post the data sheet up here so just try to type them ):
(starting from the left is column A)
Name * BDevice * Quantity Sale Owner
Basically I need to filter out for 2 column: -The BDevice with any word
contain "M1454" or "M1467" or "M1879" (It means that M1454A or
M1467TR would still fit in) -The Owner with PROD or RISK
Here is the code I wrote:
Sub AutoFilter()
ActiveWorkbook.ActiveSheet..Range(B:B).Select
Selection.Autofilter Field:=1 Criteria1:=Array( _
"M1454", "M1467", "M1879"), Operator:=xlFilterValues
Selection.AutoFilter Field:=4 Criteria1:="=PROD" _
, Operator:=xlOr, Criteria2:="=RISK"
End Sub
When I run the code, the machine returns error 1004 and the part which seems
to be wrong is the Filter part 2 ( I am not sure about the use of Field, so I can
not say it for sure)

Edit; Santosh: When I try your code, the machine gets error 9 subscript out of
range. The error came from the with statement. (since the data table has A to
AS column so I just change to A:AS) Answer
While there is a maximum of two direct wildcards per field in the AutoFilter
method, pattern matching can be used to create an array that replaces the
wildcards with the Operator:=xlFilterValues option. A Select Case statement
helps the wildcard matching.
The second field is a simple Criteria1 and Criteria2 direct match with a
Operator:=xlOr joining the two criteria.
Sub multiWildcardFilter()
Dim a As Long, aARRs As Variant, dVALs As Object
Set dVALs = CreateObject("Scripting.Dictionary") dVALs.CompareMode =
vbTextCompare
With Worksheets("Sheet1") 
      If .AutoFilterMode Then .AutoFilterMode = False 
      With .Cells(1, 1).CurrentRegion 
          'build a dictionary so the keys can be used as the
array filter 
          aARRs = .Columns(2).Cells.Value2 
          For a = LBound(aARRs, 1) + 1 To UBound(aARRs, 1) 
              Select Case True 
                  Case aARRs(a, 1) Like "MK1454" 
                      dVALs.Add Key:=aARRs(a, 1),
Item:=aARRs(a, 1) 
                  Case aARRs(a, 1) Like "MK1467" 
                      dVALs.Add Key:=aARRs(a, 1),
Item:=aARRs(a, 1) 
                  Case aARRs(a, 1) Like "MK1879*" 
                      dVALs.Add Key:=aARRs(a, 1),
Item:=aARRs(a, 1) 
                  Case Else 
                      'no match. do nothing 
              End Select 
          Next a 
          'filter on column B if dictionary keys exist 

          If CBool(dVALs.Count) Then _ 
              .AutoFilter Field:=2, Criteria1:=dVALs.keys, _ 
                                    Operator:=xlFilterValues,
VisibleDropDown:=False 
          'filter on column E 
          .AutoFilter Field:=5, Criteria1:="PROD",
Operator:=xlOr, _ 
                                Criteria2:="RISK",
VisibleDropDown:=False 
          'data is filtered on MK1454, MK1467 or MK1879*
(column B) 
          'column E is either PROD or RISK 
          'Perform work on filtered data here 
      End With 
      If .AutoFilterMode Then .AutoFilterMode = False 
End With
dVALs.RemoveAll:Set dVALs = Nothing End Sub
If exclusions¹ are to be added to the filtering, their logic should be placed at
the top of the Select.. End Select statement in order that they are not added
through a false positive to other matching criteria.
                               Before applying AutoFilter Method
                               After applying AutoFilter w/ multiple wildcards
¹ See Can Advanced Filter criteria be in the VBA rather than a range? and Can
AutoFilter take both inclusive and non-inclusive wildcards from Dictionary
keys? for more on adding exclusions to the dictionary's filter set.
Answer
Try below code :
max 2 wildcard expression for Criteria1 works. Refer this link
Sub AutoFilter()

With ThisWorkbook.Sheets("sheet1").Range("A:E") 
      .AutoFilter Field:=2, Criteria1:=Array("M1454",
"M1467"), Operator:=xlFilterValues 
      .AutoFilter Field:=5, Criteria1:="=PROD",
Operator:=xlOr, Criteria2:="=RISK" 
End With
End Sub
Topic 1024
Subject
SQL select DBF file Format not working
Question
I have a sql select in Excel VBA, i want to open a DBF file and Format the
date fom a datetime field, but is keep coming with a error.
Error code:
Runtime Error 80040e10 'No value given for one or more required param
My code is
con.Open "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & DBFFolder
& ";Extended Properties=dBASE IV;"
sql = "SELECT code_id, Format([ordertime],DD/MM/YYYY) as tp FROM "
& Filename & " group by code_id, ordertime "
On Error Resume Next
Set rs = CreateObject("ADODB.recordset") If Err.Number <> 0 Then
MsgBox "No conntectio!", vbCritical, "Connection error" Exit Sub
End If
On Error GoTo 0
rs.CursorLocation = 3

rs.CursorType = 1
rs.Open sql, con
Anyone a suggestion?
Topic 1025
Subject
create formula with sumif,if and ,or
Question
I want to make formula with sumif and with conditions i tried but its failing to
provide sum.I want to find value if conditions: 1. G/L is 62810101 or
62810100 then value for 81810101 and 81810100 should be calculated or vice
versa. 2.If code is A2+B2 then value for B2+A2 should be find in document
currency.
i tried something like this...
=IF(OR(E2=62810101,E2=62810100),SUMIFS(I:I,L:L,L2,E:E,E2=81810101)
CoCd Tr.Prt DocumentNo Reference G/L Doc. Date Amount in local cur.
LCurr Amount in doc. curr. Curr. Code 1 Sum if 1 BG05 RS31 1100000007
111 62810100 42081 2542.58 BGN 1300 EUR BG05RS31 2918 BG05 RS31
1100000017 1100000017 81810101 42234 621.95 BGN 318 EUR RS31BG05
318 Answer
Try these formula:
For Accts Receivable:
=SUM(SUMIFS(I:I,L:L,L2,E:E,{62810101,62810100}))
For Accts Payable:
=SUM(SUMIFS(I:I,L:L,L2,E:E,{81810101,81810100}))
It is just a matter of putting the wanted account numbers in the {} brackets.
Topic 1026

Subject
Sum rows in Excel with same text value
Question
I am trying to sum the rows in Excel that have the same text value in 2 different
columns. I saw the post here Group by Sum in Excel about summing rows with
the same text value in one column. Here is my table:
A B C
Item Region quantity_sold 
A     South    1 
A     South    4 
A     North    7 
B     South    5 
B     South    9 
D     South    3 
C     South    6 
C     South    4 
C     North    8 
I think I need to use Sumifs instead of Sumif. I would like the result to be:
Item Region quantity_sold 
A     South 
A     South     5 
A     North     7 
B     South 
B     South    14 
D     South     3 
C     South 
C     South    10 
C     North     8 
I tried =IF(A2=A1,"",SUMIFS(A:A,A2,B:B,B2,C:C)) but I got: #VALUE!
Answer
An alternative I find works well is to add a column which contains both
columns you wish to group as a single value. For example set up col D with
this:

=A1&""&B1
result is ASouth etc
You can then use normal SUMIF, using this column as criteria.
Main benefits are separation of formulae, and you can extend easily to further
grouping variables.
Answer
Try this formula:
=IF(OR(B2<>B3,A2<>A3),SUMIFS($C$2:$C$10,$A$2:$A$10,A2,$B$2:$B$
On caveat, the columns must be sorted. This will not work if the columns are
not sorted.
Answer
You can do it using an UDF:
=SumQuatitySold(2;A2;B2;C:C)
Where
The First entry is the start row, in this case is 2 The second one is your item
(select the cell) The third one is the region (select the cell) Last one select the
column of the quantity_sold
You just need to enter this code in a module:
Function SumQuatitySold(StartRow As Long, Item As Range, region As
Range, Quantity_Sold As Range) As Long
Dim ws As Worksheet
Dim i As Long, j As Long
Set ws = ThisWorkbook.ActiveSheet

With ws
i = Item.Row
j = StartRow
Do 
          If .Cells(i, Item.Column) = .Cells(j, Item.Column)
And .Cells(i, region.Column) = .Cells(j, region.Column) And i
<> j Then 
                  If quantitysold = 0 Then 
                      quantitysold = .Cells(j,
Quantity_Sold.Column) 
                  Else 
                      quantitysold = quantitysold + .Cells(j,
Quantity_Sold.Column) 
                  End If 
          End If 
j = j + 1
Loop Until IsEmpty(.Cells(j, Quantity_Sold.Column))
End With
SumQuatitySold = quantitysold + ws.Cells(Item.Row, Quantity_Sold.Column)
End Function
Topic 1027
Subject
How can I use a cell on new added sheet?
Question
I have following codes.
Dim a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q as Range Dim z As Integer
z = Sheet17.Cells(2, 1).Value
With Sheets.Add
.Select
.Name = "PIAF_Summary" & z
.ScrollArea = "A1:G108"

End With
z = z + 1
Columns("B:F").ColumnWidth = 38
With Range("A1:G1")
.Merge
.Interior.ColorIndex = 23
.Value = "Project Name (To be reviewed by WMO)" .Font.Color = vbWhite
.Font.Bold = True
.Font.Size = 13
End With
With Range("A5:G5")
.Merge
.Interior.ColorIndex = 23
.Value = "Project Name (Basic Project Information)" .Font.Color = vbWhite
.Font.Bold = True
.Font.Size = 13
End With
How can I activate added sheet? Since I want add a value to a new sheet cell.
Answer
First of all, when you declare your variables like this:
Dim a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q As Range
You have declare only q as range and the other ones are declare as Variant So
if you want to declare all of them as Range you should do it like this:
Dim a As Range, b As Range, c As Range, d As Range
About your question, you need first to Set your sheets in order to work with
more easily.
Sub test()
Dim a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q As Range Dim z As Integer

Dim wb As Workbook
Dim ws17 As Worksheet, wsNew As Worksheet
Set wb = ThisWorkbook
Set ws17 = wb.Sheets("Sheet17")
z = ws17.Cells(2, 1).Value
Set wsNew = Sheets.Add ' Declare your New Sheet in order to be able to
work with after wsNew.Name = "PIAF_Summary" & z
z = z + 1
wsNew.Columns("B:F").ColumnWidth = 38 With wsNew.Range("A1:G1") 
          .Merge 
          .Interior.ColorIndex = 23 
          .Value = "Project Name (To be reviewed by WMO)" 
          .Font.Color = vbWhite 
          .Font.Bold = True 
          .Font.Size = 13 
   End With 
With wsNew.Range("A5:G5") 
          .Merge 
          .Interior.ColorIndex = 23 
          .Value = "Project Name (Basic Project Information)"
          .Font.Color = vbWhite 
          .Font.Bold = True 
          .Font.Size = 13 
End With
'Now you can copy data from Sheet17 to the New created Sheet:
ws17.Range("A2:C3").Copy wsNew.Range("A2")
End Sub
Topic 1028

Subject
How can I assign a name of this combobox(Name = Combobox1) and range it
to a fixed position (Cell C4)?
Question
With
ActiveSheet.OLEObjects.Add(ClassType:="Forms.ComboBox.1",Link:=False,
DisplayAsIcon:=False, Left:=50, Top:=80, Width:=100, Height:=15)
With .Object 
      .AddItem "Yes" 
      .AddItem "No" 
End With
End With
How Can I assign a name and fix the position of it (based on the code above)?
Answer
Try this code:
Sub Test()
Dim Rng As Range: Set Rng = Range("C4")
With ActiveSheet.OLEObjects.Add(ClassType:="Forms.ComboBox.1",
Link:=False, DisplayAsIcon:=False, Left:=Rng.Left, Top:=Rng.Top,
Width:=100, Height:=15) .Name = "Combobox_Name" ' change the name With
.Object 
      .AddItem "Yes" 
      .AddItem "No" 
End With
End With
End Sub

Answer
Try this:
Sub Test()
Dim ws As Worksheet
Dim ComboBx1 As OLEObject
Set ws = ActiveSheet
Set ComboBx1 = ws.OLEObjects.Add("Forms.ComboBox.1")
With ComboBx1 
      .Left = ws.Range("C4").Left 
      .Top = ws.Range("C4").Top 
      .Name = "WateverYouWant" 
      .Width = "150" 
End With
With ws.OLEObjects("WateverYouWant").Object 
      .AddItem "Yes" 
      .AddItem "No" 
End With
End Sub
Topic 1029
Subject
AWS data into Excel?
Question
I have a client who has asked me to take a look at the spreadsheet that they use
for manipulating AWS data in order to import sales invoices into Xero....I'm
just wondering if it's possible to directly query AWS from Excel?...this would
streamline the process by cutting out the manual AWS export plus I would be
able to create a query that puts the data into the format that Xero needs to see.

...moving on from this, I guess the next logical step would be to create an API
that Xero can hook up to....unless this is already a thing?
Darren
Answer
There is a sample Excel VBA / VB6 Helper Routines project that might get you
going in the right direction.
Topic 1030
Subject
Create Excel Hyperlinks which include data from cells B2-B10000 (or so)
Question
I'm learning mandarin Chinese and study from an excel file with over 10,000
vocabulary words. To view example sentences easily, I want to place my own
10,000 hyperlinks to http://www.purpleculture.net/dictionary-details/?
word=%E4%B8%80, except replace the content after "?word=" with each of
the 10,000 characters in rows B2-B10002.
How do I do so?
Answer
Entering the formula =HYPERLINK(B2;RIGHT(B2;LEN(B2)-FIND("=";B2)))
into C2 and copying it down to C10002 would do the trick for you.
Now if you want the URL entities to be decoded you will need to apply
perhaps another function to the part RIGHT(B1;LEN(B1)-FIND("=";B1)) but
as far as I know there is no such thing in Excel
Answer
Here's the solution
Type this in C2
=HYPERLINK("http://www.purpleculture.net/dictionary-details/?
word="&ENCODEURL(B2))

This Formuala will encode the content of B2 to make sure it's URL friendly
using "ENCODEURL" Available in Excel 2013 or later
Assuming B2 = "Value 1" this cell (C2) will be
http://www.purpleculture.net/dictionary-details/?word=Value%201
Copy this cell and paste it on you 1000+ cells and it'll automatically adjust the
row number
For older Versions of Excel You can use
=HYPERLINK("http://www.purpleculture.net/dictionary-details/?word="&
(B2))
and if it doesn't work (your browser doesn't auto encode) you might have to
encode the text your self using any tool that support multiline encoding e.g. Text
Fixer
paste the encoded text in your worksheet and adjust the formula to point to it,
just edit the (B2) part
Topic 1031
Subject
while exporting report in excel using php Not working on server but working
on localhost?
Question
I am trying to export report using php. it will work fine in localhost but while I
am uploading in server it will not works fine and give output like below.(All
the variable which i have used not not displaying here is declared as global so
there is not issue in variable declaring.)
$arrayissue = array(); 
          $count = 0; 
          $screenshot_name = ''; 
          $productid = (string) filter_input(INPUT_GET,
'productid'); 

          $cycle = $SESSION['Cycle']; 
          $objPHPExcel = new PHPExcel(); 
          $query2 = "SELECT Cyclename FROM cycle_master WHERE
Cycle_id='$cycle'"; 
          $result2 = $conn->query($query2); 
          $row12 = mysqli_fetch_array($result2); 
          $ews = $objPHPExcel->getSheet(0); 
          $ews->setCellValue('a1', 'This is the Result For :
' . $row12[0]); 
          $rowCount = 2; 
          $title = 'a1:s1'; 
          $header = 'a2:s2'; 
          $objPHPExcel->getActiveSheet()->getStyle($title)-
>getFill()->setFillType(\PHPExcel_Style_Fill::FILL_SOLID)-
>getStartColor()->setARGB('A9F5E1'); 
          $objPHPExcel->getActiveSheet()->getStyle($header)-
>getFill()->setFillType(\PHPExcel_Style_Fill::FILL_SOLID)-
>getStartColor()->setARGB('FFFF00'); 
          $style = array( 
              'font' => array('bold' => true,), 
              'alignment' => array('horizontal' =>
\PHPExcel_Style_Alignment::HORIZONTAL_CENTER,), 
          ); 
          $objPHPExcel->getActiveSheet()->getStyle($header)-
>applyFromArray($style); 
          $objPHPExcel->getActiveSheet()->getStyle( 
                  'A2:' . 
                  $objPHPExcel->getActiveSheet()-
>getHighestColumn() . 
                  $objPHPExcel->getActiveSheet()-
>getHighestRow() 
          )->getBorders()->getAllBorders()-
>setBorderStyle(PHPExcel_Style_Border::BORDER_THIN); 
          $objPHPExcel->getDefaultStyle()->getAlignment()-
>setWrapText(true); 
          $styleArray = array( 
              'font' => array( 
                  'bold' => FALSE, 
                  // 'color' => array('rgb' => 'FF0000'), 
                  'size' => 10, 
                  'name' => 'Calibri' 
          )); 
          for ($col = 'A'; $col != 'S'; $col++) { 

              $objPHPExcel->getActiveSheet()-
>getColumnDimension($col)->setWidth(20); 
              $objPHPExcel->getActiveSheet()->getStyle($col)-
>applyFromArray($styleArray); 
          } 
          $queryforissue = "Select Issue_name from
tmtool.project_issue_master where Project_id IN(Select
Project_id from product_master Where
Product_id='$productid')"; 
          $resultforissue = mysqli_query($conn,
$queryforissue) or die(mysqli_error($conn)); 
          $countforissue = 0; 
          $customeTitle = array(); 
          $customTitle1 = array('Execution ID', 'TC ID',
'Parent Site', 'Redirection Site'); 
          $customTitle2 = array('Total Error Observed Count',
'Issue(Pass/Fail)', 'Circle Name', 'Mobile Number', 'Date',
'Time', 'Product Name', 'Screen Shot Name', 'Comment', 'Actual
Submitted Date'); 
          while ($rowissue =
mysqli_fetch_array($resultforissue)) { 
              array_push($arrayissue,
$rowissue['Issue_name']); 
              $countforissue++; 
          } 
          //print_r($arrayissue); 
          $customTitle3 = array_merge($customTitle1,
$arrayissue); 
          $customTitle = array_merge($customTitle3,
$customTitle2); 
          print_r($customTitle); 
          $alph = 'A'; 
          foreach ($customTitle as $value) { 
              $objPHPExcel->getActiveSheet()-
>SetCellValue($alph . $rowCount, $value); 
              $alph++; 
          } 
          $rowCount++; 
          $queryresult = "SELECT
testcase_master.`Testcase_id`,CONVERT(SUBSTRING_INDEX(testcase_
-1),UNSIGNED INTEGER) as num
,testcasemaster.`Testcase_title`,testcase_master.`Subscriber_ty

As
Time_pass,defect_master.`Defect_id`,defect_master.`Defect_title
as dcomment FROM tmtool.test_result_url LEFT JOIN
tmtool.testcase_master  ON
test_result_url.`Testcase_id`=testcase_master.`Testcase_id`
LEFT JOIN tmtool.defect_master ON
test_result_url.`Defect_id`=defect_master.`Defect_id` WHERE
testcase_master.`Product_id` = '$productid' AND
(test_result_url.`Performed_date` BETWEEN '$startdate' AND
'$enddate') AND testcase_master.`Testcase_id` IN (SELECT
Testcase_id FROM assigned_testsuite_testcase WHERE
Testsuite_id IN (SELECT Testsuite_id FROM testsuite_master
WHERE Cycle_id = '$cycle')) order by num"; 
          //$queryresult = "SELECT
testcase_master.`Testcase_id`,testcase_master.`Testcase_title`,
FROM tmtool.test_result_url LEFT JOIN tmtool.testcase_master
ON test_result_url.`Testcase_id` =
testcase_master.`Testcase_id` LEFT JOIN tmtool.defect_master
ON test_result_url.`Defect_id` = defect_master.`Defect_id`
WHERE testcase_master.`Product_id` = '$productid' AND
testcase_master.`Testcase_id` IN (SELECT Testcase_id FROM
assigned_testsuite_testcase WHERE Testsuite_id IN (SELECT
Testsuite_id FROM testsuite_master WHERE Cycle_id =
'$cycle'))"; 
          //$queryresult = "SELECT
testcase_master.`Testcase_id`,testcase_master.`Testcase_title`,
FROM tmtool.test_result_url LEFT JOIN tmtool.testcase_master
ON test_result_url.`Testcase_id` =
testcase_master.`Testcase_id` LEFT JOIN tmtool.defect_master
ON test_result_url.`Defect_id` = defect_master.`Defect_id`
WHERE testcase_master.`Product_id` = '$productid' AND
testcase_master.`Testcase_id` IN (SELECT Testcase_id FROM
assigned_testsuite_testcase WHERE Testsuite_id IN (SELECT
Testsuite_id FROM testsuite_master WHERE Cycle_id =
'$cycle'))"; 
          $resultquery = mysqli_query($conn, $queryresult) or
die(mysqli_error($conn)); 
          while ($row = mysqli_fetch_array($resultquery)) { 
              $objPHPExcel->getActiveSheet()-
>SetCellValue('A' . $rowCount, $row['Test_id']); 
              $objPHPExcel->getActiveSheet()-
>SetCellValue('B' . $rowCount, $row['Testcase_id']); 
              $objPHPExcel->getActiveSheet()-
>SetCellValue('C' . $rowCount, $row['Testcase_title']); 
              $objPHPExcel->getActiveSheet()-
>SetCellValue('D' . $rowCount, $row['Child_site']); 

              for ($i = 0, $alpha2 = 'E'; $i <
$countforissue; $i++, $alpha2++) { 
                  $querygetResult = "Select $arrayissue[$i]
from test_result_url where Test_id='$row[Test_id]'"; 
                  $getResult = mysqli_query($conn,
$querygetResult) or die('Error querying database'); 
                  $rowResult =
mysqli_fetch_array($getResult); 
                  if($arrayissue[$i] == 'Landing_page_issue')
                  { 
                      if($rowResult[0] == 'Fail') 
                      { 
                          $rowResult[0]='Yes'; 
                      } 
                      else 
                      { 
                          $rowResult[0]='No'; 
                      } 
                  } 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $rowResult[0]); 
                  if ($rowResult[0] == 'Fail') { 
                      $count++; 
                  } 
              } 
              $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $count); 
              $alpha2++; 
              $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row['Status']); 
              $alpha2++; 
              $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row['Circle_name']); 
              $alpha2++; 
              $elsealpha = $alpha2; 
              $lastalpha = $alpha2; 
              for ($j = 0; $j < 6; $j++) { 
                  $lastalpha++; 
              } 
              if ($row['Status'] == 'Fail') { 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row['Mobile']); 
                  $alpha2++; 

                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row['Created_date']); 
                  $alpha2++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row['Time']); 
                  $alpha2++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row["UrlProduct_name"]); 
                  $alpha2++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row["Defect_title"]); 
                  $alpha2++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($alpha2 . $rowCount, $row["dcomment"]); 
                  $alpha2++; 
              } else { 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($elsealpha . $rowCount, $row['Simcard_no']); 
                  $elsealpha++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($elsealpha . $rowCount, $row['Performed_date']);
                  $elsealpha++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($elsealpha . $rowCount, $row['Time_pass']); 
                  $elsealpha++; 
                  $elsealpha++; 
                  $elsealpha++; 
                  $objPHPExcel->getActiveSheet()-
>SetCellValue($elsealpha . $rowCount, $row['Comment']); 
              } 
              $objPHPExcel->getActiveSheet()-
>SetCellValue($lastalpha . $rowCount, $row['Performed_date']);
              $alpha2 = ''; 
              $elsealpha = ''; 
              $count = 0; 
              $rowCount++; 
          } 
          unset($count); 
          unset($lastalpha); 
          unset($elsealpha); 
          unset($alpha2); 
          $objPHPExcel->getActiveSheet()->setTitle("Product
Wise"); 
          header('Content-Type:
application/vnd.openxmlformats-  
officedocument.spreadsheetml.sheet'); 

          header('Content-Disposition:
attachment;filename="TestResults.xlsx"'); 
          header('Cache-Control: max-age=0'); 
          $objWriter =
PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007'); 
          ob_end_clean(); 
          $objWriter->save('php://output'); 
Answer
You start off with printing some variables, that forces a header() and would
destroy the excel file.
Remove the print_r($customTitle);
Topic 1032
Subject
sorting database with more than 1 keys in excel vba
Question
i want to sort a database with 4 keys but whenever am adding the 4th key its
saying named argument not found whereas it sorting the database with these 3
keys.. how to add 4th one in this..??
Range("A1:E" & lastrow).Sort key1:=Range("A1:A" & lastrow),
order1:=xlAscending, _ 
                           key2:=Range("C1:C" & lastrow),
order2:=xlAscending, _ 
                           key3:=Range("D1:D" & lastrow),
order3:=xlDescending, _ 
                           Header:=xlYes 
Answer
The Range.Sort method has a maximum of three keys per process. However, if
you sort by the extra keys first, then resort by the three most primary keys, you
achieve the same results.

With Range("A1:E" & lastrow)
'sort on the 4th key first (column E) .Cells.Sort Key1:=.Columns(5),
Order1:=xlAscending, _
Orientation:=xlTopToBottom, Header:=xlYes 'sort on the 1st, 2nd and 3rd keys
(columns A, C and D) .Cells.Sort Key1:=.Columns(1), Order1:=xlAscending,
_ 
              Key2:=.Columns(3), Order2:=xlAscending, _ 
              Key3:=.Columns(4), Order3:=xlAscending, _ 
              Orientation:=xlTopToBottom, Header:=xlYes 
End With
This produces the same result as if there was a Key4:=.Columns(5),
Order4:=xlAscending allowed in the method.
I try to use a With ... End With statement to ensure an easy method of defining
the parent of the keys. Your original code relied upon the ActiveSheet property
which is not always reliable.
Topic 1033
Subject
Excel userforms: mysterious behaviour of mouse events
Question
I have a question concerning excel userforms and mouse events. I have a
project with two userforms, userform1 and userform2. Userform2 is empty, no
controls, no code. The codemodule of userform1 (which contains one textbox)
contains the following code:
Private Sub TextBox1_MouseDown(ByVal Button As Integer, ByVal Shift As
Integer, ByVal X As Single, ByVal Y As Single) 
      Debug.Print "D (" & X & "," & Y & ")" 
      UserForm2.Show False 

End Sub
Private Sub TextBox1_MouseUp(ByVal Button As Integer, ByVal Shift As
Integer, ByVal X As Single, ByVal Y As Single)
Debug.Print "U (" & X & "," & Y & ")" End Sub
The problem: when i'm over the textbox and press the left mouse button, the
mousedown event occurs but no mouseup event occurs when I release the
mouse. Moreover the mouse seems to be captured as the next mouse press even
if not on textbox1 generates a mousedown event for textbox1. I'm using Excel
2013 and Windows 10.
Answer
This has something to do with event propagation. You are capturing the
MouseDown event. From the eventhandler of this event you are tearing away
the focus from the element which has raised this event. So the event will
probably bubble up to the new focused element.
With Excel-VBA we have not much possibilities to influence the event
propagation. So we can't explicitly stopping the event propagation.
But why do you think you need showing the UserForm2 from MouseDown
event? Why not from MouseUp event? The problem is the same, but a
MouseUp event will not do so much damage if bubbeling up to the wrong
object.
Private Sub TextBox1_MouseDown(ByVal Button As Integer, ByVal Shift As
Integer, ByVal X As Single, ByVal Y As Single) Debug.Print "D (" & X & ","
& Y & ")"
End Sub
Private Sub TextBox1_MouseUp(ByVal Button As Integer, ByVal Shift As
Integer, ByVal X As Single, ByVal Y As Single) Debug.Print "U (" & X & ","
& Y & ")"
Load UserForm2
UserForm2.Show False
End Sub

Topic 1034
Subject
Display value if text strings from two ranges match
Question
I have two worksheets in Excel. One contains the rankings:
:
The other one the matchups (daily updated automatically)
The purpose is to display the rank of each respective team in two columns next
to the matchups. One of the problems is that the text strings are not exact
matches (limitation of the webquery).
So I need to find a formula for when there is a string of the table in Rankings
that approximately matches the specified cell for the team in matchups and then
display Rank (column 1 on Rankings) next to it.
So far I've got this in the cell where the ranking is supposed to go.
=VLOOKUP(""&qry!B5&"";Sheet1!A3:C369;1;0)
But it just results in the string "rank" from the table header in Rankings.
Any ideas?
Answer
Several things:
Vlookup will try to find a match in the first column of the lookup table and can
return a value from a column to the right. Your lookup table has the desired
return value in the first column and the lookup values in the second column.
Therefore, Vlookup will not work in this scenario. You can use a combination
of Index and Match, though. the * wildcard before and after the lookup value
mean that the value in the lookup table can have any text before and after the
text already in your lookup value. In your case, the lookup value has more text
than the text in the lookup table. So the wildcard is not helping. Example: you
have "353 Virginia" and you want to find this in a column that has only

"Virginia". Wrapping "353 Virginia" in wildcards will add no value, because
the text that you want to match is actually shorter than the text you are starting
out with. You need to remove stuff from the lookup value instead of adding
wild cards.
If the data for the rankings comes from a web query, you need to do some work
to clean up that data, so it is fit for the lookup into your other table.
In addition to the number at the beginning, there are also two characters at the
end of some cells that I cannot identify. These need to be stripped out, too,
before you can do the lookup.
Assuming that all cells contain three digits and a space at the beginning you can
use a formula approach
=TRIM(MID(SUBSTITUTE(B5;" @#";"");5;99))
Substitute will remove the trailing characters. I don't know what they are
exactly, some web related special characters, so for the exercise here I have
used @# instead of the A thing and the chevron. Copy and paste the web
characters from one of your cells to the formula. With data coming from the
web you may also want to check for leading and trailing white space, non-
breaking space characters and other invisible characters.
You can use the "cleansing" formula as the basis of a lookup or, if the formula
above sufficiently cleans the data, then you can use it in an index/match combo
like this:
=index(Sheet1!$A$3:$A$369,match(TRIM(MID(SUBSTITUTE(B5;"
@#";"");5;99));Sheet1!$B$3:$B$369;0))
Without seeing the actual data in a spreadsheet it is hard to tell if the formula
cleanup is sufficient. You may need to do more work until a lookup returns the
desired value.
If the data is coming from the web, I strongly suggest that you look into Power
Query as a tool to get the data from the web into your spreadsheet. Power
Query is a free add-in for Excel 2010 and 2013 and is built into Excl 2016 as

"Get & Transform". It can connect to many data sources, including tables on a
web page, and it has very powerful mechanisms to clean data for further
processing. Once a Power Query is set up and working, all you need to do is
refresh the query to load new data from the web site.
Topic 1035
Subject
How to count cells in a specific color in all worksheets in excel
Question
is there a way I can count the number of colored cells in the whole workbook?
For example I'm trying to get a count of all the green cells in my workbook, but
since the work book has so many tabs that I have to do sort in each tab then add
them up at the end. It's really a waste of time since I have many workbooks
with more than 20 tabs each. Please help! :D Thanks! Answer
There is an article from Microsoft, here: https://support.microsoft.com/en-
us/kb/2815384
It details step by step instructions on doing very similar to what you are trying
to do.
The VBA function required is as follows:
Function CountCcolor(range_data As range, criteria As range) As Long
Dim datax As range
Dim xcolor As Long
xcolor = criteria.Interior.ColorIndex
For Each datax In range_data
If datax.Interior.ColorIndex = xcolor Then
CountCcolor = CountCcolor + 1
End If
Next datax
End Function

Answer
this code does the count of cells for each color in all worksheets, then creates
new workbook and fills with colors and counts:
Sub test()
Dim dic As Object: Set dic = CreateObject("Scripting.Dictionary")
dic.comparemode = vbTextCompare
Dim cl As Range, i&, ws As Worksheet, k For Each ws In
ThisWorkbook.Worksheets 
      For Each cl In ws.UsedRange 
          If Not dic.exists(cl.Interior.Color) Then 
              dic.Add cl.Interior.Color, 0 
          Else 
              dic(cl.Interior.Color) =
CLng(dic(cl.Interior.Color)) + 1 
          End If 
      Next cl 
Next ws
Workbooks.Add:i = 1
For Each k In dic 
      Cells(i, "A").Interior.Color = k 
      Cells(i, "A").Value2 = "Interior.Color = " & k 
      Cells(i, "B").Value2 = dic(k) 
      i = i + 1 
Next k
End Sub
output
Answer
Take a look at this article from Microsoft: https://support.microsoft.com/en-
us/kb/142122

If you aren't familiar with VBA, it is going to be a little challenging. But you
can use this article, in conjunction with a simple loop, to find all the cells.
If this is something you are going to be need to do often, or have been doing, I
would suggest investing the time in changing from colors to actual values. It
will be easier to sort, manage, and report on. And then you can just use
conditional formatting to get your colors back.
Topic 1036
Subject
display formula expression with inputs rather that its result
Question
Suppose Cell A1 contains the value 2 and Cell A2 contains the value 3.
Suppose Cell A3 has the formula =A1*A2.
Instead of A3 showing the product of the numbers in A1 and A2, I'd like it to
show "2*3".
So that e.g. if I change the value in A1 to 7, A3 should now show 7*3. Can this
be done? Answer
If you want to show formula instead of the result, you can press Ctrl+` or
Cmd+` to toggle them.
If you only need to show that expression in that particular cell all the time, try
this:
=A1&"*"&A2
Answer
You can also use:
=A1&CHAR(42)&A2
Topic 1037
Subject

Excel source has String to date conversion into oracle
Question
In Excel sheet I have a string Oct 20 2015 5:30 PM I want to convert this into
date format yyyy/mm/dd in Penatho DI and want to load into Oracle.
I have tried with below Javascript:
var x = EFF_DATE; EFF_DATE is stream having "Oct 20 2015 5:30 PM"
var da = new Date(x);
But this is not working. If I give Hard code string it works like var da = new
Date('Oct 20 2015 5:30 PM'); Here my varaiable EFF_DATE is not worked in
function. Answer
Use the Select values step to convert a string to date in Pentaho DI.
Here is a setup that works for your example:
Here is the date string: MMM dd yyyy h:mm a
Topic 1038
Subject
How does Excel handle scope when passing parameters to nested sub
procedures
Question
I´m calling this sub procedure from another sub procedure. When I refactored
this code out of the main procedure, the variables no longer register in my
watch window nor does the code execute correctly. However, I can hover my
cursor over myArray(x,y) when debuggging and it shows the value loading into
the array. I imagine I might have a problem with scope, any insights?
Public Sub calcPriceCycles(ws As Worksheet, thisRow As Integer) Dim k As
Integer
Dim myArray(0 To 10, 0 To 1) As Long 
          'ArraySum = 0 

          For k = 0 To 10 
              If thisRow >= 12 Then 'calculate up to row 12
due to array size 
                  myArray(k, 0) = ws.Cells(thisRow - k, 5) 
                  myArray(k, 1) = thisRow - k 
              End If 
          Next k 
End Sub
Answer
As you have coded this routine, myArray is not visible outside the sub. The
array is local. To make myArray visible you have three options:
pass the array back out through the header use a function rather than a sub
make the scope of myArray more global by moving the Dim outside the sub
Topic 1039
Subject
Excel Dispersion Graph - How many points are in a cell?
Question
I have the x-axis divided in 5 parts from 0 to 1
(0,0.2,0.4,0.6,0.8,1)
same thing for the y-axis.
How can I count the numbers of points in every cell of the dispersion graph in
Excel?
For example, I want to know how many points are in the first cell (X(0->0.2),
Y(0->0.2))
Topic 1040
Subject
Better way of protecting VBA than Excel built-in?
Question

I have noted that password protection on XLSM files is easily broken,
exposing all VBA code.
What alternative methods exist that offer more security than simply adding
password protection on the project settings? Answer
For anyone interested in truly protecting their VBA projects check out the
following step by step guide(Collected and Tested). I found it working fine for
me.
1. Open your desired file.
2. Press Alt+F11 to access the add-in's vba project
3. Lock the vba-project with a password
4. Double-click on the "ThisWorkbook" code module
5. Press F4 to open the Properties window
6. Change the "IsAddin" status to FALSE
7. Return to Excel by Pressing Alt+Q (or close the vbe window)
8. Go to Review TAB > Share Workbook
9. When the dialogue appears, check the box for: (Allow changes by.....)
10. Press OK to close the Dialogue
11. When prompted to save, Press OK
12. Press Ok to accept that "macros cannot be accessed"
13. You should feel giddy at this point because you just realized what you
havebeen missing right under your nose
14. Verify that the [SHARED] appears in the application title bar
15. Now save the workbook again.
16. Close this Excel workbook.
17. Test out your newly saved file (open it, access the vba, try to expand the
project window, you should get the new message "Project is Unviewable"
18. Your done
Topic 1041
Subject
Excel hangs when I use an innocuous looking formula?
Question
I have a large worksheet that I have set to manual formula calculation.

I added a few new columns today and when I clicked Calculate Sheet it would
hang at Calculating: 0% forever
I did some troubleshooting with the new columns and realised it was a column
of sumifs that created the issue.
The formula is
SUMIFS($DD$3:$DD$70000, 
     $DB$3:$DB$70000, 
     DB3, 
     $DC$3:$DC$70000, 
     DC3, 
     $DE$3:$DE$70000, 
     DE3) 
(dragged down for many rows) but the strange thing is when I calculate a cell
with this formula individually, it calculates correctly. There are a lot of rows
so I can't check every cell in the column individually but I don't understand
how it could cause Excel to hang when I calculate the whole sheet.
Any ideas?
Thanks.
Topic 1042
Subject
Export Excel file (.xls) from large json response
Question
I have a json response ~10,000+ records, i want them to export json response
into excel document (.xls), with some formatting.
Application is designed in C# .NET, i am displaying json data in jqGrid.
Any link or support how this can be achieved is appreciated. Answer
Try NPOL Its free and support XLS and XLSX both.

You can go through this blog for reference
Topic 1043
Subject
Have Excel Show Numbers instead of text
Question
I was given a problem set and dates show up for example as 1/1/2016 on the
side and are converted automatically to Jan-16. How do I have it so it just says
1/1/2016? Answer
You have to explicitly format the cell as text instead of automatic. After this, it
might be neccesary to re-enter the text.
Another option is to prefix the text with a tick character '.
Topic 1044
Subject
Is it possible it integrate VBA scripting with C++ in order to invoke function
calls?
Question
I want to link VBA scripting for excel with C++ in order to invoke functions
between the environments? Is this possible?? Answer
Yes.
If you have an automation-compatible COM api, use that.
If you have a simple handle-based API, you can use VBA's external function
declaration syntax.
https://msdn.microsoft.com/en-us/library/aa243324(v=vs.60).aspx
Or, you can write a type library for the API, using midl.
https://msdn.microsoft.com/en-
us/library/windows/desktop/aa367091(v=vs.85).aspx

Or, you can use C++ to write a COM or handle-based wrapper around the C++
API.
Topic 1045
Subject
VBA trigger onchange event
Question
Essentially what I am trying to achieve here is for an internal webpage to load
a team based on a drop down selection.The Javascript is built into the page
itself and not located in the header.
Additionally, the HTML for the drop down does not have an“ onchange” event
to choose from.The closest it comes to that is a jQuery.I have tried utilizing the
following VBA to achieve the desired result however, after‘ Team 1’ is
selected in the drop down, it does not fire the javascript built into the page.Is
there any way to get this to load ?
VBA :
appie.Document.getElementById("supervisor").Value = "Team 1"
appie.Document.getElementById("supervisor").FireEvent("onchange")
HTML
< SELECT id = supervisor name = supervisor jQuery16406646189108208134
= "3" > < OPTION disabled selected > Select Team < /OPTION>
Team 1 < /OPTGROUP>SELECT>
JavaScript
< SCRIPT type = text / javascript >
$(function() { 
      $('#supervisor').change(function() { 
          document.getElementById('results').innerHTML =
'<img src="/img/busy.gif" />'; 
          var str = $('#filterform').serializeArray(); 
          $.ajax({ 

              url: 'ajax.php?
p=agentrosters&mode=1&field=supervisor', 
              type: 'POST', 
              data: str, 
              success: function(j) { 
                  //alert(j); 
                
document.getElementById('results').innerHTML = j; 
                  document.getElementById('lastsearch').value
= 'supervisor'; 
                  resetscript('supervisor'); 
              }, 
              failure: function() { 
                
document.getElementById('results').innerHTML = 'There has
been an error, please try again'; 
                  resetscript('null'); 
              } 
          }) 
      }) 
}) < /SCRIPT>
Topic 1046
Subject
Link cells from different sheets if the cells next to it matches
Question
I want to make the next function.
If the first cell in A in worksheet1 is equal to the cell in A in worksheet2
(where the function is called), then the empty cell next to it in column B of
worksheet2, changes to the data of the cell next to it in column B in
worksheet1. If they are not equal, then try it for the next row in worksheet1
until it finds a match.
The sheets looks a bit like this:
Worksheet1
A B

1 11:10 a
2 11:11 b
3 11:12 c
Worksheet2
A B
1 11:11 function
2 11:14 function
Answer
Sub match()
Dim w1 As Worksheet, w2 As Worksheet
Dim FRow1 As Long, FRow2 As Long, m as Long, i As Long, j As Long Dim
str1A As String, str12A As String
Set w1 = Sheet1
Set w2 = Sheet2
m=w1.Rows.Count
Frow1 = w1.Range("A"& m).End(xlUp).Row
Frow2 = w2.Range("A"& m).End(xlUp).Row
For i=1 to FRow1
str1A = Trim(w1.Range("A" & i).Text)
str2A = Trim(w2.Range("A" & i).Text)
if str1A = str2A then
w2.Range("B" & i) =""
Else: End if
Next i

End Sub
Topic 1047
Subject
Excel VBA Insert Number of Rows for Copied Data using Resize
Question
I want to copy a range of cells from Workbook1.xlsm and Insert them in
Workbook2.xltm.
I will need to insert enough rows in Workbook2 to 'cope' with the size of the
data, which will vary. Thanks to jspek I've the following macro but this doesn't
insert the rows in Workbook2.
From much Googling I came to this . All I can see is that I need to use .Resize.
My Trial Macro
sub rangeCopy()
Dim sourceRange As Range, loopRange As Range Dim targetRange As Range
Dim lastRow As Long
Dim sourceCounter As Long
Dim targetCounter As Long
Dim outString As String
Dim startRow As Long
Dim startCol As Long
Dim endCol As Long
Dim colCounter As Long
Set sourceRange = Sheets("Input Sheet").Range("A9:C800") Set targetRange =
Workbooks.Open("C:\Users\j\Documents\Workbook2.xltm").Sheets("Quote").R
startRow = sourceRange.Row
lastRow = sourceRange.Rows.Count
startCol = sourceRange.Column
endCol = sourceRange.Columns.Count - 1
Set loopRange = sourceRange.Parent.Cells(startRow, startCol)
For colCounter = 0 To endCol

targetCounter = 0
For sourceCounter = 0 To lastRow - 1
outString = Trim(loopRange.Offset(sourceCounter, colCounter).Value) 
      While (Trim(targetRange.Offset(targetCounter,
colCounter).Value) <> "") 
          targetCounter = targetCounter + 1 
      Wend 
      targetRange.Offset(targetCounter, colCounter).Value =
outString 
Next
Next
End Sub
Answer
Just the idea of what I was trying to suggest you need to make changes and
debug it to suit it to your needs
sub rangeCopy()
Dim p As long
Set targetRange =
Workbooks.Open("C:\Users\j\Documents\Workbook2.xltm").Sheets("Quote").R
Dim FRow As Long
Dim m As Long
m =Sheets("Input Sheet").Rows.Count
FRow = Sheets("Input Sheet").Range("A" & m).End(xlUp).Row
Set sourceRange = Sheets("Input Sheet").Range("A9:C" &FRow)
sourceRange.Copy
Sheets("Quote").Rows("4:4").Select Selection.Insert Shift:=xlDown p= FRow
+ 5
Sheets("Quote").Rows("4:" & p).Copy
Sheets("Quote").Rows("4:4").PasteSpecial xlPasteValues
Application.CutCopyMode = False

End Sub
Topic 1048
Subject
Excel Formula for looking at different account #'s, and finding descriptions of
each, and making sets of them in separate columns
Question
I have 12,000+ rows to sort through of this data and help would be so
appreciated!
So firstly I need to check for the account names of a unique id.
So let's say for A00001 , there is Products, Swaps, and Adjustments-Change .
As you can see these account names are listed multiple times for the unique ID
A00001 , but I only need to the know which account names are included for
A0001, not how many times each is listed.
I'll take those 3 accounts names that I found, and put them in a "group" tab in
the worksheet, as shown in the bottom picture, and create a group #1. If another
unique ID within the 12,000+ rows only contains the account names Products,
Swaps and Adjustments-Change accounts, then I'll assign it to Group #1 ( the
green circle).
In the next set of unique ID, A00002, the account names that reoccur are
Products and Swaps. So I'll create a group #2. I won't assigned this to group
#1 because it doesn't contain all 3 of the accounts names that group #1 has.
For A00003, it contains only Products and Swaps, so I will assign it a group
#2.
So what I'm asking is, is there an excel formula or VBA code that I could use to
automate this? Answer
The reason your post has been downvoted is that you haven't produced any
code or formulae that would demonstrate you have at least attempted to solve
this problem. And your question is rather vague:

is there VBA code to automate this?
Answer: Yes!
It's not really our job to articulate your question for you, which is why
responses to your post are rather sparse. However, there are a couple of points
in your question that may also be of use to others so I'll answer as best I can.
Point 1: whenever you have reasonably large datasets (in your case 200,000),
it's usually better to read the data into a Variant array and process the data
within VBA. That's a simple task v = Range(A1:D200000).Value2 and is
remarkably fast.
Point 2: I presume your account names aren't necessarily sorted. So one client
could have a 'Products and Swaps' combo whereas another could have 'Swaps
and Products'. You haven't stated this, but I guess we have to cater for the
possibility. In these cases, a solution is to convert each item to a numerical
index which allows something similar to binary addition. If for example,
'Products'=1, 'Swaps'=2 and 'Adj'=4 then a combo of products and swaps (in
whatever order) will give a unique sum of 3; swaps and adj uniquely give 6,
etc.
The solution to your task probably lies somewhere down this road. The code
below will help you get started with it, and I have commented throughout to
give you further guidance.
I note this is your first post, so I ought to explain that the purpose of this site is
not to provide a pro-bono coding service. It's meant to help you and others
when you hit an insurmountable obstacle. Please therefore try to understand the
code and familiarise yourself with VBA so that you can develop this skeleton
code for yourself; and, if I may take the liberty of offering advice, avoid
response comments along the lines of "It won't work."
Good luck with your project, paste the following code into a Module in your
VBA Editor:
Option Explicit
Private Const UNIQUE_ID_INDEX As Integer = 0 Private Const

ACC_LIST_INDEX As Integer = 1 Private Const ALLOCATION_INDEX As
Integer = 2 Private Const GROUP_NAME_INDEX As Integer = 0 Private
Const GROUP_LIST_INDEX As Integer = 1 Private Const ROW_KEY As
String = "row" Private Const GROUP_KEY As String = "group" Private Const
SOURCE_SHEET_FIRST_ROW As Long = 2 Private Const
SOURCE_SHEET_FIRST_COL As Long = 1 Private Const
SOURCE_SHEET_LAST_COL As Long = 3 Private Const
GROUP_SHEET_FIRST_ROW As Long = 1 Private Const
GROUP_SHEET_FIRST_COL As Long = 2 Public Sub RunMe()
Dim src As Worksheet
Dim grp As Worksheet
Dim lastRow As Long
Dim data As Variant
Dim output() As Variant
Dim idList As Collection
Dim groupList As Collection
Dim accList As Collection
Dim accKeyList As Collection
Dim accIndex As Long
Dim accName As String
Dim idItems As Variant
Dim uniqueID As String
Dim groupItems As Variant
Dim maxSize As Long
Dim added As Boolean
Dim c As Long
Dim h As Long
Dim v As Variant
' Read the data from the data sheet Set src =
ThisWorkbook.Worksheets("Sheet1") 'adjust to your source data sheet name.
lastRow = src.Cells.Find(What:="*", _ 
                          After:=src.Cells(1), _ 
                          LookIn:=xlFormulas, _ 
                          LookAt:=xlPart, _ 
                          SearchOrder:=xlByRows, _ 
                          SearchDirection:=xlPrevious, _ 

                          MatchCase:=False, _ 
                          SearchFormat:=False).Row 
data = src.Range(src.Cells(SOURCE_SHEET_FIRST_ROW,
SOURCE_SHEET_FIRST_COL),
src.Cells(lastRow, SOURCESHEET_LAST_COL)).Value2
'Process the data into lists of unique acc names and IDs Set accList = New
Collection
Set accKeyList = New Collection
Set idList = New Collection
c = 1
For h = 1 To UBound(data, 1) 
      'Convert account names to unique binary indexes 
      accName = data(h, 2) 
      accIndex = GetOrAdd(accName, accList, c, added) 
      If added Then 
          accKeyList.Add accName, CStr(c) 
          c = c + c 
      End If 
      'Create a list of uniqueIDs and a list of row numbers
for each new uniqueID 
      uniqueID = data(h, 3) 
      idItems = GetOrAdd(uniqueID, idList, Array(uniqueID,
New Collection, New Collection), added) 
      If added Then idItems(ALLOCATION_INDEX).Add h, ROW_KEY 
      'Add the account index to this uniqueID group 
      Call IgnoreOrAdd(CStr(accIndex),
idItems(ACC_LIST_INDEX), accIndex) 
Next
'Sum each account index in the uniqueID group 'to obtain a binary value that is
unique 'to this combination of account names 'and create a new group if the
binary value is new. Set groupList = New Collection
maxSize = 0
c = 1

For Each idItems In idList 
      h = 0 
      For Each v In idItems(ACC_LIST_INDEX) 
          h = h + v 
      Next 
      groupItems = GetOrAdd(CStr(h), groupList, Array(c,
idItems(ACC_LIST_INDEX)), added) 
      If added Then 
          c = c + 1 
          'Get max size of list to dimension output array 
          h = groupItems(GROUP_LIST_INDEX).Count 
          If h > maxSize Then maxSize = h 
      End If 
      'Assign group name to uniqueID 
      idItems(ALLOCATION_INDEX).Add
groupItems(GROUP_NAME_INDEX), GROUP_KEY 
Next
'Write the group output onto the source data sheet ReDim output(1 To
UBound(data, 1), 1 To 1) For Each idItems In idList 
      output(idItems(ALLOCATION_INDEX).Item(ROW_KEY), 1) = 
          idItems(ALLOCATIONINDEX).Item(GROUP_KEY) 
Next
src.Cells(SOURCE_SHEET_FIRST_ROW, SOURCE_SHEET_LAST_COL +
1) _
.Resize(UBound(output, 1), UBound(output, 2)).Value = output
'Write the group summary output onto the summary sheet Set grp =
ThisWorkbook.Worksheets("Sheet2") 'adjust to your group summary sheet
name. ReDim output(1 To maxSize + 1, 1 To groupList.Count + 1) output(1, 1)
= "Group #"
'Loop through group list to read the individual acc names. c = 2
For Each groupItems In groupList 

      output(1, c) = groupItems(GROUP_NAME_INDEX) 
      h = 2 
      For Each v In groupItems(GROUP_LIST_INDEX) 
          accName = accKeyList(CStr(v)) 
          output(h, c) = accName 
          h = h + 1 
      Next 
      c = c + 1 
Next
grp.Cells(GROUP_SHEET_FIRST_ROW, GROUP_SHEET_FIRST_COL) _
.Resize(UBound(output, 1), UBound(output, 2)).Value = output
End Sub
Private Function GetOrAdd(ByVal key As String, _ 
                        ByRef col As Collection, _ 
                        ByVal newValue As Variant, _ 
                        Optional ByRef added As Boolean) As
Variant 
Dim v As Variant
v = Empty
On Error Resume Next
v = col(key)
On Error GoTo 0
If IsEmpty(v) Then 
      v = newValue 
      col.Add v, key 
      added = True 
  Else 
      added = False 
End If
GetOrAdd = v

End Function
Private Sub IgnoreOrAdd(ByVal key As String, _ 
                      ByRef col As Variant, _ 
                      ByVal newValue As Variant, _ 
                      Optional ByRef added As Boolean) 
Dim v As Variant
v = Empty
On Error Resume Next
v = col(key)
On Error GoTo 0
If IsEmpty(v) Then 
      col.Add newValue, key 
      added = True 
End If
End Sub
Topic 1049
Subject
Read a cell value from another excel file
Question
If I want to read a value from another sheet, I write in the cell
='sheetName2'!G40
If I want to read the above value in a different excel file, can this happen?
Answer
Just refer to the file, like:
='C:\Users\James\Desktop\[Other.xlsx]Sheet1'!$B$9

Answer
The formula should look something like: ='[File Name.xlsx]Sheet1'!D2
Or you can find it by going through Excel's workbooks feature which allows
you to open up another Excel file, just like everything I know the sheet with
missing file. This is for Excel 2010, be careful moving files around that may
cause the links to break.
Topic 1050
Subject
Appending formula text to specific cell on pandas
Question
I have a python app which runs 4 queries and writes results to excel file.
Everything works fine but i can't find a way to append formula text into
specific cell with sheetname. Here is my code:
import pandas as pd
import pyodbc
df = pd.read_sql_query(script, cnxn)
df2 = pd.read_sql_query(script2, cnxn)
df3 = pd.read_sql_query(script3, cnxn)
df4 = pd.read_sql_query(script4, cnxn)
writer = pd.ExcelWriter('{0}_{1}_{2}_{3}.xlsx'.format(var1, var2, var3,
var4))
df.to_excel(writer, sheet_name='name1') df2.to_excel(writer,
sheet_name='name2') df3.to_excel(writer, sheet_name='name3')
df4.to_excel(writer, sheet_name='name4')
writer.save()
I want to add a formula in sheet name 4 on F2 cell so it can sumproduct the
way i want on the results. I mean it should not overwrite the sheet name 4.
Thank you

Topic 1051
Subject
Abbreviations management
Question
I need to deal with a great number of abbreviations, so I would like to create a
spreadsheet where all of them are automatically ordered as I enter each in a
new cell. Also, the whole row corresponding to such cell must be moved along
when ordered alphabetically.
I am just supposing this is the best way to proceed, so any ideas will be
welcomed. Answer
Say we have something like:
Out editing procedure says to enter the full text in column B and then the
abbreviation next to it in column A. First place the following sub in a standard
module:
Sub Macro1()
Dim N As Long
N = Cells(Rows.Count, "A").End(xlUp).Row Columns("A:B").Select
ActiveWorkbook.Worksheets("Sheet1").Sort.SortFields.Clear
ActiveWorkbook.Worksheets("Sheet1").Sort.SortFields.Add
Key:=Range("A2:A" & N), _
SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
With ActiveWorkbook.Worksheets("Sheet1").Sort 
    .SetRange Range("A1:B" & N) 
    .Header = xlYes 
    .MatchCase = False 
    .Orientation = xlTopToBottom 
    .SortMethod = xlPinYin 
    .Apply 
End With

End Sub
Then place this event macro in the worksheet code area:
Private Sub Worksheet_Change(ByVal Target As Range)
Dim A As Range
Set A = Range("A2:A" & Rows.Count)
If Intersect(Target, A) Is Nothing Then Exit Sub If Target.Offset(0, 1) = "" Then
Exit Sub
Application.EnableEvents = False
Call Macro1
Application.EnableEvents = True
End Sub
Once macros are enabled, changes to cells in column A will cause the table to
re-sort.
Topic 1052
Subject
VBA Excel: change Page Break according to number of rows and last row
position
Question
I made a workbook consist of few sheets. By using VBA I read varying number
of rows on sheet1 and copy them to last sheet that act like some kind of custom
report. In most cases this last sheet is long just one page during printing, but
sometime VBA routine copy rows with plenty data, arranged into two or more
lines of text, so last rows of such reports (where shall be a sign, date, place
etc.) appears unexpected on Page 2! And if I made Page break on the way that
only Page 1 is printable then my report lost these details; in second case, if I
set Page break to 2 pages (and on the page are just few rows of data), then
process of printing will produce printing of 2 pages: one filled with data and
second, empty! Is there some way to detect where is situated last row with
data, and then from VBA change printing area according to result of detection,
to print only Page 1 or Page 1 and Page 2 together!? I tried it by using row

number, but some rows have twice height than others, so I gave up! Thank you.
Answer
In meantime, I thought I found simple and working solution (Excel 2010):
LastRow3 = Cells.Find("*", SearchOrder:=xlByRows,
SearchDirection:=xlPrevious).Row MsgBox "Last row filled with data is " &
LastRow3" 'detect how many pages is in this sheet
ActiveWorkbook.Sheets(1).Range("A1").Select tnp=
(ActiveSheet.HPageBreaks.Count + 1) * (ActiveSheet.VPageBreaks.Count +
1) pagnr = "Total number of pages is:" & tnp MsgBox pagnr
After that, based on tnp variable value is probably easy to set Page break with:
ActiveSheet.PageSetup.PrintArea = "$A$1:$E$80" ' takes in account Page1
and Page2
or
ActiveSheet.PageSetup.PrintArea = "$A$1:$E$50" 'only one page is for
printing
Anybody has better solution!? Thank you.
Topic 1053
Subject
VBA error(9) Subscript out of range
Question
While executing the below script, I can't get rid of the run time error 9.
What I want to do is to search a specific cell value from sheet 2 and locate it in
a range of cells in sheet 1.
Here is my script:
Public output() As Variant
Sub james()
Dim J As Object

Dim c As Object
Sheet2.Activate
ReDim ouput(3)
Set J = Cells(1, 1)
output(1) = J.Offset(0, 5).Value
output(2) = J.Offset(30, 5).Value
output(3) = J.Offset(60, 5).Value
Sheet1.Activate
Range("B7:B86").Select
For Each c In Selection
If c.Value = "output(1)" Then
Exit For
End If
Next c
Rows(c.Row).Select
End Sub
Answer
@SearchAndResQ is right, if you wanted your array to start at 1, you have two
options:
Use Option Base 1 at the beginning of your module, or Redim output(1 to 3)
Also, you will want to change your If statement for:
If c.Value = output(1) then
All in all, this is a better version of your code:
Public output() As Variant
Sub james()
Dim J As Range
Dim c As Range

ReDim ouput(1 to 3)
Set J = Sheet2.Cells(1, 1)
output(1) = J.Offset(0, 5).Value
output(2) = J.Offset(30, 5).Value
output(3) = J.Offset(60, 5).Value
For Each c In Sheet1.Range("B7:B86")
If c.Value = output(1) Then
Exit For
End If
Next c
Rows(c.Row).Select
End Sub
Topic 1054
Subject
excel Check name and use mailaddres
Question
I have a sheeta with the name of a person (dropdown), in a different sheetb
(from where the dropdown gets the name) are the contact details. If in sheeta a
person is selected and the user pushes the send button the mail has to be sent to
that person, mailaddress in sheetb.
How can i get the mailaddress from sheetb with a code in the mail macro?
Anyone ideas?
Thanks in advance
Answer
Sorry to ask, but are you trying to sent email from within Excel or trying to sent
information within Excel from one sheet to another? Perhaps you can provide
screen shots of both sheets?

thanks,
Naveen
Topic 1055
Subject
Sum of a sequence of merged cells in an excel column
Question
I have a sheet column which contains a group of contiguous cells with
addresses like G2, G17, ..., G707 containing some 'time' values (like 3:50) that
are each calculated with relative formulas like
=MROUND( SUM(F2:F16), "00:15")
=MROUND( SUM(F17:F31), "00:15")
and so on. Every cell is a combination of 15 cells. So the addresses are not
consequent. When I try to sum this G(2+ 15i) sequence with
=SUM(G2:G707)
formula, I get a reference error (!REF#). What is the problem here?
Topic 1056
Subject
Check excel column values if they are equal to each other
Question
I have a table like this
Product       Price     Currency ________   _____   ________
Product 1      10      USD
Product 2      11      EUR
Product 3      12      USD
Product 4      13      CNY
Product 5      14      EUR
                 _____             =subtotal(109)
I use filter in Currency column, and subtotal(109) formula in price column to

sum prices. So if USD is selected from filter, it filters all products with USD
price and sums them. But if currency is not filtered subtotal(109) sums prices
anyway, which is wrong (USD 1 + EUR 1 is not 2).
I want to fire subtotal(109) formula only if values in currency column are equal
to each other. Like, count NOT unique values among filtered rows, and if that
is equal to 1 fire subtotal(109).
Note: I know how to do it with SUMIF by placing a dropdown list with
currencies in a separate cell. But i want to use filter to do this task. Answer
Say we have an autofiltered table like:
but we want a warning rather than a SUBTOTAL() if more than one currency
has been selected.
We need to detect more than one currency.
First enter the following User Defined Function in a standard module:
Option Explicit
Public Function CountVisibleUnique(rng As Range) As Long
Dim c As Collection, r As Range
Set c = New Collection
On Error Resume Next 
    For Each r In rng 
       If r.EntireRow.Hidden = False Then 
          c.Add r.Text, CStr(r.Text) 
       End If 
    Next r 
On Error GoTo 0
CountVisibleUnique = c.Count
End Function

Then in cell B8, replace:
=SUBTOTAL(109,B2:B6)
with
=IF(countvisibleunique(C2:C6)>1,"multiple
currencies",SUBTOTAL(109,B2:B6))
Topic 1057
Subject
Call macros based on characters of a filename
Question
How can I call macros based on the left n characters of a filename?
Details
I get emailed many files per month whose names contain a few characters
followed by a date or serial number.
For example
- Accounts receivable files are named ARDET 25-01-16.xls, ARDET 19-01-
16.xls , ARDET 31-12-15.xls and so on - Invoicing files are named
Bkg_Inv_01.xls, Bkg_Inv_02.xls, Bkg_Inv_03.xls and so on
I have recorded various macros to run on these files. For example, I have Sub
ARDET() and Sub Bkg_Inv() to handle the above files.
I want to create a single macro to call the above Subs if the first 5 characters
of the filename matches certain text.
The code I am looking for needs to be roughly in the following syntax:
Sub Call_Macro_if_leftn_is()
' Making variables
This_File_name = Currently open file's filename

n = InputBox("Enter the total number of characters from the left of the filename
to match")
y = Left n characters of This_File_name
'If Then statements to call other macros
If y = ARDET
Call ARDET()
Else if y = Bkg_I
Call Bkg_Inv()
Else if y = PDC_I
Call PDC_Inv()
Else Msgbox "Filename does not match specified characters"
End Sub
Answer
I'd try a set-up something like this:
Sub RunCodeBasedOnFileName()
Dim fileID As String
fileID = VBA.Left$(ThisWorkbook.Name, 5)
If fileID = "ARDET" Then
ARDET
ElseIf fileID = "Bkg_I" Then
Bkg_I
ElseIf fileID = "PDC_I" Then
PDC_I
Else

MsgBox "This file is of unknown origin!" End If
End Sub
Sub ARDET()
'Do stuff
End Sub
Sub Bkg_I()
'Do stuff
End Sub
Sub PDC_I()
'Do stuff
End Sub
You don't need to use Call or have the parentheses () when calling a sub I'd
avoid getting people to input the first 5 characters - instead get it
programmatically
The only bit I am unclear about is where you are running this code from and
how you are iterating over the files that you are sent?
Where I have ThisWorkBook this requires the code to be running in the actual
file. I think you'll need to modify that e.g. you loop over a bunch of files in a
folder and access the filename that way.
Answer
Thanks Alex. I will test your code and tell you how it works.
I get such files through email atleast 10 times a day. I run my macros on files
before I store them in folders named by month and category of file.
But coming to think of it, your idea of iterating through files in a folder is great
! Could you have the same code iterate over all files in a folder, and

preferably, its sub folders as well?
My files are stored in folders in a hierarchy that goes like -
"C:\Dropbox\Work\2016\Jan\ARDET Jan" or -
"C:\Dropbox\Work\2016\Jan\BkgInv Jan"
Topic 1058
Subject
Read Excel Sheet Data into DataTable or Dataset
Question
I tried to import from Excel to a dataset and an error message occurred.
I'm studying this site http://vb.net-informations.com/excel-
2007/vb.net_excel_oledb.htm
Imports System.Data
Imports System.Data.SqlClient
Public Class Form1
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As
System.EventArgs) Handles Button1.Click 
      Try 
          Dim MyConnection As
System.Data.OleDb.OleDbConnection 
          Dim DtSet As DataSet 
          Dim MyCommand As System.Data.OleDb.OleDbDataAdapter
          Dim Loc As String = Application.StartupPath() +
"\Param\exceldata.xlsx" 
          Dim strCOleCon As String =
"provider=Microsoft.Jet.OLEDB.4.0; Data Source='" + Loc.Trim +
"';Extended Properties=Excel 8.0;" 
          MyConnection = New
OleDb.OleDbConnection(strCOleCon) 
          MyCommand = New OleDb.OleDbDataAdapter("select *
from [Sheet1$]", MyConnection) 
          MyCommand.TableMappings.Add("Table", "TestTable") 
          DtSet = New DataSet 

          MyCommand.Fill(DtSet) 
          DataGridView1.DataSource = DtSet.Tables(0) 
          MyConnection.Close() 
      Catch ex As Exception 
          MsgBox(ex.ToString) 
      End Try 
End Sub
End Class
Answer
U can use third party EPPLUS which is freeware.Which can import excel file
into data set and it also has many functionallities to manipulate the excel file
Answer
First off I believe your connection is incorrect, you have an xlsx file but the
connection is set for xls.
BTW Not sure if this is a forms or asp project but sure looks like a forms
project for windows thinking about your first tag indicating asp.net.
Excel can be tricky in regards to how the connection string is setup, do you
want to just read, does the first row in the sheet have column names or data, is
there mixed data in a column etc.
Here is a snippet I have used to make things easier with connection but be
forewarned it's not fool-proof in that you need to set HDR and IMEX correctly
in the connection,
Imports System.Data.OleDb
Module ExcelOleDbConnections
''' <summary>
''' Creates a connection string on read data from an excel file ''' </summary>
''' <param name="FileName"></param> ''' <param name="Header">Yes if first

row is column-names, No if first row is data</param> ''' <param
name="IMEX"></param>
''' <returns></returns>
''' <remarks>
''' See following page for clarification on extended properties ''' including
IMEX. Ignore C# code. '''
http://www.codeproject.com/Articles/37055/Working-with-MS-Excel-xls-
xlsx-Using-MDAC-and-Oled ''' </remarks>
<System.Diagnostics.DebuggerStepThrough()> _ Public Function
ExcelConnectionString( 
      ByVal FileName As String, 
      Optional ByVal Header As String = "No", 
      Optional ByVal IMEX As Integer = 1) As String 
      Dim Builder As New OleDbConnectionStringBuilder 
      If IO.Path.GetExtension(FileName).ToUpper = ".XLS" Then
          Builder.Provider = "Microsoft.Jet.OLEDB.4.0" 
          Builder.Add("Extended Properties",
String.Format("Excel 8.0;IMEX={0};HDR={1};", IMEX, Header)) 
      Else 
          Builder.Provider = "Microsoft.ACE.OLEDB.12.0" 
          Builder.Add("Extended Properties",
String.Format("Excel 12.0;IMEX={0};HDR={1};", IMEX, Header)) 
      End If 
      Builder.DataSource = FileName 
      Return Builder.ToString 
End Function
End Module
Sample reading a sheet where the first row is data. Note I am using optional
parameters so the last two use default values
Dim dt As New DataTable
' sheet has data in first row
Using cn As New OleDb.OleDbConnection With {.ConnectionString =
ExcelConnectionString(Loc)}

Using cmd As New OleDb.OleDbCommand With {.Connection = cn,
.CommandText = "select * from [Sheet1$]"} 
      cn.Open() 
      dt.Load(cmd.ExecuteReader) 
End Using
End Using
This example we assume the first row are field/column names
Dim dt As New DataTable
' sheet has column names for first row
Using cn As New OleDb.OleDbConnection With {.ConnectionString =
ExcelConnectionString(Loc, "Yes", 0)}
Using cmd As New OleDb.OleDbCommand With {.Connection = cn,
.CommandText = "select * from [Sheet1$]"} 
      cn.Open() 
      dt.Load(cmd.ExecuteReader) 
End Using
End Using
Populate the DataGridView
If dt.Rows.Count > 0 Then
DataGridView1.DataSource = dt
Else
'
' recover e.g. tell user there are no records in this sheet '
End If
Example all together

Try
Dim Loc As String =
IO.Path.Combine(AppDomain.CurrentDomain.BaseDirectory,
"Param\exceldata.xlsx") If IO.File.Exists(Loc) Then
Dim dt As New DataTable 
      ' sheet has column names for first row 
      Using cn As New OleDb.OleDbConnection With
{.ConnectionString = ExcelConnectionString(Loc, "Yes", 0)} 
          Using cmd As New OleDb.OleDbCommand With
{.Connection = cn, .CommandText = "select * from [Sheet1$]"} 
              cn.Open() 
              dt.Load(cmd.ExecuteReader) 
          End Using 
      End Using 
      If dt.Rows.Count > 0 Then 
          DataGridView1.DataSource = dt 
      Else 
          ' 
          ' recover e.g. tell user there are no records in
this sheet 
          ' 
      End If 
End If
Catch ex As Exception
MessageBox.Show("TODO")
End Try
See my windows forms examples (yes I see asp.net in your tags) Excel and
OleDb basics to advance operations
Topic 1059
Subject
Excel Vb check value i worksheets error

Question
I try to check if a value in column "B" in sheet2 also is in column "B" sheet1, if
there is a match then i want a "1" in the column 5, if not a "0"
I have the following code but doesnot do the job
Dim S1 As Worksheet
Dim S2 As Worksheet
Dim i As Integer
Dim k As Integer
Dim j As Integer
Set S1 = Worksheets("sheet1")
Set S2 = Worksheets("sheet2")
k = S1.UsedRange.Rows.Count
j = S2.UsedRange.Rows.Count
For i = 1 To k
If Application.WorksheetFunction.CountIf(S2.Range("B", j), S1.Range("B", k))
> 0 Then
MsgBox "Found"
S1.Cells(i, 5).Value = "1"
Else
MsgBox "Not Found"
S1.Cells(i, 5).Value = "0"
End If
Next i
Answer
It seems you are confusing the cell reference syntax for a Range object and a
Range.Cells property. The syntax is closer to S2.Range("B" & j) , not
S2.Range("B", j) ; but that does not cover full columns. It also doesn't appear
that you are using the COUNTIF function properly. In any event, a worksheet
MATCH function is more efficient.

For i = 1 To k
If Not IsError(Application.Match(S1.Range("B"& i), S2.Range("B:B"), 0))
Then 
      MsgBox "Found" 
      S1.Cells(i, 5).Value = "1" 
  Else 
      MsgBox "Not Found" 
      S1.Cells(i, 5).Value = "0" 
End If
Next
I think that should be closer to what you are attempting.
Answer
Based on your description, you might be better served to do this with formulas
directly, rather than VBA.
Let's start on Sheet2. You have a value in cell B2. If that value appears
anywhere in column B on Sheet1, you want to show the value 1 in cell E2
(same row, column 5). If not, you want E2 to show a 0.
Since you want to show the result of a calculation in a single cell, a worksheet
formula can do what you need. The MATCH function will look for the first
match in a range, which is closer to your goal than COUNTIF.
If MATCH returns any number, it found a match, so we can use ISNUMBER to
check the MATCH result and return a TRUE/FALSE. Finally, we can use IF to
convert that to our custom output (in this case, 1 or 0).
In cell E2, enter this formula:
=IF(ISNUMBER(MATCH($B2,Sheet1!$B:$B,0)),1,0)
You can copy or fill that formula down as many rows as you want. You won't
need to enable macros in the workbook to use this, and your results will

recalculate whenever the worksheet does (so you don't need to manually run a
macro).
If you need to use VBA for a specific reason, it looks like other answers have
already been posted.
Answer
Dim wk As Worksheet, ws As Worksheet
Dim i As Long, j As Long, m As Long
Dim strA As String, strB As String
Dim FRowA As Long, FRowB As Long
'Setting Worksheet Variables
Set wk = Sheet1
Set ws = Sheet2
m = wk.Rows.count
FRowA = wk.Range("B" & m).End(xlUp).Row FRowB = ws.Range("B" &
m).End(xlUp).Row
For i = 1 To FRowB
strB = Trim(ws.Range("B" & i).Text) 
      For j = 1 To FRowA 
              strA = Trim(wk.Range("B" & j).Text) 
                  If strA = strB Then 
                      wk.range("E"&j).Value = 1 
                  Else End If 
       Next j 
Next i 
   For j = 1 To FRowA 
   strA = Trim(wk.Range("E" & j).Text) 
   If strA = "" Then 
   wk.range("E"&j).Value = 0 

   Else End If 
   Next j 
End Sub
Topic 1060
Subject
Saving tuple to Excel XLSX file using python
Question
How can I save the output of expenses to Excel XLSX file? I tried the
following code -- it extracts specific lines from docx files that I want to save
to excel.
import textract
import glob
import xlsxwriter
path = "my directory file"
for fname in glob.glob(path):
text = textract.process(fname)
tend = text.find('TEST STATUS:')
rname = text.find('RUN NAME:')
ttime = text.find('TOTAL TIME ELAPSED') etime = text.find('AUTO TIME
ELAPSED') tend = text[tend:tend+21]
tends = tend.split(':')
subs = text[rname:rname+16]
subst = subs.split(":")
ttime = text[ttime+31:ttime+38]
etime = text[etime+30:etime+38]
expenses = ( 
      ['TEST STATUS',tends[1]], 
      ['RUN NAME',subst[1]], 
      ['TOTAL TIME ELAPSED',ttime], 
      ['AUTO TIME ELAPSED',etime],) 

row = 0
col = 0
workbook = xlsxwriter.Workbook('Expenses01.xlsx') worksheet =
workbook.add_worksheet() for item, cost in (expenses): 
      worksheet.write(row, col,     item) 
      worksheet.write(row, col + 1, cost) 
      row += 1 
workbook.close()`
Topic 1061
Subject
Export Pictures Excel VBA in original resolution
Question
This solution: Export Pictures Excel VBA
Works just fine, but it's using a chart method that's being resized to the images
inside the table to "screenshot" them(in my case even including the table
borders), not actually exporting the images themselves.
When I get the images by converting the excel table to a html file, they even
come in better resolution in the folder.
Is there a way to get the images themselves, with their original resolution
instead using VBA(obviously I don't just need the pictures, otherwise I'd be
content with the html conversion method)?
What I mean can be seen here: http://i.imgur.com/OUX9Iji.png The picture on
the left is what I get using the html conversion method, the picture on the right
is what I get using the chart method. As you can see the chart method just
screenshots the picture within the excel table, and I need it to get the original
picture like on the left.
Topic 1062
Subject
How to save login data in Excel worksheet using html ?

Question
What i need
I need to save login data in excel sheet while user click submit button in html.
Still what i done
using vb-script i have done this.
Errors
Sub Sample() undefined script errors.
data not saving
dialog box not responding
this is my excel sheet
<!DOCTYPE html>
<html>
<head>
<script language="vbscript" type="text/vbscript"> Sub Sample()
debugger;
Dim iRow
Set objExcel = CreateObject("Excel.Application") Set objWorkbook =
objExcel.Workbooks.Open("E:\excel\work.xlsx")
'Document.GetElementsByName("fname")(0).Value="C#"
'Document.GetElementsByName("lname")(0).Value="Corner"
'Document.GetElementsByName("Add1")(0).Value="Tamilnadu"
'Document.GetElementsByName("Add2")(0).Value="Coimbatore"
objExcel.Application.Visible = True
objWorkbook.Windows(1).Visible = True
set XlSheet =objWorkbook.Sheets(1)
XlSheet.Activate
iRow = 1
With objExcel
Do While .Cells(iRow, 1).value <> ""
.Cells(iRow, 1).activate
iRow = iRow + 1

Loop
.Cells(iRow, 1).value=Document.GetElementsByName("fname")(0).Value
.Cells(iRow, 2).value=Document.GetElementsByName("lname")(0).Value
.Cells(iRow, 3).value=Document.GetElementsByName("Add1")(0).Value
.Cells(iRow, 4).value=Document.GetElementsByName("Add2")(0).Value
MsgBox "Data Added Sucessfully",vbinformation
Document.GetElementsByName("fname")(0).Value=""
Document.GetElementsByName("lname")(0).Value=""
Document.GetElementsByName("Add1")(0).Value=""
Document.GetElementsByName("Add2")(0).Value="" End With
objWorkbook.save
objWorkbook.close
Set objWorkbook = Nothing
Set objExcel = Nothing
End Sub
</script>
<style type="text/css">
fieldset {
border: #00cc00 2px solid;
padding: 10px;
color:green;
</style>
<body
<form>
<fieldset>
<legend>Csharpcorner</legend>
<center>
<img src="C:\Users\Karthikeyan.K\Desktop\Add-Male-User.png"
alt="Mountain View"><br> First name:<br>
<input type="text" name="fname" Value=""><br> Last name:<br>
<input type="text" name="lname" Value=""><br> Address1:<br>
<input type="text" name="Add1" Value=""><br> Address2 :<br>
<input type="text" name="Add2" Value=""><br> <br>
<input type="button" onclick="Sample()" value="Submit" /><br> </center>
</fieldset>
<form>
</body>

</html>
Topic 1063
Subject
Excel - Using a word located in a different cell, into a SUMIFS formula using
exact match
Question
I am looking to use a SUMIFS formula that can use a word typed into a
different cell, so if the word were to be changed later, it would also update the
formula automatically.
Here is an example:
CELL A - Apple
CELL B - Banana
CELL C - Orange
Here is the formula I am using right now:
=SUM((SUMIFS($X:$X,$Y:$Y,"Apple")*0.5)+
(SUMIFS($X:$X,$Y:$Y,"Banana")*0.75)+
(SUMIFS($X:$X,$Y:$Y,"Orange")*1.25))
This is what I am trying to do:
=SUM((SUMIFS($X:$X,$Y:$Y,"CELL[A]")*0.5)+
(SUMIFS($X:$X,$Y:$Y,"CELL[B]")*0.75)+
(SUMIFS($X:$X,$Y:$Y,"CELL[C]")*1.25))
I hope this makes sense! I am still very new to here.
Thank you in advance.
Answer
This is accomplished easily by directly referencing a range (specially if that
range is static, as is mostly the case):

=SUM((SUMIFS($X:$X,$Y:$Y,A1)*0.5)+
(SUMIFS($X:$X,$Y:$Y,A2)*0.75)+(SUMIFS($X:$X,$Y:$Y,A3)*1.25))
And then, in A1,A2 and A3, you have control cells for your conditional sum.
Is there any special reason to do sumifs when you are only testing for one
criteria ?
Topic 1064
Subject
Extract Data Label from Excel Chart
Question
Experts,
I'm trying to extract the data labels from an auto-generated excel chart. I have a
decent amount of VBA experience, but unfortunately very little with charts.
From my understand of researching the topic there is a way to iterate through
all items on the chart to find those that have data labels.
Input
-Chart Sheet, ex "Step 0.2" -Scatterplot with straight lines.
Output
-Data labels from chart to separate sheet -Location, ex "Main"
An attempt:
Option Explicit
'Loop through chart to find data labels Sub FindDataLabels()
'Define worksheet and chart
Dim mainPage As Worksheet
Dim TestChart As chart
Set mainPage = ActiveWorkbook.Sheets("Main") Set TestChart = Charts("Step
0.2")
'Extract data points from chart for analysis Dim line1 As SeriesCollection

Set line1 = TestChart.SeriesCollection
Dim dataPoints As Double
dataPoints = line1.Count
Debug.Print "datapoints: "; dataPoints
Dim LabelsArray(2) As Integer
Dim i As Integer
For i = 1 To dataPoints
If line1(i).HasDataLabels Then
Debug.Print "data label: "; line1(i).DataLabels.Text
End If
Next i
End Sub
Answer
Here's code to extract data label values from an Excel Chart
Prints out values to Immediate Window
Dim datapoint As Point
For Each datapoint In
ActiveSheet.ChartObjects(1).Chart.SeriesCollection(1).Points
'Extract data labels
If datapoint.HasDataLabel Then Debug.Print datapoint.DataLabel.Text
Next
Topic 1065
Subject
Highlight Duplicates Not Next To Each Other Using Conditional Formatting

Question
We have a list of parts in Excel in a certain order. For reasons I won't get into,
we need to highlight when there are duplicates that aren't next to each other.
Currently, I'm using this formula in a conditional format to do the job.
=AND(COUNTIF($A$2:$A$82,$A2)>1,$A1<>$A2,$A2<>$A3)
This mostly works well except in cases where there are pairs of duplicates
like in the example below, we would want FO-1694 to be highlighted, because
they aren't all next to each other. But we would not want NIS0257 to be
highlighted because they are.
Currently
Ideally, this is what we want to see...
Expected
Any ideas on this could be achieved using conditional formatting?
Note: I have directly posted this from a past post on the SuperUser Forum
(Link) as I am in need of this EXACT conditional formatting for the EXACT
same circumstances. I do not take credit for the construction of this post, but
only hope to obtain an answer for a question that previously went unanswered.
Answer
Use this formula:
=NOT(AND(A2=OFFSET(A2,COUNTIF($A2:$A$82,A2)-1,0),A2=OFFSET(
(COUNTIF($A$2:$A2,A2)-1),0)))
If changing the range then make sure to pay attention to what is marked as
absolute and relative.
Topic 1066
Subject
Excel VBA - Assigning range to variant using .cells property error,
Question

I've the following code extract below,
Dim profileRange as Variant
profileRange = ActiveWorkbook.Worksheets("Scenario").Range(Cells(1, "C"),
Cells(5, "C"))
Then I get the following in the watch expression
Watch Expression: profileRange
Value: Empty
Type: Variant/Empty
It's supposed to get the numbers assigned in that sheet..which goes form 1 to 5
Also, I get this when running the code
Error 1004:
Application or Object defined error
Can someone please help?
Answer
Change
profileRange = ActiveWorkbook.Worksheets("Scenario").Range(Cells(1, "C"),
Cells(5, "C"))
to this:
With ActiveWorkbook.Worksheets("Scenario")
profileRange = .Range(.Cells(1, "C"), .Cells(5, "C")) End with
Cells() are range object and need to have parentage assigned. Without dictating
parentage it is trying to use the active sheet, so the range parentage does not
equate to the cells parentage.
By using the With block with the . allows consistent parentage throughout.

Topic 1067
Subject
Calculate UTC time difference in Excel
Question
Can any one provide an Excel equation that will compute the difference
between two UTC timestamps.
The UTC time stamps have the format yyyymmddhhmmssZ (e.g
20160127175049Z). The difference between time stamps is at most few hours
so, I will like the answer to be in minutes or hours.
Appreciate any guidance. Thanks
Answer
To change the time stamps into a date/time that excel can use, use this formula:
=DATE(LEFT(A1,4),MID(A1,5,2),MID(A1,7,2)) +
TIME(MID(A1,9,2),MID(A1,11,2),MID(A1,13,2))
Then format it with a custom format of your desire.
Then it is just a matter of subtracting one from the other.
Then formatting it like [hh]:mm:ss
Topic 1068
Subject
Excel - I need help to reduce redundancy of SUMIFS with date and keyword
match
Question
I am trying to gather the total cost of goods sold on various items as the
products are sold, and grouping them by month to update a spreadsheet.
The SUMIFS formula I am using is extremely repetitive, due to the date
constrictions, and I know there has to be an easier and cleaner way to produce
the same results.

The formula I am currently using:
=SUM((SUMIFS($B:$B,$A:$A,">="&DATE(2016,1,1),$A:$A,"
<="&DATE(2016,1,31),$C:$C,"Apple")*0.5)+
(SUMIFS($B:$B,$A:$A,">="&DATE(2016,1,1),$A:$A,"
<="&DATE(2016,1,31),$C:$C,"Banana")*0.75)+
(SUMIFS($B:$B,$A:$A,">="&DATE(2016,1,1),$A:$A,"
<="&DATE(2016,1,31),$C:$C,"Orange")*1.25))
Thank you in advance!
Answer
You could use an array formula. Enter the following formula and hit. CTRL +
SHIFT + ENTER:
=SUM(SUMIFS($B:$B,$A:$A,">="&DATE(2016,1,1),$A:$A,"
<="&DATE(2016,1,31),$C:$C,{"Apple","Banana","Orange"})*
{0.5,0.75,1.25})
Topic 1069
Subject
Set minimum value on chart axis using VBA
Question
Can you help me with this? I want to generate a minimum axis value for my
chart based on a cell reference.
Here is my code.
Private Sub Worksheet_calculate()
With ActiveChart.Axes(xlValue)
.MinimumScale = Worksheets("Chart Data").Range("E111").Value End With
End Sub
Answer
I'd do it this way:

Private Sub Worksheet_calculate()
Dim cht As Chart
Set cht = Worksheets("Chart").ChartObjects("Chart 1").Chart
cht.Axes(xlValue).MinimumScale = Worksheets("Chart
Data").Range("E111").Value End Sub
Set up a reference to your chart object so you don't need ActiveChart
You may need to update ChartObjects("Chart 1") with the name of your chart
You can also index it so if you only have one chart on the page you can use
ChartObjects(1)
Topic 1070
Subject
Remove Links on Excel after rendered from table2excel.js
Question
Good day,
I am using table2excel.js to export my table into an excel file its working fine
except that it still render links from the table..
my table
<table id='dataTable'>
<tr>
<td><a href="#">Item 1</a></td>
<td>item 1 description</td>
<td>item 1 price</td>
<td>item 1 total</td>
</tr>
</table>
$('#table2xcel').click(function(){
$("#dataTable").table2excel({
exclude: ".xpage",

name: "Worksheet Name",
filename: "{{$excel_title}}"
});
});
Is there anyway I can convert an <a href="#">Item 1</a> into a regular text on
excel? Any Suggestion/Answers are much appreciated.. thank you.. Answer
I think this should do the trick:
var x = $("#dataTable").clone();
$(x).find("tr td a").replaceWith(function(){ return $.text([this]);
});
Just add this before you do the $("#dataTable").table2excel() function, but this
case, it would be changed to $(x).table2excel(). It will replace the links with
text.
Hope it helps
Topic 1071
Subject
Bucketing results in aging buckets in SQL Server 2014
Question
This is a two part question.
First, I'm an Excel user and just gained SQL Server access in hopes of
automating some of my reports. I understand how to select the columns I need,
however I need to use some of these columns to create new columns based on
my specifications. I am going to provide the if statements I currently use in my
Excel version.
1st - I need a column with this...
=IF(O4="Opened",NETWORKDAYS(L4,$AM$4,Holidays!$A:$A),"")
So if O4 = "opened" I use the networkdays formula to determine how many
days it's been open. Struggling to figure out how to do this in SQL Server

2nd - In another column, I need to bucket out the result of the above based on
the below criteria. This is my Excel formula:
=IF(AF4<=6,"0-5 Days",IF(AF4<=11,"6-10 Days", IF(AF4<=16,"11-15
Days",
IF(AF4<=21,"16-20 Days",
IF(AF4<=26,"21-25 Days",
IF(AF4<=31,"26-30 Days",
IF(AF4<=36,"31-35 Days",
IF(AF4<=41,"36-40 Days",
IF(AF4<=46,"41-45 Days",
IF(AF4<=51,"46-50 Days",
IF(AF4<=56,"51-55 Days",
IF(AF4<=61,"56-60 Days",
IF(AF4<=66,"61-65 Days",IF(AF4<=71,"66-70 Days","71+
Days"))))))))))))))
Struggling to figure out how to do this in SQL Server.
I would really appreciate any help you can offer. Someone sent me an example
of a query they have using a "case" function but it either won't work in my
situation or I am just having an issue deciphering the function.
I use SQL Server 2014
Answer
Im not sure what does the first one. Dont know what is NETWORKDAYS
Second one you use a CASE expresion
SELECT CASE 
        WHEN `AF4` <= 6  THEN "0-5 Days" 
        WHEN `AF4` <= 11 THEN "6-10 Days" 
        WHEN `AF4` <= 16 THEN "11-15 Days" 
        WHEN `AF4` <= 21 THEN "16-20 Days" 
        WHEN `AF4` <= 26 THEN "21-25 Days" 
        WHEN `AF4` <= 31 THEN "26-30 Days" 
        WHEN `AF4` <= 36 THEN "31-35 Days" 

        WHEN `AF4` <= 41 THEN "36-40 Days" 
        WHEN `AF4` <= 46 THEN "41-45 Days" 
        WHEN `AF4` <= 51 THEN "46-50 Days" 
        WHEN `AF4` <= 56 THEN "51-55 Days" 
        WHEN `AF4` <= 61 THEN "56-60 Days" 
        WHEN `AF4` <= 66 THEN "61-65 Days" 
        WHEN `AF4` <= 71 THEN "66-70 Days" 
        ELSE "71+ Days" 
    END as `AF4` 
Topic 1072
Subject
What does “xlSheetHidden” represent? Is it a function?
Question
I encountered the following code:
Sub HideSheets()
Dim Sht As Worksheet
For Each Sht In ActiveWorkbook.Worksheets 
      If Sht.Name <> ActiveSheet.Name Then 
          Sht.Visible = xlSheetHidden 
      End If 
Next Sht
End Sub
What it does is to use a loop to hide all worksheets in the active workbook,
except the active sheet. What is xlSheetHidden and why is it not defined?
Answer
Its an enumeration. Normally something like this would be True or False, but
here we have three possibilities, including xlSheetVeryHidden
Topic 1073
Subject
Adding object images into Excel using EPPlus

Question
I want to add an image to excel object. I added a picture on and now I want to
add the object image to the image when I click on it in excel, it will zoom up to
me. like this
enter image description here
and here is my code:
private void AddImage(ExcelWorksheet oSheet, int rowIndex, int colIndex,
string imagePath)
{ 
      Image logo = Image.FromFile(imagePath); 
      ExcelPicture excelImage = null; 
      if (logo != null) 
      { 
          excelImage = oSheet.Drawings.AddPicture("", logo); 
          excelImage.From.Column = colIndex; 
          excelImage.From.Row = rowIndex; 
          excelImage.SetSize(100, 100); 
          // 2x2 px space for better alignment 
          excelImage.From.ColumnOff = Pixel2MTU(2); 
          excelImage.From.RowOff = Pixel2MTU(2); 
      } 
}
public int Pixel2MTU(int pixels)
{ 
      int mtus = pixels * 9525; 
      return mtus; 
}
Thanks.
I desired result is like this

enter image description here
Topic 1074
Subject
Sum the product of every 2 cells in a row (sum of A1B1, C1D1, E1*F1…to
end) in Google Sheets
Question
I want to find the average share price in B4 based on the table of shares
purchased and price seen to the right. Each meeting we will buy a few shares
at different prices. I need a formula for B4;B8 that will basically do the
function =sum(e4f4,g4h4,i4*j4...to end)/c4. Obviously I can do it manually
with the given formula but I was hoping there would be an easier way to
update the average share price when the # of new shares bought and the
purchased price are entered after future meetings. Any idea if/how this can be
done? Answer
With data in the first row only, in A2 enter:
=IF(ISEVEN(COLUMN()),0,INDEX($1:$1,1,COLUMN())*INDEX($1:$1,1,C
and copy across until data ends in the top row.
Then use:
=SUM(2:2)
Answer
In B4 use,
=sumproduct((D4:I4)*(E4:J4)*mod(column(D:I), 2))/C4
Fill or copy down.
   
Topic 1075
Subject

Excel issue using datedif function
Question
I have a homework assignment that is to calculate the number of days between
dates. It is a simple problem; however the format of the dates in column D are
causing issue because of the date function. I am using DATEDIF but I am
getting a name error. D is formatted as such =DATE(16,1,6), the E is
=TODAY() and the datedif is =DATEDIF(D8,E3,D). Please help. =E3-D8
returns the serial 36548. Answer
You should use:
=DATEDIF(D8,E3,"D")
Otherwise the D is not a Defined Name.
Answer
You're getting the correct value. The number of days between January 6, 1916
(=DATE(16, 1, 6)) and January 29, 2016 (=TODAY()) is 36,548 days.Your
subtraction using =E3-D8 is returning the correct value.
You can do a rough approximation yourself:
365.25 days per year
x 100 years
36,525 days
Topic 1076
Subject
Multiple Cell Find and Replace
Question 
A               B                           C 
VitaPisastian   ヴィタピサスティアン             "assign":
"190140000", 
VoltHowitzer    ヴォルトハウザー               "jp_text": "ヴィタピサスティ

アン", 
Zamlegd         ザムレグド                    "en_text": "", 
Zamlegda        ザムレグダー                  "jp_explain": "", 
Zamlegdia       ザムレグディア                 "en_explain": "" 
So I have this (small) part of the data within my excel sheet. Columns A and B
are supposed to be the reference point for replacing strings. Whenever part of
the text in jp_text column C matches a string in column B, then the related
Column A entry is written to en_text.
Which would look like this
C
"assign": "190140000",
"jp_text": "ヴィタピサスティアン", "en_text": "VitaPisastian",
"jp_explain": "",
"en_explain": ""
I know I can do multiple find and replace using a module, but not sure how to
have it change a different cell versus the string found.
Topic 1077
Subject
What is the correct VBA syntax for Refresh method of QueryTables object?
Question
This Excel for Mac code downloads a table of stock data from Yahoo and
inserts it into a worksheet labeled "DataSheet". It gets the ticker, start and end
date from the worksheet "QuerySheet".
This code fails on the .Refresh method of the QueryTable object and I do not
understand why. What is the correct syntax?
Sub data_get()
Dim ticker As String, sday, smonth, syear, eday, emonth, eyear As Long Dim
QuerySheet As Worksheet
Dim DataSheet As Worksheet

Set QuerySheet = ActiveWorkbook.Sheets("QuerySheet") Set DataSheet =
ActiveWorkbook.Sheets("DataSheet")
DataSheet.Columns("A:G").ClearContents
With QuerySheet
ticker = Range("A2")
sday = Day(Range("G2"))
smonth = Month(Range("G2"))
syear = Year(Range("G2"))
eday = Day(Range("H2"))
emonth = Month(Range("H2"))
eyear = Year(Range("H2"))
End With
With DataSheet.QueryTables.Add(Connection:= _
"TEXT;http://real-chart.finance.yahoo.com/table.csv?s=" & ticker & "&d=" &
emonth & "&e=" & eday & "&f=" & eyear & "&g=d&a=" & smonth & "&b="
& sday & "&c=" & syear & "&ignore=.csv" _ ,
Destination:=DataSheet.Range("$A$1")) .Name = "table1"
.FieldNames = True
.RowNumbers = False
.FillAdjacentFormulas = False
'.PreserveFormatting = True
.RefreshOnFileOpen = False
.RefreshStyle = xlInsertDeleteCells .SavePassword = False
.SaveData = True
.AdjustColumnWidth = True
'.RefreshPeriod = 0
.TextFilePromptOnRefresh = False
'.TextFilePlatform = 437
.TextFileStartRow = 1
.TextFileParseType = xlDelimited

.TextFileTextQualifier = xlTextQualifierDoubleQuote
.TextFileConsecutiveDelimiter = True .TextFileTabDelimiter = True
.TextFileSemicolonDelimiter = False .TextFileCommaDelimiter = True
.TextFileSpaceDelimiter = False
.TextFileColumnDataTypes = Array(5, 1, 1, 1, 1, 1, 1)
'.TextFileTrailingMinusNumbers = True '.BackgroundQuery = True
.Refresh BackgroundQuery:=False <---- 1004 Error '.Refresh
BackgroundQuery:=True
End With
End Sub
Topic 1078
Subject
Return cell of corresponding cells in another sheet
Question
If I have the following raw data in 2 sheets; Sheet 1 has first names only. Sheet
2 contains first and last name initial.
Sheet1 - Raw Data:
COL1 COL2
Sam ID123
John ID456
Kim ID567
Sheet2 - Raw Data:
COL1 COL2 COL3
Jess B ID555 Return1
Frank A ID111 Return2
John L ID456 Return3
Sam F ID123 Return4
Dave A ID888 Return5
Kim J ID567 Return6
How can I return the following data? Grabbing the corresponding ReturnX, and

First name + last name initial only when Sheet1:COL2 matches and is present
in Sheet2:COL2
Sheet 3 - What I want to return:
COL1 COL2
Sam F Return4
John L Return3
Kim J Return6
Answer
Set your columns on sheet 2 to a named range. For my example: Name, ID, and
Return. Then enter the following formula in Sheet 3 cell A1 and drag it down
the column as far as you need:
=IFERROR(INDEX(Name,MATCH(Sheet1!B1,ID,0)),"")
... and enter this formula in cell B1 and drag it down:
=IFERROR(INDEX(Return,MATCH(Sheet1!B1,ID,0)),"")
Answer
table2Range : reference to cells underneath COL1 in sheet 2
table1Range : reference to cells underneath COL1 in sheet 2
header2Range : reference to cell with COL1 in sheet 2
inputRange : reference to cell containing input
We'll get it with an
IF( NOT(ISERROR(MATCH(inputRange,table1Range,0)),
IFERROR(OFFFSET(header2Range,MATCH(inputRange,table2Range,0),2),""
,"")
Topic 1079
Subject
How to read a excel CSV file (comma separated value) in Java Eclipse?

Question
The objective: Create an object oriented Graphical Java Application that
program that will: Read a CSV ( comma separated value) file that consists of
student names (first name, lastname), IDs and initial marks for content and
delivery (use -1 values for un-evaluated students.
This is my Code that I have but when I click on the Select File.. It says
"Expected firstName, lastName, ID, Content and Delivery" when it really
should open the file and read the data. But for somehow its not working. enter
image description here
Below is a my code:
private class ChooseFileListener implements ActionListener {
public void actionPerformed(ActionEvent event) { Section<Student> section;
JFileChooser fileChooser = new JFileChooser(); FileNameExtensionFilter
filter = new FileNameExtensionFilter(
"CSV file", "csv"); fileChooser.setFileFilter(filter);
int returnValue = fileChooser.showOpenDialog(null); if (returnValue ==
JFileChooser.APPROVE_OPTION) { File selectedFile =
fileChooser.getSelectedFile(); if (selectedFile != null) { 
    section = createNewSection(selectedFile); 
    loadStudents(section, selectedFile); 
    System.out.print(selectedFile); 
}
}
}
}
public void RandomStudent(){
ArrayList<Student> students = new ArrayList<>(); max = (students.size()-1);
int x = (int) Math.random()* students.size(); System.out.println(x);
}

private Section<Student> createNewSection(File selectedFile) { String
filename = selectedFile.getName(); Section<Student> section = new
Section<Student>(filename); return section;
}
private void loadStudents(Section<Student> section, File selectedFile) {
Scanner in;
int MAX_COMMAS = 5;
try {
in = new Scanner(selectedFile);
String line = "";
String[] studentData;
in.nextLine();
while (in.hasNext()) {
line = in.nextLine();
studentData = line.split(",");
if (studentData.length == MAX_COMMAS) { 
    section.addStudent(new
Student(studentData[0],studentData[1], 
                                  
Integer.valueOf(studentData[2]), 
                                  
Integer.valueOf(studentData[3]), 
                                  
Integer.valueOf(studentData[4]))); 
  } else { 
    throw new Exception( 
                        "Invalid file format. \nExcepted:
firstname, lastname, id, content, delivery"); 
}
}
} catch (Exception e) {
JOptionPane.showMessageDialog(null, e.getMessage()); }
}
}
I nOW HAVE created another class Nameed Section:

package patel.Jainam;
import java.util.ArrayList;
public class Section {
private String data;
private String FirstName;
private String LastName;
private int studentID;
private int ContentMark;
private int DeliveryMark;
private ArrayList<Student> students = new ArrayList<>();
public void FileData(String First, String Last, int ID, int Content, int Delivery)
{ 
    this.FirstName = First; 
    this.LastName = Last; 
    this.studentID = ID; 
    this.ContentMark = Content; 
    this.DeliveryMark = Delivery; 
   } 
public String setFirst(String First){
return First;
}
public String setLast (String Last){
return Last;
}
public int setstudentID (int ID) {
return ID;
}
public int setContentMark (int Content) {

return Content;
}
public int setDeliveryMark (int Delivery) {
return Delivery;
}
public Section(String data) {
this.data = data;
}
public void addStudent(Student student) { students.add(student);
}
}
Answer
The problem is that you check for MAX_COMMAS, but ou are checking this
against the number of fields. This value will always be 5 for a correctly
formatted file. So, you are ensuring to get to the else part of your code and
always throw.
What you would want to express like is:
if (studentData.length != MAX_COMMAS)
Topic 1080
Subject
Expand powerpoint data select on linked charts in excel
Question
I have a question related to updating linked data from excel in powerpoint.
I'm currently updating about 50 trend line charts on a daily basis. Each day, for
each chart, I add a new row of data and then build a new chart that includes all
the previous data plus the new day's data.
I've properly linked the data from excel into powerpoint, but I don't know how
to have powerpoint automatically expand the data select in excel. To update the

charts, I have to go into powerpoint, right click on the chart, edit data in excel
then expand the data select to include the new day's data. Instead of doing this,
I would prefer to have powerpoint automatically recognize the new row of
data and incorporate that in the chart.
I've tried updating the data select in excel to include the new day, but when I go
into powerpoint, it doesn't add the new data. I'm assuming my powerpoint chart
is linked to the excel data but not any chart in excel so there's no way for excel
to communicate this change to powerpoint.
Is there a way to get around this? It would save me lots of time if I could just
expand the chart in excel and have it update in powerpoint. Even better would
be if excel could automatically update to include the new data, and I don't have
to do anything other than enter the data in excel. (Maybe a script or something?
I'm don't really know VBA and the like but can learn.)
Topic 1081
Subject
Issue - Importing a csv file to Mysql Workbench
Question
I'm trying to import a csv file called movimi.csv that has 37781 records, but
when i do the query to import on mysql workbench, it only imports 663 lines.
And it doesn't show any error. On the output says:
"662 row(s) affected
Records: 37781 Deleted: 0 Skipped: 37119 Warnings: 0"
And the query is:
LOAD DATA LOCAL INFILE 'D:\\JcVelez_Workspace\\Jorge\\MOVIMI.csv'
INTO TABLE empresa.movimi
FIELDS TERMINATED BY ';' ENCLOSED BY '"' LINES TERMINATED BY
'\r\n'
Any solution to this?

pd: sorry for my english =)
Answer
Solved
The issue was that my table has the column "codigo" as primary key, so, when
you use load data local infile, it ignores the duplicate data.
Just, i didn't use primary key and it works.
Topic 1082
Subject
How to disable 'save' option in Excel but 'save as' should be still working
Question
I need to disable the save option in Excel but I still need the save as option to
be working... So I know how to disable both of the option by this VBA:
Private Sub Workbook_BeforeSave(ByVal SaveUI As Boolean, Cancel As
Boolean)
MsgBox "You can't save this workbook!" Cancel = True
End Sub
But How is it possible to disable save but save us to be working still. Thank
you for helping me
Answer
Try
Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As
Boolean) If SaveAsUI = False Then
MsgBox "You can't save this workbook!" Cancel = True
End If
End Sub
EDIT
To delete the code from ThisWorkbook Class Module (delete every thing) we

can use this code:
Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As
Boolean)
If SaveAsUI = False Then
MsgBox "You can't save this workbook!" Cancel = True
Else
With
ThisWorkbook.VBProject.VBComponents("ThisWorkbook").CodeModule
.DeleteLines 1, .CountOfLines
End With
End If
End Sub
NOTE
This will delete everything in ThisWorkbook Class Module not only
Workbook_BeforeSave We must allow Trust access to the VBA project object
model (File > Options > click Trust Center, click Trust Center Settings, and
then click Macro Settings).
Topic 1083
Subject
Excel file (BASE64) in UIWebView
Question
I try to open Excel file in UIWebView from base64 string
This is my code:
(void)viewDidLoad { [super viewDidLoad]; NSData *excelData =
[[NSData alloc] initWithBase64EncodedString:self.base64 options:0];
NSString *path = [self writeDataToDocuments:excelData
withFilename:@"excel.xls"]; [self.webView loadRequest:
[NSURLRequest requestWithURL:[NSURL fileURLWithPath:path]]]; }

(NSString *)writeDataToDocuments:(NSData *)data withFilename:
(NSString *)filename{ NSString *docsPath =
[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,
NSUserDomainMask, YES) firstObject]; NSString *filePath = [[NSString
alloc] initWithString: [docsPath
stringByAppendingPathComponent:filename]]; [data writeToFile:filePath
atomically:YES]; return filePath; }
But in UIWebView i get error: Unable to read document Can you suggest me
any decision? (XLS file is absolutely correct, i checked it) Answer
The problem was in .xlsX, server returns me .xlsX file (not .xls) UIWebView,
probably, can't work with this .xlsX file
Topic 1084
Subject
Variable for Excel Columns. Column Assigned to Variable
Question
I have a macro that inserts 2 columns on my current sheet and pastes
information from another sheet.
I want to create 2 variables that are assigned to each column that would change
the next time I run the macro to paste the information in the next two columns.
Columns("BO:BO").Select
Selection.Insert Shift:=xlToRight
Range("BO2").Select
ActiveCell.FormulaR1C1 = "Feb weekly-wk 2" Range("BO19").Select
ActiveCell.FormulaR1C1 = _
"=VLOOKUP(Comparison!RC2,'Jan16 wk4'!R3C15:R34C24,9,FALSE)"
Range("BO19").Select
Selection.AutoFill Destination:=Range("BO19:BO47"), Type:=xlFillDefault
Range("BO19:BO47").Select

Columns("BP:BP").Select
Selection.Insert Shift:=xlToRight
Range("BP2").Select
Selection.Style = "20% - Accent6"
Range("BP2").Select
ActiveCell.FormulaR1C1 = "Diff"
Range("BP19").Select
ActiveCell.FormulaR1C1 = "=RC[-2]-RC[-1]"
My idea is to set up a variable that I would replace my current "BO" and "BP"
code with.
Dim X as String, Y as String
X = "BO"
y = "BP"
When I run the macro it would change the variable for this example "BO" to
"BQ" and "BP" to "BR". Next time I run the macro would change the "BQ" to
"BS" and "BR" to "BT". Answer
If you are not actually writing BO/BP to the range you are transforming I would
go with two ints, stored in a hidden sheet. Read/write each time you run the
macro.
This is, in my opinion, the easier solution, other places to go would be global
variables or storing it to a file.
Answer
I just cleaned your code a little:
Dim ColBO As Integer
Dim ColBP As Integer
Dim StrBO As String
Dim StrBP As String

StrBO = "BO"
StrBP = "BP"
ColBO = ActiveWorkbook.Range(StrBO & 1).Column 'instead of StrBO you
could directly write ("BO" & 1) ColBP = ActiveWorkbook.Range(StrBP &
1).Column 'Then you wouldnt need these two variables
Columns(ColBO).Insert Shift:=xlToRight
'Columns(ColBO).Select ' Trying to avoid selection but not sure if this works
here... 'Selection.Insert Shift:=xlToRight
Range(1, ColBO).FormulaR1C1 = "Feb weekly-wk 2" Range(19,
ColBO).FormulaR1C1 = "=VLOOKUP(Comparison!RC2,'Jan16
wk4'!R3C15:R34C24,9,FALSE)" Range(19, ColBO).AutoFill
Destination:=Range("BO19:BO47"), Type:=xlFillDefault
Columns(ColBP).Insert Shift:=xlToRight 'Same here as above Range(2,
ColBP).Style = "20% - Accent6" Range(2, ColBP).FormulaR1C1 = "Diff"
Range(19, ColBP).FormulaR1C1 = "=RC[-2]-RC[-1]"
For the future: If you can, try to avoid .Select/Selection/.Activate if possible.
The code can mostly run without such commands and without activating a cell.
;)
Answer
If you want to use numeric variables you can change approach and use Cells
instead of Range:
'You can use the rows below to know the column number
Range("BO1").Activate
ActiveCell.Value = ActiveCell.Column 'This way you get the column number
into the cell ColNum = ActiveCell.Column 'This way you get the column
number into the variable 'So now you know that BO column number is 67 and
you can use Cells(1, 67) = "OK"
'Or, using variables:
RowNum = 1
ColNum = 67

Cells(RowNum, ColNum) = "You Got It!"
This makes you able to loop columns simply using a for ... next If you need to
loop from BO to BR you can use
For ColNum = 67 To 70
Cells(1, ColNum) = "OK"
Next ColNum
Hope it helps.
Topic 1085
Subject
How to get around using a wildcard in Conditional formatting
Question
I tried using a wild card and after searching the web it seemed like it wasn't
possible.
I am trying to look in cell b2 and if the letter "a" appears anywhere in it AND
either C2 or D2 are filled with anything then b2 will turn red.
This is the formula i was trying to use and it obviously does not work.
=AND(B2="a",OR(C2<>"",D2<>""))
Answer
Use the Find() Function:
=AND(ISNUMBER(FIND("a",b2)),OR(C2<>"",D2<>""))
That is Case specific.
If you want it not to be case specific then use the SEARCH() Function.
=AND(ISNUMBER(SEARCH("a",b2)),OR(C2<>"",D2<>""))
Topic 1086

Subject
How I can read a sheet of Excel from SQL Server 2008 R2?
Question
Please need to help for this problem that I have. I need to read a sheet of Excel
2007 from SQL Server 2008 R2. I want to read this data what contains data
and store in a temporal table. But right now I am having problems with read
Excel because it shows me an error from SQL Server. What I need for reading
it
Error: Not registered the OLE DB provider "Microsoft.ACE.OLEDB.12.0"
I hope you can help me with it problem, please.
I have executed it. Maybe I am missing something. My operating system is
Windows 7 64bit
Code
SELECT *
INTO TB_EXAMPLE
FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0', 'Excel 12.0;
Database=C:\Microsoft\Test.xls; HDR=YES; IMEX=1', 'SELECT * FROM
[Plan1$]') GO
Thanks in advance.
Answer
You will need to install the Office System Driver: Data Connectivity
Components
https://www.microsoft.com/en-us/download/confirmation.aspx?id=23734
This will register the OLE DB provider "Microsoft.ACE.OLEDB.12.0"
Topic 1087
Subject
Conditional Formating Cell Attributes - Fill Color and Opaqueness

Question
I´m looking for code syntax that sets the cells color fill opaqueness (lighter or
darker) depending on conditions being met or not. The following code goes to
the last row of data and works upward toward the first row.
It focuses on a price column and sets a color (black) if the current price is
greater than the previous price and sets another color (red) if the current price
is lower than the previous price.
In addition, how does one specify colors that are not color constants?
code snippet:
'Loop through a recordset from the bottom up and determine 'if current row cell
value is greater than the previous one 'recordset sort is descending date (most
current date at top) 'go to oldest date and work up until most current date
Public Sub testing()
Dim ws As Worksheet
Dim endRow As Integer
Dim i As Integer
Dim thisRow As Integer
Dim nextRow As Integer
Dim pastRow As Integer
Set ws = ThisWorkbook.Worksheets("DataSheet") endRow = ws.Range("A" &
Rows.Count).End(xlUp).Row 'go to last row and work up
i = endRow
While i >= 1
'Working up the sheet doing whatever 
      thisRow = i          'the current row or date under
consideration 
      nextRow = i - 1      'the row above (next day) -
working up 
      pastRow = i + 1      'the row below (previous day) 
If pastRow < endRow Then     'skip the last row of data, start

at 2nd to last 
If nextRow > 0 Then 'as long as there is a tomorrow lets work with today 
      'If current day´s value is greater than previous day, 
      'color current day cell (black), else color (Blue) 
      If Cells(i, 2).Value > Cells(pastRow, 2).Value Then 
          Range(Cells(i, 8), Cells(i, 8)).Interior.Color _ 
               = ColorConstants.vbBlack 
          'looking for code to set color intensity (lighter
or darker) 
          'also how to define a color other than a color
constant 
      Else 
          Range(Cells(i, 8), Cells(i, 8)).Interior.Color _ 
               = ColorConstants.vbRed 
      End If 
End If
End If
i = i - 1
Wend
End Sub
Cheers !!
Answer
I do not have a Mac so cannot post a true answer, but in case you are stuck I
just wanted to try to help out with what I would do in your shoes :
there is such a thing as "conditional formatting" in Excel that enables you to
either write simple conditions or more intricate conditions that use formulas
(these could call VBA functions). With these, selecting the format is then done
through the GUI. This, to me, would be the obvious and easy way to do
conditional formatting (instead of VBA). as for custom colors, you have to do

that by specifying a custom palette, see for example How to change the color
palette for workbooks in Excel
Hope this helps,
Tepp
Topic 1088
Subject
Assign module function to ActiveX command button DIRECTLY
Question
In VBA for Excel, how do I assign an existing function or sub, say myFun(), in
a module to a newly added ActiveX click button directly?
I understand I can do the following on the worksheet code page where the
ActiveX command (click) button is located.
Private Sub myFun_Click()
myFun()
End Sub
By "directly" I mean naming the button "myFun" and point the button directly to
the function myFun() with having to placing myFun() in another sub as shown
above. Answer
There are 2 types of controls you can place on a worksheet:
ActiveX controls
You handle their Click event in the code-behind, by double-clicking the control
and generating a handler for it. Form controls
You assign a macro to these controls, exactly like you would assign a macro to
any other shape. The macro can be an existing one (any parameterless Public
Sub procedure in a non-private standard module).
If you want to assign a button to MyFun, assuming the signature looks like this:

Public Sub MyFun()
Then you can try using a form control instead of an ActiveX control.
Note: MyFun() has to be a Sub to be exposed as a Macro. A 'Sub' is a
procedure, not a function. A 'Function' has a return value, a 'Sub' doesn't. A
'Function in a standard code module (.bas) can be exposed to be used in
worksheet formulas as a UDF, a 'Sub' in a standard code module (.bas) can be
exposed to be used as a macro.
Answer
VBA events bound to control are "local" to the worksheet by defintion,
therefore if you put button "A" on a worksheet "w1" the resulting click event
handler function will be named:
Private Sub A_Click()
But if you put button "A" on worksheet "w2" the click event handler signature
will be the same but actually trigger the click event of the button placed on
"w2".
If you want to implement the same behavior when the user clicks on button "A"
from different worksheets, then you need to do this by adding a Sub/Function
on a VBA Module, which is shared among all the worksheets of the workbook
object.
Private Sub A_Click() {
CommonFunction()
}
Topic 1089
Subject
Formatting a cell as Text using the axlsx spreadsheet ruby gem with inital
empty values
Question
I'm using the axlsx ruby gem to create Excel-compatible .xlsx files. How can I

define a column as a string, if there is no initial content?
I am aware of the question Formatting a cell as Text using the axlsx
spreadsheet ruby gem? but I have special problem.
My example code:
require 'axlsx'
filename = 'test.xlsx'
Axlsx::Package.new do |p|
styles = p.workbook.styles
p.workbook.add_worksheet(:name => "Test") do |sheet| 
    sheet.add_row([ 'a', 'b', 'c', 'd'], :types =>
[:string,:string,:string,:string]) 
    sheet.add_row([ 1,2,3,4], :types =>
[:string,:string,:string,:string]) 
    sheet.add_row([ nil, nil, nil,nil], :types =>
[:string,:string,:string,:string]) 
    sheet.add_row([ 'a', 'b', 'c', 'd'], :types =>
[:string,:string,:string,:string]) 
end
p.serialize(filename)
end
This generates me an excel as:
The numbers 1..4 are formated as strings (as requested). But the row 3 (with
no content) is not defined as a string.
If I add a 1 I get the number 1:
If I define the cell format text in Excel like this (German Excel, but it should be
the same in English):
and I insert then a 2, the 2 is formatted as a text:

How can I achieve this logic aready with axlsx? I already tried * insert an
empty string instead of the nil - no effect * insert a "'" - this shows the ' but
does not modify the cell type. * made experiments with styles
My Use case:
I create a xlxs-file and one (empty) column should be filled by the reader. This
new data should be a string and there should be no interpretation as a date.
Topic 1090
Subject
copy all workbook sheets to a new workbook VBA
Question
I am using this code to copy every sheet in a workbook to a new one and it
works fine but it reverses the order of the sheets, would there be anyway to
keep it from doing this?
Sub copy()
'copies all the sheets of the open workbook to a new one Dim thisWb As
Workbook, wbTemp As Workbook Dim ws As Worksheet
On Error GoTo Whoa
Application.DisplayAlerts = False
Set thisWb = ThisWorkbook
Set wbTemp = Workbooks.Add
On Error Resume Next
For Each ws In wbTemp.Worksheets
ws.Delete
Next
On Error GoTo 0
For Each ws In thisWb.Sheets
ws.copy After:=wbTemp.Sheets(1)

Next
wbTemp.Sheets(1).Delete
'save vba code here
Application.Dialogs(xlDialogSaveAs).Show Range("CA1").Text & "-
(Submittal) " & Format(Date, "mm-dd-yy") & "_" & Format(Time, "hhmm") &
".xlsx"
LetsContinue
Application.DisplayAlerts = True Exit Sub
Whoa
MsgBox Err.Description Resume LetsContinue
End Sub
I'm copying all the sheets so i can save it as a different file extension and this
was the only way i found that worked.
Workbook before it copies
Workbook after it copies
Answer
If you only want to change the file format
(I'm copying all the sheets so i can save it as a different file extension and this
was the only way i found that worked.)
Then you can try this code:
Sub Test()
fn = Range("CA1").Text & "- (Submittal) " & Format(Now, "mm-dd-
yy_hhmm") fileSaveName =
Application.GetSaveAsFilename(InitialFileName:=fn, fileFilter:="Excel
Workbook (*.xlsx), *.xlsx") If fileSaveName <> False Then 
   Application.DisplayAlerts = False 
   ActiveWorkbook.SaveAs fileSaveName, xlOpenXMLWorkbook 

   Application.DisplayAlerts = True 
End If
End Sub
Topic 1091
Subject
Ms Excel Replace value with the average of the previous and next values
Question
I'm working with hourly weather data in Excel that has each hour of every day
of the year along with the corresponding temperature value that was recorded.
Some of the values weren't recorded, and instead show up as just an "M" on
the spreadsheet. For example, A32 = 28, A33 = M, A34 = 30. I want to
replace that "M" with a formula to take the average of the previous and next
values. I know how to do this manually, but I am having difficulty writing a
Macro to find all the M's in the spreadsheet, then auto-replace it as stated
above.
My main obstacle is getting excel to use the correct values when replacing the
"M".
Here is my code
Sub MReplace()
'
' MReplace Macro
'
'
ActiveCell.Select
Cells.Find(What:="M", After:=ActiveCell, LookIn:=xlFormulas, LookAt:= _
xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, MatchCase:=False
_ , SearchFormat:=False).Activate
Cells.FindNext(After:=ActiveCell).Activate ActiveCell.Offset(-8,
1).Range("A1").Select Cells.Find(What:="M", After:=ActiveCell,

LookIn:=xlFormulas, LookAt:= _
xlWhole, SearchOrder:=xlByRows, SearchDirection:=xlNext,
MatchCase:=True _ , SearchFormat:=False).Activate
Cells.FindNext(After:=ActiveCell).Activate ActiveCell.Replace What:="M",
Replacement:="[****This is what I am having difficulty with****]",
LookAt:=xlWhole, _
SearchOrder:=xlByRows, MatchCase:=True, SearchFormat:=False, _
ReplaceFormat:=False
Cells.Find(What:="M", After:=ActiveCell, LookIn:=xlFormulas, LookAt:= _
xlWhole, SearchOrder:=xlByRows, SearchDirection:=xlNext,
MatchCase:=True _ , SearchFormat:=False).Activate
End Sub
I have heard of something that you can put in to the code that can address the
selected cell. I think it's cell() but I am not sure. Maybe that is a way to get it to
work better? Answer
Try this code:
Sub MReplace()
Dim ws As Worksheet
Dim cel As Range
Dim firstAddress As String
Set ws = ActiveSheet
Set cel = ws.Range("A:A").Find("M")
If Not cel Is Nothing Then
firstAddress = cel.Address
Do 
      cel.Value = (cel.Offset(1) + cel.Offset( -1)) / 2 
      Set cel = ws.Range("A:A").FindNext(cel) 
      hr = False 

      If Not cel Is Nothing Then 
          If cel.Address <> firstAddress Then 
              hr = True 
          End If 
      End If 
Loop While hr
End If
End Sub
It loops through all the cells containing "M" and replaces it with the average of
the one on the right and the one on the left. It will error on any that are in the
first column as there is no column to the left.
Topic 1092
Subject
Excel Chart Titles - can I format parts of the title using cell reference such as
Sheet1!$A$1?
Question
I have a chart in Excel with the Title linked to a cell =REPORT_PAGE!$A$1
The formula in A1 looks like this:
=ProductName & ": Project Performance" & CHAR(10) & "SPI: " &
TEXT(VLOOKUP(TODAY(),ProjectData,13,TRUE),"0#.0#") & CHAR(10)
& "EV: " & TEXT(VLOOKUP(TODAY(),ProjectData,11,TRUE),"#.0#%") &
CHAR(10) & "PV: " &
TEXT(VLOOKUP(TODAY(),ProjectData,12,TRUE),"#.0#%")
This provides a Title which is all the same size; something like this:
BIG CHART TITLE
BIG METRIC 1
BIG METRIC 2
BIG METRIC 3
I need something that can change the title to look more like this:
BIG CHART TITLE

small-font metric 1
small-font metric 2
small-font metric 3
I would like to do this without VBA if possible. Answer
Check out Paste Picture Links
Create the title in 4 rows of cells
Format them as needed
Paste them as a picture link onto the chart where the title would go (do not use
the actual title object in the chart. Optional - Position the picture link where
you want and group it with the chart so they move in unison.
Topic 1093
Subject
Paste values does not work?
Question
I have a macro to automatically 'move over' 4 columns of data. It does this by
inserting 3 columns, then copying the data from the original 3 into the new 3.
The original values are derived from formulas, and I want to use the paste
values function to paste only the values without the formulas. Problem is it
keeps pasting the formulas.
The relevant section of my code is here:
Sheets("Month over Month").Select
Columns("B:E").Select
Range("B2").Activate
Selection.Copy
Columns("F:F").Select
Range("F2").Activate
Selection.Insert Shift:=xlToRight
Range("B3:C54").Select
Application.CutCopyMode = False
Selection.Copy
Range("F3").Select

Selection.PasteSpecial Paste:=xlPasteValuesAndNumberFormats, Operation:=
_
xlNone, SkipBlanks:=False, Transpose:=False
Weirdly enough the columns B and C paste as values, but column D does not (E
is blank). The formulas in each are:
B C D
1 =Summary!B2 =B3/$B$55 =SUM(B6:B9)
In the new columns, the contents of cell C are pasted as the formula.
Topic 1094
Subject
Add additions to a list by year
Question
I'm trying to count the number of new categories that I added to my inventory
each year. I'm currenty using countif(Range, ">0") and then subtracting the
results from previous years, but I'm having to offset this because sometimes I
because I have zero of that item in a subsequent year (e.g., Category 2, 2014).
Is there a way I can write a formula to count new categories added by year
easily?
2013 2014 2015
Category 1 1 4 0
Category 2 2 0 6
Category 3 0 5 1
Topic 1095
Subject
VBA Joining arrays as if they were relational database tables
Question
I have two arrays in my VBA code at the moment. They are structured very
much like a database table except they are horizontal, so the first three rows
(of 7) effectively determine the primary key within the array.

I'd like to perform OUTER and INNER join operations on them as if they were
database tables. That would allow me to easily compare values, check for
missing values, etc.
I could do this by iterating through one of them and matching it against the other
(and it would totally work), but I'm trying to find something that's more suited
to large bulk operations and less of an iterative process.
Is there perhaps an Intersect or Union operation that makes this possible?
Thanks.
Topic 1096
Subject
Excel INDEX formula cant find ranged reference or defined name
Question
To make long short story, this is my problem:
Topic 1097
Subject
How can I simplify this Google Sheets Sumif formula's criteria?
Question
I have a budgeting spreadsheet with various amounts due on various days. I
would like to have cells that total the amounts due each week. I already have
the forumlas to grab the dates, etc, but I'm stuck at how to elegantly grab the
weekly amounts. Right now, I'm just adding up SUMIFs for day([today])
through day([today]+6):
=sumif(F7:F46,day(D2),D7:D46)+sumif(F7:F46,day(D2+1),D7:D46)+sumif(F
It works, but it's ugly. I feel like I should be able to simplify that somehow, but
I'm at a loss as to how. For details, my D column has my amounts due, my F
column has the dates they're due, and cell D2 contains the date of the first
Friday in the month.
Thanks for any suggestions you can make!

Topic 1098
Subject
How to refer to an open workbook in VBA?
Question
Dim test As Range
Set test = Workbooks("MonthlyReport.xlsb").Worksheets("VC
Report").Range("C1")
VBA shows Error 9: Subscript out of range. Why is this? What is wrong with
it? The workbook MonthlyReport.xlsb is open. Answer
Your code works fine for me (Excel 2007 / Win 7). Check the spelling of the
workbook and worksheet. (especially matching spaces)
Topic 1099
Subject
firstName lastName to lastName, firstName in Excel spreadsheet
Question
I am trying to get an excel spreadsheet that has the names Jane Doe and John
Smith, go from that to Doe, Jane, and Smith, John.
I can only find ways to go from lastName, firstName to firstName lastName,
but none for the contrary.
Thank you.
Answer
For formulas use:
=MID(A1,FIND(" ",A1)+1,999) & ", " & LEFT(A1,FIND(" ",A1)-1)
Now to the next question: What if there are more than just the first and last
name?
Use this:

=MID(A1,FIND("}}}",SUBSTITUTE(A1," ","}}}",LEN(A1)-
LEN(SUBSTITUTE(A1," ",""))))+1,999) & ", " &
LEFT(A1,FIND("}}}",SUBSTITUTE(A1," ","}}}",LEN(A1)-
LEN(SUBSTITUTE(A1," ",""))))-1)
It will assume the last word is the last name.
Answer
Select only the cells you wish to convert and run this small macro:
Sub NameFixer()
For Each r In Selection 
    ary = Split(r.Value, " ") 
    r.Value = ary(1) & ", " & ary(0) 
Next r
End Sub
Answer
Alternate formula solution:
=LEFT(TRIM(RIGHT(SUBSTITUTE(A1," ",REPT(" ",99)),99))&",
"&A1,LEN(A1)+1)
Topic 1100
Subject
VBA: Convert populated cells in columns to hyperlinks
Question
I have a SQL script as a data connection in Excel that essentially returns 3
columns. These 3 columns are all the text of hyperlinks. These 3 columns can
contain nulls / empty cells.
I found a VBA script to run that converts these hyperlink texts into actual
hyperlinks (as in you can click on the cell and it will take you to the webpage).

My problem is: The VBA script is converting empty / null cells into hyperlinks
as well (that of course go nowhere, i.e., you click on the cell and it simply
does nothing).
My question is: How do I edit this script to only convert non-empty / populated
cells into hyperlinks?
Script so far:
Sub HyperlinkConverter()
For Each xCell In Range("M:O")
ActiveSheet.Hyperlinks.Add Anchor:=xCell, Address:=xCell.Formula Next
xCell
End Sub
Pseudo-script:
Sub HyperlinkConverter()
For Each xCell In Range("M:O") **WHERE RANGE("M:O") IS NOT NULL
(or) RANGE("M:O") <> ""**
ActiveSheet.Hyperlinks.Add Anchor:=xCell, Address:=xCell.Formula Next
xCell
End Sub
Answer
Just test each cell:
Sub HyperlinkConverter()
For Each xCell In Range("M:O") 
    If xCell.Value <> "" Then 
       ActiveSheet.Hyperlinks.Add Anchor:=xCell,
Address:=xCell.Formula 
    End If 

Next xCell
End Sub
EDIT#1:
To avoid the first row:
Sub HyperlinkConverter()
For Each xCell In Range("M:O") 
    If xCell.Value <> "" And xCell.Row <> 1 Then 
       ActiveSheet.Hyperlinks.Add Anchor:=xCell,
Address:=xCell.Formula 
    End If 
Next xCell
End Sub
Topic 1101
Subject
Compile error: Argument not optional when calling sub
Question
So, while I have read some of the many questions on here about similar errors,
I haven't found one which helped me understand my problem, so far. If their is
a similar question with an appropriate answer, please link it and I shall
remove this one.
Now, I am using a small sub Refresh_Activesheet() to look at the name of the
WorkSheets and according to that name run the appropriate sub. Most of the
subs are in the same module as Refresh_Activesheet(). However, two are in
their separate module, for the moment. Now the problem is that when I run
Refresh_Activesheet vba returns the argument not optional error and I can't
fathom why.
Refresh_Activesheet
Sub Refresh_Activesheet()

If IsNumeric(Left(ActiveSheet.Name, 1)) Then
Emissions_Calculation
ElseIf ActiveSheet.Name = "Voyages List" Then
Refresh_Table
ElseIf ActiveSheet.Name = "Émission Total" Then
Call Refresh_Emissions.Emission_Total ElseIf ActiveSheet.Name =
"Consommation Total" Then Exit Sub
End If
End Sub
Refresh_Emissions which is the module that contains Emission_Total
Option Explicit
Option Base 1
Public j, i, k, n, m, p, l, info, mation, Total As Variant Public AverageEmission,
TotalEmission As String
Sub Emission_Total(ByVal ws As Worksheet)
Application.ScreenUpdating = False
On Error Resume Next
Dim SoxRevenue, SoxGross, MilesTotal, MilesLaden, CargoMT As Double
ThisWorkbook.Sheets("Émission total").Range("A7 : M200").Clear j = 7
k = 1
For Each ws In ActiveWorkbook.Sheets
If IsNumeric(Left(ws.Name, 1)) Then
ws.Unprotect ("12345") 
      ThisWorkbook.Sheets("Émission Total").Range("A" &
j).Value = ws.Range("C5").Value 
      ThisWorkbook.Sheets("Émission Total").Range("B" &

j).Value = ws.Range("T2").Value 
      ThisWorkbook.Sheets("Émission Total").Range("C" &
j).Value = ws.Range("T3").Value 
      ThisWorkbook.Sheets("Émission Total").Range("D" &
j).Value = ws.Range("G2").Value 
      ThisWorkbook.Sheets("Émission Total").Range("E" &
j).Value = ws.Range("J2").Value 
      info = ThisWorkbook.Sheets("Émission total").Range("F7
: M200").Address 
      mation = ws.Range("D6:D8").Address 
      SoxRevenue =
WorksheetFunction.Sum(ws.Range("V28:V30").Value) 
      SoxGross = ws.Range("V43").Value 
      MilesLaden = ws.Range("M4").Value 
      MilesTotal = ws.Range("M6").Value 
      CargoMT = ws.Range("O5").Value 
      With ThisWorkbook.Sheets("Émission total").Range(info) 
          If (ws.Range(mation).Cells(1, 1).Value) = "" Then 
           .Cells(k, 1).Value = ws.Range("W49").Value 
           .Cells(k, 2).Value = ws.Range("W50").Value 
           .Cells(k, 3).Value = ws.Range("W54").Value 
           .Cells(k, 4).Value = ws.Range("W56").Value 
           .Cells(k, 5).Value = ws.Range("V43").Value 
           .Cells(k, 6).Value = SoxRevenue 
           .Cells(k, 7).Value = SoxGross * 1.852 * 1000 *
1000 / (CargoMT * MilesTotal) 
           .Cells(k, 8).Value = SoxRevenue * 1.852 * 1000 *
1000 / (CargoMT * MilesLaden) 
           .Cells(k, 1).NumberFormat = "?0.00" 
           .Cells(k, 2).NumberFormat = "?0.00" 
           .Cells(k, 3).NumberFormat = "?0.00" 
           .Cells(k, 4).NumberFormat = "?0.00" 
           .Cells(k, 5).NumberFormat = "?0.0000" 
           .Cells(k, 6).NumberFormat = "?0.0000" 
           .Cells(k, 7).NumberFormat = "?0.0000" 
           .Cells(k, 8).NumberFormat = "?0.0000" 
          ElseIf (ws.Range(mation).Cells(1, 1).Value) = 0
Then 
           .Cells(k, 1).Value = ws.Range("W49").Value 
           .Cells(k, 2).Value = ws.Range("W50").Value 
           .Cells(k, 3).Value = 0 
           .Cells(k, 4).Value = 0 
           .Cells(k, 5).Value = ws.Range("V43").Value 

           .Cells(k, 6).Value = ws.Range("V43").Value 
           .Cells(k, 7).Value = 0 
           .Cells(k, 8).Value = 0 
           .Cells(k, 1).NumberFormat = "?0.00" 
           .Cells(k, 2).NumberFormat = "?0.00" 
           .Cells(k, 3).NumberFormat = "?0.00" 
           .Cells(k, 4).NumberFormat = "?0.00" 
           .Cells(k, 5).NumberFormat = "?0.0000" 
           .Cells(k, 6).NumberFormat = "?0.0000" 
           .Cells(k, 7).NumberFormat = "?0.0000" 
           .Cells(k, 8).NumberFormat = "?0.0000" 
           ElseIf (ws.Range(mation).Cells(2, 1).Value) = 0
And (ws.Range(mation).Cells(3, 1).Value) = 0 Then 
           .Cells(k, 1).Value = ws.Range("W49").Value 
           .Cells(k, 2).Value = ws.Range("W50").Value 
           .Cells(k, 3).Value = (ws.Range("W49").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value) +
(ws.Range(mation).Cells(3, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 4).Value = 0 
           .Cells(k, 5).Value = ws.Range("V43").Value 
           .Cells(k, 6).Value = ws.Range("V43").Value 
           .Cells(k, 7).Value = (ws.Range("V43").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value) +
(ws.Range(mation).Cells(3, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 8).Value = 0 
           .Cells(k, 1).NumberFormat = "?0.00" 
           .Cells(k, 2).NumberFormat = "?0.00" 
           .Cells(k, 3).NumberFormat = "?0.00" 
           .Cells(k, 4).NumberFormat = "?0.00" 
           .Cells(k, 5).NumberFormat = "?0.0000" 
           .Cells(k, 6).NumberFormat = "?0.0000" 
           .Cells(k, 7).NumberFormat = "?0.0000" 
           .Cells(k, 8).NumberFormat = "?0.0000" 
           ElseIf (ws.Range(mation).Cells(2, 1).Value) = ""
And (ws.Range(mation).Cells(3, 1).Value) = "" Then 
           .Cells(k, 1).Value = ws.Range("W49").Value 
           .Cells(k, 2).Value = ws.Range("W50").Value 
           .Cells(k, 3).Value = (ws.Range("W49").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value) +
(ws.Range(mation).Cells(3, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 4).Value = 0 

           .Cells(k, 5).Value = ws.Range("V43").Value 
           .Cells(k, 6).Value = ws.Range("V43").Value 
           .Cells(k, 7).Value = (ws.Range("V43").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value) +
(ws.Range(mation).Cells(3, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 8).Value = 0 
           .Cells(k, 1).NumberFormat = "?0.00" 
           .Cells(k, 2).NumberFormat = "?0.00" 
           .Cells(k, 3).NumberFormat = "?0.00" 
           .Cells(k, 4).NumberFormat = "?0.00" 
           .Cells(k, 5).NumberFormat = "?0.0000" 
           .Cells(k, 6).NumberFormat = "?0.0000" 
           .Cells(k, 7).NumberFormat = "?0.0000" 
           .Cells(k, 8).NumberFormat = "?0.0000" 
          Else 
           .Cells(k, 1).Value = ws.Range("W49").Value 
           .Cells(k, 2).Value = ws.Range("W50").Value 
           .Cells(k, 3).Value = (ws.Range("W49").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value) +
(ws.Range(mation).Cells(3, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 4).Value = (ws.Range("W50").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 5).Value = ws.Range("V43").Value 
           .Cells(k, 6).Value = ws.Range("V43").Value 
           .Cells(k, 7).Value = (ws.Range("V43").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value) +
(ws.Range(mation).Cells(3, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 8).Value = (ws.Range("V43").Value) /
((ws.Range(mation).Cells(1, 1).Value) *
((ws.Range(mation).Cells(2, 1).Value))) * 1000 * 1000 / 1.853 
           .Cells(k, 1).NumberFormat = "?0.00" 
           .Cells(k, 2).NumberFormat = "?0.00" 
           .Cells(k, 3).NumberFormat = "?0.00" 
           .Cells(k, 4).NumberFormat = "?0.00" 
           .Cells(k, 5).NumberFormat = "?0.0000" 
           .Cells(k, 6).NumberFormat = "?0.0000" 
           .Cells(k, 7).NumberFormat = "?0.0000" 
           .Cells(k, 8).NumberFormat = "?0.0000" 
          End If 

       End With 
      k = k + 1 
      j = j + 1 
      ws.Protect ("12345") 
ElseIf ws.Name = "Émission total" Then
ws.Unprotect ("12345")
End If
Next ws
k = k + 7
p = k - 1
ThisWorkbook.Sheets("Émission total").Range("D" & k).Value =
"AverageEmission" ThisWorkbook.Sheets("Émission total").Range("F" &
k).Value = Application.Average(ThisWorkbook.Sheets("Émission
total").Range("F7 : F" & p)) ThisWorkbook.Sheets("Émission
total").Range("G" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("G7 : G"
& p)) ThisWorkbook.Sheets("Émission total").Range("H" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("H7 : H"
& p)) ThisWorkbook.Sheets("Émission total").Range("I" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("I7 : I" &
p)) ThisWorkbook.Sheets("Émission total").Range("J" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("J7 : J"
& p)) ThisWorkbook.Sheets("Émission total").Range("K" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("K7 : K"
& p)) ThisWorkbook.Sheets("Émission total").Range("L" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("L7 : L"
& p)) ThisWorkbook.Sheets("Émission total").Range("M" & k).Value =
Application.Average(ThisWorkbook.Sheets("Émission total").Range("M7 : M"
& p))
ThisWorkbook.Sheets("Émission total").Range("F" & k).NumberFormat = "?

0.00" ThisWorkbook.Sheets("Émission total").Range("G" & k).NumberFormat
= "?0.00" ThisWorkbook.Sheets("Émission total").Range("H" &
k).NumberFormat = "?0.00" ThisWorkbook.Sheets("Émission total").Range("I"
& k).NumberFormat = "?0.00" ThisWorkbook.Sheets("Émission
total").Range("J" & k).NumberFormat = "?0.0000"
ThisWorkbook.Sheets("Émission total").Range("K" & k).NumberFormat = "?
0.0000" ThisWorkbook.Sheets("Émission total").Range("L" &
k).NumberFormat = "?0.0000" ThisWorkbook.Sheets("Émission
total").Range("M" & k).NumberFormat = "?0.0000"
l = k + 2
ThisWorkbook.Sheets("Émission total").Range("D" & l).Value =
"TotalEmission" ThisWorkbook.Sheets("Émission total").Range("F" & l).Value
= Application.Sum(ThisWorkbook.Sheets("Émission total").Range("F7 : F" &
p)) ThisWorkbook.Sheets("Émission total").Range("G" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("G7 : G" &
p)) ThisWorkbook.Sheets("Émission total").Range("H" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("H7 : H" &
p)) ThisWorkbook.Sheets("Émission total").Range("I" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("I7 : I" & p))
ThisWorkbook.Sheets("Émission total").Range("J" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("J7 : J" & p))
ThisWorkbook.Sheets("Émission total").Range("K" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("K7 : K" &
p)) ThisWorkbook.Sheets("Émission total").Range("L" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("L7 : L" &
p)) ThisWorkbook.Sheets("Émission total").Range("M" & l).Value =
Application.Sum(ThisWorkbook.Sheets("Émission total").Range("M7 : M" &
p))
ThisWorkbook.Sheets("Émission total").Range("F" & l).NumberFormat = "?
0.00" ThisWorkbook.Sheets("Émission total").Range("G" & l).NumberFormat
= "?0.00" ThisWorkbook.Sheets("Émission total").Range("H" &
l).NumberFormat = "?0.00" ThisWorkbook.Sheets("Émission total").Range("I"
& l).NumberFormat = "?0.00" ThisWorkbook.Sheets("Émission
total").Range("J" & l).NumberFormat = "?0.0000"

ThisWorkbook.Sheets("Émission total").Range("K" & l).NumberFormat = "?
0.0000" ThisWorkbook.Sheets("Émission total").Range("L" &
l).NumberFormat = "?0.0000" ThisWorkbook.Sheets("Émission
total").Range("M" & l).NumberFormat = "?0.0000"
ThisWorkbook.Sheets("Émission Total").Protect ("12345")
ThisWorkbook.Protect ("12345")
Application.ScreenUpdating = True
End Sub
Answer
The problem is this line:
Call Refresh_Emissions.Emission_Total
In that line, you don't provide an argument. But the Emission_Total subroutine
requires that a worksheet object be provided as an argument, as shown by its
declaration:
Sub Emission_Total(ByVal ws As Worksheet)
It looks like you are calling different subroutines based on the worksheet name,
so my guess is you simply want to send the worksheet that matched the call, in
which case:
Sub Refresh_Activesheet()
If IsNumeric(Left(ActiveSheet.Name, 1)) Then
Emissions_Calculation
ElseIf ActiveSheet.Name = "Voyages List" Then
Refresh_Table
ElseIf ActiveSheet.Name = "Émission Total" Then
Call Refresh_Emissions.Emission_Total(ActiveSheet) 'Note I added the
worksheet as an argument here ElseIf ActiveSheet.Name = "Consommation
Total" Then Exit Sub

End If
End Sub
EDIT: Looking at your posted code some more, it looks like you never actually
use the passed worksheet variable in the Emission_Total subroutine. In which
case you could just remove the ws variable requirement from the declaration:
Sub Emission_Total()
And then leave your Refresh_Activesheet code as you originally posted.
Topic 1102
Subject
How to convert a list of text with dates and purchases into a table that shows
purchases for every date with Excel VBA?
Question
I am trying to convert a list of text into a table that shows all the purchases for
a particular date.
The data looks like this, and it is all in one column:
The data follows the format of:
Job Number
Price
Date
Email of customer
Product code
I am trying to convert the data into a table which will end up looking like this:
I would like to see all the purchases listed below the dates.
Is this possible with VBA in Excel?
Answer
I found an extremely inelegant solution to the problem, but without VBA. Here

is the original column of data:
[orginal data]
In order to separate the dates into a separate column, I used this formula in
column B:
=IF(AND(ISNUMBER(A2),A2>40000),MONTH(A2)&"/"&DAY(A2)&"/"&Y
If you convert the date into a number, it will be greater than 40000, and since
the purchases do not exceed 400000, we can see that all numbers greater than
40000 will be a date. Since the date includes the specific time of day, and we
are only looking for the actual day, I used the MONTH, DAY, and YEAR
questions to select only the date.
Next, I wanted to line up the purchases with the respective dates for the orders,
so I used this formula to check to see if the value in column A is a number, and
if it is, copy it over to column C.
=IF(AND(ISNUMBER(A1),A1<40000),A1,"")
The formula was placed in C2 so that it lines up the purchases with the dates.
The spreadsheet now looks like
this.
Next, you select columns B and C and create a pivot table- problem solved!
Topic 1103
Subject
Conditional Formatting And and Or
Question
I am trying to do some conditional formating with AND and OR.
I need to turn cell B2 red if cell B2 and C2, or D2. are filled.
So if cell B2 is filled in with text and either C2 or D2 then I need it to turn red
But, if only C2 and D2 are filled nothing will turn red
If cell B2 and C2 are filled then red

Answer
Try this:
=And(B2<>"",OR(C2<>"",D2<>""))
Topic 1104
Subject
Reading Excel Files in Python over network share is very slow
Question
I am using xlrd library with Python to read approx 200 small Excel files over a
UNC network share. The process of opening the Excel files is very slow. I
made a simple benchmark program to measure how long it takes to just open
the Excel files without actually doing anything else.
The timer reports that it takes 92 seconds to read 100 Excel files that are 50KB
in size each. Why is this taking so long to run? Over a wireless connection
accessing the same network share, it takes almost 2-3 minutes!
Eventually I need to save some data from the Excel workbooks, and then write
a new Excel file with the collected information. Am I doing something wrong
that is slowing this down?
import time
import sys
import os
import re
from xlrd import open_workbook,cellname, XLRDError from xlwt import
Workbook
from timeit import default_timer as timer
def ReadReports():
start = timer()
filename_pattern = re.compile('^Report_name_.*')
count =0

root_directory = r'//network/path/somedirectory'
for path, dirs, files in os.walk(root_directory):
files[:] = [f for f in files if re.match(filename_pattern,f)] 
      for file in files: 
          count+=1 
          try: 
              #get the input file object (open the excel
workbook) 
              fullpath = os.path.join(path,file) 
              book = open_workbook(fullpath) 
          except IOError: 
              logger.exception('Program encountered IOError')
              continue 
          except XLRDError as e: 
              logger.exception('Program encountered
XLRDError') 
              continue 
          else: 
              pass 
print "num files: ", count
end = timer()
print "time: %r seconds" %(end - start) if __name__ == "__main__":
ReadReports()
Topic 1105
Subject
Excel VBA repeating dependent ComboBoxes
Question
I have a pair of dependent ComboBoxes in a user form. ComboBox1 and
ComboBox2. ComboBox2 is dependent on ComboBox1.
This pair appears several times in the user form in the form of (ComboBox3

and ComboBox4), (ComboBox5 and ComboBox6), ……..etc. next to a text
box which contains a description of machinery condition. The user has to use
the ComboBoxes only in the case of a failure to the piece of machinery.
I am currently using the code below.
This code is sufficient only if there is a single pair of dependent ComboBoxes.
Is there way to extend this code for all ComboBoxes such that it is called only
when a pair of ComboBoxes is used?
Thank you in advance
Private Sub UserForm_Initialize()
With ComboBox1
.AddItem "PartA"
.AddItem "PartB"
.AddItem "PartC"
End With
End Sub
Private Sub ComboBox1_Change()
Dim index As Integer
index = ComboBox1.ListIndex
ComboBox2.Clear
Select Case index
Case Is = 0
With ComboBox2 
      .AddItem "FMA_1" 
      .AddItem "FMA_2" 
      .AddItem "FMA_3" 

End With
Case Is = 1
With ComboBox2 
      .AddItem "FMB_1" 
      .AddItem "FMB_2" 
      .AddItem "FMB_3" 
End With
Case Is = 2
With ComboBox2 
      .AddItem "FMC_1" 
      .AddItem "FMC_2" 
      .AddItem "FMC_3" 
End With
End Select
End Sub
Topic 1106
Subject
excel table row column lookup
Question
I'm struggling with some Excel functions.
I have a table with row header and column header and then data. For example:
If I have a type of pizza, crossed with its Size, and the data is the price. 
             S    M      L    XL 
Cheese        6    6.5    8    10 
Pepperoni     6.5  7.5    10   12 
Supreme       8    9      12   15 
If I have this table in excel, how can I do a lookup of the price if I know I want

"Cheese", "M"?
The row and colmn headers will be text and not necessarily be in any type of
sorted order.
thanks!!
Answer
Use Index match:
=INDEX(A:E,MATCH("Cheese",A:A,0),MATCH("M",1:1,0))
To call with data in cells so it is dynamic:
Say in F1 you have Cheese and in G1 you have M:
=INDEX(A:E,MATCH(F1,A:A,0),MATCH(G1,1:1,0))
The first part of the Index formula is the Search range. In this case full column
A to E.
The second part denotes what row. The match finds the first instance of
"Cheese" in column A and returns that row.
The third part denotes the column. That match finds "M" in Row 1 and returns
the column number.
Now Index, using those coordinates, knows what to return.
Answer
Adjust your range references as necessary ($A$2:$E$4 contains the table data,
$A$1:$E$1 is your headers - sizes in this case). You can also replace the
"Cheese" and "M" with cell references.
=VLOOKUP("Cheese",$A$2:$E$4,Match("M",$A$1:$E$1,0),FALSE)
Topic 1107
Subject

Can I have an “If” statement in a function parameter?
Question
I'd like to use an IF statement in my VBA code where I'm calling up a Function
and passing to it two parameters. The reason I need the IF statement is because
the parameter is an array object that I pass to the function. Here's an
abbreviation of the code that contains the problem:
For i = 1 To UBound(FilterArray)
For j = LBound(ptsheets, 1) To UBound(ptsheets, 1) 
      Filter_PivotField_Master _ 
          pvtField:=ThisWorkbook.Worksheets(ptsheets(j,
1)).PivotTables(ptsheets(j, 2)).PivotFields(FilterArray(i,
1)), _ 
          FilterTypeArray:= If FilterArray(i, 2) = 1 Then 
                              InvCodeArray 
                              Else 
                              BoardMonthArray 
                              End If 
Next j
Next i
As you can see, I'm looping through the ptsheets array and for each entry, I'm
calling up the Filter_PivotField_Master Function. The function requires two
inputs (a pivotfield and a string array for the filtering). The array called
"FilterArray" simply contains the info needed to pass along to the function.
Because I can't seem to store the string array (either InvCodeArray or
BoardMonthArray) within the "FilterArray," I wanted to use this IF statement
to choose between either array based on if FilterArray(i,2) is equal to "1" or
not. Is an "IF" statement option possible here? Answer
Don't do that. Extract a method/procedure out of the inner loop, and
parameterize it instead.
For j = LBound(ptsheets, 1) To UBound(ptsheets, 1) 
      Filter_PivotField_Master _ 

          pvtField:=ThisWorkbook.Worksheets(ptsheets(j,
1)).PivotTables(ptsheets(j, 2)).PivotFields(thePivotField), _ 
          FilterTypeArray:= theFilterType 
Next j
Then have the calling code (the outer loop) implement the conditional logic
that determines what parameters to give it.
Dim thePivotField
Dim theFilterType
For i = 1 To UBound(FilterArray)
thePivotField = FilterArray(i, 1)
If FilterArray(i, 2) = 1 Then
theFiltertype = InvCodeArray
Else
theFilterType = BoardMonthArray End If
TheExtractedMethod i, thePivotField, theFilterType Next i
Your code will be much easier to follow - and to debug.
On a related note, I made a few assumptions just to get your snippet to compile
with Option Explicit on (and an IIf instead of the illegal If...Else block), and
Rubberduck's last release (v1.4.3) correctly extracted the selected inner loop
into its own method:
There are a few known bugs with Rubberduck 1.4.3, and v2.0 is coming soon-
ish, but I thought this might interest you. I don't know any other refactoring
tools for VBA. Note that Option Explicit is pretty much a hard requirement for
this to work, since Rubberduck works off declarations and can't resolve
undeclared variables.
Disclaimer: I wrote this refactoring tool.
Answer

Use an immediate IF (IIF) for this purpose.
FilterTypeArray = IIF(FilterArray(i, 2) = 1, InvCodeArray, BoardMonthArray)
Topic 1108
Subject
Can anyone figure out why the integer of this VBA script stops increasing?
Question
I'm working on the following code:
Sub RemoveNumber()
Dim Rng As Range
Dim i As Long
i = 1
Application.ScreenUpdating = True
While i <= 20000 
      Set Rng = Range("A" & i) 
      If IsNumeric(Rng.Value) = True Then 
          Rng.Delete Shift:=xlUp 
      ElseIf IsNumeric(Rng.Value) = False Then 
          i = i + 1 
      Else 
          i = i + 1 
      End If 
Wend
End Sub
Essentially, it loops through a column and removes cells with numbers. This
much works well, but the loop doesn't end. Further testing by inserting
Range("B2").value = i shows that when i reaches 18450 (the first empty cell in
the column), i stops increasing. But surely and empty cell should trigger the
Else statement at the end, right? Answer
Your code will miss rows. As it deletes rng the next is moved up and then it

moves to the next row. If there are back to back number values it will skip
every other one.
One good method to avoid all this is to loop backwards:
Sub RemoveNumber()
Dim Rng As Range
Dim i As Long
i = 1
Application.ScreenUpdating = True
For i = 20000 To 1 Step -1
Set Rng = Range("A" & i)
If IsNumeric(Rng.Value) And Len(Rng.Value) > 0 Then
Rng.Delete Shift:=xlUp
End If
Next i
End Sub
Topic 1109
Subject
What's the best way to manipulate excel data in Python
Question
I want to import an excel spread sheet into Python so I can then manipulate the
data, how do I got about this?
Topic 1110
Subject
C#: Writing file to Excel issue
Question
I am using ClosedXML to write my data into Excel. But here is the problem.
When I write my data the old data gets removed and saves only data which I
am calling. I know that is because of "new" and "Add" word I am using. Is
there any other way I can specify to write files?

var workbook = new XLWorkbook();
var worksheet = workbook.Worksheets.Add("Common"); worksheet.Cell(2,
1).Value = "Sent";
workbook.SaveAs(@"..\..\File.xlsx");
Answer
Try this: This should work
string pathfile = @"..\..\File.xlsx";
XLWorkbook workbook = new XLWorkbook(pathfile); IXLWorksheet
worksheet = workbook.Worksheet("Common"); worksheet.Cell(2, 1).Value =
"Sent";
workbook.Save();
Answer
You may be able to instantiate
var workbook = new XLWorkbook()
in global scope and then append to it in whatever method you're using.
Topic 1111
Subject
Openpyxl - Writing from dictionary to excel rows and columns
Question
So what im trying to do is writing to an existing excel-file from a dictionary:
wb = load_workbook(filename='test.xlsx') ws2 =
wb.get_sheet_by_name("Blad3")
tuple(ws2.iter_rows('A2:I1000'))
for i in ws2.iter_rows('A2:I1000'):
print str(row[0].value)
for i in Candidates: 
      row[0].value = i['Start Location'] 
      row[1].value = i['Distance'] 

      row[2].value = i['End Location'] 
  for p in Potential_candidates: 
      row[4].value = p['Start Location'] 
      row[5].value = p['Distance'] 
      row[6].value = p['End Location'] 
  for n in No_coords: 
      row[8].value = No_coords 
print 'Saving to file "test.xlsx"'
wb.save('test.xlsx')
the "print str(row[0].value)" get the correct value from the worksheet, but
when i instead try to set the value it says: TypeError: 'NoneType' object has no
attribute 'getitem'.
The error occurs at row[0].value = i['Start Location']
Ive been trying to figure out why and either ive just missed the most obvious
thing or im completely lost. Shouldnt you be able to write to the cell if you can
read from it?
So i figured out what was wrong with the NoneType error, apparently the list
had a None element at [0]. So i added a function to remove such elements from
all the lists and now i have a new error:
TypeError: 'tuple' object does not support item assignment Answer
So i figured out what i did wrong, which was alot, first of, my code tried to fill
each row with the entire dictionary instead of just the first element. Secondly
row[0]= didnt work because of... reasons. So i did a messy solution (but that
works):
def write_excel():
wb = load_workbook(filename='test.xlsx') ws =
wb.get_sheet_by_name("Blad3")
count = 0
for row in ws.iter_rows('A2:I500'):
x = str(row[0].coordinate)

x1 = str(row[1].coordinate)
x2 = str(row[2].coordinate)
x3 = str(row[4].coordinate)
x4 = str(row[5].coordinate)
x5 = str(row[6].coordinate)
x6 = str(row[8].coordinate)
try
Start = Candidates[count]['Start Location'] Dist = Candidates[count]
['Distance'] End = Candidates[count]['End Location'] ws[x] = Start
ws[x1] = Dist ws[x2] = End except IndexError:
pass try Pstart = Potential_candidates[count]['Start Location'] Pdist =
Potential_candidates[count]['Distance'] Pend = Potential_candidates[count]
['End Location'] ws[x3] = Pstart ws[x4] = Pdist ws[x5] = Pend except
IndexError:
pass try NoCoo = No_coords[count] ws[x6] = NoCoo except IndexError:
pass count=count+1 print 'Saving to file "test.xlsx"' wb.save('test.xlsx')
I know it can be cleaned up alot, but it helped me to understand what went
poopoo so hopefully it might help someone else as well :) Ill be cleaned up
when i create a better codestructure for the whole program.
Topic 1112
Subject
Spreadsheet design
Question
I'm designing a file which will calculate a set of certain numbers for each
account. Each account has at the moment 5,000 buckets (rows) and 20
selectable criteria (columns). I the future both will grow. I have now 70
accounts, hence use 70 sheets with identical calculation, but the number of
accounts will also increase in the future. Now, this design is terrible, i had to
go and change the formula in all 70 sheets. Is there another way of designing
the workbook? The rows and columns headings will always be identical for
all accounts, but the number of rows and columns may change as well as the

number of accounts. I researched the topic and there are lots of guidelines as to
how not to design. Well I need a recipe of how to do it. Can someone please
advise? PS I can do basic/mid level vba. Answer
Initially, I would recommend writing a macro that would produce the current
"template" (ie, column headers and formulas), and running that on any new
sheet for new account creation. Then, when the data model changes and you
need to change columns/formulas, you can change the template creation macro
to match the new model and do a quick:
For Each sht in ThisWorkbook.Worksheets
CreateTemplate(sht)
Next
to change all the existing sheets.
If you structure the sheets so that doing that doesn't mess with your source data,
you can keep them all tidy without a lot of work.
Topic 1113
Subject
Excel: String within String lookup
Question
I have a long list of addresses, example:
grundisburgh woodbridge suffolk uk
How can I match it with a city, from a list? In this case city is Woodbridge
Conceptually it is something like vlookup with wild characters, but unsure on
how to this.
I tried different array formulas, but none produce desired effect.
I was able to say if it is in the list with:
{=COUNTIF(C2,""&Cities!C:C&"")}

Where C2 is the address field, and Cities!C:C is the list of Cities
Cities and address are both lowered, to reduce any issues with case sensitivity
Answer
This array formula worked for me, but it requires you send the beginning and
start rows.
=FIND(Cities!C1:C3,C1)
You can also extract which city is in the row by this regular formula:
=MID(C1,D1,FIND(" ",C1,D1+1)-D1) *where D1 is the cell that holds the
above array formula.
Answer
Try this array formula:
=SUM(COUNTIF(C2,"* "&Cities!C:C&" *"))
It is an array formula and must be confirmed with Ctrl-Shift-Enter.
Also the cities must be spelled and capitalized exactly the same in the two
lists, so make sure account for every option.
Topic 1114
Subject
Excel using proper formula, Lookup vs Vlookup vs IF
Question
Trying to write a formula for Excel, Using 2 worksheets. to classify the
invoices
Worksheet 1 has Group Name and Group ID
Worksheet 2 has Group Name, invoice amount,invoice number
Trying to get the Group ID to worksheet 2, keeping in mind a ID can be use

multiple times
Using formula below but the IDs I'm getting back aren't matching
=LOOKUP(F2,GROUP!C:C,ID!B:B)
Any help would be appreciated
Answer
With vlookup you have to be sure that your data is first sorted, otherwise the
algorithm tends to fail.
A better alternative, in my experience, is to do something like the following. I
am assuming that Worksheet 1 has Group Name in Column A and Group ID in
column B, and that Worksheet 2 has Group Name in column A. This formula
would go in worksheet 2, in a blank column starting in row 2:
=index(Worksheet1!B:B, match(A2, Worksheet1!A:A, 0))
If you fill that equation all the way down, then it will perform the equivalent to
a vlookup but without the need to sort your data first.
Answer
Assuming GroupName is column 1 of Worksheet2 and that GroupName and ID
are in columns A and B, respectively in Worksheet1
Place this formula in B1 of Worksheet2:
=vlookup(A1,Worksheet1!A:B,2,0)
Update all cell references and placements as they match your actual sheet data.
Answer
In Worksheet2:
=Vlookup(F2,Worksheet1!B:C,2,False)

But it would be better to size the table exactly and not refer to the whole
column, like:
=Vlookup(F2,Worksheet1!B1:C200,2,False)
Topic 1115
Subject
'Range' is an interface type and cannot be used as an expression
Question
I have been trying everything and I have absolutely no idea why this is not
working. I have looked at countless previous questions and answers and
nothing works. I have a dialog where the user selects a number of files that can
then be imported into Excel. The problem arises when setting the import range.
Dim files As New OpenFileDialog
files.Multiselect = True
files.InitialDirectory = My.Settings.path
If (files.ShowDialog() = DialogResult.OK) Then
My.Settings.files = files.InitialDirectory My.Settings.Save()
MsgBox("Files to be imported: " & files.Multiselect,
MessageBoxIcon.Information) If String.IsNullOrEmpty(My.Settings.path) Then
MsgBox("Warning! No files were imported!", MessageBoxIcon.Exclamation)
End If
End If
Dim openExcel As New Microsoft.Office.Interop.Excel.Application Dim
openWorkbook As New Microsoft.Office.Interop.Excel.Workbook Dim
openWorksheet As New Microsoft.Office.Interop.Excel.Worksheet
openExcel = CreateObject("Excel.Application") openExcel.Visible = True
openExcel.UserControl = True
openWorkbook = openExcel.Workbooks.Add
openWorksheet = openWorkbook.ActiveSheet

With openWorksheet.QueryTables.Add(Connection:=My.Settings.files,
Destination:=Range("$A$1"))
End With
It keeps giving me the error: "BC30111 'Range' is an interface type and cannot
be used as an expression" Answer
Your Range is returning a different worksheet than the QueryTable is on.
Try it like this:
With openWorksheet.QueryTables.Add(Connection:=My.Settings.files,
Destination:=openWorksheet.Range("$A$1"))
Or this:
With openWorksheet
With .QueryTables.Add(Connection:=My.Settings.files,
Destination:=.Range("$A$1"))
Answer
See https://msdn.microsoft.com/en-us/library/office/ff837764.aspx
Try removing the $ from Range("$A$1")
Answer
I think the issue is that it doesn't know where "Range" is coming from, try this:
With openWorksheet
QueryTables.Add(Connection:=My.Settings.files,
Destination:=Range("$A$1")) End
Topic 1116
Subject

Customize New Comment
Question
How to create New Comments without "Author:" inserted (vba). Inherently
New Comments are created with the application Author "Author:" inserted.
Generally one could replace the author name using. Application.Author =
"Mr.Dud" however to customize this for different uses a different
Activecell.AddComment
calls must be added
Answer
Public Sub MyComment(strText as String) ' Creates comment applying
"strText" to Text
ActiveCell.AddComment.Text Text:=strText
End Sub
Then, to create & edit a new comment insert this call to MyComment. This one
inserts the system date and a linefeed;
If ActiveCell.Comment Is Nothing Then
MyComment CStr(Date) & Chr(10)
End If
Application.SendKeys ("+{F2}") , True
Alternately, MyComment "" could be called if a blank comment is required.
Shortcut keys open comment for editing (instead of Mso:ReviewEditComment
call).
Topic 1117
Subject
Loop through all worksheets to find bottom-most row of data in each tab
individually

Question
I found this cool code that identifies the bottom-most row of data in a
worksheet (considering all columns), and then types an X in Column B of the
following row.
However I have been unsuccessful at creating a loop with this code, so that
each worksheet is treated uniquely. My attempts have typed X in the same cell
of all worksheets, but not each worksheet individually based on it's own set of
data. Also note that each of my tabs will not always have the same column be
the longest, which is why I needed a code to look across all columns to find the
bottom-most row.
Can someone suggest how I can loop this and identify the bottom-most row in
each worksheet individually?
Sub EndofData()
Dim iRow As Long
Dim iCol As Long
iRow = Cells.Find(What:=”*”, _
After:=Range(“A1”), _
LookAt:=xlPart, _
LookIn:=xlFormulas, _
SearchOrder:=xlByRows, _
SearchDirection:=xlPrevious, _
MatchCase:=False).Row
Cells(iRow + 1, 2).Select
ActiveCell.FormulaR1C1 = “x”
End Sub
Answer
You want to do a For Each Loop:
Sub EndofData()
Dim ws As Worksheet

Dim iRow As range
Dim iCol As Long
For Each ws In ActiveWorkbook.Worksheets
set iRow = ws.Cells.Find(What:=" * ", _ After:=ws.Range("A1"), _
LookAt:=xlPart, _
LookIn:=xlFormulas, _
SearchOrder:=xlByRows, _
SearchDirection:=xlPrevious, _
MatchCase:=False)
If not irow is nothing then
ws.Cells(iRow.Row + 1, 2).FormulaR1C1 = "x" Else
ws.Cells(1, 2).FormulaR1C1 = "x" End IF
Next ws
End Sub
Thanks to @Darren for help on the error avoidance.
Topic 1118
Subject
How to override cell style in excel file using java and Apache POI library?
Question
I am doing excel validations for input .xlsx file using java and Apache POI
library.
Here below I am posting two functions from my java class. When I try to set
the cell style it's not getting reflected in the excel file. I searched over internet
about it, but everywhere they have given code to give style while creating
cell/row itself.
public static CellStyle getNewCellStyle(){
CellStyle style = myWorkBook.createCellStyle();

style.setFillBackgroundColor(IndexedColors.GREEN.getIndex());
style.setFillPattern(CellStyle.ALIGN_FILL); return style;
}
public static void chCaseNumberColumnValidation(Cell cell){
String cellData = getCellDataValue(cell); if(cellData.length() == 10){ 
      if(cellData.equals("BLANK") || cellData.trim().length()
== 0){ 
          System.out.println("BLANK CELL:   " +
cell.getRowIndex() + "," + cell.getColumnIndex()); 
      } 
      if(cellData.charAt(0) != '5'){ 
          System.out.println("DON't START WITH 5:    " +
cell.getRowIndex() + "," + cell.getColumnIndex()); 
          cell.setCellStyle(getNewCellStyle()); 
      } 
}
else{
System.out.println("****INVALID SIZE " + cell.getRowIndex() + "," +
cell.getColumnIndex());
}
}
Is there any way by which I can give background color to the already existing
cells. (altering cell style) Answer
Pasting example of setting color from the Apache POI Developer Guide
Fills and colors
Workbook wb = new XSSFWorkbook();
Sheet sheet = wb.createSheet("new sheet");

// Create a row and put some cells in it. Rows are 0 based. Row row =
sheet.createRow((short) 1);
// Aqua background
CellStyle style = wb.createCellStyle();
style.setFillBackgroundColor(IndexedColors.AQUA.getIndex());
style.setFillPattern(CellStyle.BIG_SPOTS); Cell cell = row.createCell((short)
1);
cell.setCellValue("X");
cell.setCellStyle(style);
// Orange "foreground", foreground being the fill foreground not the font color.
style = wb.createCellStyle();
style.setFillForegroundColor(IndexedColors.ORANGE.getIndex());
style.setFillPattern(CellStyle.SOLID_FOREGROUND); cell =
row.createCell((short) 2);
cell.setCellValue("X");
cell.setCellStyle(style);
// Write the output to a file
FileOutputStream fileOut = new FileOutputStream("workbook.xls");
wb.write(fileOut);
fileOut.close();
Topic 1119
Subject
excel sort columns in groups of 2
Question
I've a data in a row looking like this ->
5 0.1 3 0.5 9 17 1 0.1...
These are in groups of two, i.e., 0.1 is associated for 5 & 0.5 for 3 & so on
I want to sort the row in groups of two ->
1 0.1 3 0.5 5 0.1 9 17

Answer
This is a real formula hack but it solves your question as posted at face value.
There is a caveat that if there are ties in numbers, this will not work as
accurately as your sample data.
Formulas are explained below the picture:
A5 -> =A1, then drag over skipping columns A7 ->
=IF(ISBLANK(A5),A1,""), then drag over all columns A4 ->
=IFERROR(RANK(A5,$A$5:$H$5),""), then drag over all columns B6 ->
=IF(B4="",A4,""), then drag over all columns A9 -> =COUNT(A1:H1)/2, rest
of columns are just math. A10 -> =HLOOKUP(A9,$A$4:$H$5,2,0)
B10 -> =HLOOKUP(B9,$A$6:$H$7,2,0)
copy A10:B10, over for each two columns.
Answer
Three methods depending on actual data structure
Method 1:
If the cells on which you wish to sort are not duplicates, you could do this:
In A2 put:
=A1
In B2 put:
=IF(MOD(COLUMN(),2) = 0,A1+(B1/1000),B1)
Then drag the whole width of the data:
Copy and paste just the values on row 2. Then sort horizontally on row 2:
Then you can delete row 2

Method 2:
If there are duplicates then this two step process will get you then list desired
In A2 put:
=IF(AND(MOD(COLUMN(),2),A1<>""),A1+(B1/10000),"")
In A3 put:
=IFERROR(IF(MOD(COLUMN(),2),INT(SMALL(2:2,ROUNDUP(COLUMN(
(SMALL(2:2,ROUNDUP(COLUMN()/2,0))-
INT(SMALL(2:2,ROUNDUP(COLUMN()/2,0))))*10000),"")
And copy across all columns. Row 3 will be your sorted list:
The advantage to this method is that you can paste the values of the list in row
one and it will calculate the correct sort order on calculate. There is no
copying and pasting over formulas.
Method 3:
If you want to go the column route then:
In one column put:
=OFFSET($A$1,0,(ROW(1:1)-1)*2)
In the second:
=OFFSET($A$1,0,(ROW(1:1)*2-1))
Then copy down sufficient to get all the values.
Then copy and paste the values anywhere you want and then sort.
Topic 1120
Subject
Produce an excel ouput file step for each case in a Switch/Case step in Pentaho

Question
I have a Text file input step, which reads from several files under the same
directory, and produce a huge dataset. I need to produce an excel file output for
each case in a Switch / Case statement and give each excel file a name, based
on the value of some field in the dataset. Is this possible with Spoon ?
Any help would be greatly appreciated.
Answer
If you don't want many cases from a SwitchCase, I'm not sure why you would
use a SwitchCase for a datastream that would result in many cases.
Having said that:
add one "Add constants" step before the SwitchCase. For each Case coming
out of the SwitchCase, add a "Set field value" step that assigns the value of
your "some field in the dataset" to the value of the Constant you created in #1.
If you have 5 streams (with 1 stream for each case), you will have 5 of these
out of the SwitchCase
Following each "Set field value" step (created in #2), you'll have a step to
save your file to Excel, and use the value of the field (that you set in #2) as the
Filename.
I'm sure there are better ways to do this (assuming that SwitchCase is the right
approach for you to start with), but it's how I would do it (not knowing java,
regex, or any other language).

