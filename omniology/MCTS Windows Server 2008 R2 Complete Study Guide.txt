
MCTS
Windows Server
® 2008 R2 
Complete
Study Guide

MCTS
Windows Server
® 2008 R2  
Complete
Study Guide 
William Panek

Acquisitions Editor: Jeff Kellum
Development Editor: Amy Breguet
Technical Editor: Rodney Fournier
Production Editor: Dassi Zeidel
Copy Editor: Linda Recktenwald
Editorial Manager: Pete Gaughan
Production Manager: Tim Tate
Vice President and Executive Group Publisher: Richard Swadley
Vice President and Publisher: Neil Edde
Media Project Manager 1: Laura Moss-Hollister
Media Associate Producer: Josh Frank
Media Quality Assurance: Marilyn Hummel
Book Designers: Judy Fung and Bill Gibson
Proofreader: Jen Larsen, Word One New York
Indexer: Ted Laux
Project Coordinator, Cover: Katie Crocker
Cover Designer: Ryan Sneed
Copyright © 2011 by Wiley Publishing, Inc., Indianapolis, Indiana
Published simultaneously in Canada
ISBN: 978-0-470-94846-0
ISBN: 9781118075197 (ebk.)
ISBN: 9781118075432 (ebk.)
ISBN: 9781118075203 (ebk.)
No part of this publication may be reproduced, stored in a retrieval system or transmitted in any form 
or by any means, electronic, mechanical, photocopying, recording, scanning or otherwise, except as 
permitted under Sections 107 or 108 of the 1976 United States Copyright Act, without either the prior 
written permission of the Publisher, or authorization through payment of the appropriate per-copy fee 
to the Copyright Clearance Center, 222 Rosewood Drive, Danvers, MA 01923, (978) 750-8400, 
fax (978) 646-8600. Requests to the Publisher for permission should be addressed to the Permissions 
Department, John Wiley & Sons, Inc., 111 River Street, Hoboken, NJ 07030, (201) 748-6011, 
fax (201) 748-6008, or online at http://www.wiley.com/go/permissions.
Limit of Liability/Disclaimer of Warranty: The publisher and the author make no representations or 
warranties with respect to the accuracy or completeness of the contents of this work and specifically 
disclaim all warranties, including without limitation warranties of fitness for a particular purpose. 
No warranty may be created or extended by sales or promotional materials. The advice and strategies 
contained herein may not be suitable for every situation. This work is sold with the understanding that 
the publisher is not engaged in rendering legal, accounting, or other professional services. If professional 
assistance is required, the services of a competent professional person should be sought. Neither the 
publisher nor the author shall be liable for damages arising herefrom. The fact that an organization or Web 
site is referred to in this work as a citation and/or a potential source of further information does not mean 
that the author or the publisher endorses the information the organization or Web site may provide or 
recommendations it may make. Further, readers should be aware that Internet Web sites listed in this work 
may have changed or disappeared between when this work was written and when it is read.
For general information on our other products and services or to obtain technical support, please contact 
our Customer Care Department within the U.S. at (877) 762-2974, outside the U.S. at (317) 572-3993 or 
fax (317) 572-4002.
Wiley also publishes its books in a variety of electronic formats. Some content that appears in print may 
not be available in electronic books.
Library of Congress Cataloging-in-Publication Data is available from the publisher.
TRADEMARKS: Wiley, the Wiley logo, and the Sybex logo are trademarks or registered trademarks of 
John Wiley & Sons, Inc. and/or its affiliates, in the United States and other countries, and may not be 
used without written permission. Windows Server is a registered trademark of Microsoft Corporation in 
the United States and/or other countries. All other trademarks are the property of their respective owners. 
Wiley Publishing, Inc., is not associated with any product or vendor mentioned in this book.
10 9 8 7 6 5 4 3 2 1

Dear Reader,
Thank you for choosing MCTS: Windows Server 2008 R2 Complete Study Guide. This 
book is part of a family of premium-quality Sybex books, all of which are written by 
outstanding authors who combine practical experience with a gift for teaching.
Sybex was founded in 1976. More than 30 years later, we’re still committed to producing 
consistently exceptional books. With each of our titles, we’re working hard to set a new 
standard for the industry. From the paper we print on, to the authors we work with, our 
goal is to bring you the best books available.
I hope you see all that reﬂ ected in these pages. I’d be very interested to hear your 
comments and get your feedback on how we’re doing. Feel free to let me know what you 
think about this or any other Sybex book by sending me an email at nedde@wiley.com. If 
you think you’ve found a technical error in this book, please visit http://sybex.custhelp
.com. Customer feedback is critical to our efforts at Sybex. 
Best regards,
Neil Edde
Vice President and Publisher
Sybex, an Imprint of Wiley

 This book is dedicated to my wife, Crystal, and my two daughters, 
Alexandria and Paige. Without their love and support, none of 
this would be possible.  

 Acknowledgments   
 I would like to thank my best friend and wife, Crystal. She is always the light at the end of 
my tunnel. I want to thank our two daughters, Alexandria and Paige, for all of their love 
and support during the writing of all my books. They make it all worthwhile. 
 I want to thank my family and especially my brothers, Rick, Gary, and Rob. They have 
always been there for me. I want to thank my father, Richard, who helped me become the 
man I am today, and my mother, Maggie, for all of her love and support. 
 I would like to thank Jeremy Hodgson, my training partner, who spends more time with 
me on the road than anyone else. His sense of humor keeps me smiling even when I am 
homesick. 
 I want to thank everyone on my Sybex team, especially my developmental editor Amy 
Breguet, who helped me make this the best book possible, and Rodney R. Fournier, who is 
the technical editor of many of my books. It ’ s always good to have the very best technical 
guy backing you up. 
 I want to thank Dassi Zeidel, who was my production editor, and my acquisitions editor 
Jeff Kellum, who was the lead for the entire book. He has always been there for me, and he 
is always great to write for. Finally, I want to thank everyone else behind the scenes who 
helped make this book possible.  

 About the Author   
 William Panek holds the following certiﬁ cations: MCP, MCPI, MCSA, MCSA 
Security and Messaging, MCSE  – NT (3.51  &  4.0), MCSE  – 2000 and 2003, MCSE   
Security and Messaging, MCDBA, MCT, MCTS, MCITP, CCNA, and CHFI. 
 After many successful years in the computer industry and a degree in computer 
programming, Will Panek decided that he could better use his talents and his personality 
as an instructor. He started teaching for such schools as Boston University, Clark 
University, and the University of Maryland, just to name a few. In 1998 Will started 
Stellacon Corporation. Stellacon has become one of New England ’ s most respected training 
companies. Stellacon is also a two - time winner of the Best Computer School award in 
Portsmouth, New Hampshire. 
 Will brings years of real - world expertise to the classroom and strives to ensure that each 
and every student has an understanding of the course material. 
 Will currently lives in New Hampshire with his wife and two girls. Will is also a 
representative in the NH House of Representatives. In his spare time he likes to golf, ski, 
and snowmobile. William is also a commercially rated helicopter pilot.  

Contents at a Glance
Introduction 
xxxv
Assessment Test 
xlvii
Part I 
MCTS: Windows Server 2008 R2 Active 
Directory Configuration (Exam 70-640) 
1
Chapter 1 
Overview of Active Directory 
3
Chapter 2 
Domain Name System (DNS) 
35
Chapter 3 
Active Directory Planning and Installation 
97
Chapter 4 
Installing and Managing Trees and Forests 
135
Chapter 5 
Configuring Sites and Replication 
179
Chapter 6 
Configuring Active Directory Server Roles 
219
Chapter 7 
Administering Active Directory 
263
Chapter 8 
Configuring Group Policy Objects 
313
Chapter 9 
Planning Security for Active Directory 
373
Chapter 10 
Active Directory Optimization and Reliability 
415
Part II 
MCTS: Windows Server 2008 R2 Network 
Infrastructure Configuration (Exam 70-642) 
461
Chapter 11 
Understanding Windows Server 2008 R2 Networking 
463
Chapter 12 
Configuring TCP/IP 
493
Chapter 13 
Managing DHCP and DNS 
545
Chapter 14 
Managing Routing and Remote Access 
595
Chapter 15 
Managing Remote Access Services 
643
Chapter 16 
Managing Security for Remote Access Services 
683
Chapter 17 
Managing File and Print Services 
725
Chapter 18 
Monitoring and Managing a Network Infrastructure 
765
Part III 
MCTS: Windows Server 2008 R2 
Applications Infrastructure Configuration 
(Exam 70-643) 
813
Chapter 19 
Windows Server 2008 R2 Storage Services 
815
Chapter 20 
Remote Desktop Services in Windows Server 2008 R2 
843

Chapter 21 
Configuring Web Services Infrastructure 
889
Chapter 22 
Advanced Web Infrastructure Configuration 
919
Chapter 23 
Configuring Additional Communication Services 
945
Chapter 24 
Configuring Windows SharePoint 2010 Foundation 
975
Chapter 25 
Using Virtualization in Windows Server 2008 R2 
1007
Chapter 26 
Deploying Servers 
1041
Chapter 27 
Configuring High Availability in Windows Server 2008 R2 
1065
Appendix  
About the Companion CD 
1097
Index 
1101

Contents
Introduction 
xxxv
Assessment Test 
xlvii
Part I 
MCTS: Windows Server 2008 R2 Active 
Directory Configuration (Exam 70-640) 
1
Chapter 1 
Overview of Active Directory 
3
The Industry before Active Directory 
5
The Benefits of Active Directory 
5
Understanding Active Directory’s Logical Structure 
9
Components and Mechanisms of Active Directory 
9
An Overview of Active Directory Domains 
11
Overview of an Active Directory Forest 
13
Understanding Active Directory Objects 
15
Names and Identifiers of Objects 
15
Using Organizational Units (OUs) in Active Directory 
17
Security Features of User, Computer, and Group Objects 
18
Delegation of Administrative Control 
19
Introducing Windows Server 2008 R2 Server Roles 
21
Active Directory Certificate Services 
22
Active Directory Domain Services 
22
Active Directory Federation Services 
24
Active Directory Lightweight Directory Services 
25
Active Directory Rights Management Services 
25
Introducing Identity and Access (IDA) in Windows 
Server 2008 
26
Using Directory Services 
27
Strong Authentication 
28
Federated Identities 
28
Information Protection 
29
Forefront Identity Manager (FIM) 2010 
29
Summary 
30
Exam Essentials 
31
Review Questions 
32
Answers to Review Questions 
34
Chapter 2 
Domain Name System (DNS) 
35
Introducing DNS 
36
The Form of an IP Address 
37
Understanding Servers, Clients, and Resolvers 
42
Understanding the DNS Process 
43

xii 
Contents
Introducing DNS Database Zones 
49
Understanding Primary Zones 
50
Understanding Secondary Zones 
51
Understanding Active Directory Integrated DNS 
52
Understanding Stub Zones 
54
GlobalName Zones 
55
Zone Transfers and Replication 
56
New Functionality in Windows Server 2008 DNS 
59
Background Zone Loading 
59
Support for IPv6 Addresses 
59
Support for Read-Only Domain Controllers 
60
GlobalName Zones 
60
DNS Socket Pool 
61
DNS Cache Locking 
61
DNS Security Extensions (DNSSEC) 
61
Introducing DNS Record Types 
62
Start of Authority (SOA) Records 
62
Name Server (NS) Records 
64
Host Record 
64
Alias Record 
65
Pointer (PTR) Record 
65
Mail Exchanger (MX) Record 
66
Service (SRV) Record 
66
Configuring DNS 
67
Installing DNS 
67
Load Balancing with Round Robin 
68
Configuring a Caching-Only Server 
68
Setting Zone Properties 
69
Configuring Zones for Dynamic Updates 
73
Delegating Zones for DNS 
74
DNS Forwarding 
75
Manually Creating DNS Records 
76
DNS Aging and Scavenging 
78
Monitoring and Troubleshooting DNS 
78
Monitoring DNS with the DNS Snap-In 
79
Troubleshooting DNS 
81
Summary 
90
Exam Essentials 
91
Review Questions 
93
Answers to Review Questions 
96

Contents 
xiii
Chapter 3 
Active Directory Planning and Installation 
97
Verifying the Filesystem 
99
Setting Up the NTFS Partition 
100
Verifying Network Connectivity 
102
Basic Connectivity Tests 
103
Tools and Techniques for Testing Network Configuration 
104
Understanding Domain and Forest Functionality 
105
About the Domain Functional Level 
106
About Forest Functionality 
107
Planning the Domain Structure 
109
Installing Active Directory 
109
Verifying Active Directory Installation 
114
Using Event Viewer 
114
Using Active Directory Administrative Tools 
117
Testing from Clients 
119
Creating and Configuring Application Data Partitions 
120
Creating Application Data Partitions 
121
Managing Replicas 
123
Removing Replicas 
124
Using ntdsutil to Manage Application Data Partitions 
124
Configuring DNS Integration with Active Directory 
126
Summary 
128
Exam Essentials 
129
Review Questions 
130
Answers to Review Questions 
133
Chapter 4 
Installing and Managing Trees and Forests 
135
Reasons for Creating Multiple Domains 
136
Reasons for Using Multiple Domains 
136
Drawbacks of Multiple Domains 
139
Creating Domain Trees and Forests 
139
Planning Trees and Forests 
140
The Promotion Process 
143
Creating a Domain Tree 
144
Joining a New Domain Tree to a Forest 
149
Adding Additional Domain Controllers 
154
Demoting a Domain Controller 
154
Managing Multiple Domains 
157
Managing Single-Master Operations 
158
Forest Operations Masters 
158
Domain Operations Masters 
158

xiv 
Contents
Assigning Single-Master Roles 
159
Managing Trusts 
161
Managing UPN Suffixes 
168
Managing Global Catalog Servers 
169
Managing Universal Group Membership Caching 
171
Summary 
172
Exam Essentials 
173
Review Questions 
175
Answers to Review Questions 
178
Chapter 5 
Configuring Sites and Replication 
179
Overview of Network Planning 
180
The Three Types of Network 
180
Exploring Network Constraints 
181
Overview of Active Directory Replication and Sites 
182
Replicating Active Directory 
182
Understanding Active Directory Site Concepts 
183
Understanding Distributed File System Replication 
187
Implementing Sites and Subnets 
188
Creating Sites 
189
Creating Subnets 
192
Configuring Sites 
195
Configuring Replication 
197
Intrasite Replication 
197
Intersite Replication 
198
Configuring Server Topology 
205
Using Universal Group Membership Caching 
208
Monitoring and Troubleshooting Active Directory 
Replication 
209
About System Monitor 
209
Troubleshooting Replication 
209
Summary 
211
Exam Essentials 
212
Review Questions 
214
Answers to Review Questions 
217
Chapter 6 
Configuring Active Directory Server Roles 
219
Understanding Server Manager 
221
Configuring Active Directory Certificate Services 
222
Installing Active Directory Certificate Services 
224
Enrolling User and Computer Certificates 
228

Contents 
xv
Certificate Templates 
230
Revoking Certificates 
232
Configuring Additional CA Server Settings 
234
What’s New in Windows Server 2008 R2 
236
Understanding Active Directory Domain Services 
237
Introducing the New Domain Services Features in 
Windows Server 2008 
237
Security Features Available for Domain Services 
238
What’s New in Windows Server 2008 R2 
241
Active Directory Federation Services 
242
Installing AD FS 
243
Configuring AD FS 
244
Active Directory Lightweight Directory Services 
245
Installing AD LDS 
246
Configuring AD LDS 
246
Installing AD LDS on Server Core 
249
Active Directory Rights Management Services 
250
AD RMS Templates 
255
Summary 
257
Exam Essentials 
257
Review Questions 
259
Answers to Review Questions 
262
Chapter 7 
Administering Active Directory 
263
An Overview of OUs 
264
The Purpose of OUs 
265
Benefits of OUs 
266
Planning the OU Structure 
266
Logical Grouping of Resources 
266
Understanding OU Inheritance 
268
Delegating Administrative Control 
269
Applying Group Policies 
270
Creating OUs 
271
Managing OUs 
275
Moving, Deleting, and Renaming OUs 
275
Administering Properties of OUs 
276
Delegating Control of OUs 
277
Troubleshooting OUs 
282
Creating and Managing Active Directory Objects 
282
Overview of Active Directory Objects 
282
Managing Object Properties 
290

xvi 
Contents
Understanding Groups 
293
Filtering and Advanced Active Directory Features 
295
Moving, Renaming, and Deleting Active 
Directory Objects 
297
Resetting an Existing Computer Account 
298
Publishing Active Directory Objects 
298
Making Active Directory Objects Available to Users 
298
Publishing Printers 
299
Publishing Shared Folders 
300
Querying Active Directory 
301
Using the Active Directory Administrative Center 
303
Using the Command Prompt for Active Directory 
Configuration 
305
Summary 
306
Exam Essentials 
307
Review Questions 
308
Answers to Review Questions 
312
Chapter 8 
Configuring Group Policy Objects 
313
Introducing Group Policy 
314
Understanding Group Policy Settings 
315
The Security Settings Section of the GPO 
317
Group Policy Objects 
318
Group Policy Inheritance 
320
Planning a Group Policy Strategy 
321
Implementing Group Policy 
321
Creating GPOs 
321
Linking Existing GPOs to Active Directory 
324
Managing Group Policy 
325
Managing GPOs 
325
Security Filtering of a Group Policy 
327
Delegating Administrative Control of GPOs 
329
Controlling Inheritance and Filtering Group Policy 
331
Assigning Script Policies 
332
Understanding the Loopback Policy 
334
Managing Network Configuration 
334
Automatically Enrolling User and Computer 
Certificates in Group Policy 
335
Redirecting Folders 
337
Managing GPOs with Windows PowerShell 
Group Policy Cmdlets 
339
Deploying Software through a GPO 
340
The Software Management Life Cycle 
340

Contents 
xvii
The Windows Installer 
342
Deploying Applications 
346
Implementing Software Deployment 
347
Preparing for Software Deployment 
347
Software Restriction Policies 
349
Using AppLocker 
349
Group Policy Slow Link Detection 
349
Publishing and Assigning Applications 
350
Applying Software Updates 
351
Verifying Software Installation 
352
Configuring Automatic Updates in Group Policy 
353
Configuring Software Deployment Settings 
354
The Software Installation Properties Dialog Box 
354
Removing Programs 
357
Microsoft Windows Installer Settings 
358
Troubleshooting Group Policies 
359
RSoP in Logging Mode 
360
RSoP in Planning Mode 
363
Using the gpresult.exe Command 
364
Summary 
365
Exam Essentials 
366
Review Questions 
368
Answers to Review Questions 
371
Chapter 9 
Planning Security for Active Directory 
373
Active Directory Security Overview 
375
Understanding Security Principals 
375
Managing Security and Permissions 
386
Using ACLs and ACEs 
387
Implementing Active Directory Security 
389
Using User Templates 
391
Delegating Control of Users and Groups 
392
Using Group Policy for Security 
393
Fine-Grained Password Policies 
396
Understanding Smart Card Authentication 
399
Preparing a Smart Card Certificate Enrollment 
Station 
400
Configuring Group Policy Settings for Smart Cards 
400
Understanding Security Configuration and Analysis Tools 
401
Using the Security Configuration and Analysis Utility 
402
Understanding the secedit.exe Command 
403

xviii 
Contents
Implementing an Audit Policy 
404
Overview of Auditing 
405
Implementing Auditing 
405
Viewing Auditing Information 
407
What’s New in Windows Server 2008 R2 Auditing 
408
Summary 
409
Exam Essentials 
410
Review Questions 
411
Answers to Review Questions 
414
Chapter 10 
Active Directory Optimization and Reliability 
415
Overview of Windows Server 2008 R2 Performance 
Monitoring 
417
Using Windows Server 2008 R2 Performance Tools 
419
Deciding What to Monitor 
420
Viewing Performance Information 
422
Managing Performance Monitor Properties 
424
Saving and Analyzing Data with Performance Logs and 
Alerts 
428
Monitoring and Troubleshooting Active Directory 
Components 
430
Monitoring Domain Controller Performance 
430
Monitoring Active Directory Performance with 
Performance Monitor 
433
Using Other Performance Monitoring Tools 
434
Troubleshooting Active Directory Performance 
Monitoring 
442
Backup and Recovery of Active Directory 
442
Overview of the Windows Server 2008 R2 Backup 
Utility 
444
Backing Up Active Directory 
448
Restoring Active Directory 
449
Active Directory Recycle Bin 
451
Restartable Active Directory 
451
Offline Maintenance 
452
Monitoring Replication 
453
Using the ADSI Editor 
454
Summary 
454
Exam Essentials 
455
Review Questions 
457
Answers to Review Questions 
460

Contents 
xix
Part II 
MCTS: Windows Server 2008 R2 
Network Infrastructure Configuration 
(Exam 70-642) 
461
Chapter 11 
Understanding Windows Server 2008 R2 
Networking 
463
Understanding the OSI Model 
464
Protocol Stacks 
466
Communication between Stacks 
475
How Microsoft’s Network Components Work with the 
OSI Model 
476
Device Drivers and the OSI Model 
477
Network Protocol Basics 
477
About Windows Network Models 
484
Windows Peer-to-Peer Network 
484
Summary 
486
Exam Essentials 
486
Review Questions 
487
Answers to Review Questions 
490
Chapter 12 
Configuring TCP/IP 
493
Understanding TCP/IP 
494
Details of the TCP/IP Model 
494
How TCP/IP Layers Communicate 
495
Understanding Port Numbers 
496
Understanding IP Addressing 
497
The Hierarchical IP Addressing Scheme 
497
Understanding Network Classes 
499
Subnetting a Network 
502
Implementing Subnetting 
503
An Easier Way to Apply Subnetting 
509
Applying Subnetting the Traditional Way 
514
Working with Classless Inter-Domain Routing 
522
Understanding IPv6 
525
IPv6 History and Need 
525
IPv6 New and Improved Concepts 
526
IPv6 Addressing Concepts 
528
IPv6 Integration/Migration 
533
Summary 
537
Exam Essentials 
538
Review Questions 
539
Answers to Review Questions 
542

xx 
Contents
Chapter 13 
Managing DHCP and DNS 
545
Overview of DHCP 
546
Introducing the DORA Process 
547
Advantages and Disadvantages of DHCP 
548
ipconfig Lease Options 
549
Understanding Scope Details 
550
Installing and Authorizing DHCP 
552
Installing DHCP 
552
Introducing the DHCP Snap-in 
553
Authorizing DHCP for Active Directory 
554
Creating and Managing DHCP Scopes 
556
Creating a New Scope in IPv4 
556
Creating a New Scope in IPv6 
563
Changing Scope Properties (IPv4 and IPv6) 
567
Changing Server Properties 
568
Managing Reservations and Exclusions 
571
Setting Scope Options for IPv4 
574
Activating and Deactivating Scopes 
577
Creating a Superscope for IPv4 
577
Creating IPv4 Multicast Scopes 
578
Integrating Dynamic DNS and IPv4 DHCP 
581
Using Multiple DHCP Servers 
583
Working with the DHCP Database Files 
583
DNS 
585
Understanding DNS Components 
585
Summary 
587
Exam Essentials 
587
Review Questions 
590
Answers to Review Questions 
593
Chapter 14 
Managing Routing and Remote Access 
595
Understanding Routing 
596
What Routing Does 
596
How Routing Works 
597
Routing in Windows Server 2008 R2 
606
Installing RRAS 
608
Configuring IP Routing 
609
Creating and Managing Interfaces 
609
Setting IP Routing Properties 
620
Managing Routing Protocols 
622
Managing Static Routes 
625
Configuring TCP/IP Packet Filters 
627

Contents 
xxi
Configuring VPN Packet Filters 
630
PPTP Packet Filters 
630
L2TP Packet Filters 
631
Managing IP Routing 
631
Using the routeprint Command 
633
Troubleshooting IP Routing 
633
Troubleshooting Example 
633
Summary 
635
Exam Essentials 
635
Review Questions 
637
Answers to Review Questions 
640
Chapter 15 
Managing Remote Access Services 
643
Overview of Dial-Up Networking 
644
What DUN Does 
645
How DUN Works 
645
Overview of Virtual Private Networks 
649
What VPNs Do 
649
VPNs and Windows Server 2008 R2 
650
How VPNs Work 
650
Configuring Your Remote Access Server 
654
Configuring PPP Options 
654
Installing a VPN 
657
How VPN Works 
658
Enabling RRAS as a VPN 
659
Configuring a VPN 
659
Configuring VPN Ports 
659
Troubleshooting VPNs 
660
Managing Your Remote Access Server 
662
Managing Remote Users with a RADIUS Server 
662
Monitoring Overall Activity 
663
Controlling Remote Access Logging 
663
Reviewing the Remote Access Event Log 
666
Monitoring Ports and Port Activity 
666
Configuring a RAS or VPN Client 
667
The General Tab 
667
The Options Tab 
668
The Security Tab 
670
The Networking Tab 
671
The Sharing Tab 
672
Introduction to Authentication Protocols 
672

xxii 
Contents
Overview of Wireless Access 
673
Configuring Wireless Access 
674
Summary 
676
Exam Essentials 
676
Review Questions 
677
Answers to Review Questions 
681
Chapter 16 
Managing Security for Remote Access Services 
683
Remote Access Security 
684
User Authentication 
684
Connection Security 
686
Access Control 
687
Configuring User Access 
687
Setting Up User Profiles 
687
Using Network Access Policies 
689
Using Remote Access Profiles 
694
Setting Up a VPN Network Access Policy 
699
Configuring Security 
701
Controlling Server Security 
701
Configuring Network Access Protection 
704
Configuring Windows Firewall Options 
706
Windows Firewall with Advanced Security 
708
Troubleshooting Techniques 
714
Summary 
716
Exam Essentials 
716
Review Questions 
718
Answers to Review Questions 
723
Chapter 17 
Managing File and Print Services 
725
Understanding File Servers 
726
Configuring File Servers 
727
Sharing Folders 
728
Making Active Directory Objects Available to Users 
728
Configuring Offline Folders 
729
Understanding Permissions 
731
Share and Storage Management console 
738
Using BitLocker Drive Encryption 
739
Understanding BranchCache 
739
Distributed Cache Mode Requirements 
740
Hosted Mode Requirements 
742
Configuring DirectAccess 
743
DirectAccess vs. VPNs 
743
Understanding How DirectAccess Works 
743
Knowing the DirectAccess Infrastructure Requirements 
744
Configuring Disk Quotas 
745

Contents 
xxiii
Configuring Distributed File System 
747
Advantages of DFS 
747
Types of DFS 
748
Using the DFS Management Console 
749
Understanding Printing 
750
Creating and Publishing Printers 
751
Configuring Printers 
752
Migrating Print Servers 
757
Summary 
757
Exam Essentials 
758
Review Questions 
759
Answers to Review Questions 
763
Chapter 18 
Monitoring and Managing a Network 
Infrastructure 
765
Configuring Windows Server Update Services 
767
Windows Update 
768
Windows Automatic Updates 
768
Using Windows Server Update Services 
770
Overview of Windows Server 2008 R2 Performance 
Monitoring 
777
Using Windows Server 2008 R2 Performance Tools 
779
Introducing the Reliability and Performance Monitor 
779
Using Other Performance-Monitoring Tools 
789
Backup and Recovery 
802
Wbadmin Command Line Utility 
803
Understanding Shadow Copies 
803
Summary 
805
Exam Essentials 
805
Review Questions 
807
Answers to Review Questions 
811
Part III 
MCTS: Windows Server 2008 R2 
Applications Infrastructure 
Configuration (Exam 70-643) 
813
Chapter 19 
Windows Server 2008 R2 Storage Services 
815
Storage in Windows Server 2008 R2 
816
Initializing Disks 
816
Working with Basic and Dynamic Disks 
817
Working with Volume Sets 
819
Redundant Array of Independent Disks 
820
Mount Points 
824

xxiv 
Contents
Microsoft MPIO 
824
iSCSI 
826
Internet Storage Name Service 
828
Fibre Channel 
829
Network Attached Storage 
830
Managing SANs 
830
Virtual Disk Service 
830
Storage Manager for SANs 
832
Storage Explorer 
833
Working with Virtualization 
834
Benefits of Virtualization 
835
Features of Microsoft Hyper-V 
835
Virtualization Concepts 
836
Understanding Virtual Hard Disks 
837
Summary 
838
Exam Essentials 
838
Review Questions 
839
Answers to Review Questions 
841
Chapter 20 
Remote Desktop Services in Windows 
Server 2008 R2 
843
Remote Desktop Connection Display 
845
Custom Display Resolutions 
845
Monitor Spanning 
846
Font Smoothing 
846
Display Data Prioritization 
847
Desktop Experience 
847
Device Redirection 
850
Single Sign-On for Remote Desktop Services 
852
Remote Desktop Protocol Signing 
853
RDP 7.0 Benefits 
853
Understanding RemoteFX 
854
Benefits of Using RemoteFX 
854
Prepare and Configure the Use of Remote Desktop 
Services RemoteApp 
855
Terminal Services Web Access 
855
Installing Programs to Be Used with RemoteApp 
856
Prepare and Configure Remote Desktop Services Gateway 
858
Preparing the Necessary RD Gateway Role Services 
858
Obtaining and Configuring a Certificate for RD 
Gateway 
858
Creating Remote Desktop Services Connection 
Authorization Policies 
860

Contents 
xxv
Creating Remote Desktop Services Resource 
Authorization Policies 
861
Configuring the Remote Desktop Services Client 
for RD Gateway 
862
Configuring Remote Desktop Services Load Balancing 
862
Configuring a Remote Desktop Services Server Farm 
with RD Connection Broker 
863
Configuring Network Load Balancing 
865
Configuring Remote Desktop Licensing 
866
Remote Desktop Services Client Access Licenses 
866
Installing RD Licensing and RD Client Access 
Licenses 
867
Configuring License Settings on an RD Session Host 
872
Remote Administration in Windows Server 2008 R2 
874
Managing Remote Desktop Services through Group Policy 
874
Group Policy Settings for Remote Desktop Services 
875
Configuring Global Deployment Settings for 
RemoteApp 
877
Monitoring RD Gateway Using RD Gateway 
Manager 
880
Summary 
882
Exam Essentials 
884
Review Questions 
885
Answers to Review Questions 
887
Chapter 21 
Configuring Web Services Infrastructure 
889
Configuring Web Applications 
890
Installing IIS 7.5 
891
Creating and Configuring Websites 
892
Configuring a File Transfer Protocol Server 
903
Configuring Permissions 
904
Configuring FTP Site for Extranet Users 
905
FTP IPv4 and Domain Restrictions 
905
WebDAV and FTP 
906
Configuring a Simple Mail Transfer Protocol Server 
907
Configuring General SMTP Virtual Server Properties 
907
Configuring Access 
909
Configuring Message Size and Transfer Limits 
910
Configuring Delivery Options 
911
Summary 
914
Exam Essentials 
915
Review Questions 
916
Answers to Review Questions 
918

xxvi 
Contents
Chapter 22 
Advanced Web Infrastructure Configuration 
919
Managing Internet Information Services 
920
Configuring Monitoring and Logging 
921
Backup and Restore 
927
Delegating Administrative Rights 
929
Configuring Secure Sockets Layer Security 
932
Requesting and Renewing SSL Certificates 
933
Enabling SSL on a Website 
935
Exporting and Importing Certificates 
936
Configuring Website Authentication and Permissions 
937
Configuring Application Access 
939
Client Certificate Mapping 
940
Summary 
941
Exam Essentials 
941
Review Questions 
942
Answers to Review Questions 
944
Chapter 23 
Configuring Additional Communication 
Services 
945
Configuring Fax Services 
946
Configuring Fax (Local) Properties 
947
Defining a Dialing Rule 
949
Defining a Fax Routing Location 
950
Configuring a Media Server 
951
Configuring Basic Streaming Solutions 
953
Configuring Advanced Streaming Solutions 
958
Options for Configuring Security in a Windows 
Media Server 
961
Web-Based Administration 
964
Configuring Digital Rights Management 
964
How Does DRM Work? 
965
Encryption 
966
Sharing Business Rules 
967
Configuring License Delivery 
968
Configuring Policy Templates 
969
Summary 
971
Exam Essentials 
971
Review Questions 
972
Answers to Review Questions 
974
Chapter 24 
Configuring Windows SharePoint 2010 
Foundation 
975
Configuring SharePoint Foundation 2010 
976
Configuring Incoming Email Settings 
977

Contents 
xxvii
Configuring Outgoing Email Settings 
979
Configuring Workflow Settings 
982
Configuring Diagnostic Logging Settings 
984
Configuring Antivirus Settings 
985
Configuring Backups 
987
Recovery 
989
Audience Targeting 
990
SharePoint Permissions 
991
Configuring Windows SharePoint Foundation 2010 Sites 
992
Upgrading from WSS 3.0 
993
Configuring Alternate Access Mapping 
996
Creating Quota Templates 
997
Creating Site Collections 
998
Enabling Access for End Users 
998
Configuring Authentication for SharePoint Foundation 2010 
999
Configure Digest Authentication 
1000
Configuring Web SSO Authentication by Using ADFS 
1001
Summary 
1001
Exam Essentials 
1002
Review Questions 
1003
Answers to Review Questions 
1005
Chapter 25 
Using Virtualization in Windows Server 2008 R2 
1007
Hyper-V Overview 
1008
What Is Virtualization? 
1008
Hyper-V Features 
1009
Hyper-V Architecture 
1010
Hyper-V Requirements 
1012
Hyper-V Installation and Configuration 
1013
Install the Hyper-V Role 
1013
Hyper-V in Server Manager 
1015
Using Hyper-V Manager 
1015
Configure Hyper-V Settings 
1016
Manage Virtual Networks 
1017
Managing Virtual Hard Disks 
1020
Configuring Virtual Machines 
1025
Creating and Managing Virtual Machines 
1025
Back Up and Restore Virtual Machines 
1032
Summary 
1036
Exam Essentials 
1037
Review Questions 
1038
Answers to Review Questions 
1040

xxviii 
Contents
Chapter 26 
Deploying Servers 
1041
Windows Deployment Services 
1042
Deploying Images by Using Windows Deployment Services 
1043
Using Windows Deployment Services 
1044
Configuring WDS 
1046
Image Types 
1049
Capturing Images 
1050
Deploying Server Core 
1052
Configuring Microsoft Windows Activation 
1054
Installing KMS 
1055
Configuring KMS 
1057
Summary 
1059
Exam Essentials 
1060
Review Questions 
1061
Answers to Review Questions 
1063
Chapter 27 
Configuring High Availability in Windows 
Server 2008 R2 
1065
Components of High Availability 
1066
Achieving High Availability 
1067
High Availability Foundation 
1067
Achieving High Availability with Failover Clustering 
1069
Failover Clustering Requirements 
1071
Cluster Quorum 
1072
Validating a Cluster Configuration 
1074
Creating a Cluster 
1078
Clustered Application Settings 
1081
Resource Properties 
1083
New Windows Server 2008 R2 Clustering Features 
1086
Achieving High Availability with Network Load Balancing 
1087
How Does Network Load Balancing Work? 
1087
Network Load Balancing Requirements 
1088
Creating an NLB Cluster 
1089
Modifying Cluster Properties 
1089
Managing NLB Clusters 
1091
Summary 
1092
Exam Essentials 
1092
Review Questions 
1093
Answers to Review Questions 
1095
Appendix  
About the Companion CD 
1097
Index 
1101

Table of Exercises
Exercise 2.1 
Installing and Configuring the DNS Service  . . . . . . . . . . . . . . . . . . . . . . . 68
Exercise 2.2 
Configuring a Zone for Dynamic Updates  . . . . . . . . . . . . . . . . . . . . . . . . . 73
Exercise 2.3 
Creating a Delegated DNS Zone  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74
Exercise 2.4 
Manually Creating DNS RRs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
Exercise 2.5 
Simple DNS Testing  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80
Exercise 2.6 
Using the Nslookup Command  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
Exercise 3.1 
Viewing Disk Configuration  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 101
Exercise 3.2 
Promoting a Domain Controller. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 110
Exercise 3.3 
Viewing the Active Directory Event Log . . . . . . . . . . . . . . . . . . . . . . . . . . 115
Exercise 3.4 
Joining a Computer to an Active Directory Domain . . . . . . . . . . . . . . . . 120
Exercise 3.5 
Configuring DNS Integration with Active Directory  . . . . . . . . . . . . . . . . 127
Exercise 4.1 
Creating a New Subdomain . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 144
Exercise 4.2 
Creating a New Domain Tree in the Forest. . . . . . . . . . . . . . . . . . . . . . . . 150
Exercise 4.3 
Assigning Single-Master Operations  . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160
Exercise 4.4 
Managing Trust Relationships . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 164
Exercise 4.5 
Adding a UPN Suffix . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168
Exercise 4.6 
Managing GC Servers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 170
Exercise 4.7 
Managing Universal Group Membership Caching  . . . . . . . . . . . . . . . . . 171
Exercise 5.1 
Creating Sites. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 190
Exercise 5.2 
Creating Subnets . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193
Exercise 5.3 
Configuring Sites. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195
Exercise 5.4 
Creating Site Links and Site Link Bridges. . . . . . . . . . . . . . . . . . . . . . . . . 201
Exercise 5.5 
Moving Server Objects Between Sites . . . . . . . . . . . . . . . . . . . . . . . . . . . 203
Exercise 6.1 
Installing Active Directory Certificate Services. . . . . . . . . . . . . . . . . . . . 225
Exercise 6.2 
Configuring Certificate Auto Enrollment  . . . . . . . . . . . . . . . . . . . . . . . . . 230
Exercise 6.3 
Modifying the AIA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 233
Exercise 6.4 
Revoking a Certificate. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 234
Exercise 6.5 
Backing Up the Certification Authority Server  . . . . . . . . . . . . . . . . . . . . 235
Exercise 6.6 
Installing the AD FS. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 243
Exercise 6.7 
Installing AD LDS. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 246
Exercise 6.8 
Configuring an AD LDS Instance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 247
Exercise 6.9 
Installing AD RMS  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 252
Exercise 6.10 
Creating an AD RMS Template. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 255

Exercise 7.1 
Creating an OU Structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 272
Exercise 7.2 
Modifying OU Structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 275
Exercise 7.3 
Using the Delegation of Control Wizard . . . . . . . . . . . . . . . . . . . . . . . . . . 278
Exercise 7.4 
Delegating Custom Tasks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 279
Exercise 7.5 
Creating Active Directory Objects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 284
Exercise 7.6 
Creating a User Template . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 288
Exercise 7.7 
Managing Object Properties  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 291
Exercise 7.8 
Moving Active Directory Objects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 297
Exercise 7.9 
Resetting an Existing Computer Account. . . . . . . . . . . . . . . . . . . . . . . . . 298
Exercise 7.10 
Creating and Publishing a Printer  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 299
Exercise 7.11 
Creating and Publishing a Shared Folder . . . . . . . . . . . . . . . . . . . . . . . . . 301
Exercise 7.12 
Finding Objects in Active Directory. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 302
Exercise 8.1 
Creating a Group Policy Object Using the GPMC  . . . . . . . . . . . . . . . . . . 323
Exercise 8.2 
Linking Existing GPOs to Active Directory. . . . . . . . . . . . . . . . . . . . . . . . 325
Exercise 8.3 
Filtering Group Policy Using Security Groups. . . . . . . . . . . . . . . . . . . . . 328
Exercise 8.4 
Delegating Administrative Control of Group Policy  . . . . . . . . . . . . . . . . 329
Exercise 8.5 
Configuring Automatic Certificate Enrollment in Group Policy. . . . . . . 337
Exercise 8.6 
Configuring Folder Redirection in Group Policy  . . . . . . . . . . . . . . . . . . . 338
Exercise 8.7 
Creating a Software Deployment Share. . . . . . . . . . . . . . . . . . . . . . . . . . 348
Exercise 8.8 
Publishing and Assigning Applications Using Group Policy . . . . . . . . . 350
Exercise 8.9 
Applying Software Updates. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 351
Exercise 9.1 
Creating and Managing Users and Groups  . . . . . . . . . . . . . . . . . . . . . . . 389
Exercise 9.2 
Creating and Using User Templates  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 391
Exercise 9.3 
Delegating Control of Active Directory Objects  . . . . . . . . . . . . . . . . . . . 392
Exercise 9.4 
Applying Security Policies by Using Group Policy  . . . . . . . . . . . . . . . . . 395
Exercise 9.5 
Fine-Grained Password Policy . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 397
Exercise 9.6 
Configuring Group Policy to Require Smart Card Logon . . . . . . . . . . . . 400
Exercise 9.7 
Enabling Auditing of Active Directory Objects  . . . . . . . . . . . . . . . . . . . . 406
Exercise 9.8 
Enabling Auditing for a Specific OU  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 407
Exercise 9.9 
Generating and Viewing Audit Logs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 407
Exercise 10.1 
 Monitoring Domain Controller and Active Directory Performance 
with Windows Server 2008 R2 Performance Monitor. . . . . . . . . . . . . . . 433
Exercise 10.2 
Backing Up Active Directory  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 448
Exercise 13.1 
Installing the DHCP Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 552
Exercise 13.2 
Unauthorizing a DHCP Server  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 555
xxx 
Table of Exercises

Exercise 13.3 
Authorizing a DHCP Server  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 555
Exercise 13.4 
Creating a New Scope. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 562
Exercise 13.5 
Configuring User Class Options  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 576
Exercise 13.6 
Creating a New Multicast Scope . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 579
Exercise 13.7 
Enabling DHCP-DNS Integration  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 583
Exercise 14.1 
Installing RRAS for IP Routing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 608
Exercise 14.2 
Creating a Demand-Dial Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 614
Exercise 14.3 
Installing the RIP Protocols  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 623
Exercise 14.4 
Adding and Removing Static Routes  . . . . . . . . . . . . . . . . . . . . . . . . . . . . 626
Exercise 14.5 
Configuring PPTP Packet Filters  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 630
Exercise 14.6 
Monitoring Routing Status. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 632
Exercise 14.7 
Troubleshooting Your Server. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 634
Exercise 15.1 
Configuring Incoming Connections  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 657
Exercise 15.2 
Changing Remote Access Logging Settings  . . . . . . . . . . . . . . . . . . . . . . 665
Exercise 16.1 
Creating a Network Access Policy. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 693
Exercise 16.2 
Restricting a User Profile for Dial-In Access  . . . . . . . . . . . . . . . . . . . . . . 694
Exercise 16.3 
Configuring Encryption. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 698
Exercise 16.4 
Creating a VPN Network Access Policy  . . . . . . . . . . . . . . . . . . . . . . . . . . 700
Exercise 16.5 
Configuring Windows Firewall. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 711
Exercise 17.1 
Creating and Publishing a Shared Network Folder . . . . . . . . . . . . . . . . . 728
Exercise 17.2 
Configuring Offline Folder Options. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 730
Exercise 17.3 
Configuring a Shared Network Folder for Offline Access  . . . . . . . . . . . 731
Exercise 17.4 
Configuring Shared and NTFS Settings . . . . . . . . . . . . . . . . . . . . . . . . . . 737
Exercise 17.5 
Configuring BranchCache Firewall Exceptions  . . . . . . . . . . . . . . . . . . . . 740
Exercise 17.6 
Installing BranchCache on a Windows Server 2008 R2 Machine  . . . . . 742
Exercise 17.7 
Installing the DirectAccess Feature. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 744
Exercise 17.8 
Configuring Disk Quotas. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 746
Exercise 17.9 
Installing the DFS Namespace Service. . . . . . . . . . . . . . . . . . . . . . . . . . . 748
Exercise 17.10 Configuring DFS  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 750
Exercise 17.11 Creating and Publishing a Printer  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 751
Exercise 18.1 
Installing a WSUS Server . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 772
Exercise 18.2 
Setting WSUS Server Options. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 773
Exercise 18.3 
Configuring a GPO for WSUS  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 776
Exercise 18.4 
Installing SNMP . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 801
Exercise 18.5 
Configuring SNMP. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 802
Table of Exercises 
xxxi

Exercise 18.6 
Configuring a Shadow Copy on a Volume  . . . . . . . . . . . . . . . . . . . . . . . . 804
Exercise 19.1 
Initializing Disk Drives. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 817
Exercise 19.2 
Converting a Basic Disk to a Dynamic Disk  . . . . . . . . . . . . . . . . . . . . . . . 818
Exercise 19.3 
Creating a Volume Set. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 819
Exercise 19.4 
Creating Mount Points  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 824
Exercise 19.5 
Installing Microsoft MPIO. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 825
Exercise 19.6 
Configuring iSCSI Storage Connection  . . . . . . . . . . . . . . . . . . . . . . . . . . 827
Exercise 19.7 
Installing the iSNS Feature on Windows Server 2008 R2. . . . . . . . . . . . 828
Exercise 19.8 
Installing Storage Manager for SANs . . . . . . . . . . . . . . . . . . . . . . . . . . . . 832
Exercise 20.1 
Enabling Font Smoothing on a Client Computer. . . . . . . . . . . . . . . . . . . 846
Exercise 20.2 
Enabling the Desktop Experience Feature  . . . . . . . . . . . . . . . . . . . . . . . . 848
Exercise 20.3 
Starting the Themes Service  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 849
Exercise 20.4 
Setting the Theme on Windows Server 2008 R2. . . . . . . . . . . . . . . . . . . 849
Exercise 20.5 
Making Desktop Composition Available on a Windows 7 Client. . . . . . 849
Exercise 20.6 
Redirecting Plug and Play Devices  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 850
Exercise 20.7 
 Configuring Authentication of a Windows 2008 R2 Remote 
Desktop Services Server  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 852
Exercise 20.8 
Configuring SSO on a Client Computer  . . . . . . . . . . . . . . . . . . . . . . . . . . 852
Exercise 20.9 
Installing the Remote Desktop Services Role  . . . . . . . . . . . . . . . . . . . . . 856
Exercise 20.10 Installing a Certificate on the RD Gateway Server  . . . . . . . . . . . . . . . . . 859
Exercise 20.11 Mapping the Certificate to the RD Gateway Server  . . . . . . . . . . . . . . . . 860
Exercise 20.12 Creating an RD CAP for the RD Gateway Server . . . . . . . . . . . . . . . . . . . 860
Exercise 20.13 Creating an RD RAP and Specifying Computers . . . . . . . . . . . . . . . . . . . 861
Exercise 20.14 Configuring DNS for RD Connection Broker Load Balancing  . . . . . . . . 864
Exercise 20.15 Installing NLB and Creating an NLB Cluster. . . . . . . . . . . . . . . . . . . . . . . 865
Exercise 20.16 Installing RD Licensing Role Service. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 868
Exercise 20.17 Installing RD Licensing Manager as a Feature. . . . . . . . . . . . . . . . . . . . . 868
Exercise 20.18 Activating an RD License Server . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 869
Exercise 20.19 Installing Remote Desktop Services Client Access Licenses. . . . . . . . . 871
Exercise 20.20 Configuring RemoteApp Global Deployment Settings. . . . . . . . . . . . . . 878
Exercise 20.21  Configuring RD RemoteApp RD Gateway Global Deployment 
Settings. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 879
Exercise 20.22  Configuring RD RemoteApp Common RDP Global Deployment 
Settings. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 879
Exercise 20.23  Configuring RD RemoteApp Digital Signature Global 
Deployment Settings  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 880
xxxii 
Table of Exercises

Exercise 20.24 Specifying RD Gateway Events to Log  . . . . . . . . . . . . . . . . . . . . . . . . . . . 881
Exercise 20.25  Viewing User Connection Information through RD Gateway 
Manager  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 882
Exercise 21.1 
Installing IIS 7.5  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 892
Exercise 21.2 
Creating a Site Using Host Headers  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 895
Exercise 21.3 
Installing IIS Modules . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 896
Exercise 22.1 
Using AppCmd.exe to List Configured Websites  . . . . . . . . . . . . . . . . . . . 920
Exercise 22.2 
Enabling Failed Request Tracing  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 921
Exercise 22.3 
Modifying Configuration History Settings. . . . . . . . . . . . . . . . . . . . . . . . 927
Exercise 22.4 
 Delegating Administrative Permissions for Administration 
of a Website  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 929
Exercise 22.5 
Enabling SSL on a Web Server  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 935
Exercise 23.1 
Installing the Fax Server Role  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 948
Exercise 23.2 
Configuring Fax Properties  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 949
Exercise 23.3 
Configuring a Dialing Rule  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 950
Exercise 23.4 
Installing and Creating a Broadcast Publishing Point. . . . . . . . . . . . . . . 956
Exercise 23.5 
Configuring a Multicast Stream. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 957
Exercise 23.6 
Enabling Fast Cache  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 959
Exercise 23.7 
Enabling Advanced Fast Start  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 960
Exercise 23.8 
Enabling FEC  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 960
Exercise 23.9 
Setting Client Connect Attempts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 961
Exercise 23.10 Changing the Anonymous Account  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 962
Exercise 23.11 Allowing or Denying IP Addresses  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 963
Exercise 23.12 Creating an ACL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 963
Exercise 23.13 Installing the Web-Based Administration role. . . . . . . . . . . . . . . . . . . . . 964
Exercise 23.14 Using AD DRM to Protect a Document . . . . . . . . . . . . . . . . . . . . . . . . . . . 967
Exercise 23.15 Configuring Users’ Exclusions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 968
Exercise 23.16 Configuring Application Exclusions  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 969
Exercise 23.17 Configuring Policy Templates  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 970
Exercise 24.1 
Configuring Incoming E-mail Settings  . . . . . . . . . . . . . . . . . . . . . . . . . . . 979
Exercise 24.2 
Configuring Outgoing E-mail Settings  . . . . . . . . . . . . . . . . . . . . . . . . . . . 981
Exercise 24.3 
 Configuring Outgoing E-mail Settings for a Specific 
Web Application  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 981
Exercise 25.1 
Installing Hyper-V in Full Installation Mode . . . . . . . . . . . . . . . . . . . . . . 1014
Exercise 25.2 
Creating an Internal Virtual Network  . . . . . . . . . . . . . . . . . . . . . . . . . . . 1019
Exercise 25.3 
Creating a Differencing Hard Disk . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1021
Table of Exercises 
xxxiii

Exercise 25.4 
Creating a Fixed-Size Disk and Cloning a Local Drive. . . . . . . . . . . . . . 1022
Exercise 25.5 
Adding a Pass-Through Disk to a Virtual Machine  . . . . . . . . . . . . . . . . 1023
Exercise 25.6 
Creating a New Virtual Machine  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1026
Exercise 25.7 
Installing Hyper-V Integration Components. . . . . . . . . . . . . . . . . . . . . . 1032
Exercise 25.8 
Creating a Snapshot of a Virtual Machine  . . . . . . . . . . . . . . . . . . . . . . . 1034
Exercise 25.9 
Applying a Snapshot. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1035
Exercise 26.1 
Installing the WDS Role  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1045
Exercise 26.2 
Configuring a WDS Server for First Use. . . . . . . . . . . . . . . . . . . . . . . . . 1047
Exercise 26.3 
Configuring WDS Server Properties . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1049
Exercise 26.4 
Creating a Capture Image Using the Wizard  . . . . . . . . . . . . . . . . . . . . . 1051
Exercise 26.5 
Using WDSUTIL to Create a Capture Image . . . . . . . . . . . . . . . . . . . . . . . 1052
Exercise 26.6 
Installing a KMS Host  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1056
Exercise 27.1 
Installing the Failover Cluster Feature  . . . . . . . . . . . . . . . . . . . . . . . . . . 1075
Exercise 27.2 
Running the Validate a Configuration Wizard  . . . . . . . . . . . . . . . . . . . . 1077
Exercise 27.3 
Creating a Cluster  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1078
Exercise 27.4 
Clustering the Print Service  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1080
Exercise 27.5 
Using the Dependency Viewer. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1083
Exercise 27.6 
Creating a Network Load Balancing Cluster. . . . . . . . . . . . . . . . . . . . . . 1089
xxxiv 
Table of Exercises

 Introduction   
 This book was written with over 20 years of IT experience. We have taken that experience 
and translated it into a Windows Server 2008 R2 book that will help you not only prepare 
for the MCTS: Windows Server 2008 exams but also develop a clear understanding of how 
to install and conﬁ gure Windows Server 2008 R2 while avoiding the possible conﬁ guration 
pitfalls. 
 Many Microsoft books just explain the Windows operating system, but with  MCTS: 
Windows Server 2008 R2 Complete Study Guide , we go a step further, providing many 
in - depth, step - by - step procedures to support our explanations of how the operating system 
performs at its best. 
 Microsoft Windows Server 2008 R2 is the newest version of Microsoft ’ s server operating 
system software. Microsoft has taken the best of Windows Server 2003 and Windows Server 
2008 and combined them into their latest creation, Windows Server 2008 R2. 
 Windows Server 2008 R2 eliminates many of the problems that plagued Windows 
Server 2003 and Windows Server 2008 and provides a much faster boot time and 
shutdown. It is also easier to install and conﬁ gure, and it barely stops to ask the user any 
questions during installation. In this book, we will show you what features are installed 
during the automated installation and where you can make changes if you need to be more 
in charge of your operating system and its features. 
 This book takes you through all the ins and outs of Windows Server 2008 R2, including 
installation, conﬁ guration, Group Policy objects, auditing, backups, and so much more. 
 Windows Server 2008 R2 has improved on Microsoft ’ s desktop environment, made 
networking easier, enhanced search ability, and improved performance — and that ’ s only 
scratching the surface. 
 When all is said and done, this is a technical book for IT professionals who want to take 
Windows Server 2008 R2 to the next step and get certiﬁ ed. With this book, you will not 
only learn Windows Server 2008 R2 and hopefully pass the exams, but you will become a 
Windows Server 2008 R2 expert.  
 The Microsoft Certification Program 
 Since the inception of its certiﬁ cation program, Microsoft has certiﬁ ed more than 
two million people. As the computer network industry continues to increase in both size 
and complexity, this number is sure to grow — and the need for  proven ability will also 
increase. Certiﬁ cations can help companies verify the skills of prospective employees and 
contractors. 
 Microsoft has developed its certiﬁ cation program to give you credentials that verify your 
ability to work with Microsoft products effectively and professionally. Several levels of 

xxxvi 
Introduction
certiﬁ cation are available based on speciﬁ c suites of exams. Microsoft has recently created 
a new generation of certiﬁ cation programs:  
  Microsoft Certified Technology Specialist (MCTS)   The MCTS can be considered the 
entry - level certiﬁ cation for the new generation of Microsoft certiﬁ cations. The MCTS 
certiﬁ cation program targets speciﬁ c technologies instead of speciﬁ c job roles. You must 
take and pass one to three exams.  
  Microsoft Certified IT Professional (MCITP)   The MCITP certiﬁ cation is a Professional 
Series certiﬁ cation that tests network and systems administrators on job roles rather than 
only on a speciﬁ c technology. The MCITP generally consists of passing one to three exams 
in addition to obtaining an MCTS - level certiﬁ cation.  
  Microsoft Certified Professional Developer (MCPD)   The MCPD certiﬁ cation is a 
Professional Series certiﬁ cation for application developers. Similar to the MCITP, the 
MCPD is focused on a job role rather than on a single technology. The MCPD generally 
consists of passing one to three exams in addition to obtaining an MCTS - level certiﬁ cation.  
  Microsoft Certified Master (MCM)   The MCM program includes three weeks of highly 
intensive classroom training, three computer - based tests, and one lab - based exam per 
training rotation.  
 Microsoft Certified Architect (MCA)   The MCA is Microsoft ’ s premier certiﬁ cation 
series. Obtaining the MCA requires a minimum of 10 years of experience and requires the 
candidate to pass a review board consisting of peer architects.  
 In addition to the above professional - level certifications, Microsoft also 
offers some more user - lever certifications, including certifications for 
Office users through its Microsoft Office Specialist certification program 
and those new to IT through its brand - new Microsoft Technology 
Associate (MTA) program. To learn more about these, visit Microsoft 
Learning at  www.microsoft.com/learning . 
 How Do You Become Certified on Windows Server 2008? 
 Attaining a Microsoft certiﬁ cation has always been a challenge. In the past, students have 
been able to acquire detailed exam information — even most of the exam questions — from 
online  “ brain dumps ” and third - party  “ cram ” books or software products. For the new 
generation of exams, this is simply not the case. 
 Microsoft has taken strong steps to protect the security and integrity of its new 
certiﬁ cation tracks. Now prospective candidates must complete a course of study that 
develops detailed knowledge about a wide range of topics. It supplies them with the true 
skills needed, derived from working with the technology being tested. 

Introduction 
xxxvii
 The new generation of Microsoft certiﬁ cation programs are heavily weighted toward 
hands - on skills and experience. It is recommended that candidates have troubleshooting 
skills acquired through hands - on experience and working knowledge. 
 Fortunately, if you are willing to dedicate the time and effort to learn Windows Server 
2008 R2, you can prepare yourself well for the exam by using the proper tools. By working 
through this book, you can successfully meet the requirements to pass the Windows Server 
2008 R2 exams.  
 MCTS Exam Requirements 
 Candidates for MCTS certiﬁ cation on Windows Server 2008 must pass at least one of the 
three Windows Server 2008 exams: 
 
 70 - 640: TS: Windows Server 2008 R2 Active Directory Configuration  
 
 70 - 642: TS: Windows Server 2008 R2 Network Infrastructure Configuration  
 
 70 - 643: TS: Windows Server 2008 R2 Applications Infrastructure Configuration  
 In late 2010, Microsoft Learning updated the MCTS: Windows Server 2008 
exams to include questions on the most up - to - date operating system, R2. 
 Each exam is also a requirement for anybody looking to achieve his or her MCITP in 
Windows Server 2008. Exams 70 - 640 and 70 - 642 are required for the MCITP: Server 
Administrator certiﬁ cation, and all three are required for those looking to get their 
MCITP: Enterprise Administrator certiﬁ cation. 
 Microsoft provides exam objectives to give you a general overview of possible areas of 
coverage on the Microsoft exams. Keep in mind, however, that exam objectives are subject 
to change at any time without prior notice and at Microsoft ’ s sole discretion. Please visit 
the Microsoft Learning website ( www.microsoft.com/learning/mcp ) for the most current 
listing of exam objectives.  
 Other MCTS certifications may require up to three exams. For a more 
detailed description of the Microsoft certification programs, including a list 
of all the exams, visit the Microsoft Learning website.  
 Types of Exam Questions 
 In an effort to both reﬁ ne the testing process and protect the quality of its certiﬁ cations, 
Microsoft has focused its newer certiﬁ cation exams on real experience and hands - on 
proﬁ ciency. There is a greater emphasis on your past working environments and 
responsibilities and less emphasis on how well you can memorize. In fact, Microsoft says 

xxxviii 
Introduction
that certiﬁ cation candidates should have hands - on experience before attempting to 
pass any certiﬁ cation exams.  
 Microsoft will accomplish its goal of protecting the exams ’ integrity by 
regularly adding and removing exam questions.  
 Exam questions may be in a variety of formats. Depending on which exam you take, 
you ’ ll see multiple choice questions, as well as drag - and - drop, build list and reorder, and 
hot area questions. Simulations and case study – based formats are included as well. You 
may also ﬁ nd yourself taking what ’ s called an  adaptive format exam . Let ’ s take a look 
at the types of exam questions and examine the adaptive testing technique so you ’ ll be 
prepared for all of the possibilities.  
 With the release of Windows 2000, Microsoft stopped providing a detailed 
score breakdown. This is mostly because of the various and complex 
question formats. Previously, each question focused on one objective. 
However, recent exams, such as the Windows Server 2008 Active Directory 
exam, contain questions that may be tied to one or more objectives from 
one or more objective sets. Therefore, grading by objective is almost 
impossible. Also, Microsoft no longer offers a score. Now you will only be 
told if you pass or fail. For more information on the exam policies, go to 
 www.microsoft.com/learning/mcpexams/policies/innovations.mspx . 
 Multiple Choice Questions 
 Multiple choice questions come in two main forms. One is a straightforward question 
followed by several possible answers, of which one or more are correct. The other type of 
multiple choice question is more complex and based on a speciﬁ c scenario. The scenario 
may focus on several areas or objectives.  
 Drag - and - Drop Questions 
 Drag - and - drop exam questions involve graphical elements that you must manipulate to 
successfully answer the question. For example, you might see a diagram of a computer 
network taken from the select - and - place demo downloaded from Microsoft ’ s website. 
 A typical diagram will show computers and other components next to boxes that 
contain the text  “ Place here. ” The labels for the boxes represent various computer roles 
on a network, such as a print server and a ﬁ le server. Based on information given for each 
computer, you are asked to select each label and place it in the correct box. You need to 
place  all of the labels correctly. No credit is given for the question if you correctly label only 
some of the boxes.  

Introduction 
xxxix
 Build List and Reorder Questions 
 In another drag - and - drop problem you might be asked to put a series of steps in order by 
dragging items from boxes on the left to boxes on the right and placing them in the correct 
order. One other type requires that you drag an item from the left and place it under an 
item in a column on the right.  
 Simulations 
 Simulations are the kinds of questions that most closely represent actual situations and test 
the skills you use while working with Microsoft software interfaces. These exam questions 
include a mock interface on which you are asked to perform certain actions according to a 
given scenario. The simulated interfaces look nearly identical to what you see in the actual 
product. 
 Because of the number of possible errors that can be made on simulations, be sure to 
consider the following recommendations from Microsoft: 
 
 Do not change any simulation settings that don ’ t pertain to the solution directly.  
 
 When related information has not been provided, assume that the default settings 
are used.  
 
 Make sure that your entries are spelled correctly.  
 
 Close all the simulation application windows after completing the set of tasks in the 
simulation.  
 The best way to prepare for simulation questions is to spend time working with the 
graphical interface of the product on which you will be tested.  
 Case Study – Based Questions 
 Case study – based questions ﬁ rst appeared in the MCSD program. These questions present 
a scenario with a range of requirements. Based on the information provided, you answer a 
series of multiple - choice and select - and - place questions. The interface for case study – based 
questions has a number of tabs, each of which contains information about the scenario. At 
present, this type of question appears only in most of the Design exams.  
 Note that due to the limitations of the Sybex Test Engine, we are not able 
to include examples of all these question types on our CD.  
 Tips for Taking the Windows Server 2008 Exams 
 Here are some general tips for achieving success on your certiﬁ cation exam: 
 
 Arrive early at the exam center so that you can relax and review your study 
materials. During this final review, you can look over tables and lists of exam - related 
information.  

xl 
Introduction
 
 Read the questions carefully. Do not be tempted to jump to an early conclusion. Make 
sure you know  exactly what the question is asking.  
 
 Answer all questions. If you are unsure about a question, mark it for review and come 
back to it at a later time.  
 
 On simulations, do not change settings that are not directly related to the question. 
Also, assume default settings if the question does not specify or imply which settings 
are used.  
 
 For questions you ’ re not sure about, use a process of elimination to get rid of the 
obviously incorrect answers first. This improves your odds of selecting the correct 
answer when you need to make an educated guess.  
 Exam Registration 
 You may take the Microsoft exams at any of more than 1,000 Authorized Prometric 
Testing Centers (APTCs) around the world. For the location of a testing center near you, 
call Prometric at 800 - 755 - EXAM (755 - 3926). Outside the United States and Canada, 
contact your local Prometric registration center. You may also register for your exams 
online at  www.prometric.com . 
 Find out the number of the exam you want to take, and then register with the Prometric 
registration center nearest to you. At this point, you will be asked for advance payment for 
the exam. The exams are $125 each and you must take them within one year of payment. 
You can schedule exams up to six weeks in advance or as late as one working day prior 
to the date of the exam. You can cancel or reschedule your exam if you contact the center 
at least two working days prior to the exam. Same - day registration is available in some 
locations, subject to space availability. Where same - day registration is available, you must 
register a minimum of two hours before test time. 
 When you schedule the exam, you will be provided with instructions regarding 
appointment and cancellation procedures, ID requirements, and information about 
the testing center location. In addition, you will receive a registration and payment 
conﬁ rmation letter from Prometric. 
 Microsoft requires certiﬁ cation candidates to accept the terms of a nondisclosure 
agreement before taking certiﬁ cation exams.  
 Who Should Read This Book? 
 This book is intended for individuals who want to pass the following Microsoft exams: 
 
 70 - 640: TS: Windows Server 2008 R2 Active Directory Configuration  
 
 70 - 642: TS: Windows Server 2008 R2 Network Infrastructure Configuration  
 
 70 - 643: TS: Windows Server 2008 R2 Applications Infrastructure Configuration  

Introduction 
xli
 This book will not only help anyone who is looking to pass the Microsoft exams but it 
will also help anyone who wants to learn the real ins and outs of the Windows Server 2008 
R2 operating system.  
 What ’ s in the Book? 
 What makes a Sybex Study Guide the book of choice for hundreds of thousands of MCPs? 
We took into account not only what you need to know to pass the exam but also what 
you need to know to take what you ’ ve learned and apply it in the real world. Each book 
contains the following:  
 Objective - by - Objective Coverage of the Topics You Need to Know   Each chapter lists the 
objectives covered in that chapter.  
 The topics covered in this Study Guide map directly to Microsoft ’ s official 
exam objectives. Each exam objective is covered completely.   
 Assessment Test   Directly following this introduction is an Assessment Test that you 
should take. It is designed to help you determine how much you already know about 
Windows Server 2008 Active Directory. Each question is tied to a topic discussed in the 
book. Using the results of the Assessment Test, you can ﬁ gure out the areas where you need 
to focus your study. Of course, we do recommend you read the entire book.  
 Exam Essentials   To highlight what you learn, you ’ ll ﬁ nd a list of Exam Essentials at the 
end of each chapter. The Exam Essentials section brieﬂ y highlights the topics that need 
your particular attention as you prepare for the exam.  
 Glossary   Throughout each chapter, you will be introduced to important terms and 
concepts that you will need to know for the exam. These terms appear in italic within the 
chapters. There is also a Glossary of Terms, in PDF format, exclusive to the book ’ s CD.  
 Review Questions, Complete with Detailed Explanations   Each chapter is followed by 
a set of Review Questions that test what you learned in the chapter. The questions are 
written with the exam in mind, meaning that they are designed to have the same look 
and feel as what you ’ ll see on the exam. Question types are just like the exam, including 
multiple choice, exhibits, and select - and - place.  
 Hands - on Exercises  In most chapters you ’ ll ﬁ nd exercises designed to give you the 
important hands - on experience that is critical for your exam preparation. The exercises 
support the topics of the chapter, and they walk you through the steps necessary to perform 
a particular function.  
 Real World Scenarios   Because reading a book isn ’ t enough for you to learn how to apply 
these topics in your everyday duties, we have provided Real World Scenarios in special 
sidebars. These explain when and why a particular solution would make sense, in a 
working environment you ’ d actually encounter.  

xlii 
Introduction
  Interactive CD   Every Sybex Study Guide comes with a CD complete with additional 
questions, ﬂ ashcards for use with an interactive device, and the Glossary in electronic 
format. Details are in the following section.  
 What ’ s on the CD? 
 With this new member of our best - selling Study Guide series, we are including quite an 
array of training resources. The CD offers practice exams and ﬂ ashcards to help you 
study for the exam. We have also included a detailed Glossary of terms in electronic 
form. For updated review questions, please see the Sybex website at  www.sybex.com/go/
mctswindows2008r2 . The CD ’ s resources are described here:  
  The Sybex Test Engine   This is a collection of multiple - choice questions that will help you 
prepare for your exam. There are four sets of questions: 
 
 Six practice exams designed to simulate the actual live exam.  
 
 All the questions from the Study Guide, presented in a test engine for your review. You 
can review questions by chapter, or you can take a random test.  
 
 The Assessment Test.  
  Sybex Flashcards for PCs and Handheld Devices   The ﬂ ashcard style of question offers 
an effective way to quickly and efﬁ ciently test your understanding of the fundamental 
concepts covered in the exam. The Sybex Flashcards set consists of 100 questions presented 
in a special engine developed speciﬁ cally for this Study Guide series. Because of the high 
demand for a product that will run on handheld devices, we have also developed, in 
conjunction with Land - J Technologies, a version of the ﬂ ashcard questions that you can 
take with you on your Palm OS PDA (including the PalmPilot and Handspring ’ s Visor). 
  The Sybex Glossary of Terms   All of the book ’ s key terms have been compiled into a 
detailed Glossary, supplied on the CD, in PDF format. We ’ ve also included Adobe Acrobat 
Reader, which provides the interface for the PDF contents as well as search capabilities.  
 Hardware and Software Requirements 
 You should verify that your computer meets the minimum requirements for installing 
Windows Server 2008 R2. We suggest that your computer meets or exceeds the 
recommended requirements for a more enjoyable experience. 
 The exercises in this book assume that your computer is conﬁ gured in a speciﬁ c manner. 
Your computer should have at least a 20GB drive that is conﬁ gured with the minimum 
space requirements and partitions. Other exercises in this book assume that your computer 
is conﬁ gured as follows: 
 
  20GB C: partition with the NTFS filesystem  
 
 Optional D: partition with the NTFS filesystem 
 
 15GB or more of free space  

Introduction 
xliii
 Of course, you can allocate more space to your partitions if it is available.  
 Contacts and Resources 
 To ﬁ nd out more about Microsoft Education and Certiﬁ cation materials and programs, to 
register with Prometric, or to obtain other useful certiﬁ cation information and additional 
study resources, check the following resources:  
 Microsoft Learning Home Page   (www.microsoft.com/learning)  This website provides 
information about the MCP program and exams. You can also order the latest Microsoft 
Roadmap to Education and Certiﬁ cation.  
 Microsoft TechNet Technical Information Network   (www.microsoft.com/technet, 
 800 - 344 - 2121)   Use this website or phone number to contact support professionals 
and systems administrators. Outside the United States and Canada, contact your local 
Microsoft subsidiary for information.  
 Prometric  (  www.prometric.com,  800 - 755 - 3936)   Contact Prometric to register to take 
an exam at any of more than 800 Prometric Testing Centers around the world.  
 MCP Magazine Online (  www.mcpmag.com)  Microsoft Certiﬁ ed Professional Magazine 
is a well - respected publication that focuses on Windows certiﬁ cation. This site hosts chats 
and discussion forums and tracks news related to the MCTS and MCITP program. Some 
of the services cost a fee, but they are well worth it.  
 Windows IT Pro Magazine (  www.windowsITPro.com)  You can subscribe to this 
magazine or read free articles at the website. The study resource provides general 
information on Windows Server.  
 What ’ s Inside 
 Here is a glance at what ’ s in each chapter:  
 Part I   Part I focuses on exam 70 - 640, Windows Server 2008 R2 Active Directory 
Configuration.  
 Chapter 1: Overview of Active Directory   We take you through the advantages and 
beneﬁ ts of Windows Server 2008 R2 Active Directory.   
 Chapter 2: Domain Name System (DNS)   This chapter shows you how to install and 
conﬁ gure DNS. We also explain the different types of DNS records and DNS zone types.   
 Chapter 3: Active Directory Planning and Installation   In this chapter you are taken 
through the process of conﬁ guring and installing Active Directory.   
 Chapter 4: Installing and Managing Trees and Forests   We show you how to install and 
manage Active Directory trees and forests using the Active Directory MMC 

xliv 
Introduction
snap - ins. This chapter explains many of the services (Global Catalogs, UGMC, 
Operation Masters, etc.) that help make the forest operate properly.   
 Chapter 5: Configuring Sites and Replication   We examine the process of conﬁ guring 
Active Directory subnets, conﬁ guring site links, conﬁ guring site link costing, and 
conﬁ guring site infrastructure. We also look at conﬁ guring one - way replication, 
Bridgehead server, replication scheduling, conﬁ guring replication protocols, and forcing 
intersite replication.   
 Chapter 6: Configuring Active Directory Server Roles   This chapter explains the 
different server roles including Active Directory Lightweight Directory Service, Active 
Directory Rights Management Service, Active Directory Federation Services, and Active 
Directory Certiﬁ cate Services.   
 Chapter 7: Administering Active Directory   We take you through the different ways to 
create and manage your users and groups on the Windows Server 2008 R2 operating 
system.   
 Chapter 8: Configuring Group Policy Objects   In this chapter you learn how to 
conﬁ gure different types of Group Policy objects (GPOs) in Active Directory.   
 Chapter 9: Planning Security for Active Directory   This chapter explains how to 
conﬁ gure domain password policies, account lockout policies, ﬁ ne - grain password 
policies, audit logon events, audit account logon events, audit policy change, and audit 
access privilege use, to name just a few.   
 Chapter 10: Active Directory Optimization and Reliability   In this exciting chapter you 
learn how to monitor, maintain, troubleshoot, and optimize Windows Server 2008 R2 
using Performance Monitor, Reliability Monitor, system information, Task Manager, 
and Event Viewer. 
 Part II   Part II focuses on exam 70 - 642, Windows Server 2008 R2 Network 
Infrastructure Configuration.  
 Chapter 11: Understanding Windows Server 2008 R2 Networking   You learn the basic 
networking terms and technologies. We look at the OSI model and different protocols 
that work with Windows Server 2008 R2.   
 Chapter 12: Configuring TCP/IP   This chapter shows you how to conﬁ gure IPv4 and 
IPv6. We look at IPv4 subnetting and how to manage a TCP/IP network.   
 Chapter 13: Managing DHCP and DNS   In this chapter you learn how to implement 
and maintain DHCP. We look at how to set up and conﬁ gure DHCP pools and scopes. 
We also look at more advanced DNS.   
 Chapter 14: Managing Routing and Remote Access   In this chapter you learn how to 
implement Microsoft Routing and Remote Access Services. We will also look at how to 
conﬁ gure Remote Desktop Services.   

Introduction 
xlv
 Chapter 15: Managing Remote Access Services   This chapter shows you Remote Access 
Policy, Network Address Translation (NAT), and VPN protocols.   
 Chapter 16: Managing Security for Remote Access Services   You learn about Network 
Policy Server (NPS) and Network Access Protection (NAP). We will also look at 
conﬁ guring Windows Firewall with Advanced Security.   
 Chapter 17: Managing File and Print Services   This chapter dives into conﬁ guring a ﬁ le 
and print server. We look at ﬁ le share publishing, ofﬂ ine ﬁ les, share permissions, NTFS 
permissions, Encrypting File System (EFS), BitLocker, Access - Based Enumeration (ABE), 
branch cache, and the Share and Storage Management console.   
 Chapter 18: Monitoring and Managing a Network Infrastructure   In this chapter you 
learn how to conﬁ gure Windows Server Update Services (WSUS) server settings. You 
also learn to gather network data, monitor event logs, capture performance data, and 
conﬁ gure backup and restore.   
 Part III   Part III focuses on exam 70 - 643, Windows Server 2008 R2 Applications 
Infrastructure Configuration.   
 Chapter 19: Windows Server 2008 R2 Storage Services   This chapter explains how to 
implement and maintain RAID types, Virtual Disk Speciﬁ cation (VDS), iSCSI Initiator, 
storage area networks (SANs), mount points, Multipath I/O (MPIO), VHD mounting, 
booting from a VHD, and N - Port Identiﬁ cation Virtualization (NPIV).   
 Chapter 20: Remote Desktop Services in Windows Server 2008 R2   You learn about 
conﬁ guring RemoteApp and Remote Desktop Web Access, conﬁ guring Remote Desktop 
Gateway (RD Gateway), conﬁ guring Remote Desktop Connection Broker, conﬁ guring 
and monitoring Remote Desktop resources, and conﬁ guring Remote Desktop Licensing.   
 Chapter 21: Configuring Web Services Infrastructure   In this chapter you learn about 
conﬁ guring web applications, managing websites, conﬁ guring a File Transfer Protocol 
(FTP) server, and conﬁ guring Simple Mail Transfer Protocol (SMTP).   
 Chapter 22: Advanced Web Infrastructure Configuration   We look at how to 
implement and maintain the Web Server (IIS) role, conﬁ gure SSL security, and conﬁ gure 
website authentication and permissions.   
 Chapter 23: Configuring Additional Communication Services   This chapter explains 
how to manage the Streaming Media Services role and secure streaming media.   
 Chapter 24: Configuring Windows SharePoint 2010 Foundation   In this chapter you 
learn how to implement and conﬁ gure Microsoft SharePoint Foundation options. You 
will also learn about conﬁ guring SharePoint Foundation integration.   
 Chapter 25: Using Virtualization in Windows Server 2008 R2   This chapter shows you 
how to implement and conﬁ gure Windows Server Hyper - V and virtual machines. You also 
learn about virtual networking, virtual hard disks, migration types, and integration services.   

xlvi 
Introduction
 Chapter 26: Deploying Servers   In this chapter you learn how to deploy images by 
using Windows Deployment Services and conﬁ gure Microsoft Windows activation.   
 Chapter 27: Configuring High Availability in Windows Server 2008 R2   In this ﬁ nal 
chapter, we explore how to conﬁ gure Windows Server 2008 R2 machines for high 
availability. We look at failover clustering, Network Load Balancing, geo - clustering 
support, cluster service migration, and Cluster Shared Volumes (CSV).  
 How to Contact Sybex 
 Sybex strives to keep you supplied with the latest tools and information you need for 
your work. Please check our website at  www.sybex.com/go/mctswin08r2 , where we ’ ll post 
additional content and updates that supplement this book should the need arise.  

 Assessment Test  
 1. 
  Which of the following is a valid role for a Windows Server 2008 R2 computer?  
 A.   Stand - alone server 
 B.   Member server  
 C.   Domain controller  
 D.   All of the above  
 2. 
  Which of the following is a benefit of using Active Directory? (Choose all that apply.)  
 A.   Hierarchical object structure  
 B.   Fault - tolerant architecture  
 C.   Ability to configure centralized and distributed administration  
 D.   Flexible replication  
 3. 
 Which of the following features of the Domain Name System (DNS) can be used to improve 
performance? (Choose all that apply.)  
 A.   Caching - only servers  
 B.   DNS forwarding  
 C.   Secondary servers  
 D.   Zone delegation  
 4. 
  Which of the following pieces of information should you have before you begin the Active 
Directory Installation Wizard? (Choose all that apply.)  
 A.   Active Directory domain name  
 B.   Administrator password for the local computer  
 C.   NetBIOS name for the server  
 D.   DNS configuration information  
 5. 
  Which of the following single master operations apply to the entire forest? (Choose all that 
apply.)  
 A.   Schema Master  
 B.   Domain Naming Master 
 C.   RID Master 
 D.   Infrastructure Master   
 6. 
 Trust relationships can be configured as which of the following? (Choose all that apply.)  
 A.   One - way and transitive 
 B.   Two - way and transitive 
 C.   One - way and nontransitive  
 D.   Two - way and nontransitive  

 7. 
  An Active Directory environment consists of three domains. What is the maximum number 
of sites that can be created for this environment?  
 A.   Two  
 B.   Three 
 C.   Nine  
 D.   Unlimited  
  8. 
  What is the name of the list that shows removed certificates from a certificate server?  
 A.   Certificate Removed List  
 B.   Certificate Revocation List  
 C.   Certificate Revoke List  
 D.   Certificate Released List  
 9. 
  Which of the following is  not a valid Active Directory object?  
 A.   User  
 B.   Group  
 C.   Organizational unit  
 D.   Computer  
 E. 
  None of the above  
 10.   Which of the following is  not considered a security principal?  
 A.   Users 
 B.   Security groups  
 C.   Distribution groups  
 D.   Computers  
 11.   Which of the following should play the  least significant role in planning an OU structure?  
 A.   Network infrastructure  
 B.   Domain organization  
 C.   Delegation of permissions  
 D.   Group Policy settings  
  12.   How can the Windows NT 4 file and printer resources be made available from within 
Active Directory?  
 A.   A systems administrator can right - click the resource and select Publish.  
 B.   A systems administrator can create Printer and Shared Folder objects that point to 
these resources.  
 C.   The Active Directory Domains and Trusts tool can be used to make resources 
available.  
 D.   Only resources on a Windows 2000 or above server can be accessed from within 
Active Directory.  
xlviii 
Assessment Test

 13.   The process by which a higher - level security authority assigns permissions to other 
administrators is known as which of the following?  
 A.   Inheritance  
 B.   Delegation  
 C.   Assignment  
 D.   Trust  
 14.   What is the minimum amount of information you need to create a Shared Folder Active 
Directory object?  
 A.   The name of the share  
 B.   The name of the server  
 C.   The name of the server and the name of the share  
 D.   The name of the server, the server ’ s IP address, and the name of the share  
 15.   Which of the following operations is not supported by Active Directory?  
 A.   Assigning applications to users  
 B.   Assigning applications to computers  
 C.   Publishing applications to users  
 D.   Publishing applications to computers  
 16.   Which of the following file extensions is used primarily for Windows Installer setup 
programs?  
 A.   .msi 
 B.   .mst 
 C.    .zap 
 D.   .aas 
 17.   A systems administrator wants to allow a group of users to add computer accounts to a specific 
organizational unit (OU). What is the easiest way to grant only the required permissions?  
 A.   Delegate control of a user account.  
 B.   Delegate control at the domain level.  
 C.   Delegate control of an OU.  
 D.   Delegate control of a computer account.  
 E. 
  Create a Group Policy object (GPO) at the OU level.  
 18.  A Group Policy object (GPO) at the domain level sets a certain option to Disabled, while 
a GPO at the OU level sets the same option to Enabled. All other settings are left at their 
default. Which setting will be effective for objects within the OU?  
 A.   Enabled  
 B.   Disabled  
 C.   No effect  
 D.   None of the above  
Assessment Test 
xlix

 19.   Which of the following tools can be used to create Group Policy object (GPO) links to 
Active Directory?  
 A.   Active Directory Users and Computers  
 B.   Active Directory Domains and Trusts  
 C.   Active Directory Sites and Services  
 D.   Group Policy Management Console  
 20.   Which of the following statements regarding auditing and Active Directory is false?  
 A.   Auditing prevents users from attempting to guess passwords.  
 B.   Systems administrators should regularly review audit logs for suspicious activity.  
 C.   Auditing information can be generated when users view specific information within 
Active Directory.  
 D.   Auditing information can be generated when users modify specific information within 
Active Directory.  
 21.   You do not know the Directory Services Recovery Mode (DSRM) password. How do you 
reset the DSRM password?  
 A.   ADSI Edit  
 B.   ntdsutil 
 C.   Active Directory Users and Computers  
 D.   Active Directory Sites and Services  
 22.   The seven layers of the OSI model do which of the following?  
 A.   Map exactly to Windows 2000 networking services and components  
 B.   Provide a useful conceptual framework for grouping services  
 C.   A and B 
 D.   None of the above  
 23.   Which of the following is not an OSI layer?  
 A.   Session  
 B.   Application  
 C.   Presentation  
 D.   Service  
  24.   You want to set up VPN access for 30 users, and the connections must be encrypted. There 
is a central Windows Server 2008 R2 domain for your users. Which of the following is the 
most appropriate VPN solution in this case?  
 A.   L2TP  1 IPsec 
 B.   PPTP  
 C.   Either A or B  
 D.   None of the above  
l 
Assessment Test

 25.   What is the IPsec Policy Agent?  
 A.   It is an optional component that ’ s required when using IPsec with Active Directory.  
 B.   It is an optional component that ’ s required when using IPsec without Active Directory.  
 C.   It is an optional component that ’ s required when using IPsec with L2TP.  
 D.   It is a mandatory component that ’ s required to use IPsec.  
 26.  To test whether a DNS server is answering queries properly, you can use which of the 
following tools?  
 A.   The  ping  tool  
 B.   The  nslookup  tool  
 C.   The  tracert  tool  
 D.   The  ipconfig  tool  
 27.   Which of the following is true about IPsec?  
 A.   Can be used by itself  
 B.   Can be used only with L2TP  
 C.   Cannot be used with L2TP 
 D.   Requires third - party software for Windows 2000 and newer  
 28.   Which of the following protocols or services is  not required for an Active Directory 
installation?  
 A.   TCP/IP  
 B.   DNS  
 C.   LDAP  
 D.   NetBEUI  
 29.   The time to live (TTL) attached to a DNS record __________.  
 A.   Cannot be used by a resolver; it can be used only by servers making recursive queries  
 B.   Is used only by resolvers  
 C.   Is used to determine how long to cache retrieved results  
 D.   Is refreshed each time the record is modified  
 30.   To enable DHCP - DNS integration, you must do which of the following?  
 A.   Configure the scope to allow it to use Dynamic DNS only.  
 B.   Configure the server to allow it to use Dynamic DNS only.  
 C.   Configure the scope and the server.  
 D.   Configure the scope or the server.  
Assessment Test 
li

 31.   You have installed the DHCP Server service on a member server in your domain and have 
configured a scope, but clients cannot lease an address. What is the most likely cause of this 
problem?  
 A.   The scope is not activated.  
 B.   There are too many DHCP servers.  
 C.   The DHCP server is not authorized. 
 D.   The DHCP server is in another subnet.  
 32.   Which of the following statements about Windows Server 2008 Dynamic DNS is true?  
 A.   DDNS requires a Microsoft DHCP server to work.  
 B.   The Windows Server 2008 DDNS server can interoperate with recent versions of 
BIND.  
 C.   DDNS clients may not register their own addresses.  
 D.   DDNS works only with Microsoft clients and servers.  
 33.   DHCP address range exclusions are assigned at which level?  
 A.   Server level  
 B.   Scope level  
 C.   Superscope level  
 D.   Multicast scope level  
 34.   The DHCP relay agent serves which function on the network?  
 A.   It listens for DHCP messages on a network and forwards them to a DHCP server on 
another network.  
 B.   It accepts DHCP messages from multiple networks and consolidates them for a single 
DHCP server.  
 C.   It allows DHCP clients to use WINS services.  
 D.   It relays DHCP requests to a Dynamic DNS server.  
 35.   Which of the following settings cannot be adjusted when using RIP?  
 A.   The RIP version that can be used for incoming and outgoing traffic on each interface  
 B.   The set of peer routers from which routes will be accepted  
 C.   The default announcement interval 
 D.   The location where received RIP routes are stored  
 36.  RRAS allows you to create which types of routing - related filters?  
 A.   Route filters only  
 B.   Peer filters only  
 C.   Route and peer filters  
 D.   Packet filters only  
lii 
Assessment Test

 37.   In which two modes do RIP routers send updates?  
 A.   Link - state database mode  
 B.   Autostatic update mode  
 C.   Periodic update mode  
 D.   Border mode  
 38.   VPN connections require which of the following? (Choose two.)  
 A.   The Windows Server 2008 VPN add - on  
 B.   The name or IP address of the VPN server  
 C.   The phone number of the VPN server 
 D.   An existing TCP/IP connection  
 39.   Which of the following are true of dynamically maintained routing tables? (Choose all 
that apply.)  
 A.   They are automatically maintained by the routing protocols.  
 B.   They are normally not maintained across reboots.  
 C.   They may be manually edited from the command line.  
 D.   They consist of multiple entries, each containing a network ID, a forwarding address, 
and a metric. 
 40.   You can control VPN access through which of the following mechanisms? (Choose two.)  
 A.   Individual user account properties  
 B.   Remote access policies  
 C.   Remote access profiles  
 D.   Group Policy objects  
 41.   To reject any incoming call from a client that can ’ t use a specified level of encryption, you 
would do which of the following?  
 A.   Turn off the No Encryption check box on the Encryption tab of the remote access 
policy ’ s profile.  
 B.   Turn off the No Encryption check box on the Security tab of the server ’ s Properties 
dialog box.  
 C.   Create a new remote access profile named Require Encryption.  
 D.   Check the Require Encryption check box in each user ’ s profile.  
 42.   You must restore the server ’ s configuration to before the last set of configuration changes 
you made. Which command should you run?  
 A.   AppCmdrestore backup  “ Last Backup “  
 B.   AppCmdrestore backup  “ CFGHISTORY_0000000001 “  
 C.   AppCmdrestore backup  “ CFGHISTORY_0000000100 “  
 D.   AppCmd add backup  “ CFGHISTORY_0000000100 “  
Assessment Test 
liii

 43.  You have been given a server with three hard disks, all with the same capacity. The first drive 
contains the operating system files. You must provide data redundancy while providing the 
highest amount of capacity. To accomplish this, which of the following would you do? 
 A.   Select the first drive, right - click, and select New RAID 5 Volume.  
 B.   Select the first drive, right - click, and select New Mirrored Volume.  
 C.   Select the first drive, right - click, and select New Striped Volume.  
 D.   Select the first drive, right - click, and select New Simple Volume.  
 44.  A server named RDSrv1 running Windows Server 2008 R2 has the Remote Desktop 
Services role installed, and you have deployed a remote application from this server. You 
have already contacted the vendor to verify that the application is supported in a Remote 
Desktop environment, but the installation package does not use an MSI installer package. 
After you have deployed the remote application, users report remote application time -
 outs and various disconnected sessions. How can you ensure that the application has been 
installed to support multiple sessions?  
 A.   Run the  change user /disable  command on RDSrv1, install the application, and 
run the  change user /enable command on RDSrv1. 
 B.   Run  mstsc /v:RDSrv1 /admin from you client computer to log on to RDSrv1 and 
install the application.  
 C.   Run the  change user /execute  command on RDSrv1, install the application, and 
run the  change user /install command on RDSrv1. 
 D.   Run the  change user /install  command on RDSrv1, install the application, and 
run the  change user /execute command on RDSrv1. 
 45.  You are a server administrator with two servers running Windows 2008 R2 with the Remote 
Desktop Services role installed, RDSrv1 and RDSrv2. RDSrv1 is currently publishing remote 
applications and distributing them as RDP files through a web virtual directory. You want 
the program lists and deployment settings to be the same on both servers, so you import 
the RemoteApp programs settings from RDSrv1. Users complain that they cannot access 
the remote applications on RDSrv2 but can on RDSrv1. Which of the following procedures 
would you do to ensure that users can access the applications on RDSrv2? 
 A.   Copy the RDP files from RDSrv1 to a new web virtual directory for RDSrv2.  
 B.   Configure RDSrv1 and RDSrv2 to participate in RD Session Broker Load Balancing.  
 C.   Re - create the RDP files on RDSrv2 and distribute them to the users.  
 D.   Re - create the RDP files on RDSrv1 and distribute them to the users.  
 46.   You have an Active Directory domain, and the RD Licensing Service role is installed on a 
server named RDSrv1 that is in a workgroup. You cannot enable RD Per User CALs on this 
license server. What do you need to do to enable RD Per User CALs?  
 A.   Get license keys from the Microsoft Clearinghouse and enter the keys into the license 
server.  
 B.   Join RDSrv1 to the domain.  
 C.   Install the Remote Desktop Services Role on RDSrv1.  
 D.   Install the RD Gateway role on RDSrv1.  
liv 
Assessment Test

 47.   You are running the Remote Desktop Services role on a server and are publishing 
RemoteApps and using GPOs to set the policies on the server. You check Remote Desktop 
Services Manager and notice that there are disconnected sessions that are several days old. 
How in the future can you ensure that disconnected sessions do not exist?  
 A.   Log into Remote Desktop Services Manager and reset each disconnected session.  
 B.   In the Group Policy Management Console, enable the policy Restrict Remote Desktop 
Users To A Remote Session.  
 C.   In the Group Policy Management Console, enable the policy Set Time Limit For 
Disconnected Sessions.  
 D.   Set the Remote Desktop Services to drain mode.  
 48.   You have installed an RD license server and you wish to activate it. You choose the 
automatic connection to activate the server with Microsoft, but it fails. You suspect that 
your firewall is configured incorrectly, and you want the activation process to happen 
automatically. How can you ensure this?  
 A.   Open port 443 on your firewall.  
 B.   Open port 80 on your firewall.  
 C.   Open port 3389 on your firewall.  
 D.   Open port 1494 on your firewall.  
 49.   You have been given a server that contains three HBAs. Each card can access the storage 
over a separate path. The application that runs on the server can exceed the usage of a 
single path. Which of the following MPIO options should be selected to provide the needed 
bandwidth as well as minimal redundancy?  
 A.   Failover  
 B.   Dynamic Least Queue Depth  
 C.   Weighted Path  
 D.   Round Robin  
 50.   You have just deployed a new .NET web application and need to provide it with the least 
amount of privileges. The application needs to be able to access the Registry. Which of the 
following .NET trust levels will provide the least amount of privileges required?  
 A.   Full  
 B.   High  
 C.   Medium  
 D.   Low  
 E. 
  Minimal  
Assessment Test 
lv

 51.   You have configured an SMTP server to be the smart host for a number of servers so that 
the server can send all outbound email out to the Internet. None of the messages that have 
been sent have been received by the recipient. What must be done to allow email to be 
delivered?  
 A.   Enable TLS encryption.  
 B.   Add the sending servers to the exceptions list on the connection control.  
 C.   Add the sending servers to the allow list in the relay restrictions.  
 D.   Enable LDAP Routing.  
  52.   You must configure a website to allow Windows user credentials based on filesystem 
permissions to provide access to a single virtual directory. Which authentication modules 
must you disable on the virtual directory if the IUSR_ServerName account has permissions 
on the site content?  
 A.   Basic Authentication  
 B.   Anonymous Authentication  
 C.   Digest Authentication  
 D.   Integrated Windows Authentication  
 53.   You are the administrator for an engineering firm. The chief information officer (CIO) 
informs you that the president of the company wants to make a live broadcast to all 
employees. The CIO informs you that he does not want the employees to be able to 
record the broadcast or pause it. In addition, he wants you to reduce the impact that the 
broadcast will have on the server. What two options should you choose to meet the CIO ’ s 
requirements?  
 A.   Deliver the content with a unicast stream.  
 B.   Use on - demand publishing points.  
 C.   Deliver the content with a multicast stream.  
 D.   Use a broadcast publishing point.  
 54.   You deploy a new SharePoint Foundation 2010 site in your company intranet. The Sales 
department asks you to create a new web application for this new site. After you create the 
new web application, users in the Sales department report that they cannot access it. What 
step do you need to perform so that the application is available to your users in the Sales 
department?  
 A.   Manually reset IIS on all servers within your SharePoint farm.  
 B.   Ask users in the Sales department to log off and then log on to their workstations.  
  C.   Change permissions on the Sales user group to administrator level.  
 D.   Give Sales users site owner permissions to the web application.  
lvi 
Assessment Test

 55.   After deploying your SharePoint Foundation 2010 site, you get a request from management 
to create a document library for the Human Resources department. Management has also 
requested that the Human Resources department should only be able to view and add 
content to the site. What level of security permissions should you provide to the Human 
Resources group?  
 A.   Owner  
 B.   Visitor  
 C.   Member  
 D.   Administrator  
 56.   When is an operating system Hyper - V hypervisor aware?  
 A.   Automatically, if you install a Microsoft operating system  
 B.   When you install the VM components  
 C.   After you install the Integration Components  
 D.   When you turn on hypervisor awareness in Hyper - V 
 57.  What types of virtual hard disks can you configure in Hyper - V Manager? (Choose all that 
apply.)  
 A.   Dynamically expanding  
 B.   Fixed size  
 C.   Differencing  
 D.   Pass - through  
 58.   What statement is correct when you create an internal - only virtual network for your virtual 
machines on a Hyper - V server? 
 A.   The virtual machines can communicate with each other and with the host machine.  
 B.   The virtual machines can communicate with each other only.  
 C.   The virtual machines can communicate with each other, with the host machine, and 
with the network.  
 D.   The virtual machines cannot communicate with each other.  
 59.   Your company has a shared directory that contains files created with Word, Excel, 
PowerPoint, and Publisher. The senior network administrator wants you to use the newly 
installed Windows 2008 R2 Server to provide better control over who has access to those 
files and to limit the amount of time the files can be used. In addition, he wants you to 
reduce the amount of administration effort that is currently being spent to change rights on 
user files. What options should you choose to install and configure? (Choose all that apply.)  
 A.   Windows SharePoint Services  
 B.   Active Directory Rights Management Service (AD RMS) role  
 C.   Configure Rights Policy Templates  
 D.   Configure Active Directory Security Groups  
Assessment Test 
lvii

 60.   You are an IT administrator for a medium - size company. This company has 250 Windows 
7 computers and 15 Windows 2008 R2 Server machines. One of your users puts in a 
service request stating that he is no longer able to open certain programs or access some 
functions. When the user logs into another machine, he is able to access the programs and 
features. He also states that he has been getting a Windows Activation popup from time to 
time. What would you do to resolve this issue?  
 A.   Check the user ’ s permissions in Active Directory and assign admin rights to his 
machine.  
 B.   Scan for viruses.  
 C.   Activate his copy of Windows 7.  
 D.   Restore the machine from a backup.  
 61.   A failover cluster contains two nodes, and a business requires the cluster ’ s application to 
remain active and not have a single point of failure. Which of the following quorum models 
would work in a two - node failover cluster? (Choose all that apply.)  
 A.   No Majority: Disk Only  
 B.   Node Majority  
 C.   Node and Disk Majority  
 D.   Node and File Share Majority  
lviii 
Assessment Test

 Answers to Assessment Test 
 1. 
D.   Based on the business needs of an organization, a Windows 2008 R2 Server computer 
can be conﬁ gured in any of the above roles. See Chapter 1 for more information.  
 2. 
A, B, C, D.  All of the options listed are beneﬁ ts of using Active Directory. See Chapter 1 
for more information.  
 3. 
A, B, C, D.   One of the major design goals for DNS was support for scalability. All of the features 
listed can be used to increase the performance of DNS. See Chapter 2 for more information.  
 4. 
A, B, C, D.  Before beginning the installation of a domain controller, you should have all of 
the information listed. See Chapter 3 for more information.  
 5. 
A, B.   There can be only one Domain Naming Master and one Schema Master per Active 
Directory forest. The purpose of the Domain Naming Master is to keep track of all 
the domains within an Active Directory forest. The Schema Master deﬁ nes the Active 
Directory schema, which must be consistent across all domains in the forest. The remaining 
roles apply at the domain level. See Chapter 4 for more information.  
 6. 
A, B, C, D.  All of the trust conﬁ gurations listed are possible. A one - way trust means that 
Domain A trusts Domain B but not the reverse. A two - way trust means that both Domain 
A and Domain B trust each other automatically. Transitive trusts are implied, meaning 
that if Domain A trusts Domain B, and Domain B trusts Domain C, then Domain A trusts 
Domain C. See Chapter 4 for more information.  
 7. 
D.   The number of sites in an Active Directory environment is independent of the domain 
organization. An environment that consists of three domains may have one or more sites, 
based on the physical network setup. See Chapter 5 for more information.  
 8. 
B.   The Certiﬁ cate Revocation List (CRL) shows all certiﬁ cates that have been revoked. See 
Chapter 6 for more information.  
 9. 
E.  All of the choices are valid types of Active Directory objects, and all can be created and 
managed using the Active Directory Users and Computers tool. See Chapter 7 for more 
information.  
 10. C.   Permissions and security settings cannot be made on Distribution groups. Distribution 
groups are used only for sending email. See Chapter 7 for more information.  
 11. A.   In general, you can accommodate your network infrastructure through the use of Active 
Directory sites. All of the other options should play a signiﬁ cant role when you design your 
OU structure. Permissions and Group Policy can both be applied at the domain or OU 
level. See Chapter 7 for more information.  
 12. B.   Printer and Shared Folder objects within Active Directory can point to Windows NT 
4 ﬁ le and printer resources, as well as Windows 2000, 2003, 2008, and Server 2008 R2 
resources. See Chapter 7 for more information.  
 13. B.   Delegation is the process by which administrators can assign permissions on the objects 
within an OU. This is useful when administrators want to give other users more control 
over administrative functions in Active Directory. See Chapter 7 for more information.  
Answers to Assessment Test 
lix

 14. C.   The name of the server and the name of the share make up the UNC (Universal Naming 
Convention) information required to create a Shared Folder object. See Chapter 7 for more 
information.  
 15. D.   Applications cannot be published to computers, but they can be published to users and 
assigned to computers. See Chapter 8 for more information.  
 16. A.  .msi ﬁ les are native Windows Installer ﬁ les used with Windows Installer setup programs. 
The other ﬁ le types do not apply to this situation. See Chapter 8 for more information. 
 17. E.   In order to allow this permission at the OU level, the systems administrator must create a 
GPO with the appropriate settings and link it to the OU. See Chapter 8 for more information.  
 18. A.   Assuming that the default settings are left in place, the Group Policy setting at the OU 
level will take effect. See Chapter 8 for more information.  
 19. D.   In Windows Server 2008 R2 you can create GPOs only by using the Group Policy 
Management Console. See Chapter 8 for more information.  
 20. A. The purpose of auditing is to monitor and record actions taken by users. Auditing will 
not prevent users from attempting to guess passwords (although it might discourage them 
from trying, if they are aware it is enabled). See Chapter 9 for more information. 
 21. B.   One of the tasks that you can perform in the ntdsutil command is the ability to reset the 
Directory Services Recovery Mode password. See Chapter 10 for more information.  
 22. B.   The OSI model is a stylized network model that can be used to compare and contrast 
implementations from different vendors. See Chapter 11 for more information on the OSI model.  
 23. D.  The Session, Application, and Presentation layers are all part of the OSI model, but the 
Service layer isn ’ t. See Chapter 11 for more information on the OSI layers.  
 24. C.  L2TP  1 IPsec and PPTP can both be encrypted, and with the guidelines set forth in the 
question, either one would do the job. See Chapter 12 for more information.  
 25. D.   The IPsec Policy Agent is the component that downloads IPsec policy settings from 
the local computer or Active Directory. Accordingly, its presence is required for IPsec to 
function. See Chapter 12 for more information.  
 26. B.   The  nslookup  tool allows you to look up name and address information. See Chapter 
12 for more information.  
 27. A.   IPsec is a stand - alone protocol included in Windows Server 2008 R2 that can be used 
by itself or in conjunction with the Layer 2 Tunneling Protocol (L2TP). See Chapter 12 for 
more information.  
 28. D.   NetBEUI is deprecated, but the other three protocols are required for Active Directory. 
See Chapter 12 for more information.  
 29. C.   The TTL indicates how long the record may be safely cached; it may or may not be 
modiﬁ ed when the record is created. See Chapter 13 for more information on TTL.  
lx 
Answers to Assessment Test

 30. D.   You can enable integration either on one scope only or on all scopes on a server. See 
Chapter 13 for more information.  
 31. C.   If the DHCP server isn ’ t authorized, it will not answer lease requests; therefore, the 
client will end up with no address. See Chapter 13 for more information.  
 32. B.   DDNS works with BIND 8.2 and later. See Chapter 13 for more information on DDNS.  
 33. B.   Scopes or ranges of addresses can be assigned only at the scope level. The scope range 
includes the exclusion range. See Chapter 13 for more information.  
 34. A.   The DHCP relay agent allows you to use a DHCP server that resides on one network to 
communicate with clients that live on a separate network. See Chapter 13 for more information.  
 35. D.   The Routing Information Protocol (RIP) implementation in Windows Server 2008 R2 
allows you to mix RIP versions, control which peer routers can send you updates, and 
control how often your router will broadcast updates to others. However, it does not allow 
you to change where the routing table data is stored. See Chapter 14 for more information.  
 36. C.  Route ﬁ lters let you accept or ignore individual routes; peer ﬁ lters give you control over 
from which other routers your router accepts routing information. See Chapter 15 for more 
information. 
 37. B, C.   In periodic update mode, a RIP router sends its list of known routes at periodic intervals 
(which you deﬁ ne). In autostatic update mode, the RRAS router broadcasts the contents of its 
routing table only when a remote router asks for it. See Chapter 15 for more information.  
 38. B, D.   VPN connections piggyback on top of regular dial - up or dedicated TCP/IP 
connections, and you must specify the name or address of the server you ’ re calling. See 
Chapter 15 for more information.  
 39. A, C, D.   The routing engines maintain the contents of the routing table, although you can 
add or remove entries manually. Persistent routes, which are the default, are automatically 
maintained until you delete them manually. See Chapter 15 for more information.  
 40. A, B.  You can allow users to make VPN connections by modifying individual account 
properties; if you ’ re using a Native mode Windows Server 2008 R2 domain, you can also 
use remote access policies. See Chapter 16 for more information.  
 41. A.   The proﬁ le associated with each remote access policy controls whether that policy will 
require, allow, or disallow encryption. To force encryption, create a policy that disallows 
using no encryption. See Chapter 17 for more information.  
 42. C.  The highest conﬁ guration number is the latest backup, so that would be correct backup 
to restore. The backup set named   “ Last Backup “  would not be correct because it would 
have been manually run instead of done when a conﬁ guration change was made. When 
 AppCmd add backup  is run, it creates a new backup, not a restore, so it would also be an 
incorrect choice. See Chapter 18 for more information.  
 43. B.   Using software RAID - 1 is the only correct option because OS ﬁ les and boot ﬁ les cannot 
reside on software RAID - 5 disks. Striped and simple volumes are not redundant. See 
Chapter 19 for more information.  
Answers to Assessment Test 
lxi

 44. D.   To install an application that does not use an MSI package, you must change the server 
mode to install mode. After the installation is complete, the server must be placed back in 
execute mode. See Chapter 20 for more information.  
 45. C.  Because the original RDP ﬁ les were created on RDSrv1, they will connect only to 
RDSrv1; thus new RDP ﬁ les will have to be created and distributed from RDSrv2. See 
Chapter 20 for more information.  
 46. B.   Per User CALs are available if only the RD license server is a member of a domain. See 
Chapter 20 for more information.  
 47. C.  If you enable and conﬁ gure Set Time Limit For Disconnected Sessions, a time limit for 
a disconnected session will be set, and when the time limit is reached, the session will be 
deleted from the server. The policy is useful to ensure that resources are released on the 
server. See Chapter 20 for more information.  
 48. A.   The automatic connection requires an SSL connection (TCP port 443) to activate the 
license server with Microsoft over the Internet. See Chapter 20 for more information.  
 49. D.   A round robin conﬁ guration uses all available active paths and will distribute I/O in 
a balanced round robin fashion. Failover only uses a primary path and standby paths, 
allowing for link failure. Weighted Path assigns requests to the path with the least weight 
value. Dynamic Least Queue Depth routes requests to the path with the lowest number of 
outstanding requests. See Chapter 21 for more information.  
 50. B.  Medium and lower trust levels do not allow access to the Registry, so they would not be 
suitable levels for this application. High is the ﬁ rst level that allows the required access. Full 
allows too much access, so it is also not a valid answer. See Chapter 21 for more information. 
 51. C.  The messages are not being delivered because the default setting is to not allow relaying. 
The sending servers must be added to be allowed to relay. Enabling TLS encryption may 
secure the SMTP transmission, but it will not affect message delivery. Adding the servers 
to the exceptions will not allow the servers to communicate to the SMTP server at all. 
Enabling LDAP routing will allow email address lookups but will not affect delivery of 
email to the Internet. See Chapter 22 for more information.  
 52. B.  Since the IUSR_ServerName account has permission, Anonymous Authentication will 
keep the server from prompting for credentials. See Chapter 22 for more information.  
 53. C, D.  Options C and D are correct because multicast streams reduce the impact on the 
server by producing a single stream that multiple users can connect to, and broadcast 
publishing only allows the user to play the content. Options A and B are incorrect because 
unicast streams would not decrease the load on the server and on - demand publishing is for 
delivering content that the users can control. See Chapter 23 for more information.  
 54. A.   Option A is correct because any new applications require an IIS reset before they will 
be available to the end user. Option B is wrong because it is related to the Active Directory 
account and not the web application. See Chapter 24 for more information.  
 55. C.   Options A and D would give the group more than the requested permissions. Option 
B would not allow the group to add content. Option C would allow them to contribute 
content. See Chapter 24 for more information.  
lxii 
Answers to Assessment Test

 56. C.   An operating system running in a virtual machine becomes hypervisor aware once the 
Hyper - V Integration Components or Services are installed because it will support using the 
VMBus. See Chapter 25 for more information.  
 57. A, B, C, D.  All options are correct. See Chapter 25 for more information.  
 58. A.   The virtual machines can communicate with each other and with the host machine. 
That ’ s the deﬁ nition for an internal - only network. If they communicate only with each 
other, that ’ s called a private virtual network. If the virtual machines also can communicate 
with the external network, that ’ s called external. See Chapter 25 for more information.  
 59. B, C.   B and C are correct because AD RMS is the role that allows for better control of 
ﬁ les, and conﬁ guring rights policy templates would reduce the amount of administration 
needed because it allows the user to apply a preconﬁ gured rights template. See Chapter 26 
for more information.  
 60. C.  Option C is the correct answer because when a Windows 7 product is not activated, it 
will reduce the functionality of the machine until it is activated. See Chapter 26 for more 
information. 
 61. C, D.   Node and Disk Majority and Node and File Share Majority both allow for one of the 
nodes to be ofﬂ ine and still have quorum. Although No Majority: Disk Only allows for a 
node to be ofﬂ ine, the quorum shared disk is a single point of failure. Since there are only two 
nodes, both nodes have to be up if only Node Majority is chosen. See Chapter 27 for more 
information.  
Answers to Assessment Test 
lxiii


MCTS: Windows 
Server 2008 R2 
Active Directory 
Configuration 
(Exam 70-640) 
 PART 
I


Overview of Active 
Directory  
 Chapter 
1

 Managing users, computers, applications, and network devices 
can seem like a never - ending process. As a result, you need to 
be organized, especially when it comes to some of the most 
fundamental yet tedious tasks you perform every day. That ’ s where the concept of directory 
services comes in. 
 Microsoft ’ s Active Directory is designed to store information about all of the objects 
within your network environment, including hardware, software, network devices, and 
users. Furthermore, it is designed to increase capabilities while it decreases administration 
through the use of a hierarchical structure that mirrors a business ’ s logical organization. 
 You ’ ve probably also heard that a great deal of planning and training is required to 
properly implement Active Directory ’ s many features. In order to reap the true beneﬁ ts of 
this technology, you must be willing to invest the time and effort to get it right. From end 
users to executive management, the success of your directory services implementation will 
be based on input from the entire business. That ’ s where the content of this book — and the 
Microsoft exams for which it will prepare you — comes in. 
 It ’ s difﬁ cult to cover the various aspects of Windows Server 2008 R2 ’ s most important 
administrative feature — Active Directory — even in a whole book. Microsoft ’ s main 
goal in Exam 70 - 640: Microsoft Windows Server 2008 Active Directory is to test your 
understanding of the features of Active Directory. The problem is that it doesn ’ t make 
much sense to begin implementing Active Directory until you understand the terms, 
concepts, and goals behind it. 
 Once you have determined exactly what your Active Directory design should look like, 
it ’ s time to implement it. Throughout this book, you ’ ll learn about the various methods 
you can use to implement the tools and features of Windows Server 2008 R2 based 
on your company ’ s business and technical requirements. Despite the underlying 
complexity of Active Directory and all of its features, Microsoft has gone to great lengths 
to ensure that implementation and management of Active Directory are intuitive and 
straightforward; after all, no technology is useful if no one can ﬁ gure out how to use it. 
 In this chapter, you ’ ll look at some of the many beneﬁ ts of using directory services and, 
speciﬁ cally, Microsoft ’ s Active Directory. You ’ ll explore basic information regarding the 
various concepts related to Microsoft ’ s Active Directory. The emphasis will be on addressing 
the concepts of a directory service, why directory services are needed, the different Active 
Directory models, and how you can use one to improve operations in your environment. You ’ ll 
then look at the various logical objects created in Active Directory and the ways in which you 
can conﬁ gure them to work with your network environment. We will look at some of the new 
Windows Server 2008 R2 server roles and how they can be implemented in your company. 

Finally, you ’ ll learn the details related to how Identity and Access (IDA) in Windows Server 
2008 R2 can strengthen the security of your directory services.  
 This book is based on Windows Server 2008 R2. Whenever we refer to 
Windows Server 2008 in this book, we are referring to Windows Server 
2008 R2. 
 The Industry before Active Directory 
 Many production networks today are still operating without a single uniﬁ ed directory 
service. A number of small businesses and large global enterprises still store information 
in various disconnected systems instead of a centralized, hierarchical system such as 
Active Directory. For example, a company might record data about its employees (such as 
home addresses, phone numbers, and locations within the corporate entity) in a human 
resources database while network accounts reside on a Windows NT 4 Primary Domain 
Controller (PDC). 
 Other information, such as security settings for applications, resides within various 
other systems. And there are always the classic paper - based forms. 
 The main reason for this disparity was that no single ﬂ exible data storage mechanism 
was available. Implementing and managing many separate systems is a huge challenge for 
most organizations.  
 The Benefits of Active Directory 
 Most businesses have created an organizational structure in an attempt to better manage 
their environments and activities. For example, companies often divide themselves into 
departments (such as Sales, Marketing, and Engineering), and individuals ﬁ ll roles within 
these departments (such as managers and staff). The goal is to add constructs that help 
coordinate the various functions required for the success of the organization as a whole. 
 The IT department in these companies is responsible for maintaining the security of the 
company ’ s information. In modern businesses, this involves planning for, implementing, 
and managing various network resources. Servers, workstations, and routers are common 
tools of the infrastructure connecting users with the information they need to do their jobs. 
In all but the smallest environments, the effort required to manage these technological 
resources can be great. 
 That ’ s where Windows Server 2008 and Microsoft ’ s Active Directory come in. In its 
most basic deﬁ nition, a  directory is a repository that records and stores information and 
makes it available to users. Active Directory allows you to create a single centralized 
The Benefits of Active Directory 
5

6 
Chapter 1  Overview of Active Directory
(or decentralized with multiple domain controllers) repository of information with which 
you can securely manage a company ’ s resources. User account management, security, and 
application usages are just a few of the solutions Active Directory offers. Many features of 
this directory services technology allow it to meet the needs of organizations of any size. 
Speciﬁ cally, Active Directory ’ s features include the following:  
  Hierarchical Organization   Active Directory is based on a hierarchical layout. Through 
the use of various organizational components (or  objects ), a company can create a network 
management infrastructure and directory structure that mirror the business organization. 
For example, if a company called Stellacon.com had several departments (such as Sales and 
Human Resources), the directory services model can reﬂ ect this structure through the use 
of various objects within the directory (See Figure 1.1). Stellacon.com could then organize 
its users into the appropriate department ’ s organizational unit (OU). 
 The directory structure can efficiently accommodate the physical and logical aspects of 
information resources, such as access to other databases, user permissions, and computers. 
Active Directory also integrates with the network naming service, the  Domain Name 
System (DNS) . DNS provides for the hierarchical naming and location of resources 
throughout the company and on the public Internet.  
  Extensible Schema   One of the foremost concerns with any type of database is the 
difﬁ culty you encounter when you try to accommodate all types of information in one 
storage repository. That ’ s why Active Directory has been designed with extensibility in 
mind. In this case, extensibility means the ability to expand (or extend) the directory 
schema. The  schema is the actual structure of the database — what data types it contains 
and the location of their attributes. The schema is important because it allows applications 
to know where particular pieces of information reside. You cannot delete any portion of 
the schema, but you can change, modify, or alter it. The information stored within the 
structure of Active Directory can be expanded and customized through the use of various 
tools. One such tool is the Active Directory Service Interfaces (ADSI). 
 ADSI provides objects and interfaces that can be accessed from within common 
programming languages such as Visual Basic, Visual C#, and Active Server Pages (ASP). 
This feature allows Active Directory to adapt to special applications and to store additional 
information as needed. It also allows all of the various areas within an organization 
(or even among several organizations) to share data easily.  
  Centralized Data Storage   All of the information within Active Directory resides within 
a single, distributed, data repository. Users and systems administrators must be able to 
easily access the information they need wherever they may be within the company. This is 
one of the most important design goals of the directory service — to provide a secure and 
centralized location for all of your data. The beneﬁ ts of centralized data storage include 
reduced administrative requirements, less duplication, higher availability, and increased 
visibility and organization of data.  

 Replication   If server performance and reliability were not concerns, it might make 
sense to store the entire Active Directory on a single server. In the real world, however, 
accessibility of remote sites and cost constraints may require that the database be replicated 
throughout the network. Active Directory provides for this functionality. Through the 
use of replication technology, Active Directory ’ s database can be distributed among many 
different servers in a network environment. The ability to deﬁ ne sites allows systems 
and network administrators to limit the amount of trafﬁ c to and from remote sites while 
still ensuring adequate performance and usability. Reliable data synchronization allows 
for multimaster replication — that is, all domain controllers (except read - only domain 
controllers) can update information stored within Active Directory and can ensure 
its consistency at the same time.  
 Ease of Administration   In order to accommodate various business models, Active 
Directory can be conﬁ gured for centralized or decentralized administration. This gives 
Stellacon.com
Sales
Human Resources
 F I G U R E 1.1 Directory services model  
The Benefits of Active Directory 
7

8 
Chapter 1  Overview of Active Directory
network and systems administrators the ability to delegate authority and responsibilities 
throughout the organization while still maintaining security. Furthermore, the tools and 
utilities used to add, remove, and modify Active Directory objects are available with all 
Windows Server 2008 domain controllers (except read - only domain controllers).  
  Network Security   Through the use of a single logon and various authentication and 
encryption mechanisms, Active Directory can facilitate security throughout an entire 
enterprise. Through the process of  delegation, higher - level security authorities can grant 
permissions to other administrators. For ease of administration, objects in the Active 
Directory tree inherit permissions from their parent objects. Application developers can 
take advantage of many of these features to ensure that users are identiﬁ ed uniquely and 
securely. Network administrators can create and update permissions as needed from within 
a single repository, thereby reducing chances of inaccurate or outdated conﬁ guration.  
  Client Configuration Management   One of the biggest struggles for systems administrators 
comes with maintaining a network of heterogeneous systems and applications. A fairly 
simple failure — such as a hard disk crash — can cause hours of work in reconﬁ guring and 
restoring a workstation, especially an enterprise - class server. Hours of work can also 
be generated when users are forced to move between computers and they need to have 
all of their applications reinstalled and the necessary system settings updated. Many 
IT organizations have found that these types of operations can consume a great deal of IT 
staffers ’ time and resources. New technologies integrated with Active Directory allow for 
greatly enhanced control and administration of these types of network issues. The overall 
beneﬁ t is decreased downtime, a better end - user experience, and reduced administration.  
  Scalability   Large organizations often have many users and large quantities of information 
to manage. Active Directory was designed with scalability in mind. Not only does it 
allow for storing millions of objects within a single domain, it also provides methods for 
distributing the necessary information between servers and locations. These features relieve 
much of the burden of designing a directory services infrastructure based on technical 
instead of business factors.  
  Search Functionality   One of the most important beneﬁ ts of having all your network 
resources stored in a single repository is that it gives you the ability to perform accurate 
searches. Users often see NOSs as extremely complicated because of the naming and 
location of resources, but they shouldn ’ t be that complicated. For example, if we need to 
ﬁ nd a printer, we should not need to know the name of the domain or print server for that 
object. Using Active Directory, users can quickly ﬁ nd information about other users or 
resources, such as printers and servers, through an intuitive querying interface.  
 The technical chapters of this book cover the technical aspects of how Windows Server 
2008 delivers all of these features. For now, keep in mind the various challenges that 
Active Directory was designed to address. This chapter introduces the technical concepts 
on which Active Directory is based. In order to better understand this topic, you ’ ll now see 
the various areas that make up the logical and physical structure of Active Directory.  

 Understanding Active Directory ’ s 
Logical Structure 
 Database professionals often use the term  schema to describe the structure of data. 
A schema usually deﬁ nes the types of information that can be stored within a certain 
repository and special rules on how the information is to be organized. A schema can be 
manipulated with the right tools, such as ADSI, mentioned earlier in the chapter. Within 
a  relational database or Microsoft Excel spreadsheet, for example, we might deﬁ ne tables 
with columns and rows. Similarly, the Active Directory schema speciﬁ es the types of 
information that are stored within a directory. 
 The schema itself also describes the structure of the information stored within the Active 
Directory data store. The Active Directory data store, in turn, resides on one or more 
domain controllers that are deployed throughout the enterprise. In this section, you ’ ll see 
the various concepts used to specify how Active Directory is logically organized. 
 Components and Mechanisms of Active Directory 
 In order to maintain the types of information required to support an entire organization, 
Active Directory must provide for many different types of functionality. Active Directory 
is made up of various components. Each of these components must work with the others 
to ensure that Active Directory remains accessible to all of the users that require it and to 
maintain the accuracy and consistency of its information. 
 In the following sections, you ’ ll see each of the components that make up Active 
Directory. 
 Data Store 
 When you envision Active Directory from a physical point of view, you probably imagine 
a set of ﬁ les stored on the hard disk that contain all of the objects within it. The term  data 
store is used to refer to the actual structure that contains the information stored within 
Active Directory. The data store is implemented as a set of ﬁ les that resides within the ﬁ le 
system of a domain controller. This is the fundamental structure of Active Directory. 
 The data store itself has a structure that describes the types of information it can 
contain. Within the data store, data about objects is recorded and made available to 
users. For example, conﬁ guration information about the domain topology, including trust 
relationships, is contained within Active Directory. Similarly, information about users, 
groups, and computers that are part of the domain is also recorded.  
 The Active Directory data store is also commonly referred to as the Active 
Directory database. 
Understanding Active Directory’s Logical Structure 
9

10 
Chapter 1  Overview of Active Directory
 Schema 
 The Active Directory schema consists of rules on the types of information that can be 
stored within the directory. The schema is made up of two types of objects: attributes 
and classes.  
 
  An  attribute is a single granular piece of information stored within Active Directory. 
First Name and Last Name, for example, are considered attributes, which may contain 
the values of Bob and Smith, respectively.  
 
  A  class is an object defined as a collection of attributes. For example, a class called 
Employee could include the First Name and Last Name attributes.  
 It is important to understand that classes and attributes are deﬁ ned independently 
and that any number of classes can use the same attributes. For example, if we create an 
attribute called Nickname, this value could conceivably be used both as part of a User 
class and as part of a Computer class. 
 By default, Microsoft has included several schema objects. In order to support custom 
data, applications developers can extend the schema by creating their own classes and 
attributes. The entire schema is replicated to all of the domain controllers within the 
environment to ensure data consistency among them. 
 The overall result of the schema is a centralized data store that can contain information 
about many different types of objects — including users, groups, computers, network devices, 
applications, and more.  
 Global Catalog 
 The  Global Catalog is a database that contains all of the information pertaining to objects 
within all domains in the Active Directory environment. 
 One of the potential problems with working in an environment that contains multiple 
domains is that users in one domain may want to ﬁ nd objects stored in another domain, 
but they may not have any additional information about those objects. 
 The purpose of the Global Catalog is to index information stored in Active Directory 
so that it can be more quickly and easily searched. The Global Catalog can be distributed 
to servers within the network environment. That is, network and systems administrators 
specify which servers within the Active Directory environment will contain copies of the 
Global Catalog. This decision is usually made based on technical considerations (such 
as network links) and organizational considerations (such as the number of users at each 
remote site). 
 You can think of the Global Catalog as something like a universal phone book. 
Much like the local phone book you may keep in your house, the Global Catalog is quite 
large and bulky, but just like the phone book, it is also very useful in helping you locate 
information. Your goal (as a system administrator) would be to ﬁ nd a balance where you 
are maintaining enough copies in enough locations so that users can quickly and easily 
access it, without it taking up too much space. 
 This distribution of Global Catalog information allows for increased performance of 
company - wide resource searches and can prevent excessive trafﬁ c across network links. 
Because the Global Catalog includes information about objects stored in all domains 

within the Active Directory environment, its management and location should be an 
important concern for network and systems administrators.  
 Searching Mechanisms 
 The best - designed data repository in the world is useless if users can ’ t access the information 
stored within it. Active Directory includes a search engine that users can query to ﬁ nd 
information about objects stored within it. For example, if a member of the Human 
Resources (HR) department is looking for a color printer, they can easily query Active 
Directory to ﬁ nd the one located closest. Best of all, the query tools are already built 
into Windows Server 2008 operating systems and are only a few mouse clicks away.  
 Replication 
 Although it is theoretically possible to create a directory service that involves only one 
central computer, there are several problems with this conﬁ guration. First, all of the data 
is stored on one machine. This server would be responsible for processing all of the logon 
requests and search queries associated with the objects that it contains. Although this 
scenario might work well for a small network, it would create a tremendous load on 
a single server in a very large environment. Second, clients that are located on remote 
networks would experience slower response times due to the pace of network trafﬁ c. If 
this server became unavailable (because of a failed power supply, for example), network 
authentication and other vital processes could not be carried out. 
 To prevent these problems, Active Directory has been designed with a replication 
engine. The purpose of  replication is to distribute the data stored within the directory 
throughout the organization for increased availability, performance, and data protection. 
Systems administrators can tune replication based on their physical network infrastructure 
and other constraints. 
 An Overview of Active Directory Domains 
 As mentioned earlier, in a Windows Server 2008 Active Directory deployment, a domain 
is considered a logical security boundary that allows for the creation, administration, and 
management of related resources. 
 You can think of a domain as a logical division, such as a neighborhood within a city. 
Although each neighborhood is part of a larger group of neighborhoods (the city), it may carry 
on many of its functions independently of the others. For example, resources such as tennis 
courts and swimming pools may be made available only to members of the neighborhood, 
whereas resources such as electricity and water supplies would probably be shared between 
neighborhoods. So, think of a domain as a grouping of objects that utilizes resources exclusive 
to its domain, but keep in mind that those resources can also be shared between domains. 
 Although the names and fundamental features are the same, Active Directory domains 
are quite different from those in Windows NT. As we mentioned earlier, an Active Directory 
domain can store many more objects than a Windows NT domain. Furthermore, Active 
Directory domains can be combined together into trees and forests to form more complex 
hierarchical structures. 
Understanding Active Directory’s Logical Structure 
11

12 
Chapter 1  Overview of Active Directory
 Before going into the details, let ’ s discuss the concept of domains. If you think of 
a domain as a neighborhood, you can think of a group of similar domains (a  tree ) as a 
suburb and a group of disparate domains that trust each other (a  forest ) as a city. This is in 
contrast to Windows NT domains, which treat all domains as peers of each other (that is, 
they are all on the same level and cannot be organized into trees and forests). 
 Within most business organizations, network and systems administration duties are 
delegated to certain individuals and departments. For example, a company might have 
a centralized IT department that is responsible for all implementation, support, and 
maintenance of network resources throughout the organization. In another example, 
network support may be largely decentralized — that is, each department, business unit, 
or ofﬁ ce may have its own IT support staff. Both of these models may work well for a 
company, but implementing such a structure through directory services requires the use 
of logical objects. 
 A domain is a collection of computers and resources that share a common security 
database. An Active Directory domain contains a logical partition of users, groups, 
and other objects within the environment. Objects within a domain share several 
characteristics, including the following:  
  Group Policy and Security Permissions   Security for all of the objects within a domain can 
be administered based on policies. Thus, a domain administrator can make changes to any 
of the settings within the domain. These policies can apply to all of the users, computers, 
and objects within the domain. For more granular security settings, however, permissions 
can be granted on speciﬁ c objects, thereby distributing administration responsibilities and 
increasing security.  
  Hierarchical Object Naming   All of the objects within an Active Directory container 
share a common namespace. When domains are combined, however, the namespace is 
hierarchical. For example, a user in one department might have the object name  willp@
engineering.stellacon.com , while a user in another department might have the name 
 wpanek@sales.stellacon.com . The ﬁ rst part of the name (in these examples, the usernames 
 willp and  wpanek ) is the name of the object within the domain. The sufﬁ x (in this case 
 engineering.stellacon.com and  sales.stellacon.com ) is determined by the organization of 
the domains. The hierarchical naming system allows each object within Active Directory to 
have a unique name. 
  Hierarchical Inheritance   Containers called  organizational units (OUs) can be created 
within a domain. These units are used for creating a logical grouping of objects within 
Active Directory. The speciﬁ c settings and permissions assigned to an OU can be inherited 
by lower - level objects. 
 For example, if we have an OU for the North America division within our company, 
we can set user permissions on this object. All of the objects within the North America 
object (such as the Sales, Marketing, and Engineering departments) automatically inherit 
these settings. The proper use of hierarchical properties allows systems administrators to 
avoid inconsistent security policies and makes administration easier, but it ’ s important 
to remember how inheritance works when implementing and administering security, because 
it results in the implicit assignment of permissions.  

 Trust Relationships   In order to facilitate the sharing of information between domains, 
trust relationships are automatically created between them. The administrator can break 
and establish trust relationships based on business requirements. A trust relationship allows 
two domains to share security information and objects, but it does not automatically assign 
permissions to these objects.  Trusts allow users who are contained within one domain to be 
granted access to resources in other domains. To make administrating trust relationships 
easier, Microsoft has made transitive two - way trusts the default relationship between 
domains. As shown in Figure 1.2, if Domain A trusts Domain B and Domain B trusts 
Domain C, Domain A implicitly trusts Domain C.  
       Transitive
 
    Two-Way
 
    Trust
Domain
A
Domain
B
Domain
C
An implicit trust exists 
between Domain A and Domain C.
 F I G U R E 1. 2 Transitive two - way trust relationships  
 Generally, triangles are used in network diagrams to represent Active 
Directory domains (thereby indicating their hierarchical structure), and 
circles are used to represent organizational units. 
 Overall, the purpose of domains is to ease administration while providing for a common 
security and resource database.  
 Overview of an Active Directory Forest 
 Although the ﬂ exibility and power afforded by the use of an Active Directory domain 
will meet the needs of many organizations, there are reasons for which companies might 
want to implement more than one domain. It is important to know that domains can be 
combined into domain trees. 
 Domain trees are hierarchical collections of one or more domains that are designed to 
meet the organizational needs of a business (see Figure 1.3).  
Understanding Active Directory’s Logical Structure 
13

14 
Chapter 1  Overview of Active Directory
stellacon.com
sales.
stellacon.com
us.sales.
stellacon.com
Domain Tree
  F I G U R E 1. 3 A domain tree  
 Trees are deﬁ ned by the use of a contiguous namespace. For example, the following 
domains are all considered part of the same tree: 
 
  stellacon.com 
 
  sales.stellacon.com 
 
  research.stellacon.com 
 
  us.sales.stellacon.com 
 The ﬁ rst domain that gets installed in your Active Directory forest is called the  root 
domain . Notice that all of these domains are part of the  stellacon.com domain, which is 
the root domain for this tree. Domains within the same tree still maintain separate security 
and resource databases, but they can be administered together through the use of trust 
relationships. By default, trust relationships are automatically established between parent 
and child domains within a tree. 
 Although single companies will often want to conﬁ gure domains to ﬁ t within a single 
namespace, noncontiguous namespaces may be used for several reasons. Domain trees can 
be combined together into noncontiguous groupings. Such a grouping is known as a  forest  
(see Figure 1.4). A forest can consist of a single domain, but a forest often contains multiple 
noncontiguous namespaces — domains that are kept separate for technical or political reasons.  

acmetools.com
sales.acmetools.com
austin.sales.acmetools.com
abchardware.com
europe.abchardware.com
 F I G U R E 1. 4 An Active Directory forest  
 Trust relationships (which facilitate shared resources) can be created among the 
following entities: 
 
  Among domains within a tree  
 
  Among trees within a forest  
 
  Among forests (Windows Server 2003 and 2008)  
 Understanding Active Directory Objects 
 The Active Directory database is made up of units called  objects . Each object represents a 
single unique database entry. 
 Names and Identifiers of Objects 
 Objects are uniquely identiﬁ ed within your database in the following ways: 
 
  Each object has a globally unique identifier (GUID) or security identifier (SID).  
 
  Each object has a distinguished name (DN).  
Understanding Active Directory Objects 
15

16 
Chapter 1  Overview of Active Directory
 GUIDs and SIDs 
 Globally unique identiﬁ ers are security identiﬁ cation numbers placed on applications by 
Active Directory. These numbers are guaranteed to be unique, but the number generated is 
very large, so the odds are very low that two applications will end up with the same GUID. 
 Security identiﬁ ers are security identiﬁ cation numbers placed on objects (for example, users, 
groups, and printers) by Active Directory. All rights and permissions are placed on the SID 
and not the account name. For example, let ’ s say we have an IT manager named Maria who is 
going on maternity leave. John is temporarily replacing Maria. By renaming Maria ’ s account 
and having John change the password, we give John all the rights and permissions that Maria 
had; this is because the SID on the account did not change, even though the name did.  
 Microsoft likes to ask questions on the exam about switching rights and 
permissions from one user to another. Understanding how the rights 
and permissions are associated with the SID will help you answer these 
questions correctly.  
 Distinguished Names 
 A fundamental feature of Active Directory is that each object within the directory has 
its own unique name, as well as a unique SID (for security objects). For example, your 
organization may have two different users named John Smith (who may or may not be in 
different departments or locations within the company). There should be some way for us 
to distinguish between these users (and their corresponding user objects). 
 Within Active Directory, each object can be uniquely identiﬁ ed using a long name that 
speciﬁ es the full path to the object. Generally, this long name for an object is called the 
 distinguished name (DN) . Following is an example of a DN: 
/O=Internet/DC=Com/DC=Stellacon/DC=Sales
/CN=Managers/CN=John Smith 
 In this name, we have speciﬁ ed several different types of objects: 
 
  Organization (O) is the company or root - level domain. In this case, the root level is 
the Internet.  
 
  Domain component (DC) is a portion of the hierarchical path. Domain components 
are used for organizing objects within the directory service. The three domain 
components in the example DN specify that the user object is located within the 
 sales.stellacon.com domain.  
 
  Common name (CN) specifies the names of objects in the directory. In this example, 
the user  John Smith is contained within the  Managers container.  
 Together, the components of the DN uniquely identify where the user object is stored. 
 Instead of specifying the full DN, you might also choose to use a  relative distinguished 
name (RDN) . This name speciﬁ es only part of the object ’ s path relative to another 
object. For example, if your current context is already the  Managers group within the 
 sales.stellacon.com domain, you could simply specify the user as  CN=John Smith . 

 Functions of the SID and the DN 
 The difference between the DN and the SID is this: If you change the structure of the 
domain — for example, by renaming one of the containers or moving the user object —
 the DN of this object also changes. This type of naming system allows for ﬂ exibility 
and the ability to easily identify the potentially millions of objects that might exist in 
Active Directory.  
 Using Organizational Units (OUs) in Active Directory 
 The fundamental unit of organization within an Active Directory domain is the 
organizational unit (OU). OUs are container objects that can be hierarchically arranged 
within a domain. Figure 1.5 provides examples of two typical OU setups. OUs can contain 
other objects such as users, groups, computers, and even other OUs.  
Active Directory
Domain
(Geographically-Based)
Active Directory
Domain
(Functionally-Based)
North America
Sales
Marketing
Engineering
Asia
Sales
Marketing
Engineering
Sales
North America
Asia
Marketing
North America
Asia
Engineering
North America
Asia
Root
Root
 F I G U R E 1. 5 Two different OU hierarchy models  
Understanding Active Directory Objects 
17

18 
Chapter 1  Overview of Active Directory
 OUs are the objects to which security permissions and group policies are generally 
assigned. This means that proper planning of OU structure is important. A well - designed 
OU structure can allow for efﬁ cient administration of Active Directory objects. 
 OUs can be organized based on various criteria. For example, we might choose to 
implement an OU organization based on the geographic distribution of our company ’ s 
business units or based on functional business units (see Figure 1.5).  
 Security Features of User, Computer, and Group Objects 
 The real objects that you will want to control and manage with Active Directory are the 
users, computers, and groups within your network environment. These are the types of 
objects that allow for the most granular level of control over permissions and allow you to 
conﬁ gure your network to meet business needs.  
 
  User account objects  enforce security within the network environment. These accounts 
define the login information and passwords that individuals using your network need 
to enter to receive permissions to use network objects.  
 
  Computer objects allow systems administrators to configure the functions that can be 
performed on client machines throughout the environment.  
 Both user account objects and computer objects enable security to be maintained at a 
granular level. 
 Although security can be enforced by placing permissions directly on user and computer 
objects, it is much more convenient to combine users into groups for the purpose of 
assigning permissions. 
 For example, if three users will require similar permissions within the Accounting 
department, you can place all of them in one group and assign permissions to the group. If 
users are removed or added to the department, you can easily make changes to the group 
without having to make any further changes to security permissions. Figure 1.6 shows how 
groups can be used to easily administer permissions.  
are assigned
permissions to
Files
Database
Printers
Corporate
Sales
HR
placed
in
Users
Groups
Resources
  F I G U R E 1.6 Using groups to administer security  

 There are two main types of groups within Active Directory: 
 
  Security groups are used to administer permissions. All members of a security group 
receive the same security settings and are able to send email and other messages to 
several different users at once.  
 
  Distribution groups are used only to send email and other messages to several different 
users at once. You don ’ t have to maintain security permissions when using distribution 
groups, but they can help you handle multiple users.  
 Overall, using groups properly really helps you implement and manage security and 
permissions within Active Directory.  
 Delegation of Administrative Control 
 An OU is the smallest component within a domain to which administrative permissions 
and group policies can be assigned. (Administrative permissions and group policies are 
covered in Chapter 5,  “ Conﬁ guring Sites and Replication, ” and Chapter 6,  “ Conﬁ guring 
Active Directory Server Roles. ” ) Now, we take a look at speciﬁ cally how to set 
administrative control on OUs. 
 Delegation occurs when a higher security authority assigns permissions to a lower 
security authority. 
 As a real - world example, assume that you are the director of IT for a large organization. 
Instead of doing all of the work yourself, you would probably assign roles and 
responsibilities to other individuals. 
 For example, if you worked within a multidomain environment, you might make one 
systems administrator responsible for all operations within the Sales domain and another 
responsible for the Engineering domain. Similarly, you could assign the permissions for 
managing all printers and print queues within your organization to one individual user while 
allowing another individual user to manage all security permissions for users and groups. 
 In this way, you can distribute the various roles and responsibilities of the IT staff 
throughout the organization. Businesses generally have a division of labor that handles all 
of the tasks involved in keeping the company ’ s networks humming. Network operating 
systems, however, often make it difﬁ cult to assign just the right permissions, or in other 
words, they have very granular permissions. Sometimes, this complexity is necessary to 
ensure that only the right permissions are assigned. 
 A good general rule of thumb is that you should provide users and administrators the 
minimum permissions they require to do their jobs. This way you can reduce the risk that 
accidental, malicious, and otherwise unwanted changes will occur.  
 You can also use auditing to log events to the Security Log in the Event 
Viewer. Doing so ensures that if accidental, malicious, and otherwise 
unwanted changes do occur, they are logged and traceable. 
Understanding Active Directory Objects 
19

20 
Chapter 1  Overview of Active Directory
 In the world of Active Directory, you use the process of delegation to deﬁ ne permissions 
for OU administrators. As a systems administrator you will occasionally need to delegate 
responsibility to others — you can ’ t do it all (although sometimes some administrators 
believe that they can!). If you do need to delegate, remember that Windows Server 2008 
was designed to offer you the ability to do so. 
 Simply, delegation allows a higher administrative authority to grant an individual or a 
group speciﬁ c administrative rights for containers and subtrees. This feature eliminates the 
need to assign any one individual administrator sweeping authority over large segments of 
the user population. You can break up this control over branches within your tree, within 
each OU you create.  
 To understand delegation and rights, you should first understand 
the concept of access control entries (ACEs). ACEs grant specific 
administrative rights on objects in a container to a user or group. 
The container ’ s access control list (ACL) is used to store ACEs.  
 When you are considering implementing delegation, there are two main concerns to 
keep in mind:  
  Parent - Child Relationships   The OU hierarchy you create will be very important when 
you consider the maintainability of security permissions. OUs can exist in a parent - child 
relationship, which means that permissions and group policies set on OUs higher up in 
the hierarchy (parents) can interact with objects in OUs lower on the hierarchy (children). 
When it comes to delegating permissions, this is extremely important. You can allow 
child containers to automatically inherit the permissions set on parent containers. For 
example, if the North America division of your organization contains 12 other OUs, you 
could delegate the same set of permissions to all of them by placing security permissions 
on the North America division. By doing the task only once, you save time and reduce the 
likelihood of human error. This feature can greatly ease administration, especially in larger 
organizations, but it is also a reminder of the importance of properly planning the OU 
structure within a domain.  
 You can delegate control only at the OU level and not at the object level 
within the OU. 
  Inheritance Settings   Now that you ’ ve seen how you can use parent - child relationships 
for administration, you should consider  inheritance , the actual process of inheriting 
permissions. When you set permissions on a parent container, all of the child objects are 
conﬁ gured to inherit the same permissions. You can override this behavior, however, if 
business rules do not lend themselves well to inheritance.  

 Introducing Windows Server 2008 
R2 Server Roles 
 Windows Server 2003 had many tools an administrator could use to conﬁ gure the services 
they needed to make a network run efﬁ ciently. Some of these tools included the Manage 
Your Server, Conﬁ gure Your Server, and the Add/Remove Windows components. 
 Windows Server 2008 includes a feature called  Server Manager . Server Manager is a 
Microsoft Management Console (MMC) snap - in that allows an administrator to view 
information about server conﬁ guration, the status of roles that are installed, and links for 
adding and removing features and roles (see Figure 1.7).  
 F I G U R E 1.7 Windows Server 2008 R2 server roles  
 The following are some of the roles that you can install and manage using Server 
Manager.  
 
  Active Directory Certificate Services  
 
  Active Directory Domain Services  
Introducing Windows Server 2008 R2 Server Roles 
21

22 
Chapter 1  Overview of Active Directory
 
  Active Directory Federation Services  
 
  Active Directory Lightweight Directory Services  
 
  Active Directory Rights Management Services  
 This is not the complete list of roles. These are some of the roles that 
directly affect Active Directory. All Active Directory server - based roles 
are discussed in detail in Chapter 5. 
 Active Directory Certificate Services 
 Active Directory Certiﬁ cate Services (AD CS) allows administrators to conﬁ gure services 
for issuing and managing public key certiﬁ cates. Companies can beneﬁ t from AD CS 
security by combining a private key with an object (such as users and computers), devices 
(such as routers), or services. When using Server Manager, you can conﬁ gure the following 
components of AD CS:  
 Web Enrollment   This feature allows users to request certiﬁ cates and retrieve certiﬁ cate 
revocation lists (CRLs) through the use of a web browser.  
  Certificate Authorities   Enterprise Root CAs and Stand Alone Root CAs are the two 
types of CAs. Enterprise Root CAs (automatically integrated with Active Directory) are 
the top - most trusted CAs of the hierarchy. They hold the certiﬁ cates that you issue to the 
users within your organization. The Stand Alone Root CAs hold the CAs that you issue to 
Internet users. 
 CAs below the Enterprise and Stand Alone Root CAs in the hierarchy are referred to 
as Subordinate CAs. The Enterprise or Stand Alone Root CAs give certificates to the 
Subordinate CAs, which in turn issue certificates to objects and services.  
  Network Device Enrollment Service   The Network Device Enrollment Service allows 
network devices (such as routers) to obtain a certiﬁ cate even though they do not have an 
account in the Active Directory domain. 
  Online Responder Service   Some applications such as Secure/Multipurpose Internet 
Mail Extensions (S/MIME), Secure Sockets Layer (SSL), Encrypting File System (EFS), 
and smart cards may need to validate the status of a certiﬁ cate. The Online Responder 
service responds to certiﬁ cate status requests, evaluates the status of the certiﬁ cate that 
was requested, and answers the request with a signed response containing the certiﬁ cate ’ s 
status information.  
 Active Directory Domain Services 
 In Windows Server 2008, you can use Active Directory Domain Services (AD DS) to 
manage objects (users, computers, printers, etc.) on a network. Many new features have 

been added to AD DS that were not available in previous versions of Windows Server 
Active Directory. Thanks to these new features, now organizations can securely deploy and 
administer AD DS more efﬁ ciently. Some of the features include the following:  
 User Interface Improvements   The updated Installation Wizard for AD DS allows it to 
be installed more easily. Administrators are able to locate domain controllers anywhere 
throughout the enterprise, and due to the improved AD DS user interface (UI), domain 
controllers have new options during the installation process. One of these is the ability to 
set up  read - only domain controllers (RODCs) . 
 Read - Only Domain Controllers   Windows Server 2008 has a new type of domain 
controller called a read - only domain controller. This gives an organization the ability to 
install a domain controller in an area or location (on or offsite) that has limited security. 
 Let ’ s imagine a hospital running Microsoft Windows Server 2003. This hospital has many 
affiliated physicians ’ offices located near it. Most likely these remote locations would not 
have domain controllers at their offices because administrators usually do not like to put a 
writable domain controller in an unsecured location. If the staff at these offices wanted to 
log into the hospital system, they would have to go across the WAN to be authenticated. 
 Now let ’ s imagine the same hospital running Microsoft Windows Server 2008. The 
hospital can now place RODCs at these remote physicians ’ offices, which greatly 
improves performance for these sites.  
 Auditing   In previous versions of Microsoft Windows Server, you had the ability to audit 
Active Directory by watching for successes or failures. If an individual made a successful or 
unsuccessful change to an Active Directory object, the attempt was logged in the Security 
Log. The problem with this was that, although you could view the Security Log and notice 
that someone accessed an object, you could not view what they might have changed in that 
object ’ s attributes. 
 In Microsoft Windows Server 2008, you can view the new and old values of the object and 
its attributes.  
 Fine - Grained Password Policies   In Microsoft Windows Server 2000 and 2003, when an 
organization implemented a domain - based password policy, it applied to all users in that 
domain. There was no inexpensive way to have individuals or groups use a different password 
policy. The same limitation applied to the account lockout policy. Fine - grained password policies 
allow an organization to have different password and account lockout policies for different sets 
of users in the same domain.  
 Restartable Active Directory Domain Services   Microsoft Windows Server 2008 gives 
an administrator the ability to stop or restart Active Directory Domain Services. For 
example, administrators can do an ofﬂ ine defragmentation of the Active Directory 
database or apply security updates without needing to restart the machine. This allows 
other services not dependent on Active Directory (DNS, DHCP, etc.) to continue to 
operate while Active Directory is ofﬂ ine.  
Introducing Windows Server 2008 R2 Server Roles 
23

24 
Chapter 1  Overview of Active Directory
  Database Mounting Tool   In previous versions of Active Directory, if an object got deleted, 
an administrator had to load multiple online backups until they found the object to restore. 
The Windows Server 2008 Active Directory database mounting tool ( Dsamain.exe ) allows 
an administrator to view Active Directory data that was backed up online or through the 
Volume Shadow Copy Service (snapshot) at different times and then decide which online 
backup or snapshot to restore. This allows an administrator to quickly ﬁ nd and restore the 
data that they need.  
 Active Directory Federation Services 
 Active Directory Federation Services (AD FS) provides Internet - based clients a secure 
identity access solution that works on both Windows and non - Windows operating 
systems. 
 Let ’ s imagine a user who logs into their domain when arriving at work in the morning. 
An authentication box asks the user for their credentials (username and password). The 
same user then tries to access an Internet application that operates on another network. 
Normally when a user from one network tries to access an application in another network, 
they must have a secondary username and password. 
 AD FS gives users the ability to do a  single sign - on (SSO) and access applications on 
other networks without needing a secondary password. Organizations can set up trust 
relationships with other trusted organizations so a user ’ s digital identity and access rights 
can be accepted without a secondary password.  
 AD FS in Use 
 Two companies have decided to work together. Company A is a retail shop that gets all of 
its supplies from Company B. Once these two companies decided to become partners, if 
they use AD FS, they can work together as if they were one company. 
 The companies might set up their operations so that a manager from Company A can 
log into an inventory database in Company B ’ s network and order as many products as 
they need without approval. A lower - level employee in Company A can also log into the 
inventory database and place an order, but the order ﬁ rst has to be approved (since 
this level of employee does not have the rights to automatically order) by someone with the 
appropriate rights. 
 Because these companies decided to use AD FS, they can now share resources easily. 

 Active Directory Lightweight Directory Services 
 Active Directory Lightweight Directory Services (AD LDS) is a  Lightweight Directory 
Access Protocol (LDAP) directory service. This type of service allows directory - enabled 
applications to store and retrieve data without needing the dependencies AD DS requires. 
 To fully understand AD LDS, you must ﬁ rst understand the LDAP. LDAP is an 
application protocol used for querying and modifying directory services. 
 Think of directory services as an address book. An address book is a set of names 
(your objects) that you organize in a logical and hierarchical manner (names organized 
alphabetically). Each name in the address book has an address and phone number 
(the attributes of your objects) associated with it. LDAP allows you to query or modify 
this address book.  
 Active Directory Rights Management Services 
 Active Directory Rights Management Services (AD RMS), included with Microsoft 
Windows Server 2008, allows administrators or users to determine what access (open, 
read, modify, etc.) they give to other users in an organization. This access can be used to 
secure email messages, internal websites, and documents.  
 To secure documents, Microsoft Office 2003 Professional (Word, Excel, 
PowerPoint, and Outlook), Microsoft Office 2007 Enterprise, Professional 
Plus, or Ultimate, or Microsoft Office 2010 is required.  
 Organizations can use AD RMS for conﬁ dential or critical information. They can design 
usage policy templates that can be applied directly to the conﬁ dential information. 
 AD RMS requires an AD RMS – enabled client. Windows Vista and Windows 7 both 
include the AD RMS client by default. If you are not using Windows Vista, Windows 7, 
or Windows Server 2008 / 2008 R2, you can download the AD RMS client for previous 
versions of Windows from Microsoft ’ s Download Center. 
 An advantage of AD RMS is its easy installation and administration. You can install 
AD RMS easily through Server Manager and administer it through the MMC snap - in. AD 
RMS has created three new administrative roles to allow for its easy delegation throughout 
an organization: 
 
  AD RMS Enterprise Administrators  
 
  AD RMS Template Administrators  
 
  AD RMS Auditors  
 Another advantage of AD RMS is its integration with AD FS, which allows two 
organizations to share information without needing to install AD RMS in both organizations.  
Introducing Windows Server 2008 R2 Server Roles 
25

26 
Chapter 1  Overview of Active Directory
 
We will discuss the advantages of AD RMS in Chapter 5. Chapter 5 
also shows the step - by - step installation of all the server roles we have 
discussed in this section.  
 Introducing Identity and Access (IDA) 
in Windows Server 2008 
 In today ’ s complex business world, users may have to access resources on different types of 
hardware, software, and devices. Because many of these systems and devices do not always 
communicate with each other, it is not unusual for users to have multiple identities on 
multiple systems. 
 If you have worked in the computer industry for even a short period of time, you 
understand that users having multiple identities and passwords for multiple systems can 
cause many problems. This practice can actually increase security risks due to the errors 
that end users can encounter by having multiple accounts.  
 How Users Deal with Multiple Accounts and Passwords 
 In today ’ s technical world, we all have multiple usernames and passwords. I recently 
watched a morning news program that stated that the average person has eight sets 
of these. Think about it: credit card logons, online banking, websites that we visit, and 
many others. 
 Now many of us (myself included) write down all the different website usernames and 
passwords we use. At home, this is normally not an issue because we do not have 100 
employees walking by our computer or ofﬁ ce. The problem occurs when we use the 
same method at the ofﬁ ce. 
 Let ’ s say my company, Stellacon Corporation, decides to hire a good salesperson. Now 
when I say a good salesperson, I mean someone you can give a list of names and phone 
numbers to and they can make sales happen. But now they must use a computer to do 
their job. 
 This new salesperson has a username and password to log into the Microsoft Windows 
domain, a username and password to log into a lead - generating website, and other 
usernames and passwords to do their job. So what do they do? Well, if you have been in 

 Users ’ identities are an ongoing concern for most companies. This is where Identity 
and Access (IDA) solutions can help an organization. Through technologies and products 
speciﬁ cally designed for IDA, organizations can manage user identities and associated 
access privileges. IDA solutions can be categorized into ﬁ ve distinct areas: 
 
  Directory services  
 
  Strong authentication 
 
  Federated Identities  
 
  Information protection  
 
  Identity Lifecycle Management 
In the following sections, we will explain these five distinct areas in more 
detail. Because IDA is so tightly integrated with Windows Server 2008, 
some of these categories were covered in the previous section,  “ Introduc-
ing Windows Server 2008 R2 Server Roles. ”  Here we will explain how 
these previously discussed concepts interact with IDA. 
 Using Directory Services 
 As discussed earlier in this chapter, in Windows Server 2008, AD DS can be used by 
organizations to manage objects (users, computers, printers, etc.) on a network. 
 One of the advantages of using AD DS with IDA solutions is that directory services are 
deployed in many organizations worldwide. The chances are very good that when you work 
with other companies, they will also be using Microsoft directory services. 
 Also, by default, directory services are integrated with certiﬁ cates, rights management, 
and Federation Services. As discussed earlier in this chapter, directory services give you the 
following beneﬁ ts: 
 
  Read - only domain controllers  
 
  Auditing  
this industry long enough, you know the stories of what users do with their credentials —
 they write them down and tape them to their monitor or maybe under the keyboard. My 
favorite story is of the person who put all their credential information on a Rolodex card 
and made it the ﬁ rst card in their Rolodex holder. 
 The Information Technology department needs to train their users on the importance 
of user credential security. If users tape their credentials to their monitor, it ’ s our fault 
as IT managers; we did not train them properly. It ’ s up to us to help make our users safe 
and secure. 
Introducing Identity and Access (IDA) in Windows Server 2008 
27

28 
Chapter 1  Overview of Active Directory
 
  Fine - grained password policies  
 
  Restartable Active Directory Domain Services  
 
  Database mounting tool  
 
  Active Directory Recycle Bin  
 Strong Authentication 
 You can strengthen your network in many ways. One of the major ways to use strong 
authentication is with two - factor authentication. The most common two - factor authentication 
method uses the  smart card . Windows XP has built in smart - card support, but Windows 
Vista and Windows 7 have taken this to a higher level. Smart cards look like bank ATM 
cards or hotel room key cards. To use a smart card, you place it into a smart card reader and 
put in a personal identiﬁ cation number (PIN). 
 Another form of strong authentication uses the certiﬁ cate. Certiﬁ cate authority is fully 
integrated with Active Directory. Active Directory Certiﬁ cate Services (AD CS) allows 
administrators to conﬁ gure services for issuing and managing public key certiﬁ cates. 
Companies can beneﬁ t from AD CS security by combining a private key with an object 
(such as users and computers), devices (such as routers), or services. With AD CS you get 
the following beneﬁ ts: 
 
  Web enrollment  
 
  Certificate Authorities (CAs)  
 
  Network Device Enrollment Service  
 
  Online Responder  
 Strong authentication helps strengthen your IDA. Remember that IDA tries to minimize 
the number of usernames and passwords that users have to remember. When using a form 
of strong authentication, users keep track of fewer credentials (usernames and passwords) 
while still keeping security a top priority.  
 Another easy way to help with strong authentication is to enforce a strong 
password policy (minimum password lengths, unique characters, a 
combination of numbers and letters, and mixed capitalization).  
 Federated Identities 
 As we discussed earlier, AD FS gives users the ability to do a single sign - on (SSO) and 
access applications on other networks without a secondary password. Organizations can 
set up trust relationships with other trusted organizations so users ’ digital identity and 
access rights can be accepted without a secondary password. 

 Federated Identities enables new models for crossover SSO systems between 
organizations. SSO can be used for Windows and non - Windows environments. 
 The full implementation of Federation Identities claims – based architecture is based on 
the Web Services Federation (WS - Federation). The Federation Identities models support 
groups, roles, and rules - based models. 
 This works well as part of the IDA architecture because users who can use SSO 
authentication require fewer password resets and make fewer errors while entering 
credentials.  
 Information Protection 
 Active Directory Rights Management Services (AD RMS) is what information 
protection is all about. Information protection is included with Microsoft Windows 
Server 2008 R2 automatically once the AD RMS service is installed. This service 
allows administrators or users to determine what access (open, read, modify, etc.) 
they give to other users in an organization. This access can be used to secure email 
messages, internal websites, and documents. 
 Information protection supports Microsoft Ofﬁ ce 2003 (Word, Excel, PowerPoint, and 
Outlook), Microsoft Ofﬁ ce 2007, and Microsoft Ofﬁ ce 2010.  
 If you are not using Microsoft Office 2003 (Word, Excel, PowerPoint, and 
Outlook), Microsoft Office 2007, or Microsoft Office 2010, users can always 
use basic information protection in the form of encryption. (Encryption is 
only available if the file structure is NTFS). 
 Information protection prevents unauthorized users from opening ﬁ les, email messages, 
and internal websites if they do not have appropriate access. It also allows email to be 
tracked. This information protection and tracking will help organizations stay compliant 
with local, state, or federal regulations for data privacy requirements. 
 Some companies have designed information protection solutions to support PDF, 
BlackBerry, and CAD formats.  
 Forefront Identity Manager (FIM) 2010 
 The goal of Forefront Identity Manager (FIM) 2010 is to take some of the basic 
administration work (resetting passwords, managing groups and distribution lists, 
managing resource access, and policy creation) out of the hands of administrators 
and put it into the hands of users.  
 Help desk support technicians reportedly spend an average of one - third of 
their workdays resetting passwords.  
Introducing Identity and Access (IDA) in Windows Server 2008 
29

30 
Chapter 1  Overview of Active Directory
 Now I understand that many of you felt a burning in the pit of your stomach when I 
stated that the goal was to allow users to do administrator ’ s tasks. For most of us, this just 
seems like an impossible goal. But it ’ s not. 
 FIM allows you to set up policies that allow users to do speciﬁ c tasks. Let ’ s say a user goes 
to log into their network but they forget their password. Instead of calling IT or helpdesk, 
they can check a box labeled Forgot Password. A portal opens and the user is asked several 
security questions. If the answers are correct, the user can reset their password. 
 Think about a policy that allows managers to keep track of their own groups and 
distribution lists. Let ’ s say a new salesperson is hired in your company. The sales manager 
can add that individual to the sales group and the sales distribution list. The new 
salesperson will now have access to all the resources every other salesperson has. 
 You may be thinking,  “ How does this help the IT department? ” Well, ﬁ rst it helps IT 
save money. If administrators and IT professionals did not have to spend unproductive time 
doing some of these basic tasks, they could focus on important tasks. 
 Let ’ s say we have an administrator who makes $70,000 a year. For a 40 - hour workweek, 
that ’ s about $35 an hour. Let ’ s say that administrator spends 10 to 15 hours a week on 
group management and resetting passwords. That ’ s a lot of money to pay someone to do a 
task that a basic user can now accomplish. 
 If users and managers could do some of the small day - to - day tasks that take up so 
much of our time, that would free us up to do some of the more important tasks we need 
to accomplish: 
 
  System architecture  
 
  System deployments  
 
  System administration and auditing  
 
  Creating security policies  
 Another advantage of FIM is that more than 20  connectors are included with the 
installation. Connectors are software add - ons that allow different applications and servers 
to communicate with each other. Many other add - on connectors are also available and will 
allow you to connect a wide range of systems and applications quickly and easily.  
 Summary 
 In this chapter, we covered Active Directory fundamentals. We gave you a high - level 
overview of many concepts related to Active Directory and how it is logically laid out. 
We covered the beneﬁ ts of deploying Active Directory, including its hierarchical 
organization, extensible schema, centralized data storage, replication, ease of 
administration, network security, client conﬁ guration management, scalability 
and performance, and searching functionality. 
 We went on to cover the logical components of Active Directory, such as forests, 
domains, trees, and objects, and how you can create multiple Active Directory domains 

and why you might do so. (For example, you can keep two companies ’ internal system 
models separate if you have a merger or acquisition.) We also covered the importance of 
how you name Active Directory objects and how domain naming affects the planning 
of Active Directory. 
 You then learned about the Windows Server 2008 server roles that are integrated with 
Active Directory. We covered the ﬁ ve main Windows Server 2008 Active Directory server 
roles (Active Directory Certiﬁ cate Services, Active Directory Domain Services, Active 
Directory Federation Services, Active Directory Lightweight Directory Services, and 
Active Directory Rights Management Services). 
 Finally, we covered Identity and Access (IDA) solutions and how IDA can help an 
organization ’ s users stay safe and secure while entering their credentials. 
 In the next chapter, we will cover the Domain Name System (DNS).  
 Exam Essentials  
 Understand the problems that Active Directory is designed to solve.   The creation of 
a single, centralized directory service can make network operations and management 
much simpler.  
 Understand Active Directory design goals.   Active Directory should be structured to 
mirror an organization ’ s logical structure. Understand the factors that you should take into 
account, including business units, geographic structure, and future business requirements.  
 Understand Windows Server 2008 server roles.   Understand what the ﬁ ve Active Directory 
Windows Server 2008 server roles — AD CS, AD DS, AD FS, AD LDS, and AD RMS — do 
for an organization and its users.  
 Understand Identity and Access (IDA) solutions.   Understand how IDA can help 
organizations solve the problems associated with multiple usernames and passwords. 
Understand how the Active Directory Windows Server 2008 server roles work with 
and affect IDA. 
Exam Essentials 
31

32 
Chapter 1  Overview of Active Directory
 Review Questions  
 1. 
  Domains provide which of the following functions?  
 A.   Creating logical boundaries  
 B.   Easing the administration of users, groups, computers, and other objects  
 C.   Providing a central database of network objects  
 D.   All of the above  
 2. 
  You are the administrator for a large organization with multiple remote sites. Your 
supervisor would like to have remote sites log in locally to their own site, but he is nervous 
about security. What type of server can you implement to ease their concerns?  
 A.   Domain controller  
 B.   Global Catalog  
 C.   Read - only domain controller  
 D.   Universal Group Membership Caching Server  
 3. 
 Which of the following objects is used to create the logical structure within Active 
Directory domains?  
 A.   Users 
 B.   Sites  
 C.   Organizational units (OUs)  
 D.   Trees  
 4. 
  Which of the following is  true regarding Active Directory trust relationships?  
 A.   Trusts are transitive. 
 B.   By default, trusts are two - way relationships.  
 C.   Trusts are used to allow the authentication of users between domains.  
 D.   All of the above.  
 5. 
  Which of the following protocols is used to query Active Directory information?  
 A.   LDAP  
 B.   NetBEUI  
 C.   NetBIOS  
 D.   IPX/SPX  

 6. 
 You are the administrator for a large organization. Your organization currently has a 
Windows Server 2003 domain. Your company has set up a domain - based password policy, 
but the organization is unhappy with the requirement to have a single policy for all users. 
Your company is considering upgrading to Windows Server 2008. What feature will solve 
the problem of only one policy for all domain users?  
 A.   Microsoft Windows Server 2008 multi - password policy  
 B.   Fine - grained password policy 
 C.   Certificate server policy  
 D.   None of the above  
 7. 
  What Windows Server 2008 server role allows a user to have a single sign - on (SSO) to 
access multiple applications?  
 A.   Active Directory Domain Services  
 B.   Active Directory Federation Services  
 C.   Active Directory Lightweight Directory Services  
 D.   Active Directory Rights Management Services  
 8. 
  What are some of the advantages of using Windows Server 2008 Active Directory 
Certificate Services?  
 A.   Web enrollment  
 B.   Network Device Enrollment Service  
 C.   Online Responder  
 D.   All of the above  
 9. 
  What Windows Server 2008 server role allows a user to secure an email while using 
Microsoft Office 2007 Outlook?  
 A.   Active Directory Domain Services  
 B.   Active Directory Federation Services  
 C.   Active Directory Rights Management Services  
 D.   Active Directory Lightweight Directory Services  
 10.   Which of the following features of Active Directory allows information between domain 
controllers to remain synchronized?  
 A.   Replication  
 B.   The Global Catalog  
 C.   The schema  
 D.   None of the above  
Review Questions 
33

34 
Chapter 1  Overview of Active Directory
 Answers to Review Questions 
 1. 
D.  All of these options are features of domains and are reasons for their usefulness. 
 2. 
C.  Windows Server 2008 has a type of domain controller called a read - only domain 
controller (RODC). This gives an organization the ability to install a domain controller in 
an area or location (on or offsite) where security is a concern.  
 3. 
C.  OUs are used for creating a hierarchical structure within a domain. Users are objects 
within the directory, sites are used for physical planning, and trees are relationships between 
domains. 
 4. 
D.   Trusts are designed for facilitating the sharing of information and have all of these 
features.  
 5. 
A.   LDAP is the Internet Engineering Task Force (IETF) standard protocol for accessing 
information from directory services. It is also the standard used by Active Directory.  
 6. 
B.  Fine - grained password policies allow an organization to have different password and 
account lockout policies for different sets of users in the same domain. 
 7. 
B.   Active Directory Federation Services gives users the ability to do an SSO and access 
applications on other networks without a secondary password.  
 8. 
D.  Web enrollment, certiﬁ cate authorities (CAs), the Network Device Enrollment Service, and 
the Online Responder are four advantages of Active Directory Certiﬁ cate Services. 
 9. 
C.  Active Directory Rights Management Services (AD RMS) is included with Microsoft 
Windows Server 2008. This service allows administrators or users to determine what access 
(open, read, modify, etc.) they give to other users in an organization. This access can be used 
to secure email messages, internal websites, and documents. Organizations can use AD RMS 
for conﬁ dential or critical information. 
 10. A.  Replication ensures that information remains synchronized between domain controllers. 
 Microsoft continually updates its question pool. We occasionally will  
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswindows2008r2 . 

Domain Name 
System (DNS)  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Domain Name System (DNS) for Active 
Directory  
 Configure zones. May include but is not limited to: Dynamic 
DNS (DDNS), Non - dynamic DNS (NDDNS), and Secure 
Dynamic DNS (SDDNS); Time to Live (TTL); GlobalNames; 
Primary, Secondary, Active Directory Integrated, Stub; SOA; 
zone scavenging; forward lookup; reverse lookup.  
 Configure DNS server settings. May include but is not limited 
to: forwarding; root hints; configure zone delegation; round 
robin; disable recursion; debug logging; server scavenging.  
 Configure zone transfers and replication. May include but is 
not limited to: configure replication scope (forestDNSzone; 
domainDNSzone); incremental zone transfers; DNS Notify; 
secure zone transfers; configure name servers; application 
directory partitions. 




 Chapter 
2

 The Domain Name System (DNS) is one of the most important 
topics that you need to know about if you are planning to take 
any of the Microsoft administration exams (70 - 640, 70 - 642, 
etc.). It ’ s also imperative that you understand DNS in order to work with Active Directory, 
because Active Directory requires DNS to function properly. 
 DNS is a requirement of Active Directory, and many important system functions 
(including Kerberos authentication and ﬁ nding domain controllers) are handled through 
DNS lookups. Windows 2000, XP, and Vista clients use DNS for name resolution and to 
ﬁ nd Kerberos key distribution centers (KDCs), Global Catalog servers, and other services 
that may be registered in DNS. 
 By the time you ﬁ nish this chapter, you will have a deeper understanding of how 
DNS works and how to set up, conﬁ gure, manage, and troubleshoot DNS in Microsoft 
Windows Server 2008.  
 Introducing DNS 
 The Domain Name System (DNS) is a service that allows you to resolve a hostname to an 
Internet Protocol (IP) address. One of the inherent complexities of working in networked 
environments is working with multiple protocols and network addresses. Thanks largely 
to the tremendous rise in popularity of the Internet, however, most environments have 
transitioned to use TCP/IP (Transmission Control Protocol/Internet Protocol) as their 
primary networking protocol. Microsoft is no exception when it comes to supporting 
TCP/IP in its workstation and server products. All current versions of Microsoft ’ s 
operating systems support TCP/IP, as do most other modern operating systems. 
 A very easy way to understand DNS is to think about making a telephone call. If I 
wanted to call Microsoft and I did not know the phone number, I could call information, 
tell them the name (Microsoft), and get the telephone number. I would then make my 
call. Now think about trying to connect to Server1. I don ’ t know the TCP/IP number 
(the computer ’ s telephone number) so my computer asks DNS (information) for the number 
of Server1. DNS returns the number and my system makes the connection (the call). DNS 
is your network ’ s 411 or information, and it returns the TCP/IP data for your network. 
 TCP/IP is actually a collection of different technologies (protocols and services) that 
allow computers to function together on a single, large, heterogeneous network. Some of 
the major advantages of this protocol include widespread support for hardware, software, 
and network devices; reliance on a system of standards; and scalability. TCP handles 

Introducing DNS 
37
tasks such as sequenced acknowledgments. IP involves many issues such as logical subnet 
assignment and routing.  
 It is beyond the scope of this chapter to fully describe the intricacies of 
working with TCP/IP; full details are covered in stand - alone volumes.  
 The Form of an IP Address 
 To understand DNS, you must ﬁ rst understand how TCP/IP addresses are formed. Since 
DNS is strictly on a network to support TCP/IP, understanding the basics of TCP/IP is 
very important.  
 Microsoft exams cover TCP/IP in depth. The TCP/IP material will be 
covered in the Infrastructure section (Part 2) of this book.  
 An IP address is a logical number that uniquely identiﬁ es a computer on a TCP/IP 
network. TCP/IP allows a computer packet to reach the correct host. Windows Server 2008 
works with two versions of TCP/IP: IPv4 and IPv6. An IPv4 address takes the form of four 
octets (eight binary bits), each of which is represented by a decimal number between 0 and 
255. The four numbers are separated by decimal points. For example, all of the following 
are valid IP addresses: 
 
  128.45.23.17 
 
  230.212.43.100 
 
  10.1.1.1 
 The dotted decimal notation was created to make it easier for users to deal with IP 
addresses, but this idea did not go far enough. As a result, another abstraction layer 
that used names to represent the dotted decimal notation was developed — the domain 
name. For example, the IP address  11000000 10101000 00000001 00010101 maps to 
 192.168.1.21 , which in turn might map to  server1.company.org — how the computer ’ s 
address is usually presented to the user or application. 
 As stated above, IPv4 addresses are made up of octets or the decimal (base 10) 
representation of 8 bits. It takes four octets to add up to the 32 bits required. IPv6 expands 
the address space to 128 bits. The address is usually represented in hexadecimal notation, 
like this: 
2001:0DB8:0000:0000:1234:0000:A9FE:133E 
 You can tell the implementation of DNS will make life a lot easier for everyone, even 
those of us who like to use alphanumeric values (for example, some of us enjoy pinging 
the address in lieu of the name). Fortunately, DNS already has the ability to handle IPv6 

38 
Chapter 2  Domain Name System (DNS)
address using an AAAA record. An A record in IPv4 ’ s addressing space is 32 bits, and an 
AAAA record (4 As) in IPv6 ’ s is 128 bits. 
 Nowadays, most computer users are quite familiar with navigating to DNS - based 
resources, such as  www.microsoft.com . In order to resolve these  “ friendly ”  names to 
TCP/IP addresses that the network stack can use, you must have some method for mapping 
them. Originally, ASCII ﬂ at ﬁ les (often called  HOSTS ﬁ les, as shown in Figure 2.1) were used 
for this purpose. 
 In some cases, they are still used today in very small networks, and they can be used to 
help troubleshoot name resolution problems. 
 As the number of machines and network devices grew, it became unwieldy for 
administrators to manage all of the manual updates required to enter new mappings to a 
master  HOSTS ﬁ le and distribute it. Clearly, a better system was needed.  
  F I G U R E 2 .1 Sample HOSTS file  
 As you can see from the sample  HOSTS ﬁ le in Figure 2.1, you can conduct a quick test of 
the email server ’ s name resolution.  
 1. 
 Open the  HOSTS file   < C:\Windows\Systems32\drivers\etc >  . 
 2. 
  Add the IP address – to – hostname mapping.  
 3. 
  Try to ping the server using the hostname to verify that that you can reach it using an 
easy - to - remember name.  
 Following these steps should drive home the concept of DNS for you because you can see 
it working to make your life easier. Now you don ’ t have to remember  10.0.0.10 ; you only 
need to remember  exchange03 . 
 You can also see how this method can become unwieldy if you have many hosts that 
want to use easy - to - remember names instead of IP addresses to locate resources on your 
network. 

Introducing DNS 
39
 When dealing with large networks, both users and network administrators must be 
able to locate the resources they require with minimal searching. Users don ’ t care about 
the actual physical or logical network address of the machine; they just want to be able to 
connect to it using a simple name that they can remember. From a network administrator ’ s 
standpoint, however, each machine must have its own logical address that makes it part of 
the network on which it resides. Therefore, some scalable and easy - to - manage method for 
resolving a machine ’ s logical name to an IP address and then to a domain name is required. 
DNS was created for this purpose. 
 DNS is a hierarchically distributed database. In other words, its layers are arranged in 
a deﬁ nite order, and its data is distributed across a wide range of machines, each of which 
can exert control over a portion of the database. DNS is a standard set of protocols that 
deﬁ nes the following: 
 
  A mechanism for querying and updating address information in the database  
 
  A mechanism for replicating the information in the database among servers  
 
  A schema of the database   
 DNS is defined by a number of RFCs, though primarily by RFC 1034 and 
RFC 1035.  
 DNS was originally developed in the early days of the Internet when the Internet (called 
ARPAnet at the time) was a small network created by the Department of Defense for 
research purposes. Before DNS, computer names, or hostnames, were manually entered 
into a  HOSTS ﬁ le located on a centrally administered server. Each site that needed to 
resolve hostnames outside of its organization had to download this ﬁ le. As the number of 
computers on the Internet grew, so did the size of this  HOSTS ﬁ le, as well as the problems 
with its management. The need for a new system that would offer features such as 
scalability, decentralized administration, and support for various data types became 
more and more obvious. DNS, introduced in 1984, became this new system. 
 With DNS, the hostnames reside in a database that can be distributed among multiple 
servers, decreasing the load on any one server and providing the ability to administer this 
naming system on a per - partition basis. DNS supports hierarchical names and allows 
registration of various data types in addition to the hostname – to – IP address mapping used 
in  HOSTS ﬁ les. Database performance is ensured through its distributed nature as well as 
through caching. 
 The DNS distributed database establishes an inverted logical tree structure called the 
domain namespace. Each node, or domain, in that space has a unique name. At the top 
of the tree is the root. This may not sound quite right, which is why the DNS hierarchical 
model is described as being an inverted tree, with the root at the top. The root is represented 
by the null set   “ ”  . When written, the root node is represented by a single dot  “  . ” . 
 Each node in the DNS can branch out to any number of nodes below it. For example, 
below the root node are a number of other nodes, commonly referred to as top - level 
domains (TLDs). These are the familiar  com ,  net ,  org ,  gov ,  edu , and other such names. 
Table 2.1 lists some of these TLDs.  

40 
Chapter 2  Domain Name System (DNS)
 TA B L E 2 .1 Common top - level DNS domains 
 Common Top - Level 
Domain Names  
  Type of Organization  
  com 
  Commercial (for example,  stellacon.com for Stellacon Training 
Corporation.  
  edu 
  Educational (for example,  gatech.edu for the Georgia Institute 
of Technology).  
  gov 
  Government (for example,  whitehouse.gov for the White House 
in Washington, D.C.).  
  int 
  International organizations (for example,  nato.int for NATO). This 
top - level domain is fairly rare. 
 mil 
  Military organizations (for example,  usmc.mil for the Marine Corps). 
There is a separate set of root name servers for this domain. 
 net 
  Networking organizations and Internet providers (for example, 
 hiwaay.net for HiWAAY Information Systems). Many commercial 
organizations have registered names under this domain, too. 
 org 
  Noncommercial organizations (for example,  fidonet.org for FidoNet).  
  au 
  Australia.  
  uk 
  United Kingdom.  
  ca 
  Canada.  
  us 
  United States.  
  jp 
  Japan.  
 Each of these nodes then branches out into another set of domains, and they combine 
to form what we refer to as domain names, such as  microsoft.com . A domain name 
identiﬁ es the domain ’ s position in the logical DNS hierarchy in relation to its parent 
domain by separating each branch of the tree with a dot. Figure 2.2 shows a few of the 
top - level domains, where the Microsoft domain ﬁ ts, and a host called Tigger within 
the  microsoft.com domain. If someone wanted to contact that host, they would use the 
fully qualiﬁ ed domain name (FQDN),  tigger.microsoft.com .  

Introducing DNS 
41
 An FQDN includes the trailing dot ( . ) to indicate the root node, but it ’ s 
commonly left off in practice. 
 (Managed by 
Microsoft)
(Managed by Internic)
Int/Net/Org
Mil
Army Navy
Gov
White 
House
IRS
Edu
MIT Stanford
Com
Microsoft
Tigger
 F I G U R E 2 . 2 The DNS hierarchy 
 As previously stated, one of the strengths of DNS is the ability to delegate control 
over portions of the DNS namespace to multiple organizations. For example, the Internet 
Corporation for Assigned Names and Numbers (ICANN) assigns the control over the 
TLDs to one or more organizations. Those organizations in turn delegate portions of 
the DNS namespace to other organizations. For example, when we register a domain 
name — let ’ s call it  example.com — we control the DNS for the portion of the DNS 
namespace within  example.com . The registrar controlling the  .com TLD has delegated 
control over the  example.com node in the DNS tree. No other node can be named 
 example directly below the  .com within the DNS database. 
 Within the portion of the domain namespace that we control ( example.com ), we 
could create host records and other records (more on these later). We could also further 
subdivide  example.com and delegate control over those divisions to other organizations 
or departments. These divisions are called subdomains. For example, we might create 
subdomains named for the cities in which the company has branch ofﬁ ces and then delegate 
control over those subdomains to the branch ofﬁ ces. The subdomains might be named 
 losangeles.example.com ,  chicago.example.com ,  portsmouth.example.com , and so on. 
 Each domain (or delegated subdomain) is associated with DNS  name servers . In other 
words, for every node in the DNS, one or more servers can give an authoritative answer to 
queries about that domain. At the root of the domain namespace are the root servers. More 
on these later.  

42 
Chapter 2  Domain Name System (DNS)
 Domain names and hostnames must contain only characters  a to  z , 
 A to  Z , 0 to 9, and  - (hyphen). Other common and useful characters, like 
the  & (ampersand), / (slash), . (period), and _ (underscore) characters, 
are not allowed. This is in conflict with NetBIOS ’ s naming restrictions. 
However, you ’ ll find that Windows Server 2008 is smart enough to take 
a NetBIOS name, like  Server_1 , and turn it into a legal DNS name, like 
 server1.example.com . 
 DNS servers work together to resolve hierarchical names. If a server already has 
information about a name, it simply fulﬁ lls the query for the client. Otherwise, it queries 
other DNS servers for the appropriate information. The system works well because it 
distributes the authority over separate parts of the DNS structure to speciﬁ c servers. 
A DNS zone is a portion of the DNS namespace over which a speciﬁ c DNS server has 
authority (DNS zone types are discussed in detail later in this chapter).  
 There is an important distinction to make between DNS zones and Active 
Directory (AD) domains. Although both use hierarchical names and require 
name resolution, DNS zones do not map directly to AD domains.  
 Within a given DNS zone, resource records (RRs) contain the hosts and other database 
information that make up the data for the zone. For example, an RR might contain the 
host entry for  www.example.com , pointing it to the IP address  192.168.1.10 . 
 Understanding Servers, Clients, and Resolvers 
 You will need to know a few terms and concepts in order to manage a DNS server. 
Understanding these terms will make it easier to understand how the Windows Server 2008 
DNS server works:  
 DNS Server   Any computer providing domain name services is a  DNS name server.  No 
matter where the server resides in the DNS namespace, it ’ s still a DNS name server. For 
example, 13 root name servers at the top of the DNS tree are responsible for delegating 
the TLDs. The root servers provide referrals to name servers for the TLDs, which in turn 
provide referrals to an authoritative name server for a given domain.  
 The Berkeley Internet Name Domain (BIND) was originally the only 
software for running the root servers on the Internet. However, a few years 
ago the organizations responsible for the root servers undertook an effort 
to diversify the software running on these important machines. Today, root 
servers run multiple kinds of name server software. BIND is still primary 
on Unix - based machines, and it is the most popular for Internet providers 
as well. None of the root servers run Windows DNS. 

Introducing DNS 
43
 Any DNS server implementation supporting Service Location Resource Records (see RFC 
2782) and Dynamic Updates (RFC 2136) is sufficient to provide the name service for any 
operating system running Windows 2000 software and above.  
 DNS Client   A  DNS client is any machine that issues queries to a DNS server. The client 
hostname may or may not be registered in a DNS database. Clients issue DNS requests 
through processes called resolvers. You ’ ll sometimes see the terms  client and  resolver used 
synonymously.  
 Resolver   Resolvers are software processes, sometimes implemented in software libraries, 
that handle the actual process of ﬁ nding the answers to queries for DNS data. The resolver 
is also built into many larger pieces of software so that external libraries don ’ t have to be 
called in order to make and process DNS queries. Resolvers can be what you ’ d consider 
client computers or other DNS servers attempting to resolve an answer on behalf of a client.  
 Query   A query is a request for information sent to a DNS server. Three types of queries 
can be made to a DNS server: recursive, inverse, and iterative. We ’ ll discuss their differences 
in the following section.  
 Understanding the DNS Process 
 To help you understand the DNS process, we will start by covering the differences 
between Dynamic DNS and Non - Dynamic DNS. During this discussion you will learn 
how Dynamic DNS populates the DNS database. You ’ ll also see how to implement 
security for Dynamic DNS. We will then talk about the workings of different types 
of DNS queries. Finally we will discuss caching and time to live (TTL). You ’ ll learn 
how to determine the best setting for your organization. 
 Dynamic DNS and Non - Dynamic DNS 
 To understand Dynamic DNS and Non - Dynamic DNS, you must go back in time (here is 
where the TV screen always used to get wavy). Many years ago when we all worked on NT 
3.51 and NT 4.0, most networks used  Windows Internet Name Service (WINS) to do their 
TCP/IP name resolution. Windows versions 95/98 and NT 4.0 Professional were all built 
on the idea of using WINS. This worked out well for administrators because WINS was 
 dynamic (which meant that, once it was installed, it automatically built its own database). 
Back then, there was no such thing as Dynamic DNS; administrators had to manually 
enter DNS records into the server. This is important to know even today. If you have clients 
still running any of these older operating systems (95/98 or NT 4) these clients cannot use 
Dynamic DNS. 
 Now let ’ s move forward in time to the release of Windows Server 2000. Microsoft 
announced that DNS was going to be the name resolution method of choice. Many 
administrators (me included) did not look forward to the switch. Because there was no 
such thing as Dynamic DNS, most administrators had nightmares about manually entering 
records. But luckily for us, when Microsoft released Windows Server 2000, DNS had the 
ability to be dynamic. 

44 
Chapter 2  Domain Name System (DNS)
 Now, when you ’ re setting up Windows Server 2008 R2 DNS, you can choose what type 
of dynamic update you would like to use, if any. Let ’ s talk about why you would want to 
choose one over the other. 
 The  Dynamic DNS (DDNS) standard , described in RFC 2136, allows DNS clients to 
update information in the DNS database ﬁ les. For example, a Windows Server 2008 R2 
DHCP server can automatically tell a DDNS server which IP addresses it has assigned 
to what machines. Windows 2000, 2003, 2008, XP Pro, Vista, and Windows 7 DHCP 
clients can do this, too — but for security reasons it ’ s better to let the DHCP server do it. 
The result: IP addresses and DNS records stay in sync so that you can use DNS and DHCP 
together seamlessly. 
 Because DDNS is a proposed Internet standard, you can even use Windows Server 2008 
R2 ’ s DDNS - aware parts with Unix/Linux (*nix) – based DNS servers. 
 Non - Dynamic DNS (NDDNS)  does not automatically populate the DNS database. The 
client systems do not have the ability to update to DNS. 
 If you decide to use Non - Dynamic DNS, an administrator will need to populate the 
DNS database manually. Non - Dynamic DNS is a reasonable choice if your organization 
is small to midsize and you do not want extra network trafﬁ c (clients updating to the DNS 
server), or if you need to manually enter the computer ’ s TCP/IP information because of 
strict security measures.  
 Dynamic DNS has the ability to be secure, and the chances are slim that 
a rogue system (a computer that does not belong in your DNS database) 
could update to a secure DNS server. Nevertheless, some organizations 
have to follow stricter security measures and are not allowed to have 
dynamic updates.  
 The major downside to manually entering records into DNS occurs when the 
organization is using the  Dynamic Host Conﬁ guration Protocol (DHCP) . When using 
DHCP, it is possible for users to end up with different TCP/IP addresses every day. This 
means that an administrator has to manually update DNS daily to keep it accurate. 
 If you choose to allow Dynamic DNS, you need to decide how you want to set it up. When 
setting up dynamic updates on your DNS server, you have three choices (see Figure 2.3): 
 
  None — This means your DNS server is Non - Dynamic.  
 
  Nonsecure And Secure — This means that any machine (even if it does not have a 
domain account) can register with DNS. Using this setting could allow rogue systems 
to enter records into your DNS server.  
 
  Secure Only — This means that only machines with accounts in Active Directory can 
register with DNS. Before DNS registers any account in its database, it checks Active 
Directory to make sure that account is an authorized domain computer.  

Introducing DNS 
45
 How Dynamic DNS Populates the DNS Database 
 On a Microsoft Windows Server 2008 R2 network, TCP/IP is the protocol used for 
network communications. Users have two ways to receive a TCP/IP number: 
 
  Static (administrators manually enter the TCP/IP information)  
 
  Dynamic (using DHCP)  
 When an administrator sets up TCP/IP, DNS can also be conﬁ gured. 
 Once a client gets the address of the DNS server, if that client is allowed to update 
with DNS, the client sends a registration to DNS or requests DHCP to send the 
registration. DNS then does one of two things, depending on which Dynamic Updates 
option is speciﬁ ed: 
 
  Check with Active Directory to see if that computer has an account (Secure Only 
updates) and if it does, enter the record into the database  
 
  Enter the record into its database (Nonsecure And Secure updates)  
 What if you have clients (95/98 and NT 4) that cannot update DNS? Well, there is a 
solution — DHCP. In the DNS tab of the IPv4 Properties window, check the option labeled 
 “ Dynamically update DNS A and PTR records for DHCP clients that do not request 
updates (for example, clients running Windows NT 4.0) ” (see Figure 2.4).  
 F I G U R E  2 . 3 Setting the Dynamic Updates option  

46 
Chapter 2  Domain Name System (DNS)
 DHCP, along with Dynamic DNS clients, allows an organization to dynamically update 
its DNS database without the time and effort of having an administrator manually enter 
DNS records.  
 DNS Queries 
 As stated earlier, a client can make three types of queries to a DNS server: recursive, 
inverse, and iterative. Remember that the client of a DNS server can be a resolver (what 
you ’ d normally call a client) or another DNS server. 
 Iterative Queries 
 Iterative queries are the easiest to understand: A client asks the DNS server for an answer, 
and the server returns the best answer. This information likely comes from the server ’ s 
cache. The server never sends out an additional query in response to an iterative query. If the 
server doesn ’ t know the answer, it may direct the client to another server through a referral.  
 Recursive Queries 
 In a recursive query, the client sends a query to a name server, asking it to respond either 
with the requested answer or with an error message. The error states one of two things: 
 
  The server can ’ t come up with the right answer.  
 
  The domain name doesn ’ t exist.  
 In a recursive query, the name server isn ’ t allowed to just refer the client to some other 
name server. 
 F I G U R E 2 . 4 DHCP settings for DNS  

Introducing DNS 
47
 Most resolvers use recursive queries. In addition, if your DNS server uses a forwarder, 
the requests sent by your server to the forwarder will be recursive queries. 
 Figure 2.5 shows an example of both recursive and iterative queries. In this example, 
a client within the Microsoft Corporation is querying its DNS server for the IP address for 
 www.whitehouse.gov . Here ’ s what happens to resolve the request:  
Iterative 
queries
Root 
name 
server
Local 
name 
server
Gov 
name 
server
Recursive
 query
DNS
client
Whitehouse.gov 
name server
1
8
2
3
4
5
6
7
 F I G U R E 2 . 5 A sample DNS query  
 1. 
 The resolver sends a recursive DNS query to its local DNS server asking for the IP 
address of  www.whitehouse.gov . 
 The local name server is responsible for resolving the name and cannot refer the 
resolver to another name server.  
 2. 
  The local name server checks its zones and finds no zones corresponding to the 
requested domain name.  
 3. 
  The root name server has authority for the root domain and will reply with the IP 
address of a name server for the  .gov top - level domain.  
 4. 
  The local name server sends an iterative query for  www.whitehouse.gov to the Gov 
name server.  
 5. 
  The Gov name server replies with the IP address of the name server servicing the 
 whitehouse.gov domain.  

48 
Chapter 2  Domain Name System (DNS)
 6. 
  The local name server sends an iterative query for  www.whitehouse.gov to the 
 whitehouse.gov name server.  
 7. 
  The  whitehouse.gov name server replies with the IP address corresponding to 
 www.whitehouse.gov . 
 8. 
  The local name server sends the IP address of  www.whitehouse.gov back to the origi-
nal resolver.  
 Inverse Queries 
 Inverse queries use pointer (PTR) records. Instead of supplying a name and then asking for 
an IP address, the client ﬁ rst provides the IP address and then asks for the name. Because 
there ’ s no direct correlation in the DNS namespace between a domain name and its 
associated IP address, this search would be fruitless without the use of the  in - addr.arpa  
domain. Nodes in the  in - addr.arpa domain are named after the numbers in the dotted - octet 
representation of IP addresses. But because IP addresses get more speciﬁ c from left to right 
and domain names get less speciﬁ c from left to right, the order of IP address octets must be 
reversed when building the  in - addr.arpa tree. With this arrangement, administration of the 
lower limbs of the DNS  in - addr.arpa tree can be given to companies as they are assigned 
their Class A, B, or C subnet address or delegated even further down thanks to Variable 
Length Subnet Masking (VLSM). 
 Once the domain tree is built into the DNS database, a special PTR record is added 
to associate the IP addresses to the corresponding hostnames. In other words, to ﬁ nd a 
hostname for the IP address  206.131.234.1 , the resolver would query the DNS server 
for a PTR record for  1.234.131.206.in - addr.arpa . If this IP address is outside the local 
domain, the DNS server will start at the root and sequentially resolve the domain nodes 
until arriving at  234.131.206.in - addr.arpa , which would contain the PTR record for 
the desired host.  
 Caching and Time to Live 
 When a name server is processing a recursive query, it may be required to send out several 
queries to ﬁ nd the deﬁ nitive answer. Name servers, acting as resolvers, are allowed to cache 
all the received information during this process; each record contains information called time 
to live (TTL). The TTL speciﬁ es how long the record will be held in the local cache until it 
must be resolved again. If a query comes in that can be satisﬁ ed by this cached data, the TTL 
that ’ s returned with it equals the current amount of time left before the data is ﬂ ushed. 
 There is also a negative cache TTL. The negative cache TTL is used when an authoritative 
server responds to a query indicating that the record queried doesn ’ t exist and indicates the 
amount of time that this negative answer may be held. Negative caching is quite helpful in 
preventing repeated queries for names that don ’ t exist. 
 The administrator for the DNS zone sets TTL values for the entire zone. The value 
can be the same across the zone or the administrator can set a separate TTL for each RR 
within the zone. Client resolvers also have data caches and honor the TTL value so that 
they know when to ﬂ ush.  

 Introducing DNS Database Zones 
 As we mentioned earlier in this chapter, a DNS zone is a portion of the DNS namespace 
over which a speciﬁ c DNS server has authority. Within a given DNS zone there are 
resource records (RRs) that deﬁ ne the hosts and other types of information that make up 
the database for the zone. 
 Choosing Appropriate TTL Values 
 For zones that you administer, you can choose the TTL values for the entire zone, for 
negative caching, and for individual records. Choosing an appropriate TTL depends on a 
number of factors, including the following: 
 
  Amount of change you anticipate for the records within the zone  
 
  Amount of time that you can withstand an outage that might require changing an 
IP address 
 
  Amount of trafﬁ c that you feel the DNS server can handle  
 Resolvers query the name server every time the TTL expires for a given record. A low 
TTL, say, 60 seconds, can burden the name server, especially for popular DNS records. 
(DNS queries aren ’ t particularly intensive for a server to handle, but they can add up 
quickly if you mistakenly use 60 seconds instead of 600 seconds for the TTL on a popular 
record.) Set a low TTL only when you need to quickly respond to a changing environment. 
 A high TTL, say, 604,800 seconds (that ’ s 1 week), means that if you need to make a 
change to the DNS record, clients might not see the change for up to a week. This 
consideration is especially important when making changes to the network, and it ’ s one 
that ’ s all too frequently overlooked. We can ’ t count the times we ’ ve worked with clients 
who have recently made a DNS change to a new IP for their email or website, only to ask 
why it ’ s not working for some clients. The answer can be found in the TTL value. If the 
record is being cached, then the only thing that can solve their problem is time. 
 You should choose a TTL that ’ s appropriate for your environment. Take the following 
factors into account: 
 
  The amount of time that you can afford to be ofﬂ ine if you need to make a change to 
a DNS record that ’ s being cached  
 
  The amount of load that a low TTL will cause on the DNS server 
 In addition, you should plan well ahead of any major infrastructure changes and change 
the TTL to a lower value in order to lessen the effect of the downtime by reducing the 
amount of time that the record(s) can be cached. 
Introducing DNS Database Zones 
49

50 
Chapter 2  Domain Name System (DNS)
 You can choose from several different zone types. Understanding the characteristics of 
each will help you choose which is right for your organization.  
 The DNS zones discussed in this book are all Microsoft Windows Server 
2008 zones. Non - Windows (e.g., Unix) systems set up their DNS zones 
differently.  
 In the following sections, we will discuss the different zone types and their characteristics. 
 Understanding Primary Zones 
 When you ’ re learning about zone types, things can get a bit confusing. But it ’ s really not 
difﬁ cult to understand how they work and why you would want to choose one type of zone 
over the other. 
 Zones are databases that store records. By choosing one zone type over another, you are 
basically just choosing how the database works and how it will be stored on the server. 
 The  primary zone is responsible for maintaining all of the records for the DNS zone. It 
contains the primary copy of the DNS database. All record updates occur on the primary zone. 
You will want to create and add primary zones whenever you create a new DNS domain. 
 There are two types of primary zone: 
 
  Primary zone  
 
  Primary zone with Active Directory Integration (Active Directory DNS)  
 From this point forward, we refer to a primary zone with Active Directory 
Integration as an Active Directory DNS. When we just use the term  primary 
zone , Active Directory is not included. 
 To install DNS as a primary zone, ﬁ rst you must install DNS using the Server 
Manager MMC. Once DNS is installed and running, you create a new zone and specify 
it as a primary zone.  
 The process of installing DNS and its zones will be discussed later in this 
chapter. In addition, we ’ ve included step - by - step exercises that walk you 
through how to install these components. 
 Primary zones have advantages and disadvantages. Knowing the characteristics of a primary 
zone will help you decide when you need the zone and when it ﬁ ts into your organization. 
 Local Database 
 Primary DNS zones get stored locally in a ﬁ le (with the sufﬁ x  .dns ) on the server. This 
allows you to store a primary zone on a domain controller or a member server. In addition, 
by loading DNS onto a member server, you can help a small organization conserve 

resources. Such an organization may not have the resources to load DNS on an Active 
Directory domain controller. 
 Unfortunately, the local database has many disadvantages:  
 Lack of Fault Tolerance   Think of a primary zone as a contact list on your cell phone 
or handheld. All of the contacts in the list are the records in your database. The problem 
is that if you lose your phone or the phone breaks, you lose your contact list. Until your 
phone gets ﬁ xed or you swap out your phone card, the contacts are unavailable. 
 It works the same way with a primary zone. If the server goes down or you lose the 
hard drive, DNS records on that machine are unreachable. An administrator can install 
a secondary zone (explained later in this section), and that provides temporary fault 
tolerance. Unfortunately, if the primary zone is down for an extended period of time, 
the secondary server ’ s information will no longer be valid.  
 Additional Network Traffic   Let ’ s imagine that you are looking for a contact number 
for John Smith. John Smith is not listed in your cell phone directory, but he is listed in 
your partner ’ s cell phone. You have to contact your partner to get the listing. You cannot 
directly access your partner ’ s cell contacts. 
 When a resolver sends a request to DNS to get the TCP/IP address for  Jsmith (in this case 
 Jsmith is a computer name), and the DNS server does not have an answer, it does not have the 
ability to check the other server ’ s database directly to get an answer. So it forwards the request 
to another DNS. This causes additional network traffic. When DNS servers are replicating 
zone databases with other DNS servers, this causes additional network traffic.  
 No Security   Staying with the cell phone example, let ’ s say you call your partner 
looking for John Smith ’ s phone number. When your partner gives you the phone number 
over your wireless phone, someone with a scanner can pick up your conversation. 
Unfortunately, wireless telephone calls are not very secure. 
 Now a resolver asks a primary zone for the  Jsmith TCP/IP address. If someone on the 
network has a  packet sniffer , they can steal the information in the DNS packets being sent 
over the network. The packets are not secure unless you implement some form of secondary 
security. Also, the DNS server has the ability to be dynamic. A primary zone accepts all 
updates from DNS servers. You cannot set it to accept secure updates only.  
 Understanding Secondary Zones 
 In Windows Server 2008 DNS, you have the ability to use  secondary DNS zones . 
Secondary zones are non - editable copies of the DNS database. You use them for  load 
balancing (also referred to as load sharing) — a way of managing network overloads on a 
single server. A secondary zone gets its database from a primary zone. 
 A secondary zone contains a database with all the same information as the primary zone 
and can be used to resolve DNS requests. Secondary zones have the following advantages: 
 
  A secondary zone provides fault tolerance, so if the primary zone server becomes 
unavailable, name resolution can still occur using the secondary zone server.  
Introducing DNS Database Zones 
51

52 
Chapter 2  Domain Name System (DNS)
 It is a good general practice to ensure that each zone has at least one 
secondary zone server to protect against failures.  
 
  Secondary DNS servers can also increase network performance by offloading some of 
the traffic that would otherwise go to the primary server. 
 Secondary servers are often placed within the parts of an organization that have high -
 speed network access. This prevents DNS queries from having to run across slow wide 
area network (WAN) connections. For example, if there are two remote ofﬁ ces within 
the  stellacon.com organization, you may want to place a secondary DNS server in 
each remote ofﬁ ce. This way, when clients require name resolution, they will contact the 
nearest server for this IP address information, thus preventing unnecessary WAN trafﬁ c.  
 Having too many secondary zone servers can actually cause an increase in 
network traffic because of replication (especially if DNS changes are fairly 
frequent). Therefore, you should always weigh the benefits and drawbacks 
and properly plan for secondary zone servers.  
 Understanding Active Directory Integrated DNS 
 Windows Server 2000 introduced Active Directory Integrated DNS to the world. This 
zone type was unique and was a separate choice during setup. In Windows Server 2003, 
this zone type became an add - on to a primary zone. In Windows Server 2008, it works the 
same way. After choosing to set up a primary zone, you check the box labeled Store The 
Zone In Active Directory (see Figure 2.6).  
  F I G U R E 2 .6 Setting up an Active Directory Integrated zone  

 Microsoft covers Active Directory Integrated DNS on most of the 
DNS - related exams. Knowing the characteristics of this zone type will 
help you answer many exam questions. Remember, this is an Active 
Directory Exam (70 - 640), so you can bet that the Active Directory portion 
of DNS will be covered in depth. 
 Disadvantages of Active Directory Integrated DNS 
 The main disadvantage of Active Directory Integrated DNS is that it has to reside on a 
domain controller because the DNS database is stored in Active Directory As a result, you 
cannot load this zone type on a member server, and small organizations might not have the 
resources to set up a dedicated domain controller.  
 Advantages of Active Directory Integrated DNS 
 The advantages of using an Active Directory Integrated DNS zone well outweigh the 
disadvantage just discussed. The following are some of the major advantages to an Active 
Directory Integrated zone:  
 Full Fault Tolerance   Think of an Active Directory Integrated zone as a database on your 
server that stores contact information for all your clients. If you need to retrieve John 
Smith ’ s phone number, as long as it was entered, you can look it up on the software. 
 If John Smith ’ s phone number was stored only on your computer and your computer 
stopped working, no one could access John Smith ’ s phone number. But since John Smith ’ s 
phone number is stored in a database that everyone has access to, if your computer stops 
working, other users can still retrieve John Smith ’ s phone number. 
 An Active Directory Integrated zone works the same way. Since the DNS database is stored 
in Active Directory, all Active Directory DNS servers can have access to the same data. If 
one server goes down or you lose a hard drive, all other Active Directory DNS servers can 
still retrieve DNS records.  
 No Additional Network Traffic   As previously discussed, an Active Directory Integrated 
zone is stored in Active Directory. Since all records are now stored in Active Directory, 
when a resolver needs a TCP/IP address for  Jsmith , any Active Directory DNS server can 
access  Jsmith ’ s address and respond to the resolver. 
 When you choose an Active Directory Integrated zone, DNS zone data can be replicated 
automatically to other DNS servers during the normal Active Directory replication process.   
 DNS Security   An Active Directory Integrated zone has a few security advantages over a 
primary zone: 
 
  An Active Directory Integrated zone can use secure dynamic updates.  
 
  As explained earlier, the Dynamic DNS standard allows secure - only updates or 
dynamic updates, not both.  
Introducing DNS Database Zones 
53

54 
Chapter 2  Domain Name System (DNS)
 
  If you choose secure updates, then only machines with accounts in Active Directory 
can register with DNS. Before DNS registers any account in its database, it checks 
Active Directory to make sure it is an authorized domain computer.  
 
  An Active Directory Integrated zone stores and replicates its database through Active 
Directory replication. Because of this, the data gets encrypted as it is sent from one 
DNS server to another.  
 Background Zone Loading   Background zone loading (discussed in more detail later in 
this chapter) allows an Active Directory Integrated DNS zone to load in the background. As 
a result, a DNS server can service client requests while the zone is still loading into memory.  
 Understanding Stub Zones 
 Stub zones work a lot like secondary zones — the database is a non - editable copy of a 
primary zone. The difference is that the stub zone ’ s database contains only the information 
necessary (three record types) to identify the authoritative DNS servers for a zone (see 
Figure 2.7). You should not use stub zones to replace secondary zones, nor should you use 
them for redundancy and load balancing.  
  F I G U R E 2 .7 DNS stub zone type  
 Stub zone databases contain only three record types: name server (NS), 
start of authority (SOA), and glue host (A) records. Knowing about these 
records will help you on the Microsoft Certification Exams. Microsoft asks 
many questions about stub zones on all DNS - related exams.  

 GlobalName Zones 
 Earlier in this chapter we talked about organizations using WINS to resolve NetBIOS 
names (also referred to as  computer names ) to TCP/IP addresses. Many organizations even 
today still use WINS along with DNS for name resolution. Unfortunately, WINS is slowly 
becoming obsolete. 
 To help organizations move forward with an all - DNS network, Microsoft Windows 
Server 2008 DNS supports  GlobalName zones . These use single - label names (DNS names 
that do not contain a sufﬁ x such as  .com ,  .net , and so on). GlobalName zones are not 
intended to support peer - to - peer networks and workstation name resolution, and they don ’ t 
support dynamic DNS updates. 
 GlobalName zones were designed to be used with servers. Since GlobalNames zones are 
not dynamic, an administrator has to manually enter the records into the zone database. In 
 When to Use Stub Zones 
 Stub zones become particularly useful in a couple of different scenarios. 
 Consider what happens when two large companies merge:  example.com and  example.net . 
In most cases, the DNS zone information from both companies must be available to every 
employee. You could set up a new zone on each side that acts as a secondary for the other 
side ’ s primary zone, but administrators tend to be very protective of their DNS databases 
and they probably wouldn ’ t agree to this plan. 
 A better solution is to add a stub zone to each side that points to the primary server 
on the other side. When a client in  example.com (which you help administer) makes a 
request for a name in  example.net , the stub zone on the  example.com DNS server would 
send the client to the primary DNS server for  example.net without actually resolving the 
name. At this point it would be up to  example.net ’ s primary server to resolve the name. 
 An added beneﬁ t is that even if the administrators over at  example.net change their 
conﬁ guration, you won ’ t have to do anything because the changes will automatically 
replicate to the stub zone, just as they would for a secondary server. 
 Stub zones can also be useful when you administer two domains across a slow 
connection. 
 Let ’ s change the previous example a bit and assume that you have full control over 
 example.com and  example.net , but they connect through a 56kbps line. In this case, you 
wouldn ’ t necessarily mind using secondary zones because you personally administer the 
entire network, but it could get messy to replicate an entire zone ﬁ le across that slow line. 
Instead, stub zones would refer clients to the appropriate primary server at the other site.  
Introducing DNS Database Zones 
55

56 
Chapter 2  Domain Name System (DNS)
most organizations, the servers have static TCP/IP addresses, and this works well with the 
GlobalName zone design. GlobalName zones are usually used to map single - label CNAME 
(alias) resource records to an FQDN.  
 Zone Transfers and Replication 
 DNS is such an important part of the network that you should not just use a single DNS 
server. With a single DNS server you also have a single point of failure, and, in fact, 
many domain registrars encourage the use of more than two name servers for a domain. 
Secondary servers or multiple primary Active Directory Integrated servers play an integral 
role in providing DNS information for an entire domain. 
 As previously stated, secondary DNS servers receive their zone databases through 
zone transfers. When you conﬁ gure a secondary server for the ﬁ rst time, you must specify 
the primary server that is authoritative for the zone and that will send the zone transfer. The 
primary server must also permit the secondary server to request the zone transfer. 
 Zone transfers occur in one of two ways: full zone transfers (AXFR) and incremental 
zone transfers (IXFR). 
 When a new secondary server is conﬁ gured for the ﬁ rst time, it receives a full zone 
transfer from the primary DNS server. The full zone transfer contains all of the information 
in the DNS database. Some DNS implementations always receive full zone transfers. 
 After the secondary server receives its ﬁ rst full zone transfer, subsequent zone transfers 
are incremental. The primary name server compares its zone version number with that on 
the secondary server and sends only the changes that have been made in the interim. This 
signiﬁ cantly reduces network trafﬁ c generated by zone transfers. 
 Zone transfers are typically initiated by the secondary server when the refresh interval 
time for the zone expires or when the secondary or stub server boots. Alternatively, you can 
conﬁ gure notify lists on the primary server that send a message to the secondary or stub 
servers whenever any changes to the zone database occur. 
 When you consider your DNS strategy, you must carefully consider the layout of your 
network. If you have a single domain with ofﬁ ces in separate cities, you want to reduce the 
number of zone transfers across the potentially slow or expensive WAN links, although this 
is becoming less of a concern because bandwidth seems to multiply daily. 
 Active Directory Integrated zones do away with traditional zone transfers altogether. 
Instead, they replicate across Active Directory with all of the other AD information. This 
replication is secure and encrypted since it uses the Active Directory Security. 
 How DNS Notify Works 
 Windows Server 2008 supports  DNS Notify . DNS Notify is a mechanism that allows the 
process of initiating notiﬁ cations to secondary servers when zone changes occur (RFC 
1996). DNS Notify uses a push mechanism for communicating to a select set of secondary 
zone servers when their zone information is updated. (DNS Notify does not allow you to 
conﬁ gure a notify list for a stub zone.) 
 After being notiﬁ ed of the changes, secondary servers can then start a pull zone transfer 
and update their local copies of the database.  

 Many different mechanisms use the push/pull relationship. Normally 
one object pushes information to another, and that other object pulls 
the information from the first. Most applications push replication on a 
change value and pull it on a time value. For example, a system can push 
replication after 10 updates or it can be pulled every 30 minutes.  
 To conﬁ gure the DNS Notify process, you create a list of secondary servers to notify. 
List the IP address of the server in the primary master ’ s Notify dialog box (See Figure 2.8). 
The Notify dialog box is located under the Zone Transfers tab, which is located in the 
Zone Properties dialog box (See Figure 2.9).  
 F I G U R E  2 . 8 DNS Notify dialog box  
 F I G U R E  2 . 9 DNS Zone Transfers tab  
Introducing DNS Database Zones 
57

58 
Chapter 2  Domain Name System (DNS)
 Configuring Stub Zone Transfers with Zone Replication Scope 
 In the preceding section, we talked about how to conﬁ gure secondary server zone transfers. 
What if you wanted to conﬁ gure settings for stub zone transfers? This is where zone 
replication scope comes in. 
 Only Active Directory – integrated primary and stub zones can conﬁ gure their replication 
scope. Secondary servers do not have this ability. 
 You can conﬁ gure zone replication scope conﬁ gurations in two ways. An administrator 
can set conﬁ guration options through the DNS snap - in or through a command - line tool 
called  Dnscmd . 
 To conﬁ gure zone replication scope through the DNS snap - in, follow these steps: 
 1. 
 Click Start   Administrative Tools   DNS.  
 2. 
  Right - click the zone that you want to set up.  
 3. 
  Choose Properties.  
 4. 
  In the Properties dialog box (see Figure 2.10), click the Change button next to 
Replication.  
 F I G U R E 2 .10 DNS zone replication scope  
 5. 
  Choose the replication scope that fits your organization.  

 New Functionality in Windows Server 
2008 DNS 
 Microsoft Windows Server 2008 and Windows Server 2008 R2 have improved their 
version of DNS in many different ways. This section covers this new functionality. Here 
are some of the new DNS features from Windows Server 2008: 
 
  Background zone loading  
 
  Support for TCP/IP version 6 (IPv6)  
 
  Read - only domain controllers  
 
  GlobalName zone  
 Background Zone Loading 
 If an organization had to restart a DNS server with an extremely large Active Directory 
Integrated DNS zones database in the past, DNS had a common problem with an Active 
Directory Integrated DNS zone. After the DNS restart, it could take hours for DNS data to 
be retrieved from Active Directory. During this time, the DNS server was unable to service 
any client requests. 
 Microsoft Windows Server 2008 DNS has addressed this problem by implementing 
background zone loading. As the DNS restarts, the Active Directory zone data populates 
the database in the background. This allows the DNS server to service client requests for 
data from other zones almost immediately after a restart. 
 Background zone loading accomplishes this task by loading the DNS zone using separate 
threads. This allows a DNS server to service requests while still loading the rest of the zone. 
If a client sends a request to the DNS server for a computer that has not loaded into memory 
yet, the DNS server retrieves the data from Active Directory and updates the record.  
 Support for IPv6 Addresses 
 Over the past few years, the Internet has starting running into a problem that was not 
foreseen when it was ﬁ rst created — it started running out of TCP/IP addresses. As you 
probably already know, when the Internet was created, it was used for government 
and academic purposes only. Then, seemingly overnight, it grew to be the information 
superhighway. Now, asking someone for their email address is almost as common as 
asking for their phone number. 
 In the past, the common version of TCP/IP was version 4 (IPv4). The release of TCP/IP 
version 6 (IPv6) has solved the lack - of - IP - addresses problem. IPv4 addresses are 32 bits 
long, but IPv6 addresses are 128 bits. The longer lengths allow for a much greater number 
of globally unique TCP/IP addresses. 
New Functionality in Windows Server 2008 DNS 
59

60 
Chapter 2  Domain Name System (DNS)
 Microsoft Windows Server 2008 DNS has built - in support to accommodate both IPv4 
and IPv6 address records (DNS records are explained later in this chapter). DHCP can 
also issue IPv6 addresses, which lets administrators allow DHCP to register the client with 
DNS, or the IPv6 client can register their address with the DNS server.  
 Support for Read - Only Domain Controllers 
 As mentioned in Chapter 1,  “ Overview of Active Directory, ”  Windows Server 2008 
has introduced a new type of domain controller called the read - only domain controller 
(RODC). This is a full copy of the Active Directory database without the ability to 
conﬁ gure Active Directory. The RODC gives an organization the ability to install a 
domain controller in a location (onsite or offsite) where security is a concern. 
 Microsoft Windows Server 2008 DNS has implemented a new type of zone to help 
support an RODC. A primary read - only zone allows a DNS server to receive a copy of the 
application partition (including ForestDNSZones and DomainDNSZones) that DNS uses. 
This allows DNS to support an RODC because DNS now has a full copy of all DNS zones 
stored in Active Directory. 
 A primary read - only zone is just what it says — a read - only zone; so to make any 
changes to it, you have to change the primary zones located on the Active Directory 
Integrated DNS server.  
 GlobalName Zones 
 Earlier in this chapter we talked about organizations using the Windows Internet Name 
Service (WINS) to resolve NetBIOS names (also referred to as computer names) to 
TCP/IP addresses. Many organizations, even today, still use WINS along with DNS for 
name resolution. Unfortunately, WINS is slowly becoming obsolete. 
 To help organizations move forward with an all - DNS network, Microsoft Windows 
Server 2008 DNS supports GlobalName zones. These use single - label names (DNS 
names that do not contain a sufﬁ x such as  .com ,  .net , etc.) the same way WINS does. 
Unlike WINS, GlobalName zones are not intended to support peer - to - peer networks and 
workstation name resolution, nor do they support dynamic DNS updates. 
 GlobalName zones were designed to be used with servers. Since GlobalName zones are 
not dynamic, an administrator has to manually enter the records into the zone database. 
In most organizations, the servers have static TCP/IP addresses, and this works well with 
the GlobalName zone design. GlobalName zones are normally used to map single - label 
CNAME (Alias) resource records to an FQDN. 
 Now that you have seen some of the changes in Windows Server 2008, here are some of 
the new DNS features from Windows Server 2008 R2: 
 
  DNS Socket Pool  
 
  DNS Cache Locking  
 
  DNS Security Extensions (DNSSEC)  

 DNS Socket Pool 
 If your server is running Windows Server 2008 R2, or you have installed security update 
MS08 - 037, you will be able to take advantage of DNS Socket Pools. DNS Socket Pools 
allows source port randomization to protect against DNS cache poisoning attacks. 
 If you choose to use source port randomization, when the DNS service starts, the DNS 
server will randomly pick a source port from a pool of available sockets. 
 This is an advantage because instead of DNS using a well - known source port 
when issuing queries, the DNS server uses a random port selected from the socket 
pool. This helps guard against attacks because a hacker must correctly access the 
source port of the DNS query. The socket pool is automatically enabled in DNS with 
the default settings. 
 When using the DNS Socket Pool, the default size of the socket pool is 2500. When 
conﬁ guring the socket pool, you have the ability to choose a size value from 0 to 10000. 
The larger the value, the greater protection you will have against DNS spooﬁ ng attacks. 
If you decide to conﬁ gure your socket pool size with a zero value, only a single socket for 
remote DNS queries will be used.  
 DNS Cache Locking 
 Windows Server 2008 R2 DNS Cache Locking allows cached DNS records to remain safe 
for the duration of the record ’ s time to live (TTL) value. This means that the cached DNS 
records cannot be overwritten or changed. Because of this new DNS feature, it ’ s tougher 
for hackers to perform cache - poisoning attacks against your DNS server. 
 DNS administrators can set how long a record will remain safe in cache. The 
conﬁ guration is based on a percent value. For example, if you set your cache locking value 
to 50 percent, then the cached records cannot be overwritten until half of the TTL has 
been reached. The default DNS cache locking is set to 100 percent. This means the cached 
records never get overwritten.  
 DNS Security Extensions (DNSSEC) 
 Windows Server 2008 R2 has introduced a new feature called DNS Security Extensions 
(DNSSEC). DNSSEC allows your Windows Server 2008 DNS server to sign and host 
DNSSEC - signed zones. DNSSEC cryptographically signs the DNS zone and all of the zone 
records, thus providing a greater level of security. 
 Windows Server 2008 R2 DNS server has the following changes: 
 
  Ability to sign a zone and host signed zones  
 
  Support for changes to the DNSSEC protocol  
 
  Support for DNSKEY, RRSIG, NSEC, and DS resource records  
New Functionality in Windows Server 2008 DNS 
61

62 
Chapter 2  Domain Name System (DNS)
 Windows 7 DNS clients are also built to use these new DNS features. The following 
changes are available for Windows 7 DNS clients: 
 
  Ability to indicate knowledge of DNSSEC in queries  
 
  Ability to process the DNSKEY, RRSIG, NSEC, and DS resource records  
 
  Ability to check whether the DNS server with which it communicated has performed 
validation on the client ’ s behalf  
 DNS Security Extensions (DNSSEC) will be discussed in greater detail in 
the Infrastructure 70 - 642 part of this book. 
 Now that we have looked at some of the new features of Windows Server 2008 DNS, 
let ’ s take a look at some of the DNS record types.  
 Introducing DNS Record Types 
 No matter where your zone information is stored, you can rest assured that it contains a 
variety of DNS information. Although the DNS snap - in makes it unlikely that you ’ ll ever 
need to edit these ﬁ les by hand, it ’ s good to know exactly what data is contained there. 
 As stated previously, zone ﬁ les consist of a number of  resource records (RRs). You need 
to know about several types of resource records to effectively manage your DNS servers. 
They are discussed in the following sections. 
 Part of the resource record is its class. Classes deﬁ ne the type of network for the resource 
record. There are three classes: Internet, Chaosnet, and Hesoid. By far, the Internet class is 
the most popular. In fact, it ’ s doubtful that you ’ ll see either Chaosnet or Hesoid classes 
in the wild.  
 The following are some of the more important resource records in a DNS 
database. For a complete listing of records in a Microsoft DNS database, 
visit Microsoft ’ s website.  
 Start of Authority (SOA) Records 
 The ﬁ rst record in a database ﬁ le is the start of authority (SOA) record. The SOA deﬁ nes 
the general parameters for the DNS zone, including the identity of the authoritative server 
for the zone. 
 The SOA is in the following format: 
@ IN SOA  primary_mastercontact_e-mailserial_number 
 refresh_timeretry_timeexpiration_timetime_to_live 

 Here is a sample SOA from the domain  example.com : 
@ IN SOA win2k3r2.example.com. hostmaster.example.com. (
                        5            ; serial number
                        900          ; refresh
                        600          ; retry
                        86400        ; expire
                        3600       ) ; default TTL 
 Table 2.2 lists the attributes stored in the SOA record.  
 TA B L E 2 . 2 The SOA record structure 
 Field  
  Meaning  
 Current zone  
  The current zone for the SOA. This can be represented by an  @ symbol 
to indicate the current zone or by naming the zone itself. In the example, 
the current zone is  example.com . The trailing dot ( .com. ) indicates the 
zone ’ s place relative to the root of the DNS. 
 Class  
  This will almost always be the letters  IN for the Internet class. 
 Type of record  
  The type of record follows — in this case it ’ s SOA.  
 Primary master  
  The primary master for the zone on which this file is maintained.  
 Contact email 
  The Internet email address for the person responsible for this domain ’ s 
database file. There is no  @ symbol in this contact email address since 
 @ is a special character in zone files. The contact email address is 
separated by a single dot (.). So the email address of  root@example.com 
would be represented by  root.example.com in a zone file.  
 Serial number  
  The  “ version number ” of this database file. This increases each time the 
database file is changed. 
 Refresh time 
  The amount of time (in seconds) that a secondary server will wait 
between checks to its master server to see if the database file has 
changed and a zone transfer should be requested.  
 Retry time  
  The amount of time (in seconds) that a secondary server will wait before 
retrying a failed zone transfer.  
 Expiration time  
  The amount of time (in seconds) that a secondary server will spend 
trying to download a zone. Once this time limit expires, the old zone 
information will be discarded. 
 Time to live  
  The amount of time (in seconds) that another DNS server is allowed 
to cache any resource records from this database file. This is the value 
that is sent out with all query responses from this zone file when the 
individual resource record doesn ’ t contain an overriding value.  
Introducing DNS Record Types 
63

64 
Chapter 2  Domain Name System (DNS)
 Name Server (NS) Records 
  Name server (NS) records  list the name servers for a domain. This record allows other 
name servers to look up names in your domain. A zone ﬁ le may contain more than one 
name server record. The format of these records is simple: 
example.com.    IN      NS      Hostname.example.com 
 Table 2.3 explains the attributes stored in the NS record.  
 TA B L E 2 . 3 The NS record structure 
  Field  
  Meaning  
  Name  
  The domain that will be serviced by this name server. In this case 
we used example.com.  
  AddressClass  
  Internet (IN)  
  RecordType  
  Name server (NS)  
  Name Server Name  
  The FDQN name of the server responsible for the domain 
 Any domain name in the database file that is  not terminated with a period 
will have the root domain appended to the end. For example, an entry that 
just has the name  sales will be expanded by adding the root domain to 
the end, whereas the entry  sales.example.com. won ’ t be expanded.  
 Host Record 
 A  host record (also called an A record for IPv4 and AAAA record for IPv6) is used to 
statically associate a host ’ s name to its IP addresses. The format is pretty simple: 
 host_nameoptional_TTL IN  A   IP_Address 
 Here ’ s an example from our DNS database: 
www  IN  A  192.168.0.204
SMTP IN  A  192.168.3.144 
 The A or AAAA record ties a hostname (which is part of an FQDN) to a speciﬁ c IP 
address. This makes these records suitable for use when you have devices with statically 

assigned IP addresses; in this case, you create these records manually using the DNS 
snap - in. As it turns out, if you enable DDNS, your DHCP server can create these for you; 
that automatic creation is what enables DDNS to work. 
 Notice that an optional TTL ﬁ eld is available for each resource record in the DNS. 
This value is used to set a TTL that is different from the default TTL for the domain. For 
example, if you wanted a 60 - second TTL for the  www A or AAAA record, it would look 
like this: 
www 60 IN  A  192.168.0.204 
 Alias Record 
 Closely related to the host record is the alias or canonical name (CNAME) record. The 
syntax of an alias record looks like the following: 
 aliasoptional_TTL  IN  CNAME   hostname 
 Aliases are used to point more than one DNS record toward a host for which an A 
record already exists. For example, if the hostname of your web server was actually  chaos , 
you would likely have an A record like this: 
chaos IN A 192.168.1.10 
Then you could make an alias or CNAME for the record so that  www.example.com 
would point to chaos: 
www IN CNAME chaos.example.com. 
Note the trailing dot ( . ) on the end of the CNAME record. This means the root domain 
is not appended to the entry.  
 Pointer (PTR) Record 
 A or AAAA records are probably the most visible component of the DNS database because 
Internet users depend on them to turn FQDNs like  www.microsoft.com into the IP addresses 
that browsers and other components require to ﬁ nd Internet resources. However, the host 
record has a lesser - known but still important twin: the  pointer (PTR) record.  The format 
of a PTR record looks like the following: 
 reversed_address.in-addr.arpa. optional_TTL IN PTR  targeted_domain_name 
 The A or AAAA record maps a hostname to an IP address, and the PTR record 
does just the opposite — mapping an IP address to a hostname — through the use of the 
 in - addr.arpa zone. 
 The PTR record is necessary because IP addresses begin with the least - speciﬁ c portion 
ﬁ rst (the network) and end with the most - speciﬁ c portion (the host), whereas hostnames 
begin with the most - speciﬁ c portion at the beginning and the least - speciﬁ c at the end. 
Introducing DNS Record Types 
65

66 
Chapter 2  Domain Name System (DNS)
 Consider the example  192.168.1.10 with a subnet mask  255.255.255.0 . The portion 
 192.168.1 deﬁ nes the network and the ﬁ nal  .10 deﬁ nes the host, or the most speciﬁ c 
portion of the address. DNS is just the opposite: The hostname  www.example.com. deﬁ nes 
the most - speciﬁ c portion,  www , at the beginning and then traverses the DNS tree to the 
least - speciﬁ c part, the dot ( . ), at the root of the tree. 
 Reverse DNS records, therefore, need to be represented in this most - speciﬁ c - to - least -
 speciﬁ c manner. The PTR record for mapping 192.168.1.10 to  www.example.com would 
look like this: 
10.1.168.192.in-addr.arpa. IN PTR www.example.com. 
 Now a DNS query for that record can follow the logical DNS hierarchy from the root of 
the DNS tree all the way to the most - speciﬁ c portion.  
 Mail Exchanger (MX) Record 
 The mail exchanger (MX) record is used to specify which servers accept mail for this 
domain. Each MX record contains two parameters — a preference and a mail server — as 
shown in the following example: 
 domain IN MX  preference mailserver_host 
 The MX record uses the preference value to specify which server should be used if more 
than one MX record is present. The preference value is a number. The lower the number, 
the more preferred the server. Here ’ s an example: 
example.com.    IN  MX  0  mail.example.com.
example.com.    IN  MX  10 backupmail.example.com. 
 In the example,  mail.example.com is the default mail server for the domain. If that server 
goes down for any reason, the  backupmail.example.com mail server is used by mailers.  
 Service (SRV) Record 
 Windows Server 2008 R2 depends on some other services, like the Lightweight Directory 
Access Protocol (LDAP) and Kerberos. Using a service record, which is another type of 
DNS record, a Windows 2000, XP, Vista, or Windows 7 client can query DNS servers 
for the location of a domain controller. This makes it much easier (for both the client and 
the administrator) to manage and distribute logon trafﬁ c in large - scale networks. For this 
approach to work, Microsoft has to have some way to register the presence of a service in 
DNS. Enter the  service (SRV) record . 
 SRV records tie together the location of a service (like a domain controller) with 
information about how to contact the service. SRV records provide seven items of 
information. Let ’ s look at an example to help clarify this powerful concept (Table 2.4 
explains the ﬁ elds in the following example): 

ldap.tcp.example.com.  86400 IN SRV  10  100  389  hsv.example.com
ldap.tcp.example.com.  86400 IN SRV  20  100  389  msy.example.com  
 TA B L E 2 . 4 The SRV record structure 
 Field  
  Meaning  
 Domain name  
  Domain for which this record is valid ( ldap.tcp.example.com. ).  
 TTL  
 Time to live (86,400 seconds).  
 Class  
  This field is always  IN , which stands for Internet . 
 Record type 
  Type of record ( SRV ).  
 Priority  
  Specifies a preference, similar to the Preference field in an MX record. The 
SRV record with the lowest priority is used first ( 10 ).  
 Weight  
  Service records with equal priority are chosen according to their weight ( 100 ).  
 Port number  
  The port where the server is listening for this service ( 389 ).  
 Target  
  The FQDN of the host computer ( hsv.example.com and  msy.example.com ).  
 You can define other types of service records. If your applications support 
them, they can query DNS to find the services they need. 
 Configuring DNS 
 In the following section, we are going to start the explanation of the actual DNS server. 
We will start with an exercise to install DNS. Then we will talk about different zone 
conﬁ guration options and what they mean. We will follow this by completing an exercise 
that covers conﬁ guring Dynamic DNS, delegating zones, and manually entering records. 
 Installing DNS 
 Let ’ s start by installing DNS. Installing DNS is an important part of running a network. 
Exercise 2.1 walks you through the installation of a DNS server.  
Configuring DNS 
67

68 
Chapter 2  Domain Name System (DNS)
 E X E R C I S E  2 .1
Installing and Configuring the DNS Service 
 1. 
  Open the Conﬁ gure Your Server wizard by selecting Start   Administrative Tools   
Server Manager.  
 2. 
  Under Roles Summary, click the link to the right labeled Add Role.  
 3. 
  If a Before You Begin screen appears, click Next. 
 4. 
  Click the DNS Server Item in the Server Role list and click Next to continue. If your 
computer is conﬁ gured with a dynamic IP address, you will be prompted to use a static 
address. Click Install DNS Server anyway. 
 5. 
  Click Next on the Introduction To DNS screen. 
 6. 
  On the Conﬁ rm Installation screen, click the Install button. You may need to insert the 
Windows Server 2008 R2 CD into the CD - ROM drive. 
 7. 
  At the Installation Results screen, click Close. 
 8. 
  Close Server Manager.  
 Load Balancing with Round Robin 
 Like other DNS implementations, the Windows Server 2008 R2 implementation of DNS 
supports load balancing through the use of round robin. Load balancing distributes the 
network load among multiple network hosts if they are available. You set up round robin 
load balancing by creating multiple resource records with the same hostname but different 
IP addresses for multiple computers. Depending on the options that you select, the DNS 
server responds with the addresses of one of the host computers. 
 If round robin is enabled, when a client requests name resolution, the ﬁ rst address 
entered in the database is returned to the resolver and is then sent to the end of the list. 
The next time a client attempts to resolve the name, the DNS server returns the second 
name in the database (which is now the ﬁ rst name) and then sends it to the end of the list, 
and so on. Round robin is enabled by default.  
 Configuring a Caching - Only Server 
 Although all DNS name servers cache queries that they have resolved, caching - only servers 
are DNS name servers that only perform queries, cache the answers, and return the results. 
They are not authoritative for any domains, and the information that they contain is 
limited to what has been cached while resolving queries. Accordingly, they don ’ t have any 
zone ﬁ les, and they don ’ t participate in zone transfers. When a caching - only server is ﬁ rst 
started, it has no information in its cache; the cache is gradually built over time. 

 Caching - only servers are very easy to conﬁ gure. After installing the DNS service, simply 
make sure that the root hints are conﬁ gured properly: 
 1. 
 Right - click your DNS server and choose the Properties command.  
 2. 
  When the Properties dialog box appears, switch to the Root Hints tab (see Figure 2.11).  
 F I G U R E 2 .11 The Root Hints tab of the DNS server ’ s Properties dialog box  
 3. 
  If your server is connected to the Internet, you should see a list of root hints for the 
root servers maintained by ICANN and the Internet Assigned Numbers Authority 
(IANA). If not, click the Add button to add root hints as defined in the  cache.dns file. 
 You can obtain current  cache.dns ﬁ les on the Internet by using a search engine. Just 
search for  “ cache.dns ” and download one. (I always try to get  cache.dns ﬁ les from a 
university or a company that manages domain names.)  
 Setting Zone Properties 
 There are six tabs on the Properties dialog box for a forward or reverse lookup zone (see 
Figure 2.10 earlier in this chapter). You use the Security tab only to control who can change 
Configuring DNS 
69

70 
Chapter 2  Domain Name System (DNS)
properties and make dynamic updates to records on that zone. The other tabs are discussed 
in the following sections.  
 Secondary zones don ’ t have a Security tab and their SOA tab shows you 
the contents of the master SOA record, which you can ’ t change. 
 General Tab 
 The General tab (see Figure 2.10) includes the following: 
 
  The Status indicator and the associated Pause button let you see and control whether 
this zone can be used to answer queries. When the zone is running, the server can use 
it to answer client queries; when it ’ s paused, the server won ’ t answer any queries it gets 
for that particular zone.  
 
  The Type indicator and its Change button allow you to select the zone type. The 
options are Standard Primary, Standard Secondary, and AD - Integrated. (See 
 “ Introducing DNS Database Zones, ” earlier in this chapter.) As you change the type, 
the controls you see below the horizontal dividing line change too. For primary zones, 
you ’ ll see a field that lets you select the zone filename; for secondary zones, you ’ ll get 
controls that allow you to specify the IP addresses of the primary servers. But the most 
interesting controls are the ones you see for AD - Integrated zones When you change to 
the AD Integrated zones, you have the ability to make the dynamic zones Secure Only.  
 
  The Replication indicator and its Change button allow you to change the replication 
scope if the zone is stored in Active Directory. You can choose to replicate the zone 
data to any of the following:  
 
  All DNS servers in the Active Directory forest  
 
  All DNS servers in a specified domain  
 
  All domain controllers in the Active Directory domain (required if you use 
Windows 2000 domain controllers in your domain)  
 
  All domain controllers specified in the replication scope of the application 
directory partition  
 
  The Dynamic Updates field gives you a way to specify whether you want to support 
Dynamic DNS updates from compatible DHCP servers. As you learned earlier in the 
section  “ Dynamic DNS and Non - Dynamic DNS, ” the DHCP server or DHCP client 
must know about and support Dynamic DNS in order to use it, but the DNS server has 
to participate too. You can turn dynamic updates on or off, or you can require that 
updates be secured.  
 Start Of Authority (SOA) Tab 
 The following options in the Start Of Authority (SOA) tab, shown in Figure 2.12, 
control the contents of the SOA record for this zone:  

 
  The Serial Number field indicates which version of the SOA record the server currently 
holds; every time you change another field, you should increment the serial number so 
that other servers will notice the change and get a copy of the updated record.  
 
  The Primary Server and Responsible Person fields indicate the location of the primary 
name server (NS) for this zone and the email address of the administrator responsible 
for the maintenance of this zone, respectively. The standard username for this is 
 hostmaster . 
 
  The Refresh Interval field controls how often any secondary zones of this zone must 
contact the primary zone server and get any changes that have been posted since the 
last update. 
 
  The Retry Interval field controls how long secondary servers will wait after a zone 
transfer fails before they try again. They ’ ll keep trying at the interval you specify 
(which should be shorter than the refresh interval) until they eventually succeed in 
transferring zone data.  
 
  The Expires After field tells the secondary servers when to throw away zone data. The 
default of 1 day (24 hours) means that a secondary server that hasn ’ t gotten an update 
in 24 hours will delete its local copy of the zone data.  
 
  The Minimum (Default) TTL field sets the default TTL for all RRs created in the zone; 
you can assign specific TTLs to individual records if you want.  
 
  The TTL For This Record field controls the TTL for the SOA record itself.  
 F I G U R E 2 .12 The Start Of Authority (SOA) tab of the zone Properties dialog box  
Configuring DNS 
71

72 
Chapter 2  Domain Name System (DNS)
 Name Servers Tab 
 The name server (NS) record for a zone indicates which name servers are authoritative for 
the zone. That normally means the zone primary server and any secondary servers you ’ ve 
conﬁ gured for the zone (remember, secondary servers are authoritative read - only copies of 
the zone). You edit the NS record for a zone using the Name Servers tab (Figure 2.13). The 
tab shows you which servers are currently listed, and you use the Add, Edit, and Remove 
buttons to specify which name servers you want included in the zone ’ s NS record.  
  F I G U R E 2 .13  The Name Servers tab of the zone Properties dialog box  
 WINS Tab 
 The WINS tab allows you to control whether this zone uses WINS forward lookups or not. 
These lookups pass on queries that DNS can ’ t resolve to WINS for action. This is a useful 
setup if you ’ re still using WINS on your network. You must explicitly turn this option on 
with the Use WINS Forward Lookup check box in the WINS tab for a particular zone.  
 Zone Transfers Tab 
 Zone transfers are necessary and useful because they ’ re the mechanism used to propagate 
zone data between primary and secondary servers. For primary servers (whether AD 
Integrated or not), you can specify whether your servers will allow zone transfers (see 
Figure 2.9, earlier in this chapter) and, if so, to whom. 

 You can use the following controls on the Zone Transfers tab to conﬁ gure these settings 
per zone: 
 
  The Allow Zone Transfers check box controls whether the server answers zone transfer 
requests for this zone at all — when it ’ s not checked, no zone data is transferred. The 
Allow Zone Transfers selections are as follows:  
 
  To Any Server allows any server anywhere on the Internet to request a copy of 
your zone data.  
 
  Only To Servers Listed On The Name Servers Tab (the default) limits transfers to 
servers you specify. This is a more secure setting than To Any Server because it 
limits transfers to other servers for the same zone.  
 
  Only To The Following Servers allows you to specify exactly which servers are 
allowed to request zone transfers. This list can be larger or smaller than the list 
specified on the Name Servers tab.  
 
  The Notify button is for setting up automatic notification triggers that are sent to 
secondary servers for this zone. Those triggers signal the secondary servers that 
changes have occurred on the primary server so that the secondary servers can request 
updates sooner than their normally scheduled interval. The options in the Notify 
dialog box are similar to those in the Zone Transfers tab. You can enable automatic 
notification and then choose either Servers Listed On The Name Servers Tab or The 
Following Servers.  
 Configuring Zones for Dynamic Updates 
 In Exercise 2.2, you will create and then modify the properties of a forward lookup zone. 
In addition, you ’ ll conﬁ gure the zone to allow dynamic updates.  
 E X E R C I S E  2 . 2
Configuring a Zone for Dynamic Updates 
 1. 
  Open the DNS management snap - in by selecting Start   Administrative Tools   DNS.  
 2. 
  Click the DNS server to expand it, and then click the Forward Lookup Zones folder. 
Right - click the Forward Lookup Zones folder and choose New Zone. 
 3. 
  At the New Zone Welcome screen, click Next. 
 4. 
  At the Zone Type screen, choose the Primary Zone option. If your DNS server is also a 
domain controller, do not check the box to store the zone in Active Directory. Click Next 
when you are ready.  
 5. 
  Enter a new zone name in the Zone Name ﬁ eld and click Next (I used my last name —
 Panek.com).  
 6. 
  Leave the default zone ﬁ lename and click Next. 
Configuring DNS 
73

74 
Chapter 2  Domain Name System (DNS)
E X E R C I S E  2 . 2  (c o n t i n u e d)
 7. 
  Select the Do Not Allow Dynamic Updates radio button and click Next.  
 8. 
  Click Finish to end the wizard. 
 9. 
  Right - click the zone you just created and choose the Properties command.  
 10.   Click the down arrow next to Dynamic Updates. Notice that there are only two options 
(None and Nonsecure And Secure). The Secure Only option is not available because we 
are not using Active Directory Integrated. Make sure Nonsecure And Secure is chosen.  
 11.   Click OK to close the Properties box. 
 12.   Close the DNS management snap - in.  
 Delegating Zones for DNS 
 DNS provides the ability to divide the namespace into one or more zones, which can then 
be stored, distributed, and replicated to other DNS servers. When deciding whether to 
divide your DNS namespace to make additional zones, consider the following reasons 
to use additional zones: 
 
  A need to delegate management of part of your DNS namespace to another location or 
department within your organization  
 
  A need to divide one large zone into smaller zones for distributing traffic loads among 
multiple servers, for improving DNS name - resolution performance, or for creating a 
more fault - tolerant DNS environment  
 
  A need to extend the namespace by adding numerous subdomains at once, such as to 
accommodate the opening of a new branch or site  
 Each new delegated zone requires a primary DNS server just like a regular DNS zone. 
When delegating zones within your namespace, be aware that for each new zone you 
create, you need to place delegation records in other zones that point to the authoritative 
DNS servers for the new zone. This is necessary both to transfer authority and to 
provide correct referral to other DNS servers and clients of the new servers being made 
authoritative for the new zone. 
 In Exercise 2.3, you ’ ll create a delegated subdomain of the domain you created back 
in Exercise 2.2. Note that the name of the server to which you want to delegate the 
subdomain must be stored in an A or CNAME record in the parent domain.  
 E X E R C I S E  2 . 3
Creating a Delegated DNS Zone 
 1. 
  Open the DNS management snap - in by selecting Start   Administrative Tools   DNS.  
 2. 
  Expand the DNS server and locate the zone you created in Exercise 2.2.  

 3. 
  Right - click the zone and choose the New Delegation command.  
 4. 
  The New Delegation Wizard appears. Click Next to dismiss the initial wizard page.  
 5. 
  Enter  ns1 (or whatever other name you like) in the Delegated Domain ﬁ eld of the 
Delegated Domain Name page. This is the name of the domain for which you want to 
delegate authority to another DNS server. It should be a subdomain of the primary 
domain (for example, to delegate authority for  farmington.example.net , you ’ d enter 
 farmington in the Delegated Domain ﬁ eld). Click Next to complete this step.  
 6. 
  When the Name Servers page appears, click the Add button to add the name(s) and 
IP address(es) of the servers that will be hosting the newly delegated zone. For the 
purpose of this exercise, enter the zone name you used in Exercise 2.2. Click the Resolve 
button to automatically resolve this domain name ’ s IP address into the IP address ﬁ eld. 
Click OK when you are ﬁ nished. Click Next to continue with the wizard.  
 7. 
  Click the Finish button. The New Delegation Wizard disappears, and you ’ ll notice the new 
zone you just created appear beneath the zone you selected in step 3. The newly delegated 
zone ’ s folder icon is drawn in gray to indicate that control of the zone is delegated.  
 DNS Forwarding 
 If a DNS server does not have an answer to a DNS request, it may be necessary to send that 
request to another DNS server. This is  DNS forwarding . You need to understand the two 
main types of forwarding:  
 External Forwarding   When a DNS server forwards an external DNS request to a DNS 
server outside your organization, this is considered external forwarding. For example, a 
resolver requests the host  www.microsoft.com . Most likely, your internal DNS server is not 
going to have Microsoft ’ s web address in its DNS database. So, your DNS server is going to 
send the request to an external DNS (most likely your ISP).  
Configuring DNS 
75

76 
Chapter 2  Domain Name System (DNS)
  Conditional Forwarding   Conditional forwarding is a lot like external forwarding except 
that you are going to forward requests to speciﬁ c DNS servers based on a condition. Usually 
this is an excellent setup for internal DNS resolution. For example, let ’ s say you have two 
companies,  stellacon.com and  stellatest.com . If a request comes in for  Stellacon.com , 
it gets forwarded to the Stellacon DNS server, and any requests for  Stellatest.com will 
get forwarded to the Stellatest DNS server. Requests are forwarded to a speciﬁ c DNS server 
depending on the condition that an administrator sets up.  
 Manually Creating DNS Records 
 From time to time you may ﬁ nd it necessary to manually add resource records to your 
Windows Server 2008 R2 DNS servers. Although Dynamic DNS frees you from the need 
to ﬁ ddle with A and PTR records for clients and other such entries, you still have to create 
other resource types (including MX records, required for the proper ﬂ ow of SMTP email) 
manually. You can manually create A, PTR, MX, SRV, and many other record types. 
 There are only two important things to remember: 
 
  You must right - click the zone and choose either the New Record command or the 
Other New Records command.  
 
  You must know how to fill in the fields of whatever record type you ’ re using. 
 For example, to create an MX record, you need three pieces of information (the 
domain, the mail server, and the priority), but to create an SRV record, you need 
several more.  
 In Exercise 2.4, you will manually create an MX record for a mailtest server in the 
domain you created back in Exercise 2.2.  
 E X E R C I S E  2 . 4
Manually Creating DNS RRs 
 1. 
  Open the DNS management snap - in by selecting Start   Administrative Tools   DNS.  
 2. 
  Expand your DNS server, right - click its zone, and choose New Host.  
 3. 
  Enter  mailtest in the Name ﬁ eld. Enter a TCP/IP number in the IP Address ﬁ eld (you can 
use any number for this exercise, i.e., 192.168.1.254). Click the Add Host button.  
 4. 
  A dialog box appears stating that the host record was created successfully. Click OK. 
Click Done.  
 5. 
  Right - click your zone name, and choose New Mail Exchanger (MX).  
 6. 
  Enter  mailtest in the Host Or Child Domain ﬁ eld, and enter  mailtest. yourDomain.com 
(or whatever domain name you used in Exercise 2.2) in the Fully Qualiﬁ ed Domain 
Name (FQDN) Of Mail Server ﬁ eld, and then click OK. Notice that the new record is 
already visible. 

 7. 
  Next, create an alias (or CNAME) record to point to the mail server. (It is assumed 
that you already have an A record for mailtest in your zone.) Right - click your zone and 
choose New Alias (CNAME).  
 8. 
  Type  mail into the Alias Name ﬁ eld.  
 9. 
  Type  mailtest. yourDomain.com into the Fully Qualiﬁ ed Domain Name (FQDN) For 
Target Host ﬁ eld.  
Configuring DNS 
77

78 
Chapter 2  Domain Name System (DNS)
E X E R C I S E  2 . 4  (c o n t i n u e d)
 10.   Click the OK button. 
 11.   Close the DNS management snap - in.  
 DNS Aging and Scavenging 
 When using dynamic updates, computers (or DHCP) will register a resource record with 
DNS. These records get removed when a computer is shut down properly. A major problem 
in the industry is that laptops are frequently removed from the network without a proper 
shutdown. Therefore, their resource records continue to live in the DNS database. 
 Windows Server 2008 R2 DNS supports two features called DNS aging and DNS 
scavenging. These features are used to clean up and remove stale resource records. 
DNS zone or DNS server aging and scavenging ﬂ ag old resource records that have not 
been updated in a certain amount of time (determined by the scavenging interval). These 
stale records will be scavenged at the next cleanup interval. DNS uses time stamps on the 
resource records to determine how long they have been listed in the DNS database.  
 Monitoring and Troubleshooting DNS 
 Now that you have set up and conﬁ gured your DNS name server and created some resource 
records, you will want to conﬁ rm that it is resolving and replying to client DNS requests. A 
couple of tools allow you to do some basic monitoring and managing. Once you are able to 
monitor DNS, you ’ ll want to start troubleshooting. 

 The simplest test is to use the  ping command to make sure the server is alive. A more 
thorough test would be to use  nslookup to verify that you can actually resolve addresses for 
items on your DNS server. 
 In the following sections, we ’ ll look at some of these monitoring and management tools, 
as well as how to troubleshoot DNS. 
 Monitoring DNS with the DNS Snap - In 
 You can use the DNS snap - in to do some basic server testing and monitoring. More 
importantly, you use the snap - in to monitor and set logging options. On the Event Logging 
tab of the server ’ s Properties dialog box (Figure 2.14), you can pick which events you want 
logged. The more events you select, the more log information you ’ ll get. This is useful when 
you ’ re trying to track what ’ s happening with your servers, but it can result in a very, very 
large log ﬁ le if you ’ re not careful.  
 F I G U R E 2 .14 The Event Logging tab of the server ’ s Properties dialog box  
 The Monitoring tab (Figure 2.15) gives you some testing tools. When the check box 
labeled A Simple Query Against This DNS Server is checked, a test is performed that 
asks for a single record from the local DNS server; it ’ s useful for verifying that the service 
is running and listening to queries, but not much else. When the check box labeled 
A Recursive Query To Other DNS Servers is checked, the test is more sophisticated — a 
recursive query checks whether forwarding is working okay. The Test Now button and the 
Perform Automatic Testing At The Following Interval check box allow you to run these 
tests now or later, as you require.  
Monitoring and Troubleshooting DNS 
79

80 
Chapter 2  Domain Name System (DNS)
 Another tab in the server ’ s properties that allows you to monitor the activity of the 
DNS server is the Debug Logging tab. The Debug Logging tab allows you to monitor all 
outbound and inbound DNS trafﬁ c, packet content, packet type, and which transport 
protocol (TCP or UDP) that you want to monitor on the DNS server.  
 If the simple query fails, check that the local server contains the zone 
 1.0.0.127.in - addr.arpa . If the recursive query fails, check that your 
root hints are correct and that your root servers are running.  
 In Exercise 2.5, you will enable logging, use the DNS MMC to test the DNS server, and 
view the contents of the DNS log.  
 E X E R C I S E  2 . 5
Simple DNS Testing  
 1. 
  Open the DNS management snap - in by selecting Start   Administrative Tools   DNS.  
 2. 
  Right - click the DNS server you want to test and select Properties.  
 3. 
  Switch to the Debug Logging tab, check all the debug logging options except Filter 
Packets By IP Address, and enter a full path and ﬁ lename in the File Path And Name 
ﬁ eld. Click the Apply button.  
  F I G U R E 2 .15  The Monitoring tab of the server ’ s Properties dialog box  

 4. 
  Switch to the Monitoring tab, and check both A Simple Query Against This DNS Server 
and A Recursive Query To Other DNS Servers. 
 5. 
  Click the Test Now button several times and then click OK.  
 6. 
  Using Windows Explorer, navigate to the folder that you speciﬁ ed in step 3 and use 
WordPad to view the contents of the log ﬁ le.  
 Troubleshooting DNS 
 When troubleshooting DNS problems, ask yourself the following basic questions: 
 
  What application is failing? What works? What doesn ’ t work?  
 
  Is the problem basic IP connectivity, or is it name resolution? If the problem is name 
resolution, does the failing application use NetBIOS names, DNS names, or host-
names?  
 
  How are the things that do and don ’ t work related?  
 
  Have the things that don ’ t work ever worked on this computer or network? If so, what 
has changed since they last worked?  
 Windows Server 2008 R2 provides several useful tools, discussed in the following 
sections, that can help you answer these questions: 
 
  Nslookup is used to perform DNS queries and to examine the contents of zone files on 
local and remote servers.  
 
  DNSLint is a command - line utility used for troubleshooting many common DNS issues.  
Monitoring and Troubleshooting DNS 
81

82 
Chapter 2  Domain Name System (DNS)
 
  Ipconfig allows you to perform the following tasks:  
 
  View DNS client settings  
 
  Display and flush the resolver cache  
 
  Force a dynamic update client to register its DNS records  
 
  The DNS log file monitors certain DNS server events and logs them for your 
edification.  
 Using Nslookup 
  Nslookup is a standard command - line tool provided in most DNS server implementations, 
including Windows Server 2008. Windows Server 2008 gives you the ability to launch 
 nslookup from the DNS snap - in.  
 When launching  nslookup from the DNS snap - in, a command prompt window 
opens automatically. You enter  nslookup commands in this window.  
 Nslookup offers the ability to perform query testing of DNS servers and to obtain 
detailed responses at the command prompt. This information can be useful for diagnosing 
and solving name resolution problems, for verifying that resource records are added or 
updated correctly in a zone, and for debugging other server - related problems. You can do 
a number of useful things with  nslookup : 
 
  Use it in non - interactive mode to look up a single piece of data  
 
  Enter interactive mode and use the debug feature  
 
  Perform the following from within interactive mode:  
 
  Set options for your query  
 
  Look up a name 
 
  Look up records in a zone  
 
  Perform zone transfers  
 
  Exit  nslookup 
 When you are entering queries, it is generally a good idea to enter FQDNs 
so you can control what name is submitted to the server. However, if you 
want to know which suffixes are added to unqualified names before they 
are submitted to the server, you can enter  nslookup in debug mode and 
then enter an unqualified name. 

 Using Nslookup on the Command Line 
 To use  nslookup in plain - old command - line mode, enter the following in the command 
prompt window: 
 nslookup  DNS_name_or_IP_address server_IP_address  
 This command will look up a DNS name or address using a server at the IP address 
you specify.  
 Using Nslookup in Interactive Mode 
 Nslookup is a lot more useful in interactive mode because you can enter several commands 
in sequence. Entering  nslookup by itself (without specifying a query or server) puts it in 
interactive mode, where it will stay until you type  exit and press Enter. Before that point, 
you can look up lots of useful stuff. Following are some of the tasks you can perform with 
 nslookup in interactive mode:  
 Setting Options with the  set Command   While in interactive mode, you can use the  set 
command to conﬁ gure how the resolver will carry out queries. Table 2.5 shows a few of the 
options available with  set . 
 TA B L E 2 . 5 Command - line options available with the  set command 
 Option  
  Purpose  
 set all 
  Shows all the options available. 
 set d2 
  Puts  nslookup in debug mode so you can examine the query 
and response packets between the resolver and the server. 
 set domain= domain name  
  Tells the resolver what domain name to append for 
unqualified queries. 
 set timeout= timeout  
  Tells the resolver how long to keep trying to contact the 
server. This option is useful for slow links where queries 
frequently time out and the wait time must be lengthened. 
 set type= record type  
  Tells the resolver which type of resource records to search 
for (for example, A, PTR, or SRV). If you want the resolver to 
query for all types of resource records, type   settype=all  . 
 Looking Up a Name   While in interactive mode, you can look up a name just by typing it: 
  stellacon.com  . In this example,  stellacon is the owner name for the record you are looking 
for, and  .com is the server that you want to query. 
Monitoring and Troubleshooting DNS 
83

84 
Chapter 2  Domain Name System (DNS)
 You can use the wildcard character ( * ) in your query. For example, if you want to look for 
all resource records that have  k as the first letter, just type   k*  as your query. 
  Looking Up a Record Type   If you want to query for a particular type of record (for 
instance, an MX record), use the  set type command. The command  set type=mx tells 
 nslookup that you ’ re only interested in seeing MX records that meet your search criteria.  
  Listing the Contents of a Domain   To get a list of the contents of an entire domain, use the 
 ls command. To ﬁ nd all the hosts in the  apple.com domain, you ’ d type   settype=a  and then 
type   ls - tapple.com  . 
  Troubleshooting Zone Transfers   You can simulate zone transfers by using the  ls 
command with the   - d switch. This can help you determine whether the server you 
are querying allows zone transfers to your computer. To do this, type the following: 
   ls - d domain__name   . 
 Nslookup Responses and Error Messages 
 A successful  nslookup response looks like this: 
Server:  Name_of_DNS_server 
Address:  IP_address_of_DNS_server 
Response_data 
 Nslookup might also return an error message. Some of the common messages are listed 
in Table 2.6:  
 TA B L E 2 .6 Common  nslookup error messages 
  Error Message  
  Meaning  
 DNS request timed out.
Timeout was  x seconds.
*** Can ’ t find server name for 
address  IP_Address : Timed out
*** Default servers are not 
available
Default Server: Unknown
Address:  IP_address_of_DNS_server 
 The resolver did not locate a PTR resource record 
(containing the hostname) for the server IP 
address you specified.  Nslookup can still query 
the DNS server, and the DNS server can still 
answer queries.  
  *** Request to Server timed - out 
  A request was not fulfilled in the allotted time. This 
might happen, for example, if the DNS service was 
not running on the DNS server that is authoritative 
for the name.  
  *** Server can ’ t find  Name_or_
IP_address_queried_for : No response 
from server 
 The server is not receiving requests on UDP (User 
Datagram Protocol) port 53.  

 In Exercise 2.6, you ’ ll get some hands - on practice with the  nslookup tool.  
 E X E R C I S E  2 . 6
Using the   Nslookup  Command  
 1. 
  Open a Windows Server 2008 command prompt by selecting Start   Command Prompt.  
 2. 
  Type   nslookup  and press the Enter key. (For the rest of the exercise, use the Enter key to 
terminate each command.) 
 3. 
  Try looking up a well - known address: Type   www.microsoft.com  . Notice that the query 
returns several IP addresses (Microsoft load - balances web trafﬁ c by using multiple 
servers in the same DNS record). 
 4. 
  Try looking up a nonexistent host: Type   www.example.ccccc  . Notice that your server 
complains that it can ’ t ﬁ nd the address and times out. This is normal behavior. 
 5. 
  Type  Exit at the prompt. Type  Exit again to leave the command prompt. 
 Using DNSLint 
 Microsoft Windows Server 2008 DNS can use the  DNSLint command - line utility to help 
diagnose some common DNS name - resolution issues and to help diagnose potential 
problems of incorrect delegation. You need to download  DNSLint from the Microsoft 
Download Center. 
 Error Message  
  Meaning  
 *** Server can ’ t find  Name_or_IP_
address_queried_for : Non - existent 
domain 
 The DNS server was unable to find the name 
or IP address in the authoritative domain. The 
authoritative domain might be on the remote DNS 
server or on another DNS server that this DNS 
server is unable to reach. 
 *** Server can ’ t find  Name_or_IP_
address_queried_for : Server failed 
 The DNS server is running but is not working 
properly. For example, it might include a corrupted 
packet, or the zone in which you are querying for 
a record might be paused. However, this message 
can also be returned if the client queries for a 
host in a domain for which the DNS server is not 
authoritative. You will also receive the error if the 
DNS server cannot contact its root servers, it is not 
connected to the Internet, or it has no root hints. 
Monitoring and Troubleshooting DNS 
85

86 
Chapter 2  Domain Name System (DNS)
 DNSLint uses three main functions to verify DNS records and to generate a report 
in HTML: 
 
  dnslint /d helps diagnose reasons that cause  “ lame delegation ” and other related 
DNS problems.  
 
  dnslint /ql helps verify a user - defined set of DNS records on multiple DNS servers.  
 
  dnslint /ad helps verify DNS records pertaining to Active Directory replication.  
 Here is the syntax for  DNSLint : 
dnslint /d  domain_name | /ad [ LDAP_IP_address ] | /ql  input_file 
[/c [smtp,pop,imap]] [/no_open] [/r  report_name ]
[/t] [/ test_tcp ] [/s  DNS_IP_address ] [/v] [/y] 
 The following are some sample queries: 
dnslint /d stellacon.com
dnslint /ad /s 192.168.36.201
dnslint /ql dns_server.txt
dnslint /ql autocreate
dnslint /v /d stellacon.com
dnslint /r newfile /d stellacon.com
dnslint /y /d stellacon.com
dnslint /no_open /d stellacon.com 
 Table 2.7 explains the command options.  
TA B L E 2 .7 DNSLint command options
 Command Option 
  Meaning  
 /d 
  Domain name that is being tested. 
 /ad 
  Resolves DNS records that are used for Active Directory forest 
replication.  
  /s 
  TCP/IP address of host 
 /ql 
  Request DNS query tests from a list. This switch sends DNS queries 
specified in an input file. 
 /v 
  Turns on verbose mode. 
 /r  filename  
 Allows you to create a report file.  
  /y 
  Overwrites an existing report file without being prompted.  
  /no_open 
  Prevents a report from opening automatically. 

 Using Ipconfig 
 You can use the command - line tool  ipconfig to view your DNS client settings, to view and 
reset cached information used locally for resolving DNS name queries, and to register the 
resource records for a dynamic update client. If you use the  ipconfig command with no 
parameters, it displays DNS information for each adapter, including the domain name and 
DNS servers used for that adapter. Table 2.8 shows some command - line options available 
with  ipconfig . 
 TA B L E 2 . 8 Command - line options available for the  ipconfig command 
 Command  
 What It Does  
 ipconfig /all 
  Displays additional information about DNS, including the 
FQDN and the DNS suffix search list. 
 ipconfig /flushdns 
  Flushes and resets the DNS resolver cache. For more 
information about this option, see the section  “ Configuring 
DNS ” earlier in this chapter. 
 ipconfig /displaydns 
  Displays the contents of the DNS resolver cache. For more 
information about this option, see  “ Configuring DNS ” earlier 
in this chapter. 
 ipconfig /registerdns 
  Refreshes all DHCP leases and registers any related DNS 
names. This option is available only on Windows 2000 and 
newer computers that run the DHCP Client service. 
 You should know and be comfortable with the  ipconfig commands 
related to DNS for the exam.  
 Using DNSCmd 
 DNSCmd is a free downloadable ﬁ le that allows you to display and change the properties of 
DNS servers, zones, and resource records through the use of command - line commands. 
The  DNSCmd utility allows you to manually modify, create, and delete resource records and/
or zones, and it allows you to force replication between two DNS servers. 
 Table 2.9 lists some of the  DNSCmd commands and their explanations.  
Monitoring and Troubleshooting DNS 
87

88 
Chapter 2  Domain Name System (DNS)
 TA B L E 2 . 9  DNSCmd command - line options 
  DNSCmd Command  
  Explanation  
  dnscmd /clearcache 
 Clears the DNS server cache 
  dnscmd /config 
  Resets DNS server or zone configuration  
  dnscmd /
createdirectorypartition 
 Creates a DNS application directory partition 
  dnscmd /
deletedirectorypartition 
 Deletes a DNS application directory partition 
  dnscmd /enumrecords 
  Shows the resource records in a zone  
  dnscmd /exportsettings 
  Creates a text file of all server configuration information 
  dnscmd /info 
  Displays server information 
  dnscmd /recordadd 
  Adds a resource record to a zone  
  dnscmd /recorddelete 
  Deletes a resource record from a zone  
  dnscmd /zoneadd 
 Creates a new DNS zone  
  dnscmd /zonedelete 
 Deletes a DNS zone  
  dnscmd /zoneexport 
 Creates a text file of all resource records in the zone 
  dnscmd /zoneinfo 
  Displays zone information  
  dnscmd /zonerefresh 
  Forces replication of the master zone to the secondary zone  
 For a full list of  DNSCmd commands, please visit Microsoft ’ s Technet forum 
at  http://technet.microsoft.com/en-us/library/cc772069(WS.10).aspx . 
 Using the DNS Log File 
 You can conﬁ gure the DNS server to create a log ﬁ le that records the following 
information: 
 
  Queries  
 
  Notification messages from other servers  

 
  Dynamic updates  
 
  Content of the question section for DNS query messages  
 
  Content of the answer section for DNS query messages  
 
  Number of queries this server sends  
 
  Number of queries this server has received  
 
  Number of DNS requests received over a UDP port  
 
  Number of DNS requests received over a TCP port  
 
  Number of full packets sent by the server  
 
  Number of packets written through by the server and back to the zone  
 The DNS log appears in   systemroot \System32\dns\Dns.log . Because the log is in RTF 
format, you must use WordPad or Word to view it. 
 Once the log ﬁ le reaches the maximum size, Windows Server 2008 writes over 
the beginning of the ﬁ le. You can change the maximum size of the log. If you increase the 
size value, data persists for a longer time but the log ﬁ le consumes more disk space. 
If you decrease the value, the log ﬁ le uses less disk space but the data persists for a 
shorter time.  
 Do not leave DNS logging turned on during normal operation because it 
sucks up both processing and hard disk resources. Enable it only when 
diagnosing and solving DNS problems. 
 Troubleshooting the .(root) Zone 
 As stated earlier in this chapter, a DNS root zone is the top - level DNS zone in the DNS 
hierarchy. Windows Server 2008 based DNS server will build a .(root) zone when a 
connection to the Internet can ’ t be found. 
 Because of this, the .(root) zone may prevent access to the Internet. The DNS forwarding 
option and DNS root hints will not be conﬁ gurable. If you want your DNS to work as a 
DNS forwarder or you want to use root hints, you must remove the .(root) zone.  
 Issues with Non - Microsoft DNS Servers 
 Another troubleshooting problem that you may run into is working with both 
Microsoft DNS servers and non - Microsoft DNS servers. One of the most common 
non - Microsoft DNS servers is the Unix - based BIND DNS server. 
 If you need to complete a zone transfer from Microsoft DNS to a BIND DNS 
server, you need to enable BIND Secondaries on the Microsoft DNS server, as shown 
in Figure 2.16.  
Monitoring and Troubleshooting DNS 
89

90 
Chapter 2  Domain Name System (DNS)
 If you need to enable Bind Secondaries, complete the following steps: 
 1. 
 Open the DNS management snap - in by selecting Start   Administrative Tools   DNS.  
 2. 
  Right - click the server name and choose Properties.  
 3. 
  Click the Advanced tab.  
 4. 
  Check the BIND Secondaries box.  
 5. 
  Click OK.  
 Summary 
 DNS was designed to be a robust, scalable, high - performance system for resolving 
friendly names to TCP/IP host addresses. We started by presenting an overview of the 
basics of DNS and how DNS names are generated. We then looked at the many new 
features available in the Microsoft Windows Server 2008 version of DNS and focused on 
how to install, conﬁ gure, and manage the necessary services. Microsoft ’ s DNS is based 
on a widely accepted set of industry standards. Because of this, Microsoft ’ s DNS can 
work with both Windows and non - Windows - based networks.  
  F I G U R E 2 .16  Enabling BIND Secondaries  

 Exam Essentials  
 Understand the purpose of DNS.   DNS is a standard set of protocols that deﬁ nes a 
mechanism for querying and updating address information in the database, a mechanism for 
replicating the information in the database among servers, and a schema of the database.  
 Understand the different parts of the DNS database.   The SOA record deﬁ nes the general 
parameters for the DNS zone, including who the authoritative server is. NS records list 
the name servers for a domain; they allow other name servers to look up names in your 
domain. A host record (also called an address record or an A record) statically associates a 
host ’ s name with its IP addresses. Pointer records (PTRs) map an IP address to a hostname, 
making it possible to do reverse lookups. Alias records allow you to use more than one 
name to point to a single host. The MX record tells you which servers can accept mail 
bound for a domain. SRV records tie together the location of a service (like a domain 
controller) with information about how to contact the service.  
 Know how DNS resolves names.   With iterative queries, a client asks the DNS server for 
an answer, and the client, or resolver, returns the best kind of answer it has. In a recursive 
query, the client sends a query to one name server, asking it to respond either with the 
requested answer or with an error. The error states either that the server can ’ t come up with 
the right answer or that the domain name doesn ’ t exist. With inverse queries, instead of 
supplying a name and then asking for an IP address, the client ﬁ rst provides the IP address 
and then asks for the name.  
 Understand the differences among DNS servers, clients, and resolvers.   Any computer 
providing domain name services is a DNS server. A DNS client is any machine issuing 
queries to a DNS server. A resolver handles the process of mapping a symbolic name to an 
actual network address.  
 Know how to install and configure DNS.   DNS can be installed before, during, or after 
installing the Active Directory service. When you install the DNS server, the DNS snap -
 in is installed, too. Conﬁ guring a DNS server ranges from very easy to very difﬁ cult, 
depending on what you ’ re trying to make it do. In the simplest conﬁ guration, for a caching -
 only server, you don ’ t have to do anything except make sure the server ’ s root hints are set 
correctly. You can also conﬁ gure a root server, a normal forward lookup server, and a 
reverse lookup server.  
 Know how to create new forward and reverse lookup zones.   You can use the New Zone 
Wizard to create a new forward or reverse lookup zone. The process is basically the same 
for both types, but the speciﬁ c steps and wizard pages differ somewhat. The wizard walks 
you through the steps, such as specifying a name for the zone (in the case of forward 
lookup zones) or the network ID portion of the network that the zone covers (in the case 
of reverse lookup zones).  
Exam Essentials 
91

92 
Chapter 2  Domain Name System (DNS)
  Know how to configure zones for dynamic updates.   The DNS service allows dynamic 
updates to be enabled or disabled on a per - zone basis at each server. This is easily done in 
the DNS snap - in.  
 Know how to delegate zones for DNS.   DNS provides the ability to divide the namespace 
into one or more zones; these can then be stored, distributed, and replicated to other DNS 
servers. When delegating zones within your namespace, be aware that for each new zone 
you create, you need delegation records in other zones that point to the authoritative DNS 
servers for the new zone.  
 Understand the tools that are available for monitoring and troubleshooting DNS.   You 
can use the DNS snap - in to do some basic server testing and monitoring. More importantly, 
you use the snap - in to monitor and set logging options. Windows Server 2008 R2 
automatically logs DNS events in the event log under a distinct DNS server heading. 
 Nslookup offers the ability to perform query testing of DNS servers and to obtain detailed 
responses at the command prompt. You can use the command - line tool  ipconfig to view 
your DNS client settings, to view and reset cached information used locally for resolving 
DNS name queries, and to register the resource records for a dynamic update client. Finally, 
you can conﬁ gure the DNS server to create a log ﬁ le that records queries, notiﬁ cation 
messages, dynamic updates, and various other DNS information.  

 Review Questions  
 1. 
  You are the network administrator for the ABC Company. Your network consists of two 
DNS servers named DNS1 and DNS2. The users who are configured to use DNS2 complain 
because they are unable to connect to Internet websites. The following table shows the 
configuration of both servers. 
 DNS1  
  DNS2  
 _msdcs.abc.com 
 abc.com  
 .(root) 
 _msdcs.abc.com 
 abc.com  
 
 The users connected to DNS2 need to be able to access the Internet. What needs to be done?  
 A.   Build a new Active Directory Integrated zone on DNS2.  
 B.   Delete the .(root) zone from DNS2 and configure Conditional forwarding on DNS2.  
 C.   Delete the current  cache.dns  file.  
 D.   Update your  cache.dns  file and root hints.  
 2. 
  You are the network administrator for a large company that has one main site and one 
branch office. Your company has a single Active Directory forest,  ABC.com . You have a 
single domain controller (ServerA) in the main site that has the DNS role installed. ServerA 
is configured as a primary DNS zone. You have decided to place a domain controller 
(ServerB) in the remote site and implement the DNS role on that server. You want to 
configure DNS so that if the WAN link fails, users in both sites can still update records and 
resolve any DNS queries. How should you configure the DNS servers?  
 A.   Configure ServerB as a secondary DNS server. Set replication to occur every 5 minutes.  
 B.   Configure ServerB as a stub zone.  
 C.   Configure ServerB as an Active Directory Integrated zone and convert ServerA to an 
Active Directory Integrated zone.  
 D.   Convert ServerA as an Active Directory Integrated zone and configure ServerB as a 
secondary zone.  
 3. 
 You are the network administrator for a midsize computer company. You have a single 
Active Directory forest, and your DNS servers are configured as Active Directory 
Integrated zones. When you look at the DNS records in Active Directory, you notice that 
there are many records for computers that do not exist on your domain. You want to make 
sure that only domain computers register with your DNS servers. What should you do to 
resolve this issue?  
 A.   Set dynamic updates to None.  
 B.   Set dynamic updates to Nonsecure and Secure.  
 C.   Set dynamic updates to Domain Users Only.  
 D.   Set dynamic updates to Secure Only.  
Review Questions 
93

94 
Chapter 2  Domain Name System (DNS)
  4. 
  Your company consists of a single Active Directory forest. You have a Windows Server 
2008 domain controller that also has the DNS role installed. You also have a Unix - based 
DNS server at the same location. You need to configure your Windows DNS server to allow 
zone transfers to the Unix - based DNS server. What should you do?  
 A.   Enable BIND secondaries.  
 B.   Configure the Unix machine as a stub zone.  
 C.   Convert the DNS server to Active Directory Integrated.  
 D.   Configure the Microsoft DNS server to forward all requests to the Unix DNS server.  
 5. 
  You are the network administrator for Stellacon Corporation. Stellacon has two trees in 
its Active Directory forest,  stellacon.com and  abc.com . Company policy does not allow 
DNS zone transfers between the two trees. You need to make sure that when anyone in 
 abc.com  tries to access the  stellacon.com  domain that all names are resolved from the 
 stellacon.com DNS server. What should you do? 
 A.   Create a new secondary zone in  abc.com  for  stellacon.com . 
 B.   Configure conditional forwarding on the  abc.com  DNS server for  stellacon.com . 
 C.   Create a new secondary zone in  stellacon.com  for  abc.com . 
 D.   Configure conditional forwarding on the  stellacon.com  DNS server for  abc.com . 
 6. 
 You are the network administrator for your organization. A new company policy states 
that all inbound DNS queries need to be recorded. What can you do to verify that the IT 
department is compliant with this new policy?  
 A.   Enable Server Auditing  - Object Access.  
 B.   Enable DNS debug logging.  
 C.   Enable server database query logging.  
 D.   Enable DNS Auditing  - Object Access.  
 7. 
  You are the network administrator for a small company with two DNS servers, DNS1 
and DNS2. Both DNS servers reside on domain controllers. DNS1 is set up as a standard 
primary zone and DNS2 is set up as a secondary zone. A new security policy was written 
stating that all DNS zone transfers must be encrypted. How can you implement the new 
security policy? 
 A.   Enable the Secure Only setting on DNS1.  
 B.   Enable the Secure Only setting on DNS2.  
 C.   Configure Secure Only on the Zone Transfers tab for both servers.  
 D.   Delete the secondary zone on DNS2. Convert both DNS servers to use Active 
Directory Integrated zones.  

 8. 
  You are responsible for DNS in your organization. You look at the DNS database and see a 
large number of older records on the server. These records are no longer valid. What should 
you do?  
 A.   In the zone properties, enable Zone Aging and Scavenging.  
 B.   In the server properties, enable Zone Aging and Scavenging.  
 C.   Manually delete all the old records.  
 D.   Set Dynamic Updates to None.  
 9. 
  Your IT team has been informed by the compliance team that they need copies of the DNS 
Active Directory Integrated zones for security reasons. You need to give the Compliance 
department a copy of the DNS zone. How should you accomplish this goal?  
 A.   Run  dnscmd /zonecopy . 
 B.   Run  dnscmd /zoneinfo . 
 C.   Run  dnscmd /zoneexport . 
 D.   Run  dnscmd /zonefile . 
 10.   You are the network administrator for a Windows Server 2008 R2 network. You have 
multiple remote locations connected to your main office by slow satellite links. You want 
to install DNS into these offices so that clients can locate authoritative DNS servers in the 
main location. What type of DNS servers should be installed in the remote locations?  
 A.   Primary DNS zones  
 B.   Secondary DNS zones  
 C.   Active Directory Integrated zones  
 D.   Stub zones   
Review Questions 
95

96 
Chapter 2  Domain Name System (DNS)
  Answers to Review Questions 
 1. 
B.   Because of the .(root) zone, users will not be able to access the Internet. The DNS 
 forwarding option and DNS root hints will not be conﬁ gurable. If you want your users to 
access the Internet, you must remove the .(root) zone.  
 2. 
C.  Active Directory Integrated zones store their records in Active Directory. Since this 
company only has one Active Directory forest, it ’ s the same Active Directory that both 
DNS servers are using. This allows ServerA to see all of the records of ServerB and ServerB 
to see all the records of ServerA.  
 3. 
D. The Secure Only option is for DNS servers that have an Active Directory Integrated 
zone. When a computer tries to dynamically register with DNS, the DNS server checks 
Active Directory to verify that the computer has an Active Directory account. If the 
computer that is trying to register has an account, DNS adds the host record. If the 
computer trying to register does not have an account, the record gets tossed away and the 
database is not updated.  
  4. 
A.  If you need to complete a zone transfer from Microsoft DNS to a BIND (Unix) DNS 
server, you need to enable BIND Secondaries on the Microsoft DNS server. 
 5. 
B.  Conditional forwarding allows you to send a DNS query to different DNS servers based 
on the request. Conditional forwarding lets a DNS server on a network forward DNS 
queries according to the DNS domain name in the query. 
 6. 
B.   On a Windows Server 2008 R2 DNS machine, debug logging is disabled by default. 
When it is enabled, you have the ability to log DNS server activity, including inbound and 
outbound queries, packet type, packet content, and transport protocols.  
 7. 
D.  Active Directory Integrated zones give you many beneﬁ ts over using primary and 
secondary zones including less network trafﬁ c, secure dynamic updates, encryption, and 
reliability in the event of a DNS server going down. The Secure Only option is for dynamic 
updates to a DNS database. 
 8. 
A.  Windows Server 2008 R2 DNS supports two features called DNS Aging and DNS 
Scavenging. These features are used to clean up and remove stale resource records. DNS 
zone or DNS server aging and scavenging ﬂ ags old resource records that have not been 
updated in a certain amount of time (determined by the scavenging interval). These stale 
records will be scavenged at the next cleanup interval. 
 9. 
C.   The  dnscmd /zoneexport command creates a ﬁ le using the zone resource records. This 
ﬁ le can be then given to the Compliance department as a copy.  
 10. D.   Stub zones are very useful for slow WAN connections. These zones store only three 
types of resource records: NS records, glue host (A) records, and SOA records. These three 
records are used to locate authoritative DNS servers.  
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at  
www.sybex.com/go/mctswindows2008r2. 

Active Directory 
Planning and 
Installation  
 Chapter 
3

 In the previous chapters, you ’ ve seen some factors you need to 
take into account when planning for Active Directory, such 
as your company ’ s physical and logical structure and the need 
for centralized or decentralized administration. The time you spend understanding these 
concepts is very important because the success of your Active Directory implementation 
depends on them. 
 Now that you are familiar with Domain Name System (DNS), you need to verify that 
the computer you upgrade to a domain controller (DC) meets the basic ﬁ lesystem and 
network connectivity requirements so that Active Directory runs smoothly and efﬁ ciently 
in your organization. 
 Next, you ’ ll explore the concept of domain functional levels, which essentially determine 
what sorts of domain controllers you can use in your environment. For instance, in the 
Windows Server 2000 Native domain functional level, you can include Server 2008, Server 
2003, and 2000 Server domain controllers, but the functionality of the domain is severely 
limited. 
 Once you understand how to properly plan for your domain environment, you will learn 
how to install Active Directory, which you accomplish by promoting a Windows Server 
2008 R2 computer to a domain controller. We will also discuss a feature in Windows 
Server 2008 R2 called a read - only domain controller (RODC). 
 After you become familiar with the initial Active Directory installation, you will learn 
how to install and conﬁ gure Application Directory partitions. These partitions provide 
replicable data repositories using the Active Directory paradigm, but they don ’ t actually 
store any security principals, such as users or groups. As the name implies, you use 
Application Directory partitions primarily to store data generated by applications that need 
to be replicated throughout your network environments independently of the rest of Active 
Directory. 
 The ﬁ nal section of this chapter deals with integrating DNS with Active Directory. You 
learned about DNS in Chapter 2,  “ Domain Name System (DNS), ” but here we will review 
how DNS implements with Active Directory.  
 For these exercises, we assume that you are creating a Windows Server 
2008 R2 machine in a test environment and not on a live network. If this 
Windows Server 2008 R2 machine is being added into a Windows Server 
2003 domain, you will need to prep the domain. This is explained in 
Chapter 4,  “ Installing and Managing Trees and Forests. ” 

 Verifying the Filesystem 
 When planning your Active Directory deployment, the ﬁ lesystem the operating system 
uses is an important concern for many reasons. First, the ﬁ lesystem can provide the 
ultimate level of security for all of the information stored on the server itself. Second, it is 
responsible for managing and tracking all of this data. Furthermore, certain features are 
available only on certain ﬁ lesystems. These features include encryption support, remote ﬁ le 
access, remote storage, disk redundancy, and disk quotas. 
 The Windows Server 2008 R2 platform supports two ﬁ lesystems: 
 
  File Allocation Table  32 (FAT32)  
 
  Windows  NT File System (NTFS) 
 The fundamental difference between FAT32 and NTFS partitions is that NTFS allows 
for ﬁ lesystem - level security. Support for FAT32 is mainly included in Windows Server 2008 
R2 for backward compatibility and machines that need to  dual - boot . For example, if you  
want to conﬁ gure a single computer to boot into Windows 98 and Windows Server 2003, 
you need to have at least one FAT or FAT32 partition. 
 Windows Server 2008 R2 uses version 5 of NTFS. There are many other beneﬁ ts to 
using NTFS, including support for the following:  
 Disk Quotas   In order to restrict the amount of disk space used by users on the network, 
systems administrators can establish disk quotas. By default, Windows Server 2008 R2 
supports disk quota restrictions at the volume level. That is, you can restrict the amount of 
storage space a speciﬁ c user uses on a single disk volume. Third - party solutions that allow 
more granular quota settings are also available.  
 Filesystem Encryption   One of the fundamental problems with network operating systems 
(NOSs) is that systems administrators are often given full permission to view all ﬁ les and 
data stored on hard disks, which can be a security and privacy concern. In some cases, this 
is necessary. For example, in order to perform backup, recovery, and disk management 
functions, at least one user must have all permissions. Windows Server 2008 R2 and 
NTFS address these issues by allowing for ﬁ lesystem encryption. Encryption essentially 
scrambles all of the data stored within ﬁ les before they are written to the disk. When an 
authorized user requests the ﬁ les, they are transparently decrypted and provided. By using 
encryption, you can prevent the data from being used in case it is stolen or intercepted by an 
unauthorized user, even a systems administrator.  
 Dynamic Volumes   Protecting against disk failures is an important concern for 
production servers. Although earlier versions of Windows NT supported various levels 
of Redundant Array of Independent Disks (RAID) technology, software - based solutions 
had some shortcomings. Perhaps the most signiﬁ cant was that administrators needed to 
perform server reboots to change RAID conﬁ gurations. Also, you could not make some 
conﬁ guration changes without completely reinstalling the operating system. With Windows 
Server 2008 R2 ’ s support for dynamic volumes, systems administrators can change RAID 
Verifying the Filesystem 
99

100 
Chapter 3  Active Directory Planning and Installation
and other disk conﬁ guration settings without needing to reboot or reinstall the server. The 
result is greater data protection, increased scalability, and increased uptime.  
  Mounted Drives   By using mounted drives, systems administrators can map a local disk 
drive to an NTFS directory name. This helps them organize disk space on servers and 
increase manageability. By using mounted drives, you can mount the  C:\Users directory to 
an actual physical disk. If that disk becomes full, you can copy all of the ﬁ les to another, 
larger drive without changing the directory pathname or reconﬁ guring applications.  
  Remote Storage   Systems administrators often notice that as soon as they add more space, 
they must plan the next upgrade. One way to recover disk space is to move infrequently 
used ﬁ les to tape. However, backing up and restoring these ﬁ les can be quite difﬁ cult and 
time consuming. Systems administrators can use the remote storage features supported 
by NTFS to automatically off - load seldom - used data to tape or other devices, but the ﬁ les 
remain available to users. If a user requests an archived ﬁ le, Windows Server 2008 R2 can 
automatically restore the ﬁ le from a remote storage device and make it available. Using 
remote storage like this frees up systems administrators ’ time and allows them to focus on 
tasks other than micromanaging disk space.  
  Self - Healing NTFS   In previous versions of the Windows Server operating system, if you 
had to ﬁ x a corrupted NTFS volume, you used a tool called  Chkdsk.exe . The disadvantage 
of this tool is that the Windows Server ’ s availability was disrupted. If this server was your 
domain controller, that could stop domain logon authentication. 
  To help protect the Windows Server 2008 R2 NTFS ﬁ lesystem, Microsoft now uses 
a feature called self - healing NTFS. Self - healing NTFS attempts to ﬁ x corrupted NTFS 
ﬁ lesystems without taking them ofﬂ ine. Self - healing NTFS allows an NTFS ﬁ lesystem to be 
corrected without running the  Chkdsk.exe utility. New features added to the NTFS kernel 
code allow disk inconsistencies to be corrected without system downtime.  
  Security   NTFS allows you to conﬁ gure not only folder - level security but also ﬁ le - level 
security. NTFS security is one of the biggest reasons why most companies use NTFS.  
 NTFS security and shared permissions will both be discussed in greater 
detail in the 70 - 642 section of this book. 
 Setting Up the NTFS Partition 
 Although the features mentioned in the previous section probably compel most systems 
administrators to use NTFS, more reasons make using it mandatory. The most important 
reason is that the Active Directory data store must reside on an NTFS partition. Therefore, 
before you begin installing Active Directory, make sure you have at least one NTFS 
partition available. Also, be sure you have a reasonable amount of disk space available (at 
least 4 GB). Because the size of the Active Directory data store will grow as you add objects 
to it, also be sure you have adequate space for the future. 

 Exercise 3.1 shows you how to use the administrative tools to view and modify disk 
conﬁ guration.  
 Before you make any disk configuration changes, be sure you completely 
understand their potential effects; then perform the test in a lab 
environment and make sure you have good, verifiable backups handy. 
Changing partition sizes and adding and removing partitions can result in 
a total loss of all information on one or more partitions.  
 If you want to convert an existing partition from FAT or FAT32 to NTFS, you need to 
use the  CONVERT command - line utility. For example, the following command converts the 
 C: partition from FAT to NTFS: 
CONVERT c: /fs:ntfs 
 E X E R C I S E  3 .1
Viewing Disk Configuration  
 1. 
  Click Start   Administrative Tools   Computer Management.  
 2. 
  Under the Storage branch, click Disk Management.  
Verifying the Filesystem 
101

102 
Chapter 3  Active Directory Planning and Installation
   Windows Server 2008 R2 allows you to convert existing FAT or FAT32 
partitions to NTFS. However, this is a one - way process. You cannot 
convert an NTFS partition to any other filesystem without losing data. If 
you need to make such a conversion, the recommended process involves 
backing up all existing data, deleting and reformatting the partition, and 
then restoring the data.  
 Only the Windows NT, 2000, XP, Vista, Windows 7, 2003, and 2008 
operating systems (all based on the original NT architecture) can read 
and write to and from NTFS partitions. Therefore, if you are using other 
operating systems on the same computer, be sure you fully understand the 
effects of converting the filesystem.  
 Verifying Network Connectivity 
 Although a Windows Server 2008 R2 computer can be used by itself without connecting 
to a network, you will not harness much of the potential of the operating system without 
network connectivity. Because the fundamental purpose of a network operating system is 
to provide resources to users, you must verify network connectivity. 
E X E R C I S E  3 .1  (c o n t i n u e d)
 The Disk Management program shows you the logical and physical disks that are 
currently conﬁ gured on your system. Note that information about the size of each 
partition is also displayed (in the Capacity column).  
 3. 
  Use the View menu to choose various depictions of the physical and logical drives in 
your system.  
 4. 
  To see the available options for modifying partition settings, right - click any of the disks 
or partitions. This step is optional. 
 If the partition you are trying to convert contains any system ﬁ les or the Windows Server 
2008 R2 virtual memory page ﬁ le, a message informs you that the conversion will take 
place during the next machine reboot. After the partition is converted to NTFS, the 
computer automatically reboots again, and you will be able to continue using the system. 
 

 Basic Connectivity Tests 
 Before you begin to install Active Directory, you should perform several checks of your 
current conﬁ guration to ensure that the server is conﬁ gured properly on the network. You 
should test the following:  
 Network Adapter   At least one network adapter should be installed and properly 
conﬁ gured on your server. A quick way to verify that a network adapter is properly 
installed is to use the Computer Management administrative tool. Under Device Manager, 
Network Adapters branch, you should have at least one network adapter listed. If you do 
not, use the Add Hardware icon in Control Panel to conﬁ gure hardware.  
 TCP/IP   Make sure TCP/IP is installed, conﬁ gured, and enabled on any necessary 
network adapters. The server should also be given a valid IP address and subnet mask. 
Optionally, you may need to conﬁ gure a default gateway, DNS servers, WINS servers, 
and other network settings. If you are using DHCP, be sure that the assigned information 
is correct. It is always a good idea to use a static IP address for servers because IP address 
changes can cause network connectivity problems if they are not handled properly.  
 You must understand TCP/IP to use Windows Server 2008 R2 and Active 
Directory. TCP/IP will be covered in greater detail in the 70 - 642 section of 
this book. 
 Internet Access   If the server should have access to the Internet, verify that it is able 
to connect to external web servers and other machines outside the large area network 
(LAN). If the server is unable to connect, you might have a problem with the TCP/IP 
conﬁ guration.  
 LAN Access   The server should be able to view other servers and workstations on the 
network. You can quickly verify this type of connectivity by clicking Start   Network. 
If other machines are not visible, ensure that the network and TCP/IP conﬁ guration are 
correct for your environment.  
 Client Access   Network client computers should be able to connect to your server and 
view any shared resources. A simple way to test connectivity is to create a share and test 
whether other machines are able to see ﬁ les and folders within it. If clients cannot access 
the machine, ensure that both the client and server are conﬁ gured properly.  
 Wide Area Network Access   If you ’ re working in a distributed environment, you 
should ensure that you have access to any remote sites or users that will need to connect 
to this machine. Usually, this is a simple test that can be performed by a network 
administrator.  
Verifying Network Connectivity 
103

104 
Chapter 3  Active Directory Planning and Installation
 Tools and Techniques for Testing Network 
Configuration 
 In some cases, verifying network access can be quite simple. You might have some 
internal and external network resources with which to test. In other cases, it might be 
more complicated. You can use several tools and techniques to verify that your network 
conﬁ guration is correct:  
 Using the   Ipconfig  Utility   By typing   ipconf ig/all   at the command prompt, you can 
view information about the TCP/IP settings of a computer. Figure 3.1 shows the types of 
information you ’ ll receive.  
  Using the  Ping Command   The  ping command was designed to test connectivity to other 
computers. You can use the command by simply typing   ping  and then an IP address or 
hostname at the command line. The following are some steps for testing connectivity using 
the  ping command.  
 Ping Other Computers on the Same Subnet.   You should start by pinging a known 
active IP address on the network to check for a response. If you receive one, then you 
have connectivity to the network. 
 Next, check to see if you can ping another machine using its hostname. If this works, 
then local name resolution works properly.  
 Ping Computers on Different Subnets.   In order to ensure that routing is set up 
properly, you should attempt to ping computers that are local on other subnets (if any 
exist) on your network. If this test fails, try pinging the default gateway. Any errors may 
indicate a problem in the network conﬁ guration or a problem with a router.  
 When You Don ’ t Receive a Response 
 Some ﬁ rewalls, routers, or servers on your network or on the Internet might prevent you 
from receiving a successful response from a  ping command. This is usually for security 
reasons (malicious users might attempt to disrupt network trafﬁ c using excessive pings as 
well as redirects and smurf attacks). If you do not receive a response, do not assume that 
the service is not available. Instead, try to verify connectivity in other ways. For example, 
you can use the  TRACERT command to demonstrate connectivity beyond your subnet, 
even if other routers ignore Internet Control Message Protocol (ICMP) responses. Since the 
display of a second router implies connectivity, the path to an ultimate destination shows 
success even if it does not display the actual names and addresses. 

 Browsing the Network   To ensure that you have access to other computers on the network, 
be sure that they can be viewed by clicking Start   Network. This veriﬁ es that your name 
resolution parameters are set up correctly and that other computers are accessible. Also, try 
connecting to resources (such as ﬁ le shares or printers) on other machines.  
 Browsing the Internet   You can quickly verify whether your server has access to 
the Internet by visiting a known website, such as  www.microsoft.com . Success ensures 
that you have access outside of your network. If you do not have access to the Web, 
you might need to verify your proxy server settings (if applicable) and your DNS server 
settings.  
 By performing these simple tests, you can ensure that you have a properly conﬁ gured 
network connection and that other network resources are available.  
 Understanding Domain and 
Forest Functionality 
 Windows Server 2008 R2 Active Directory uses a concept called  domain and forest 
functionality . The functional level that you choose during the Active Directory installation 
determines which features your domain can use. 
 Windows Server 2003, 2008, and 2008 R2 include additional forest functionality 
compared to Windows 2000. Forest functionality applies to all of the domains in 
a forest. 
 F I G U R E 3 .1 Viewing TCP/IP information with the  ipconfig utility 
Understanding Domain and Forest Functionality 
105

106 
Chapter 3  Active Directory Planning and Installation
 About the Domain Functional Level 
 Windows Server 2008 R2 will support the following domain functional levels: 
 
  Windows 2000 Native  
 
  Windows 2003  
 
  Windows Server 2008  
 
  Windows Server 2008 R2  
 Which function level you use depends on the domain controllers you have installed on 
your network. This is an important fact to remember. You can use Windows 2000 Server, 
and Windows 2003 member servers in the Windows Server 2008 function level, as long as 
all domain controllers are running Windows Server 2008. 
 When you install the ﬁ rst domain controller in a new Windows Server 2008 R2 forest, 
the forest functional level is set by default to Windows Server 2003. Windows Server 2003 is the 
default setting because once a forest functional level is upgraded, it cannot be downgraded. 
 Table 3.1 shows features available in Windows 2000 Native, Windows 2003, Windows 
Server 2008, and Windows Server 2008 R2 domain functional levels. Even though 
Windows 2000 is out of the support cycle, it is shown here to give you a full representation 
of how functional levels have changed.  
  Domain Functional 
Feature  
 Windows 
2000 Native  
 Windows 
Server 2003  
 Windows 
Server 2008  
 Windows 
Server 2008 R2 
  Authentication 
Assurance  
 Disabled  
  Disabled  
  Disabled  
  Enabled  
  Fine - grained password 
policies  
 Disabled  
  Disabled  
  Enabled  
  Enabled  
  Last interactive logon 
information  
 Disabled  
  Disabled  
  Enabled  
  Enabled  
  Advanced Encryption 
Services (AES 128 and 
256) support for the 
Kerberos protocol  
 Disabled  
  Disabled  
  Enabled  
  Enabled  
  Distributed File System 
replication support for 
Sysvol.  
 Disabled  
  Disabled  
  Enabled  
  Enabled  
  Read - only domain 
controller (RODC)  
 Disabled  
  Enabled  
  Enabled  
  Enabled  
TA B L E 3 .1 Comparing domain functional levels

 Domain Functional 
Feature  
 Windows 
2000 Native  
 Windows 
Server 2003  
 Windows 
Server 2008  
 Windows 
Server 2008 R2 
 Ability to redirect the 
Users and Computers 
containers  
 Disabled  
  Enabled  
  Enabled  
  Enabled  
 Ability to rename 
domain controllers  
 Disabled  
  Enabled  
  Enabled  
  Enabled  
 Logon time stamp 
updates  
 Disabled  
  Enabled  
  Enabled  
  Enabled  
 Kerberos KDC key 
version numbers  
 Disabled  
  Enabled  
  Enabled  
  Enabled  
 Passwords for 
InetOrgPerson objects 
 Disabled  
  Enabled  
  Enabled  
  Enabled  
 Converts NT groups to 
domain local and global 
groups 
 Enabled  
  Enabled  
  Enabled  
  Enabled  
 SID history  
  Enabled  
  Enabled  
  Enabled  
  Enabled  
 Group nesting  
  Enabled  
  Enabled  
  Enabled  
  Enabled  
 Universal groups  
  Enabled  
  Enabled  
  Enabled  
  Enabled  
 About Forest Functionality 
 Windows Server 2008 R2 includes new forest functionality features. Forest functionality 
applies to all of the domains in a forest. All domains have to be upgraded to Windows 
Server 2008 R2 before the forest can be upgraded to Windows Server 2008 R2. 
 There are four levels of forest functionality: 
 
  Windows 2000 support for Windows 2000, 2003, 2008, and 2008 R2 domain con-
trollers  
 
  Windows Server 2003  
 
  Windows Server 2008  
 
  Windows Server 2008 R2  
 Windows Server 2003, 2008, and 2008 R2 have many of the same forest features. Some 
of these features are described in the following list:  
 Global Catalog Replication Enhancements   When an administrator adds a new attribute 
to the Global Catalog, only those changes are replicated to other Global Catalogs in the 
forest. This can signiﬁ cantly reduce the amount of network trafﬁ c generated by replication.  
Understanding Domain and Forest Functionality 
107

108 
Chapter 3  Active Directory Planning and Installation
  Defunct Schema Classes and Attributes   You can never permanently remove classes and 
attributes from the Active Directory schema, but you can mark them as defunct so that 
they cannot be used. With Windows Server 2003 and 2008 forest functionality, you can 
redeﬁ ne the defunct schema attribute so that it occupies a new role in the schema.  
  Forest Trusts   Previously, systems administrators had no easy way of granting permission 
on resources in different forests. Windows Server 2003 and 2008 resolve some of these 
difﬁ culties by allowing trust relationships between separate Active Directory forests. Forest 
trusts act much like domain trusts, except that they extend to every domain in two forests. 
Note that all forest trusts are intransitive.  
  Linked Value Replication   Windows Server 2003 and 2008 use a concept called  linked 
value replication . With linked value replication, only the user record that has been changed 
is replicated (not the entire group). This can signiﬁ cantly reduce network trafﬁ c associated 
with replication.  
 Renaming Domains   Although the Active Directory domain structure was originally 
designed to be ﬂ exible, there were several limitations. Because of mergers, acquisitions, 
corporate reorganizations, and other business changes, you may need to rename domains. 
In Windows Server 2003 and 2008, you can change the DNS and NetBIOS names for 
any domain, as well as reposition a domain within a forest. Note that this operation 
is not as simple as just issuing a  rename command. Instead, there ’ s a speciﬁ c process 
you must follow to make sure that the operation is successful. Fortunately, when you 
properly follow the procedure, Microsoft supports domain renaming even though not all 
applications do.  
 Other Features   Windows Server 2003, 2008, and 2008 R2 also support the following 
features: 
 
  Improved replication algorithms and dynamic auxiliary classes are designed to increase 
performance, scalability, and reliability.  
 
  Active Directory Federation Services (AD FS, also known as Trustbridge) handles 
federated identity management. Federated identity management is a standards - based 
information technology process that enables distributed identification, authentication, 
and authorization across organizational and platform boundaries. The AD FS solution in 
Windows Server 2003 (Release 2), 2008, and 2008 R2 helps administrators address these 
challenges by enabling organizations to securely share a user ’ s identity information.  
 
  Active Directory Application Mode (ADAM) was developed by Microsoft as part of 
Windows Server 2008 R2 Active Directory for organizations that require flexible 
support for directory - enabled applications. ADAM, which uses the Lightweight 
Directory Access Protocol (LDAP), is a directory service that adds flexibility and helps 
organizations avoid increased infrastructure costs.  
 Many of the concepts related to domain and forest functional features are 
covered in greater detail later in this book. 

 Planning the Domain Structure 
 Once you have veriﬁ ed the technical conﬁ guration of your server for Active Directory, it ’ s 
time to verify the Active Directory conﬁ guration for your organization. Since the content 
of this chapter focuses on installing the ﬁ rst domain in your environment, you really only 
need to know the following information prior to beginning setup: 
 
  The DNS name of the domain 
 
  The computer name or the NetBIOS name of the server (which will be used by 
previous versions of Windows to access server resources)  
 
  Which domain function level the domain will operate in  
 
  Whether other DNS servers are available on the network  
 
  What type of and how many DNS servers are available on the network  
 However, if you will be installing additional domain controllers in your environment 
or will be attaching to an existing Active Directory structure, you should also have the 
following information: 
 
 If this domain controller will join an existing domain, you should know the name of 
that domain. You will also either require a password for a member of the Enterprise 
Administrators group for that domain or have someone with those permissions create 
a domain account before promotion.  
 
 You should know whether the new domain will join an existing tree and, if so, the 
name of the tree it will join.  
 
  You should know the name of a forest to which this domain will connect (if applicable).  
 Installing Active Directory 
 Installing Active Directory is an easy and straightforward process as long as you planned 
adequately and made the necessary decisions beforehand. In this section, you ’ ll look at the 
actual steps required to install the ﬁ rst domain controller in a given environment. 
 With early versions of the Windows NT operating system, you had to determine during 
installation the role of your server as it related to the domain controller or member server. 
Choices included making the machine a primary domain controller (PDC), a backup 
domain controller (BDC), or a member server. This was an extremely important decision 
because, even though you could promote a BDC to a PDC, you had to completely reinstall 
the operating system to make any changes to the server ’ s role between a domain controller 
and a member server. 
 Instead of forcing you to choose during setup whether the machine will participate as a 
domain controller, Windows Server 2008 R2 allows you to promote servers after you install 
Active Directory. Therefore, at the end of the setup process, all Windows Server 2008 
R2 computers are conﬁ gured as either member servers (if they are joined to a domain) or 
Installing Active Directory 
109

110 
Chapter 3  Active Directory Planning and Installation
stand - alone servers (if they are part of a workgroup). The process of converting a member 
server to a domain controller is known as  promotion . Through the use of a simple and intuitive 
wizard, systems administrators can quickly conﬁ gure servers to be domain controllers after 
installation. 
 Later in this section, you ’ ll follow the steps you need to take to install Active Directory 
by promoting the ﬁ rst domain controller in the domain. These steps are performed using 
the Active Directory Installation Wizard  (DCPROMO) . This tool is designed to be used 
after a server has been installed in the environment. As part of the promotion process, the 
server creates or receives information related to Active Directory conﬁ guration. 
 The ﬁ rst step in installing Active Directory is promoting a Windows Server 2008 R2 
computer to a domain controller. The ﬁ rst domain controller in an environment serves as 
the starting point for the forest, trees, domains, and the Operations Master roles. 
 Exercise 3.2 shows the steps you need to follow to promote an existing Windows Server 
2008 R2 to a domain controller. In order to complete the steps in this exercise, you must 
have already installed and conﬁ gured a Windows Server 2008 R2 computer. You also need 
a DNS server that supports SRV records. If you do not have a DNS server available, the 
Active Directory Installation Wizard automatically conﬁ gures one for you.   
 E X E R C I S E  3 . 2 
Promoting a Domain Controller  
 1. 
  Start the Active Directory Installation Wizard by clicking Start   Run and typing 
  dcpromo   . 
 2. 
  When the Welcome screen appears, check the box that says Use Advanced Mode 
Installation, and then click Next.  
 3. 
  Click Next at the Operating System Compatibility screen.  
 4. 
  The Choose A Deployment Conﬁ guration dialog box appears. Choose the second 
option, Create A New Domain In A New Forest. Then click Next.  

 5. 
  A warning box may appear stating that the local administrator account will become the 
domain administrator account. If this box appears, click Yes.  
 6. 
  The Name The Forest Root Domain dialog box appears, asking you to enter the full DNS 
name of your domain. Enter your domain ’ s DNS name and click Next. (Use   mycompany
.com  if you do not have a domain name.)  
 7. 
  After the DNS name gets veriﬁ ed, a NetBIOS name box appears with your default 
NetBIOS name (for example,  mycompany ). Leave the default and click Next. 
 A NetBIOS name can be up to 15 characters. To make it easier to remember and type 
the name, you should limit yourself to English alphabet characters and numbers.  
 8. 
  The Set Forest Functional Level dialog box appears. Use the pull - down menu and 
choose Windows Server 2003, and then click Next. Do not choose Windows Server 2008 
R2; we will upgrade the forest later.  
Installing Active Directory 
111

112 
Chapter 3  Active Directory Planning and Installation
E X E R C I S E  3 . 2  (c o n t i n u e d)
 9. 
  The Set Domain Functional Level dialog box will appear. Use the pull - down menu and 
choose Windows Server 2003, and then click Next. Do not choose Windows Server 2008 
R2; we will upgrade the domain later.  
 10.   When the Additional Domain Controller Options page appears, make sure DNS Server is 
checked (if you need to install DNS). Also notice the option labeled Read - Only Domain 
Controller (RODC). This is where you will create your RODC (RODC installation and 
conﬁ guration are covered in later chapters of this book). Since this is the ﬁ rst domain 
controller in your new domain, the RODC option is grayed out. Click Next.  
 11.   If you are using DHCP to receive a TCP/IP address, a Static IP Assignment dialog box 
may appear. If it does, choose the Yes option and go on to the next step.  
 12.   In the Location for Database, Log Files, and SYSVOL page, specify the ﬁ lesystem 
locations for the Active Directory database and log ﬁ les. Microsoft recommends that 
these ﬁ les reside on separate physical devices in order to improve performance and 

to provide for recoverability. The default ﬁ lesystem location is in a directory called 
 NTDS  located within the system root. However, you can choose any folder located on a 
FAT32 or NTFS partition (SYSVOL requires NTFS). After you ’ ve speciﬁ ed the ﬁ lesystem 
locations (you can leave the defaults if you like), click Next.  
 13.   On the Directory Services Restore Mode Administrator Password page, provide a 
password to be used to restore Active Directory in the event of its loss or corruption. 
Note that this password does not have to correspond with passwords set for any other 
account. For this exercise, use the following password: 
  P@ssw0rd   
 After conﬁ rming the password, click Next.  
Installing Active Directory 
113

114 
Chapter 3  Active Directory Planning and Installation
E X E R C I S E  3 . 2  (c o n t i n u e d)
 14.   Based on the installation options you ’ ve selected, the wizard presents a summary of 
your choices. It is a good idea to copy and paste this information into a text ﬁ le to refer 
to later. Verify the options, and then click Next to begin the Active Directory installation 
process. 
 A dialog box showing a book that is being written to will appear as Active Directory 
is installing.  
 15.   Once Active Directory has been installed, click Finished. You are prompted to reboot the 
system. After the reboot, you can access the administrative tools that are related to the 
conﬁ guration and management of Active Directory. 
 
 Verifying Active Directory Installation 
 Once you have installed and conﬁ gured Active Directory, you ’ ll want to verify that you 
have done so properly. In the following sections, you ’ ll look at methods for doing this. 
 Using Event Viewer 
 The ﬁ rst (and perhaps most informative) way to verify the operations of Active Directory is 
to query information stored in the Windows Server 2008 R2 event log. You can do this using 
the Windows Server 2008 R2 Event Viewer. Exercise 3.3 walks you through this procedure. 
Entries seen with the Event Viewer include errors, warnings, and informational messages. 
 In order to complete the steps in this exercise, you must have configured 
the local machine as a domain controller.   

 E X E R C I S E  3 . 3
Viewing the Active Directory Event Log  
 1. 
  Open the Event Viewer snap - in from the Administrative Tools program group.  
 2. 
  In the left pane, under Applications and Services Logs, select Directory Service. 
 3. 
  In the right pane, you can sort information by clicking column headings. For example, you 
can click the Source column to sort by the service or process that reported the event. 
 4. 
  Double - click an event in the list to see the details for that item. Note that you can click 
the Copy button to copy the event information to the Clipboard. You can then paste 
the data into a document for later reference. Also, you can move between items using the 
up and down arrows. Click OK when you have ﬁ nished viewing an event.  
 5. 
  Filter an event list by right - clicking the Directory Service item in the left pane and 
selecting Filter Current Log. Note that ﬁ ltering does not remove entries from the event 
logs — it only restricts their display.  
 6. 
  To verify Active Directory installation, look for events related to the proper startup of 
Active Directory, such as Event ID 1000 (Active Directory Startup Complete) and 1394 
(Attempts To Update The Active Directory Database Are Succeeding). Also, be sure to 
examine any error or warning messages because these could indicate problems with 
DNS or other necessary services.  
 7. 
  When you ’ ve ﬁ nished viewing information in the Event Viewer, close the application.  
 
Verifying Active Directory Installation 
115

116 
Chapter 3  Active Directory Planning and Installation
 Gaining Insight through Event Viewer 
 Despite its simple user interface and somewhat limited GUI functionality, the Event 
Viewer tool can be your best ally in isolating and troubleshooting problems with 
Windows Server 2008 R2. The Event Viewer allows you to view information that is stored 
in various log ﬁ les that are maintained by the operating system. This list of logs includes 
the following:
  Application   Stores messages generated by programs running on your system. For 
example, SQL Server 2008 R2 might report the completion of a database backup job 
within the Application log. 
 Security   Contains security - related information, as deﬁ ned by your auditing settings. For 
example, you could see when users have logged onto the system or when particularly 
sensitive ﬁ les have been accessed. 
  System   Contains operating system – related information and messages. Common 
messages might include a service startup failure or information about when the 
operating system was last rebooted. 
  Directory Service   Stores messages and events related to how Active Directory 
functions. For example, details related to replication might be found here.  
  DNS Server   Contains details about the operations of the DNS service. This log is useful 
for troubleshooting replication or name - resolution problems.  
  Other Log Files   Contain various features of Windows Server 2008 R2 and the 
applications that may run on this operating system that can create additional types of 
logs. These ﬁ les allow you to view more information about other applications or services 
through the familiar Event Viewer tool.  
 Additionally, developers can easily send custom information from their programs to the 
Application log. Having all of this information in one place really makes it easy to analyze 
operating system and application messages. Also, many third - party tools and utilities are 
available for analyzing log ﬁ les. 
 Although the Event Viewer GUI does a reasonably good job of letting you ﬁ nd the 
information you need, you might want to extract information to analyze other systems or 
applications. One especially useful feature of the Event Viewer is its ability to save the log 
ﬁ le in various formats. You can access this feature by clicking Action   Save As. You ’ ll 
be given the option of saving in various formats, including tab -  and comma - delimited 
text ﬁ les. You can then open these ﬁ les in other applications (such as Microsoft Excel) for 
additional data analysis. 
 Overall, in the real world, the Event Viewer can be an excellent resource for monitoring 
and troubleshooting your important servers and workstations! 

 In addition to providing information about the status of events related to Active 
Directory, the Event Viewer shows you useful information about other system services and 
applications. You should routinely use the tool.  
 Using Active Directory Administrative Tools 
 After a server has been promoted to a domain controller, you will see various tools added 
to the Administrative Tools program group (see Figure 3.2). 
 These include the following:  
 Active Directory Administrative Center   This is a new Microsoft Management Console 
(MMC) snap - in that allows you to accomplish many Active Directory tasks from one 
central location. This MMC snap - in allows you to manage your directory services objects, 
including the following: 
 
  Reset user passwords 
 
  Create or manage user accounts  
 
  Create or manage groups  
 
  Create or manage computer accounts  
 
  Create or manage organizational units (OUs) and containers  
 
  Connect to one or several domains or domain controllers in the same instance of 
Active Directory Administrative Center 
 
  Filter Active Directory data  
 Active Directory Domains and Trusts   Use this tool to view and change information 
related to the various domains in an Active Directory environment. This MMC snap - in 
also allows you to set up shortcut trusts.  
 Active Directory Sites and Services   Use this tool to create and manage Active Directory 
sites and services to map to an organization ’ s physical network infrastructure. Sites and 
services are covered in detail in Chapter 4.  
 Active Directory Users and Computers   User and computer management is fundamental 
for an Active Directory environment. The Active Directory Users and Computers tool 
allows you to set machine - and user - speciﬁ c settings across the domain. This tool is 
discussed throughout many chapters in this book.  
 Active Directory Module for Windows PowerShell   Windows PowerShell is a command -
 line shell and scripting language. New to Windows Server 2008 R2, the Active 
Directory Module for Windows PowerShell is a   group of cmdlets used to manage your 
Active Directory domains, Active Directory Lightweight Directory Services (AD LDS) 
conﬁ guration sets, and Active Directory Database Mounting Tool instances in a single, 
self - contained package.  
Verifying Active Directory Installation 
117

118 
Chapter 3  Active Directory Planning and Installation
 F I G U R E 3 . 2 Some of the many Windows Server 2008 administrative tools 
 F I G U R E 3 . 3 Viewing Active Directory information using the Active Directory Users 
and Computers tool 

 A good way to make sure that Active Directory is accessible and functioning properly 
is to run the Active Directory Users And Computers tool. When you open the tool, you 
should see a conﬁ guration similar to that shown in Figure 3.3. Speciﬁ cally, you should 
make sure that the name of the domain you created appears in the list. You should also 
click the  Domain Controllers folder and ensure that the name of your local server appears 
in the right pane. If your conﬁ guration passes these two checks, Active Directory is present 
and conﬁ gured.  
 Testing from Clients 
 The best test of any solution is to simply verify that it  works the way you had intended in 
your environment. When it comes to using Active Directory, a good test is to ensure that 
clients can view and access the various resources presented by Windows Server 2008 R2 
domain controllers. In the following sections, you ’ ll look at several ways to verify that 
Active Directory is functioning properly. 
 Verifying Client Connectivity 
 Perhaps the most relevant way to test Active Directory is by testing client operations. Using 
computers running previous versions of Windows (such as Windows NT 4 or Windows 
95/98), you should be able to see your server on the network. Earlier versions of Windows -
 based clients should recognize the NetBIOS name of the domain controller. Windows 2000 
and newer computers should also be able to see resources in the domain, and users should 
be able to browse for resources using the My Network Places icon. 
 If you are unable to see the recently promoted server on the network, there is likely a 
network conﬁ guration error. If only one or a few clients are unable to see the machine, the 
problem is probably related to client - side conﬁ guration. To ﬁ x this, make sure the client 
computers have the appropriate TCP/IP conﬁ guration (including DNS server settings) and 
that they can see other computers on the network. 
 If the new domain controller is unavailable from any of the other client computers, you 
should verify the proper startup of Active Directory using the methods mentioned earlier in 
this chapter. If Active Directory has been started, ensure that the DNS settings are correct. 
Finally, test network connectivity between the server and the clients by accessing the My 
Network Places icon.  
 Joining a Domain 
 If Active Directory has been properly conﬁ gured, clients and other servers should be able 
to join the domain. Exercise 3.4 outlines the steps you need to take to join a Windows 7 
computer to the domain. 
 In order to complete this exercise, you must have already installed and properly 
conﬁ gured at least one Active Directory domain controller and a DNS server that supports 
SRV records in your environment. In addition to the domain controller, you need at least 
one other computer, not conﬁ gured as a domain controller, running one of the following 
Verifying Active Directory Installation 
119

120 
Chapter 3  Active Directory Planning and Installation
operating systems: Windows 2000, Windows XP Professional (Windows XP Home Edition 
cannot join a domain), Vista, Windows 7, Windows Server 2003, or Windows Server 2008. 
 Once clients are able to successfully join the domain, they should be able to view 
Active Directory resources using the My Network Places icon. This test validates the 
proper functioning of Active Directory and ensures that you have connectivity with client 
computers.   
 E X E R C I S E  3 . 4
Joining a Computer to an Active Directory Domain  
 1. 
  Right - click the Computer icon on the Start menu and click Properties. 
 2. 
  Go to the section called Computer Name, Domain, And Workgroup Settings. On the 
right - hand side, click the Change Settings link. 
 3. 
  Next to the section To Rename This Computer Or Change Its Domain Or Workgroup, 
click the Change button.  
 4. 
  In the Member Of section, choose the Domain option. Type the name of the Active 
Directory domain that this computer should join. Click OK. 
 5. 
  When prompted for the username and password of an account that has permission to 
join computers to the domain, enter the information for an administrator of the domain. 
Click OK to commit the changes. If joining the domain was successful, you will see a 
dialog box welcoming you to the new domain.  
 6. 
  You will be notiﬁ ed that you must reboot the computer before the changes take place. 
Select Yes when prompted to reboot. 
 
 Creating and Configuring Application 
Data Partitions 
 Organizations store many different kinds of information in various places. For the IT 
departments that support this information, it can be difﬁ cult to ensure that the right 
information is available when and where it is needed. Windows Server 2008 R2 uses a feature 
called  application data partitions , which allows systems administrators and application 
developers to store custom information within Active Directory. The idea behind application 
data partitions is that, since you already have a directory service that can replicate all kinds of 
information, you might as well use it to keep track of your own information. 
 Developing distributed applications that can, for example, synchronize information 
across an enterprise is not a trivial task. You have to come up with a way to transfer data 
between remote sites (some of which are located across the world), and you have to ensure 

that the data is properly replicated. By storing application information in Active Directory, 
you can take advantage of its storage mechanism and replication topology. Application -
 related information stored on domain controllers beneﬁ ts from having fault - tolerance 
features and availability. 
 Take a look at the following simple example to understand how this can work. Suppose 
your organization has developed a customer Sales Tracking and Inventory application. The 
company needs to make the information that is stored by this application available to all 
of its branch ofﬁ ces and users located throughout the world. However, the goal is to do 
this with the least amount of IT administrative effort. Assuming that Active Directory has 
already been deployed throughout the organization, developers can build support into the 
application for storing data within Active Directory. They can then rely on Active Directory 
to store and synchronize the information among various sites. When users request updated 
data from the application, the application can obtain this information from the nearest 
domain controller that hosts a replica of the Sales Tracking and Inventory data. 
 Other types of applications can also beneﬁ t greatly from the use of application data 
partitions. Now that you have a good idea of what application data partitions are, let ’ s take 
a look at how you can create and manage them using Windows Server 2008 R2 and Active 
Directory. 
 Creating Application Data Partitions 
 By default, after you create an Active Directory environment, you will not have any 
customer application data partitions. Therefore, the ﬁ rst step in making this functionality 
available is to create a new application data partition. You can use several tools to do this:  
 Third - Party Applications or Application - Specific Tools   Generally, if you are planning to 
install an application that can store information in the Active Directory database, you ’ ll 
receive some method of administering and conﬁ guring that data along with the application. 
For example, the setup process for the application might assist you in the steps you need to 
take to set up a new application data partition and to create the necessary structures for 
storing data.  
 The creation and management of application data partitions is an 
advanced Active Directory – related function. Be sure that you have a 
solid understanding of the Active Directory schema, Active Directory 
replication, LDAP, and your applications ’ needs before you attempt to 
create new application data partitions in a live environment.  
 Active Directory Service Interfaces   ADSI is a set of programmable objects that can be 
accessed through languages such as Visual Basic Scripting Edition (VBScript), Visual C#, 
Visual Basic .NET, and many other language technologies that support the Component 
Object Model (COM) standard. Through the use of ADSI, developers can create, access, 
and update data stored in Active Directory and in any application data partitions.  
Creating and Configuring Application Data Partitions 
121

122 
Chapter 3  Active Directory Planning and Installation
  The LDP Tool   You can view and modify the contents of the Active Directory schema 
using LDAP - based queries. The LDP tool allows you to view information about application 
data partitions. In order to use this utility, you must ﬁ rst install the Windows Server 2008 
R2 Support Tools. The installer for this collection of utilities is located within the Windows 
Server 2008 R2 installation media in the  \Support\Tools folder. You ’ ll need to run the 
 SupTools.msi ﬁ le in order to install the tools. Once the installation is complete, you can 
access the utility by clicking Start   Run and typing   ldp.exe . Figure 3.4 shows an example 
of connecting to a domain controller and browsing Active Directory information. For 
further details on using LDP, click the Support Tools Help icon (located within the  Windows 
Support Tools program folder in the Start menu). Additional details about working with 
the LDP tool are also available in the  LDP.doc ﬁ le, which is located within the folder into 
which you installed the Support Tools.  
 F I G U R E 3 . 4 Using the LDP tool to view Active Directory schema information.
Note: This tool isn ’ t released for Server 2008 and the current screenshot is from 2003.
 
  ntdsutil  The  ntdsutil utility is the main method by which systems administrators 
create and manage application data partitions on their Windows Server 2008 domain 
controllers. This utility ’ s speciﬁ c commands are covered later in this chapter.  

 Creating and managing application data partitions can be fairly complex; 
such a project ’ s success depends on the quality of the architecture design. 
This is a good example of where IT staff and application developers must 
cooperate to ensure that data is stored effectively and that it is replicated 
efficiently.  
 You can create an application data partition in one of three different locations within an 
Active Directory forest: 
 
  As a new tree in an Active Directory forest  
 
  As a child of an Active Directory domain partition 
 For example, you can create an Accounting application data partition within the 
 Finance.MyCompany.com  domain.  
 
  As a child of another application data partition  
 This method allows you to create a hierarchy of application data partitions. 
 As you might expect, you must be a member of the Enterprise Admins or Domain 
Admins group in order to be able to create application data partitions. Alternatively, you 
can be delegated the appropriate permissions to create new partitions. 
 Now that you have a good idea of the basic ways in which you can create application 
data partitions, let ’ s look at how replicas (copies of application data partition information) 
are handled.  
 Managing Replicas 
 A replica is a copy of any data stored within Active Directory. Unlike the basic information 
that is stored in Active Directory, application partitions cannot contain security principals. 
Also, not all domain controllers automatically contain copies of the data stored in an 
application data partition. Systems administrators can deﬁ ne which domain controllers 
host copies of the application data. This is a very important feature, since, if replicas are 
used effectively, administrators can ﬁ nd a good balance between replication trafﬁ c and 
data consistency. For example, suppose that 3 of your organization ’ s 30 locations require 
up - to - date accounting - related information. You might choose to replicate the data only to 
domain controllers located in the places that require the data. Limiting replication of this 
data reduces network trafﬁ c. 
 Replication is the process by which replicas are kept up to date. Application data can be 
stored and updated on designated servers, the same way basic Active Directory information 
(such as users and groups) is synchronized between domain controllers. Application data 
partition replicas are managed using the Knowledge Consistency Checker (KCC), which 
ensures that the designated domain controllers receive updated replica information. 
Additionally, the KCC uses all Active Directory sites and connection objects (covered in 
Chapter 4) that you create to determine the best method to handle replication.  
Creating and Configuring Application Data Partitions 
123

124 
Chapter 3  Active Directory Planning and Installation
 Removing Replicas 
 When you perform  demotion on a domain controller, that server can no longer host an 
application data partition. If a domain controller contains a replica of application data 
partition information, you must remove the replica from the domain controller before you 
demote it. If a domain controller is the machine that hosts a replica of the application data 
partition, then the entire application data partition is removed and will be permanently 
lost. Generally, you want to do this only after you ’ re absolutely sure that your organization 
no longer needs access to the data stored in the application data partition. 
 Using ntdsutil to Manage Application Data Partitions 
 The primary method by which systems administrators create and manage application data 
partitions is through the  ntdsutil command - line tool. You can launch this tool by simply 
entering   ntdsutil  at a command prompt. The  ntdsutil command is both interactive and 
context sensitive. That is, once you launch the utility, you ’ ll see an  ntdsutil command 
prompt. At this prompt, you can enter various commands that set your context within the 
application. For example, if you enter the  domain management command, you ’ ll be able to 
use domain - related commands. Several operations also require you to connect to a domain, 
a domain controller, or an Active Directory object before you perform a command.  
 For complete details on using  ntdsutil , see the Windows Server 2008 
R2 Help and Support Center. 
 Table 3.2 provides a list of the domain management commands supported by the 
 ntdsutil tool. You can access this information by typing the following sequence of 
commands at a command prompt.   
ntdsutil
 domain management 
help 
 ntdsutil  Domain Management Command  
  Purpose  
 Help or  ? 
  Displays information about the 
commands that are available within 
the Domain Management menu of the 
 ntdsutil command.  
 Connection  or  Connections 
 Allows you to connect to a specific 
domain controller. This will set the 
context for further operations that 
are performed on specific domain 
controllers.  
TA B L E 3 . 2 ntdsutil domain management commands

 Figure 3.5 provides an example of working with  ntdsutil . The following commands 
were entered to set the context for further operations: 
ntdsutil
domain management
connections
 ntdsutil  Domain Management Command  
  Purpose  
 Create NC
 PartitionDistinguishedName 
DNSName  
 Creates a new application directory 
partition.  
 Delete NC
 PartitionDistinguishedName  
 Removes an application data partition. 
 List NC Information
 PartitionDistinguishedName  
 Shows information about the specified 
application data partition.  
 List NC Replicas
 PartitionDistinguishedName  
 Returns information about all replicas 
for the specific application data partition.  
 Precreate
 PartitionDistinguishedName
ServerDNSName  
 Precreates cross - reference application 
data partition objects. This allows the 
specified DNS server to host a copy of 
the application data partition.  
 Remove NC Replica  
PartitionDistinguishedName 
DCDNSName  
 Removes a replica from the specified 
domain controller. 
 Select Operation Target  
  Selects the naming context that will be 
used for other operations.  
 Set NC Reference Domain 
 PartitionDistinguishedName 
DomainDistinguishedName 
 Specifies the reference domain for an 
application data partition.  
 Set NC Replicate 
NotificationDelay 
 PartitionDistinguishedName 
FirstDCNotificationDelay 
OtherDCNotificationDelay 
 Defines settings for how often 
replication will occur for the specified 
application data partition.  
 The  ntdsutil commands are all case insensitive. Mixed - case was used in the table to make them easier to read. 
 NC in commands stands for  “ naming context, ” referring to the fact that this is a partition of the Active Directory 
schema.  
Creating and Configuring Application Data Partitions 
125

126 
Chapter 3  Active Directory Planning and Installation
connect to server localhost
connect to domain ADTest
quit
list 
 F I G U R E 3 . 5 Viewing naming contexts on the local domain controller 
 Configuring DNS Integration 
with Active Directory 
 There are many beneﬁ ts to integrating Active Directory and DNS services: 
 
  You can configure and manage replication along with other Active Directory components.  
 
  You can automate much of the maintenance of DNS resource records through the use 
of dynamic updates.  
 
 You will be able to set specific security options on the various properties of the DNS service.  
 Exercise 3.5 shows the steps that you can take to ensure that these integration features 
are enabled. You ’ ll look at the various DNS functions that are speciﬁ c to interoperability 
with Active Directory. 
 Before you begin this exercise, make sure that the local machine is conﬁ gured as an 
Active Directory domain controller and that DNS services have been properly conﬁ gured. 
If you instructed the Active Directory Installation Wizard to automatically conﬁ gure DNS, 
many of the settings mentioned in this section may already be enabled. However, you 
should verify the conﬁ guration and be familiar with how the options can be set manually.   

 E X E R C I S E  3 . 5
Configuring DNS Integration with Active Directory  
 1. 
  Open the DNS snap - in from the Administrative Tools program group.  
 2. 
  Right - click the icon for the local DNS Server, and select Properties. Click the 
Security tab. Notice that you can now specify which users and groups have access 
to modify the conﬁ guration of the DNS server. Make any necessary changes, and 
click OK.  
 3. 
  Expand the local server branch and the Forward Lookup Zones folder.  
 4. 
  Right - click the name of the Active Directory domain you created, and select 
Properties. 
 5. 
  On the General tab, verify that the type is Active Directory - Integrated and that the 
Data Is Stored In Active Directory message is displayed. If this option is not currently 
selected, you can change it by clicking the Change button next to Type and choosing the 
Store The Zone In Active Directory check box on the bottom.  
Configuring DNS Integration with Active Directory 
127

128 
Chapter 3  Active Directory Planning and Installation
E X E R C I S E  3 . 5  (c o n t i n u e d)
 6. 
  Verify that the Dynamic Updates option is set to Secure Only. This ensures that all 
updates to the DNS resource records database are made through authenticated Active 
Directory accounts and processes. 
  The other options are Nonsecure And Secure (accepts all updates) and None (to 
disallow dynamic updates).  
 7. 
  Finally, notice that you can deﬁ ne the security permissions at the zone level by clicking 
the Security tab. Make any necessary changes, and click OK.  
 
 Summary 
 In this chapter, we covered the basics of implementing an Active Directory forest and 
domain structure, creating and conﬁ guring application data partitions, and setting the 
functional level of your domain and forest. 
 You are now familiar with how you can implement Active Directory. We carefully 
examined all the necessary steps and conditions you need to follow to install Active 
Directory on your network. First, you need to prepare for the Domain Name System (DNS) 
since Active Directory cannot be installed without the support of a DNS server. 
 You also need to verify that the computer you upgrade to a domain controller (DC) 
meets some basic ﬁ lesystem and network connectivity requirements so that Active 

Directory can run smoothly and efﬁ ciently in your organization. These are some of the 
most common things you will have to do when you deploy Active Directory. 
 We also covered the concept of domain functional levels, which essentially determine 
the kinds of domain controllers you can use in your environment. For instance, in the 
Windows 2000 functional level, you can include Server 2008 R2, 2008, 2003 Server, and 
2000 Server domain controllers, but the functionality of the domain is severely limited. 
 In this chapter, you also learned to install Active Directory, which you accomplish by 
promoting a Windows Server 2008 R2 computer to a domain controller using DCPROMO. 
You also learned how to verify the installation by testing Active Directory from a client 
computer. 
 This chapter was limited in scope to examining the issues related to installing and 
conﬁ guring the ﬁ rst domain in an Active Directory environment. In later chapters, you ’ ll 
see how to create and manage more complex conﬁ gurations.  
 Exam Essentials  
 Know the prerequisites for promoting a server to a domain controller.   You should 
understand the tasks that you must complete before you attempt to upgrade a server to a 
domain controller. Also, you should have a good idea of the information you need in order 
to complete the domain controller promotion process.  
 Understand the steps of the Active Directory Installation Wizard (DCPROMO).   When 
you run the Active Directory Installation Wizard, you ’ ll be presented with many different 
choices. You should understand the effects of the various options provided in each step of 
the wizard. 
 Be familiar with the tools that you will use to administer Active Directory.   Three main 
administrative tools are installed when you promote a Windows Server 2008 to a domain 
controller. Be sure you know which tools to use for which types of tasks.  
 Understand the purpose of application data partitions.   The idea behind application data 
partitions is that, since you already have a directory service that can replicate all kinds of 
security information, you can also use it to keep track of application data. The main beneﬁ t 
of storing application information in Active Directory is that you can take advantage of 
its storage mechanism and replication topology. Application - related information stored on 
domain controllers beneﬁ ts from having fault - tolerance features and availability.  
Exam Essentials 
129

130 
Chapter 3  Active Directory Planning and Installation
 Review Questions  
 1. 
  You are the systems administrator of a large organization that has recently implemented 
Windows Server 2008 R2. You have a few remote sites that do not have very tight security. 
You have decided to implement read - only domain controllers (RODC). What forest and 
function levels does the network need for you to do the install? (Choose all that apply.)  
 A.   Windows 2000 Mixed  
 B.   Windows 2008 R2  
 C.   Windows 2003  
 D.   Windows 2008  
 2. 
  What is the maximum number of domains that a Windows Server 2008 R2 computer, 
configured as a domain controller, may participate in at one time?  
 A.   Zero  
 B.   One 
 C.   Two  
 D.   Any number of domains  
 3. 
 A systems administrator is trying to determine which filesystem to use for a server that 
will become a Windows Server 2008 file server and domain controller. His company ’ s 
requirements include the following:  
 
  The filesystem must allow for file - level security from within Windows 2008 
Server.  
 
  The filesystem must make efficient use of space on large partitions.  
 
  The domain controller SYSVOL must be stored on the partition.  
 Which of the following ﬁ lesystems meets these requirements?  
 A.   FAT  
 B.   FAT32  
 C.   HPFS  
 D.   NTFS  
 4. 
  For security reasons, you have decided that you must convert the system partition on your 
Windows Server 2008 R2 from the FAT32 filesystem to NTFS. Which of the following 
steps must you take in order to convert the filesystem? (Choose two.)  
 A.   Run the command  CONVERT /FS:NTFS  from the command prompt.  
 B.   Rerun Windows Server 2008 R2 Setup and choose to convert the partition to NTFS 
during the reinstallation.  
 C.   Boot Windows Server 2008 R2 Setup from the installation CD - ROM and choose 
Rebuild File System.  
 D.   Reboot the computer.  

Review Questions 
131
 5. 
  Windows Server 2008 R2 requires the use of which of the following protocols or services in 
order to support Active Directory? (Choose two.)  
 A.   DHCP  
 B.   TCP/IP  
 C.   NetBEUI  
 D.   IPX/SPX  
 E. 
  DNS  
 6. 
 You are promoting a Windows Server 2008 R2 computer to an Active Directory domain 
controller for test purposes. The new domain controller will be added to an existing 
domain. While you are using the Active Directory Installation Wizard, you receive an error 
message that prevents the server from being promoted. Which of the following might be the 
cause of the problem? (Choose all that apply.)  
 A.   The system does not contain an NTFS partition on which the SYSVOL directory can 
be created. 
 B.   You do not have a Windows Server 2008 R2 DNS server on the network.  
 C.   The TCP/IP configuration on the new server is incorrect.  
 D.   The domain has reached its maximum number of domain controllers.  
 7. 
  You are installing the first domain controller in your Active Directory environment. What 
command do you run in order to begin the Active Directory Installation Wizard?  
 A.   DCPromote.exe 
 B.   DomainPromote.exe 
 C.   DCPromo.exe 
 D.   Promote.exe 
 8. 
 You are the network administrator for a large company that creates widgets. You are asked 
by management to implement a new Windows Server 2008 R2 system. You need to implement 
federated identity management. Which of the following will help you do this?  
 A.   Active Directory Federation Services  
 B.   Active Directory DNS Services  
  C.   Active Directory IIS Services  
 D.   Active Directory IAS Services  

132 
Chapter 3  Active Directory Planning and Installation
  9. 
  You are the systems administrator responsible for your company ’ s infrastructure. You 
think you have an issue with name resolution and you need to verify that you are using 
the correct hostname. You want to test DNS on the local system and need to see if the 
hostname server - 1 resolves to the IP address  10.1.1.1 . Which of the following actions 
provides a solution to the problem?  
 A.   Add a DNS server to your local subnet.  
 B.   Add the mapping for the hostname server - 1 to the IP address  10.1.1.1  in the local 
system ’ s  HOSTS  file.  
 C.   Add an A record to your local WINS server.  
 D.   Add an MX record to your local DNS server.  
 10.   You have one Active Directory forest in your organization that contains one domain named 
 Stellacon.com . You have two domain controllers configured with the DNS role installed. 
There are two Active Directory Integrated zones named  stellacon.com and  stellatest
.com . One of your IT members (who is not an administrator) needs to be able to modify 
the  Stellacon.com  DNS server, but you need to prevent this user from modifying the 
 Stellatest.com  SOA record. How do you accomplish this?  
 A.   Modify the permissions of stellacon.com zone from the DNS Manager snap - in.  
 B.   Modify the permissions of stellatest.com zone from the DNS Manager snap - in.  
 C.   Run the Delegation of Control Wizard in Active Directory.  
 D.   Run the Delegation of Control Wizard in the DNS snap - in.  
  

 Answers to Review Questions 
 1. 
B, C, D .  The forest and function levels have to be Windows 2003 or above to install 
an RODC. 
 2. 
B . A domain controller can contain Active Directory information for only one domain. 
If you want to use a multidomain environment, you must use multiple domain controllers 
conﬁ gured in either a tree or forest setting. 
 3. 
D .  NTFS has ﬁ le - level security and makes efﬁ cient usage of disk space. Since this machine 
is to be conﬁ gured as a domain controller, the conﬁ guration requires at least one NTFS 
partition in order to store the SYSVOL information.  
 4. 
A, D .  In order to convert the system partition to NTFS, you must ﬁ rst use the  CONVERT 
command - line utility and then reboot the server. During the next boot, the ﬁ lesystem will 
be converted.  
 5. 
B, E . The use of LDAP and TCP/IP is required to support Active Directory. TCP/IP is 
the network protocol favored by Microsoft, which determined that all Active Directory 
communication would occur on TCP/IP. DNS is required because Active Directory 
is inherently dependent on the domain model. DHCP is used for automatic address 
assignment and is not required. Similarly, NetBEUI and IPX/SPX are not available network 
protocols in Windows Server 2008 R2. 
 6. 
A, C .  The SYSVOL directory must be created on an NTFS partition. If such a partition is 
not available, you will not be able to promote the server to a domain controller. An error 
in the network conﬁ guration might prevent the server from connecting to another domain 
controller in the environment.  
 7. 
C . You use  DCPromo.exe  to begin the process of promoting or demoting a server to/from a 
domain controller. 
 8. 
A . You ’ ll need to use Active Directory Federation Services (AD FS) in order to implement 
federated identity management. Federated identity management is a standards - based 
technology and information technology process that will enable distributed identiﬁ cation, 
authentication, and authorization across organizational and platform boundaries. The 
AD FS solution in Windows Server 2008 helps administrators address these challenges by 
enabling organizations to securely share a user ’ s identity information. 
 9. 
B .  The  HOSTS ﬁ le is a text ﬁ le - based database of mappings between hostnames and IP 
addresses. It works like a ﬁ le - based version of DNS. DNS resolves a hostname to an IP address.  
 10. A .  You only need to give them rights to the  stellacon.com  zone using the DNS snap - in. If 
they do not have any rights to the  stellatest.com  zone, they will not be able to conﬁ gure 
this zone in any way. 
Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at 
 www.sybex.com/go/mctswindows2008r2. 
Answers to Review Questions 
133


Installing and 
Managing Trees 
and Forests  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring the Active Directory Infrastructure  
 Configure a forest or a domain. May include but is not limited 
to: remove a domain; perform an unattended installation; 
change forest and domain functional levels; interoperability 
with previous versions of Active Directory; multiple user 
principal name (UPN) suffixes; forestprep; domainprep.  
 Configure trusts. May include but is not limited to: forest 
trust; selective authentication vs. forest - wide authentication; 
transitive trust; external trust; shortcut trust; SID filtering.  
 Configure the global catalog. May include but is not limited 
to: Universal Group Membership Caching (UGMC); partial 
attribute set; promote to global catalog.  
 Configure operations masters. May include but is not limited 
to: seize and transfer; backup operations master; operations 
master placement; Schema Master; extending the schema; 
time service.  





 Chapter 
4

 So far, you have seen the steps you need to take to install the 
Domain Name System (DNS) and to implement the ﬁ rst Active 
Directory domain. Although we brieﬂ y introduced you to 
multidomain Active Directory structures earlier, we focused on only a single domain and 
the objects within it. 
 Many businesses ﬁ nd that using a single domain provides an adequate solution to meet 
their business needs. By working with  trees and  forests , however, organizations can use 
multiple domains to better organize their environments. 
 This chapter begins by covering some reasons why you should create more than one 
Active Directory domain. Then it moves on to look at the exact processes involved in 
creating a domain tree and in joining multiple trees together into a domain forest. 
In addition, you learn how to demote a domain controller and manage multiple 
domains after you ’ ve created trees and forests.  
 Reasons for Creating Multiple Domains 
 Before you look at the steps you must take to create multiple domains, become familiar 
with the reasons why an organization might want to create them. 
 In general, you should always try to reﬂ ect your organization ’ s structure within a single 
domain. By using organizational units (OUs) and other objects, you can usually create an 
accurate and efﬁ cient structure within one domain. Creating and managing a single 
domain is usually much simpler than managing a more complex environment consisting 
of multiple domains. 
 That said, you should familiarize yourself with some real beneﬁ ts and reasons for 
creating multiple domains as well as some drawbacks of using them. 
 Reasons for Using Multiple Domains 
 You might need to implement multiple domains for several reasons. These reasons include 
the following considerations:  
 Scalability   Although Microsoft has designed Active Directory to accommodate millions 
of objects, this may not be practical for your current environment. Supporting thousands of 
users within a single domain requires more disk space, greater CPU (central processing 
unit) usage, and additional network burdens on your  domain controllers (computers 
containing Active Directory security information). To determine the size of Active 

Directory domain your network can support, you need to plan, design, test, and analyze 
within your own environment.  
 Reducing Replication Traffic   All the domain controllers in a domain must keep an 
up - to - date copy of the entire Active Directory database. For small - to medium - sized 
domains, this is not generally a problem. Windows Server 2008 R2 and Active Directory 
manage all the details of transferring the database behind the scenes. Other business and 
technical limitations might, however, affect Active Directory ’ s ability to perform adequate 
replication. For example, if you have two sites that are connected by a very slow network 
link (or a sporadic link, or no link at all), replication is not practical. In this case, you 
would probably want to create separate domains to isolate replication trafﬁ c. Sporadic 
coverage across the wide area network (WAN) link would come from circuit - switching 
technologies such as Integrated Services Digital Network (ISDN) technologies. If you 
didn ’ t have a link at all, then you would have a service provider outage or some other 
type of disruption. Separate domains mean separate replication trafﬁ c, but the amount of 
administrative overhead is increased signiﬁ cantly. 
 Because it ’ s common to have WAN links in your business environment, you will always 
need to consider how your users authenticate to a domain controller (DC). DCs at a remote 
site are commonly seen to authenticate users locally to their local area network (LAN). 
The most common design involves putting a DC at each remote site to keep authentication 
traffic from traversing the WAN. If it is the other way around, the authentication traffic 
may cause users problems if WAN utilization is high or if the link is broken and no other 
way to the central site is available. The design you are apt to see most often is one in which 
each server replicates its database of information to each other server so that the network 
and its systems converge. 
 However, it ’ s important to realize that the presence of slow WAN links alone is  not a good 
reason to break an organization into multiple domains. The most common solution is to 
set up site links with the Site and Services Microsoft Management Console (MMC). When 
you use this MMC, you can manage replication traffic and fine - tune independently of the 
domain architecture. We ’ ll cover these topics in detail in Chapter 5,  “ Configuring Sites 
and Replication. ”  
 The following are the reasons why you would want to use a multidomain architecture, 
such as when two companies merge through an acquisition.  
 Meeting Business Needs   Several business needs might justify the creation of multiple 
domains. Business needs can be broken down even further into organizational and 
political needs. 
 One of the organizational reasons for using multiple domains is to avoid potential 
problems associated with the Domain Administrator account. At least one user needs 
to have permissions at this level. If your organization is unable or unwilling to trust a 
single person to have this level of control over all business units, then multiple domains 
may be the best answer. Since each domain maintains its own security database, you can 
keep permissions and resources isolated. Through the use of trusts, however, you can still 
share resources. 
Reasons for Creating Multiple Domains 
137

138 
Chapter 4  Installing and Managing Trees and Forests
 A political need for separate domains might arise if you had two companies that merged 
with two separate but equal management staffs and two sets of officers. In such a situation, 
you might need to have Active Directory split into two separate databases to keep the 
security of the two groups separate. Some such organizations may need to keep the internal 
groups separate by law. A multidomain architecture provides exactly this type of pristinely 
separate environment.  
  Many Levels of Hierarchy   Larger organizations tend to have very complex internal and 
external business structures that dictate the need for many different levels of organization. 
For example, two companies might merge and need to keep two sets of ofﬁ cers who 
are managed under two different logical groupings. As you will see in Chapter 7, 
 “ Administering Active Directory, ” you can use OUs to help group different branches of 
the company so that you can assign permissions, or delegations, or whatever else you can 
think of without affecting anyone else. Managing data becomes much easier when you ’ re 
using OUs, and if you design them correctly, OUs will help you control your network 
right from one console. You may need only one level of management — your company 
may be small enough to warrant the use of the default OU structure you see when Active 
Directory is ﬁ rst installed. If, however, you ﬁ nd that you need many levels of OUs to 
manage resources (or if large numbers of objects exist within each OU), it might make 
sense to create additional domains. Each domain would contain its own OU hierarchy 
and serve as the root of a new set of objects.  
  Decentralized Administration   Two main models of administration are commonly used: 
a centralized administration model and a decentralized administration model. In the 
centralized administration model, a single IT organization is responsible for managing 
all of the users, computers, and security permissions for the entire organization. In the 
decentralized administration model, each department or business unit might have its own 
IT department. In both cases, the needs of the administration model can play a signiﬁ cant 
role in whether you decide to use multiple domains. 
 Consider, for example, a multinational company that has a separate IT department for 
offices in each country. Each IT department is responsible for supporting only the users and 
computers within its own region. Since the administration model is largely decentralized, 
creating a separate domain for each of these major business units might make sense from a 
security and maintenance standpoint.  
  Multiple DNS or Domain Names   Another reason you may need to use a multidomain 
architecture is if you want or plan to use multiple DNS names within your organization. If 
you use multiple DNS names or domain names, you must create multiple Active Directory 
domains. Each AD domain can have only one fully qualiﬁ ed domain name (FQDN). An 
FQDN is the full name of a system that consists of a local host, a second - level domain 
name, and a top - level domain (TLD). For example,  www.stellacon.com is an FQDN,  .com 
is the TLD,  www is the host, and  stellacon is the second - level domain name.  
  Legality   One ﬁ nal reason you may need to use a multidomain architecture is legality 
within your organization. Some corporations have to follow state or federal regulations and 
laws. For this reason, they may have to have multiple domains.  

 Drawbacks of Multiple Domains 
 Although there are many reasons why it makes sense to have multiple domains, there are 
also reasons why you should not break an organizational structure into multiple domains, 
many of which are related to maintenance and administration. Here are some of the 
drawbacks to using multiple domains:  
 Administrative Inconsistency   One of the fundamental responsibilities of most systems 
administrators is implementing and managing security. When you are implementing Group 
Policy and security settings in multiple domains, you want to be careful to ensure that 
the settings are consistent. In Windows Server 2008 R2, security policies can be different 
between and within the same domains. If this is what the organization intended, then it is 
not a problem. If, however, an organization wishes to make the same settings apply to all 
users, then each domain requires similar security settings.  
 Increased Management Challenges   Managing servers, users, and computers can become 
a considerable challenge when you are also managing multiple domains, because many 
more administrative units are required. In general, you need to manage all user, group, 
and computer settings separately for the objects within each domain. The hierarchical 
structure provided by OUs, on the other hand, provides a much simpler and easier way 
to manage permissions.  
 Decreased Flexibility   Creating a domain involves the  promotion of a DC to the 
new domain. Although the process is quite simple, it is much more difﬁ cult to rearrange 
the domain topology within an Active Directory environment than it is to simply 
reorganize OUs. When planning domains, you should ensure that the domain structure 
will not change often, if at all.  
 Now that you have examined the pros and cons related to creating multiple domains, it 
is time to see how to create trees and forests.  
 Creating Domain Trees and Forests 
 So far this chapter has covered some important reasons for using multiple domains in a 
single network environment; now it ’ s time to look at how to create multidomain structures 
like domain trees and domain forests. 
 Regardless of the number of domains you have in your environment, you always have 
a tree and a forest. This might surprise those of you who generally think of domain trees 
and forests as belonging only to Active Directory environments that consist of multiple 
domains. However, recall that when you install the ﬁ rst domain in an Active Directory 
environment, that domain automatically creates a new forest and a new tree. 
 In the following sections, you will learn how to plan trees and forests as well as see how 
to promote domain controllers to establish a tree and forest environment. 
Creating Domain Trees and Forests 
139

140 
Chapter 4  Installing and Managing Trees and Forests
 Planning Trees and Forests 
 You have already seen several reasons why you might want to have multiple domains 
within a single company. What you haven ’ t yet seen is how multiple domains can be related 
to each other and how their relationships can translate into domain forests and trees. 
 A fundamental commonality between the various domains that exist in trees and forests 
is that they all share the same Active Directory Global Catalog (GC). This means that 
if you modify the Active Directory schema, these changes must be propagated to all of 
the domain controllers in all of the domains. This is an important point because adding 
and modifying the structure of information in the GC can have widespread effects on 
replication and network trafﬁ c. Also, you need to ensure that any system you use in the GC 
role can handle it — you might need to size up the system ’ s hardware requirements. This is 
especially true if there are multiple domains. 
 Every domain within an Active Directory conﬁ guration has its own unique name. 
For example, even though you might have a sales domain in two different trees, the 
complete names for each domain will be different (such as  sales.stellacon1.com and 
 sales.stellacon2.com ). 
 In the following sections, you ’ ll look at how you can organize multiple Active Directory 
domains based on business requirements. 
 Using a Single Tree 
 The concept of domain trees was created to preserve the relationship between multiple 
domains that share a common contiguous namespace. For example, you might have the 
following DNS domains (based on Internet names): 
 
  mycompany.com 
 
  sales.mycompany.com 
 
  engineering.mycompany.com 
 
  europe.sales.mycompany.com 
 Note that all of these domains ﬁ t within a single contiguous namespace. That is, they are 
all direct or indirect children of the  mycompany.com domain. In this case,  mycompany.com  
is called the root domain. All of the direct children (such as  sales.mycompany.com and 
 engineering.mycompany.com ) are called child domains. Finally, parent domains are 
the domains that are directly above one domain. For example,  sales.mycompany.com  
is the parent domain of  europe.sales.mycompany.com . Figure 4.1 provides an example 
of a domain tree. 
 In order to establish a domain tree, you must create the root domain for the tree ﬁ rst. 
Then you can add child domains off this root. These child domains can then serve as 
parents for further subdomains. Each domain must have at least one domain controller, 
and domain controllers can participate in only one domain at a time. However, you can 
move a domain controller from one domain to another. To do this, you must ﬁ rst demote 
a domain controller to a member server and then promote it to a domain controller in 
another domain.  

 You will learn how to demote a domain controller later in this chapter in 
the section titled  “ Demoting a Domain Controller. ” 
company.com
hr.company.com
corp.
company.com
us. corp.
company.com
Root
Domain
(Parent)
Sub-
domains
(Children)
Domain Tree
 F I G U R E 4 .1 A domain tree 
 Domains are designed to be logical boundaries. The domains within a tree are, by 
default, automatically bound together using a two - way transitive trust relationship, which 
allows resources to be shared among domains through the use of the appropriate user and 
group assignments. Because trust relationships are transitive, all of the domains within the 
tree trust each other. Note, however, that a trust by itself does not automatically grant any 
security permissions to users or objects between domains. Trusts are designed only to  allow 
resources to be shared; you must still go through the process of sharing and managing 
them. Administrators must explicitly assign security settings to resources before users can 
access resources between domains. 
 Using a single tree makes sense when your organization maintains only a single 
contiguous namespace. Regardless of the number of domains that exist within this 
environment and how different their security settings are, they are related by a common 
name. Although domain trees make sense for many organizations, in some cases the 
network namespace may be considerably more complicated. You ’ ll look at how forests 
address these situations next.  
Creating Domain Trees and Forests 
141

142 
Chapter 4  Installing and Managing Trees and Forests
 Using a Forest 
 Active Directory forests are designed to accommodate multiple noncontiguous namespaces. 
That is, they can combine domain trees together into logical units. An example might be 
the following tree and domain structure: 
 
  Tree:  Organization1.com 
 
  Sales.Organization1.com 
 
  Marketing.Organization1.com 
 
  Engineering.Organization1.com 
 
  NorthAmerica.Engineering.Organization1.com 
 
  Tree:  Organization2.com 
 
  Sales.Organization2.com 
 
  Engineering.Organization2.com 
 Figure 4.2 provides an example of how multiple trees can ﬁ t into a single forest. Such 
a situation might occur in the acquisition and merger of companies or if a company is 
logically divided into two or more completely separate and autonomous business units.  
organization1.
com
organization2.
com
engineering.
organization1.
com
sales.
organization1.
com
sales.
organization2.
com
marketing.
sales.
organization1.
com
engineering.
organization2.
com
northamerica.
engineering.
organization1.
com
Forest
Organization 1 Tree
Organization 2 Tree
  F I G U R E 4 . 2 A single forest consisting of multiple trees  

 All of the trees within a forest are related through a single forest root domain. This is 
the ﬁ rst domain that was created in the Active Directory environment. The root domain in 
each tree creates a transitive trust with the forest root domain. The result is a conﬁ guration 
in which all of the trees within a domain and all of the domains within each tree trust 
each other. Again, as with domain trees, the presence of a trust relationship does not 
automatically signify that users have permissions to access resources across domains. It 
only allows objects and resources to be shared. Authorized network administrators must 
set up speciﬁ c permissions. 
 All of the domains within a single Active Directory forest have the following features 
in common:  
 Schema   The schema is the Active Directory structure that deﬁ nes how the information 
within the data store is structured. For the information stored on various domain 
controllers to remain compatible, all of the domain controllers within the entire Active 
Directory environment must share the same schema. For example, if you add a ﬁ eld for an 
employee ’ s beneﬁ ts plan number, all domain controllers throughout the environment need 
to recognize this information before you can share information among them.  
 Global Catalog   One of the problems associated with working in large network 
environments is that sharing information across multiple domains can be costly in terms 
of network and server resources. Fortunately, Active Directory uses the Global Catalog 
(GC), which serves as a repository for information about a subset of all objects within 
 all Active Directory domains in a forest. Systems administrators can determine what 
types of information should be added to the defaults in the GC. Generally, they decide to 
store commonly used information, such as a list of all of the printers, users, groups, and 
computers. In addition, they can conﬁ gure speciﬁ c domain controllers to carry a copy of 
the GC. Now, if you have a question about, for example, where to ﬁ nd all the color printers 
in the company, all you need to do is to contact the nearest GC server.  
 Configuration Information   Some roles and functions must be managed for the 
entire forest. When you are dealing with multiple domains, this means that you must 
conﬁ gure certain domain controllers to perform functions for the entire Active Directory 
environment. We will discuss some speciﬁ cs of this later in this chapter. 
 The main purpose of allowing multiple domains to exist together is to allow them to 
share information and other resources. Now that you ’ ve seen the basics of domain trees 
and forests, take a look at how domains are actually created.  
 The Promotion Process 
 A domain tree is created when a new domain is added as the child of an existing domain. 
This relationship is established during the promotion of a Windows Server 2008 R2 
computer to a domain controller. Although the underlying relationships can be quite 
complicated in larger organizations, the  Active Directory Installation Wizard (DCPROMO) 
makes it easy to create forests and trees. 
Creating Domain Trees and Forests 
143

144 
Chapter 4  Installing and Managing Trees and Forests
 Using the Active Directory Installation Wizard, you can quickly and easily create new 
domains by promoting a Windows Server 2008 R2 stand - alone server or a member server 
to a domain controller. When you install a new domain controller, you can choose to make 
it part of an existing domain, or you can choose to make it the ﬁ rst domain controller in a 
new domain. In the following sections and exercises, you ’ ll become familiar with the exact 
steps you need to take to create a domain tree and a domain forest when you promote a 
server to a domain controller.  
 Creating a Domain Tree 
 In the previous chapter (Chapter 3,  “ Active Directory Planning and Installation ” ), you saw 
how to promote the ﬁ rst domain controller in the ﬁ rst domain in a forest, also known as 
the root. If you don ’ t promote any other domain controllers, then that domain controller 
simply controls that one domain and only one tree is created. To create a new domain 
tree, you need to promote a Windows Server 2008 R2 computer to a domain controller. 
In the Active Directory Installation Wizard, you select the option that makes this domain 
controller the ﬁ rst machine in a new domain that is a child of an existing domain. As a 
result, you will have a domain tree that contains two domains — a parent and a child. 
 Before you can create a new child domain, you need the following information: 
 
  The name of the parent domain (for the exercises, you ’ ll use the one you created in the 
previous chapter)  
 
  The name of the child domain (the one you are planning to install)  
 
 The filesystem locations for the Active Directory database, logs, and shared system volume  
 
  DNS configuration information  
 
  The NetBIOS name for the new server  
 
  A domain administrator username and password  
 Exercise 4.1 walks you through the process of creating a new child domain using the 
Active Directory Installation Wizard. This exercise assumes that you have already created 
the parent domain and that you are using a server in the domain that is not a domain 
controller.  
 E X E R C I S E  4 .1
Creating a New Subdomain 
 1. 
  Log on to the computer as a member of the Administrators group and open the Active 
Directory Installation Wizard by clicking Start   Run and typing  dcpromo . After the 
message about installing the binaries appears, a Welcome screen appears. Click Next. 
 2. 
  At the Operating System Compatibility screen, click Next.  
 3. 
  The Choose A Deployment Conﬁ guration screen appears. Click Existing Forest and then 
click Create A New Domain In An Existing Forest. Click Next. 

 4. 
  On the Network Credentials page, specify the full name of the domain that you installed 
in the previous chapter. Then click the Set button. In the new Windows Security dialog 
box that appears, enter the username and password for the domain administrator of the 
domain you wish to join.  
 5. 
  Click the OK button on the Alternate Credentials screen. The domain administrator 
account that you used in the previous chapter should now be listed.  
Creating Domain Trees and Forests 
145

146 
Chapter 4  Installing and Managing Trees and Forests
E X E R C I S E  4 .1  (c o n t i n u e d)
 6. 
  If the information you entered was correct, you will see the Name The New Domain 
page. Here, you will be able to conﬁ rm the name of the parent domain and then enter the 
domain name for the child domain. Enter the new child domain name (in the following 
example, we used  Portsmouth for a city in New Hampshire). Click Next to continue.  
 7. 
  At the Set Domain Functional Level screen, choose Windows Server 2003 and click Next.  

 8. 
  If the Select A Site screen appears, choose Default - First - Site - Name and click Next.  
 9. 
  On the Additional Domain Controller Options page, uncheck all options and click Next. 
 10.   A warning box appears stating that you have chosen not to install DNS; just click Yes.  
Creating Domain Trees and Forests 
147

148 
Chapter 4  Installing and Managing Trees and Forests
E X E R C I S E  4 .1  (c o n t i n u e d)
 11.   On the Location for Database, Log Files, and SYSVOL page, you ’ ll need to specify 
the database and log locations. These settings specify where the Active Directory 
database resides on the local machine. As mentioned previously, it is good practice 
to place the log ﬁ les on a separate physical hard disk because this increases 
performance. Enter the path for a local directory (you can also leave the defaults for 
these exercises), and click Next.  
 12.   In order to be able to recover this server in the event of a loss of Active Directory 
information, you will need to provide a password on the Directory Services Restore 
Mode Administrator Password page. This password will allow you to use the built -
 in recovery features of Windows Server 2008 in the event that the Active Directory 
database is lost or corrupted. Enter  P@ssw0rd , conﬁ rm it, and then click Next.  

 13.   On the Summary page, you will be given a brief listing of all the choices you made 
in the previous steps. It ’ s a good idea to copy this information and paste it into a text 
document for future reference. Click Next to continue.  
 14.   On the Completing the Active Directory Domain Services Installation Wizard page, 
click Finish.  
 Joining a New Domain Tree to a Forest 
 A forest is one or more trees that do not share a contiguous namespace. For example, you 
could join the  organization1.com and  organization2.com domains together to create a 
single Active Directory environment. 
 Any two trees can be joined together to create a forest, as long as the second tree is 
installed after the ﬁ rst and the trees have noncontiguous namespaces. (If the namespaces 
were contiguous, you would actually need to create a new domain for an existing tree.) The 
process of creating a new tree to form or add to a forest is as simple as promoting a server 
to a domain controller for a new domain that does  not share a namespace with an existing 
Active Directory domain.  
 The command - line tool  adprep.exe is used to prepare a Microsoft 
Windows 2003 forest or a Windows 2003 domain for the installation 
of Windows Server 2008 R2 domain controllers.  
Creating Domain Trees and Forests 
149

150 
Chapter 4  Installing and Managing Trees and Forests
 Before you promote a Windows Server 2008 R2 domain controller into a 
Windows Server 2008 or Windows 2003 forest, an administrator should 
first successfully run  adprep /forestprep on the Schema Operations 
Master and then run  adprep/domainprep on the Infrastructure Master in 
the Windows 2003 forest. The  forestprep and  domainprep processes 
prepare the Windows 2000 or 2003 network to accept the installation of the 
Windows Server 2008 R2 servers.  
 In Exercise 4.2, you will use the Active Directory Installation Wizard to create a new 
domain tree to add to a forest. In order to add a new domain to an existing forest, you 
must already have at least one other domain, which is the root domain. Keep in mind that 
the entire forest structure is destroyed if the original root domain is ever entirely removed. 
Therefore, you should have at least two domain controllers in the Active Directory root 
domain; the second serves as a backup in case you have a problem with the ﬁ rst, and it 
can also serve as a backup solution for disaster recovery and fault tolerance purposes. 
Such a setup provides additional protection for the entire forest in case one of the domain 
controllers fails. In order to complete this exercise, you must have already installed another 
domain controller that serves as the root domain for a forest, and you must use a server in 
the domain that is not a domain controller.  
 E X E R C I S E  4 . 2
Creating a New Domain Tree in the Forest  
 1. 
  Open the Active Directory Installation Wizard by clicking Start   Run and typing 
 dcpromo . Click the Use Advanced Mode Installation box. Click Next. 
 2. 
  At the Operating System Compatibility screen, click Next.  
 3. 
  On the Choose A Deployment Conﬁ guration page, select Existing Forest and then click 
Create A New Domain In An Existing Forest. Check the box  “ Create a new domain tree 
root instead of a new child domain. ” Click Next.  

 4. 
  On the Network Credentials page, specify the full name of the domain that you installed 
in the previous chapter. Click the Set button and enter the username and password for 
the domain administrator of a domain in the forest you wish to join. Click Next.  
 5. 
  On the Name The New Domain Tree Root page, you need to specify the full name of 
the new domain you wish to create. Note that this domain may not share a contiguous 
namespace with any other existing domain. Once you have entered the appropriate 
information, click Next. 
 6. 
  On the Domain NetBIOS Name page, you are prompted for the NetBIOS name of the 
domain controller. This is the name previous versions of Windows use to identify 
this machine. Choose a name that is up to 15 characters in length and includes only 
alphanumeric characters. Click Next to continue.  
Creating Domain Trees and Forests 
151

152 
Chapter 4  Installing and Managing Trees and Forests
E X E R C I S E  4 . 2  (c o n t i n u e d)
 7. 
  At the Set Domain Function Level screen, choose Windows Server 2003 and click Next.  
 8. 
  If you receive an error stating  “ Unable to ﬁ nd a site that corresponds to the IP address 
of this computer, ” click OK.   
 9. 
  At the Select A Site screen, choose Default - First - Site - Name and click Next. 
 10.   On the Additional Domain Controller Options page, make sure DNS Server and Global 
Catalog are both checked and click Next.  
 11.   If a delegation for DNS message appears, click Yes.  

 12.   The Source Domain Controller screen appears. Click the button labeled Use This 
Speciﬁ c Domain Controller, and highlight the domain controller that you created in 
Chapter 3. Click Next. 
 13.   On the Location For Database, Log Files, And SYSVOL page, specify the database and 
log locations. These settings specify where the Active Directory database resides on 
the local machine. Click Next.  
 14.   In order to be able to recover this server in the event of a loss of Active Directory 
information, you need to provide a Directory Services Restore Mode Administrator 
password. This password allows you to use the built - in recovery features of Windows 
Server 2008 if the Active Directory database is lost or corrupted. Enter  P@ssw0rd , 
conﬁ rm it, and then click Next.  
 15.   On the Summary page, you are given a brief listing of all of the choices you made in the 
previous steps. Click Next to continue.  
 16.   The Active Directory Installation Wizard automatically begins performing the steps 
required to create a new domain tree based on the information you provided. Note that 
you can press Cancel if you want to abort this process. When the setup is complete, 
you are prompted to reboot the system. Go ahead and do so, and once the process is 
ﬁ nished, you will have a new domain tree.  
Creating Domain Trees and Forests 
153

154 
Chapter 4  Installing and Managing Trees and Forests
 Adding Additional Domain Controllers 
 In addition to the operations you ’ ve already performed, you can use the Active Directory 
Installation Wizard to create additional domain controllers for any of your domains. There 
are two main reasons to create additional domain controllers:  
  Fault Tolerance and Reliability   You should always consider the theory of disaster 
recovery (DR) and have a plan, sometimes referred to as a Disaster Recovery Plan (DRP). 
If you ’ re part of one of those organizations that rely upon their network directory services 
infrastructures, you need Active Directory to provide security and resources for all users. 
For this reason, downtime and data loss are very costly. Through the use of multiple 
domain controllers, you can ensure that if one of the servers goes down, another one is 
available to perform the necessary tasks, such as user authentication and resource browsing. 
Additionally, data loss (perhaps from hard disk drive failure) will not result in the loss or 
unavailability of network security information since you can easily recover Active Directory 
information from the remaining, still - functional domain controller.  
  Performance   The burden of processing login requests and serving as a repository for 
security permissions and other information can be quite extensive, especially in larger 
businesses. By using multiple domain controllers, you can distribute this load across 
multiple systems. Additionally, by strategically placing domain controllers, you can greatly 
increase response times for common network operations, such as authentication and 
browsing for resources.  
 As a rule of thumb, you should always plan and design your infrastructure to have at 
least two domain controllers per domain. For many organizations, this provides a good 
balance between the cost of servers and the level of reliability and performance. For 
larger or more distributed organizations, however, additional domain controllers greatly 
improve performance.  
 Demoting a Domain Controller 
 In addition to being able to promote member servers to domain controllers, the Active 
Directory Installation Wizard can do the exact opposite — demote domain controllers. 
 You might choose to demote a domain controller for a couple of reasons. First, if you 
have determined that the role of a server should change (for example, from a domain 
controller to a member or stand - alone server you might make into a web server), you 
can easily demote it to make this happen. Another common reason to demote a domain 
controller is if you wish to move the machine from one domain to another. You cannot 
do this in a single step: You need to ﬁ rst demote the existing domain controller to remove 
it from the current domain and then promote it into a new domain. The result is that the 
server is now a domain controller for a different domain.  

 To demote a domain controller, you simply access the Active Directory Installation 
Wizard. The wizard automatically notices that the local server is a domain controller, 
and it asks you to verify each step you take, as with most things you do in Windows. You 
are prompted to decide whether you really want to remove this machine from the current 
domain (see Figure 4.3). Note that if the local server is a Global Catalog (GC) server, you 
will be warned that at least one copy of the GC must remain available so that you can 
perform logon authentication.  
 Planning for Domain Controller Placement 
 You ’ re the senior systems administrator for a medium - sized Active Directory 
environment. Currently, the environment consists of only one Active Directory domain. 
Your company ’ s network is spread out through 40 different sites within North America. 
Recently, you ’ ve received complaints from users and other systems administrators about 
the performance of Active Directory – related operations. For example, users report that 
it takes several minutes to log on to their machines in the morning between the hours 
of 9 and 10 a.m. when activity is at its highest. Simultaneously, systems administrators 
complain that updating user information within the OUs for which they are responsible 
can take longer than expected. 
 Fortunately, Active Directory ’ s distributed domain controller architecture allows you to 
optimize performance for this type of situation without making dramatic changes to your 
environment. You decide that the quickest and easiest solution is to deploy additional 
domain controllers throughout the organization. The domain controllers are generally 
placed within areas of the network that are connected by slow or unreliable links. For 
example, a small branch ofﬁ ce in Des Moines, Iowa, receives its own domain controller. 
The process is quite simple: You install a new Windows Server 2008 R2 computer and 
then run the Active Directory Installation Wizard (DCPROMO) to make the new machine a 
domain controller for an existing domain. Once the initial directory services data is copied 
to the new server, it is ready to service requests and updates of your domain information. 
 Note that there are potential drawbacks to this solution; for instance, you have to manage 
additional domain controllers and the network trafﬁ c generated from communications 
between the domain controllers. It ’ s important that you monitor your network links to 
ensure that you ’ ve reached a good balance between replication trafﬁ c and overall Active 
Directory performance. In later chapters, you ’ ll see how you can conﬁ gure Active Directory 
sites to better map Active Directory operations to your physical network structure.  
Demoting a Domain Controller 
155

156 
Chapter 4  Installing and Managing Trees and Forests
  F I G U R E  4 . 3 Demoting a domain controller using the Active Directory Domain Services 
Installation Wizard  
 Removing the Last Domain Controller in a Domain 
 In order for a domain to continue to exist, at least one domain controller must remain in 
that domain. As noted in the dialog box in Figure 4.3, you must take some very important 
considerations into account if you are removing the last domain controller from the 
domain. Because all of the security accounts and information will be lost, you should 
ensure that the following requirements are met before you remove a domain ’ s last 
domain controller:
  Computers No Longer Log on to This Domain.   Ensure that computers that were once 
members of this domain have changed domains. If computers are still attempting to 
log on, they will not be able to use any of the security features, including any security 
permissions or logon accounts. Users will, however, still be able to log on to the 
computer using cached authenticated information.  
  No User Accounts Are Needed.   All of the user accounts that reside within the domain 
(and all of the resources and permissions associated with them) will be lost when the 
domain is destroyed. Therefore, if you have already set up usernames and passwords, 
you need to transfer these accounts to another domain; otherwise, you will lose all of 
this information.  

 By default, at the end of the demotion process, the server is joined as a member server to 
the domain for which it was previously a domain controller. If you demote the last domain 
controller in the domain, the server becomes a stand - alone.  
 Removing a domain from your environment is not an operation that you 
should take lightly. Before you plan to remove a domain, make a list of 
all the resources that depend on the domain and the reasons why the 
domain was originally created. If you are sure your organization no longer 
requires the domain, then you can safely continue. If you are not sure, 
think again, because the process cannot be reversed and you could lose 
critical information!  
 Managing Multiple Domains 
 You can easily manage most of the operations that must occur  between domains by using 
the Active Directory Domains and Trusts administrative tool. If, on the other hand, you 
want to conﬁ gure settings  within a domain, you should use the Active Directory Users 
and Computers tool. In the following sections, we ’ ll look at ways to perform two common 
 All Encrypted Data Is Decrypted.   You need the security information (including User, 
Computer, and Group objects) stored within the Active Directory domain database 
to access any encrypted information. Once the domain no longer exists, the security 
information stored within it will no longer be available, and any encrypted information 
stored in the ﬁ lesystem will become permanently inaccessible. So, you need to decrypt 
any encrypted data before you begin the demotion process so that you can make sure 
you can access this information afterward. For example, if you have encrypted ﬁ les or 
folders that reside on NTFS volumes, you should decrypt them before you continue with 
the demotion process.  
 All Cryptographic Keys Are Backed Up.   If you are using cryptographic keys to 
authenticate and secure data, you should export the key information before you demote 
the last domain controller in a domain. Because this information is stored in the Active 
Directory database, any resources locked with these keys become inaccessible once the 
database is lost as a result of the demotion process. 
 By now, you ’ ve probably noticed a running theme — a lot of information disappears when 
you demote the last domain controller in a domain. The Active Directory Installation 
Wizard makes performing potentially disastrous decisions very easy. Be sure that you 
understand these effects before you demote the last domain controller for a given domain.  
Managing Multiple Domains 
157

158 
Chapter 4  Installing and Managing Trees and Forests
domain management functions with the tools just mentioned: managing  single - master 
operations and managing trusts. We ’ ll also look at ways to manage UPN sufﬁ xes to 
simplify user accounts, and we ’ ll examine GC servers in more detail. 
 Managing Single - Master Operations 
 For the most part, Active Directory functions in what is known as multimaster replication. 
That is, every domain controller within the environment contains a copy of the Active 
Directory database that is both readable and writable. This works well for most types of 
information. For example, if you want to modify the password of a user, you can easily do 
this on  any of the domain controllers within a domain. The change is then automatically 
propagated to the other domain controllers. 
 However, some functions are not managed in a multimaster fashion. These operations 
are known as  operations masters . You must perform single - master operations on specially 
designated domain controllers within the Active Directory forest. There are ﬁ ve main 
single - master functions: two that apply to an entire Active Directory forest and three that 
apply to each domain.  
 Forest Operations Masters 
 You use the Active Directory Domains and Trusts tool to conﬁ gure forest - wide roles. The 
following single - master operations apply to the entire forest:  
  Schema Master   Earlier, you learned that all of the domain controllers within a single 
Active Directory environment share the same schema. This ensures information consistency. 
Developers and systems administrators can, however, modify the Active Directory schema 
by adding custom information. A trivial example might involve adding a ﬁ eld to employee 
information that speciﬁ es a user ’ s favorite color. 
 When you need to make these types of changes, you must perform them on the domain 
controller that serves as the  Schema Master for the environment. The Schema Master is 
then responsible for propagating all of the changes to all of the other domain controllers 
within the forest.  
 Domain Naming Master   The purpose of the  Domain Naming Master is to keep track 
of all the domains within an Active Directory forest. You access this domain controller 
whenever you need to add new domains to a tree or forest.  
 Domain Operations Masters 
 You use the Active Directory Users and Computers snap - in to administer roles within 
a domain. Within each domain, at least one domain controller must fulﬁ ll each of the 
following roles:  

 Relative ID (RID) Master   Every security object within Active Directory must be assigned 
a unique identiﬁ er so that it is distinguishable from other objects. For example, if you 
have two OUs named IT that reside in different domains, you must have some way to 
easily distinguish between them. Furthermore, if you delete one of the IT OUs and then 
later re - create it, the system must be able to determine that it is not the same object as 
the other IT OU. The unique identiﬁ er for each object is made up of a domain identiﬁ er 
and a relative identiﬁ er (RID). RIDs are always unique within an Active Directory domain 
and are used for managing security information and authenticating users. The  RID 
Master is responsible for creating these values within a domain whenever new Active 
Directory objects are created.   
 PDC Emulator Master   Within a domain, the  PDC Emulator Master is responsible for 
maintaining backward compatibility with Windows 95, 98, and NT clients. 
 When running in Windows 2000 Native, Windows 2003, Windows Server 2008, or 
Windows 2008 R2 domain functional level (which does not support the use of pre - Windows 
2000 domain controllers), the PDC Emulator Master serves as the default domain controller 
to process authentication requests if another domain controller is unable to do so. The PDC 
Emulator also receives preferential treatment whenever domain security changes are made.  
 Infrastructure Master   Whenever a user is added to or removed from a group, all of the 
other domain controllers should be made aware of this change. The role of the domain 
controller that acts as an  Infrastructure Master is to ensure that group membership 
information stays synchronized within an Active Directory domain.  
 Unless there is only one domain controller, you should not place the 
Infrastructure Master on a Global Catalog server. If the Infrastructure 
Master and Global Catalog are on the same domain controller, the 
Infrastructure Master will not function. 
 Another service that a server can control for the network is the Windows Time service. 
The Windows Time service uses a suite of algorithms in the Network Time Protocol (NTP). 
This helps to ensure that the time on all computers throughout a network is as accurate as 
possible. All client computers within a Windows Server 2008 R2 domain are synchronized 
with the time of an authoritative computer.  
 Assigning Single - Master Roles 
 Now that you are familiar with the different types of single - master operations, take a look 
at Exercise 4.3. This exercise shows you how to assign these roles to servers within the 
Active Directory environment. In this exercise, you will assign single - master operations 
roles to various domain controllers within the environment. In order to complete the steps 
in this exercise, you need one Active Directory domain controller.  
Managing Multiple Domains 
159

160 
Chapter 4  Installing and Managing Trees and Forests
 E X E R C I S E  4 . 3
Assigning Single - Master Operations  
 1. 
  Open the Active Directory Domains and Trusts administrative tool by clicking Start   
Administrative Tools   Active Directory Domains And Trusts. 
 2. 
  Right - click Active Directory Domains And Trusts, and choose Operations Masters. 
 3. 
  In the Operations Masters dialog box, note that you can change the operations 
master by clicking the Change button. If you want to move this assignment to another 
computer, you ﬁ rst need to connect to that computer and then make the change. Click 
Close to continue without making any changes.  
 4. 
  Close the Active Directory Domains and Trusts administrative tool.  
 5. 
  Open the Active Directory Users and Computers administrative tool.  
 6. 
  Right - click the name of a domain and select Operations Masters. This brings up the RID 
tab of the Operations Masters dialog box.  

 Notice that you can change the computer that is assigned to the role. In order to change the 
role, you ﬁ rst need to connect to the appropriate domain controller. Notice that the PDC and 
Infrastructure roles have similar tabs. Click Close to continue without making any changes. 
 7. 
  When you have ﬁ nished, close the Active Directory Users and Computers tool. 
 Remember that you manage single - master operations with three different 
tools. You use the Active Directory Domains and Trusts tool to configure 
forest - wide roles, while you use the Active Directory Users and Computers 
snap - in to administer roles within a domain. Although this might not seem 
intuitive at first, it can help you remember which roles apply to domains 
and which apply to the whole forest. The third tool, the Schema Master 
role, is a bit different than these other two. To change the Schema 
Master role, you must install the Active Directory Schema MMS snap - in 
and change it there.  
 Managing Trusts 
 Trust relationships make it easier to share security information and network resources 
between domains. As was already mentioned, standard transitive two - way trusts are 
automatically created between the domains in a tree and between each of the trees in a forest. 
Figure 4.4 shows an example of the default trust relationships in an Active Directory forest.  
tree1.com
tree2.com
= Transitive
Two-Way
Trust
 F I G U R E 4 . 4 Default trusts in an Active Directory forest 
Managing Multiple Domains 
161

162 
Chapter 4  Installing and Managing Trees and Forests
 When conﬁ guring trusts, here are two main characteristics you need to consider:  
  Transitive Trusts   By default, Active Directory trusts are  transitive trusts . The simplest 
way to understand transitive relationships is through an example like the following: If 
Domain A trusts Domain B and Domain B trusts Domain C, then Domain A implicitly 
trusts Domain C. If you need to apply a tighter level of security, trusts can be conﬁ gured 
as intransitive.  
  One - Way vs. Two - Way   Trusts can be conﬁ gured as one - way or two - way relationships. The 
default operation is to create  two - way trusts or  bidirectional trusts . This makes it easier to 
manage trust relationships by reducing the trusts you must create. In some cases, however, 
you might decide against two - way trusts. In one - way relationships, the trusting domain 
allows resources to be shared with the trusted domain but not the other way around.  
 When domains are added together to form trees and forests, an automatic transitive two -
 way trust is created between them. Although the default trust relationships work well for 
most organizations, there are some reasons why you might want to manage trusts manually: 
 
  You may want to remove trusts between domains if you are absolutely sure that you do 
not want resources to be shared between domains.  
 
  Because of security concerns, you may need to keep resources isolated.  
 In addition to the default trust types, you can also conﬁ gure the following types of 
special trusts:  
  External Trusts   You use  external trusts to provide access to resources on a Windows NT 
4 domain or forest that cannot use a forest trust. Windows NT 4 domains cannot beneﬁ t 
from the other trust types that are used in Windows Server 2008 R2, so in some cases, 
external trusts could be your only option. External trusts are always nontransitive, but they 
can be established in a one - way or two - way conﬁ guration.  
 Default SID Filtering on External Trusts   When you set up an external trust, 
remember that it is possible for hackers to compromise a domain controller in 
a trusted domain. If this trust is compromised, a hacker can use the security 
identiﬁ er (SID) history attribute to associate SIDs with new user accounts, granting 
themselves unauthorized rights (this is called an elevation - of - privileges attack). To help 
prevent this type of attack, Windows Server 2008 R2 automatically enables SID ﬁ lter 
quarantining on all external trusts. SID ﬁ ltering allows the domain controllers in the 
trusting domain (the domain with the resources) to remove all SID history attributes 
that are not members of the trusted domain.  
  Realm Trusts   Realm trusts are similar to external trusts. You use them to connect to a 
non - Windows domain that uses Kerberos authentication. Realm trusts can be transitive or 
nontransitive, one - way or two - way.  
  Cross - Forest Trusts   Cross - forest trusts are used to share resources between forests. They 
have been used since Windows Server 2000 domains and cannot be nontransitive, but 
you can establish them in a one - way or a two - way conﬁ guration. Authentication requests 
in either forest can reach the other forest in a two - way cross - forest trust. If you want one 

forest to trust another forest, you must set it (at a minimum) to at least the forest function 
level of Windows Server 2003.  
 Selective Authentication vs. Forest - wide Authentication   Forest - wide authentication 
on a forest trust means that users of the trusted forest can access all the resources 
of the trusting forest. Selective authentication means that users cannot authenticate 
to a domain controller or resource server in the trusting forest unless they are 
explicitly allowed to do so. Exercise 4.4 will show you the steps to change forest -
 wide authentication to selective authentication.  
 Shortcut Trusts   In some cases, you may actually want to create direct trusts between two 
domains that implicitly trust each other. Such a trust is sometimes referred to as a  shortcut 
trust and can improve the speed at which resources are accessed across many different 
domains. Let ’ s say that you have a forest, as shown in Figure 4.5.  
Stellacon.com
US.stellacon.com
UK.stellacon.com
USERS
NY.us.stellacon.com
RESOURCES
London.uk.stellacon.com
 F I G U R E 4 . 5 Example of forest  
 Users in the  NY.us.stellacon.com domain can access resources in the  London.uk
.stellacon.com domain but the users have to authenticate using the parent domains 
to gain access ( NY.us.stellacon.com to  us.stellacon.com to  stellacon.com to 
 uk.stellacon.com to finally reach  London.uk.stellacon.com ). This process can be 
slow. An administrator can set up a one - way trust from  London.uk.stellacon.com 
(trusting domain) to  NY.us.stellacon.com (trusted domain) so that the users can 
access the resources directly.  
Managing Multiple Domains 
163

164 
Chapter 4  Installing and Managing Trees and Forests
 Perhaps the most important aspect to remember regarding trusts is that 
creating them only  allows you to share resources between domains. The 
trust does not grant any permissions between domains by itself. Once 
a trust has been established, however, systems administrators can easily 
assign the necessary permissions.  
 Exercise 4.4 walks you through the steps you need to take to manage trusts. In this 
exercise, you will see how to assign trust relationships between domains. In order to 
complete the steps in this exercise, you must have domain administrator access permissions.  
 E X E R C I S E  4 . 4
Managing Trust Relationships  
 1. 
  In the domain you created in Chapter 3, open the Active Directory Domains and Trusts 
administrative tool by clicking Start   Administrative Tools   Active Directory Domains 
And Trusts.  
 2. 
  Right - click the name of a domain and select Properties. 
 3. 
  Select the Trusts tab. You will see a list of the trusts that are currently conﬁ gured. To 
modify the trust properties for an existing trust, highlight that trust and click Properties.  
 4. 
  The Properties window for the trust displays information about the trust ’ s direction, 
transitivity, and type, along with the names of the domains involved in the relationship. 
Click Cancel to exit without making any changes.  

 5. 
  To create a new trust relationship, click the New Trust button on the Trusts tab. The New 
Trust Wizard appears. Click Next to proceed with the wizard.  
 6. 
  On the Trust Name page, you are prompted for the name of the domain with which the 
trust should be created. Enter the name of the domain and click Next.  
 7. 
  On the Trust Type page, you would normally choose the Trust With A Windows Domain 
option if you know that the other domain uses a Windows domain controller. Choose 
Realm Trust. Click Next when you have ﬁ nished. 
Managing Multiple Domains 
165

166 
Chapter 4  Installing and Managing Trees and Forests
E X E R C I S E  4 . 4  (c o n t i n u e d)
 
 8. 
  On the Transitivity Of Trust page, you choose whether the trust is transitive or 
nontransitive. Choose the Nontransitive option and click Next to continue. 
 9. 
  On the Direction Of Trust page, you select the direction of the trust. If you want both 
domains to trust each other, you select the Two - Way option. Otherwise you select either 
One - Way: Incoming or One - Way: Outgoing, depending on where the affected users are 
located. For the sake of this exercise, choose One - Way: Incoming and then click Next.  

 10.   On the Trust Password page, you need to specify a password that should be used to 
administer the trust. Type  P@ssw0rd and conﬁ rm it. Note that if there is an existing 
trust relationship between the domains, the passwords must match. Click Next to 
continue.  
 11.   Now you see the Trust Selections Complete page that recaps the selections you have 
made. Because this is an exercise, you don ’ t actually want to establish this trust. Click 
Cancel to cancel the wizard without saving the changes.  
Managing Multiple Domains 
167

168 
Chapter 4  Installing and Managing Trees and Forests
E X E R C I S E  4 . 4  (c o n t i n u e d)
 12.   Exit the trust properties for the domain by clicking Cancel. 
  To Enable Selective Authentication 
 1. 
  In the console tree, right - click the name of a domain and select Properties. 
 2. 
  Select the Trusts tab. Under either Domains Trusted By This Domain (Outgoing Trusts) 
or Domains That Trust This Domain (Incoming Trusts), click the forest trust that you 
want to administer, and then click Properties. 
 3. 
  On the Authentication tab, click Selective Authentication, and then click OK.  
 Managing UPN Suffixes 
 User principal name (UPN) sufﬁ xes are the part of a user ’ s name that appears after the 
 @ symbol. So, for instance, the UPN sufﬁ x of  wpanek@stellacon.com would be  stellacon
.com . By default, the UPN sufﬁ x is determined by the name of the domain in which the 
user is created. In this example, the user  wpanek was created in the domain  stellacon.com , 
so the two pieces of the UPN logically ﬁ t together. However, you might ﬁ nd it useful to 
provide an alternative UPN sufﬁ x to consolidate the UPNs forest - wide. 
 For instance, if you manage a forest that consists of  stellacon.com and  stellacon2.com , 
you might want all of your users to adopt the more generally applicable  stellacon.com  
UPN sufﬁ x. By adding additional UPN sufﬁ xes to the forest, you can easily choose the 
appropriate sufﬁ x when it comes time to create new users. Exercise 4.5 shows you how to 
add additional sufﬁ xes to a forest.  
 E X E R C I S E  4 . 5
Adding a UPN Suffix  
 1. 
  Open the Active Directory Domains and Trusts administrative tool by clicking Start   
Administrative Tools   Active Directory Domains And Trusts. 
 2. 
  Right - click Active Directory Domains And Trusts in the left side of the window and 
select Properties.  
 3. 
  On the UPN Sufﬁ xes tab of the Active Directory Domains And Trusts Properties dialog 
box, enter an alternative UPN sufﬁ x in the Alternative UPN Sufﬁ xes ﬁ eld. Click the Add 
button to add the sufﬁ x to the list. 

 4. 
  To remove a UPN sufﬁ x, select its name in the list and click the Remove button.  
 Managing Global Catalog Servers 
 One of the best features of a distributed directory service like Active Directory is that you 
can store different pieces of information in different places within an organization. For 
example, a domain in Japan might store a list of users who operate within a company ’ s Asian 
operations business unit, while one in New York would contain a list of users who operate 
within its North American operations business unit. This architecture allows systems 
administrators to place the most frequently accessed information on domain controllers in 
different domains, thereby reducing disk space requirements and replication trafﬁ c. 
 However, you may encounter a problem when you deal with information that is segmented 
into multiple domains. The issue involves querying information stored within Active Directory. 
What would happen, for example, if a user wanted a list of all of the printers available in 
all domains within the Active Directory forest? In this case, the search would normally 
require information from at least one domain controller in each of the domains within the 
environment. Some of these domain controllers may be located across slow WAN links or may 
have unreliable connections. The result would include an extremely long wait while retrieving 
the results of the query, that is, if any results came up without the query timing out. 
 Fortunately, Active Directory has a mechanism that speeds up such searches. You can 
conﬁ gure any number of domain controllers to host a copy of the GC. The GC contains all 
of the schema information and a subset of the attributes for all domains within the Active 
Directory environment. Although a default set of information is normally included with the 
GC, systems administrators can choose to add additional information to this data store if it is 
needed. To help reduce replication trafﬁ c and to keep the GC ’ s database small, only a limited 
subset of each object ’ s attributes is replicated. This is called the partial attribute set (PAS). You 
can change the PAS by modifying the schema and marking attributes for replication to the GC. 
Managing Multiple Domains 
169

170 
Chapter 4  Installing and Managing Trees and Forests
 Servers that contain a copy of the GC are known as GC servers. Now, whenever a user 
executes a query that requires information from multiple domains, they need only contact 
the nearest GC server for this information. Similarly, when users must authenticate across 
domains, they do not have to wait for a response from a domain controller that may be 
located across the world. The result is that the overall performance of Active Directory 
queries improves. 
 Exercise 4.6 walks you through the steps you need to take to conﬁ gure a domain 
controller as a GC server. Generally, GC servers are only useful in environments that use 
multiple Active Directory domains.  
 E X E R C I S E  4 . 6
Managing GC Servers  
 1. 
  Open the Active Directory Sites and Services administrative tool by clicking Start   
Administrative Tools   Active Directory Sites And Services.  
 2. 
  Find the name of the local domain controller within the list of objects (typically under 
Default First Site Name   Servers), and expand this object. Right - click NTDS Settings 
and select Properties.  
 3. 
  In the NTDS Settings Properties dialog box, type  Primary GC Server for Domain  in 
the Description ﬁ eld. Note that there is a check box that determines whether this 
computer contains a copy of the Global Catalog. If the box is checked, then this domain 
controller contains a subset of information from all other domains within the Active 
Directory environment. Select the Global Catalog check box, and then click OK to 
continue.  
 4. 
  When you have ﬁ nished, close the Active Directory Sites and Services administrative tool. 

 Managing Universal Group Membership Caching 
 Many networks run into problems with available network bandwidth and server hardware 
limitations. For this reason, it may not be wise to install a GC in smaller branch ofﬁ ces. 
Windows Server 2008 R2 can help these smaller sites by deploying domain controllers that 
use Universal Group Membership Caching (UGMC). 
 Once enabled, Universal Group Membership Caching stores information locally when 
a user attempts to log on for the ﬁ rst time. With the use of a GC, the domain controller 
retains the universal group membership for that logged - on user. 
 The next time that user attempts to log on, the authenticating domain controller 
running Windows Server 2008 R2 will obtain the universal group membership 
information from its local cache without the need to contact a GC. The universal 
group membership information is retained, by default, on the domain controller for 
8 hours. 
 Some of the advantages of using Universal Group Membership Caching are as follows:  
 Faster Logon Times   Since the domain controller does not need to contact a Global 
Catalog, logon authentication is faster.  
 Reduced Network Bandwidth   The domain controller does not have to handle object 
replication for all the objects located in the forest.  
 Ability to Use Existing Hardware.   There is no need to upgrade hardware to support a GC.  
 Exercise 4.7 shows you the steps that you need to take to conﬁ gure Universal Group 
Membership Caching.  
 E X E R C I S E  4 . 7
Managing Universal Group Membership Caching  
 1. 
  Open the Active Directory Sites and Services administrative tool by clicking Start   
Administrative Tools   Active Directory Sites And Services. 
 2. 
  Click Sites; then click DefaultFirstSite. In the right pane, right - click NTDS Settings and 
choose Properties.  
 3. 
  In the NTDS Site Settings Properties dialog box, check the box labeled Enable Universal 
Group Membership Caching, and then click OK to continue. 
Managing Multiple Domains 
171

172 
Chapter 4  Installing and Managing Trees and Forests
E X E R C I S E  4 . 7  (c o n t i n u e d)
 4. 
  When you have ﬁ nished, close the Active Directory Sites and Services administrative tool. 
 Summary 
 In this chapter, we covered the basics of linking multiple domains in trees and forests. You 
now know why you would want to plan for them and what the beneﬁ ts and drawbacks 
are of using only one domain or of having a multidomain environment. For example, you 
might decide to have multiple domains if you have an acquisitions - and - mergers situation 
where you need to keep multiple administrators. In addition, by using multiple domains, 
organizations can retain separate security databases; however, in such cases, they are also 
able to share resources between domains. 
 You also learned how to use multiple domains to provide two major beneﬁ ts for the 
network directory services — security and availability. These beneﬁ ts are made possible 
through Active Directory and the administrative tools that can be used to access it. 
 In addition, we covered how systems administrators can simplify operations while 
still ensuring that only authorized users have access to their data, how multiple domains 
can interact to form Active Directory trees and forests, and how you can use the Active 
Directory Installation Wizard to create new Active Directory trees and forests.  

 Exam Essentials  
 Understand the reasons for using multiple domains.   There are seven primary reasons 
for using multiple domains: They provide additional scalability, they reduce replication 
trafﬁ c, they help with political and organizational issues, they provide many levels of 
hierarchy, they allow for decentralized administration, they preserve legality, and they 
allow for multiple DNS or domain names.  
 Understand the drawbacks of using multiple domains.   With multiple domains, maintaining 
administrative consistency is more difﬁ cult. The number of administrative units multiplies 
as well, which makes it difﬁ cult to keep track of network resources. Finally, it is much more 
difﬁ cult to rearrange the domain topology within an Active Directory environment than it is 
to simply reorganize OUs.  
 Know how to create a domain tree.   To create a new domain tree, you need to promote 
a Windows Server 2008 computer to a domain controller, select the option that makes 
this domain controller the ﬁ rst machine in a new domain, and make that domain the ﬁ rst 
domain of a new tree. The result is a new domain tree.  
 Know how to join a domain tree to a forest.   Creating a new tree to form or add to a 
forest is as simple as promoting a server to a domain controller for a new domain that does 
 not share a namespace with an existing Active Directory domain. In order to add a domain 
to an existing forest, you must already have at least one other domain. This domain serves 
as the root domain for the entire forest.  
 Understand how to manage single - master operations.   Single - master operations must 
be performed on specially designated machines within the Active Directory forest. There 
are ﬁ ve main single - master functions: two that apply to an entire Active Directory forest 
(Schema Master and Domain Naming Master) and three that apply to each domain (RID 
Master, PDC Emulator Master, and Infrastructure Master).  
 Understand how to manage trusts.   When conﬁ guring trusts, you ’ ll need to consider two 
main characteristics: transitivity and direction. The simplest way to understand transitive 
relationships is through an example like the following: If Domain A trusts Domain B 
and Domain B trusts Domain C, then Domain A implicitly trusts Domain C. Trusts can 
be conﬁ gured as nontransitive so that this type of behavior does not occur. In one - way 
relationships, the trusting domain allows resources to be shared with the trusted domain. 
In two - way relationships, both domains trust each other equally. Special trusts include 
external trusts, realm trusts, cross - forest trusts, and shortcut trusts.  
 Understand how to manage UPN suffixes.   By default, the name of the domain in which the 
user is created determines the UPN sufﬁ x. By adding additional UPN sufﬁ xes to the forest, 
you can easily choose more manageable sufﬁ xes when it comes time to create new users.  
 Understand how to manage Global Catalog servers.   You can conﬁ gure any number of 
domain controllers to host a copy of the Global Catalog. The GC contains all of the schema 
information and a subset of the attributes for all domains within the Active Directory 
Exam Essentials 
173

174 
Chapter 4  Installing and Managing Trees and Forests
environment. Servers that contain a copy of the GC are known as GC servers. Whenever 
a user executes a query that requires information from multiple domains, they need only 
contact the nearest GC server for this information. Similarly, when users must authenticate 
across domains, they will not have to wait for a response from a domain controller that 
may be located across the world. The result is increased overall performance of Active 
Directory queries.  
  Understand universal group membership caching.   You can enable a domain controller as 
a Universal Group Membership Caching server. The Universal Group Membership Caching 
machine will then send a request for the logon authentication of a user to the GC server. 
The GC will then send the information back to the Universal Group Membership Caching 
server to be cached locally for 8 hours (by default). The user can then authenticate without 
the need to contact the GC again.  

 Review Questions  
 1. 
  You are the network administrator for an organization that has two locations, New York 
and London. Each location has multiple domains but all domains fall under the same tree, 
 Stellacon.com . Users in the  NY.us.stellacon.com  domain need to access resources in 
the  London.uk.stellacon.com  domain. You need to reduce the amount of time it takes 
for authentication when users from  NY.us.stellacon.com  access resources in  London
.uk.stellacon.com . What can you do?  
 A.   Set up a one - way shortcut trust from  London.uk.stellacon.com  to 
 NY.us.stellacon.com . 
 B.   Set up a one - way shortcut trust from  NY.us.stellacon.com  to 
 London.uk.stellacon.com . 
 C.   Enable Universal Group Membership Caching in  NY.us.stellacon.com . 
 D.   Enable Universal Group Membership Caching in  London.uk.stellacon.com . 
 2. 
  You are hired as a consultant by ABC Corporation to implement a Windows Server 2008 
R2 computer onto their Windows Server 2003 domain. All of the client machines are 
Windows 7. You install Windows Server 2008 R2 onto a new computer and join that 
computer to the Windows 2003 domain. You want to upgrade the Windows Server 2008 
R2 to a domain controller. What should you do first?  
 A.   On the new server, run  adprep /domainprep . 
 B.   On the new server, run  adprep /forestprep . 
 C.   On a Windows Server 2003 domain controller, run  adprep /domainprep . 
 D.   On a Windows Server 2003 domain controller, run  adprep /forestprep . 
 3. 
 You are the network administrator for ABC Company. You have a domain controller 
named ServerA that needs to have the Active Directory Domain Services role removed from 
the computer. What do you do?  
 A.   Run  adprep /removedc  and remove the Active Directory Domain Services role.  
 B.   Run  adprep /dcremove  and remove the Active Directory Domain Services role.  
 C.   Run  dcpromo  and remove the Active Directory Domain Services role.  
 D.   Run  demotedc  and remove the Active Directory Domain Services role.  
 4. 
  You are removing a domain controller from your network. This domain controller holds 
the forest - wide operations master roles. Which roles would you need to transfer to another 
machine before you remove the domain controller? (Choose all that apply.)  
 A.   PDC Emulator Master  
 B.   Schema Master  
 C.   RID Master 
 D.   Domain Naming Master 
 E. 
  Infrastructure Master   
Review Questions 
175

176 
Chapter 4  Installing and Managing Trees and Forests
  5. 
  You are the network administrator for an organization that has a single Active Directory 
domain named  intranet.stellacon.com . All domain controllers run Windows Server 
2008 R2, and the domain function level is set to Windows Server 2000 Native. You need 
to make sure that the UPN suffix for  stellacon.com  is available to all users. What do you 
need to do?  
 A.   Add the new UPN suffix of  stellacon.com  to the forest.  
 B.   Upgrade the domain to Windows Server 2003.  
 C.   Upgrade the domain to Windows Server 2008.  
 D.   Upgrade the domain to Windows Server 2008 R2.  
 6. 
 You are removing a domain controller from your network. This domain controller holds 
the domain - based operations master roles. Which roles would you need to transfer to 
another machine before you remove this domain controller? (Choose all that apply.)  
 A.   PDC Emulator Master  
 B.   Schema Master  
 C.   RID Master 
 D.   Domain Naming Master 
 E. 
  Infrastructure Master  
  7. 
  You are the network administrator for your company. Your company has four domain 
controllers named Server1, Server2, Server3, and Server4. The four domain controllers have 
the following setup:
 Domain Controller  
  Role Installed  
 Server1  
  PDC Emulator Master, RID Master  
 Server2  
  Schema Master  
 Server3  
  Domain Naming Master 
 Server4  
  Infrastructure Master  
 Server2 stops responding and you need to move the roles to Server3. How do you 
accomplish this?  
 A.   On Server2, transfer the Schema Master to Server3.  
 B.   On Server3, seize control of the Schema Master.  
 C.   On Server3, transfer the Schema Master.  
 D.   On Server2, release control of the Schema Master to Server3.  

 8. 
  You are the network administrator for your company. Your company has two domain 
controllers named Server1 and Server2. The two domain controllers have the following 
setup:
 Domain Controller  
  Role Installed  
 Server1  
  PDC Emulator Master, Infrastructure Master, Global Catalog  
 Server2  
  Schema Master, Domain Naming Master, RID Master 
 The Infrastructure Master is not functioning. What should you do?  
 A.   Move the PDC Emulator Master to Server2.  
 B.   On Server2, seize control of the Global Catalog.  
 C.   Move the Schema Master to Server1.  
 D.   Move the Infrastructure Master to Server2.  
 9. 
  You are the network administrator for a company that has a Windows Server 2003 forest. 
You need to install Windows Server 2008 R2 onto the network. What two actions need to 
be completed first? (Choose two.)  
 A.   Run the  adprep /domainprep command.  
 B.   Run the  dcpromo  command.  
 C.   Raise the forest function level to Windows Server 2008 R2.  
 D.   Run the  adprep /forestprep command.  
 10.   You have a Windows Server 2003 domain controller on your network. You plan to install 
a Windows Server 2008 R2 domain controller. You have already run  forestprep and 
 domainprep . How do you upgrade the Windows Server 2008 R2 machine into a domain 
controller?  
 A.   Run the  adprep /dcprep  command.  
 B.   Run the  dcpromo  command.  
 C.   Run the  adprep /dcpromo  command.  
 D.   Run the  setup /dcprep  command.  
Review Questions 
177

178 
Chapter 4  Installing and Managing Trees and Forests
 Answers to Review Questions 
1. 
 A.   Since the users in the  NY.us.stellacon.com  (trusted) domain are accessing resources 
in the  London.uk.stellacon.com (trusting) domain, you must set up the shortcut trust 
from the trusting domain to the trusted domain. 
2. 
 D.   Before you promote a Windows Server 2008 R2 domain controller into a Windows 
2003 forest, an administrator should ﬁ rst successfully run  adprep /forestprep on the 
Schema Operations Master and then run  adprep/domainprep  on the Infrastructure Master 
in the Windows 2003 forest. The  forestprep and  domainprep  processes prepare the 
Windows 2003 network to accept the installation of the Windows Server 2008 server. 
3. 
 C.   The  dcpromo  command allows you to add or remove the Active Directory Domain 
Services role from a Windows Server 2008 R2 machine. 
4. 
 B, D.   You would need to transfer the two forest - wide operations master roles: Schema Master 
and Domain Naming Master. This means that there can only be one Schema Master and 
only one Domain Naming Master per forest. The PDC Emulator Master, RID Master, and 
Infrastructure Master are all domain - based operations master roles (each domain in the forest 
must have a domain controller with these three roles installed). 
5. 
 A.   When you add a sufﬁ x name to the forest, it allows your users to use a simple user logon 
name that is not the same as the actual domain or parent name. Windows Server 2000 
native mode allows you to create a UPN sufﬁ x name. 
6. 
 A, C, E.   The PDC Emulator Master, RID Master, and Infrastructure Master are all 
domain - based operations master roles (each domain in the forest must have a domain 
controller with these three roles installed). There are two forest - wide operations master 
roles: Schema Master and Domain Naming Master. This means that there can only be one 
Schema Master and only one Domain Naming Master per forest. 
7. 
 B.   Seizing control of a operations master role allows you to transfer the role from a 
computer that is not working. If Server2 was working properly, you could just transfer the 
role to Server3, but since the machine is not responding, you must seize control. 
8. 
 D.   Unless there is only one domain controller, you should not place the Infrastructure 
Master on a Global Catalog server. If the Infrastructure Master and Global Catalog are on 
the same domain controller, the Infrastructure Master will not function. 
9. 
 A, D.   Before you install a Windows Server 2008 domain controller into a Windows 2003 
forest, an administrator should ﬁ rst successfully run  adprep /forestprep  on the Schema 
operations master and then run  adprep/domainprep  on the Infrastructure Master in the 
Windows 2003 forest. 
10.  B.   The  dcpromo  command gives you the ability to upgrade a Windows Server 2008 R2 
machine into a domain controller. 
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at 
 www.sybex.com/go/mctswindows2008r2.  

Configuring Sites and 
Replication  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring the Active Directory Infrastructure  
 Configure sites. May include but is not limited to: create 
Active Directory subnets; configure site links; configure site 
link costing; configure site infrastructure.  
 Configure Active Directory replication. May include but is not 
limited to: DFSR; one - way replication; Bridgehead server; 
replication scheduling; configure replication protocols; force 
intersite replication.  



 Chapter 
5

 Microsoft has designed Active Directory to be an enterprise -
 wide solution for managing network resources. In previous 
chapters, you saw how to create Active Directory objects based 
on an organization ’ s logical design. Domain structure and organizational unit (OU) struc-
ture, for example, should be designed based primarily on an organization ’ s business needs. 
 Now it ’ s time to learn how Active Directory can map to an organization ’ s  physical 
requirements. Speciﬁ cally, you must consider network connectivity between sites and the 
ﬂ ow of information between domain controllers (DC) under less - than - ideal conditions. 
These constraints determine how domain controllers can work together to ensure that 
the objects within Active Directory remain synchronized, no matter how large and 
geographically dispersed the network is. 
 Fortunately, through the use of the Active Directory Sites and Services administrative 
tool, you can quickly and easily create the various components of an Active Directory 
replication topology. Using this tool, you can create objects called sites, place servers in 
sites, and create connections between sites. Once you have conﬁ gured Active Directory 
replication to ﬁ t your current network environment, you can sit back and allow Active 
Directory to make sure that information remains consistent across domain controllers. 
 This chapter covers the features of Active Directory that allow systems administrators 
to modify the behavior of replication based on their physical network design. Through 
the use of sites, systems and network administrators will be able to leverage their network 
infrastructure to best support Windows Server 2008 R2 and Active Directory.  
 Overview of Network Planning 
 Before discussing sites and replication, you need to understand some basic physical and 
network concepts. 
 The Three Types of Network 
 When designing networks, systems and network administrators use the following terms to 
deﬁ ne the types of connectivity between locations and servers:
 Local Area Networks  A  local area network (LAN) is usually characterized as a high -
 bandwidth network. Generally, an organization owns all of its LAN network hardware 
and software. Ethernet is by far the most common networking standard. Ethernet speeds 
are generally at least 10 Mbps and can scale to multiple gigabits per second. Currently, 

the standard for Ethernet is the 10 Gigabit Ethernet, which runs at 10 times the speed of 
Gigabit Ethernet (1 Gbps). Several LAN technologies, including routing and switching, are 
available to segment LANs and to reduce contention for network resources.  
 Wide Area Networks   The purpose of a  wide area network (WAN) is similar to that of 
a LAN — to connect network devices. Unlike LANs, however, WANs are usually leased 
from third - party telecommunications carriers and Internet service providers (ISPs). 
Although extremely high - speed WAN connections are available, they are generally 
costly for organizations to implement through a distributed environment. Therefore, 
WAN connections are characterized by lower - speed connections and, sometimes, 
nonpersistent connections.  
 The Internet   If you have not heard of the Internet, you must have been locked away 
in a server room (without network access) for a long time. The Internet is a worldwide 
public network infrastructure based on the  Internet Protocol (IP) . Access to the Internet is 
available through organizations known as ISPs. Because it is a public network, there is no 
single  “ owner ”  of the Internet. Instead, large network and telecommunications providers 
constantly upgrade the infrastructure of this network to meet growing demands. 
 Organizations now use the Internet regularly. For example, it ’ s rare nowadays to see 
advertisements that don ’ t direct you to one website or another. Through the use of 
technologies such as virtual private networks (VPNs), organizations can use encryption 
and authentication technology to enable secure communications across the Internet.  
 Exploring Network Constraints 
 In an ideal situation, a high - speed network would connect all computers and networking 
devices. In such a situation, you would be able to ensure that any user of your network, 
regardless of location, would be able to quickly and easily access resources. When you 
are working in the real world, however, you have many other constraints to keep in mind, 
including network bandwidth and network cost. 
 Network Bandwidth 
 Network bandwidth generally refers to the amount of data that can pass through a speciﬁ c 
connection in a given amount of time. For example, in a WAN situation, a T1 may have 
1.544 Mbps (megabits per second), or a standard analog modem may have a bandwidth of 
56 or 57.6 Kbps (kilobits per second) or less. However, your LAN ’ s Ethernet connection 
may have a bandwidth of 100 Mbps. Different types of networks work at different speeds; 
therefore, it ’ s imperative that you always consider network bandwidth when you ’ re 
thinking of how to deploy domain controllers in your environment.  
 Network Cost 
 Cost is perhaps the single biggest factor in determining a network design. If cost were 
not a constraint, organizations would clearly choose to use high - bandwidth connections 
for all of their sites. Realistically, trade - offs in performance must be made for the sake of 
Overview of Network Planning 
181

182 
Chapter 5  Configuring Sites and Replication
affordability. Some of the factors that can affect the cost of networking include the distance 
between networks and the types of technology available at locations throughout the world. 
In remote or less - developed locations, you may not even be able to get access through an 
ISP or telecom beyond a satellite connection or dial - up, and what is available can be quite 
costly. Network designers must keep these factors in mind, and often they must settle for 
less - than - ideal connectivity. 
 Before, we considered the monetary value of doing business: now let ’ s consider another 
deﬁ nition of cost. When designing and conﬁ guring networks, you can require certain 
devices to automatically make data transport decisions based on an assigned network 
cost. These devices are commonly known as routers, and they use routing protocols to 
make routing decisions. One of the elements a router uses to conﬁ gure a routing protocol 
is its ability to adjust the cost of a route. For example, a router might have multiple ways 
to connect to a remote site, and it may have multiple interfaces connected to it, each with 
different paths out of the network to which it is connected locally. When two or more 
routes are available, you can set up a routing protocol that states that the route with the 
lower cost is automatically used ﬁ rst. 
 Another cost is personnel. Do you have the personnel to do the job, or do you need to 
hire a consultant? Remember that even if you use individuals already on staff, they will be 
spending time on these projects. When your IT team is working on a project, that is a cost 
because they cannot also be working on day - to - day tasks. 
 All of these factors play an important role when you make your Active Directory 
implementation decisions.  
 Overview of Active Directory 
Replication and Sites 
 We now need to cover two topics that are not only covered heavily on the Microsoft 
exams but are also two areas that all IT administrators should understand. Understanding 
Active Directory replication and sites can help you ﬁ ne - tune a network to run at peak 
performance. 
 Replicating Active Directory 
 Regardless of the issues related to network design and technological constraints, network 
users have many different requirements and needs that must be addressed. First and 
foremost, network resources such as ﬁ les, printers, and shared directories must be made 
available. Similarly, the resources stored within Active Directory — and, especially, its 
security information — are required for many operations that occur within domains. 
 With these issues in mind, take a look at how you can conﬁ gure Active Directory to 
reach connectivity goals using replication. 

 Active Directory was designed as a scalable, distributed database that contains 
information about an organization ’ s network resources. In previous chapters, we looked at 
how you can create and manage domains and how you can use domain controllers to store 
Active Directory databases. 
 Even in the simplest of network environments, you generally need more than one domain 
controller. The major reasons for this include fault tolerance (if one domain controller fails, 
others can still provide services as needed) and performance (the workload can be balanced 
between multiple domain controllers). Windows Server 2008 R2 domain controllers have 
been designed to contain read - write copies of the Active Directory database as well as read -
 only copies of the Active Directory database. However, the domain controllers must also 
remain current when objects are created or modiﬁ ed on other domain controllers. 
 To keep information consistent between domain controllers, you use  Active Directory 
replication . Replication is the process by which changes to the Active Directory database 
are transferred between domain controllers. The result is that all of the domain controllers 
within an Active Directory domain contain up - to - date information and achieved 
convergence. Keep in mind that domain controllers may be located very near to each other 
(for example, within the same server rack), or they may be located across the world from 
each other. Although the goals of replication are quite simple, the real - world constraints of 
network connections between servers cause many limitations that you must accommodate. 
If you have a domain controller on your local LAN, you may ﬁ nd that between your server 
connections you have Gigabit Ethernet, which runs at 1000 Mbps, whereas you may have a 
domain controller on the other side or a WAN where the network link runs at a fraction of 
a T1, 56 Kbps. Replication trafﬁ c must traverse each link to ensure convergence no matter 
what the speed or what bandwidth is available. 
 Throughout this chapter, you will look at the technical details of Active Directory 
replication and how you can use the concept of sites and site links to map the logical 
structure of Active Directory to a physical network topology to help it work efﬁ ciently, no 
matter what type of link you are working with. 
 Understanding Active Directory Site Concepts 
 One of the most important aspects of designing and implementing Active Directory is 
understanding how Active Directory allows you to separate the logical components of the 
directory service from the physical components. 
 The logical components — Active Directory domains, OUs, users, groups, and 
computers — map to the organizational and business requirements of a company. 
 The physical components, on the other hand, are designed based on technical issues 
involved in keeping the network synchronized (that is, making sure all parts of the network 
have the same up - to - date information). Active Directory uses the concept of sites to map to 
an organization ’ s physical network. Stated simply, a  site is a collection of well - connected 
subnets. The technical implications of sites are described later in this chapter. 
 It is important to understand that no speciﬁ ed relationship exists between Active 
Directory domains and Active Directory sites. An Active Directory site can contain many 
Overview of Active Directory Replication and Sites 
183

184 
Chapter 5  Configuring Sites and Replication
domains. Alternatively, a single Active Directory domain can span multiple sites. Figure 5.1 
illustrates this very important characteristic of domains and sites.  
Domain A
Domain A
Domain B
Domain C
Site
One Site,
Multiple Domains
One Domain,
Multiple Sites
Site #1
Domain
Controllers
Site #2
 F I G U R E 5 .1 Potential relationships between domains and sites 
 There are two main reasons to use Active Directory sites: service requests and 
replication. 
 Service Requests 
 Clients often require the network services of a domain controller. One of the most common 
reasons for this is that they need the domain controller to perform network authentication. 
If your Active Directory network is set up with sites, clients can easily connect to the 
domain controller that is located closest to them. By doing this, they avoid many of the 
inefﬁ ciencies associated with connecting to distant domain controllers or to those that are 
located on the other side of a slow network connection. For example, by connecting to a 
local domain controller, you can avoid the problems associated with a saturated network 
link, which might cause two domain controllers to be out of synch with each other. 
 Other network services that clients might access include the Licensing service (for 
tracking licenses associated with Microsoft and other compatible products) and the services 
used by messaging applications (such as Exchange Server). All of these functions depend on 
the availability of network services.  
 Replication 
 As we mentioned earlier, the purpose of Active Directory replication is to ensure that the 
information stored on all domain controllers within a domain remains synchronized. In 
environments with many domains and domain controllers, usually multiple communication 

paths connect them, which makes the synchronization process more complicated. A simple 
method of transferring updates and other changes to Active Directory involves all of the 
servers communicating directly with each other as soon as a change occurs; they can all 
update with the change and reach convergence again. This is not ideal, however, since 
it places high requirements on network bandwidth and is inefﬁ cient for many network 
environments that use slower and more costly WAN links, especially if all environments 
update at the same time. Such simultaneous updating could cause the network connection at 
the core of your network to become saturated and decrease performance of the entire WAN. 
 Using sites, Active Directory can automatically determine the best methods for 
performing replication operations. Sites take into account an organization ’ s network 
infrastructure, and Active Directory uses these sites to determine the most efﬁ cient method 
for synchronizing information between domain controllers. Systems administrators can 
make their physical network design map to Active Directory objects. Based on the creation 
and conﬁ guration of these objects, the Active Directory service can then manage replication 
trafﬁ c in an efﬁ cient way. 
 Whenever a change is made to the Active Directory database on a domain controller, 
the change is given an update sequence number. The domain controller can then propagate 
these changes to other domain controllers based on replication settings. 
 Windows Server 2008 R2 uses a feature called  linked value replication  that is active 
only when the domain is in Windows Server 2003, Windows Server 2008, or Windows 
Server 2008 R2 domain functional level. In Windows 2000, if a change was made to a 
member of a group, the entire group was replicated. With linked value replication, only the 
group member is replicated. This greatly enhances replication efﬁ ciency and cuts down on 
network trafﬁ c utilization. Linked value replication is automatically enabled in Windows 
Server 2003, Windows Server 2008, or Windows Server 2008 R2 domain functional - level 
domains.  
 Planning Your Sites 
 Much of the challenge of designing Active Directory is related to mapping a company ’ s 
business processes to the structure of a hierarchical data store. So far, you ’ ve seen many 
of these requirements. But what about the existing network infrastructure? Clearly, when 
you plan for and design the structure of Active Directory, you must take into account your 
LAN and WAN characteristics. Let ’ s see some of the ways you can use Active Directory 
sites to manage replication trafﬁ c. 
 Synchronizing Active Directory is extremely important. In order to keep security 
permissions and objects within the directory consistent throughout the organization, you 
must use replication. Active Directory data store supports  multimaster replication ; that 
is, data can be modiﬁ ed at any domain controller within the domain because replication 
ensures that information remains consistent throughout the organization. 
 Ideally, every site within an organization has reliable, high - speed connections with the 
other sites. A much more realistic scenario, however, is one in which bandwidth is limited 
and connections are sometimes either sporadically available or completely unavailable. 
 Using sites, network and systems administrators can deﬁ ne which domain controllers 
are located on which areas of the network. These settings can be based on the bandwidth 
Overview of Active Directory Replication and Sites 
185

186 
Chapter 5  Configuring Sites and Replication
available between the areas of the network. Additionally, these administrators can deﬁ ne 
 subnets — logically partitioned areas of the network — between areas of the network. 
Subnets are designed by subdividing IP addresses into usable blocks for assignment, and 
they are also objects found within the Sites and Services Microsoft Management Console 
(MMC) in the  Administrative Tools folder. The Windows Server 2008 R2 Active 
Directory services use this information to decide how and when to replicate data between 
domain controllers. 
 Directly replicating information between all domain controllers might be a viable 
solution for some companies. For others, however, this might result in a lot of trafﬁ c 
traveling over slow or undersized network links. One way to efﬁ ciently synchronize 
data between sites that have slow connections is to use a  bridgehead server . Bridgehead 
servers are designed to accept trafﬁ c between two remote sites and to then forward 
this information to the appropriate servers. Figure 5.2 provides an example of how a 
bridgehead server can reduce network bandwidth requirements and improve performance. 
Reduced network bandwidth requirements and improved performance can also be achieved 
by conﬁ guring replication to occur according to a predeﬁ ned schedule if bandwidth usage 
statistics are available.  
India
China
Hong Kong
Bridgehead
Server
Asia
H.Q.
Domain
Controller
Corporate
H.Q.
Site #1
Site #2
North America
Asia
= Replication
 F I G U R E 5 . 2 Using a bridgehead server 
 Bridgehead servers do not ﬁ t a normal hub - and - spoke WAN topology. Such a topology 
usually involves a core site (for example, company headquarters) with remote sites as links 
one off from the core. However, you can use a bridgehead server design to ﬁ t a distributed 
star, where you have a hub - and - spoke topology design, with additional spokes coming out 
of the ﬁ rst set of spokes. Doing so would make some of your spoke sites into smaller core 
sites; it is at these sites that you would place your bridgehead servers. In Figure 5.2, you 

can see that your Asia headquarters site is also where you can connect to India, China, and 
Hong Kong — thus making the Asia headquarters the ideal site for the bridgehead server. 
 In addition to managing replication trafﬁ c, sites also offer the advantage of allowing 
clients to access the nearest domain controller. This prevents problems with user 
authentication across slow network connections, and it can help ﬁ nd the shortest and 
fastest path to resources such as ﬁ les and printers. Therefore, Microsoft recommends that 
you place at least one domain controller at each site that contains a slow link. Preferably, 
this domain controller also contains a copy of the Global Catalog so that logon attempts 
and resource search queries do not occur across slow links. The drawback, however, is that 
deploying more copies of the Global Catalog to servers increases replication trafﬁ c. 
 Through proper planning and deployment of sites, organizations can best use the 
capabilities of the network infrastructure while keeping Active Directory synchronized.  
 Understanding Distributed File System Replication 
 DFS Replication was created to replace the File Replication Service (FRS) that was introduced 
in the Windows 2000 Server operating systems. DFSR is a state - based, multimaster 
replication engine that supports replication scheduling and bandwidth throttling. DFS has 
the ability to detect insertions, removals, and rearrangements of data in ﬁ les. This allows DFS 
Replication to replicate only the changed ﬁ le blocks when ﬁ les are updated. 
 The DFS Replication component uses many different processes to keep data 
synchronized on multiple servers. To understand the DFSR process, it is helpful to 
understand some of the following concepts: 
 
  DFSR is a multimaster replication engine, and changes that occur on one of the mem-
bers are then replicated to all of the other members of the replication group.  
 
  DFSR uses the update sequence number (USN) journal to detects changes on the 
volume, and then DFSR replicates the changes only after the file is closed.  
 
  Before sending or receiving a file, DFSR uses a staging folder to stage the file.  
 
  When a file is changed, DFSR replicates only the changed blocks and not the entire file. 
The RDC protocol is what helps determine the blocks that have changed in the file.  
 
  One of the advantages of DFSR is that it is self - healing and can automatically recover 
from USN journal wraps, USN journal loss, or loss of the DFS Replication database.  
 
  Windows Server 2008 R2 DFSR includes the ability to add a failover cluster as a 
member of a replication group. 
 
  Windows Server 2008 R2 DFSR allows for read - only replicated folders on a particular 
member in which users cannot add or change files.  
 
  In Windows Server 2008 R2 it is possible to make changes to the  SYSVOL folder of 
an RODC. 
 The  Dfsrdiag.exe command - line tool includes three new Windows Server 2008 R2 
command - line switches that provide enhanced diagnostic capabilities for DFSR.  
Overview of Active Directory Replication and Sites 
187

188 
Chapter 5  Configuring Sites and Replication
  Dfsrdiag.exe ReplState  When you use the  ReplState switch, a summary of the replication 
status across all connections on the speciﬁ ed replication group member is provided. The 
 ReplState switch takes a snapshot of the internal state of the DFSR service, and the 
updates that are currently being processed (downloaded or served) by the service are shown 
in a list. 
 Dfsrdiag.exe IdRecord  The DFSR service, when replicating a ﬁ le or folder, creates an ID 
record, and an administrator can use this ID record to determine if a ﬁ le has replicated 
properly to a speciﬁ c member. The  IdRecord switch returns the DFSR ID record for the ﬁ le 
or folder that you specify by using its path or its Unique Identiﬁ er (UID).  
  Dfsrdiag.exe FileHash  The  FileHash switch, when used against a particular ﬁ le, 
will compute and display the hash value that is generated by the DFSR service. An 
administrator can then look at the hash values to compare two ﬁ les. If the hash values for 
the two ﬁ les are the same, then the two ﬁ les are the same.  
 Implementing Sites and Subnets 
 Now that you have an idea of the goals of replication, look at the following quick overview 
of the various Active Directory objects that are related to physical network topology. 
 The basic objects that are used for managing replication include the following:
 Subnets   A subnet is a partition of a network. As we started to discuss earlier, subnets are 
logical IP blocks usually connected to other IP blocks through the use of routers and other 
network devices. All of the computers that are located on a given subnet are generally well 
connected with each other.  
 It is extremely important to understand the concepts of TCP/IP and the 
routing of network information when you are designing the topology for 
Active Directory replication. Although TCP/IP is not tested heavily in this 
exam, you should still generally understand it so that you know how to 
deploy sites properly. TCP/IP is covered in detail in Part 2 of the book, 
 “ Infrastructure. ” 
  Sites   An Active Directory site is a logical object that can contain servers and other objects 
related to Active Directory replication. Speciﬁ cally, a site is a grouping of related subnets. 
Sites are created to match the physical network structure of an organization. Sites are 
primarily used for slow WAN links. If your network is well connected (using ﬁ ber optics, 
Category 5 Ethernet, etc.), then sites are not needed.  
  Site Links   A  site link is created to deﬁ ne the types of connections that are available 
between the components of a site. Site links can reﬂ ect a relative cost for a network 
connection and can reﬂ ect the bandwidth that is available for communications.  

 All of these components work together to determine how information is used to 
replicate data between domain controllers. Figure 5.3 provides an example of the physical 
components of Active Directory.  
Site #1
Site #2
Domain
Controllers
Site Link
Site Link
Site Link
Bridge
Subnet 1
Site #3
 F I G U R E 5 . 3 Active Directory replication objects 
 Many issues are related to conﬁ guring and managing sites; all are covered in this 
chapter. Overall, using sites allows you to control the behavior of Active Directory 
replication between domain controllers. With this background and goal in mind, let ’ s look 
at how you can implement sites to control Active Directory replication so that it is efﬁ cient 
and in synch. 
 If you do not have replication set up properly, you will experience problems with your 
domain controllers after awhile. An example of a common replication problem is Event Log 
event ID 1311, which states that the Windows NT Directory Services (NTDS) Knowledge 
Consistency Checker (KCC) has found (and reported) a problem with Active Directory 
replication. This error message states that the replication conﬁ guration information in 
Active Directory does not accurately reﬂ ect the physical topology of the network. This 
error is commonly found on ailing networks that have replication problems for one reason 
or another. 
 Creating Sites 
 The primary method for creating and managing Active Directory replication components 
is to utilize the Active Directory Sites and Services tool or the MMC found within the 
 Administrative Tools folder. Using this administrative component, you can graphically 
create and manage sites in much the same way you create and manage OUs. 
Implementing Sites and Subnets 
189

190 
Chapter 5  Configuring Sites and Replication
 Exercise 5.1 walks you through the process of creating Active Directory sites. In order 
for you to complete this exercise, the local machine must be a domain controller. Also, this 
exercise assumes that you have not yet changed the default domain site conﬁ guration.  
 Do not perform any testing on a production system or network — make sure 
you test site configuration in a lab setting only.  
 E X E R C I S E  5 .1
Creating Sites  
 1. 
  Open the Active Directory Sites and Services tool from the Administrative Tools 
program group.  
 2. 
  Expand the  Sites folder. 
 3. 
  Right - click the Default - First - Site - Name item, and choose Rename. Rename the site to 
 CorporateHQ . 
 4. 
  Create a new site by right - clicking the Sites object and selecting New Site. 
 5. 
  On the New Object  - Site dialog box, type  Farmington for the site name. Click the 
DEFAULTIPSITELINK item, and an information screen pops up; then click OK to create the 
site. Note that you cannot include spaces or other special characters in the name of a site.  

 6. 
  Notice that the Farmington site is now listed under the Sites object. 
Implementing Sites and Subnets 
191

192 
Chapter 5  Configuring Sites and Replication
E X E R C I S E  5 .1  (c o n t i n u e d)
 7. 
  Create another new site and name it  Portsmouth . Again, choose the 
DEFAULTIPSITELINK item. Notice that the new site is listed under the Sites object.  
 8. 
  When you have ﬁ nished, close the Active Directory Sites and Services tool.  
 Creating Subnets 
 Once you have created the sites that map to your network topology, it ’ s time to deﬁ ne the 
subnets that deﬁ ne the site boundaries. 
 Subnets are based on TCP/IPv4 or TCP/IPv6 address information. For example, the IPv4 
address may be  10.10.0.0 , and the subnet mask may be  255.255.0.0 . This information 
speciﬁ es that all of the TCP/IP addresses that begin with the ﬁ rst two octets are part of the 
same TCP/IP subnet. All of the following TCP/IP addresses would be within this subnet: 
 
  10.10.1.5 
 
  10.10.100.17 
 
  10.10.110.120 
 The Active Directory Sites and Services tool expresses these subnets in a somewhat 
different notation. It uses the provided subnet address and appends a slash followed by the 
number of bits in the subnet mask. In the example in the previous paragraph, the subnet 
would be deﬁ ned as  10.1.0.0/16 . 

 Remember that sites typically represent distinct physical locations and almost always 
have their own subnets. The only way for a domain controller (DC) in one site to reach 
a DC in another site is to add subnet information about the remote site. Generally, 
information regarding the deﬁ nition of subnets for a speciﬁ c network environment will 
be available from a network designer. Exercise 5.2 walks you through the steps you need 
to take to create subnets and assign subnets to sites. In order to complete the steps in this 
exercise, you must have ﬁ rst completed Exercise 5.1.  
 E X E R C I S E  5 . 2
Creating Subnets  
 1. 
  Open the Active Directory Sites and Services tool from the Administrative Tools 
program group.  
 2. 
  Expand the  Sites folder. Right - click the  Subnets folder, and select New Subnet.  
 3. 
  In the New Object  -  Subnet dialog box, you are prompted for information about the IPv4 
or IPv6 details for the new subnet. For the preﬁ x, type   10.10.1.0/24  (we are staying with 
the more commonly used IPv4). This actually calculates out to  10.10.1.0 with the mask 
of  255.255.255.0 . Click the Farmington site, and then click OK to create the subnet.  
 4. 
  In the Active Directory Sites and Services tool, right - click the newly created 
 10.10.1.0/24 subnet object, and select Properties. 
 5. 
  On the subnet ’ s Properties dialog box, type  Farmington 100Mbit LAN for the 
description. Click OK to continue.  
Implementing Sites and Subnets 
193

194 
Chapter 5  Configuring Sites and Replication
E X E R C I S E  5 . 2  (c o n t i n u e d)
 6. 
  Create a new subnet using the following information:  
 Address:   160.25.0.0/16  
 Site:  Portsmouth 
 Description:  Portsmouth 100Mbit LAN 
 7. 
  Finally, create another subnet using the following information:  
 Address:   176.33.0.0/16  
 Site:  CorporateHQ 
 Description:  Corporate 100Mbit switched LAN 
 The Active Directory Sites and Services tool should now look like this:  
 8. 
  When ﬁ nished, close the Active Directory Sites and Services tool. 

 So far, you have created the basic components that govern Active Directory sites: sites 
and subnets. You also linked these two components together by deﬁ ning which subnets 
belong in which sites. These two steps — creating sites and subnets — form the basis of 
mapping the physical network infrastructure of an organization to Active Directory. Now, 
look at the various settings that you can make for sites.  
 Configuring Sites 
 Once you have created Active Directory sites and deﬁ ned which subnets they contain, it ’ s 
time to make some additional conﬁ guration settings for the site structure. Speciﬁ cally, 
you ’ ll need to assign servers to speciﬁ c sites and conﬁ gure the site - licensing options. By 
placing servers in sites, you tell Active Directory replication services how to replicate 
information for various types of servers. Later in this chapter, you ’ ll look at the details of 
working with replication within and between sites. 
 In Exercise 5.3, you will add servers to sites and conﬁ gure CorpDC1 options. In order to 
complete the steps in this exercise, you must have ﬁ rst completed Exercises 5.1 and 5.2.  
 E X E R C I S E  5 . 3
Configuring Sites  
 1. 
  Open the Active Directory Sites and Services tool from the Administrative Tools 
program group.  
 2. 
  Expand the  Sites folder, and click and expand the Farmington site.  
 3. 
  Right - click the Servers container in the Farmington site, and select New   Server. Type 
 FarmingtonDC1 for the name of the server, and then click OK.  
 4. 
  Create a new Server object within the CorporateHQ site, and name it  CorpDC1 . Note that 
this object also includes the name of the local domain controller. 
Implementing Sites and Subnets 
195

196 
Chapter 5  Configuring Sites and Replication
E X E R C I S E  5 . 3  (c o n t i n u e d)
 5. 
  Create two new Server objects within the Portsmouth site, and name them 
 PortsmouthDC1 and  PortsmouthDC2 . The Active Directory Sites and Services tool 
should now look like this:  
 6. 
  Right - click the CorpDC1 server object and select Properties. In the General tab of the 
CorpDC1 Properties box, select STMP in the Transports Available For Inter - site Data 
Transfer box, and click Add to make this server a preferred IP bridgehead server. Click 
OK to accept the settings.  
 7. 
  When you have ﬁ nished, close the Active Directory Sites and Services tool.  

 With the conﬁ guration of the basic settings for sites out of the way, it ’ s time to focus on 
the real details of the site topology — creating site links and site link bridges.  
 Configuring Replication 
 Sites are generally used to deﬁ ne groups of computers that are located within a single 
geographic location. In most organizations, machines that are located in close physical 
proximity (for example, within a single building or branch ofﬁ ce) are well connected. A 
typical example is a LAN in a branch ofﬁ ce of a company. All of the computers may be 
connected using Ethernet, and routing and switching technology may be in place to reduce 
network congestion. 
 Often, however, domain controllers are located across various states, countries, and 
even continents. In such a situation, network connectivity is usually much slower, less 
reliable, and more costly than that for the equivalent LAN. Therefore, Active Directory 
replication must accommodate accordingly. When managing replication trafﬁ c within 
Active Directory sites, you need to be aware of two types of synchronization:
 Intrasite   Intrasite replication refers to the synchronization of Active Directory 
information between domain controllers that are located in the same site. In accordance 
with the concept of sites, these machines are usually well connected by a high - speed LAN.  
 Intersite   Intersite replication occurs between domain controllers in different sites. 
Usually, this means that there is a WAN or other type of low - speed network connection 
between the various machines. Intersite replication is optimized for minimizing the amount 
of network trafﬁ c that occurs between sites.  
 In the following sections, you ’ ll look at ways to conﬁ gure both intrasite and intersite 
replication. Additionally, you ’ ll see features of Active Directory replication architecture 
that you can use to accommodate the needs of almost any environment. 
 Intrasite Replication 
 Intrasite replication is generally a simple process. One domain controller contacts the 
others in the same site when changes to its copy of Active Directory are made. It compares 
the update sequence numbers in its own copy of Active Directory with those of the other 
domain controllers, then the most current information is chosen by the DC in question, and 
all domain controllers within the site use this information to make the necessary updates to 
their database. 
 Because you can assume that the domain controllers within an Active Directory site are 
well connected, you can pay less attention to exactly when and how replication takes place. 
Communications between domain controllers occur using the  Remote Procedure Call 
(RPC) protocol . This protocol is optimized for transmitting and synchronizing information 
on fast and reliable network connections. The RPC protocol provides for fast replication at 
Configuring Replication 
197

198 
Chapter 5  Configuring Sites and Replication
the expense of network bandwidth, which is usually readily available because most LANs 
today are running on Fast Ethernet (100 Mbps) at a minimum.  
 Intersite Replication 
 Intersite replication is optimized for low - bandwidth situations and network connections 
that have less reliability. Intersite replication offers several features that are tailored toward 
these types of connections. To begin with, two different protocols may be used to transfer 
information between sites:
  RPC over IP  When connectivity is fairly reliable, IP is a good choice. IP - based 
communications require you to have a live connection between two or more domain 
controllers in different sites and let you transfer Active Directory information. RPC over IP 
was originally designed for slower WANs in which packet loss and corruption may occur 
often.  
  Simple Mail Transfer Protocol   Simple Mail Transfer Protocol (SMTP) is perhaps best 
known as the protocol that is used to send and receive email messages on the Internet. 
SMTP was designed to use a store - and - forward mechanism through which a server receives 
a copy of a message, records it to disk, and then attempts to forward it to another email 
server. If the destination server is unavailable, it holds the message and attempts to resend it 
at periodic intervals. 
 This type of communication is extremely useful for situations in which network 
connections are unreliable or not always available. If, for instance, a branch office in Peru 
is connected to the corporate office by a dial - up connection that is available only during 
certain hours, SMTP would be a good choice for communication with that branch. 
 SMTP is an inherently insecure network protocol. Therefore, if you would like to ensure 
that you transfer replication traffic securely and you use SMTP for Active Directory 
replication, you must take advantage of Windows Server 2008 R2 ’ s Certificate Services 
functionality.  
 Other intersite replication characteristics are designed to address low - bandwidth 
situations and less - reliable network connections. These features give you a high degree of 
ﬂ exibility in controlling replication conﬁ guration. They include the following: 
 
  Compression of Active Directory information. This compression is helpful because 
changes between domain controllers in remote sites may include a large amount of 
information and also because network bandwidth tends to be less available and 
more costly.  
 
  Site links and site link bridges help determine intersite replication topology.  
 
  Replication can occur based on a schedule defined by systems administrators.  
 You can conﬁ gure intersite replication by using the Active Directory Sites and Services 
tool. Select the name of the site for which you want to conﬁ gure settings. Then, right - click 
the NTDS Site Settings object in the right windowpane, and select Properties. By clicking 

the Change Schedule button in the NTDS Site Settings Properties dialog box, you ’ ll be able 
to conﬁ gure how often replication between sites will occur (see Figure 5.4).  
 F I G U R E 5 . 4 Configuring intersite replication schedules 
 You will see how to set the replication schedule in Exercise 5.4.  
 In the following sections, you will see how to conﬁ gure site links and site link bridges, 
as well as how to manage connection objects and bridgehead servers. 
 Creating Site Links and Site Link Bridges 
 The overall topology of intersite replication is based on the use of site links and site 
link bridges.  Site links are logical connections that deﬁ ne a path between two Active 
Directory sites. Site links can include several descriptive elements that deﬁ ne their network 
characteristics.  Site link bridges are used to connect site links so that the relationship can 
be transitive. Figure 5.5 provides an example of site links and site link bridges. 
 Both of these types of logical connection are used by Active Directory services to 
determine how information should be synchronized between domain controllers in remote 
sites. This information is used by the Knowledge Consistency Checker (KCC), which forms 
a replication topology based on the site topology created. The KCC service is responsible 
for determining the best way to replicate information within sites.  
Configuring Replication 
199

200 
Chapter 5  Configuring Sites and Replication
 When creating site links for your environment, you ’ ll need to consider the following 
factors:
  Transporting Information   You can choose to use either RPC over IP or SMTP for 
transferring information over a site link. You will need to determine which is best based on 
your network infrastructure and the reliability of connections between sites.  
  Assigning a Cost Value   You can create multiple site links between sites and assign site 
links a cost value based on the type of connection. The systems administrator determines the 
cost value, and the relative costs of site links are then used (by the system) to determine 
the optimal path for replication. The lower the cost, the more likely the link is to be used 
for replication. 
 For example, a company may primarily use a T1 link between branch offices, but it may also 
use a slower and circuit - switched dial - up ISDN connection for redundancy (in case the T1 
fails). In this example, a systems administrator may assign a cost of 25 to the T1 line and a 
cost of 100 to the ISDN line. This ensures that the more reliable and higher - bandwidth T1 
connection is used whenever it ’ s available but that the ISDN line is also available. 
  Determining a Replication Schedule   Once you ’ ve determined how and through which 
connections replication will take place, it ’ s time to determine when information should be 
replicated. Replication requires network resources and occupies bandwidth. Therefore, you 
need to balance the need for consistent directory information with the need to conserve 
bandwidth. For example, if you determine that it ’ s reasonable to have a lag time of 6 hours 
between when an update is made at one site and when it is replicated to all others, you 
might schedule replication to occur once in the morning, once during the lunch hour, and 
more frequently after normal work hours.  
Site #1
Site Link
Site Link
Data
Site Link
Bridge
Site #3
Site #2
 F I G U R E 5 . 5 An example of site links and site link bridges 

 Based on these factors, you should be able to devise a strategy that allows you to 
conﬁ gure site links. 
 Exercise 5.4 walks you through the process of creating site links and site link bridges. 
In order to complete the steps in this exercise, you must have ﬁ rst completed Exercises 5.1, 
5.2, and 5.3.  
 E X E R C I S E  5 . 4
Creating Site Links and Site Link Bridges 
 1. 
  Open the Active Directory Sites and Services tool from the Administrative Tools 
program group. 
 2. 
  Expand the Sites, Inter - site Transports, and IP objects. Right - click the 
DEFAULTIPSITELINK item in the right pane, and select Rename. Rename the object 
 CorporateWAN . 
 3. 
  Right - click the CorporateWAN link, and select Properties. In the General tab of the 
CorporateWAN Properties dialog box, type  T1 Connecting Corporate and Portsmouth 
Ofﬁ ces for the description. Remove the Farmington site from the link by highlighting 
Farmington in the Sites In This Site Link box and clicking Remove. For the Cost value, 
type  50 , and specify that replication should occur every  60 minutes. To create the site 
link, click OK. 
 4. 
  Right - click the IP folder, and select New Site Link. On the New Object  -  Site Link dialog 
box, name the link  CorporateDialup . Add the Farmington and CorporateHQ sites to the 
site link and then click OK. 
 5. 
  Right - click the CorporateDialup link, and select Properties. In the General tab of the 
CorporateDialup Properties dialog box, type  ISDN Dialup between Corporate and 
Farmington for the description. Set the Cost value to  100 , and specify that replication 
should occur every  120 minutes. To specify that replication should occur only during 
certain times of the day, click the Change Schedule button. 
 6. 
  On the Schedule ForCorporateDialup dialog box, highlight the area between 8:00 a.m. 
and 6:00 p.m. for the days Monday through Friday, and click the Replication Not 
Available option. This will ensure that replication trafﬁ c is minimized during normal 
work hours. 
 
 Click OK to accept the new schedule and then OK again to create the site link. 
 7. 
  Right - click the IP object, and select New Site Link Bridge. On the New Object  -  Site 
Link Bridge dialog box, name the site link bridge  CorporateBridge . Note that the 
CorporateDialup and CorporateWAN site links are already added to the site link bridge. 
Because there must be at least two site links in each bridge, you will not be able to 
remove these links. Click OK to create the site link bridge. 
 8. 
  When ﬁ nished, close the Active Directory Sites and Services tool. 
Configuring Replication 
201

202 
Chapter 5  Configuring Sites and Replication
 Creating Connection Objects 
 Generally, it is a good practice to allow Active Directory ’ s replication mechanisms to 
automatically schedule and manage replication functions. In some cases, however, you 
may want to have additional control over replication. Perhaps you want to replicate certain 
changes on demand (for example, when you create new accounts). Or you may want to 
specify a custom schedule for certain servers. 
 Connection objects provide you with a way to set up these different types of replication 
schedules. You can create connection objects with the Active Directory Sites and Services 
tool by expanding a server object, right - clicking the NTDS Settings object, and selecting 
New Active Directory Domain Services Connection (see Figure 5.6).  
 F I G U R E 5 .6 Creating a new Active Directory Domain Services connection 
 Within the properties of the connection object, which you can see in the right pane of 
the Active Directory Sites and Services tool, you can specify the type of transport to use for 
replication (RPC over IP or SMTP), the schedule for replication, and the domain controllers 
that participate in the replication. Additionally, you can right - click the connection object 
and select Replicate Now.  

 Ensure that if you kick off a manual replication, you don ’ t do it during 
business hours if you think you do not have the bandwidth available to 
accomplish it. If you do it during business hours, you will most likely create a 
network slowdown if you do not plan properly. It ’ s safer to plan a test during 
non - business hours or during times of very little activity on the network.  
 Moving Server Objects between Sites 
 Using the Active Directory Sites and Services tool, you can easily move servers between 
sites. To do this, simply right - click the name of a domain controller and select Move. You 
can then select the site to which you want to move the domain controller object. 
 Figure 5.7 shows the Move Server dialog box. After the server is moved, all replication 
topology settings are updated automatically. If you want to choose custom replication 
settings, you ’ ll need to manually create connection objects (as described earlier).  
 F I G U R E 5 .7 Choosing a new site for a specific server 
 In Exercise 5.5, you move a server object between sites. In order to complete the steps in 
this exercise, you must have ﬁ rst completed the previous exercises in this chapter.  
 E X E R C I S E  5 . 5
Moving Server Objects Between Sites  
 1. 
  Open the Active Directory Sites and Services administrative tool.  
 2. 
  Right - click the server named PortsmouthDC1, and select Move.  
Configuring Replication 
203

204 
Chapter 5  Configuring Sites and Replication
E X E R C I S E  5 . 5  (c o n t i n u e d)
 3. 
  In the Move Server dialog box, select the Farmington site, and then click OK. This moves 
this server to the Farmington site.  
 4. 
  To move the server back, right - click PortsmouthDC1 (now located in the Farmington 
site) and then click Move. Select Portsmouth for the destination site.  
 5. 
  When ﬁ nished, close the Active Directory Sites and Services administrative tool. 
 Creating Bridgehead Servers 
 By default, all of the servers in one site communicate with all of the servers in another site. 
You can, however, further control replication between sites by using  bridgehead servers . 
As we mentioned earlier in the chapter, using bridgehead servers helps minimize replication 
trafﬁ c, especially in larger distributed star network topologies, and it allows you to 
dedicate machines that are better connected to receive replicated data. Figure 5.8 provides 
an example of how bridgehead servers work.  
Site #1
Site #2
Site Link
Intersite
Replication
Bridgehead
Server
Intrasite
Replication
Bridgehead
Server
Intrasite
Replication
 F I G U R E 5 . 8 A replication scenario using bridgehead servers 
 You can use a bridgehead server to specify which domain controllers are preferred for 
transferring replication information between sites. Different bridgehead servers can be 
selected for RPC over IP and SMTP replication, thus allowing you to balance the load. 
To create a bridgehead server for a site, simply right - click a domain controller and select 

Properties, which brings up the bridgehead server ’ s Properties dialog box (See Figure 5.9). 
To make the server a bridgehead server, just select one or both replication types (called 
transports) from the left side of the dialog box and click the Add button to add them to the 
right side of the dialog box.  
 F I G U R E 5 . 9 Specifying a bridgehead server 
 Configuring Server Topology 
 When you are using environments that require multiple sites, you must carefully consider 
where you place your servers. In doing so, you can greatly improve performance and the 
end user ’ s experience by reducing the time they must spend performing common operations 
such as authentication or searching Active Directory for resources. 
 There are two main issues to consider when you are designing a distributed Active 
Directory environment. The ﬁ rst is how you should place domain controllers within the 
network environment. The second is how to manage the use of Global Catalog servers. 
Finding the right balance between servers, server resources, and performance can be 
considered an art form for network and systems administrators. In the following sections, 
you ’ ll look at some of the important considerations you must take into account when you 
design a replication server topology. 
Configuring Replication 
205

206 
Chapter 5  Configuring Sites and Replication
 Placing Domain Controllers 
 Microsoft highly recommends that you have at least two domain controllers in each 
domain of your Active Directory environment. As mentioned earlier in this chapter, using 
additional domain controllers provides the following beneﬁ ts: 
 
  Increased network performance:  
 
  The servers can balance the burden of serving client requests.  
 
  Clients can connect to the server closest to them instead of performing authentica-
tion and security operations across a slow WAN link.  
 
  Fault tolerance (in case one domain controller fails, the other still contains a valid and 
usable copy of the Active Directory database).  
 
  In Windows Server 2008 R2, RODCs help increase security when users connect to a 
domain controller in an unsecured remote location.  
 As we just mentioned, having too few domain controllers can be a problem. However, 
you can also have  too many . Keep in mind that the more domain controllers you choose to 
implement, the greater the replication trafﬁ c among them. Because each domain controller 
must propagate any changes to all of the others, compounding services can result in 
increased network trafﬁ c.  
 Placing Global Catalog Servers 
 A  Global Catalog (GC) server is a domain controller that contains a copy of all the objects 
contained in the forest - wide domain controllers that compose the Active Directory database. 
Making a domain controller a GC server is very simple, and you can change this setting 
quite easily. That brings us to the harder part — determining which domain controllers 
should also be GC servers. 
 Where you place domain controllers and GC servers and how many you deploy are very 
important network planning decisions. 
 Generally, you want to make GC servers available in every site that has a slow link. This 
means that the most logical places to put GC servers are in every site and close to the WAN 
link for the best possible connectivity. 
 However, having too many GC servers is a bad thing. The main issue is associated with 
replication trafﬁ c — you must keep each GC server within your environment synchronized 
with the other servers. In a very dynamic environment, using additional GC servers causes 
a considerable increase in network trafﬁ c. 
 Therefore, you will want to ﬁ nd a good balance between replication burdens and GC 
query performance in your own environment. 
 To create a GC server, simply expand the Server object in the Active Directory Sites 
and Services tool, right - click NTDS Settings, and select Properties to bring up the NTDS 
Settings Properties dialog box (see Figure 5.10). To conﬁ gure a server as a GC server, 
simply place a check mark in the Global Catalog box.  

 F I G U R E 5 .10 Enabling the Global Catalog on an Active Directory domain controller 
 Accommodating a Changing Environment 
 You ’ re a systems administrator for a medium - sized business that consists of many 
ofﬁ ces located throughout the world. Some of these ofﬁ ces are well connected because 
they use high - speed, reliable links, while others are not so fortunate. Overall, things are 
going well until your CEO announces that the organization will be merging with another 
large company and that the business will be restructured. The restructuring will involve 
opening new ofﬁ ces, closing old ones, and transferring employees to different locations. 
Additionally, changes in the IT budget will affect the types of links that exist between ofﬁ ces. 
Your job as the systems administrator is to ensure that the network environment and, 
speciﬁ cally, Active Directory keep pace with the changes and ultimately outperform them. 
 An important skill for any technical professional is the ability to quickly and efﬁ ciently 
adapt to a changing organization. When a business grows, restructures, or forms 
relationships with other businesses, often many IT - related changes must also occur. You 
may have to create new network links, for example. Fortunately, Active Directory was 
Configuring Replication 
207

208 
Chapter 5  Configuring Sites and Replication
designed with these kinds of challenges in mind. For example, you can use the Active 
Directory Sites and Services administrative tool to reﬂ ect physical network changes in 
Active Directory topology. If a site that previously had 64 Kbps of bandwidth is upgraded 
to a T1 connection, you can change those characteristics for the site link objects. 
Conversely, if a site that was previously well connected is reduced to a slow, unreliable 
link, you can reconﬁ gure the sites, change the site link transport mechanisms (perhaps 
from IP to SMTP to accommodate a nonpersistent link), and create connection objects 
(which would allow you to schedule replication trafﬁ c to occur during the least busy 
hours). Or suppose that many of your operations move overseas to a European division. 
This might call for designating speciﬁ c domain controllers as preferred bridgehead 
servers to reduce the amount of replication trafﬁ c over costly and slow overseas links. 
 Sweeping organizational changes inevitably require you to move servers between 
sites. For example, an ofﬁ ce may close and its domain controllers may move to another 
region of the world. Again, you can accommodate this change by using Active Directory 
administrative tools. You may change your OU structure to reﬂ ect new logical and 
business - oriented changes, and you can move server objects between sites to reﬂ ect 
physical network changes. 
 Rarely can the job of mapping a physical infrastructure to Active Directory be 
 “ complete. ” In most environments, it ’ s safe to assume that you will always need to make 
changes based on business needs. Overall, however, you should feel comfortable that 
the physical components of Active Directory are at your side to help you accommodate 
these changes. 
 Using Universal Group Membership Caching 
 To understand how UGMC works, you must ﬁ rst understand how authentication works. 
When a user tries to authenticate with a domain controller, the ﬁ rst action that takes place 
is that the domain controller checks with the Global Catalog to see which domain the users 
belongs to. 
 If the domain controller (the one the user is trying to authenticate to) is not a GC, 
then the domain controller sends a request to the GC to verify the user ’ s domain. The GC 
responds with the user ’ s information and the domain controller authenticates the user (if 
the user belongs to the same domain as the domain controller). 
 There are two ways to speed up the authentication process. First, you can make all the 
domain controllers Global Catalogs. But then you end up with a lot of GC replication 
trafﬁ c. This becomes even more of an issue if you have multiple sites. Now replication trafﬁ c 
can be too large for your site link connections. 
 So if you have a slower site link connection, you can use Universal Group Membership 
Caching. If you are using UGMC, after a domain controller communicates with the Global 
Catalog, the domain controller will then cache the user ’ s credentials for 8 hours. Now if the 

user logs off the domain and then relogs back into the domain, the domain controller will 
use the cached credentials and not ask the Global Catalog. The downside to using UGMC 
is that UGMC is for authentication only. Global Catalogs help speed up Active Directory 
searches and work with Directory Service enabled applications (applications that have to 
work with Active Directory) like Exchange and SQL. 
 Monitoring and Troubleshooting Active 
Directory Replication 
 For the most part, domain controllers handle the replication processes automatically. 
However, systems administrators still need to monitor the performance of Active Directory 
replication, since failed network links and incorrect conﬁ gurations can sometimes prevent 
the synchronization of information between domain controllers. 
 You can monitor the behavior of Active Directory replication and troubleshoot the 
process if problems occur. 
 About System Monitor 
 The Windows Server 2008 R2 System Monitor administrative tool was designed so that 
you can monitor many performance statistics associated with using Active Directory. 
Included within the various performance statistics that you can monitor are counters 
related to Active Directory replication.  
 Troubleshooting Replication 
 A common symptom of replication problems is that information is not updated on some or 
all domain controllers. For example, a systems administrator creates a user account on one 
domain controller, but the changes are not propagated to other domain controllers. In most 
environments, this is a potentially serious problem because it affects network security and 
can prevent authorized users from accessing the resources they require. 
 You can take several steps to troubleshoot Active Directory replication; these are 
discussed in the following sections. 
 Verifying Network Connectivity 
 In order for replication to work properly in distributed environments, you must have 
network connectivity. Although ideally all domain controllers would be connected by high -
 speed LAN links, this is rarely the case for larger organizations. In the real world, dial - up 
connections and slow connections are common. If you have veriﬁ ed that your replication 
topology is set up properly, you should conﬁ rm that your servers are able to communicate. 
Problems such as a failed dial - up connection attempt can prevent important Active 
Directory information from being replicated.  
Monitoring and Troubleshooting Active Directory Replication 
209

210 
Chapter 5  Configuring Sites and Replication
 Verifying Router and Firewall Configurations 
 Firewalls are used to restrict the types of trafﬁ c that can be transferred between networks. 
They are mainly used to increase security by preventing unauthorized users from 
transferring information. In some cases, company ﬁ rewalls may block the types of network 
access that must be available in order for Active Directory replication to occur. For 
example, if a speciﬁ c router or ﬁ rewall prevents data from being transferred using SMTP, 
replication that uses this protocol will fail.  
 Examining the Event Logs 
 Whenever an error in the replication conﬁ guration occurs, the computer writes events to 
the Directory Service and File Replication Service event logs. By using the Event Viewer 
administrative tool, you can quickly and easily view the details associated with any 
problems in replication. For example, if one domain controller is unable to communicate 
with another to transfer changes, a log entry is created.  
 Verifying That Information Is Synchronized 
 It ’ s often easy to forget to perform manual checks regarding the replication of Active 
Directory information. One of the reasons for this is that Active Directory domain 
controllers have their own read/write copies of the Active Directory database. Therefore, 
if connectivity does not exist, you will not encounter failures while creating new objects. 
 It is important to periodically verify that objects have been synchronized between 
domain controllers. This process might be as simple as logging on to a different domain 
controller and looking at the objects within a speciﬁ c OU. This manual check, although 
it might be tedious, can prevent inconsistencies in the information stored on domain 
controllers, which, over time, can become an administration and security nightmare.  
 Verifying Authentication Scenarios 
 A common replication conﬁ guration issue occurs when clients are forced to authenticate 
across slow network connections. The primary symptom of the problem is that users 
complain about the amount of time it takes them to log on to Active Directory (especially 
during times of high volume of authentications, such as at the beginning of the workday). 
 Usually, you can alleviate this problem by using additional domain controllers or 
reconﬁ guring the site topology. A good way to test this is to consider the possible scenarios 
for the various clients that you support. Often, walking through a conﬁ guration, such 
as,  “ A client in Domain1 is trying to authenticate using a domain controller in Domain2, 
which is located across a slow WAN connection, ” can be helpful in pinpointing potential 
problem areas.  
 Verifying the Replication Topology 
 The Active Directory Sites and Services tool allows you to verify that a replication topology 
is logically consistent. You can quickly and easily perform this task by right - clicking the 

NTDS Settings within a Server object and choosing All Tasks   Check Replication. If any 
errors are present, a dialog box alerts you to the problem. 
 Another way to verify replication is by using the command - line utility  Repadmin . Table 5.1 
shows some of the  Repadmin commands.  
 TA B L E 5 .1  Repadmin commands 
 Command  
  Description  
 Repadmin Bridgeheads 
 Lists the bridgehead servers for a specified site 
 Repadmin dsaguid 
 Returns a server name when given a GUID  
 Repadmin failcache 
 Shows a list of failed replication events 
 Repadmin istg 
 Returns the server name of the ISTG server for a specified site 
 Repadmin kcc 
 Forces the KCC to recalculate replication topology for a 
 specified domain controller 
 Repadmin latency 
 Shows the amount of time between replications 
 Repadmin queue 
 Shows tasks waiting in the replication queue 
 Repadmin querysites 
 Uses routing information to determine cost of a route from a 
specified site to another specified site or sites  
 Repadmin replicate 
 Starts a replication event for the specified directory partition 
between domain controllers 
 Repadmin replsummary 
 Displays the replication state and relative health of a forest 
 Summary 
 In this chapter we discussed the purpose of Active Directory replication. As you learned, 
replication is used to keep domain controllers synchronized and is important in Active 
Directory environments of all sizes. Replication is the process by which changes to the 
Active Directory database are transferred between domain controllers. 
 This chapter also covered the concepts of sites, site boundaries, and subnets. In addition 
to learning how to conﬁ gure them, you learned that subnets deﬁ ne physical portions of 
your network environment and that sites are deﬁ ned as collections of well - connected IP 
subnets. Site boundaries are deﬁ ned by the subnet or subnets that you include in your site 
conﬁ guration. 
 We also covered the basics of replication and the differences between intrasite and 
intersite replication. We also covered the purpose and use of bridgehead servers in depth. 
Summary 
211

212 
Chapter 5  Configuring Sites and Replication
Although replication is a behind - the - scenes type of task, the optimal conﬁ guration of 
sites in distributed network environments results in better use of bandwidth and faster 
response by network resources. For these reasons, you should be sure that you thoroughly 
understand the concepts related to managing replication for Active Directory. 
 We covered the placement of domain controllers and Global Catalog servers in the 
network and how when placed properly, they can increase the performance of Active 
Directory operations. 
 We also showed how to monitor and troubleshoot replication. The Windows Server 
2008 R2 System Monitor administrative tool was designed so that you can monitor many 
performance statistics associated with using Active Directory.  
 Exam Essentials  
  Understand the purpose of Active Directory replication.   Replication is used to keep 
domain controllers synchronized and is important in Active Directory environments of 
all sizes. Replication is the process by which changes to the Active Directory database are 
transferred between domain controllers.  
  Understand the concept of sites, site boundaries, and subnets.   Subnets deﬁ ne physical 
portions of your network environment. Sites are deﬁ ned as collections of well - connected IP 
subnets. Site boundaries are deﬁ ned by the subnet or subnets that you include in your site 
conﬁ guration.  
 Understand the differences between intrasite and intersite replication.   Intrasite 
replication is designed to synchronize Active Directory information to machines that are 
located in the same site. Intersite replication is used to synchronize information for domain 
controllers that are located in different sites.  
  Understand the purpose of bridgehead servers.   Bridgehead servers are designed to accept 
trafﬁ c between two remote sites and to then forward this information to the appropriate 
servers. One way to efﬁ ciently synchronize data between sites that are connected with slow 
connections is to use a bridgehead server.  
  Implement site links, site link bridges, and connection objects.   You can use all three of 
these object types to ﬁ nely control the behavior of Active Directory replication and to 
manage replication trafﬁ c. Site links are created to deﬁ ne the types of connections that are 
available between the components of a site. Site links can reﬂ ect a relative cost for a network 
connection and can reﬂ ect the bandwidth that is available for communications. You can use 
site link bridges to connect site links so that the relationship can be transitive. Connection 
objects provide you with a way to set up special types of replication schedules such as 
immediate replication on demand or specifying a custom schedule for certain servers.  
  Configure replication schedules and site link costs.   You can create multiple site links 
between sites, and you can assign site links a cost value based on the type of connection. 
The systems administrator determines the cost value, and the relative costs of site links are 

then used to determine the optimal path for replication. The lower the cost, the more likely 
the link is to be used for replication. Once you ’ ve determined how and through which 
connections replication will take place, it ’ s time to determine  when information should be 
replicated. Replication requires network resources and occupies bandwidth. Therefore, you 
need to balance the need for consistent directory information with the need to conserve 
bandwidth.  
 Determine where to place domain controllers and Global Catalog servers based on a set 
of requirements.   Where you place domain controllers and Global Catalog servers can 
positively affect the performance of Active Directory operations. However, to optimize 
performance, you need to know where the best places are to put these servers in a network 
environment that consists of multiple sites.  
 Monitor and troubleshoot replication.   The Windows Server 2008 R2 System Monitor 
administrative tool is designed so that you can monitor many performance statistics 
associated with using Active Directory. In addition to this monitoring, you should always 
verify basic network connectivity and router and ﬁ rewall connections, as well as examine 
the event logs. 
Exam Essentials 
213

214 
Chapter 5  Configuring Sites and Replication
 Review Questions  
 1. 
  You need to deactivate the UGMC option on some of your domain controllers. At which 
level in Active Directory would you deactivate UGMC?  
 A.   Server  
 B.   Site  
 C.   Domain  
 D.   Forest  
  2. 
  You work for an organization with a single domain forest. Your company has one main 
location and two branch locations. All locations are configured as Active Directory sites 
and all sites are connected with the DEFAULTIPSITELINK object. Your connections 
are running slower than the company policy allows. You want to decrease the replication 
latency between all domain controllers in the various sites. What should you do?  
 A.   Decrease the Replication interval for the DEFAULTIPSITELINK object.  
 B.   Decrease the Replication interval for the site.  
 C.   Decrease the Replication schedule for the site.  
 D.   Decrease the Replication schedule for all domain controllers.  
 3. 
 You need to enable three of your domain controllers as Global Catalog servers. Where 
would you configure the domain controllers as Global Catalogs?  
 A.   Forest, NTDS settings  
 B.   Domain, NTDS settings  
 C.   Site, NTDS settings  
 D.   Server, NTDS settings 
 4. 
  Daniel is responsible for managing Active Directory replication traffic for a medium -
 sized organization that has deployed a single Active Directory domain. Currently, the 
environment is configured with two sites and the default settings for replication. Each site 
consists of 15 domain controllers. Recently, network administrators have complained that 
Active Directory traffic is using a large amount of available network bandwidth between 
the two sites. Daniel has been asked to meet the following requirements:  
 
  Reduce the amount of network traffic between domain controllers in the two sites.  
 
  Minimize the amount of change to the current site topology.  
 
  Require no changes to the existing physical network infrastructure.  
 Daniel decides that it would be most efﬁ cient to conﬁ gure speciﬁ c domain controllers in 
each site that will receive the majority of replication trafﬁ c from the other site. Which of the 
following solutions meets the requirements?  
 A.   Create additional sites that are designed only for replication traffic, and move the 
existing domain controllers to these sites.  
 B.   Create multiple site links between the two sites.  
 C.   Create a site link bridge between the two sites.  
 D.   Configure one server at each site to act as a preferred bridgehead server.  

Review Questions 
215
 5. 
  Which of the following does not need to be manually created when you are setting up a 
replication scenario involving three domains and three sites?  
 A.   Sites  
 B.   Site links 
 C.   Connection objects  
 D.   Subnets  
 6. 
 Which of the following services of Active Directory is responsible for maintaining the 
replication topology?  
 A.   File Replication Service  
 B.   Knowledge Consistency Checker  
 C.   Windows Internet Name Service  
 D.   Domain Name System  
 7. 
  Will, a systems administrator for an Active Directory environment that consists of three 
sites, wants to configure site links to be transitive. Which of the following Active Directory 
objects is responsible for representing a transitive relationship between sites?  
 A.   Additional sites 
 B.   Additional site links  
 C.   Bridgehead servers  
 D.   Site link bridges  
 8. 
  You have configured your Active Directory environment with multiple sites and have 
placed the appropriate resources in each of the sites. You are now trying to choose a 
protocol for the transfer of replication information between two sites. The connection 
between the two sites has the following characteristics:  
 
  The link is generally unavailable during certain parts of the day because of an 
unreliable network provider.  
 
  The replication transmission must be attempted whether the link is available or not. 
If the link was unavailable during a scheduled replication, the information should 
automatically be received after the link becomes available again.  
 
  Replication traffic must be able to travel over a standard Internet connection.  
 Which of the following protocols meets these requirements?  
 A.   IP  
 B.   SMTP  
 C.   RPC  
 D.   DHCP  

216 
Chapter 5  Configuring Sites and Replication
 9. 
  A systems administrator suspects that there is an error in the replication configuration. 
How can he look for specific error messages related to replication?  
 A.   By using the Active Directory Sites and Services administrative tool  
 B.   By using the Computer Management tool  
 C.   By going to Event Viewer   System Log 
 D.   By going to Event Viewer   Directory Service Log  
 10.   Christina is responsible for managing Active Directory replication traffic for a medium -
 sized organization. Currently, the environment is configured with a single site and the 
default settings for replication. The site contains more than 50 domain controllers, and the 
system administrators are often making changes to the Active Directory database. Recently, 
network administrators have complained that Active Directory traffic is consuming a large 
amount of network bandwidth between portions of the network that are connected by slow 
links. Ordinarily, the amount of replication traffic is reasonable, but recently users have 
complained about slow network performance during certain hours of the day. 
 Christina has been asked to alleviate the problem while meeting the following 
requirements:  
 
  Be able to control exactly when replication occurs.  
 
  Be able to base Active Directory replication on the physical network infrastructure.  
 
  Perform the changes without creating or removing any domain controllers.  
 Which two of the following steps can Christina take to meet these requirements?  
 A.   Create and define Connection objects that specify the hours during which replication 
will occur.  
 B.   Create multiple site links.  
 C.   Create a site link bridge.  
 D.   Create new Active Directory sites that reflect the physical network topology.  
 E. 
  Configure one server at each of the new sites to act as a bridgehead server.  

 Answers to Review Questions 
1. 
 B .  The NTDS settings for the site level is where you would activate and deactivate UGMC. 
2. 
 A .  By decreasing the Replication interval for the DEFAULTIPSITELINK object, you will 
decrease the replication latency for all sites using the DEFAULTIPSITELINK. 
3. 
 D .  In the Active Directory Sites and Services console, the Server NTDS settings is where 
you would activate and deactivate Global Catalogs. 
4. 
 D .  Preferred bridgehead servers receive replication information for a site and transmit this 
information to other domain controllers within the site. By doing this, Daniel can ensure 
that all replication trafﬁ c between the two sites is routed through the bridgehead servers 
and that replication trafﬁ c will ﬂ ow properly between the domain controllers. 
5. 
 C .  By default, Connection objects are automatically created by the Active 
Directory replication engine. You can choose to override the default behavior of Active Directory 
replication topology by manually creating Connection objects, but this step is not required. 
6. 
 B .  The Knowledge Consistency Checker (KCC) is responsible for establishing the 
replication topology and ensuring that all domain controllers are kept up to date. 
7. 
 D .  Site link bridges are designed to allow site links to be transitive. That is, they allow site 
links to use other site links to transfer replication information between sites. By default, all 
site links are bridged. However, you can turn off transitivity if you want to override this 
behavior. 
8. 
 B .  The Simple Mail Transfer Protocol was designed for environments in which persistent 
connections may not always be available. SMTP uses the store - and - forward method to 
ensure that information is not lost if a connection cannot be made. 
9. 
 D .  The Directory Service event log contains error messages and information related to 
replication. These details can be useful when you are troubleshooting replication problems. 
10.  A, D .  By creating new sites, Christina can help deﬁ ne settings for Active Directory 
replication based on the environment ’ s network connections. She can use Connection 
objects to further deﬁ ne the details of how and when replication trafﬁ c will be transmitted 
between the domain controllers. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswindows2008r2 . 
Answers to Review Questions 
217


Configuring Active 
Directory Server 
Roles  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Active Directory Roles and Services  
 Configure Active Directory Lightweight Directory Service 
(AD LDS). May include but is not limited to: migration 
to AD LDS; configure data within AD LDS; configure an 
authentication server; Server Core installation.  
 Configure Active Directory Rights Management Service (AD 
RMS). May include but is not limited to: certificate request 
and installation; self - enrollments; delegation; create RMS 
templates, RMS administrative roles; RM Add - on for IE.  
 Configure the read - only domain controller (RODC). May 
include but is not limited to: replication; Administrator role 
separation; read - only DNS; BitLocker; credential caching; 
password replication; syskey; read - only SYSVOL; staged 
install.  
 Configure Active Directory Federation Services (AD FS v2). 
May include but is not limited to: install AD FS server role; 
exchange certificate with AD FS agents; configure trust 
policies; configure user and group claim mapping; import 
and export trust policies.  
 Configuring Active Directory Certificate Services 
 Install Active Directory Certificate Services. May include but 
is not limited to: certificate authority (CA) types, including 
standalone, enterprise, root, and subordinate; role services; 
prepare for multiple - forest deployments.  
 Configure CA server settings. May include but is not limited 
to: key archival; certificate database backup and restore; 
assigning administration roles; high - volume CAs; auditing.  








 Chapter 
6

 Manage certificate templates. May include but is 
not limited to: certificate template types; securing 
template permissions; managing different certificate 
template versions; key recovery agent.  
 Manage enrollments. May include but is not limited 
to: network device enrollment service (NDES); auto 
enrollment; Web enrollment; extranet enrollment; 
smart card enrollment; authentication mechanism 
assurance; creating enrollment agents; deploying 
multiple - forest certificates; x.509 certificate mapping.  
 Manage certificate revocations. May include but is not 
limited to: configure Online Responders; Certificate 
Revocation List (CRL); CRL Distribution Point (CDP); 
Authority Information Access (AIA).  




 So far, you have learned how to install the main components 
of Active Directory. At this point, you should be able to install 
Domain Name System (DNS) and Active Directory. You 
should also understand what domains, sites, and trees can do for your organization. 
 In this chapter, we are going to take your domain a step further. First, we are going to 
talk about the Server Manager application, which allows you to install the many different 
server roles. Then we are going to dive into the ﬁ ve main Active Directory server roles and 
talk about what they can do to make your network run more securely and efﬁ ciently.  
 As you most likely noticed, this chapter covers many exam objectives. We 
cannot stress enough how important it is for you to know and understand 
these five Active Directory server roles before you attempt the MCTS 
70 - 640 exam.  
 Understanding Server Manager 
 In Chapter 1,  “ Overview of Active Directory, ”  we brieﬂ y mentioned some of the 
administration tools available in Windows Server 2003, including the Manage Your Server, 
Conﬁ gure Your Server, and Add/Remove Windows components. 
 Windows Server 2008 R2 combines many of these tools in a new Microsoft 
Management Console (MMC) snap - in called  Server Manager . With Server Manager, an 
administrator can view the server conﬁ guration and installed roles. Server Manager also 
includes links for adding and removing features and roles (see Figure 6.1). 
 Server Manager is your one - stop - shopping MMC snap - in. By that, I mean that you can 
take care of all your server management needs in one easy interface. In this chapter, we are 
going to discuss the following roles that you can install and manage using Server Manager.  
 
  Active Directory Certificate Services  
 
  Active Directory Domain Services  
 
  Active Directory Federation Services  
 
  Active Directory Lightweight Directory Services  
 
  Active Directory Rights Management Services  

222 
Chapter 6  Configuring Active Directory Server Roles
 Configuring Active Directory 
Certificate Services 
 Using Active Directory Certiﬁ cate Services (AD CS), administrators conﬁ gure public - key 
certiﬁ cate services. AD CS security allows a private key to be combined with objects (such 
as users and computers), devices (such as routers), or services. The public - key infrastructure 
greatly increases data security. 
 In Windows Server 2008 R2, AD CS provides services for creating and managing public 
key certiﬁ cates used in software security systems that employ public key technologies. 
Organizations can use AD CS to enhance security by binding the identity of a user, device, 
or service to a corresponding private key. AD CS also includes features that allow you to 
manage certiﬁ cate enrollment and revocation in a variety of environments. 
 Think of a digital certiﬁ cate as a carrying case for a public key. A certiﬁ cate contains 
the public key and a set of attributes, like the key holder ’ s name and email address. These 
attributes specify something about the holder: their identity, what they ’ re allowed to 
do with the certiﬁ cate, and so on. The attributes and the public key are bound together 
because the certiﬁ cate is digitally signed by the entity that issued it. Anyone who wants to 
verify the certiﬁ cate ’ s contents can verify the issuer ’ s signature. 
 F I G U R E 6 .1 Server Manager showing Windows Server 2008 server roles 

 Certiﬁ cates are one part of what security experts call a  public - key infrastructure (PKI) . 
A PKI has several different components that you can mix and match to achieve the desired 
results. 
 Applications supported by AD CS include Secure/Multipurpose Internet Mail 
Extensions (S/MIME), secure wireless networks, virtual private networks (VPN), IP 
security (IPSec), Encrypting File System (EFS), smart card logon, Secure Socket Layer/
Transport Layer Security (SSL/TLS), and digital signatures. 
 The following are some of the AD CS components:
 Cert Publishers Group   Certiﬁ cates are used to increase security by allowing for strong 
authentication methods. User accounts are placed within the Cert Publishers group if they 
need to be able to publish security certiﬁ cates. Generally, these accounts are used by Active 
Directory security services.  
 PKI - Savvy Applications   These applications allow you and your users to do useful things 
with certiﬁ cates, like encrypt email or network connections. Ideally, the user shouldn ’ t have 
to know (or even necessarily be aware of) what the application is doing — everything should 
work seamlessly and automatically. The best - known examples of PKI - savvy applications 
are web browsers like Internet Explorer and Firefox and email applications like Outlook 
and Outlook Express. 
 Online Responder Service   Some applications — including S/MIME, SSL, EFS, and 
smart cards — need to validate the status of certiﬁ cates. The Online Responder Service 
authoritatively responds to such requests.  
 Certification Practice Statement   A Certiﬁ cation Practice Statement (CPS) is a statement 
that is issued by a certiﬁ cate creator. It represents the creator ’ s practices for issuing and 
validating certiﬁ cates. The CPS represents the technical, procedural, and personnel policies 
and practices of the issuing certiﬁ cation authority (CA) organization.  
 Enrollment Agents   Enrollment agents are administrators who have the ability to enroll 
users into the certiﬁ cate services program. Enrollment agents can issue and manage 
certiﬁ cate requests. Windows Server 2008 R2 includes three certiﬁ cate templates that allow 
different types of enrollment agents (templates are explained later in this section);  
 
  Enrollment Agent  
 
  Enrollment Agent (Computer)  
 
  Exchange Enrollment Agent (Offline Request)  
 Network Device Enrollment Service   Network devices such as routers do not have 
accounts in the Active Directory Domain. The Network Device Enrollment Service (NDES) 
allows such network devices to obtain certiﬁ cates.  
 Web Enrollment   With the Certiﬁ cate Authority Web Enrollment Role Service, users can 
easily request certiﬁ cates and retrieve Certiﬁ cate Revocation Lists (CRLs) through a web 
browser. It is a good practice to load this service on a member server and not a domain 
controller. This machine can issue certiﬁ cates to web users, and for security reasons you do 
not want a domain controller talking to web - based users. 
Configuring Active Directory Certificate Services 
223

224 
Chapter 6  Configuring Active Directory Server Roles
  Certificate Mapping   Administrators have the ability, for domain user accounts, to 
use certiﬁ cate mapping to control access to network resources. Administrators also can use 
certiﬁ cate mapping to control access to website resources for Internet Information Services.  
  Authentication Mechanism Assurance   Authentication mechanism assurance allows 
applications to control resource access. The resource access control is based on 
authentication strength and method. Administrators have the ability to conﬁ gure 
properties, including authentication type and authentication strength, to a resource. This 
feature is enabled at the Windows Server 2008 R2 domain functional level.  
 Installing Active Directory Certificate Services 
 When you are installing AD CS, the Installation Wizard will walk you through the 
installation process, and you will need to answer some conﬁ guration questions. If at any 
time during installation you do not know how to conﬁ gure an option, you can click the 
help link for explanations. Here are some of the AD CS options that you can conﬁ gure 
during the installation:
  Certificate Authorities   Certiﬁ cate authorities (CAs) issue, revoke, and publish certiﬁ cates 
for their clients; big CAs like Thawte and VeriSign may do this for millions of users. You can 
also set up your own CA for each department or workgroup in your organization if you want. 
 Each CA is responsible for choosing what attributes it will include in a certificate and what 
mechanism it will use to verify those attributes before it issues the certificate. 
 There are three types of CA: 
 
  Enterprise Root CAs (automatically integrated with Active Directory) are the most 
trusted CAs of the hierarchy. They hold the certificates that you issue to the users 
within your organization.  
 
  Stand - Alone Root CAs hold the certificates that you issue to Internet users.  
 
  Subordinate CAs are below the Enterprise and Stand - Alone Root CAs in the hierarchy. 
The Enterprise or Stand - Alone Root CAs give certificates to the Subordinate CAs, 
which in turn issue certificates to objects and services.  
  Cryptographic Service Provider   The cryptographic service provider (CSP) is the 
mechanism that is responsible for authentication, encoding, and encryption services that 
Windows - based applications access through the Microsoft Cryptography application 
programming interface (CryptoAPI). Every CSP offers a unique implementation of the 
CryptoAPI. Some CSPs offer a strong cryptographic algorithm, while others use hardware 
components, such as smart cards.  
  Hash Algorithm   An algorithm that produces a hash value of some piece of data, such 
as a message or session key, is called a  hash algorithm . If you use a well - designed hash 
algorithm, the hash value changes when the data changes. Because of this characteristic, 
hash values are useful when you are trying to detect whether any modiﬁ cations have been 
made to data (such as a message). Also, a well - designed hash algorithm makes it almost 
impossible for two independent inputs to have the same hash value.  

 Exercise 6.1 shows you the steps you need to follow to install the AD CS server. You 
need to complete the exercises in Chapter 3,  “ Active Directory Planning and Installation, ” 
before you attempt Exercise 6.1. 
 E X E R C I S E  6 .1
Installing Active Directory Certificate Services  
 1. 
  Open the Server Manager MMC by selecting Start   Administrative Tools   Server 
Manager. 
 2. 
  Under Roles Summary, click the link labeled Add Role.  
 3. 
  At the Before You Begin screen, click the Skip This Page By Default check box. 
Click Next.  
 4. 
  On the Select Server Roles screen, check the box next to Active Directory Certiﬁ cate 
Services, and click Next to continue.  
 5. 
  At the Introduction to Active Directory Certiﬁ cate Services (AD CS) screen, read the 
explanation of AD CS, and then click Next.  
 6. 
  At the Select Role Services screen, make sure the Certiﬁ cation Authority and 
Certiﬁ cation Authority Web Enrollment boxes are both checked.  
Configuring Active Directory Certificate Services 
225

226 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 .1  (c o n t i n u e d)
 7. 
  When you check the Certiﬁ cation Authority Web Enrollment box, the Add Roles Wizard 
may appear, stating that you need to install supporting services. If you see this wizard, 
click the Add Required Role Services button. Otherwise go on to step 8.  
 8. 
  Once both check boxes are checked on the Select Role Services screen, click Next.  
 9. 
  At the Specify Setup Type screen, choose Enterprise and click Next.  

 10.   The Specify CA Type screen appears. This is where you decide what type of CA you will 
use. If you have only one CA or this is the ﬁ rst CA, choose Root CA (Recommended). If 
you are going to receive your certiﬁ cates from a higher CA (either your own root or a 
third - party company), choose Subordinate CA. Click Next.  
 11.   At the Set Up Private Key screen, choose Create A New Private Key, and then click Next. 
 This option allows you to create a new key for your certiﬁ cate server. You would choose 
Use Existing Private Key if you were reinstalling or using previously issued keys.  
 12.   When the Conﬁ gure Cryptography For CA screen appears, you must select a CSP. 
Choose RSA#Microsoft Software Key Storage Provider. Make sure that the Key 
Character Length is 2048, and choose SHA1 for the hash algorithm. Click Next.  
 13.   At the Conﬁ gure CA Name screen, accept the defaults and click Next. The common 
name is the general name that is used to help identify the CA, and the common name is 
also added to all issued certiﬁ cates.  
 14.   At the Set The Certiﬁ cate Validity Period screen, change the default to 1 Years and click Next.  
 15.   The Conﬁ gure Certiﬁ cate Database screen will prompt you to enter the storage location 
for your database ﬁ les. Accept the defaults and click Next.  
 16.   The Web Server IIS screen appears. This is an informational screen. Click Next.  
 17.   The Select Role Services screen shows all the services you need to install IIS so it works 
with the certiﬁ cate server. Click Next.  
Configuring Active Directory Certificate Services 
227

228 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 .1  (c o n t i n u e d)
 18.   At the Conﬁ rm Installation Selections screen, you will see a warning message stating 
that the name of this server must remain unchanged for the certiﬁ cate server to 
continue to run properly. Click Install.  
 19.   At the Installation Results screen, you will see the status of the installation. You should 
see an Installation Succeeded message. Click Close and exit Server Manager.  
 Enrolling User and Computer Certificates 
 Now that we have installed the AD CS, it ’ s time for our users and computers to receive 
certiﬁ cates. Users can receive their certiﬁ cates multiple ways: 
 
  Through Group Policy objects (GPOs) 
 You can use group policies to automatically enroll user and computer certiﬁ cates, 
making the entire certiﬁ cate process transparent to your end users. See Chapter 8, 
 “ Conﬁ guring Group Policy Objects. ” 
 
  Web enrollment 
 You can request a certiﬁ cate by using  http://servername/certsrv . 
 
  Extranet enrollment 
 The Certiﬁ cate Enrollment Web Service enables users and computers to perform 
 certiﬁ cate enrollment by using the HTTPS protocol.  

 
  Smart card enrollment 
 The enrollment agent capability, also referred to as the smart card enrollment station, 
allows an authorized user to issue smart cards from a centralized workstation.  
 
  Certificate auto enrollment 
 To set up certiﬁ cate auto enrollment, you conﬁ gure the local security policy 
(see Figure 6.2 and Exercise 6.2).  
 F I G U R E 6 . 2 Configuring auto enrollment through the Local Security Policy 
application 
 User Enrollment through Auto Enrollment 
 As an IT administrator, security is always a major concern on any network. When 
deciding to implement certiﬁ cates, you must decide how you want to issue the 
certiﬁ cates. It is always a good practice to auto enroll your end users. The fewer steps 
that an end user has to do, the better the chance that it will get done. We are not saying 
this in a bad way. Your end users are not as concerned with the network security as you 
are as an administrator. End users start doing their day - to - day tasks, and before you 
know it, they forget to implement the certiﬁ cate. Try to make a practice of auto enrolling 
your end users to make sure that the certiﬁ cate gets issued and the network is secure. 
Configuring Active Directory Certificate Services 
229

230 
Chapter 6  Configuring Active Directory Server Roles
 Exercise 6.2 shows the steps you need to take to conﬁ gure auto enrollment.  
 E X E R C I S E  6 . 2
Configuring Certificate Auto Enrollment  
 1. 
  Open the Local Security Policy MMC by selecting Start   Administrative Tools   Local 
Security Policy.  
 2. 
  In the left pane, click Public Key Policies. In the right pane, right - click Certiﬁ cate 
Services Client  -  Auto - Enrollment and choose Properties.  
 3. 
  In the Conﬁ guration Model drop - down list, choose Enabled and click OK.  
 Certificate Templates 
 Certiﬁ cate templates act like rubber stamps: By specifying a particular template as the 
model you want to use for a newly issued certiﬁ cate, you ’ re actually telling the CA which 
optional attributes to add to the certiﬁ cate, as well as implicitly telling it how to ﬁ ll in some 
of the mandatory attributes. Templates greatly simplify the process of issuing certiﬁ cates 
because they keep you from having to memorize the names of all the attributes you might 
potentially want to put in a certiﬁ cate. In Windows Server 2008 R2, multiple templates are 
available, and you also have the ability to secure templates using template permissions. 
 Version 3 certiﬁ cate templates are new templates that have been added to Windows 
Server 2008. Now Windows Server 2008 R2 supports Cryptography Next Generation 
(CNG). CNG introduces support for Suite B cryptographic algorithms such as elliptic curve 
cryptography (ECC). 
 Certiﬁ cate templates are categorized in different certiﬁ cate template types.  
  CA Certificate   When this certiﬁ cate is present on the client and server computers, the 
certiﬁ cate notiﬁ es the client or server that it can trust other certiﬁ cates that are issued 
by this CA. This type of certiﬁ cate is required for deployments of certiﬁ cate - based 
authentication methods.  

 Client Computer Certificate   This certiﬁ cate type is issued to client computers, and the 
certiﬁ cate is used when the client computer needs to prove its identity to a server during the 
authentication process.  
 Server Certificate   This certiﬁ cate type is issued to Network Policy Server (NPS) servers, and 
the certiﬁ cate is used during the authentication process to prove its identity to client computers.  
 User Certificate   This is the certiﬁ cate type that is issued to individuals by the certiﬁ cate 
server. This is also the certiﬁ cate type typically distributed to smart cards.  
 Table 6.1 shows some of the default Windows Server 2008 R2 templates that are 
available. 
 Template  
  Description  
  Type  
 Administrator  
  Allows trust list signing and user 
authentication  
 User  
 Authenticated Session  
  Allows subjects to authenticate to a web 
server 
 User  
 Basic EFS  
  Used by EFS to encrypt data  
 User  
 CA Exchange  
  Used to protect private keys as they are sent 
to the CA for private key archival  
 Computer  
 Code Signing  
  Used to digitally sign software  
  User  
 Computer  
  Allows a computer to authenticate itself on 
the network  
 Computer  
 Domain Controller 
Authentication  
 Used to authenticate Active Directory 
computers and users  
 Computer  
 EFS Recovery Agent  
  Allows the subject to decrypt files that are 
encrypted with EFS  
 User  
 Enrollment Agent  
  Used to request certificates on behalf of 
another user  
 User  
 Enrollment Agent 
(Computer)  
 Used to request certificates on behalf of 
another computer 
 Computer  
TA B L E 6 .1  Default Windows Server 2008 R2 templates
Configuring Active Directory Certificate Services 
231

232 
Chapter 6  Configuring Active Directory Server Roles
 Revoking Certificates 
 Occasionally, you will need to remove a certiﬁ cate from a user or computer. This is 
known as  certiﬁ cate revocation . For example, if a user gets terminated from your 
organization, as an administrator, you have the ability to revoke this user ’ s certiﬁ cate so 
that they cannot access any data or conﬁ dential information after they leave the company. 
 The following are some of the certiﬁ cate revocation components:
  Certificate Revocation List   When certiﬁ cates get revoked, they are listed in the  Certiﬁ cate 
Revocation List (CRL) . When conﬁ gured properly by an administrator, this list is used 
by all the certiﬁ cate servers. The CRL helps validate certiﬁ cates and helps prevent revoked 
certiﬁ cates from being used.  
  CRL Distribution Point   You need to publish your CRL to a shared location called a  CRL 
distribution point (CDP) . This gives your CRL a central location that all the certiﬁ cate 
servers can share and use.  
 Remember to change the URL distribution point for the Authority Information 
Access (AIA) for any new root CA. You need to make this location accessible 
to all users in your organization ’ s network. The offline root CA ’ s default AIA 
points are not accessible to users on the network. If you do not change the 
location of the AIA, certificate chain verification fails.  
  Template  
  Description  
  Type  
  Exchange 
Enrollment Agent 
(Offline request)  
 Used to request certificates on behalf of 
another user and supply the username in 
the request; used by the Network Device 
Enrollment Service for its enrollment agent 
certificate  
 User  
  IPSec  
  Used by IP security (IPsec) to digitally 
sign, encrypt, and decrypt network 
communication  
 Computer  
  Smart Card Logon  
  Allows the holder to authenticate its 
identity by using a smart card 
 User  
  User  
  Used by users for email, EFS, and client 
authentication 
 User  
TA B L E 6 .1  Default Windows Server 2008 R2 templates (continued)

 Online Responder   The Online Responder is the server component of a certiﬁ cate 
validation method called Online Certiﬁ cate Status Protocol (OCSP). When certiﬁ cates 
get revoked, your certiﬁ cate server needs to make sure that these certiﬁ cates don ’ t get 
used again. You can perform this validation in many ways. The most common validation 
methods are CRLs, delta CRLs, and OCSP responses. Previous versions of Windows Server 
supported only CRLs. Windows Vista, Windows 7, Windows 2008 and the Windows 
Server 2008 R2 operating system support both CRL and OCSP as methods for determining 
certiﬁ cate status. The OCSP support applies to both the client component and the server 
component (called the Online Responder).  
 Authority Information Access   When you build a certiﬁ cate server, one of the jobs of 
the server is to issue certiﬁ cates. When you build or purchase certiﬁ cates, you place the 
certiﬁ cates on the server so they can be issued. The Authority Information Access (AIA) 
extension speciﬁ es where to ﬁ nd these up - to - date certiﬁ cates.  
 In Exercise 6.3, we will look at how to change the Authority Information Access 
extension path.  
 E X E R C I S E  6 . 3
Modifying the AIA  
 1. 
  Open the Certiﬁ cation Authority snap - in.  
 2. 
  In the console tree, right - click the server name, and then click Properties. 
 3. 
  Click the Extensions tab.  
 4. 
  In Select Extension, click Authority Information Access.  
 5. 
  If the Specify Locations list does not include a valid location for the CA certiﬁ cate, click 
Add to open the Add Location dialog box, and type a valid location. Click OK. 
 6. 
  In the Specify Locations list, click a location, and then select the Include In The Authority 
Information Access Extension Of Issued Certiﬁ cates check box.  
 7. 
  Click OK.  
 8. 
  Close the Certiﬁ cation Authority snap - in.  
 Once Exercise 6.3 is complete, you must restart Active Directory 
Certificate Services for the changes to take effect.  
 Exercise 6.4 walks you through the process of revoking a certiﬁ cate using the 
Certiﬁ cation Authority MMC snap - in (this MMC is installed automatically after the 
installation of your certiﬁ cate server). You must have completed Exercises 6.1 and 6.2 in 
order to complete this exercise.  
Configuring Active Directory Certificate Services 
233

234 
Chapter 6  Configuring Active Directory Server Roles
 E X E R C I S E  6 . 4
Revoking a Certificate  
 1. 
  Open the Certiﬁ cation Authority MMC by selecting Start   Administrative Tools   
Certiﬁ cation Authority.  
 2. 
  On the left pane, expand the server name. Click the  Issued Certificates folder. Right -
 click a certiﬁ cate (right pane), and in the menu, choose All Tasks   Revoke Certiﬁ cate.  
 3. 
  In the Certiﬁ cate Revocation dialog box, you can choose the reason for the revocation 
and the effective date. Choose Unspeciﬁ ed and enter today ’ s date. Click Yes. Close the 
Certiﬁ cation Authority.  
 Configuring Additional CA Server Settings 
 You need to complete some important tasks while you are working on a certiﬁ cate server. 
At this point, you have learned how to install an Enterprise Root CA, conﬁ gure automatic 
certiﬁ cate requests, set up web enrollment, and revoke a certiﬁ cate. We will ﬁ nish this 
section by covering some of the following tasks:
  Key Archival   Key archival allows a key to be stored for later recoverability if necessary. 
In a Windows Server 2008 R2 CA, key archival is automatic. The private key portion of a 
public - private key pair is archived and can be recovered when needed. 

 Note that when a private key is recovered, the data or messages that it was associated with 
are not recovered. Key recovery only allows an individual to recover lost or damaged keys 
and allows an administrator to assume the role of an account for data access or recovery.  
 Key Recovery Agent   The  key recovery agent  is a role (a set of rights) that you can give an 
individual so that they have the permission to recover a lost or damaged key.  
 Assigning Administrative Roles   Using the Certiﬁ cation Authority MMC, you can assign 
users or administrators rights to help manage the certiﬁ cate server. 
 To assign an individual a role, right - click the name of the server in the Certification 
Authority MMC and choose Properties. Click the Security tab. Add the individual and 
choose their roles.  
 Rights and permissions are discussed in detail in Chapter 7,  “ Administering 
Active Directory. ” 
 Auditing   One of the security features in a CA is auditing. You have the ability to audit 
many different events of a CA server in the Security Log of the event viewer. You can audit 
the following events: 
 
  Back up and restore the CA database  
 
  Change CA configurations  
 
  Change CA security settings  
 
  Issue and manage certificate requests  
 
  Revoke certificates and publish the CRL  
 
  Store and retrieve archived keys  
 
  Start and stop Active Directory Certificate Services  
 Database Backup and Restore   One task that all administrators need to perform is 
backing up and restoring the certiﬁ cates and keys. To back up and restore certiﬁ cates, you 
use the Certiﬁ cation Authority MMC. Exercise 6.5 walks you through backing up your 
Certiﬁ cation Authority server.  
 E X E R C I S E  6 . 5
Backing Up the Certification Authority Server  
 1. 
  Open the Certiﬁ cation Authority MMC by selecting Start   Administrative Tools   
Certiﬁ cation Authority.  
 2. 
  In the left pane, right - click the name of the server; then choose All Tasks   Back Up CA.  
Configuring Active Directory Certificate Services 
235

236 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 . 5  (c o n t i n u e d)
 3. 
  When the Certiﬁ cation Authority Backup Wizard appears, click Next.  
 4. 
  At the Items To Back Up screen, click the Private Key And CA Certiﬁ cate check box. Next 
to the Back Up To This Location ﬁ eld, click the Browse button. Choose a location for 
your backup and click OK. Click Next.  
 5. 
  At the Select A Password screen, enter and conﬁ rm a password. For this exercise use 
 P@ssw0rd . Click Next.  
 6. 
  At the Completing The Certiﬁ cation Authority Backup Wizard screen, click Finish.  
 7. 
  Close the Certiﬁ cation Authority MMC.  
 What ’ s New in Windows Server 2008 R2 
 Microsoft CA servers are not new to the Windows Server family of products, but with 
every edition of Windows Server come improvements to the CA server. Windows Server 
2008 R2 is no different.  
  Multi Forest Certificate Enrollment   In previous versions of Windows Server, when a 
CA issued certiﬁ cates to users, the users had to be members of the same forest as the CA 
server. Now with Windows Server 2008 R2, you have the ability to issue certiﬁ cates across 

a multi forest environment that has a two - way trust relationship established. Multi Forest 
Certiﬁ cate Enrollment is available for enterprise CAs running Windows Server 2008 R2 
Enterprise or Datacenter Edition.  
 High - Volume CAs   Organizations can choose to bypass certain CA database operations 
to reduce the CA database size. By default, the CA database stores a record of each request 
and issued certiﬁ cate. If you have a project or application that needs a high volume of 
requests, this would increase the CA database growth rate and administration cost. 
 High - volume CAs do not store any certificates in the CA database. Because of this, 
certificate revocation is not possible. This is not normally an issue. Because these high -
 volume certificates are often short - lived certificates (expiration date is very short), it is not 
practical to maintain a CRL for these certificates.  
 Certificate Enrollment Web Service and Certificate Enrollment Policy Web Service   The 
certiﬁ cate enrollment web services enable policy - based certiﬁ cate enrollment over HTTP. 
This is available because of existing methods such as auto enrollment. The certiﬁ cate 
enrollment web services act as a proxy between the client computer and the CA server. 
Because of this proxy service, direct communication between the client computer and 
CA server is unnecessary. Since the direct communication is now unnecessary, certiﬁ cate 
enrollment over the Internet (extranet enrollment) and across forests is possible. The 
certiﬁ cate enrollment web services must meet the following requirements: 
 
  Active Directory forest with Windows Server 2008 R2 schema.  
 
  Enterprise CA running Windows Server 2008 R2, Windows Server 2008, or Windows 
Server 2003.  
 
  Certificate enrollment across forests requires an enterprise CA running the Enterprise 
or Datacenter Edition of Windows Server.  
 
  Client computers running Windows 7.  
 Understanding Active Directory 
Domain Services 
 With Active Directory Domain Services (AD DS), you manage objects (users, computers, 
printers, etc.) on a network. Active Directory is the database that stores all of your domain 
objects. In a Windows Server 2000, 2003, or 2008 network, you cannot have a domain 
without Active Directory. 
 Introducing the New Domain Services Features 
in Windows Server 2008 
 Many new AD DS features have been added in Windows Server 2008. These features 
improve the security and efﬁ ciency of deploying and administering AD DS. 
Understanding Active Directory Domain Services 
237

238 
Chapter 6  Configuring Active Directory Server Roles
  User Interface Improvements   Domain services are easier to install using the updated 
Installation Wizard for AD DS. Administrators can set up domain controllers anywhere in 
the organization. An improved AD DS user interface offers additional installation options 
for domain controllers. One of these is the ability to set up read - only domain controllers.  
  Read - Only Domain Controllers   Windows Server 2008 supports a new type of domain 
controller, the  read - only domain controller (RODC) . You can safely install an RODC in a 
location that has limited security, such as a small offsite ofﬁ ce. Offsite users no longer have 
to be authenticated across a slow WAN connection.  
  Auditing   Previous versions of Microsoft Windows Server supported auditing of successful 
or unsuccessful changes to Active Directory objects; however, the nature of the change was 
not included in the Security Log. In Microsoft Windows Server 2008, you can view the 
new and old values of the object and its attributes. 
 Fine - Grained Password Policies   In Microsoft Windows Server 2000 and 2003, domain -
 based password policies and account lockout policies applied to all users in the domain. 
There was no inexpensive way to implement multiple such policies for individuals or 
groups. In Windows Server 2008, ﬁ ne - grained password policies support multiple 
password and account lockout policies in the same domain.  
  Restartable Active Directory Domain Services   With Microsoft Windows Server 2008, 
administrators can stop or restart AD DS while other services not dependent on Active 
Directory (DNS, DHCP, etc.) continue to operate. For example, administrators can do an 
ofﬂ ine defragmentation of the Active Directory database or apply security updates without 
needing to restart the machine.  
  Database Mounting Tool   In previous versions of Active Directory, if an object got 
deleted, an administrator had to load multiple online backups until they found the object 
to restore. Windows Server 2008 Active Directory includes a database mounting tool 
( Dsamain.exe ) that makes it quicker and easier to ﬁ nd and restore speciﬁ c data. The tool 
supports online and Volume Shadow Copy Service (snapshot) backups.  
 Security Features Available for Domain Services 
 Two important security features are available for domain services in Windows Server 
2008 — RODCs and BitLocker Drive Encryption. 
 Read - Only Domain Controllers 
 As stated earlier, RODCs allow you to have a non - editable copy of Active Directory in an 
area that may be a security risk. RODCs hold an entire copy of Active Directory, and the 
replication trafﬁ c is unidirectional.  Unidirectional replication means that other domain 
controllers can talk to an RODC but an RODC cannot talk to other domain controllers. 

 One advantage to having an RODC is that you can give a normal user the administrator 
role for the RODC, and that user can do any type of maintenance on it. The user does not 
need to be a domain administrator; they are allowed to have the maintenance role for just 
the one RODC. This concept is known as administrator role separation. 
 You can also load DNS on an RODC. This makes a read - only copy of the DNS 
database. The downside to a read - only DNS server is that it does not allow dynamic 
updates (see Chapter 2,  “ Domain Name System (DNS) ” ). The beneﬁ t is that you do not 
have to worry about hackers or unauthorized domain users changing the DNS database. 
 RODCs allow for authentication through credential caching, but not all accounts have 
to be cached. You can decide which accounts to cache on an RODC by using a  password 
replication policy . This policy allows an administrator to determine which user groups will 
be allowed to use the RODC credential caching. 
 To install an RODC, use the  dcpromo.exe application (discussed in Chapter 3,  “ Active 
Directory Planning and Installation, ” and Chapter 4,  “ Installing and Managing Trees and 
Forests ” ). In the Active Directory Domain Services Installation Wizard, on the Additional 
Domain Controller Options page, you check the box labeled Read - Only Domain 
Controller (RODC) (see Figure 6.3).  
 F I G U R E 6 . 3 Installing an RODC 
 Read - Only SYSVOL 
 When you create a read - only domain controller (RODC), the SYSVOL share becomes read 
only. File Replication Service (FRS) and Distribute File System (DFS) Replication updates 
to the SYSVOL are performed on a writable domain controller and then replicated to the 
RODC. If you are using either Windows Server 2000 or Windows Server 2003 domain 
Understanding Active Directory Domain Services 
239

240 
Chapter 6  Configuring Active Directory Server Roles
function levels, FRS is used to replicate the SYSVOL share. If you are using the Windows 
Server 2008 domain functional level, DFS Replication (DFSR) can be used to replicate the 
SYSVOL share. If you are running Windows Server 2008 R2, DFSR for the SYSVOL share 
on an RODC is absolutely read - only. If you are running Windows Server 2008, a delegated 
administrator could still write changes to SYSVOL on an RODC.  
 Staged Install of the RODC and RODC Administrative Role Separation 
 One way you can install an RODC is by doing it in a two - stage process. The advantage of 
installing an RODC in two stages is that two different individuals can complete part of the 
install. 
 The ﬁ rst stage of the RODC installation requires an individual with domain admin 
rights. The domain admin creates an account in Active Directory for the RODC. Also 
during the ﬁ rst stage, the Active Directory Installation Wizard records all data (i.e., the 
domain controller account name and the site in which it will be placed) about the RODC. 
This data will then be stored in the distributed Active Directory database. 
 The second stage is the actual installation of the machine at the remote location. A 
new feature called RODC Administrative Role Separation allows an administrator to give 
a normal user the rights to perform the second stage. The second stage does not require 
domain admin rights. Also during the second stage, the Active Directory Installation 
Wizard attaches the server to the domain account that was previously created by the 
domain admin. 
 Another advantage of using RODC Administrative Role Separation is that a normal user 
can also help an administrator maintain the RODC.  
 Using the System Key Utility 
 The System Key Utility ( Syskey.exe ) is used to secure account data on a hard disk. 
Also, the System Key Utility helps member servers and client operating systems (i.e., 
Windows Vista and Windows 7) encrypt the passwords in their Security Account Manager 
(SAM) database. The System Key Utility further encrypts the passwords in the Active 
Directory database, allowing for stronger encryption algorithms beyond the default 
algorithms.  
 BitLocker Drive Encryption 
 Another way to add security in a nonsecure location is through the use of BitLocker Drive 
Encryption. The BitLocker data - protection feature on Windows Server 2008 R2 allows an 
IT administrator to encrypt both the operating system volume and additional data volumes 
within same server. BitLocker will protect your data in the event of a lost or stolen hard 
disk. If your disk is lost or stolen, the encryption prevents unauthorized access to the data. 
However, BitLocker is not installed by default. To install the BitLocker security, use Server 
Manager (see Figure 6.4).  

 What ’ s New in Windows Server 2008 R2 
 Active Directory Domain Services has added many new features and beneﬁ ts to Windows 
Server 2008 R2. Many of these new features improve Active Directory manageability, 
supportability, and performance.  
 Active Directory Recycle Bin   Administrators now have the ability to undo an accidentally 
deleted Active Directory object using the Active Directory Recycle Bin. When a user 
is deleted, the user ’ s SID number is deleted. Even if you re - create the user (using the 
same username and password), that user would get a new SID number. All rights and 
permissions are associated with the SID number and not the username. You would recover 
the user through the use of a backup. This takes time. Using the Active Directory Recycle 
Bin helps solve this issue. This feature is enabled in AD DS at the Windows Server 2008 R2 
forest functional level. This feature is discussed in greater detail in Chapter 7.  
 Active Directory Module for Windows PowerShell and Windows PowerShell Cmdlets   The 
Active Directory module for Windows PowerShell allows an administrator to perform 
command - line scripting for administrative, conﬁ guration, and diagnostic tasks. This is 
beneﬁ cial to administrators because PowerShell uses a consistent vocabulary and syntax. 
Administrators using PowerShell can easily pipe cmdlets to build complex operations that 
allow end - to - end manageability with Exchange Server, Group Policy, and other services.  
 F I G U R E 6 . 4 Using the Add Features Wizard of Server Manager to install BitLocker 
Understanding Active Directory Domain Services 
241

242 
Chapter 6  Configuring Active Directory Server Roles
  Active Directory Administrative Center   The Active Directory Administrative Center is 
an MMC snap - in that allows you to conﬁ gure and manage many of the day - to - day Active 
Directory tasks. The Active Directory Administrative Center can help administrators 
perform certain activities, such as making backups, adding a user, or doing diagnostic tasks 
to correct system failures. This feature is discussed in greater detail in Chapter 7.  
  Active Directory Best Practices Analyzer   The Active Directory Best Practices Analyzer 
(BPA) takes a look at your Active Directory deployments and then identiﬁ es deviations 
from Microsoft ’ s best practices. This helps administrators properly manage their Active 
Directory deployments following Microsoft recommendations. The Active Directory Best 
Practices Analyzer uses Windows PowerShell cmdlets to gather runtime data. The BPA 
then analyzes the Active Directory settings that can cause unexpected behavior and reports 
back its recommendations in the context of your deployment. The Active Directory BPA is 
available in Server Manager.  
  Active Directory Web Services  Active Directory Web Services (ADWS) allows an administrator 
to manage Active Directory domains and AD LDS instances using a web service interface.  
  Offline Domain Join   Ofﬂ ine domain join gives administrators the ability to preprovision 
computer accounts in the domain to prepare operating systems for deployments. 
Computers, at startup, can then join the domain without the need to contact a domain 
controller. This helps reduce the time it takes to deploy computers in a datacenter.  
  Managed Service Accounts   This new Windows Server 2008 R2 feature makes the 
management of service accounts even simpler. Managed Service Accounts allows for 
easier management of service principal names (SPNs), and it also helps by reducing service 
outages for manual password resets and related issues. Administrators have the ability, 
without any human intervention for password management, to run one Managed Service 
Account for each service that is running on a server.  
  Active Directory Management Pack   The Active Directory Management Pack gives 
administrators the ability to proactively monitor the availability and performance of Active 
Directory. This feature is discussed in greater detail in Chapter 10,  “ Active Directory 
Optimization and Reliability. ” 
 Windows Server 2008 R2 Hyper - V   Windows Server 2008 R2 has a role - based utility 
called Hyper - V. Hyper - V is a hypervisor - based virtualization feature. (A hypervisor is a 
virtual machine monitor, also called virtual machine manager). It includes all the necessary 
features to support machine virtualization. By using machine virtualization, a company can 
reduce costs, improve server utilization, and create a more dynamic IT infrastructure.  
 Active Directory Federation Services 
 Active Directory Federation Services (AD FS v2) provides Internet - based clients a secure 
identity access solution that works on both Windows and non - Windows operating systems. 
 Normally when a user from one network tries to access an application in another 
network, they must have a secondary username and password. 

 AD FS allows organizations to set up trust relationships between networks and supports 
single sign - on (SSO), which allows users to access applications on other networks without 
needing secondary passwords. Security is improved and administrators spend less time 
resetting passwords when users don ’ t have to remember multiple passwords. 
 AD FS requires an AD FS server on both ends of the connection. For example, if 
company A is going to set up a trust relationship with company B, the AD FS server needs 
to be conﬁ gured at both company A and company B. 
 Installing AD FS 
 Exercise 6.6 shows you the steps you need to perform to install the AD FS through the 
Server Manager MMC.  
 E X E R C I S E  6 . 6
Installing the AD FS  
 1. 
  Open the Server Manager MMC by selecting Start   Administrative Tools   Server Manager.  
 2. 
  In the left pane, click Roles. In the Roles Summary section of right pane, click Add Roles.  
 3. 
  On the Select Server Roles screen, click the Active Directory Federation Services check 
box and click Next. 
Active Directory Federation Services 
243
 4. 
  On the Introduction To AD FS screen, click Next.  

244 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 . 6  (c o n t i n u e d)
 5. 
  On the Select Role Services screen, click the AD FS Web Agents check box. A dialog box 
appears asking you to conﬁ rm the additional services that need to be installed. Click Add 
Required Role Services. When the Select Role Services screen reappears, click Next. 
 6. 
  On the Specify Federation Server screen, type the name of your server and domain and 
click Validate. 
 You will see an error message explaining that the other federation server that you are 
trying to connect to is unavailable. That is OK for this exercise. Click Next.  
 7. 
  At the Introduction To IIS screen, click Next. 
 8. 
  On the Select Role Services screen, you see the additional services needed to install IIS. 
All the required boxes are already checked. Click Next.  
 9. 
  The Conﬁ rm Installation Selections screen shows you all the services and roles that you 
are about to install. Click Install.  
 10.   After the installation is ﬁ nished, click Close.  
 Configuring AD FS 
 Now that AD FS is installed and running, you need to learn how to conﬁ gure some of the 
important options. In AD FS, you can conﬁ gure trust policies, AD FS agents, and user and 
group mapping.  

 AD FS Web Agents  Administrators have the ability to conﬁ gure a Windows NT token -
 based Web Agent. To support this feature, Windows Server 2008 AD FS includes a user 
interface for the AD FS Web Agent role service. The Web Agent account is a service 
account that calls on other services.  
 Trust Policies   The AD FS trust policy is a ﬁ le that outlines the set of rules that a 
Federation Service uses to recognize partners, certiﬁ cates, account stores, claims, and 
the other numerous properties that are associated with the Federation Service. AD FS 
administrators have the ability to create a federated trust between two organizations. There 
are two ways to create the federated trust: 
 
  Importing and exporting policy files  
 
  The manual process, which involves the mutual exchange of partner values  
 In Windows Server 2008 R2, administrators using the export and import features can 
easily export their trust policy settings to an  .xml file. They can then send that file to the 
partner administrator so that the partner administrator can import the  .xml file. This file 
provides all of the necessary information, including URIs, claim types, claim mappings, 
and other values and verification certificates, to create the federated trust between the two 
partner organizations.  
 User and Group Claim Mapping   In basic terms,  claims mean that each partnered 
location agrees and appropriately maps the AD FS trust policy for sharing between 
federation partner locations. A claim contains user information and helps users connect to 
a partner ’ s resources. Three types of claims are supported by AD FS:
 Identity Claim   This claim type helps identify the user. The identity claim is included 
within a security token. A security token can contain up to three identity claims.  
 Group Claim   This claim type indicates membership in a group or role.  
 Custom Claim   This claim type provides any additional information that needs to be sent. 
An example might be DepartmentID. This is a custom ﬁ eld that in turn would be a custom 
claim. A custom claim can provide any attribute that is located in Active Directory.  
 Active Directory Lightweight 
Directory Services 
 Active Directory Lightweight Directory Services (AD LDS) is a Lightweight Directory 
Access Protocol (LDAP) directory service. LDAP is an application protocol used for 
querying and modifying directory services. This type of service allows directory - enabled 
applications to store and retrieve data without needing the dependencies AD DS requires. 
 You can understand LDAP by thinking of directory services as something similar to an 
address book — a set of names (your objects) that you organize in a logical and hierarchical 
manner (for example, alphabetically). Each name in the address book has an address and 
phone number (the attributes of your objects) associated with it. LDAP allows you to query 
or modify this address book. 
Active Directory Lightweight Directory Services 
245

246 
Chapter 6  Configuring Active Directory Server Roles
 Installing AD LDS 
 In Exercise 6.7 we will install AD LDS by using the Server Manager MMC.  
 E X E R C I S E  6 . 7
Installing AD LDS  
 1. 
  Open the Server Manager MMC by selecting Start   Administrative Tools   Server Manager.  
 2. 
  In the left pane, click Roles. In the Roles Summary section of the right pane, click Add Roles.  
 3. 
  On the Select Server Roles screen, click the Active Directory Lightweight Directory 
Services check box and click Next.  
 4. 
  On the Introduction To AD LDS screen, click Next. 
 5. 
  The Conﬁ rm Installation Selections screen shows you all the services and roles that you 
are about to install. Click Install.  
 6. 
  A progress screen will appear for a few minutes.  
 7. 
  After the installation is ﬁ nished, click Close.  
 Configuring AD LDS 
 Now that we have installed AD LDS, we have to conﬁ gure it. We have the ability to 
conﬁ gure the following:

 An Authentication Store   Let ’ s say that you have a web or data server and you want a way 
to save authorization information for it. Conﬁ guring an AD LDS authentication store can 
help you out in this type of situation. AD LDS works well as an authentication store because 
it can host user account objects even though they are not Windows security principals. You 
can authenticate non - Windows security principals by using LDAP simple binds. 
 The Data within AD LDS   Remember, earlier we said that AD LDS is like an address 
book, and you can edit who is in that address book by conﬁ guring the data within AD 
LDS. To conﬁ gure the data within AD LDS, you can use the ADSI edit snap - in tool.  
 A Migration to AD LDS   What if your company is using an X.500 - style directory service 
that is integrated into your company ’ s legacy applications, and you want to move to AD 
DS? You can use AD LDS to service the legacy applications while using Active Directory 
for the shared security infrastructure.  
 To conﬁ gure AD LDS, you need to set up a service instance (or instance, for short), 
which is a single running copy of AD LDS. You can have multiple instances as part of a 
conﬁ guration set. The reason for having multiple instances is load balancing and fault 
tolerance. This way if one instance becomes unavailable or overloaded, the other instances 
will pick up the slack. 
 In Exercise 6.8, we will use the Active Directory Lightweight Directory Services Wizard 
to set up our ﬁ rst AD LDS instance. 
 E X E R C I S E  6 . 8
Configuring an AD LDS Instance  
 1. 
  Open the Server Manager MMC by selecting Start   Administrative Tools   Active 
Directory Lightweight Directory Services Setup.  
 2. 
  The Active Directory Lightweight Directory Services Wizard appears. Click Next.  
 3. 
  At the Setup Options screen, click the button labeled A Unique Instance. This option is 
for a new default instance. (If you choose the button labeled A Replica Of An Existing 
Instance, you will be getting a copy of an instance from another machine.) Click Next.  
Active Directory Lightweight Directory Services 
247

248 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 . 8  (c o n t i n u e d)
 4. 
  In the Instance Name screen, type the instance name you want to use and click Next.  
 5. 
  The Ports screen shows the ﬁ rst available ports on the machine. Whatever ports you 
choose, make sure that any internal ﬁ rewalls know these port numbers. After you 
choose ports (or leave the defaults), click Next. 
 6. 
  On the Application Directory Partition screen, you need to decide whether you want to 
create a directory partition (see Chapter 3). If your application (such as Exchange) installs 
its own partition, choose No, Do Not Create An Application Directory Partition. For this 
exercise, choose No, Do Not Create An Application Directory Partition and then click Next. 
 7. 
  In the File Locations screen, you decide where you want to place your database ﬁ les on 
your hard drive. For this exercise, leave the defaults and click Next.  
 8. 
  On the Service Account Selection screen, you need to choose which service account AD 
LDS will use. This account has to have administrative rights. Choose Network Service 
Account and click Next. 

 9. 
  At the AD LDS Administrators screen, you choose which account will have the right to 
administer AD LDS. Choose Currently Logged On User and click Next. 
 10.   On the Importing LDIF Files screen, you can choose which LDIF (Lightweight Directory 
Interchange Format) services that you want to install. For this exercise, we will not 
install any services. Click Next.  
 11.   On the Ready To Install screen, look over all your choices before continuing. Click Next.  
 12.   Once the instance installation is complete, click Finish.  
 Installing AD LDS on Server Core 
 With Windows Server 2008 R2, you can install Windows Server on a server in a special 
minimum server installation called Server Core. Server Core allows an IT department to 
install Windows Server 2008 R2 with a low - maintenance server environment that has 
limited functionality. One of the functions that Server Core can provide is AD LDS. 
 Because Server Core has limited functionality, it actually provides some strong beneﬁ ts, 
including reduced servicing and management requirements, reduced attack surface, and 
reduced disk space usage. 
 Besides AD LDS, Server Core functionality includes the following: 
 
  Active Directory Domain Services (AD DS)  
 
  DNS  
 
  DHCP server  
 
  File server  
 
  Hyper - V 
 
  Media services  
Active Directory Lightweight Directory Services 
249

250 
Chapter 6  Configuring Active Directory Server Roles
 
  Print server  
 
  Web Services (IIS)  
 To install the AD LDS role on a Server Core installation, at the command prompt, type 
in the following command: 
Dism /online /enable-feature /featurename:DirectoryServices-ADAM-ServerCore 
 To uninstall the AD LDS role on a Server Core installation, at the command prompt, 
type in the following command: 
Dism /online /disable-feature /featurename:DirectoryServices-ADAM-ServerCore 
 Now that we have discussed Active Directory Lightweight Directory Services, let ’ s take 
a look at the Active Directory Rights Management Services.  
 Active Directory Rights 
Management Services 
 Active Directory Rights Management Services (AD RMS), included with Microsoft 
Windows Server 2008 R2, allows administrators or users to determine what access (open, 
read, modify, etc.) they give to other users in an organization. Access restrictions can 
improve security for email messages, internal websites, and documents.  
 To secure documents, Microsoft Office 2003 Professional (Word, Excel, 
PowerPoint, and Outlook), Microsoft Office 2007 Enterprise, Professional Plus, 
Ultimate, Microsoft Office 2010 Professional, or Professional Plus is required.  
 You can apply AD RMS usage policy templates directly to conﬁ dential information. 
 You can install AD RMS easily using Server Manager, and you can administer it 
through the MMC snap - in. These three new administrative roles allow for delegation of 
AD RMS responsibilities: 
 
  AD RMS Enterprise Administrators  
 
  AD RMS Template Administrators  
 
  AD RMS Auditors  
 AD RMS is integrated with AD FS, which means that two organizations can share 
information without needing AD RMS installed in both organizations. Some other 
advantages of using AD RMS include the following:
 Self Enrollment   AD RMS server enrollment allows for the creation and signing of a server 
licensor certiﬁ cate (SLC). This SLC gives the AD RMS server the right to issue certiﬁ cates 
and licenses whenever they are needed.  

 AD RMS Administrative Roles   When AD RMS is installed on your server, new 
administrative roles get created as local security groups. These new administrative roles 
allow an administrator to manage their AD RMS environment more efﬁ ciently. The new 
AD RMS administrative roles are as follows:
 AD RMS Service Group   When the AD RMS role is installed onto a server, an AD 
RMS service account is created and added to the AD RMS Service Group. The service 
account is used by the server to start services at the system startup.  
 AD RMS Enterprise Administrators   The AD RMS policies and settings are managed 
by members of the AD RMS Enterprise Administrators group. When AD RMS is 
installed onto the server, the user account installing the role is automatically added to 
the AD RMS Enterprise Administrators group. Only administrators who manage RMS 
should be added to this group.  
 AD RMS Template Administrators   Users who belong to the AD RMS Templates 
Administrators group are allowed to manage rights policy templates. AD RMS Template 
Administrators have the rights to read cluster information, list rights policy templates, 
create new rights policy templates, modify existing rights policy templates, and export 
rights policy templates.  
 AD RMS Auditors   The AD RMS Auditors role allows administrators who have 
this right to manage logs and reports. The AD RMS Auditors role is a read - only role 
that is restricted to running reports available on the AD RMS cluster, reading cluster 
information, and reading logging settings.  
 AD RMS Add - on for Internet Explorer   If you would like the ability to view but not alter 
ﬁ les with restricted permission using Internet Explorer, you can download the Windows 
Rights Management Add - on for Internet Explorer. Because you can only view but not alter 
these restricted ﬁ les, this prevents sensitive documents, web - based information, and email 
messages from being forwarded, edited, or copied by unauthorized individuals. In order for 
you to successfully run the Rights Management Add - on (RMA) for Internet Explorer, you 
must ﬁ rst install the Windows Rights Management (RM) client.  
 AD RMS Certificates   For AD RMS to work properly, AD RMS has many components 
that are all working in conjunction with each other. These components have trusted 
connections that are implemented by a set of certiﬁ cates. Making sure that these 
certiﬁ cates are valid is a core function of AD RMS technology. The Extensible rights 
Markup Language (XrML) is the XML verbiage used by AD RMS to express usage rights 
for rights - protected content.  
 AD RMS requires an AD RMS – enabled client. Windows Vista and Windows 
7 include the AD RMS client by default. If you are not using Windows 
Vista, Windows 7, Windows Server 2008, or Windows Server 2008 R2, you 
can download the AD RMS client for previous versions of Windows from 
Microsoft ’ s Download Center. 
Active Directory Rights Management Services 
251

252 
Chapter 6  Configuring Active Directory Server Roles
 Now that you have a basic understanding of what AD RMS does, let ’ s take the next step 
and install AD RMS. In Exercise 6.9, we will install AD RMS by using the Server Manager 
MMC.  
 E X E R C I S E  6 . 9
Installing AD RMS  
 1. 
  Open the Server Manager MMC by selecting Start   Administrative Tools   Server 
Manager. 
 2. 
  In the left pane, click Roles. In the Roles Summary section of the right pane, click Add 
Roles.  
 3. 
  At the Select Server Roles screen, click the Active Directory Rights Management 
Services check box. A dialog box will appear stating that additional services need to be 
installed. Click the Add Required Role Services button. Then click Next.  
 4. 
  On the Introduction To AD RMS screen, click Next. 
 5. 
  On the Select Role Services screen, make sure both check boxes (Active Directory 
Rights Management Server and Identity Federation Support) are checked. Identity 
Federation Support allows AD RMS to work with AD FS. Click Next.  

 6. 
  On the Create Or Join An AD RMS Cluster screen, choose Create A New AD RMS 
Cluster. (The other choice will not be available because we are installing the ﬁ rst AD 
RMS server and must start the cluster.) Click Next.  
 7. 
  AD RMS uses a database to store conﬁ guration and policy information. At the Select 
Conﬁ guration Database screen, choose Use Windows Internal Database on this server. 
(The other option you have is to use a third - party database engine.) Click Next.  
 8. 
  On the Specify Service Account screen, you need to choose which service account the 
AD RMS will use. Click the Specify button and type in an Administrator account and 
password other than the one you are currently logged on as. Click Next.  
 9. 
  At the Conﬁ gure AD RMS Cluster Key Storage screen, choose Use AD RMS Centrally 
Managed Key Storage and click Next.  
 10.   Next you will be asked to enter a password in the AD RMS Cluster Key Password ﬁ eld. 
The AD RMS cluster key password is used to encrypt the AD RMS cluster key that is 
stored in the AD RMS database. Type  P@ssw0rd , conﬁ rm it, and then click Next.  
 11.   On the Select Website screen, leave the default and click Next. AD RMS needs to be 
hosted in IIS. This will set up a default website for AD RMS.  
 12.   In the Specify Cluster Address screen, you choose whether to use a secure or a non -
 secure website. Choose Use An SSL - Encrypted Connection (https://) check box. In the 
Internal Address box, type in the server name and click the Validate button. After the 
address is veriﬁ ed, click Next.  
Active Directory Rights Management Services 
253

254 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 . 9  (c o n t i n u e d)
 13.   The Choose A Server Authentication Certiﬁ cate For SSL Encryption screen appears. 
Choose one of your certiﬁ cates and click Next.  
 14.   The Name The Server Licensor Certiﬁ cate screen appears. Accept the default server and 
click Next.  
 15.   Next, you have the option to register AD RMS now or later. If you register the server 
now, AD RMS will take effect immediately. If you register the server later, AD RMS will 
not work until you register. We will not register during this exercise. Choose Register 
Later and click Next.  
 16.   At the Conﬁ gure Identity Federation Support screen, you specify the name of the web 
server that Identity Federation will use. Enter the friendly name from step 14 and click 
the Validate button. The Next button will become available once the server is validated. 
If an error appears during validation, it will not affect this exercise. Click Next.  
 17.   At the Introduction To IIS screen, click Next. 
 18.   At the Select Roles Services screen, click Next. This will install all the necessary 
components for IIS.  
 19.   At the Conﬁ rm Installation Selections screen, verify all your settings and click Install.  
 20.   The install progress screen will appear. When the install is complete, click Close.  
 21.   Close the Server Manager MMC. 

 AD RMS Templates 
 As explained during the CA section, a template is a mold that you can use over and 
over again. AD RMS templates are no different. Before you start creating AD RMS 
templates, you must ﬁ rst create a shared directory where the templates can be stored. An 
administrator can then create AD RMS rights policy templates on the AD RMS cluster and 
export those templates to the shared directory. 
 If your users are connected to the company intranet and they are using AD RMS 
enabled applications, the users can access the AD RMS templates right from the shared 
directory as long as they have read access to the shared folder. If your users are not going 
to be connected to the company intranet, just copy the template to the user ’ s computer, and 
this will allow AD RMS – enabled applications to continue to function properly. 
 In Exercise 6.10 we will go through the process of creating a template in AD RMS. 
You must complete Exercise 6.9 in order to complete this exercise. Before completing this 
exercise, you will need to create and share a folder called  RMS_Templates . 
 E X E R C I S E  6 .1 0
Creating an AD RMS Template  
 1. 
  Click Start, point to Administrative Tools, and then click Active Directory Rights 
Management Services snap - in.  
 2. 
  In the Active Directory Rights Management Services Administration console, choose 
your server.  
 3. 
  In the Tasks box in the Results pane, click Manage Rights Policy Templates.  
Active Directory Rights Management Services 
255

256 
Chapter 6  Configuring Active Directory Server Roles
E X E R C I S E  6 .1 0  (c o n t i n u e d)
 4. 
  To enable exporting of the AD RMS rights policy templates, click Properties in the 
Actions pane.  
 5. 
  Select the Enable Export check box, type   \\servername\ RMS_Templates  in the Specify 
Templates File Location (UNC) box, and then click OK.  
 6. 
  In the Actions pane, click Create Distributed Rights Policy Template to start the Create 
Distributed Rights Policy Template Wizard.  
 7. 
  Click Add. 
 8. 
  In the Language list, choose English (United States).  
 9. 
  Type  ABC.COM in the Name box.  
 10.   Type  ABC.COM Company in the Description box, and then click Add. Click Next.  
 11.   Click Add, type   yourname@abc.com  in the e - mail address of a user or group box, and 
then click OK.  
 12.   Select the View check box to grant the USERS@ABC.COM group read access to any 
document created by using this AD RMS rights policy template.  
 13.   Click Finish. Close the AD RMS MMC snap - in.  

 Summary 
 In this chapter, we talked about the certiﬁ cate authority (CA). We explained why you need 
to use certiﬁ cates and how to conﬁ gure them. We discussed how a computer or user gets a 
certiﬁ cate through a GPO, auto enrollment, or web enrollment. We then reviewed the steps 
and reasons for revoking a certiﬁ cate. 
 We went on to discuss the Active Directory Domain Service (AD DS) and the advantages 
of using a read - only domain controller (RODC). After that, we talked about the Active 
Directory Federation Services (AD FS), which provides Internet - based clients with a secure 
identity access solution that works on both Windows and non - Windows operating systems. 
 We continued with Active Directory Lightweight Directory Services (AD LDS), a 
Lightweight Directory Access Protocol (LDAP) directory service. We discussed how this 
type of service allows directory - enabled applications to store and retrieve data without 
needing the dependencies AD DS requires. 
 Finally, we talked about Active Directory Rights Management Services (AD RMS). We 
explained that the AD RMS is included with Microsoft Windows Server 2008 and 2008 
R2, and we described how it allows administrators or users to determine what access to 
give other users in an organization.  
 Exam Essentials  
 Understand the concepts behind certificate authority.   Certiﬁ cate Authority servers 
manage certiﬁ cates. Make sure you understand why companies use certiﬁ cate servers and 
how they work.  
 Understand certificate enrollment.   You need to understand the many different ways 
to issue certiﬁ cates to users and computers. You also need to understand the differences 
between installing certiﬁ cates using GPOs, auto enrollment, and web enrollment.  
 Be familiar with the uses of read - only domain controllers.   Windows Server 2008 has a 
new type of domain controller called a read - only domain controller (RODC). This gives 
an organization the ability to install a domain controller in an area or location (onsite or 
offsite) that has limited security.  
 Know when to implement fine - grained password policies.   Understand that in Windows 
Server 2008 R2 you have the ability to have multiple password and account lockout 
policies. In Microsoft Windows Server 2000 and 2003, when an organization implemented 
a domain - based password policy, it applied to all users in that domain. Fine - grained 
password policies allow an organization to have different password and account lockout 
policies for different sets of users in the same domain.  
 Understand Active Directory Federation Service.   Active Directory Federation Service 
(AD FS) gives users the ability to do a single sign - on (SSO) and access applications on 
Exam Essentials 
257

258 
Chapter 6  Configuring Active Directory Server Roles
other networks without needing a secondary password. Organizations can set up trust 
relationships with other trusted organizations so a user ’ s digital identity and access rights 
can be accepted without a secondary password.  
  Know how to install Active Directory Rights Management Services.   Active Directory 
Rights Management Services (AD RMS), included with Microsoft Windows Server 2008 
R2, allows administrators or users to determine what access (open, read, modify, etc.) they 
give to other users in an organization. This access can be used to secure email messages, 
internal websites, and documents.  
  Understand how to configure Active Directory Lightweight Directory Services.   You need 
to know that Active Directory Lightweight Directory Services (AD LDS) is a Lightweight 
Directory Access Protocol (LDAP) directory service. This type of service allows directory -
 enabled applications to store and retrieve data without needing the dependencies AD DS 
requires.  

Review Questions 
259
 Review Questions  
 1. 
  You are the network administrator for the ABC Company. The ABC Company has all 
Windows Server 2008 R2 Active Directory domains and uses an Enterprise Root certificate 
server. You need to verify that revoked certificate data is highly available. 
 A.   Implement a Group Policy Object (GPO) that has the Certificate Verification Enabled 
option.  
 B.   Using Network Load Balancing, implement an Online Certificate Status Protocol 
(OCSP) responder.  
 C.   Implement a Group Policy object (GPO) that enables the Online Certificate Status 
Protocol (OCSP) responder.  
 D.   Using Network Load Balancing, implement the Certificate Verification Enabled 
option.  
 2. 
  You are the network administrator for your organization. Your company uses a Windows 
Server 2008 R2 Enterprise Root CA. The company has issued a new policy that prevents 
port 443 and port 80 from being opened on domain controllers and on issuing CAs. Your 
users need to request certificates from a web interface. You have already installed the AD 
CS role. What do you need to do next?  
 A.   Configure the Certificate Authority Web Enrollment Service on a member server.  
 B.   Configure the Certificate Authority Web Enrollment Service on a domain server.  
 C.   Configure AD FS on a member server to allow secure web - based access.  
 D.   Configure AD FS on a domain controller to allow secure web - based access.  
 3. 
 You are the network administrator for your organization. Your company uses a Windows 
Server 2008 R2 Enterprise certification authority to issue certificates. You need to start 
using key archival. What should you do?  
 A.   Implement a distribution CRL.  
 B.   Install the smartcard key retrieval.  
 C.   Implement a Group Policy object (GPO) that enables the Online Certificate Status 
Protocol (OCSP) responder.  
 D.   Archive the private key on the server.  
 4. 
  You are the administrator for your organization. You have decided to implement certificate 
authority servers. You have routers located on your network. What component allows 
systems to receive a certificate even though they do not have an Active Directory account?  
 A.   Hardware Device Enrollment Service  
 B.   Network Device Enrollment Service  
 C.   Router Enrollment Service  
 D.   Network Hardware Enrollment Service  

260 
Chapter 6  Configuring Active Directory Server Roles
 5. 
 You are the network administrator for your organization. Your organization has two 
Windows Server 2008 R2 servers named ServerA and ServerB. ServerA is configured as an 
Enterprise Root Certificate Authority and ServerB has the Online Responder role service 
installed. You need to configure ServerA to support the Online Responder. What do you do? 
 A.   Configure a distributed CRL.  
 B.   Configure the AD FS role on ServerA.  
 C.   Configure the Authority Information Access (AIA) extension.  
 D.   Import the root CA key.  
 6. 
 You are the network administrator for an organization with one main office and one 
branch office. In the branch office, you deploy a Windows Server 2008 R2 RODC. You 
need to ensure that users in the branch office can log onto the domain by using the RODC. 
What should you do?  
 A.   Configure a password replication policy on the RODC.  
 B.   Configure authentication replication on the RODC.  
 C.   Configure authentication replication on the main office domain controller.  
 D.   Create a new RODC site link to the main office.  
 7. 
  Will, the administrator for your organization, has decided to implement certificates for all 
of your internal users. What type of root certificate authority (CA) would he implement?  
 A.   Enterprise  
 B.   Subordinate  
 C.   Stand Alone 
 D.   Web CA 
 8. 
  You have decided to implement certificate authority (CA) servers, and you want all of your 
users to receive their certificates automatically without any user intervention. What two 
ways can you accomplish this goal?  
 A.   Auto enrollment  
 B.   GPO enrollment  
 C.   Internet enrollment  
 D.   Web enrollment  
 9. 
  Which of the following provides Internet - based clients a secure identity access solution that 
works on both Windows and non - Windows operating systems?  
 A.   Active Directory Federation Services (AD FS)  
 B.   Active Directory Rights Management Service (AD RMS)  
 C.   Active Directory Lightweight Directory Service (AD LDS)  
 D.   Active Directory Domain Services (AD DS)  

Review Questions 
261
 10.   Which of the following allows administrators to configure services for issuing and 
managing public key certificates, which help organizations implement network security?  
 A.   Active Directory Federation Services (AD FS)  
 B.   Active Directory Rights Management Service (AD RMS)  
 C.   Active Directory Certificate Services (AD CS)  
 D.   Active Directory Domain Services (AD DS)  

262 
Chapter 6  Configuring Active Directory Server Roles
 Answers to Review Questions 
1. 
 B .  One of the main certiﬁ cate validation methods is called Online Certiﬁ cate Status 
Protocol (OCSP). When certiﬁ cates get revoked, your certiﬁ cate server needs to make sure 
that these certiﬁ cates don ’ t get used again. You can perform this validation in many ways. 
The most common validation methods are CRLs, delta CRLs, and OCSP responses. Using 
Network Load Balancing ensures fault tolerance. 
2. 
 A .  With the Certiﬁ cate Authority Web Enrollment Role Service, users can easily request 
certiﬁ cates and retrieve Certiﬁ cate Revocation Lists (CRLs) through a web browser. It is 
a good practice to load this service on a member server and not a domain controller. This 
machine can issue certiﬁ cates to web users, and for security reasons, you do not want a 
domain controller talking to web - based users. 
3. 
 D .  Key archival allows a key to be stored for later recoverability if necessary. The private key 
portion of a public - private key pair is archived and can be recovered when needed. 
4. 
 B .  The Network Device Enrollment Service allows network devices (such as routers) to 
obtain certiﬁ cates even though they do not have an account in the Active Directory domain. 
5. 
 C .  The Authority Information Access extension speciﬁ es where to ﬁ nd the up - to - date 
certiﬁ cates, and this will allow ServerA to support the Online Responder. 
6. 
 A .  RODCs do not store account credentials by default. They allow for authentication 
through credential caching, but not all accounts have to be cached. You can decide which 
accounts (or all accounts) to cache on an RODC by using a password replication policy. 
This policy allows an administrator to determine which user groups will be allowed to use 
the RODC credential caching. 
7. 
 A .  Enterprise Root CAs and Stand Alone Root CAs are the two main types of CAs. 
Enterprise Root CAs (automatically integrated with Active Directory) are the top - most 
trusted CAs of the hierarchy. They hold the certiﬁ cates that you issue to the users within your 
organization. The Stand Alone Root CAs hold the certiﬁ cates that you issue to Internet users. 
8. 
 A, B .  GPO enrollment automatically issues a certiﬁ cate to a user through the use of a 
Group Policy object (GPO). Web enrollment allows users to request certiﬁ cates and retrieve 
Certiﬁ cate Revocation Lists (CRLs) through the use of a web browser. Auto enrollment 
automatically issues a certiﬁ cate to a user after either the user or an administrator 
conﬁ gures a setting on the user ’ s computer. 
9. 
 A .  Active Directory Federation Services (AD FS) provides Internet - based clients a secure 
identity access solution that works on both Windows and non - Windows operating systems. 
AD FS also gives users the ability to do a single sign - on (SSO) and access applications on 
other networks without needing a secondary password. 
10.  C .  AD CS allows administrators to conﬁ gure services for issuing and managing public key 
certiﬁ cates. Companies can beneﬁ t from AD CS security by combining a private key with 
an object (such as users and computers), device (such as routers), or service. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswindows2008r2 .  

Administering Active 
Directory  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Creating and Maintaining Active Directory Objects  
 Automate creation of Active Directory accounts. 
May include but is not limited to: bulk import; configure the 
UPN; create computer, user, and group accounts (scripts, 
import, migration); template accounts; contacts; distribution 
lists; offline domain join.  
 Maintain Active Directory accounts.
May include but is not limited to: manage computer 
accounts; configure group membership; account resets; 
delegation; AGDLP/AGGUDLP; deny domain local group; 
local vs. domain; Protected Admin; disabling accounts 
vs. deleting accounts; deprovisioning; contacts; creating 
organizational units (OUs); delegation of control; protecting 
AD objects from deletion; managed service accounts.  





 Chapter 
7

 In the previous chapters, you learned how to install Domain 
Name System (DNS) and Active Directory, conﬁ gure 
server roles, and work with sites, but you still haven ’ t been 
introduced to the lower - level objects that exist in Active Directory. 
 In this chapter, you will look at the structure of the various components within a 
domain. You ’ ll see how an organization ’ s business structure can be mirrored within Active 
Directory through the use of organizational units (OUs) for ease of use and to create a 
seamless look and feel. Because the concepts related to OUs are quite simple, some systems 
administrators may underestimate their importance and not plan to use them accordingly. 
Make no mistake — one of the fundamental components of a successful Active Directory 
installation is the proper design and deployment of OUs. 
 You ’ ll also see the actual steps you need to take to create common Active Directory 
objects and then learn how to conﬁ gure and manage these objects. Finally, you ’ ll look at 
ways to publish resources and methods for creating user accounts automatically.  
 An Overview of OUs 
 An  organizational unit (OU) is a logical group of Active Directory objects, just as its 
name implies. OUs serve as containers within which other Active Directory objects can be 
created, but they do not form part of the DNS namespace. They are used solely to create 
organization within a domain. 
 OUs can contain the following types of Active Directory objects: 
 
  Users  
 
  Groups  
 
  Computers  
 
  Shared Folder objects  
 
  Contacts  
 
  Printers  
 
  InetOrgPerson objects  
 
  MSMQ Queue Aliases  
 
  Other OUs  

 Perhaps the most useful feature of OUs is that they can contain other OU objects. 
As a result, systems administrators can hierarchically group resources and other objects 
according to business practices. The OU structure is extremely ﬂ exible and, as you will see 
later in this chapter, can easily be rearranged to reﬂ ect business reorganizations. 
 Another advantage of OUs is that each can have its own set of policies. Administrators 
can create individual and unique Group Policy objects (GPOs) for each OU. GPOs are rules 
or policies that can apply to all the objects within the OU. (GPOs are discussed in detail in 
Chapter 8,  “ Conﬁ guring Group Policy Objects. ” ) 
 Each type of object has its own purpose within the organization of Active Directory 
domains. Later in this chapter, you ’ ll look at the speciﬁ cs of User, Computer, Group, and 
Shared Folder objects. For now, let ’ s focus on the purpose and beneﬁ ts of using OUs. 
 The Purpose of OUs 
 OUs are mainly used to organize the objects within Active Directory. Before you dive into 
the details of OUs, however, you must understand how OUs, users, and groups interact. 
Most importantly, you should understand that OUs are simply containers that you can use 
to logically group various objects. They are not, however, groups in the classical sense. 
That is, they are not used for assigning security permissions. Another way of stating this is 
that the user accounts, computer accounts, and group accounts that are contained in OUs 
are considered security principals while the OUs themselves are not. 
 OUs do not take the place of standard user and group permissions (covered in Chapter 9, 
 “ Planning Security for Active Directory ” ). A good general practice is to assign users to 
groups and then place the groups within OUs. This enhances the beneﬁ ts of setting security 
permissions and of using the OU hierarchy for making settings. Figure 7.1 illustrates this 
concept. 
Security
Permissions
assigned
to
Delegation and
Group Policy
Settings
User Accounts
Groups
OU Structure
OU
OU
OU
placed
in 
 F I G U R E 7.1 Relationships of users, groups, and OUs 
An Overview of OUs 
265

266 
Chapter 7  Administering Active Directory
 An OU contains objects only from within the domain in which it resides. As you ’ ll see in 
the section titled  “ Delegating Administrative Control, ” later in this chapter, the OU is the 
ﬁ nest level of granularity used for group policies and other administrative settings.  
 Benefits of OUs 
 There are many beneﬁ ts of using OUs throughout your network environment: 
 
  OUs are the smallest unit to which you can assign directory permissions.  
 
  You can easily change the OU structure, and it is more flexible than the domain 
structure.  
 
  The OU structure can support many different levels of hierarchy.  
 
  Child objects can inherit OU settings.  
 
  You can set Group Policy settings on OUs.  
 
  You can easily delegate the administration of OUs and the objects within them to the 
appropriate users and groups.  
 Now that you have a good idea of why you should use OUs, take a look at some general 
practices you can use to plan the OU structure.  
 Planning the OU Structure 
 One of the key beneﬁ ts of Active Directory is the way in which it can bring organization 
to complex network environments. Before you can begin to implement OUs in various 
conﬁ gurations, you must plan a structure that is compatible with business and technical 
needs. In this section, you ’ ll learn about several factors you should consider when planning 
for the structure of OUs. 
 Logical Grouping of Resources 
 The fundamental purpose of using OUs is to hierarchically group resources that exist 
within Active Directory. Fortunately, hierarchical groups are quite intuitive and widely 
used in most businesses. For example, a typical manufacturing business might divide its 
various operations into different departments like these: 
 
  Sales  
 
  Marketing  
 
  Engineering  
 
  Research and Development 
 
  Support  
 
  Information Technology (IT)  

 Each of these departments usually has its own goals and missions. In order to make the 
business competitive, individuals within each of the departments are assigned to various 
roles. Some types of roles might include the following: 
 
  Managers  
 
  Clerical staff  
 
  Technical staff  
 
  Planners  
 Each of these roles usually entails speciﬁ c job responsibilities. For example, managers 
should provide direction to general staff members. Note that the very nature of these roles 
suggests that employees may ﬁ ll many different positions. That is, one employee might be a 
manager in one department and a member of the technical staff in another. In the modern 
workplace, such situations are quite common. 
 All of this information helps you plan how to use OUs. First, the structure of OUs 
within a given network environment should map well to the business ’ s needs, including the 
political and logical structure of the organization, as well as its technical needs. Figure 7.2 
shows how a business organization might be mapped to the OU structure within an Active 
Directory domain.  
Stellacon.com Domain
Stellacon.com
Sales
Engineering
Corporate
US
International
IT
Development
Testing
Research
IT
IT
Accounting
 F I G U R E 7. 2 Mapping a business organization to an OU structure 
Planning the OU Structure 
267

268 
Chapter 7  Administering Active Directory
 When naming OUs for your organization, you should keep several considerations and 
limitations in mind:  
  Keep the Names and Descriptions Simple.   The purpose of OUs is to make administering 
and using resources simple. Therefore, it ’ s always a good idea to keep the names of your 
objects simple and descriptive. Sometimes, ﬁ nding a balance between these two goals can 
be a challenge. For example, although a printer name like  “ The LaserJet located near Bob ’ s 
cube ” might seem descriptive, it is certainly difﬁ cult to type. Also, imagine the naming 
changes that you might have to make if Bob moves (or leaves the company)!  
  Pay Attention to Limitations.   The maximum length for the name of an OU is 64 
characters. In most cases, this should adequately describe the OU. Remember, the name of 
an OU does not have to uniquely describe the object because the OU is generally referenced 
only as part of the overall hierarchy. For example, you can choose to create an OU 
named  “ IT ” within two different parent OUs. Even though the OUs have the same name, 
users and administrators are able to distinguish between them based on their complete 
pathname.  
 Pay Attention to the Hierarchical Consistency.   The fundamental basis of an OU structure 
is its position in a hierarchy. From a design standpoint, this means that you cannot have 
two OUs with the same name at the same level. However, you can have OUs with the same 
name at different levels. For example, you could create an OU named  “ Corporate ” within 
the North America OU and another one within the South America OU. This is because the 
fully qualiﬁ ed name includes information about the hierarchy. When an administrator tries 
to access resources in a Corporate OU, they must specify which Corporate OU they mean. 
 If, for example, you create a North America OU, the Canada OU should logically fit 
under it. If you decide that you want to separate the North America and Canada OUs into 
completely different containers, then you might want to use other, more appropriate names. 
For example, you could change North America to U.S. Users and administrators depend on 
the hierarchy of OUs within the domain, so make sure that it remains logically consistent.  
 Based on these considerations, you should have a good idea of how to best organize the 
OU structure for your domain.  
 Understanding OU Inheritance 
 When you rearrange OUs within the structure of Active Directory, you can change several 
settings. When they are moving and reorganizing OUs, systems administrators must 
pay careful attention to automatic and unforeseen changes in security permissions and 
other conﬁ guration options. By default, OUs inherit the permissions of their new parent 
container when they are moved. 
 By using the built - in tools provided with Windows Server 2008 R2 and Active Directory, 
you can move or copy OUs only within the same domain. 
 You cannot use the Active Directory Users and Computers tool to move OUs between 
domains. To do this, use the Active Directory Migration Tool (ADMT) v3.2. This is one of 
the many Active Directory support tools.  

 Delegating Administrative Control 
 We already mentioned that OUs are the smallest component within a domain to which 
administrative permissions and group policies can be assigned by administrators. Now, 
you ’ ll take a look at speciﬁ cally how administrative control is set on OUs. 
 Delegation occurs when a higher security authority assigns permissions to a lesser 
security authority. As a real - world example, assume that you are the director of IT for a 
large organization. Instead of doing all of the work yourself, you would probably assign 
roles and responsibilities to other individuals. For example, if you worked within a 
multidomain environment, you might make one systems administrator responsible for all 
operations within the Sales domain and another responsible for the Engineering domain. 
Similarly, you could assign the permissions for managing all printers and print queues 
objects within your organization to one individual user while allowing another individual 
user to manage all security permissions for users and groups. 
 In this way, you can distribute the various roles and responsibilities of the IT staff 
throughout the organization. Businesses generally have a division of labor that handles all 
of the tasks involved in keeping the company ’ s networks humming. Network operating 
systems (NOSs), however, often make it difﬁ cult to assign just the right permissions, or 
in other words, do not support very granular permission assignments. Sometimes, ﬁ ne 
granularity is necessary to ensure that only the right permissions are assigned. A good 
general rule of thumb is to provide users and administrators the minimum permissions they 
require to do their jobs. This way you can ensure that accidental, malicious, and otherwise 
unwanted changes do not occur.  
 You can use auditing to log events to the Security Log in the Event Viewer. 
This is a way to ensure that if accidental, malicious, and otherwise 
unwanted changes do occur, they are logged and traceable. 
 In the world of Active Directory, you use the process of delegation to deﬁ ne responsibilities 
for OU administrators. As a systems administrator, you will be occasionally tasked with 
having to delegate responsibility to others — you can ’ t do it all, although sometimes some 
administrators believe that they can. We understand the old IT logic of doing all the tasks 
yourself for job security, but this can actually make you look worse and not better.  
 You can delegate control only at the OU level and not at the object level 
within the OU. 
 If you do ﬁ nd yourself in a role to delegate, remember that Windows Server 2008 R2 
was designed to offer you the ability to do so. In its simplest deﬁ nition, delegation allows 
a higher administrative authority to grant speciﬁ c administrative rights for containers and 
subtrees to individuals and groups. What this essentially does is eliminate the need for 
domain administrators with sweeping authority over large segments of the user population. 
You can break up this control over branches within your tree, within each OU you create.  
Planning the OU Structure 
269

270 
Chapter 7  Administering Active Directory
 To understand delegation and rights, you should first understand 
the concept of access control entries (ACEs). ACEs grant specific 
administrative rights on objects in a container to a user or group. The 
containers ’ access control list (ACL) is used to store ACEs.  
 When you are considering implementing delegation, keep these two main concerns in mind:  
  Parent - Child Relationships   The OU hierarchy you create will be very important when 
you consider the maintainability of security permissions. OUs can exist in a parent - child 
relationship, which means that permissions and group policies set on OUs higher up in the 
hierarchy (parents) can interact with objects in lower - level OUs (children). When it comes 
to delegating permissions, this is extremely important. You can allow child containers to 
automatically inherit the permissions set on parent containers. For example, if the 
North America division of your organization contains 12 other OUs, you could delegate 
permissions to all of them at once (saving time and reducing the likelihood of human error) 
by placing security permissions on the North America division. This feature can greatly 
ease administration, especially in larger organizations, but it is also a reminder of the 
importance of properly planning the OU structure within a domain.  
  Inheritance Settings   Now that you ’ ve seen how you can use parent - child relationships for 
administration, you should consider  inheritance , the process in which child objects take on 
the permissions of a parent container. When you set permissions on a parent container, all 
of the child objects are conﬁ gured to inherit the same permissions. You can override this 
behavior, however, if business rules do not lend themselves well to inheritance.  
 Applying Group Policies 
 One of the strengths of the Windows operating system is that it offers users a great deal 
of power and ﬂ exibility. From installing new software to adding device drivers, users can 
make many changes to their workstation conﬁ gurations. However, this level of ﬂ exibility 
is also a potential problem. For instance, inexperienced users might inadvertently change 
settings, causing problems that can require many hours to ﬁ x. 
 In many cases (and especially in business environments), users require only a subset 
of the complete functionality the operating system provides. In the past, however, the 
difﬁ culty associated with implementing and managing security and policy settings has led 
to lax security policies. Some of the reasons for this are technical — it can be very tedious 
and difﬁ cult to implement and manage security restrictions. Other problems have been 
political — users and management might feel that they should have full permissions on their 
local machines, despite the potential problems this might cause. 
 That ’ s where the idea of group policies comes in. Simply deﬁ ned,  group policies 
are collections of permissions that you can apply to objects within Active Directory. 
Speciﬁ cally, Group Policy settings are assigned at the site, domain, and OU levels, and they 
can apply to user accounts and computer accounts. Examples of settings that a systems 
administrator can make using group policies include the following: 

 
  Restricting users from installing new programs  
 
  Disallowing the use of Control Panel  
 
  Limiting choices for display and Desktop settings  
 Chapter 8 covers the technical issues related to group policies. 
 Creating OUs 
 Now that you have looked at several different ways in which OUs can be used to bring 
organization to the objects within Active Directory, it ’ s time to look at how you can create 
and manage them. 
 Through the use of the Active Directory Users and Computers administrative tool, also 
called the MMC (Microsoft Management Console), you can quickly and easily add, move, 
and change OUs. This graphical tool makes it easy to visualize and create the various levels 
of hierarchy an organization requires. 
 Figure 7.3 shows a geographically based OU structure that a multinational company 
might use. Note that the organization is based in North America and it has a corporate 
ofﬁ ce located there. In general, the other ofﬁ ces are much smaller than the corporate ofﬁ ce 
located in North America.  
Company Hierarchy
Africa
China
Austin
Boston
Canada
Chicago
San Francisco
Corporate
Mexico
L.A.
N.Y.
India
Malaysia
Vietnam
France
Spain
Chile
Peru
Germany
Argentina
Brazil
UK
Asia
Europe
North America
South America
Bombay
New Delhi
Engineering
Sales
HR
Marketing
Research
 F I G U R E 7. 3 A geographically based OU structure 
Creating OUs 
271

272 
Chapter 7  Administering Active Directory
 It ’ s important to note that this OU structure could have been designed in several 
different ways. For example, we could have chosen to group all of the ofﬁ ces located in 
the United States within an OU named  “ U.S. ” However, because of the large size of these 
ofﬁ ces, we chose to place these objects at the same level as the Canada and Mexico OUs. 
This prevents an unnecessarily deep OU hierarchy while still logically grouping the ofﬁ ces. 
 One nice feature when creating an OU is the ability to protect the OU from being 
accidently deleted. When you create an OU, you can check the check box Protect Container 
From Accidental Deletion. This check box protects against an administrator deleting the 
OU. To delete the OU, you must go into the advanced properties of the OU and uncheck 
the box. 
 Exercise 7.1 walks you through the process of creating several OUs for a multinational 
business. You ’ ll be using this OU structure in later exercises within this chapter.  
 In order to perform the exercises included in this chapter, you must have 
administrative access to a Windows Server 2008 R2 domain controller.  
 E X E R C I S E  7.1
Creating an OU Structure  
 1. 
  Open the Active Directory Users and Computers administrative tool.  
 2. 
  Right - click the name of the local domain, and choose New   Organizational Unit. You 
will see the dialog box shown in the following graphic. Notice that this box shows 
you the current context within which the OU will be created. In this case, you ’ re 
creating a top - level OU, so the full path is simply the name of the domain. 
 3. 
  Type  North America for the name of the ﬁ rst OU. Uncheck the box Protect Container 
From Accidental Deletion, and click OK to create this object.  

 4. 
  Create the following top - level OUs by right - clicking the name of the domain and 
choosing New   Organizational Unit. Also make sure to uncheck Protect Container From 
Accidental Deletion for all OUs in these labs, because you ’ ll be deleting some of these 
OUs in later exercises.  
 Africa 
 Asia 
 Europe 
 South America 
 Note that the order in which you create the OUs is not important. In this exercise, you 
are simply using a method that emphasizes the hierarchical relationship.  
 5. 
  Create the following second - level OUs within the North America OU by right - clicking 
the North America OU and selecting New   Organizational Unit:  
 Austin 
 Boston 
 Canada 
 Chicago 
 Corporate 
 Los Angeles 
 Mexico 
 New York 
 San Francisco 
 6. 
  Create the following OUs under the Asia OU: 
 China 
 India 
 Malaysia 
 Vietnam 
 7. 
  Create the following OUs under the Europe OU: 
 France 
 Germany 
 Spain 
 UK 
Creating OUs 
273

274 
Chapter 7  Administering Active Directory
E X E R C I S E  7.1  (c o n t i n u e d)
 8. 
  Create the following OUs under the South America OU:  
 Argentina 
 Brazil 
 Chile 
 Peru 
 9. 
  Create the following third - level OUs under the India OU by right - clicking India within the 
Asia OU and selecting New   Organizational Unit:  
 Bombay 
 New Delhi 
 10.   Within the North America Corporate OU, create the following OUs:  
 Engineering  
 HR  
 Marketing  
 Research  
 Sales  
 11.   When you have completed the creation of the OUs, you should have a structure that 
looks similar to the one in the following graphic.  

 Managing OUs 
 Managing network environments would still be challenging even if things rarely changed. 
However, in the real world, business units, departments, and employee roles change frequently. 
As business and technical needs change, so should the structure of Active Directory. 
 Fortunately, changing the structure of OUs within a domain is a relatively simple process. In 
the following sections, you ’ ll look at ways to delegate control of OUs and make other changes. 
 Moving, Deleting, and Renaming OUs 
 The process of moving, deleting, and renaming OUs is a simple one. Exercise 7.2 shows how 
you can easily change and reorganize OUs to reﬂ ect changes in the business organization. 
The speciﬁ c scenario covered in this exercise includes the following changes: 
 
  The Research and Engineering departments have been combined to form a department 
known as Research and Development (RD).  
 
  The Sales department has been moved from the Corporate office to the New York office. 
 
  The Marketing department has been moved from the Corporate office to the Chicago office.  
 This exercise assumes that you have already completed the steps in Exercise 7.1.  
 E X E R C I S E  7. 2
Modifying OU Structure   
 1. 
  Open the Active Directory Users and Computers administrative tool.  
 2. 
  Right - click the Engineering OU (located within North America   Corporate) and 
click Delete. When you are prompted for conﬁ rmation, click Yes. Note that if this OU 
contained objects, they all have been automatically deleted as well.  
 3. 
  Right - click the Research OU and select Rename. Type  RD to change the name of the OU 
and press Enter.  
 4. 
  Right - click the Sales OU and select Move. In the Move dialog box, expand the North 
America branch and click the New York OU. Click OK to move the OU.  
Managing OUs 
275

276 
Chapter 7  Administering Active Directory
E X E R C I S E  7. 2  (c o n t i n u e d)
 5. 
  You will use an alternate method to move the Marketing OU. Drag the Marketing OU and 
drop it onto the Chicago OU. 
 6. 
  When you have ﬁ nished, you should see an OU structure similar to the one shown in the 
following graphic. Close the Active Directory Users and Computers administrative tool.  
 Administering Properties of OUs 
 Although OUs are primarily created for organizational purposes within the Active Directory 
environment, they have several settings that you can modify. To modify the properties of 
an OU using the Active Directory Users and Computers administrative tool, right - click the 
name of any OU and select Properties; when you do, the OU Properties dialog box appears. 
In the example shown in Figure 7.4, you see the options on the General tab. 
 In any organization, it helps to know who is responsible for managing an OU. You can set 
this information on the Managed By tab (see Figure 7.5). The information speciﬁ ed on this tab 
is very convenient because it is automatically pulled from the contact information on a user 
record. You should consider always having a contact for each OU within your organization so 
that other systems administrators know whom to contact if they need to make any changes.  

 F I G U R E 7. 4 The General tab of the OU ’ s Properties dialog box 
 F I G U R E 7. 5 The Managed By tab of the OU ’ s Properties dialog box 
 Delegating Control of OUs 
 In simple environments, one or a few systems administrators may be responsible for 
managing all of the settings within Active Directory. For example, a single systems 
administrator could manage all users within all OUs in the environment. In larger 
organizations, however, roles and responsibilities may be divided among many different 
individuals. A typical situation is one in which a systems administrator is responsible 
for objects within only a few OUs in an Active Directory domain. Or, one systems 
administrator might manage User and Group objects while another is responsible for 
managing ﬁ le and print services. 
Managing OUs 
277

278 
Chapter 7  Administering Active Directory
 Fortunately, using the Active Directory Users and Computers tool, you can quickly and 
easily ensure that speciﬁ c users receive only the permissions they need. In Exercise 7.3, you 
will use the Delegation of Control Wizard to assign permissions to individuals. In order 
to successfully complete these steps, you must ﬁ rst have created the objects in the previous 
exercises of this chapter.  
 E X E R C I S E  7. 3
Using the Delegation of Control Wizard  
 1. 
  Open the Active Directory Users and Computers administrative tool.  
 2. 
  Right - click the Corporate OU within the North America OU and select Delegate Control. This 
starts the Delegation of Control Wizard. Click Next to begin conﬁ guring security settings.  
 3. 
  In the Users Or Groups page, click the Add button. In the Enter The Object Names To 
Select ﬁ eld, enter  Account Operators and click the Check Names button. Click OK. Click 
Next to continue. 
 4. 
  In the Tasks To Delegate page, select Delegate The Following Common Tasks and place 
a check mark next to the following items:  
 Create, Delete, And Manage User Accounts 
 Reset User Passwords And Force Password Change At Next Logon 
 Read All User Information  
 Create, Delete, And Manage Groups 
 Modify The Membership Of A Group 
 Click Next to continue. 

 5. 
  The Completing The Delegation Of Control Wizard page then provides a 
summary of the operations you have selected. To implement the changes, click 
Finish.  
 Although the common tasks available through the wizard are sufﬁ cient for many 
delegation operations, you may have cases in which you want more control. For example, 
you might want to give a particular systems administrator permissions to modify only 
Computer objects. Exercise 7.4 uses the Delegation of Control Wizard to assign more 
granular permissions. In order to successfully complete these steps, you must ﬁ rst have 
completed the previous exercises in this chapter.  
 E X E R C I S E  7. 4
Delegating Custom Tasks  
 1. 
  Open the Active Directory Users and Computers administrative tool. 
 2. 
  Right - click the Corporate OU within the North America OU and select Delegate Control. 
This starts the Delegation of Control Wizard. Click Next to begin making security 
settings.  
 3. 
  In the Users Or Groups page, click the Add button. In the Enter The Object Names To 
Select ﬁ eld, enter  Server Operators and click the Check Names button. Click OK and 
then click Next to continue. 
 4. 
  In the Tasks To Delegate page, select the Create A Custom Task To Delegate radio 
button, and click Next to continue. 
 5. 
  In the Active Directory Object Type page, choose Only The Following Objects In The 
Folder, and place a check mark next to the following items (you will have to scroll down 
to see them all): 
 User Objects  
 Computer Objects 
 Contact Objects 
 Group Objects 
 Organizational Unit Objects  
 Printer Objects 
 Click Next to continue.  
Managing OUs 
279

280 
Chapter 7  Administering Active Directory
E X E R C I S E  7. 4  (c o n t i n u e d)
 6. 
  In the Permissions page, place a check mark next to the General option and make 
sure the other options are not checked. Note that if the various objects within your 
Active Directory schema had property - speciﬁ c settings, you would see those options 
here. Place a check mark next to the following items:  
 Create All Child Objects 
 Read All Properties  
 Write All Properties  
 This gives the members of the Server Operators group the ability to create new objects 
within the Corporate OU and the permissions to read and write all properties for these 
objects.   

 7. 
  Click Next to continue.  
 8. 
  The Completing The Delegation Of Control Wizard page provides a summary of the 
operations you have selected. To implement the changes, click Finish.  
 
   
 Delegation: Who ’ s Responsible for What? 
 You ’ re the IT director for a large, multinational organization. You ’ ve been with the 
company for quite a while — since the environment had only a handful of ofﬁ ces 
and a few network and systems administrators. But times have changed. Systems 
administrators must now coordinate the efforts of hundreds of IT staffers in 14 countries. 
 When the environment ran under a Windows NT 4 domain environment, the network was 
set up with many domains. For security, performance, and distribution of administration 
reasons, the computing resources in each major ofﬁ ce were placed in their own domain. 
You have recently decided to move to Active Directory and to consolidate the numerous 
Windows NT domains into a single Active Directory domain. However, securely 
administering a distributed environment is still an important concern. So, the challenge 
involves determining how to coordinate the efforts of different systems administrators. 
 Fortunately, through the proper use of OUs and delegation, you are given a lot of 
ﬂ exibility in determining how to handle the administration. You can structure the 
administration in several ways. First, if you choose to create OUs based on geographic 
business structure, you could delegate control of these OUs based on the job functions 
of various systems administrators. For example, you could use one user account to 
administer the Europe OU. Within the Europe OU, this systems administrator could 
delegate control of ofﬁ ces represented by the Paris and London OUs. Within these 
OUs, you could further break down the administrative responsibilities for printer queue 
operators and security administrators. 
 Alternatively, the OU structure may create a functional representation of the business. 
For example, the Engineering OU might contain other OUs that are based on ofﬁ ce 
locations such as New York and Paris. A systems administrator of the Engineering 
domain could delegate permissions based on geography or job functions to the lower 
OUs. Regardless of whether you build a departmental, functional, or geographical OU 
model, keep in mind that each model excludes other models. This is one of the most 
important decisions you need to make. When you are making this decision or modifying 
previous decisions, your overriding concern is how it will affect the management and 
administration of the network. The good news is that because Active Directory has so 
many features, the model you choose can be based on speciﬁ c business requirements 
rather than imposed by architectural constraints. 
Managing OUs 
281

282 
Chapter 7  Administering Active Directory
 Troubleshooting OUs 
 In general, you should ﬁ nd using OUs to be straightforward and relatively painless. With 
adequate planning, you ’ ll be able to implement an intuitive and useful structure for OU 
objects. 
 The most common problems with OU conﬁ guration are related to the OU structure. 
When troubleshooting OUs, pay careful attention to the following factors:  
  Inheritance   By default, Group Policy and other settings are transferred automatically 
from parent OUs to child OUs and objects. Even if a speciﬁ c OU is not given a set of 
permissions, objects within that OU might still get them from parent objects.  
  Delegation of Administration   If you allow the wrong user accounts or groups to perform 
speciﬁ c tasks on OUs, you might be violating your company ’ s security policy. Be sure to 
verify the delegations you have made at each OU level.  
  Organizational Issues  Sometimes, business practices do not easily map to the structure 
of Active Directory. A few misplaced OUs, user accounts, computer accounts, or groups 
can make administration difﬁ cult or inaccurate. In many cases, it might be beneﬁ cial to 
rearrange the OU structure to accommodate any changes in the business organization. In 
others, it might make more sense to change business processes.  
 If you regularly consider each of these issues when troubleshooting problems with OUs, 
you will be much less likely to make errors in the Active Directory conﬁ guration.  
 Creating and Managing Active 
Directory Objects 
 Now that you are familiar with the task of creating OUs, you should ﬁ nd creating and 
managing other Active Directory objects quite simple. The following sections look at the 
details. 
 Overview of Active Directory Objects 
 When you install and conﬁ gure a domain controller, Active Directory sets up some 
organization for you, and you can create and manage several types of objects. This section 
describes these features. 
 Active Directory Organization 
 By default, after you install and conﬁ gure a domain controller, you will see the following 
organizational sections within the Active Directory Users and Computers tool (they look 
like folders):  

 Built - In   The Built - In container includes all of the standard groups that are installed by 
default when you promote a domain controller. You can use these groups to administer 
the servers in your environment. Examples include the Administrators group, Backup 
Operators, and Print Operators.  
 Computers   By default, the Computers container contains a list of the workstations in 
your domain. From here, you can manage all of the computers in your domain.  
 Domain Controllers   The Domain Controllers container includes a list of all of the 
domain controllers for the domain.  
 Foreign Security Principals   Foreign security principals  are any objects to which security 
can be assigned and that are not part of the current domain.  Security principals are Active 
Directory objects to which permissions can be applied, and they can be used to manage 
permissions in Active Directory.  
 Managed Service Accounts   The Managed Service Accounts OU is a new Windows Server 
2008 R2 OU. Service accounts are accounts created to run speciﬁ c services like Exchange 
and SQL Server. Having a Managed Service Accounts OU allows you to better control the 
service accounts and thus allows for better service account security.  
 Users   The Users container includes all of the security accounts that are part of the 
domain. When you ﬁ rst install the domain controller, there will be several groups in this 
container. For example, the Domain Admins group and the Administrator account are 
created in this container. 
 One thing you want to make sure of is to protect the administrator account. You should 
rename the admin account and make sure the password is complex. Protected admin accounts 
can make your network safer. Every hacker knows that there is an administrator account on 
the server by default. Be sure to make your network safer by protecting the admin account.  
 Active Directory Objects 
 You can create and manage several different types of Active Directory objects. The 
following are speciﬁ c object types:  
 Computer   Computer objects represent workstations that are part of the Active Directory 
domain. All computers within a domain share the same security database, including user 
and group information. Computer objects are useful for managing security permissions and 
enforcing Group Policy restrictions.  
 Contact   Contact objects are usually used in OUs to specify the main administrative 
contact. Contacts are not security principals like users. They are used to specify 
information about individuals outside the organization.  
 Group   Group objects are logical collections of users primarily for assigning security 
permissions to resources. When managing users, you should place them into groups and 
then assign permissions to the group. This allows for ﬂ exible management without the need 
to set permissions for individual users.  
Creating and Managing Active Directory Objects 
283

284 
Chapter 7  Administering Active Directory
  InetOrgPerson   The  InetOrgPerson object is an Active Directory object that deﬁ nes 
attributes of users in Lightweight Directory Access Protocol (LDAP) and X.500 
directories.  
 MSMQ Queue Alias   An  MSMQ Queue Alias object  is an Active Directory object for 
the MSMQ - Custom - Recipient class type. The MSMQ (Microsoft Message Queuing) 
Queue Alias object associates an Active Directory path and a user - deﬁ ned alias with a 
public, private, or direct single - element format name. This allows a queue alias to be 
used to reference a queue that might not be listed in Active Directory Domain Services 
(AD DS).  
  Organizational Unit   An OU object is created to build a hierarchy within the Active 
Directory domain. It is the smallest unit that can be used to create administrative 
groupings, and it can be used to assign group policies. Generally, the OU structure within a 
domain reﬂ ects a company ’ s business organization.  
  Printer   Printer objects map to printers.  
  Shared Folder   Shared Folder objects  map to server shares. They are used to organize 
the various ﬁ le resources that may be available on ﬁ le/print servers. Often, Shared Folder 
objects are used to give logical names to speciﬁ c ﬁ le collections. For example, systems 
administrators might create separate shared folders for common applications, user data, 
and shared public ﬁ les.  
 User   A  User object is the fundamental security principal on which Active Directory is 
based. User accounts contain information about individuals, as well as password and other 
permission information.  
 Creating Objects Using the Active Directory Users and Computers Tool 
 Exercise 7.5 walks you through the steps you need to take to create various objects within 
an Active Directory domain. In this exercise, you create some basic Active Directory 
objects. In order to complete this exercise, you must have access to at least one Active 
Directory domain controller, and you should have also completed the previous exercises in 
this chapter.  
 E X E R C I S E  7. 5
Creating Active Directory Objects  
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Expand the current domain to list the objects currently contained within it. For this 
exercise you will use the second -  and third - level OUs contained within the North 
America top - level OU, as shown in the following graphic. 

 3. 
  Right - click the Corporate OU, and select New   User. Fill in the following information:  
 First Name:  Maria 
 Initial:  D 
 Last Name:  President 
 Full Name: (leave as default)  
 User Logon Name:  mdpresident (leave default domain) 
 Click Next to continue.  
 4. 
  Enter  P@ssw0rd for the password for this user, and then conﬁ rm it. Note that you can 
also make changes to password settings here. Click Next.  
 5. 
  You will see a summary of the user information. Click Finish to create the new user.  
 6. 
  Click the RD container and create another user in that container with the following 
information:  
 First Name:  John 
 Initial:  Q 
Creating and Managing Active Directory Objects 
285

286 
Chapter 7  Administering Active Directory
E X E R C I S E  7. 5  (c o n t i n u e d)
 Last Name:  Admin 
 Full Name: (leave as default)  
 User Logon Name:  jqadmin (leave default domain) 
 Click Next to continue. 
 7. 
  Assign the password  P@ssw0rd . Click Next, and then click Finish to create the user. 
 8. 
  Right - click the RD OU, and select New   Contact. Use the following information to ﬁ ll in 
the properties of the Contact object: 
 First Name:  Jane 
 Initials:  R 
 Last Name:  Admin 
 Display Name:  jradmin 
 Click OK to create the new Contact object. 
 9. 
  Right - click the RD OU, and select New   Shared Folder. Enter  Software for the 
name and  \\server1\applications  for the network path (also known as the Universal 
Naming Convention [UNC] path). Note that you can create the object even though 
this resource (the physical server) does not exist. Click OK to create the Shared Folder 
object.  
 10.   Right - click the HR OU, and select New   Group. Type  All Users for the group name. 
Do not change the value in the Group Name (Pre – Windows 2000) ﬁ eld. For the Group 
Scope, select Global, and for the Group Type, select Security. To create the group, 
click OK.  
 11.   Right - click the Sales OU and select New   Computer. Type  Workstation1  for the name 
of the computer. Notice that the pre – Windows 2000 name is automatically populated 
and that, by default, the members of the Domain Admins group are the only ones who 
can add this computer to the domain. Place a check mark in the Assign This Computer 
Account As A Pre – Windows 2000 Computer box, and then click OK to create the 
Computer object.  
 12.   Close the Active Directory Users and Computers tool. 
 Configuring the User Principal Name 
 When you log into a domain, your logon name looks like an email address (i.e.,  wpanek@
willpanek.com ): this is called your user principal name (UPN). A UPN is the username, 
along with the @ sign, followed by the domain name. At the time that the user account 
is created, the UPN sufﬁ x is generated by default. The UPN is created as  userName @ 

 DomainName , but an administrator can alter or change the default UPN. If your forest 
has multiple domains and you need to change the UPN to a different domain, you have 
that ability. To change the UPN sufﬁ x, in Active Directory Users and Computers, choose 
a user and go into their properties. Choose the Attribute Editor tab. Scroll down to the 
 userPrincipalName attribute and make your changes. These changes then get replicated to 
the Global Catalog. 
 If your organization has multiple forests set up by a trust, you can ’ t change 
the UPN to a domain in the other forest. Global Catalogs are used to log on 
users. Since UPNs get replicated to the local forest Global Catalog servers, 
you cannot log onto other forests using the UPN.  
 Using Templates 
 Throughout this book we have talked about using templates like the certiﬁ cate templates 
and AD RMS templates. Now we are going to dive into user templates. User templates 
allow an Active Directory administrator to create a default account (for example, template_
sales) and use that account to create all the other users that match that account (all the 
salespeople). 
 If you are creating multiple accounts, this can save you a lot of time and resources. 
For example, if we need to add 35 new salespeople to our company, you ’ ll create one 
template for sales and use a copy of that template for all the other new accounts. This 
saves you the trouble of ﬁ lling out many of the same ﬁ elds over and over again. When 
you copy a template, some of the information does  not get copied over. This is because it 
is user - speciﬁ c information. Here are some of the ﬁ elds that do not get copied over from a 
template: 
 
  Name  
 
  Logon Name  
 
  Password  
 
  Email  
 
  Phone Numbers  
 
  Description  
 
  Office  
 
  Web Page  
 Many of the important ﬁ elds like Member Of (which groups you belong to), Proﬁ le 
Path, Department, and Company all get copied over. There is one very important item that 
needs to be done when creating a template: The template account needs to be disabled after 
creation. You do not want anyone using this account to access your network. In Exercise 
7.6, we will create a Sales template to use for your Sales department.  
Creating and Managing Active Directory Objects 
287

288 
Chapter 7  Administering Active Directory
 E X E R C I S E  7. 6
Creating a User Template 
 1. 
  Open the Active Directory Users and Computers snap - in.  
 2. 
  Expand the current domain to list the objects contained within it. For this exercise you 
will use the Sales OU. Right - click the Sales OU and choose New   User. 
 3. 
  Use the following properties: 
 First Name    Sales 
 Last Name    Template 
 Username    sales_template 
 Password    P@ssw0rd 
 4. 
  Click Next and then click Finish. 
 5. 
  In the right - hand window, double click the Sales Template user to open the properties. 
 6. 
  Under the General tab, complete the following items:  
 Description    Template Account 
 Ofﬁ ce    Corporate 
 Telephone    999 - 999 - 9999 
 Email    Salet@abc.com 
 Web    www.abc.com 
 7. 
  Click the Proﬁ le tab. In the Proﬁ le Path ﬁ eld, type  \\ServerA\%username% . 
 8. 
  On the Members Of tab, click the Add button. At the Enter The Object Name To Select 
box, type  Administrator and click the Check Names button. (I know that you would not 
add sales people to the administrators group, but we are doing so just for this exercise). 
Click OK.  
 9. 
  Click the Account tab. Scroll down in the Account Options box and check the Account Is 
Disabled check box. 
 10.   Click OK on the user ’ s Properties window to go back to the Sales OU. 
 11.   Right - click the Sales Template account and choose Copy. 
 12.   Enter the following information:  
 First Name    Jenny 
 Last Name    Sales 
 Username    jsales 

 Password    P@ssw0rd 
 Uncheck    Account is disabled 
 13.   In the right - hand window, double - click the Jenny Sales user to open the properties. 
 14.   Take a look at the Members Of tab, the General tab, and the Proﬁ le tab, and you will see 
that some of the ﬁ elds are preﬁ lled (including the administrators group).  
 15.   Close Jenny Sales Properties, and exit Active Directory Users and Computers.  
 Importing Objects from a File 
 In Exercise 7.5 we created an account using the Active Directory Users and Computers tool. 
But what if we needed to bulk import accounts? There are two main applications for doing 
bulk imports of accounts: the  ldifde.exe utility and the  csvde.exe utility. Both utilities 
import accounts from ﬁ les. 
 The  ldifde utility imports from line - delimited ﬁ les. This utility allows an administrator 
to export and import data, thus allowing batch operations like Add, Modify, and Delete to 
be performed in Active Directory. Windows Server 2008 R2 includes  ldifde.exe to help 
support batch operations. 
 csvde.exe performs the same export functions as  ldifde.exe , but  csvde.exe uses 
a comma - separated ﬁ le format. The  csvde.exe utility does not allow administrators to 
modify or delete objects. It only supports adding objects to Active Directory.  
 Active Directory Migration Tool v3.2 
 Another tool you can use to help import and migrate users is the Active Directory 
Migration Tool (ADMT) v3.2. The ADMT v3.2 allows an administrator to migrate users, 
groups, and computers from a Microsoft Server 2003 domain to a Windows Server 2008 
R2 Active Directory domain. 
 Administrators can also use the ADMT v3.2 to migrate users, groups, and computers 
between Active Directory domains in different forests (interforest migration) and between 
Active Directory domains in the same forest (intraforest migration). 
 ADMT v3.2 also helps administrators perform security translations from a Windows 
Server 2003 domain to a Windows Server 2008 R2 Active Directory domain. ADMT v3.2 
will also allow the security translations between Active Directory domains in different forests.  
 Offline Domain Join of a Computer 
 Ofﬂ ine domain join gives administrators the ability to preprovision computer accounts in 
the domain to prepare operating systems for deployments. Computers, at startup, can then 
join the domain without the need to contact a domain controller. This helps reduce the 
time it takes to deploy computers in a datacenter. 
 Let ’ s say that your datacenter needs to have multiple virtual machines deployed. 
This is where ofﬂ ine domain join can be useful. Ofﬂ ine domain join allows the virtual 
machines, upon initial startup after the operating system is installed, to join the domain 
automatically. No additional steps or restart are needed. 
Creating and Managing Active Directory Objects 
289

290 
Chapter 7  Administering Active Directory
 The following are some of the beneﬁ ts of using ofﬂ ine domain join: 
 
  No additional network traffic for Active Directory state changes.  
 
  No additional network traffic for computer state changes to the domain controller.  
 
  Changes for both the Active Directory state and the computer state can be completed 
at a different times. 
 Managing Object Properties 
 Once you ’ ve created the necessary Active Directory objects, you ’ ll probably need to make 
changes to their default properties. In addition to the settings you made when you were 
creating Active Directory objects, you can conﬁ gure several more properties. In addition, 
you can access object properties by right - clicking any object and selecting Properties from 
the pop - up menu. 
 Each object type contains a unique set of properties. 
 User Object Properties 
 The following list describes some of the properties of a User object: 
 
  General: General account information about this user  
 
  Address: Physical location information about this user  
 
  Account: User logon name and other account restrictions, such as workstation 
restrictions and logon hours  
 
  Profile: Information about the user ’ s roaming profile settings  
 
  Telephones: Telephone contact information for the user  
 
  Organization: The user ’ s title, department, and company information  
 
  Member Of: Group membership information for the user  
 
  Dial - In: Remote Access Service (RAS) permissions for the user  
 
  Environment: Logon and other network settings for the user  
 
  Sessions: Session limits, including maximum session time and idle session settings  
 
  Remote Control: Remote control options for this user ’ s session  
 
  Remote Desktop Services Profile: Information about the user ’ s profile for use with 
Remote Desktop Services  
 
  Personal Virtual Desktop: Allows you to assign a user a specific virtual machine to use 
as a personal virtual desktop  
 
  COM+: Specifies a COM+ partition set for the user  

 Computer Object Properties 
 Computer objects have different properties than user objects. Computer objects refer to the 
systems that clients are operating to be part of a domain. The following list describes some 
Computer object properties.  
 
  General: Information about the name of the computer, the role of the computer, and its 
description 
 You can enable an option to allow the Local System Account of this machine to 
request services from other servers. This is useful if the machine is a trusted and secure 
computer.  
 
  Operating System: The name, version, and service pack information for the operating 
system running on the computer  
 
  Member Of: Active Directory groups that this Computer object is a member of  
 
  Delegation: Allows you to set services that work on behalf of another user  
 
  Location: A description of the computer ’ s physical location  
 
  Managed By: Information about the User or Contact object that is responsible for 
managing this computer  
 
  Dial - in: Sets dial - in options for the computer  
 Setting Properties for Active Directory Objects 
 Now that you have seen the various properties that can be set for the Active Directory 
objects, let ’ s go through an exercise on how to conﬁ gure some of these properties. 
 Exercise 7.7 walks you through how to set various properties for Active Directory 
objects. In order to complete the steps in this exercise, you must have ﬁ rst completed 
Exercise 7.5.  
 Although it may seem somewhat tedious, it ’ s always a good idea to enter 
as much information as you know about Active Directory objects when you 
create them. Although the name Printer1 may be meaningful to you, users 
will appreciate the additional information, like location, when they are 
searching for objects.  
 E X E R C I S E  7. 7
Managing Object Properties  
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Expand the name of the domain, and select the RD container. Right - click the John Q. 
Admin user account, and select Properties. 
Creating and Managing Active Directory Objects 
291

292 
Chapter 7  Administering Active Directory
E X E R C I S E  7. 7  (c o n t i n u e d)
 3. 
  Here, you will see the various Properties tabs for the User account. Make some 
conﬁ guration changes based on your personal preferences. Click OK to continue.  
 4. 
  Select the HR OU. Right - click the All Users group, and click Properties. In the All Users 
Properties dialog box, you will be able to modify the membership of the group. 
 Click the Members tab, and then click Add. Add the Maria D. President and John Q. 
Admin user accounts to the group. Click OK to save the settings and then OK to accept 
the group modiﬁ cations.  
 5. 
  Select the Sales OU. Right - click the Workstation1 Computer object. Notice that you can 
choose to disable the account or reset it (to allow another computer to join the domain 
under that same name). From the context menu, choose Properties. You ’ ll see the 
properties for the Computer object. 
 Examine the various options and make changes based on your personal preference. 
After you have examined the available options, click OK to continue.  
 6. 
  Select the Corporate OU. Right - click the Maria D. President user account, and choose 
Reset Password. You will be prompted to enter a new password, and then you ’ ll be 
asked to conﬁ rm it. Note that you can also force the user to change this password upon 
the next logon, and you can also unlock the user ’ s account from here. For this exercise, 
do not enter a new password; just choose Cancel. 
 7. 
  Close the Active Directory Users and Computers tool.  

 By now, you have probably noticed that Active Directory objects have a lot of common 
options. For example, Group and Computer objects both have a Managed By tab. 
 Windows Server 2008 R2 allows you to manage many user objects at once. For 
instance, you can select several user objects by holding down the Shift or Ctrl key while 
selecting. You can then right - click any one of the selected objects and select Properties 
to display the properties that are available for multiple users. Notice that not every user 
property is available, because some properties are unique to each user. You can conﬁ gure 
the Description ﬁ eld for multiple object selections that include both users and non - users, 
such as computers and groups.  
 
A very important thing to think about when it comes to accounts is the 
difference between disabling an account and deleting an account. When 
you delete an account, the Security ID (SID) gets deleted. Even if you later 
create an account with the same username, it will have a different SID 
number and therefore it will be a different account. It is sometimes better 
to disable an account and place it into a non - active OU called Disabled. 
This way, if you ever need to re - access the account, you can do so.  
 Another object management task is the process of deprovisioning. Deprovisioning is 
the management of Active Directory objects in the connector. When you remove an object 
from an Active Directory container, the deprovisioning process removes the object and 
synchronizes the container to stay current.  
 Understanding Groups 
 Now that you know how to create user accounts, it ’ s time to learn how to create group 
accounts. As instructors, we are always amazed when students (who work in the IT ﬁ eld) 
have no idea why they should use groups. This is something every organization should be 
using. 
 To illustrate their usefulness, let ’ s say we have a Sales department user by the name of 
 wpanek . Our organization has 100 resources shared on the network for users to access. 
Because  wpanek is part of the Sales department, he has access to 50 of the resources. The 
other 50 are used by the Marketing department. If the organization is not using groups, 
and  wpanek moves from Sales to Marketing, how many changes do we have to make? The 
answer is 100. We have to move him out of the 50 resources he currently can use and place 
his account in the 50 new resources that he now needs. 
 Now, let ’ s say that we use groups. The Sales group has access to 50 resources and the 
Marketing group has access to the other 50. If  wpanek moves from Sales to Marketing, we 
only need to make two changes. We just have to take  wpanek out of the Sales group and 
place him in the Marketing group; once this is done,  wpanek can access everything he needs 
to do his job. 
Creating and Managing Active Directory Objects 
293

294 
Chapter 7  Administering Active Directory
 Group Properties 
 Now that you understand why you should use groups, let ’ s go over setting up groups and 
their properties. When you are creating groups, it helps to understand some of the options 
that you need to use.  
  Group Type   You can choose from two group types — Security groups and Distribution 
groups. 
 
  Security groups can have rights and permissions placed on them. For example, if you 
wanted to give a certain group of users access to a particular printer, but you wanted 
to control what they were allowed to do with this printer, you ’ d create a Security group 
and then apply certain rights and permissions to this group.  
 Security groups can also receive emails. If someone sent an email to the group, all users 
within that group would receive it.  
 
  Distribution groups are used for email  only . You cannot place permissions and rights 
for objects on this group type.  
  Group Scope   When it comes to group scopes, your choices depend on what domain 
function level (discussed in Chapter 3,  “ Active Directory Planning and Installation ” ) you 
are working with. If you are in Native mode (Windows 2000 Native, 2003, 2008, or 2008 
R2), you will have three choices:  
 Domain Local Groups  Domain local groups are groups that remain in the domain 
in which they were created. You use these groups to grant permissions within a single 
domain. For example, if you create a domain local group named HPLaser, you cannot use 
that group in any other domain, and it has to reside in the domain in which you created it. 
 You can create domain local groups in domain Mixed or Native modes.  
 Global Group   Global groups can contain other groups and accounts from the domain 
in which the group is created. In addition, you can give them permissions in any 
domain in the forest. 
 Global groups can be created in domain Mixed or Native modes.  
 Universal Groups   Universal groups can include other groups and accounts from any 
domain in the domain tree or forest. You can give universal groups permissions in 
any domain in the domain tree or forest. 
 You can create universal groups  only if you are in a domain Native mode.  
 Creating Group Strategies 
 When you are creating a group strategy, think of this acronym that Microsoft likes to use 
in the exam: AGDLP (or AGLP). This acronym stands for a series of actions you should 
perform. Here is how it expands: 
 A   Accounts (Create your user accounts.)  
 G   Global groups (Put user accounts into global groups.)  

 DL   Domain local groups (Put global groups into domain local groups.)  
 P   Permissions (Assign permissions like Deny or Apply on the domain local group.)  
 Another acronym that stands for a strategy you can use is AGUDLP (or AULP). Here is 
how it expands: 
 A   Accounts (Create your user accounts.)  
 G   Global groups (Put user accounts into global groups.)  
 U   Universal groups (Put the global groups into universal groups.)  
 DL   Domain local groups (Put universal groups into domain local groups.)  
 P   Permissions (Place permissions on the local group.)  
 Creating a Group 
 To create a new group, open the Active Directory Users and Computers snap - in. Click the 
OU where the group is going to reside. Right - click and choose New and then Group. After 
you create the group, just click the Members tab and choose Add. Add the users that you 
want to reside in that group, and that ’ s all there is to it.  
 Filtering and Advanced Active Directory Features 
 The Active Directory Users and Computers tool has a couple of other features that come in 
quite handy when you are managing many objects. You can access the Filter Options dialog 
box by clicking the View menu in the MMC and choosing Filter Options. You ’ ll see a 
dialog box similar to the one shown in Figure 7.6. Here, you can choose to ﬁ lter objects by 
their speciﬁ c types within the display. For example, if you are an administrator who works 
primarily with user accounts and groups, you can select those speciﬁ c items by placing 
check marks in the list. In addition, you can create more complex ﬁ lters by choosing Create 
Custom. Doing so provides you with an interface that looks similar to that of the Find 
command. 
 Another option in the Active Directory Users and Computers tool is to view Advanced 
options. You can enable the Advanced options by choosing Advanced Features in the View 
menu. This adds some top - level folders to the list under the name of the domain. Let ’ s take 
a look at a couple of the new top - level folders. 
 The  System folder (shown in Figure 7.7) provides additional features that you can 
conﬁ gure to work with Active Directory. You can conﬁ gure settings for the Distributed File 
System (DFS), IP Security (IPSec) policies, the File Replication Service (FRS), and more. In 
addition to the  System folder, you ’ ll also see the  LostAndFound folder. This folder contains 
any ﬁ les that may not have been replicated properly between domain controllers. You 
should check this folder periodically for any ﬁ les so that you can decide whether you need 
to move them or copy them to other locations.  
Creating and Managing Active Directory Objects 
295

296 
Chapter 7  Administering Active Directory
 F I G U R E 7.6 The Filter Options dialog box 
 F I G U R E 7.7 Advanced Features in the  System folder of the Active Directory Users and 
Computers tool 
 As you can see, managing Active Directory objects is generally a simple task. The Active 
Directory Users and Computers tool allows you to conﬁ gure several objects. Let ’ s move on 
to look at one more common administration function — moving objects.  

 Moving, Renaming, and Deleting Active 
Directory Objects 
 One of the extremely useful features of the Active Directory Users and Computers tool is its 
ability to easily move users and resources. 
 Exercise 7.8 walks you through the process of moving Active Directory objects. In this 
exercise, you will make several changes to the organization of Active Directory objects. In 
order to complete this exercise, you must have ﬁ rst completed Exercise 7.5.  
 E X E R C I S E  7. 8
Moving Active Directory Objects  
 1. 
  Open the Active Directory Users and Computers tool, and expand the name of the 
domain.  
 2. 
  Select the Sales OU (under the New York OU), right - click Workstation1, and select Move. 
A dialog box appears. Select the RD OU, and click OK to move the Computer object to 
that container.  
 3. 
  Click the RD OU, and verify that Workstation1 was moved. 
 4. 
  Close the Active Directory Users and Computers tool. 
 In addition to moving objects within Active Directory, you can also easily rename them 
by right - clicking an object and selecting Rename. Note that this option does not apply 
to all objects. You can remove objects from Active Directory by right - clicking them and 
choosing Delete.  
 Deleting an Active Directory object is an irreversible action. When an 
object is destroyed, any security permissions or other settings made 
for that object are removed as well. Because each object within Active 
Directory contains its own security identifier (SID), simply re - creating an 
object with the same name does not place any permissions on it. Before 
you delete an Active Directory object, be sure that you will never need it 
again. Windows Server 2008 R2 has an Active Directory Recycle Bin to 
allow an administrator to retrieve a deleted object, but in case the Recycle 
Bin gets cleared, it ’ s better to be safe than sorry. Don ’ t delete AD objects 
unless you are sure.  
 Windows Server 2008 R2 has a check box called Protect Container From 
Accidental Deletion for all OUs. If this check box is checked, to delete or 
move an OU, you must go into the Active Directory Users and Computers 
Advanced options. Once you are in the Advanced options, you can uncheck 
the box to move or delete the OU. 
Creating and Managing Active Directory Objects 
297

298 
Chapter 7  Administering Active Directory
 Resetting an Existing Computer Account 
 Every computer on the domain establishes a discrete channel of communication with 
the domain controller at logon time. The domain controller stores a randomly selected 
password (different from the user password) for authentication across the channel. 
The password is updated every 30 days. 
 Sometimes the computer ’ s password and the domain controller ’ s password don ’ t 
match, and communication between the two machines fails. Without the ability to reset 
the computer account, you wouldn ’ t be able to connect the machine to the domain. 
Fortunately, you can use the Active Directory Users and Computers tool to reestablish the 
connection. 
 Exercise 7.9 shows you how to reset an existing computer account. You should have 
completed the previous exercises in this chapter before you begin this exercise.  
 E X E R C I S E  7. 9
Resetting an Existing Computer Account 
 1. 
  Open the Active Directory Users and Computers tool and expand the name of the 
domain.  
 2. 
  Click the RD OU, and then right - click the Workstation1 computer account. 
 3. 
  Select Reset Account from the context menu. Click Yes to conﬁ rm your selection. Click 
OK at the success prompt. 
 4. 
  When you reset the account, you break the connection between the computer and the 
domain, so after performing this exercise, reconnect the computer to the domain if you 
want it to continue working on the network. 
 Publishing Active Directory Objects 
 One of the main goals of Active Directory is to make resources easy to ﬁ nd. Two of the 
most commonly used resources in a networked environment are server ﬁ le shares and 
printers. These are so common, in fact, that most organizations have dedicated ﬁ le and 
print servers. When it comes to managing these types of resources, Active Directory makes 
it easy to determine which ﬁ les and printers are available to users. 
 With that said, take a look at how Active Directory manages to publish shared folders 
and printers. 
 Making Active Directory Objects Available to Users 
 An important aspect of managing Active Directory objects is that a systems administrator 
can control which objects users can see. The act of making an Active Directory object 

available is known as  publishing . The two main publishable objects are Printer objects and 
Shared Folder objects. 
 The general process for creating server shares and shared printers has remained 
unchanged from previous versions of Windows: You create the various objects (a printer or 
a ﬁ lesystem folder) and then enable them for sharing. 
 To make these resources available via Active Directory, however, there ’ s an additional 
step: You must publish the resources. Once an object has been published in Active 
Directory, clients will be able to use it. 
 When you publish objects in Active Directory, you should know the server name and 
share name of the resource. When systems administrators use Active Directory objects, 
they can change the resource to which the object points without having to reconﬁ gure or 
even notify clients. For example, if you move a share from one server to another, all you 
need to do is update the Shared Folder object ’ s properties to point to the new location. 
Active Directory clients still refer to the resource with the same path and name as they used 
before.  
 Publishing Printers 
 Printers can be published easily within Active Directory. This makes them available to 
users in your domain. 
 Exercise 7.10 walks you through the steps you need to take to share and publish a 
Printer object by having you create and share a printer. In order to complete the printer 
installation, you need access to the Windows Server 2008 R2 installation media (via the 
hard disk, a network share, or the CD - ROM drive). 
 E X E R C I S E  7.1 0
Creating and Publishing a Printer 
 1. 
  Click Start   Devices And Printers   Add A Printer. This starts the Add Printer Wizard. 
 2. 
  In the Choose A Local Or Network Printer page, select Add A Local Printer. This should 
automatically take you to the next page. If it does not, Click Next.  
 3. 
  In the Choose A Printer Port page, select Use An Existing Port. From the drop - down list 
beside that option, make sure LPT1: (Printer Port) is selected. Click Next.  
 4. 
  On the Install The Printer Driver page, select Generic for the manufacturer, and for the 
printer, highlight Generic / Text Only. Click Next. 
 5. 
  On the Type A Printer Name page, type  Text Printer . Uncheck the Set As The Default 
Printer box and then click Next. 
 6. 
  The Installing Printer screen appears. After the system is ﬁ nished, the Printer Sharing 
page appears. Make sure the box labeled  “ Share this printer so that others on your 
network can ﬁ nd and use it ” is selected, and accept the default share name of Text 
Printer.  
Publishing Active Directory Objects 
299

300 
Chapter 7  Administering Active Directory
E X E R C I S E  7.1 0  (c o n t i n u e d)
 7. 
  In the Location section, type  Building 203, and in the Comment section, add the 
following comment:  This is a text - only Printer. Click Next.  
 8. 
  On the You ’ ve Successfully Added Text Printer page, click Finish.  
 9. 
  Next, you need to verify that the printer will be listed in Active Directory. Right - click the 
Text Printer icon and select Printer Properties.  
 10.   Select the Sharing tab, and ensure that the List In The Directory box is checked. Note 
that you can also add additional printer drivers for other operating systems using this 
tab. Click OK to accept the settings.  
 Note that when you create and share a printer this way, an Active Directory Printer 
object is not displayed within the Active Directory Users and Computers tool. The printer 
is actually associated with the Computer object to which it is connected.  
 Publishing Shared Folders 
 Now that you ’ ve created and published a printer, you ’ ll see how the same thing can be done 
to shared folders. 
 Exercise 7.11 walks through the steps required to create a folder, share it, and then 
publish it in Active Directory. This exercise assumes that you are using the  C: partition; 
however, you may want to change this based on your server conﬁ guration. This exercise 
assumes that you have completed Exercise 7.5.  

 E X E R C I S E  7.11
Creating and Publishing a Shared Folder  
 1. 
  Create a new folder in the root directory of your  C: partition, and name it   Test Share  . 
 2. 
  Right - click the Test Share. Choose Share With   Speciﬁ c People.  
 3. 
  In the File Sharing dialog box, enter the names of users you want to share this folder 
with. In the upper box, enter  Everyone ; then click Add. Note that Everyone appears in 
the lower box. Click in the Permission Level column next to Everyone and choose Read/
Write from the pop - up menu. Then click Share. 
 4. 
  You ’ ll see a message that your folder has been shared. Click Done.  
 5. 
  Open the Active Directory Users and Computers tool. Expand the current domain, and 
right - click the RD OU. Select New   Shared Folder.  
 6. 
  In the New Object  - Shared Folder dialog box, type   Shared Folder Test  for the name of 
the folder. Then type the UNC path to the share (for example,   \\server1\Test Share  ). 
Click OK to create the share.  
 Once you have created and published the Shared Folder object, clients can use the 
My Network Places icon to ﬁ nd this object. The Shared Folder object will be organized 
based on the OU in which you created the Shared Folder object. When you use publication, 
you can see how this makes it easy to manage shared folders.  
 Querying Active Directory 
 So far you ’ ve created several Active Directory resources. One of the main beneﬁ ts of having 
all of your resource information in Active Directory is that you can easily ﬁ nd what you ’ re 
looking for using the Find dialog box. Recall that we recommended that you always enter 
Publishing Active Directory Objects 
301

302 
Chapter 7  Administering Active Directory
as much information as possible when creating Active Directory objects. This is where that 
extra effort begins to pay off. 
 Exercise 7.12 walks you through the steps to ﬁ nd speciﬁ c objects in Active Directory. In 
order to complete this exercise, you must have ﬁ rst completed Exercise 7.5.  
 E X E R C I S E  7.1 2
Finding Objects in Active Directory  
 1. 
  Open the Active Directory Users and Computers tool.  
 2. 
  Right - click the name of the domain and select Find.  
 3. 
  In the Find Users, Contacts, And Groups dialog box, select Users, Contacts, And Groups 
from the Find drop - down list. For the In setting, choose Entire Directory. This searches 
the entire Active Directory environment for the criteria you enter. 
 Note that if this is a production domain and there are many objects, searching the whole 
directory may be a time - consuming and network - intensive operation.  
 4. 
  In the Name ﬁ eld, type  admin and then click Find Now to obtain the results of the 
search.  
 5. 
  Now that you have found several results, you can narrow down the list. Click the 
Advanced tab of the Find Users, Contacts, And Groups dialog box.  

 In the Field drop - down list, select User   Last Name. For Condition, select Starts With, 
and for Value, type  admin . Click Add to add this condition to the search criteria. Click 
Find Now. Now only the users that have the last name Admin are shown.  
 6. 
  When you have ﬁ nished searching, close the Find Users, Contacts, And Groups dialog 
box and exit the Active Directory Users and Computers tool.  
 Using the many options available in the Find dialog box, you can usually narrow down 
the objects you ’ re searching for quickly and efﬁ ciently. Users and systems administrators 
alike ﬁ nd this tool useful in environments of any size. Now that you have seen how to 
create objects in Active Directory, let ’ s take a look at a new Windows Server 2008 R2 
feature called Active Directory Administrative Center.  
 Using the Active Directory Administrative Center 
 Windows Server 2008 R2 has a new feature called the Active Directory Administrative 
Center (see Figure 7.8). This new feature allows you to manage many Active Directory 
tasks from one central location.  
Publishing Active Directory Objects 
303

304 
Chapter 7  Administering Active Directory
 Using the Active Directory Administrative Center, here are some of the tasks that an 
administrator can perform (see Figure 7.9): 
 
  Reset passwords  
 
  Create new objects  
 
  Delete objects  
 
  Move objects  
 
  Perform global searches  
 
  Configure properties for Active Directory objects  
 F I G U R E 7. 8 Active Directory Administrative Center 
 F I G U R E 7. 9 Administrative Center Overview screen 

 In Windows Server 2008 R2, the Active Directory Administrative Center is just another 
tool in your Active Directory tool belt. It does not matter which way you create your Active 
Directory objects, as long as you have a good understanding of how to create the objects.  
 Using the Command Prompt for Active 
Directory Configuration 
 One advantage of Active Directory is that you can use the command - line utility to 
conﬁ gure Active Directory. Many IT administrators like to use command - line commands 
to conﬁ gure and maintain their Active Directory environment. One advantage to using 
command - line commands is the ability to do multiple changes at once using batch ﬁ les. 
 Another advantage to knowing how to manipulate Active Directory using the command 
prompt is working with Windows Server 2008 R2 Server Core. Server Core is an 
installation of Windows Server 2008 R2 that has no GUI windows. One of the ways to 
conﬁ gure Server Core is to use commands in the command prompt window. 
 Table 7.1 shows you many of the command prompt commands and explains how each 
command affects Active Directory. 
 Command  
  Explanation  
 Csvde 
 This command allows you to import and export data from Active 
Directory. The data gets stored in a comma - separated value (CSV) format.  
 Dcdiag 
 This troubleshooting command checks the state of your domain 
controllers in your forest and sends back a report of any problems.  
 Dcpromo 
 This command initiates the Active Directory Installation Wizard and 
adds or removes the Active Directory Domain Services (AD DS). 
 Dsacls 
 This command allows you to see and change permissions in the access 
control list (ACL) for objects in AD DS. 
 Dsadd 
 This command allows you to add object to the AD DS directory.  
 Dsamain 
 This command shows the Active Directory data stored in either a 
snapshot or a backup as if it were in a Lightweight Directory Access 
Protocol (LDAP) server.  
 Dsdbutil 
 This command provides database utilities for Active Directory 
Lightweight Directory Services (AD LDS). 
TA B L E 7.1 Command prompt commands
Using the Command Prompt for Active Directory Configuration 
305

306 
Chapter 7  Administering Active Directory
 Summary 
 In this chapter, we covered the fundamentals of administering Active Directory. The most 
important part of administering Active Directory is learning about how to work with 
OUs. Therefore, you should be aware of the purpose of OUs — they help you to organize 
and manage the directory. For instance, think of administrative control. If you wanted to 
delegate rights to another administrator (such as a sales manager), you could delegate that 
authority to that user within the Sales OU. As the systems administrator, you retain the 
rights to the castle. 
 We also looked at how to design an OU structure from an example. In our example, we 
looked at how to design proper OU layout. Once we ﬁ nished designing, we looked at how 
to create, organize, and reorganize OUs if need be. 
 In addition, we took a look at groups and group strategies. We discussed the different 
types of groups — domain local, global, and universal groups. We talked about when each 
group is available and when to use each group. 
  Command  
  Explanation  
  Dsget 
  This command shows the properties of an object in the AD DS directory.  
  Dsmgmt 
  This command gives an administrator management utilities for Active 
Directory Lightweight Directory Services (AD LDS). 
  Dsmod 
  This command allows you to modify an AD DS object.  
  Dsmove 
  This command allows you to move an object in an Active Directory 
domain from its current OU to a new OU within the same forest. 
  Dsquery 
  This command allows you to query AD DS.  
  Dsrm 
  This command removes an object from the AD DS directory. 
  Ldifde 
  This command allows you to Import and export data from Active 
Directory. The data is stored as LDAP Data Interchange Format (LDIF).  
  Ntdsutil 
  This is one of the most important commands for Active Directory. It 
allows you to do maintenance on the Active Directory database.  
  Repadmin 
  This command allows administrators to diagnose Active Directory 
replication problems between domain controllers. 
TA B L E 7.1 Command prompt commands (continued)

 Lastly, we covered how to use the Active Directory Users and Computers tool to manage 
Active Directory objects. If you ’ re responsible for day - to - day systems administration, 
there ’ s a good chance that you are already familiar with this tool, but if not, you should be 
now. Using this tool, you learned how to work with Active Directory objects such as Users, 
Computers, and Groups. You also learned how to import users by doing a bulk import and 
the two different ﬁ le types that work for bulk imports. Bulk imports allow you to import 
multiple users without the need of adding one user at a time.  
 Exam Essentials  
 Understand the purpose of OUs.   OUs are used to create a hierarchical, logical 
organization for objects within an Active Directory domain.  
 Know the types of objects that can reside within OUs.   OUs can contain Active Directory 
User, Computer, Shared Folder, and other objects.  
 Understand how to use the Delegation of Control Wizard.   The Delegation of Control 
Wizard is used to assign speciﬁ c permissions at the level of OUs.  
 Understand the concept of inheritance.   By default, child OUs inherit permissions and 
Group Policy assignments set for parent OUs. However, these settings can be overridden 
for more granular control of security.  
 Know groups and group strategies.   We can use three groups in Native mode: domain 
local, global, and universal. Understand that universal groups cannot be created in Mixed 
mode. Understand the group strategies and when they apply.  
 Understand how Active Directory objects work.   Active Directory objects represent some 
piece of information about components within a domain. The objects themselves have 
attributes that describe details about them.  
 Understand how Active Directory objects can be organized.   By using the Active Directory 
Users and Computers tool, you can create, move, rename, and delete various objects.  
 Understand how to import bulk users.   You can import multiple accounts by doing a 
bulk import. Bulk imports use ﬁ les to import the data into Active Directory. Know the two 
utilities ( ldifde.exe and  csvde.exe ) you need to perform the bulk imports and how to use 
them. 
 Learn how resources can be published.   A design goal for Active Directory was to make 
network resources easier for users to ﬁ nd. With that in mind, you should understand how 
using published printers and shared folders can simplify network resource management.  
Exam Essentials 
307

308 
Chapter 7  Administering Active Directory
 Review Questions  
 1. 
  You are the administrator of an organization with a single Active Directory domain. 
A user who left the company returns after 16 weeks. The user tries to log onto their old 
computer and receives an error stating that authentication has failed. The user ’ s account 
has been enabled. You need to ensure that the user is able to log onto the domain using that 
computer. What do you do?  
 A.   Reset the computer account in Active Directory. Disjoin the computer from the domain 
and then rejoin the computer to the domain.  
 B.   Run the  ADadd  command to rejoin the computer account.  
 C.   Run the MMC utility on the user ’ s computer and add the Domain Computers snap - in.  
 D.   Re - create the user account and reconnect the user account to the computer account.  
 2. 
  You are the administrator of an organization with a single Active Directory domain. One of 
your senior executives tries to log onto a machine and receives the error  “ This user account 
has expired. Ask your administrator to reactivate your account. ” You need to make sure 
this doesn ’ t happen again to this user. What do you do?  
 A.   Configure the domain policy to disable account lockouts.  
 B.   Configure the password policy to extend the maximum password age to 0.  
 C.   Modify the user ’ s properties to set the Account Never Expires setting.  
 D.   Modify the user ’ s properties to extend the maximum password age to 0.  
 3. 
 You need to create a new user account using the command prompt. Which command would 
you use?  
 A.   dsmodify 
 B.   dscreate 
 C.   dsnew 
 D.   dsadd 
 4. 
  Maria is a user who belongs to the Sales distribution global group. Maria has been 
trying to access the laser printer that is shared on the network. The Sales global 
group has full access to the laser printer. How do you ﬁ x the problem?  
 A.   Change the group type to a security group.  
 B.   Add the Sales global group to the Administrators group.  
 C.   Add the Sales global group to the Printer Operators group. 
 D.   Change the Sales group to a local group.  

Review Questions 
309
 5. 
  You are a domain administrator for a large domain. Recently, you have been asked to make 
changes to some of the permissions related to OUs within the domain. In order to further 
restrict security for the Texas OU, you remove some permissions at that level. Later, a 
junior systems administrator mentions that she is no longer able to make changes to objects 
within the Austin OU (which is located within the Texas OU). Assuming no other changes 
have been made to Active Directory permissions, which of the following characteristics of 
OUs might have caused the change in permissions?  
 A.   Inheritance  
 B.   Group Policy  
 C.   Delegation  
 D.   Object properties  
 6. 
 Isabel, a systems administrator, has created a new Active Directory domain in an 
environment that already contains two trees. During the promotion of the domain 
controller, she chose to create a new Active Directory forest. Isabel is a member of the 
Enterprise Administrators group and has full permissions over all domains. During 
the organization ’ s migration to Active Directory, many updates have been made to the 
information stored within the domains. Recently, users and other systems administrators 
have complained about not being able to ﬁ nd speciﬁ c Active Directory objects in one or 
more domains (although the objects exist in others). 
 In order to investigate the problem, Isabel wants to check for any objects that have not been 
properly replicated among domain controllers. If possible, she would like to restore these 
objects to their proper place within the relevant Active Directory domains. 
 Which two of the following actions should she perform to be able to view the relevant 
information?  
 A.   Change Active Directory permissions to allow object information to be viewed in all 
domains.  
 B.   Select the Advanced Features item in the View menu.  
 C.   Promote a member server in each domain to a domain controller.  
 D.   Rebuild all domain controllers from the latest backups.  
 E. 
  Examine the contents of the  LostAndFound  folder using the Active Directory Users and 
Computers tool.  
 7. 
  You are a consultant hired to evaluate an organization ’ s Active Directory domain. The domain 
contains over 200,000 objects and hundreds of OUs. You begin examining the objects within 
the domain, but you ﬁ nd that the loading of the contents of speciﬁ c OUs takes a very long 
time. Furthermore, the list of objects can be very large. You want to do the following:  
 
  Use the built - in Active Directory administrative tools, and avoid the use of third - party 
tools or utilities.  
 
  Limit the list of objects within an OU to only the type of objects that you ’ re examining 
(for example, only Computer objects).  
 
  Prevent any changes to the Active Directory domain or any of the objects within it.  

310 
Chapter 7  Administering Active Directory
 
 Which one of the following actions meets these requirements?  
 A.   Use the Filter option in the Active Directory Users and Computers tool to restrict the 
display of objects.  
 B.   Use the Delegation of Control Wizard to give yourself permissions over only a certain 
type of object.  
 C.   Implement a new naming convention for objects within an OU and then sort the results 
using this new naming convention. 
 D.   Use the Active Directory Domains and Trusts tool to view information from only 
selected domain controllers.  
 E. 
 Edit the domain Group Policy settings to allow yourself to view only the objects of interest.  
 8. 
  Your organization is currently planning a migration from a Windows NT 4 environment 
that consists of several domains to an Active Directory environment. Your staff consists of 
25 systems administrators who are responsible for managing one or more domains. The 
organization is ﬁ nalizing a merger with another company. 
 
 Will, a technical planner, has recently provided you with a preliminary plan to migrate 
your environment to several Active Directory domains. He has cited security and 
administration as major justiﬁ cations for this plan. Crystal, a consultant, has recommended 
that the Windows NT 4 domains be consolidated into a single Active Directory domain. 
Which of the following statements provide a valid justiﬁ cation to support Crystal ’ s 
proposal? (Choose all that apply.)  
 A.   In general, OU structure is more flexible than domain structure.  
 B.   In general, domain structure is more flexible than OU structure.  
 C.   It is possible to create a distributed system administration structure for OUs by using 
delegation.  
 D.   The use of OUs within a single domain can greatly increase the security of the overall 
environment.  
 9. 
  Miguel is a junior - level systems administrator, and he has basic knowledge about working 
with Active Directory. As his supervisor, you have asked Miguel to make several security -
 related changes to OUs within the company ’ s Active Directory domain. You instruct 
Miguel to use the basic functionality provided in the Delegation of Control Wizard. Which 
of the following operations are represented as common tasks within the Delegation of 
Control Wizard? (Choose all that apply.)  
 A.   Reset passwords on user accounts.  
 B.   Manage Group Policy links.  
 C.   Modify the membership of a group.  
  D.   Create, delete, and manage groups.  

Review Questions 
311
 10.   You are the primary systems administrator for a large Active Directory domain. Recently, you 
have hired another systems administrator to ofﬂ oad some of your responsibilities to. This 
systems administrator will be responsible for handling help desk calls and for basic user 
account management. You want to allow the new employee to have permissions to reset 
passwords for all users within a speciﬁ c OU. However, for security reasons, it ’ s important 
that the user not be able to make permissions changes for objects within other OUs in the 
domain. Which of the following is the best way to do this?  
 A.   Create a special administration account within the OU and grant it full permissions for 
all objects within Active Directory.  
 B.   Move the user ’ s login account into the OU that he or she is to administer.  
 C.   Move the user ’ s login account to an OU that contains the OU (that is, the parent OU of 
the one that he or she is to administer).  
 D.   Use the Delegation of Control Wizard to assign the necessary permissions on the OU 
that he or she is to administer.  

312 
Chapter 7  Administering Active Directory
 Answers to Review Questions 
1. 
 A.   A computer account and the domain authenticate each other by using a password. The 
password resets every 30 days. Since the machine has not connected to the domain in 16 
weeks, the computer needs to be rejoined to the domain. 
2. 
 C.   Checking the box Account Never Expires will prevent this user ’ s account from expiring 
again. 
3. 
 D .  The  dsadd  command allows you to add an object (users account) to the Active Directory 
database. 
4. 
 A .  Distribution groups are for emails only, and distribution groups cannot be assigned 
rights and permissions to objects. 
5. 
 A .  Inheritance is the process by which permissions placed on parent OUs affect child OUs. 
In this example, the permissions change for the higher - level OU (Texas) automatically 
caused a change in permissions for the lower - level OU (Austin). 
6. 
 B, E .  Enabling the Advanced Features item in the View menu will allow Isabel to see the 
 LostAndFound  and  System  folders. The  LostAndFound  folder contains information about 
objects that could not be replicated among domain controllers. 
7. 
 A .  Through the use of ﬁ ltering, you can choose which types of objects you want to see 
using the Active Directory Users and Computers tool. Several of the other choices may 
work, but they require changes to Active Directory settings or objects. 
8. 
 A, C .  You can easily move and rename OUs without having to promote domain controllers 
and make network changes. This makes OU structure much more ﬂ exible and a good choice 
since the company may soon undergo a merger. Because security administration is important, 
delegation can be used to control administrative permissions at the OU level. 
9. 
 A, B, C, D.  All of the options listed are common tasks presented in the Delegation of 
Control Wizard. 
10.  D .  The Delegation of Control Wizard is designed to allow administrators to set up 
permissions on speciﬁ c Active Directory objects. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswindows2008r2 . 

Configuring Group 
Policy Objects  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Creating and Maintaining Active Directory Objects  
 Create and apply Group Policy objects (GPOs).
May include but is not limited to: enforce, OU hierarchy, 
block inheritance, and enabling user objects; group policy 
processing priority; WMI; group policy filtering; group policy 
loopback; Group Policy Preferences (GPP).  
 Configure GPO templates.
May include but is not limited to: user rights; ADMX Central 
Store; administrative templates; security templates; 
restricted groups; security options; starter GPOs; shell 
access policies. 
 Deploy and manage software by using GPOs.
May include but is not limited to: publishing to users; 
assigning software to users; assigning to computers; 
software removal; software restriction policies; AppLocker.  







 Chapter 
8

 For many years in this industry, it was a time - consuming 
process to make changes to computer or user environments. 
If you wanted to install a service pack or a piece of software, 
unless you had a third - party utility, you had to use sneakernet (that is, you had to walk 
from one computer to another with a disk containing the software). 
 Installing any type of software was one of the biggest challenges faced by systems 
administrators. It was difﬁ cult enough to deploy and manage workstations throughout the 
environment. When you added in the fact that users were generally able to make system 
conﬁ guration changes, it quickly became a management nightmare! 
 For example, imagine that a user noticed that they did not have enough disk space to 
copy a large ﬁ le. Instead of seeking help from the IT help desk, they may have decided to 
do a little cleanup of their own. Unfortunately, this cleanup operation may have involved 
deleting critical system ﬁ les! Or, consider the case of users who changed system settings 
 “ just to see what they do. ” Relatively minor changes, such as modifying TCP/IP bindings 
or Desktop settings, could cause hours of support headaches. Now, multiply these (or 
other common) problems by hundreds (or even thousands) of end users. Clearly, systems 
administrators needed to have a way to limit the options available to users of client 
operating systems. 
 So how do you prevent problems like these from occurring in a Windows Server 2008 
R2 environment? Fortunately, there ’ s a solution that comes with the base operating 
system that ’ s readily available and easy to implement. One of the most important system 
administration features in Windows Server 2008 R2 and Active Directory is Group 
Policy. By using Group Policy objects (GPOs), administrators can quickly and easily deﬁ ne 
restrictions on common actions and then apply them at the site, domain, or organizational 
unit (OU) level. In this chapter, you will see how group policies work and then look at how 
you can implement them within an Active Directory environment.  
 Introducing Group Policy 
 One of the strengths of Windows - based operating systems is their ﬂ exibility. End users 
and systems administrators can conﬁ gure many different options to suit the network 
environment and their personal tastes. However, this ﬂ exibility comes at a price — generally, 
many of these options should not be changed by end users on a network. For example, 
TCP/IP conﬁ guration and security policies should remain consistent for all client computers. 
In fact, end users really don ’ t need to be able to change these types of settings in the ﬁ rst 
place because many of them do not understand what these setting are used for. 

 Windows Server 2008 R2  group policies  are designed to allow systems administrators the 
ability to customize end - user settings and to place restrictions on the types of actions that users 
can perform. Group policies can be easily created by systems administrators and then later 
applied to one or more users or computers within the environment. Although they ultimately 
do affect Registry settings, it is much easier to conﬁ gure and apply settings through the use 
of Group Policy than it is to manually make changes to the Registry. To make management 
easy, Microsoft has set up Windows Server 2008 and Windows Server 2008 R2 so that Group 
Policy settings are all managed from within the Microsoft Management Console (MMC) in 
the Group Policy Management Console (GPMC). 
 Group policies have several different potential uses. We ’ ll cover the use of group policies 
for software deployment, and we ’ ll also focus on the technical background of group 
policies and how they apply to general conﬁ guration management. 
 Let ’ s begin by looking at how group policies function. 
 Understanding Group Policy Settings 
 Group Policy settings are based on Group Policy  administrative templates . These templates 
provide a list of user - friendly conﬁ guration options and specify the system settings to 
which they apply. For example, an option for a user or computer that reads Require A 
Speciﬁ c Desktop Wallpaper Setting would map to a key in the Registry that maintains this 
value. When the option is set, the appropriate change is made in the Registry of the affected 
user(s) and computer(s). 
 By default, Windows Server 2008 R2 comes with several administrative template ﬁ les 
that you can use to manage common settings. Additionally, systems administrators and 
application developers can create their own administrative template ﬁ les to set options for 
speciﬁ c functionality. 
 Most Group Policy items have three different settings options:  
 Enabled   Speciﬁ es that a setting for this GPO has been conﬁ gured. Some settings require 
values or options to be set.  
 Disabled   Speciﬁ es that this option is disabled for client computers. Note that disabling 
an option  is a setting. That is, it speciﬁ es that the systems administrator wants to disallow 
certain functionality.  
 Not Configured   Speciﬁ es that these settings have been neither enabled nor disabled. Not 
Conﬁ gured is the default option for most settings. It simply states that this Group Policy 
will not specify an option and that other policy settings may take precedence.  
 The speciﬁ c options available (and their effects) will depend on the setting. Often, you will need 
additional information. For example, when setting the Account Lockout policy, you must specify 
how many bad login attempts may be made before the account is locked out. With this in mind, 
let ’ s look at the types of user and computer settings that can be managed. 
 Group Policy settings can apply to two types of Active Directory objects: Users and 
Computers. Because both Users and Computers can be placed into groups and organized 
within OUs, this type of conﬁ guration simpliﬁ es the management of hundreds, or even 
thousands, of computers. 
Introducing Group Policy 
315

316 
Chapter 8  Configuring Group Policy Objects
 The main options you can conﬁ gure within User and Computer Group Policies are as 
follows:  
 Software Settings   Software Settings options apply to speciﬁ c applications and software 
that might be installed on the computer. Systems administrators can use these settings to 
make new applications available to end users and to control the default conﬁ guration for 
these applications.  
  Windows Settings   Windows Settings options allow systems administrators to customize 
the behavior of the Windows operating system. The speciﬁ c options that are available here 
are divided into two types: users and computers. User - speciﬁ c settings let you conﬁ gure 
Internet Explorer (including the default home page and other settings). Computer settings 
include security options, such as Account Policy and Event Log options.  
  Administrative Templates   Administrative Templates are used to further conﬁ gure user 
and computer settings. In addition to the default options available, systems administrators 
can create their own administrative templates with custom options.  
  Group Policy Preferences   Brand new to the Windows Server 2008 operating system 
is Group Policy Preferences (GPP). Group Policy Preferences gives you more than 20 new 
Group Policy extensions. These extensions, in turn, give you a vast range of conﬁ gurable 
settings within a Group Policy object. Included in the new Group Policy preference 
extensions are settings for folder options, mapped drives, printers, Registry settings, local 
users and groups, scheduled tasks, services, and Start menu settings. 
 Besides providing easier management, Group Policy preferences give an administrator the 
ability to deploy settings for client computers without restricting the users from changing 
the settings. This allows an administrator the flexibility needed to decide which settings to 
enforce and which settings to not enforce.  
 Figure 8.1 shows some of the options that you can conﬁ gure with Group Policy.  
  ADMX Central Store   Another consideration in GPO settings is whether to set up an ADMX 
Central Store. GPO administrative template ﬁ les are saved as  .admx ﬁ les. To get the most 
beneﬁ t out of using administrative templates, you should create an ADMX Central Store. 
 You create the Central Store in the  SYSVOL folder on a domain controller. The Central Store 
is a repository for all of your administrative templates, and it is checked by the Group 
Policy tools. The Group Policy tools then use any  .admx files that they find in the Central 
Store. These files then replicate to all domain controllers in the domain. 
 If you want your clients to be able to edit domain - based GPOs by using the  .admx files that 
are stored in the ADMX Central Store, you must be using Windows Vista or Windows 7.  
  Security Template   Security templates are used to conﬁ gure security settings through a 
GPO. Some of the security settings that can be conﬁ gured are settings for account policies, 
local policies, event logs, restricted groups, system services, and the Registry. Security 
templates are described in detail in Chapter 9,  “ Planning Security for Active Directory. ” 
  Starter GPOs   Starter Group Policy Objects gives administrators the ability to store a 
collection of Administrative Template policy settings in a single object. Administrators then 

have the ability to import and export Starter GPOs to easily distribute the GPOs to other 
environments. When a GPO is created from a Starter GPO, just like with any template, 
the new GPO receives the settings and values that were deﬁ ned from the Administrative 
Template policy in the Starter GPO.  
 Group Policy settings do not take effect immediately. You must run the 
 gpupdate command at the command prompt or wait for the regular update 
cycle (90 minutes by default) in order for the policy changes to take effect.  
 F I G U R E 8 .1 Group Policy configuration options 
 The Security Settings Section of the GPO 
 One of the most important sections of a GPO is the Security Settings section. The Security 
Settings section, under the Windows Settings section, allows an administrator to secure 
many aspects of the computer and user policies. The following are some of the conﬁ gurable 
options for the Security Settings section. 
 Computer section only of the GPO: 
 
  Account Policies  
 
  Local Policies  
 
  Event Policies  
Introducing Group Policy 
317

318 
Chapter 8  Configuring Group Policy Objects
 
  Restricted Groups  
 
  System Services  
 
  Registry  
 
  File System  
 
  Wired Network  
 
  Windows Firewall with Advanced Security  
 
  Network List Manager Policies  
 
  Wireless Networks  
 
  Network Access Protection  
 
  Application Control Policies  
 
  IP Security Policies 
 
  Advanced Audit Policy Configuration  
 Computer and User sections of the GPO: 
 
  Public Key Policies  
 
  Software Restriction Policy  
 Most of the security policies are discussed in Chapter 9 or throughout this 
entire book. We are going to cover two of the options in this section. 
  Restricted Groups   Restricted Groups allows you to control group membership by using 
a GPO. The group membership I am referring to is the normal Active Directory groups 
(Domain Locals, Globals, and Universals). Restricted Groups offers two conﬁ gurable 
properties: Members and Members Of. 
 The users on the Members list do not belong to the restricted group. The users on the 
Members Of list do belong to the restricted group. When you configure a Restricted Group 
Policy, members of the restricted group that are not on the Members list are removed. Users 
who are on the Members list who are not currently a member of the restricted group are 
added.  
  Software Restriction Policy   Software restriction policies allow administrators to identify 
software and to control its ability to run on the user ’ s local computer, organizational 
unit, domain, or site. This prevents users from installing unauthorized software. Software 
Restriction Policy is discussed in greater detail in this chapter in the  “ Implementing 
Software Deployment ” section.  
 Group Policy Objects 
 So far, we have been talking about what group policies are designed to do. Now, it ’ s time to 
drill down to determine exactly how you can set up and conﬁ gure them. 

 To make them easier to manage, group policies may be placed in items called  Group 
Policy objects (GPOs) . GPOs act as containers for the settings made within Group Policy 
ﬁ les; this simpliﬁ es the management of settings. For example, as a systems administrator, 
you might have different policies for users and computers in different departments. Based 
on these requirements, you could create a GPO for members of the Sales department and 
another for members of the Engineering department. Then you could apply the GPOs to 
the OU for each department. Another important concept you need to understand is that 
Group Policy settings are hierarchical — that is, systems administrators can apply Group 
Policy settings at four different levels, and these levels determine the GPO processing 
priority:  
 Local  Every Windows operating system computer has one Group Policy object that 
is stored locally. This GPO functions for both the computer and user Group Policy 
processing.  
 Sites   At the highest level, systems administrators can conﬁ gure GPOs to apply to entire sites 
within an Active Directory environment. These settings apply to all of the domains and 
servers that are part of a site. Group Policy settings managed at the site level may apply to 
more than one domain within the same forest. Therefore, they are useful when you want 
to make settings that apply to all of the domains within an Active Directory tree or forest. 
 For more information on sites, see Chapter 5,  “ Configuring Sites and 
Replication. ” 
 Domains  Domains are the third level to which systems administrators can assign GPOs. 
GPO settings placed at the domain level will apply to all of the User and Computer objects 
within the domain. Usually, systems administrators make master settings at the domain level. 
 Organizational Units   The most granular level of settings for GPOs is at the OU level. By 
conﬁ guring Group Policy options for OUs, systems administrators can take advantage of 
the hierarchical structure of Active Directory. If the OU structure is planned well, you will 
ﬁ nd it easy to make logical GPO assignments for various business units at the OU level.  
 Based on the business need and the organization of the Active Directory environment, 
systems administrators might decide to set up Group Policy settings at any of these 
four levels. Because the settings are cumulative by default, a User object might receive 
policy settings from the site level, from the domain level, and from the OUs in which it is 
contained. 
 You can also apply Group Policy settings to the local computer (in which 
case Active Directory is not used at all), but this limits the manageability of 
the Group Policy settings.  
Introducing Group Policy 
319

320 
Chapter 8  Configuring Group Policy Objects
 Group Policy Inheritance 
 In most cases, Group Policy settings are cumulative. For example, a GPO at the domain 
level might specify that all users within the domain must change their password every 
60 days, and a GPO at the OU level might specify the default Desktop background for all 
users and computers within that OU. In this case, both settings apply, and users within 
the OU are forced to change their password every 60 days and have the default Desktop 
setting. 
 So what happens if there ’ s a conﬂ ict in the settings? For example, suppose we create a 
scenario where a GPO at the site level speciﬁ es that users are to use red wallpaper, and one 
at the OU level speciﬁ es that they must green wallpaper. The users at the OU layer would 
have green wallpaper by default. Although hypothetical, this raises an important point 
about  inheritance . By default, the settings at the most speciﬁ c level (in this case, the OU 
that contains the User object) override those at more general levels. 
 Although the default behavior is for settings to be cumulative and inherited, systems 
administrators can modify this behavior. Systems administrators can set two main options 
at the various levels to which GPOs might apply:  
 Block Policy Inheritance   The Block Policy Inheritance option speciﬁ es that Group 
Policy settings for an object are not inherited from its parents. You might use this, for 
example, when a child OU requires completely different settings from a parent OU. 
Note, however, that you should manage blocking policy inheritance carefully because 
this option allows other systems administrators to override the settings made at higher 
levels.  
  Force Policy Inheritance   The Enforced (sometimes referred as the No Override) 
option can be placed on a parent object and ensures that all lower - level objects inherit 
these settings. In some cases, systems administrators want to ensure that Group Policy 
inheritance is not blocked at other levels. For example, suppose it is corporate policy that 
all network accounts are locked out after ﬁ ve incorrect password attempts. In this case, 
you would not want lower - level systems administrators to override the option with other 
settings. 
 Systems administrators generally use this option when they want to globally enforce a 
specific setting. For example, if a password expiration policy should apply to all users and 
computers within a domain, a GPO with the Force Policy Inheritance option enabled could 
be created at the domain level.  
 We must consider one ﬁ nal case: If a conﬂ ict exists between the computer and user 
settings, the user settings take effect. If, for instance, a systems administrator applies a 
default Desktop setting for the Computer policy and a different default Desktop setting 
for the User policy, the one they specify in the User policy takes effect. This is because the 
user settings are more speciﬁ c, and they allow systems administrators to make changes for 
individual users, regardless of the computer they ’ re using.  

 Planning a Group Policy Strategy 
 Through the use of Group Policy settings, systems administrators can control many 
different aspects of their network environment. As you ’ ll see throughout this chapter, 
system administrators can use GPOs to conﬁ gure user settings and computer conﬁ gurations. 
Windows Server 2008 R2 includes many different administrative tools for performing these 
tasks. However, it ’ s important to keep in mind that, as with many aspects of using Active 
Directory, a successful Group Policy strategy involves planning. 
 Because there are hundreds of possible GPO settings and many different ways 
in which you can implement them, you would start by determining the business and 
technical needs of your organization. For instance, you would ﬁ rst group your users based 
on their work functions. You might ﬁ nd, for example, that users in remote branch ofﬁ ces 
require particular network conﬁ guration options. In that case, you might implement Group 
Policy settings best at the site level. Or, you might ﬁ nd that certain departments have varying 
requirements for disk quota settings. In this case, it would probably make the most sense to 
apply GPOs to the appropriate department OUs within the domain. 
 The overall goal should be to reduce complexity (for example, by reducing the overall 
number of GPOs and GPO links) while still meeting the needs of your users. By taking into 
account the various needs of your users and the parts of your organization, you can often 
determine a logical and efﬁ cient method of creating and applying GPOs. Although it ’ s rare 
that you ’ ll come across a right or wrong method of implementing Group Policy settings, 
you will usually encounter some that are either better or worse than others. 
 By implementing a logical and consistent set of policies, you ’ ll also be well prepared to 
troubleshoot any problems that might come up or to adapt to your organization ’ s changing 
requirements. Later in this chapter, you ’ ll see some speciﬁ c methods for determining 
effective Group Policy settings before you apply them.  
 Implementing Group Policy 
 Now that we ’ ve covered the basic layout and structure of group policies and how they 
work, let ’ s look at how you can implement them in an Active Directory environment. In 
this section, you ’ ll start by creating GPOs. Then, you ’ ll apply these GPOs to speciﬁ c Active 
Directory objects and take a look at how to use administrative templates. 
 Creating GPOs 
 In previous versions of Windows Server (2000 and 2003) you could create GPOs from 
many different locations. For example, you could use Active Directory Users and 
Implementing Group Policy 
321

322 
Chapter 8  Configuring Group Policy Objects
Computers to create GPOs on your OUs along with other GPO tools. In Windows Server 
2008 R2, things are simpler. You can create GPOs for OUs in only one location: the Group 
Policy Management Console (GPMC). You have your choice of three applications for 
setting up policies on your Windows Server 2008 R2 computers.  
  Local Computer Policy Tool   This administrative tool allows you to quickly access the 
Group Policy settings that are available for the local computer. These options apply to 
the local machine and to users who access it. You must be a member of the local 
administrators group to access and make changes to these settings.  
  Group Policy Management Console   You must use the GPMC to manage Group Policy 
deployment. The GPMC provides a single solution for managing all Group Policy – related 
tasks and is also best suited to handle enterprise - level tasks such as forest - related work. 
 The GPMC allows administrators to manage the Group Policy and GPOs whether their 
enterprise solution spans multiple domains and sites within one or more forests or it is local 
to one site all from one easy - to - use console. The GPMC adds flexibility, manageability, and 
functionality. Using this console, you can also perform other functions such as backup and 
restore, importing, and copying.  
  Auditpol.exe  Auditpol.exe is a command - line utility that works with Windows 7, 
Windows Vista, Windows Server 2008, or Windows Server 2008 R2. An administrator 
has the ability to display information about policies and also to perform some functions to 
manipulate audit policies. Table 8.1 shows some of the switches available for  auditpol.exe . 
 TA B L E 8 .1  Auditpol.exe switches 
 Switch  
  Explanation  
  /? 
  This is the  auditpol.exe help command. 
  /get 
  Allows you to display the current audit policy.  
  /set 
  Allows you to set a policy.  
  /backup 
  Allows you to save the audit policy to a file.  
  /restore 
  Restores a policy from previous backup. 
 /remove 
  Removes all per - user audit policy settings and disables all system 
audit policy settings. 
 Exercise 8.1 walks you through the process of installing the Group Policy Management 
MMC snap - in for editing Group Policy settings and creating a GPO.  

 You should be careful when making Group Policy settings because certain 
options might prevent the proper use of systems on your network. Always 
test Group Policy settings on a small group of users before you deploy 
GPOs throughout your organization. You ’ ll probably find that some 
settings need to be changed in order for them to be effective.  
 E X E R C I S E  8 .1
Creating a Group Policy Object Using the GPMC  
 1. 
  Click Start   Administrative Tools   Group Policy Management. The Group Policy 
Management tool opens. 
 2. 
  Expand the Forest, Domains,  your domain name , and North America containers. Right -
 click the Corporate OU and then choose Create A GPO In This Domain, And Link It Here.  
 3. 
  When the New GPO dialog box appears, type  Warning Box in the Name ﬁ eld. Click OK.  
 4. 
  The New GPO will be listed on the right side of the Group Policy Management window. 
Right - click the GPO and choose Edit.  
 5. 
  In the Group Policy Management Editor, expand the following: Computer Conﬁ guration   
Policies   Windows Settings   Security Settings   Local Policies   Security Options. 
On the right side, scroll down and double - click Interactive Logon: Message Text For 
Users Attempting To Log On. 
 6. 
  Click the box labeled Deﬁ ne This Policy Setting In The Template. In the text box, type 
 Unauthorized use of this machine is prohibited and then click OK. Close the GPO and 
return to the GPMC main screen. 
 7. 
  Under the domain name (in the GPMC) right - click Group Policy Objects and 
choose New.  
 8. 
  When the New GPO dialog box appears, type  Unlinked Test GPO in the Name ﬁ eld. 
Click OK.  
 9. 
  On the right side, the new GPO will appear. Right - click Unlinked Test GPO and 
choose Edit.  
Implementing Group Policy 
323

324 
Chapter 8  Configuring Group Policy Objects
E X E R C I S E  8 .1  (c o n t i n u e d)
 10.   Under the User Conﬁ guration section, click Policies   Administrative Templates   
Desktop. On the right side, double - click Hide And Disable All Items On The Desktop and 
then click Enabled. Click OK and then close the GPMC.  
 Note that Group Policy changes may not take effect until the next user logs 
in (some settings may even require that the machine be rebooted). That is, 
users who are currently working on the system will not see the effects of 
the changes until they log off and log in again. GPOs are reapplied every 
90 minutes with a 30 - minute offset. In other words, users who are logged 
on will have their policies reapplied every 60 – 120 minutes. Not all settings 
are reapplied (for example, software settings and Password policies).  
 Linking Existing GPOs to Active Directory 
 Creating a GPO is the ﬁ rst step in assigning group policies. The second step is to link the 
GPO to a speciﬁ c Active Directory object. As mentioned earlier in this chapter, GPOs can 
be linked to sites, domains, and OUs. 
 Exercise 8.2 walks you through the steps you must take to assign an existing GPO to an 
OU within the local domain. In this exercise, you will link the Test Domain Policy GPO 

to an OU. In order to complete the steps in this exercise, you must have ﬁ rst completed 
Exercise 8.1.  
 E X E R C I S E  8 . 2
Linking Existing GPOs to Active Directory  
 1. 
  Open the Group Policy Management Console.  
 2. 
  Expand the Forest and Domain containers and right - click the Africa OU. 
 3. 
  Choose Link An Existing GPO.  
 4. 
  The Select GPO dialog box appears. Click Unlinked Test GPO and click OK.  
 5. 
  Close the Group Policy Management Console.  
 Note that the GPMC tool offers a lot of ﬂ exibility in assigning GPOs. You can create 
new GPOs, add multiple GPOs, edit them directly, change priority settings, remove links, 
and delete GPOs all from within this interface. In general, creating new GPOs using the 
GPMC tool is the quickest and easiest way to create the settings you need. 
 To test the Group Policy settings, you can simply create a user account within the Africa 
OU that you created in Exercise 8.2. Then, using another computer that is a member of the 
same domain, you can log on as the newly created user.  
 Managing Group Policy 
 Now that you have implemented GPOs and applied them to sites, domains, and OUs within 
Active Directory, it ’ s time to look at some ways to manage them. In the following sections, 
you ’ ll look at how multiple GPOs can interact with one another and ways you can provide 
security for GPO management. These features are a very important part of working with 
Active Directory, and if you properly plan Group Policy, you can greatly reduce the time 
the help desk spends troubleshooting common problems. 
 Managing GPOs 
 One of the beneﬁ ts of GPOs is that they ’ re modular and can apply to many different objects 
and levels within Active Directory. This can also be one of the drawbacks of GPOs if 
they ’ re not managed properly. A common administrative function related to using GPOs is 
ﬁ nding all of the Active Directory links for each of these objects. You can do this when you 
are viewing the Linked Group Policy Objects tab of the site, domain, or OU in the GPMC 
(shown in Figure 8.2).  
Managing Group Policy 
325

326 
Chapter 8  Configuring Group Policy Objects
 In addition to the common action of delegating permissions on OUs, you can set 
permissions regarding the modiﬁ cation of GPOs. The best way to accomplish this is to 
add users to the Group Policy Creator/Owners built - in security group. The members of 
this group are able to modify security policy. You saw how to add users to groups back in 
Chapter 7,  “ Administering Active Directory. ” 
 Windows Management Instrumentation 
 Windows Management Instrumentation (WMI) scripts are used to gather information or 
to help GPOs deploy better. The best way to explain this is to give an example. Let ’ s say 
we wanted to deploy Microsoft Ofﬁ ce 2010 to everyone in the company. We would ﬁ rst set 
up a GPO to deploy the Ofﬁ ce package (explained later in the section  “ Deploying Software 
through a GPO ” ). 
 We can then place a WMI script on the GPO stating that only computers with 10 GB 
of hard disk space actually deploy Ofﬁ ce. Now if a computer has 10 GB of free space, 
the Ofﬁ ce GPO would get installed. If the computer does not have the 10 GB of hard 
disk space, the GPO will not deploy. You can use WMI scripts to check for computer 
information such as MAC addresses. WMI is a powerful tool because if you know how to 
write scripts, the possibilities are endless. The following script is a sample of a WMI that is 
checking for at least 10 GB of free space on the  C: partition/volume.  
Select * from Win32_LogicalDisk where FreeSpace  > 10737418240 AND Caption = “C:” 
 F I G U R E 8 . 2 Viewing GPO links to an Active Directory OU 

 Security Filtering of a Group Policy 
 Another method of securing access to GPOs is to set permissions on the GPOs themselves. 
You can do this by opening the GPMC, selecting the GPO, and clicking the Advanced 
button in the Delegation tab. The Unlinked Test GPO Security Settings dialog box appears 
(see Figure 8.3). 
 The permissions options include the following: 
 
  Full Control  
 
  Read  
 
  Write  
 
  Create All Child Objects  
 
  Delete All Child Objects  
 
  Apply Group Policy 
 You might have to scroll the Permissions window to see the Apply Group Policy item.  
 F I G U R E  8 . 3 A GPO ’ s Security Settings dialog box 
 Of these, the Apply Group Policy setting is particularly important because you use it 
to ﬁ lter the scope of the GPO.  Filtering is the process by which selected security groups 
are included or excluded from the effects of the GPOs. To specify that the settings should 
apply to a GPO, you should select the Allow check box for both the Apply Group Policy 
setting and the Read setting. These settings will be applied only if the security group is also 
contained within a site, domain, or OU to which the GPO is linked. In order to disable 
GPO access for a group, choose Deny for both of these settings. Finally, if you do not want 
Managing Group Policy 
327

328 
Chapter 8  Configuring Group Policy Objects
to specify either Allow or Deny, leave both boxes blank. This is effectively the same as 
having no setting. 
 In Exercise 8.3, you will ﬁ lter Group Policy using security groups. In order to complete 
the steps in this exercise, you must have ﬁ rst completed Exercises 8.1 and 8.2.  
 E X E R C I S E  8 . 3
Filtering Group Policy Using Security Groups  
 1. 
  Open the Active Directory Users and Computers administrative tool.  
 2. 
  Create a new OU called  Group Policy Test . 
 3. 
  Create two new Global Security groups within the Group Policy Test OU and name them 
 PolicyEnabled and  PolicyDisabled . 
 4. 
  Exit Active Directory Users and Computers and open the GPMC.  
 5. 
  Right - click the Group Policy Test OU, and select Link An Existing GPO.  
 6. 
  Choose Unlinked Test GPO and click OK.  
 7. 
  Expand the Group Policy Test OU so that you can see the GPO (Unlinked Test GPO) 
underneath the OU. 
 8. 
  Click the Delegation tab and then click the Advanced button in the lower - right corner of 
the window.  

 9. 
  Click the Add button and type  PolicyEnabled in the Enter The Object Names To Select 
ﬁ eld. Click the Check Names button. Then click OK.  
 10.   Add a group named  PolicyDisabled in the same way. 
 11.   Highlight the PolicyEnabled group, and select Allow for the Read and Apply Group 
Policy permissions. This ensures that users in the PolicyEnabled group will be affected 
by this policy. 
 12.   Highlight the PolicyDisabled group, and select Deny for the Read and Apply Group 
Policy permissions. This ensures that users in the PolicyDisabled group will not be 
affected by this policy. 
 13.   Click OK. You will see a message stating that you are choosing to use the Deny 
permission and that the Deny permission takes precedence over the Allow entries. Click 
the Yes button to continue.  
 14.   When you have ﬁ nished, close the GPMC tool. 
 Delegating Administrative Control of GPOs 
 So far, you have learned about how you can use Group Policy to manage user and computer 
settings. What you haven ’ t done is determine who can modify GPOs. It ’ s very important to 
establish the appropriate security on GPOs themselves for two main reasons: 
 1. 
 If the security settings aren ’ t set properly, users and systems administrators can easily 
override them. This defeats the purpose of having the GPOs in the first place.  
 2. 
  Having many different systems administrators creating and modifying GPOs can 
become extremely difficult to manage. When problems arise, the hierarchical nature of 
GPO inheritance can make it difficult to pinpoint the problem.  
 Fortunately, through the use of delegation, determining security permissions for GPOs is 
a simple task. You saw the usefulness of delegation in Chapter 7. 
 Exercise 8.4 walks you through the steps you must take to grant the appropriate 
permissions to a user account. Speciﬁ cally, the process involves delegating the ability to 
manage Group Policy links on an Active Directory object (such as an OU). In order to 
complete this exercise, you must have ﬁ rst completed Exercises 8.1 and 8.2.  
 E X E R C I S E  8 . 4
Delegating Administrative Control of Group Policy  
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Expand the local domain, and create a user named  Policy Admin within the Group Policy 
Test OU. 
 3. 
  Exit Active Directory Users and Computers and open the GPMC. 
 4. 
  Click the Group Policy Test OU and select the Delegation tab.  
Managing Group Policy 
329

330 
Chapter 8  Configuring Group Policy Objects
E X E R C I S E  8 . 4  (c o n t i n u e d)
 5. 
  Click the Add button. In the ﬁ eld labeled Enter The Object Name To Select, type  Policy 
Admin and click the Check Names button. 
 6. 
  The Add Group Or User dialog box appears. In the Permissions drop - down list, make 
sure the item labeled Edit Settings, Delete, Modify Security is chosen. Click OK.  
 7. 
  At this point you should be looking at the Group Policy Test Delegation window. Click 
the Advanced button in the lower - right corner. 
 8. 
  Highlight the Policy Admin account and check the Allow Full Control box. This user now 
has full control of these OUs and all child OUs and GPOs for these OUs. Click OK. 
 If you want to just give this user individual rights, then in the Properties window (step 8), 
click the Advanced button and then the Effective Permissions tab. This is where you can 
also choose a user and give them just the rights you need them to have.  
 9. 
  When you have ﬁ nished, close the GPMC tool. 
 
  
 Understanding Delegation 
 Although we have talked about delegation throughout the text, it ’ s important to discuss it 
again in the context of OUs, Group Policy, and Active Directory. 
 Once conﬁ gured, Active Directory administrative delegation allows an administrator 
to delegate tasks (usually admin related) to speciﬁ c user accounts or groups. What this 
means is that if you don ’ t manage it all, the user accounts (or groups) you choose will be 
able to manage their portions of the tree. 
 It ’ s very important to be aware of the beneﬁ ts of Active Directory Delegation (AD Delega-
tion). AD Delegation will help you manage the assigning of administrative control over 
objects in Active Directory, such as users, groups, computers, printers, domains, and 
sites. AD Delegation is used to create more administrators, which essentially saves time. 
 For example, let ’ s say you have a company whose IT department is small and situated 
in the central location. The central location connects three other smaller remote sites. 
These sites do not each warrant a full - time IT person, but the manager on staff (for 
example) can become an administrator for this portion of the tree. If the user accounts for 
the staff at the remote site are managed by that manager, this reduces the burden on the 
systems administrator of trivial administrative work, such as unlocking user accounts or 
changing passwords, and thus it reduces costs. 

 Controlling Inheritance and Filtering Group Policy 
 Controlling inheritance is an important function when you are managing GPOs. Earlier 
in this chapter, you learned that, by default, GPO settings ﬂ ow from higher - level Active 
Directory objects to lower - level ones. For example, the effective set of Group Policy settings 
for a user might be based on GPOs assigned at the site level, the domain level, and in the 
OU hierarchy. In general, this is probably the behavior you would want. 
 In some cases, however, you might want to block Group Policy inheritance. You can 
accomplish this easily by selecting the object to which a GPO has been linked. Right - click 
the object and choose Block Inheritance (see Figure 8.4). By enabling this option, you are 
effectively specifying that this object starts with a clean slate — that is, no other Group 
Policy settings will apply to the contents of this Active Directory site, domain, or OU.  
 F I G U R E 8 . 4 Blocking GPO inheritance 
 Systems administrators can also force inheritance. By setting the Enforced option, they 
can prevent other systems administrators from making changes to default policies. You 
can set the Enforced option by right - clicking the GPO and choosing the Enforced item (see 
Figure 8.5).  
Managing Group Policy 
331

332 
Chapter 8  Configuring Group Policy Objects
 Assigning Script Policies 
 Systems administrators might want to make several changes and settings that would apply 
while the computer is starting up or the user is logging on. Perhaps the most common 
operation that logon scripts perform is mapping network drives. Although users can 
manually map network drives, providing this functionality within login scripts ensures 
that mappings stay consistent and that users need only remember the drive letters for their 
resources. 
 Script policies are speciﬁ c options that are part of Group Policy settings for users and 
computers. These settings direct the operating system to the speciﬁ c ﬁ les that should be 
processed during the startup/shutdown or logon/logoff processes. You can create the scripts 
by using the  Windows Script Host (WSH) or by using standard batch ﬁ le commands. WSH 
allows developers and systems administrators to quickly and easily create scripts using the 
familiar Visual Basic Scripting Edition (VBScript) or JScript (Microsoft ’ s implementation of 
JavaScript). Additionally, WSH can be expanded to accommodate other common scripting 
languages. 
 To set script policy options, you simply edit the Group Policy settings. As shown in 
Figure 8.6, there are two main areas for setting script policy settings.  
  Startup/Shutdown Scripts   These settings are located within the Computer Conﬁ guration   
Windows Settings   Scripts (Startup/Shutdown) object. 
 F I G U R E 8 . 5 Setting the Enforced GPO option 

 Logon/Logoff Scripts   These settings are located within the User Conﬁ guration   
Windows Settings   Scripts (Logon/Logoff) object.  
 To assign scripts, simply double - click the setting, at which time its Properties dialog box 
appears. For instance, if you double - click the Startup setting, the Startup Properties dialog 
box appears, as shown in Figure 8.7. To add a script ﬁ lename, click the Add button. When 
you do, you will be asked to provide the name of the script ﬁ le (such as  MapNetworkDrives
.vbs or  ResetEnvironment.bat ). 
 F I G U R E 8 .6 Viewing Startup/Shutdown script policy settings 
 F I G U R E 8 .7 Setting scripting options 
Managing Group Policy 
333

334 
Chapter 8  Configuring Group Policy Objects
 Note that you can change the order in which the scripts are run by using the Up and 
Down buttons. The Show Files button opens the directory folder in which you should 
store the Logon script ﬁ les. In order to ensure that the ﬁ les are replicated to all domain 
controllers, you should be sure that you place the ﬁ les within the SYSVOL share.  
 Understanding the Loopback Policy 
 There may be times when the user settings of a Group Policy object should be applied to a 
computer, based on its location, instead of the user object. Usually the user Group Policy 
processing dictates that the GPOs be applied in order during computer startup based on the 
computers located in their organizational unit. User GPOs, on the other hand, are applied 
in order during logon, regardless of which computer they log on to. 
 In some situations, this processing order may not be appropriate. A good example is a 
kiosk machine. You would not want applications that have been assigned or published to a 
user to be installed when the user is logged on to the kiosk machine. Loopback Policy allows 
two ways to retrieve the list of GPOs for any user when using a speciﬁ c computer in an OU: 
 Merge Mode   The GPOs for the computer are added to the end of the GPOs for the user. 
Because of this, the computer ’ s GPOs have higher precedence than the user ’ s GPOs. 
  Replace Mode   In Replace mode, the user ’ s GPOs are not used. Only the GPOs of the 
computer object are used. 
 Managing Network Configuration 
 Group policies are also useful in network conﬁ guration. Although administrators can 
handle network settings at the protocol level using many different methods — such as 
Dynamic Host Conﬁ guration Protocol (DHCP) — Group Policy allows them to set which 
functions and operations are available to users and computers. 
 Figure 8.8 shows some of the features that are available for managing Group Policy 
settings. The paths to these settings are as follows:  
 Computer Network Options   These settings are located within the Computer 
Conﬁ guration   Administrative Templates   Network   Network Connections folder.  
  User Network Options   These settings are located within the User Conﬁ guration   
Administrative Templates   Network folder.  
 Examples of the types of settings available include the following: 
 
  The ability to allow or disallow the modification of network settings. 
 In many environments, the improper changing of network conﬁ gurations and protocol 
settings is a common cause of help desk calls.  
 
  The ability to allow or disallow the creation of Remote Access Service (RAS) connections. 
 This option is very useful, especially in larger networked environments, because the 
use of modems and other WAN devices can pose a security threat to the network.  

 
  The ability to set offline files and folders options. 
 This is especially useful for keeping ﬁ les synchronized for traveling users and is 
commonly conﬁ gured for laptops.  
 Each setting includes detailed instructions in the description area of the GPO Editor 
window. By using these conﬁ guration options, systems administrators can maintain 
consistency for users and computers and can avoid many of the most common 
troubleshooting calls. 
 F I G U R E  8 . 8 Viewing Group Policy User network configuration options 
 Automatically Enrolling User and Computer 
Certificates in Group Policy 
 You can also use Group Policy to automatically enroll user and computer certiﬁ cates, making 
the entire certiﬁ cate process transparent to your end users. Before you go on, you should 
understand what certiﬁ cates are and why they are an important part of network security. 
 Think of a digital certiﬁ cate as a carrying case for a public key. A certiﬁ cate contains 
the public key and a set of attributes, including the key holder ’ s name and email address. 
These attributes specify something about the holder: their identity, what they ’ re allowed 
to do with the certiﬁ cate, and so on. The attributes and the public key are bound together 
because the certiﬁ cate is digitally signed by the entity that issued it. Anyone who wants to 
verify the certiﬁ cate ’ s contents can verify the issuer ’ s signature. 
Managing Group Policy 
335

336 
Chapter 8  Configuring Group Policy Objects
 Certiﬁ cates are one part of what security experts call a public - key infrastructure (PKI). 
A PKI has several different components that you can mix and match to achieve the desired 
results. Microsoft ’ s PKI implementation offers the following functions:  
  Certificate Authorities   CAs issue certiﬁ cates, revoke certiﬁ cates they ’ ve issued, and 
publish certiﬁ cates for their clients. Big CAs like Thawte and VeriSign may do this for 
millions of users; you can also set up your own CA for each department or workgroup in 
your organization if you want. Each CA is responsible for choosing what attributes it will 
include in a certiﬁ cate and what mechanism it will use to verify those attributes before it 
issues the certiﬁ cate. 
  Certificate Publishers   They make certiﬁ cates publicly available, inside or outside an 
organization. This allows widespread availability of the critical material needed to support 
the entire PKI.  
  PKI - Savvy Applications   These allow you and your users to do useful things with 
certiﬁ cates, like encrypt email or network connections. Ideally, the user shouldn ’ t have to 
know (or even necessarily be aware of) what the application is doing — everything should 
work seamlessly and automatically. The best - known examples of PKI - savvy applications 
are web browsers like Internet Explorer and Netscape Navigator and email applications 
like Outlook and Outlook Express. 
  Certificate Templates   These act like rubber stamps. By specifying a particular template 
as the model you want to use for a newly issued certiﬁ cate, you ’ re actually telling the CA 
which optional attributes to add to the certiﬁ cate, as well as implicitly telling it how to 
ﬁ ll some of the mandatory attributes. Templates greatly simplify the process of issuing 
certiﬁ cates because they keep you from having to memorize the names of all the attributes 
you might potentially want to put in a certiﬁ cate.  
 Learn More about PKI 
 When discussing certiﬁ cates, it ’ s important to also mention PKI and its deﬁ nition. The 
exam doesn ’ t go deeply into PKI, but we recommend that you do some extra research 
on your own because it is a very important technology and shouldn ’ t be overlooked. PKI 
is actually a simple concept with a lot of moving parts. When broken down to its bare 
essentials, PKI is nothing more than a server and workstations utilizing a software ser-
vice to add security to your infrastructure. When you use PKI, you are adding a layer of 
protection. The auto - enrollment Settings policy determines whether or not users and/or 
computers are automatically enrolled for the appropriate certiﬁ cates when necessary. By 
default, this policy is enabled if a certiﬁ cate server is installed, but you can make changes 
to the settings, as shown in Exercise 8.5. 
 In Exercise 8.5, you will learn how to conﬁ gure automatic certiﬁ cate enrollment in Group 
Policy. You must have completed the other exercises in this chapter in order to proceed. 

 E X E R C I S E  8 . 5
Configuring Automatic Certificate Enrollment in Group Policy  
 1. 
  Open the Group Policy Management Console tool.  
 2. 
  Right - click the North America OU you created in the previous exercises in this book.  
 3. 
  Choose Create A GPO In This Domain And Link It Here and name it  Test CA . Click OK.  
 4. 
  Right - click the Test CA GPO and choose Edit.  
 5. 
  Open Computer Conﬁ guration   Policies   Windows Settings   Security Settings   
Public Key Policies.  
 6. 
  Double - click Certiﬁ cate Services Client  -  Auto - Enrollment in the right pane.  
 7. 
  The Certiﬁ cate Services Client  -  Auto - Enrollment Properties dialog box will appear.  
 8. 
  For now, you won ’ t change anything. Just become familiar with the settings in this 
dialog box. Click OK to close it.  
 Redirecting Folders 
 Another set of Group Policy settings that you will learn about are the  folder redirection 
settings. Group Policy provides a means of redirecting the My Documents, Desktop, 
Managing Group Policy 
337

338 
Chapter 8  Configuring Group Policy Objects
and Start menu folders, as well as cached application data, to network locations. Folder 
redirection is particularly useful for the following reasons: 
 
  When using roaming user profiles, a user ’ s  My Documents folder is copied to the local 
machine each time he logs on. This requires high bandwidth consumption and time if 
the  My Documents folder is large. If you redirect the  My Documents folder, it stays in the 
redirected location, and the user opens and saves files directly to that location.  
 
  Documents are always available no matter where the user logs on.  
 
  Data in the shared location can be backed up during the normal backup cycle without 
user intervention.  
 
  Data can be redirected to a more robust server - side - administered disk that is less prone 
to physical and user errors.  
 When you decide to redirect folders, you have two options: basic and advanced.  
 
  Basic redirection redirects everyone ’ s folders to the same location (but each user gets 
their own folder within that location).  
 
  Advanced redirection redirects folders to different locations based on group 
membership. For instance, you could configure the Engineers group to redirect their 
folders to  //Engineering1/My_Documents/ and the Marketing group to  //Marketing1/
My_Documents/ . Again, each individual user still gets their own folder within the 
redirected location. 
 To conﬁ gure folder redirection, follow the steps in Exercise 8.6. You must have 
completed the other exercises in this chapter in order to proceed.  
 E X E R C I S E  8 . 6
Configuring Folder Redirection in Group Policy  
 1. 
  Open the GPMC tool.  
 2. 
  Open the North America OU and then edit the Test CA GPO.  
 3. 
  Open User Conﬁ guration   Policies   Windows Settings   Folder Redirection   
Documents.  
 4. 
  Right - click Documents and select Properties. 
 5. 
  On the Target tab of the Documents Properties dialog box, choose the Basic  -  Redirect 
Everyone ’ s Folder To The Same Location selection from the Setting drop - down list. 
 6. 
  Leave the default option for the Target Folder Location drop - down list and specify a 
network path in the Root Path ﬁ eld.  
 7. 
  Click the Settings tab. All of the default settings are self - explanatory and should 
typically be left with the default setting. Click OK when you have ﬁ nished. 

 Managing GPOs with Windows PowerShell 
Group Policy Cmdlets 
 As we stated earlier in this book, Windows PowerShell is a Windows command - line shell 
and scripting language. Windows PowerShell can also help an administrator automate 
many of the same tasks that you perform using the Group Policy Management Console. 
 Windows Server 2008 R2 helps you perform many of the Group Policy tasks by 
providing more than 25 cmdlets. Each of these cmdlets is a simple, single - function 
command - line tool. 
 The Windows PowerShell Group Policy cmdlets can help you to perform some of the 
following tasks for domain - based Group Policy objects: 
 
  Maintain, create, remove, back up, and import GPOs. 
 
  Create, update, and remove GPO links to Active Directory containers.  
 
  Set Active Directory OUs and domain permissions and inheritance flags.  
 
  Configure Group Policy registry settings.  
 
  Create and edit Starter GPOs.  
 The requirement for Windows PowerShell Group Policy cmdlets is Windows Server 
2008 R2 on either a domain controller or a member server that has the GPMC installed. 
 Folder Redirection Facts 
 Try not to mix up the concepts of  folder redirection and  ofﬂ ine folders , especially in a 
world with ever - increasing numbers of mobile users. Folder redirection and ofﬂ ine 
folders are different features. 
 Windows Server 2008 R2 folder redirection works as follows: The system uses a pointer 
that moves the folders you want to a location you specify. Users do not see any of this — it 
is transparent to them. One problem with folder redirection is that it does not work for 
mobile users (users who will be ofﬂ ine and who will not have access to ﬁ les that they 
may need). 
 Ofﬂ ine folders, however, are copies of folders that were local to you. Files are now avail-
able locally to you on the system you have with you. They are also located back on the 
server where they are stored. The next time you log in, the folders are synchronized 
so that both folders contain the latest data. This is a perfect feature for mobile users, 
whereas folder redirection provides no beneﬁ t for the mobile user. 
Managing Group Policy 
339

340 
Chapter 8  Configuring Group Policy Objects
Windows 7 also has the ability to use Windows PowerShell Group Policy cmdlets if it has 
Remote Server Administration Tools (RSAT) installed. RSAT includes the GPMC and its 
cmdlets. PowerShell v2 is also a requirement.  
 Deploying Software through a GPO 
 It ’ s difﬁ cult enough to manage applications on a stand - alone computer. It seems that the 
process of installing, conﬁ guring, and uninstalling applications is never ﬁ nished. Add in 
the hassle of computer reboots and reinstalling corrupted applications, and the reduction in 
productivity can be very real. 
 Software administrators who manage software in network environments have even more 
concerns: 
 
  First and foremost, they must determine which applications specific users require.  
 
  Then, IT departments must purchase the appropriate licenses for the software and 
acquire any necessary media.  
 
  Next, the systems administrators need to actually install the applications on users ’ 
machines. This process generally involves help desk staff visiting computers, or it 
requires end users to install the software themselves. Both processes entail several 
potential problems, including installation inconsistency and lost productivity from 
downtime experienced when applications were installed.  
 
  Finally, they still need to manage software updates and remove unused software.  
 One of the key design goals for Active Directory was to reduce some of the headaches 
involved in managing software and conﬁ gurations in a networked environment. To that 
end, Windows Server 2008 R2 offers several features that can make the task of deploying 
software easier and less error prone. Before you dive into the technical details, though, you 
need to examine the issues related to software deployment. 
 The Software Management Life Cycle 
 Although it may seem that the use of a new application requires only the installation of 
the necessary software, the overall process of managing applications involves many more 
steps. When managing software applications, there are three main phases to the life cycle 
of applications:  
 Phase 1: Deploying Software   The ﬁ rst step in using applications is to install them on the 
appropriate client computers. Generally, some applications are deployed during the initial 
conﬁ guration of a PC, and others are deployed when they are requested. In the latter case, 
this often used to mean that systems administrators and help desk staff would have to 
visit client computers and manually walk through the installation process. With Windows 
Server 2008 R2 and GPOs, the entire process can be automated.  

 Phase 2: Maintaining Software   Once an application is installed and in use on client 
computers, you need to ensure that the software is maintained. You must keep programs 
up to date by applying changes due to bug ﬁ xes, enhancements, and other types of 
updates. This is normally done with service packs, hot ﬁ xes, and updates. As with the 
initial software deployment, software maintenance can be tedious. Some programs require 
older versions to be uninstalled before updates are added. Others allow for automatically 
upgrading over existing installations. Managing and deploying software updates can 
consume a signiﬁ cant amount of the IT staff ’ s time. 
 Before You Install, Stop 
 It is very important to understand that just because you can easily deploy software does 
not necessarily mean that you have the right to do so. Before you install software on cli-
ent computers, you must make sure that you have the appropriate licenses for the soft-
ware. Furthermore, it ’ s very important to take the time to track application installations. 
As many systems administrators have discovered, it ’ s much more difﬁ cult to inventory 
software installations after they ’ ve been performed. Another issue you may encounter is 
that you lack available resources (for instance, your system does not meet the minimum 
hardware requirements) and face problems such as limited hard disk space or memory 
that may not be able to handle the applications you want to load and use. You may also 
ﬁ nd that your user account does not have the permission to install software. It ’ s impor-
tant to consider not only how you will install software but also whether you can. 
 Using Windows Update 
 Make sure you learn about Windows Update, a service that allows you to connect to 
Microsoft ’ s website and download what your system may need to bring it up to compli-
ance. This tool is very helpful if you are running a stand - alone system, but if you want 
to deploy software across your enterprise, the best way to accomplish this is to ﬁ rst test 
the updates you are downloading and make sure you can use them and that they are not 
buggy. Then you can use a tool such as the Windows Server Update Service (WSUS), 
formally called the Software Update Services (SUS). 
 You can check for updates at Microsoft ’ s website ( http://update.microsoft.com ). Micro-
soft likes to ask many types of questions about WSUS on its certiﬁ cation exams. WSUS is 
described in detail in other Sybex certiﬁ cation series books. 
Deploying Software through a GPO 
341

342 
Chapter 8  Configuring Group Policy Objects
  Phase 3: Removing Software   At the end of the life cycle for many software products is 
the actual removal of unused programs. Removing software is necessary when applications 
become outdated or when users no longer require their functionality. One of the traditional 
problems with uninstalling applications is that many of the installed ﬁ les may not be 
removed. Furthermore, the removal of shared components can sometimes cause other 
programs to stop functioning properly. Also, users often forget to uninstall applications 
that they no longer need, and these programs continue to occupy disk space and consume 
valuable system resources.  
 Each of these three phases of the software maintenance life cycle is managed by the 
Microsoft Windows Installer (MSI). Now that you have an overview of the process, let ’ s 
move on to look at the actual steps involved in deploying software using Group Policy.  
 The Microsoft Windows Installer (sometimes referred to as Microsoft Installer 
or Windows Installer) is an application installation and configuration service. 
An instruction file (the Microsoft Installer package) contains information 
about what needs to be done to install a product. It ’ s common to confuse 
the two. 
 The Windows Installer 
 If you ’ ve installed newer application programs (such as Microsoft Ofﬁ ce 2010), you ’ ve 
probably noticed the updated setup and installation routines. Applications that comply 
with the updated standard use the  Windows Installer  speciﬁ cation and MSI software 
packages for deployment. Each package contains information about various setup options 
and the ﬁ les required for installation. Although the beneﬁ ts may not seem dramatic on the 
surface, there ’ s a lot of new functionality under the hood. 
 The Windows Installer was created to solve many of the problems associated with 
traditional application development. It has several components, including the Installer 
service (which runs on Windows 2000, XP, Vista, Windows 7, Server 2003, Windows 
Server 2008, and Server 2008 R2 computers), the Installer program ( msiexec.exe ) 
that is responsible for executing the instructions in a  Windows Installer package , and 
the speciﬁ cations third - party developers use to create their own packages. Within each 
installation package ﬁ le is a relational structure (similar to the structure of tables in 
databases) that records information about the programs contained within the package. 
 In order to appreciate the true value of the Windows Installer, you ’ ll need to look at 
some of the problems with traditional software deployment mechanisms and then at how 
the Windows Installer addresses many of these. 
 Application Installation Issues 
 Before the Windows Installer, applications were installed using a setup program that 
managed the various operations required for a program to operate. These operations 

included copying ﬁ les, changing Registry settings, and managing any other operating 
system changes that might be required (such as starting or stopping services). However, this 
method included several problems: 
 
  The setup process was not robust, and aborting the operation often left many unneces-
sary files in the filesystem. 
 
  The process included uninstalling an application (this also often left many unnecessary 
files in the filesystem) and remnants in the Windows Registry and operating system 
folders. Over time, these remnants would result in reduced overall system performance 
and wasted disk space.  
 
  There was no standard method for applying upgrades to applications, and installing 
a new version often required users to uninstall the old application, reboot, and then 
install the new program.  
 
  Conflicts between different versions of dynamic link libraries (DLLs) — shared program 
code used across different applications — could cause the installation or removal of one 
application to break the functionality of another.  
 Benefits of the Windows Installer 
 Because of the many problems associated with traditional software installation, Microsoft 
created the Windows Installer. This system provides for better manageability of the 
software installation process and allows systems administrators more control over the 
deployment process. Speciﬁ cally, beneﬁ ts of the Windows Installer include the following:  
 Improved Software Removal   The process of removing software is an important one since 
remnants left behind during the uninstall process can eventually clutter up the Registry 
and ﬁ lesystem. During the installation process, the Windows Installer keeps track of all of 
the changes made by a setup package. When it comes time to remove an application, all of 
these changes can then be rolled back.  
 More Robust Installation Routines  If a typical setup program is aborted during the 
software installation process, the results are unpredictable. If the actual installation hasn ’ t 
yet begun, then the installer generally removes any temporary ﬁ les that may have been 
created. If, however, the ﬁ le copy routine starts before the system encounters an error, it is 
likely that the ﬁ les will not be automatically removed from the operating system. In contrast, 
the Windows Installer allows you to roll back any changes when the application setup 
process is aborted. 
 Ability to Use Elevated Privileges   Installing applications usually requires the user to have 
Administrator permissions on the local computer because ﬁ lesystem and Registry changes 
are required. When installing software for network users, systems administrators thus 
have two options. First, they can log off of the computer before installing the software 
and then log back on as a user who has Administrator permissions on the local computer. 
This method is tedious and time consuming. The second option is to temporarily give 
Deploying Software through a GPO 
343

344 
Chapter 8  Configuring Group Policy Objects
users Administrator permissions on their own machines. This method could cause security 
problems and requires the attention of a systems administrator. 
 Through the use of the Installer service, the Windows Installer is able to use temporarily 
elevated privileges to install applications. This allows users, regardless of their security 
settings, to execute the installation of authorized applications. This saves time and 
preserves security. 
  Support for Repairing Corrupted Applications   Regardless of how well a network 
environment is managed, critical ﬁ les are sometimes lost or corrupted. Such problems 
can prevent applications from running properly and can cause crashes. Windows Installer 
packages provide you with the ability to verify the installation of an application and, if 
necessary, replace any missing or corrupted ﬁ les. This support saves time and lessens the 
end - user headaches associated with removing and reinstalling an entire application to 
replace just a few ﬁ les.  
 Prevention of File Conflicts   Generally, different versions of the same ﬁ les should 
be compatible with each other. In the real world, however, this isn ’ t always the case. A 
classic problem in the Windows world is the case of one program replacing DLLs that 
are used by several other programs. Windows Installer accurately tracks which ﬁ les are 
used by certain programs and ensures that any shared ﬁ les are not improperly deleted or 
overwritten.  
  Automated Installations   A typical application setup process requires end users or systems 
administrators to respond to several prompts. For example, a user may be able to choose 
the program group in which icons will be created and the ﬁ lesystem location to which the 
program will be installed. Additionally, they may be required to choose which options are 
installed. Although this type of ﬂ exibility is useful, it can be tedious when you are rolling 
out multiple applications. By using features of the Windows Installer, however, users are 
able to specify setup options before the process begins. This allows systems administrators 
to ensure consistency in installations, and it saves users ’ time. 
  Advertising and On - Demand Installations   One of the most powerful features of the 
Windows Installer is its ability to perform on - demand software installations. Prior to 
the Windows Installer, application installation options were quite basic — either a program 
was installed or it was not. When setting up a computer, systems administrators would be 
required to guess which applications the user might need and install all of them. 
 The Windows Installer supports a function known as advertising. Advertising makes 
applications appear to be available via the Start menu. However, the programs themselves 
may not actually be installed on the system. When a user attempts to access an advertised 
application, the Windows Installer automatically downloads the necessary files from a 
server and installs the program. The result is that applications are installed only when they 
are needed, and the process requires no intervention from the end user. We ’ ll cover the 
details of this process later in this chapter.  

 To anyone who has managed many software applications in a network environment, 
all of these features of the Windows Installer are likely welcome ones. They also make life 
easier for end users and application developers who can focus on the  “ real work ” their jobs 
demand. 
 Windows Installer File Types 
 When performing software deployment with the Windows Installer in Windows Server 
2008 R2, you may encounter several different ﬁ le types:  
 Microsoft Windows Installer Packages   In order to take full advantage of Windows 
Installer functionality, applications must include Microsoft Windows Installer (MSI) 
packages. These packages are normally created by third - party application vendors and 
software developers, and they include the information required to install and conﬁ gure the 
application and any supporting ﬁ les.  
 Microsoft Transformation Files  Microsoft Transformation (MST) ﬁ les are useful when you 
are customizing the details of how applications are installed. When a systems administrator 
chooses to assign or publish an application, they may want to specify additional options for 
the package. If, for instance, a systems administrator wants to allow users to install only the 
Microsoft Word and Microsoft PowerPoint components of Ofﬁ ce 2010, they could specify 
these options within a transformation ﬁ le. Then, when users install the application, they will 
be provided with only the options related to these components. 
 Microsoft Patches   In order to maintain software,  patches are often required. Patches 
may make Registry and/or ﬁ lesystem changes. Patch ﬁ les (MSP) are used for minor system 
changes and are subject to certain limitations. Speciﬁ cally, a patch ﬁ le cannot remove 
any installed program components and cannot delete or modify any shortcuts created 
by the user. 
 Initialization Files   In order to provide support for publishing non – Windows Installer 
applications,  initialization ﬁ les can be used. These ﬁ les provide links to a standard 
executable ﬁ le that is used to install an application. An example might be  \\server1\
software\program1\setup.exe . These ﬁ les can then be published and advertised, and users 
can access the  Add or Remove Programs icon to install them over the network.  
 Application Assignment Scripts   Application assignment scripts (AAS) store information 
regarding assigning programs and any settings that the systems administrator makes. These 
ﬁ les are created when Group Policy is used to create software package assignments for 
users and computers.  
 Each of these types of ﬁ les provides functionality that allows the systems administrator 
to customize software deployment. Windows Installer packages have special properties that 
you can view by right - clicking the ﬁ le in Windows Explorer and choosing Properties (see 
Figure 8.9).  
Deploying Software through a GPO 
345

346 
Chapter 8  Configuring Group Policy Objects
 Deploying Applications 
 The functionality provided by Windows Installer offers many advantages to end users 
who install their own software. That, however, is just the beginning in a networked 
environment. As you ’ ll see later in this chapter, the various features of Windows Installer 
and compatible packages allow systems administrators to centrally determine applications 
that users will be able to install. 
 There are two main methods of making programs available to end users using Active 
Directory:  assigning and  publishing . Both publishing and assigning applications greatly 
ease the process of deploying and managing applications in a network environment. 
 In the following sections, you ’ ll look at how the processes of assigning and publishing 
applications can make life easier for IT staff and users alike. The various settings for 
assigned and published applications are managed through the use of GPOs. 
 Assigning Applications 
 Software applications can be assigned to users and computers. Assigning a software 
package makes the program available for automatic installation. The applications advertise 
 F I G U R E 8 . 9 Viewing the properties of an MSI package file 

their availability to the affected users or computers by placing icons within the  Programs 
folder of the Start menu. 
 When applications are assigned to a user, programs will be advertised to the user, 
regardless of which computer they are using. That is, icons for the advertised program 
will appear within the Start menu, regardless of whether the program is installed on that 
computer. If the user clicks an icon for a program that has not yet been installed on the 
local computer, the application will automatically be accessed from a server and will be 
installed. 
 When an application is assigned to a computer, the program is made available to any 
users of the computer. For example, all users who log on to a computer that has been 
assigned Microsoft Ofﬁ ce 2010 will have access to the components of the application. If 
the user did not previously install Microsoft Ofﬁ ce 2010, they will be prompted for any 
required setup information when the program ﬁ rst runs. 
 Generally, applications that are required by the vast majority of users should be 
assigned to computers. This reduces the amount of network bandwidth required to install 
applications on demand and improves the end - user experience by preventing the delay 
involved when installing an application the ﬁ rst time it is accessed. Any applications that 
may be used by only a few users (or those with speciﬁ c job tasks) should be assigned 
to users.  
 Publishing Applications 
 When applications are published, they are advertised, but no icons are automatically 
created. Instead, the applications are made available for installation using the Add Or 
Remove Programs icon in Control Panel.  
 Vista and Windows 7 do not have the Add Or Remove Programs feature. Vista 
and Windows 7 use the Programs icon in Control Panel to install the software.  
 Implementing Software Deployment 
 So far, you have become familiar with the issues related to software deployment and 
management from a theoretical level. Now it ’ s time to drill down into the actual steps required 
to deploy software using the features of Active Directory and the GPMC. In the following 
sections, you will walk through the steps required to create an application distribution share 
point, to publish and assign applications, to update previously installed applications, to verify 
the installation of applications, and to update Windows operating systems. 
 Preparing for Software Deployment 
 Before you can install applications on client computers, you must make sure that the 
necessary ﬁ les are available to end users. In many network environments, systems 
Implementing Software Deployment 
347

348 
Chapter 8  Configuring Group Policy Objects
administrators create shares on ﬁ le servers that include the installation ﬁ les for many 
applications. Based on security permissions, either end users or systems administrators 
can then connect to these shares from a client computer and install the needed software. 
The efﬁ cient organization of these shares can save the help desk from having to carry around 
a library of CD - ROMs and can allow you to install applications easily on many computers 
at once. 
 One of the problems in network environments is that users frequently 
install applications whether or not they really need them. They may 
stumble upon applications that are stored on common file servers and 
install them out of curiosity. These actions can often decrease productivity 
and may violate software licensing agreements. You can help avoid this 
by placing all of your application installation files in hidden shares (for 
example,   “ software$ ”  ).  
 Exercise 8.7 walks you through the process of creating a software distribution share 
point. In this exercise, you will prepare for software deployment by creating a directory 
share and placing certain types of ﬁ les in this directory. In order to complete the steps 
in this exercise, you must have access to the Microsoft Ofﬁ ce 2010 installation ﬁ les 
(via CD - ROM or through a network share) and have 2000 MB of free disk space.  
 E X E R C I S E  8 . 7
Creating a Software Deployment Share  
 1. 
  Using Windows Explorer, create a folder called   Software  that you can use with 
application sharing. Be sure that the volume on which you create this folder has at least 
2000 MB of available disk space. 
 2. 
  Within the  Software folder, create a folder called   Office 2010  . 
 3. 
  Copy all of the installation ﬁ les for Microsoft Ofﬁ ce 2010 from the CD - ROM or network 
share containing the ﬁ les to the  Office 2010 folder that you created in step 2. If you 
prefer, you can use switches to install all of the Ofﬁ ce 2010 installation ﬁ les. You can ﬁ nd 
these switches at  http://technet.microsoft.com/en-us/library/ff521767.aspx . 
 4. 
  Right - click the  Software folder (created in step 1), and select Share. In the Choose 
People On Your Network To Share With dialog box, type  Everyone , and click the Add 
button. Next click the Share button. When you see a message that the sharing process 
is complete, click the Done button. 
 Once you have created an application distribution share, it ’ s time to actually publish and 
assign the applications. This topic is covered next.  

 Software Restriction Policies 
 One of the biggest problems that we face as IT managers is users downloading and 
installing software. Many software packages don ’ t cause any issues and are completely 
safe. Unfortunately, many software packages do have viruses and can cause problems. This 
is where software restriction policies can help. Software restriction policies help to identify 
software and to control its ability to run on a local computer, organizational unit, domain, 
or site. 
 Software restriction policies give administrators the ability to regulate unknown or 
untrusted software. Software restriction policies allow you to protect your computers from 
unwanted software by identifying and also specifying what software packages are allowed 
to be installed. 
 When conﬁ guring software restriction policies, an administrator has the ability to deﬁ ne 
a default security level of Unrestricted  ( software is allowed) or Disallowed (software is 
not allowed to run) for a GPO. Administrators have the ability to make exceptions to this 
default security level. Administrators can create software restriction policy rules for speciﬁ c 
software. 
 To create a software policy using the Group Policy Management Console, create a 
new GPO. In the GPO, expand the Windows Settings for either the user or computer 
conﬁ guration section, expand Security, right - click Software Restriction Policy, and choose 
New Software Restriction Policy. Set the policy for the level of security that you need.  
 Using AppLocker 
 AppLocker is a new feature in Windows 7 and Windows Server 2008 R2, and it is the 
replacement for Software Restriction Policies. AppLocker allows you to conﬁ gure a Denied 
list and an Accepted list for applications. Applications that are conﬁ gured on the 
Denied list will not run on the system, whereas applications on the Accepted list will 
operate properly. 
 The new capabilities and extensions of the AppLocker feature help reduce administrative 
overhead and help administrators control how users can access and use ﬁ les, such as  .exe 
ﬁ les, scripts, Windows Installer ﬁ les ( .msi and .msp ﬁ les), and DLLs.  
 Group Policy Slow Link Detection 
 When setting up GPOs, most of us assume that the connection speeds between the 
servers and the clients are going to be fast. In today ’ s world, it is very unlikely to see slow 
connections between locations, but they are still out there. Sometimes connection speeds 
can cause issues with the deployment of GPOs, speciﬁ cally ones deploying software. 
 A setting in the Computer and User section of the GPO called Group Policy Slow Link 
Detection deﬁ nes a slow connection for the purposes of applying and updating GPOs. 
 If the data transfer rate from the domain controller providing the GPO to the computer 
is slower than what you have speciﬁ ed in this setting, the connection is considered to 
Implementing Software Deployment 
349

350 
Chapter 8  Configuring Group Policy Objects
be a slow connection. If a connection is considered slow, the system response will vary 
depending on the policy. For example, if a GPO is going to deploy software and the 
connection is considered slow, the software may not be installed on the client computer. If 
you conﬁ gure this option as 0, all connections are considered fast connections.  
 Publishing and Assigning Applications 
 As we mentioned earlier in this section, systems administrators can make software 
packages available to users by using publishing and assigning operations. Both of these 
operations allow systems administrators to leverage the power of Active Directory and, 
speciﬁ cally, GPOs to determine which applications are available to users. Additionally, 
OUs can provide the organization that can help group users based on their job functions 
and software requirements. 
 The general process involves creating a GPO that includes software deployment settings 
for users and computers and then linking this GPO to Active Directory objects. 
 Exercise 8.8 walks you through the steps you need to take to publish and assign 
applications. In this exercise, you will create applications and assign them to speciﬁ c Active 
Directory objects using GPOs. In order to complete the steps in this exercise, you must have 
ﬁ rst completed Exercise 8.7.  
 E X E R C I S E  8 . 8
Publishing and Assigning Applications Using Group Policy  
 1. 
  Open the Active Directory Users and Computers tool from the Administrative Tools 
program group. 
 2. 
  Expand the domain, and create a new top - level OU called  Software . 
 3. 
  Within the Software OU, create a user named   Jane User  with a login name of   juser  
(choose the defaults for all other options).  
 4. 
  Exit Active Directory Users and Computers and open the Group Policy Management 
Console.  
 5. 
  Right - click the Software OU and choose Create A GPO In This Domain And Link It Here.  
 6. 
  For the name of the new GPO, type  Software Deployment . 
 7. 
  To edit the Software Deployment GPO, right - click it and choose Edit. Expand the 
Computer Conﬁ guration   Policies   Software Settings object. 
 8. 
  Right - click the Software Installation item, and select New   Package.  
 9. 
  Navigate to the Software share that you created in Exercise 8.7.  
 10.   Within the Software share, double - click the  Office 2010 folder and select the 
appropriate MSI ﬁ le depending on the version of Ofﬁ ce 2010 that you have. Ofﬁ ce 2010 
Professional is being used in this example, so you ’ ll see that the  OFFICEMUI.MSI ﬁ le is 
chosen. Click Open. 

 11.   In the Deploy Software dialog box, choose Advanced. (Note that the Published option is 
unavailable because applications cannot be published to computers.) Click OK to return 
to the Deploy Software dialog box.  
 12.   To examine the deployment options of this package, click the Deployment tab. Accept 
the default settings by clicking OK.  
 13.   Within the Group Policy Object Editor, expand the User Conﬁ guration   Software 
Settings object. 
 14.   Right - click the Software Installation item, and select New   Package.  
 15.   Navigate to the Software share that you created in Exercise 8.7.  
 16.   Within the Software share, double - click the  Office 2010 folder, and select the 
appropriate MSI ﬁ le. Click Open.  
 17.   For the Software Deployment option, select Published in the Deploy Software dialog 
box and click OK. 
 18.   Close the GPMC.  
 The overall process involved with deploying software using Active Directory is quite 
simple. However, you shouldn ’ t let the intuitive graphical interface fool you — there ’ s a lot 
of power under the hood of these software deployment features! Once you ’ ve properly 
assigned and published applications, it ’ s time to see the effects of your work.  
 Applying Software Updates 
 The steps described in the previous section work only when you are installing a brand - new 
application. However, software companies often release updates that you need to install 
on top of existing applications. These updates usually consist of bug ﬁ xes or other changes 
that are required to keep the software up to date. You can apply software updates in Active 
Directory by using the Upgrades tab of the software package Properties dialog box found 
in the Group Policy Object Editor. 
 In Exercise 8.9, you will apply a software update to an existing application. You 
should add the upgrade package to the GPO in the same way that you added the original 
application in steps 8 through 12 of Exercise 8.8. You should also have completed Exercise 8.8 
before attempting this exercise.  
 E X E R C I S E  8 . 9
Applying Software Updates  
 1. 
  Open the Group Policy Management Console from the Administrative Tools program group.  
 2. 
  Click the Software OU, right - click the Software Deployment GPO, and choose Edit.  
 3. 
  Expand the Computer Conﬁ guration   Policies   Software Settings   Software 
Installation object. 
Implementing Software Deployment 
351

352 
Chapter 8  Configuring Group Policy Objects
E X E R C I S E  8 . 9  (c o n t i n u e d)
 4. 
  Right - click the software package, and select Properties from the context menu to bring 
up the Properties dialog box. 
 5. 
  Select the Upgrades tab and click the Add button.  
 6. 
  Click the Current Group Policy Object (GPO) radio button in the Choose A Package 
From section of the dialog box, or click the Browse button to select the GPO to which 
you want to apply the upgrade. Consult your application ’ s documentation to see if you 
should choose the Uninstall The Existing Package, Then Install The Upgrade Package 
radio button or the Package Can Upgrade Over The Existing Package radio button.  
 7. 
  Click Cancel to close the Add Upgrade Package dialog box.  
 8. 
  Click Cancel and exit the GPMC.  
 You should understand that not all upgrades make sense in all situations. For instance, 
if Stellacon 6 ﬁ les are incompatible with the Stellacon 10 application, then your Stellacon 6 
users might not want you to perform the upgrade without taking additional steps to ensure 
that they can continue to use their ﬁ les. In addition, users might have some choice about 
which version they use when it doesn ’ t affect the support of the network. 
 Regardless of the underlying reason for allowing this ﬂ exibility, you should be aware 
that there are two basic types of upgrades that are available for administrators to provide 
to the users:  
 Mandatory Upgrade   Forces everyone who currently has an existing version of the 
program to upgrade according to the GPO. Users who have never installed the program for 
whatever reason will be able to install only the new upgraded version.  
  Nonmandatory Upgrade   Allows users to choose whether they would like to upgrade. 
This upgrade type also allows users who do not have their application installed to choose 
which version they would like to use.  
 Verifying Software Installation 
 In order to ensure that the software installation settings you make in a GPO have taken 
place, you can log in to the domain from a Windows 7 or Vista computer that is within the 
OU to which the software settings apply. When you log in, you will notice two changes. 
First, the application is installed on the computer (if it was not installed already). In order 
to access the application, all a user needs to do is click one of the icons within the Program 
group of the Start menu. Note also that applications are available to any of the users who 
log on to this machine. Second, the settings apply to any computers that are contained 
within the OU and to any users who log on to these computers. 
 If you publish an application to users, the change may not be as evident, but it is 
equally useful. When you log on to a Windows 7 or Vista computer that is a member 

of the domain, and when you use a user account from the OU where you published the 
application, you will be able to automatically install any of the published applications. On 
a Windows 7 computer, you can do this by accessing the Add Or Remove Programs icon 
in Control Panel. By clicking Add New Programs, you access a display of the applications 
available for installation. By clicking the Add button in the Add New Programs section of 
the Add Or Remove Programs dialog box, you will automatically begin the installation 
of the published application.  
 Vista and Windows 7 do not have the Add Or Remove Programs feature. 
In Vista and Windows 7, use the Programs icon in Control Panel to install 
the software.  
 Configuring Automatic Updates in Group Policy 
 So far you ’ ve seen the advantages of deploying application software in a group policy. 
Group policies also provide a way to install operating system updates across the network 
for Windows 2000, XP, Vista, Windows 7, Server 2003, Windows 2008, and Server 
2008 R2 machines using Windows Update in conjunction with Windows Server Update 
Service. WSUS is the newer version of SUS and is used on a Windows Server 2008 R2 
system to update systems. As you might remember from earlier, WSUS and SUS are patch -
 management tools that help you deploy updates to your systems in a controlled manner. 
 Windows Update is available through the Microsoft website and is used to provide the 
most current ﬁ les for the Windows operating systems. Examples of updates include security 
ﬁ xes, critical updates, updated help ﬁ les, and updated drivers. You can access Windows 
Update by clicking the Windows Update icon in the system tray.  
 Learn more about WSUS at  http://technet.microsoft.com/en-us/wsus/
default.aspx . 
 WSUS is used to leverage the features of Windows Update within a corporate 
environment by downloading Windows updates to a corporate server, which in turn 
provides the updates to the internal corporate clients. This allows administrators to test 
and have full control over what updates are deployed within the corporate environment. 
 Within an enterprise network that is using Active Directory, you would typically see 
automatic updates conﬁ gured through Group Policy. Group policies are used to manage 
conﬁ guration and security settings via Active Directory. Group Policy is also used to 
specify what server a client will use for automatic updates. 
 If the WSUS client is a part of an enterprise network that is using Active Directory, you 
would conﬁ gure the client via a group policy.  
Implementing Software Deployment 
353

354 
Chapter 8  Configuring Group Policy Objects
 Configuring Software Deployment 
Settings 
 In addition to the basic operations of assigning and publishing applications, you can use several 
other options to specify the details of how software is deployed. In the following sections, you 
will examine the various options that are available and their effects on the software installation 
process. 
 The Software Installation Properties Dialog Box 
 The most important software deployment settings are contained in the Software Installation 
Properties dialog box, which you can access by right - clicking the Software Installation item 
and selecting Properties from the context menu. The following sections describe the features 
contained on the various tabs of the dialog box. 
 Managing Package Defaults 
 On the General tab of the Software Installation Properties dialog box, you ’ ll be able to 
specify some defaults for any packages that you create within this GPO. Figure 8.10 shows 
the General options for managing software installation settings.  
 F I G U R E 8 .10 General tab of the Software Installation Properties dialog box 
 The various options available include the following:  
  Default Package Location   This setting speciﬁ es the default ﬁ lesystem or network location 
for software installation packages. This is useful if you are already using a speciﬁ c share on 
a ﬁ le server for hosting the necessary installation ﬁ les.  

 New Packages  These settings specify the default type of package assignment that will 
be used when you add a new package to either the user or computer settings. If you ’ ll be 
assigning or publishing multiple packages, you may ﬁ nd it useful to set a default here. 
Selecting the Advanced option enables Group Policy to display the package ’ s Properties 
dialog box each time a new package is added.  
 Installation User Interface Options   When they are installing an application, systems 
administrators may or may not want end users to see all of the advanced installation options. 
If Basic is chosen, the user will only be able to conﬁ gure the minimal settings (such as the 
installation location). If Maximum is chosen, all of the available installation options will be 
displayed. The speciﬁ c installation options available will depend on the package itself.  
 The Advanced Tab 
 The Advanced tab (see Figure 8.11) includes several options for conﬁ guring advanced software 
installation properties. The only option you need to be concerned with is the following:  
 Uninstall the Applications When They Fall out of the Scope of Management.   So far, you 
have seen how applications can be assigned and published to users or computers. But what 
happens when effective GPOs change? For example, suppose that User A is currently located 
within the Sales OU. A GPO that assigns the Microsoft Ofﬁ ce 2010 suite of applications is 
linked to the Sales OU. You decide to move User A to the Engineering OU, which has no 
software deployment settings. Should the application be uninstalled, or should it remain? 
 If the  “ Uninstall the applications when they fall out of the scope of management ” option 
is checked, applications will be removed if they are not specifically assigned or published 
within GPOs. In our earlier example, this means that Office 2010 would be uninstalled for 
User A. If, however, this box is left unchecked, the application will remain installed.  
 F I G U R E 8 .11 The Advanced tab of the Software Installation Properties dialog box 
Configuring Software Deployment Settings 
355

356 
Chapter 8  Configuring Group Policy Objects
 Managing File Extension Mappings 
 One of the potential problems associated with using many different ﬁ le types is that it ’ s 
difﬁ cult to keep track of which applications work with which ﬁ les. For example, if you 
received a ﬁ le with the extension  .abc , you would have no idea which application you 
would need to view it. And Windows would not be of much help, either. 
 Fortunately, through software deployment settings, systems administrators can specify 
mappings for speciﬁ c  ﬁ le extensions . For example, you could specify that whenever users 
attempt to access a ﬁ le with the extension  .vsd , the operating system should attempt to 
open the ﬁ le using the Visio diagramming software. If Visio is not installed on the user ’ s 
machine, the computer can automatically download and install it (assuming that the 
application has been properly advertised). 
 This method allows users to have applications automatically installed when they are 
needed. The following is an example of the sequence of events that might occur: 
 1. 
 A user receives an email message that contains an Adobe Acrobat file attachment.  
 2. 
  The computer realizes that Adobe Acrobat, the appropriate viewing application for this 
type of file, is not installed. However, it also realizes that a file extension mapping is 
available within the Active Directory software deployment settings. 
 3. 
  The client computer automatically requests the Adobe Acrobat software package 
from the server and uses the Microsoft Windows Installer to automatically install the 
application. 
 4. 
  The computer opens the attachment for the user.  
 Notice that all of these steps were carried out without any further interaction with the user. 
 You can manage ﬁ le extension mappings by right - clicking the Software Installation item, 
selecting Properties, and then clicking the File Extensions tab.  
 Creating Application Categories 
 In many network environments, the list of supported applications can include hundreds of 
items. For users who are looking for only one speciﬁ c program, searching through a list of 
all of these programs can be difﬁ cult and time consuming. 
 Fortunately, methods for categorizing the applications are available on your network. 
You can easily manage the application categories for users and computers by right - clicking 
the Software Installation item, selecting Properties, and then clicking the Categories tab. 
 Figure 8.12 shows you how application categories can be created. It is a good idea to use 
category names that are meaningful to users because it will make it easier for them to ﬁ nd 
the programs they ’ re looking for. 
 Once the software installation categories have been created, you can view them by 
opening the Add Or Remove Programs item in Control Panel. When you click Add New 
Programs, you ’ ll see that several options appear in the Category drop - down list. Now when 
you select the properties for a package, you will be able to assign the application to one or 
more of the categories.  

 Removing Programs 
 As we discussed in the beginning of the chapter, an important phase in the software 
management life cycle is the removal of applications. Fortunately, using the GPMC and the 
Windows Installer packages, the process is simple. To remove an application, you can right - click 
the package within the Group Policy settings and select All Tasks   Remove (see Figure 8.13).  
 F I G U R E 8 .12 The Categories tab of the Software Installation Properties dialog box 
 F I G U R E 8 .13 Removing a software package 
Configuring Software Deployment Settings 
357

358 
Chapter 8  Configuring Group Policy Objects
 When choosing to remove a software package from a GPO, you have two options:  
  Immediately Uninstall The Software From Users And Computers   Systems administrators 
can choose this option to ensure that an application is no longer available to users who 
are affected by the GPO. When this option is selected, the program will be automatically 
uninstalled from users and/or computers that have the package. This option might be 
useful, for example, if the license for a certain application has expired or if a program is no 
longer on the approved applications list.  
  Allow Users To Continue To Use The Software, But Prevent New Installations   This 
option prevents users from making new installations of a package, but it does not remove 
the software if it has already been installed for users. This is a good option if the company 
has run out of additional licenses for the software, but the existing licenses are still valid.  
 Figure 8.14 shows these two removal options.  
 F I G U R E 8 .14 Software removal options 
 If you no longer require the ability to install or repair an application, you can delete it 
from your software distribution share point by deleting the appropriate Windows Installer 
package ﬁ les. This will free up additional disk space for newer applications.  
 Microsoft Windows Installer Settings 
 Several options inﬂ uence the behavior of the Windows Installer; you can set them within a 
GPO. You can access these options by navigating to User Conﬁ guration   Administrative 
Templates   Windows Components   Windows Installer. The options include the following: 
  Always Install With Elevated Privileges   This policy allows users to install applications 
that require elevated privileges. For example, if a user does not have the permissions 
necessary to modify the Registry but the installation program must make Registry changes, 
this policy will allow the process to succeed.  
  Search Order   This setting speciﬁ es the order in which the Windows Installer will search 
for installation ﬁ les. The options include  n (for network shares),  m (for searching removal 
media), and  u (for searching the Internet for installation ﬁ les).  
  Disable Rollback   When this option is enabled, the Windows Installer does not store the 
system state information that is required to roll back the installation of an application. 
Systems administrators may choose this option to reduce the amount of temporary disk 

space required during installation and to increase the performance of the installation 
operation. However, the drawback is that the system cannot roll back to its original state if 
the installation fails and the application needs to be removed.  
 Disable Media Source For Any Install   This option disallows the installation of software 
using removable media (such as CD - ROM, DVD - ROM, or ﬂ oppy disks). It is useful for 
ensuring that users install only approved applications.  
 With these options, systems administrators can control how the Windows Installer 
operates for speciﬁ c users who are affected by the GPO.  
 Troubleshooting Group Policies 
 Because of the wide variety of conﬁ gurations that are possible when you are establishing 
GPOs, you should be aware of some common troubleshooting methods. These methods 
will help isolate problems in policy settings or GPO links. 
 One possible problem with GPO conﬁ guration is that logons and system startups may take 
a long time. This occurs especially in large environments when the Group Policy settings must 
be transmitted over the network and, in many cases, slow WAN links. In general, the number 
of GPOs should be limited because of the processing overhead and network requirements 
during logon. By default, GPOs are processed in a synchronous manner. This means that 
the processing of one GPO must be completed before another one is applied (as opposed to 
asynchronous processing, where they can all execute at the same time). 
 The most common issue associated with Group Policy is the unexpected setting of Group 
Policy options. In Windows Server 2000, administrators spent countless hours analyzing 
inheritance hierarchy and individual settings to determine why a particular user or computer 
was having policy problems. For instance, say a user named  wpanek complains that the 
Run option is missing from his Start menu. The  wpanek user account is stored in the New 
Hampshire OU, and you ’ ve applied group policies at the OU, domain, and site levels. To 
determine the source of the problem, you would have to manually sift through each GPO to 
ﬁ nd the Start menu policy as well as ﬁ gure out the applicable inheritance settings. 
 Windows Server 2008 has a handy feature called  Resultant Set of Policy (RSoP) that 
displays the exact settings that actually apply to individual users, computers, OUs, domains, 
and sites after inheritance and ﬁ ltering have taken effect. In the example just described, you 
could run RSoP on the  wpanek account and view a single set of Group Policy settings that 
represent the settings that actually apply to the  wpanek account. In addition, each setting ’ s 
Properties dialog box displays the GPO that the setting is derived from, as well as the order 
of priority, the ﬁ lter status, and other useful information, as you will see a bit later. 
 RSoP actually runs in two modes:  
 Logging Mode   Logging mode displays the actual settings that apply to users and 
computers, like in the example in the preceding paragraph.  
 Planning Mode   Planning mode can be applied to users, computers, OUs, domains, and 
sites, and you use it before you actually apply any settings. As its name implies, planning 
mode is used to plan GPOs.  
Troubleshooting Group Policies 
359

360 
Chapter 8  Configuring Group Policy Objects
 Additionally, you can run the command - line utility  gpresult.exe to quickly get a 
snapshot of the Group Policy settings that apply to a user and/or computer. Let ’ s take a 
closer look at the two modes and the  gpresult.exe command. 
 RSoP in Logging Mode 
 RSoP in logging mode can only query policy settings for users and computers. The easiest 
way to access RSoP in logging mode is through the Active Directory Users and Computers 
tool, although you can run it as a stand - alone MMC snap - in if you want to. 
 To analyze the policy settings for  wpanek from the earlier example, you would right - click 
the user icon in Active Directory Users and Computers and select All Tasks   Resultant 
Set of Policy (Logging). The Group Policy Results Wizard appears. The wizard walks you 
through the steps necessary to view the RSoP for  wpanek . 
 The Computer Selection page, shown in Figure 8.15, requires you to select a computer 
for which to display settings. Remember that a GPO contains both user and computer 
settings, so you must choose a computer that the user has logged on to in order to continue 
with the wizard. If the user has never logged on to a computer, then you must run RSoP in 
planning mode, because there is no logged policy information for that user yet.  
 F I G U R E 8 .15 The Computer Selection page of the Group Policy Results Wizard 
 The User Selection page, shown in Figure 8.16, requires you to select a user account to 
analyze. Because we selected a user from the Active Directory Users and Computers tool, 
the username is ﬁ lled in automatically. This page is most useful if you are running RSoP in 
MMC mode and don ’ t have the luxury of selecting a user contextually.  

 The Summary Of Selections page, shown in Figure 8.17, displays a summary of your 
choices and provides an option for gathering extended error information. If you need to 
make any changes before you begin to analyze the policy settings, you should click the 
Back button on the Summary screen. Otherwise, click Next.  
 F I G U R E 8 .16 The User Selection page of the Group Policy Results Wizard 
 F I G U R E 8 .17 The Summary Of Selections page of the Group Policy Results Wizard 
 After the wizard is complete, you will see the window shown in Figure 8.18. This window 
displays only the policy settings that apply to the user and computer that you selected in the 
wizard. You can see these users and computers at the topmost level of the tree. 
Troubleshooting Group Policies 
361

362 
Chapter 8  Configuring Group Policy Objects
 F I G U R E 8 .18 The User Selection page for user  wpanek on computer SERVER1 
 Any warnings or errors appear as a yellow triangle or red X over the applicable icon 
at the level where the warning or error occurred. To view more information about the 
warning or error, right - click the icon, select Properties, and select the Error Information 
tab. An error message is shown in Figure 8.19.  
 F I G U R E 8 .19 Details of error pertaining to user  wpanek on computer SERVER1 

 You cannot make changes to any of the individual settings because RSoP is a diagnostic 
tool and not an editor, but you can get more information about settings by clicking a 
setting and selecting Properties from the context menu. 
 The Settings tab of the user ’ s Properties window, shown in Figure 8.20, displays the 
actual setting that applies to the user in question based on GPO inheritance.  
 F I G U R E 8 . 2 0 The Settings tab of the object ’ s Properties window 
 RSoP in Planning Mode 
 Running RSoP in planning mode isn ’ t much different from running RSoP in logging mode, 
but the RSoP Wizard asks for a bit more information than you saw earlier. 
 In the earlier example,  wpanek couldn ’ t see the Run option in the Start menu because 
his user account is affected by the New Hampshire GPO in the San Jose OU. As an 
administrator, you could plan to move his user account to the North America OU. Before 
doing so, you could verify his new policy settings by running RSoP in planning mode. Run 
the RSoP on the user  wpanek under the scenario that you ’ ve already moved him from the 
San Jose OU to the North America OU. At this point, you haven ’ t actually moved the user, 
but you can see what his settings would be if you did.  
Troubleshooting Group Policies 
363

364 
Chapter 8  Configuring Group Policy Objects
 Using the  gpresult.exe Command 
 The command - line utility  gpresult.exe is included as part of the RSoP tool. Running the 
command by itself without any switches returns the following Group Policy information 
about the local user and computer: 
 
  The name of the domain controller from which the local machine retrieved the policy 
information  
 
  The date and time in which the policies were applied  
 
  Which policies were applied  
 
  Which policies were filtered out  
 
  Group membership  
 You can use the switches shown in Table 8.2 to get information for remote users and 
computers and to enable other options.  
 TA B L E 8 . 2  gpresult  switches 
 Switch  
  Description  
  /S  systemname  
 Generates RSoP information for a remote computer name 
  /USER  username  
 Generates RSoP information for a remote username 
  /V  
 Specifies verbose mode, which displays more verbose informa-
tion such as user rights information 
  /Z  
 Specifies an even greater level of verbose information 
  /SCOPE MACHINE 
 Displays maximum information about the computer policies 
applied to this system 
  /SCOPE USER 
 Displays maximum information about the user policies applied 
to this system  
  > textfile.txt  
 Writes the output to a text file 
 For example, to obtain information about user  wpanek in a system called STELLACON, 
you would use the command  gpresult/S STELLACON/USERwpanek . 

 Through the use of these techniques, you should be able to track down even the most 
elusive Group Policy problems. Remember, however, that good troubleshooting skills do 
not replace planning adequately and maintaining GPO settings!  
 Summary 
 In this chapter, we examined Active Directory ’ s solution to a common headache for many 
systems administrators: policy settings. Speciﬁ cally, we discussed topics that covered Group 
Policy. 
 We covered the fundamentals of Group Policy including its fundamental purpose. You 
can use Group Policy to enforce granular permissions for users in an Active Directory 
environment. Group policies can restrict and modify the actions allowed for users and 
computers within the Active Directory environment. 
 Also group policies can restrict and modify the actions that are allowed for users 
and computers within the Active Directory environment. Certain Group Policy settings 
may apply to users, computers, or both. Computer settings affect all users who access 
the machines to which the policy applies. User settings affect users, regardless of which 
machines they log on to. 
 You learned that you can link Group Policy objects to Active Directory sites, domains, 
or OUs. This link determines to which objects the policies apply. GPO links can interact 
through inheritance and ﬁ ltering to result in an effective set of policies. 
 We covered inheritance and how GPOs ﬁ lter down. We showed you how to use the 
Enforced option on a GPO issued from a parent and how to block a GPO from a child. 
 You also learned that you can use administrative templates to simplify the creation of 
GPOs. We covered the basic default templates that come with Windows Server 2008 R2. 
 In addition, administrators can delegate control over GPOs in order to distribute 
administrative responsibilities. Delegation is an important concept because it allows for 
distributed administration. 
 You can also deploy software using GPOs. This feature can save time and increase 
productivity throughout the entire software management life cycle by automating software 
installation and removal on client computers. The Windows Installer offers a more robust 
method for managing installation and removal, and applications that support it can take 
advantage of new Active Directory features. Make sure that you are comfortable using the 
Windows Installer. 
 You learned about publishing applications via Active Directory and the difference 
between publishing and assigning applications. We explained that you can assign some 
applications to users and computers so that they are always available. You can also publish 
them to users so that they may be installed by the user with a minimal effort when a user 
requires them. 
Summary 
365

366 
Chapter 8  Configuring Group Policy Objects
 You also learned how to prepare for software deployment. Before your users can take 
advantage of automated software installation, you must set up an installation share and 
provide the appropriate permissions. 
 The ﬁ nal portion of the chapter covered the Resultant Set of Policy (RSoP) tool, which 
you can use in logging mode or planning mode to determine exactly which set of policies 
apply to users, computers, OUs, domains, and sites.  
 Exam Essentials  
  Understand the purpose of Group Policy.   Systems administrators use Group Policy to 
enforce granular permissions for users in an Active Directory environment.  
  Understand user and computer settings.   Certain Group Policy settings may apply to 
users, computers, or both. Computer settings affect all users that access the machines to 
which the policy applies. User settings affect users, regardless of which machines they log 
on to.  
  Know the interactions between Group Policy objects and Active Directory.   GPOs can be 
linked to Active Directory objects. This link determines to which objects the policies apply.  
  Understand filtering and inheritance interactions between GPOs.   For ease of 
administration, GPOs can interact via inheritance and ﬁ ltering. It is important to 
understand these interactions when you are implementing and troubleshooting Group 
Policy.  
  Know how Group Policy settings can affect script policies and network settings.   You can 
use special sets of GPOs to manage network conﬁ guration settings.  
  Understand how delegation of administration can be used in an Active Directory 
environment.   Delegation is an important concept because it allows for distributed 
administration.  
  Know how to use the Resultant Set of Policy (RSoP) tool to troubleshoot and plan Group 
Policy.   Windows Server 2008 includes the RSoP feature, which you can run in logging 
mode or planning mode to determine exactly which set of policies applies to users, 
computers, OUs, domains, and sites.  
  Identify common problems with the software life cycle.   IT professionals face many 
challenges with client applications, including development, deployment, maintenance, and 
troubleshooting.  
  Understand the benefits of the Windows Installer.   Using the Windows Installer is an 
updated way to install applications on Windows - based machines. It offers a more robust 
method for making the system changes required by applications, and it allows for a cleaner 
uninstall. Windows Installer – based applications can also take advantage of new Active 
Directory features. 

 Understand the difference between publishing and assigning applications.   Some 
applications can be assigned to users and computers so that they are always available. 
Applications can be published to users so that the user may install the application with a 
minimal amount of effort when it is required.  
 Know how to prepare for software deployment.   Before your users can take advantage 
of automated software installation, you must set up an installation share and provide the 
appropriate permissions.  
 Know how to configure application settings using Active Directory and Group 
Policy.   Using standard Windows Server 2008 R2 administrative tools, you can create an 
application policy that meets the needs of your requirements. Features include automatic, 
on - demand installation of applications as well as many other features.  
 Create application categories to simplify the list of published applications.   It ’ s important 
to group applications by functionality or the users to whom they apply, especially in 
organizations that support a large number of programs.  
Exam Essentials 
367

368 
Chapter 8  Configuring Group Policy Objects
 Review Questions  
 1. 
  You are the network administrator for a large organization that uses Windows Server 
2008 R2 domain controllers and DNS servers. All of your client machines currently have 
Windows XP operating systems. You want to be able to have client computers edit the 
domain - based GPOs by using the ADMX files that are located in the ADMX Central Store. 
How do you accomplish this task? (Choose all that apply.)  
 A.   Upgrade your clients to Windows Vista.  
 B.   Upgrade your clients to Windows 7.  
 C.   Add the client machines to the ADMX edit utility.  
 D.   In the ADMX store, choose the box Allow All Client Privileges.  
 2. 
  You work for an organization with a single Windows Server 2008 R2 Active Directory 
domain. The domain has OUs for Sales, Marketing, Admin, R & D, and Finance. You need 
only the users in the Finance OU to get Windows Office 2010 installed automatically onto 
their computers. You create a GPO named OfficeApp. What is the next step in getting all 
the Finance users Office 2010?  
 A.   Edit the GPO and assign the Office application to the users account. Link the GPO to 
the Finance OU.  
 B.   Edit the GPO and assign the Office application to the users account. Link the GPO to 
the domain.  
 C.   Edit the GPO and assign the Office application to the computer account. Link the 
GPO to the domain.  
 D.   Edit the GPO and assign the Office application to the computer account. Link the 
GPO to the Finance OU.  
 3. 
 You are hired as a consultant to the ABC Company. The owner of the company complains 
that he continues to have Desktop wallpaper that he did not choose. When you speak with 
the IT team, you find out that a former employee created 20 GPOs and they have not been 
able to figure out which GPO is changing the owner ’ s Desktop wallpaper. How can you 
resolve this issue?  
 A.   Run the RSoP utility against all forest computer accounts.  
 B.   Run the RSoP utility against the owner ’ s computer account.  
 C.   Run the RSoP utility against the owner ’ s user account.  
 D.   Run the RSoP utility against all domain computer accounts.  

Review Questions 
369
 4. 
  You are the network administrator for a large organization that has multiple sites and 
multiple OUs. You have a site named SalesSite that is for the sales building across the 
street. In the domain there is an OU for all salespeople called Sales. You set up a GPO for 
the SalesSite, and you need to be sure that it applies to the Sales OU. The Sales OU GPOs 
cannot override the SalesSite GPO. What do you do?  
 A.   On the GPO, disable the Block Child Inheritance setting.  
 B.   On the GPO, set the Enforce setting.  
 C.   On the GPO, set the priorities to 1.  
 D.   On the Sales OU, set the Inherit Parent Policy settings.  
 5. 
  You are the administrator for an organization that has multiple locations. You are running 
Windows Server 2008 R2, and you have only one domain with multiple OUs set up for 
each location. 
 One of your locations, Boston, is connected to the main location by a 256Kbps ISDN line. 
You conﬁ gure a GPO to assign a sales application to all computers in the entire domain. 
You have to be sure that Boston users receive the GPO properly. What should you do?  
 A.   Disable the Slow Link Detection setting in the GPO.  
 B.   Link the GPO to the Boston OU.  
 C.   Change the properties of the GPO to publish the application to the Boston OU.  
 D.   Have the users in Boston run the  GPResult / force  command.  
 6. 
 To disable GPO settings for a specific security group, which of the following permissions 
should you apply?  
 A.   Deny Write  
 B.   Allow Write  
 C.   Enable Apply Group Policy  
 D.   Disable Apply Group Policy  
 7. 
  GPOs assigned at which of the following level(s) will override GPO settings at the domain 
level?  
 A.   OU  
 B.   Site  
 C.   Domain  
 D.   Both OU and site  

370 
Chapter 8  Configuring Group Policy Objects
  8. 
  A systems administrator wants to ensure that only the GPOs set at the OU level affect the 
Group Policy settings for objects within the OU. Which option can they use to do this 
(assuming that all other GPO settings are the defaults)?  
 A.   The Enforced option  
 B.   The Block Policy Inheritance option  
 C.   The Disable option  
 D.   The Deny permission  
 9. 
  A systems administrator is planning to implement Group Policy objects in a new Windows 
Server 2008 Active Directory environment. In order to meet the needs of the organization, 
he decides to implement a hierarchical system of Group Policy settings. At which of the 
following levels is he able to assign Group Policy settings? (Choose all that apply.)  
 A.   Sites  
 B.   Domains  
 C.   Organizational units  
 D.   Local system  
  10.   Ann is a systems administrator for a medium - sized Active Directory environment. She has 
determined that several new applications that will be deployed throughout the organization 
use Registry - based settings. She would like to do the following:  
 
 Control these Registry settings using Group Policy.  
 
 Create a standard set of options for these applications and allow other systems admin-
istrators to modify them using the standard Active Directory tools.  
 Which of the following options can she use to meet these requirements? (Choose all 
that apply.) 
 A.   Implement the inheritance functionality of GPOs.  
 B.   Implement delegation of specific objects within Active Directory.  
 C.   Implement the No Override functionality of GPOs.  
 D.   Create administrative templates.  
 E. 
  Provide administrative templates to the systems administrators who are responsible for 
creating Group Policy for the applications.  

 Answers to Review Questions 
1. 
 A, B .  If you want your clients to be able to edit domain - based GPOs by using the ADMX 
ﬁ les that are stored in the ADMX Central Store, you must be using Windows Vista or 
Windows 7. 
2. 
 D .  If you assign an application to a user, the application does not get automatically installed. 
To have an application automatically installed, you must assign the application to the 
computer account. Since Finance is the only OU that should receive this application, you 
would link the GPO to Finance only. 
3. 
 C .  The Resultant Set of Policy (RSoP) displays the exact settings that actually apply to 
individual users, computers, OUs, domains, and sites after inheritance and ﬁ ltering have 
taken effect. Desktop wallpaper settings are under the User section of the GPO, so you 
would run the RSoP against the user account. 
4. 
 B .  The Enforced option can be placed on a parent GPO, and this option ensures that 
all lower - level objects inherit these settings. Using this option ensures that Group Policy 
inheritance is not blocked at other levels. 
5. 
 A .  If the data transfer rate from the domain controller providing the GPO 
to the computer is slower than what you have speciﬁ ed in the slow link detection setting, 
the connection is considered to be a slow connection and the application will not install 
properly. 
6. 
 D .  To disable the application of Group Policy on a security group, you should disable the 
Apply Group Policy option. This is particularly useful when you don ’ t want GPO settings 
to apply to a speciﬁ c group, even though that group may be in an OU that includes the 
GPO settings. 
7. 
 A .  GPOs at the OU level take precedence over GPOs at the domain level. GPOs at the 
domain level, in turn, take precedence over GPOs at the site level. 
8. 
 B .  The Block Policy Inheritance option prevents group policies of higher - level Active 
Directory objects from applying to lower - level objects as long as the Enforced option is 
not set. 
9. 
 A, B, C, D .  GPOs can be set at all of the levels listed. You cannot set GPOs on security 
principals such as users or groups. 
10.  D, E .  Administrative templates are used to specify the options available for setting Group 
Policy. By creating new administrative templates, Ann can specify which options are 
available for the new applications. She can then distribute these templates to other systems 
administrators in the environment. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswindows2008r2 . 
Answers to Review Questions 
371


Planning Security for 
Active Directory  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Creating and Maintaining Active Directory Objects  
■   Configure account policies. May include but is not limited to: 
domain password policy; account lockout policy; fine - grain 
password policies.  
■   Configure audit policy by using GPOs. May include but 
is not limited to: audit logon events; audit account logon 
events; audit policy change; audit access privilege use; audit 
directory service access; audit object access; advanced 
audit policies; global object access auditing;  “ Reason for 
Access ” reporting.  

 Chapter 
9

 So far in this book we have covered many important aspects of 
Active Directory. The most important aspect of any network, 
including Active Directory, is security. If your network is not 
secure, then hackers (internal or external) can make your life as an IT member a living 
nightmare. 
 All network operating systems (NOSs) offer some way to grant or deny access to 
resources, such as ﬁ les and printers. Active Directory is no exception. You can deﬁ ne 
fundamental security objects through the use of the users, groups, and computers security 
principals. Then you can allow or disallow access to resources by granting speciﬁ c 
permissions to each of these objects. 
 In this chapter, you ’ ll learn how to implement security within Active Directory. By using 
Active Directory tools, you can quickly and easily conﬁ gure the settings that you require in 
order to protect information. 
 Proper planning for security permissions is an important prerequisite of setting up 
Active Directory. Security is always one of the greatest concerns as an IT administrator. 
 If your security settings are too restrictive, users may not be able to perform their 
job functions. Worse yet, they may try to circumvent security measures. They may even 
complain to their management teams, and eventually you will receive these complaints. 
On the other end of the spectrum, if security permissions are too lax, users may be able to 
access and modify sensitive company resources. 
 You may continuously try to seek balance — to have enough security and, at the same 
time, be somewhat transparent to the end users, who simply want to do their jobs and not 
be bothered by what ’ s between the lines. 
 You should have a security policy that states what is expected of every computer user 
in your company. Fine - tuning Active Directory to comply with your security policy and 
allowing end users to function without an issue should be your goals. 
 You should know how to use Active Directory to apply permissions to resources on the 
network. An administrator should pay particular attention to the evaluation of permissions 
when applied to different groups and the ﬂ ow of permissions through the organizational 
units (OUs) via group policies. With all of this in mind, let ’ s start looking at how you can 
manage security within Active Directory.  
 In order to complete the exercises in this chapter, you should understand 
the basics of working with Active Directory objects. If you are not 
familiar with creating and managing users, groups, computers, and OUs, 
you should review the information in Chapter 7,  “ Administering Active 
Directory, ” before you continue.  

 Active Directory Security Overview 
 One of the fundamental design goals for Active Directory is to deﬁ ne a single, centralized 
repository of users and information resources. Active Directory records information about 
all of the users, computers, and resources on your network. Each domain acts as a logical 
boundary, and members of the domain (including workstations, servers, and domain 
controllers) share information about the objects within them. 
 The information stored within Active Directory determines which resources are 
accessible to which users. Through the use of  permissions  that are assigned to Active 
Directory objects, you can control all aspects of network security. 
 Throughout this chapter, you ’ ll learn the details of security as it pertains to Active 
Directory. Note, however, that Active Directory security is only one aspect of overall 
network security. You should also be sure that you have implemented appropriate access 
control settings for the ﬁ lesystem, network devices, and other resources. Let ’ s start by 
looking at the various components of network security, which include working with 
security principals and managing security and permissions, access control lists (ACLs), 
and access control entries (ACEs).  
 A fact that you should always keep in mind while you are setting up a 
network is that 90 percent of all hacks on a network are internal. This 
means that internal permissions and security (as well as external) need 
to be as strong as possible while still allowing users to do their jobs. 
 Understanding Security Principals 
 Security principals are Active Directory objects that are assigned  security identiﬁ ers (SIDs) . 
An SID is a unique identiﬁ er that is used to manage any object to which permissions can be 
assigned. Security principals are assigned permissions to perform certain actions and access 
certain network resources. 
 The basic types of Active Directory objects that serve as security principals include the 
following:
 User Accounts   User accounts identify individual users on your network by including 
information such as the user ’ s name and their password. User accounts are the fundamental 
unit of security administration.  
 Groups   There are two main types of groups:  security groups and  distribution groups . 
Both types can contain user accounts. Systems administrators use security groups to ease 
the management of security permissions. They use distribution groups, on the other hand, 
solely to send email. Distribution groups are not security principals. You ’ ll see the details of 
groups in the next section.  
Active Directory Security Overview 
375

376 
Chapter 9 ■ Planning Security for Active Directory
  Computer Accounts   Computer accounts identify which client computers are members 
of particular domains. Because these computers participate in the Active Directory 
database, systems administrators can manage security settings that affect the computer. 
They use computer accounts to determine whether a computer can join a domain and for 
authentication purposes. As you ’ ll see later in this chapter, systems administrators can also 
place restrictions on certain computer settings to increase security. These settings apply 
to the computer and, therefore, also apply to any user who is using it (regardless of the 
permissions granted to the user account).  
 Note that other objects — such as OUs — do not function as security principals. What 
this means is that you can apply certain settings (such as Group Policy) on all of the objects 
within an OU; however, you cannot speciﬁ cally set permissions with respect to the OU 
itself. The purpose of OUs is to logically organize other Active Directory objects based 
on business needs, add a needed level of control for security, and create an easier way 
to delegate. 
 You can manage security by performing the following actions with security principals: 
 You can assign them permissions to access various network resources.  
 You can give them user rights. 
 You can track their actions through auditing (covered later in this chapter).  
 The major types of security principals — user accounts, groups, and computer accounts —
 form the basis of the Active Directory security architecture. As a systems administrator, you 
will likely spend a portion of your time managing permissions for these objects. 
 It is important to understand that, since a unique SID defines each security 
principal, deleting a security principal is an irreversible process. For 
example, if you delete a user account and then later re - create one with the 
same name, you ’ ll need to reassign permissions and group membership 
settings for the new account. Once a user account is deleted, its SID 
is deleted.  
 Users and groups are two types of fundamental security principals employed for 
security administration. In the following sections, you ’ ll learn how users and groups 
interact and about the different types of groups that you can create. 
 Types of Groups 
 When dealing with groups, you should make the distinction between local security 
principals and domain security principals: 
 You use  local users and groups  to assign the permissions necessary to access the local 
machine. For example, you may assign the permissions you need to reboot a domain 
controller to a speciﬁ c domain local group.  
 Domain users and groups , on the other hand, are used throughout the domain. These 
objects are available on any of the computers within the Active Directory domain and 
between domains that have a trust relationship.  
■
■
■
■
■

 Here are the two main types of groups used in Active Directory:
 Security Groups   Security groups are considered security principals. They can contain user 
accounts or groups. To make administration simpler, systems administrators usually grant 
permissions to groups. This allows you to change permissions easily at the Active Directory 
level (instead of at the level of the resource on which the permissions are assigned). 
 You can also place Active Directory Contact objects within security groups, but security 
permissions will not apply to them.  
 Distribution Groups   Distribution groups are not considered security principals, because 
they do not have SIDs. As mentioned earlier, they are used only for the purpose of sending 
email messages. You can add users to distribution groups just as you would add them to 
security groups. You can also place distribution groups within OUs so they are easier 
to manage. You will ﬁ nd them useful, for example, if you need to send email messages to 
an entire department or business unit within Active Directory.  
 Understanding the differences between security and distribution groups is important in 
an Active Directory environment. For the most part, systems administrators use security 
groups for daily administration of permissions. On the other hand, systems administrators 
who are responsible for maintaining email distribution lists generally use distribution 
groups to logically group members of departments and business units. (A systems 
administrator can also email all of the users within a security group, but to do so, they 
would have to specify the email addresses for the accounts.) 
 When you are working in Windows 2000 Native, Server 2003, or Server 2008 
functional - level domains, you can convert security groups to or from distribution groups. 
When group types are running in a Windows 2000 Mixed domain functional level, you 
cannot change them.  
 It is vital that you understand group types when you are getting ready to 
take the Microsoft exams. Microsoft likes to include trick questions about 
putting permissions on distribution groups. Remember, only security 
groups can have permissions assigned to them. 
 Group Scope 
 In addition to being classiﬁ ed by type, each group is also given a speciﬁ c scope. The scope 
of a group deﬁ nes two characteristics. First, it determines the level of security that applies 
to a group. Second, it determines which users can be added to the group. Group scope is an 
important concept in network environments because it ultimately deﬁ nes which resources 
users are able to access. 
 The three types of group scope are as follows:
 Domain Local   The scope of  domain local groups extends as far as the local domain. 
When you ’ re using the Active Directory Users and Computers tool, domain local accounts 
Active Directory Security Overview 
377

378 
Chapter 9 ■ Planning Security for Active Directory
apply to the computer for which you are viewing information. Domain local groups are 
used to assign permissions to local resources, such as ﬁ les and printers. They can contain 
global groups, universal groups, and user accounts.  
  Global   The scope of  global groups  is limited to a single domain. Global groups may 
contain any of the users that are a part of the Active Directory domain in which the 
global groups reside. Global groups are often used for managing domain security 
permissions based on job functions. For example, if you need to specify permissions 
for the Engineering department, you could create one or more global groups (such as 
EngineeringManagers and EngineeringDevelopers). You could then assign security 
permissions to each group.  
  Universal   Universal groups can contain users from any domains within an Active 
Directory forest. Therefore, systems administrators use them to manage security across 
domains. Universal groups are available only when you ’ re running Active Directory in the 
Windows 2000 Native, Windows Server 2003, Windows Server 2008, or Windows Server 
2008 R2 domain functional level. When you are managing multiple domains, it often helps 
to group global groups within universal groups. For instance, if you have an Engineering 
global group in the  research.stellacon.com domain and an Engineering global group 
in the  asia.stellacon.com domain, you can create a universal AllEngineers group that 
contains both of the global groups. Now whenever you must assign security permissions to 
all engineers within the organization, you need only assign permissions to the AllEngineers 
universal group. 
 For domain controllers to process authentication between domains, information about 
the membership of universal groups is stored in the Global Catalog (GC). Keep this in 
mind if you ever plan to place users directly into universal groups and bypass global 
groups because all of the users will be enumerated in the GC, which will impact size and 
performance. 
 Fortunately, universal group credentials are cached on domain controllers that universal 
group members use to log on. This process is called universal group membership caching 
(discussed in Chapter 4,  “ Installing and Managing Trees and Forests ” ). The cached data 
is obtained by the domain controller whenever universal group members log on, and 
then it is retained on the domain controller for eight hours by default. This is especially 
useful for smaller locations, such as branch ofﬁ ces, that run less - expensive domain 
controllers. Most domain controllers at these locations cannot store a copy of the 
entire GC, and frequent calls to the nearest GC would require an inordinate amount 
of network trafﬁ c.  
 When you create a new group using the Active Directory Users and Computers tool, you 
must specify the scope of the group. Figure 9.1 shows the New Object  - Group dialog box 
and the available options for the group scope.  

 As you can see, the main properties for each of these group types are affected by 
whether Active Directory is running in Windows 2000 Mixed, Windows 2000 Native, 
Server 2003, Server 2008, or Server 2008 R2 domain functional level (Figure 9.1 shows 
that you are in Native mode because all three options are available). Each of these scope 
levels is designed for a speciﬁ c purpose and will ultimately affect the types of security 
permissions that you can assign to them. 
 The following are limitations on group functionality when you are running in Windows 
2000 Mixed domain functional level: 
 Universal security groups are not available.  
 You are not allowed to change the scope of groups.  
 Limitations to group nesting exist. Speciﬁ cally, the only nesting allowed is global 
groups contained in domain local groups.  
 When you are running in Native mode domains, you can make the following group 
scope changes: 
 You can change domain local groups to a universal group. You can make this change 
only if the domain local group does not contain any other domain local groups.  
 You can change a global group to a universal group. You can make this change only 
if the global group is not a member of any other global groups.  
■
■
■
■
■
 F I G U R E 9.1 The New Object — Group dialog box 
Active Directory Security Overview 
379

380 
Chapter 9 ■ Planning Security for Active Directory
 Universal groups themselves cannot be converted into any other group scope type. 
However, changing group scope can be helpful when your security administration or 
business needs change. You can change group scope easily using the Active Directory Users 
and Computers tool. To do so, access the properties of the group. As shown in Figure 9.2, 
you can make a group scope change by clicking one of the options.  
 F I G U R E 9. 2 A group ’ s Properties dialog box 
 Built - in Domain Local Groups 
 Systems administrators use built - in domain local groups to perform administrative 
functions on the local server. Because these have preassigned permissions and privileges, 
they allow systems administrators to easily assign common management functions. 
Figure 9.3 shows the default built - in groups that are available on a Windows Server 2008 
domain controller.  

 The list of built - in local groups includes some of the following:
 Account Operators   These users can create and modify domain user and group accounts. 
Members of this group are generally responsible for the daily administration of Active 
Directory.  
 Administrators   Members of the Administrators group, by default, are given full 
permissions to perform any functions within the Active Directory domain and on the 
local computer. This means they can access all ﬁ les and resources that reside on any server 
within the domain. As you can see, this is a very powerful account. 
 In general, you should restrict the number of users who are included in this group because 
most common administration functions do not require this level of access.  
 Backup Operators   One of the problems associated with backing up data in a secure 
network environment is that you need to provide a way to bypass standard ﬁ lesystem 
security so you can copy ﬁ les. Although you could place users in the Administrators 
 F I G U R E 9. 3 Default built - in local groups 
Active Directory Security Overview 
381

382 
Chapter 9 ■ Planning Security for Active Directory
group, doing so usually provides more permissions than necessary. Members of the 
Backup Operators group can bypass standard ﬁ lesystem security for the purpose 
of backup and recovery only. They cannot, however, directly access or open ﬁ les within 
the ﬁ lesystem. 
 Generally, backup software applications and data use the permissions assigned to the 
Backup Operators group.  
  Certificate Service DCOM Access   Members of the Certiﬁ cate Service DCOM Access 
group can connect to certiﬁ cate authority servers in the enterprise.  
  Cryptographic Operators   Members of the Cryptographic Operators group are authorized 
to perform cryptographic operations. Cryptography allows the use of codes to convert 
data, which then allows a speciﬁ c recipient to read it using a key.  
  Guests   Typically, you use the Guests group to provide access to resources that generally 
do not require security. For example, if you have a network share that provides ﬁ les 
that should be made available to all network users, you can assign permissions to allow 
members of the Guests group to access those ﬁ les.  
  Print Operators   By default, members of the Print Operators group are given permissions 
to administer all of the printers within a domain. This includes common functions such as 
changing the priority of print jobs and deleting items from the print queue.  
  Replicator   The Replicator group allows ﬁ les to be replicated among the computers in a 
domain. You can add accounts used for replication - related tasks to this group to provide 
those accounts with the permissions they need to keep ﬁ les synchronized across multiple 
computers.  
  Server Operators   A common administrative task is managing server conﬁ guration. 
Members of the Server Operators group are granted the permissions they need to manage 
services, shares, and other system settings.  
  Users   The Users built - in domain local group is used to administer security for most 
network accounts. Usually, you don ’ t give this group many permissions and use it to apply 
security settings for most employees within an organization.  
 Windows Server 2008 R2 also includes many different default groups you can ﬁ nd in 
the  Users folder. As shown in Figure 9.4, these groups are of varying scopes, including 
domain local, global, and universal groups. You ’ ll see the details of these groups in the 
next section.  

 Three important user accounts are created during the promotion of a domain controller: 
 The Administrator account is assigned the password a systems administrator provides 
during the promotion process, and it has full permissions to perform all actions within 
the domain.  
 The Guest account is disabled by default. The purpose of the Guest account is to 
provide anonymous access to users who do not have an individual logon and password 
to use within the domain. Although the Guest account might be useful in some 
situations, it is generally recommended that this account be disabled to increase security. 
 Only the operating system uses the krbtgt or Key Distribution Center Service account 
for Kerberos authentication while it is using  DCPromo.exe . This account is disabled by 
default. Unlike other user accounts, the krbtgt account cannot be used to log on to the 
domain, and therefore it does not need to be enabled. Since only the operating system 
uses this account, you do not need to worry about hackers gaining access by using 
this account.  
■
■
■
 F I G U R E 9. 4 Contents of the default  Users folder 
Active Directory Security Overview 
383

384 
Chapter 9 ■ Planning Security for Active Directory
 Predefined Global Groups 
 As we mentioned earlier in this chapter, you use global groups to manage permissions at 
the domain level. Members of each of these groups can perform speciﬁ c tasks related to 
managing Active Directory. 
 The following predeﬁ ned global groups are installed in the  Users folder:
  Cert Publishers   Certiﬁ cates are used to increase security by allowing for strong 
authentication methods. User accounts are placed within the Cert Publishers group if they 
must publish security certiﬁ cates. Generally, Active Directory security services use these 
accounts.  
 Domain Computers   All of the computers that are members of the domain are generally 
members of the Domain Computers group. This includes any workstations or servers that 
have joined the domain, but it does not include the domain controllers.  
  Domain Admins   Members of the Domain Admins group have full permissions to manage 
all of the Active Directory objects for this domain. This is a powerful account; therefore, 
you should restrict its membership to only those users who require full permissions.  
 Domain Controllers   All of the domain controllers for a given domain are generally 
included within this group.  
  Domain Guests   Generally, by default, members of the Domain Guests group are given 
minimal permissions with respect to resources. Systems administrators may place user 
accounts in this group if they require only basic access or temporary permissions within the 
domain.  
  Domain Users   The Domain Users group usually contains all of the user accounts for 
the given domain. This group is generally given basic permissions to resources that do not 
require higher levels of security. A common example is a public ﬁ le share.  
  Enterprise Admins   Members of the Enterprise Admins group are given full permissions 
to perform actions within the entire forest. This includes functions such as managing trust 
relationships and adding new domains to trees and forests.  
  Group Policy Creator Owners   Members of the Group Policy Creator Owners group are 
able to create and modify Group Policy settings for objects within the domain. This allows 
them to enable security settings on OUs (and the objects that they contain).  
  Schema Admins   Members of the Schema Admins group are given permissions to modify 
the Active Directory schema. As a member of Schema Admins, you can create additional 
ﬁ elds of information for user accounts. This is a very powerful function because any 
changes to the schema will be propagated to all of the domains and domain controllers 
within an Active Directory forest. Furthermore, you cannot undo changes to the schema 
(although you can disable some).  
 In addition to these groups, you can create new ones for speciﬁ c services and 
applications that are installed on the server (you ’ ll notice the list in Figure 9.4 includes more 
than just the ones in the preceding list). Speciﬁ cally, services that run on domain controllers 

and servers will be created as security groups with domain local scope. For example, if 
a domain controller is running the DNS service, the DnsAdmins and DnsUpdateProxy 
groups become available. In addition, there are two read - only domain controller (RODC) 
local groups: the Allowed RODC Password Replication and the Denied RODC Password 
Replication groups. Similarly, if you install the DHCP service, it automatically creates the 
DHCP Users and DHCP Administrators groups. The purpose of these groups depends on 
the functionality of the applications being installed.  
 Foreign Security Principals 
 In environments that have more than one domain, you may need to grant permissions to 
users who reside in multiple domains. Generally, you manage this using Active Directory 
trees and forests. However, in some cases, you may want to provide resources to users who 
belong to domains that are not part of the forest. 
 Active Directory uses the concept of  foreign security principals to allow permissions 
to be assigned to users who are not part of an Active Directory forest. This process is 
automatic and does not require the intervention of systems administrators. You can then 
add the foreign security principals to domain local groups, for which, in turn, you can 
grant permissions for resources within the domain. You can view a list of foreign security 
principals by using the Active Directory Users and Computers tool. Figure 9.5 shows the 
contents of the  ForeignSecurityPrincipals folder.  
 F I G U R E 9. 5 The  ForeignSecurityPrincipals folder 
Active Directory Security Overview 
385

386 
Chapter 9 ■ Planning Security for Active Directory
 Managing Security and Permissions 
 Now that you understand the basic issues, terms, and Active Directory objects that pertain 
to security, it ’ s time to look at how you can apply this information to secure your network 
resources. The general practice for managing security is to assign users to groups and 
then grant permissions and logon parameters to the groups so that they can access 
certain resources. 
 For management ease and to implement a hierarchical structure, you can place groups 
within OUs. You can also assign Group Policy settings to all of the objects contained within 
an OU. By using this method, you can combine the beneﬁ ts of a hierarchical structure 
(through OUs) with the use of security principals. Figure 9.6 provides a diagram of 
this process. 
assigned
to
Users
Groups
Organizational Units (OUs)
OU
OU
OU
organized
in
Group
Policy
 F I G U R E 9.6 An overview of security management 
 The primary tool you use to manage security permissions for users, groups, and 
computers is the Active Directory Users and Computers tool. Using this tool, you can create 
and manage Active Directory objects and organize them based on your business needs. 
Common tasks for many systems administrators might include the following: 
 Resetting a user ’ s password (for example, in cases where they forget their password)  
 Creating new user accounts (when, for instance, a new employee joins the company)  
 Modifying group memberships based on changes in job requirements and functions  
 Disabling user accounts (when, for example, users will be out of the ofﬁ ce for long 
periods of time and will not require network resource access)  
 Once you ’ ve properly grouped your users, you need to set the actual permissions 
that affect the objects within Active Directory. The actual permissions available vary 
based on the type of object. Table 9.1 provides an example of some of the permissions 
that you can apply to various Active Directory objects and an explanation of what each 
permission does.  
■
■
■
■

 Using ACLs and ACEs 
 Each object in Active Directory has an access control list (ACL). The ACL is a list of 
user accounts and groups that are allowed to access the resource. For each ACL, there is 
an access control entry (ACE) that deﬁ nes what a user or a group can actually do with 
the resource. Deny permissions are always listed ﬁ rst. This means that if users have 
Deny permissions through user or group membership, they will not be allowed to access 
the object, even if they have explicit Allow permissions through other user or group 
permissions. Figure 9.7 shows an ACL for the Sales OU.  
 TA B L E 9.1 Permissions of Active Directory objects 
 Permission  
  Explanation  
 Control Access  
  Changes security permissions on the object  
 Create Child  
  Creates objects within an OU (such as other OUs)  
 Delete Child  
  Deletes child objects within an OU 
 Delete Tree  
  Deletes an OU and the objects within it  
 List Contents  
  Views objects within an OU 
 List Object  
  Views a list of the objects within an OU  
 Read  
  Views properties of an object (such as a username) 
 Write  
  Modifies properties of an object  
 F I G U R E 9.7 The ACL for an OU named Sales 
Active Directory Security Overview 
387

388 
Chapter 9 ■ Planning Security for Active Directory
 The Security tab is enabled only if you selected the Advanced Features option 
from the View menu in the Active Directory Users and Computers tool.  
 Using Groups Effectively 
 You are a new systems administrator for a medium - sized organization, and your network 
spans a single campus - type environment. The previous administrator had migrated the 
network from Windows 2000 to Windows Server 2008, and everyone seems ﬁ ne with 
the network and new workstations. As you familiarize yourself with the network, 
you realize that the previous administrator had a very ad hoc approach. Many of the 
permissions to resources had been given to individual accounts on request. It seems 
there was no particular strategy with regard to administration. 
 In a meeting, management tells you that the company has acquired another company, 
hopefully the ﬁ rst of several acquisitions. Management tells you about these plans 
because they do not want any hiccups in the information system as necessary 
changes ensue. 
 You immediately realize that management practices of the past must be replaced with 
the best practices that have been developed for networks over the years. One of the 
fundamental practices you need to establish for this environment is the use of groups to 
apply permissions and give privileges to users throughout the network. 
 It is quite simple to give permissions individually, and in some cases, it seems like overkill 
to create a group, give permissions to the group, and then add a user to the group. But 
using group - based permissions really pays off in the long run, regardless of how small 
your network is today. One constant in the networking world is that networks grow. And 
when they grow, it is much easier to add users to a well - thought - out system of groups 
and consistently applied policies and permissions than it is to patch these elements 
together for each individual user. 
 Don ’ t get caught up in the  “ easy ” way of dealing with each request as it comes down 
the pike. Take the time to ﬁ gure out how the system will beneﬁ t from a more structured 
approach. Visualize your network as already large with numerous accounts, even if it is 
still small; this way, when it grows, you will be well positioned to manage the network 
as smoothly as possible. 

 Implementing Active Directory Security 
 So far, you have looked at many different concepts that are related to security within Active 
Directory. You began by exploring security principals and how they form the basis for 
administering Active Directory security. Then you considered the purpose and function of 
groups, how group scopes can affect how these groups work, and how to create a list of the 
predeﬁ ned users and groups for new domains and domain controllers. Based on all of this 
information, it ’ s time to see how you can implement Active Directory security. 
 In this section, you ’ ll take a look at how you can create and manage users and groups. 
The most commonly used tool for working with these objects is the Active Directory Users 
and Computers tool. Using this tool, you can create new user and group objects within the 
relevant OUs of your domain, and you can modify group membership and group scope. 
 In addition to these basic operations, you can use some additional techniques to 
simplify the administration of users and groups. One method involves using user templates. 
Additionally, you ’ ll want be able to specify who can make changes to user and group 
objects. That ’ s the purpose of delegation. Both of these topics are covered later in this 
section. 
 Let ’ s start with the basics. In Exercise 9.1, you learn how to create and manage users 
and groups.  
 This exercise involves creating new OUs and user accounts within 
an Active Directory domain. Be sure that you are working in a test 
environment to avoid any problems that might occur because of the 
changes that you make.  
 E X E R C I S E  9 .1
Creating and Managing Users and Groups 
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Create the following top - level OUs: 
 Sales  
 Marketing  
 Engineering  
 HR  
Implementing Active Directory Security 
389

390 
Chapter 9 ■ Planning Security for Active Directory
E X E R C I S E  9 .1  (c o n t i n u e d)
 3. 
  Create the following User objects within the Sales container (use the defaults for all 
ﬁ elds not listed):  
 a. 
 First Name:  John 
 
  Last Name:  Sales 
 
  User Logon Name:  JSales 
 b.  First Name:  Linda 
 
  Last Name:  Manager 
 
  User Logon Name:  LManager 
 4. 
  Create the following User objects within the Marketing container (use the defaults for all 
ﬁ elds not listed):  
 a.  First Name:  Jane 
 
  Last Name:  Marketing 
 
  User Logon Name:  JMarketing 
 b.  First Name:  Monica 
 
  Last Name:  Manager 
 
  User Logon Name:  MManager 
 5. 
  Create the following User object within the Engineering container (use the defaults for 
all ﬁ elds not listed):  
 First Name:  Bob 
 Last Name:  Engineer 
 User Logon Name:  BEngineer 
 6. 
  Right - click the HR container, and select New  Group. Use the name  Managers for the 
group, and specify Global for the group scope and Security for the group type. Click OK 
to create the group. 
 7. 
  To assign users to the Managers group, right - click the Group object and select 
Properties. Change to the Members tab, and click Add. Enter  Linda Manager  and  Monica 
Manager , and then click OK. You will see the group membership list. Click OK to ﬁ nish 
adding the users to the group. 
 8. 
  When you have ﬁ nished creating users and groups, close the Active Directory Users and 
Computers tool.  

 Notice that you can add users to groups regardless of the OU in which they ’ re contained. 
In Exercise 9.1, for example, you added two user accounts from different OUs into a group 
that was created in a third OU. This type of ﬂ exibility allows you to easily manage user and 
group accounts based on your business organization. 
 The Active Directory Users and Computers tool also allows you to perform common 
functions by simply right - clicking an object and selecting actions from the context menu. 
For example, you could right - click a user account and select Add Members To Group to 
quickly change group membership. You even have the ability in Active Directory Users and 
Computers to drag a user from one OU and drop them into another. 
 You may have noticed that creating multiple users can be a fairly laborious and a 
potentially error - prone process. As a result, you are probably ready to take a look at a 
better way to create multiple users — by using user templates, discussed in the next section. 
 Using User Templates 
 Sometimes you will need to add several users with the same security settings. Rather than 
creating each user from scratch and making conﬁ guration changes to each one manually, 
you can create one user template, conﬁ gure it, and copy it as many times as necessary. Each 
copy retains the conﬁ guration, group membership, and permissions of the original, but you 
must specify a new username, password, and full name to make the new user unique. 
 In Exercise 9.2, you create a user template, make conﬁ guration changes, and create a 
new user based on the template. This exercise shows you that the new user you create will 
belong to the same group as the user template that you copied it from. You should have 
completed Exercise 9.1 before you begin this one.  
 E X E R C I S E  9 . 2
Creating and Using User Templates 
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Create the following User object within the Sales container (use the defaults for all ﬁ elds 
not listed):  
 First Name:  Sales User  
 Last Name:  Template 
 User Logon Name:  SalesUserTemplate 
 3. 
  Create a new global security group called  Sales Users , and add SalesUserTemplate to 
the group membership.  
 4. 
  Right - click the SalesUserTemplate User object and select Copy from the context menu.  
 5. 
  Enter the username, ﬁ rst name, and last name for the new user. 
Implementing Active Directory Security 
391

392 
Chapter 9 ■ Planning Security for Active Directory
E X E R C I S E  9 . 2  (c o n t i n u e d)
 6. 
  Click the Next button to move on to the password screen and enter the new user ’ s 
password information. Close the Copy Object  -  User dialog box when you ’ ve ﬁ nished.  
 7. 
  Right - click the user you created in step 5, select Properties, and click the Member 
Of tab.  
 8. 
  Verify that the new user is a member of the Sales Users group. 
 Delegating Control of Users and Groups 
 A common administrative function related to the use of Active Directory involves managing 
users and groups. You can use OUs to logically group objects so that you can easily manage 
them. Once you have placed the appropriate Active Directory objects within OUs, you are 
ready to delegate control of these objects. 
 Delegation is the process by which a higher - level security administrator assigns 
permissions to other users. For example, if Admin A is a member of the Domain Admins 
group, he is able to delegate control of any OU within the domain to Admin B. You 
can access the Delegation of Control Wizard through the Active Directory Users and 
Computers tool. You can use it to quickly and easily perform common delegation tasks. 
The wizard walks you through the steps of selecting for which object(s) you want to 
perform delegation, what permission you want to allow, and which users will have those 
permissions. 
 Exercise 9.3 walks through the steps required to delegate control of OUs. In order to 
complete the steps in this exercise, you must have already completed Exercise 9.1.  
 E X E R C I S E  9 . 3
Delegating Control of Active Directory Objects  
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Create a new user within the Engineering OU, using the following information (use the 
default settings for any ﬁ elds not speciﬁ ed):  
 First Name:  Robert 
 Last Name:  Admin 
 User Logon Name:  radmin 
 Password:  P@ssw0rd 
 3. 
  Right - click the Sales OU, and select Delegate Control. This starts the Delegation of 
Control Wizard. Click Next. 

 4. 
  To add users and groups to which you want to delegate control, click the Add button. In 
the Add dialog box, enter  Robert Admin for the name of the user to add. Note that you 
can specify multiple users or groups using this option. 
 5. 
  Click OK to add the account to the delegation list, which is shown in the Users Or 
Groups page. Click Next to continue. 
 6. 
  On the Tasks To Delegate page, you must specify which actions you want to allow the 
selected user to perform within this OU. Select the Delegate The Following Common 
Tasks option, and place a check mark next to the following options:  
 Create, Delete, And Manage User Accounts 
 Reset User Passwords And Force Password Change At Next Logon  
 Read All User Information  
 Create, Delete, And Manage Groups 
 Modify The Membership Of A Group 
 7. 
  Click Next to continue. The wizard provides you with a summary of the selections that 
you have made on the Completing The Delegation Of Control Wizard page. To complete 
the process, click Finish to have the wizard commit the changes. 
 Now, when the user Robert Admin logs on (using  radmin as his logon name), he will be 
able to perform common administrative functions for all of the objects contained within 
the Sales OU.  
 8. 
  When you have ﬁ nished, close the Active Directory Users and Computers tool. 
 Using Group Policy for Security 
 As discussed in Chapter 8,  “ Conﬁ guring Group Policy Objects, ”  a very useful and 
powerful feature of Active Directory is a technology known as a Group Policy. Through 
the use of Group Policy settings, systems administrators can assign literally hundreds 
of different settings and options for users, groups, and OUs. Speciﬁ cally, in relation to 
security, you can use many different options to control how important features such as 
password policies, user rights, and account lockout settings can be conﬁ gured. 
 The general process for making these settings is to create a Group Policy object (GPO) 
with the settings that you want and to then link it to an OU or other Active Directory 
object. 
 Table 9.2 lists many Group Policy settings that are relevant to creating a secure Active 
Directory environment. Note that this list is not complete — many other options are 
available through Windows Server 2008 ’ s administrative tools.  
Using Group Policy for Security 
393

394 
Chapter 9 ■ Planning Security for Active Directory
 TA B L E 9. 2 Group Policy settings used for security purposes 
  Setting Section  
  Setting Name  
  Purpose  
  Account Policies   
Password Policy  
 Enforce Password 
History  
 Specifies how many passwords will 
be remembered. This option prevents 
users from reusing the same passwords, 
whenever they ’ re changed.  
  Account Policies   
Password Policy  
 Minimum Password 
Length  
 Prevents users from using short, weak 
passwords by specifying the minimum 
number of characters that the password 
must include.  
  Account Policies   
Account Lockout 
Policy  
 Account Lockout 
Threshold  
 Specifies how many bad password 
attempts can be entered before the 
account gets locked out.  
  Account Policies   
Account Lockout 
Policy  
 Account Lockout 
Duration  
 Specifies how long an account will 
remain locked out after too many bad 
password attempts have been entered. 
By setting this option to a reasonable 
value (such as 30 minutes), you can 
reduce administrative overhead while still 
maintaining fairly strong security.  
  Account Policies   
Account Lockout 
Policy  
 Reset Account 
Lockout Counter After 
 Specifies how long the Account Lockout 
Threshold counter will hold failed logon 
attempts before resetting to 0. 
  Local Policies   
Security Options  
 Accounts: Rename 
Administrator 
Account  
 Often, when trying to gain unauthorized 
access to a computer, individuals attempt 
to guess the Administrator password. 
One method for increasing security is to 
rename this account so that no password 
allows entry using this logon.  
  Local Policies   
Security Options  
 Domain Controller: 
Allow Server 
Operators To 
Schedule Tasks 
 This option specifies whether members 
of the built - in Server Operators group are 
allowed to schedule tasks on the server. 
  Local Policies   
Security Options  
 Interactive Logon: Do 
Not Display Last User 
Name  
 Increases security by not displaying the 
name of the last user who logged onto the 
system.  
  Local Policies   
Security Options  
 Shutdown: Allow 
System To Be Shut 
Down Without Having 
To Log On  
 Allows systems administrators to perform 
remote shutdown operations without 
logging on to the server. 

 You can use several different methods to conﬁ gure Group Policy settings using the tools 
included with Windows Server 2008 R2. Exercise 9.4 walks through the steps required 
to create a basic Group Policy for the purpose of enforcing security settings. In order to 
complete the steps of this exercise, you must have already completed Exercise 9.1.  
 E X E R C I S E  9 . 4
Applying Security Policies by Using Group Policy  
 1. 
  Open the Group Policy Management Console tool.  
 2. 
  Expand Domains and then click the domain name.  
 3. 
  In the right pane, right - click the Default Domain Policy and choose Edit.  
 4. 
  In the Group Policy Management Editor window, expand Computer Conﬁ guration   
Policies   Windows Settings   Security Settings  Account Policies   Password 
Policy.  
Using Group Policy for Security 
395

396 
Chapter 9 ■ Planning Security for Active Directory
E X E R C I S E  9 . 4  (c o n t i n u e d)
 5. 
  In the right pane, double - click the Minimum Password Length setting.  
 6. 
  In the Security Policy Setting dialog box, make sure the box labeled Deﬁ ne This 
Policy Setting Option is checked. Increase the Password Must Be At Least value to 8 
characters.  
 7. 
  Click OK to return to the Group Policy Management Editor window.  
 8. 
  Expand User Conﬁ guration   Administrative Templates   Control Panel. Double - click 
Prohibit Access To The Control Panel, select Enabled, and then click OK.  
 9. 
  Close the Group Policy window.  
 Fine - Grained Password Policies 
 The Windows Server 2008 and Windows Server 2008 R2 operating systems allow an 
organization to have different password and account lockout policies for different sets of 
users in a domain. In previous versions of Active Directory domains, an administrator 
could set up only one password policy and account lockout policy per domain. The Default 

Domain Policy for the domain is where these policy settings were conﬁ gured. Because 
domains could only have one password and account lockout policy, organizations that 
wanted multiple password and account lockout settings had to either create a password 
ﬁ lter or deploy multiple domains. 
 Fine - grained password policies allow you to specify multiple password policies within a 
single domain. Let ’ s say that you want administrators to not have to change their password 
as frequently as salespeople. Fine - grained password policies allow you to do that. 
 In Exercise 9.5, we will walk through the creation of a custom password policy using 
the ADSI Edit tool, and then we will link that policy to a group using Active Directory 
Users and Computers. Before completing this exercise, create a new global group named 
 Passgroup in Active Directory Users and Computers.  
 E X E R C I S E  9 . 5
Fine - Grained Password Policy  
 1. 
  Open ADSI Edit by clicking Start   Run   adsiedit.msc.  
 2. 
  Right - click ADSI Edit and then choose Connect To.  
 3. 
  When the Connection Settings dialog box appears, click OK.  
 4. 
  In the left - hand window, expand Default Naming Context   
DC= yourdomainname, DC=com   CN=System   CN=Password Settings Container.  
Using Group Policy for Security 
397

398 
Chapter 9 ■ Planning Security for Active Directory
E X E R C I S E  9 . 5  (c o n t i n u e d)
 5. 
  Right - click CN=Password Settings Container and choose New   Object. 
 6. 
  In the Select A Class box, choose msDS - PasswordSettings and click Next. 
 7. 
  At the Common Name screen, type  CustomPolicy and click Next. 
 8. 
  At the Password Settings Precedence screen, enter  10 as the value. This works as a cost 
value. The lowest priority takes precedence.  
 9. 
  At the Password Reversible Encryption Status For Users Accounts screen, set the value 
to False (recommended by Microsoft). 
 10.   The Password History Length screen shows how many passwords are remembered 
before a password can be used again. You can set this up to 1024 remembered 
passwords. Set the value to  12 . Click Next. 
 11.   At the Password Complexity screen, set the value to True. 
 12.   The next screen will be the Minimum Password Length screen. Set the value to  8 and 
click Next. 
 13.   At the Minimum Password Age screen, you must enter a value for the amount of time 
you want the password to be used at a minimum. Time is done in the I8 format. Thus  
 - 600000000   1 minute 
 - 36000000000   1 hour 
 - 864000000000   1 day 
 So if you want the minimum to be 10 days, you must calculate  - 864000000000 x 10 
(equaling  - 8640000000000). 
 Enter   - 8640000000000 (10 zeros) as your value for 10 days and click Next. You must put 
the  - (minus) sign in the front of the value. 
 14.   At the Maximum Password Age screen, set the value as   - 51840000000000 (10 zeros). 
This value equals 60 days. Click Next. 
 15.   At the Lockout Threshold screen, enter  3 and click Next.  
 16.   At the Observation Window screen, enter   - 3000000000 (5 minutes) and click Next.  
 17.   At the Lockout Duration screen, enter   - 18000000000 (30 minutes) and click Next.  
 18.   Click Finished. If you received any errors, check all your times for the  - (minus) sign in 
front.  
 19.   Close ADSI Edit.  
 20.   Open the Active Directory Users and Computers snap - in.  
 21.   On the View menu along the top, make sure that Advanced Features is checked.  

 22.   In the left - hand window, expand Active Directory Users And Computers   
 yourdomain   System   Password Settings Container. 
 23.   In the details pane on the right side, right - click CustomPolicy, and choose Properties.  
 24.   Click the Attribute Editor tab.  
 25.   Scroll down and select the msDS - PsoAppliesTo attribute. Click Edit.  
 26.   In the Multi - valued Distinguished Name dialog box, click Add Windows Account. 
 27.   Type in  Passgroup (this is the group you created before the exercise) and click the Check 
Name button. Click OK.  
 28.   Click OK twice more and you are ﬁ nished. Close the Active Directory Users and 
Computers snap - in. 
 Understanding Smart Card 
Authentication 
 In the previous section, we discussed password policies and account lockout policies that 
increase security for Windows Server 2008 R2. However, the standard account logon 
process is still fairly insecure due to the fact that a malicious attacker needs only a single 
piece of information — a password — to log on to the network. This problem is compounded 
by the fact that users or administrators probably would not detect a stolen password until 
after it had been used by a hacker to break into the system. Smart cards, which are similar 
in appearance to credit cards, solve both of these problems. 
 Smart cards store user certiﬁ cate information in a magnetic strip (barcode) or on a gold 
chip on a plastic card. As an alternative to the standard username and password logon 
process, users can insert a smart card into a special smart card reader attached to the 
computer and enter a unique PIN on the keyboard. This provides the system with a double -
 veriﬁ cation (two - factor authentication) secure logon (the smart card and the PIN) and 
reduces the likelihood that a user ’ s authentication method will be stolen without detection. 
 To deploy a smart card solution in the enterprise you must have a certiﬁ cate authority 
(CA) and a public - key infrastructure (PKI) on your intranet. In each domain, you must 
conﬁ gure the security permissions of the Smart Card User, Smart Card Logon, and 
Enrollment Agent certiﬁ cate templates to allow smart card users to enroll for certiﬁ cates. 
You must also set up the CA to issue smart card certiﬁ cates and Enrollment Agent 
certiﬁ cates. 
 After you ’ ve conﬁ gured your certiﬁ cate server to meet the requirements for smart card 
authentication, you can set up a smart card enrollment station and begin issuing smart 
Understanding Smart Card Authentication 
399

400 
Chapter 9 ■ Planning Security for Active Directory
cards to users. Most organizations that use smart card authentication don ’ t allow standard 
authentication at all, so Microsoft provides a Group Policy setting that requires the use of 
smart cards. 
 Preparing a Smart Card Certificate 
Enrollment Station 
 To begin issuing smart cards, you must prepare a smart card certiﬁ cate enrollment station 
where you physically transfer the authentication information to smart cards. You need to 
install a smart card reader on the enrollment station, which in this case doubles as a smart 
card writer.  
 Smart card readers are available from a variety of manufacturers, so 
you should always make sure that any smart card reader your company 
purchases is listed on the Windows Server 2008 R2 hardware compatibility 
list (HCL).  
 After you ’ ve properly installed the smart card reader, you need to install an Enrollment 
Agent certiﬁ cate on the enrollment station, which you obtain from your CA.  
 Configuring Group Policy Settings for 
Smart Cards 
 Now that you ’ ve seen how to conﬁ gure a smart card enrollment station and set up smart 
cards for user logon, you should begin to think about Group Policy settings for enforcing 
smart card logon. One of the most common mistakes that administrators make when 
administering a smart card policy is to not require smart card logon at all. This means that 
users with smart cards can log on with either their smart cards or through the standard 
username and password procedure, which defeats the point of issuing smart cards in the 
ﬁ rst place! Exercise 9.6 shows you how to conﬁ gure Group Policy to require smart card 
authentication.  
 E X E R C I S E  9 . 6
Conﬁ guring Group Policy to Require Smart Card Logon  
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Create a new top - level OU called  Smart Card Test . 
 3. 
  Close the Active Directory Users and Computers tool and open the Group Policy 
Management Console.  

 4. 
  Right - click the Smart Card Test OU and select Create A GPO In This Domain And Link 
It Here.  
 5. 
  In the New GPO dialog box, enter  Smart Card GPO Test in the Name box and Click OK. 
Right - click the new GPO and then click the Edit button.  
 6. 
  In the Group Policy Object Editor window, expand Computer Conﬁ guration   Policies   
Windows Settings   Security Settings   Local Policies   Security Options.  
 7. 
  Double - click the Interactive Logon: Require Smart Card policy.  
 8. 
  Check the box labeled Deﬁ ne This Policy Setting, and then select Enabled and click OK.  
 9. 
  Close the Group Policy Management Console.  
 Understanding Security Configuration 
and Analysis Tools 
 The power and ﬂ exibility of Windows - based operating systems are both beneﬁ ts and 
liabilities. On the plus side, the many conﬁ guration options available allow users 
and systems administrators to modify and customize settings. On the negative side, 
however, when systems administrators allow all users full functionality, problems can 
Understanding Security Configuration and Analysis Tools 
401

402 
Chapter 9 ■ Planning Security for Active Directory
arise. For example, novice users might attempt to delete critical system ﬁ les or incorrectly 
uninstall programs to free up disk space. 
 So how can you prevent these types of problems? One method is to control the types of 
actions that users can perform. Because you can conﬁ gure most settings for the Windows 
Server 2008 R2 interface in the Registry, you could edit the appropriate settings using 
the  RegEdit command. However, this process can become quite tedious. Furthermore, 
manually modifying the Registry is a dangerous process and one that is bound to cause 
problems due to human error. In order to make creating and applying security settings 
easier, Microsoft has included the Security Conﬁ guration and Analysis utility with 
Windows Server 2008 R2. They have also built this utility ’ s functionality into a command -
 line utility called  secedit.exe . 
 Using the Security Configuration 
and Analysis Utility 
 You can use the  Security Conﬁ guration and Analysis utility  together with security template 
ﬁ les to create, modify, and apply security settings in the Registry.  Security templates allow 
systems administrators to deﬁ ne security settings once and then store this information in a 
ﬁ le that can be applied to other computers. 
 These template ﬁ les offer a user - friendly way to conﬁ gure common settings for Windows 
Server 2008 R2 operating systems. For example, instead of searching through the Registry 
(which is largely undocumented) for speciﬁ c keys, a systems administrator can choose from 
a list of common options. The template ﬁ le provides a description of the settings, along with 
information about the Registry key(s) to which the modiﬁ cations must be made. Templates 
can be stored and applied to users and computers. For example, we could create three 
conﬁ gurations named Level 1, Level 2, and Level 3. We may use the Level 3 template for 
high - level managers and engineers and the Level 1 and Level 2 templates for all other users 
who need only basic functionality. 
 The overall process for working with the Security Conﬁ guration and Analysis utility is 
as follows: 
 1. 
 Open or create a security database ﬁ le.  
 2. 
  Import an existing template ﬁ le.  
 3. 
  Analyze the local computer.  
 4. 
  Make any setting changes.  
 5. 
  Save any template changes.  
 6. 
  Export the new template (optional).  
 7. 
  Apply the changes to the local computer (optional).  
 The Security Conﬁ guration and Analysis utility has no default icon. In order to access it, 
you must manually choose this snap - in from within the MMC.  

 Understanding the  secedit.exe Command 
 All of the functionality of the Security Conﬁ guration and Analysis utility has also been 
built into a command - line utility called  secedit.exe . One advantage of using  secedit.exe 
is that you can perform a batch analysis without having to use the graphical tools. 
 Just like the Security Conﬁ guration and Analysis utility, the command - line utility is 
database driven, meaning that you can use switches to access database and conﬁ guration 
ﬁ les. The  secedit.exe command performs the following high - level functions: analysis, 
conﬁ guration, export function, and validation. These are the same functions carried out by 
the Security Conﬁ guration and Analysis graphical utility (described in the previous section 
and exercise). 
 Table 9.3 lists the  secedit.exe switches and their functions. 
 If any errors occur during the security conﬁ guration and analysis process, the results 
will be stored in the log ﬁ le that is created. Be sure to examine this ﬁ le for any errors that 
might be present in your conﬁ guration.  
 Switch  
  Valid with Switch  
  Function  
 /analyze 
  Independent function  
  Analyzes system security. 
 /configure 
  Independent function  
  Configures system security by applying a 
stored template.  
 /refreshpolicy 
  Independent function  
  Reapplies security settings to the GPO.  
 /export 
  Independent function  
  Exports a template from the database to 
the template file.  
 /validate 
  Independent function  
  Validates the syntax of a security template. 
 [/DB  filename  ] 
  /analyze ,  /configure , 
 /export 
 Required with the  /analyze and 
 /configure commands. Optional with 
others. Specifies the path to the database 
file.  
 [/CFG  filename  ] 
  /analyze,/configure , 
 /export 
 Required if a new database file is specified. 
Specifies the path to a security template to 
import into the database.  
 [/log  logpath  ] 
  /analyze, /configure , 
 /export 
 Specifies the path to the log file generated 
during the operation. 
 TA B L E 9. 3  secedit.exe switches 
Understanding Security Configuration and Analysis Tools 
403

404 
Chapter 9 ■ Planning Security for Active Directory
 Implementing an Audit Policy 
 One of the most important aspects of controlling security in networked environments is 
ensuring that only authorized users are able to access speciﬁ c resources. Although systems 
administrators often spend much time managing security permissions, it is almost always 
possible for a security problem to occur. 
 Sometimes, the best way to ﬁ nd possible security breaches is to actually record the 
actions speciﬁ c users take. Then, in the case of a security breach (the unauthorized 
shutdown of a server, for example), systems administrators can examine the log to ﬁ nd 
the cause of the problem. 
  Switch  
  Valid with Switch  
  Function  
  [/verbose] 
  /analyze ,  /configure , 
 /export 
 Specifies more detailed progress 
information.  
  [/quiet] 
  /analyze ,  /configure , 
 /export 
 Suppresses screen output during the 
operation.  
  [/overwrite] 
 /configure 
  Optional only if  [/CFG  filename  ] is used. 
Completely overwrites the database rather 
than appending the database. 
  [/areas  area1 
area2 ] 
 /configure ,  /export 
  Specifies security areas to be applied to 
the system. Default is all areas. Options 
are  SECURITYPOLICY ,  GROUP_MGMT ,  USER_
RIGHTS ,  REGKEYS ,  FILESTORE , and  SERVICES . 
  Machine_policy 
  /refreshpolicy 
  Refreshes security settings for the local 
computer.  
  User_policy 
  /refreshpolicy 
  Refreshes security settings for the current 
local user account. 
  /enforce 
  /refreshpolicy 
  Refreshes security settings even if no 
changes have been made to the GPO.  
  /MergedPolicy 
  /export 
  Merges local and domain policy in the 
export file.  
  Filename  
 /validate 
  Indicates the filename of the template to 
validate.  
 TA B L E 9. 3  secedit.exe switches  (continued)

 The Windows Server 2008 R2 operating system and Active Directory offer you the 
ability to audit a wide range of actions. In the following sections, you ’ ll see how to 
implement auditing for Active Directory. 
 Overview of Auditing 
 The act of auditing relates to recording speciﬁ c actions. From a security standpoint, 
auditing is used to detect any possible misuse of network resources. Although auditing does 
not necessarily prevent resources from being misused, it does help determine when security 
violations occurred (or were attempted). Furthermore, just the fact that others know that 
you have implemented auditing may prevent them from attempting to circumvent security. 
 You need to complete several steps in order to implement auditing using Windows Server 
2008 R2: 
 1. 
 Conﬁ gure the size and storage settings for the audit logs.  
 2. 
  Enable categories of events to audit.  
 3. 
  Specify which objects and actions should be recorded in the audit log.  
 Note that there are trade - offs to implementing auditing. First and foremost, recording 
auditing information can consume system resources. This can decrease overall system 
performance and use up valuable disk space. Second, auditing many events can make the audit 
log impractical to view. If too much detail is provided, systems administrators are unlikely 
to scrutinize all of the recorded events. For these reasons, you should always be sure to ﬁ nd 
a balance between the level of auditing details provided and the performance - management 
implications of these settings.  
 Implementing Auditing 
 Auditing is not an all - or - none type of process. As is the case with security in general, systems 
administrators must choose speciﬁ cally which objects and actions they want to audit. 
 The main categories for auditing include the following: 
 Audit account logon events  
 Audit account management  
 Audit directory service access  
 Audit logon events  
 Audit object access  
 Audit policy change  
 Audit privilege use  
 Audit process tracking 
 Audit system events  
 In this list of categories, four of the categories are related to Active Directory. Let ’ s 
discuss these four auditing categories in a bit more detail.  
■
■
■
■
■
■
■
■
■
Implementing an Audit Policy 
405

406 
Chapter 9 ■ Planning Security for Active Directory
  Audit Account Logon Events   You enable this auditing event if you want to audit when a 
user authenticates with a domain controller and logs onto the domain. This event is logged 
in the Security Log on the domain controller.  
  Audit Account Management   This auditing event is used when you want to watch 
what changes are being made to Active Directory accounts. For example, when another 
administrator creates or deletes a user account, it would be an audited event.  
  Audit Directory Service Access   This auditing event occurs whenever a user or administrator 
accesses Active Directory objects. Let ’ s say an administrator opens Active Directory and 
clicks a user account; even if nothing is changed on that account, an event is logged. 
  Audit Logon Events   Account logon events are created for domain account activity. For 
example, you have a user who logs on to a server so that they can access ﬁ les; the act of 
logging onto the server creates this audit event.  
  Audit Object Access   Audit object access allows you to audit objects within your network 
such as folders, ﬁ les, and printers. If you suspect someone is trying to hack into an object 
(for example, the  finance folder), this is the auditing that you would use. You still would 
need to enable auditing on the actual object (for example, the  finance folder).  
  Audit Policy Change   Audit policy change allows you to audit changes to user rights 
assignment policies, audit policies, or trust policies. This auditing allows you to see if 
anyone changes any of the other audit policies.  
  Audit Privilege Use   Setting the audit privilege use allows an administrator to audit each 
instance of a user exercising a user right. For example, if a user changes the system time on 
a machine, this is a user right. Log on locally is another common user right.  
 In order to audit access to objects stored within Active Directory, you must enable the 
Audit Directory Service Access option. Then you must specify which objects and actions 
should be tracked. 
 Exercise 9.7 walks through the steps you must take to implement auditing of Active 
Directory objects on domain controllers. In order to complete the steps in this exercise, you 
must have already completed Exercise 9.1.  
 E X E R C I S E  9 . 7
Enabling Auditing of Active Directory Objects  
 1. 
  Open the Local Security Policy tool (located in the Administrative Tools program group).  
 2. 
  Expand Local Policies   Audit Policy.  
 3. 
  Double - click the setting for Audit Directory Service Access.  
 4. 
  In the Audit Directory Service Access Properties dialog box, place check marks next to 
Success and Failure. Click OK to save the settings.  
 5. 
  Close the Local Security Policy tool.  

 Once you have enabled auditing of Active Directory objects, it ’ s time to specify exactly 
which actions and objects should be audited. Exercise 9.8 walks through the steps required 
to enable auditing for a speciﬁ c OU. In order to complete the steps in this exercise, you 
must have already completed Exercise 9.1 and Exercise 9.7.  
 E X E R C I S E  9 . 8
Enabling Auditing for a Speciﬁ c OU  
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  To enable auditing for a speciﬁ c object, right - click the Engineering OU, and select 
Properties. 
 3. 
  Select the Security tab on the Properties dialog box, and then click Advanced. Select the 
Auditing tab.  
 4. 
  Click the Edit button. Notice that you can view and change auditing settings based on 
the objects and/or properties. To retain the current settings, click OK. 
 5. 
  To exit the conﬁ guration for the Engineering object, click OK three more times.  
 6. 
  When you have ﬁ nished with the auditing settings, close the Active Directory Users and 
Computers tool.  
 Viewing Auditing Information 
 One of the most important aspects of auditing is regularly monitoring the audit logs. If 
this step is ignored, as it often is in poorly managed environments, the act of auditing is 
useless. Fortunately, Windows Server 2008 R2 includes the  Event Viewer tool, which 
allows systems administrators to quickly and easily view audited events. Using the ﬁ ltering 
capabilities of Event Viewer, they can ﬁ nd speciﬁ c events of interest. 
 Exercise 9.9 walks through the steps you must take to generate some auditing events 
and to examine the data collected for these actions. In this exercise, you will perform some 
actions that will be audited, and then you will view the information recorded within the 
audit logs. In order to complete this exercise, you must have already completed the steps in 
Exercise 9.1 and Exercise 9.7.  
 E X E R C I S E  9 . 9
Generating and Viewing Audit Logs 
 1. 
  Open the Active Directory Users and Computers tool. 
 2. 
  Within the Engineering OU, right - click the Bob Engineer user account, and select 
Properties. 
Implementing an Audit Policy 
407

408 
Chapter 9 ■ Planning Security for Active Directory
E X E R C I S E  9 . 9  (c o n t i n u e d)
 3. 
  On the Bob Properties dialog box, add the middle initial  A  for this user account, and 
specify  Software Developer  in the Description box. Click OK to save the changes. 
 4. 
  Within the Engineering OU, right - click the Robert Admin user account, and select 
Properties. 
 5. 
  On the Robert Properties dialog box, add the description  Engineering IT Admin , and 
click OK.  
 6. 
  Close the Active Directory Users and Computers tool. 
 7. 
  Open the Event Viewer tool from the Administrative Tools program group. Select the 
Security item under Windows Logs. You will see a list of audited events categorized 
under Directory Service Access. Note that you can obtain more details about a speciﬁ c 
item by double - clicking it. 
 8. 
  When you have ﬁ nished viewing the Security Log, close the Event Viewer tool.  
 What ’ s New in Windows Server 2008 R2 Auditing 
 Auditing in Windows Server 2008 R2 and Windows 7 has been enhanced in many ways. 
Microsoft has increased the level of details in the security auditing logs. Microsoft has 
also simpliﬁ ed the deployment and management of auditing policies. Some of the major 
enhancements include the following:
  Global Object Access Auditing   Administrators using Windows Server 2008 R2 and 
Windows 7 now have the ability to deﬁ ne computer - wide system access control lists 
(SACLs). Administrators can deﬁ ne SACLs for either the ﬁ lesystem or Registry. After the 
speciﬁ ed SACL is deﬁ ned, the SACL is then applied automatically to every single object 
of that type. This can be very helpful to administrators for verifying that all critical 
ﬁ les, folders, and Registry settings on a computer are protected. This is also helpful for 
identifying when an issue occurs with a system resource.  
  “ Reason For Access ” Reporting   When an administrator is performing auditing, they can 
see whether an operation was successful or unsuccessful, but previously they lacked the 
ability to see the reason why the operation was successful or unsuccessful. In Windows 
Server 2008 R2 and Windows 7, administrators now have the ability to view the reason 
why the operation was successful or unsuccessful.  
  Advanced Audit Policy Settings   In Windows Server 2008 R2, the Advanced Audit Policy 
settings are 53 new settings that can be used in place of the 9 basic auditing settings. These 
new settings, shown in Figure 9.8, allow administrators to be more speciﬁ c when targeting 
the types of activities that they want to audit. These advanced audit settings also help 
eliminate the unnecessary auditing activities that can make audit logs difﬁ cult to manage 
and decipher.  

 Summary 
 In this chapter, we talked about planning for and implementing security with Active 
Directory. You cannot overlook security; it ’ s important to always consider how security may 
affect your deployment or lack of it — how it will ultimately affect your system if it is hacked. 
 We also looked at the differences between security and distribution groups. Distribution 
groups are used for only one thing: email distribution lists. These groups are used with 
email applications (such as Microsoft Exchange Server 2010) to send email to the members 
of the group you create. They do not allow you to assign permissions, and you cannot use 
them to ﬁ lter Group Policy settings. In the Windows Server 2008 R2 operating system, 
security groups are used to manage user account and computer account access to shared 
resources and to ﬁ lter Group Policy settings. 
 We also explained other important items that pertain to security, such as which default 
groups are available after a base install of the operating system and how to secure the most 
vulnerable accounts. 
 We then examined how permissions are managed. You can change permissions 
with Group Policy or simply by altering them right on the object. We also covered how 
delegation of control can be used to distribute administrative responsibilities. We wrapped 
up this chapter by discussing auditing — why it ’ s important and how to get it done. 
 Thoroughly understanding each of these topics is important when you ’ re implementing 
Active Directory in a business environment (and when you ’ re preparing for the exam). In 
the next chapter, we focus on Active Directory reliability and how to optimize it.  
 F I G U R E 9. 8 Advanced Audit Policy settings 
Summary 
409

410 
Chapter 9 ■ Planning Security for Active Directory
 Exam Essentials  
  Understand the purpose of security principals.   Security principals are Active Directory 
objects that can be assigned permissions. Understanding how they work is vital to creating 
a secure Active Directory environment. Security principals include users, groups, and 
computers.  
  Understand group types and group scope.   The two major types of groups are security 
and distribution groups, and they have different purposes. Groups can be local, global, 
or universal. Domain local groups are used to assign permissions to local resources, such 
as ﬁ les and printers. The scope of global groups is limited to a single domain. Universal 
groups can contain users from any domains within an Active Directory forest.  
  Understand the purpose and permissions of built - in groups.   The Active Directory 
environment includes several built - in local and global groups that are designed to simplify 
common systems administration tasks. For instance, members of the Administrators group 
are given full permissions to perform any functions within the Active Directory domain 
and on the local computer.  
  Understand how to use Group Policy to manage password and other security - related 
policies.   Through the use of Group Policy settings, you can conﬁ gure password and 
account - related options. You can also specify to which users, groups, and OUs many of the 
settings apply.  
  Understand how to configure smart card authentication.   Smart card authentication 
requires a CA for issuing smart card certiﬁ cates. To enroll a smart card certiﬁ cate, you 
must ﬁ rst prepare a smart card enrollment station and then write certiﬁ cate information to 
the smart cards using a smart card reader. Finally, to make smart cards useful, you should 
enable the Interactive Logon: Require Smart Card policy in the Group Policy Object Editor.  
  Understand how to use the Delegation of Control Wizard to allow distributed 
administration.   Delegation is the process by which a higher - level security administrator 
assigns permissions to other users. The Delegation of Control Wizard walks you through 
the steps of selecting for which object(s) you want to perform delegation, what permissions 
you want to allow, and which users will have those permissions.  
  Learn how the Security Configuration and Analysis utility can simplify the 
implementation of security policies.   You can use the Security Conﬁ guration and Analysis 
utility together with security template ﬁ les to create, modify, and apply security settings 
in the Registry. Security templates allow systems administrators to deﬁ ne security settings 
once and then store this information in a ﬁ le that can be applied to other computers.  
  Understand the purpose and function of auditing.   Auditing helps determine the cause of 
security violations and helps troubleshoot permissions - related problems.  

 Review Questions  
 1. 
  You want to create multiple password policies for the users in your domain. What utility do 
you use to complete this task?  
 A.   MMC  
 B.   Schema editor  
 C.   ADSI Edit  
 D.   Secedit.exe 
 2. 
  You are the systems administrator for a medium - sized Active Directory domain. Currently, 
the environment supports many different domain controllers, some of which are running 
Windows NT 4 and others that are running Windows 2003 and Server 2008 R2. When 
you are running domain controllers in this type of environment, which of the following 
types of groups can you not use? (Choose all that apply.)  
 A.   Universal security groups  
 B.   Global groups  
 C.   Domain local groups  
 D.   Computer groups  
 3. 
 Isabel is a systems administrator for an Active Directory environment that is running in 
Native mode. Recently, several managers have reported suspicions about user activities and 
have asked her to increase security in the environment. Specifically, the requirements are as 
follows:  
 The accessing of certain sensitive files must be logged.  
 Modifications to certain sensitive files must be logged.  
 Systems administrators must be able to provide information about which users 
accessed sensitive files and when they were accessed.  
 All logon attempts for specific shared machines must be recorded.  
 
 Which of the following steps should Isabel take to meet these requirements? (Choose all 
that apply.)  
 A.   Enable auditing with the Computer Management tool.  
 B.   Enable auditing with the Active Directory Users and Computers tool.  
 C.   Enable auditing with the Active Directory Domains and Trusts tool.  
 D.   Enable auditing with the Event Viewer tool.  
 E. 
  View the audit log using the Event Viewer tool.  
 F. 
 View auditing information using the Computer Management tool.  
 G.   Enable failure and success auditing settings for specific files stored on NTFS volumes.  
 H.  Enable failure and success auditing settings for logon events on specific computer 
accounts.  
■
■
■
■
Review Questions 
411

412 
Chapter 9 ■ Planning Security for Active Directory
 4. 
  A systems administrator wants to allow another user the ability to change user account 
information for all users within a specific OU. Which of the following tools would allow 
them to do this most easily?  
 A.   Domain Security Policy 
 B.   Domain Controller Security Policy  
 C.   Computer Management  
 D.   Delegation of Control Wizard  
 5. 
  Will, an IT manager, has full permissions over several OUs within a small Active Directory 
domain. Recently, Will has hired a junior systems administrator named Crystal to take 
over some of the responsibilities of administering the objects within these OUs. Will gives 
Crystal access to modify user accounts within two OUs. This process is known as what?  
 A.   Inheritance  
 B.   Transfer of control  
 C.   Delegation  
 D.   Transfer of ownership  
 6. 
 You are the network administrator for your organization. A new company policy has been 
released wherein if a user enters their password incorrectly three times within 5 minutes, 
they are locked out for 30 minutes. What three actions do you need to set to comply with 
this policy? (Choose all that apply.)  
 A.   Set the Account Lockout Duration to 5 minutes.  
 B.   Set the Account Lockout Duration to 30 minutes.  
 C.   Set the Account Lockout Threshold setting to 3 invalid logon attempts.  
 D.   Set the Account Lockout Threshold setting to 30 minutes.  
 E. 
  Set the Reset Account Lockout Counter setting to 5 minutes. 
 F. 
 Set the Reset Account Lockout Counter setting to 3 times. 
 7. 
  You have almost finished helping with the migration of a Windows NT network to a 
Windows Server 2008 R2 network. The current domain functional level is Windows 2000 
Mixed mode. There are three locations, and the engineers are creating a single domain 
for now. Many rumors are surfacing that a merger with one of your competitors is going 
to happen, and the designers are considering adding a new domain to bring those users 
into the network. One of your jobs is to help come up with the administrative plans for 
the designers to manage the users. To outline your task, you are going to build a best -
 practices approach to giving permissions to resources on your mixed network. Which of the 
following approaches best suits your situation?  
  A.   Apply permissions to the domain local group and add the accounts to this group.  
 B.   Apply permissions to the domain local groups, add users to global groups, and add the 
global groups to the domain local groups.  
 C.   Apply permissions to global groups, add users to universal groups, and place these 
universal groups into global groups.  
 D.   Apply permissions to domain local groups, add the users to global groups, add the global 
groups into universal groups, and add the universal groups into the domain local groups.  

 8. 
  Which of the following folders in the Active Directory Users and Computers tool is used 
when users from outside the forest are granted access to resources within a domain?  
 A.   Users 
 B.   Computers 
 C.   Domain Controllers  
 D.   Foreign Security Principals 
 9. 
  You create a GPO and link it to the Sales OU. You want to monitor users in the Sales OU 
who connect to the file server. What type of auditing do you enable?  
 A.   Audit Object Access  
 B.   Audit Logon Events  
 C.   Audit System Events  
 D.   Audit Process Tracking  
 10.   Alexis is a systems administrator for an Active Directory environment that contains four 
domains. Recently, several managers have reported suspicions about user activities and have 
asked her to increase security in the environment. Specifically, the requirements are as follows:  
 Audit changes to User objects that are contained within a specific OU.  
 Allow a special user account called Audit to view and modify all security - related 
information about objects in that OU.  
 
 Which of the following steps should Alexis take to meet these requirements? (Choose all 
that apply.)  
 A.   Convert all volumes on which Active Directory information resides to NTFS.  
 B.   Enable auditing with the Active Directory Users and Computers tool.  
 C.   Create a new Active Directory domain and create restrictive permissions for the 
suspected users within this domain.  
 D.   Reconfigure trust settings using the Active Directory Domains and Trusts tool.  
 E. 
 Specify auditing options for the OU using the Active Directory Users and Computers tool.  
 F. 
 Use the Delegation of Control Wizard to grant appropriate permissions to view and 
modify objects within the OU to the Audit user account.  
■
■
Review Questions 
413

414 
Chapter 9 ■ Planning Security for Active Directory
 Answers to Review Questions 
1. 
 C.   To create multiple password policies, you would use ADSI Edit (or  adsiedit.msc ). 
2. 
 A, D.  Because you are supporting Windows NT 4, Server 2003, and Server 2008 R2 domain 
controllers, you must run the environment in Windows 2000 Mixed domain functional level. 
Universal security groups are not available when you are running in Windows 2000 Mixed 
domain functional level. Computer groups is not an actual group type. 
3. 
 B, E, G, H.   The Active Directory Users and Computers tool allows systems administrators 
to change auditing options and to choose which actions are audited. At the ﬁ lesystem level, 
Isabel can specify exactly which actions are recorded in the audit log. She can then use 
Event Viewer to view the recorded information and provide it to the appropriate managers. 
4. 
 D.   The Delegation of Control Wizard is designed to assist systems administrators in 
granting speciﬁ c permissions to other users. 
5. 
 C.   Delegation is the process of granting permissions to other users. Delegation is often 
used to distribute systems administration responsibilities. Inheritance is the transfer of 
permissions and other settings from parent OUs to child OUs. Transfer of control and 
transfer of ownership are not terms applicable to OUs. 
6. 
 B, C, E.   The Account Lockout Duration states how long an account will be locked out 
if the password is entered incorrectly. The Account Lockout Threshold is the number of 
bad password attempts, and the Account Lockout Counter is the time in which the bad 
password attempts are made. Once the Account Lockout Counter reaches 0, the number of 
bad password attempts returns to 0. 
7. 
 B.  Because this is still a Windows 2000 Mixed domain functional - level network, universal groups 
are not available, so the best practice is to add users to global groups and apply permissions to 
the domain local groups where the resources reside. Even in a Native mode network, you do not 
want to place users into a universal group because the contents of universal groups are included 
in the Global Catalog and therefore will unnecessarily add to its size. When the migration is 
complete, you can use the universal groups to include global groups from multiple domains, and 
then you can place them in domain local groups that have permissions applied to them. 
8. 
 D.   When resources are made available to users who reside in domains outside the forest, 
Foreign Security Principal objects are automatically created. These new objects are stored 
within the  Foreign Security Principals  folder. 
9. 
 B.   Account logon events are created for domain account activity. For example, you have a 
user who logs on to a server so that they can access ﬁ les; the act of logging on to the server 
creates this audit event. 
10.  B, E, F.   The ﬁ rst step is to enable auditing. With auditing enabled, Alexis can specify 
which actions are recorded. To give permissions to the Audit user account, she can use the 
Delegation of Control Wizard. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 .  

Active Directory 
Optimization and 
Reliability  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Maintaining the Active Directory Environment  
 Configure backup and recovery. May include but is not 
limited to: using Windows Server Backup; back up files 
and system state data to media; back up and restore by 
using removable media; perform an authoritative or 
non - authoritative restore; linked value replication; Directory 
Services Recovery Mode (DSRM); back up and restore GPOs; 
configure AD recycle bin.  
 Perform offline maintenance. May include but is not limited 
to: offline defragmentation and compaction; Restartable 
Active Directory; Active Directory database mounting tool.  
 Monitor Active Directory. May include but is not limited to: 
Event Viewer subscriptions; data collector sets; real - time 
monitoring; analyzing logs; WMI queries; PowerShell.  

■
■
■
 Chapter 
10

 One of the most important tasks of an IT team is to keep the 
network up and running. Making sure that Active Directory is 
running at its peak performance is one way you can guarantee 
that your end users continue to use the network and its resources without problems or 
interruptions. Remember, everyone has clients; sales people have theirs as do we as systems 
administrators. Our clients are the end users. It ’ s our job to make sure our clients can do 
their jobs. 
 When you are working with Active Directory, it is important that you make sure 
your system information is safely backed up. Backups become useful when you lose data 
because of system failures, ﬁ le corruptions, or accidental modiﬁ cations of information. As 
consultants, we can tell you from experience that backups are one of the most important 
tasks that an IT person performs daily. In this chapter, we cover the many different types of 
backup strategies. 
 Sometimes performance optimization can feel like a luxury, especially if you can ’ t get 
your domain controllers to the point where they are actually performing the services you 
intended for them, such as servicing printers or allowing users to share and work on ﬁ les. 
The Windows Server 2008 R2 operating system platform has been speciﬁ cally designed to 
provide high - availability services intended solely to keep your mission - critical applications 
and data accessible even in times of disaster. Occasionally, however, you might experience 
intermittent server crashes on one or more of the domain controllers or other computers in 
your environment. 
 The most common cause of such problems is a hardware conﬁ guration issue. Poorly 
written device drivers and unsupported hardware can cause problems with system stability. 
Similarly, a failed hardware component (such as system memory) can also cause problems. 
For instance, memory chips can be faulty, electrostatic discharge (ESD) can ruin them, 
and other hardware issues can occur. No matter what, a problem with your memory chip 
only spells disaster for your server. Usually, third - party hardware vendors provide utility 
disks with their computers that you can use to perform hardware diagnostics on machines 
to help ﬁ nd your problems. These utilities are a good ﬁ rst step when you are working on 
resolving intermittent server crashes. When you use these utility disks combined with the 
troubleshooting tips we provide in this and other chapters of this book, you should be able 
to pinpoint most Active Directory – related problems that might occur on your network. 
 In this chapter, we ’ ll cover tools and methods for measuring performance and 
troubleshooting failures in Windows Server 2008 R2. Before you dive into the technical 
details, however, you should thoroughly understand what we ’ re trying to accomplish and 
how we ’ ll meet this goal.  

 Overview of Windows Server 2008 R2 
Performance Monitoring 
 The ﬁ rst step in any performance optimization strategy is to accurately and consistently 
measure performance. The insight that you ’ ll gain from monitoring factors such as network 
and system utilization will be extremely useful when you go to measure the effects of any 
changes. 
 The overall process of performance monitoring usually involves the following steps: 
 1. 
 Establish a baseline of current performance.  
 2. 
  Identify the bottleneck(s).  
 3. 
  Plan for and implement changes.  
 4. 
  Measure the effects of the changes. 
 5. 
  Repeat the process, based on business needs.  
 Note that the performance optimization process is never really ﬁ nished because you can 
always try to gain more performance from your system by modifying settings and applying 
other well - known tweaks. Before you get discouraged, realize that you ’ ll reach some level of 
performance that you and your network and system users consider acceptable enough; at this 
point, you will ﬁ nd that it ’ s not worth the additional effort it ’ ll take to optimize performance 
further. Also note that as your network and system load increases (more users or users doing 
more), the need to reiterate this process will increase also. By continuing to monitor, measure, 
and optimize, you will keep ahead of the pack and keep your end users happy. 
 Troubleshooting Issues 
 It would be almost impossible to cover everything that could go wrong with your 
Windows Server 2008 R2 system and/or Active Directory. This book covers many of 
the most likely and/or common issues you might come across, but anything is likely. 
Make sure you focus on the methodology we use and the steps we show you to locate 
and isolate a problem, even if you are not 100 percent sure what the problem may be. 
In addition, use online resources to help you locate and troubleshoot the problem, but 
don ’ t believe everything you read (something that is posted online can be wrong or 
misleading); test your changes in a lab environment and try to read multiple sources. 
Always use Microsoft Support ( http://support.microsoft.com/ ) as one of your sources, 
because this site is most likely the right source of information (it ’ s the product vendor, 
after all). You won ’ t be able to ﬁ nd and ﬁ x everything, but knowing where to ﬁ nd critical 
information that will aid you deﬁ nitely won ’ t hurt you either. One of the tools that 
many of us in the industry use is Microsoft TechNet. The full version of TechNet (paid 
subscription) is a resource that will help you ﬁ nd and ﬁ x many real - world issues. 
Overview of Windows Server 2008 R2 Performance Monitoring 
417

418 
Chapter 10 ■ Active Directory Optimization and Reliability
 Now that you have an idea of the overall process, let ’ s focus on how you should make 
changes. Some important ideas to keep in mind when monitoring performance include the 
following:
  Plan Changes Carefully.   Here ’ s a rule of thumb we always try to follow: An hour of 
planning can save you a week of work. When you are working in an easy - to - use GUI - based 
operating system like the Windows Server 2008 R2 platform, it ’ s tempting to randomly 
remove a check mark here or there and then retest the performance. You should resist 
the urge to do this because some changes can cause large decreases in performance or 
can impact functionality. Before you make haphazard changes (especially on production 
servers), take the time to learn about, plan for, and test your changes. Plan for outages and 
testing accordingly.  
 Utilize a Test Environment.   Test in a test lab that simulates a production environment. 
Do not make changes on production environments without ﬁ rst giving warning. Ideally, 
change production environments in off hours when fewer network and system users will 
be affected. Making haphazard changes in a production environment can cause serious 
problems. These problems will likely outweigh any beneﬁ ts you could receive from making 
performance tweaks.  
  Make Only One Change at a Time.   The golden rule of scientiﬁ c experiments is that 
you should always keep track of as many variables as possible. When the topic is server 
optimization, this roughly translates into making only one change at a time. 
 One of the problems with making multiple system changes is that, although you may have 
improved performance overall, it ’ s hard to determine exactly  which change created the 
positive effects. It ’ s also possible, for example, that changing one parameter increased 
performance greatly while changing another decreased it slightly. Although the overall 
result was an increase in performance, the second, performance - reducing option should 
be identified so the same mistake is not made again. To reduce the chance of obtaining 
misleading results, always try to make only one change at a time. 
 But the main reason to make one change at a time is that if you do make a mistake or 
create an unexpected issue, you can easily back out of the change. If you make two or three 
changes at the same time and are not sure which one created the problem, you will have 
to undo all the changes and then make one alteration at a time to find the problem. If you 
make only one change at a time and follow that methodology every time, you won ’ t find 
yourself in this situation.  
 It ’ s important to remember that many changes (for example, Registry 
changes) take place immediately; they do not need to be explicitly applied. 
Once the change is made, it ’ s live. Be careful to plan your changes wisely.  
  Ensure Consistency in Measurements.   When you are monitoring performance, consistency is 
extremely important. You should strive toward having repeatable and accurate measurements. 
Controlling variables, such as system load at various times during the day, can help. 

 Assume, for instance, that you want to measure the number of transactions that you can 
simulate on the accounting database server within an hour. The results would be widely 
different if you ran the test during the month - end accounting close than if you ran the test 
on a Sunday morning. By running the same tests when the server is under a relatively static 
amount of load, you will be able to get more accurate measurements.  
 Maintain a Performance History.   In the introduction to this chapter, we mentioned that 
the performance optimization cycle is a continuous improvement process. Because many 
changes may be made over time, it is important to keep track of the changes you have made 
and the results you have experienced. Documenting this knowledge will help solve similar 
problems if they arise. We understand that many IT professionals do not like to document, 
but documentation can make life much easier in the long run.  
 As you can see, you need to keep a lot of factors in mind when optimizing performance. 
Although this might seem like a lot to digest and remember, do not fear; as systems 
administrators, you will learn some of the rules you need to know to keep your system 
running optimally. Fortunately, the tools included with Windows Server 2008 R2 can help 
you organize the process and take measurements. Now that you have a good overview of 
the process, let ’ s move on to look at the tools you can use to set it in motion.  
 Using Windows Server 2008 R2 
Performance Tools 
 Because performance monitoring and optimization are vital functions in network 
environments of any size, Windows Server 2008 R2 includes several performance - related 
tools. 
 The ﬁ rst and most useful tool is the Windows Server 2008 R2  Reliability and 
Performance Monitor , which was designed to allow users and systems administrators to 
monitor performance statistics for various operating system parameters. Speciﬁ cally, you can 
collect, store, and analyze information about CPU, memory, disk, and network resources 
using this tool, and these are only a handful of the things that you can monitor. By collecting 
and analyzing performance values, systems administrators can identify many potential 
problems. As you ’ ll see later in this chapter, you can also use the Reliability and Performance 
Monitor to monitor the performance of Active Directory and its various components. 
 Here are the two ways in which you can use the Reliability and Performance Monitor:
 Reliability and Performance Monitor ActiveX Control   The Windows Server 2008 R2 
Reliability and Performance Monitor is an ActiveX control that you can place within 
other applications. Examples of applications that can host the Reliability and Performance 
Monitor control include web browsers and client programs like Microsoft Ofﬁ ce ’ s Word 
2010 or Excel 2010. This functionality can make it very easy for application developers and 
systems administrators to incorporate the Reliability and Performance Monitor into their 
own tools and applications. 
Using Windows Server 2008 R2 Performance Tools 
419

420 
Chapter 10 ■ Active Directory Optimization and Reliability
  Reliability and Performance MMC   For more common performance - monitoring 
functions, you ’ ll want to use the built - in Microsoft Management Console (MMC) version 
of the Reliability and Performance Monitor called the Performance Monitor.  
 To access the Reliability and Performance Monitor MMC, you open Computer 
Management in the Administrative Tools program group within your Start menu. This 
launches the Reliability and Performance MMC and loads and initializes the Reliability 
and Performance Monitor with a handful of default counters. 
 You can choose from many different methods of monitoring performance when you are 
using Performance Monitor. A couple of examples are listed here: 
 You can look at a snapshot of current activity for a few of the most important counters; 
this allows you to ﬁ nd areas of potential bottlenecks and monitor the load on your 
servers at a certain point in time. 
 You can save information to a log ﬁ le for historical reporting and later analysis. This 
type of information is useful, for example, if you want to compare the load on your 
servers from three months ago to the current load.  
 You ’ ll get to take a closer look at this method and many others as you examine 
Performance Monitor in more detail. 
 In the following sections, you ’ ll learn about the basics of working with the Windows 
Server 2008 R2 Performance Monitor and other performance tools. Then, you ’ ll apply 
these tools and techniques when you monitor the performance of Active Directory.  
 Your Performance Monitor grows as your system grows, and whenever you 
add services to Windows Server 2008 R2 (such as installing Exchange Server 
2010), you also add to what you can monitor. You should make sure that, as 
you install services, you take a look at what it is you can monitor. 
 Deciding What to Monitor 
 The ﬁ rst step in monitoring performance is to decide  what you want to monitor. In 
Windows Server 2008 R2, the operating system and related services include hundreds of 
performance statistics that you can track easily. All of these performance statistics fall into 
three main categories that you can choose to measure:
  Performance Objects   A performance object within Performance Monitor is a collection 
of various performance statistics that you can monitor. Performance objects are based 
on various areas of system resources. For example, there are performance objects for 
the processor and memory, as well as for speciﬁ c services such as web services. Later 
in this chapter, you ’ ll see how you can use the Windows NT Directory Service (NTDS) 
performance object to monitor performance of Active Directory.  
  Counters   Counters are the actual parameters measured by Performance Monitor. They 
are speciﬁ c items that are grouped within performance objects. For example, within the 
Processor performance object, there is a counter for % Processor Time. This counter 
■
■

displays one type of detailed information about the Processor performance object 
(speciﬁ cally, the amount of total CPU time all of the processes on the system are using).  
 Instances   Some counters will have instances. An instance further identiﬁ es which 
performance parameter the counter is measuring. A simple example is a server with 
two CPUs. If you decide that you want to monitor processor usage (using the Processor 
performance object) — speciﬁ cally, utilization (the %Total Utilization counter) — you must 
still specify  which CPU(s) you want to measure. In this example, you would choose between 
monitoring either of the two CPUs or a total value for both (using the Total instance). 
 Data Collector Sets   Windows Server 2008 R2 Reliability and Performance Monitor 
includes Data Collector Sets. This tool works with performance logs, telling Performance 
Monitor where the logs are stored and when the log needs to run. The Data Collector Sets 
also deﬁ ne the credentials used to run the set.  
 To specify which performance objects, counters, and instances you want to monitor, add 
them to Performance Monitor using the Add Counters dialog box. Figure 10.1 shows the 
various available options when you add new counters to monitor using Performance Monitor.  
 F I G U R E 10.1 Adding a new Performance Monitor counter 
 The items that you will be able to monitor will be based on your hardware and 
software conﬁ guration. For example, if you have not installed and conﬁ gured the Internet 
Information Server (IIS) service, the options available within the Web Server performance 
object will not be available. Or, if you have multiple network adapters or CPUs in the 
server, you will have the option of viewing each instance separately or as part of the total 
value. You ’ ll see which counters are generally most useful later in this chapter.  
Using Windows Server 2008 R2 Performance Tools 
421

422 
Chapter 10 ■ Active Directory Optimization and Reliability
 Viewing Performance Information 
 The Windows Server 2008 R2 Performance Monitor was designed to show 
information in a clear and easy - to - understand format. Performance objects, counters, 
and instances may be displayed in each of three views. This ﬂ exibility allows systems 
administrators to quickly and easily deﬁ ne the information they want to see once and then 
choose how it will be displayed based on speciﬁ c needs. Most likely you will use only one 
view, but it ’ s helpful to know what other views are available depending on what it is you 
are trying to assess. 
 You can use the following main views to review statistics and information on 
performance:
 Graph View   The Graph view is the default display that is presented when you ﬁ rst 
access the Windows Server 2008 R2 Performance Monitor. The chart displays values using 
the vertical axis and time using the horizontal axis. This view is useful if you want to 
display values over a period of time and or see the changes in these values over that time 
period. Each point that is plotted on the graph is based on an average value calculated 
during the sample interval for the measurement being made. For example, you may notice 
overall CPU utilization starting at a low value at the beginning of the chart and then 
becoming much higher during later measurements. This indicates that the server has 
become busier (speciﬁ cally, with CPU - intensive processes). Figure 10.2 provides an example 
of the Graph view. 
 F I G U R E 10. 2 Viewing information in Performance Monitor Graph view 

 A quick way to get to the Performance Console and view Performance 
Monitor is to go to Start   Run and enter  perfmon in the Open box. The 
Performance Console opens directly to Performance Monitor.  
 Histogram View   The Histogram view shows performance statistics and information 
using a set of relative bar charts. This view is useful if you want to see a snapshot of the 
latest value for a given counter. For example, if we were interested in viewing a snapshot of 
current system performance statistics during each refresh interval, the length of each of the 
bars in the display would give us a visual representation of each value. It would also allow 
us to visually compare measurements relative to each other. You can set the histogram to 
display an average measurement as well as minimum and maximum thresholds. Figure 10.3 
shows a typical Histogram view.  
 F I G U R E  10 . 3 Viewing information in Performance Monitor Histogram view 
 Report View   Like the Histogram view, the Report view shows performance statistics 
based on the latest measurement. You can see an average measurement as well as minimum 
and maximum thresholds. This view is most useful for determining exact values because 
Using Windows Server 2008 R2 Performance Tools 
423

424 
Chapter 10 ■ Active Directory Optimization and Reliability
  Resource View  Windows Server 2008 R2 offers a new Resource view screen. This screen 
provides a real - time graphical overview of CPU, disk, network, and memory usage. This 
allows for real - time monitoring of a Windows Server 2008 R2 system. In previous versions 
of Windows, this real - time, process - speciﬁ c data was available only in limited form in Task 
Manager.  
 Managing Performance Monitor Properties 
 You can specify additional settings for viewing performance information within the 
properties of Performance Monitor. You can access these options by clicking the Properties 
button in the taskbar or by right - clicking the Performance Monitor display and selecting 
Properties. You can change these additional settings using the following tabs:
  General Tab   On the General tab (shown in Figure 10.5), you can specify several options 
that relate to Performance Monitor view.  
 F I G U R E 10. 4 Viewing information in Performance Monitor Report view 
it provides information in numeric terms, whereas the Chart and Histogram views provide 
information graphically. Figure 10.4 provides an example of the type of information you ’ ll 
see in the Report view.  

 You can enable or disable legends (which display information about the various 
counters), the value bar, and the toolbar.  
 For the Report and Histogram views, you can choose which type of information is 
displayed. The options are Default, Current, Minimum, Maximum, and Average. 
What you see with each of these options depends on the type of data being collected. 
These options are not available for the Graph view, because the Graph view displays an 
average value over a period of time (the sample interval).  
 You can also choose the graph elements. By default, the display will be set to update 
every second. If you want to update less often, you should increase the number of 
seconds between updates.  
■
■
■
 F I G U R E 10. 5 General tab of the Performance Monitor Properties dialog box 
 Source Tab   On the Source tab (shown in Figure 10.6), you can specify the source for the 
performance information you would like to view. Options include current activity (the 
default setting) or data from a log ﬁ le. If you choose to analyze information from a log ﬁ le, 
you can also specify the time range for which you want to view statistics. We ’ ll cover these 
selections in the next section.   
Using Windows Server 2008 R2 Performance Tools 
425

426 
Chapter 10 ■ Active Directory Optimization and Reliability
  Data Tab  The Data tab (shown in Figure 10.7) displays a list of the counters that have been 
added to Performance Monitor display. These counters apply to the Chart, Histogram, and 
Report views. Using this interface, you can also add or remove any of the counters and change 
properties, such as the width, style, and color of the line, and the scale used for display.  
 F I G U R E 10.6 Source tab of the Performance Monitor Properties dialog box 
 F I G U R E 10.7 The Data tab of the Performance Monitor Properties dialog box 
  Graph Tab  On the Graph tab (shown in Figure 10.8), you can specify certain options 
that will allow you to customize the display of Performance Monitor views. First you can 
specify what type of view you want to see (Line, Histogram Bar, or Report). Then you can 

add a title for the graph, specify a label for the vertical axis, choose to display grids, and 
specify the vertical scale range.  
 F I G U R E  10 . 8 The Graph tab of the Performance Monitor Properties dialog box 
 Appearance Tab   Using the Appearance tab (see Figure 10.9), you can specify the colors 
for the areas of the display, such as the background and foreground. You can also specify 
the fonts that are used to display counter values in Performance Monitor views. You can 
change settings to ﬁ nd a suitable balance between readability and the amount of 
information shown on one screen. Finally, you can set up the properties for a border.  
 F I G U R E 10. 9 The Appearance tab of the Performance Monitor Properties dialog box 
Using Windows Server 2008 R2 Performance Tools 
427

428 
Chapter 10 ■ Active Directory Optimization and Reliability
 Now that you have an idea of the types of information Performance Monitor tracks 
and how this data is displayed, take a look at another feature that you will use to save and 
analyze performance data.  
 Saving and Analyzing Data with 
Performance Logs and Alerts 
 One of the most important aspects of monitoring performance is that it should be done 
over a given period of time (referred to as a baseline). So far, we have discussed how you 
can use Performance Monitor to view statistics in real time. We have, however, also alluded 
to using Performance Monitor to save data for later analysis. Now let ’ s take a look at how 
this is done. 
 When viewing information in Performance Monitor, you have two main options with 
respect to the data on display:
 View Current Activity   When you ﬁ rst open the Performance icon from the Administrative 
Tools folder, the default option is to view data obtained from current system information. 
This method of viewing measures and displays various real - time statistics on the system ’ s 
performance.  
  View Log File Data   This option allows you to view information that was previously saved 
to a log ﬁ le. Although the performance objects, counters, and instances may appear to be 
the same as those you saw using the View Current Activity option, the information itself 
was actually captured at a previous point in time and stored into a log ﬁ le.  
 Log ﬁ les for the View Log File Data option are created in the Performance Logs and 
Alerts section of the Windows Server 2008 R2 Performance tool. 
 One advantage to analyzing logs is using custom views. Custom Views allow you to ﬁ lter 
events to create your own customized look. You can ﬁ lter events by event level (critical, 
error, warning, and so on), by logs, and by source. You also have the ability to view events 
occurring within a speciﬁ c time frame. This allows you to look only at the events that are 
important to you. 
 Three items allow you to customize how the data is collected in the log ﬁ les:
  Counter Logs   Counter logs record performance statistics based on the various 
performance objects, counters, and instances available in Performance Monitor. The values 
are updated based on a time interval setting and are saved to a ﬁ le for later analysis.  
  Circular Logging   In circular logging, the data that is stored within a ﬁ le is overwritten 
as new data is entered into the log. This is a useful method of logging if you only want to 
record information for a certain time frame (for example, the last four hours). Circular 
logging also conserves disk space by ensuring that the performance log ﬁ le will not 
continue to grow over certain limits.  

 Linear Logging   In linear logging, data is never deleted from the log ﬁ les, and new 
information is added to the end of the log ﬁ le. The result is a log ﬁ le that continually grows. 
The beneﬁ t is that all historical information is retained.  
 Now that you have an idea of the types of functions that are supported by the Windows 
Server 2008 R2 Performance tool, let ’ s move on to look at how this information can be 
applied to the task at hand — monitoring and troubleshooting Active Directory.  
 Real - World Performance Monitoring 
 In our daily jobs as systems engineers and administrators, we come across systems 
that need our help — and may even be asking for it. Of course, you check your Event 
Viewer and Performance Monitor and perform other tasks that help you troubleshoot. 
But what is really the most common problem that occurs? From our experience, we ’ d 
say that many times you suffer performance problems if you have your Windows Server 
2008 R2 operating system installed on a subpar system. Either the server hardware 
isn ’ t enterprise class, or the minimum hardware requirements weren ’ t addressed. Most 
production servers suffer from slow response times, lagging, and so on, because money 
wasn ’ t spent where it should have been — on the server ’ s hardware requirements. 
 Take a look at  http://www.microsoft.com/windowsserver2008/en/us/overview.aspx to 
see the minimum Windows Server 2008 R2 requirements. You have to make very sure 
that you follow these minimum requirements. That ’ s not all though; as you will see 
by reading this chapter, most times the minimum requirements are just that — the bare 
minimum and not necessarily good enough, especially if you are running many services 
on your server or you have many network clients who will access the server. 
 Would you drive a truck over a glass bridge? No. Then why would you run an enterprise -
 class server operating system hosting a mission - critical application such as Active 
Directory, email, and messaging on an antiquated desktop system? This seems illogical 
when you read it, but in practice, it ’ s common to ﬁ nd budgets squeezed to the point 
where your secondary domain controller is running on a high - end desktop. Just 
make sure that you consider this when you deploy a new system. Once you deploy it, 
open Performance Monitor and see if you are having issues just opening and running 
programs on the server itself. 
 It ’ s also common to blame the network ﬁ rst, but it is usually not the problem at all. Be 
careful of false positives, and keep your mind focused on ﬁ nding the root of the problem. 
If you come across other problems, document them, but continue to focus on ﬁ nding 
(and ﬁ xing) the real issue. 
Saving and Analyzing Data with Performance Logs and Alerts 
429

430 
Chapter 10 ■ Active Directory Optimization and Reliability
 Monitoring and Troubleshooting Active 
Directory Components 
 Active Directory utilizes many different types of server resources in order to function 
properly. For example, it uses memory to increase the speed of accessing data, CPU time 
to process information, and network resources to communicate with clients and Active 
Directory domain controllers. Additionally, it uses disk space for storing the Active 
Directory data store itself and the Global Catalog (GC). 
 The types and amount of system resources consumed by Active Directory are based on 
many factors. Some of the more obvious ones include the size of the Active Directory data 
store and how many users are supported in the environment. Other factors include the 
replication topology and the domain architecture. As you can see, all of the design issues 
you learned about in earlier chapters will play a role in the overall performance of domain 
controllers and Active Directory. 
 So how do all of these Active Directory requirements impact the server overall? 
Although the answer isn ’ t always simple to determine, Performance Monitor is usually the 
right tool for the job. In the following sections, we ’ ll look at how you can use Windows 
Server 2008 R2 ’ s Performance tool to monitor and optimize the performance of Active 
Directory. 
 Monitoring Domain Controller Performance 
 When it comes to performance, domain controllers have the same basic resource 
requirements as the other machines in your environment. The major areas to monitor for 
computers include the following: 
 Processor (CPU) time 
 Memory  
 Disk I/O (input/output)  
 Disk space  
 Network utilization  
■
■
■
■
■
 If your enterprise - level servers aren ’ t running with Redundant Array of Independent 
Disks (RAID), then you will most likely need an upgrade on your system hardware. Most 
enterprise - level server systems come with RAID as the minimum fault tolerance you 
should have on any server of any size. RAID can help you in a pinch; when you lose a 
disk — and you will, based on the Mean Time Between Failure (MTBF) — you can quickly 
recover with minimal downtime and no loss of data. 

 When you ’ re deciding to monitor performance, you should carefully determine which 
statistics will be most useful. For example, if you ’ re measuring the performance of a 
database server, CPU time and memory may be the most important. However, some 
applications may have high disk I/O and network requirements. Choosing what to monitor 
can be difﬁ cult because so many different options are available. Many times it just takes 
experience and trial and error using various performance objects to learn exactly how 
best to monitor things. This chapter at least starts you on your journey if performance 
monitoring is new to you, and it ﬁ lls you in on how to monitor Active Directory if you are 
already a performance - monitoring guru. 
 Table 10.1 describes some common System Monitor counters and performance objects 
you might want to choose.  
 Performance Object  
  Counter  
  Notes  
 Memory  
  Available MB  
  Displays the number of megabytes of 
physical memory (RAM) available for use by 
processes.  
 Memory  
  Pages/Sec  
  Indicates the number of pages of memory 
that must be read from or written to disk per 
second. A high number may indicate that 
more memory is needed. 
 Network Interface  
  Bytes Total/Sec  
  Measures the total number of bytes sent 
to or received by the specified network 
interface card. 
 Network Interface  
  Packets Received 
Errors  
 Specifies the number of received network 
packets that contain errors. A high number 
may indicate problems with the network 
connection.  
 Network Segment  
  % Net Utilization  
  Specifies the percentage of total network 
resources being consumed. A high value 
may indicate network congestion.* 
 Paging File  
 % Usage  
  Indicates the amount of the Windows virtual 
memory file (paging file) in use. If this is 
a large number, the machine may benefit 
from a RAM upgrade. 
 Physical Disk  
  Disk Reads/Sec Disk 
Writes/Sec  
 Indicates the amount of disk activity on the 
server. 
TA B L E 10.1 Useful counters for monitoring domain controller performance
Monitoring and Troubleshooting Active Directory Components 
431

432 
Chapter 10 ■ Active Directory Optimization and Reliability
  Performance Object  
  Counter  
  Notes  
  Physical Disk  
  Avg. Disk Queue 
Length  
 Indicates the number of disk read or write 
requests that are waiting to access the 
disk. If this value is high, disk I/O could 
potentially be a bottleneck. 
  Processor  
  % Processor Time  
  Indicates the overall CPU load on the server. 
High values generally indicate processor -
 intensive tasks. In machines with multiple 
processors, you can monitor each processor 
individually, or you can view a total value.  
  Server  
  Bytes Total/Sec  
  Specifies the number of bytes sent by the 
Server service on the local machine. A high 
value usually indicates that the server is 
responsible for fulfilling many outbound 
data requests (such as a file/print server). 
  Server  
  Server Sessions  
  Indicates the number of users who may be 
accessing the server. 
  System  
  Processor Queue 
Length  
 Specifies the number of threads that are 
awaiting CPU time. A high number might 
indicate that a reduction in available CPU 
resources is creating a potential bottleneck. 
  System  
  Processes  
  Indicates the number of processes currently 
running on the system. 
  Web Service  
  Bytes Total/Sec  
  Indicates the number of bytes of data that 
have been transmitted to or from the local 
web service. This option is available only 
if IIS is installed and the web server is 
running.  
 *You must have the full version of Network Monitor installed on the local computer in order to view this counter. 
TABLE 10.1 Useful counters for monitoring domain controller performance (continued)
 Keep in mind that this is not by any means a complete list of the items of interest — it ’ s 
just a good guideline for some of the more common items that you may want to include. 
The key to determining what to monitor is to ﬁ rst understand the demands imposed 
by applications or services and then make appropriate choices. When monitored and 
interpreted properly, these performance values can be extremely useful in providing insight 
into overall system performance.  

 Monitoring Active Directory Performance with 
Performance Monitor 
 As you may have already guessed, the Windows Server 2008 R2 operating system 
automatically tracks many performance statistics that are related to Active Directory. You 
can easily access these same statistics by using Performance Monitor. The speciﬁ c counters 
you ’ ll want to monitor are part of the NTDS performance object and are based on several 
different functions of Active Directory, including some of those that follow: 
 The Address Book (AB)  
 The Directory Replication Agent (DRA)  
 The Directory Service (DS)  
 The Lightweight Directory Access Protocol (LDAP)  
 The Security Accounts Manager (SAM)  
 You may ﬁ nd each of these performance objects useful when you are monitoring speciﬁ c 
aspects of Active Directory. The speciﬁ c counters you choose to monitor will depend on 
the aspects of Active Directory performance you ’ re planning to examine. For example, if 
you want to measure performance statistics related to Active Directory replication (covered 
in Chapter 5,  “ Conﬁ guring Sites and Replication ” ), you will probably want to monitor the 
DRA counters. Similarly, if you ’ re interested in performance loads generated by Windows 
NT computers, you will want to monitor the SAM. 
 Perhaps the best way to learn about the various types of performance objects, counters, 
and instances that are related to Active Directory is by actually measuring these values and 
saving them for analysis. Exercise 10.1 walks you through the steps of working with 
various features of the Windows Server 2008 R2 Performance Monitor. In this exercise, 
you will use various features of the Windows Server 2008 R2 Performance Monitor to 
analyze performance information on a Windows Server 2008 R2 domain controller.  
 E X E R C I S E  1 0 .1
Monitoring Domain Controller and Active Directory Performance with 
Windows Server 2008 R2 Performance Monitor 
 1. 
  Open the Reliability and Performance Monitor by selecting Start   Run and entering 
 perfmon . 
 2. 
  In the left pane, right - click Performance Monitor and select New   Data Collector Set. In 
the Name box of the Create New Data Collector Set dialog box, type  Domain Controller 
Performance , and click Next. 
 3. 
  A dialog box showing the location of the saved data appears. This is the location on the 
hard disk where the data will be stored. Keep the defaults and click Next.  
 4. 
  In the Create New Data Collector Set dialog box, make sure the Save And Close radio 
button is selected, and click Finish. 
■
■
■
■
■
Monitoring and Troubleshooting Active Directory Components 
433

434 
Chapter 10 ■ Active Directory Optimization and Reliability
E X E R C I S E  1 0 .1  (c o n t i n u e d)
 5. 
  In the left pane of the Reliability and Performance Monitor, expand Data Collector 
Sets, User Deﬁ ned and click the new collector set you just created (Domain Controller 
Performance). Right - click System Monitor Log in the right pane and choose Properties.  
 6. 
  In the System Monitor Log Properties dialog box, click the Add button.  
 7. 
  In the dialog box that appears, select  < Local Computer >  in the Select Counters From 
Computer drop - down list. Expand the Processor object from the Available Counters list. 
Select the % Processor Time counter and the _Total instance. Note that you can click the 
Show Description box to ﬁ nd more information about the various parameters that are 
available. Click the Add button to add the counter to the Added Counters list. 
 8. 
  When you have ﬁ nished adding these counters, click the OK button to return to the 
System Monitor Log Properties dialog box and view the counters that you selected.  
 9. 
  Click the File tab of the System Monitor Log Properties dialog box. Change the log 
ﬁ lename to  Domain Controller log . Click the Append check box. Click OK. 
 10.   In the left pane of the Reliability and Performance Monitor, right - click the collector set 
Domain Controller Performance. Choose Start.  
 11.   Let the system run for ﬁ ve minutes. During this time, open applications or windows 
on the server. After ﬁ ve minutes, in the left pane of the Reliability and Performance 
Monitor, right - click the collector set Domain Controller Performance. Choose Stop.  
 12.   Right - click the collector set Domain Controller Performance. Choose Latest Report.  
 13.   View the data that was captured. 
 14.   When you have ﬁ nished viewing the captured data, close the Reliability and 
Performance Monitor. 
 It is useful to have a set of Performance Monitor counters saved to ﬁ les so that you 
can quickly and easily monitor the items of interest. For example, you may want to create 
a System Monitor log that includes statistics related to database services while another 
focuses on network utilization. In that way, whenever a performance problem occurs, you 
can quickly determine the cause of the problem (without having to create a System Monitor 
log from scratch).  
 Using Other Performance Monitoring Tools 
 Performance Monitor allows you to monitor various different parameters of the Windows 
Server 2008 R2 operating system and associated services and applications. However, you 
can use three other tools to monitor performance in Windows Server 2008 R2. They are 
 Network Monitor ,  Task Manager , and  Event Viewer . All three of these tools are useful for 

monitoring different areas of overall system performance and for examining details related 
to speciﬁ c system events. In the following sections, we ’ ll take a quick look at these tools 
and how you can best use them. 
 Network Monitor 
 Although Performance Monitor is a great tool for viewing overall network performance 
statistics, it isn ’ t equipped for packet - level analysis and doesn ’ t give you much insight into 
what types of network trafﬁ c are traveling on the wire. That ’ s where the Network Monitor 
tool comes in. There are two main components to the Network Monitor: the Network 
Monitor Agent and the Network Monitor tool itself. 
 The Network Monitor Agent is available with Windows 2000, XP, Server 2003, 
and Server 2008. The agent allows you to track network packets. When you install the 
Network Monitor Agent, you will also be able to access the Network Segment System 
Monitor counter. 
 On Windows Server 2008 R2 computers, you ’ ll see the Network Monitor icon appear in 
the Administrative Tools program group. You can use the Network Monitor tool to capture 
data as it travels on your network.  
 A limited version of Network Monitor is available for free with Windows 
Server 2008 R2. The full version of Network Monitor is available at 
Microsoft ’ s download server. For more information, see  www.microsoft
.com/downloads/ . 
 Once you have captured the data of interest, you can save it to a capture ﬁ le or further 
analyze it using Network Monitor. Experienced network and systems administrators can 
use this information to determine how applications are communicating and the types of 
data that are being passed via the network.  
 For the exam, you don ’ t need to understand the detailed information 
that Network Monitor displays, but you should be aware of the types of 
information that you can view and when you should use Network Monitor.  
 Task Manager 
 Performance Monitor is designed to allow you to keep track of speciﬁ c aspects of system 
performance over time. But what do you do if you want to get a quick snapshot of what 
the local system is doing? Creating a System Monitor chart, adding counters, and choosing 
a view is overkill. Fortunately, the Windows Server 2008 R2 Task Manager has been 
designed to provide a quick overview of important system performance statistics without 
requiring any conﬁ guration. Better yet, it ’ s always readily available. 
Monitoring and Troubleshooting Active Directory Components 
435

436 
Chapter 10 ■ Active Directory Optimization and Reliability
 You can easily access Task Manager in several ways: 
 Right - click the Windows taskbar, and then click Task Manager.  
 Press Ctrl+Alt+Delete, and then select Task Manager.  
 Press Ctrl+Shift+Esc.  
 Each of these methods allows you to quickly access a snapshot of the current system 
performance. 
 Once you access Task Manager, you will see the following six tabs:
 Applications Tab   The Applications tab (see Figure 10.10) shows you a list of the 
applications currently running on the local computer. This is a good place to check to 
determine which programs are running on the system. You can also use this tab to shut 
down any applications whose status is listed as [Not Responding] (meaning either that 
the application has crashed or that it is performing operations and is not responding to 
Windows Server 2008 R2).  
■
■
■
 F I G U R E 10.10 The Applications tab of Task Manager 
  Processes Tab   The Processes tab shows you all of the processes that are currently running 
on the local computer. By default, you ’ ll be able to view how much CPU time and memory 
a particular process is using. By clicking any of the columns, you can quickly sort by the 
data values in that particular column. This is useful, for example, if you want to ﬁ nd out 
which processes are using the most memory on your server. 
 By accessing the performance objects in the View menu, you can add additional columns to 
the Processes tab. Figure 10.11 shows a list of the current processes running on a Windows 
Server 2008 R2 computer.  

 Services Tab   The Services tab (see Figure 10.12) shows you what services are currently 
running on the system. From this location, you can stop a service from running by right -
 clicking the service and choosing Stop. The Services button launches the Services MMC.  
 F I G U R E 10.11 Viewing process statistics and information using Task Manager 
 F I G U R E 10.12 Viewing services information using Task Manager 
 Performance Tab   One of the problems with using Performance Monitor to get a quick 
snapshot of system performance is that you have to add counters to a chart. Most systems 
administrators are too busy to take the time to do this when all they need is basic CPU and 
Monitoring and Troubleshooting Active Directory Components 
437

438 
Chapter 10 ■ Active Directory Optimization and Reliability
memory information. That ’ s where the Performance tab of Task Manager comes in. Using 
the Performance tab, you can view details about how memory is allocated on the computer 
and how much of the CPU is utilized (see Figure 10.13).  
 FIGURE 10.13 Viewing CPU and memory performance information using Task Manager 
  Networking Tab   Like the Performance tab, the Networking tab (see Figure 10.14) displays 
a graph of the current network utilization. The active connections are displayed at the 
bottom of the tab along with their connection speed, percentage of utilization, and status. 
The graph in the top part of the tab displays the percentage of utilization in real time. 
 F I G U R E 10.14 Viewing network information using Task Manager 

 Users Tab   The Users tab (see Figure 10.15) displays a list of the currently active user 
accounts. This is particularly helpful if you want to see who is online and quickly log off 
or disconnect users. You can also send a console message to any remote user in the list 
by clicking the Send Message button. (The button is grayed out in Figure 10.15 because 
you cannot send a message to yourself. If you select a different user, the button will be 
available.)  
 F I G U R E 10.15 Viewing user information using Task Manager 
 As you can see, Task Manager is very useful for quickly providing important 
information about the system. Once you get used to using the Task Manager, you won ’ t be 
able to get by without it!  
 
Make sure you use Task Manager often and familiarize yourself with all 
that it can do; you can end processes that have become intermittent, kill 
applications that may hang the system, view NIC performance, and so on. 
In addition, you can access this tool quickly to get an idea of what could 
be causing you problems. All the performance - monitoring tools (Task 
Manager, Event Viewer, Network Monitor, and Performance Monitor) are 
great at getting granular information on potential problems.  
 Event Viewer 
 Event Viewer is also useful for monitoring Active Directory information. Speciﬁ cally, you 
can use the Directory Service log to view any information, warnings, or alerts related to 
Monitoring and Troubleshooting Active Directory Components 
439

440 
Chapter 10 ■ Active Directory Optimization and Reliability
the proper functioning of the directory services. You can access Event Viewer by selecting 
Start   Programs   Administrative Tools   Event Viewer. Clicking any of the items in the 
left pane displays the various events that have been logged for each item. The contents of 
Directory Service log are shown in Figure 10.16.  
 F I G U R E 10.16 The Directory Service log in Event Viewer 
 Each event is preceded by a blue  “ i ” icon. That icon designates that these events are 
informational and do not indicate problems with the Directory Service. Rather, they record 
benign events such as Active Directory startup or a domain controller ﬁ nding a Global 
Catalog server. 
 Problematic or potentially problematic events are indicated by a yellow Warning icon 
or a red Error icon, both of which are shown in Figure 10.17. Warnings usually indicate 
a problem that wouldn ’ t prevent a service from running but might cause undesired 
effects with the service in question. For example, we were conﬁ guring a site with some 
ﬁ ctional domain controllers and IP addresses. Our local domain controller ’ s IP address 
wasn ’ t associated with any of the sites, and Event Viewer generated a warning. In this 
case, the local domain controller could still function as a domain controller, but the site 
conﬁ guration could produce undesirable results.  

 F I G U R E 10.17 Information, errors, and warnings in Event Viewer 
 Error events almost always indicate a failed service, application, or function. For 
instance, if the dynamic registration of a DNS client fails, Event Viewer generates an error. 
As you can see, errors are more severe than warnings, because in this case the DNS client 
cannot participate in DNS at all. 
 Double - clicking any event opens the event ’ s Properties dialog box, as shown in Figure 10.18. 
The Event Properties dialog box displays a detailed description of the event.  
 F I G U R E 10.18 The Event Properties dialog box 
Monitoring and Troubleshooting Active Directory Components 
441

442 
Chapter 10 ■ Active Directory Optimization and Reliability
 Event Viewer can display thousands of different events, so it would be impossible to list 
them all here. Just be aware that information events are always benign, warnings indicate 
noncritical problems, and errors indicate show - stopping events.  
  Event Viewer Subscriptions   Subscriptions allow a user to receive alerts about events that 
you predeﬁ ne. In the Subscriptions Properties dialog box, you can deﬁ ne what type of 
events you want notiﬁ cations of and the notiﬁ cation method. The Subscriptions section is 
an advanced alerting service to help you watch for events.  
 Troubleshooting Active Directory Performance Monitoring 
 Monitoring performance is not always an easy process. As mentioned earlier, the act of 
performance monitoring can use up system resources. One of the problems that may then 
occur is that Performance Monitor cannot obtain performance statistics and information 
quickly enough. If this occurs, you ’ ll receive an error message. In this case, the suggestion 
is to increase the sample interval. This will reduce the number of statistics Performance 
Monitor has to record and display, and it may prevent the loss of performance information. 
 Sometimes, when you ’ re viewing performance information in the Chart or Histogram 
view, the data is either too small (the bar or line is too close to the baseline) or too large (the 
bar or line is above the maximum value). In either case, you ’ ll want to adjust the scale for 
the counter so that you can accurately see information in the display. For example, if the 
scale for the number of logons is 1 when it displays values from 0 to 100 and you frequently 
have more than 100 users per server, you might want to change the scale to a value less than 1. 
If you choose 1/10, you will be able to accurately see up to 1000 user logons in the Chart 
and Histogram views. You can adjust the scale by right - clicking the Performance Monitor 
display, selecting Properties, and then accessing the Data tab. 
 Backup and Recovery of Active 
Directory 
 If you have deployed Active Directory in your network environment, your users now 
depend on it to function properly in order to do their jobs. From network authentications 
to ﬁ le access to print and web services, Active Directory has now become a mission - critical 
component of your business. Therefore, the importance of backing up the Active Directory 
data store should be evident. As we discussed in earlier chapters, it is important to have 
multiple domain controllers available to provide backup in case of a problem. The same 
goes for Active Directory itself — it too should be backed up by being saved. This way, if a 
massive disaster occurs in which you need to restore your directory services, you will have 
that option available to you. 
 Backups are just good common sense, but here are several speciﬁ c reasons to back up data:
  Protect against Hardware Failures   Computer hardware devices have ﬁ nite lifetimes, and 
all hardware eventually fails. We discussed this when we mentioned MTBF earlier. MTBF 

is the average time a device will function before it actually fails. There is also a rating 
derived from benchmark testing of hard disk devices that tells you when you may be at risk 
for an unavoidable disaster. Some types of failures, such as corrupted hard disk drives, can 
result in signiﬁ cant data loss.  
 Protect against Accidental Deletion or Modification of Data   Although the threat of 
hardware failures is very real, in most environments mistakes in modifying or deleting data 
are much more common. For example, suppose a systems administrator accidentally deletes 
all of the objects within a speciﬁ c OU. Clearly, it ’ s very important to be able to retrieve this 
information from a backup.  
 Keep Historical Information  Users and systems administrators sometimes modify ﬁ les and 
then later ﬁ nd that they require access to an older version of the ﬁ le. Or a ﬁ le is accidentally 
deleted, and a user does not discover that fact until much later. By keeping multiple backups 
over time, you can recover information from prior backups when necessary. 
 Protect against Malicious Deletion or Modification of Data.   Even in the most secure 
environments, it is conceivable that unauthorized users (or authorized ones with malicious 
intent!) could delete or modify information. In such cases, the loss of data might require 
valid backups from which to restore critical information.  
 Windows Server 2008 R2 includes a Backup utility that is designed to back up operating 
system ﬁ les and the Active Directory data store. It allows for basic backup functionality, 
such as scheduling backup jobs and selecting which ﬁ les to back up. Figure 10.19 shows the 
main screen for the Windows Server 2008 R2 Backup utility.  
 F I G U R E 10.19 The main screen of the Windows Server 2008 R2 Backup utility 
Backup and Recovery of Active Directory 
443

444 
Chapter 10 ■ Active Directory Optimization and Reliability
 In the following sections, we ’ ll look at the details of using the Windows Server 2008 R2 
Backup utility and how you can restore Active Directory when problems do occur. 
 Overview of the Windows Server 2008 R2 Backup Utility 
 Although the general purpose behind performing backup operations — protecting 
information — is straightforward, systems administrators must consider many options when 
determining the optimal backup - and - recovery scenario for their environment. Factors 
include what to back up, how often to back up, and when the backups should be performed. 
 In this section, you ’ ll see how the Windows Server 2008 R2 Backup utility makes it easy 
to implement a backup plan for many network environments.  
 Although the Windows Server 2008 R2 Backup utility provides the basic 
functionality required to back up your files, you may want to investigate 
third - party products that provide additional functionality. These 
applications can provide options for specific types of backups (such as 
those for Exchange Server and SQL Server), as well as disaster recovery 
options, networking functionality, centralized management, and support 
for more advanced hardware.  
 Backup Types 
 One of the most important issues you will have to deal with when you are performing 
backups is keeping track of which ﬁ les you have backed up and which ﬁ les you need to back 
up. Whenever a backup of a ﬁ le is made, the Archive bit for the ﬁ le is set. You can view 
the attributes of system ﬁ les by right - clicking them and selecting Properties. By clicking the 
Advanced button on the Properties dialog box, you will access the Advanced Attributes 
dialog box. Here you will see the option Folder Is Ready For Archiving. Figure 10.20 shows 
an example of the attributes for a folder. 
 F I G U R E 10. 2 0 Viewing the Archive attributes for a folder 

 Although it is possible to back up all of the ﬁ les in the ﬁ lesystem during each backup 
operation, it ’ s sometimes more convenient to back up only selected ﬁ les (such as those that 
have changed since the last backup operation). When performing backups, you can back up 
to removable media (such as tape) or to a network location. It is not recommended to do a 
backup to a network location unless absolutely necessary. The reason for this is that if your 
company suffers from a disaster (ﬁ re, hurricane, etc.), your data can all still be lost — including 
the backup. If you back up to a removable media source, a copy of the backup can be taken 
off - site. This protects against a major disaster. Several types of backups can be performed:
 Normal   Normal backups (also referred to as system or full backups) back up all of the 
selected ﬁ les and then mark them as backed up. This option is usually used when a full 
system backup is made. 
 Copy   Copy backups back up all of the selected ﬁ les but do not mark them as backed up. 
This is useful when you want to make additional backups of ﬁ les for moving ﬁ les offsite or 
you want to make multiple copies of the same data for archival purposes.  
 Incremental   Incremental backups  copy any selected ﬁ les that are marked as ready for 
backup (typically because they have not been backed up or they have been changed since 
the last backup) and then mark the ﬁ les as backed up. When the next incremental backup 
is run, only the ﬁ les that are not marked as having been backed up are stored. Incremental 
backups are used in conjunction with normal (full) backups. The most common backup 
process is to make a full backup and then to make subsequent incremental backups. The 
beneﬁ t to this method is that only ﬁ les that have changed since the last full or incremental 
backup will be stored. This can reduce backup times and disk or tape storage space 
requirements. 
 When recovering information from this type of backup method, a systems administrator 
must first restore the full backup and then restore each of the incremental backups.  
 Differential   Differential backups are similar in purpose to incremental backups with one 
important exception: Differential backups copy all ﬁ les that are marked for backup but do 
not mark the ﬁ les as backed up. When restoring ﬁ les in a situation that uses normal and 
differential backups, you need only restore the normal backup and the latest differential 
backup.  
 Daily   Daily backups back up all ﬁ les that have changed during a single day. This 
operation uses the ﬁ le time/date stamps to determine which ﬁ les should be backed up and 
does not mark the ﬁ les as having been backed up.  
 Backing Up System State Data 
 When you are planning to back up and restore Active Directory, be aware that the most 
important component is known as the  System State data . System State data includes the 
components that the Windows Server 2008 R2 operating system relies on for normal 
operations. The Windows Server 2008 R2 Backup utility offers you the ability to back 
up the System State data to another type of media (such as a hard disk or network share). 
Backup and Recovery of Active Directory 
445

446 
Chapter 10 ■ Active Directory Optimization and Reliability
Speciﬁ cally, it will back up the following components for a Windows Server 2008 R2 
domain controller.  
  Active Directory   The Active Directory data store is at the heart of Active Directory. It 
contains all of the information necessary to create and manage network resources, such as 
users and computers. In most environments that use Active Directory, users and systems 
administrators rely on the proper functioning of these services in order to do their jobs.  
 Boot Files   Boot ﬁ les are the ﬁ les required for booting the Windows Server 2008 operating 
system and can be used in the case of boot ﬁ le corruption.  
  COM+ Class Registration Database   The COM+ Class Registration database is a listing 
of all of the COM+ Class registrations stored on the computer. Applications that run on 
a Windows Server 2008 R2 computer might require the registration of various share code 
components. As part of the System State backup process, Windows Server 2008 R2 stores 
all of the information related to Component Object Model+ (COM+) components so that it 
can be quickly and easily restored.  
  Registry   The Windows Server 2008 R2 Registry is a central repository of information 
related to the operating system conﬁ guration (such as desktop and network settings), user 
settings, and application settings. Therefore, the Registry is absolutely vital to the proper 
functioning of Windows Server 2008 R2. 
  SYSVOL Directory   The  SYSVOL directory includes data and ﬁ les that are shared between 
the domain controllers within an Active Directory domain. This information is relied upon 
by many operating system services for proper functioning.  
 Scheduling Backups 
 In addition to specifying which ﬁ les to back up, you can schedule backup jobs to occur at 
speciﬁ c times. Planning  when to perform backups is just as important as deciding what to 
back up. Performing backup operations can reduce overall system performance; therefore, 
you should plan to back up information during times of minimal activity on your servers. 
 To add a backup operation to the schedule, you can simply click the Add button on the 
Specify Backup Time window.  
 Restoring System State Data 
 In some cases, the Active Directory data store or other System State data may become 
corrupt or unavailable. This could be due to many different reasons. A hard disk failure 
might, for example, result in the loss of data. Or the accidental deletion of an OU and all of 
its objects might require a restore operation to be performed. 
 The actual steps involved in restoring System State data are based on the details of what 
has caused the data loss and what effect this data loss has had on the system. In the best 
case, the System State data is corrupt or inaccurate, but the operating system can still boot. 
If this is the case, all that you must do is boot into a special  Directory Services Restore 
Mode (DSRM) and then restore the System State data from a backup. This process will 

replace the current System State data with that from the backup. Therefore, any changes 
that have been made since the last backup will be completely lost and must be redone. 
 In a worst - case scenario, all of the information on a server has been lost or a hardware 
failure is preventing the machine from properly booting. If this is the case, here are several 
steps that you must take in order to recover System State data: 
 1. 
 Fix any hardware problem that might prevent the computer from booting (for example, 
replace any failed hard disks).  
 2. 
  Reinstall the Windows Server 2008 R2 operating system. This should be performed 
like a regular installation on a new system.  
 3. 
  Reinstall any device drivers that may be required by your backup device. If you backed 
up information to the ﬁ lesystem, this will not apply.  
 4. 
  Restore the System State data using the Windows Server 2008 R2 Backup utility.  
 We ’ ll cover the technical details of performing restores later in this section. For now, 
however, you should understand the importance of backing up information and, whenever 
possible, testing the validity of backups.  
 Backing Up and Restoring Group Policy Objects 
 Group Policy objects (GPOs) are a major part of Active Directory. When you back up 
Active Directory, GPOs can also get backed up. You also have the ability to back up GPOs 
through the Group Policy Management Console (GPMC). This gives you the ability to back 
up and restore individual GPOs.  
 The Group Policy Management Console is discussed in detail in Chapter 8, 
 “ Configuring Group Policy Objects. ” 
 To back up all GPOs, open the GPMC and right - click the Group Policy Objects 
container. You will see the option Back Up All. After you choose this option, a wizard will 
start asking you for the backup location. Choose a location and click Backup. 
 To back up an individual GPO, right - click the GPO (in the Group Policy Objects 
container) and choose Backup. Again, after you choose this option, a wizard will start 
asking you for the backup location. Choose a location and click Backup. 
 To restore a GPO, it ’ s the same process as above except instead of choosing Backup, you 
will either choose Manage Backups (to restore all GPOs) or Restore (for an individual GPO).  
 Wbadmin Command - Line Utility 
 Microsoft gives an administrator the ability to back up and restore the operating system, 
volumes, ﬁ les, folders, and applications from a command prompt using the  Wbadmin 
command. The  Wbadmin command replaces the old  ntbackup command that was released 
with previous versions of Windows. The  Wbadmin command can also be helpful when using 
Windows PowerShell. PowerShell gives you the ability to write scripts, and the  Wbadmin 
command can be included when writing these scripts. 
Backup and Recovery of Active Directory 
447

448 
Chapter 10 ■ Active Directory Optimization and Reliability
 When conﬁ guring your backup schedule using  Wbadmin , the account that is conﬁ guring 
the backup schedule must be a member of the Administrators group. Any other tasks 
used with the  Wbadmin command can be done by a member of the Backup Operators or 
the Administrators group. An administrator can also delegate the appropriate permissions 
to a user. 
 When you are using the  Wbadmin command, you must use an elevated command prompt. 
To use an elevated command prompt, just right - click the command prompt and choose Run 
As Administrator.  
 Backing Up Active Directory 
 The Windows Server 2008 R2 Backup utility makes it easy to back up the System data 
(including Active Directory) as part of a normal backup operation. We ’ ve already covered 
the ideas behind the different backup types and why and when they are used. Exercise 10.2 
walks you through the process of backing up the domain controller. In order to complete 
this exercise, the local machine must be a domain controller, and you must have a DVD 
drive to back up the System State.  
 The Windows Server 2008 R2 Backup utility is not installed by default. If 
you have already installed the Windows Server 2008 R2 Backup utility, skip 
to step 5. 
 E X E R C I S E  1 0 . 2
Backing Up Active Directory  
 1. 
  To install the Windows Server 2008 R2 Backup utility, click Start   Administrative 
Tools   Server Manager. In the left pane, click Features. In the right pane, click Add 
Features.  
 2. 
  In the Select Features window, scroll down and check the Windows Server Backup 
check box. Make sure both lower boxes (Windows Server Backup and Command - Line 
Tools) are checked. Click Next.  
 3. 
  On the Conﬁ rm Installation Selections screen, click the Install button. 
 4. 
  After the installation is complete, close Server Manager. 
 5. 
  Open the Backup utility by clicking Start   Administrative Tools   Windows Server 
Backup.  
 6. 
  In the Windows Server Backup utility, click Action   Backup Once. This is how you 
schedule a one - time backup. The Action menu also contains the Backup Schedule (set a 
daily backup time), Recover, and Conﬁ gure Performance Settings commands. 

 7. 
  The Backup Once Wizard appears. Make sure the radio button labeled Different Options 
is checked, and click Next.  
 8. 
  In the Select Items window, click the Custom radio button. Click Next. 
 The Full Server — Recommended option does a complete backup of the system.  
 9. 
  In the Select Items for Backup screen, click the Add Item button. 
 10.   Make sure the boxes labeled System State and System Reserved are checked. Click OK. 
Click Next. 
 11.   In the Specify Location Type screen, choose Local Drives. These options help you 
determine where your backup ﬁ le is going to be stored. Click Next. 
 12.   In the Select Backup Location screen, choose DVD. Click Next.  
 13.   Verify all your choices in the Summary screen and click the Backup button.  
 14.   The Backup Progress screen will show you the status of your backup. Once the backup 
is complete, close the Windows Server 2008 R2 Backup utility. 
 Restoring Active Directory 
 Active Directory has been designed with fault tolerance in mind. For example, it is highly 
recommended by Microsoft that each domain have at least two domain controllers. Each 
of these domain controllers contains a copy of the Active Directory data store. Should one of 
the domain controllers fail, the available one can take over the failed server ’ s functionality. 
When the failed server is repaired, it can then be promoted to a domain controller in the 
existing environment. This process effectively restores the failed domain controller without 
incurring any downtime for end users because all of the Active Directory data is replicated 
to the repaired server in the next scheduled replication. 
 In some cases, you might need to restore Active Directory from a backup. For example, 
suppose a systems administrator accidentally deletes several hundred users from the 
domain and does not realize it until the change has been propagated to all of the other 
domain controllers. Manually re - creating the accounts is not an option because the objects ’ 
security identiﬁ ers will be different (and all permissions must be reset). Clearly, a method 
for restoring from backup is the best solution. You can elect to make the Active Directory 
restore authoritative or nonauthoritative, as described in the following sections. 
 Overview of Authoritative Restore 
 Restoring Active Directory and other System State data is an important process should 
system ﬁ les or the Active Directory data store become corrupt or otherwise unavailable. 
Fortunately, the Windows Server 2008 R2 Backup utility allows you to easily restore data 
from a backup, should the need arise. 
Backup and Recovery of Active Directory 
449

450 
Chapter 10 ■ Active Directory Optimization and Reliability
 We mentioned earlier that in the case of the accidental deletion of information from 
Active Directory, you may need to restore the Active Directory from a recent backup. But 
what happens if there is more than one domain controller in the environment? Even if you 
did perform a restore, the information on this domain controller would be seen as outdated 
and it would be overwritten by the data from another domain controller. This data from 
the older domain controller is exactly the information you want to replace. The domain 
controller that was reloaded using a backup would have an older timestamp, and the other 
domain controllers would re - delete the information from the backup. 
 Fortunately, Windows Server 2008 R2 and Active Directory allow you to perform 
what is called an  authoritative restore . The authoritative restore process speciﬁ es a 
domain controller as having the authoritative (or master) copy of the Active Directory data 
store. When other domain controllers communicate with this domain controller, their 
information will be overwritten with Active Directory data stored on the local machine. 
 Now that you have an idea of how an authoritative restore is supposed to work, let ’ s 
move on to looking at the details of performing the process.  
 Performing an Authoritative Restore 
 When you are restoring Active Directory information on a Windows Server 2008 R2 
domain controller, make sure Active Directory services are not running. This is because 
the restore of System State data requires full access to system ﬁ les and the Active Directory 
data store. If you attempt to restore System State data while the domain controller is active, 
you will see the error message. 
 In general, restoring data and operating system ﬁ les is a straightforward process. 
It is important to note that restoring a System State backup will replace the existing 
Registry, SYSVOL, and Active Directory ﬁ les, so any changes you made since the last 
backup will be lost. 
 In addition to restoring the entire Active Directory database, you can also restore 
just speciﬁ c subtrees within Active Directory using the  restoresubtree command in the 
 ntdsutil utility. This allows you to restore speciﬁ c information and is useful in the case of 
an accidental deletion of isolated material. 
 Following the authoritative restore process, Active Directory should be updated to the 
time of the last backup. Furthermore, all other domain controllers for this domain will 
have their Active Directory information overwritten by the results of the restore operation. 
The result is an Active Directory environment that has been recovered from media.  
 Overview of Nonauthoritative Restore 
 Now that you understand why you would use an authoritative restore and how it is 
performed, it ’ s an easy conceptual jump to understand what a nonauthoritative restore is. 
Remember that by making a restore authoritative, you are simply telling other domain 
controllers in the domain to recognize the restored machine as the newest copy of Active 
Directory for replication purposes. If you only have one domain controller, the authoritative 
restore process becomes moot; you can simply skip the steps required to make the restore 
authoritative and begin using the domain controller immediately after the normal restore is 
complete. 

 If you have more than one domain controller in the domain and you need to perform a 
nonauthoritative restore, simply allow the domain controller to receive Active Directory 
database information from other domain controllers in the domain using normal 
replication methods.  
 Active Directory Recycle Bin 
 Windows Server 2008 R2 offers a new feature called the Active Directory Recycle Bin. The 
Active Directory Recycle Bin allows you to preserve and restore accidentally deleted Active 
Directory objects without the need of using a backup. 
 The Active Directory Recycle Bin works for both the Active Directory Domain Services 
and the Active Directory Lightweight Directory Services (AD LDS) environments. 
 One problem that we have all faced is the deletion of an object that was not supposed 
to be deleted. The problem here is that when you delete a security object from Active 
Directory, the object ’ s Security ID (SID) gets removed. All users ’  rights and permissions are 
associated to the users ’ SID number and not their account name. 
 By enabling (disabled by default) the Active Directory Recycle Bin, any deleted Active 
Directory objects are preserved and Active Directory objects can be restored, in their 
entirety, to the same condition that they were in immediately before deletion. This means 
that all group memberships and access rights that the object had before deletion will 
remain intact. 
 To enable the Active Directory Recycle Bin you must do the following (you must be a 
member of the Schema Admins group): 
 Run the  adprep /forestprep command, to prepare the forest, on the server that holds 
the schema master to update the schema.  
 Run the  adprep /domainprep /gpprep command, to prepare the domain, on the server 
that holds the infrastructure operations master role.  
 If a read - only domain controller (RODC) is present in your environment, you must 
also run the  adprep /rodcprep command.  
 Make sure all domain controllers in your Active Directory forest are running Windows 
Server 2008 R2.  
 Make sure the forest functional level is set to Windows Server 2008 R2.  
 Restartable Active Directory 
 Administrators have the ability to stop and restart Active Directory in the Windows Server 
2008 R2 operating system without the need of rebooting the entire system. Administrators 
can perform these actions by using either the Microsoft Management Console (MMC) 
snap - ins or the command line. 
 With Restartable Active Directory Services, an administrator has the ability to stop 
Active Directory Services so that updates and other tasks can be applied to a domain 
■
■
■
■
■
Backup and Recovery of Active Directory 
451

452 
Chapter 10 ■ Active Directory Optimization and Reliability
controller. One task that an administrator can perform while Active Directory is stopped is 
an ofﬂ ine defragmentation of the database. 
 One of the advantages to a Restartable Active Directory is that other services running 
on the same server do not depend on Active Directory continue to function properly while 
Active Directory is stopped. An administrator has the ability to stop and restart the Active 
Directory Domain Services in the Local Services MMC snap - in.  
 Offline Maintenance 
 As you have seen in the last section, there are times when you have to be ofﬂ ine to do 
maintenance. For example, you need to perform authoritative and nonauthoritative restores 
while the domain controller is ofﬂ ine. The main utility we use for ofﬂ ine maintenance is 
 ntdsutil . 
 NTDSUtil.exe  
 The primary method by which systems administrators can do ofﬂ ine maintenance is 
through the  ntdsutil command - line tool. You can launch this tool by simply entering 
   ntdsutil  at a command prompt. The  ntdsutil command is both interactive and context 
sensitive. That is, once you launch the utility, you ’ ll see an  ntdsutil command prompt. At 
this prompt, you can enter various commands that set your context within the application. 
For example, if you enter   domain management  , you ’ ll be able to enter in domain - related 
commands. Several operations also require you to connect to a domain, a domain 
controller, or an Active Directory object before you perform a command. 
 Table 10.2 provides a list of the domain - management commands supported by the 
 ntdsutil tool. You can access this functionality by typing the command at a command 
prompt.  
 TA B L E 10. 2  ntdsutil  offline maintenance commands 
 ntdsutil  Domain Management 
Command 
  Purpose 
  Help or  ? 
  Displays information about the commands that are 
available within the Domain Management menu of the 
 ntdsutil utility.  
  compact to (at the file 
maintenance prompt) 
 Allows you to compact the Active Directory database 
(offline defragmentation).  
  metadata cleanup 
  Removes metadata from decommissioned domain 
controllers.  
  Set DSRM Password 
  Resets the Directory Service Restore mode 
Administrator account password. 

 Active Directory Database Mounting Tool 
 One issue that an administrator may run into when trying to restore Active Directory is 
the need to restore several backups to compare the Active Directory data that each backup 
contains. Windows Server 2008 R2 has a utility called the Active Directory database 
mounting tool ( Dsamain.exe ), which can resolve this issue. 
 The  Dsamain.exe tool can help the recovery processes by giving you a way to compare 
data as it exists in snapshots (the snapshots are taken at different times) so that you have 
the ability to decide which Active Directory database to restore. 
 Creating snapshots on a regular basis will allow you to have enough data so that you 
can keep accurate records of how the Active Directory database changes over time. The 
 ntdsutil utility allows you to take snapshots by using the  ntdsutil snapshot operation.  
 
You are not required to run the  ntdsutil snapshot operation to use 
 Dsamain.exe . You have the ability to use a backup of the Active Directory 
database.  
 You must be a member of the Domain Admins group or the Enterprise Admins group 
to view any snapshots taken due to the fact that these snapshots contain sensitive Active 
Directory data.  
 Compact the Directory Database File (Offline Defragmentation) 
 One task that all of us having been doing for years is the process of defragging the 
operating systems that we run. We have used the defragmentation utility since Windows 
NT. Defragging a system helps return free space from data to the hard drive. 
 You can also use the defragmentation process to compact the Active Directory database 
while it ’ s ofﬂ ine. Ofﬂ ine defragmentation helps return free disk space and check Active 
Directory database integrity. 
 To perform an ofﬂ ine defragmentation, you would use the  ntdsutil command. When 
you perform a defragmentation of the Active Directory database, a new compacted version 
of the database is created. This new database ﬁ le can be created on the same machine (if 
space permits) or on a network location. After the new ﬁ le is created, copy the compacted 
 Ntds.dit ﬁ le back to the original location. 
 It is a good practice, if space allows, to maintain a copy of the older, original database 
ﬁ le. You can either rename the older database ﬁ le and keep it in its current location or copy 
the older database ﬁ le to an alternate location.  
 Monitoring Replication 
 At times you may need to keep an eye on how your replication trafﬁ c is working on your 
domain controllers. We are going to examine the replication utilities that you can use to 
help determine problems on your domain. 
Backup and Recovery of Active Directory 
453

454 
Chapter 10 ■ Active Directory Optimization and Reliability
 RepAdmin Utility 
 The  RepAdmin utility is included when you install Windows Server 2008 R2. This 
command - line tool helps administrators diagnose replication problems between Windows 
domain controllers. 
 RepAdmin can allow administrators to view the replication topology of each domain 
controller as seen from the domain controller ’ s perspective. Administrators can also use 
 RepAdmin to manually create the replication topology. By manually creating the replication 
topology, administrators can force replication events between domain controllers and view 
the replication metadata vectors. 
 To access the  RepAdmin utility, open a command prompt using an elevated privilege 
(Run   CMD). At the command prompt, type   RepAdmin.exe  , and all the available options 
will appear.  
 Using the ADSI Editor 
 Another utility that allows you to manage objects and attributes in Active Directory is the 
Active Directory Service Interfaces Editor (ADSI Edit). In Chapter 9,  “ Planning Security for 
Active Directory, ” we used ADSI Edit ( adsiedit.msc ) to create multiple password policies 
to allow for ﬁ ne - grained password policies. ADSI Edit allows you to view every object and 
attribute in an Active Directory forest. 
 One advantage to using the  Adsiedit.msc MMC snap - in is that this tool allows you to 
query, view, create, and edit attributes that are not exposed through other Active Directory 
Microsoft Management Console (MMC) snap - ins. 
 ADSI Edit allows you to administer an AD LDS instance. To do this, you must ﬁ rst 
connect and bind to the instance. After you connect and bind to the instance, you can 
administer the containers and objects within the instance by browsing to the containers or 
objects and then right - clicking them. To complete this task, you must be a member of the 
Administrators group for the AD LDS instance.  
 Summary 
 Although the tasks related to performance optimization and ensuring reliability of 
Active Directory domain controllers are only a small part of the seemingly endless tasks 
performed by systems administrators, they are very important in the overall health of a 
network environment. In this chapter, we covered many aspects associated with optimizing 
Active Directory and making it reliable. We showed you how to use many tools that can 
help you monitor and manage your systems, and we discussed the basics of troubleshooting 
Active Directory in times of problems or disaster. 
 It is imperative that you monitor performance on domain controllers in order to root out 
any issues that may affect your systems. If your systems are not running optimally, your 
end users may experience issues such as latency, or worse, you may experience corruption 

in your Active Directory database. Either way, it ’ s important to know how to monitor 
the performance of domain controllers. In this chapter, we also looked at ways systems 
administrators can optimize the operations of domain controllers to ensure that end users 
enjoy adequate performance. 
 We also looked at how to use the various performance - related tools that are included 
with Windows Server 2008 R2. Tools such as the Performance Monitor utility, Task 
Manager, Network Monitor, and Event Viewer can help you diagnose and troubleshoot 
system performance issues. As an administrator, you will often use these tools and they 
will deﬁ nitely help you ﬁ nd typical problems related to memory, disk space, and any other 
hardware - related issues you may experience. Knowing how to use tools to troubleshoot and 
test your systems is imperative not only to passing the exam but also to performing your 
duties at work. In order to have a smoothly running network environment, it is vital that 
you understand the issues related to the reliability and performance of Active Directory and 
domain controllers. 
 We also covered the details of performing backups, the most commonly used form 
of reliability you can implement. You learned how to back up and restore System State 
data using the Windows Server 2008 R2 Backup utility. Through the use of wizards and 
prompts, this backup tool can simplify an otherwise tedious process. Knowing how to 
restore System State data and the Active Directory database can really put you a cut above 
the rest, especially in times of disaster. By using the authoritative restore functionality, you 
can revert all or part of an Active Directory environment back to an earlier state.  
 Exam Essentials  
 Understand the methodology behind troubleshooting performance.   By following a set 
of steps that involve making measurements and ﬁ nding bottlenecks, you can perform 
systematic troubleshooting of performance problems.  
 Be familiar with the features and capabilities of the Windows Server 2008 R2 Performance 
Monitor tool for troubleshooting performance problems.   Using the Performance 
administrative tool is a very powerful method for collecting data about all areas of system 
performance. Through the use of performance objects, counters, and instances, you 
can choose to collect and record only the data of interest and use this information for 
pinpointing performance problems.  
 Know the importance of common performance counters.   Several important performance -
 related counters deal with general system performance. Know the importance of 
monitoring memory, CPU, and network usage on a busy server.  
 Understand the role of other troubleshooting tools.   Windows Task Manager, Network 
Monitor, and Event Viewer can all be used to diagnose and troubleshoot conﬁ guration - 
and performance - related issues.  
 Understand how to troubleshoot common sources of server reliability problems.  
 Windows Server 2008 R2 has been designed to be a stable, robust, and reliable operating 
Exam Essentials 
455

456 
Chapter 10 ■ Active Directory Optimization and Reliability
system. Should you experience intermittent failures, you should know how to troubleshoot 
device drivers and buggy system - level software.  
  Understand the various backup types available with the Windows Server 2008 R2 Backup 
utility.   The Windows Server 2008 R2 Backup utility can perform full and incremental 
backup operations. Some third - party backup utilities also support differential and daily 
backups. You can use each of these operations as part of an efﬁ cient backup strategy.  
  Know how to back up Active Directory.   The data within the Active Directory database 
on a domain controller is part of the System State data. You can back up the System State 
to a ﬁ le using the Windows Server 2008 R2 Backup utility.  
  Know how to restore Active Directory.   Restoring the Active Directory database is 
considerably different from other restore operations. In order to restore some or all of 
the Active Directory database, you must ﬁ rst boot the machine into Directory Services 
Restore mode.  
  Understand the importance of an authoritative restore process.   You use an authoritative 
restore when you want to restore earlier information from an Active Directory backup 
and you want the older information to be propagated to other domain controllers in the 
environment.  
 Understand offline maintenance using  ntdsutil .  The  ntdsutil command - line tool is a 
primary method by which systems administrators perform ofﬂ ine maintenance. Understand 
how to launch this tool by entering   ntdsutil  at a command prompt.  

Review Questions 
457
 Review Questions  
 1. 
  You are the network administrator for an organization that has all Windows Server 2008 
R2 domain controllers. You need to capture all replication errors that occur between all 
domain controllers. What should you do?  
 A.   Use System Performance data collector sets.  
 B.   Use  ntdsutil . 
 C.   Configure event log subscriptions.  
 D.   Use the ADSI Edit tool.  
 2. 
  You are one of two network administrators for your organization. Your IT partner does 
most of the work in Active Directory. While working in Active Directory, your partner 
accidently deleted a user from the Sales OU. You recover the user from tape backup but you 
want to help prevent this from happening again in the future. What can you do?  
 A.   Enable the Active Directory Recycle Bin.  
 B.   Use ADSI Edit to restore the user.  
 C.   Take away all rights from the other administrator.  
 D.   Use the Directory Services Restore Mode Lockout command.  
 3. 
 You are the network administrator for a midsize organization with a single Windows 
Server 2008 R2 domain controller. The domain controller has the backup features installed 
and enabled. You need to perform a nonauthoritative restore of the domain controller using 
an existing backup file. How can you accomplish your goal?  
 A.   Boot into Safe mode and use the Windows Server Backup restore.  
 B.   Boot into Directory Services Restore mode and use the  ntdsutil.exe  nonauthoritative 
restore command.  
 C.   Boot into Directory Services Restore mode and use the  Wbadmin  utility to restore 
critical volume.  
 D.   Boot into Safe mode and use the  Wbadmin  utility to restore critical volume.  
 4. 
  Following an authoritative restore of the entire Active Directory database, what will 
happen to the copies of Active Directory on other domain controllers for the same domain?  
 A.   The copies of Active Directory on other domain controllers will be overwritten.  
 B.   The information on all domain controllers will be merged.  
 C.   The other domain controllers will be automatically demoted.  
 D.   The copies of Active Directory on the restored domain controller will be overwritten.  

458 
Chapter 10 ■ Active Directory Optimization and Reliability
  5. 
  You are the network administrator for an organization that runs Windows Server 2008 
R2 domain controllers. Your company has a Windows Server 2008 R2 server that runs an 
instance of the Active Directory Lightweight Directory Services (AD LDS). You need to 
create a new OU in the AD LDS application directory partition. What do you need to do to 
accomplish this task?  
 A.   Use the AD LDS snap - in to create the new OU. 
 B.   Use the AD LDS  add command to create the new OU. 
 C.   Use  ntdsutil  to create the OU on the AD LDS application directory partition.  
 D.   Use the ADSI Edit snap - in to create the OU on the AD LDS application directory 
partition.  
 6. 
 You have just been hired by the ABC Company to take over all of their Active Directory 
tasks. The IT administrator who installed Active Directory is no longer with the company. 
It is your job to restore Active Directory in the event of a failure. You do not know the 
Directory Services Recovery Mode (DSRM) password. How do you reset the DSRM 
password?  
 A.   ADSI Edit  
 B.   ntdsutil 
 C.   Active Directory Users and Computers  
 D.   Active Directory Sites and Services  
 7. 
  What utility is a command - line tool that helps administrators diagnose replication 
problems between Windows domain controllers?  
 A.   RepAdmin 
 B.   RepWatch 
 C.   RepUtility 
 D.   RepAlert 
 8. 
  A systems administrator boots the operating system using the Directory Services Restore 
Mode (DSRM). He attempts to log in using a Domain Administrator account but is unable 
to do so. What is the most likely reason for this?  
 A.   The account has been disabled by another domain administrator.  
 B.   The permissions on the domain controller do not allow users to log on locally.  
 C.   The Active Directory service is unavailable, and he must use the DSRM password.  
 D.   Another domain controller for the domain is not available to authenticate the login.  

Review Questions 
459
 9. 
  Which of the following types of backup operations should a systems administrator use to 
back up all of the files that have changed since the last full backup or incremental backup 
and to mark these files as having been backed up?  
 A.   Differential  
 B.   Copy  
 C.   Incremental  
 D.   Normal  
 10.   Which of the following  ntdsutil  commands is used to perform an authoritative restore of 
the entire Active Directory database?  
 A.   restore active directory 
 B.   restore database 
 C.   restore subtree 
 D.   restore all 

460 
Chapter 10 ■ Active Directory Optimization and Reliability
 Answers to Review Questions 
1. 
 C .  Event log subscriptions allow a user to receive alerts about events that you predeﬁ ne. 
In the Subscriptions Properties dialog box, you can deﬁ ne what type of events you want 
notiﬁ cations of and the notiﬁ cation method. The Subscriptions section is an advanced 
alerting service to help you watch for events. 
2. 
 A .  The Active Directory Recycle Bin allows you to preserve and restore accidentally deleted 
Active Directory objects without the need of using a backup. 
3. 
 C .  The  Wbadmin  command allows an administrator to back up and restore an operating 
system, volumes, ﬁ les, folders, and applications from a command prompt. When restoring 
Active Directory, you must enter the Directory Services Restore mode. 
4. 
 A .  In an authoritative restore of the entire Active Directory database, the restored copy will 
override information stored on other domain controllers. 
5. 
 D .  AD LDS is a lightweight implementation of Active Directory. ADSI Edit allows you to 
administer an AD LDS instance. You can administer the containers and objects within the 
instance by browsing to the containers or objects and then right - clicking them. ADSI Edit 
also allows you to create objects in the AD LDS instance. 
6. 
 B .  One of the tasks that you can perform with the  ntdsutil  command is to reset the 
Directory Services Recovery Mode password. 
7. 
 A .  The  RepAdmin  command - line tool is included when you install Windows Server 2008 
R2.  RepAdmin  helps administrators diagnose replication problems between Windows 
domain controllers. 
8. 
 C .  When booting in Directory Services Restore Mode (DSRM), Active Directory is not 
started, and network services are disabled. Therefore, the systems administrator must use 
the DSRM password in order to log in. 
9. 
 C .  Incremental backup operations copy ﬁ les and mark them as having been backed up. 
Therefore, a systems administrator uses them when they want to back up only the ﬁ les that 
have changed since the last full or incremental backup. Differential backups, although they 
will also back up only ﬁ les that were created or changed since the last full or incremental 
backup, will not mark the ﬁ les as having been backed up. 
10.  B .  The  restore database command instructs the  ntdsutil  application to perform an 
authoritative restore of the entire Active Directory database. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 

MCTS: Windows 
Server 2008 
R2 Network 
Infrastructure 
Configuration 
(Exam 70-642)
PART 
II


Understanding 
Windows Server 2008 
R2 Networking  
 Chapter 
11

 Microsoft has put an immense amount of time and effort 
into building Windows Server 2008 R2. Much is new in the 
operating system, but it still retains a great deal of core code 
from Windows 2003, Internet Information Services, and Exchange Server. Windows Server 
2008 R2 is a large, complicated, and very powerful operating system. To use it effectively, 
you have to understand how it works and how to make it do what you want it to do. 
 This part of the book is a study guide for the Microsoft Windows Server 2008 R2 exam 
70 - 642. So, it only makes sense to start with a discussion of network protocols and which 
protocols have been included and removed in Windows Server 2008 R2. 
 Having a good frame of reference helps when discussing network protocols. To establish 
such a framework, this chapter will start with the OSI network model, a sort of idealized 
way to stack various protocols together. Then the chapter will cover the different Microsoft 
Windows network models and which one would work best for your company. 
 While discussing these topics, we will cover the necessary background information in 
order for you to be successful on the 70 - 642 exam as well as work with Windows Server 
2008 R2 on the network.  
 This chapter talks about networking in general, and Microsoft will not 
ask any questions about basic networking and the OSI model. We start 
with this chapter so that you can understand how protocols and services 
work with Microsoft. This will help lay the foundation for the rest of 
the book.  
 Understanding the OSI Model 
 The International Organization for Standardization (ISO) began developing the Open Systems 
Interconnection (OSI) reference model in 1977. OSI has since become the most widely 
accepted model for understanding network communication; once you understand how the 
OSI model works, you can use it to compare network implementations on different systems. 
 When you want to communicate with another person, you need to have two things in 
common: a communication language and a communication medium. Computer networks 
are no different; for communication to take place on a network composed of a variety of 
different network devices, both the language and the medium must be clearly deﬁ ned. The 
OSI model (and networking models developed by other organizations) attempts to deﬁ ne 
rules that cover both the generalities and the speciﬁ cs of networks: 

 How network devices contact each other and, if they have different languages, how 
they communicate with each other  
 Methods by which a device on a network knows when to transmit data and when not 
to transmit it  
 Methods to ensure that network transmissions are received correctly and by the right 
recipient  
 How the physical transmission media is arranged and connected  
 How to ensure that network devices maintain a proper rate of data ﬂ ow  
 How bits are represented on the network media  
 The OSI model isn ’ t a product. It ’ s just a conceptual framework you can use to better 
understand the complex interactions taking place among the various devices on a network. 
It doesn ’ t do anything in the communication process; appropriate software and hardware 
do the actual work. The OSI model simply deﬁ nes which tasks need to be done and which 
protocols will handle those tasks at each of the seven layers of the model. The seven layers 
are as follows: 
 Application (layer 7)  
 Presentation (layer 6)  
 Session (layer 5)  
 Transport (layer 4)  
 Network (layer 3)  
 Data - Link (layer 2)  
 Physical (layer 1)  
 You can remember the seven layers from top to bottom using a handy 
mnemonic, such as  “ All People Seem To Need Data Processing. ” 
 Each of the seven layers has a distinct function, which we ’ ll explore a little later in the 
chapter. 
■
■
■
■
■
■
■
■
■
■
■
■
■
 The True IP Suite 
 There is another model to represent these same concepts that is truly what the Internet 
was built upon. The model is known by a few names, including the TCP/IP model, the IP 
model, or the DoD model (after its designers, the U.S. Department of Defense). The TCP/
IP model, as we ’ ll call it, contains only four layers: 
 Application  
 Transport (sometimes called Host to Host) 
■
■
Understanding the OSI Model 
465

466 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 Internet  
 Link (also called Network Access) 
 This model was the one originally used for the design of the Internet. You won ’ t 
encounter this model on the 70 - 642 exam, but as a network administrator, you should 
know that this model exists when you hear your peers talking about it. 
■
■
 Protocol Stacks 
 The OSI model splits communication tasks into smaller pieces called  subtasks . Protocol 
implementations are computer processes that handle these subtasks. Speciﬁ c protocols fulﬁ ll 
subtasks at speciﬁ c layers of the OSI model. When these protocols are grouped together to 
complete a whole task, the assemblage of code is called a  protocol stack . The stack is just a 
group of protocols, arranged in layers, that implements an entire communication process. 
Each layer of the OSI model has a different protocol associated with it. When more than one 
protocol is needed to complete a communication process, the protocols are grouped together 
in a stack. An example of a protocol stack is TCP/IP, which is widely used by Unix and the 
Internet — TCP and IP are implemented at different OSI layers. 
 Windows Server 2008, Windows Server 2008 R2, Windows Vista, and 
Windows 7 include the Next Generation TCP/IP Stack, which is for both 
version 4 (IPv4) and version 6 (IPv6) of the Internet Protocol. 
 Why You Should Care about Protocol Stacks 
 It may not be incredibly clear right now why you should care about protocol stacks 
and the OSI model. However, the OSI model and the protocol stacks for Internet 
communication are the basis upon which the 70 - 642 exam is built. All things about 
today ’ s modern network stem from either the OSI or IP model. 
 Knowing the layers of both models is essential to sound troubleshooting, and though it 
may not be obvious as you trudge through this background material, knowing the OSI 
model will help when managing a Windows network. You ’ ll see additional examples of 
how knowing the OSI model helps when troubleshooting throughout this chapter. 
  Each layer in the protocol stack receives services from the layer below it and provides 
services to the layer above it. It can be better explained like this: layer N uses the services of 
the layer below it (layer N  – 1) and provides services to the layer above it (layer N   1). 

 For two computers to communicate, the same protocol stacks must be running on each 
computer. Each layer on both computers ’ stacks must use compatible protocols in order for 
the machines to communicate with each other. The computers can have different operating 
systems and still be able to communicate if they are running the same protocol stacks (see 
Figure 11.1).  
Layer 7
Application
DOS
Macintosh
Layer 6
Layer 5
Layer 4
Layer 3
Layer 2
Layer 1
Presentation
Session
Peer communication
Information ﬂow
Network medium
Transport
Network
Data-Link
Physical
Application
Presentation
Session
Transport
Network
Data-Link
Physical
7
6
5
4
3
2
1
 F I G U R E 11.1 Each layer communicates with its counterparts on other network hosts. 
 When sending data, each layer in the OSI model places its own information onto the 
data as it passes down the stack in a process called  encapsulation . Encapsulation takes 
place when each layer adds its own header and sometimes trailer information onto the 
data. When the data is received, it works its way back up the protocol stack, and the 
corresponding layer of the protocol stack reads this information. 
 The Physical Layer 
 The Physical layer is responsible for using electric (or sometimes other types of) signaling to 
get bits from one computer to another. Physical layer components don ’ t care what the bits 
 mean ; their job is to get the bits from point A to point B, using whatever kind of optical, 
electrical, or wireless connection that connects the points. This level deﬁ nes physical 
and electrical details, such as what will represent a 1 or a 0, how many pins a network 
connector will have, and when the network adapter can or cannot transmit the data (see 
Figure 11.2).  
Understanding the OSI Model 
467

468 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 The Physical layer addresses all the small details of the actual physical connection 
between the computer and the network medium, including the following: 
 Network connection types, including multipoint and point - to - point connections.  
 Physical topologies, or how the network is physically laid out (for example, bus, star, 
or ring).  
 Which analog and digital signaling methods are used to encode data in the analog and 
digital signals.  
 Bit synchronization, which deals with keeping the sender and receiver in sync as they 
read and write data.  
 Multiplexing, or the process of combining several data channels into one.  
 Termination, which prevents signals from reﬂ ecting back through the cable and 
causing signal and packet errors. It also indicates the last node in a network segment.  
 The Data - Link Layer 
 The Data - Link layer provides for the ﬂ ow of data over a single physical link from one 
device to another. It accepts packets from the Network layer and packages the information 
into data units called  frames ; these frames are presented to the Physical layer for 
transmission. The Data - Link layer adds control information, such as the frame type, to the 
data being sent. 
 This layer also provides for the error - free transfer of frames from one computer to 
another. A  cyclic redundancy check (CRC) added to the data frame can detect damaged 
frames, and the Data - Link layer in the receiving computer can request that the CRC 
information be present so that it can check incoming frames for errors. The Data - Link 
layer can also detect when frames are lost and request that those frames be sent again. 
 In broadcast networks such as Ethernet, all devices on the LAN receive the data that 
any device transmits. (Whether a network is broadcast or point - to - point is determined by 
the network protocols used to transmit data over it.) The Data - Link layer on a particular 
device is responsible for recognizing frames addressed to that device and throwing the rest 
away, much as you might sort through your daily mail to separate good stuff from junk. 
Figure 11.3 shows how the Data - Link layer establishes an error - free connection between 
two devices. 
■
■
■
■
■
■
1. Physical layer
1. Physical layer
Physical circuit
Electrical, optical,
or radio signals
 F I G U R E 11. 2 The Physical layer makes a physical circuit with electrical, optical, or 
radio signals. 

 The Institute of Electrical and Electronics Engineers (IEEE) developed a protocol 
speciﬁ cation known as IEEE 802.X. (802.2 is the standard that divides this layer into two 
sublayers. The Media Access Control layer, more commonly called the MAC layer, varies 
depending on the network type and is described further in standards 802.3 through 802.5.) 
As part of that speciﬁ cation (which today we know as Ethernet), the Data - Link layer is split 
into two sublayers: 
 The Logical Link Control (LLC) layer establishes and maintains the logical communi-
cation links between the communicating devices.  
 The Media Access Control (MAC) layer acts like an airport control tower — it controls 
the way multiple devices share the same media channel in the same way that a control 
tower regulates the ﬂ ow of air trafﬁ c into and out of an airport.  
 Figure 11.4 illustrates the division of the Data - Link layer into the LLC and MAC layers.  
■
■
2. Data-Link layer
1. Physical layer
1. Physical layer
2. Data-Link layer
Error-free
data link
Physical circuit
 F I G U R E  11. 3 The Data - Link layer establishes an error - free link between two devices. 
7. Application layer
6. Presentation layer
5. Session layer
4. Transport layer
3. Network layer
Logical Link
Control sublayer
Media Access
Control sublayer
2. Data-Link layer
1. Physical layer
 F I G U R E 11. 4 The IEEE split the ISO Data - Link layer into the LLC sublayer and the MAC 
sublayer. 
Understanding the OSI Model 
469

470 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 The LLC sublayer provides  service access points (SAPs) that other computers can refer 
to and use to transfer information from the LLC sublayer to the upper OSI layers. This is 
deﬁ ned in the 802.2 standard. 
 The MAC sublayer, the lower of the two sublayers, provides for shared access to the 
network adapter and communicates directly with network interface cards. A unique 48 - bit 
address, commonly represented as a 12 - digit hexadecimal MAC address (frequently called 
the  hardware Ethernet address ), is assigned to network interface cards before they leave the 
factory where they are made. The LLC sublayer uses MAC addresses to establish logical 
links between devices on the same LAN. Ethernet is an example of a protocol that exists at 
the Data - Link layer.  
 MAC Address Conﬂ icts and Limitations 
 Historically, one of the more difﬁ cult problems to diagnose and ﬁ x has been a conﬂ ict of 
MAC addresses between two (or more) devices on a network. Since the MAC address is 
speciﬁ c to the hardware, it ’ s sometimes referred to as the  burned - in address . The MAC 
consists of 48 bits represented as a 12 - digit hexadecimal number. Of those 12 digits, 6 
are speciﬁ c to the vendor that produced the card. For example, the ﬁ rst six numbers on a 
network card produced by Intel are 00AA00, while on Cisco devices they are 00000C. 
 On many network cards there is no way to change this address, because it is set at the 
factory (although some cards do enable the administrator to change the MAC address). 
When two devices with the same MAC address are connected to the same network 
segment, a conﬂ ict will occur that can be quite difﬁ cult to diagnose. Many times the 
normal troubleshooting techniques won ’ t work since things like pings respond normally. 
Resolving a MAC conﬂ ict sometimes comes down to looking at the MAC address for 
each device currently reporting problems. On Windows this is accomplished with the 
 ipconfig /all command, as you ’ ll see in Chapter 12,  “ TCP/IP. ” 
 MAC addresses don ’ t cross network boundaries. Therefore, when troubleshooting a 
problem related to a MAC address with a tool called a  sniffer (a packet sniffer is a utility 
used to extract packets from a network cable so that the packet information may be 
examined), you might see one MAC address showing up more often than others. Chances 
are that this is the address of the router or gateway boundary of the network. Since all 
trafﬁ c coming into the network goes through the router, it assigns its own MAC address 
to all conversations coming into the network. Many an intrusion analyst or administrator 
on a network has been confused when seeing large amounts of trafﬁ c apparently coming 
from a single MAC source. 
 The Network Layer 
 The Network layer handles moving packets between devices. It makes routing decisions 
and forwards packets as necessary to help them travel to their intended destination. In 

larger networks, there may be intermediate devices and subnetworks between any two end 
systems. The Network layer makes it possible for the Transport layer (and layers above it) 
to send packets without being concerned with whether the end system is on the same piece 
of network cable or on the other end of a large wide area network. 
 To do its job, the Network layer translates logical network addresses into physical 
machine addresses (MAC addresses, which operate at the Data - Link layer). The Network 
layer also determines the quality of service (such as the priority of the message) and the 
route a message will take if there are several ways a message can get to its destination. 
 The Network layer also may split large packets into smaller chunks if the packet is larger 
than the largest data frame the Data - Link layer will accept. The Network layer reassembles 
the chunks into packets at the receiving end. 
 Intermediate systems that perform only routing and relaying functions and do not 
provide an environment for executing user programs can implement just the ﬁ rst three OSI 
network layers. Figure 11.5 shows how the Network layer moves packets across multiple 
links in a network.  
3. Network layer
3. Network layer
3. Network layer
2. Data-Link layer
2. Data-Link layer
2. Data-Link
layer
1. Physical layer
1. Physical layer
1. Physical
      layer
1. Physical
      layer
2. Data-Link
layer
Router
 F I G U R E 11. 5 The Network layer moves packets across links to their destination. 
 The Network layer performs several important functions that enable data to arrive 
at its destination. The protocols at this layer may choose a speciﬁ c route through an 
internetwork to avoid the excess trafﬁ c caused by sending data over networks and segments 
that don ’ t need access to it. The Network layer serves to support communications between 
logically separate networks. This layer is concerned with the following: 
 Addressing, including logical network addresses and service addresses  
 Circuit, message, and packet switching  
 Route discovery and route selection  
 Connection services, including Network layer ﬂ ow control, Network layer error con-
trol, and packet sequence control  
 Gateway services  
 The Internet Protocol (IP) resides on the Network layer.  
■
■
■
■
■
Understanding the OSI Model 
471

472 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 The Transport Layer 
 The Transport layer ensures that data is delivered error - free, in sequence, and with no 
losses or duplications. This layer also can break large messages from the Session layer 
into smaller segments to be handed down to the Network layer and sent to the destination 
computer; it then reassembles segments into messages to be presented to the Session 
layer. The Transport layer can send an acknowledgment to the originator for messages 
received (as in Figure 11.6). Most of these services are optional and are not required in the 
implementation of all Transport layer protocols. The one feature common to all protocols 
at the Transport layer is upper - layer protocol multiplexing, allowing multiple higher - layer 
protocol ﬂ ows to operate simultaneously. In terms of TCP/IP, this means you could, for 
example, navigate to a website and download a ﬁ le at the same time. 
 Transmission Control Protocol (TCP) and User Datagram Protocol (UDP) are examples 
of protocols that exist at the Transport layer.  
3. Network layer
3. Network layer
3. Network layer
2. Data-Link layer
2. Data-Link layer
2. Data-Link
layer
1. Physical layer
1. Physical layer
1. Physical
      layer
Router
End-to-end transport
connection
1. Physical
      layer
2. Data-Link
layer
4. Transport layer
4. Transport layer
 F I G U R E 11.6 The Transport layer provides end - to - end communication with integrity 
and performance guarantees. 
 The Session Layer 
 The Session layer allows applications on separate computers to share a connection called 
a  session . This layer provides services that allow two programs to ﬁ nd each other and 
establish the communication link, such as name lookup and security. The Session layer 
also provides for data synchronization and check pointing so that in the event of a network 

failure, only the data sent after the point of failure would need to be resent. This layer also 
controls the dialogue between two processes and determines who can transmit and who 
can receive at what point during the communication (see Figure 11.7). 
 NetBIOS, RPC, Named Pipes, PPTP, and SQL are examples of protocols on the Session 
layer.  
 The Presentation Layer 
 The Presentation layer translates data between the formats the network requires and the 
formats the computer expects. The Presentation layer performs protocol conversion; data 
translation, compression, and encryption; character set conversion; and the interpretation 
of graphics commands. 
 The network redirector, long a part of Windows networking, operates at this level. 
The redirector is what makes the ﬁ les on a ﬁ le server visible to the client computer. The 
network redirector also makes remote printers act as though they were attached to the local 
computer. Figure 11.8 shows the Presentation layer ’ s role in the protocol stack. 
 Graphic formats such as PICT, TIFF, and JPEG are examples of Presentation layer 
protocols.  
3. Network layer
3. Network layer
3. Network layer
2. Data-Link layer
2. Data-Link layer
2. Data-Link
layer
2. Data-Link
layer
1. Physical layer
1. Physical layer
1. Physical
      layer
1. Physical
      layer
4. Transport layer
4. Transport layer
5. Session layer
5. Session layer
Router
Dialog between application
programs
 F I G U R E 11.7 The Session layer allows applications to establish communication 
sessions with each other. 
Understanding the OSI Model 
473

474 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 The Application Layer 
 The Application layer is the topmost layer of the OSI model, and it provides services that 
directly support user applications, such as database access, email, and ﬁ le transfers. It also 
allows applications to communicate with applications on other computers as though they 
were on the same computer. When a programmer writes an application that uses network 
services, this is the layer the application will access. For example, Internet Explorer uses 
the Application layer to make its requests for ﬁ les and web pages; the Application layer 
then passes those requests down the stack, with each succeeding layer doing its job (as in 
Figure 11.9). 
 File Transfer Protocol (FTP), Hypertext Transfer Protocol (HTTP), Simple Mail 
Transfer Protocol (SMTP), and others are examples of protocols at the Application layer.  
Router
Data conversion between
different systems
3. Network layer
3. Network layer
3. Network layer
2. Data-Link layer
2. Data-Link layer
2. Data-Link
layer
2. Data-Link
layer
1. Physical layer
1. Physical layer
1. Physical
      layer
1. Physical
      layer
4. Transport layer
4. Transport layer
5. Session layer
5. Session layer
6. Presentation
        layer
6. Presentation
        layer
 F I G U R E  11. 8 The Presentation layer allows applications to establish communication 
sessions with each other. 

 Communication between Stacks 
 When a message is sent from one machine to another, it travels down the layers 
on one machine and then up the layers on the other machine, as shown in Figure 11.10. 
 As the message travels down the ﬁ rst stack, each layer it passes through (except the 
Physical layer) adds a header. These headers contain pieces of control information that 
are read and processed by the corresponding layer on the receiving stack. As the message 
travels up the stack of the other machine, each layer removes the header added by its peer 
layer and uses the information it ﬁ nds to ﬁ gure out what to do with the message contents 
(see Figure 11.11).  
 F I G U R E 11. 9 The Application layer is where the applications function, using lower 
levels to get their work done. 
Understanding the OSI Model 
475
Router
Communication between
user processes
7. Application
between user processes
User process
7. Application
between user processes
3. Network layer
3. Network layer
3. Network layer
2. Data-Link layer
2. Data-Link layer
2. Data-Link
layer
2. Data-Link
layer
1. Physical layer
1. Physical layer
1. Physical
      layer
1. Physical
      layer
4. Transport layer
4. Transport layer
5. Session layer
5. Session layer
6. Presentation
        layer
6. Presentation
        layer
User process

476 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
Application
Unix
Macintosh
Presentation
Session
Transport
Network
Data-Link
Physical
Application
Presentation
Session
Transport
Network
Data-Link
Physical
 F I G U R E 11.10 Traffic flows down through the stack on one computer and up the stack 
on the other. 
Original data
Original data
Original data
Original data
Original data
Original data
Original data
Hp
Hs
Ht
Hn
Hd
Original data
Original data
Original data
Original data
Original data
Original data
Original data
Application
Macintosh
DOS
Presentation
Session
Transport
Network
Data-Link
Physical
Hp
Hs
Ht
Hn
Hd
Hp = Presentation header
Hs = Session header
Ht = Transport header
Hn = Network header
Hd = Data-Link header
 F I G U R E 11.11 As packets flow up and down the stacks, each layer adds or removes 
necessary control information. 
 How Microsoft ’ s Network Components 
Work with the OSI Model 
 Because the OSI model is so abstract, it can be hard to tell how its concepts relate to the 
actual network software and hardware you use in the real world. The following sections 
will make the link clearer. We will introduce you to some network protocols and show how 
they apply to the various layers of the OSI model. 

 Device Drivers and the OSI Model 
 Every hardware device in a computer requires a software - based device driver to make it 
work. Some drivers — for instance, the driver for an Integrated Device Electronics (IDE) 
hard disk or for the keyboard — are built into the operating system. Other devices require 
that drivers be installed separately when the device is attached or installed in the computer. 
Windows Server 2008 R2 really blurs this distinction because it includes drivers for several 
hundred different network cards, but if your card isn ’ t on the list, you will need to install 
the driver provided by the manufacturer. 
 When Windows 3.11 was introduced, network drivers were vendor - speciﬁ c for both 
the operating system and the card. You might, for instance, have had a difﬁ cult time if 
you wanted to put a 3Com Ethernet card and an IBM Token Ring card in the same server. 
Worse yet, most drivers could be bound only to a single protocol stack and a single card, so 
you couldn ’ t have two cards using TCP/IP on one server. 
 A variety of vendors tried to solve this problem by developing driver interfaces that 
allowed multiple cards to be bound to multiple protocols. Apple and Novell developed 
the Open Data - link Interface (ODI), and Microsoft countered with the Network Driver 
Interface Speciﬁ cation (NDIS). Microsoft ’ s operating systems have supported NDIS ever 
since, making it possible to bind either multiple protocols to one card or the same protocol 
to multiple cards.  
 Windows Server 2008, Windows Server 2008 R2, Windows 7, and Windows 
Vista include Network Driver Interface Specification (NDIS) 6.0.  
 Network adapter cards and drivers provide the services corresponding to the Data -
 Link layer in the OSI model. In the IEEE model, the Data - Link layer is split into the 
LLC sublayer, which corresponds to the software drivers, and the MAC sublayer, which 
corresponds to the network adapter. You can think of the drivers as intermediaries between 
the higher layers and the card hardware that handles the business of forming packets and 
stufﬁ ng them into a wire.  
 Network Protocol Basics 
 Protocols are nothing more than an agreed - upon way for two objects (people, computers, 
home appliances, and so on) to exchange information. There are protocols at various levels 
in the OSI model. In fact, it is the protocols at a particular level in the OSI model that 
provide that level ’ s functionality. Protocols that work together at one or more layers of the 
OSI model are known as a  protocol stack or  protocol suite . The following sections explain 
how network protocols move data between machines. 
 How Protocols Work 
 A  protocol is a set of basic steps two or more parties perform according to a predeﬁ ned or 
agreed - upon set of standards. A good example of a protocol that follows some unwritten 
How Microsoft ’ s Network Components Work with the OSI Model 
477

478 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
but largely agreed - upon standards is a telephone conversation. When one person places a 
phone call, they dial the number of another party. The person on the other end answers the 
phone and says something akin to  “ Hello, ” at which point the calling party responds with 
a similar greeting. The conversation ensues from there. When the conversation is complete, 
each party (usually) ends the call with some parting words such as  “ Good - bye. ” This 
telephone call followed a routine protocol: 
 1. 
 Say  “ Hello. ” 
 2. 
  Converse.  
 3. 
  Say  “ Goodbye. ” 
 In the realm of computers, a protocol follows the same concept. A protocol is a set of 
predeﬁ ned standards that both computers must perform in the right order. For instance, for 
one computer to send a message to another computer, the ﬁ rst computer must perform the 
steps given in the following general example: 
 1. 
 Break the data into small sections called  packets  (or  segments , or another name 
depending on the layer involved). 
 2. 
  Add addressing information to the packets, identifying the destination computer. 
 3. 
  Deliver the data to the network card for transmission over the network.  
 The receiving computer must perform these steps: 
 1. 
 Accept the data from the network adapter card.  
 2. 
  Remove the transmitting information that was added by the transmitting computer.  
 3. 
  Reassemble the packets of data into the original message.  
 Each computer needs to perform the same steps, in the same way and in the correct 
order, so that the data will arrive and be reassembled correctly. If one computer uses a 
protocol with different steps or even the same steps with different parameters (such as 
different sequencing, timing, or error correction), the two computers won ’ t be able to 
communicate with each other.  
 Network Packets 
 Ethernet networks running IP and using TCP as the transport protocol primarily send and 
receive small chunks of data called  packets. Network protocols construct, modify, and 
disassemble packets as they move data down the sending stack, across the network, and back 
up the OSI stack of the receiving computer. An IP packet has the following components: 
 A source address specifying the sending computer 
 A destination address specifying where the packet is being sent  
 Instructions that tell the computer how to pass the data along  
 Reassembly information (if the packet is part of a longer message)  
 The data to be transmitted to the remote computer (often called the  packet payload ) 
 Error - checking information to ensure that the data arrives intact  
■
■
■
■
■
■

 These components are assembled into slightly larger chunks; each packet contains three 
distinct parts (listed here and shown in Figure 11.12), and each part contains some of the 
components listed previously:
 Header   A typical header might include an identiﬁ er, source and destination addresses, 
and other options, depending on the protocol.  
 Data   This is the actual data being sent.  
 Trailer   The contents of the trailer (or even the existence of a trailer) vary among network 
types, but it typically includes a CRC. The CRC helps the network determine whether a 
packet has been damaged in transmission.  
Header
Data
Trailer
 F I G U R E 11.12 A packet consists of a header, the data, and a trailer. 
 Protocols and Binding 
 Many different protocol stacks can perform network functions, and many different types 
of network interface cards can be installed in a computer. A computer may have more 
than one card, and a computer may use more than one protocol stack at the same time. 
 The  binding process is what links the protocol stack to the network device driver for the 
network interface adapter. Several protocols can be bound to the same card. In addition, 
one computer with several interface adapters — for instance, a server that must be able to 
communicate with both a local area network and a network backbone — can have the same 
protocol bound to two or more network cards. 
 The binding process can be used throughout the OSI layers to link one protocol stack to 
another. The device driver (which implements the Data - Link layer) is bound to the network 
interface card (which implements the Physical layer). TCP/IP can be bound to the device 
driver, and the NWLink Session layer can be bound to the device driver.  
 Determining Connections 
 Communication between computers can be arranged in two ways: 
 Using connectionless protocols  
 Using connection - oriented protocols  
 It ’ s important to understand the differences between them because different Windows 
Server 2008 R2 services use both types. 
■
■
How Microsoft ’ s Network Components Work with the OSI Model 
479

480 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 Connectionless Protocols 
 It might seem odd to talk about a connectionless protocol for networks, but you use 
at least two of them just about every day: radio and television. Connectionless systems 
assume that all data will get through, so the protocol doesn ’ t guarantee delivery or correct 
packet ordering. Think of shouting a message out of your window to someone walking 
by outside — there ’ s no guarantee that they ’ ll hear you, but it ’ s quick and easy. These 
optimistic assumptions mean that there ’ s no protocol overhead spent on these activities, 
so connectionless protocols tend to be fast. The User Datagram Protocol (UDP), which is 
part of the IP suite, is an example of a connectionless Internet transport protocol. In fact, 
IP itself is connectionless, relying on upper - layer protocols such as TCP to provide the 
connection. The Domain Name System uses UDP.  
 Connection - Oriented Protocols 
 Connection - oriented systems work more like your telephone — you have to dial a number 
and establish a connection to the other end before you can send a message. Connection -
 oriented protocols pessimistically assume that some data will be lost or disordered in 
most transmissions. They guarantee that transmitted data will reach its destination in the 
proper sequence and that all data will get through. To accomplish this, connection - oriented 
protocols that also are considered  reliable retain the transmitted data and negotiate for 
a retransmission when needed. Once all the needed data has arrived at the remote end, it 
can be reassembled into its proper sequence and passed to the higher - level protocols. This 
means that any application can depend on a connection - oriented transport to reliably 
deliver data exactly as it was transmitted. TCP is an example of a reliable connection -
 oriented Internet protocol. Frame Relay is an example of an  unreliable connection - oriented 
protocol. Unreliable does not imply undependable. It just means that the protocol does not 
support the retransmission of lost or errored data. 
 For local area systems where data isn ’ t likely to be dropped, it makes sense to push 
serialization and guaranteed delivery up to higher - level protocols that are less efﬁ cient 
because they won ’ t be used often anyway. But in wide area networks like the Internet, it 
would simply take too much time for higher - level protocols to sort out what data had been 
sent and what was missing, so the transport protocol takes measures to guarantee that all 
the data gets through in order.  
 Network Protocols and Windows Server 2008 R2 
 A number of protocol stacks are used in the world ’ s networks today. Besides NetWare, 
AppleTalk, NetBIOS, and TCP/IP, there are a bunch of specialty protocols such as IBM ’ s 
Systems Network Architecture (SNA), Digital ’ s (now HP/Compaq ’ s) DECnet, and others. 
Even though these protocols actually work at different levels of the OSI model, they fall 
neatly into three distinct groups, as shown in the following list and in Figure 11.13: 
 Application protocols provide for application - to - application interaction and data exchange.  
 Transport protocols establish communication sessions between computers.  
 Network protocols handle issues such as routing and addressing information, error 
checking, and retransmission requests.  
■
■
■

 Network Protocols Not Supported in Windows Server 2008 R2 
 In Windows Server 2003, Microsoft supported many different protocol types such as 
NWLink, AppleTalk, Serial Line Interface Protocol (SLIP), and TCP/IP. In Windows Server 
2008 R2, Microsoft supports a different set of protocols. 
 Support for the following technologies has been removed since Windows Server 2003: 
 Bandwidth Allocation Protocol (BAP)  
 X.25  
 Serial Line Interface Protocol (SLIP) 
 SLIP - based connections will automatically be updated to PPP - based connections.  
 Asynchronous Transfer Mode (ATM)  
 IP over IEEE 1394  
 NWLink IPX/SPX/NetBIOS Compatible Transport Protocol  
 Services for Macintosh (SFM)  
 The Open Shortest Path First (OSPF) routing protocol component in Routing and 
Remote Access  
 Basic Firewall in Routing and Remote Access 
 This protocol has been replaced with Windows Firewall.  
 Static IP ﬁ lter APIs for Routing and Remote Access 
 This protocol has been replaced with Windows Filtering Platform APIs.  
 The SPAP, EAP - MD5 - CHAP, and MS - CHAP v1 authentication protocols for PPP -
 based connections  
■
■
■
■
■
■
■
■
■
■
■
7. Application layer
Application
Transport
Network
6. Presentation layer
5. Session layer
4. Transport layer
3. Network layer
2. Data-Link layer
1. Physical layer
 F I G U R E 11.13 Each OSI protocol works within one of three groups: Application, 
Transport, or Network. 
How Microsoft ’ s Network Components Work with the OSI Model 
481

482 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 TCP/IP Preferred for Windows Server 2008 R2 
 Microsoft Windows 2008 R2 supports TCP/IP version 4 and TCP/IP version 6 networking 
protocols. TCP/IP is a complex transport sufﬁ cient for globe - spanning networks such as 
the Internet, and Microsoft is doing everything possible to position TCP/IP as a one - size -
 ﬁ ts - all network protocol. TCP/IP is required to use Active Directory and is the default 
protocol for Windows Server 2008 R2.  
 Understanding TCP/IP 
 TCP/IP is actually two sets of protocols bundled together: the Transmission Control 
Protocol and the Internet Protocol. The U.S. Department of Defense ’ s Advanced Research 
Projects Agency (ARPA, or later DARPA) developed TCP/IP and its suite of protocols 
beginning in 1969. The original goal was to develop network protocols that were robust 
enough to route communications around damage caused by nuclear war. That design goal 
was never tested, but some aspects of that design have led to the redundant, distributed 
whole we call the Internet. 
 IP is by far the most widely used protocol for interconnecting computers, and it is 
the protocol of the Internet. This is because although ARPA originally created IP to 
connect military networks, it provided the protocol standards to government agencies and 
universities free of charge. The academic world leapt at the chance to use a robust protocol 
to interconnect their networks, and the Internet was born. Many organizations and 
individuals collaborated to create higher - level protocols for everything from newsgroups, 
mail transfer, and ﬁ le transfer to printing, remote booting, and even document browsing.  
 
Although you ’ ll see it commonly referred to as TCP/IP in Windows and 
throughout this book, TCP/IP really means the TCP/IP or IP suite, and 
not necessarily TCP, the Transport layer protocol. UDP is also used, thus 
making it sort of a misnomer to say TCP/IP while ignoring UDP/IP.  
 IP is currently the protocol of choice for most networks because of its rapid and 
widespread adoption. IP is used for networks that span more than one metropolitan area or 
to connect to (or over) the Internet.  
 Understanding the OSI Model and Troubleshooting 
 The company you work for has several regional ofﬁ ces spread around the country. Your 
job is to make sure the resources on the Windows Server 2008 R2 network, which include 
manufacturing, inventory, and sales information, are available at all times. If the sales 
information from the regional ofﬁ ces isn ’ t collected and updated to the manufacturing 

 IP has some signiﬁ cant advantages: 
 Broad connectivity among all types of computers and servers, including direct access to 
the Internet  
 Strong support for routing, using a number of ﬂ exible routing protocols  
 Support for advanced name and address resolution services: the Domain Name System 
(DNS), GlobalNames, and the Windows Internet Name Service (WINS)  
 Support for a wide variety of Internet - standard protocols, including protocols for mail 
transport, web browsing, and ﬁ le and print services  
 Centralized network number and name assignment, which facilitates internetworking 
between organizations 
 TCP/IP is the core protocol that Windows Server 2008 R2 depends on for all its 
network services. In fact, most of this book focuses on TCP/IP and its related services.  
 Chapter 12 covers TCP/IP in detail. 
■
■
■
■
■
and inventory programs, the company won ’ t be able to supply its customers effectively. 
The users of the network aren ’ t particularly interested in the technical nuts and bolts of 
the system, but they do care when the system is down. 
 At the same time, you ’ re studying for your MCITP certiﬁ cation and wondering how the 
abstract notions of the OSI model are relevant to your job. A support call comes in from 
a user who can ’ t connect to a printer on a Windows Server 2008 R2 machine in another 
region where an executive management meeting is taking place. The user is down the 
hall from you, so you drop everything and run down to take a look. 
 With the OSI model fresh in mind, you approach the problem in terms of layers of 
functionality. You ping the address of your router, and it comes back ﬁ ne. You now know 
that the Physical, Data - Link, and Network layers are working ﬁ ne, which means you have 
eliminated cable and basic protocol problems. Your browser also seems to work ﬁ ne 
because you can reach random sites. When you ping the name of the Windows Server 2008 
R2 machine that hosts the printer, you get the  “ request timed out ” message. But when you 
ping the IP address directly, the reply shows a healthy connection, implying that you have a 
name - resolution problem. You begin the task of looking at your DNS server. 
 By breaking down your troubleshooting tactics into the general OSI layers, you can better 
gauge where the problem lies and which services to look at, depending on where in the 
OSI model the symptoms appear. Although the OSI model is fairly abstract, when it ’ s 
applied appropriately, it gives you a structure for thinking about your overall network and 
provides a framework for following methodical troubleshooting tactics. 
How Microsoft ’ s Network Components Work with the OSI Model 
483

484 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 About Windows Network Models 
 Now that you have learned how computers communicate with each other, we ’ ll discuss 
how you choose what kind of network to set up. Before you start setting it up, you have to 
make an important decision. Speciﬁ cally, you need to decide what type of network model 
you need to install. The choice you make here is going to determine how you set up the rest 
of the computers and servers on your network. 
 The following sections describe two network models used by Microsoft Windows.  
 Since this is a Microsoft Windows certification book, the network models 
that are discussed in this book are Microsoft Windows – related models.  
 Windows Peer - to - Peer Network 
 In a Microsoft Windows peer - to - peer network (also referred to as a  workgroup ) 
all computers on the network are equal. All computers (also referred to as  nodes ) 
simultaneously act as both clients and servers. This is an advantage for small networks that 
have 12 or fewer users. 
 New Features of Windows Peer - to - Peer Network 
 Windows Vista and Windows 7 include some of the following enhancements to the 
Windows peer - to - peer network:
  HomeGroup (Windows 7 only)   HomeGroup is an easy way for home users to set up 
a small workgroup environment in their homes. HomeGroup allows you to set up a 
workgroup based on a password. When other machines try to connect to the HomeGroup, 
you just enter the password and the machine becomes part of the network.  
  People Near Me   This Windows 7 and Windows Vista feature provides four important 
services: 
 Discovery of users on the same subnet  
 Ability to invite users to an application  
 Publication of objects  
 Contact management through the use of the Windows Address Book  
  New Application Programming Interface   Microsoft has improved and simpliﬁ ed its API ’ s 
abilities to access Windows peer - to - peer networking capabilities such as name resolution, 
group creation, and security. This makes it easier for developers to create peer - to - peer 
applications for Windows.  
 Group Policy Configuration Support   Windows 7 and Windows Vista allow you to set up 
a Group Policy to conﬁ gure Windows peer - to - peer networking settings.  
■
■
■
■

 New Version of Peer Name Resolution Protocol   Microsoft Windows 7 and Windows 
Vista include version 2 of the Peer Name Resolution Protocol (PNRP). This version uses 
less network bandwidth and is more scalable.  
 The new version of the PNRP protocol is incompatible with the version 
that came with the Windows XP Advanced Networking Pack. You can 
download the PNRP v2 upgrade for Windows XP through the Windows 
Update utility.  
 Windows Peer - to - Peer Network Scenario 
 Imagine you are planning a network for a small real - estate ofﬁ ce with ﬁ ve realtors. 
Should you set up a client/server - based network and spend money on a powerful machine, 
Windows 2008 R2 Server, client access licenses (CALs), and a consultant who knows how 
to set up a Microsoft Active Directory domain? Or should you set up a Microsoft Windows 
peer - to - peer network? With a peer - to - peer network, all Windows 7, Windows Vista, or XP 
Professional machines can be linked with each other through a small hub, and all users can 
share resources across the network (see Figure 11.14).  
Vista
Vista
Vista
Vista
Windows 7
Windows 7
Vista
Vista
 F I G U R E 11.14 Microsoft Windows peer - to - peer network 
 A Microsoft Windows peer - to - peer model has some disadvantages. All data is stored on 
individual workstations, and the local workstation ’ s owner controls the security. Each user 
needing to log onto a machine in a peer - to - peer network must have a local username and 
password. Returning to our example, let ’ s suppose the real - estate ofﬁ ce grows to employ 12 
realtors. Each realtor needs to be able to log onto any machine in the network: 
 12 users   12 computers   144 user accounts that need to be created  
About Windows Network Models 
485

486 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 The following are some other disadvantages to a peer - to - peer network:
  Scalability   A peer - to - peer network is limited to 12 computers.  
  Backups   Backups must be done locally on each computer, instead of backing up one 
server.  
 Decentralized Security   Security is controlled by the local workstation ’ s owner. Imagine 
having 200 ﬁ les on 12 different workstations. If one user goes on vacation, you might not 
be able to access a needed ﬁ le on that user ’ s workstation. 
 A Microsoft Windows peer - to - peer network does have its place in the vast computer 
universe. It ’ s great for a small company that is trying to save money while still sharing 
network resources. But if a peer - to - peer network does not ﬁ t into your part of the computer 
universe, you can use an Active Directory scheme (as explained in Part 1 of this book).  
 Summary 
 This chapter covered how the OSI networking model is organized into seven layers 
(Physical, Data - Link, Network, Transport, Session, Presentation, and Application) and 
described each level of the OSI stack. You also learned that Windows Server 2008 R2 
includes support for TCP/IP v4 and v6. TCP/IP is the primary protocol in use today, and 
Microsoft encourages you to use TCP/IP exclusively, if possible. 
 Finally, the chapter discussed the Microsoft Windows network models (Windows peer -
 to - peer) and the advantages and disadvantages of this model.  
 Exam Essentials  
  Know which protocols Windows Server 2008 R2 supports.   Previous versions of 
Microsoft Windows Server supported many networking protocols. Windows Server 2008 
R2 no longer supports many of these protocols, including BAP, X.25, SLIP, ATM, IP over 
IEEE 1394, NWLink IPX/SPX/NetBIOS Compatible Transport Protocol, SFM, several 
components of Routing and Remote Access (OSPF, Basic Firewall, and static IP ﬁ lter 
APIs), SPAP, EAP - MD5 - CHAP, and MS - CHAP v1 authentication protocols for PPP - based 
connections.  

Review Questions 
487
 Review Questions  
 1. 
  A packet is sent from one computer to another across a network. Various protocols move 
the packet down the OSI stack from the sending computer and up the OSI stack to the 
receiving computer. How do the protocols know where to send the packet?  
 A.   Each packet has a trailer that contains source and destination addresses.  
 B. 
  Each packet has a header that contains an alert signal and source and destination addresses.  
 C.   The data portion of every packet stores all the source and destination information.  
 D.   Special packets, called  header packets , that contain only source and destination 
addresses are sent first. Every packet that follows the header packet is sent to the 
destination address contained in the header packet.  
 2. 
 You are the administrator for a software development house that writes small utility 
programs for a wide range of networks. In addition to supporting its Windows Server 
2008 R2 network, you are responsible for verifying that some of the applications that are 
developed function properly. During these tests, you have to install transport protocols from 
other development houses that are used by various systems. You have worked out the issues 
surrounding the different protocols working on Windows Server 2008 R2 by requiring the 
protocol developers to make sure their protocols are compliant with what standard? 
 A.   ODI  
 B.   DLC  
 C.   NDIS  
 D.   NetBIOS  
 3. 
 You administer a very large network that consists of Windows 7, Windows Vista, Windows 
XP Professional, and Windows Server 2008 R2 computers. You want to implement DNS, 
DHCP, and WINS, and every computer must have access to the Internet and services on 
non - Windows machines. You want to be able to configure the network from a central 
location. Which network protocol provides the ability to do all these things?  
 A.   NetBEUI  
 B.   NWLink  
 C.   TCP  
 D.   TCP/IP  

488 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 4. 
  You are the administrator for a Windows NT network that has been internally focused 
on basic file and print services. You have been charged with upgrading your network to 
Windows Server 2008 R2 and also allowing the users of the network to find information 
on the Internet. Currently, the network is running NWLink because of routing needs 
between two locations and a lack in the IT department of IP experience. You need to 
change the network protocol to TCP/IP to support Internet connectivity. What layers in 
the OSI model do you need to consider to allow the workstations to access the Internet for 
simple browsing? (Choose all that apply.)  
 A.   Network layer  
 B.   Application layer  
 C.   Presentation layer  
 D.   Transport layer  
  5. 
  You have just been asked to troubleshoot intermittent communication problems on a fairly 
old network for a company that builds and repairs elevator motors. You have determined 
that the network is a straightforward thin - coax Ethernet Windows NT LAN running 
TCP/IP. The company wants to upgrade to Windows Server 2008 R2, hoping that the now -
 stable platform will resolve the intermittent problems. You perform the upgrade; all goes 
smoothly, and initially everything seems to function properly. However, the intermittent 
problems show up again. What layer in the OSI model is the most likely place for the 
problems to be occurring?  
 A.   Physical layer  
 B.   Data - Link layer 
 C.   Network layer  
 D.   Transport layer  
 E. 
  Session layer  
 6. 
 This sublayer, the lower of two sublayers, provides for shared access to the network 
adapter and communicates directly with network interface cards. A unique 48 - bit 
address, commonly represented as a 12 - digit hexadecimal address, is assigned to network 
interface cards before they leave the factory where they are made. What is the name of this 
sublayer?  
 A.   The TCP/IP sublayer  
 B.   The ISO sublayer  
 C.   The MAC sublayer  
 D.   The ARP sublayer  
  E. 
  The LLC sublayer  

Review Questions 
489
 7. 
  This OSI layer handles moving packets between devices. It makes routing decisions and 
forwards packets as necessary to help them travel to their intended destination. In larger 
networks, there may be intermediate devices and subnetworks between any two end systems. 
This OSI layer makes it possible for the Transport layer to send packets without being 
concerned with whether the end system is on the same piece of network cable or on the other 
end of a large wide area network. What layer in the OSI model makes this possible?  
 A.   Physical layer  
 B.   Data - Link layer 
 C.   Network layer  
 D.   Transport layer  
 E. 
  Session layer  
 8. 
 You are the administrator for a small company that makes video games. The company uses 
Windows XP, Windows Vista, Windows 7, and Windows Server 2008 R2. In the last two days 
users have been complaining the network has been running much more slowly than usual. You 
monitor the performance of the server, but the server is showing no signs of problems. You 
believe that there might be a computer or device on the network that is sending large amounts 
of broadcast traffic. What type of utility can you use to examine the packets on your network?  
 A.   Performance Monitor  
 B.   Ethernet cable tester  
 C.   ipconfig /all 
 D.   Packet sniffer 
 9. 
 The OSI layer is responsible for using electric (or sometimes other types of) signaling to get bits 
from one computer to another. This layer ’ s components don ’ t care what the bits mean; their job 
is to get the bits from point A to point B, using whatever kind of optical, electrical, or wireless 
connection that connects the points. What layer in the OSI model are we referring to?  
 A.   Application layer  
 B.   Data - Link layer 
 C.   Network layer  
 D.   Transport layer  
 E. 
  Physical layer  
 10.   This OSI layer provides for the flow of data over a single physical link from one device to 
another. It accepts packets from the Network layer and packages the information into data 
units called  frames ; these frames are presented to the Physical layer for transmission. This 
OSI layer adds control information, such as the frame type, to the data being sent. This layer 
also provides for the error - free transfer of frames from one computer to another. Which OSI 
layer does these tasks? 
 A.   Application layer  
 B.   Data - Link layer 
 C.   Network layer  
 D.   Transport layer  
 E. 
  Physical layer  

490 
Chapter 11 ■ Understanding Windows Server 2008 R2 Networking
 Answers to Review Questions 
1. 
 B .  Each packet has a header and data and is typically placed in a frame that consists 
of three parts: a header, data, and a trailer. The packet header includes the source and 
destination logical addresses. 
2. 
 C .  Network Driver Interface Speciﬁ cation (NDIS) provides a standard way for protocols to 
bind to the Data - Link drivers. As long as a developer supports NDIS, the protocol will load in 
Windows Server 2008 R2. However, this will not make it interoperate with the Windows Server 
2008 R2 services. The applications will have to be written to the speciﬁ c protocols. 
3. 
 D .  TCP/IP is the most widely used protocol for interconnecting computers and networks. 
It is the only protocol used on the Internet and the only one compatible with the other 
protocols mentioned. It works well with very large internetworks. 
4. 
 A, B, C, D .  TCP sits at the Transport layer, and IP sits at the Network layer; both are 
necessary to route requests through the Internet. However, you also need a browser such as 
Netscape or Internet Explorer to provide the HTTP calls to actually connect to the various 
websites; the browser sits at the Application layer. But any end - to - end communication uses 
all the levels of the OSI model because each layer communicates with the layer below and 
the layer above to form the complete chain. 
5. 
 A .  The Physical layer is concerned with signaling, speciﬁ cally through electrical, optical, 
or radio signals. The high voltage associated with large motors can easily cause an 
interruption in the signaling of coax cable. There have been many cases of people running 
network cable through elevator shafts in a building because of the ease of access, only to 
have the network malfunction every time someone summons the car. The other layers are 
associated with software and are beyond the reach of most electrical interference unless it 
affects the entire workstation. 
6. 
 C .  The IEEE split the ISO Data - Link layer into the LLC sublayer and the MAC sublayer. 
The MAC sublayer, the lower of the two sublayers, provides for shared access to the 
network adapter and communicates directly with network interface cards. A unique 48 - bit 
address, commonly represented as a 12 - digit hexadecimal MAC address (frequently called 
the  hardware Ethernet address ), is assigned to network interface cards before they leave the 
factory where they are made. 
7. 
 C .  To do its job, the Network layer translates logical network addresses into physical 
machine addresses (MAC addresses, which operate at the Data - Link layer). The Network 
layer also determines the quality of service (such as the priority of the message) and the 
route a message will take if there are several ways a message can get to its destination. The 
Network layer also may split large packets into smaller chunks if the packet is larger than 
the largest data frame the Data - Link layer will accept. The Network layer reassembles the 
chunks into packets at the receiving end. 
8. 
 D .  A packet sniffer is a utility used to extract packets from a network cable so that 
the packet information may be examined. There are many different packet sniffers on the 
market, but most will be able to determine what types of packets are being sent. Using a 
packet sniffer will allow you to determine whether a computer or device is sending high 
amounts of broadcast trafﬁ c. 

9. 
 E .  The Physical layer is concerned with signaling, speciﬁ cally through electrical, optical, or 
radio signals. This layer ’ s components don ’ t care what the bits mean; their job is to get the 
bits from point A to point B via the optical, electrical, or wireless connection between 
the points. 
10.  B .  The Data - Link layer provides for the ﬂ ow of data over a single physical link from 
one device to another. It accepts packets from the Network layer and packages the 
information into data units called  frames ; these frames are presented to the Physical layer 
for transmission. The Data - Link layer adds control information, such as frame type, to the 
data being sent. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
491


Configuring TCP/IP  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Addressing and Services  
 Configuring IPv4 and IPv6 addressing. May include but is 
not limited to: configuring IP address options, subnetting, 
supernetting, multi - homed; interoperability between IPv4 
and IPv6.  

■
 Chapter 
12

 In this chapter, we will discuss the most important protocol 
used in a Microsoft Windows Server 2008 R2 network: 
Transmission Control Protocol/Internet Protocol (TCP/IP). 
 As mentioned in the previous chapter, TCP/IP is actually two sets of protocols bundled 
together: the Transmission Control Protocol (TCP) and the Internet Protocol (IP). TCP/IP is 
a suite of protocols developed by the Department of Defense ’ s Advanced Research Projects 
Agency in 1969. 
 This chapter is divided into two main topics; we ’ ll talk about TCP/IP version 4 ﬁ rst and 
then about TCP/IP version 6. TCP/IP version 4 is still used in Windows Server 2008 R2, 
and it was the primary version of TCP/IP in all previous versions of Windows. However, 
TCP/IP version 6 is the new release of TCP/IP, and it has been incorporated into Windows 
Server 2008 R2 as well.  
 Understanding TCP/IP 
 We mentioned earlier that TCP/IP is actually two sets of protocols bundled together: TCP 
and IP. These protocols sit on a four - layer TCP/IP model (see Figure 12.1). 
 Details of the TCP/IP Model 
 The four layers of the TCP/IP model are as follows (see Figure 12.1):  
 Application Layer   The Application layer is where the applications that use the protocol stack 
reside. These applications include File Transfer Protocol (FTP), Trivial File Transfer Protocol 
(TFTP), Simple Mail Transfer Protocol (SMTP), and Hypertext Transfer Protocol (HTTP).  
 Transport Layer   The Transport Layer is where the two Transport layer protocols reside. 
These are TCP and the User Datagram Protocol (UDP). TCP is a connection - oriented 
protocol, and delivery is guaranteed. UDP is a connectionless protocol. This means UDP 
does its best job to deliver the message, but there is no guarantee.  
 Internet Layer   The Internet layer is where IP resides. IP is a connectionless protocol that 
relies on the upper layer (Transport layer) for guaranteeing delivery. Address Resolution 
Protocol (ARP) also resides on this layer. ARP turns an IP address into a Media Access 
Control (MAC) address. All upper and lower layers travel through the IP protocol.  
 Link Layer   The data link protocols like Ethernet and Token Ring reside in the Link layer. 
This layer is also referred to as the Network Access Layer.  

FTP
TFTP
UDP
TCP
Application Layer
Transport Layer
Internet Layer
Link Layer
IP
Ethernet
Token Ring
 F I G U R E 12 .1 TCP/IP model 
Source Host
Destination Host
Application
Application
Application
Application
Application
Application
Transport
Transport
Application
Application
Internet
Internet
Application
Application
Link
Link
Network
Packets
 F I G U R E 12 . 2 TCP/IP process 
 How TCP/IP Layers Communicate 
 When an application like FTP gets called upon, the application moves down the layers, 
and TCP is retrieved. TCP then connects itself to the IP protocol and gets released onto the 
network through the Link layer (see Figure 12.2). This is a connection - oriented protocol 
(because TCP is the protocol that guarantees delivery).  
Understanding TCP/IP 
495

496 
Chapter 12  Configuring TCP/IP
 When an application like TFTP gets called, the application moves down the layers, 
and UDP is retrieved. UDP then connects itself to the IP protocol and gets released onto 
the network through the Link layer. This is a connectionless protocol (because the UDP 
protocol does not have guaranteed delivery).  
 Understanding Port Numbers 
 TCP and UDP rely on port numbers assigned by the Internet Assigned Numbers Authority 
(IANA) to forward packets to the appropriate application process. Port numbers are 16 - bit 
integers that are part of a message header. They identify the application software process 
that the packet should be associated with. 
 For example, let ’ s say that a client has a copy of Internet Explorer and a copy of Outlook 
Express open at the same time. Both applications are sending TCP requests across the 
Internet to retrieve web pages and email, respectively. How does the computer know which 
return packets to forward to Internet Explorer and which packets to forward to Outlook 
Express? When making a connection, the client chooses a source port for the communication 
that is usually in the range 1024 – 65535 (sometimes in the range 1 – 65535). This source port 
then communicates with a destination port of 80 or 110 on the server side. Every packet 
destined for Internet Explorer has a source port number of 80 in the header, and every 
packet destined for Outlook Express has a source port number of 110 in the header. 
 Table 12.1 lists the most common port numbers (you might need to know these for the 
exam). You can visit  www.iana.org to get the most current full list of port numbers. It ’ s 
good to become familiar with speciﬁ c port numbers, because it ’ s an asset to be able to 
determine from memory the ports that, for example, allow or block speciﬁ c protocols in 
a ﬁ rewall. Allowing only port 80, for instance, does not ensure that all web trafﬁ c will be 
allowed. You must also allow port 443 for certain secure web trafﬁ c.  
 Simply because a port is  “ well known ” doesn ’ t mean that a given service 
must run on it. It ’ s technically valid to run any service on any port, but 
doing so is usually a bad idea. For example, if you chose to run your web 
server on TCP port 25, clients would need to type  www.example.com:25 in 
order to reach your website from most browsers.  
  Port Number  
  Description  
  20  
  FTP data 
  21  
  FTP control 
  23  
  Telnet  
  25  
  Simple Mail Transfer Protocol (SMTP)  
TA B L E 12 .1  Common port numbers

 Understanding IP Addressing 
 Understanding IP addressing is critical to understanding how IP works. An IP address is 
a numeric identiﬁ er assigned to each device on an IP network. This type of address is a 
logical software address that designates the device ’ s location on the network. It isn ’ t the 
physical hardware address hard - coded in the device ’ s network interface card. 
 In the following sections, you will see how IP addresses are used to uniquely identify 
every machine on a network.  
 
We ’ ll assume you ’ re comfortable with binary notation and math for the 
remainder of this discussion. 
 The Hierarchical IP Addressing Scheme 
 An IP address consists of 32 bits of information. These bits are divided into four sections 
(sometimes called  octets or  quads ) containing 1 byte (8 bits) each. There are three common 
methods for specifying an IP address: 
 Dotted - decimal, as in  130.57.30.56 
 Binary, as in  10000010.00111001.00011110.00111000 
 Hexadecimal, as in  82 39 1E 38 
 All of these examples represent the same IP address. 
 The 32 - bit IP address is a structured address, or hierarchical address, as opposed to 
a ﬂ at or nonhierarchical address. Although IP could have used either ﬂ at or hierarchical 
addressing, its designers chose hierarchical addressing — for a very good reason, as you 
will see.  
■
■
■
 Port Number  
  Description  
 53  
  Domain Name System (DNS)  
 80  
  Hypertext Transfer Protocol (HTTP), Web  
 88  
 Kerberos  
 110  
  Post Office Protocol v3 (POP3)  
 443  
  Secure HTTP (HTTPS) 
Understanding IP Addressing 
497

498 
Chapter 12  Configuring TCP/IP
 IP Address Structure 
 IP addressing works the same way. Instead of treating the entire 32 bits as a unique 
identiﬁ er, one part of the IP address is designated as the network address (or network ID) 
and the other part as a node address (or host ID), giving it a layered, hierarchical structure. 
Together, the IP address, the network address, and the node address uniquely identify a 
device within an IP network. 
 The network address — the ﬁ rst two sets of numbers in an IP address — uniquely 
identiﬁ es each network. Every machine on the same network shares that network address 
as part of its IP address, just as the address of every house on a street shares the same street 
name. In the IP address  130.57.30.56 , for example,  130.57 is the network address. 
 The node address — the second two sets of numbers — is assigned to, and uniquely 
identiﬁ es, each machine in a network, just as each house on the same street has a different 
house number. This part of the address must be unique because it identiﬁ es a particular 
machine — an individual, as opposed to a network. This number can also be referred to as a 
 host address . In the sample IP address  130.57.30.56 , the node address is  .30.56 . 
 Why Hierarchical Addressing Is Used 
 What ’ s the difference between these two types of addressing? A good example of a 
ﬂ at addressing scheme is a U.S. state driver ’ s license number. There ’ s no partitioning 
to it; the range of legal numbers isn ’ t broken up in any meaningful way (say, by county 
of residence or date of issue). If this method had been used for IP addressing, every 
machine on the Internet would have needed a totally unique address, just as each driver ’ s 
license number in a particular state is unique. 
 The good news about ﬂ at addressing is that it can handle a large number of addresses 
in 32 bits of data, namely, 4.3 billion. A 32 - bit address space with two possible values 
for each position — either 0 (zero) or 1 (one) — gives you 2 32 values, which equals 
approximately 4.3 billion. 
 The bad news — and the reason why ﬂ at addressing isn ’ t used in IP — relates to routing. If 
every address were totally unique, every router on the Internet would need to store the 
address of every other machine on the Internet. It would be fair to say that this would make 
efﬁ cient routing impossible, even if only a fraction of the possible addresses were used. 
 The solution to this dilemma is to use a hierarchical addressing scheme that breaks the 
address space into ordered chunks. Telephone numbers are a great example of this 
type of addressing. The ﬁ rst section of a U.S. telephone number, the area code, 
designates a very large area; the area code is followed by the preﬁ x, which narrows the 
scope to a local calling area. The ﬁ nal segment, the customer number, zooms in on 
the speciﬁ c connection. By looking at a number such as 603 - 766 -  xxxx , you can quickly 
determine that the number is located in the southern part of New Hampshire (area code 
603) in the Portsmouth area (the 766 exchange). 

 Understanding Network Classes 
 The designers of the Internet decided to create classes of networks based on network 
size. For the small number of networks possessing a very large number of nodes, they 
created the Class A network. At the other extreme is the Class C network, reserved for the 
numerous networks with small numbers of nodes. The class of networks in between 
the very large and very small ones is predictably called the Class B network. 
 The default subdivision of an IP address into a network and node address is determined 
by the class designation of your network. Table 12.2 summarizes the three classes of 
network, which will be described in more detail in the following sections.  
 TA B L E 12 . 2 Network address classes 
 Class  
  Mask Bits  
 Leading Bit 
Pattern  
 Decimal 
Range of 
First Octet of 
IP Address 
 Assignable 
Networks  
 Maximum 
Nodes per 
Network  
 A 
  8 
  0 
  1 – 126  
  126  
  16,777,214 
 B 
  16  
  10  
  128 – 191  
  16,384  
  65,534  
 C 
  24  
  110  
  192 – 223  
  2,097,152  
  254  
 Classless Inter - Domain Routing, explained in detail later in this chapter, 
has effectively done away with these class designations. You will still 
hear and should still know the meaning behind the class designations of 
addresses, because they are important to understanding IP addressing. 
However, when working with IP addressing in practice, CIDR is more 
important to know. 
 To ensure efﬁ cient routing, Internet designers deﬁ ned a mandate for the leading bits 
section of the address for each different network class. For example, because a router 
knows that a Class A network address always starts with a 0, the router can quickly 
apply the default mask, if necessary, after reading only the ﬁ rst bit of the address. 
Table 12.2 illustrates how the leading bits of a network address are deﬁ ned. When 
considering the subnet masking between network and host addresses, the number of bits 
to mask is important. For example, in a Class A network, 8 bits are masked, making the 
default subnet mask  255.0.0.0 , while in a Class C, 24 bits are masked, making the default 
subnet mask  255.255.255.0 . 
 Some IP addresses are reserved for special purposes and shouldn ’ t be assigned to nodes. 
Table 12.3 lists some of the reserved IP addresses. See RFC 3330 for others.  
Understanding IP Addressing 
499

500 
Chapter 12  Configuring TCP/IP
 TA B L E 12 . 3 Special network addresses 
 Address  
  Function  
  Entire IP address set to all 0s  
  Depending on the mask, this network (that is, the 
network or subnet that you are currently a part of) or this 
host on this network. 
  A routing table entry of all 0s 
with a mask of all 0s 
 Used as the default gateway entry. Any destination 
address masked by all 0s produces a match for the all - 0s 
reference address. Because the mask has no 1s, this is 
the least desirable entry but will be used when no other 
match exists.  
  Network address 127  
  Reserved for loopback tests. Designates the local node 
and allows that node to send a test packet to itself 
without generating network traffic.  
  Node address of all 0s  
  Used when referencing a network without referring to any 
specific nodes on that network. Usually used in routing tables.  
  Node address of all 1s  
  Broadcast address for all nodes on the specified network, 
also known as a  directed broadcast . For example, 
 128.2.255.255 means all nodes on the Class B 
network  128.2 . Routing this broadcast is configurable 
on certain routers. 
  169.254.0.0 with a mask of 
255.255.0.0  
 The  “ link - local ” block used for autoconfiguration and 
communication between devices on a single link. 
Communication cannot occur across routers. Microsoft 
uses this block for Automatic Private IP Addressing 
(APIPA).  
  Entire IP address set to all 1s 
(same as  255.255.255.255 ) 
  10.0.0.0/8 
  172.16.0.0 to  172.31.255.255 
 Broadcast to all nodes on the current network; 
sometimes called a  limited broadcast or an  all - 1s 
broadcast . This broadcast is not routable. 
  192.168.0.0/16 
  The private - use blocks for Classes A, B, and C. As noted 
in RFC 1918, the addresses in these blocks must never 
be allowed into the Internet, making them acceptable for 
simultaneous use behind NAT servers and non - Internet -
 connected IP networks. 
 In the following sections, we will look at the three network types. 
 Class A Networks 
 In a Class A network, the ﬁ rst byte is the network address, and the three remaining bytes 
are used for the node addresses. The Class A format is  Network.Node.Node.Node . 

 For example, in the IP address  49.22.102.70 , the 49 is the network address, and the 
22.102.70 is the node address. Every machine on this particular network would have 
the distinctive network address of 49; within that network, though, you could have a 
large number of machines. 
 There are 126 possible Class A network addresses. Why? The length of a Class A 
network address is 1 byte, and the ﬁ rst bit of that byte is reserved, so 7 bits in the ﬁ rst 
byte remain for manipulation. This means that the maximum number of Class A networks 
is 128. (Each of the 7 bit positions that can be manipulated can be either a 0 or a 1, and 
this gives you a total of 2 7 positions, or 128.) But to complicate things further, it was also 
decided that the network address of all 0s (0000 0000) would be reserved. This means the 
actual number of usable Class A network addresses is 128 minus 1, or 127. Also, 127 is a 
reserved number (a network address of 0 followed by all 1s (0111 1111); so, you actually 
start with 128 addresses minus the two reserved, and you ’ re left with 126 possible Class A 
network addresses. 
 Each Class A network has 3 bytes (24 bit positions) for the node address of a machine, 
which means that there are 2 24 — or 16,777,216 — unique combinations. Because addresses 
with the two patterns of all 0s and all 1s in the node bits are reserved, the actual maximum 
usable number of nodes for a Class A network is 2 24 minus 2, which equals 16,777,214.  
 Class B Networks 
 In a Class B network, the ﬁ rst two bytes are assigned to the network address, and the 
remaining two bytes are used for node addresses. The format is  Network.Network.Node.Node . 
 For example, in the IP address  130.57.30.56 , the network address is 130.57, and the 
node address is 30.56. 
 The network address is 2 bytes, so there would be 2 16 unique combinations. But the 
Internet designers decided that all Class B networks should start with the binary digits 10. 
This leaves 14 bit positions to manipulate; therefore, there are 16,384 (or 2 14 ) unique 
Class B networks. 
 This gives you an easy way to recognize Class B addresses. If the ﬁ rst 2 bits of the ﬁ rst 
byte can be only 10, that gives you a decimal range from 128 up to 191 in the ﬁ rst octet 
of the IP address. Remember that you can always easily recognize a Class B network by 
looking at its ﬁ rst byte — even though there are 16,384 different Class B networks. If the 
ﬁ rst octet in the address falls between 128 and 191, it is a Class B network, regardless of 
the value of the second octet. 
 A Class B network has 2 bytes to use for node addresses. This is 2 16 minus the two 
patterns in the reserved - exclusive club (all 0s and all 1s in the node bits), for a total of 
65,534 possible node addresses for each Class B network.  
 Class C Networks 
 The ﬁ rst 3 bytes of a Class C network are dedicated to the network portion of the address, with 
only 1 byte remaining for the node address. The format is  Network.Network.Network.Node . 
 In the example IP address  198.21.74.102 , the network address is 198.21.74, and the 
node address is 102. 
Understanding IP Addressing 
501

502 
Chapter 12  Configuring TCP/IP
 In a Class C network, the ﬁ rst three bit positions are always binary 110. Three bytes, 
or 24 bits, minus 3 reserved positions leaves 21 positions. There are therefore 2 21 , or 
2,097,152, possible Class C networks. 
 The lead bit pattern of 110 equates to decimal 192 and runs through 223. Remembering 
our handy easy - recognition method, this means you can always spot a Class C address if 
the ﬁ rst byte is in the range 192 – 223, regardless of the values of the second and third bytes 
of the IP address. 
 Each unique Class C network has 1 byte to use for node addresses. This leads to 2 8 , or 
256, minus the two special patterns of all 0s and all 1s, for a total of 254 node addresses 
for each Class C network.  
 Class D networks, used for multicasting only, use the address range 
 224.0.0.0 to  239.255.255.255 and are used, as in broadcasting, as 
destination addresses only. Class E networks (reserved for future use at 
this point) cover  240.0.0.0 to  255.255.255.255 . Addresses in the Class E 
range are considered within the experimental range.  
 Subnetting a Network 
 If an organization is large and has lots of computers, or if its computers are geographically 
dispersed, it makes good sense to divide its colossal network into smaller ones connected 
by routers. These smaller networks are called  subnets . The beneﬁ ts of using subnets include 
the following:  
  Reduced Network Traffic   We all appreciate less trafﬁ c of any kind, and so do networks. 
Without routers, packet trafﬁ c could choke the entire network. Most trafﬁ c will stay on the 
local network — only packets destined for other networks will pass through the router and 
over to another subnet. This trafﬁ c reduction also improves overall performance.  
  Simplified Management   It ’ s easier to identify and isolate network problems in a group of 
smaller networks connected together than within one gigantic one.  
 Understanding the Beneﬁ ts of Subnetting 
 To understand one beneﬁ t of subnetting, consider a hotel or ofﬁ ce building. Say a hotel 
has 1,000 rooms, with 75 rooms to a ﬂ oor. You could start at the ﬁ rst room on the ﬁ rst 
ﬂ oor and number it 1; then when you get to the ﬁ rst room on the second ﬂ oor, you could 
number it 76 and keep going until you reach room 1,000. But someone looking for room 
521 would have to guess which ﬂ oor the room was on. If you were to  “ subnet ” the hotel, 
you would identify the ﬁ rst room on the ﬁ rst ﬂ oor with the number 101 (1   Floor 1 and 
01   Room 1), the ﬁ rst room on the second ﬂ oor with 201, and so on. The guest looking 
for room 521 would go to the ﬁ fth ﬂ oor and look for room 21. 

 An organization with a single network address (comparable to the hotel building 
mentioned in the sidebar  “ Understanding the Beneﬁ ts of Subnetting ” ) can have a subnet 
address for each individual physical network (comparable to a ﬂ oor in the hotel building). 
Each subnet is still part of the shared network address, but it also has an additional 
identiﬁ er denoting its individual subnetwork number. This identiﬁ er is called a  subnet 
address . 
 Subnetting solves several addressing problems: 
 If an organization has several physical networks but only one IP network address, it 
can handle the situation by creating subnets.  
 Because subnetting allows many physical networks to be grouped together, fewer 
entries in a routing table are required, notably reducing network overhead.  
 These things combine to collectively yield greatly enhanced network efﬁ ciency.  
 The original designers of the Internet Protocol envisioned a small Internet with only tens 
of networks and hundreds of hosts. Their addressing scheme used a network address for 
each physical network. As you can imagine, this scheme and the unforeseen growth of the 
Internet created a few problems. The following are two examples:  
 Not Enough Addresses   A single network address can be used to refer to multiple physical 
networks, but an organization can request individual network addresses for each one of its 
physical networks. If all these requests were granted, there wouldn ’ t be enough addresses to 
go around.  
 Gigantic Routing Tables   If each router on the Internet needed to know about every 
physical network, routing tables would be impossibly huge. There would be an 
overwhelming amount of administrative overhead to maintain those tables, and the resulting 
physical overhead on the routers would be massive (CPU cycles, memory, disk space, and so 
on). Because routers exchange routing information with each other, an additional, related 
consequence is that a terriﬁ c overabundance of network trafﬁ c would result. 
 Although there ’ s more than one way to approach these problems, the principal solution 
is the one that we ’ ll cover in this book — subnetting. As you might guess, subnetting is 
the process of carving a single IP network into smaller logical subnetworks. This trick is 
achieved by subdividing the host portion of an IP address to create a subnet address. The 
actual subdivision is accomplished through the use of a subnet mask (covered later in 
the chapter). 
 In the following sections, you will see exactly how to calculate and apply subnetting. 
 Implementing Subnetting 
 Before you can implement subnetting, you need to determine your current requirements 
and plan on how best to implement your subnet scheme. 
■
■
■
Subnetting a Network 
503

504 
Chapter 12  Configuring TCP/IP
 How to Determine Your Subnetting Requirements 
 Follow these guidelines to calculate the requirements of your subnet: 
 1. 
 Determine the number of required network IDs: one for each subnet and one for each 
wide area network (WAN) connection.  
 2. 
  Determine the number of required host IDs per subnet: one for each TCP/IP device, 
including, for instance, computers, network printers, and router interfaces.  
 3. 
  Based on these two data points, create the following:  
 One subnet mask for your entire network  
 A unique subnet ID for each physical segment  
 A range of host IDs for each unique subnet  
 How to Implement Subnetting 
 Subnetting is implemented by assigning a subnet address to each machine on a given 
physical network. For example, in Figure 12.3, each machine on subnet 1 has a subnet 
address of 1. 
■
■
■
The Internet
Router D
This router needs only one
entry for Widget, Inc.
Subnet 1
Router A
Widget, Inc.
130.57
Router C
Router B
Subnet 3
Subnet 2
Subnet 4
1.
 F I G U R E  12 . 3 A sample subnet 

 The default network portion of an IP address can ’ t be altered without encroaching 
on another administrative domain ’ s address space, unless you are assigned multiple 
consecutive classful addresses. In order to maximize the efﬁ cient use of the assigned 
address space, machines on a particular network share the same network address. In 
Figure 2.3, you can see that all the Widget, Inc., machines have a network address of 
130.57. That principle is constant. In subnetting, it ’ s the host address that ’ s manipulated; 
the network address doesn ’ t change. The subnet address scheme takes a part of the host 
address and recycles it as a subnet address. Bit positions are stolen from the host address 
to be used for the subnet identiﬁ er. Figure 12.4 shows how an IP address can be given a 
subnet address. 
 Because the Widget, Inc., network is a Class B network, the ﬁ rst two bytes specify 
the network address and are shared by all machines on the network — regardless of their 
particular subnet. Here, every machine ’ s address on the subnet must have its third byte 
read 0000 0001. The fourth byte, the host address, is the unique number that identiﬁ es the 
actual host within that subnet. Figure 12.5 illustrates how a network address and a subnet 
address can be used together.   
 When implementing subnetting, you need some type of hardware installed onto the 
network. Most of us will just use a router. But if you do not want to purchase an expensive 
router, there is another way. 
Class B address
Class B address with a subnet address
130.57.
1.56
1000 0010. 0011 1001.
0000 0001. 0011 1000
Network address
Host address
1000 0010. 0011 1001.
0000 0001. 0011 1000
Network address
Subnet
Host address
 F I G U R E 12 . 4 Network vs. host addresses 
Subnetting a Network 
505

506 
Chapter 12  Configuring TCP/IP
 One way that you can implement subnetting is by using a Windows Server 2008 R2 
machine with multiple NIC adapters conﬁ gured with routing enabled on the server. This 
type of router is called a multi - homed router. This is an inexpensive way to set up a router 
using a Microsoft server, but it may not be the best way. Many companies specialize in 
routers, and these routers offer many more features and more ﬂ exibility than a multi -
 homed router.  
 
Setting up and configuring a multi - homed router will be covered in detail 
in Chapter 14,  “ Managing Routing and Remote Access. ” 
 How to Use Subnet Masks 
 For the subnet address scheme to work, every machine on the network must know which 
part of the host address will be used as the network address. This is accomplished by 
assigning each machine a subnet mask. 
 The network administrator creates a 32 - bit subnet mask comprised of 1s and 0s. The 1s 
in the subnet mask represent the positions in the IP address that refer to the network and 
subnet addresses. The 0s represent the positions that refer to the host part of the address. 
Figure 12.6 illustrates this combination.  
The Internet
Router D
130.57.1.56
130.57.1.22
Router A
Router C
Router B
130.57.1.70
Subnet 1
 F I G U R E 12 . 5 The network address and its subnet 

 In the Widget, Inc., example, the ﬁ rst two bytes of the subnet mask are 1s because 
Widget ’ s network address is a Class B address, formatted as  Network.Network.Node.Node . 
The third byte, normally assigned as part of the host address, is now used to represent the 
subnet address. Hence, those bit positions are represented with 1s in the subnet mask. 
The fourth byte is the only part of the example that represents the host address. 
 The subnet mask can also be expressed using the decimal equivalents of the binary 
patterns. The binary pattern of 1111 1111 is the same as decimal 255. Consequently, the 
subnet mask in the example can be denoted in two ways, as shown in Figure 12.7.  
Network address
positions
1s = Positions representing network or subnet addresses
1 1 1 1 1 1 1 1. 1 1 1 1 1 1 1 1. 1 1 1 1 1 1 1 1. 0000 0000
0s = Positions representing the host address
Subnet
positions
Host
positions
Subnet mask code
Subnet mask for Widget, Inc.
 F I G U R E 12 .6 The subnet mask revealed 
Subnet mask in binary:
Subnet mask in decimal:
(The spaces in the above example are only for illustrative purposes.
The subnet mask in decimal would actually appear as 255.255.255.0.)
1 1 1
255
255
.
255
.
0
.
.
.
.
1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 0000 0000
 F I G U R E 12 .7 Different ways to represent the same mask 
 Not all networks need to have subnets and therefore don ’ t need to use custom subnet 
masks. In this case, they are said to have a  default subnet mask. This is basically the same 
as saying they don ’ t have a subnet address. Table 12.4 shows the default subnet masks for 
the different classes of networks.  
 TA B L E 12 . 4 Default subnet masks 
 Class  
 Format  
  Default Subnet Mask 
 A 
  Network.Node.Node.Node 
  255.0.0.0 
 B 
  Network.Network.Node.Node 
  255.255.0.0 
 C 
  Network.Network.Network.Node 
  255.255.255.0 
Subnetting a Network 
507

508 
Chapter 12  Configuring TCP/IP
 Once the network administrator has created the subnet mask and assigned it to each 
machine, the IP software applies the subnet mask to the IP address to determine its 
subnet address. The word  mask carries the implied meaning of  “ lens ” in this case — the 
IP software looks at its IP address through the lens of its subnet mask to see its subnet 
address. Figure 12.8 illustrates an IP address being viewed through a subnet mask. 
 In this example, the IP software learns through the subnet mask that, instead of being 
part of the host address, the third byte of its IP address is now going to be used as a subnet 
address. The IP software then looks in its IP address at the bit positions that correspond to 
the mask, which are 0000 0001. 
 The ﬁ nal step is for the subnet bit values to be matched up with the binary numbering 
convention and converted to decimal. In the Widget, Inc., example, the binary - to - 
decimal conversion is simple, as illustrated in Figure 12.9.  
1s = Positions representing network or subnet addresses
1 1 1 1 1 1 1 1. 1 1 1 1 1 1 1 1. 1 1 1 1 1 1 1 1. 0000 0
0
00
1000 0
0.
01
001 1 1 001. 0000 0001. 001 1 1
0
00
0s = Positions representing the host address
Positions relating to the subnet address
Bits relating to the subnet address
Subnet mask:
IP address of a machine on subnet 1:
(Decimal: 130.57.1.56)
Subnet mask code
 F I G U R E  12 . 8 Applying the subnet mask 
Binary numbering convention
Position/value:
Widget third byte:
(continued)
Decimal equivalent:
Subnet address:
0 + 1 = 1
1
4
8
16
32
64
128
2 1
0
0
0
0
0
0
0 1
 F I G U R E 12 . 9 Converting the subnet mask to decimal 
 By using the entire third byte of a Class B address as the subnet address, it is easy to set 
and determine the subnet address. For example, if Widget, Inc., wants to have a subnet 6, 
the third byte of all machines on that subnet will be 0000 0110 (decimal 6 in binary). 

 Using the entire third byte of a Class B network address for the subnet allows for a fair 
number of available subnet addresses. One byte dedicated to the subnet provides eight bit 
positions. Each position can be either a 1 or a 0, so the calculation is 2 8 , or 256. Thus, 
Widget, Inc., can have up to 256 total subnetworks, each with up to 254 hosts. 
 Although RFC 950 prohibits the use of binary all 0s and all 1s as subnet addresses, 
almost all products actually permit this usage today. Microsoft ’ s TCP/IP stack allows it, 
as does the software in most routers (provided you enable this feature — sometimes it ’ s not 
enabled by default). This gives you two additional subnets. However, you should not use a 
subnet of 0 (all 0s) unless all the software on your network recognizes this convention.  
 How to Calculate the Number of Subnets 
 The formulas for calculating the maximum number of subnets and the maximum number 
of hosts per subnet are as follows: 
 2   number of masked bits in subnet mask   maximum number of subnets  
 2   number of unmasked bits in subnet mask  – 2   maximum number of hosts per subnet  
 In the formulas,  masked  refers to bit positions of 1, and  unmasked  refers to positions of 0. 
The downside to using an entire byte of a node address as your subnet address is that you 
reduce the possible number of node addresses on each subnet. As explained earlier, without a 
subnet, a Class B address has 65,534 unique combinations of 1s and 0s that can be used for 
node addresses. The question is, why would you ever want 65,534 hosts on a single physical 
network? The trade - off is acceptable to most who ask themselves this question. 
 If you use an entire byte of the node address for a subnet, you then have only 1 byte for 
the host addresses, leaving only 254 possible host addresses. If any of your subnets will 
be populated with more than 254 machines, you ’ ll have a problem. To solve it, you would 
then need to shorten the subnet mask, thereby lengthening the number of host bits and 
increasing the number of host addresses; this gives you more available host addresses on 
each subnet. A side effect of this solution is that it shrinks the number of possible subnets. 
 Figure 12.10 shows an example of using a smaller subnet address. A company called 
Acme, Inc., expects to need a maximum of 14 subnets. In this case, Acme does not need 
to take an entire byte from the host address for the subnet address. To get its 14 different 
subnet addresses, it needs to snatch only 4 bits from the host address (2 4   16). The host 
portion of the address has 12 usable bits remaining (2 12  – 2   4094). Each of Acme ’ s 16 
subnets could then potentially have a total of 4,094 host addresses; 4,094 machines on 
each subnet should be plenty.  
 An Easier Way to Apply Subnetting 
 Now that you have the basics down of how to subnet, we ’ ll show you an easier way. If 
you have learned a different way and it works for you, stick with it. It does not matter 
how you get to the ﬁ nish line, just as long as you get there. But if you are new to 
subnetting, Figure 12.11 will make it easier for you. 
 This chart may look intimidating, but it ’ s really simple to use once you have used it 
a few times. 
Subnetting a Network 
509

510 
Chapter 12  Configuring TCP/IP
 Remember that on this chart 1s equal subnets and 0s equal hosts. If you 
get this confused, you will get wrong answers in the following exercises.  
 Watch the Y column on the lower end of the chart. This represents the number of 
addresses available to you after the two reserved addresses have been removed. The 
following sections provide some examples.  
Acme, Inc.
Subnet Mask Code
Subnet mask:
Subnet mask:
IP address of a Acme machine:
(Decimal: 132.8.18.60)
Binary:
Decimal:
(The decimal 240 is equal to the binary 1111 0000.)
Positions relating to the subnet address
Bits relating to the subnet address
Binary-to-Decimal Conversions for Subnet Address
1s = Positions representing network or subnet addresses
0s = Positions representing the host address
Network address:
132.8 (Class B; net.net.host.host)
Example IP address:
Decimal:
132
8
18
60
1000 0100.
0011 1 100
0001 0010.
0000 1000.
.
.
.
255
255
240
0
1 111 1 111.
0000 0000
1 111 0000.
1 111 1 111.
1 111 1 111.
0000 0000
1 111 0000.
1 111 1 111.
1000 0100.
0011 1 100
0001 0010.
0000 1000.
.
.
.
Position/value:
Third byte of IP address:
(continue)
Decimal equivalent:
Subnet address for this IP address:
Subnet mask positions:
1
1
1
1
0
0
0
0
128
64
32
16
8
4
2
1
0
0
0
1
0
0
1
0
0 + 16 = 16
16
 F I G U R E 12 .10 An example of a smaller subnet address 

 Subnet Mask Exercise 1: Class C, 10 Hosts per Subnet 
 You have a Class C address, and you require 10 hosts per subnet.  
 1. 
 Write down   255.255.255._____  . The blank area is the number you need to ﬁ ll in.  
 2. 
  Look under the Y column, and choose the ﬁ rst number that is larger than 10 (the 
number of hosts per subnet you need). 
 You should have come up with 14.  
 3. 
  Move across the page, and look at number in the X (Power) column. 
 The power number is 4.  
 4. 
  Go to the top of the chart, and look for the row with exactly four 0s (hosts). Find the 
number at the beginning of the row. 
 The number at the beginning of the row is 240. That ’ s your answer. The subnet mask 
should be  255.255.255.240 . 
0=Hosts, 1=Subnets
2(X)-2=Y
255
254
252
248
240
224
192
128
0
128
1
1
1
1
1
1
1
1
0
64
1
1
1
1
1
1
1
0
0
32
1
1
1
1
1
1
0
0
0
16
1
1
1
1
1
0
0
0
0
8
1
1
1
1
0
0
0
0
0
4
1
1
1
0
0
0
0
0
0
2
1
1
0
0
0
0
0
0
0
1
1
0
0
0
0
0
0
0
0
2x
2x
2x
2x
2x
2x
2x
2x
2x
2x
2x
2x
2x
2x
2x
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
=
=
=
=
=
=
=
=
=
=
=
=
=
=
=
8
16
32
64
128
256
512
1024
2048
4096
8192
16384
32768
65536
131072
-2
-2
-2
-2
-2
-2
-2
-2
-2
-2
-2
-2
-2
-2
-2
6
14
30
62
126
254
510
1022
2046
4094
8190
16382
32766
65534
131070
X (POWER)
X
Y
 F I G U R E 12 .11 TCP/IP v4 subnetting chart 
Subnetting a Network 
511

512 
Chapter 12  Configuring TCP/IP
 Subnet Mask Exercise 2: Class C, 20 Hosts per Subnet 
 You have a Class C address, and you need 20 hosts per subnet.  
 1. 
 Write down   255.255.255._____  . 
 2. 
  Look under the Y column, and ﬁ nd the ﬁ rst number that covers 20 (this should be 30).  
 3. 
  Go across to the power number (5).  
 4. 
  Go to the top part of the chart, and ﬁ nd the row with exactly ﬁ ve 0s from right to left. 
 The number at the beginning of the row is 224. Your answer should be 
 255.255.255.224 . 
 Subnet Mask Exercise 3: Class C, 5 Subnets 
 Now you have a Class C address, and you need ﬁ ve subnets. Remember that subnets are 
represented by 1s in the chart.  
 1. 
 First write down   255.255.255._____  . 
 2. 
  Look under the Y column, and ﬁ nd the ﬁ rst number that covers 5 (should be 6).  
 3. 
  Go across to the power number (should be 3).  
 4. 
  Go to the top part of the chart, and ﬁ nd which row has exactly three 1s (remember 1s 
are for subnets) from left to right. 
 Your answer should be  255.255.255.224 . 
 Subnet Mask Exercise 4: Class B, 1,500 Hosts per Subnet 
 This one is a bit harder. You have a Class B address, and you need 1,500 hosts per subnet. 
Because you have a Class B address, you need to ﬁ ll in the third octet of numbers. The 
fourth octet contains eight 0s.  
 1. 
 Write down   255.255.____.0  . 
 2. 
  Look at the Y column, and ﬁ nd the ﬁ rst number that covers 1,500 (this should be 2,046).  
 3. 
  Go across, and ﬁ nd the power number (this should be 11).  
 4. 
  Remember, you already have eight 0s in the last octet. So, you need only three more. 
Find the row with three 0s. 
 You should come up with an answer of  255.255.248.0 . This actually breaks down to 
 11111111.11111111.11111000.00000000 , and that ’ s how you got the 11 zeros.  
 Subnet Mask Exercise 5: Class B, 3,500 Hosts per Subnet 
 You have a Class B address, and you need 3,500 hosts per subnet.  
 1. 
 Write down   255.255.____.0  . 
 2. 
  Look at the Y column, and ﬁ nd the ﬁ rst number that covers 3,500 (this should be 4,094).  
 3. 
  Go across, and ﬁ nd the power number (should be 12).  

 4. 
  Remember, you already have eight 0s in the last octet, so you need only four more. 
Count for four zeros from right to left. 
 You should come up with an answer of  255.255.240.0 . Again, this actually breaks 
down to  11111111.11111111.11110000.00000000 , and that ’ s how you got the 12 zeros.  
 If you get a question that gives you both the hosts and the subnets, 
always figure out the larger number first. Then, depending on the mask 
you have decided to use, make sure the lower number also is correct with 
that mask.  
 Now try doing the following exercises on your own:
 Class B address  
  Class B address 
 1,000 hosts per subnet  
  25 subnets 
 Class C address  
  Class B address 
 45 hosts per subnet  
  4,000 hosts per subnet 
 192.168.0.0  
  Class B address 
 10 subnets  
  2,000 hosts per subnet 
 
  25 subnets 
 Here are the answers. If any of your answers are wrong, follow the previous examples, 
and try to work them out again:
 Class B address  
  Class B address 
 1,000 hosts per subnet  255.255.252.0 
  25 subnets  255.255.248.0 
 Class C address  
  Class B address 
 45 hosts per subnet  255.255.255.192 
 4,000 hosts per subnet  255.255.240.0 
 192.168.0.0  
  Class B address 
 10 subnets  255.255.255.240 
  2,000 hosts per subnet 
 
  25 subnets  255.255.248.0 
Subnetting a Network 
513

514 
Chapter 12  Configuring TCP/IP
 Applying Subnetting the Traditional Way 
 Sometimes subnetting can be confusing. After all, it can be quite difﬁ cult to remember 
all those numbers. You can step back a minute and take a look at the primary classes 
of networks and how to subnet each one. Let ’ s start with Class C because it uses only 8 
bits for the node address, so it ’ s the easiest to calculate. In the following sections, we will 
explain how to subnet the various types of networks. 
 Subnetting Class C 
 If you recall, a Class C network uses the ﬁ rst 3 bytes (24 bits) to deﬁ ne the network 
address. This leaves you 1 byte (8 bits) with which to address hosts. So if you want to 
create subnets, your options are limited because of the small number of bits available. 
 If you break down your subnets into chunks smaller than the default Class C, then 
ﬁ guring out the subnet mask, network number, broadcast address, and router address can 
be confusing. To build a sturdy base for subnetting, study the following techniques for 
determining these special values for each subnet, but also learn and use the more efﬁ cient 
technique presented in the later section  “ Quickly Identifying Subnet Characteristics 
Using CIDR ” and the earlier section  “ An Easier Way to Apply Subnetting. ” Table 12.5 
summarizes how you can break down a Class C network into one, two, four, or eight 
smaller subnets, and it gives you the subnet masks, network numbers, broadcast addresses, 
and router addresses. The ﬁ rst three bytes have simply been designated x.y.z. (Note that the 
table assumes you can use the all - 0s and all - 1s subnets, too.)  
  Number 
of Desired 
Subnets  
  Subnet Mask  
 Network 
Number  
 Router 
Address  
 Broadcast 
Address  
 Remaining 
Number 
of IP 
Addresses  
  1  
  255.255.255.0 
  x.y.z .0  
  x.y.z .1  
  x.y.z .255  
 253  
  2  
  255.255.255.128 
  x.y.z.0  
  x.y.z.1  
  x.y.z.127  
  125  
   
  255.255.255.128 
  x.y.z.128  
  x.y.z.129  
  x.y.z.255  
  125  
  4  
  255.255.255.192 
  x.y.z.0  
  x.y.z.1  
  x.y.z.63  
 61  
   
  255.255.255.192 
  x.y.z.64  
  x.y.z.65  
  x.y.z.127  
  61  
   
  255.255.255.192 
  x.y.z.128  
  x.y.z.129  
  x.y.z.191  
  61  
   
  255.255.255.192 
  x.y.z.192  
  x.y.z.193  
  x.y.z.255  
  61  
  8  
  255.255.255.224 
  x.y.z.0  
  x.y.z.1  
  x.y.z.31  
  29  
TA B L E 12 . 5 Setting up Class C subnets

 For example, suppose you want to chop up a Class C network,  200.211.192. x  , into 
two subnets. As you can see in the table, you ’ d use a subnet mask of  255.255.255.128 
for each subnet. The ﬁ rst subnet would have network number  200.211.192.0 , router 
address  200.211.192.1 , and broadcast address  200.211.192.127 . You could assign 
IP addresses  200.211.192.2 through  200.211.192.126 — that ’ s 125 additional 
different IP addresses.  
 Heavily subnetting a network results in the loss of a progressively greater 
percentage of addresses to the network number, broadcast address, and 
router address.  
 The second subnet would have network number  200.211.192.128 , router address 
 200.211.192.129 , and broadcast address  200.211.192.255 . 
 Number 
of Desired 
Subnets  
  Subnet Mask  
 Network 
Number  
 Router 
Address  
 Broadcast 
Address  
 Remaining 
Number 
of IP 
Addresses  
 
  255.255.255.224 
  x.y.z.32  
  x.y.z.33  
  x.y.z.63  
 29  
 
  255.255.255.224 
  x.y.z.64  
  x.y.z.65  
  x.y.z.95  
  29  
 
  255.255.255.224 
  x.y.z.96  
  x.y.z.97  
  x.y.z.127  
  29  
 
  255.255.255.224 
  x.y.z.128  
  x.y.z.129  
  x.y.z.159  
 29  
 
  255.255.255.224 
  x.y.z.160  
  x.y.z.161  
  x.y.z.191  
  29  
 
  255.255.255.224 
  x.y.z.192  
  x.y.z.193  
  x.y.z.223  
 29  
 
  255.255.255.224 
  x.y.z.224  
  x.y.z.225  
  x.y.z.255  
  29  
 Why It ’ s Best to Use Routers That Support Subnet 0 
 When subnetting a Class C network using the method in Table 12.5, if you use the 2x  – 2 
calculation, the subnet 128 in the table doesn ’ t make sense. It turns out that there ’ s a 
legitimate and popular reason to do it this way, however: 
 Remember that using subnet 0 is not allowed according to the RFC standards, but by 
using it you can subnet your Class C network with a subnet mask of 128. This uses 
only 1 bit, and according to your calculator 2 1  – 2   0, giving you zero subnets.  
■
Subnetting a Network 
515

516 
Chapter 12  Configuring TCP/IP
 Determining the Subnet Numbers for a Class C Subnet 
 The ﬁ rst subnet always has a 0 in the interesting octet. In the example, it would be 
 200.211.192.0 , the same as the original nonsubnetted network address. To determine the 
subnet numbers for the additional subnets, you ﬁ rst have to determine the incremental value: 
 1. 
  Begin with the octet that has an interesting value (other than 0 or 255) in the subnet 
mask. Then subtract the interesting value from 256. The result is the incremental value. 
 If you again use the network  200.211.192. x  and a mask of  255.255.255.192 , the 
example yields the following equation: 256  – 192   64. So, 64 is your incremental 
value in the interesting octet — the fourth octet in this case. Why the fourth octet? 
That ’ s the octet with the interesting value, 192, in the mask. 
 2. 
  To determine the second subnet number, add the incremental value to the 0 in the 
fourth octet of the ﬁ rst subnet. 
 In the example, it would be  200.211.192.64 . 
 3. 
  To determine the third subnet number, add the incremental value to the interesting 
octet of the second subnet number. 
 In the example, it would be  200.211.192.128 . 
 4. 
  Keep adding the incremental value in this fashion until you reach the actual subnet 
mask number. 
 For example, 0   64   64, so your second subnet is 64. And 64   64 is 128, so your 
third subnet is 128. And 128   64 is 192, so your fourth subnet is 192. Because 192 
is the subnet mask, this is your last subnet. If you tried to add 64 again, you ’ d come up 
with 256, an unusable octet value, which is always what you end up with when you ’ ve 
gone too far. This means your valid subnets are 0, 64, 128, and 192.  
 The numbers between the subnets are your valid host and broadcast addresses. For 
example, the following are valid hosts for two of the subnets in a Class C network with a 
subnet mask of 192: 
 The valid hosts for subnet 64 are in the range 65 – 126, which gives you 62 hosts per 
subnet. 
 (You can ’ t use 127 as a host, because that would mean your host bits would be all 1s. 
The all - 1s format is reserved as the broadcast address for that subnet.)  
 The valid hosts for subnet 128 are in the range 129 – 190, with a broadcast address of 191.  
 As you can see, this solution wastes a few addresses — six more than not subnetting 
at all, to be exact. In a Class C network, this should not be hard to justify. The 
■
■
 By using routers that support subnet 0, you can assign 1 – 126 for hosts and 129 – 254 
for hosts, as stated in the table. This saves a bunch of addresses! If you were to stick 
to the method deﬁ ned by the RFC standards, the best you could gain is a subnet 
mask of 192 (2 bits), which allows you only two subnets (2 2  – 2   2).  
■

 255.255.255.128 subnet mask is an even better solution if you need only two subnets and 
expect to need close to 126 host addresses per subnet.  
 Calculating Values for an Eight - Subnet Class C Network 
 What happens if you need eight subnets in your Class C network? 
 By using the calculation of 2x, where  x is the number of subnet bits, you would need 
three subnet bits to get eight subnets (2 3   8). What are the valid subnets, and what are the 
valid hosts of each subnet? Let ’ s ﬁ gure it out. 
 11100000 is 224 in binary and would be the interesting value in the fourth octet of the 
subnet mask. This must be the same on all workstations.  
 You ’ re likely to see test questions that ask you to identify the problem with 
a given configuration. If a workstation has the wrong subnet mask, the 
router could  “ think ” the workstation is on a different subnet than it actually 
is. When that happens, the misguided router won ’ t forward packets to the 
workstation in question. Similarly, if the mask is incorrectly specified in 
the workstation ’ s configuration, that workstation will observe the mask 
and send packets to the default gateway when it shouldn ’ t.  
 To ﬁ gure out the valid subnets, subtract the interesting octet value from 256 (256  – 224    
32), so 32 is your incremental value for the fourth octet. Of course, the 0 subnet is your ﬁ rst 
subnet, as always. The other subnets would be 32, 64, 96, 128, 160, 192, and 224. The valid 
hosts are the numbers between the subnet numbers, except the numbers that equal all 1s in 
the host bits. These numbers would be 31, 63, 95, 127, 159, 191, 223, and 255. Remember 
that using all 1s in the host bits is reserved for the broadcast address of each subnet. 
 The valid subnets, hosts, and broadcasts are as follows:
 Subnet  
  Hosts  
  Broadcast  
 0 
  1 – 30 
  31 
 32 
  33 – 62 
  63 
 64 
  65 – 94 
  95 
 96 
  97 – 126 
 127 
 128 
  129 – 158 
  159 
 160 
  161 – 190 
  191 
 192 
  193 – 222 
  223 
 224 
  225 – 254 
  255 
Subnetting a Network 
517

518 
Chapter 12  Configuring TCP/IP
 You can add one more bit to the subnet mask just for fun. You were using 3 bits, which 
gave you 224. By adding the next bit, the mask now becomes 240 (11110000). 
 By using 4 bits for the subnet mask, you get 14 subnets because 2 4   16. This subnet 
mask also gives you only 4 bits for the host addresses, or 2 4  – 2   14 hosts per subnet. As 
you can see, the amount of hosts per subnet gets reduced rather quickly for each host bit 
that gets reallocated for subnet use. 
 The ﬁ rst valid subnet for subnet 240 is 0, as always. Because 256  – 240   16, your 
remaining subnets are then 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 
and 240. Remember that the actual interesting octet value also represents the last valid 
subnet, so 240 is the last valid subnet number. The valid hosts are the numbers between the 
subnets, except for the numbers that are all 1s — the broadcast address for the subnet. 
 Table 12.6 shows the numbers in the interesting (fourth) octet for a Class C network 
with eight subnets.  
 TA B L E 12 .6 Fourth - octet addresses for a Class C network with eight subnets 
  Subnet  
  Hosts  
  Broadcast  
  0  
  1 – 14  
  15  
  16  
  17 – 30  
  31  
  32  
  33 – 46  
  47  
  48  
  49 – 62  
  63  
  64  
  65 – 78  
  79  
  80  
  81 – 94  
  95  
  96 
  97 – 110  
  111  
  112  
  113 – 126  
  127  
  128  
 129 – 142  
  143  
  144  
  145 – 158  
  159  
  160  
  161 – 174  
  175  
  176  
  177 – 190  
  191  
  192  
  193 – 206  
  207  
  208  
  209 – 222  
  223  
  224  
  225 – 238  
  239  
  240  
 241 – 254  
  255  

 Subnetting Class B 
 Because a Class B network has 16 bits for host addresses, you have plenty of available bits 
to play with when ﬁ guring out a subnet mask. Remember that you have to start with 
the leftmost bit and work toward the right. For example, a Class B network would look 
like   x.y .0.0 , with the default mask of  255.255.0.0 . Using the default mask would give 
you one network with 65,534 hosts. 
 The default mask in binary is  11111111.11111111.00000000.00000000 . The 1s represent 
the corresponding network bits in the IP address, and the 0s represent the host bits. When 
creating a subnet mask, the leftmost bit(s) will be borrowed from the host bits (0s will be 
turned into 1s) to become the subnet mask. You then use the remaining bits that are still set 
to 0 for host addresses. 
 If you use only 1 bit to create a subnet mask, you have a mask of  255.255.128.0 . If you 
use 2 bits, you have a mask of  255.255.192.0 , or  11111111.11111111.
11000000.00000000 . 
 As with subnetting a Class C address, you now have three parts of the IP address: the 
network address, the subnet address, and the host address. You ﬁ gure out the subnet 
mask numbers the same way as you do with a Class C network (see the previous section, 
 “ Calculating Values for an Eight - Subnet Class C Network ” ), but you ’ ll end up with a lot 
more hosts per subnet. 
 There are four subnets, because 2 2   4. The valid third - octet values for the subnets are 
0, 64, 128, and 192 (256  – 192   64, so the incremental value of the third octet is 64). 
However, there are 14 bits (0s) left over for host addressing. This gives you 16,382 hosts 
per subnet (2 14  – 2   16,382). 
 The valid subnets and hosts are as follows:
 Subnet  
  Hosts  
  Broadcast  
 x.y.0.0 
  x.y.0.1 through  x.y. 63.254 
  x.y.63.255 
 x.y.64.0 
  x.y.64.1 through  x.y.127.254 
  x.y.127.255 
 x.y.128.0 
  x.y.128.1 through  x.y.191.254 
  x.y.191.255 
 x.y.192.0 
  x.y.192.1 through  x.y.255.254 
  x.y.255.255 
 You can add another bit to the subnet mask, making it  11111111.11111111.11100000
.00000000 or  255.255.224.0 . This gives you eight subnets (2 3   8) and 8,190 hosts. The 
Subnetting a Network 
519

520 
Chapter 12  Configuring TCP/IP
valid subnets are 0, 32, 64, 96, 128, 160, 192, and 224 (256  – 224   32). The 
subnets, valid hosts, and broadcasts are listed here:
 Subnet  
 Hosts  
  Broadcast  
 x.y.0.0 
  x.y.0.1 through  x.y.31.254 
  x.y.31.255 
 x.y.32.0 
  x.y.32.1 through  x.y.63.254 
  x.y.63.255 
 x.y.64.0 
  x.y.64.1 through  x.y.95.254 
  x.y.95.255 
 x.y.96.0 
  x.y.96.1 through  x.y.127.254 
  x.y.127.255 
 x.y.128.0 
  x.y.128.1 through  x.y.159.254 
 x.y.159.255 
 x.y.160.0 
  x.y.160.1 through  x.y.191.254 
 x.y.191.255 
 x.y.192.0 
  x.y.192.1 through  x.y.223.254 
 x.y.223.255 
 x.y.224.0 
  x.y.224.1 through  x.y.255.254 
 x.y.255.255 
 The following are the breakdowns for a 9 - bit mask and a 14 - bit mask: 
 If you use 9 bits for the mask, it gives you 512 subnets (2 9 ). With only 7 bits for hosts, 
you still have 126 hosts per subnet (2 7  – 2   126). The mask looks like this: 
 11111111.11111111.11111111.10000000 or  255.255.255.128 
 If you use 14 bits for the subnet mask, you get 16,384 subnets (2 14 ) but only two hosts 
per subnet (2 2  – 2   2). The subnet mask would look like this: 
 11111111.11111111.11111111.11111100 or  255.255.255.252 
■
■
 Subnet Mask Use in an ISP 
 You may be wondering why you would use a 14 - bit subnet mask with a Class B address. 
This approach is actually very common. Let ’ s say you have a Class B network and use 
a subnet mask of  255.255.255.0 . You ’ d have 256 subnets and 254 hosts per subnet. 
Imagine also that you are an Internet service provider (ISP) and have a network with 
many WAN links, a different one between you and each customer. Typically, you ’ d have 
a direct connection between each site. Each of these links must be on its own subnet or 
network. There will be two hosts on these subnets — one address for each router port. 
If you used the mask described earlier ( 255.255.255.0 ), you would waste 252 host 
addresses per subnet. But using the  255.255.255.252 subnet mask, you have more 
subnets available, which means more customers — each subnet with only two hosts, 
which is the maximum allowed on a point - to - point circuit. 

 Subnetting Class A 
 Class A networks have even more bits available than Class B and Class C networks. A 
default Class A network subnet mask is only 8 bits, or  255.0.0.0 , giving you a whopping 
24 bits for hosts to play with. Knowing which hosts and subnets are valid is a lot more 
complicated than it was for either Class B or Class C networks. 
 If you use a mask of  11111111.1111111.00000000.00000000 , or  255.255.0.0 , you ’ ll 
have 8 bits for subnets, or 256 subnets (2 8 ). This leaves 16 bits for hosts, or 65,534 hosts 
per subnet (2 16  – 2   65534). 
 If you split the 24 bits evenly between subnets and hosts, you would give each one 
12 bits. The mask would look like this:  11111111.11111111.11110000.00000000 , or 
 255.255.240.0 . How many valid subnets and hosts would you have? The answer is 4,096 
subnets each with 4,094 hosts (2 12  – 2   4094). 
 The second octet will be somewhere between 0 and 255. However, you will need to 
ﬁ gure out the third octet. Because the third octet has a 240 mask, you get 16 (256  – 240   
16) as your incremental value in the third octet. The third octet must start with 0 for the 
ﬁ rst subnet, the second subnet will have 16 in the third octet, and so on. This means that 
some of your valid subnets are as follows (not in order):
 Subnet  
  Hosts  
  Broadcast  
 x.0 - 255.0.0 
  x.0 - 255.0.1 through  x.0 - 255.15.254 
  x.0 - 255.15.255 
 x.0 - 255.16.0 
  x.0 - 255.16.1 through  x.0 - 255.31.254 
 x.0 - 255.31.255 
 x.0 - 255.32.0 
  x.0 - 255.32.1 through  x.0 - 255.47.254 
 x.0 - 255.47.255 
 x.0 - 255.48.0 
  x.0 - 255.48.1 through  x.0 - 255.63.254 
 x.0 - 255.63.255 
 They go on in this way for the remaining third - octet values through 224 in the subnet 
column. 
 You can use the  255.255.255.252 subnet mask only if you are running a routing 
algorithm such as Enhanced Interior Gateway Routing Protocol (EIGRP) or Open Shortest 
Path First (OSPF), discussed in Chapter 5,  “ Conﬁ guring Sites and Replication. ” These 
routing protocols allow what is called  variable - length subnet masking (VLSM). VLSM 
allows you to run the  255.255.255.252 subnet mask on your interfaces to the WANs and 
run  255.255.255.0 on your router interfaces in your local area network (LAN), using the 
same classful network address for all subnets. It works because these routing protocols 
transmit the subnet mask information in the update packets that they send to the other 
routers. Classful routing protocols, such as RIP version 1, don ’ t transmit the subnet mask 
and therefore cannot employ VLSM. 
Subnetting a Network 
521

522 
Chapter 12  Configuring TCP/IP
 Working with Classless Inter - Domain Routing 
 Microsoft uses an alternate way to write address ranges, called Classless Inter - Domain 
Routing (CIDR; pronounced  “ cider ” ). CIDR is a shorthand version of the subnet mask. For 
example, an address of  131.107.2.0 with a subnet mask of  255.255.255.0 is listed in CIDR 
as  131.107.2.0/24 because the subnet mask contains twenty - four 1s. An address listed as 
 141.10.32.0/19 would have a subnet mask of  255.255.224.0 , or nineteen 1s (the default 
subnet mask for Class B plus 3 bits). This is the nomenclature used in all Microsoft exams 
(see Figure 12.12). 
Subnet mask in binary:
Subnet mask in decimal:
(The spaces in the above example are only for illustrative purposes.
The subnet mask in decimal would actually appear as 255.255.255.0.)
1 1 1
255
255
.
255
.
0
.
.
.
.
1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 0000 0000
 F I G U R E 12 .12 Subnet mask represented by 1s 
 Let ’ s say an Internet company has assigned you the following Class C address and CIDR 
number:  192.168.10.0 /24 . This represents the Class C address of  192.168.10.0 and a 
subnet mask of  255.255.255.0 . 
 Again, CIDR represents the number of 1s turned on in a subnet mask. For example, a 
CIDR number of  /16  stands for  255.255.0.0 ( 11111111.11111111.00000000.00000000 ). 
 The following is a list of all the CIDR numbers (starting with a Class A default subnet 
mask) and their corresponding subnet masks. 
 CIDR  
  Mask  
  CIDR  
  Mask  
  CIDR  
  Mask  
 /8 
  255.0.0.0 
  /17 
 255.255.128.0 
  /25 
  255.255.255.128 
 /9 
  255.128.0.0 
  /18 
 255.255.192.0 
  /26 
  255.255.255.192 
 /10 
  255.192.0.0 
  /19 
 255.255.224.0 
  /27 
  255.255.255.224 
 /11 
  255.224.0.0 
  /20 
 255.255.240.0 
  /28 
  255.255.255.240 
 /12 
  255.240.0.0 
  /21 
 255.255.248.0 
  /29 
  255.255.255.248 
 /13 
  255.248.0.0 
  /22 
 255.255.252.0 
  /30 
  255.255.255.252 
 /14 
  255.252.0.0 
  /23 
 255.255.254.0 
  /31 
  255.255.255.254 
 /15 
  255.254.0.0 
  /24 
 255.255.255.0 
  /32 
  255.255.255.255 
 /16 
  255.255.0.0 
  
  
  
  

 Quickly Identifying Subnet Characteristics Using CIDR 
 Given the limited time you have to dispatch questions in the structured environment of a 
Microsoft certiﬁ cation exam, every shortcut to coming up with the correct answer is a plus. 
The following method, using CIDR notation, can shave minutes off the time it takes you to 
complete a single question. Since you already understand the underlying binary technology 
at the heart of subnetting, you can use the following shortcuts, one for each address class, 
to come up with the correct answer without working in binary. 
 Identifying Class C Subnet Characteristics 
 Consider the host address  192.168.10.50/27 . The following steps ﬂ esh out the details of the 
subnet of which this address is a member: 
 1. 
 Obtain the CIDR - notation preﬁ x length for the address by converting the dotted -
 decimal mask to CIDR notation. 
 In this case,  /27 corresponds to a mask of  255.255.255.224 . Practice converting 
between these notations until it becomes second nature.  
 2. 
  Using the closest multiple of 8 that is greater than or equal to the preﬁ x length, 
compute the interesting octet (the octet that increases from one subnet to the next 
in increments other than 1 or 0). Divide this multiple by 8. The result is a number 
corresponding to the octet that is interesting. 
 In this case, the next multiple of 8 greater than 27 is 32. Dividing 32 by 8 produces the 
number 4, pointing to the fourth octet as the interesting one.  
 3. 
  To compute the incremental value in the interesting octet, subtract the preﬁ x length 
from the next higher multiple of 8, which in this case is 32. The result (32  – 27) is 5. 
Raise 2 to the computed value (2 5   32). The result is the incremental value of the 
interesting octet.  
 4. 
  Recall the value of the interesting octet from the original address (50 in this case). 
Starting with 0, increment by the incremental value until the value is exceeded. The 
values, then, are 0, 32, 64, and so on.  
 5. 
  The subnet in question extends from the increment that is immediately less than or 
equal to the address ’ s interesting octet value to the address immediately before the next 
increment. In this example,  192.168.10.50/27 belongs to the subnet  192.168.10.32 , 
and this subnet extends to the address immediately preceding  192.168.10.64 , which is 
its broadcast address,  192.168.10.63 . 
 Note that if the interesting octet is not the fourth octet, all octets after the interesting 
octet must be set to 0 for the subnet address.  
 6. 
  The usable range of addresses for the subnet in question extends from one higher 
than the subnet address to one less than the broadcast address, making the range 
for the subnet in question  192.168.10.33 through  192.168.10.62 . As you can see, 
 192.168.10.50/27 deﬁ nitely falls within the subnet  192.168.10.32/27 . 
Subnetting a Network 
523

524 
Chapter 12  Configuring TCP/IP
 Identifying Class B Subnet Characteristics 
 Using the steps in the previous section, ﬁ nd the subnet in which the address  172.16.76.12 
with a mask of  255.255.240.0 belongs: 
 1. 
 The corresponding CIDR notation preﬁ x length is  /20 . 
 2. 
  The next multiple of 8 that is greater than 20 is 24. 24   8   3. Octet 3 is interesting.  
 3. 
  24  – 20   4, so the incremental value is 2 4   16. 
 4. 
  The increments in the third octet are 0, 16, 32, 48, 64, 80, and so on.  
 5. 
  The increments of 64 and 80 bracket the address ’ s third - octet value of 76, making the 
subnet in question  172.16.64.0 , after setting all octets after the interesting octet to 0. 
This subnet ’ s broadcast address is  172.16.79.255 , which comes right before the next 
subnet address of  172.16.80.0 . 
 6. 
  The usable address range, then, extends from  172.16.64.1 through  172.16.79.254 . 
 Identifying Class A Subnet Characteristics 
 Try it one more time with  10.6.127.255/14 . Combine some of the related steps, if possible: 
 1. 
 The preﬁ x length is 14. The next multiple of 8 that is greater than or equal to 14 is 16. 
16   8   2, so the second octet is interesting.  
 2. 
  16  – 14   2, so the incremental value in the second octet is 2 2   4. 
 3. 
  The corresponding second - octet value of 6 in the address falls between the 4 and 8 
increments. This means that the subnet in question is  10.4.0.0 (setting octets after the 
second one to 0) and its broadcast address is  10.7.255.255 . 
 4. 
  The usable address range is from  10.4.0.1 through  10.7.255.254 . 
 Determining Quantities of Subnets and Hosts 
 The general technique described in the previous section also is useful when trying to 
determine the total number of subnets and hosts produced by a given mask with respect 
to the default mask of the class of address in question. 
 Consider, for example, the Class B address  172.16.0.0 with a subnet mask of 
 255.255.254.0 . 
 This is a preﬁ x length of 23 bits. When you subtract the default preﬁ x length for a 
Class B address of 16 from 23, you get the value 7. Raising 2 to the 7th power results in 
the value 128, which is the number of subnets you get when you subnet a Class B address 
with the  255.255.254.0 mask. 
 Determining the number of hosts available in each of these 128 subnets is simple 
because you always subtract the preﬁ x length that the subnet mask produces — 23 in this 
example — from the value 32, which represents the total number of bits in any IP address. 
The difference, 9, represents the remaining number of 0s, or host bits, in the subnet mask. 
Raising 2 to this value produces the total possible number of host IDs per subnet that this 
subnet mask allows. Remember to subtract 2 from this result to account for the subnet and 

broadcast addresses for each subnet. This gives you the actual number of usable host IDs 
per subnet. In this case, this value is 2 9  – 2   510. 
 Repeated practice with this technique will reduce your time to obtain the desired answer 
to mere seconds, leaving more time for the more challenging tasks in each question. You 
have a wealth of examples and scenarios in this chapter, as well as in the review questions, 
on which to try your technique and build your faith in this faster method.  
 Understanding IPv6 
 Internet Protocol version 6 (IPv6) is the ﬁ rst major revamping of IP since RFC 791 was 
accepted in 1981. Yes, the operation of IP has improved, and there have been a few bells 
and whistles added (such as NAT, for example), but the basic structure is still being used as 
it was originally intended. IPv6 has actually been available to use in Microsoft operating 
systems since NT 4.0, but it always had to be manually enabled. Microsoft Vista was the 
ﬁ rst Microsoft operating system to have it enabled by default. It is also enabled by default 
in Windows 7, Windows Server 2008, and Windows Server 2008 R2 (and probably will 
be in all Microsoft operating systems from this point on). 
 TCP and UDP — as well as the IP applications such as HTTP, FTP, SNMP, and the 
rest — are still being used in IPv4. So, you might ask, why change to the new version? 
What does IPv6 bring to your networking infrastructure? What is the structure of an IPv6 
address? How is it implemented and used within Windows Server 2008 R2? We ’ ll answer 
all those questions and more in the following sections. 
 IPv6 History and Need 
 In the late 1970s, as the IP speciﬁ cations were being put together, the vision of the 
interconnected devices was limited compared to what we actually have today. To get an 
idea of the growth of the Internet, take a look at Hobbes ’ Internet Timeline in RFC 2235 
( www.faqs.org/rfcs/rfc2235.html ). As you can see, in 1984, the number of hosts ﬁ nally 
surpassed 1,000 — two years after TCP and IP were introduced. With 32 bits of addressing 
available in IPv4, it handled the 1,000+ hosts just ﬁ ne. And even with the number of hosts 
breaking the 10,000 mark in 1987 and then 100,000 in 1989, there were still plenty of IP 
addresses to go around. But when the number of hosts exceeded 2 million in 1992 and 
3 million in 1994, concern in the industry started to build. So, in 1994 a working group 
was formed to come up with a solution to the quickly dwindling usable address availability 
in the IPv4 space. Internet Protocol next generation (IPng) was starting. 
 Have you heard of IP address depletion being a problem today? Probably not as much. 
When the working group realized it could not have IPv6 standardized before the available 
addresses might run out, they developed and standardized Network Address Translation 
(NAT) as an interim solution. NAT — or, more speciﬁ cally, an implementation of NAT 
called Port Address Translation (PAT) — is taking care of a big portion of the problem. 
Understanding IPv6 
525

526 
Chapter 12  Configuring TCP/IP
 NAT works very well, but it does have some limitations, including issues of peer - to -
 peer applications with their IPv4 addresses embedded in the data, issues of end - to - end 
traceability, and issues of overlapping addresses when two networks merge. Because all 
devices in an IPv6 network will have a unique address and no network address translation 
will take place, the global addressing concept of IPv4 will be brought back (the address 
put on by the source device will stay all the way to the destination). With the new - and -
 improved functionality of IPv6, the drawbacks of NAT, and the limitations of IPv4, will be 
eliminated.  
 IPv6 New and Improved Concepts 
 Several elements of the IPv4 protocol could use some enhancements. Fortunately, IPv6 
incorporates enhancements as well as new features directly into the protocol speciﬁ cation 
to provide better and additional functionality. 
 The new concepts and new implementations of old concepts in IPv6 include the following: 
 Larger address space (128 - bit vs. 32 - bit)  
 Autoconﬁ guration of Internet - accessible addresses with or without DHCP (without 
DHCP it ’ s called  stateless autoconﬁ guration ) 
 More efﬁ cient IP header (fewer ﬁ elds and no checksum)  
 Fixed - length IP header (the IPv4 header is variable length) with extension headers 
beyond the standard ﬁ xed length to provide enhancements  
 Built - in IP mobility and security (although available in IPv4, the IPv6 implementation 
is a much better implementation)  
 Built - in transition schemes to allow integration of the IPv4 and IPv6 spaces 
 ARP broadcast messages replaced with multicast request  
 Here are more details about these features:  
  128 - Bit Address Space   The new 128 - bit address space will provide unique addresses 
for the foreseeable future. Although we would like to say we will never use up all the 
addresses, history may prove us wrong. The number of unique addresses in the IPv6 space 
is 2 128 , or 3.4   10 38 , addresses. How big is that number? It ’ s enough for toasters and 
refrigerators (and maybe even cars) to all have their own addresses. 
 As a point of reference, the nearest black hole to Earth is 1,600 light years away. If you 
were to stack 4mm BB pellets from here to the nearest black hole and back, you would need 
1.51   10 22 BBs. This means you could uniquely address each BB from Earth to the black 
hole and back and still have quite a few addresses left over. 
 Another way to look at it is that the IPv6 address space is big enough to provide more than 
1 million addresses per square inch of the surface area of the earth (oceans included).  
  Autoconfiguration and Stateless Autoconfiguration   Autoconﬁ guration is another added/
improved feature of IPv6. We ’ ve used DHCP for a while to assign IP addresses to client 
■
■
■
■
■
■
■

machines. You should even remember that APIPA can be used to automatically assign 
addresses to Microsoft DHCP client machines in the absence of a DHCP server. The 
problem with APIPA is that it conﬁ nes communication between machines to a local LAN 
(no default gateway). What if a client machine could ask whether there was a router on the 
LAN and what network it was on? If the client machine knew that, it could not only assign 
itself an address, but it could also choose the appropriate network and default gateway. The 
stateless autoconﬁ guration functionality of IPv6 allows the clients to do this. 
 Improved IPv6 Header   The IPv6 header is more efﬁ cient than the IPv4 header because it 
is ﬁ xed length (with extensions possible) and has only a few ﬁ elds. The IPv6 header consists 
of a total of 40 bytes, as described in the following list: 
 32 bytes : Source and destination IPv6 addresses 
 8 bytes : Version ﬁ eld, trafﬁ c class ﬁ eld, ﬂ ow label ﬁ eld, payload length ﬁ eld, next 
header ﬁ eld, and hop limit ﬁ eld  
 You don ’ t have to waste your time with a checksum validation anymore, and you don ’ t 
have to include the length of the IP header (it ’ s fixed in IPv6; the IP header is variable 
length in IPv4, so the length must be included as a field).  
 IPv6 Mobility   IPv6 is only a replacement of the OSI layer 3 component, so you ’ ll continue 
to use the TCP (and UDP) components as they currently exist. IPv6 addresses a TCP issue, 
though. Speciﬁ cally, TCP is connection oriented, meaning you establish an end - to - end 
communication path with sequencing and acknowledgments before you ever send any 
data, and then you have to acknowledge all the pieces of data sent. You do this through a 
combination of an IP address, port number, and port type (socket). 
 If the source IP address changes, the TCP connection may be disrupted. But then, how 
often does this happen? Well, it happens more and more often, as more people are walking 
around with a wireless laptop or a wireless Voice over IP (VoIP) telephone. IPv6 mobility 
establishes a TCP connection with a home address, and when changing networks, it 
continues to communicate with the original endpoint from a care - of address as it changes 
LANs, which sends all traffic back through the home address. The handing off of network 
addresses does not disrupt the TCP connection state (the original TCP port number 
and address remain intact).  
 Improved Security   Unlike IPv4, IPv6 has security built in. Internet Protocol Security 
(IPsec) is a component used today to authenticate and encrypt secure tunnels from a source 
to a destination. This can be from the client to the server or between gateways. IPv4 lets 
you do this by enhancing IP header functionality (basically adding a second IP header while 
encrypting everything behind it). In IPv6, you add this as standard functionality by using 
extension headers. Extension headers are inserted into the packet only if they are needed. 
Each header has a  “ next header ” ﬁ eld, which identiﬁ es the next piece of information. 
The extension headers currently identiﬁ ed for IPv6 are Hop - By - Hop Options, Routing, 
Fragment, Destination Options, Authentication, and Encapsulating Security Payload. The 
Authentication header and the Encapsulating Security Payload header are the IPsec - speciﬁ c 
control headers.  
■
■
Understanding IPv6 
527

528 
Chapter 12  Configuring TCP/IP
  IPv4 to IPv6 Interoperability   Several mechanisms in IPv6 make the IPv4 to IPv6 
transition easy: 
 A simple dual - stack implementation where both IPv4 and IPv6 are installed and used is 
certainly an option. In most situations (so far), this doesn ’ t work so well, because most 
of us aren ’ t connected to an IPv6 network and our Internet connection is not IPv6 even 
if we ’ re using IPv6 internally. So, Microsoft includes other mechanisms that can be 
used in several different circumstances.  
 Intra - Site Automatic Tunnel Addressing Protocol (ISATAP) is an automatic tunnel-
ing mechanism used to connect an IPv6 network to an IPv4 address space (not using 
NAT). ISATAP treats the IPv4 space as one big logical link connection space.  
 6to4 is a mechanism used to transition to IPv4. This method, like ISATAP, treats 
the IPv4 address space as a logical link layer with each IPv6 space in transition using 
a 6to4 router to create endpoints using the IPv4 space as a point - to - point connec-
tion (kind of like a WAN, eh?). 6to4 implementations still do not work well through 
a NAT, although a 6to4 implementation using an Application layer gateway (ALG) is 
certainly doable.  
 Teredo is a mechanism that allows users behind a NAT to access the IPv6 space by 
tunneling IPv6 packets in UDP.  
 Pseudo - interfaces are used in these mechanisms to create a usable interface for the 
operating system. Another interesting feature of IPv6 is that addresses are assigned to 
interfaces (or pseudo - interfaces), not simply to the end node. Your Windows Server 2008 
R2 will have several unique IPv6 addresses assigned.  
  New Broadcast Methods   IPv6 has moved away from using broadcasting. The three 
types of packets used in IPv6 are unicast, multicast, and anycast. IPv6 clients then must 
use one of these types to get the MAC address of the next Ethernet hop (default gateway). 
IPv6 makes use of multicasting for this along with the new functionality called  neighbor 
discovery . Not only does ARP utilize new functionality, but ICMP (also a layer 3 protocol) 
has been redone and is now known as ICMP6. ICMP6 is used for messaging (packet too 
large, time exceeded, and so on) as it was in IPv4, but now it ’ s also used for the messaging 
of IPv6 mobility. ICMP6 echo request and ICMP6 echo reply are still used for  ping . 
 IPv6 Addressing Concepts 
 You need to consider several concepts when using IPv6 addressing. For starters, the format 
of the address has changed. Three types of addresses are used in IPv6 with some predeﬁ ned 
values within the address space. You need to get used to seeing these addresses and be able 
to identify their uses. 
 IPv6 Address Format 
 For the design of IPv4 addresses, you present addresses as octets or the decimal (base 10) 
representation of 8 bits. Four octets add up to the 32 bits required. IPv6 expands the address 
space to 128 bits, and the representation is for the most part shown in hexadecimal (a notation 
used to represent 8 bits using the values 0 – 9 and A – F). Figure 12.13 compares IPv4 to IPv6.  
■
■
■
■

IPv4
ddd
ddd
ddd
ddd
ddd = 8 Bits in Dotted Decimal Notation
            32 Bits Total
IPv6
hhhh
hhhh
hhhh
hhhh
hhhh
hhhh
hhhh
hhhh
hhhh = 16 Bits in Hexadecimal Notation
              128 Bits Total
 F I G U R E 12 .13 IPv4/IPv6 comparison 
 An example of a full IPv6 address looks like this: 
2001:0DB8:0000:0000:1234:0000:A9FE:133E 
 You can tell the implementation of DNS will make life a lot easier for even those who like 
to ping the address in lieu of the name. Fortunately, DNS already has the ability to handle 
IPv6 addresses with the use of an AAAA record. ( A is short for  alias .) An A record in IPv4 ’ s 
addressing space is 32 bits, so an AAAA record — four As — is 128 bits. The Windows Server 
2008 R2 DNS server handles the AAAA and the reverse pointer (PTR) records for IPv6. 
 IPv6 Address Shortcuts 
 There are several shortcuts for writing an IPv6 address, described in the following list: 
 :0: stands for :0000:.  
 You can omit preceding 0s in any 16 - bit word. For example, :DB8: and :0DB8: are 
equivalent.  
 :: is a variable standing for enough zeros to round out the address to 128 bits. :: can be 
used only once in an address.  
 You can use these shortcuts to represent the example address  2001:0DB8:0000:0000:123
4:0000:A9FE:133E as shown here: 
 Compress :0000: into :0:: 
 2001:0DB8:0000:0000:1234:0:A9FE:133E 
 Eliminate preceding zeros: 
 2001:DB8:0000:0000:1234:0:A9FE:133E 
 Use the special variable shortcut for multiple 0s: 
 2001:DB8::1234:0:A9FE:133E 
■
■
■
■
■
■
Understanding IPv6 
529

530 
Chapter 12  Configuring TCP/IP
 You also now use preﬁ x notation or slash notation when discussing IPv6 networks. For 
example, the network of the previous address can be represented as  2001:DB8:0000:0000:0
000:0000:0000:0000 . This can also be expressed as  2001:DB8:: /32 . The  /32  indicates 32 
bits of network, and 2001:DB8: is 32 bits of network.  
 IPv6 Address Assignment 
 So, do you subnet IPv6? The answer depends on your deﬁ nition of subnetting. If you are 
given 32 bits of network from your ISP, you have 96 bits to work with. If you use some of 
the 96 bits to route within your network infrastructure, then you are subnetting. In this 
context, you do subnet IPv6. However, given the huge number of bits you have available, 
you will no longer need to implement VLSM. For example, Microsoft has a network space 
of  2001:4898:: /32 . That gives the administrators a space of 96 bits (2 96   79,228,162,51
4,264,337,593,543,950,336 unique addresses using all 96 bits) to work with. 
 You can let Windows Server 2008 R2 dynamically/automatically assign its IPv6 address, 
or you can still assign it manually (see Figure 12.14). With dynamic/automatic assignment, 
the IPv6 address is assigned either by a DHCPv6 server or by the Windows Server 2008 R2 
machine. If no DHCPv6 server is conﬁ gured, the Windows Server 2008 R2 can query the 
local LAN segment to ﬁ nd a router with a conﬁ gured IPv6 interface. If so, the server will 
assign itself an address on the same IPv6 network as the router interface and set its default 
gateway to the router interface ’ s IPv6 address. Figure 12.14 shows that you have the same 
dynamic and manual choices as you do in IPv4; however, the input values for IPv6 must 
conform to the new format.  
 F I G U R E 12 .14 TCP/IPv6 Properties window 
 To see your conﬁ gured IP addresses (IPv4 and IPv6), you can still use the  ipconfig  
command. For example, we have conﬁ gured a static IPv4 address and an IPv6 address on our 
server. The IPv6 address is the same as used in the earlier IPv6 example address. Figure 12.15 
shows the result of this command on Windows Server 2008 R2 for our server.  

 IPv6 Address Types 
 There are three types of addresses in IPv6: unicast, multicast, and anycast.  
 Note the absence of the broadcast type, which is included in IPv4. You 
can ’ t use broadcasts in IPv6; they ’ ve been replaced with multicasts.  
 Anycast Addresses   Anycast addresses are not really new. The concept of anycast existed 
in IPv4 but was not widely used. An anycast address is an IPv6 address assigned to multiple 
devices (usually different devices). When an anycast packet is sent, it is delivered to one of 
the devices, usually the closest one.  
 Unicast Addresses  A unicast packet uniquely identiﬁ es an interface of an IPv6 device. The 
interface can be a virtual or pseudo - interface or a real (physical) interface. 
 Unicast addresses come in several types, as described in the following list:
 Global Unicast Address   As of this writing, the global unicast address space is deﬁ ned as 
2000:: /3. The 2001::/32 networks are the IPv6 addresses currently being issued to business 
entities. As mentioned, Microsoft has been allocated  2001:4898:: /32 . A Microsoft 
DHCPv6 server would be set up with scopes (ranges of addresses to be assigned) within 
this address space. There are some special addresses and address formats you will see 
in use as well. You ’ ll ﬁ nd most example addresses listed as 2001:DB8:: /32; this space 
has been reserved for documentation. Do you remember the loopback address in IPv4, 
 127.0.0.1 ? In IPv6 the loopback address is ::1 (or  0:0:0:0:0:0:0:0001 ). You may also 
see an address with dotted decimal used. A dual - stack Windows Server 2008 R2 may 
also show you  FE80::5EFE:192.168.1.200 . This address form is used in an integration/
migration model of IPv6 (or if you just can ’ t leave the dotted decimal era, we suppose).  
 Link - Local Address   Link - local addresses are deﬁ ned as FE80:: /10. If you refer to 
Figure 2.15 showing the  ipconfig command, you will see the link - local IPv6 address 
as  fe80::a425:ab9d:7da4:ccba . The last 8 bytes (64 bits) are random to ensure a high 
probability of randomness for the link - local address. 
 F I G U R E 12 .15 IPv6 configuration as seen from the command prompt 
Understanding IPv6 
531

532 
Chapter 12  Configuring TCP/IP
 The link - local address is to be used on a single link (network segment) and should never 
be routed. 
 There is another form of the local - link IPv6 address called the Extended User Interface 
64 - bit (EUI - 64) format. This is derived by using the MAC address of the physical 
interface and inserting an FFFE between the third and fourth bytes of the MAC. The 
first byte is also made 02 (this sets the universal/local or U/L bit to 1 as defined in 
IEEE 802 frame specification). Again looking at Figure 2.15, the EUI - 64 address would 
take the physical (MAC) address  00 - 03 - FF - 11 - 02 - CD and make the link - local IPv6 
address  FE80::0203:FFFF:FE11:02CD . (We ’ ve left the preceding zeros in the link - local 
IPv6 address to make it easier for you to pick out the MAC address with the  “ FFFE ” 
inserted.)  
 AnonymousAddress   Microsoft Server 2008 R2 uses the random address by default 
instead of EUI - 64. The random value is called the AnonymousAddress in Microsoft 
Server 2008 R2. It can be modiﬁ ed to allow the use of EUI - 64. 
 Unique Local Address   The unique local address can be  FC00  or  FD00  and is used like 
the private address space of IPv4. RFC 4193 describes unique local addresses. They are 
not expected to be routable on the global Internet. They are used for private routing 
within an organization.  
  Multicast Address   Multicast addresses are one - to - many communication packets. 
Multicast packets are identiﬁ able by their ﬁ rst byte (most signiﬁ cant byte, leftmost byte, 
leftmost 2 nibbles, leftmost 8 bits, and so on). A multicast address is deﬁ ned as  FF00::/8 . 
 In the second byte shown (the  “  00  ” of  FF00 ), the second  0  is what ’ s called the  scope . 
Interface - local is  01 , and link - local is  02 .  FF01::  is an interface - local multicast. 
 There are several well - known (already defined) multicast addresses. For example, if you 
want to send a packet to all nodes in the link - local scope, you send the packet to  FF02::1  
(also shown as  FF02:0:0:0:0:0:0:1 ). The all - routers multicast address is  FF02::2  
 You can also use multicasting to get the logical link layer address (MAC address) of a 
device you are trying to communicate with. Instead of using the ARP mechanism of 
IPv4, IPv6 uses the ICMPv6 neighbor solicitation (NS) and neighbor advertisement (NA) 
messages. The NS and NA ICMPv6 messages are all part of the new Neighbor Discovery 
Protocol (NDP). This new ICMPv6 functionality also includes router solicitation and router 
advertisements as well as redirect messages (similar to the IPv4 redirect functionality).  
 Unicast vs. Anycast 
 Unicast and anycast addresses look the same and may be indistinguishable from each 
other; it just depends on how many devices have the same address. If only one device 
has a globally unique IPv6 address, it ’ s a unicast address. If more than one device has the 
same address, it ’ s an anycast address. Both unicast and anycast are considered one - to -
 one communication, although you could say anycast is one - to - “ one of many. ” 

 Table 12.7 outlines the IPv6 address space known preﬁ xes and some well - known addresses. 
 TA B L E 12 .7 IPv6 address space known prefixes and addresses 
 Address Prefix  
  Scope of Use 
 2000:: /3 
  Global unicast space prefix 
 FE80:: /10 
  Link - local address prefix 
 FC00:: /7 
  Unique local unicast prefix  
 FD00:: /8 
  Unique local unicast prefix  
 FF00:: /8 
  Multicast prefix  
 2001:DB8:: /32 
  Global unicast prefix use for documentation 
 ::1 
  Reserved local loopback address  
 2001:0000: /32 
  Teredo prefix (discussed later in this chapter)  
 2002:: /16 
  6to4 prefix (discussed later in this chapter)  
 IPv6 Integration/Migration 
 It ’ s time to get into the mind - set of integrating IPv6 into your existing infrastructure 
with the longer goal of migrating to IPv6. In other words, this is not going to be an  “ OK, 
Friday the Internet is changing over ” rollout. You have to bring about the change as a 
controlled implementation. It could easily take three to ﬁ ve years before a solid migration 
occurs, and probably longer. We think the migration will take just less than getting the 
world migrated to the metric system on the overall timeline. The process of integration/
migration consists of several mechanisms:  
 Dual Stack   Simply running both IPv4 and IPv6 on the same network, utilizing the IPv4 
address space for devices using only IPv4 addresses and utilizing the IPv6 address space for 
devices using IPv6 addresses 
 Tunneling   Using an encapsulation scheme for transporting one address space inside 
another  
 Address Translation   Using a higher - level application to transparently change one address 
type (IPv4 or IPv6) to the other so end devices are unaware one address space is talking to 
another  
 We elaborate on these three mechanisms in the following sections. 
Understanding IPv6 
533

534 
Chapter 12  Configuring TCP/IP
 IPv6 Dual Stack 
 The default implementation in Windows Server 2008 R2 is an enabled IPv6 conﬁ guration 
along with IPv4; this is dual stack. The implementation can be dual IP layer or dual TCP/IP 
stack. Windows Server 2008 R2 uses the dual IP layer implementation (see Figure 12.16). 
When an application queries a DNS server to resolve a hostname to an IP address, the DNS 
server may respond with an IPv4 address or an IPv6 address. If the DNS server responds 
with both, Windows Server 2008 R2 will prefer the IPv6 address. Windows Server 2008 
R2 can use both IPv4 and IPv6 addresses as necessary for network communication. When 
looking at the output of the  ipconfig command, you will see both address spaces displayed. 
Application Layer
Transport Layer
Network Interface
Application
IPv4
IPv6
Network Layer
 F I G U R E 12 .16 IPv6 dual IP layer diagram 
 IPv6 Tunneling 
 Windows Server 2008 R2 includes several tunneling mechanisms for tunneling IPv6 
through the IPv4 address space. They include the following: 
 Intra - Site Automatic Tunnel Addressing Protocol (ISATAP), which is used for unicast 
IPv6 communication across an IPv4 infrastructure. ISATAP is enabled by default in 
Windows Server 2008 R2.  
 6to4, which is used for unicast IPv6 communication across an IPv4 infrastructure.  
 Teredo, which is used for unicast IPv6 communication with an IPv4 NAT implementa-
tion across an IPv4 infrastructure.  
 With multiple tunneling protocols available and enabled by default, you might ask, 
what ’ s the difference and why is one used over the others? They all allow you to tunnel 
IPv6 packets through the IPv4 address space (a really cool thing if you ’ re trying to 
integrate/migrate). Here are the details:  
  ISATAP   ISATAP is the automatic tunnel addressing protocol providing IPv6 addresses 
based on the IPv4 address of the end interface (node). The IPv6 address is automatically 
conﬁ gured on the local device, and the dual stack machine can use either its IPv4 or IPv6 
address to communicate on the local network (within the local network infrastructure). 
■
■
■

ISATAP can use the neighbor discovery mechanism to determine the router ID and network 
preﬁ x where the device is located, thus making intrasite communication possible even in a 
routed infrastructure. 
 The format of an ISATAP address is as follows: 
[64bits of prefix] [32bits indicating ISATAP] [32bits IPv4 Address] 
 The center 32 bits indicating ISATAP are actually  0000:5EFE  (when using private IPv4 
addresses). The ISATAP address of the example Windows Server 2008 R2 machine using 
the link - local IPv6 address is  FE80::5EFE:192.168.1.200 . Each node participating in the 
ISATAP infrastructure must support ISATAP. If you ’ re routing through an IPv4 cloud, a 
border router (a router transitioning from an IPv6 to IPv4 space) must support ISATAP. 
Windows Server 2008 R2 can be configured as a border router and will forward ISATAP 
packets. ISATAP is experimental and is defined in RFC 4214.  
 6to4   6to4 speciﬁ es a procedure for IPv6 networks to communicate with each other 
through an IPv4 space without the IPv6 nodes having to know what ’ s happening. The 
IPv6 nodes do not need to be dual stacked to make this happen. The border router is 
the device responsible for knowing about the IPv6 to IPv4 transition. The IPv6 packets are 
encapsulated at the border router (and decapsulated at the other end or on the way back). 
There is an assigned preﬁ x for the 6to4 implementation:  2002:: /16 . 6to4 is deﬁ ned in 
RFC 3056. 
 Teredo   Teredo (named after a kind of shipworm that drills holes in the wood of ships) is 
a protocol designed to allow IPv6 addresses to be available to hosts through one or more 
layers of NAT. Teredo uses a process of tunneling packets through the IPv4 space using 
UDP. The Teredo service encapsulates the IPv6 data within a UDP segment (packet) and 
uses IPv4 addressing to get through the IPv4 cloud. Having a layer 4 (Transport layer) 
available to use as translation functionality is what gives you the ability to be behind a 
NAT. Teredo provides host - to - host communication and dynamic addressing for IPv6 nodes 
(dual stack), allowing the nodes to have access to resources in an IPv6 network and the 
IPv6 devices to have access to the IPv6 devices that have only connectivity to the IPv4 space 
(like home users who have an IPv6 - enabled operating system connecting to IPv6 resources 
while their home ISP has only IPv4 capabilities). Teredo is deﬁ ned in RFC 4380. 
 In Windows Server 2008 R2, an IPv4 Teredo server is identified and configured (using the 
 netsh command interface). The Teredo server provides connectivity resources (address) to 
the Teredo client (the node that has access to the IPv4 Internet and needs access to an IPv6 
network/Internet. A Teredo relay is a component used by the IPv6 router to receive traffic 
destined for Teredo clients and forward the traffic appropriately. The defined prefix for 
Teredo address is  2001:0000:: /32 . Teredo does add overhead like all the implementations 
discussed. It is generally accepted that you should use the simplest model available. 
However, in the process of integration/migration for most of us behind a NAT, Teredo will 
be the process to choose. 
 From Windows Server 2008 R2, use the  ipconfig /all command to view the default 
conﬁ gurations including IPv4 and IPv6. You may notice a notation we didn ’ t discuss, the 
Understanding IPv6 
535

536 
Chapter 12  Configuring TCP/IP
percent sign at the end of the IPv6 address (see Figure 12.17). The number after the percent 
sign is the virtual interface identiﬁ er used by Windows Server 2008 R2.  
 F I G U R E 12 .17 IPv6 Interface identifier for  ipconfig display 
 Information Commands Useful with IPv6 
 You can use numerous commands to view, verify, and conﬁ gure the network parameters of 
Windows Server 2008 R2. Speciﬁ cally, you can use the  netsh command set and the  route 
command set, as well as the standard  ping and  tracert functions. 
 Use the  netsh command interface to examine and conﬁ gure IPv6 functionality (as well 
as the provided dialog boxes if you want). The  netsh command issued from the command 
interpreter changes into a network shell ( netsh ) where you can conﬁ gure and view both 
IPv4 and IPv6 components. 
 Don ’ t forget to use the ever - popular  route print command to see the Windows Server 
2008 R2 routing tables (IPv4 and IPv6). The other diagnostic commands are still available 
for IPv4 as well as IPv6. In previous versions of Microsoft operating systems,  ping was the 
IPv4 command, and  ping6 was the IPv6 command. This has changed for Windows Server 
2008 R2;  ping works for both IPv4 and IPv6 to test layer 3 connectivity to remote devices. 
The IPv4  tracert command was  tracert6 for IPv6. The command is now  tracert for 
both IPv4 and IPv6 and will show you every layer 3 (IP) hop from source to destination 
(assuming all the administrators from here to there want you to see the hops and are not 
blocking ICMP and also assuming there are not IP tunnels your packets are traversing, or 
you won ’ t see the router hops in the tunnel either). 
 Overall, the consortium of people developing the Internet and the Internet Protocol have 
tried to make all the changes to communication infrastructures easy to implement (this 
is a daunting task with the many vendors and various infrastructures currently in place). 
The goal is not to daze and confuse administrators; it ’ s to provide the most ﬂ exibility 
with the greatest functionality. IPv6 is going to provide the needed layer 3 (Network layer, 
global addressing layer, logical addressing layer...call it what you like) functionality for the 
foreseeable future.  
 Subnetting with IPv6 
 Subnetting with IPv6 is a lot like subnetting with IPv4. You need to know how many bits 
you are going to use for the network mask to subnet it correctly. 
 For example, you have an IPv6 preﬁ x of  2001:DB8:BBCC:0000::/53 and you need to set 
up your network so that your IPv6 addressing scheme can handle 1500 more subnets. How 
would you ﬁ gure this out? 
 When ﬁ guring out any number of hosts or subnets, the calculation is 2 to the power (2 x ). 
The ﬁ rst power number that is greater than or equal to the number you need is the power 
number that you add to the current network mask. So, in the previous question, to get to 

1,500 subnets, you would need to ﬁ gure out which 2 x is the ﬁ rst one that is greater than or 
equal to 1,500. If you calculate out your powers correctly, 2 11 (2 11   2048) is the ﬁ rst one 
that is greater than or equal to 1500. So you would add the power of 11 to the  /53  in the 
above address, and you would now use  /64  as your network mask. Table 12.8 shows you 
some of the power numbers for the power of 2.  
 TA B L E 12 . 8 Powers of 2 
 Power  
  Equals  
 2 2 
  4 
 2 3 
 8 
 2 4 
  16  
 2 5 
  32  
 2 6 
  64  
 2 7 
  128  
 2 8 
  256  
 2 9 
  512  
 2 10 
  1024  
 2 11 
  2048  
 2 12 
  4096  
 Summary 
 One of the important topics covered in this chapter was how TCP/IP is the primary 
protocol in use today. Microsoft encourages you to use TCP/IP exclusively, if possible. 
 You also learned that the 32 - bit IPv4 address is a structured and hierarchical address 
that is used to uniquely identify every machine on a network. You learned how to 
determine available IP addresses and implement subnetting. In addition, you learned how 
the new layer 3 IPv6 protocol is implemented, including the structure of the IPv6 address. 
Finally, we discussed the new functionality included in IPv6 addressing as well as several 
Windows Server 2008 R2 integration/migration implementations.  
Summary 
537

538 
Chapter 12  Configuring TCP/IP
 Exam Essentials  
  Understand what subnetting is and when to use it.   If an organization is large and has 
many computers or if its computers are geographically dispersed, it ’ s sensible to divide its 
large network into smaller ones connected by routers. These smaller networks are called 
 subnets . Subnetting is the process of carving a single IP network into smaller, logical 
subnetworks.  
 Understand subnet masks.   For the subnet address scheme to work, every machine on the 
network must know which part of the host address will be used as the subnet address. 
The network administrator creates a 32 - bit subnet mask consisting of 1s and 0s. The 1s 
in the subnet mask represent the positions that refer to the network or subnet addresses. 
The 0s represent the positions that refer to the host portion of the address.  
  Understand IPv6.   Understand the structure of an IPv6 address and how it ’ s displayed. 
Know the shortcuts and rules (like for displaying 0s) for writing IPv6 addresses. Know 
the integration/migration components for IPv6 included in Windows Server 2008 R2, 
including tunneling and dual stack.  

Review Questions 
539
 Review Questions  
 1. 
  You are the network administrator for ABC Company. You have an IPv6 prefix of  2001:
DB8:BBCC:0000::/53  and you need to set up your network so that your IPv6 addressing 
scheme can handle 1000 more subnets. Which network mask would you use?  
 A.   /60  
 B.   /61  
 C.  /62 
 D.  /63 
 E. 
 /64  
 2. 
  You are the network administrator for Stellacon Corporation. Stellacon has a Windows 
Server 2008 R2 machine that needs to be able to communicate with all computers on the 
internal network. Stellacon has decided to add 15 new segments to its IPv6 network. How 
would you configure the IPv6 so that the server can communicate with all the segments?  
 A.   Configure the IPv6 address as  fd00::2b0:e0ff:dee9:4143/8 . 
 B.   Configure the IPv6 address as  fe80::2b0:e0ff:dee9:4143/32 . 
 C.   Configure the IPv6 address as  ff80::2b0:e0ff:dee9:4143/64 . 
 D.   Configure the IPv6 address as  fe80::2b0:e0ff:dee9:4143/64 . 
 3. 
 You are the network administrator for a midsize organization that has installed Windows 
Server 2008 R2 onto the network. You are thinking of moving all machines to 
Windows 7 and IPv6. You decide to set up a test environment with four subnets. What 
type of IPv6 addresses do you need set up?  
 A.   Global addresses  
 B.   Link - local addresses  
 C.   Unique local addresses  
 D.   Site - local addresses  
 4. 
  You have a large IP - routed network using the address  137.25.0.0 ; it is composed of 20 
subnets, with a maximum of 300 hosts on each subnet. Your company continues on a 
merger - and - acquisitions spree, and your manager has told you to prepare for an increase to 
50 subnets, with some of them containing more than 600 hosts. Using the existing network 
address, which of the following subnet masks would work for that requirement from your 
manager?  
 A.   255.255.252.0 
 B.   255.255.254.0 
 C.   255.255.248.0 
 D.   255.255.240.0 

540 
Chapter 12  Configuring TCP/IP
 5. 
  The company you work for is growing dramatically via acquisitions of other companies. 
As the network administrator, you need to keep up with the changes because they affect 
the workstations, and you need to support them. When you started, there were 15 locations 
connected via routers, and now there are 25. As new companies are acquired, they are 
migrated to Windows Server 2008 R2 and brought into the same domain as another site. 
Management says that they are going to acquire at least 10 more companies in the next 
two years. The engineers have also told you that they are redesigning the company ’ s Class 
B address into an IP addressing scheme that will support these requirements and that there 
will never be more than 1,000 network devices on any subnet. What will be the appropriate 
subnet mask to support this network when the changes are completed?  
 A.   255.255.252.0 
 B.   255.255.248.0 
 C.   255.255.255.0 
 D.   255.255.255.128 
 6. 
  You work for a small printing company that has 75 workstations. Most of them run standard 
office applications such as word processing, spreadsheet, and accounting programs. Fifteen of 
the workstations are constantly processing huge graphics files and then sending print jobs to 
industrial - size laser printers. The performance of the network has always been an issue, but 
you have never addressed it. You have now migrated your network to Windows Vista and 
Windows Server 2008 R2 and have decided to take advantage of the routing capability built 
into Windows Server 2008 R2. You choose the appropriate server and place two NICs in 
the machine, but you realize that you have only one network address,  201.102.34.0 , which 
you obtained years ago. How should you subnet this address to segment the bandwidth hogs 
from the rest of the network while giving everyone access to the entire network?  
 A.   255.255.255.192 
 B.   255.255.255.224 
 C.   255.255.255.252 
 D.   255.255.255.240 
 7. 
  You work for Carpathian Worldwide Enterprises, which has more than 50 administrative 
and manufacturing locations around the world. The size of these organizations varies greatly, 
with the number of computers per location ranging from 15 to slightly fewer than 1,000. 
The sales operations use more than 1,000 facilities, each of which contains 2 to 5 computers. 
Carpathian is also in merger talks with another large organization; if the merger materializes 
as planned, you will have to accommodate another 100 manufacturing and administrative 
locations, each with a maximum of 600 computers, as well as 2,000 additional sales 
facilities. You don ’ t have any numbers for the future growth of the company, but you are told 
to keep growth in mind. You decide to implement a private addressing plan for the entire 
organization. More than half of your routers don ’ t support variable - length subnet masking. 
Which subnet masks would work for this situation? (Choose all that apply.) 
 A.   255.255.224.0 
 B.   255.255.240.0 
 C.   255.255.248.0 
 D.   255.255.252.0 
 E. 
  255.255.254.0  

Review Questions 
541
 8. 
  Which of the following subnet masks are represented with the CIDR of /27?  
 A.   255.255.255.254 
 B.   255.255.255.248 
 C.   255.255.255.224 
 D.   255.255.255.240 
 9. 
  You are the administrator for a Windows Server 2008 R2 network that uses DHCP. You 
notice that your DHCP database is getting too large and you want to reduce the size of the 
database. What should you do?  
 A. From the folder containing the DHCP database, run  jetpack.exe dhcp.mdb 
temp.mdb . 
 B. From the folder containing the DHCP database, run  shrinkpack.exe dhcp.mdb 
temp.mdb . 
 C. From the folder containing the DHCP database, run  jetshrink.exe dhcp.mdb 
temp.mdb . 
 D. From the folder containing the DHCP database, run  shrinkjet.exe dhcp.mdb 
temp.mdb .  
 10.   You ask one of your technicians to get the IPv6 address of new Windows Server 2008 
R2 machine, and she hands you a note with  FE80::0203:FFFF:FE11:2CD on it. What 
can you tell from this address? (Choose two.)  
 A.   This is a globally unique IPv6 address.  
 B.   This is a link - local IPv6 address.  
 C.   This is a multicast IPv6 address.  
 D.   In EUI - 64 format you can see the MAC address of the node.  
 E. 
  In EUI - 64 format you can see the IPv4 address of the node.  

542 
Chapter 12  Configuring TCP/IP
 Answers to Review Questions 
1. 
 D .  To calculate the network mask, you need to ﬁ gure out which power number (2 x ) is 
greater than or equal to the number you need. Since we are looking for 1000, 2 10   1022. 
You then add the power (10) to the current network mask (53   10   63). 
2. 
 A .  When you look at an IPv6 address, the ﬁ rst sections tell you the IPv6 address space 
preﬁ x.  Fd00:: /8  is the unique local unicast preﬁ x and this allows the server to 
communicate with all local machines within your intranet. 
3. 
 C .  The unique local address can be  FC00  or  FD00  and is used like the private address space 
of IPv4. Unique local addresses are not expected to be routable on the global Internet, but 
they are used for private routing within an organization. 
4. 
 A .  A Class B address with a default subnet mask of  255.255.0.0 will support up to 65,534 
hosts. To increase the number of networks that this network will support, you need to 
subnet the network by borrowing bits from the host portion of the address. The subnet mask 
 255.255.252.0 uses 6 bits from the host ’ s area and will support 64 subnets while leaving 
enough bits to support 1,022 hosts per subnet. The subnet mask  255.255.248.0 uses 5 
bits from the hosts and will support 32 subnetworks while leaving enough bits to support 
2,046 hosts per subnet.  255.255.252.0 is the better answer because it leaves quite a bit 
of room for further growth in the number of networks while still leaving room for more 
than 1,000 hosts per subnet, which is a fairly large number of devices on one subnet. The 
subnet mask  255.255.254.0 uses 7 bits from the host ’ s area and will support more than 
120 networks, but it will leave only enough bits to support 500 hosts per subnet. The subnet 
mask  255.255.240.0 uses 4 bits from the hosts and will support only 16 subnetworks, even 
though it will leave enough bits to support more than 4,000 hosts per subnet. 
5. 
 A .  The network mask applied to an address determines which portion of that address reﬂ ects 
the number of hosts available to that network. The balance with subnetting is always between 
the number of hosts and individual subnetworks that can be uniquely represented within one 
encompassing address. The number of hosts and networks that are made available depends 
on the number of bits that can be used to represent them. This scenario requires more than 35 
networks and fewer than 1,000 workstations on each network. If you convert the subnet masks 
as described in the chapter, you will see that the mask in option A allows for more than 60 
networks and more than 1,000 hosts. All of the other options are deﬁ cient in either the number 
of networks or the number of hosts that they represent. 
6. 
 A .  The subnet mask  255.255.255.192  borrows 2 bits from the hosts, which allows you 
to build four separate networks that you can route through the Windows server. This will 
allow you to have 62 hosts on each segment. A mask of  255.255.255.128 would have been 
even better, with two subnets of 126 hosts each, but that wasn ’ t an option, and this solution 
gives you room for growth in the number of subnets. The subnet mask  255.255.255.224 
borrows 3 bits from the hosts; this allows you to create 8 networks, which you don ’ t need, 
and leaves only enough bits for 30 hosts. The subnet mask  255.255.255.252 borrows 6 
bits from the hosts; this allows you to create more than 60 networks, which you don ’ t need, 
and leaves only enough bits for 2 hosts. The subnet mask  255.255.255.240  borrows 4 bits 
from the hosts; this allows you to create 16 networks, which you don ’ t need, and leaves 
only enough bits for 14 hosts per subnet. 

7. 
 B, C, D .  When you add up the locations that currently need to be given a network address, 
the total is 3,150, and the maximum number of hosts at any one of these locations is less 
than 1,000. The subnet masks need to support those requirements. Assuming you choose 
the Class A private address space  10.0.0.0/8 , the subnet masks given in options B, C, and 
D will provide the address space to support the outlined requirements. The subnet mask 
 255.255.240.0  supports more than 4,000 subnets and more than 4,000 hosts. The subnet 
mask  255.255.248.0  supports more than 8,000 subnets and more than 2,000 hosts. The 
subnet mask  255.255.252.0  supports more than 16,000 subnets and more than 1,000 
hosts. Although each of these subnet masks will work, at the rate that this company is 
growing,  255.255.252.0  is probably the best mask to prepare for the future. It ’ s unlikely 
that there will ever be more than 1,000 hosts on any given network. In fact, that number 
would probably cause performance problems on that subnet. Therefore, it ’ s better to have 
more subnets available to deploy as the company grows. The subnet mask  255.255.224.0 
supports more than 2,000 subnets — an insufﬁ cient number to cover the locations. The 
subnet mask  255.255.254.0  supports more than 32,000 subnets but only 500 hosts 
per subnet, which are not enough hosts to cover all the locations. 
8. 
 C .  The CIDR /27 tells you that 27 ones are turned on in the subnet mask. Twenty -
 seven 1s equals  11111111.11111111.11111111.11100000 . This would then equal 
 255.255.255.224 . 
 
 The network address  192.168.11.192  with a subnet mask of  255.255.255.224 is perfect 
for Subnet A because it supports up to 30 hosts. The network address  192.168.11.128 
with a subnet mask of  255.255.255.192  is perfect for Subnet B because it supports up to 
62 hosts. The network address  192.168.11.0  with a subnet mask of  255.255.255.128  is 
perfect for Subnet C because it supports up to 126 hosts. 
9. 
A. Microsoft’s  jetpack.exe  utility allows you to compact a JET database. Microsoft JET 
databases are used for WINS and DHCP databases.
10.  B, D .  If the ﬁ rst word of an IPv6 address is  FE80  (actually the ﬁ rst 10 bits 
of the ﬁ rst word yields  1111 1110 10  or  FE80:: /10 ), then the address is a link - local 
IPv6 address. If it ’ s in EUI - 64 format, then the MAC address is also available (unless it ’ s 
randomly generated). The middle  FF:FE  is the ﬁ ller and indicator of the EUI - 64 space, with 
the MAC address being  00:03:FF:11:02:CD . Remember also the  00  of the MAC becomes 
 02  in the link - local IPv6 address, ﬂ ipping a bit to call it  local . 
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at 
 www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
543


Managing DHCP 
and DNS  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Addressing and Services  
■   Configure Dynamic Host Configuration Protocol. May 
include but is not limited to: DHCP options; creating new 
options; PXE boot; default user profiles; DHCP relay agents; 
exclusions; authorize server in Active Directory; scopes; 
DHCPv6.  
 Configuring Names Resolution  
■   Configure a Domain Name Server (DNS) server. May 
include but is not limited to: conditional forwarding; external 
forwarders; root hints; cache - only; socket pooling; cache 
locking.  
■   Configure DNS zones. May include but is not limited to: 
zone scavenging; zone types; Active Directory integration; 
Dynamic Domain Name System (DDNS); Secure DDNS; 
GlobalNames; zone delegation; DNS Security Extensions 
(DNSSEC); reverse lookup zones.  
■   Configure DNS records. May include but is not limited 
to: record types; Time to Live (TTL); weighting records; 
registering records; netmask ordering; DnsUpdateProxy 
group; round robin; DNS record security; auditing.  
■   Configure DNS replication. May include but is not limited 
to: DNS secondary zones; DNS stub zones; Active Directory 
replication scope; securing zone transfers; SOA refresh; 
auditing.  
■   Configure name resolution for clients computers. May 
include but is not limited to: configuring HOSTS file; Link -
 Local Multicast Name Resolution (LLMNR); broadcasting; 
resolver cache; DNS Server list; Suffix Search order; DNS 
devolution.  


 Chapter 
13

 In Chapter 12,  “ Conﬁ guring TCP/IP, ” we brieﬂ y discussed 
the Dynamic Host Conﬁ guration Protocol (DHCP) and 
how to conﬁ gure DHCP clients. Planning for and using DHCP 
in Windows Server 2008 R2 is pretty straightforward, but there ’ s a lot you need to know 
to make sure your installation proceeds without trouble. 
 In this chapter, you ’ ll learn how to install and manage DHCP, including how to 
set up plain DHCP scopes, superscopes, and multicast scopes. You ’ ll also learn how 
to set up integration between Dynamic DNS and DHCP as well as how to authorize a 
DHCP server to integrate with Active Directory. 
 We will also look at DNS and how it pertains to the 70 - 642 exam. DNS was covered in 
detail in Chapter 2,  “ Domain Name System (DNS), ” but we will look at how DNS works 
within the network infrastructure.  
 Overview of DHCP 
 As you saw in Chapter 12, TCP/IP is the priority protocol for Windows Server 2008 R2. 
There are two ways to have clients and servers get TCP/IP addresses: 
 You can manually assign the addresses.  
 The addresses can be assigned automatically.  
 Manually assigning addresses is a fairly simple process. An administrator goes to each of 
the machines on the network and assigns TCP/IP addresses. The problem with this method 
arises when the network becomes midsize or larger. Think of an administrator trying to 
individually assign 4,000 TCP/IP addresses, subnet masks, default gateways, and all other 
conﬁ guration options needed to run the network. 
 DHCP ’ s job is to centralize the process of IP address and option assignment. You can 
conﬁ gure a DHCP server with a range of addresses (called a  pool ) and other conﬁ guration 
information and let it assign all the IP parameters — addresses, default gateways, DNS 
server addresses, and so on.  
 DHCP is defined by a series of Request for Comment (RFC) documents, 
notably 2131 and 2132. 
■
■

 Introducing the DORA Process 
 An easy way to remember how DHCP works is to learn the acronym DORA. DORA stands 
for Discover, Offer, Request, and Acknowledge. In brief, here is DHCP ’ s DORA process: 
 1. 
 Discover : When IP networking starts up on a DHCP - enabled client, a special message 
called a DHCPDISCOVER is broadcast within the local physical subnet.  
 2. 
  Offer : Any DHCP server that hears the request checks its internal database and replies 
with a message called a DHCPOFFER, which contains an available IP address. 
 The contents of this message depend on how the DHCP server is conﬁ gured — there are 
numerous options aside from an IP address that you can specify to pass to the client on 
a Windows Server 2008 R2 DHCP server.  
 3. 
  Request : The client receives one or more DHCPOFFERs (depending on how many 
DHCP servers exist on the local subnet), chooses an address from one of the offers, 
and sends a DHCPREQUEST message to the server in order to signal acceptance of the 
DHCPOFFER. 
 This message might also request additional conﬁ guration parameters. 
 Other DHCP servers that sent offers take the request message as an acknowledgment 
that the client didn ’ t accept their offer.  
 4. 
  Acknowledge : When the DHCP server receives the DHCPREQUEST, it marks the IP 
address as being in use (usually, but it ’ s not required to). Then it sends a DHCPACK to 
the client. 
 The acknowledgment message might contain requested conﬁ guration parameters. 
 If the server is unable to accept the DHCPREQUEST for any reason, it sends a 
DHCPNAK message. If a client receives a DHCPNAK, it begins the conﬁ guration 
process over again.  
 5. 
  When the client accepts the IP offer, the address is assigned to the client for a 
speciﬁ ed period of time, called a  lease . After receiving the DHCPACK message, the 
client performs a ﬁ nal check on the parameters (sometimes it sends an ARP request for 
the offered IP address) and makes note of the duration of the lease. The client is now 
conﬁ gured. 
 If the client detects that the address is already in use, it sends a DHCPDECLINE.  
 If the DHCP server has given out all the IP addresses in its pool, it won ’ t make an offer. 
If no other servers make an offer, the client ’ s IP network initialization will fail and the 
client will use Automatic Private IP Addressing (APIPA). 
 DHCP Lease Renewal 
 No matter how long the lease period is, the client sends a new lease request message 
directly to the DHCP server when the lease period is half over (give or take some 
randomness required by RFC 2131). This period goes by the name  T1 (not to be confused 
with the T1 type of network connection). If the server hears the request message and there ’ s 
Overview of DHCP 
547

548 
Chapter 13 ■ Managing DHCP and DNS
no reason to reject it, it sends a DHCPACK to the client. This resets the lease period, just as 
signing a renewal rider on a car lease does. 
 If the DHCP server isn ’ t available, the client realizes that the lease can ’ t be renewed. The 
client continues to use the address; once 87.5 percent of the lease period has elapsed (again, 
give or take some randomness), the client sends out another renewal request. This interval 
is also known as T2. At that point, any DHCP server that hears the renewal can respond to 
this  DHCP request message  (which is a request for a lease renewal) with a DHCPACK and 
renew the lease. 
 If at any time during this process the client gets a negative DHCPNACK message, it 
must stop using its IP address immediately and start the leasing process over from the 
beginning by requesting a new lease. 
 When a client initializes its IP networking, it always attempts to renew its old address. If 
the client has time left on the lease, it continues to use the lease until its end. If the client is 
unable to get a new lease by that time, all IP functions stop until a new, valid address can 
be obtained.  
 DHCP Lease Release 
 Although leases can be renewed repeatedly, at some point they might run out. Furthermore, 
the lease process is an  “ at - will ” process — the client or server can cancel the lease before it 
ends. In addition, if the client doesn ’ t succeed in renewing the lease before it expires, the 
client loses its lease and reverts to APIPA. This release process is important for reclaiming 
extinct IP addresses used by systems that have moved or switched to a non - DHCP address.  
 Advantages and Disadvantages of DHCP 
 DHCP was designed from the start to simplify network management. It has some 
signiﬁ cant advantages, but it also has some drawbacks. 
 Advantages of DHCP 
 The following are advantages of DHCP: 
 Conﬁ guration of large and even midsize networks is much simpler. If a DNS server 
address or some other change is necessary to the client, the administrator doesn ’ t have 
to physically touch each device in the network to reconﬁ gure it with the new settings.  
 Once you enter the IP conﬁ guration information in one place — the server — it ’ s 
automatically propagated to clients, eliminating the risk that a user will misconﬁ gure 
some parameters and require you to ﬁ x them.  
 IP addresses are conserved because DHCP assigns them only when requested.  
 IP conﬁ guration becomes almost completely automatic. In most cases, you can plug 
in a new system (or move one) and then watch as it receives a conﬁ guration from the 
server. For example, when you install new network changes such as a gateway or 
DNS server, the client conﬁ guration is done at only one location — the DHCP server.  
■
■
■
■

 It allows a preboot execution environment (PXE) client to get a TCP/IP address from 
DHCP. PXE clients — also called Microsoft Windows Deployment Services (WDS) 
clients — can get an IP address without needing to have an operating system installed. 
This allows WDS clients to connect to a WDS server through the TCP/IP protocol and 
download an operating system remotely.  
 Disadvantages of DHCP 
 Unfortunately, there are a few drawbacks with DHCP: 
 DHCP can become a single point of failure for your network. If you have only 
one DHCP server and it ’ s not available, clients can ’ t request or renew leases.  
 If the DHCP server contains incorrect information, the misinformation will 
automatically be delivered to all your DHCP clients.  
 If you want to use DHCP on a multisegment network, you must put either a DHCP 
server or a relay agent on each segment, or you must ensure that your router can 
forward Bootstrap Protocol (BOOTP) broadcasts.  
 ipconfig Lease Options 
 The  ipconfig command - line tool is useful for working with network settings. Its  /renew 
and  /release switches make it particularly handy for DHCP clients. These switches allow 
you to request renewal of, or give up, your machine ’ s existing address lease. You can do 
the same thing by toggling the Obtain An IP Address Automatically button in the Internet 
Protocol (TCP/IP) Properties dialog box, but the command - line option is useful especially 
when you ’ re setting up a new network. 
 For example, we spend about a third of our time teaching MCITP classes, usually in 
temporary classrooms set up at conferences, hotels, and so on. Laptops are used in these 
classes, with one brawny laptop set up as a DNS/DHCP/DC server. Occasionally, a client 
will lose its DHCP lease (or not get one, perhaps because a cable has come loose). The 
quickest way to ﬁ x it is to pop open a command - line window and type   ipconfig/renew . 
 You can conﬁ gure DHCP to assign options only to certain classes. Classes, deﬁ ned 
by an administrator, are groups of computers that require identical DHCP options. 
The  /setclassid classID  switch of  ipconfig is the only way to assign a machine to a class. 
 More speciﬁ cally, the switches do the following:  
 ipconfig /renew   Instructs the DHCP client to request a lease renewal. If the client 
already has a lease, it requests a renewal from the server that issued the current lease. 
This is equivalent to what happens when the client reaches the half - life of its lease. Or, if 
the client doesn ’ t currently have a lease, it is equivalent to what happens when you boot a 
DHCP client for the ﬁ rst time. It initiates the DHCP mating dance, listens for lease offers, 
and chooses one it likes.  
 ipconfig/release   Forces the client to immediately give up its lease by sending the 
server a DHCP release notiﬁ cation. The server updates its status information and marks 
■
■
■
■
Overview of DHCP 
549

550 
Chapter 13 ■ Managing DHCP and DNS
the client ’ s old IP address as  “ available, ” leaving the client with no address bound to its 
network interface. When you use this command, most of the time it will be immediately 
followed by  ipconfig/renew . The combination releases the existing lease and gets a new 
one, probably with a different address. (It ’ s also a handy way to force your client to get a 
new set of settings from the server before lease expiration time.)  
  ipconfig /setclassid classID   Sets a new class ID for the client. You will see how to 
conﬁ gure class options later in the section  “ Setting Scope Options for IPv4. ” For now, you 
should know that the only way to add a client machine to a class is to use this command. 
Note that you need to renew the client lease for the class assignment to take effect.  
 If you have multiple network adapters in a single machine, you can provide the name of 
the adapter (or adapters) you want the command to work on, including an asterisk ( * ) as 
a wildcard. For example, one of our servers has two network cards: an Intel EtherExpress 
(ELNK1) and a generic 100Mbps card. If you want to renew DHCP settings for both 
adapters, you can type   ipconfig/renew* . If you just want to renew the Intel EtherExpress 
card, you can type   ipconfig/renewELNK1  . 
 Understanding Scope Details 
 By now you should have a good grasp of what a lease is and how it works. To learn how 
to conﬁ gure your servers to hand out those leases, though, you need to have a complete 
understanding of some additional topics: scopes, superscopes, exclusions, reservations, 
address pool, and relay agents. 
 Scope 
 Let ’ s start with the concept of a  scope , which is a contiguous range of addresses. There ’ s 
usually one scope per physical subnet, and a scope can cover a Class A, Class B, or Class C 
network address or a TCP/IP v6 address. DHCP uses scopes as the basis for managing and 
assigning IP addressing information. 
 Each scope has a set of parameters, or  scope options , that you can conﬁ gure. Scope 
options control what data is delivered to DHCP clients when they ’ re completing the DHCP 
negotiation process with a particular server. For example, the DNS server name, default 
gateway, and default network time server are all separate options that can be assigned. 
These settings are called  option types ; you can use any of the types provided with Windows 
Server 2008 R2, or you can specify your own.  
 Superscope 
 A  superscope enables the DHCP server to provide addresses from more than one scope to 
clients on the same physical subnet. This is helpful when clients within the same subnet 
have more than one IP network and thus need IPs from more than one address pool. 
Microsoft ’ s DHCP snap - in allows you to manage IP address assignment in the superscope, 
though you must still conﬁ gure other scope options individually for each child scope.  

 Exclusions and Reservations 
 The scope deﬁ nes what IP addresses could potentially be assigned, but you can inﬂ uence the 
assignment process in two additional ways by specifying exclusions and reservations: 
 Exclusions are IP addresses within the range that you never want automatically 
assigned. These excluded addresses are off - limits to DHCP. You ’ ll typically use 
exclusions to tag any addresses that you never want the DHCP server to assign at all. 
You might use exclusions to set aside addresses that you want to permanently assign to 
servers that play a vital role in your organization.  
 Reservations are IP addresses within the range for which you want a permanent 
DHCP lease. They essentially reserve a particular IP address for a particular device. 
The device still goes through the DHCP process (that is, its lease expires, and it asks 
for a new one), but it always obtains the same addressing information from the 
DHCP server.  
 Exclusions are useful for addresses that you don ’ t want to participate in 
DHCP at all. Reservations are helpful for situations in which you want a 
client to get the same settings each time they obtain an address.  
 An address cannot be simultaneously reserved and excluded at the 
same time. Be aware of this fact for the exam, possibly relating to a 
troubleshooting question.   
■
■
 Using Reservations and Exclusions 
 Deciding when to assign a reservation or exclusion can sometimes be confusing. In 
practice, you ’ ll ﬁ nd that certain computers in the network greatly beneﬁ t by having 
static IP network information. Servers such as DNS servers, the DHCP server itself, 
SMTP servers, and other low - level infrastructure servers are good candidates for static 
assignment. There are usually so few of these servers that the administrator is not 
overburdened if a change in network settings requires going out to reconﬁ gure each 
individually. Chances are that the administrator would still need to manually reconﬁ gure 
these servers (by using  ipconfig /release and then  ipconfig /renew ), even if they 
did not have IP addresses reserved. Even in large installations, we ﬁ nd it much more 
preferable to manage these vital servers by hand than to rely on DHCP. 
Overview of DHCP 
551

552 
Chapter 13 ■ Managing DHCP and DNS
 Address Pool 
 The range of IP addresses that the DHCP server can assign is called its  address pool . For 
example, let ’ s say you set up a new DHCP scope covering the  192.168.1 subnet. That 
gives you 255 IP addresses in the pool. After adding an exclusion from  192.168.1.240 to 
 192.168.1.254 , you ’ re left with 241 (255  – 14) IP addresses in the pool. That means (in theory, 
at least) that you can service 241 unique clients at a time before you run out of IP addresses.  
 DHCP Relay Agent 
 By design, DHCP is intended to work only with clients and servers on a single IP network 
to communicate. But RFC 1542 sets out how BOOTP (on which DHCP is based) should 
work in circumstances in which the client and server are on different IP networks. If no 
DHCP server is available on the client ’ s network, you can use a DHCP relay agent to 
forward DHCP broadcasts from the client ’ s network to the DHCP server. The relay agent 
acts like a radio repeater, listening for DHCP client requests and retransmitting them 
through the router to the server.  
 Installing and Authorizing DHCP 
 Installing DHCP is easy using the Windows Server 2008 R2 installation mechanism. 
Unlike some other services discussed in this book, the installation process installs just the 
service and its associated snap - in, starting it when the installation is complete. At that 
point, it ’ s not delivering any DHCP service, but you don ’ t have to reboot. 
 Installing DHCP 
 Exercise 13.1 shows you how to install DHCP Server using Server Manager.  
 E X E R C I S E  1 3 .1
Installing the DHCP Service 
 1. 
  Select Start   Administrative Tools   Server Manager. 
 2. 
  Click the Roles link and then the Add Roles Link. 
 Reservations are also appropriate for application servers and other special but nonvital 
infrastructure servers. With a reservation in DHCP, the client device will still go through 
the DHCP process but will always obtain the same addressing information from the DHCP 
server. The premise behind this strategy is that these nonvital servers can withstand a 
short outage if DHCP settings change or if the DHCP server fails.  

 3. 
  Click the DHCP Server box, and then click Next. 
 4. 
  If the Introduction To DHCP page appears, click Next. 
 5. 
  On the Specify DNS Server Settings page, make sure your domain name (example: 
 mycompany.com ) appears in the Parent Domain ﬁ eld.  
 6. 
  In the box labeled Preferred DNS Server IP Address, enter the TCP/IP address of your 
DNS server, and then click Validate. A green Valid check mark will appear. Click Next. 
 7. 
  On the Specify WINS Server Settings page, just click Next. 
 8. 
  On the Add Or Edit DHCP Scopes page, click the Add button.  
 9. 
  In the Add Scope dialog box, enter the following: 
 Scope Name:  Test Scope 
 Starting IP Address:  192.168.20.100  
 Ending IP Address:  192.168.20.200  
 Subnet Mask:  255.255.255.0  
 Default Gateway:  192.168.20.1  
 Subnet Type:  Wired (lease duration will be 6 days)  
 Click the Activate This Scope check box, and then click OK. Click Next. 
 10.   On the Select DHCPv6 Server Operation Mode page, make sure Enabled is selected, and 
then click Next.  
 11.   On the Specify IPv6 DNS Server Settings page, make sure your domain name (example: 
 mycompany.com ) appears in the Parent Domain ﬁ eld. Then click Next. 
 Do not  put the TCP/IP address of your DNS server in the second box.  
 12.   On the Authorize DHCP Server page, make sure the administrator account is entered in 
the ﬁ rst box, and click Next. 
 13.   On the Conﬁ rm Installation Selections page, conﬁ rm all your settings, and click Install.  
 14.   On the Installation Results page, click Close once the installation has completed 
successfully.  
 15.   Close Server Manager.  
 Introducing the DHCP Snap - in 
 When you install the DHCP server, the DHCP snap - in is installed, too. You can open it by 
selecting Start   Administrative Tools  DHCP. Figure 13.1 shows the snap - in. 
 As you can see, the snap - in follows the standard MMC model. The left pane displays 
IPv4 and IPv6 sections and which servers are available; you can connect to servers other 
Installing and Authorizing DHCP 
553

554 
Chapter 13 ■ Managing DHCP and DNS
than the one to which you ’ re already connected. A  Server Options folder contains 
options that are speciﬁ c to a particular DHCP server. Each server contains subordinate 
items grouped into folders. Each scope has a folder named after the scope ’ s IP address 
range. Within each scope, four subordinate views show you interesting things about the 
scope, such as the following: 
 The Address Pool view shows you what the address pool looks like.  
■
 F I G U R E 13 .1 DHCP snap - in 
 The Address Leases view shows one entry for each current lease. Each lease shows the 
computer name to which the lease was issued, the corresponding IP address, and the 
current lease expiration time.  
 The Reservations view shows you which IP addresses are reserved and which devices 
hold them.  
 The Scope Options view lists the set of options you ’ ve deﬁ ned for this scope.  
 Authorizing DHCP for Active Directory 
  Authorization creates an Active Directory object representing the new server. It helps 
keep unauthorized servers off your network. Unauthorized servers can cause two kinds of 
problems. They may hand out bogus leases, or they may fraudulently deny renewal requests 
from legitimate clients. 
■
■
■

 When you install a DHCP server using Windows Server 2008 R2 and Active Directory 
is present on your network, the server won ’ t be allowed to provide DHCP services to 
clients until it has been authorized. If you install DHCP on a member server in an Active 
Directory domain or on a stand - alone server, you ’ ll have to manually authorize the server. 
When you authorize a server, you ’ re adding its IP address to the Active Directory object 
that contains the IP addresses of all authorized DHCP servers.  
 You also have the ability to authorize a DHCP server during the installation 
of DHCP (this is what you did in Exercise 13.1).  
 At start time, each DHCP server queries the directory, looking for its IP address on 
the  “ authorized ” list. If it can ’ t ﬁ nd the list or if it can ’ t ﬁ nd its IP address on the list, the 
DHCP service fails to start. Instead, it adds a message to the event log, indicating that it 
couldn ’ t service client requests because the server wasn ’ t authorized. 
 Exercise 13.2 shows you how to unauthorize a DHCP server in an Active Directory 
domain.  
 E X E R C I S E  1 3 . 2
Unauthorizing a DHCP Server 
 1. 
  Select Start   Administrative Tools   DHCP to open the DHCP snap - in.  
 2. 
  Right - click the server you want to unauthorize, and choose the Unauthorize command.  
 3. 
  Click Yes on the dialog box asking if you are sure you want to complete this action.  
 Exercise 13.3 shows you how to authorize a DHCP server in an Active Directory 
domain.  
 E X E R C I S E  1 3 . 3
Authorizing a DHCP Server  
 1. 
  Select Start   Administrative Tools   DHCP to open the DHCP snap - in.  
 2. 
  Right - click the server you want to authorize, and choose the Authorize command.  
 3. 
  Wait a short time (30 – 45 seconds) to allow the authorization to take place.  
 4. 
  Right - click the server again. Verify that the Unauthorize command appears in the 
pop - up menu; this indicates that the server is now authorized. 
Installing and Authorizing DHCP 
555

556 
Chapter 13 ■ Managing DHCP and DNS
 Creating and Managing 
DHCP Scopes 
 You can use any number of DHCP servers on a single physical network if you divide the 
range of addresses you want assigned into multiple scopes. Each scope contains a number 
of useful pieces of data, but before you can understand them, you need to know some 
additional terminology. 
 You can perform the following management tasks on DHCP scopes: 
 Create a scope.  
 Conﬁ gure scope properties.  
 Conﬁ gure reservations and exclusions.  
 Set scope options.  
 Activate and deactivate scopes.  
 Create a superscope.  
 Create a multicast scope.  
 Integrate Dynamic DNS and DHCP.  
 We will cover each task in the following sections. 
 Creating a New Scope in IPv4 
 Like many other things in Windows Server 2008 R2, the process of creating a new scope 
is driven by a wizard. You will most likely create a scope while installing DHCP, but you 
may need to create more than one. The overall process is simple, as long as you know 
beforehand what the wizard is going to ask. If you think about what deﬁ nes a scope, you ’ ll 
be well prepared. You need to know the following: 
 The IP address range for the scope you want to create  
 Which IP addresses, if any, you want to exclude from the address pool  
 Which IP addresses, if any, you want to reserve  
 Values for the DHCP options you want to set, if any 
 This item isn ’ t strictly necessary for creating a scope. However, to create a useful 
scope, you ’ ll need to have some options to specify for the clients.  
 To create a scope, under the server name, right - click the IPv4 option in the 
DHCP snap - in, and use the Action   New Scope command. This starts the New 
Scope Wizard (see Figure 13.2). We will look at each page of the wizard in the 
following sections.  
■
■
■
■
■
■
■
■
■
■
■
■

 Setting the Screen Name 
 The Scope Name page allows you to enter a name and description for your scope. These 
will be displayed by the DHCP snap - in.  
 It ’ s a good idea to pick sensible names for your scopes so that other 
administrators will be able to figure out what the scope is for. For example, 
the name DHCP is likely not very helpful, whereas a name like 1st Floor 
Subnet is more descriptive and can help in troubleshooting.  
 Defining the IP Address Range 
 The IP Address Range page (Figure 13.3) is where you enter the start and end IP addresses 
for your range. The wizard does minimal checking on the addresses you enter and 
automatically calculates the appropriate subnet mask for the range. You can modify the 
subnet mask if you know what you ’ re doing.  
 F I G U R E 13 . 2 Welcome page of the New Scope Wizard 
 F I G U R E  13 . 3 IP Address Range page of the New Scope Wizard 
Creating and Managing DHCP Scopes 
557

558 
Chapter 13 ■ Managing DHCP and DNS
 Adding Exclusions 
 The Add Exclusions page (Figure 13.4) allows you to create exclusion ranges. Exclusions 
are TCP/IP numbers that are in the pool, but they do not get issued to clients. To exclude 
one address, put it in the Start IP Address ﬁ eld. To exclude a range, also ﬁ ll in the End 
IP Address ﬁ eld.  
 Although you can always add exclusions later, it ’ s best to include them 
when you create the scope so that no excluded addresses are ever passed 
out to clients.   
 Setting a Lease Duration 
 The Lease Duration page (Figure 13.5) allows you to set how long a device gets to use 
an assigned IP address before it has to renew its lease. The default lease duration is eight 
days. You may ﬁ nd that a shorter or longer duration makes sense for your network. If your 
network is highly dynamic, with lots of arrivals, departures, and moving computers, set a 
shorter lease duration; if it ’ s less active, make it longer.  
 F I G U R E 13 . 4 Add Exclusions page of the New Scope Wizard 

 Remember that renewal attempts begin when approximately half of the lease 
period is over (give or take a random interval), so don ’ t set them too short.  
 Configuring Basic DHCP Options 
 The Conﬁ gure DHCP Options page (Figure 13.6) allows you to choose whether you want 
to set up basic DHCP options such as default gateway and DNS settings. The options are 
described in the following sections. If you choose not to conﬁ gure options, you can always 
do so later. However, you should not activate the scope until you ’ ve conﬁ gured the options 
you want assigned.  
 F I G U R E 13 . 5 Lease Duration page of the New Scope Wizard 
 F I G U R E 13 .6 Configure DHCP Options page of the New Scope Wizard 
Creating and Managing DHCP Scopes 
559

560 
Chapter 13 ■ Managing DHCP and DNS
 Configuring a Router 
 The ﬁ rst option conﬁ guration page is the Router (Default Gateway) page (Figure 13.7), in 
which you enter the IP addresses of one or more routers (more commonly referred to as 
 default gateways ) that you want to use for outbound trafﬁ c. After entering the IP addresses 
of the routers, use the Up and Down buttons to order the addresses. Clients will use the 
routers in the order speciﬁ ed when attempting to send outgoing packets.  
 Providing DNS Settings 
 On the Domain Name And DNS Servers page (Figure 13.8), you specify the set of DNS 
servers and the parent domain you want passed down to DHCP clients. Normally, you ’ ll 
want to specify at least one DNS server by ﬁ lling in its DNS name or IP address. You 
can also specify the domain sufﬁ x that you want clients to use as the base domain for all 
connections that aren ’ t fully qualiﬁ ed. For example, if your clients are used to navigating 
based on server name alone rather than the fully qualiﬁ ed domain name (FQDN) of 
 server.stellacon.com , then you ’ ll want to place your domain here.  
 F I G U R E 13 .7 Router (Default Gateway) page of the New Scope Wizard 
 F I G U R E  13 . 8 Domain Name And DNS Servers page of the New Scope Wizard 

 Providing WINS Settings 
 If you ’ re still using Windows Internet Name Service (WINS) on your network, you can 
conﬁ gure DHCP so that it passes WINS server addresses to your Windows clients. (If you 
want the Windows clients to honor it, you ’ ll also need to deﬁ ne the WINS/NBT Node Type 
option for the scope.) As on the DNS server page, on the WINS Servers page (Figure 13.9) 
you can enter the addresses of several servers and move them into the order in which you 
want clients to try them. You can enter the DNS or NetBIOS name of each server, or 
you can enter an IP address. 
 Here are some of the more common options you can set on a DHCP server: 
 003 Router : Used to provide a list of available routers or default gateways on the same 
subnet  
 006 DNS Servers : Used to provide a list of DNS servers  
 015 DNS Domain Name : Used to provide the DNS sufﬁ x  
 028 Broadcast Address : Used to conﬁ gure the broadcast address, if different than the 
default, based on the subnet mask  
 44 WINS/NBNS Servers : Used to conﬁ gure the IP addresses of WINS servers  
 46 WINS/NBT Node Type : Used to conﬁ gure the preferred NetBIOS name resolution 
method. There are four settings for node type:  
 B node (0x1) : Broadcast for NetBIOS resolution 
 P node (0x2) : Peer - to - peer (WINS) server for NetBIOS resolution  
 M node (0x4) : Mixed node (does a B node and then a P node)  
 H node (0x8) : Hybrid node (does a P node and then a B node)  
 051 Lease : Used to conﬁ gure a special lease duration  
■
■
■
■
■
■
■
■
■
■
■
 F I G U R E 13 . 9 WINS Servers page of the New Scope Wizard 
Creating and Managing DHCP Scopes 
561

562 
Chapter 13 ■ Managing DHCP and DNS
 Activating the Scope 
 The Activate Scope page (Figure 13.10) gives you the option to activate the scope immediately 
after creating it. By default, the wizard assumes you want the scope activated unless you 
select the No, I Will Activate This Scope Later radio button, in which case the scope will 
remain dormant until you manually activate it.  
 F I G U R E 13 .10 Activate Scope page of the New Scope Wizard 
 Be sure to verify that there are no other DHCP servers assigned to the 
address range you choose!  
 In Exercise 13.4, you will create a new scope for the  192.168.0 private Class C network. 
You need to complete Exercise 13.1 before beginning this exercise.  
 E X E R C I S E  1 3 . 4
Creating a New Scope  
 1. 
  Open the DHCP snap - in by selecting Start   Administrative Tools   DHCP.  
 2. 
  Right - click the IPv4 folder, and choose New Scope. The New Scope Wizard appears.  
 3. 
  Click the Next button on the welcome page.  

 4. 
  Enter a name and a description for your new scope, and click the Next button.  
 5. 
  On the IP Address Range page, enter   192.168.0.2  as the start IP address for the scope 
and   192.168.0.250  as the end IP address. Leave the subnet mask controls alone (though 
when creating a scope on a production network, you might need to change them). Click 
the Next button. 
 6. 
  On the Add Exclusions page, click Next without adding any excluded addresses.  
 7. 
  On the Lease Duration page, set the lease duration to 3 days, and click the Next 
button.  
 8. 
  On the Conﬁ gure DHCP Options page, click the Next button to indicate that you want to 
conﬁ gure default options for this scope. 
 9. 
  On the Router (Default Gateway) page, enter   192.168.0.1  for the router IP address, and 
then click the Add button. Once the address is added, click the Next button. 
 10.   On the Domain Name And DNS Servers page, enter the IP address of a DNS server on 
your network in the IP Address ﬁ eld (for example, you might enter   192.168.0.251 ), and 
click the Add button. Click the Next button. 
 11.   On the WINS Servers page, click the Next button to leave the WINS options unset.  
 12.   On the Activate Scope page, if your network is currently using the  192.168.0. x  
range, select the No, I Will Activate This Scope Later radio button. Click the Next 
button. When the wizard ’ s summary page appears, click the Finish button to create 
the scope.  
 Creating a New Scope in IPv6 
 Now that you have seen how to create a new scope in IPv4, we ’ ll go through the steps to 
create a new scope in IPv6. 
 To create a scope, under the server name, right - click the IPv6 option in the DHCP 
snap - in, and select the Action   New Scope command. This starts the New Scope Wizard. 
Just as with creating a scope in IPv4, the welcome page of the wizard tells you that you ’ ve 
launched the New Scope Wizard. We will look at each page of the wizard in the following 
sections. 
 Setting the Screen Name 
 The Scope Name page (Figure 13.11) allows you to enter a name and description for your 
scope. These will be displayed by the DHCP snap - in.  
Creating and Managing DHCP Scopes 
563

564 
Chapter 13 ■ Managing DHCP and DNS
 It ’ s a good idea to pick a sensible name for your scopes so that other 
administrators will be able to figure out what the scope is for.  
 Scope Prefix 
 The Scope Preﬁ x page (Figure 13.12) gets you started creating the IPv6 scope. IPv6 has 
three types of addresses, which can be categorized by type and scope: 
 Unicast addresses : One - to - one. A packet from one host is delivered to another host. 
The following are some examples of IPv6 unicast:  
 The unicast preﬁ x for site - local addresses is  FEC0::/48 . 
 The unicast preﬁ x for link - local addresses is  FE80::/64 . 
 Figure 13.12 shows the link - local preﬁ x ﬁ lled in.  
 The 6to4 address allows communication between two hosts running both IPv4 
and IPv6. The way to calculate the 6to4 address is by combining the global preﬁ x 
 2002::/16 with the 32 bits of a public IPv4 address of the host. This gives you a 48 - bit 
preﬁ x. 6to4 is described in RFC 3056.  
 Multicast addresses : One - to - many. A packet from one host is delivered to multiple 
hosts (but not everyone). The preﬁ x for multicast addresses is  FF00::/8 . 
 Anycast addresses : A packet from one host is delivered to the nearest of multiple hosts 
(in terms of routing distance).  
■
■
■
■
■
■
 F I G U R E 13 .11 IPv6 Scope Name page of the New Scope Wizard 

 Adding Exclusions 
 As with the IPv4 New Scope Wizard, the Add Exclusions page (Figure 13.13) allows you to 
create exclusion ranges. Exclusions are TCP/IP numbers that are in the pool but do not get 
issued to clients. To exclude one address, put it in the Start IPv6 Address ﬁ eld. To exclude a 
range, also ﬁ ll in the End IPv6 Address ﬁ eld.  
 F I G U R E 13 .12 Scope Prefix page of the New Scope Wizard 
 F I G U R E 13 .13 Add Exclusions page of the New Scope Wizard 
Creating and Managing DHCP Scopes 
565

566 
Chapter 13 ■ Managing DHCP and DNS
 Setting a Lease Duration 
 The Scope Lease page (Figure 13.14) allows you to set how long a device gets to use 
an assigned IP address before it has to renew its lease. You can set two different lease 
durations. The section labeled Non Temporary Address (IANA) is the lease time for your 
more permanent hosts (such as printers and system towers). The one labeled Temporary 
Address (IATA) is for hosts that might disconnect at any time, such as laptops.  
 F I G U R E 13 .14 Scope Lease page of the New Scope Wizard 
 Activating the Scope 
 The Completing The New Scope Wizard page (Figure 13.15) gives you the option to activate 
the scope immediately after creating it. By default, the wizard will assume you want the scope 
activated. If you want to wait on activating the scope, choose No in the Activate Scope Now box.  
 F I G U R E 13 .15 Completing The New Scope Wizard page of the New Scope Wizard 

 Changing Scope Properties (IPv4 and IPv6) 
 Each scope has a set of properties associated with it. Except for the set of options assigned 
by the scope (more about this in the next section), you can ﬁ nd these properties on the 
General tab of the scope ’ s Properties dialog box (Figure 13.16). Some of these properties, 
such as the scope name and description, are self - explanatory. Others require a little more 
explanation: 
 The Start IP Address and End IP Address ﬁ elds allow you to set the range of the scope.  
 For IPv4 scopes, the settings in the section Lease Duration For DHCP Clients control 
how long leases in this scope are valid. 
 The IPv6 scope dialog box includes a Lease tab where you set the lease properties.  
 When you make changes to these properties, they have no effect on 
existing leases. For example, say you create a scope from  172.30.1.1 to 
 172.30.1.199 . You use that scope for a while and then edit its properties 
to reduce the range from  172.30.1.1 to  172.30.1.150 . If a client has been 
assigned the address  172.30.1.180 — which was part of the scope before 
you changed it — the client will retain that address until the lease expires 
but will not be able to renew it.  
■
■
 F I G U R E 13 .16 General tab of the scope ’ s Properties dialog box for an IPv4 scope 
Creating and Managing DHCP Scopes 
567

568 
Chapter 13 ■ Managing DHCP and DNS
 Changing Server Properties 
 Just as each scope has its own set of properties, so too does the server itself. You access the 
server properties by right - clicking the IPv4 or IPv6 object within the DHCP management 
console and selecting Properties. 
 IPv4 Server Properties 
 Figure 13.17 shows the IPv4 Properties dialog box.  
 F I G U R E 13 .17 General tab of the IPv4 Properties dialog box for the server 
 The IPv4 Properties dialog box has four tabs: General, DNS, Network Access 
Protection, and Advanced. 
 The Advanced tab, shown in Figure 13.18, contains the following conﬁ guration 
parameters: 
 Audit Log File Path is the location for log ﬁ les.  
 Conﬂ ict Detection Attempts speciﬁ es how many ICMP echo requests (pings) the server 
sends for an address it is about to offer. The default is 0. Conﬂ ict detection is a way to 
verify that the DHCP server is not issuing IP addresses that are already being used on 
the network.  
■
■

 The Network Access Protection (Figure 13.19) tab allows you to set up Network 
Access Protection (NAP). With NAP, which is a new Windows Server 2008 R2 service, an 
administrator can perform the following tasks: 
 Carry out computer health policy validation. 
 Ensure ongoing compliance with health policies.  
 Optionally restrict the access of computers that do not meet with the computer health 
requirements.  
 IPv6 Server Properties 
 The IPv6 Properties dialog box for the server has two tabs: General and Advanced. On the 
General tab (see Figure 13.20), you can conﬁ gure the following settings: 
 Frequency with which statistics are updated  
 DHCP auditing  
■
■
■
■
■
 F I G U R E 13 .18 The Advanced tab of the IPv4 Properties dialog box for the server 
Creating and Managing DHCP Scopes 
569

570 
Chapter 13 ■ Managing DHCP and DNS
 F I G U R E 13 . 2 0 Server ’ s IPv6 Properties, General tab 
 F I G U R E 13 .19 The Network Access Protection tab of the IPv4 Properties dialog 
box for the server 

 The Advanced tab (see Figure 13.21) allows you to conﬁ gure the following settings: 
 Database path for the audit log ﬁ le path  
 Connection bindings  
 Registration credentials for dynamic DNS. The registration credential is the user 
account that DHCP will use to register clients with Active Directory.  
■
■
■
 F I G U R E 13 . 21 Server ’ s IPv6 Properties, Advanced tab 
 Managing Reservations and Exclusions 
 After deﬁ ning the address pool for your scope, the next step is to create reservations and 
exclusions, which reduce the size of the pool. In the following sections, you will learn how 
to add and remove exclusions and reservations. 
 Adding and Removing Exclusions 
 When you want to exclude an entire range of IP addresses, you need to add that range as 
an  exclusion . Ordinarily, you ’ ll want to do this before you enable a scope, because that 
prevents any of the IP addresses you want excluded from being leased before you have 
a chance to exclude them. In fact, you can ’ t create an exclusion that includes a leased 
address — you have to get rid of the lease ﬁ rst. 
Creating and Managing DHCP Scopes 
571

572 
Chapter 13 ■ Managing DHCP and DNS
 Adding an Exclusion Range 
 Here ’ s how to add an exclusion range: 
 1. 
 Open the DHCP snap - in and ﬁ nd the scope to which you want to add an exclusion 
(either IPv4 or IPv6).  
 2. 
  Expand the scope so you can see its Address Pool item for IPv4 or the Exclusion 
section for IPv6.  
 3. 
  Right - click Address Pool or Exclusion section, and choose the New Exclusion Range 
command.  
 4. 
  When the Add Exclusion dialog box appears (see Figure 13.22), enter the IP addresses 
you want to exclude. To exclude a single address, type it in the Start IP Address ﬁ eld. 
To exclude a range of addresses, also ﬁ ll in the End IP Address ﬁ eld.  
 5. 
  Click the Add button to add the exclusion.  
IPv4 Add Exclusion dialog box
IPv4 Add Exclusion Dialog Box
IPv4 Add Exclusion Dialog Box
IPv6 Add Exclusion dialog box
 F I G U R E 13 . 2 2 Add Exclusion dialog boxes for IPv4 and IPv6 
 When you add exclusions, they appear in the Address Pool node, which is under the 
Scope for IPv4 and under the Exclusion section of IPv6.  
 Removing an Exclusion Range 
 To remove an exclusion, just right - click it, and choose the Delete command. After 
conﬁ rming your command, the snap - in removes the excluded range, and the addresses 
become immediately available for issuance.  
 Adding and Removing Reservations 
 Adding a reservation is simple as long as you have the MAC address of the device for which 
you want to create a reservation. Because reservations belong to a single scope, you create 
and remove them within the Reservations node beneath each scope. 

 Adding a Reservation 
 To add a reservation, perform the following tasks: 
 1. 
 Right - click the scope, and select New Reservation. 
 This displays the New Reservation dialog box, shown in Figure 13.23.  
 2. 
  Enter the IP address and MAC address or ID for the reservation. 
 To find the MAC address of the local computer, use the  ipconfig 
command. To find the MAC address of a remote machine, use the 
 nbtstat - a computername  command.  
IPv4 New Reservation dialog box
IPv6 New Reservation dialog box
 F I G U R E 13 . 2 3 New Reservation dialog boxes for IPv4 and IPv6 
 3. 
  If you want, you can also enter a name and description.  
 4. 
  For IPv4, in the Supported Types section, choose whether the reservation will be made 
by DHCP only, BOOTP only (useful for remote - access devices), or both.  
 Removing a Reservation 
 To remove a reservation, right - click it and select Delete. This removes the reservation but 
does nothing to the client device.  
 
There ’ s no way to change a reservation once it has been created — if you 
want to change any of the associated settings, you ’ ll have to delete and 
re - create the reservation.  
Creating and Managing DHCP Scopes 
573

574 
Chapter 13 ■ Managing DHCP and DNS
 Setting Scope Options for IPv4 
 Once you ’ ve installed a server, authorized it in Active Directory, and ﬁ xed up the address pool, 
the next step is to set scope options that you want sent out to clients, such as router (that is, 
default gateway) and DNS server addresses. You must conﬁ gure the options you want sent out 
before you activate a scope. If you don ’ t, clients may register in the scope without getting any 
options, rendering them virtually useless. Scope options, along with the IP address and subnet 
mask that you conﬁ gured earlier in this chapter, complete the standard TCP/IP settings you 
saw in Chapter 2. 
 In the following sections, you will learn how to conﬁ gure and assign scope options on 
the DHCP server. 
 Understanding Option Assignment 
 You can control which DHCP options are doled out to clients in ﬁ ve (slightly 
overlapping) ways. 
 Predefined Options 
 Predeﬁ ned options are templates that are available in the Server, Scope, or Client Options 
dialog box.  
 Server Options 
 Server options are assigned to all scopes and clients of a particular server. That means 
if there ’ s some setting you want all clients of a DHCP server to have, no matter what scope 
they ’ re in, this is where you assign it. Speciﬁ c options (those that are set at the class, 
scope, or client level) will override server - level options. That gives you an escape valve; 
it ’ s a better idea, though, to be careful about which options you assign if your server 
manages multiple scopes.  
 Scope Options 
 If you want a particular option value assigned only to those clients in a certain subnet, you 
should assign it as a scope option. For example, it ’ s common to specify different routers for 
different physical subnets; if you have two scopes corresponding to different subnets, each 
scope would probably have a separate value for the router option.  
 Class Options 
 You can assign different options to clients of different types. For example, Windows 2000, 
XP, Vista, Windows 7, Server 2003, Server 2008, and Server 2008 R2 machines recognize 
a number of DHCP options that Windows 98, Windows NT, and Mac OS machines 
ignore, and vice versa. By deﬁ ning a Windows 2000 or newer class (using the  ipconfig 
/setclassid command you saw earlier), you could assign those options only to machines 
that report themselves as being in that class.  

 Client Options 
 If a client is using DHCP reservations, you can assign certain options to that speciﬁ c client. 
You attach client options to a particular reservation. Client options override scope, server, 
and class options. The only way to override a client option is to manually conﬁ gure the 
client. The DHCP server manages client options.  
 Client options override class options, class options override scope options, 
and scope options override server options.  
 Assigning Options 
 You can use the DHCP snap - in to assign options at the scope, server, reserved address, or 
class level. The mechanism you use to assign these options is identical; the only difference is 
where you set the options. 
 When you create an option assignment, remember that it applies to all the clients in the 
server or the scope from that point forward. Option assignments aren ’ t retroactive, and 
they don ’ t migrate from one scope to another. 
 Creating and Assigning a New Option 
 To create a new option and have it assigned, follow these steps: 
 1. 
 Select the scope or server where you want the option assigned.  
 2. 
  Select the corresponding Options node, and choose Action   Conﬁ gure Options. 
 To set options for a reserved client, right - click its entry in the Reservations node, and 
select Conﬁ gure Options. 
 You ’ ll then see the Scope Options dialog box (Figure 13.24), which lists all the 
options you might want to conﬁ gure.  
 3. 
  To select an individual option, check the box next to it, and then use the controls in the 
Data Entry control group to enter the value you want associated with the option.  
 4. 
  Continue to add options until you ’ ve speciﬁ ed all the ones you want attached to the 
server or scope. Then click OK.  
 Configuring the DHCP Server for Classes 
 You saw how to assign classes to individual machines earlier in the chapter. Now you 
will learn how to conﬁ gure the DHCP server to recognize your customized classes and 
conﬁ gure options for them. In Exercise 13.5, you will create a new user class and conﬁ gure 
options for the new class. Before you begin, you should make sure that the computers you 
want to use in the class have been conﬁ gured with the  ipconfig /setclassid command as 
described in the section  “  ipconfig Lease Options ”  earlier in this chapter.  
Creating and Managing DHCP Scopes 
575

576 
Chapter 13 ■ Managing DHCP and DNS
 E X E R C I S E  1 3 . 5
Conﬁ guring User Class Options  
 1. 
  Open the DHCP snap - in by selecting Start   Administrative Tools   DHCP.  
 2. 
  Right - click the IPv4 item, and select Deﬁ ne User Classes.  
 3. 
  Click the Add button in the DHCP User Classes dialog box.  
 4. 
  In the New Class dialog box, enter a descriptive name for the class in the Display Name 
ﬁ eld. Enter a class ID in the ID ﬁ eld. (Typically, you will enter the class ID in the ASCII 
portion of the ID ﬁ eld.) When you have ﬁ nished, click OK.  
 5. 
  The new class appears in the DHCP User Classes dialog box. Click the Close button to 
return to the DHCP snap - in. 
 6. 
  Right - click the Scope Options node, and select Conﬁ gure Options.  
 7. 
  Click the Advanced tab. Select the class you deﬁ ned in step 4 from the User Class 
pop - up menu. 
 8. 
  Conﬁ gure the options you want to set for the class. Click OK when you have ﬁ nished. 
Notice that the options you conﬁ gured (and the class they are associated with) appear 
in the right pane of the DHCP window. 
 F I G U R E 13 . 2 4 The Scope Options dialog box 

 About the Default Routing and Remote Access Predefined User Class 
 Windows Server 2008 R2 includes a predeﬁ ned user class called the Default Routing and 
Remote Access class. This class includes options important to clients connecting to Routing 
and Remote Access, notably the 051 Lease option.  
 Be sure to know that the 051 Lease option is included within this class and 
that it can be used to assign a shorter lease duration for clients connecting 
to Routing and Remote Access. 
 Activating and Deactivating Scopes 
 When you ’ ve completed the steps in Exercise 13.5 and you ’ re ready to unleash your 
new scope so that it can be used to make client assignments, the ﬁ nal required step is 
activating the scope. When you activate a scope, you ’ re just telling the server that it ’ s OK 
to start handing out addresses from that scope ’ s address pool. As soon as you activate a 
scope, addresses from its pool may be assigned to clients. Of course, this is a necessary 
precondition to getting any use out of your scope. 
 If you later want to stop using a scope, you can, but beware because it ’ s a permanent 
change. When you deactivate a scope, DHCP tells all clients registered with the scope 
that they need to immediately release their leases and renew them someplace else — the 
equivalent of a landlord who evicts his tenants when the building is condemned!  
 Don ’ t deactivate a scope unless you want clients to stop using it 
immediately.  
 Creating a Superscope for IPv4 
 A superscope allows the DHCP server to provide multiple logical subnet addresses 
to DHCP clients on a single physical network. You create superscopes with the New 
Superscope command, which triggers the New Superscope Wizard.  
 You can have only one superscope per server. 
 Creating a Superscope 
 The following steps take you through the process of creating a superscope: 
 1. 
 Open the DHCP snap - in by selecting Start   Administrative Tools   DHCP.  
 2. 
  Follow the instructions in Exercise 13.4 to create two scopes: one for  192.168.0.2 
through  192.168.0.127 and one for  192.168.1.12 through  192.168.1.127 . 
Creating and Managing DHCP Scopes 
577

578 
Chapter 13 ■ Managing DHCP and DNS
 3. 
  Right - click IPv4, and choose the New Superscope command. The New Superscope 
Wizard appears. Click the Next button.  
 4. 
  On the Superscope Name page, name your superscope, and click the Next button.  
 5. 
  The Select Scopes page appears, listing all scopes on the current server. Select the two 
scopes you created in step 2, and then click the Next button.  
 6. 
  The wizard ’ s summary page appears; click the Finish button to create your scope.  
 7. 
  Verify that your new superscope appears in the DHCP snap - in.  
 Deleting a Superscope 
 You can delete a superscope by right - clicking it and choosing the Delete command. A 
superscope is just an administrative convenience, so you can safely delete one at any time —
 it doesn ’ t affect the  “ real ” scopes that make up the superscope.  
 Adding a Scope to a Superscope 
 To add a scope to an existing superscope, ﬁ nd the scope you want to add, right - click it, and 
choose Action  Add To Superscope. A dialog box appears, listing all the superscopes known 
to this server. Pick the one you want the current scope appended to, and click the OK button.  
 Removing a Scope from a Superscope 
 To remove a scope from a superscope, open the superscope, and right - click the target scope. 
The pop - up menu provides a Remove From Superscope command that will do the deed. 
 Activating and Deactivating Superscopes 
 Just as with regular scopes, you can activate and deactivate superscopes. The same 
restrictions and guidelines apply. You must activate a superscope before it can be used, and 
you must not deactivate it until you want all your clients to lose their existing leases and be 
forced to request new ones. 
 To activate or deactivate a superscope, right - click the superscope name, and select 
Activate or Deactivate, respectively, from the pop - up menu. 
 Creating IPv4 Multicast Scopes 
 Multicasting occurs when one machine communicates to a network of subscribed 
computers rather than speciﬁ cally addressing each computer on the destination network. 
It ’ s much more efﬁ cient to  multicast a video or audio stream to multiple destinations 
than it is to unicast it to the same number of clients, and the increased demand for 
multicast - friendly network hardware has resulted in some head scratching about how 
to automate the multicast conﬁ guration. 
 In the following sections, you will learn about MADCAP, the protocol that controls 
multicasting, and about how to build and conﬁ gure a multicast scope. 

 Understanding the Multicast Address Dynamic Client 
Allocation Protocol 
 DHCP is usually used to assign IP conﬁ guration information for  unicast (or one - to - one) 
network communications. With multicast, there ’ s a separate type of address space assigned 
from  224.0.0.0 through  239.255.255.255 . Addresses in this space are known as  Class 
D addresses or simply  multicast addresses. Clients can participate in a multicast just by 
knowing (and using) the multicast address for the content they want to receive. However, 
multicast clients also need to have an ordinary IP address. 
 How do clients know what address to use? Ordinary DHCP won ’ t help because it ’ s 
designed to assign IP addresses and option information to one client at a time. Realizing 
this, the Internet Engineering Task Force (IETF) deﬁ ned a new protocol: Multicast Address 
Dynamic Client Allocation Protocol (MADCAP). MADCAP provides an analog to DHCP 
but for multicast use. A MADCAP server issues leases for multicast addresses only. 
MADCAP clients can request a multicast lease when they want to participate in 
a multicast. 
 DHCP and MADCAP have some important differences. First, you have to realize that 
the two are totally separate. A single server can be a DHCP server, a MADCAP server, or 
both; no implied or actual relation exists between the two. Likewise, clients can use DHCP 
and/or MADCAP at the same time — the only requirement is that every MADCAP client 
has to get a unicast IP address from somewhere.  
 Remember that DHCP can assign options as part of the lease process, 
but MADCAP cannot. The only thing MADCAP does is dynamically assign 
multicast addresses. 
 Building Multicast Scopes 
 Most of the steps you go through when creating a multicast scope are identical to those 
required for an ordinary unicast scope. Exercise 13.6 highlights the differences.  
 E X E R C I S E  1 3 . 6
Creating a New Multicast Scope 
 1. 
  Open the DHCP snap - in by selecting Start   Administrative Tools   DHCP. 
 2. 
  Right - click IPv4, and choose New Multicast Scope. The New Multicast Scope Wizard 
appears. Click the Next button on the welcome page. 
 3. 
  In the Multicast Scope Name page, name your multicast scope (and add a description if 
you ’ d like). Click the Next button.  
 4. 
  The IP Address Range page appears. Enter a start IP address of   224.0.0.0  and an end 
IP address of   224.255.0.0   . Adjust the TTL to 1 to make sure that no multicast packets 
escape your local network segment. Click the Next button when you ’ ve ﬁ nished.  
Creating and Managing DHCP Scopes 
579

580 
Chapter 13 ■ Managing DHCP and DNS
E X E R C I S E  1 3 . 6  (c o n t i n u e d)
 5. 
  The Add Exclusions page appears; click its Next button. 
 6. 
  The Lease Duration page appears. Since multicast addresses are used for video and 
audio, you ’ d ordinarily leave multicast scope assignments in place somewhat longer 
than you would with a regular unicast scope, so the default lease length is 30 days 
(instead of 8 days for a unicast scope). Click the Next button.  
 7. 
  The wizard asks you whether you want to activate the scope now. Click the No radio 
button and then the Next button.  
 8. 
  The wizard ’ s summary page appears; click the Finish button to create your scope.  
 9. 
  Verify that your new multicast scope appears in the DHCP snap - in.  
 Setting Multicast Scope Properties 
 Once you create a multicast scope, you can adjust its properties by right - clicking the scope 
name and selecting Properties. 
 The Multicast Scope Properties dialog box has two tabs. The General tab (Figure 13.25) 
allows you to change the scope ’ s name, its start and end addresses, its Time to Live (TTL) 
value, its lease duration, and its description — in essence, all the settings you provided when 
you created it in the ﬁ rst place.   
 F I G U R E 13 . 2 5 General tab of the Multicast Scope Properties dialog box 
 The Lifetime tab (see Figure 13.26) allows you to limit how long your multicast scope 
will be active. By default, a newly created multicast scope will live forever, but if you ’ re 
creating a scope to provide MADCAP assignments for a single event (or a set of events 

of limited duration), you can specify an expiration time for the scope. When that time is 
reached, the scope disappears from the server but not before making all its clients give up 
their multicast address leases. This is a nice way to make sure the lease cleans up after itself 
when you ’ re ﬁ nished with it.  
 F I G U R E 13 . 2 6 Lifetime tab of the Multicast Scope Properties dialog box 
 Integrating Dynamic DNS and IPv4 DHCP 
 DHCP integration with Dynamic DNS is a simple concept but powerful in action. By 
setting up this integration, you can pass addresses to DHCP clients while still maintaining 
the integrity of your DNS services. 
 The DNS server can be updated in two ways. One way is for the DHCP client to tell the 
DNS server what its address is. Another is for the DHCP server to tell the DNS server when 
it registers a new client. 
 However, neither of these updates will take place unless you conﬁ gure the DNS server to 
use Dynamic DNS. You can make this change in two ways: 
 If you change it at the scope level, it will apply only to the scope.  
 If you change it at the server level, it will apply to all scopes and superscopes served by 
the server.  
 Which of these options you choose depends on how widely you want to support 
Dynamic DNS; most of the sites we visit have enabled DNS updates at the server level.  
 You also have to instruct the DNS server to accept Dynamic DNS updates. 
For more on how to do so, see Chapter 2.  
■
■
Creating and Managing DHCP Scopes 
581

582 
Chapter 13 ■ Managing DHCP and DNS
 To update the settings at either the server or scope level, you need to open the scope or 
server properties by right - clicking the appropriate object and choosing Properties. The DNS 
tab of the Properties dialog box (Figure 13.27) includes the following options:  
  Enable DNS Dynamic Updates According To The Settings Below   This check box controls 
whether this DHCP server will attempt to register lease information with a DNS server. It 
must be checked to enable Dynamic DNS.  
 Dynamically Update DNS A And PTR Records Only If Requested By The DHCP 
Clients   This radio button (which is on by default) tells the DHCP server to register the 
update only if the DHCP client asks for DNS registration. When this button is active, 
DHCP clients that aren ’ t hip to DDNS won ’ t have their DNS records updated. However, 
Windows 2000, XP, Vista, Windows 7, Server 2003, and Server 2008 (2008 R2) DHCP 
clients are smart enough to ask for the updates.  
 Always Dynamically Update DNS A And PTR Records   This radio button forces 
the DHCP server to register any client to which it issues a lease. This setting may add 
DNS registrations for DHCP - enabled devices that don ’ t really need them, such as print 
servers; however, it allows other clients (such as Mac OS, Windows NT, and Linux 
machines) to have their DNS information automatically updated.  
  Discard A And PTR Records When Lease Is Deleted   This check box has a long name but a 
simple function. When a DHCP lease expires, what should happen to the DNS registration? 
Obviously, it would be nice if the DNS record associated with a lease vanished when the 
lease expired; when this check box is checked (as it is by default), that ’ s exactly what 
happens. If you uncheck this box, your DNS will contain entries for expired leases that are 
no longer valid; when a particular IP address is reissued on a new lease, the DNS will be 
updated, but in between leases you ’ ll have incorrect data in your DNS — something that ’ s 
always best to avoid. 
 F I G U R E 13 . 27 DNS tab of the scope ’ s IPv4 Properties dialog box 

 Dynamically Update DNS A And PTR Records For DHCP Clients That Do Not Request 
Updates   This check box lets you handle these older clients graciously by making the 
updates using a separate mechanism.  
 In Exercise 13.7, you will enable a scope to participate in Dynamic DNS updates.  
 E X E R C I S E  1 3 . 7
Enabling DHCP - DNS Integration 
 1. 
  Open the DHCP snap - in by selecting Start   Administrative Tools   DHCP. 
 2. 
  Right - click the IPv4 item, and select Properties. 
 3. 
  The Server Properties dialog box appears. Click the DNS tab.  
 4. 
  Verify that the check box labeled Enable DNS Dynamic Updates According To The 
Settings Below is checked, and verify that the radio button labeled Dynamically Update 
DNS A And PTR Records Only If Requested By The DHCP Clients is selected. 
 5. 
  Verify that the check box labeled Discard A And PTR Records When Lease Is Deleted is 
checked. If not, then check it.  
 6. 
  Click the OK button to apply your changes and close the Server Properties dialog box.  
 Using Multiple DHCP Servers 
 DHCP can become a single point of failure within a network if there is only one DHCP 
server. If that server becomes unavailable, clients will not be able to obtain new leases or 
renew existing leases. For this reason, it is recommended that you have more than one 
DHCP server in the network. However, more than one DHCP server can create problems if 
they both are conﬁ gured to use the same scope or set of addresses. Microsoft recommends 
the 80/20 rule for redundancy of DHCP services in a network. 
 Implementing the 80/20 rule calls for one DHCP server to make approximately 80 
percent of the addresses for a given subnet available through DHCP while another server 
makes the remaining 20 percent of the addresses available. For example, with a  /24  
network of 254 addresses, say  192.168.1.1 to  192.168.1.254 , you might have Server 1 
offer  192.168.1.10 to  192.168.1.210 while Server 2 offers  192.168.1.211 to  192.168.254 . 
 Working with the DHCP Database Files 
 DHCP uses a set of database ﬁ les to maintain its knowledge of scopes, superscopes, and 
client leases. These ﬁ les, which live in the   systemroot \System32\DHCP folder, are always 
open when the DHCP service is running. DHCP servers use Joint Engine Technology (JET) 
databases to maintain their records.  
Creating and Managing DHCP Scopes 
583

584 
Chapter 13 ■ Managing DHCP and DNS
 You shouldn ’ t modify or alter the DHCP database files when the service is 
running.  
 The primary database ﬁ le is  dhcp.mdb — it has all the scope data in it. 
 The following ﬁ les are also part of the DHCP database: 
 Dhcp.tmp is a backup copy of the database ﬁ le created during reindexing of the 
database. You normally won ’ t see this ﬁ le, but if the service fails during reindexing, 
it may not remove the ﬁ le when it should.  
 J50.log (plus a number of ﬁ les named  J50 xxxxx  . log , where   xxxxx  stands for 00001, 
00002, 00003, and so on) is a log ﬁ le that stores changes before they ’ re written to the 
database. The DHCP database engine can recover some changes from these ﬁ les when 
it restarts.  
 J50.chk is a checkpoint ﬁ le that tells the DHCP engine which log ﬁ les it still needs 
to recover.  
 In the following sections, you will see how to manipulate the DHCP database ﬁ les. 
 Removing the Database Files 
 If you ’ re convinced that your database is corrupt because the lease information you see 
doesn ’ t match what ’ s on the network, the easiest repair mechanism is to remove the 
database ﬁ les and start over with an empty database.  
 If you think the database is corrupt because the DHCP service fails at 
start - up, you should check the event log.  
 To start over, follow these steps: 
 1. 
 Stop the DHCP service by typing   netstopdhcpserver  at the command prompt.  
 2. 
  Remove all the ﬁ les from the   systemroot \system32\DHCP folder.  
 3. 
  Restart the service.  
 4. 
  Reconcile the scope.  
 Changing the Database Backup Interval 
 By default, the DHCP service backs up its databases every 60 minutes. You can adjust 
this setting by editing the Backup Interval value under  HKEY_LOCAL_MACHINE\SYSTEM\
CurrentControlSet\Services\DHCPServer\Parameters . This allows you to make backups 
either more frequently (if your database changes a lot or if you seem to have ongoing 
corruption problems) or less often (if everything seems to be on an even keel).  
 Moving the DHCP Database Files 
 You may ﬁ nd that you need to dismantle or change the role of your DHCP server and 
ofﬂ oad the DHCP functions to another computer. Rather than spend the time re - creating 
■
■
■

the DHCP database on the new machine by hand, you can copy the database ﬁ les and use 
them directly. This is especially helpful if you have a complicated DHCP database with lots 
of reservations and option assignments. 
 By copying the ﬁ les, you also minimize the amount of human error that could be 
introduced by reentering the information by hand.  
 Compacting the DHCP Database Files 
 There may be a time when you need to compact the DHCP database. Microsoft has a 
utility called  jetpack.exe that allows you to compact the JET database. Microsoft JET 
databases are used for WINS and DHCP databases. If you wanted to use the  jetpack 
command, the proper syntax is: 
JETPACK.EXE  < database name > < temp database name > 
 After you compact the database, you rename the temp database to  dhcp.mdb . 
 DNS 
 Even though we covered DNS in Chapter 2, on the Windows Server 2008 R2 
Infrastructure exam (70 - 642) there will be details of DNS that were not needed for the 
Windows Server 2008 R2 Active Directory exam (70 - 640). That ’ s what we are going to 
cover in this section. 
 If you did not read Chapter 2, stop and read it before proceeding. Most of 
the DNS concepts on the 70 - 642 exam were covered in Chapter 2.  
 Understanding DNS Components 
 You will need to know a few terms and concepts in order to manage a DNS server. 
Understanding these terms will make it easier to understand how the Windows Server 2008 
R2 DNS server works.  
 DNS Server   Any computer providing domain name services is a DNS name server. No 
matter where in the DNS namespace the server resides, it ’ s still a DNS name server. For 
example, 13 root servers at the top of the DNS tree are responsible for delegating the TLDs. 
The root servers provide referrals to name servers for the TLDs, which in turn provide 
referrals to an authoritative name server for a given domain. 
 Any DNS server implementation supporting service location resource records (see RCF 
2782) and dynamic updates (RFC 2136) is sufﬁ cient to provide the name service for any 
operating system running Windows 2000 software and newer.  
DNS 
585

586 
Chapter 13 ■ Managing DHCP and DNS
  DNS Client   A DNS client is any machine that issues queries to a DNS server. The client 
hostname may or may not be registered in a DNS database. Clients issue DNS requests 
through processes called  resolvers . You ’ ll sometimes see the terms  client and  resolver used 
synonymously.  
  DNS Server List   When setting up a DNS client, you have the ability to set up the DNS 
Server list. This is the list of DNS servers that the client can contact to resolve names.  
  DNS Suffix Search Order   Also on a client, you can set up the DNS sufﬁ x search order. 
The sufﬁ x name is the name of the DNS zone. For example, if you set up a DNS server for 
 stellacon.com , that would be the client ’ s sufﬁ x name. If anyone pings Server1, the sufﬁ x 
name  stellacon.com gets appended, resulting in  Server1.stellacon.com . You have the 
ability to set multiple sufﬁ x names on the client if your organization has multiple DNS 
names. Many of the DNS client settings (including sufﬁ x search order) can be conﬁ gured 
through the use of a Group Policy object (GPO).  
  Resolver  Resolvers are software processes, sometimes implemented in software libraries, 
that handle the actual process of ﬁ nding the answers to queries for DNS data. The resolver 
is also built into many larger pieces of software so that external libraries don ’ t have to 
be called in order to make and process DNS queries. Resolvers can be what you ’ d consider 
client computers or other DNS servers attempting to resolve an answer on behalf of 
a client.  
  Query   A query is a request for information sent to a DNS server. Three types of 
queries can be made to a DNS server: recursive, inverse, and iterative. We ’ ll discuss their 
differences later in this chapter. 
  Link - Local Multicast Name Resolution   Link - Local Multicast Name Resolution 
(LLMNR) is a peer - to - peer name resolution protocol that broadcasts to neighboring hosts 
to help resolve hostnames. LLMNR can work with both IPv4 and IPv6. Because LLMNR 
uses broadcasts, routers will not pass LLMNR protocol trafﬁ c. LLMNR is a good solution 
for small temporary networks. You can disable Multicast Name Resolution by using 
a GPO. 
  DNS Devolution   Using DNS devolution, if a client computer is a member of a child 
namespace, the client computer will be able to access resources in the parent namespace 
without the need to explicitly provide the fully qualiﬁ ed domain name (FQDN) of the 
resource. DNS devolution removes the left - most label of the namespace to get to the parent 
sufﬁ x. DNS devolution allows the DNS resolver to create the new FQDNs. DNS devolution 
works by appending the single - label, unqualiﬁ ed domain name with the parent sufﬁ x of the 
primary DNS sufﬁ x name.  
  Record Weighting   Weighting DNS records will allow an administrator to place a value 
on DNS SRV records. Clients will then randomly choose SRV records proportional to the 
weight value assigned.  
  Netmask Ordering   As we discussed in Chapter 2, if round robin is enabled, when a 
client requests name resolution, the ﬁ rst address entered in the database is returned to the 

resolver and is then sent to the end of the list. The next time a client attempts to resolve 
the name, the DNS server returns the second name in the database (which is now the ﬁ rst 
name) and then sends it to the end of the list, and so on. Round robin is enabled by default. 
 Netmask ordering is a part of the round robin process. When an administrator conﬁ gures 
netmask ordering, the DNS server will detect the subnet of the querying client. The DNS 
server will then return a host address available for the same subnet. Netmask ordering is 
enabled through the DNS Manager console   Server Properties   Advanced tab. 
 DnsUpdateProxy Group   As mentioned previously in the DHCP section, the DHCP server 
can be conﬁ gured to dynamically register host (A) and pointer (PTR) resource records on 
behalf of DHCP clients. Because of this, the DNS server can end up with stale resources. 
To help solve this issue, an administrator can use the built - in security group called 
DnsUpdateProxy. 
 To use the DnsUpdateProxy group, an administrator must ﬁ rst create a dedicated user 
account and conﬁ gure the DHCP servers with its credentials. This will protect against the 
creation of unsecured records. Also, by creating the dedicated user account, members of 
the DnsUpdateProxy group will be able to register records in zones that allow only secured 
dynamic updates. Multiple DHCP servers can use the same credentials of one dedicated 
user account.  
 Summary 
 This chapter covered the DHCP lease process as it relates to TCP/IP conﬁ guration 
information for clients. The following stages were covered: IP discovery, IP lease offer, IP 
lease selection, and IP lease acknowledgment. We covered how to install and conﬁ gure the 
DHCP server on Windows Server 2008 R2 as well as how to create and manage DHCP 
scopes and scope options. We also discussed the authorization of DHCP servers within 
Active Directory and scopes for IPv4 and IPv6 and showed how to create them. We covered 
superscopes as well as managing client leases with the options therein. 
 Even though we covered DNS in detail in Chapter 2, we discussed some extra concepts 
and pieces needed for the MCTS: Windows Server 2008 R2 Infrastructure exam (70 - 642).  
 Exam Essentials  
 Know how to install and authorize a DHCP server.   You install the DHCP service 
using the Add/Remove Windows Components Wizard. You authorize the DHCP 
server using the DHCP snap - in. When you authorize a server, you ’ re actually adding its 
IP address to the Active Directory object that contains a list of the IP addresses of all 
authorized DHCP servers.  
Exam Essentials 
587

588 
Chapter 13 ■ Managing DHCP and DNS
  Know how to create a DHCP scope.   You use the New Scope Wizard to create a new 
scope for both IPv4 and IPv6. Before you start, you ’ ll need to know what the IP address 
range is for the scope you want to create; which IP addresses, if any, you want to exclude 
from the address pool; which IP addresses, if any, you want to reserve; and the values for 
the DHCP options you want to set, if any.  
  Understand how relay agents help with multiple physical network segments.   A question 
about relay agents on the exam may appear to be a DHCP - related question. Relay agents 
assist DHCP message propagation across network or router boundaries where such 
messages ordinarily wouldn ’ t pass.  
  Understand the difference between exclusions and reservations.   When you want to 
exclude an entire range of IP addresses, you need to add that range as an exclusion. Any 
IP addresses within the range for which you want a permanent DHCP lease are known 
as reservations. Remember that exclusions are TCP/IP numbers in a pool that do not get 
issued and reservations are numbers in a TCP/IP pool that get issued only to the same client 
each time.  
 Understand the purpose of DNS.   DNS is a standard set of protocols that deﬁ nes a 
mechanism for querying and updating address information in the database, a mechanism 
for replicating the information in the database among servers, and a schema of the 
database.  
  Understand the different parts of the DNS database.   The SOA record deﬁ nes the general 
parameters for the DNS zone, including who the authoritative server is for the zone. NS 
records list the name servers for a domain; they allow other name servers to look up names 
in your domain. A host record (also called an  address or an  A record ) statically associates a 
host ’ s name with its IP addresses. Pointer records (PTRs) map an IP address to a hostname, 
making it possible to do reverse lookups. Alias records allow you to use more than one 
name to point to a single host. The MX record tells you which servers can accept mail 
bound for a domain. SRV records tie together the location of a service (such as a domain 
controller) with information about how to contact the service.  
  Know how DNS resolves names.   With iterative queries, a client asks the DNS server for 
an answer, and the client, or resolver, returns the best kind of answer it has. In a recursive 
query, the client sends a query to one name server, asking it to respond either with the 
requested answer or with an error. The error states either that the server can ’ t come up with 
the right answer or that the domain name doesn ’ t exist. With inverse queries, instead of 
supplying a name and then asking for an IP address, the client ﬁ rst provides the IP address 
and then asks for the name.  
 Understand the difference between DNS servers, clients, and resolvers.   Any computer 
providing domain name services is a DNS server. A DNS client is any machine issuing 
queries to a DNS server. A resolver handles the process of mapping a symbolic name to an 
actual network address.  
 Know how to install and configure DNS.   DNS can be installed before, during, or 
after installing the Active Directory service. When you install the DNS server, the DNS 

snap - in is installed, too. Conﬁ guring a DNS server ranges from very easy to very difﬁ cult, 
depending on what you ’ re trying to make it do. In the simplest conﬁ guration, for a caching -
 only server, you don ’ t have to do anything except make sure the server ’ s root hints are set 
correctly. You can also conﬁ gure a root server, a normal forward lookup server, and a 
reverse lookup server.  
 Know how to create new forward and reverse lookup zones.   You can use the New Zone 
Wizard to create a new forward or reverse lookup zone. The process is substantially the 
same for both types, but the speciﬁ c steps and wizard pages differ somewhat. The wizard 
will walk you through the steps, such as specifying a name for the zone (in the case of 
forward lookup zones) or the network ID portion of the network that the zone covers 
(in the case of reverse lookup zones).  
 Know how to configure zones for dynamic updates.   The DNS service allows dynamic 
updates to be enabled or disabled on a per - zone basis at each server. This is easily done in 
the DNS snap - in.  
 Know how to delegate zones for DNS.   DNS provides the ability to divide the namespace 
into one or more zones, which can then be stored, distributed, and replicated to other DNS 
servers. When delegating zones within your namespace, be aware that for each new zone 
you create, you ’ ll need delegation records in other zones that point to the authoritative 
DNS servers for the new zone.  
Exam Essentials 
589

590 
Chapter 13 ■ Managing DHCP and DNS
 Review Questions  
 1. 
  You are the network administrator for your Windows Server 2008 R2 network. You have 
a DHCP server that fails. You restore the DHCP server from backup. You need to prevent 
the DHCP server from issuing any IP addresses that are already being used on the network. 
What can you do?  
 A.   On the DHCP scope, set the Duplicate Address option.  
 B.   On the DHCP server, set the Duplicate Address option.  
 C.   Set the Conflict Detection value to 0.  
 D.   Set the Conflict Detection value to 2.  
 2. 
  You are the administrator for a Windows Server 2008 R2 network that uses DHCP. You 
notice that your DHCP database is getting too large and you want to reduce the size of the 
database. What should you do?  
 A.  From the folder containing the DHCP database, run  jetpack.exe dhcp.mdb temp.mdb . 
 B.   From the folder containing the DHCP database, run  shrinkpack.exe dhcp.mdb 
temp.mdb . 
 C.  From the folder containing the DHCP database, run  jetshrink.exe dhcp.mdb 
temp.mdb . 
 D.   From the folder containing the DHCP database, run  shrinkjet.exe dhcp.mdb 
temp.mdb . 
 3. 
 You administer a network that assigns IP addresses via DHCP. You want to make sure that 
one of the clients always receives the same IP address from the DHCP server. You create an 
exclusion for that address, but you find that the computer isn ’ t being properly configured at 
bootup. What ’ s the problem?  
 A.   You excluded the wrong IP address.  
 B.   You need to make a reservation for the client that ties the IP address to the computer ’ s 
MAC address. Delete the exclusion.  
 C.   You need to create a superscope for the address.  
 D.   You must configure the client manually. You cannot assign the address via the DHCP 
server.  
  4. 
  Your DHCP server crashed in the middle of the day. You rebooted the server and got it 
running within five minutes, and nobody but you seemed to notice that it had gone down at 
all. What additional steps must you take?  
 A.   None. If there were no lease - renewal requests during the five - minute period in which 
the DHCP server was down, none of the clients will ever know that it went down.  
 B.   You need to renew all the leases manually.  
 C.   None. The DHCP server automatically assigned new addresses to all the clients on the 
network transparently.  
 D.   You must reboot all the client machines.  

 5. 
  Your employer, the Stellacon Corporation, has used networking for years, starting with 
LAN Manager in the early 1990s. You migrated to Windows NT as an early adopter, 
and recently you also migrated to Windows 7 and 2008 R2 Server. You are using DHCP 
on your newly upgraded network, and you still have 100 Windows NT workstations 
to migrate before you ’ re finished. You have added a new DNS server to the network 
and modified the scope on the DHCP server to reflect the new addition. You know the 
command for the Windows NT machines, but what command would you use to verify 
the IP configuration on the Windows 7 machines?  
 A.   w2kipcfg /all 
 B.   ipconfig /all 
 C.   dhcpcfg /all 
 D.   tcpcfg /all 
 E. 
  winipcfg /all 
 6. 
 You have a private network that contains several DNS zones and servers, including a couple 
of root name servers. You never need to change any of your DNS data. You find that the 
load on one of your name servers is inordinately high. What can you do to reduce this load?  
 A.   Increase the TTL on the affected name server. 
 B.   Decrease the TTL on the affected name server. 
 C.   Add a service record to the affected name server.  
 D.   Edit the directory command in the DNS boot file.  
 7. 
  You have two master servers operating in your environment, a primary master and a 
secondary master. These DNS servers are authoritative for the zone  example.com . When 
the secondary master transfers the domain, what part of the DNS zone does it use to 
determine whether the zone data has changed?  
 A.   The TTL, or time to live 
 B.   The NS record  
 C.   The serial number 
 D.   The database record tombstone  
 8. 
  You ’ re troubleshooting an error whereby a client computer seems to have old DNS data. 
You ’ ve used  ipconfig  to see what DNS servers the client is using, and you ’ ve used  ping  to 
verify connectivity to those servers. What command should you use in order to clear the 
DNS cache on the client so that it will start building a new cache of DNS lookups?  
 A.   ipconfig /cleardns  
 B.   nslookup /flushdns  
 C.   dns /register 
 D.   ipconfig /flushdns  
Review Questions 
591

592 
Chapter 13 ■ Managing DHCP and DNS
 9. 
  What command can you use to clear the Windows Server 2008 R2 DNS server ’ s cache? 
 A.   ipconfig /flushcache 
 B.   dnscmd /flushcache 
 C.   ipconfig /clearcache 
 D.   dnscmd /clearcache 
 10.   You are the network administrator for a Windows Server 2008 R2 network. You have 
multiple remote locations connected to your main office by slow satellite links. You want 
to install DNS onto these offices so that clients can locate authoritative DNS servers in the 
main location. What type of DNS servers should be installed in the remote locations?  
 A.   Primary DNS zones  
 B.   Secondary DNS zones  
 C.   Active Directory – integrated zones 
 D.   Stub zones  

 Answers to Review Questions 
1. 
 D.   The Conﬂ ict Detection value speciﬁ es how many ICMP echo requests (pings) the server 
sends for an address it is about to offer. The default is 0. Conﬂ ict Detection is a way to 
verify that the DHCP server is not issuing IP addresses that are already being used on the 
network. 
2. 
 A.   Microsoft ’ s  jetpack.exe  utility allows you to compact a JET database. Microsoft JET 
databases are used for WINS and DHCP databases. 
3. 
 B.   An exclusion just marks addresses as excluded; the DHCP server doesn ’ t maintain any 
information about them. A reservation marks an address as reserved for a particular client. 
4. 
 A.   When the DHCP server crashed, the scope was effectively deactivated. Deactivating a 
scope has no effect on the client until it needs to renew the lease. 
5. 
 B.   ipconfig/all is still the command to display the IP conﬁ guration on Windows 2000, 
XP, Vista, Windows 7, Server 2003, and Server 2008 (2008 R2) machines. The  /all  switch 
is needed to show the details that include the DNS server address. The  winipcfg command 
is used for Windows 9 x workstations. The other commands are not valid. 
6. 
 A.   If the TTL is too small, the load on the DNS server will increase. 
7. 
 C.   Secondary servers use the serial number to determine whether the zone data has 
changed. By default, this value is automatically updated with Windows Server 2008 R2 
DNS server. The zone ’ s TTL is used to determine when to query for an update of the zone 
ﬁ le from the master server unless the master server has sent a Notify in the interim. 
8. 
 D.   The command  ipconfig /flushdns  clears the local DNS cache. 
9. 
 D.   DNSCmd  is a free downloadable ﬁ le that allows you to display and change 
the properties of DNS servers, zones, and resource records through the use of command -
 line commands. The  DNSCmd utility allows you to manually modify, create, and delete 
resource records and/or zones, and it allows you to force replication between two DNS 
servers. The  dnscmd /clearcache  command clears the DNS server cache. 
10.  D.   Stub zones are very useful for slow WAN connections. These zones store 
only three types of resource record: NS records, glue host (A) records, and SOA records. 
These three records are used to locate authoritative DNS servers. 
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 .  
Answers to Review Questions 
593


Managing Routing 
and Remote Access  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Addressing and Services  
 Configuring routing. May include but is not limited to: static 
routes; persistent routing; Routing Internet Protocol (RIP); 
metrics; choosing a default gateway; maintaining a routing 
table; demand - dial routing; IGMP proxy.  

■
 Chapter 
14

 As the use of TCP/IP internetworking has grown, so has the 
demand for easy - to - install and easy - to - conﬁ gure routers. Not 
every small business that wants to connect to the Internet or 
connect two remote ofﬁ ces can afford an expensive router and a certiﬁ ed professional to 
administer it. Microsoft ’ s ﬁ rst attempt to solve this problem was the version of the Routing 
and Remote Access Services (RRAS) included in the Windows NT 4.0 Option Pack, which 
is the direct ancestor of the RRAS components included in Windows Server 2008 R2. 
 The Windows Server 2008 R2 version of RRAS is a fully functional multiprotocol 
router. Third parties can also extend it to add network protocols or routing methods. The 
idea behind using RRAS for routing is that you can just enable RRAS on a Windows Server 
2008 R2 machine and use it as a router in addition to whatever else you have it doing. For 
example, you could use a Windows Server 2008 R2 computer with RRAS for routing, 
Internet Information Services (IIS) for Simple Mail Transfer Protocol (SMTP) mail and web 
services, and two network interface cards (NICs) to serve as a combination ﬁ rewall/router/
Internet server. 
 We will begin the chapter by discussing how routing works and covering the ways that 
routing is integrated into Windows Server 2008 R2.  
 
Even though this chapter is called  “ Managing Routing and Remote 
Access, ”  the actual concept of remote access will not be covered until 
Chapter 15,  “ Managing Remote Access Services. ”  
 Understanding Routing 
 Routing is the process of delivering trafﬁ c to the correct destination. IP routing is simple 
to understand at the most basic level. Packets have addresses, and the process of routing 
involves getting a packet from its source to its destination. The mechanics of how that 
happens are a little more complicated, though. In the following sections, you will see exactly 
what routing does, how routing works, and how Windows Server 2008 R2 handles routing. 
 What Routing Does 
 An  internetwork is just a network of networks. A sample internetwork might contain ﬁ ve 
distinct networks, which might be named after the cities they are based in, for example, 

Atlanta, Boston, Orlando, Portland, and San Diego. The internetwork is the collection of 
all these networks, any of which could ordinarily stand alone.  
 An internetwork is not the same as the Internet. Actually, it ’ s the other 
way around. The Internet we all use is just a really large, really complex 
internetwork.  
 Complex internetworks like the Internet require routing. Consider what happens 
when you try to send a ﬁ le over the Internet. Suppose you ’ re on the East Coast and the 
destination is in California. If you look at a map of the physical topology of the Internet, 
you ’ ll see that there are a large number of potential routes to get from here to there. Some 
may be better than others; for instance, one route would carry packets east, across the 
Atlantic, through Europe, and across Russia and the Paciﬁ c Ocean to the West Coast of the 
United States. That ’ s a legal route, but it would be inefﬁ cient. 
 Routing associates the routes a message might take with costs. Routing systems allow 
administrators to attach a metric, or  cost , to each leg of a route. In a bit, you ’ ll see how 
routing systems use this metric information to calculate the most efﬁ cient route for packets 
to take.  
 The actual way in which the metric information is used in calculations 
varies depending which routing protocol is being used. The routing 
protocols are Routing Information Protocol (RIP) version 1, RIP version 
2, and Open Shortest Path First (OSPF — which is no longer supported in 
Windows Server 2008 R2 Routing and Remote Access). The important 
point to remember is that all three routing protocols (discussed in more 
detail throughout this chapter) use metrics to figure out the  “ best ” route in 
any situation. 
 How Routing Works 
 The basic underlying idea in the routing process is that each packet on a network has a 
source address and a destination address, which means any device that receives the packet 
can inspect its headers to determine where it came from and where it ’ s going. If such a 
device also has some information about the network ’ s design and implementation — such 
as how long it takes packets to travel over a particular link — it can intelligently change the 
routing to minimize the total cost. 
 Figure 14.1 shows an imaginary network consisting of six interconnected local 
networks. These networks, named A through F, are connected by links of varying speeds 
and costs. This accurately mirrors what happens in the real world, where it ’ s common for 
internal networks (or Internet service providers) to have multiple ways to establish a link 
between two points. 
Understanding Routing 
597

598 
Chapter 14  Managing Routing and Remote Access
 Imagine that a client machine on network B wants to send trafﬁ c to a machine on 
network E. The most obvious route would probably be B to F to E, but you could also use 
B to C to D to E. Notice the costs: B - F - E has a total cost of 12, while the seemingly longer 
B - C - D - E actually has a lower cost of 8. That doesn ’ t appear to make sense because the 
latter route has a longer path. When you consider what cost really means, though, you ’ ll 
understand why this makes sense. 
 Assigning link costs is entirely up to you. Usually, you assign costs that reﬂ ect your 
preference for how you want trafﬁ c to ﬂ ow. An expensive or slow link would probably 
deserve a higher cost than a cheaper or faster link; if you assign a high cost to your most 
ﬁ nancially expensive links (for example, metered ISDN connections), they would not be 
used if there were more cost - efﬁ cient links available. 
 Now, revisit Figure 14.1 with the assumption that each circle is really a router. You can 
hide all the complexity of the network behind a router, because only the router is in charge 
of moving packets. Call your client machine X and your server Y. When X wants to send 
trafﬁ c to Y, it already knows the destination IP address of its target. X will build a packet, 
including its IP address as the source and Y ’ s address as the destination. X will then use its 
default gateway setting to send that packet to router B.  
1
2
10
5
F
2
5
E
D
C
A
B
 F I G U R E 14 .1 An example network 
 According to the Open Systems Interconnection (OSI) model, a gateway 
and a router are two different things. However, Microsoft uses the terms 
interchangeably, and so will we. We discussed OSI models in Chapter 11, 
 “ Understanding Windows Server 2008 R2 Networking. ” 
 Router B receives the packet and has both source and destination address information. By 
examining the IP addresses, it can determine that it doesn ’ t  “ know ” a direct route to the 
network where Y is located. However, two intermediate nodes claim to know how to 

reach Y: C and F. Because C has the lowest link cost, the router at B will send the packet to 
C in a simple routing algorithm. When C receives it, it will go through the same process, 
forwarding the packet on to D, and so on. Eventually the packet arrives at its destination. 
 Let ’ s take a look at some of the speciﬁ c ways in which RRAS actually performs the steps 
in the preceding example. 
 Routing Tables 
 A routing table is a database that stores route information. Think of it as a road map for 
the internetwork — the routing table lists which routes exist between networks, so the 
router or host can look up the necessary information when it encounters a packet bound 
for a foreign network. Each entry in the routing table contains the following ﬁ ve pieces of 
information: 
 The network address of the remote host or network  
 The netmask associated with the entry  
 The forwarding address to which trafﬁ c for the remote network should be sent  
 The network interface that should be used to send the packet to the forwarding address  
 A cost, or metric, that indicates what relative priority should be assigned to this route  
 For example, you could write the San Diego – Atlanta route as 10.1.1.0:255.255.255.
128:10.10.1.254:ATL:1, assuming that the interface name is ATL and you want to use a 
metric of 1. The actual format in which these entries are stored isn ’ t important (in fact, it ’ s 
not visible in RRAS); what ’ s important for you to know is that every routing table entry 
contains that information. 
 Routing tables actually can contain these three different kinds of routes: 
 Network routes provide a route to an entire network. For example, the route from San 
Diego to Atlanta is a network route because it can be used to route trafﬁ c from any 
host in San Diego to any host in Atlanta.  
 Host routes provide a route to a single system or to a broadcast address. Think of them 
as shortcuts — they provide a slightly more efﬁ cient way for a router to  “ know ” how to 
get trafﬁ c to a remote machine, so they ’ re usually used when you want to direct trafﬁ c 
to remote networks through a particular machine.  
 Default routes are where packets go when there ’ s no explicit route for them. They 
are similar to the default gateway you ’ re used to conﬁ guring for IP clients. Anytime 
a router encounters a packet bound for some remote network, it will ﬁ rst search the 
routing table; if it can ’ t ﬁ nd a network or host route, it will use the default route 
instead. This saves you from having to conﬁ gure a network or host route for every 
network to which you might ever want to talk.  
 Static Routing 
 Static routing provides predeﬁ ned routes in a table called, predictably, a  static routing 
table . Static routing systems don ’ t make any attempt to discover other routers or systems 
■
■
■
■
■
■
■
■
Understanding Routing 
599

600 
Chapter 14  Managing Routing and Remote Access
on their networks. Instead, you manually tell the routing engine how to get data to other 
networks; speciﬁ cally, you tell it what other networks are reachable from your network 
by specifying the network addresses, subnet masks, and a metric for each network. This 
information goes into the system ’ s routing table. When an outgoing packet arrives at the 
routing engine, the engine can examine the routing table to select the lowest - cost route to 
the destination. If there ’ s no explicit entry in the routing table for that network, the packet 
goes to the default gateway, which is then entrusted with getting the packet to where it 
needs to go. 
 Static routing is faster and more efﬁ cient than dynamic routing. Static routing works 
well with a small network that doesn ’ t change much. You can identify the remote networks 
to which you want to route and then add static routes to them to reﬂ ect the costs and 
topology of your network. In Windows Server 2008 R2, you maintain static routes with 
the  route command, which allows you to either see the contents of the routing table or 
modify it by adding and removing static routes to individual networks.  
 Dynamic Routing 
 Unlike static routing,  dynamic routing doesn ’ t depend on your adding ﬁ xed, unchangeable 
routes to remote networks. Instead, a dynamic routing engine can discover its surroundings 
by ﬁ nding and communicating with other nearby routers in an internetwork. 
 This process, usually called  router discovery , enables a newly added (or rebooted) router 
to conﬁ gure itself. This is roughly equivalent to the process that happens when you move 
into a new neighborhood. Within a short time of your arrival, you ’ ll probably meet most 
of the people who live nearby, either because they come to you or because you go to them. 
At that point, you have useful information about the surrounding environment that could 
come only from people who were already there. 
 The dynamic routing protocol in Windows Server 2008 R2 is the Routing Information 
Protocol. In previous versions, the Open Shortest Path First protocol was also used, but 
in Windows Server 2008 R2, OSPF has been discontinued. RIP has its advantages and 
disadvantages. Each router (whether a hardware device, a Windows Server 2008 R2 
machine, or otherwise) is connected to at least two separate physical networks. When the 
router starts, the only information it has comes from its internal routing table. Usually, 
that means it knows about all the attached networks plus whatever static routes have been 
previously deﬁ ned. The router then receives conﬁ guration information that tells it about the 
state and topology of the network. 
 As time goes on, the network ’ s physical topology can change. For example, take a look 
at the network in Figure 14.2. If network G suddenly lost its connection, the routers in 
sites A, D, and E would need to readjust their routing tables because they could no longer 
route trafﬁ c directly to G. The process by which this adjustment happens is what makes 
the routing dynamic, and it ’ s also the largest area of difference between the two dynamic 
routing protocols for IP.  

 In the following sections, we will look at both RIP and OSPF more closely. 
 The Routing Information Protocol 
 RIP is a distance - vector routing protocol that is generally simple and easy to conﬁ gure, but 
it has performance limitations that restrict its usefulness on medium and large networks. 
RIP routers begin with a basically empty routing table, but they immediately begin sending 
out announcements that they know will reach the networks to which they ’ re connected.  
 RIP uses UDP as a transport protocol and port 520 by default. 
 RIP announcements may be broadcast or multicast. Routers on other networks that hear 
these announcements can add the advertised routes to their own routing tables. The process 
works both ways, of course; your router will hear announcements from other routers and 
add the advertised routes to its list of places it knows how to reach. Unfortunately, RIP 
supports a maximum of only 15 hop counts (the number of routers that a packet can pass 
through). 
 Microsoft ’ s RIP implementation in Server 2008 R2 supports RIPv2. You should be 
aware of these important differences between RIPv1 and RIPv2: 
 The primary, or most important, difference between versions 1 and 2 of RIP is that 
RIPv2 supports variable - length subnet masking (VLSM). VLSM helps preserve IP 
address space by enabling networks to be subdivided into smaller blocks based on need. 
 RIPv2 supports simple (that is, plain text) username/password authentication, which is 
handy to prevent unwanted changes from cluttering your routing tables.  
■
■
1
2
10
5
2
F
D
5
5
5
C
E
G
A
B
 F I G U R E 14 . 2 A more complex, dynamically routed network 
Understanding Routing 
601

602 
Chapter 14  Managing Routing and Remote Access
 RIPv2 routers add the ability to receive triggered updates. When you know that your 
network topology is changing (perhaps because you ’ ve added connectivity to another 
network), you can send out a trigger that contains information about the changes. 
This trigger forces all the RIP routers you own to assimilate the changes immediately. 
Triggered updates are also useful because routers that detect a link or router failure 
can update their routing tables and announce the change, making their neighbors 
aware of it sooner rather than later.  
 You can use the Routing And Remote Access snap - in to set up two kinds of ﬁ lters that 
screen out some types of RIP updates: 
 Route ﬁ lters allow you to pick and choose the networks that you want to admit 
knowing about and for which you want to accept announcements.  
 Peer ﬁ lters give you control over the neighboring routers to which your router will 
listen.  
 RIP also incorporates features that attempt to prevent route loops. In Figure 14.2 
(shown earlier in the chapter), the network topology has the potential to cause a route 
loop. For instance, say that someone in E wants to send a packet to a machine in A, but 
the G - A and D - C links are down. E sends the packet to G, which recognizes that it can ’ t 
reach A. Also, G knows that the route D - C - B - A will work, so it sends the packet to D. 
When the packet reaches D, D knows it can ’ t talk to C, so it sends the packet to E because 
E - G - A is usually a valid route. You can see that the packet will never reach its destination 
and will loop continually. This might seem like a contrived example, but in real life, where 
internetwork links are often concentrated among a small number of physical links, it ’ s a 
real problem. RIP offers several methods for resolving and preventing loops, including the 
split - horizon and poison - reverse algorithms. (Despite their cool names, it ’ s not important to 
understand how these algorithms work to pass the exam — it ’ s enough to know what they ’ re 
for and that RIP implements them to protect against routing loops.) 
 RIP has two operation modes: 
 In  periodic update  mode, a RIP router sends out its list of known routes at periodic 
intervals (which you deﬁ ne). The router marks any routes it learns from other routers 
as RIP routes, which means they remain active only while the router is running. If 
the router is stopped, the routes vanish. This mode is the default for RIP on LAN 
interfaces, but it ’ s not suitable for demand - dial connections because you don ’ t want 
your router bringing up a connection just to announce its presence.  
 In  autostatic update mode, the RRAS router broadcasts the contents of its routing table 
only when a remote router asks for it. Better still, the routes that the RRAS router learns 
from its RIP neighbors are marked as static routes in the routing table, and they persist 
until you manually delete them — even if the router is stopped and restarted or if RIP is 
disabled for that interface. Autostatic mode is the default for demand - dial interfaces.  
 One drawback to RIP in either version is that it causes the router to send its entire 
routing table with every update. This can generate a large amount of trafﬁ c and makes RIP 
inappropriate for many of today ’ s networks. Another routing protocol, Open Shortest Path 
First, solves this problem by sending updates for only routes that have changed.  
■
■
■
■
■

 The Open Shortest Path First Protocol 
 RIP is designed for fairly small networks; it can handle only 15 router - to - router hops. 
If you have a network that spans more than 16 routers at any point, RIP won ’ t be able 
to cache routes for it, and some parts of the network will appear to be (or in fact will 
be) unreachable. The OSPF routing protocol is a link - state protocol designed for use 
on medium, large, or very large networks. It ’ s much more efﬁ cient than RIP, but it also 
requires more knowledge and experience to set up and administer. Also, as stated earlier in 
the chapter, OSPF is no longer supported by Windows Server 2008 R2 RRAS. 
 RIP routers continually exchange routing data with one another, which allows incorrect 
route entries to propagate. Instead of exchanging routing data, each OSPF router maintains 
a map of the state of the internetwork. This map, called a  link - state map , provides a 
continually updated reference to the state of each internetwork link. Neighboring routers 
group into an  adjacency (similar to a neighborhood). Within an adjacency, routers 
synchronize any changes to the link - state map. When the network topology changes, 
whichever router notices it ﬁ rst ﬂ oods the internetwork with change notiﬁ cations. Each 
router that receives the notiﬁ cation updates its copy of the link map and then recalculates 
its internal routing table. 
 The  “ shortest path ﬁ rst ” in OSPF refers to the algorithm that OSPF systems use to 
calculate routes. Routes are calculated so that the shortest path (the one with the lowest 
cost) is used ﬁ rst. SPF - calculated routes are always free of loops, which is another nice 
advantage over RIP. 
 OSPF networks are broken down into subparts called  areas ; an area is a collection of 
interconnected networks. Think of an area as a subsection of an internetwork. Areas are 
interconnected by backbones. Each OSPF router keeps a link - state database only for the 
areas to which it ’ s connected. Special OSPF routers called  area border routers  interlink 
areas. Figure 14.3 shows how this looks.  
Area border routers
Area 1
Area 2
Backbone area
 F I G U R E  14 . 3 A simple OSPF network 
Understanding Routing 
603

604 
Chapter 14  Managing Routing and Remote Access
 Border Routing 
  Internal routing refers to routing that occurs within your internetwork. By contrast,  border 
routing is what happens when packets leave your internetwork and go to another router 
someplace else. Consider what happens when you use your home computer to browse a 
website. TCP/IP packets from your machine go to your ISP (probably via PPP, over an 
analog, cable, DSL, or ISDN connection). The ISP examines the destination address of the 
packets and determines that they should go to some other network, usually a network for 
which the ISP doesn ’ t maintain a direct connection. 
 For example, when you want to fetch a web page from Microsoft ’ s website, you 
essentially lease an Internet connection from a local ISP, which likely leases lines from 
another, larger provider, which maintains peering connections at national access points 
(NAPs). These peering connections maintain routing tables for various networks on the 
Internet. They forward your packet to the next - nearest hop, and then on to the next - nearest 
hop, until the packet reaches its destination. 
 Figure 14.4 shows an example of the Internet service provider where one of this book ’ s 
authors used to work: Core Digital Communication Services (later ExecPC/Voyager). 
The local router represents a home user or business connected to the ISP. From there, the 
Stevens Point router forwarded packets over a DS3 to Appleton; from there they traveled to 
Milwaukee and on to the NAP in Chicago. The thick black lines between borders indicate 
backbone links that join border areas together. Even though this network was all owned 
by ExecPC/Voyager, it utilized different OSPF areas up to the NAP where Border Gateway 
Protocol (BGP) was used. The true border of this network was at the NAP.  
Local
Router
Stevens
Point
Router
Appleton
Router
Milwaukee
Router
Chicago
NAP
 F I G U R E 14 . 4 Networks are divided into areas linked by backbones 
 In a border routing network, some routers are responsible for handling packets inside 
the area, while others manage network communication with other areas. These border 
routers are responsible for storing routes to other borders that they can reach over the 
backbone.  
 Multicast Routing 
 IP multicasting works by sending to a single IP address a packet that is read by many 
hosts. The hosts all have individual IP addresses, but they belong to a multicast group that 
shares a single, separate IP address. As you saw in Chapter 13,  “ Managing DHCP and 
DNS, ” multicast group membership is dynamic, and groups can contain unlimited hosts on 

separate IP networks, provided that routers between the networks support multicast trafﬁ c. 
In fact, even computers that aren ’ t part of a multicast group can send multicast packets. 
 Multicasting uses a special range of IP addresses, called the  Class D address space , 
that is reserved exclusively for multicasting. The multicast address range contains the IP 
addresses  224.0.0.0 through  239.255.255.255 . Each multicast group uses a single address 
in the Class D address space. In addition, just as with regular IP addresses, the multicast 
address range reserves a few special addresses used for speciﬁ c purposes. Table 14.1 
contains a partial list of these special multicast addresses.  
 TA B L E 14 .1  Special multicast addresses 
 Address  
  Description  
 224.0.0.0 
  Base address (reserved)  
 224.0.0.1 
  All hosts, all systems on the same network segment 
 224.0.0.2 
  All routers, all routers on the same network segment 
 224.0.0.5 
  All OSPF routers, used to send routing information to all OSPF routers 
on the network 
 224.0.0.6 
  All designated OSPF routers, used to send routing information to all 
designated OSPF routers 
 224.0.0.9 
  All RIP 2 routers, used to send routing information to all RIPv2 routers 
on the network 
 224.0.1.24 
 Used to support replication for WINS servers 
 Is a Multi - homed Computer a Router? 
 For several years, your company has been growing steadily, from a small network of 
50 Windows NT workstations and 5 Windows NT servers to a medium - sized network of 
more than 200 Windows 7 and Vista workstations and more than 10 Windows Server 
2008 servers. Everything functions properly, but performance is beginning to suffer. 
After analyzing the network trafﬁ c, you realize that you need to segment the network into 
subnets to control the trafﬁ c and improve the performance. You are considering using 
multi - homed computers to save money when purchasing dedicated routers. 
Understanding Routing 
605

606 
Chapter 14  Managing Routing and Remote Access
 Internet Group Management Protocol (IGMP) is used to exchange multicast group 
membership information between multicast - capable routers. You can conﬁ gure RRAS in 
two modes: 
 IGMP router mode listens for IGMP membership report packets and tracks group 
membership. IGMP router mode must be attached to any interfaces that connect to 
multicast - conﬁ gured hosts.  
 IGMP proxy mode  essentially acts like a multicast host, except that it forwards IGMP 
membership report packets to an IGMP router. This provides a list of multicast -
 enabled hosts to an upstream router that normally wouldn ’ t be aware of the hosts. 
Typically, IGMP proxy is used on single - router networks connected to the Internet. 
The IGMP proxy sends the list of multicast hosts to the multicast - capable portion of 
the Internet known as the  Internet multicast backbone , or MBone, so that the hosts 
can receive multicast packets.  
 You may need to send multicast trafﬁ c across non - multicast - compatible routers. This 
is made possible through the use of  IP - in - IP interfaces (or  IP - in - IP tunnels ). An IP - in - IP 
interface actually encapsulates packets with an additional IP header. The encapsulated 
packets can be sent across any router because they appear to be ordinary IP packets. You 
create and manage IP - in - IP interfaces in RRAS the same way you conﬁ gure other interfaces. 
 Routing in Windows Server 2008 R2 
 RRAS provides a multiprotocol router. In other words, the RRAS routing engine can 
handle multiple network protocols and multiple routing methods on multiple NICs. RRAS 
provides some speciﬁ c features of interest when the conversation turns to network routing: 
■
■
 Windows Server 2008 R2 has expanded support with the RIP routing protocol. But before 
you leap at the cost savings of using a multi - homed Windows Server 2008 R2 computer, you 
want to take a closer look. 
 Despite some added cost, there is a lot to be said for using specialized routing computers 
for the connection points in networks. When there is a signiﬁ cant utilization of bandwidth 
across your network, it ’ s questionable whether the multi - homed host will be able to provide 
the level of service you need. General - purpose operating systems such as Windows Server 
2008 R2 will always pale in comparison to a computer that ’ s designed to perform singular 
tasks. In addition, with the basic routing protocols, you can use many tools and services to 
guarantee levels of service and to set up ﬁ lters and access control lists. 
 Windows Server 2008 R2 doesn ’ t really make sense as a router for small ofﬁ ces either, 
with the cost of basic routers being so low. Make sure you are applying these Windows 
Server 2008 R2 routing services in the areas that are appropriate for the particular load 
and scale of your situation. 

 Demand - dial routing can open connections to speciﬁ c networks when the router 
receives packets addressed to those networks. This feature allows you to use on -
 demand links instead of permanent connections. It ’ s especially nice for Integrated 
Services Digital Network (ISDN), which combines per - minute fees in most places with 
really fast call setup times. Point - to - Point Tunneling Protocol (PPTP) connections can 
be demand - dialed, too, or you can use demand - dial interfaces to make long - distance 
connections only when they ’ re needed.  
 You can establish static routes that specify where packets bound for certain networks 
should go. The most common use of this feature is to link a remote network with your 
LAN. The remote network gets one static route that basically says,  “ Any trafﬁ c leaving 
my subnet should be sent to the router. ” RRAS handles it from there.  
 Dynamic routing using RIPv1 and RIPv2 protocols provides ways for your router to 
share routing information with other routers  “ near ” it in network space.  
 Packet ﬁ ltering screens out undesirable packets in both directions. For example, you can 
create a packet ﬁ lter to keep out FTP trafﬁ c, or you can add a ﬁ lter to a demand - dial 
interface so that it will be opened only for web or mail trafﬁ c. Other trafﬁ c types will pass 
if the link is up, but they won ’ t cause RRAS to open the link if it ’ s not already open. (See 
the section  “ Conﬁ guring TCP/IP Packet Filters ” later in the chapter for more details.)  
 In unicast routing, one machine sends directly to one destination address. In multicast 
routing, one machine sends to an entire network. RRAS supports both methods.  
 Network Address Translation (NAT) is a service that allows multiple LAN clients to 
share a single public IP address and Internet connection.  
■
■
■
■
■
■
 About NAT 
 NAT provides an advantage with routing. NAT (also referred to as  network 
masquerading ) allows a router to translate one IP address to another. 
 For example, let ’ s say you have two networks ( 10.10.0.0 and  192.168.1.0 ), and they 
are conﬁ gured with two separate sets of TCP/IP addresses. The router can use NAT so 
that a user from the  10.10.0.0 network goes to the  192.168.1.0 network and gets a 
valid IP address for that network. Basically, the NAT swaps its  10.10.0.0 address for a 
 192.168.1.0 address. 
 NAT is also commonly used for Internet connections. For example, let ’ s say you have 
an Internet service provider that issues you only six valid Internet TCP/IP addresses for 
you to use on your network. You can set up NAT and program it to use those six valid 
addresses. Then, when a user from the network wants to access the Internet, NAT swaps 
the user ’ s internal IP address for one of the valid IP addresses. 
Understanding Routing 
607

608 
Chapter 14  Managing Routing and Remote Access
 Installing RRAS 
 To use RRAS, you need to install the RRAS components on computers running Windows 
Server 2008 R2, because they ’ re not installed by default. You can do this through the 
Server Manager MMC ’ s Add Roles Wizard. Exercise 14.1 leads you through the process of 
installing RRAS as a router.  
 E X E R C I S E  1 4 .1
Installing RRAS for IP Routing  
 1. 
  Open Server Manager by clicking Start   Administrative Tools   Server Manager. 
 2. 
  In the left pane, click Roles. In the right pane, click Add Roles. 
 3. 
  On the Select Server Roles page, check the Network Policy And Access Service box, and 
click Next. 
 4. 
  On the Introduction page, click Next. 
 5. 
  On the Select Role Services page, check the Routing And Remote Access Services box, 
and click Next.  
 6. 
  On the Conﬁ rm Installation Selections page, click Install. 
 7. 
  On the Installation Results page, verify that the installation was successful, and click 
Close.  
 8. 
  Close the Server Manager MMC. 
 9. 
  Open the Routing and Remote Access snap - in by selecting Start   Administrative Tools 
  Routing And Remote Access. 
 10.   Select the server you want to conﬁ gure in the left pane of the MMC. Right - click the 
server, and choose Conﬁ gure And Enable Routing And Remote Access. 
 The Routing and Remote Access Server Setup Wizard appears. Click the Next button.  
 11.   On the Conﬁ guration page, ensure that the Secure Connection Between Two Private 
Networks radio button is selected. Then click the Next button. 
 12.   The Demand - Dial Connections page appears. It ’ s there only to ask whether you want 
to use demand - dialed connections; you still have to set up the connections (either 
manually or using the Demand - Dial Wizard) after you complete the Routing and Remote 
Access Server Setup Wizard. Select Yes to use demand - dial connections. Click Next to 
continue.  
 13.   On the IP Address Assignment page, you can choose how RRAS assigns IP addresses 
to incoming demand - dial calls. If you want to use DHCP (either a DHCP server on 

your network or the built - in address allocator), leave the Automatically radio button 
selected. If you want to pick out an address range, select the From A Speciﬁ ed Range Of 
Addresses button. Click the Next button. 
 14.   Click the Finish button on the summary page to close the wizard. If you chose to create 
a demand - dial interface, the Demand - Dial Interface Wizard appears automatically. 
Leave the computer in its current state because Exercise 14.2 will walk you through the 
Demand - Dial Interface Wizard. 
 Configuring IP Routing 
 Continuing from the previous exercise, when the summary page of the Routing And 
Remote Access Server Setup Wizard appears, it ’ s going to remind you to do the following 
things, depending on whether you chose to use demand - dial connections: 
 Add demand - dial interfaces if you want to support demand dialing.  
 Give each routable interface a network address for each protocol it carries. For 
example, if you ’ re using IP and IPX on a computer with three NICs, each NIC that 
participates in routing needs to have distinct IP and IPX addresses.  
 Install and conﬁ gure the routing protocols (for example, RIP for IP in this case) on the 
interfaces that should support them.  
 These three actions form the core of what you must do to make your RRAS server 
into an IP router. In the following sections, we ’ ll cover how RRAS treats LAN, 
demand - dial, and RIP interfaces. Next, we ’ ll show how to conﬁ gure properties that affect 
RRAS in general, such as error logging and route preferences. You ’ ll also learn how to 
install and conﬁ gure RIP. Finally, you ’ ll see how to manage static routes with the  route 
command. 
 Creating and Managing Interfaces 
 The Network Interfaces node in the Routing And Remote Access snap - in (shown in Figure 
14.5) summarizes the routable interfaces available on your machine for  all protocols. It lists 
all the LAN and demand - dial interfaces, plus two special interfaces maintained by RRAS: 
loopback and internal. Each of the interfaces displayed has a type, a status (either Enabled 
or Disabled), and a connection status associated with it. For example, a Windows Server 
2008 R2 machine in the default conﬁ guration with a single NIC displays the Local Area 
Connection interface. Each of those interfaces represents a potential destination for routed 
packets.  
■
■
■
Configuring IP Routing 
609

610 
Chapter 14  Managing Routing and Remote Access
 You can right - click each interface to get a pop - up menu with some useful commands, 
including Disable, Enable, and Unreachability Reason (which tells you why an interface is 
marked as Unreachable). The menu also contains some commands speciﬁ c to demand - dial 
interfaces, which will be covered in the following sections.  
 What  “ Unreachable ” Really Means 
 A demand - dial interface can be in any of several different states: 
 First, the Enabled and Disabled states that appear in the Status column indicate 
whether the link is administratively available — that is, whether you ’ re allowing 
people to use it. 
 The Connection State column shows you whether the connection is working. The 
default state for a demand - dial connection is Disconnected, which is perfectly 
reasonable. When RRAS tries to establish a connection, the state changes to 
 Connected — also eminently logical. In both the connected and disconnected states, 
any static routes tied to the demand - dial interface are available. 
 When RRAS tries to dial a number and fails to connect, it will continue to try until it 
reaches the redial limit set on the Dialing tab of the interface ’ s Properties dialog box 
(the default redial limit is 10 minutes). If the redial limit is reached, the interface will 
be marked as Unreachable for a time - out period.  
 As long as the interface is unreachable, any static routes pointing to it will be 
unavailable — they ’ ll actually disappear from the routing table. After the time - out period, 
RRAS will try again to dial; if it fails again, it tacks another 10 minutes onto the time - out 
and tries again. If the time - out period reaches the maximum (six hours by default), the 
counter will stop incrementing so RRAS will try again to connect every six hours until a 
successful connection is made or until you restart the RRAS service. 
 You can adjust both the minimum and maximum values for this time - out from their 
defaults (10 minutes and 6 hours, respectively). You make this change in the Registry, 
by adding two REG_DWORD values to  HKLM\System\CurrentControlSet\Services\
Router\Interfaces\InterfaceName (where InterfaceName matches the name of the 
interface you want to change). The MinUnreachabilityInterval value controls both 
the minimum retry interval and how much the retry interval is incremented after each 
failure; the MaxUnreachabilityInterval sets the upper limit. Both of these values must be 
expressed in seconds. 
■
■
■

 Managing LAN Interfaces 
 LAN interface options appear when you select the General node under the IPv4 node in 
the Routing And Remote Access snap - in. These options correspond to the LAN interfaces 
you ’ ve deﬁ ned in RRAS. You can set general properties for the LAN interfaces. After 
you add speciﬁ c routing protocols to the interfaces, you can conﬁ gure those protocols 
individually (as you ’ ll see later in this chapter). 
 To see the properties for an interface, select the General node in the console, click the 
interface in the pane on the right, and select Action   Properties, which opens the Local 
Area Connection Properties dialog box (Figure 14.6).  
 F I G U R E 14 . 5 The Network Interfaces node 
 F I G U R E 14 .6 The General tab of the Local Area Connection Properties dialog box 
Configuring IP Routing 
611

612 
Chapter 14  Managing Routing and Remote Access
 The General tab allows you to set some useful parameters for the entire interface, 
including whether this interface will send out router discovery advertisements so that other 
routers on your network can ﬁ nd it. 
 The controls on the General tab do the following: 
 The Enable IP Router Manager check box controls whether this interface allows 
IP routing at all. When it ’ s checked, the administrative status of this interface will 
appear as Up, indicating that it ’ s available for routing trafﬁ c. When it ’ s unchecked, the 
interface will be marked as Down; it won ’ t route any packets, and other routers won ’ t 
be able to communicate with it.  
 The Enable Router Discovery Advertisements check box controls whether this router 
will broadcast router discovery messages. These messages allow clients to ﬁ nd a 
 “ nearby ” (in network terms) router without any manual conﬁ guration on your part. 
When this check box is enabled, the controls below it become active so you can set the 
following properties:  
 The Advertisement Lifetime (Minutes) ﬁ eld determines how long advertisements 
are valid. Clients will ignore any advertisement they receive after its lifetime has 
expired.  
 The Level Of Preference ﬁ eld determines how clients use this router in comparison 
with other routers on your network. Clients use routers with higher preferences ﬁ rst; 
if there are routers with equal preference levels, the client can randomly select one.  
 RRAS will send out advertisements at a randomly chosen interval that falls 
between the minimum and maximum time intervals for sending advertisements. 
The default settings mean RRAS will send an advertisement every 7 to 10 minutes.  
 The Inbound Filters and Outbound Filters buttons allow you to selectively accept or 
reject packets on the speciﬁ ed interface. You can accept all packets that don ’ t trigger a 
ﬁ lter or accept only those packets that match ﬁ lter criteria. Each type of ﬁ lter can use 
the source or destination IP address and netmask as ﬁ lter criteria. For example, you 
can construct a ﬁ lter that rejects all packets from  206.151.234.0 with a netmask of 
 255.255.255.0 ; that effectively screens out any trafﬁ c from that subnet.  
 The Enable Fragmentation Checking check box tells your router to reject any 
fragmented IP packets instead of accepting them for processing. Because ﬂ ooding a 
router with fragmented IP packets is a popular denial - of - service attack, you may want 
to check this box.  
 Setting Up Demand - Dial Interfaces 
 When you install RRAS, it will automatically create an interface for each LAN connection 
it can ﬁ nd. If you want to create new demand - dial interfaces, you ’ ll have to do it yourself. 
Fortunately, there ’ s an easy way to do this with the Demand - Dial Interface Wizard. To 
activate the wizard, right - click the Network Interfaces node in the Routing And Remote 
Access snap - in, and choose the New Demand - Dial Interface command. 
 In the following sections, we cover the steps involved in setting up demand - dial interfaces. 
■
■
■
■
■
■
■

 Naming the Interface 
 The ﬁ rst page of the wizard is the Interface Name page, where you specify the name you 
want the new interface to have. This is the name you ’ ll see in the Routing And Remote 
Access snap - in, so you should choose a name that identiﬁ es the source and destination of 
the connection (for example, HSV - ATL for a connection between Huntsville and Atlanta). 
This is particularly useful when you want to use one RRAS console somewhere on a 
network to manage many RRAS servers, because having an easy way to see which link 
you ’ re working with can be very valuable.  
 Choosing a Connection Type 
 The Connection Type page of the wizard allows you to specify which type of demand -
 dial interface you will create. Demand - dial interfaces can use a physical device (such as a 
modem or an ISDN adapter) or a virtual private network (VPN) connection. For example, 
you can have a demand - dial connection that opens a VPN tunnel to a remote network 
when it sees trafﬁ c destined for that network. Depending on which option you choose here, 
the remaining wizard pages will differ. 
 Assuming you choose to use a physical device as the basis for your network, the Select 
A Device page of the wizard prompts you to choose a device (such as a modem or ISDN 
terminal adapter) to use for this demand - dial interface. If the device you want to use isn ’ t 
already set up, you ’ ll need to add it; for that reason, you ’ re probably better off adding and 
conﬁ guring modems before setting up RRAS. 
 If you specify that you want to use a VPN connection, you ’ ll see the VPN Type page, where 
you can specify what type of VPN connection to use. You have the following three choices: 
 The Automatic radio button tells RRAS to ﬁ gure out the connection type when 
negotiating with the remote server. This is the most ﬂ exible choice, so it ’ s selected by 
default.  
 The Point - To - Point Tunneling Protocol (PPTP) radio button tells RRAS that this 
connection will always use PPTP.  
 Likewise, the Layer 2 Tunneling Protocol (L2TP) radio button indicates that you want 
this connection to always use L2TP. 
 Determining Who to Call 
 The next step is the same for both VPN and physical connections, even though the wizard 
page is labeled differently. For VPNs, you ’ ll see the Network Address page. For ordinary 
dial - up connections, the page is labeled Phone Number. In either case, you should enter the 
phone number or IP address (whichever is appropriate) of the remote router.  
 Setting Routing and Security Options 
 The next page is the Protocols And Security page, which contains four conﬁ guration check 
boxes: 
 The Route IP Packets On This Interface Or Route IPX Packets On This Interface box 
controls whether this interface will handle the speciﬁ ed packet types. By default, IP 
routing is enabled, but IPX routing isn ’ t.  
■
■
■
■
Configuring IP Routing 
613

614 
Chapter 14  Managing Routing and Remote Access
 If you want to add a user account so that a remote router (running RRAS or not) can 
dial in, check the Add A User Account So A Remote Router Can Dial In box.  
 Some routers can handle Password Authentication Protocol (PAP), Challenge 
Handshake Authentication Protocol (CHAP), or Microsoft Challenge Handshake 
Authentication Protocol (MS - CHAP) authentication, but others can handle only 
PAP. If your remote partner works only with PAP, make sure the Send A Plain - Text 
Password If That Is The Only Way To Connect box is checked.  
 If your RRAS server is calling a system that isn ’ t running RRAS, the system may 
expect you to manually interact with it, perhaps through a terminal window. This is 
what the last check box, Use Scripting To Complete The Connection With The Remote 
Router, is for — check it, and you ’ ll get a terminal window after the modem connects so 
you can provide whatever commands or authenticators you need.  
 Setting Dial - In Credentials 
 If you choose to allow remote routers to dial in to the RRAS machine you ’ re setting up, 
you ’ ll have to create a user account with appropriate permissions. The Demand - Dial 
Interface Wizard handles the account - creation process for you, assuming you ﬁ ll out the 
ﬁ elds on the Dial - In Credentials page.  
 Setting Dial - Out Credentials 
 If you want your router to initiate calls to another router, you ’ ll need to tell your local 
RRAS installation what credentials to use when it makes an outgoing call. Although RRAS 
uses the information you enter in the Dial - In Credentials page, it makes no attempt to do 
anything with the credentials you provide on the Dial - Out Credentials page. The credentials 
you provide here must match the credentials the remote router expects to see. If they don ’ t 
match, your router won ’ t be able to authenticate itself to the remote end. 
 In Exercise 14.2 you will continue from Exercise 14.1 with conﬁ guring the Demand -
 Dial Interface Wizard. In this exercise, you ’ ll create a simple demand - dial interface. This 
requires you to have the phone number, username, and password for the remote end as well 
as a demand - dial - capable device installed in the machine.  
 The Demand - Dial Interface Wizard automatically appears after you 
complete Exercise 14.1. 
 E X E R C I S E  1 4 . 2
Creating a Demand - Dial Interface 
 1. 
  The Demand - Dial Interface Wizard should be open if you just ﬁ nished Exercise 14.1. 
Click Next. 
 2. 
  On the Interface Name page, you can specify a name for the interface. Accept the 
default of Remote Router. Click Next.  
■
■
■

 3. 
  The Connection Type page appears. You can connect to the remote router via a VPN 
interface or through a Point to Point Protocol over Ethernet (PPPoE) connection. Make sure 
the Connect Using Virtual Private Networking (VPN) option is selected, and click Next. 
 4. 
  On the VPN Type page, choose Automatic Selection. This page allows you to choose 
which VPN connection you want to use.  
 5. 
  The Destination Address page appears next. Here is where you enter the IP address 
of the other router to which you are connecting. Type the IP address of one of your 
routers (if you are at home and have a small home router, type that IP address). For this 
example, we entered  192.168.1.1 . Click Next after you ’ ve entered the IP address. 
 6. 
  On the Protocols And Security page, make sure the Route IP Packets On This Interface 
box is the only one checked.  
 7. 
  If you have not deﬁ ned any static routes yet, you will be asked to do so before you can 
activate the demand - dial connection. On the Static Routes For Remote Networks page, 
click the Add button and enter the IP address, subnet mask, and metric of the remote 
router. Click OK when you ’ ve ﬁ nished. You will notice the new static route in the list. 
Click Next. 
 8. 
  In the Dial - Out Credentials page, ﬁ ll in the username, domain (if any), and password 
needed to connect to the remote network. Click Next. 
 9. 
  When the wizard ’ s summary page appears, click the Finish button to create the 
interface.  
 Creating and Removing RIP Interfaces 
 After you create the physical interfaces (using either demand - dial or LAN interfaces), the next 
step you have to take is to create an interface for the routing protocol you want to use. After 
you install the routing protocols (see the section  “ Managing Routing Protocols ” later in this 
chapter), RIP nodes appear in the Routing And Remote Access snap - in. To create an interface, 
right - click the RIP node, and choose New Interface. That displays the New Interface dialog 
box, which lists all the physical interfaces that are available for the selected protocol. 
 Once you select the interface you want to use, if RRAS can create the interface, the 
interface is added to the appropriate item in the console, and the corresponding Properties 
dialog box opens. 
 You can remove a RIP interface by selecting it in the appropriate folder and pressing the 
Delete key, by selecting Action   Delete, or by choosing Delete from the pop - up menu. 
 Setting RIP Interface Properties 
 RIP interfaces have their own properties, all of which are speciﬁ c to RIP. You adjust these 
settings by selecting the RIP node, clicking the appropriate RIP interface in the right pane, 
and selecting Properties from the pop - up or Action menu. 
 In the following sections, we ’ ll cover the various options available in a RIP interface ’ s 
Properties dialog box. 
Configuring IP Routing 
615

616 
Chapter 14  Managing Routing and Remote Access
 The General Tab 
 The General tab of the RIP interface ’ s Properties dialog box (Figure 14.7) lets you 
control the router ’ s operational mode, which protocols it uses to send and accept packets, 
and a couple of other useful things.  
 F I G U R E 14 .7 The General tab of the RIP interface ’ s Properties dialog box 
 Here ’ s what you can do with the General tab: 
 The Operation Mode drop - down list controls the router ’ s mode. By default, demand -
 dial interfaces will be set to Auto - Static Update Mode, while LAN interfaces will be 
set to Periodic Update Mode.  
 The Outgoing Packet Protocol drop - down list controls what kind of RIP packets this 
router sends:  
 If your network has all RIPv2 routers, choose RIP Version 2 Multicast to make 
RRAS send efﬁ cient RIP multicasts.  
 If you have a version 1 or a mix of version 1 and version 2, there are selections for 
those, too.  
 The fourth choice, Silent RIP, is useful when you want your RRAS router to listen 
to other routers ’ routes but not advertise any of its own. Typically, you ’ ll use Silent 
RIP when you ’ re using RRAS to connect a small network (such as a branch ofﬁ ce) 
that doesn ’ t have any other routers to a larger network — the small network doesn ’ t 
have any routes to advertise because it ’ s connected to only one remote network.  
 Use the Incoming Packet Protocol drop - down list to specify what kinds of RIP packets 
this interface will accept. You can choose to accept any of the following:  
 Only RIPv1 packets  
 Only RIPv2 packets  
■
■
■
■
■
■
■
■

 Both version 1 and version 2 packets  
 No packets at all  
 The default setting is to accept both version 1 and version 2 packets.  
 The Added Cost For Routes ﬁ eld lets you control how much this router will increase 
the route cost. Usually, it ’ s best to leave this set to 1 because setting it too high may 
increase the interface ’ s cost so much that no one uses it.  
 The Tag For Announced Routes ﬁ eld gives you a way to supply a tag included in all RIP 
packets sent by this router. RRAS doesn ’ t use RIP tags, but other routers can use them. 
 The Activate Authentication check box and Password ﬁ eld give you an identiﬁ cation 
tool for use with your routers. If you turn on authentication, all incoming and outgoing 
RIP packets must contain the speciﬁ ed password. Therefore, all of this router ’ s 
neighbors need to use the same password. The password is transmitted as clear text, so 
this option doesn ’ t provide you with any security.  
 The Security Tab 
 The Security tab (see Figure 14.8) helps you regulate which routes your RIP interface will 
accept from and broadcast to its peers. There are good reasons to be careful about which 
routes you accept into your routing table because a malicious attacker could simply ﬂ ood 
your router with bogus routes and watch, laughing, as your routers send trafﬁ c off on a 
wild goose chase. Likewise, you may not want to advertise every route in your routing 
table, particularly if the same routers handle both Internet and intranet trafﬁ c. You can use 
the controls on this tab to discard routes that fall within a particular range of addresses, or 
you can accept only those routes that fall within a particular range.  
■
■
■
■
■
 F I G U R E  14 . 8 The Security tab of the RIP interface ’ s Properties dialog box 
Configuring IP Routing 
617

618 
Chapter 14  Managing Routing and Remote Access
 The default setting is to accept all routes, but you can change it using these controls: 
 The Action drop - down list lets you choose whether you want to impose settings on 
incoming routes that your router hears from its peers or on outgoing routes that it 
announces. Depending on which of these options you choose, the wording of the three 
radio buttons below the drop - down will change.  
 The restriction radio buttons in the center of the dialog box control the action applied 
to incoming or outgoing routes:  
 The default setting, Announce All Routes (for outgoing routes) or Accept All 
Routes (for incoming routes), does just that — all routes are accepted or announced, 
no matter the source.  
 Announce All Routes In The Ranges Listed (outgoing) or Accept All Routes In The 
Ranges Listed (incoming) causes RRAS to silently ignore any routes that fall out-
side the speciﬁ ed ranges. You ’ d usually use this option when you wanted to limit 
the scope of routes over which your router can exchange trafﬁ c.  
 Do Not Announce All Routes In The Ranges Listed (outgoing) or Ignore All Routes 
In The Ranges Listed (incoming) tells RRAS to silently ignore any routes that fall 
within the speciﬁ ed ranges. This is useful for ﬁ ltering out routes that you don ’ t want 
to make available or those you don ’ t want to use to reach remote systems. 
 The From and To ﬁ elds; the Add, Edit, and Remove buttons; and the address range list are 
all used to specify which set of addresses you want to use with the restriction radio buttons.  
 The Neighbors Tab 
 The Neighbors tab (Figure 14.9) gives you a ﬁ ner degree of control over how this particular 
interface interacts with its peer RIP routers. By specifying a list of trusted neighbor routers, 
you can choose to use neighboring routers ’ routes in addition to, or instead of, broadcast 
and multicast RIP announcements.  
■
■
■
■
■
■
 F I G U R E 14 . 9  The Neighbors tab of the RIP interface ’ s Properties dialog box 

 You will see the following radio buttons on the Neighbors tab: 
 The Use Broadcast Or Multicast Only radio button tells RRAS to ignore any RIP 
neighbors. This is the default setting. It means that any router that can successfully 
broadcast or multicast routes to you can load its routes into your routing table.  
 The Use Neighbors In Addition To Broadcast Or Multicast radio button tells RRAS to 
accept routes from RIP peers as well as from the neighbors you ’ ve speciﬁ ed.  
 The Use Neighbors Instead Of Broadcast Or Multicast radio button indicates that you 
don ’ t trust RIP announcements that your router picks up from the network; instead, 
you ’ re telling RRAS to trust only those neighbors that are deﬁ ned in the neighbor list.  
 You manage the list of trusted neighbor routers using the IP Address ﬁ eld; the Add, Edit, 
and Remove buttons; and the list itself. These controls are enabled when you specify that 
you want to use neighbor - supplied routing information; once the controls are activated, you 
can add router IP addresses to the neighbor list. 
 The Advanced Tab 
 The Advanced tab (Figure 14.10) contains 12 controls that govern some fairly esoteric RIP 
behavior.  
■
■
■
 F I G U R E 14 .10 The Advanced tab of the RIP interface ’ s Properties dialog box 
 The ﬁ rst three controls are active only when you turn on Periodic Update Mode on the 
General tab: 
 The Periodic Announcement Interval (Seconds) ﬁ eld controls the interval at which 
periodic router announcements are made.  
 The Time Before Routes Expire (Seconds) ﬁ eld controls how long the route may stay 
in the routing table before it ’ s considered to be expired. The arrival of a new RIP 
■
■
Configuring IP Routing 
619

620 
Chapter 14  Managing Routing and Remote Access
announcement for the route resets the timer — it will be marked as invalid only if it 
reaches the expiration timer without being renewed through a new announcement.  
 The Time Before Route Is Removed (Seconds) ﬁ eld controls the interval that may pass 
between the time a route expires and the time it ’ s removed. 
 The next group of check boxes update processing and loop detection: 
 The Enable Split - Horizon Processing check box turns on split - horizon processing, in 
which a route learned by a RIP router on a network is not rebroadcast to that network. 
Split - horizon processing helps prevent routing loops, so it ’ s on by default.  
 The Enable Poison - Reverse Processing check box is active only when the Enable 
Split - Horizon Processing check box is on. This option modiﬁ es the way split -
 horizon processing works. When poison - reverse processing is turned on, routes 
learned from a network are rebroadcast to the network with a metric of 16, a 
special value that tells other routers that the route is unreachable. This option 
 prevents routing loops while still keeping the routing tables up - to - date.  
 The Enable Triggered Updates check box indicates whether you want routing table 
changes to be immediately sent out when they ’ re noticed (the default). Triggered 
updates help keep the routing table up - to - date with minimum latency. 
 The Send Clean - Up Updates When Stopping check box controls whether RRAS 
will send announcements that mark the routes it was handling as unavailable. This 
immediately lets its RIP peers know that the routes it was servicing are no longer usable. 
 The last set of controls governs what happens with host and default routes: 
 By default, RRAS ignores any host routes it sees in RIP announcements. Check the 
Process Host Routes In Received Announcements box if you want it to honor those 
routes instead of ignoring them.  
 The Include Host Routes In Sent Announcements check box directs RRAS to send host 
route information as part of its RIP announcements; normally it won ’ t do this. 
 The Process Default Routes In Received Announcements and Include Default Routes 
In Sent Announcements check boxes have the same function as their host route check 
boxes described earlier.  
 The Disable Subnet Summarization check box is active only if you have RIPv2 speciﬁ ed 
as the outbound packet type for the router. When subnet summarization is turned off, 
RIP won ’ t advertise subnets to routers that are on other subnets.  
 Setting IP Routing Properties 
 The IPv4 and IPv6 nodes in the Routing And Remote Access snap - in have several subnodes, 
including the General node. When you click the General node and select Properties from the 
Action menu, you ’ ll ﬁ nd settings that apply to all installed IP routing protocols on the server. 
These settings give you some additional control over how routing works. 
 In the following sections, we ’ ll look at the options in the General Properties dialog box. 
These options are available for conﬁ guring settings that apply to IP routing in general.  
■
■
■
■
■
■
■
■
■

 The Multicast Scopes tab of the General Properties dialog box is for setting 
and managing multicast scopes. 
 The Logging Tab 
 The Logging tab (shown in Figure 14.11) contains four radio buttons that you use to 
control what information the IP routing components of RRAS log: 
 The Log Errors Only radio button instructs the server to log IP routing – related errors 
and nothing else. This gives you adequate indication of problems after they happen, 
but it doesn ’ t point out potential problems noted by warning messages.  
 The Log Errors And Warnings radio button is the default choice; it instructs RRAS 
to log error and warning messages to the event log without adding any informational 
messages. If you get in the habit of carefully reviewing your event logs, these warning 
messages may give you welcome forewarning of incipient problems.  
 The Log The Maximum Amount Of Information radio button causes the IP routing 
stack to log messages about almost everything it does. This gives you a lot of useful 
fodder when you ’ re troubleshooting, but it can ﬂ ood your logs with minutiae if you ’ re 
not careful — don ’ t turn it on unless you ’ re trying to isolate and ﬁ x a problem.  
 The Disable Event Logging radio button turns off all IP routing event logging.  
 Don ’ t use the Disable Event Logging option because it will keep you from 
being able to review the service ’ s logs in case of a problem.  
■
■
■
■
 F I G U R E 14 .11 The Logging tab of the General Properties dialog box 
Configuring IP Routing 
621

622 
Chapter 14  Managing Routing and Remote Access
 The Preference Levels Tab 
 The Preference Levels tab (Figure 14.12) gives you a way to change the router ’ s behavior by 
telling it what class of routes to prefer. In the earlier discussion of routing, you read that 
the router selects routes based on cost metric information. The other factor that comes 
into play is the preference level of the routing source. The default conﬁ guration for RRAS 
causes it to prefer local and static routes over dynamically discovered routes. 
 For example, say there are two routing table entries indicating routes to  216.80.* — one 
that you ’ ve entered as a static route and one that your router has discovered via a RIP peer. 
In the example shown in Figure 14.12, the router will always try to use the static route 
ﬁ rst; if it can ’ t, it will try to use the RIP - generated route. You can change the router ’ s class 
preference by selecting the class you want to change and using the Move Up and Move 
Down buttons.  
 F I G U R E 14 .12 The Preference Levels tab 
 Managing Routing Protocols 
 Routing protocols typically don ’ t take a lot of management; once you install RIP, the 
protocol engine takes care of exchanging routes with remote routers. You can ’ t directly edit 
the contents of the routing table generated by dynamic routing protocols (this feature is 
available only with dedicated routers using a router operating system such as Cisco ’ s IOS). 
That means your management of these protocols is pretty much limited to installing them, 
conﬁ guring them to meet your needs, and watching them as they run. 

 In the following sections, you will learn how to install routing protocols and set routing 
protocol properties. 
 Installing RIP 
 You add routing protocols from the General section of the IPv4 node in the Routing And 
Remote Access snap - in. Exercise 14.3 explains how to install RIP; you ’ ll need the protocol 
installed to complete the exercises later in the chapter.  
 E X E R C I S E  1 4 . 3
Installing the RIP Protocols 
 1. 
  Open the Routing and Remote Access snap - in by selecting Start   Administrative Tools   
Routing And Remote Access. 
 2. 
  Select the server you want to conﬁ gure in the left pane of the MMC. Expand it until you 
see General beneath IPv4. 
 3. 
  Right - click General and select New Routing Protocol. 
 The New Routing Protocol dialog box appears. 
 4. 
  Select the routing protocol you want to install. In this case, choose RIP Version 2 For 
Internet Protocol, and click the OK button.  
 5. 
  The RRAS console refreshes its display, revealing a new node labeled RIP under the IP 
Routing node. 
 Setting RIP Properties 
 RIP is pretty much self - tuning. Once you conﬁ gure an RRAS router to use RIP, the router 
will look for peer routers and exchange routing information without a whole lot of effort 
on your part. You can make a few settings through the RIP Properties dialog box. To open 
RIP Properties, select the RIP node under IP Routing in the Routing And Remote Access 
snap - in, and then choose Action   Properties. 
 We will cover the various tabs of the RIP Properties dialog box in the following 
sections. 
 The General Tab 
 The General tab (Figure 14.13) has the same logging controls as the General tab of the IPv4 
General Properties dialog box. The Maximum Delay control governs how long the router 
will wait to send an update notiﬁ cation to its peers.  
Configuring IP Routing 
623

624 
Chapter 14  Managing Routing and Remote Access
 The Security Tab 
 The Security tab (Figure 14.14) lets you control what router announcements your router 
will accept. By default, the RRAS RIP implementation will ingest routes supplied by any 
other router; you can restrict this behavior by supplying either a list of routers to trust or a 
list of routers whose routes you want to ignore.  
 F I G U R E 14 .13 The General tab of the RIP Properties dialog box 
 F I G U R E 14 .14 The Security tab of the RIP Properties dialog box 

 Managing Static Routes 
 Static routes are simple to manage and conﬁ gure because they don ’ t participate in 
any kind of automatic discovery process. Static routes are conceptually very simple — they 
combine a destination network address with a subnet mask to provide a list of 
potential destinations. The destination addresses are reached through a particular interface 
on your router, and they ’ re sent to a speciﬁ ed gateway (normally another router). Finally, 
there ’ s a metric associated with the static route. The metric value is like a cost that you 
can set to determine which route is preferred. The lower the metric, the more the route 
gets used. 
 You create new static routes in two ways: by using the  routeadd command from the 
command line or by right - clicking the Static Routes node in the Routing And Remote 
Access snap - in and selecting New Static Route. 
 In the following sections, we ’ ll show how those methods work. 
 Using  route add to Create a Static Route 
 With the  routeadd command, you can add new static routes and choose whether these 
routes remain in the routing table after the system reboots. Routes that stick around in this 
manner are called  persistent routes . To make a route persistent, you need to add the   - p 
switch to the  route add command. The command syntax itself is simple: 
route add -p destinationMasknetMaskgateWay metric interfaceID 
 The following two examples would be setting the router to see the  131.107.16.0 subnet 
on a  255.255.240.0 subnet mask using  131.107.32.1 as the gateway to get there.  
         
route add -p 131.107.16.0 mask 255.255.240.0 131.107.32.1
route add -p 131.107.16.0/20 131.107.32.1 
 You specify the destination, netmask, gateway, metric, and interface ID on the 
command line. These parameters are all required. The  routeadd command does some 
basic checking to make sure that the netmask and destination match and that you haven ’ t 
omitted anything. You have to specify the interface as a number, not as a name. However, 
the  route print command (which will be covered a little later in this chapter) lists its 
interfaces and the associated numbers.  
 Using RRAS to Create a Static Route 
 To create a new static route using the RRAS console, right - click the Static Routes node in 
the Routing And Remote Access snap - in, and select New Static Route. This opens the IPv4 
Static Routes dialog box (Figure 14.15).  
Configuring IP Routing 
625

626 
Chapter 14  Managing Routing and Remote Access
 You have to provide the same parameters as with the  routeadd command — the interface 
you want to use to connect, the destination and network mask, the gateway for the 
outbound packets, and a metric. 
 If you ’ re creating a route that ’ s not bound to a LAN interface, you can use the Use This 
Route To Initiate Demand - Dial Connections check box to specify that the route should 
open a new demand - dial connection on the speciﬁ ed interface. 
 Exercise 14.4 shows you how to add and remove static routes. To complete Exercise 
14.4, you must have completed Exercise 14.1.  
 E X E R C I S E  1 4 . 4
Adding and Removing Static Routes  
 1. 
  Open the Routing and Remote Access snap - in by selecting Start   Administrative Tools 
  Routing And Remote Access. 
 2. 
  Select the server you want to conﬁ gure in the left pane of the MMC. Expand IPv4 until 
you see the Static Routes node beneath.  
 3. 
  Right - click the Static Routes node, and select New Static Route. The Static Route dialog 
box appears. 
 4. 
  Select the interface you want to use from the Interface drop - down list. The choices 
are Local Area Connection and Remote Router. Choose Local Area Connection for this 
exercise.  
 5. 
  Enter the destination address (try   10.10.10.0  ), and enter a netmask of   255.255.255.0  . 
 6. 
  For the gateway address, enter the IP address of your RRAS server.  
 7. 
  Click the OK button. The Routing and Remote Access snap - in reappears.  
 F I G U R E 14 .15 Use the IPv4 Static Routes dialog box to create new static routes. 

 8. 
  Right - click the Static Routes item, and choose Show IP Routing Table. The IP Routing 
Table window appears. Verify that your newly added static route is present in the table.  
 9. 
  Close the IP Routing Table window. 
 10.   Right - click the static route you added, and use the Delete command to remove it.  
 Configuring TCP/IP Packet Filters 
 One of the most useful features in RRAS is its ability to selectively ﬁ lter TCP/IP packets in 
both directions. 
 Filters are usually used to block out undesirable trafﬁ c. In general, the idea is to keep out 
packets that your machine doesn ’ t need to see. You can construct ﬁ lters that allow trafﬁ c 
into or deny trafﬁ c out of your network based on rules that specify source and destination 
addresses and ports. 
 The basic idea behind packet ﬁ ltering is simple: 
 1. 
 You specify ﬁ lter rules.  
 2. 
  Incoming packets are measured against those rules.  
 There are two types of ﬁ lter rule: 
 Accept all packets except those prohibited by a rule.  
 Drop all packets except those permitted by a rule.  
 Filters are associated with a particular interface; the ﬁ lters assigned to one interface 
are totally independent of those on all other interfaces. Inbound and outbound ﬁ lters are 
likewise separate. 
 The following are some examples of ﬁ lters: 
 Block all packets to a web server except those on TCP ports 80 and 443.  
 Block all outgoing packets on the ports used by the MSN and AOL instant messaging 
tools.  
 Filters on a PPTP or L2TP server can screen out everything except VPN trafﬁ c. 
This allows you to expose a Windows Server 2008 R2 VPN server without fear of 
compromise.  
 You create and remove ﬁ lters by using the Input Packet Filters and Output Packet 
Filters buttons on the General tab of the Local Area Network Properties dialog box. The 
mechanics of working with incoming and outbound ﬁ lters are identical; just remember the 
following guidelines: 
 You create inbound ﬁ lters to screen trafﬁ c coming to the interface.  
 You create outbound ﬁ lters to screen trafﬁ c going back out through that interface.  
■
■
■
■
■
■
■
Configuring TCP/IP Packet Filters 
627

628 
Chapter 14  Managing Routing and Remote Access
 To create a ﬁ lter, ﬁ nd the interface on which you want the ﬁ lter and then open its 
Properties dialog box. Click the appropriate packet ﬁ lter button, and you ’ ll see the Inbound 
Filters dialog box (Figure 14.16).  
 F I G U R E 14 .16 The Inbound Filters dialog box 
 This dialog box has the following six parts: 
 Receive All Packets Except Those That Meet The Criteria Below excludes the packets 
you specify and accepts everything else. 
 This option is inactive until you create a ﬁ lter rule.  
 Drop All Packets Except Those That Meet The Criteria Below accepts only those 
packets you specify and excludes everything else. 
 This option is inactive until you create a ﬁ lter rule.  
 The Filters list, which is initially empty, shows you which ﬁ lters are deﬁ ned on this 
interface. Each entry in the list shows the following:  
 Source address and mask  
 Destination address and mask  
 Protocol, port, and trafﬁ c type speciﬁ ed in the rule  
 The New, Edit, and Delete buttons allow you to add, edit, and remove ﬁ lters.  
 To create a ﬁ lter, click the New button, and you ’ ll see the Add IP Filter dialog box 
(Figure 14.17). The conditions you specify here must all be true to trigger the rule. For 
example, if you specify both the source and destination addresses, only trafﬁ c from the 
deﬁ ned source to the deﬁ ned destination will be ﬁ ltered.  
■
■
■
■
■
■
■

 Use these tips to ﬁ ll out the Add IP Filter dialog box: 
 To create a ﬁ lter that blocks packets by their origin or source address, check the Source 
Network box, and supply the IP address and subnet mask for the source you want to 
block. 
 To create a ﬁ lter that blocks packets according to their destination address, check the 
Destination Network box, and ﬁ ll in the appropriate address and subnet mask.  
 To ﬁ lter by protocol, choose the protocol you want to block:  
 Any, which blocks everything  
 TCP  
 TCP (Established) 
 This means that the TCP/IP has an established connection already.  
 IP  
 UDP  
 ICMP  
 Other, with a ﬁ ll - in ﬁ eld for a protocol number  
 For each of these protocols, you ’ ll have to enter some additional information; for 
example, if you select TCP, you have to specify the source or destination port numbers (or 
both). 
 Once you ’ ve speciﬁ ed the ﬁ lter you want, click the OK button, and you ’ ll see it in the 
ﬁ lter list. Filters go into effect as soon as you close the interface ’ s Properties dialog box; you 
can go back and add, edit, or remove ﬁ lters at any time. 
■
■
■
■
■
■
■
■
■
■
 F I G U R E 14 .17 The Add IP Filter dialog box 
Configuring TCP/IP Packet Filters 
629

630 
Chapter 14  Managing Routing and Remote Access
 Configuring VPN Packet Filters 
 Packet ﬁ lters provide a useful security mechanism for blocking unwanted trafﬁ c on 
particular machines. It ’ s a good idea to use packet ﬁ lters to keep non - VPN trafﬁ c out of 
your VPN servers. The rules for doing this are fairly straightforward, as you will see in the 
following sections. 
 PPTP Packet Filters 
 You need at least two ﬁ lters to adequately screen out non - PPTP trafﬁ c: 
 The ﬁ rst ﬁ lter allows trafﬁ c with a protocol ID of 47 — the Generic Routing 
Encapsulation (GRE) protocol — to pass to the destination address of the PPTP 
interface.  
 The second ﬁ lter allows inbound trafﬁ c bound for TCP port 1723 (the PPTP port) to 
come to the PPTP interface.  
 You can add a third ﬁ lter if the PPTP server also works as a PPTP client; in that 
case, the third ﬁ lter needs the interface ’ s destination address, a protocol type of TCP 
(established), and a source port of 1723. 
 Once you ’ ve created these ﬁ lters, you open the Inbound Filters dialog box and select the 
radio button labeled Drop All Packets Except Those That Meet The Criteria Below. 
 Then you repeat the process on the Outbound side, creating two or three corresponding 
output ﬁ lters that screen out any trafﬁ c not originating from the VPN interface and using 
the correct protocols. 
 In Exercise 14.5, you ’ ll set up RRAS IP packet ﬁ lters that block everything except PPTP 
trafﬁ c on the speciﬁ ed interface.  
 Don ’ t attempt this exercise on your production VPN server until you ’ ve 
been successful in trying it on another, less - critical machine.  
 E X E R C I S E  1 4 . 5
Configuring PPTP Packet Filters  
 1. 
  Open the Routing and Remote Access snap - in by selecting Start   Administrative 
Tools   Routing And Remote Access. Expand the server and IPv4 nodes to expose the 
General node of the server on which you ’ re working. Select the General node. 
 2. 
  Right - click the Local Area Connection interface, and choose Properties. 
 3. 
  In the General tab of the interface ’ s Properties dialog box, click the Inbound Filters 
button. The Inbound Filters dialog box appears. 
 4. 
  Click the New button, and the Add IP Filter dialog box appears. 
■
■

 5. 
  Fill out the Add IP Filter dialog box as follows: 
 Check the Destination Network check box. 
 Fill in the destination IP Address ﬁ eld with the IP address of the remote VPN interface. 
(For this exercise, we entered   192.168.1.254  . You can use the same.) 
 Enter a destination subnet mask of  255.255.255.255 . 
 Select a protocol type of TCP, and then specify a source port of  0 and a destination port 
of  1723 . 
 Click the OK button. 
 6. 
  The Inbound Filters dialog box reappears, listing the new ﬁ lter you created in step 5. 
Add another new ﬁ lter using the same IP address and subnet mask, but this time specify 
Other in the Protocol ﬁ eld and ﬁ ll in a protocol number of  47 . 
 When you ’ ve ﬁ nished, click the OK button to return to the Inbound Filters dialog box. 
 7. 
  In the Inbound Filters dialog box, click the Drop All Packets Except Those That Meet The 
Criteria Below radio button, and click the OK button. 
 8. 
  Close the interface ’ s Properties dialog box. 
 L2TP Packet Filters 
 To use L2TP packet ﬁ lters, you have to go through the same basic process as you do with 
PPTP packet ﬁ lters (see the previous section), but the ﬁ lters you need are slightly different. 
Four ﬁ lters are required — two input ﬁ lters and two output ﬁ lters: 
 Two input ﬁ lters with a destination of the VPN interface address and a netmask of 
 255.255.255.255 , ﬁ ltering UDP:  
 One with a source and destination port of 500 
 The second with a source and destination port of 1701  
 Two output ﬁ lters with a source of the VPN interface address and a netmask of 
 255.255.255.255 , ﬁ ltering UDP:  
 One with a source and destination port of 500 
 The second with a source and destination port of 1701  
 Managing IP Routing 
 Managing IP routing is fairly simple. If you understand how the options described earlier 
in this chapter work, you know most of what you need to know to keep IP routing working 
smoothly. All the remaining skills you ’ ll need center on monitoring your routers to make 
sure trafﬁ c is ﬂ owing smoothly and troubleshooting the occasional problem. 
■
■
■
■
■
■
Managing IP Routing 
631

632 
Chapter 14  Managing Routing and Remote Access
 A number of status displays are built into the Routing And Remote Access snap -
 in. Knowing that they exist, and what they display, makes it much easier to see all the 
various health and status data that RRAS maintains. Each of these commands shows you 
something different:  
  The General   Show TCP/IP Information Command   As you would expect, this display 
shows a broad general selection of IP routing data, including the number of routes in the 
route table, the number of IP and UDP datagrams received and forwarded, and the number 
of connection attempts. To customize the view, you can right - click the TCP/IP Information 
window and choose the Select Columns command.  
  The Static Routes   Show IP Routing Table Command   This command shows you the 
entire contents of the routing table, including the destination, netmask, and gateway for 
each route. This version of the routing table doesn ’ t show you where the route came from 
(for example, whether it was learned by RIP).  
  The RIP   Show Neighbors Command   This command shows you which RIP neighbors 
exist; for each router, you can see how many bad packets and bad routes that neighbor has 
tried to foist off on your router. 
 Exercise 14.6 shows you how to monitor IP routing.  
 E X E R C I S E  1 4 . 6
Monitoring Routing Status  
 1. 
  Open the Routing and Remote Access snap - in by selecting Start   Administrative Tools 
  Routing And Remote Access. 
 2. 
  Select the server whose status you want to monitor in the left pane of the MMC.  
 3. 
  Select the Network Interfaces node. Notice that the right pane of the MMC now lists all 
known interfaces along with their status and connection state. 
 4. 
  Select the General node beneath IPv4. Notice that the right pane of the MMC updates to 
show the IP interfaces, their IP addresses, their administrative and operational states, 
and whether IP ﬁ ltering is enabled on each interface. 
 5. 
  Right - click the General node, and choose the Show TCP/IP Information command. Check 
the number of IP routes shown. 
 6. 
  Right - click the Static Routes node, and choose the Show IP Routing Table command. 
Note that the number of routes listed corresponds to the route count in the TCP/IP 
Information window and that some of the routes listed are automatically generated.  
 Now let ’ s revisit the  route command you saw earlier but in the context of route 
monitoring. 

 Using the  routeprint Command 
 You already learned how to use the  routeadd command to add a new static route from the 
command line. The  routeprint command can show you all or part of the routing table 
from the command line. Just entering   routeprint  into a command window gives you a 
complete dump of the entire routing table. Adding a wildcard IP address displays only 
routes that match the address you specify. For example,  route print 206.151.* displays 
only routes that match  206.151 . 
 Troubleshooting IP Routing 
 A comprehensive overview of IP routing troubleshooting is beyond the scope of this book. 
Microsoft ’ s online help is pretty good at suggesting probable causes and solutions for most 
routing problems. If you understand the topics presented in this chapter, then you shouldn ’ t 
have many troubleshooting problems in RRAS as long as you verify the following points: 
 The RRAS service is running and conﬁ gured to act as an IP router.  
 The router ’ s TCP/IP conﬁ guration is correct (including a static IP address).  
 You have IP routing protocols attached to each interface on which you need them.  
 Next, you need to verify the following routing - speciﬁ c settings and behaviors: 
 Check to be sure that your router is receiving routes from its peers. Do this by opening 
the routing table and looking at the Protocol column. Seeing entries marked as RIP 
tells you that at least some peers are getting routing information through. If you don ’ t 
see any RIP routes, that ’ s a bad sign.  
 You need to have a static default route enabled if your router hasn ’ t received any 
default routes. To do this, add a new static route with a destination of   0.0.0.0  , a 
netmask of   0.0.0.0  , and either a demand - dial or a LAN interface appropriate for your 
network setup.  
 Troubleshooting Example 
 In Exercise 14.7, you will perform some troubleshooting, and the exercise assumes the 
following: 
 Your Windows Server 2008 R2 server doesn ’ t have any packet ﬁ lters or ﬁ rewall running.  
 Your server uses the IP address of  192.168.1.64 as its main interface address.  
 The goal is to allow only necessary trafﬁ c to this server using an IP packet ﬁ lter. It was 
your understanding that another network administrator was going to enable a ﬁ rewall 
outside the Windows Server 2008 R2 server. However, after performing a scan of the 
server using  nmap from a nearby Linux server, you ﬁ nd these ports open: 
PORT     STATE SERVICE
53/tcpopen  domain
135/tcp  openmsrpc
■
■
■
■
■
■
■
Managing IP Routing 
633

634 
Chapter 14  Managing Routing and Remote Access
139/tcp  opennetbios-ssn
445/tcp  openmicrosoft-ds
1025/tcpopen  NFS-or-IIS
1723/tcpopen  pptp 
 Obviously the other ﬁ rewall is not in place yet. The server acts as a PPTP VPN server 
for a Windows network and therefore needs only port 1723/TCP open for inbound 
connections. Your job is to enable some type of ﬁ ltering as soon as possible in order to 
protect this Windows Server 2008 R2 server.  
 E X E R C I S E  1 4 . 7
Troubleshooting Your Server  
 1. 
  Open the Routing and Remote Access snap - in by clicking Start   Administrative Tools   
Routing And Remote Access. 
 2. 
  Expand IPv4 or IPv6, and click the General node. 
 If you don ’ t have an IPv4 or IPv6 node, open the server ’ s Properties dialog box, and 
make sure the Router box is checked. If it ’ s not, select it. 
 3. 
  In the General window of the IPv4 node in the Routing and Remote Access snap - in, 
right - click the main network interface for the server, which is Local Area Connection by 
default, and then select Properties.  
 4. 
  Click the Inbound Filters button. This opens the Inbound Filters dialog box.  
 5. 
  In the Inbound Filters dialog box, click New. This opens the Add IP Filter dialog box.  
 6. 
  The ﬁ rst order of business is to allow established TCP connections into the server. These 
are necessary for any connection that originates from the computer. Within the Add IP Filter 
dialog box, use the Protocol drop - down, and select TCP [Established]. Leave the Source Port 
and Destination Port text boxes empty. Click OK to return to the Inbound Filters dialog box.  
 7. 
  In the Inbound Filters dialog box, which now has one ﬁ lter in it, change the ﬁ lter action 
to Drop All Packets Except Those That Meet The Criteria Below. This is an important 
step because it changes the policy from  “ accept everything by default ” to  “ deny 
everything by default, ” which is a better ﬁ ltering policy.  
 8. 
  Add another ﬁ lter by clicking New in the Inbound Filters dialog box. For this ﬁ lter, change the 
protocol to UDP, and set the source port at  53 . This allows the server to receive responses 
from DNS queries that it sends. Click OK to return to the Inbound Filters dialog box.  
 9. 
  Back at the Inbound Filters dialog box, click New once again. This time add a ﬁ lter for 
PPTP trafﬁ c, which runs on 1723/TCP. To do this, select TCP from the Protocol drop -
 down box, and type  1723 in the Destination Port text box. Then click OK.  
 10.   Check the ﬁ nal group of ﬁ lters in the Inbound Filters dialog box. Click OK at the Inbound 
Filters dialog box and OK again at the Local Area Connection Properties dialog box.  

 Scanning the server again reveals that the only port open from a remote location is 
1723/TCP: 
PORT     STATE SERVICE
1723/tcpopen  pptp 
 You ’ ve now effectively blocked access to this server except for trafﬁ c on the PPTP port 
of TCP/1723. Outbound trafﬁ c has not been ﬁ ltered. 
 As extra credit, you could enable ICMP echo requests and replies by adding inbound 
ﬁ lters. You could also add outbound ﬁ lters to ensure that only authorized trafﬁ c is being 
sent from the server. For example, only PPTP trafﬁ c and HTTPS trafﬁ c to Windows 
Update might be allowed from this server. 
 In this exercise, you worked with RRAS to create packet ﬁ lters for inbound trafﬁ c. These 
were created through the IP Routing section of the Routing and Remote Access snap - in. You 
added ﬁ lters for established TCP connections, for responses to outgoing DNS requests, and 
ﬁ nally for the PPTP trafﬁ c itself. The policy for the ﬁ lter was set to  “ deny by default. ” 
 Summary 
 In this chapter, you learned how IP routing connects networks by intelligently delivering 
network trafﬁ c to the correct destination in the internetwork, how to create and manage 
demand - dial and the RIP interface for IP routing, how to install RIP and set routing 
parameters, how to manage static routes with the  routeadd command and the Routing and 
Remote Access snap - in, how to conﬁ gure TCP/IP packet ﬁ lters for blocking undesirable 
trafﬁ c, and ﬁ nally how to manage demand - dial routing. We also discussed the OSPF routing 
protocol and how OSPF is no longer supported by Windows Server 2008 R2 RRAS. 
 We then discussed VPN connections and protocols. We talked about the inbound and 
outbound ﬁ lters that you can set up on your VPN connection. We also discussed NAT 
and how it can help minimize TCP/IP numbers needed for Internet and remote network 
connections. 
 Exam Essentials  
 Know the difference between static routing and dynamic routing.   Static routing systems 
don ’ t make any attempt to discover other routers or systems on their networks. Instead, 
you tell the routing engine how to get data to other networks. Dynamic routing doesn ’ t 
depend on your adding ﬁ xed, unchangeable routes to remote networks. Instead, a dynamic 
routing engine can discover its surroundings by ﬁ nding and communicating with other 
nearby routers in an internetwork.  
Exam Essentials 
635

636 
Chapter 14  Managing Routing and Remote Access
  Understand RRAS.   RRAS provides Windows Server 2008 R2 computers with routing 
capabilities. You can establish static routes that specify where packets bound for certain 
networks should go. RRAS provides dynamic routing using versions 1 and 2 of the Routing 
Information Protocol (RIP). It also provides packet ﬁ ltering to screen out undesirable 
packets in both directions.  
  Understand the difference between RIP and OSPF.   A RIP - capable router periodically 
sends out announcements while simultaneously receiving announcements from its peers. 
This exchange of routing information enables each router to learn what routers exist on the 
network and which destination networks each router knows how to reach. OSPF networks 
are broken down into areas; an area is a collection of interconnected networks. Think of 
an area as a subsection of an internetwork. Areas are interconnected by backbones. Each 
OSPF router keeps a link - state database only for the areas to which it ’ s connected.  
  Know how to install RRAS and configure IP routing.   The RRAS components are not 
installed by default on computers running Windows Server 2008 R2. To enable your server 
to route IP packets, you have to install, activate, and conﬁ gure RRAS using the Routing 
and Remote Access Server Setup Wizard in the Routing and Remote Access snap - in. You 
then need to add demand - dial interfaces if you want to support demand - dialing, give each 
routable interface a network address for each protocol it carries, and install and conﬁ gure 
the routing protocols on the interfaces that should support them.  
  Know how to configure TCP/IP packet filters.   You can construct ﬁ lters that allow or 
deny trafﬁ c into or out of your network based on rules that specify source and destination 
addresses and ports. To create a ﬁ lter, ﬁ nd the interface on which you want the ﬁ lter, open 
its Properties dialog box, and click the appropriate packet ﬁ lter button.  

Review Questions 
637
 Review Questions  
 1. 
  You work on a network with four subnets whose addresses are  208.45.231.0 , 
 208.45.232.0 ,  208.45.233.0 , and  208.45.234.0 . Your routers are configured with these 
IP addresses:  
 
 Router 1:  208.45.231.1 and  208.45.232.1 
 
 Router 2:  208.45.231.2 and  208.45.233.1 
 
 Router 3:  208.45.232.2 and  208.45.234.1 
 
 Router 4:  208.45.233.2 and  208.45.234.2 
 Router 2 is connected to the Internet. The connection between Router 2 and Router 4 
is a very slow 56K dial - up line. Your computer ’ s IP address is  208.45.231.25 . Your 
default gateway is  208.45.231.2 , because that ’ s the address of the router that ’ s connected 
to the Internet. You want to make sure your computer always routes information to 
 208.45.234.0  through Router 1 (unless Router 1 becomes unavailable) because the 56K 
line is so slow. Which command should you use to accomplish this?  
 A.   route add 208.45.231.1 mask 255.255.255.0 208.45.234.0 metric 1route 
add 208.45.231.2 mask 255.255.255.0 208.45.234.0 metric 2 
 B.   route add 208.45.234.0 mask 255.255.255.0 208.45.231.1 metric 2route 
add 208.45.234.0 mask 255.255.255.0 208.45.231.2 metric 1 
 C.   route add 208.45.234.0 mask 255.255.255.0 208.45.231.1 metric 1route 
add 208.45.234.0 mask 255.255.255.0 208.45.231.2 metric 2 
 D.   route add 208.45.234.0 mask 255.255.255.0 208.45.232.1 metric 1route 
add 208.45.234.0 mask 255.255.255.0 208.45.233.1 metric 2 
 2. 
  You administer a network that consists of four subnets. Your manager wants to reduce 
costs as much as possible. You decide to configure at least one Windows Server 2008 R2 
computer on each subnet with RRAS and a nonpersistent demand - dial connection. You 
want to have the routers dynamically update themselves. Which of the following should you 
use to accomplish these goals?  
 A.   RIPv2 
 B.   OSPF  
 C.   EIGRP  
 D.   Area border routers  
 3. 
 Leigh is setting up an RRAS router at a remote site so that it can connect to the corporate 
LAN. Which of the following interfaces will Leigh need?  
 A.   A demand - dial interface for connecting the remote and LAN routers  
 B.   RIP for routing discovery  
 C.   A demand - dial interface as well as RIP or OSPF  
 D.   None of the above  

638 
Chapter 14  Managing Routing and Remote Access
  4. 
  You upgraded all your locations to Windows Server 2008 R2 and implemented the routing 
capability built into the servers. You chose to implement RIP. After implementing the 
routers, you discover that routes that you don ’ t want your network to consider are updating 
your RIP routing tables. What can you do to control which networks the RIP routing 
protocol will communicate with on your network?  
 A.   Configure TCP/IP filtering.  
 B.   Configure RIP route filtering.  
 C.   Configure IP packet filtering.  
 D.   Configure RIP peer filtering.  
 E. 
  There is no way to control this behavior.  
 5. 
  You are the network administrator for your organization. You need to see the routing table 
from the command line. What command - line utility can you use? 
 A.   route add 
 B.   route view 
 C.   route print 
 D.   route monitor 
 6. 
 Joe set up a new RRAS router that seems to be functioning properly, but it isn ’ t routing 
traffic. He has already verified that RRAS is running and properly configured. Which of 
the following are possible causes of the problem? (Choose all that apply.)  
 A.   No routes are being learned from peer routers.  
 B.   There is no static default route.  
 C.   No RIP neighbors are defined.  
 D.   The router ’ s authentication credentials are wrong.  
 7. 
  Your company has six locations that have been connected in a hub - and - spoke design with 
your location as the center. The network is designed that way because it grew over time, 
and you simply added another connection to your Windows NT server each time one was 
needed. You are concerned that if your connection goes down, the entire network will go 
down and all your users across the country will lose connectivity. You have now migrated 
all your servers to Windows Server 2008 R2, and you are well on your way to migrating 
the Windows NT workstations to Vista and XP Professional. You decide that each RRAS 
server will have at least three separate connections to other RRAS servers in the network 
so that you will always have a way to find a path through the network. You want to 
accomplish this with the least amount of administrative effort. How should you configure 
the RRAS computers to ensure these objectives?  
 A.   Configure RIPv2 on all routing interfaces.  
 B.   Configure OSPF on all routing interfaces.  
 C.   Configure RIPv1 and OSPF on all routing interfaces.  
 D.   Configure static routes.  
 E. 
  Configure RIP version 2 and OSPF on all routing interfaces.  

Review Questions 
639
 8. 
  You work for a very large accounting company that has more than 1,000 workstations 
in three locations over a routed network. You have upgraded all the servers to Windows 
Server 2008 R2 and are well under way in bringing all the workstations to Windows 2003, 
Windows Vista, Windows 7, and XP Professional. Two of the locations are connected to 
the central office, which has a T1 connection to the Internet. All the users on all three 
networks are funneled through this RRAS server for Internet access. Your company has 
a policy that personal Internet browsing from company equipment is not acceptable. The 
main purposes of Internet access within the company are email connectivity and VPN 
traffic to your business partners. Also, some staff members occasionally download new 
regulations and forms from a few government websites. How can you implement this policy 
using the tools and services on your Windows Server 2008 R2 network?  
 A.   Configure TCP/IP filters to control access to the Internet.  
 B.   Configure IP packet filters to control access to the Internet.  
 C.   Configure the Internet browsers through global policies to control which websites 
users can and cannot visit. 
 D.   Create static routing tables to control which websites, based on address, the users can reach.  
 9. 
  You notice that packets sent to your RRAS router aren ’ t being routed. You determine that 
the packets are indeed reaching the router. What should you check in order to troubleshoot 
the problem?  
 A.   The RRAS service status 
 B.   The RRAS routing configuration  
 C.   The RRAS server ’ s TCP/IP configuration  
 D.   All of the above  
 10.   You are the administrator of a network consisting of six subnets that are routed together 
through an ISP that doesn ’ t support multicasting. You are connected to the ISP at all 
locations with Windows Server 2008 R2 RRAS servers. The Marketing department is 
interested in providing audio and video presentations between the corporate office and 
one of the other locations; these presentations will be a test of how audio and video 
presentations could be used throughout the entire company. Your company is growing 
rapidly, and you plan to build a private network to support more flexibility in your routing 
capability — but that isn ’ t going to happen in time for the test. What can you do on your 
side of the network to allow the multicasting traffic to reach the intended destinations?  
 A.   Configure multicast boundaries on each of the appropriate RRAS routers.  
 B.   Install RIPv2 to carry the multicast traffic.  
 C.   Configure an IP - in - IP tunnel interface on the appropriate RRAS routers.  
 D.   Configure the multicast heartbeat on the appropriate RRAS routers.  

640 
Chapter 14  Managing Routing and Remote Access
 Answers to Review Questions 
1. 
 C .  The correct syntax for the  routeadd  command is as follows:  routeadd destination_
masksubnet_maskgateway_metriccost_metric  . In option A, the destination and gateway 
addresses are reversed. Option B uses incorrect metrics. Option D uses gateways that are 
not on the host ’ s subnet. 
2. 
 A .  The only way to accomplish all the goals is to use RIPv2. OSPF and EIGRP cannot be 
used in Windows Server 2008 R2 RRAS. Area border routers are simply special versions 
of OSPF routers. 
3. 
 A .  RIP is optional; you can use static routes on a remote dial - up router to avoid dealing 
with dynamic routing protocols. 
4. 
 B .  RIP route ﬁ lters allow you to conﬁ gure your routers to either ignore or accept updates 
from speciﬁ c network addresses or a range of addresses. TCP/IP ﬁ ltering is conﬁ gured at 
each individual host to control the trafﬁ c at a granular level, such as a speciﬁ c address, 
UDP port, or TCP port. IP packet ﬁ ltering is used on the router interface to control IP 
trafﬁ c based on subnet masks, IP address, or port. RIP peer ﬁ ltering is used to control 
communication between individual routers rather than control the entire network address. 
5. 
 C .  The  route print  command can show you all or part of the routing table from the 
command line. Just typing   route print  into a command window will give you a complete 
dump of the entire routing table. 
6. 
 A, B, D .  RIP neighbors are optional. If no routes are arriving or if there is no static default 
route, the router may not be able to route trafﬁ c. 
7. 
 A .  RIP is a distance - vector protocol that periodically broadcasts routes to the other servers. 
It ’ s useful for a very simple routed network. Your environment is much too complex to 
conﬁ gure static routes. Every time something changed, you would have to modify all the 
routing tables manually. OSPF cannot be used in Windows Server 2008 R2. 
8. 
 B .  IP packet ﬁ lters are applied at the RRAS server and can control access based on rules 
that act on source and destination addresses and ports. For example, you could build a 
rule that speciﬁ es the IP address of all acceptable web destinations while dropping all 
other requests, or you could create a rule that would use IP addresses to prevent requests 
from reaching speciﬁ c sites. 
 
 TCP/IP ﬁ lters are conﬁ gured at each workstation; although they can control speciﬁ c 
communication, the administrative overhead is unacceptable for a broad - based policy. 
Conﬁ guring each browser through global policies is not a valid option. Using static routing 
tables applies only to communication between routers; it wouldn ’ t involve the ultimate 
destinations of the packets. 

9. 
 D .  Any of these factors could prevent trafﬁ c from ﬂ owing, and therefore all should be 
checked. 
10.  C .  An IP - in - IP tunnel encapsulates IP datagrams inside other IP headers. This allows you 
to send packets that are not supported — such as multicasts — to other locations that are 
supported. Multicast boundaries use the multicast scope, rate of trafﬁ c, or IP header to 
control the forwarding of the trafﬁ c, but this does not allow that trafﬁ c to ﬂ ow across a 
section of the network that does not support it. This is also the case for multicast heartbeat, 
which is used to look for multicast support connectivity on the network. RIP is a routing 
protocol that manages the tables that locate routes through the network. It is not involved 
in the support or lack of support of multicast trafﬁ c. 
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at 
 www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
641


Managing Remote 
Access Services  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Network Access  
 Configuring Remote Access
■ May include but is not limited to: dial - up; Remote Access 
Policy; Network Address Translation (NAT); VPN protocols, 
such as Secure Socket Tunneling Protocol (SSTP) and IKEv2; 
Routing and Remote Access Services (RRAS); packet filters; 
Connection Manager; VPN reconnect; RAS authentication by 
using MS - CHAP, MS - CHAPv2, and EAP. 


 Chapter 
15

 Now that you understand how routing works, it ’ s time to 
discuss how clients connect using remote access. Routing 
and Remote Access Services (RRAS) includes some security 
features necessary to effectively provide remote access. For example, you ’ ll probably want 
to have the ability to restrict user dial - up access by group membership, time of day, or 
other factors. You ’ ll also need a way to specify the various callback, authentication, and 
encryption options that the protocols support. 
 In this chapter, you ’ ll learn about virtual private networks (VPNs), which provide 
remote access to private networks across public connections. That is, using the Internet, 
clients can dial in to an Internet service provider (ISP) and connect to your private 
network. The main beneﬁ t of VPNs is reduced cost, because it means long - distance calls 
are unnecessary. VPNs are becoming more popular because of the increased popularity of 
high - speed Internet connections such as cable and digital subscriber line (DSL). 
 Many of the features included in Windows Server 2008 R2 are simply carried over from 
Windows 2003 and Windows Server 2008, with a few minor additions. Thus is the case 
with the Routing and Remote Access console. 
 Before we can get into the details of what these features do and how to conﬁ gure them 
to provide remote access for your network, you need to understand some of the terms and 
concepts speciﬁ c to RRAS. That ’ s where we ’ ll begin in this chapter, and then we ’ ll move on 
to reviewing the features and conﬁ guration settings that you need to understand to meet 
the exam objectives.  
 Overview of Dial - Up Networking 
 LANs provide relatively high - speed connectivity to attached machines, but where does 
that leave those of us who work from home, who travel, or who need to access data on a 
remote computer? Until wireless access is available worldwide, we have the option of using 
dial - up networking, in which the client computer uses a modem to dial in and connect to a 
remote server. Once the connection is established, a variety of protocols and services make 
it possible for us to view web pages, transfer ﬁ les and email, and do pretty much anything 
we could do with a hardwired LAN connection, albeit at a reduced speed. 
 In the following sections, you will learn more about what dial - up networking does 
and how it works by examining the speciﬁ c technologies and protocols associated with 
remote access. 

 What DUN Does 
 From Chapter 11,  “ Understanding Windows Server 2008 R2 Networking, ” you already 
understand that Windows Server 2008 R2 network protocols are actually implemented as 
drivers. These drivers normally work with hardware network interfaces to get data from 
point A to point B. How do dial - up connections ﬁ t in? 
 Think back to the OSI model. Each layer has a function, and each layer serves as an 
intermediary between the layer above it and the one below. By substituting one driver for 
another at some level in the stack, you can dramatically change how things work. That ’ s 
exactly what Windows Server 2008 ’ s Dial - Up Networking (DUN) subsystem does. It 
makes the dial - up connection appear to be just another network adapter. 
 The DUN driver takes care of the work of making a slow asynchronous modem appear 
to work just like a fast LAN interface. Applications and services that use TCP/IP on your 
DUN connection never know the difference. In fact, you can conﬁ gure Windows Server 
2008 R2 to use your primary connection ﬁ rst and then pass trafﬁ c over a secondary 
connection (such as a dial - up link) if the primary connection is down — this does not affect 
the applications you ’ re working with (except that they might run more slowly). 
 On the server side, DUN allows you to host one or more network users who dial into 
your Windows Server 2008 R2 machine. Windows Vista, Windows 7, and XP Professional 
allow up to 10 concurrent dial - up connections, and Windows Server 2008 R2 allows up to 
255. (But by the time you allow 255 concurrent connections, you ’ ll probably be overloading 
your server.) 
 Depending on how you conﬁ gure the DUN server, users who dial in can see the whole 
network or only speciﬁ c resources on the server. You also get to control who can log on, 
when they can log on, and what they can do once they ’ ve logged on. As far as Windows 
Server 2008 R2 is concerned, a user connected via DUN is no different from one using 
resources over your LAN, so all the access controls and permissions you apply remain in 
force for DUN users.  
 How DUN Works 
 A lot of pieces are required to successfully complete a dial - up call from your computer to a 
server at another physical location. Understanding what these pieces are, how they work, 
and what they do for you is important. In the following sections, we will cover the DUN 
infrastructure, how the Point - to - Point Protocol (PPP) helps in this connection, 
the relationship between PPP and the network protocols, and how multilink can be 
used to increase the speed and efﬁ ciency of your remote connections. 
 The DUN Infrastructure 
 We ’ ll start with a look at the physical layer that underlies voice and data calls. Most of the 
following material will be familiar to anyone who has ever used a modem, but you should 
still understand the details that you might not have thought of before. 
Overview of Dial - Up Networking 
645

646 
Chapter 15 ■ Managing Remote Access Services
 Plain Old Telephone Service 
 Plain Old Telephone Service (POTS) connections offer a theoretical maximum speed of 
56 Kbps; in practice, many users routinely get connections at 51 or 52 Kbps. 
 The word  modem is actually short for  “ modulator - demodulator. ” The original Bell 
System modems took digital data and modulated it into screechy analog audio tones 
suitable for use on regular phone lines. Because phone lines are purposely designed to pass 
only the low end of the audible frequency range that most can hear, the amount of data was 
limited. However, in the early 1990s, an engineer discovered that you could communicate 
much faster when the path between the sender and receiver was all digital. 
 An all - digital path doesn ’ t have any analog components that induce signal loss, so it 
preserves the original signal quality faithfully, which in turn makes it possible to put more 
information into the original signal. As it happens, phone companies nationwide were 
in the process of making major upgrades to replace their analog equipment with newer, 
better, digital equivalents. These upgrades made it possible for people in most areas to get 
almost - 56Kbps speeds without changing any of the wiring in their homes or ofﬁ ces. The 
connection between the house and the phone ofﬁ ce was still analog, but the connections 
between phone ofﬁ ces were digital, ensuring high - quality connections.  
 Integrated Services Digital Network 
 In the mid - 1970s, Integrated Services Digital Network (ISDN) was designed. At the 
time, no one had any idea that you ’ d be able to get 56Kbps speeds out of an ordinary 
phone line. ISDN ’ s speeds of up to 128 Kbps over a single pair of copper wires seemed 
pretty revolutionary. In addition, ISDN had features such as call forwarding, caller ID, 
and multiple directory numbers (so you could have more than one number, perhaps with 
different ringing patterns, associated with a single line). 
 Unfortunately, ISDN requires an all - digital signal path. It also requires special 
equipment on both ends of the connection. The phone companies were slow to promote 
ISDN as a faster alternative to regular dial - up service, so customers avoided it. 
 ISDN still has some advantages, though. Because it ’ s all digital, call setup times 
are much shorter than they are for analog modems — it takes only about half a second 
to establish a new ISDN call. Modern ISDN adapters and ISDN - capable routers can 
seamlessly stitch together multiple ISDN channels to deliver bandwidth in 64Kbps 
increments. Because you can use ISDN lines for regular analog voice, data, and fax trafﬁ c, 
you can make a single ISDN act like two voice lines, a single 128Kbps data line, or a 
64Kbps data line plus a voice line.  
 ISDN is quickly being replaced by faster broadband services such as 
DSL and cable modems. In fact, you should resort to ISDN only if these 
other solutions are not available in your area. Note that DSL (a misnomer 
because they are all digital) and cable modems do not use PPP — discussed 
later — so they are technically not considered dial - up connections.  

 Other Connection Methods 
 Any other on - demand connection that ’ s established using the Point - to - Point Protocol can 
be thought of as a dial - up connection, and Windows Server 2008 R2 doesn ’ t make any 
distinction between POTS, ISDN, and other dial - ups — they ’ re all treated identically.  
 Connecting with PPP 
 The Point - to - Point Protocol enables any two devices to establish a TCP/IP connection over 
a serial link. That usually means a dial - up modem connection, but it could just as easily 
be a direct serial cable connection, an infrared connection, or any other type of serial 
connection. When one machine dials another, the machine that initiates the connection is 
referred to as a  client , and the machine that receives the call is a  server — even though PPP 
itself makes no such distinction. 
 PPP negotiation involves three phases that are required to establish a remote access 
connection. Actually, at least six distinct protocols run on top of PPP. Understanding what 
they do helps make the actual PPP negotiation process clearer. These protocols include the 
following:  
 The Link Control Protocol   The Link Control Protocol (LCP) handles the details of 
establishing and conﬁ guring the lowest - level PPP link; in that regard, you can think 
of it almost as if it were part of the Physical layer. When one PPP device calls another, 
the devices use LCP to agree that they want to establish a PPP connection.  
 The Challenge Handshake Authentication Protocol   The Challenge Handshake 
Authentication Protocol (CHAP) — as well as MS - CHAPv2 and PAP, which will be covered 
in Chapter 16,  “ Managing Security for Remote Access Services ”  — allows the client to 
authenticate itself to the server. This authentication functions much like a regular network 
logon; once the client presents its logon credentials, the server can ﬁ gure out what access 
to grant.  
 The Callback Control Protocol   The Callback Control Protocol (CBCP) is used to 
negotiate whether a callback is required, whether it ’ s permitted, and when it happens. 
Once the client has authenticated itself, the server can decide whether it should hang up 
and call the client back. The client can also request a callback at a number it provides; 
although this isn ’ t as secure as having the server place a call to a predetermined number, 
it provides some additional ﬂ exibility. If a callback occurs, the connection is reestablished 
and reauthenticated, but the CBCP stage is skipped.  
 The Compression Control Protocol   The Compression Control Protocol (CCP) allows the 
two sides of the connection to determine what kind of compression, if any, they want to 
use on the network data. Because PPP trafﬁ c actually consists of wrapped - up IP datagrams 
and because IP datagram headers tend to be fairly compressible, negotiating effective 
compression can signiﬁ cantly improve overall PPP throughput.  
 The IP Control Protocol   At this point in the call, the two sides have agreed to 
authentication, compression, and a callback. They haven ’ t yet agreed on what IP 
parameters to use for the connection. These parameters, which include the maximum 
Overview of Dial - Up Networking 
647

648 
Chapter 15 ■ Managing Remote Access Services
packet size to be sent over the link (the maximum transmission unit, or MTU), have a great 
impact on the overall link performance, so the client and server use the IP Control Protocol 
(IPCP) to negotiate them based on the trafﬁ c they expect to be passed.  
  The Internet Protocol   Once the IPCP negotiation has been completed, each end has 
complete knowledge of how to communicate with its peer. That knowledge allows the two 
sides to begin exchanging Internet Protocol (IP) datagrams over the link just as they would 
over a standard LAN connection.  
 The Relationship between PPP and Network Protocols 
 Usually when you hear about network communication, you hear about using TCP/IP on a 
hardwired LAN. How does this protocol ﬁ t in with PPP? In the case of TCP/IP, that ’ s an 
easy question to answer: The client routes all (or some) of its outgoing TCP/IP trafﬁ c to 
its PPP peer, which can then inspect the IP datagrams it gets back from the PPP stack 
to analyze and route them properly. 
 Windows Server 2008 R2 supports only TCP/IP, so consider what has to happen when 
a client using AppleTalk needs to connect via dial - up. Because the server will not use 
those other protocols, it will drop the call or cause the client to warn its user (that ’ s what 
Windows Server 2008 R2 does). After the other PPP setup steps are ﬁ nished, the client and 
server can wrap other types of network trafﬁ c inside an IP datagram. This process, called 
 encapsulation , allows the client to take a packet with some kind of private content, wrap 
it inside an IP datagram, and send it to the server. The server, in turn, processes the IP 
datagram, routing real datagrams normally and handling any encapsulated packets with 
the appropriate protocol. At that point, the client can communicate with the server without 
knowing that its non - TCP/IP packets are being encapsulated in any way — that detail is 
hidden deep in the layers of the OSI model.  
 Understanding the Benefits of Multilink 
 Many parts of the world don ’ t have high - speed broadband access yet. In fact, many 
places don ’ t have ISDN or even phone lines that support 56Kbps modems. The  multilink 
extensions to the Point - to - Point Protocol provide a way to take several independent PPP 
connections and make them look like one line so that they act as a single connection. 
 For example, if you use two phone lines and modems to place a two - line multilink call 
to your ISP, instead of getting the usual 48Kbps connection, you would end up with an 
apparent bandwidth of 96 Kbps. The multilink PPP software on your Windows Server 
2008 R2 machine and on the ISP ’ s router takes care of stringing all the packets together 
to make this process seamless. Windows Server 2008 ’ s RRAS supports multilink PPP for 
inbound and outbound calls.  
 The primary drawback to multilink calls is that they take up more than one 
phone line apiece. 

 Overview of Virtual Private Networks 
 Private networks offer superior security. You own the wires, so you have control over 
what they ’ re used for, who can use them, and what kind of data passes over them. 
However, they ’ re not very ﬂ exible, because they require you to conﬁ gure and manage 
costly leased lines between remote locations. To make things worse, most private networks 
face a dilemma: Implementing enough capacity to handle peak loads almost guarantees 
that much of that capacity will sit idly much of the time, even though it still has to be 
paid for. 
 One way to work around this problem is to maintain private dial - up services. Such 
services allow, for example, a ﬁ eld rep in Chicago to dial the home ofﬁ ce in Boston. But 
dial - ups are expensive, and they have the same excess capacity problem that truly private 
networks do. As an added detriment, someone has to pay long - distance or toll - free number 
charges. 
 Virtual private networks  (VPNs) offer a solution. You get the security of a true private 
network with the ﬂ exibility, ubiquity, and low cost of the Internet. In the following 
sections, we will cover VPNs, including what they are used for and how they work (in 
general and with Windows Server 2008 R2). 
 What VPNs Do 
 At any time, two parties can create a connection over the Internet. The idea behind a 
VPN is that you can use these connections to let two parties establish an encrypted  tunnel 
between them using the Internet as a transportation medium. The VPN software on each 
end takes care of encrypting the VPN packets as they go; when the packets leave one end 
of the tunnel, their payloads are encrypted and encapsulated inside regular IP packets 
that cause them to be delivered to the remote machine. Figure 15.1 shows one way to 
conceptualize this process.  
Internet
access
provider
corporate
network
Server
Client
encrypted data
 F I G U R E 15 .1 Drilling a tunnel through the Internet 
Overview of Virtual Private Networks 
649

650 
Chapter 15 ■ Managing Remote Access Services
 As an example, let ’ s say you ’ re in the ﬁ eld at a client site. As long as you ’ re somewhere 
that your ISP serves, you can dial into the client ’ s local point of presence and get connected 
to the Internet. At that point, you can open a VPN connection back to the servers at your 
ofﬁ ce and do whatever you could do when sitting in front of a regular desktop machine.  
 VPNs and Windows Server 2008 R2 
 Windows Server 2008 R2 includes support for Microsoft ’ s proprietary Point - to - Point 
Tunneling Protocol and Layer 2 Tunneling Protocol. Layer 2 Tunneling Protocol (L2TP) 
provides a more generic tunneling mechanism than PPTP; when combined with IPSec, 
L2TP also allows you to establish VPNs using a wide range of Microsoft or non - Microsoft 
hardware and software products, including routers and access devices from companies such 
as Cisco, Red Creek, and Nortel. 
 Worthwhile features in Windows Server 2008 ’ s VPN support include the following: 
 You can set up account lockout policies for dial - up and VPN users; this capacity has 
existed for network and console users for some time.  
 The Extensible Authentication Protocol (EAP) allows Microsoft or third parties to 
write modules that implement new authentication methods and retroﬁ t them to servers. 
One example is the EAP - TLS module, which implements access control based on smart 
cards and certiﬁ cates for VPN and dial - up users.  
 How you enable VPN support on your Windows Server 2008 R2 machine depends on 
whether you ’ re using a server or a client (Windows 7, Vista, XP, and so on). 
 Client conﬁ guration is easy. Just install the Dial - Up Networking service and then use the 
Make New Connection Wizard to create a new VPN connection. On the server side, you ’ ll 
need to install and conﬁ gure RRAS and then enable it to accept incoming VPN connections. 
 How VPNs Work 
 The VPN client assumes that the VPN server is already connected to the Internet in some 
way. Here ’ s how the VPN connection process works: 
 1. 
 The client establishes a connection to the Internet. Dial - up networking or any other 
connection method can be used for this connection. The client must be able to send 
packets to the Internet.  
 2. 
  The client sends a VPN connection request to the server. The exact format of the 
request varies, depending on whether the VPN is using PPTP, L2TP, or SSTP.  
 3. 
  The client authenticates itself to the server. Again, the exact process varies according 
to the VPN protocol in use. If the client can ’ t provide valid credentials, the connection 
is terminated. 
 4. 
  The client and server negotiate parameters for the VPN session. This negotiation 
allows the two ends to agree on an encryption algorithm and strength.  
 5. 
  The client and server go through the PPP negotiation process because both L2TP and 
PPTP depend on the lower - level PPP.  
■
■

 Because the contents of data passed around in steps 2 and 3 vary according to the 
tunneling protocol in use, we ’ ll explain the differences. First, though, you should 
understand encapsulation and how VPNs use it to wrap one kind of data inside another. 
 An Encapsulation Primer 
 Most of yesterday ’ s networks could carry only one kind of data. Each network vendor 
had its own protocol, and most of the time there was no way to intermingle data using 
different protocols on the same line. Over time, vendors began to ﬁ nd ways to allow a 
single network to carry many different types of trafﬁ c, resulting in the current assortment 
of trafﬁ c types found on most large networks. However, the Internet works only with IP, 
which is why it ’ s called Internet Protocol. If you need to send other types of trafﬁ c — such 
as AppleTalk — across the Internet, you can encapsulate it within IP. 
 How does encapsulation work? Software at each level of the OSI model has to see 
header information to ﬁ gure out where a packet is coming from and where it ’ s going. But 
the payload contents aren ’ t important to most of those components, and the payload is 
what ’ s encapsulated. By fabricating the right kind of header and prepending it to whatever 
you want in the payload, you can route foreign trafﬁ c types through IP networks with 
no trouble. 
 VPNs depend on encapsulation because their security method depends on being able to 
keep the payload information encrypted. The following steps demonstrate what happens 
to a typical packet as it goes from being a regular IP datagram to a PPTP packet (see 
Figure 15.2): 
 1. 
 An application creates a block of data bound for a remote host. In this case, it ’ s a web 
browser.  
 2. 
  The client - side IP stack takes the application ’ s data and turns it into an IP packet, ﬁ rst by 
adding a TCP header and then by adding an IP header. This can be called the  IP datagram 
because it contains all the necessary addressing information to be delivered by IP.  
 3. 
  The client is connected via PPP, so it adds a PPP header to the IP datagram. This 
PPP+IP combination is called a  PPP frame . 
 4. 
  If you are using PPP instead of a VPN protocol, the packet goes across the PPP link 
without further modiﬁ cation. When you are using a VPN (as in this example), the next 
step is for the VPN to encrypt the PPP frame, turning it into unreadable information to 
be transported over the Internet.  
 5. 
  A Generic Routing Encapsulation (GRE) header is combined with the encrypted 
payload. GRE really is generic; in this case, the protocol ID ﬁ eld in the GRE header 
says that this is an encapsulated PPTP packet.  
 6. 
  Now that there is a tag to tell you what ’ s in the payload, the PPTP stack can add an IP 
header (specifying the destination address of the VPN server) and a PPP header.  
 7. 
  Now the packet can be sent out over your PPP connection. The IP header speciﬁ es that 
it should be routed to the VPN server.  
 8. 
  When the packet arrives at the VPN server, the server reverses steps 1 – 6 to extract the 
payload. 
Overview of Virtual Private Networks 
651

652 
Chapter 15 ■ Managing Remote Access Services
 Encapsulation allows the use of VPN data inside ordinary - looking IP datagrams, 
which is part of what makes VPNs so powerful — you don ’ t have to change any of your 
applications, routers, or network components (unless they have to be conﬁ gured to 
recognize and pass GRE packets).  
 F I G U R E 15 . 2 The encapsulation process 
IP
GET /index.html
TCP
GET /index.html
TCP
GET /index.html
TCP
IP
PPP
GET /index.html
GRE
IP
PPP
GRE
IP
GRE
etaoin$rdl7Ouakweo-4p5fvjkl
etaoin$rdl7Ouakweo-4p5fvjkl
etaoin$rdl7Ouakweo-4p5fvjkl
etaoin$rdl7Ouakweo-4p5fvjkl
payload encryption
standard TCP/IP stack
encapsulation and tunneling
 PPTP Tunneling 
 PPTP is a pretty straightforward protocol. It works by encapsulating packets using the 
mechanism described in the previous section,  “ An Encapsulation Primer, ” and performs 
encryption (step 4) using the Microsoft Point - to - Point Encryption (MPPE) algorithm. 
The encryption keys used to encrypt the packets are generated dynamically for each 
connection; in fact, the keys can be changed periodically during the connection. 
 When the client and server have successfully established a PPTP tunnel, the 
authorization process begins. This process is an exchange of credentials that allows 
the server to decide whether the client is permitted to connect: 
 1. 
 The server sends a challenge message to the client.  
 2. 
  The client answers with an encrypted response.  
 3. 
  The server checks the response to see whether the answer is right. The challenge -
 response process allows the server to determine which account is trying to make a 
connection.  
 4. 
  The server determines whether the user account is authorized to make a connection.  
 5. 
  If the account is authorized, the server accepts the inbound connection; any access 
controls or remote access restrictions still apply.  

 L2TP/IPSec Tunneling 
 L2TP is much more ﬂ exible than PPTP, but it ’ s also more complicated. It was designed to 
be a general - purpose tunneling protocol not limited to VPN use. 
 L2TP itself doesn ’ t offer any kind of security. When you use L2TP, you ’ re setting up 
an unencrypted, unauthenticated tunnel. Using L2TP by itself over the Internet, therefore, 
would be dangerous, because anyone who wanted to could read your trafﬁ c. 
 To address this issue, you can use L2TP in conjunction with IPSec (see Chapter 12, 
 “ Conﬁ guring TCP/IP ” ). 
 The overall ﬂ ow of an L2TP/IPSec tunnel session looks a little different from that of a 
PPTP session because IPSec security is different. Here ’ s how the L2TP/IPSec combination 
works: 
 1. 
 The client and server establish an IPSec security association using the ISAKMP and 
Oakley protocols. At this point, the two machines have an encrypted channel between 
them. 
 2. 
  The client builds a new L2TP tunnel to the server. Because this happens after the 
channel has been encrypted, there ’ s no security risk.  
 3. 
  The server sends an authentication challenge to the client.  
 4. 
  The client encrypts its answer to the challenge and returns it to the server.  
 5. 
  The server checks the challenge response to see whether it ’ s valid; if so, the server can 
determine which account is connecting. Subject to whatever access policies you ’ ve put 
in place, at this point the server can accept the inbound connection.  
 Note that steps 3 – 5 mirror the steps described for PPTP tunneling. This is because the 
authorization process is a function of the remote access server, not the VPN stack. All VPN 
does is provide a secure communications channel, and something else has to decide who 
gets to use it.  
 SSTP Tunneling 
 The Secure Sockets Tunneling Protocol (SSTS) is a secure way to make a VPN connection 
using the Secure Sockets Layer v.3 (SSL) port 443. The following steps show how SSTP 
operates and functions.  
 1. 
 The client connects to the server through the Internet using port 443.  
 2. 
  During the TCP session, SSL negotiation takes place.  
 3. 
  During the SSL authentication phase, the client machine receives the server certiﬁ cate.  
 4. 
  The client machine will send HTTPS requests on the top of the encrypted SSL session.  
 5. 
  The client machine will then also send SSTP control packets on top of the HTTPS 
session.  
 6. 
  PPP negotiation now takes place on both ends of the connection.  
 7. 
  After PPP is ﬁ nished, both ends are ready to send IP packets to each other.  
Overview of Virtual Private Networks 
653

654 
Chapter 15 ■ Managing Remote Access Services
 Configuring Your Remote Access Server 
 Most of the conﬁ guration necessary for a remote access server happens at the server level. 
You use the server ’ s Properties dialog box to control whether the server allows remote 
connections, what protocols and options it supports, and so forth. Because all the protocols 
are carried via PPP, you can set some generic PPP options as well. We will cover these 
options in the following sections. You also have to conﬁ gure settings for your users, which 
you ’ ll read about in the next section.  
 Chapter 14,  “ Managing Routing and Remote Access, ” covers how to 
configure the RRAS general properties. 
 Configuring PPP Options 
 You can use the PPP tab of the RRAS server ’ s Properties dialog box (see Figure 15.3) 
to control the PPP - layer options available to clients that call in. The settings you specify 
here control whether the related PPP options are available to clients; you can use remote 
access policies to control whether individual connections can use them.  
 F I G U R E  15 . 3 The PPP tab of the RRAS server ’ s Properties dialog box 

 This tab has four check boxes: 
 The Multilink Connections check box, which is selected by default, controls whether the 
server will allow clients to establish multilink connections when they call in. 
 The Dynamic Bandwidth Control Using BAP Or BACP check box determines whether 
clients and servers are allowed to dynamically add or remove links during a multilink 
session. If you enable this feature, you can throttle the amount of available bandwidth 
up or down on demand. It ’ s available only when the Multilink Connections check 
box is selected. (BAP stands for Bandwidth Allocation Protocol, and BACP stands for 
Bandwidth Allocation Control Protocol.)  
 The Link Control Protocol (LCP) is used to establish a PPP link and negotiate its 
settings. A variety of LCP extensions are deﬁ ned in various RFCs; these extensions 
allow a client and server to dynamically agree on which protocols are being passed back 
and forth, among other things. The Link Control Protocol (LCP) Extensions check box 
controls whether these extensions are available. Windows 9 x , NT, 2000, Vista, XP, and 
7 clients depend on the LCP extensions, so you should leave this check box selected. 
 The Software Compression check box controls whether RRAS will allow a remote 
client to use the Compression Control Protocol (CCP) to compress PPP trafﬁ c. In some 
cases, hardware compression at the modem level is more efﬁ cient, but not everyone has 
a compression - capable modem. You should leave this check box selected as well.  
 Configuring IP - Based Connections 
 TCP/IP is far and away the most commonly used remote access protocol; coincidentally, it ’ s 
also the most conﬁ gurable of the protocols that Windows Server 2008 R2 supports. Both 
of these facts are reﬂ ected in the IPv4 and IPv6 tabs of the server ’ s Properties dialog box. 
Figure 15.4 shows the IPv4 tab.  
■
■
■
■
 F I G U R E 15 . 4 The IPv4 tab of the RRAS server ’ s Properties dialog box 
Configuring Your Remote Access Server 
655

656 
Chapter 15 ■ Managing Remote Access Services
 The controls on the IPv4 tab do the following: 
 The Enable IPv4 Forwarding check box controls whether RRAS will route IPv4 
packets between the remote client and other interfaces on your RRAS server. When 
this box is checked, as it is by default, remote clients ’ packets can go to the RRAS 
server or to any other host to which the RRAS server has a route. To allow clients to 
access resources on the RRAS server only, uncheck this box.  
 The IP Address Assignment control group lets you specify how you want remote clients 
to get their IP addresses. The default settings here depend on what you told the RRAS 
Setup Wizard during setup:  
 If you want to use a DHCP server on your network as the source of IP addresses 
for remote clients, select the Dynamic Host Conﬁ guration Protocol (DHCP) radio 
button and make sure you have the DHCP relay agent installed and running.  
 If you ’ d rather use static address allocation, select the Static Address Pool radio button. 
Then in the list below, specify which IP address ranges you want issued to clients.  
 If you choose to use static addressing, be sure you don ’ t use any address 
ranges that are part of a DHCP server ’ s address pool. Better still, you can 
add the ranges you want reserved for remote access as excluded ranges in 
the DHCP snap - in. (See Chapter 13,  “ Managing DHCP and DNS. ” ) 
 The Enable Broadcast Name Resolution option allows remote clients to resolve TCP/IP 
names without the use of a WINS or DNS server. This feature is enabled by default 
and is new for Windows Server 2008 R2.  
 Figure 15.5 shows the IPv6 tab of the RRAS server ’ s Properties dialog box.  
■
■
■
■
■
 F I G U R E 15 . 5 The IPv6 tab of the RRAS server ’ s Properties dialog box 

 The controls on the IPv6 tab do the following: 
 The Enable IPv6 Forwarding check box controls whether RRAS will route IPv6 
packets between the remote client and other interfaces on your RRAS server. When 
this box is checked, as it is by default, remote clients ’ packets can go to the RRAS 
server or to any other host to which the RRAS server has a route. To allow clients to 
access resources on the RRAS server only, uncheck this box.  
 The Enable Default Route Advertisement check box (enabled by default) makes the 
Border Gateway Protocol (BGP) routing protocol available. BGP can exchange routing 
information between Windows Server 2008 R2 routers. When this box is checked, 
your Windows Server 2008 R2 router can announce its route to other routers.  
 On the IPv6 tab, you can also set up your IPv6 preﬁ x assignment (assigning IPv6 
preﬁ xes was discussed in Chapter 12).  
 In Exercise 15.1, you ’ ll conﬁ gure your RRAS server so it accepts only those inbound 
calls that use the Internet Protocol.  
 E X E R C I S E  1 5 .1
Conﬁ guring Incoming Connections  
 1. 
  Open the RRAS MMC console by selecting Start   Administrative Tools   Routing And 
Remote Access. 
 2. 
  Right - click the server you want to conﬁ gure in the left pane of the MMC, and choose the 
Properties command. The server ’ s Properties dialog box appears. 
 3. 
  Click the IPv4 tab. Verify that the Enable IPv4 Forwarding check box is selected.  
 4. 
  Make sure the Dynamic Host Conﬁ guration Protocol (DHCP) radio button is selected.  
 5. 
  Click the OK button. 
 Installing a VPN 
 Conventional dial - up access works well, but as you saw earlier, it can be expensive to 
implement, painful to manage, and extremely slow by today ’ s standards. VPNs offer a 
way around these problems by providing low initial and ongoing costs, easy management, 
and excellent speeds (depending on your connection). Windows Server 2008 ’ s RRAS 
component includes two complete VPN implementations: one using Microsoft ’ s PPTP and 
one using a combination of the Internet - standard IPSec protocol and L2TP or SSTP. 
■
■
■
Installing a VPN 
657

658 
Chapter 15 ■ Managing Remote Access Services
 The basic process of setting up a VPN is simple, but you need to think some things 
through before plunging ahead. Getting the VPN installation right may require small 
hardware or networking changes plus proper conﬁ guration of the VPN service. We will 
look at this process in the following sections. 
 How VPN Works 
 A VPN sits between your internal network and the Internet, accepting connections 
from clients in the outside world. In Figure 15.6, clients 1 and 2 are using different ISPs 
(probably because they ’ re at different physical locations). For example, a packet from 
client 1 goes from its computer to its ISP and then through some route, unknown to you, 
that eventually delivers it to the VPN server, which transforms it into a packet suitable for 
use on the internal network.  
 F I G U R E 15 .6 VPNs provide private connections between clients and servers across 
the Internet. 
Corporate network
VPN
ISP 1
Client 1
Client 2
ISP 2
Internet
 Imagine a line around the internal network, and think of it as a security boundary. 
In general, you ’ ll want your VPN server to be outside any ﬁ rewalls or network security 
measures you have in place. The most common conﬁ guration is to use two NICs: One 
connects to the Internet, and the other connects either to the private network or to an 
intermediate network that itself connects to the private network. Of course, you can use 

any type of Internet connection you want for the VPN server: cable modem, DSL, T1, 
satellite, or whatever. 
 The point behind giving the VPN its own network adapter is that your VPN clients need 
a public IP address to connect to, and you probably don ’ t want them calling directly into 
your internal network. That also means that things will be easiest for your VPN users if 
the IP address for your VPN server ’ s external interface is statically assigned so it won ’ t be 
changing on them when they least expect it.  
 Enabling RRAS as a VPN 
 If you ’ re already using RRAS for IP routing or remote access, you can enable it as a VPN 
server without reinstalling. 
 Recall that the General tab of the server ’ s Properties dialog box allows you to specify 
whether your RRAS server is a router, a remote access server, or both. The ﬁ rst step in 
converting your existing RRAS server to handle VPN trafﬁ c is to make sure the IPv4 
Remote Access Server or IPv6 Remote Access Server check box is selected on this tab. 
 Making this change requires you to stop and restart the RRAS service, but that ’ s OK 
because the snap - in will do it for you. Then you must conﬁ gure VPN ports, as shown in the 
following sections.  
 Configuring a VPN 
 VPN conﬁ guration is extremely simple, at least for PPTP. Either a server can accept VPN 
calls or it can ’ t. If it can, it will have a certain number of VPN ports, all of which are 
conﬁ gured identically. You don ’ t have to change or tweak much to get a VPN server set up, 
but you can adjust a few things as you like. 
 Configuring VPN Ports 
 The biggest opportunity to conﬁ gure your VPN server is to adjust the number and kind 
of VPN ports available for clients to use. You can enable or disable either PPTP or L2TP, 
depending on what you want your remote users to be able to access. You accomplish this 
through the Ports Properties dialog box. 
 For conventional remote access servers, this dialog box shows you a list of hardware 
ports, but for servers that support VPN connections, there two WAN Miniport device 
selections, one for PPTP and one for L2TP. (These aren ’ t really devices; they ’ re actually 
virtual ports maintained by RRAS for accepting VPN connections.) You conﬁ gure these 
ports by selecting one and clicking the Conﬁ gure button, which displays the Conﬁ gure 
Device  – WAN Miniport (PPTP) dialog box (see Figure 15.7).  
Configuring a VPN 
659

660 
Chapter 15 ■ Managing Remote Access Services
 Three controls are pertinent to a VPN conﬁ guration: 
 The Remote Access Connections (Inbound Only) check box must be activated in order 
to accept VPN connections with this port type. To disable a VPN type (for instance, if 
you want to turn off L2TP), uncheck this box.  
 The Demand - Dial Routing Connections (Inbound And Outbound) check box controls 
whether this VPN type can be used for demand - dial connections. By default, this box 
is checked; you ’ ll need to uncheck it if you don ’ t want to use VPN connections to link 
your network with other networks.  
 The Maximum Ports control lets you set the number of inbound connections that this 
port type will support. By default, you get 5 PPTP and 5 L2TP ports when you install 
RRAS; you can use from 0 to 250 ports of each type by adjusting the number here.  
 You can also use the Phone Number For This Device ﬁ eld to enter the IP address of the 
public interface to which VPN clients connect. You might want to do this if your remote 
access policies accept or reject connections based on the number called by the client. 
Because you can assign multiple IP addresses to a single adapter, you can control VPN 
trafﬁ c by throttling which clients can connect to which addresses through a policy.  
 Chapter 16 discusses remote access policies in more detail.  
 Troubleshooting VPNs 
 The two primary problems you might encounter with VPN are as follows: 
 Inability to establish a connection at all  
 Inability to reach some needed resource once connected  
■
■
■
■
■
 F I G U R E 15 .7 The Configure Device  –  WAN Miniport (PPTP) dialog box 

 There ’ s a lot of common ground between the process of troubleshooting a VPN 
connection and the process of troubleshooting an ordinary remote access connection. 
 The following are some extremely simple — but sometimes overlooked — things to 
check when your VPN clients can ’ t connect. First, make sure your clients can make the 
underlying connection to their ISP, and then check the following: 
 Is RRAS installed and conﬁ gured on the server?  
 Is the server conﬁ gured to allow remote access? Check the General tab of the 
server ’ s Properties dialog box.  
 Is the server conﬁ gured to allow VPN trafﬁ c? Check the Ports Properties dialog 
box to make sure that the appropriate VPN protocol is enabled and that the 
number of ports for that protocol is greater than 0.  
 Are there any available VPN ports? If you have 10 L2TP ports allocated, the 11th 
caller will not be able to connect.  
 Do the client and server match?  
 Is the VPN protocol used by the client enabled on the server? Windows 2000 and 
newer clients will try L2TP ﬁ rst and switch to PPTP as a second choice. However, 
clients on other OSs (including Windows NT) can normally expect L2TP, PPTP, 
or SSTP.  
 Are the client and server authenticated correctly?  
 Are the username and password correct?  
 Does the user account in question have remote access permissions, either directly 
on the account or through a policy?  
 Do the authentication settings in the server ’ s policies (if any) match the supported 
set of authentication protocols?  
 If you check all the simple stuff and ﬁ nd nothing wrong, it ’ s time to move on to checking 
more complex issues. These tend to affect more than one user, as opposed to the simple 
(and generally user - speciﬁ c) issues just outlined. The problems include the following:  
 Policy Problems   If you ’ re using a native - mode Windows Server 2008 R2 domain and 
you ’ re using policies, those policies may cause some subtle problems that show up under 
some circumstances: 
 Are there any policies whose Allow or Deny settings conﬂ ict with each other? 
Remember that all conditions of all policies must match to gain user access; if 
any condition of any policy fails or if there are any policies that deny access, the 
connection will be denied.  
 Does the user match all the necessary conditions that are in place, such as time 
and date?  
 Network Problems   If you ’ re using dynamic IP addressing, are there any addresses left in 
the pool? If the VPN server can ’ t assign an address, it won ’ t accept the connection.  
■
■
■
■
■
■
■
■
■
■
■
■
Configuring a VPN 
661

662 
Chapter 15 ■ Managing Remote Access Services
  Domain Problems   Windows Server 2008 R2 RRAS servers can coexist with Windows 
NT RRAS servers, and both of them can interoperate with RADIUS servers from 
Microsoft and other vendors. Sometimes, though, this interoperation doesn ’ t work exactly 
as you ’ d expect. Some questions to ask include the following: 
 Is the RRAS server ’ s domain membership correct? Your RRAS servers don ’ t have 
to be domain members unless you want to use native - mode features such as remote 
access policies.  
 If you ’ re in a domain, are the server ’ s group memberships correct? The server 
account must be a member of the RAS group and Internet Authentication Servers 
security group.  
 Packet filters are discussed in detail in Chapter 14. 
 Managing Your Remote Access Server 
 RRAS server management is generally pretty easy because, in most cases, there ’ s not much 
to manage. You set up the server, and it answers calls. You ’ ll probably ﬁ nd it necessary to 
monitor the server ’ s ongoing activity, however, and you may ﬁ nd it necessary to log activity 
for accounting or security purposes. 
 You can monitor your server ’ s activity in a number of ways, including having the server 
keep local copies of its logs or having it send logging data to a remote RADIUS server. In 
addition, you can monitor the current status of any of the ports on your system. 
 Microsoft ’ s documentation distinguishes between event logging, which records 
signiﬁ cant things that happen such as the RRAS service starting up and shutting down, and 
authentication and accounting logging, which tracks things such as when a user logged on 
and logged off. The settings for both types of logging are intermingled in the RRAS snap - in. 
 Managing Remote Users with a RADIUS Server 
 Remote Authentication Dial - In User Service (RADIUS) allows for maintaining and 
managing your remote users. A RADIUS server allows Remote Access Service (RAS) clients 
and dial - up routers to be authenticated. 
 Network Policy Server (NPS) is Microsoft ’ s implementation of a RADIUS server in 
Windows Server 2008 R2. NPS is replacing Windows Server 2003 Internet Authentication 
Service (IAS). NPS, working as a RADIUS server, allows for authentication, authorization, 
and accounting for wireless and VPN networks. 
 NPS allows a server to perform the duties of a RADIUS proxy. A RADIUS proxy allows 
the routing of RADIUS messages between RADIUS clients (RAS) and RADIUS servers. 
NPS also gives you the ability to record information about forwarded messages in an 
accounting log.  
■
■

 Monitoring Overall Activity 
 The Server Status node in the RRAS snap - in shows you a summary of all the RRAS servers 
known to the system. Depending on whether you use the features discussed in Chapter 14 
to manage multiple RRAS servers from one console, you may see only the local server ’ s 
information here. When you select the Server Status item, the right pane of the MMC will 
list each known RRAS server. Each entry in the list tells you whether the server is up, what 
kind of server it is, how many ports it has, how many ports are currently in use, and how 
long the server has been up. You can right - click any Windows Server 2008 R2 RRAS server 
in this view to start, stop, restart, pause, or resume its RRAS service; disable RRAS on the 
server; or remove the server ’ s advertisement from Active Directory (provided, of course, 
that you ’ re using Active Directory).  
 Controlling Remote Access Logging 
 A standard RRAS installation will always log some data locally, but that ’ s pretty useless 
unless you know what gets logged and where it goes. Each RRAS server on your network 
has its own set of logs, which you manage through the Remote Access Logging folder. 
Within that folder, you ’ ll usually see a single item labeled Local File, which is the log ﬁ le 
stored on that particular server.  
 If you don ’ t have Windows accounting or Windows authentication turned 
on, you won ’ t have a local log file. Depending on whether you ’ re using 
RADIUS accounting and logging, you may see additional entries.  
 Setting Server Logging Properties 
 You can control server logging at the server level. You use the Logging tab to control what 
level of detail you want in the server ’ s event log.  
 These controls regulate all logging by RRAS, not just remote access log 
entries.  
 You have four choices for the level of logged detail: 
 The Log Errors Only radio button instructs the server to log errors and nothing else. 
This gives you an adequate indication of problems after they happen, but it doesn ’ t 
point out potential problems noted by warning messages.  
 The Log Errors And Warnings radio button is the default choice. This forces the server 
to log error and warning messages to the event log, giving you a nice balance between 
information content and log volume.  
■
■
Managing Your Remote Access Server 
663

664 
Chapter 15 ■ Managing Remote Access Services
 The Log All Events radio button causes the RRAS service to log mass quantities of 
messages, covering literally everything the server does. Although this voluminous 
output is useful for troubleshooting (or even for getting a better understanding of how 
remote access works), it ’ s overkill for everyday use.  
 The Do Not Log Any Events radio button turns off all event logging for RRAS.  
 Don ’ t use the Do Not Log Any Events option. The service ’ s logs are 
important in case of a problem. 
 The Log Additional Routing And Remote Access Information check box allows you 
to turn on the logging of all PPP negotiations and connections. This can provide valuable 
information when you ’ re trying to ﬁ gure out what ’ s wrong, but it adds a lot of unnecessary 
bulk to your log ﬁ les. Don ’ t turn it on unless you ’ re trying to pin down a problem.  
 Setting Log File Properties 
 By selecting an individual log ﬁ le in the snap - in, you can change what events will be logged 
in that ﬁ le. This dialog box has two tabs: 
 The Settings tab controls what gets logged in the ﬁ le:  
 Accounting Requests governs whether events related to the service will be logged 
(as well as accounting data). You should always leave this checked.  
 Authentication Requests adjusts whether successful and failed logon requests are 
logged. You should always leave this checked.  
 Periodic Status controls whether interim accounting packets are permanently 
stored on disk. You should usually leave this checked.  
 Periodic Authentication Requests adjusts whether successful and failed logon 
requests are periodically logged. You should always leave this checked.  
 The Log File tab (see Figure 15.8) controls the format of the ﬁ le, speciﬁ cally, how the 
log ﬁ le is written to disk. You use this tab to designate three things:  
 The Directory ﬁ eld shows where the log ﬁ le is stored. By default, each server 
logs its data in   systemroot  \system32\LogFiles . You can change this location to 
wherever you want.  
 The Format controls determine the format of the log ﬁ le. By default, Windows Server 
2000, 2003, 2008, and 2008 R2 use the database - compatible ﬁ le format. This format 
makes it easy for you to take log data and store it in a database, enabling more 
sophisticated postprocessing for things such as billing and chargebacks.  
 The Create A New Log File controls determine how often new log ﬁ les are created. 
For example, some administrators prefer to start a new log ﬁ le each week or each 
month, whereas others are content to let the log ﬁ le grow without end. You can 
choose to have RRAS start new log ﬁ les every day, week, month, never, or when 
the log ﬁ le reaches a certain size.  
■
■
■
■
■
■
■
■
■
■
■

 Having correct accounting and authorization data is critical to maintaining a good level 
of security. Exercise 15.2 walks you through conﬁ guring remote access logging.  
 F I G U R E  15 . 8 The Log File tab of the Local File Logging dialog box 
 E X E R C I S E  1 5 . 2
Changing Remote Access Logging Settings  
 1. 
  Open the RRAS MMC snap - in by selecting Start   Administrative Tools   Routing And 
Remote Access. 
 2. 
  Navigate to the Remote Access Logging and Policies folder. Right - click the folder, and 
select Launch NPS. 
 3. 
  On the left pane, click Accounting. On the right side, click Change Log File Properties.  
 4. 
  The Local File Logging dialog box appears. On the Settings tab, make sure all check 
boxes are marked.  
 5. 
  Switch to the Log File tab in the Create A New Log File control, select the When Log File 
Reaches This Size option, and enter  50 to set the maximum size of the log ﬁ le to 50 MB.  
 6. 
  Click the OK button. Close the Network Policy Server window.  
Managing Your Remote Access Server 
665

666 
Chapter 15 ■ Managing Remote Access Services
 Reviewing the Remote Access Event Log 
 You use the Log File tab to specify the format, size, and location of the log ﬁ le. But once you 
have a log ﬁ le, what do you do with the log information? Windows Server 2008 R2 online 
help has an exhaustive list of all the ﬁ elds logged for each connection attempt and accounting 
record. Because of the availability of online help, you don ’ t need to have all those ﬁ elds 
memorized, and you don ’ t have to remember exactly how to make sense of the log entries. 
 Why bother reviewing the logs? One nice feature is that each entry in the authentication 
log indicates which remote access policy was applied (either to accept or to reject the 
connection). This is a good way to identify problems with policies, because sometimes 
multiple policies can combine to have an effect you didn ’ t expect. 
 Furthermore, if it ’ s desirable in your environment, you can use the logged data to 
generate accounting reports to tell you things such as the average utilization of your 
dial - in ports, the top ten users of dial - in connect time, or how much online time accounts 
or certain Windows groups use.  
 Monitoring Ports and Port Activity 
 You can monitor port status and activity from the RRAS snap - in. The Ports folder under 
the server contains one entry for each deﬁ ned port. When you select the Ports folder, you ’ ll 
see a list of the ports and their current status. The list indicates whether each port is a 
dial - in or VPN port and whether it ’ s active, so you can get a quick summary of your 
server ’ s workload at any time. 
 Double - clicking an individual port displays the Port Status dialog box (see Figure 15.9). 
This dialog box shows information such as a port ’ s line speed (Line BPS), the amount of 
transmitted and received data (Bytes In and Bytes Out), and the network address for each 
protocol being carried on the port. This is a useful tool for verifying whether a port is in active 
use, and it gives you a count of the number of transmission and reception errors on the port.  
 F I G U R E 15 . 9 The Port Status dialog box 

 Configuring a RAS or VPN Client 
 Dial - up RAS clients and VPN clients are similar. Almost all the options that are available 
when you set up a RAS client are also available when you set up a VPN client. The main 
differences are as follows: 
 VPN clients specify the server ’ s IP address, whereas RAS clients specify the server ’ s 
phone number.  
 VPN clients require an underlying connection to the Internet.  
 Client conﬁ guration is not a focus of the exam, so in this chapter you will learn 
how to conﬁ gure a VPN client but not a RAS client. Just remember that the RAS client 
conﬁ guration is extremely similar.  
 VPN connections are almost always created on client workstations, so this 
section describes the settings in Windows 7. 
 When you establish a virtual private network connection, you ’ re actually building an 
encrypted tunnel between you and some other machine. The tunneled data is carried over 
an insecure network, such as the Internet. 
 Once you ’ ve created a connection, you can change its properties at any time by opening 
its Properties dialog box. The Dial - Up Connection Properties dialog box has a total of ﬁ ve 
tabs you can use to adjust all the pertinent settings for each connection.  
 Don ’ t confuse these settings with the ones in the Local Area Connection 
Properties dialog box; they serve entirely different purposes. 
 The General Tab 
 The General tab of the Connection Properties dialog box (the box is called Dial - Up 
Connections or VPN Connections, depending on whether you ’ re conﬁ guring dial - up RAS 
or VPN) is where you specify either the IP address of the VPN server or the modem and 
phone number to use with this particular connection. Some ﬁ elds have already been 
ﬁ lled in from when you used the Network Connection Wizard. Figure 15.10 shows the 
VPN settings. 
 The General tab has a ﬁ eld where you enter the VPN server address or hostname. The 
First Connect group lets you specify which dial - up connection, if any, you want brought up 
before the VPN connection is established. 
■
■
Configuring a RAS or VPN Client 
667

668 
Chapter 15 ■ Managing Remote Access Services
 With the General tab, you can also do the following: 
 Set VPN options:  
 Enter the VPN server address or hostname.  
 Specify whether to automatically dial another connection ﬁ rst, and then specify 
the connection to dial.  
 Set RAS options:  
 Change the modem this connection uses, or settings for the modem you already 
have, with the Conﬁ gure button.  
■
■
■
■
■
 F I G U R E 15 .10 General tab of the VPN Connection Properties dialog box 
 When configuring dial - up, you can also use the Phone And Modem 
Options control panel to adjust a broader range of modem settings.  
 The Options Tab 
 The Options tab holds settings that control how DUN dials and redials the connection. The 
controls in this dialog box are segregated into two groups. The Dialing Options group 
holds controls that govern DUN ’ s interface behavior while dialing, and the Redialing 
Options group controls whether and how DUN will redial if it doesn ’ t immediately connect. 

 Dialing Options 
 Four dialing options are available in the Dialing Options group: 
 The Display Progress While Connecting check box (selected by default) instructs DUN 
to keep you updated on its progress as it attempts to raise the connection.  
 The Prompt For Name And Password, Certiﬁ cate, Etc. check box is also selected 
by default. When it ’ s on, Windows will prompt you for any credentials it needs 
to authenticate your connection to the remote server. This may be a username, a 
password, a public - key certiﬁ cate, or some combination of the three, depending on 
what the remote end requires.  
 The Include Windows Logon Domain check box is unchecked by default. It forces 
DUN to include the domain name of the domain you ’ re logged on to as part of the 
authentication credential. Leave this unchecked unless you ’ re dialing into a Windows 
NT/2000 network that has a trust relationship with your logon domain.  
 For RAS connections, a Prompt For Phone Number check box tells DUN to display the 
phone number in the connection dialog box. This box is checked by default. This gives 
you a chance to edit the phone number before dialing; you may want to uncheck it 
if you (or your users) are prone to making accidental changes.  
 Redialing Options 
 The settings in the Redialing Options group control how DUN will attempt to redial the 
speciﬁ ed number if the remote end is busy or doesn ’ t answer with a recognizable carrier 
tone. These settings include the following: 
 The Redial Attempts ﬁ eld controls how many attempts DUN will make to raise the 
other end before giving up. The default value is 3, but you can set any value from 0 
(meaning that DUN won ’ t attempt to redial) to 999,999,999.  
 The Time Between Redial Attempts drop - down menu controls how long DUN 
will wait after each failed call before it tries again. Values in the drop - down 
menu range from 1 second all the way to 10 minutes, with various increments 
in between.  
 The Idle Time Before Hanging Up drop - down menu lets you specify an inactivity 
timer. If your connection is idle for longer than the speciﬁ ed period, your client 
will terminate the call. Note that the remote end may drop the call sooner than your 
client, depending on how it ’ s conﬁ gured. By default, this drop - down menu is set to 
Never, meaning that your client will never drop a call. If you want an inactivity timer, 
you can pick values ranging from 1 minute to 24 hours.  
 The Redial If Line Is Dropped check box automatically redials the number if you are 
disconnected.  
■
■
■
■
■
■
■
■
Configuring a RAS or VPN Client 
669

670 
Chapter 15 ■ Managing Remote Access Services
 The Security Tab 
 How useful you ﬁ nd the Security tab will depend on whom you ’ re calling. The default 
settings it provides will work ﬁ ne with most Internet service providers and corporate 
dial - up facilities, but Windows 7 has a broad range of security settings you can change if 
you require. The Security Options group contains controls that directly affect the security 
of your connection. The Advanced (Custom Settings) radio button controls settings such as 
encryption and authentication protocols. 
 Security Options 
 The controls in the Security Options group are pretty straightforward. The security 
settings in effect for this connection are governed by your choice between the Typical 
(Recommended Settings) and Advanced (Custom Settings) radio buttons. 
 Typical (Recommended Settings) 
 Usually, it ’ s best to stick with the Typical (Recommended Settings) option and use its 
subordinate controls to pick a canned setting that matches your needs. These subordinate 
controls include the following: 
 The Validate My Identity As Follows drop - down menu lets you choose among the 
following authentication methods:  
 Unsecured passwords (the default, and the only type of authentication that most 
networks support)  
 Secured passwords  
 Smart card authentication (useful only when calling another Windows 2000, 
2003, 2008, or 2008 R2 network)  
 If you choose to require a secured password, the Automatically Use My Windows 
Logon Name And Password (And Domain If Any) check box instructs DUN to offer 
to the remote end the logon credentials you used to log on to the computer or domain. 
This is useful only if you ’ re dialing into a network that has access to your domain 
authentication information.  
 If you require a secured password or smart card authentication, the Require 
Encryption (Disconnect If None) check box allows you to have either an encrypted 
connection or none at all. If you check this box, your client and the remote server will 
attempt to negotiate a common encryption method. If they can ’ t (perhaps because the 
remote end doesn ’ t offer encryption), your client will hang up.  
 Advanced (Custom Settings) 
 If you select the Advanced (Custom Settings) radio button and then click the Settings 
button, you ’ ll see the Advanced Security Settings dialog box. Its controls are more complex 
than the ones on the Security tab. 
■
■
■
■
■
■

 The ﬁ rst ﬁ eld is the Data Encryption drop - down menu. Windows 7 offers you the 
opportunity to encrypt both sides of network connections using IPSec. This capability 
extends to dial - up connections, too. The drop - down menu gives you the following four 
choices: 
 No Encryption Allowed means that the server will drop your call if it requires 
encryption because you can ’ t provide it.  
 Optional Encryption tells the client to request encryption but to continue the call if it ’ s 
not available.  
 Require Encryption tells the client to request encryption and to refuse to communicate 
with servers that don ’ t support it.  
 Maximum Strength Encryption tells the client to communicate only with servers that 
offer the same strength encryption it does. For example, with this setting in force, a 
North American Windows Server 2008 R2 machine running 3DES won ’ t communicate 
with a French Windows XP machine because the French machine uses the weaker 
exportable encryption routines.  
 The Authentication section controls which authentication protocols this client can 
use. The default setting, Use Extensible Authentication Protocol (EAP), is for standard 
Windows authentication (using the MD5 - Challenge method) or certiﬁ cate - based 
authentication (using the Smart Card Or Other Certiﬁ cate choice in the drop - down menu). 
 The Allow These Protocols radio button is followed by a long list of authentication 
protocols. Although the speciﬁ cs of how they work are different, the basic idea behind all 
these protocols is the same. Each provides a secure way for a client to prove its identity 
to a server. By selecting the appropriate check boxes, you can make your client use the 
same protocols as the remote end. For more details, see  “ Introduction to Authentication 
Protocols ” later in this chapter. 
 The Networking Tab 
 You use the Networking tab to control which protocols your client will attempt to use 
when communicating with other servers. 
 The list box in the middle of the tab shows the network protocols installed on the client. 
Protocols marked with a check are available for use with this connection. Usually, when 
conﬁ guring RAS, you ’ ll see TCP/IP and Client For Microsoft Networks marked, which 
indicates that those two protocols can be used over the connection. 
 The Install, Uninstall, and Properties buttons work just as they do in the Local Area 
Connection Properties dialog box — by using them you can control which protocols are on 
your machine and what their settings are. 
 It ’ s worth mentioning that selecting Internet Protocol (TCP/IP) in the protocols list and 
opening its Properties dialog box gives you access to a set of properties that are completely 
distinct from any TCP/IP settings that may apply to your LAN interfaces. Usually, the 
dial - up TCP/IP settings are conﬁ gured to obtain an IP address and DNS information from 
the remote server, although if you need to, you can override these settings.  
■
■
■
■
Configuring a RAS or VPN Client 
671

672 
Chapter 15 ■ Managing Remote Access Services
 The Sharing Tab 
 Internet Connection Sharing allows other users to connect to the Internet through this 
machine. The machine you enable this on works like a gateway to the Internet.  
 Introduction to Authentication Protocols 
 The authentication protocols available when setting up VPN or dial - up connections include 
the following: 
 PAP  
 SPAP  
 CHAP  
 MS - CHAP version 1 (MS - CHAPv1)  
 MS - CHAP version 2 (MS - CHAPv2)  
 SPAP and MS - CHAPv1 are no longer supported by Windows Server 
2008 R2 for authentication protocols for PPP - based connections. We will 
continue to discuss these protocols so that you have an understanding of 
them for older operating systems and clients. 
 The sheer number of authentication protocol choices means that it ’ s quite easy to 
miss the subtleties inherent within each choice and version. It is important that you understand 
the differences between these protocols — not only for your career as an administrator but also 
for the exam! Both this chapter and Chapter 16 will cover these authentication protocols in 
some detail since you ’ ll likely encounter questions about them on the exam.  
  Challenge Handshake Authentication Protocol   CHAP is an authentication protocol that 
calls for the authenticating server to send a challenge to the NAS, which then combines 
that challenge with a preshared secret and performs the authentication. Passwords for use 
with CHAP are stored with a reversible encryption, which makes CHAP a poor choice for 
most scenarios.  
  Extensible Authentication Protocol - Transport Level Security   Extensible Authentication 
Protocol - Transport Level Security (EAP - TLS) is a certiﬁ cate - based authentication 
framework that ’ s usually used with smart cards (two - factor authentication). EAP - TLS can 
be used only on servers that are members of a domain, and it is found only in Windows 
Server 2003, 2008, and 2008 R2.  
  Extensible Authentication Protocol - Message Digest 5 Challenge Handshake Authentication 
Protocol   EAP - MD5 CHAP is a version of EAP that uses CHAP. This algorithm hashes 
encryption information using MD5. This algorithm can be used for compatibility with 
■
■
■
■
■

other, non - Microsoft systems. Windows Server 2008 R2 no longer supports this protocol 
for authentication protocols for PPP - based connections.  
 MS - CHAPv1   MS - CHAPv1 is Microsoft ’ s implementation of a one - way authentication 
and encryption algorithm. MS - CHAPv1 is supported on older versions of Windows, 
including Windows 95 and Windows 98. Windows Server 2008 R2 no longer supports this 
protocol for authentication protocols for PPP - based connections.  
 MS - CHAPv2   MS - CHAPv2 is an implementation by Microsoft of a two - way 
authentication system. It is available in Windows 2000, Server 2003, Windows 7, Vista, 
XP, Server 2008, and Server 2008 R2. 
 Password Authentication Protocol  Password Authentication Protocol (PAP) is an 
authentication mechanism found at many Internet providers. PAP sends user credentials 
in plain text between the NAS and the authentication server and therefore is susceptible to 
man - in - the - middle attacks.  
 Shiva Password Authentication Protocol   Shiva Password Authentication Protocol (SPAP) 
encrypts authentication information between the NAS and the authentication server and is 
mainly used with Shiva remote access servers. Windows Server 2008 R2 no longer supports 
this protocol for PPP - based connections.  
 Unauthenticated Access   This method enables connections to be established without 
providing credentials. You shouldn ’ t use this method in a live network, but it can be helpful 
for testing and troubleshooting.  
 Internet Key Exchange Version 2   Microsoft has added Internet Key Exchange version 2 
(IKEv2) support for Windows Server 2008 R2 and Windows 7, thus allowing support of 
VPN Reconnect. VPN Reconnect allows a VPN connection to survive short interruptions 
in network connectivity. 
 Even if you change the IP address at the client side, the VPN connection will not drop or 
require any user actions. As soon as connectivity to the VPN server is restored, then the 
VPN tunnel is automatically reestablished.  
 For the exam, you should know which authentication protocols support 
which features and which ones are available on various versions of 
operating systems.  
 Overview of Wireless Access 
 In today ’ s computer world, it seems like everyone has a laptop. We do a lot of traveling, 
and when you go to any airport in America, it seems like everyone is working on a laptop 
while they wait for their plane. 
Overview of Wireless Access 
673

674 
Chapter 15 ■ Managing Remote Access Services
 Because laptops have grown in popularity, we IT professionals must account for them on 
our networks. Laptops offer IT administrators a unique set of challenges that we must deal 
with on a day - to - day basis. 
 One major concern for IT administrators is security. Years ago we never had to worry 
about users copying documents to a desktop computer and then walking out with the 
computer. But today, users can copy company documents to laptop computers and then 
walk out the door with the computer and the documents. In this section, we will discuss 
wireless networks, protocols, and security. 
 Windows7, Windows Vista, Windows 2008, and Windows Server 2008 R2 have 
enhanced the IEEE 802.11 wireless support to include some of the following changes: 
 Single sign - on  
 802.11 wireless diagnostics  
 WPA2 support  
 Native Wi - Fi architecture  
 User interface improvements for wireless connections  
 Wireless Group Policy enhancements  
 Changes in Wireless Auto Conﬁ guration  
 Integration with Network Access Protection when using 802.1X authentication  
 EAPHost infrastructure  
 Command - line support for conﬁ guring wireless settings  
 Network Location Awareness and network proﬁ les  
 Next - generation TCP/IP stack enhancements for wireless environments  
 Configuring Wireless Access 
 Windows 7, Windows Vista, Windows XP, and Windows Server 2003, 2008, and 
2008 R2 provide built - in support for 802.11 wireless LAN networking. Inside the 
Network Connections folder, an installed 802.11 wireless LAN network adapter 
appears as a wireless network connection. The following are some of the items you 
can conﬁ gure:  
  Operating Modes   There are two types of operating modes: 
 Infrastructure mode : This uses at least one wireless access point (AP) and/or a 
device that bridges the wireless computers to each other.  
 Ad hoc mode : Wireless network computers connect directly to each other without 
the use of an AP or bridge.  
  Wired Equivalent Privacy   All of us (on a laptop) have tried to ﬁ nd a wireless network at 
one time or another. Wired Equivalent Privacy (WEP) is a wireless encryption that was 
■
■
■
■
■
■
■
■
■
■
■
■
■
■

originally deﬁ ned in 802.11. WEP helps prevent unauthorized wireless users from accessing 
your wireless network by the use of a shared secret key: 
 If your wireless network is using the infrastructure mode, the WEP key must be 
conﬁ gured on the wireless AP and all the wireless clients.  
 If your wireless network is using the ad hoc mode, the WEP key must be 
conﬁ gured on all the wireless clients.  
 The WEP key can be either 40 - bit or 104 - bit depending on what your hardware can 
accommodate.  
 Wi - Fi Protected Access   An organization of wireless equipment vendors called 
the Wi - Fi Alliance created an interim standard called Wi - Fi Protected Access (WPA) 
while the IEEE 802.11i wireless LAN security standard was still being completed. WPA 
uses a strong encryption method called the Temporal Key Integrity Protocol (TKIP) to 
replace the weaker WEP standard. You have the ability to use the Advanced Encryption 
Standard (AES) for encryption that is provided by WPA. 
 WPA can be used in two different mode types: 
 WPA - Personal is used for a home ofﬁ ce or small company.  
 WPA - Enterprise was designed for a midsize to large organization.  
 Wi - Fi Protected Access 2   Wi - Fi Protected Access 2 (WPA2) was designed to ofﬁ cially 
replace the WEP standard. WPA2 certiﬁ es that equipment used in a wireless network is 
compatible with the IEEE 802.11i standard. This certiﬁ cation is used to help standardize 
the use of the additional security features of the IEEE 802.11i standard that are not already 
included in WPA. 
 WPA2 can be used in two different mode types: 
 WPA2 - Personal is used for a home ofﬁ ce or small company.  
 WPA2 - Enterprise was designed for a midsize to large organization.  
 Service Set Identifier   To specify a wireless network by name, you specify the service set 
identiﬁ er (SSID), also known as the  wireless network name : 
 In infrastructure mode, the SSID is conﬁ gured on the wireless access point.  
 In ad hoc mode, the SSID is conﬁ gured on the initial wireless client.  
 To help wireless clients discover and join the wireless network, the wireless AP or the initial 
wireless client periodically advertises the SSID (this can be disabled for security).  
 Group Policies for Wireless   You have the ability to use Group Policy settings for Vista, 
Windows 7, Windows 2008, and Windows Server 2008 for WPA2. Group Policy settings 
allow you to conﬁ gure WPA2 options at the server for all wireless clients.  
■
■
■
■
■
■
■
■
Overview of Wireless Access 
675

676 
Chapter 15 ■ Managing Remote Access Services
 Summary 
 In this chapter, you learned how to install and conﬁ gure the Routing and Remote Access 
Services to handle dial - in connections, how to conﬁ gure appropriate encryption and 
security settings so that communication between the client and server is encrypted and 
authenticated, how to install RRAS to provide VPN service using the PPTP and L2TP 
protocols, how to conﬁ gure VPN services on the server and client, and ﬁ nally how to 
troubleshoot common problems with VPNs. 
 We also discussed using wireless networking and what types of security encryption you 
can use to help support your wireless network. We talked about the different components 
of wireless access and using group policies to conﬁ gure wireless clients. Finally, we 
discussed Internet Connection Sharing and the beneﬁ ts of using it.  
 Exam Essentials  
  Know how to install and configure RAS at the server level.   The RAS installation process 
is driven by the Routing and Remote Access Server Setup Wizard, which you use to set 
up a dial - up server. You can specify whether the server acts as a remote access server, 
specify what authentication providers and settings you want the server to use, control the 
settings applied to each protocol you have installed, specify which PPP protocols (including 
multilink) the clients on this server are allowed to use, and control what level of log detail 
is kept for incoming connections.  
  Know how to install and configure a VPN server.   If you don ’ t have RRAS installed, you ’ ll 
need to install it, activate it, and conﬁ gure it as a VPN server. If you ’ re already using RRAS 
for IP routing or remote access, you can enable it as a VPN server without reinstalling. 
VPN conﬁ guration is extremely simple, at least for PPTP. Either a server can accept VPN 
calls or it can ’ t. If it can, it will have a certain number of VPN ports, all of which are 
conﬁ gured identically.  
  Know how to configure an RRAS client.   Most client connections are made on 
Windows 7, Vista, or XP Professional workstations. Dial - in and VPN connections are 
conﬁ gured very similarly, but when creating a VPN connection, you must substitute an 
IP address for a phone number.   

 Review Questions  
 1. 
  You have a local DHCP server for your dial - in clients, but you also want to use the DHCP 
relay agent to forward requests to a remote DHCP server if the local server doesn ’ t answer 
a request. To do this, you must do which of the following?  
 A.   Add a static route to the remote server.  
 B.   Adjust the boot threshold on the DHCP relay agent interface for the remote network so 
that the local server has enough time to respond.  
 C.   Adjust the DHCP Forwarding Time parameter in the Registry.  
 D.   Adjust the forwarding time in the DHCP Relay Agent Global Properties dialog box.  
 2. 
  You are considering multilink PPP in order to increase bandwidth available for a dial - up 
client. Which of the following is not a benefit of multilink?  
 A.   Multilink can make the client experience faster by combining multiple phone lines and 
creating one logical PPP connection.  
 B.   Multilink enables the encryption of data between the client and the server.  
 C.   Multilink can be relatively low in cost and can utilize existing infrastructure.  
 D.   Multilink is easy to use and included in Windows Server 2008 R2 for both inbound 
and outbound calls. 
 3. 
 Your company has offices in five locations around the country. Most of the users ’ activity 
is local to their own network. Occasionally, some of the users in one location need to 
send confidential information to one of the other four locations or to retrieve information 
from one of them. The communication between the remote locations is sporadic and 
relatively infrequent, so you have configured RRAS to use demand - dial lines to set up the 
connections. Management ’ s only requirement is that any communication between the office 
locations be appropriately secured. Which of the following steps should you take to ensure 
compliance with this requirement? (Choose all that apply.)  
 A.   Configure CHAP on all the RRAS servers.  
 B.   Configure PAP on all the RRAS servers.  
 C.   Configure MPPE on all the RRAS servers.  
 D.   Configure L2TP on all the RRAS servers.  
 E. 
  Configure MS - CHAPv2 on all the RRAS servers.  
Review Questions 
677

678 
Chapter 15 ■ Managing Remote Access Services
  4. 
  Your small financial consulting company has a stand - alone Windows 2008 R2 server 
that provides a central location for your home - based consultants to upload and download 
spreadsheet files using Windows 7. A few of the consultants still use Windows XP 
Professional workstations. You want to set up VPN connections between the consultants 
and the RRAS server. The RRAS server is connected to a small peer - to - peer network of five 
Windows XP Professional workstations that use the network for storing files, including the 
files that the consultants are uploading and downloading. What authentication protocol 
should you use for the VPN?  
 A.   CHAP  
 B.   MS - CHAPv2  
 C.   EAP - TLS  
 D.   PAP  
  5. 
  You recently migrated your company ’ s Windows NT network to Windows Server 2008 
R2. This migration includes 300 Windows 7 workstations and 8 Windows Server 2008 R2 
servers. Your company has just acquired another company with offices down the street. It 
has a Windows NT network that needs to be migrated to Windows Server 2008 R2 as well, 
and you have already begun to move the servers to the new operating system and associated 
services. Because you have a tight cap on expenses for network additions, you presently 
can ’ t afford leased lines between the buildings. Until you can get support for them, you are 
going to create a VPN that is both encrypted and authenticated between the two facilities 
over the Internet connections that already exist. What do you need to implement in order to 
achieve this goal? (Choose all that apply.)  
 A.   L2TP  
 B.   PPTP  
 C.   IPsec  
 D.   RADIUS  
 E. 
  MS - CHAPv2  
  6. 
 You have implemented VPNs to connect the various locations of your organization. 
These locations include offices in New York, Sacramento, Memphis, and Omaha, with a 
significant LAN in each one. The RRAS server is set up such that the users aren ’ t aware of 
the intricacies of the connections. You are beginning to have problems with the connections 
between the offices, and as a result, the number of support calls is growing dramatically. 
What configurations could you use to troubleshoot the communication problems?  
 A.   L2TP using MPPE  
 B.   L2TP unencrypted 
 C.   L2TP using IPsec in transport mode  
 D.   L2TP using IPsec in tunnel mode  

 7. 
  Your company ’ s 450 sales reps are finally going to receive laptops so that they can 
communicate with the corporate office whenever they need information stored on the 
corporate network. The corporate network is fully upgraded to Windows Server 2008 R2, 
including the default configuration of the RRAS server for the remote connectivity over 
VPNs. You have installed Windows 7 with the default configuration on all the laptops and 
have added the sales reps to a special group in Active Directory. After you test the laptops, 
everything appears to work fine. You ship them out, and as they reach the sales reps, you 
monitor their initial connections. During the next few days, you begin receiving support 
calls from people complaining they cannot connect to the network. What is the most likely 
cause of the problem?  
 A.   The Windows 7 clients are not configured to support a VPN.  
 B.   The default RRAS configuration does not support VPNs.  
 C.   The default RRAS configuration does not support enough VPN connections.  
 D.   The default RRAS configuration does not support L2TP.  
 E. 
  The Windows 7 client default configuration does not support L2TP.  
 8. 
  You are the network administrator for a company with two offices: one located on the 
East Coast and the other on the West Coast. Sales information needs to be sent from 
the East Coast office to the West Coast office on a regular basis, and some accounting 
reports and payroll information needs to be sent back to the East Coast. The owner of 
your company has been reading stories in the press about security problems on the Internet 
and refuses to allow any company information to travel through the Internet, regardless 
of how much you talk about securing those transmissions. The communications between 
the sites occur approximately once a week. What steps would you take to ensure secure 
authentication and secure transmission while not spending too much money? (Choose all 
that apply.)  
 A.   Configure PAP as the authentication method between the servers.  
 B.   Install RRAS on a server at each location, and keep the line open with an ISDN 
connection that will always be available for the communication.  
 C.   Install RRAS on a server at each location, and configure demand - dial to open the 
connection each time the transmission occurs.  
 D.   Configure CHAP as the authentication method between the servers.  
 E. 
  Configure MS - CHAPv2 as the authentication method between the servers. 
 F. 
 Configure IPSec as the encryption method between the servers.  
 G.   Configure MPPE as the encryption method between the servers.  
 H.  Configure L2TP as the encryption method between the servers.  
Review Questions 
679

680 
Chapter 15 ■ Managing Remote Access Services
 9. 
  You are using an RRAS server to manage remote access to your small Windows Server 
2008 R2 network that serves a single location. RRAS provides access to several remote 
users and to the people who have machines on the local network but occasionally want to 
access the network from home or from hotels when on the road. Regardless of the category 
of user, everyone is authenticated through Active Directory. You haven ’ t spent much time 
reviewing the use of this remote connectivity since you configured the system, but now 
there is a concern about unauthorized users as well as intermittent problems that remote 
users are experiencing when connecting to the network. You ’ ve been asked to prepare 
a report for management describing the extent of these problems in the company. You 
recall that when you set up the system, you configured the logging to track all connection 
attempts using local Windows accounting. Where will you find the logging information 
that you need for preparing your report?  
 A.   The Performance Monitor log  
 B.   Active Directory  
 C.   The   systemroot  \System32\LogFiles  folder  
 D.   The system event log  
 E. 
  The RRAS authentication log  
 10.   Your area of responsibility at the All Terrain Vehicle Rentals Company is to build, deploy, 
and maintain the remote access system for the Windows Server 2008 R2 network. The 
system consists of four RRAS servers, which serve 200 users across the country. The users 
often travel from location to location, and they access different servers depending upon 
where they call in. You put together a management station to monitor all the RRAS servers 
so you can keep an eye on this critical aspect of your network. What tool do you use to 
accomplish this?  
 A.   The Server Monitor of the RRAS snap - in  
 B.   The Server Status node of the RRAS snap - in  
 C.   The System Monitor snap - in  
 D.   The MMC 

 Answers to Review Questions 
1. 
 B.   The boot threshold for an interface controls how long the relay agent will wait before 
forwarding DHCP requests it hears on that interface. 
2. 
 B.   Multilink PPP has nothing to do with encryption of data. Multilink is easy to set up, is 
relatively low in cost, and makes the connection faster. 
3. 
 C, E.   MS - CHAPv2 provides encrypted and mutual authentication between the respective 
RRAS locations. MPPE works with MS - CHAPv2 and provides encryption for all the data 
between the locations. CHAP provides encrypted authentication, but MS - CHAPv2 is 
needed for MPPE to work. PAP is the lowest level of authentication providing passwords, 
but it sends passwords in clear text, which is not the most secure solution. L2TP needs to 
team up with IPsec to provide the data encryption for the secure transfer of information 
between the locations. 
4. 
 B.   MS - CHAPv2 authentication allows you to create VPN connections with a stand - alone 
server using PPTP and MPPE. MPPE employs keys that are created via MS - CHAPv2 
or EAP - TLS authentication. EAP - TLS is not the correct answer because only domain 
controllers or member servers support EAP - TLS. Stand - alone servers support only MPPE. 
Neither PAP nor CHAP is supported with MPPE. 
5. 
 A, C.   L2TP connections can be used to authenticate both sides of the VPN. L2TP needs 
IPsec to provide the encryption for the connection. These two together will provide the 
secure and authenticated transmission of data across the Internet between the two sites. 
PPTP connections provide encryption only using MPPE but don ’ t provide authentication 
between the machines. RADIUS is a service that provides dial - in connectivity. MS -
 CHAPv2 is an authentication protocol for clients accessing the network. 
6. 
 B.   L2TP and IPsec each has its own negotiation procedure for making a connection. If 
you remove the IPsec portion of the connection and the problem is alleviated, it is likely 
that IPsec is the problem, and you can then focus on IPsec. If the problem remains, you 
can work on the L2TP portion of the connection. IPsec has two modes: tunnel mode 
and transport mode. But because L2TP is a tunneling protocol, there is no sense in using 
IPsec tunneling. IPsec transport mode is used with L2TP and should be set aside for 
troubleshooting, as discussed. The L2TP implementation in Windows Server 2008 R2 
doesn ’ t support MPPE. 
7. 
 C.   The default conﬁ guration for RRAS supports ﬁ ve PPTP ports and ﬁ ve L2TP ports. 
There are up to 150 sales reps trying to connect to the server, but only the ﬁ rst 10 will be 
able to connect. You can increase the number of ports available, up to 1,000, by using the 
Ports Properties dialog box. The Windows 7 clients are by default ready to support VPNs; 
they will ﬁ rst try L2TP and then switch over to PPTP if ports are unavailable. 
Answers to Review Questions 
681

682 
Chapter 15 ■ Managing Remote Access Services
8. 
 C, E, G.  Because the communication is not a continuous or frequent occurrence, it doesn ’ t 
make sense to have the line always available, so RRAS with demand - dial will be less 
expensive than ISDN, which is always up. MS - CHAPv2 provides encryption and a mutual 
authentication process. The MPPE provides the encryption of the actual data that travels 
across the connection. PAP is a clear - text authentication method, and CHAP provides only 
one - way authentication. L2TP doesn ’ t provide any encryption by itself. 
9. 
 C.   When you use Windows accounting, the local Windows account logs are found in the 
  systemroot  \System32\LogFiles folder. These logs can be stored in one of two formats 
for later analysis — Open Database Connectivity (ODBC) or Internet Authentication 
Service. The Performance Monitor Log tool that came with Windows NT has been replaced 
with the system event log. This keeps track of global service errors such as initialization 
failures and service starts and stops. There is no RRAS authentication log. You do have 
RADIUS logging available; when it ’ s used, the log ﬁ les are stored on the RADIUS servers. 
This is useful when you have multiple RRAS servers because you can centralize RRAS 
authentication requests. Active Directory is not used to log events from the various services 
in Windows Server 2008 R2. 
10.  B.   The Server Status node in the RRAS snap - in shows you a summary of all the RRAS 
servers known to the system. Each server entry displays whether the server is up, what kind 
of server it is, how many ports it has, how many ports are currently in use, and how long 
the server has been up. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 

Managing Security 
for Remote Access 
Services  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Addressing and Services  
■   Configure Windows Firewall with Advanced Security. May 
include but is not limited to: inbound and outbound rules; 
custom rules; authorized users; authorized computers; 
configure firewall by using Group Policy; network location 
profiles; service groups; import/export policies; isolation 
policy; IPsec group policies; Connection Security Rules.  
 Configuring Network Access  
■   Configure Network Access Protection (NAP). May include 
but is not limited to: network layer protection; DHCP 
enforcement; VPN enforcement; RDS enforcement; configure 
NAP health policies; IPsec enforcement; 802.1x enforcement; 
flexible host isolation; multi - configuration System Health 
Validator (SHV).  
■   Configure Network Policy Server (NPS). May include but is 
not limited to: IEEE 802.11 wireless; IEEE 802.3 wired; group 
policy for wireless; RADIUS accounting; Connection Request 
policies; RADIUS proxy; NPS templates.  


 Chapter 
16

 One of the more important goals for a network administrator 
is keeping the network secure, including when your users 
remotely access the network. The Windows Server 2008 R2 
Group Policy object (GPO) provides a way to apply dial - up permission and capability 
settings to groups of users. 
 This chapter explains how network access policies and proﬁ les are used to grant or deny 
user access to resources on the network across remote connections. We ’ ll begin by looking 
in more detail at the authentication protocols included with Windows Server 2008 R2. 
You ’ ll also see how the operating system handles remote access security. Then we ’ ll dive 
into the details of conﬁ guring user access with proﬁ les and policies. You ’ ll also learn how 
to conﬁ gure your server to use Windows authentication or RADIUS authentication.  
 Remote Access Security 
 In the past, remote access was seldom part of most companies ’  networks. It was too hard to 
implement, too hard to manage, and too hard to secure. It ’ s reasonably easy to secure your 
networks from unauthorized physical access, but it was perceived to be much harder to do 
so for remote access. Recently, a number of security policies, protocols, and technologies 
have been developed to ease this problem. First we ’ ll discuss the user authentication 
protocols. 
 User Authentication 
 One of the ﬁ rst steps in establishing a secure remote access connection involves allowing 
the user to present some credentials to the server. You can use any or all of the following 
authentication protocols that Windows Server 2008 R2 supports:  
 Password Authentication Protocol   The Password Authentication Protocol (PAP) is the 
simplest authentication protocol. It transmits all authentication information in clear 
text with no encryption, which makes it vulnerable to snooping if attackers can put 
themselves between the modem bank and the remote access server. However, this type of 
attack is unlikely in most networks. The security risk with PAP is largely overemphasized 
considering the difﬁ culty of setting up a sniffer in between the modems and the remote 
access server. If an attacker has the ability to install a sniffer this deep in the network, you 
have larger problems to address. 

 PAP is the most widely supported authentication protocol, and you therefore may ﬁ nd that 
you need to leave it enabled.  
 Microsoft CHAPv2   Microsoft CHAPv2 (MS - CHAPv2) was created by Microsoft as an 
extension of the CHAP protocol to allow the use of Windows authentication information. 
Version 2 is more secure than version 1 and version 1 is not supported by Windows Server 
2008 and Windows Server 2008 R2. Some other operating systems support MS - CHAP 
version 1. 
 Extensible Authentication Protocol   The Extensible Authentication Protocol (EAP) doesn ’ t 
provide any authentication itself. Instead, it relies on external third - party authentication 
methods that you can retroﬁ t to your existing servers. Instead of hardwiring any 
one authentication protocol, a client/server pair that understands EAP can negotiate an 
authentication method. The computer that asks for authentication — the  authenticator — is 
free to ask for several pieces of information, making a separate query for each one. This 
allows the use of almost any authentication method, including smart cards, secure access 
tokens such as SecurID, one - time password systems such as S/Key, or ordinary username/
password systems. 
 Each authentication scheme supported in EAP is called an  EAP type . Each EAP type is 
implemented as a plug - in module. Windows Server 2008 R2 can support any number of 
EAP types at once; the Routing and Remote Access Services (RRAS) server can use any 
EAP type to authenticate if you ’ ve allowed that module to be used and the client has the 
module in question. 
 Windows Server 2008 R2 comes with EAP - Transport Level Security (TLS). This EAP type 
allows you to use public - key certiﬁ cates as an authenticator. TLS is similar to the familiar 
Secure Sockets Layer (SSL) protocol used for web browsers. When EAP - TLS is turned 
on, the client and server send TLS - encrypted messages back and forth. EAP - TLS is the 
strongest authentication method you can use; as a bonus, it supports smart cards. However, 
EAP - TLS requires your RRAS server to be part of a Windows 2000, Windows Server 
2003, Windows Server 2008, or Windows Server 2008 R2 domain. 
 EAP - RADIUS is another authentication method included with Windows Server 2008 
R2. EAP - RADIUS is a fake EAP type that passes any incoming message to a Remote 
Authentication Dial - In User Service (RADIUS) server for authentication.  
 NTLMv2   NTLMv2 helps the authentication process for Windows NT 4 systems or 
earlier and allows for transactions between any two computers running these older 
systems. Networks that use NTLMv2 are referred to as  mixed mode . 
 Kerberos   Active Directory domain authentication is done by using the Kerberos 
authentication protocol. By default, all computers joined to a Windows Server 2008 R2 
domain use the Kerberos authentication protocol. Kerberos allows for single sign - on to 
network resources on a domain or on a trusted domain. Administrators have the ability 
to control certain parameters through the Kerberos security settings of the account policies.  
Remote Access Security 
685

686 
Chapter 16 ■ Managing Security for Remote Access Services
  802.1X   The IEEE has a standard for wireless authentication called 802.1X. 802.1X 
allows wireless networks to authenticate onto a wired Ethernet networks or wireless 
802.11 networks. The IEEE 802.1X standard uses EAP for exchanging messages during the 
authentication process.  
 Connection Security 
 You can use some additional features to provide connection - level security for your remote 
access clients: 
 The Callback Control Protocol (CBCP) allows your RRAS servers or clients to negoti-
ate a callback with the other end. When CBCP is enabled, either the client or the server 
can ask the server at the other end to call the client back at a number supplied by the 
client or a prearranged number stored on the server.  
 You can program the RRAS server to accept or reject calls based on the caller ID or 
automatic number identiﬁ cation (ANI) information transmitted by the phone company. 
For example, you can instruct your primary RRAS server to accept calls from only 
your home analog line. That means you can ’ t call the server when you ’ re on the road —
 and it also keeps the server from talking to strangers.  
 You can specify various types and levels of encryption to protect your connection from 
interception or tampering.    
■
■
■
 The Limits of Caller ID 
 It ’ s risky to rely on ANI information for any type of authentication or caller veriﬁ cation. 
First, caller ID information can be forged. Therefore, if an attacker knows the telephone 
numbers from which your network accepted calls, they could make their ANI report as 
one of those numbers and be authenticated into the network. 
 Another problem with relying on ANI for authentication is that not all telephone compa-
nies pass ANI information with the call. Therefore, if your users are in remote locations 
(which is why they ’ d be dialing in anyway), they might not be able to authenticate. Even 
when ANI information is sent, some telephone companies pass different pieces of the 
information, which can also result in authentication failures. 
 Finally, not all incoming line types support ANI. If your site uses a network access server 
or modem bank that doesn ’ t receive this information based on the type of T1 connection 
used for incoming calls, the ANI information might not be there at all. 

 Access Control 
 Apart from the connection - level measures you can use to prohibit outside callers from 
talking to your servers, you can restrict which users can make remote connections in a 
number of ways: 
 You can allow or disallow remote access from individual user accounts. This is the 
same limited control you have in Windows NT, but it ’ s just the start for Windows 
Server 2008 R2.  
 You can use network access policies to control whether users can get access. 
 Like group policies, network access policies give you an easy way to apply a consistent 
set of policies to groups of users. However, the policy mechanism is a little different: 
You create rules that include or exclude the users you want in the policy. 
 Unlike group policies, network access policies are available only in Windows 2000 
native, Windows Server 2003, Windows Server 2008, and Windows Server 2008 
R2 domain functional level (that is, in domains in which there are no Windows NT 
domain controllers present). That means you may not have the option to use network 
access policies until your Windows 2000, Windows Server 2003, Windows Server 
2008, and Windows Server 2008 R2 deployment is further along.  
 In the next section, you will learn how to conﬁ gure user access control.  
 Configuring User Access 
 In the previous chapter, you set up the server to accept incoming calls. Now it ’ s time to 
determine who can actually use the remote access services. You do this in two ways: 
 By setting up remote access proﬁ les on individual accounts  
 By creating and managing network access policies that apply to groups of users  
 This distinction is subtle but important because you manage and apply proﬁ les and 
policies in different places. 
 Setting Up User Profiles 
 Windows Server 2008 R2 stores a lot of information for each user account. Collectively, 
this information is known as the account ’ s  proﬁ le , and it ’ s normally stored in Active 
Directory. Some settings in the user ’ s proﬁ le are available through one of the two 
user - management snap - ins: 
 If your RRAS server is part of an Active Directory domain, the user proﬁ le settings are 
in the Active Directory Users and Computers snap - in.  
 If your RRAS server is  not part of an Active Directory domain, the user proﬁ le settings 
are in the Local Users and Groups snap - in.  
■
■
■
■
■
■
Configuring User Access 
687

688 
Chapter 16 ■ Managing Security for Remote Access Services
 In either case, the interesting part of the proﬁ le is the Dial - In tab of the user ’ s Properties 
dialog box (see Figure 16.1). This tab has a number of controls that regulate how the user 
account can be used for dial - in access.  
 F I G U R E 16 .1 The Dial - In tab of the user ’ s Properties dialog box 
 These controls include the following:  
  Network Access Permission Control Group   The ﬁ rst, and probably most familiar, 
controls on this tab are in the Network Access Permission control group. These options 
control whether the user has dial - in permission. Windows Server 2008 has a new feature: 
In addition to explicitly allowing or denying access, you can control access through 
Network Access Protection (NAP).  
  Verify Caller - ID Check Box   RRAS can verify a user ’ s caller ID information and use the 
results to allow or deny access. When you check the Verify Caller - ID check box and enter 
a phone number in the ﬁ eld, you ’ re telling RRAS to reject a call from anyone who provides 
that username and password but whose caller ID information doesn ’ t match what you 
enter. This means the user can call in only from a single phone number.  
  Callback Options Control Group   The Callback Options control group gives you three 
choices for regulating callback: 
 No Callback (the default setting) means the server will never honor callback 
requests from this account.  
■

 Set By Caller allows the calling system to specify a number at which it wants to 
be called back. The RRAS server will call the client back at that number.  
 Always Callback To allows you to enter a number that the server will call back 
no matter from where the client is actually calling. This option is less ﬂ exible but 
more secure than the Set By Caller option.  
 Assign Static IP Addresses Check Box   If you want this user to always get the same static 
IP address, you can arrange it by selecting the Assign Static IP Addresses check box and 
then entering the desired IP address. This allows you to set up nondynamic DNS records 
for individual users, guaranteeing that their machines will always have a valid DNS entry. 
On the other hand, this can be more prone to typographical errors on setup than the 
dynamic DNS - DHCP combination you could be using instead.  
 Apply Static Routes Check Box   In an ordinary LAN, you don ’ t have to do anything 
special to clients to enable them to route packets — just conﬁ gure them with a default 
gateway, and the gateway handles the rest. For dial - up connections, though, you may want 
to deﬁ ne a list of static routes that will enable the remote client to reach hosts on your 
network, or elsewhere, without requiring that packets be sent to a gateway in between. 
Depending on the remote access server, though, the client may be able to use Address 
Resolution Protocol (ARP) for local devices too. If you want to deﬁ ne a set of static routes 
on the client, you ’ ll have to do it manually. If you want to assign static routes on the server, 
select the Apply Static Routes check box, and then use the Static Routes button to add and 
remove routes as necessary.  
 Remember that these settings apply to individual users, so you can assign 
different routes, caller ID, or callback settings to each user. 
 Using Network Access Policies 
 Windows Server 2008 R2 includes support for two additional conﬁ guration systems: 
 Network access policies (which used to be called  remote access policy ) 
 Remote access proﬁ les (covered later in this chapter)  
 Policies determine who can and cannot connect; you deﬁ ne rules with conditions that 
the system evaluates to see whether a particular user can connect. 
 You can have any number of policies in a native Windows Server 2008 R2 domain; each 
policy must have exactly one proﬁ le associated with it.  
 Settings in an individual user ’ s profile override settings in a network 
access policy. 
■
■
■
■
Configuring User Access 
689

690 
Chapter 16 ■ Managing Security for Remote Access Services
 You manage network access policies through the Remote Access Logging and Policies 
folder in the RRAS snap - in. Policies contain conditions that you pick from a list. When a 
caller connects, the policy ’ s conditions are evaluated, one by one, to see whether the caller 
gets in. All the conditions in the policy must match for the user to gain access. If there are 
multiple policies, they ’ re evaluated according to an order you specify. 
 In the following sections, you will see how to create and conﬁ gure network access 
policies. 
 Network Policy Attributes 
 To create a policy, right - click the Remote Access Logging and Policies folder, and select 
Launch NPS (see Figure 16.2). Then right - click Network Policies, and choose New. This 
command starts the New Network Policy Wizard, which uses a series of steps to help you 
deﬁ ne the policy.  
 F I G U R E 16 . 2 The Launch NPS option in RRAS 
 The Select Condition dialog box (see Figure 16.3) is part of the New Network Policy 
Wizard. It lists the attributes that you can evaluate in a policy. Table 16.1 lists the 
attributes that you can set. These attributes are drawn from the RADIUS standards, so 
you can (and in some cases, should) intermix your Windows Server 2008 R2 RRAS servers 
with RADIUS servers.  

 When setting up any policies, you must base your policy on company 
rules and standards. Remember, policies can allow or restrict users from 
remotely accessing your network. The needs of the organization determine 
the policy and when to use it. 
 Once you choose an attribute and click the Add button, its corresponding editor 
appears. You use the editor to set the value of the attribute. For example, if you select the 
Day And Time Restrictions attribute, you ’ ll see the Time Of Day Constraints dialog box, a 
calendar grid that lets you select which days and times are available for logging on.  
 TA B L E 16 .1  Network Access Policy Attributes 
 Attribute Name  
  What It Specifies 
 Authentication Type  
  Specifies the authentication methods required to 
match this policy.  
 Allowed EAP Types  
  Specifies the EAP types required for client computer 
authentication method configuration to match this 
policy.  
 Called Station Id  
  Specifies the phone number of the remote access port 
called by the caller. 
 Calling Station Id  
  Specifies the caller ’ s phone number.  
 F I G U R E  16 . 3 Select Condition dialog box of New Network Policy Wizard 
Configuring User Access 
691

692 
Chapter 16 ■ Managing Security for Remote Access Services
 TA B L E 16 .1  Network Access Policy Attributes (continued) 
  Attribute Name  
  What It Specifies 
  Client Friendly Name  
  Specifies the name of the RADIUS server that ’ s 
attempting to validate the connection. 
  Client IP Address (IPv4 and IPv6)  
  Specifies the IP address of the RADIUS server that ’ s 
attempting to validate the connection. 
  Client Vendor  
  Specifies the vendor of the remote access server that 
originally accepted the connection. This is used to set 
different policies for different hardware. 
  Day And Time Restrictions  
  Specifies the weekdays and times when connection 
attempts are accepted or rejected. 
  Framed Protocol  
  Specifies the protocol to be used for framing incoming 
packets (for example, PPP, SLIP, and so on).  
  HCAP (Host Credential 
Authorization Protocol) User 
Groups  
 Used for communications between NPS 
and some third - party network access 
servers (NAS).  
  Location Groups  
 Specifies the HCAP location groups required to match 
this policy. This is used for communications between 
HCAP and some third - party network access servers 
(NAS).  
  MS RAS Vendor  
  Specifies the vendor identification number of the 
network access server (NAS) that is requesting 
authentication.  
  NAS Identifier  
  Specifies the friendly name of the remote access 
server that originally accepted the connection. 
  NAS IP Address (IPv4 and IPv6)  
  Specifies the IP address of the remote access server 
that originally accepted the connection. 
  NAS Port Type  
  Specifies the physical connection (for example, ISDN, 
POTS) used by the caller. 
  Service Type  
  Specifies Framed or Async (for PPP) or login (Telnet).  
  Tunnel Type  
  Specifies which tunneling protocol should be used 
(L2TP or PPTP).  
   Windows Groups  
  Specifies which Windows groups are allowed access. 

 After you select an attribute and give it a value, you can add more attributes or move to 
the next page by clicking the Next button on the Select Condition page. 
 Once you ’ re ﬁ nished setting attributes, you arrive at the Specify Access Permission page 
of the wizard. This page has only two radio buttons — Grant Remote Access Permissions 
and Deny Remote Access Permissions — which specify whether the policy you create  allows 
users to connect or  prevents users from connecting. The page also includes an Access Is 
Determined By User Dial - In Properties check box. If this box is checked and there is a 
conﬂ ict between the network policy and user dial - in properties, the user dial - in properties 
take precedence. 
 Creating a Network Access Policy 
 In Exercise 16.1, you ’ ll create an adjunct policy that adds time and day restrictions to the 
default policy. (An adjunct policy is used in conjunction with another policy.) This exercise 
requires you to be in Windows 2000 Native, Windows Server 2003, Windows Server 2008, 
or Windows Server 2008 R2 domain functional level, and you must have completed the 
exercises in Chapter 15,  “ Managing Remote Access Services. ” 
 E X E R C I S E  1 6 .1
Creating a Network Access Policy  
 1. 
  Open the RRAS MMC snap - in by selecting Start   Administrative Tools   Routing And 
Remote Access. 
 2. 
  Expand the server you want to conﬁ gure in the left pane of the MMC. 
 3. 
  Right - click the Remote Access Logging And Policies folder.  
 4. 
  Right - click, and then select Launch NPS. 
 5. 
  Once the Network Policy Server page appears, right - click Network Policies and then 
choose New.  
 6. 
  The New Network Policy Wizard starts. In the Policy Name box, enter  Test Policy and 
then click Next (leave the other settings as they are). 
 7. 
  On the Specify Conditions page, click the Add button. 
 8. 
  In the Select Condition dialog box, scroll down, and click Day And Time Restrictions. 
Next click Add. 
 9. 
  The Time Of Day Constraints dialog box appears. Use the calendar controls to allow 
remote access Monday through Saturday from 7 a.m. to 7 p.m. and then click the OK 
button.  
 10.   The Select Conditions dialog box reappears, this time with the new condition listed. 
Click the Next button. 
Configuring User Access 
693

694 
Chapter 16 ■ Managing Security for Remote Access Services
E X E R C I S E  1 6 .1  (c o n t i n u e d)
 11.   The Specify Access Permission page appears. Select the Access Granted radio button, 
and click Next to continue.  
 12.   Next the Conﬁ gure Authentication Methods page appears. This page is where you 
choose which authentication methods will be used for this connection. Make sure that 
MS - CHAP and MS - CHAPv2 are both checked along with the check boxes associated 
with them. Click Next. 
 13.   The Conﬁ gure Constraints page appears. Under Constraints, click Session Timeout. On 
the right side, click the Disconnect After The Following Maximum Session Time box, 
and type  60 in the ﬁ eld (the value represents minutes). Click Next.  
 14.   The Conﬁ gure Settings page appears. This page allows you to conﬁ gure any additional 
settings for this network policy. Click Next. 
 15.   On the Completing New Network Policy page, click Finish.  
 Using Remote Access Profiles 
 Remote access proﬁ les are an integral part of network access policies. Proﬁ les determine 
what happens during call setup and completion. Each policy has a proﬁ le associated 
with it; the proﬁ le determines what settings will be applied to connections that meet the 
conditions stated in the policy. 
 For security reasons, it ’ s usually a good idea to limit access to the administrative 
accounts on your network. In particular, as consultants, we usually tell clients to restrict 
remote access for the Administrator account; that way, the potential exposure from a 
dial - up compromise is reduced. In Exercise 16.2, you will learn how to conﬁ gure the 
Administrator account ’ s user proﬁ le to restrict dial - up access.  
 E X E R C I S E  1 6 . 2
Restricting a User Proﬁ le for Dial - In Access 
 1. 
  Log on to your computer using an account that has administrative privileges.  
 2. 
  If you ’ re using an RRAS server that ’ s part of an Active Directory domain, open the Active 
Directory Users and Computers snap - in by selecting Start   Administrative Tools   
Active Directory Users And Computers. If not, open the Local Users and Groups snap - in 
by selecting Start   Administrative Tools   Computer Management   Local Users And 
Groups.  
 3. 
  Expand the tree to the Users folder. Right - click the Administrator account in the right 
pane, and choose Properties. The Administrator Properties dialog box appears.  

 4. 
  Switch to the Dial - In tab. On machines that participate in Active Directory, make sure the 
Control Access Through NPS Network Policy option (in the Permissions group) is selected.  
 5. 
  Click the Deny Access radio button to prevent the use of this account over a dial - in 
connection.  
 6. 
  Click the OK button. 
 You can create one proﬁ le for each policy. The proﬁ le contains settings that ﬁ t into 
speciﬁ c areas; each area has its own link in the proﬁ le ’ s Properties dialog box. 
 The Constraints Tab 
 The Constraints tab has most of the settings that you think of when you consider dial - in 
access controls. The controls here allow you to adjust how long the connection can be 
idle before it gets dropped, how long it can be up, the dates and times for establishing the 
connection, and what dial - in port and medium can be used to connect.  
 Authentication Link 
 In the Authentication Methods pane (see Figure 16.4), you can specify which authentication 
methods are allowed on this speciﬁ c policy. Note that these settings, like the other policy 
 F I G U R E 16 . 4 Authentication Methods settings 
Configuring User Access 
695

696 
Chapter 16 ■ Managing Security for Remote Access Services
settings, will be useful only if the server ’ s settings match. For example, if you turn EAP 
authentication off in the server ’ s Properties dialog box, turning it on in the Authentication 
Methods pane of the proﬁ le ’ s Properties dialog box will have no effect.  
 You ’ ll notice that each authentication method has a check box. Check the appropriate 
boxes to control the protocols that you want this proﬁ le to use. If you enable EAP, you can 
also choose which speciﬁ c EAP type you want the proﬁ le to support. You can also choose 
to allow totally unauthenticated access (which is unchecked by default).  
 Settings Tab 
 The Settings tab of the policy ’ s Properties dialog box has several useful sections, described 
in the following list:  
  IP Settings Pane   The IP Settings pane (see Figure 16.5) gives you control over the 
IP - related settings associated with an incoming call. If you think back to the server - speciﬁ c 
settings covered in Chapter 15, you ’ ll remember that the server preferences include settings 
for protocols other than IP; this is not so in the network access proﬁ le. In this pane, you 
can specify where the client gets its IP address.  
  Multilink And Bandwidth Allocation Protocol (BAP) Pane   The proﬁ le mechanism gives 
you a degree of control over how the server handles multilink calls; you exert this control 
through the Multilink And Bandwidth Allocation Protocol (BAP) pane of the proﬁ le 
Properties dialog box (see Figure 16.6). Your ﬁ rst choice is to decide whether to allow 
 F I G U R E 16 . 5 IP Settings pane of the Settings tab 

multilink calls at all and, if so, how many ports you want to let a single client use at once. 
Normally, this setting is conﬁ gured so that the server - speciﬁ c settings take precedence, but 
you can override them. 
 Bandwidth Allocation Protocol Group   The Bandwidth Allocation Protocol control group 
gives you a way to control what happens during a multilink call when the bandwidth usage 
drops below a certain threshold. For example, why tie up three analog lines to provide 
168 Kbps of bandwidth when the connection is using only 56 Kbps? You can tweak the 
capacity and time thresholds; by default, a multilink call will drop one line every time 
the bandwidth usage falls to less than 50 percent of the available bandwidth and stays there 
for two minutes. The Require BAP For Dynamic Multilink Requests check box allows you 
to refuse calls from clients that don ’ t support BAP; this is an easy way to make sure that no 
client can hog your multilink bandwidth.  
 Encryption Pane   The Encryption pane of the Settings tab (see Figure 16.7) controls which 
type of encryption you want your remote users to be able to access. The following radio 
buttons are on the Encryption pane: 
 Basic Encryption (MPPE 40 - Bit) means single Data Encryption Standard (DES) 
for IPSec or 40 - bit Microsoft Point - to - Point Encryption (MPPE) for Point - to - Point 
Tunneling Protocol (PPTP).  
■
 F I G U R E 16 .6 The Multilink And Bandwidth Allocation Protocol (BAP) pane of the 
Settings tab 
Configuring User Access 
697

698 
Chapter 16 ■ Managing Security for Remote Access Services
 Strong Encryption (MPPE 56 - Bit) means 56 - bit encryption (single DES for IPSec; 
56 - bit MPPE for PPTP).  
 Strongest Encryption (MPPE 128 - Bit) means triple DES for IPSec or 128 - bit MPPE for 
PPTP connections.  
 No Encryption allows users to connect using no encryption at all. Unless this button is 
selected, a remote connection must be encrypted, or it ’ ll be rejected.  
■
■
■
 F I G U R E 16 .7 Encryption pane of the Settings tab of the policy ’ s Properties dialog box 
 In Exercise 16.3, you ’ ll force all connections to your server to use encryption. Any client 
that can ’ t use encryption will be dropped. You must complete Exercise 16.1 before you do 
this exercise. 
 Don ’ t do this exercise on your production RRAS server unless you ’ re sure 
that all your clients are encryption capable.  
 E X E R C I S E  1 6 . 3
Conﬁ guring Encryption  
 1. 
  Open the RRAS MMC snap - in by selecting Start   Administrative Tools   Routing And 
Remote Access. 
 2. 
  Expand the server you want to conﬁ gure in the left pane of the MMC. 
 3. 
  Right - click the Remote Access Logging And Policies folder.  
 4. 
  Select Launch NPS. 
 5. 
  Once the Network Policy Server page appears, click the hours policy you created in 
Exercise 16.1 (we named ours Test Policy).  

 6. 
  Select Action   Properties. The policy ’ s Properties dialog box appears. 
 7. 
  Click the Settings tab. Select Encryption in the left pane.  
 8. 
  In the right pane, uncheck the No Encryption check box. Make sure that the Basic, 
Strong, and Strongest check boxes are all selected.  
 9. 
  Click the OK button. When the policy Properties dialog box reappears, click 
the OK button.  
 Setting Up a VPN Network Access Policy 
 Earlier in this chapter, you learned how to use the Network Access Policy mechanism on a 
Windows Server 2008 R2 domain. Now it ’ s time to apply what you ’ ve learned to a virtual 
private network (VPN). Recall that you have two ways to control which speciﬁ c users can 
access a remote access server: 
 You can grant and deny dial - up permission to individual users in each user ’ s Properties 
dialog box.  
 You can create a network access policy that embodies whatever restrictions you want 
to impose.  
 It turns out that you can do the same thing for VPN connections, but there are a few 
additional things to consider. 
 Granting and Denying Per - User Access 
 To grant or deny VPN access to individual users, all you have to do is make the appropriate 
change on the Dial - In tab of each user ’ s Properties dialog box. Although this is the easiest 
method to understand, it gets tedious quickly if you need to change VPN permissions for 
more than a few users. Furthermore, this method offers you no way to distinguish between 
dial - in and VPN permissions.  
 Creating a Network Access Policy for VPNs 
 You may ﬁ nd it helpful to create network access policies that enforce the permissions you 
want end users to have. You can accomplish this result in a number of ways; which one you 
use will depend on your overall use of network access policies. 
 The simplest way is to create a policy that allows all your users to use a VPN. Earlier 
in this chapter, you learned how to create network access policies and specify settings 
for them; one thing you may have noticed was that there ’ s a NAS - Port - Type attribute 
that you can use in the policy ’ s conditions. That attribute is the cornerstone of building a 
policy that allows or denies remote access via VPN, because you use it to accept or reject 
connections arriving over a particular type of VPN connection. For best results, you ’ ll use 
the Tunnel - Type attribute in conjunction with the NAS - Port - Type attribute, as described 
in Exercise 16.4.  
■
■
Configuring User Access 
699

700 
Chapter 16 ■ Managing Security for Remote Access Services
 E X E R C I S E  1 6 . 4
Creating a VPN Network Access Policy  
 1. 
  Open the RRAS MMC snap - in by selecting Start   Administrative Tools   Routing And 
Remote Access. 
 2. 
  Expand the server you want to conﬁ gure in the left pane of the MMC. 
 3. 
  Right - click the Remote Access Logging And Policies folder.  
 4. 
  Select Launch NPS. 
 5. 
  Once the Network Policy Server page appears, right - click Network Policies, and 
choose New. 
 6. 
  The New Network Policy Wizard starts. In the Policy Name box, enter  VPN Network 
Policy , and click Next (leave the other settings as they are).  
 7. 
  On the Specify Conditions page, click the Add button. 
 8. 
  On the Select Condition page, scroll down, click NAS - Port - Type Attribute, and click Add. 
When the NAS Port Type page appears, click Virtual VPN in the Common Dial - Up And 
VPN Tunnel Types box. Click OK, and then click the Next button. 
 9. 
  The Specify Conditions page reappears, this time with the new condition listed. Click 
the Next button. 
 10.   The Specify Access Permission page appears. Select the Access Granted radio button, 
and click Next to continue.  
 11.   Next the Conﬁ gure Authentication Methods page will appear. This page is where you 
choose which authentication methods will be used for this connection. Make sure that 
MS - CHAP and MS - CHAPv2 are both checked along with their associated check boxes. 
Click Next. 
 12.   The Conﬁ gure Constraints page appears. Under Constraints, click Session Timeout. On 
the right side, click the Disconnect After The Following Maximum Session Time box, 
and type  60 in the box (the value speciﬁ es minutes). Click Next. 
 13.   The Conﬁ gure Settings page appears. This page allows you to conﬁ gure any additional 
settings for this network policy. Click Next. 
 14.   At the Completing New Network Policy page, click Finish.  
 If you don ’ t want to grant VPN access to everyone, you can make some changes to the 
process in Exercise 16.4 to ﬁ ne - tune it. First, you ’ ll probably want to move the VPN policy 
to the top of the list. (When you ﬁ rst add the policy described in the exercise, it is placed at 
the end of the policy list. Unless you move it, the default policies will take effect before the 
VPN - speciﬁ c policy does.) 
 Second, you can create an Active Directory group and put your VPN users in it. You can 
then create a policy using the two conditions outlined in Exercise 16.4 plus a condition that 

uses the Windows - Groups attribute to specify the new group. You can also use this process 
to allow everyone dial - up access and reserve VPN capability for a smaller group.  
 Connection Manager 
 To help administrators create and manage remote access connections, Microsoft includes 
within Windows Server 2008 R2 a suite of components called Connection Manager. 
Connection Manager is not installed by default. You can install the Connection Manager 
by using Server Manager   Add Roles   Network Access Services. 
 Connection Manager allows an administrator to create remote access connections called 
 service proﬁ les . These proﬁ les then appear on client machines as network connections. You 
can use these network connections to connect client machines to VPNs or remote networks.   
 Configuring Security 
 When conﬁ guring remote access security, you must consider several aspects, the most 
fundamental of which involves conﬁ guring the types of authentication and encryption the 
server will use when accepting client requests. We will look at each of these in the following 
sections. 
 Controlling Server Security 
 The Security tab of the server ’ s Properties dialog box (see Figure 16.8) allows you to specify 
which authentication and accounting methods RRAS uses. You can choose one of two 
authentication providers by using the Authentication Provider drop - down list.  
 F I G U R E  16 . 8 The Security tab of the RRAS server ’ s Properties dialog box 
Configuring Security 
701

702 
Chapter 16 ■ Managing Security for Remote Access Services
 Your choices include the following: 
 Windows Authentication, a built - in authentication suite included with Windows Server 
2008 R2  
 RADIUS Authentication, which allows you to send all authentication requests heard by 
your server to a RADIUS server for approval or denial  
 You can also use the Accounting Provider drop - down list on the Security tab to choose 
between the following: 
 Microsoft - Developed Accounting, in which connection requests are maintained in the 
event log  
 RADIUS Accounting, in which all accounting events such as call start and call stop are 
sent to a RADIUS server for action  
 RADIUS Authentication Settings 
 When you select the RADIUS Authentication option from the Authentication Provider 
drop - down menu, you are enabling a RADIUS client that passes authentication duties to a 
RADIUS server. This communication is sent via UDP on port 1645 or 1812, depending on 
the version of RADIUS being used. 
 Click the Conﬁ gure button to open the RADIUS Authentication dialog box. From here, 
you can set the following options: 
 Click the Add button to add the name or address of a RADIUS server to which the 
RAS server will pass authentication duties.  
 You must also enter the correct secret, which is initially set by the RADIUS server.  
 The Time - Out option determines how long the RRAS server will attempt to 
authenticate the remote user before giving up.  
 The Initial Score option is similar to the cost value used by routers. The RAS server 
will attempt to authenticate users on the RADIUS server with the highest score ﬁ rst. 
If that attempt fails, the RAS server will use the RADIUS server with the next highest 
score, and so on.  
 Although the Port option can be changed, the default setting is part of RFC 2866, 
 “ RADIUS Accounting, ” and should not be altered unless extraordinary circumstances 
call for it.  
 The Internet Assigned Numbers Authority (IANA) is the official 
source for port number assignment. You can view current 
port number assignments and other valuable information at 
 www.iana.org/assignments/port-numbers . 
■
■
■
■
■
■
■
■
■

 Windows Authentication Settings 
 Select the Windows Authentication option from the Authentication Provider 
drop - down menu if you want the local machine to authenticate your remote access users. 
To conﬁ gure the server by telling it which authentication methods you want it to use, 
click the Authentication Methods button, which displays the Authentication Methods 
dialog box (see Figure 16.9). If you look at the list of authentication protocols earlier 
in the chapter, you ’ ll ﬁ nd that each one has a corresponding check box here: EAP, 
MS - CHAPv2, CHAP, and PAP. You can also turn on unauthenticated access by checking 
the Allow Remote Systems To Connect Without Authentication box, but that is not 
recommended because it allows anyone to connect to, and use, your server (and thus by 
extension your network). 
 There ’ s actually a special set of requirements for using CHAP because it requires access 
to each user ’ s encrypted password. Windows Server 2008 R2 normally doesn ’ t store user 
passwords in a format that CHAP can use, so you have to take some additional steps if you 
want to use CHAP: 
 1. 
 Enable CHAP at the server and policy levels.  
 2. 
  Edit the default domain GPO ’ s Password Policy object to turn on the Store Password 
Using Reversible Encryption policy setting (see Figure 16.10).  
 3. 
  Change or reset each user ’ s password, which forces Windows Server 2008 R2 to store 
the password using reversible encryption.  
 After these steps are completed for an account, that account can be used with CHAP.  
 F I G U R E 16 . 9  Authentication Methods dialog box 
Configuring Security 
703

704 
Chapter 16 ■ Managing Security for Remote Access Services
 These steps aren ’ t required for MS - CHAPv2; for that protocol, you just 
enable MS - CHAPv2 at the server and policy levels.  
 Configuring Network Access Protection 
 Another way you can have security is to allow users to access resources based on the 
identity of the client computer. This new security solution is called Network Access 
Protection (NAP). Determined by the client needs, network administrators now have 
the ability to determine granular levels of network access using NAP. NAP also allows 
administrators to determine client access based on compliancy with corporate governance 
policies. The following are some of the NAP features:  
  Network Layer Protection   Network layer protection is the ability to secure 
communications at the Network layer of the OSI model. 
 F I G U R E 16 .10 The default domain GPO ’ s Password Policy 

 As explained in Chapter 11,  “ Understanding Windows Server 2008 R2 Networking, ” 
all communications travel through the seven layers of the OSI model. Starting at the top 
(layer 7), the seven layers are the Application, Presentation, Session, Transport, Network, 
Data - Link, and Physical layers.  
 DHCP Enforcement   If a computer wants to receive unlimited IPv4 network access, the 
computer must be compliant with corporate governance policies. DHCP enforcement 
veriﬁ es that a computer is compliant before granting unlimited access. If a computer is 
noncompliant, the computer receives an IPv4 address that has limited network access and a 
default user proﬁ le. 
 When a client computer attempts to receive an IP address from DHCP, the DHCP 
enforcement checks the health policy requirements of the system to make sure they meet 
the compliancy.  
 VPN Enforcement   VPN enforcement works a lot like DHCP enforcement except that 
VPN enforcement veriﬁ es the compliancy of the system before the VPN connection is given 
full access to the network.  
 IPsec Enforcement   IPsec enforcement will allow a computer to communicate with other 
computers as long as the computers are IPsec compliant. You have the ability to conﬁ gure 
the requirements for secure communications between the two compliant computer systems. 
You can conﬁ gure the IPsec communications based on IP address or TCP/UDP port 
numbers.  
 802.1X Enforcement   For a computer system to have 802.1X unlimited access to network 
connections (Ethernet 802.11 or wireless access point), the computer system must be 
802.1X compliant. 802.1X enforcement veriﬁ es that the connecting system is 802.1X 
connection compliant. Noncompliant computers will obtain only limited access to 
network connections.  
 Flexible Host Isolation   Flexible host isolation allows a server and domain to isolate 
computers to help make it possible to design a layer of security between computers or 
networks. Even if a hacker gains access to your network using an authorized username and 
password, the server and domain isolation can stop the attack because the computer is not 
an authorized domain computer.  
 Multi - configuration System Health Validator   This feature allows you to specify multiple 
conﬁ gurations of a System Health Validator (SHV). When an administrator conﬁ gures 
a network policy for health evaluation, the administrator will select a speciﬁ c health 
policy. Using this feature allows you to specify different network policies for different 
sets of health requirements based on a speciﬁ c conﬁ guration of the SHV. For example, 
an administrator can create a network policy that speciﬁ es that all internal computers 
must have antivirus software enabled and a different network policy that speciﬁ es that 
VPN - connected computers must have their antivirus software enabled and signature 
ﬁ les up - to - date.  
Configuring Security 
705

706 
Chapter 16 ■ Managing Security for Remote Access Services
 Configuring Windows Firewall Options 
 Before we can start talking about ﬁ rewall options, you must ﬁ rst understand what a 
ﬁ rewall does. A  ﬁ rewall is a software or hardware device that checks the information 
that is received from an outside (Internet) or external network and determines from that 
information whether the packet is accepted or declined. 
 Depending on the ﬁ rewall, you have the ability to check all potential remote users 
against Active Directory to verify that the remote user has an authorized domain account. 
This process is called Active Directory  account integration . 
 Microsoft Windows Server 2008 R2 has a built - in ﬁ rewall. The following are some of 
the conﬁ guration options included in the Windows Firewall Settings dialog box:  
  Windows Firewall Settings — General Tab  On the Windows Firewall Settings dialog box ’ s 
General tab, you have the ability to turn the ﬁ rewall on and off. When turning the ﬁ rewall 
on, you also have the ability to block all incoming trafﬁ c (see Figure 16.11). This stops all 
trafﬁ c from accessing your server.  
 F I G U R E 16 .11 General tab of Windows Firewall Settings 
  Windows Firewall Settings — Exceptions Tab   The Exceptions tab gives you the ability to 
exclude applications from the ﬁ rewall settings (see Figure 16.12).  
 If you enable the ﬁ rewall, this tab gives you the following options: 
 You can allow certain applications to continue to access the ﬁ rewall.  
 You also have the ability to add programs to the exceptions.  
■
■

 You also have the ability to do trafﬁ c ﬁ ltering by ports and protocols (explained in the 
next section).  
 Finally, you have the ability to see the properties of any of the applications you exclude.  
 Traffic Filtering   When setting up the Microsoft Windows Server 2008 ﬁ rewall, the 
administrator has the ability to ﬁ lter trafﬁ c by ports and by protocols (see Figure 16.13).  
■
■
 F I G U R E 16 .12 Exceptions tab of Windows Firewall Settings 
 F I G U R E  16 .13 Add A Port dialog box of Windows Firewall 
Configuring Windows Firewall Options 
707

708 
Chapter 16 ■ Managing Security for Remote Access Services
  Windows Firewall Settings — Advanced Tab   The Windows Firewall Settings dialog 
box ’ s Advanced tab allows you to choose the network connection you want to enable for 
the ﬁ rewall (see Figure 16.14). For example, if you have multiple network cards, you can 
choose to which connections the ﬁ rewall settings will apply.  
 Windows Firewall with Advanced Security 
 Windows Server 2008 R2 takes ﬁ rewalls a step further than just the normal ﬁ rewall 
settings in the control panel. An MMC snap - in called Windows Firewall with Advanced 
Security (see Figure 16.15) can block all incoming and outgoing connections based on its 
conﬁ guration. 
 One of the major advantages to using the Firewall with Advanced Security snap - in is the 
ability to set ﬁ rewall conﬁ gurations on remote computers using group policies. 
 Another advantage to using this MMC is the ability to set up ﬁ rewalls using IPsec 
security. The Firewall with Advanced Security snap - in allows an administrator to set more 
in - depth rules for Microsoft Active Directory users and groups, source and destination 
Internet Protocol (IP) addresses, IP port number, ICMP settings, IPsec settings, speciﬁ c 
types of interfaces, and services.  
 F I G U R E 16 .14 Advanced tab of Windows Firewall Settings 

 You can conﬁ gure more advanced settings by conﬁ guring Windows Firewall with 
Advanced Security (WFAS). To access Windows Firewall with Advanced Security, 
click Start   Control Panel   Large Icons View   Windows Firewall and then click the 
Advanced Settings link. 
 The scope pane to the left shows that you can set up speciﬁ c inbound and outbound 
rules, connection security rules, and monitoring rules. The central area shows an overview 
of the ﬁ rewall ’ s status, as well as the current proﬁ le settings. Let ’ s take a look at these in 
more detail. 
 Inbound and Outbound Rules 
 Inbound and outbound rules consist of many preconﬁ gured rules that can be enabled 
or disabled. Obviously, inbound rules (see Figure 16.16) monitor inbound trafﬁ c, and 
outbound rules monitor outbound trafﬁ c. By default, many are disabled. Double - clicking a 
rule will bring up its Properties dialog box, as shown in Figure 16.17.  
 F I G U R E 16 .15 Windows Firewall with Advanced Security snap - in 
Configuring Windows Firewall Options 
709

710 
Chapter 16 ■ Managing Security for Remote Access Services
 F I G U R E 16 .16 Inbound Rules 
 F I G U R E 16 .17 An inbound rule ’ s Properties dialog box 

 You can ﬁ lter the rules to make them easier to view. Filtering can be performed based on 
the proﬁ le the rule affects, whether the rule is enabled or disabled, or based on the rule group. 
 If you can ’ t ﬁ nd a rule that is appropriate for your needs, you can create a new rule 
by right - clicking Inbound Rules or Outbound Rules in the scope pane and then selecting 
New Rule. The New Inbound (or Outbound) Rule Wizard will launch, and you will be 
asked whether you want to create a rule based on a particular program, protocol or port, 
predeﬁ ned category, or custom settings. 
 Exercise 16.5 will walk you through the steps needed to create a new inbound rule 
that will allow only encrypted TCP trafﬁ c. In this exercise you will have the ability to 
create a custom rule and then specify which authorized users and computers can connect 
using this rule.  
 E X E R C I S E  1 6 . 5
Conﬁ guring Windows Firewall  
 1. 
  Select Start   Control Panel   Large Icon View   Windows Firewall. 
 2. 
  Click Advanced Settings on the left - hand side. 
 3. 
  Right - click Inbound Rules and select New Rule.  
 4. 
  Choose a rule type. For this exercise, choose Custom so that you can see all the options 
available to you; then click Next.  
 5. 
  Choose the programs or services that are affected by this rule. For this exercise, 
choose All Programs; then click Next. 
 6. 
  Choose the protocol type, as well as the local and remote port numbers that are 
affected by this rule. For this exercise, choose TCP, and ensure that All Ports is selected 
for both Local Port and Remote Port. Click Next to continue.  
 7. 
  Choose the local and remote IP addresses that are affected by this rule. Choose Any IP 
Address for both local and remote; then click Next. 
 8. 
  Specify whether this rule will allow the connection, allow the connection only if it is 
secure, or block the connection. Select the option Allow The Connection If It Is Secure; 
then click Next.  
 9. 
  Specify whether connections should be allowed only from certain users. You can 
experiment with these options if you want. Then click Next to continue.  
 10.   Specify whether connections should be allowed only from certain computers. Again 
you can experiment with these options if you want. Then click Next to continue.  
 11.   Choose which proﬁ les will be affected by this rule. Select one or more proﬁ les and click 
Next to continue. 
 12.   Give your proﬁ le a name and description; then click Finish. Your custom rule will appear 
in the list of Inbound Rules, and the rule will be enabled.  
Configuring Windows Firewall Options 
711

712 
Chapter 16 ■ Managing Security for Remote Access Services
E X E R C I S E  1 6 . 5  (c o n t i n u e d)
 13.   Double - click your newly created rule. Notice that you can change the options that you 
previously conﬁ gured.  
 14.   Disable the rule by right - clicking the rule and choosing Disable Rule.  
 15.   Close Windows Firewall.  
 Now let ’ s take a look at setting up Connection Security Rules through Windows 
Firewall with Advanced Security.  
 Connection Security Rules 
 Connection Security Rules are used to conﬁ gure how and when authentication occurs. 
These rules do not speciﬁ cally allow connections; that ’ s the job of inbound and outbound 
rules. You can conﬁ gure the following connection security rules (see Figure 16.18): 
 Program: Rules that control connections for a program  
 Port: Rules that control connections for a TCP or UDP port  
 Predeﬁ ned: Rules that control connections for a Windows experience  
 Custom  
■
■
■
■
 F I G U R E 16 .18 Connection Security Rules 

 The ﬁ nal section we will look at for Windows Firewall with Advanced Security is the 
Monitoring Section.  
 Configuring Windows Firewall with a GPO 
 If you wanted to conﬁ gure Windows Firewall on all of your client machines, you have 
two options. You can either manually conﬁ gure each machine or set up a GPO to 
conﬁ gure your Windows Firewall. To set up a GPO for Windows Firewall, conﬁ gure 
the Computer section   Windows Settings   Security   Windows Firewall With 
Advanced Security.  
 Import/Export Policies 
 One advantage of conﬁ guring Windows Firewall is the ability to export and import 
policy settings. For example, we set up a policy for 35 machines; we created the policy 
on one of the 35 machines and then exported the policy. We then imported the policy to 
the other 34 machines, and we did not have to re - create the policy over and over again. 
To export a policy, right - click Windows Firewall With Advanced Security and choose 
Export Policy (see Figure 16.19). Choose Import Policy on the other machines to import 
the policy.  
 F I G U R E 16 .19 Export and Import options 
Configuring Windows Firewall Options 
713

714 
Chapter 16 ■ Managing Security for Remote Access Services
 IPSec Policy Settings in Windows Firewall 
 When conﬁ guring options for Windows Firewall with Advanced Security, you have the 
ability to conﬁ gure some IPsec policies. The three options are: 
 IPsec defaults: Specify settings used by IPsec to establish secure connections.  
 IPsec exemptions: Exempting ICMP from all IPsec requirements can simplify 
troubleshooting of network connectivity issues.  
 IPsec tunnel authorization: Specify the computers or users that are authorized to 
establish IPsec tunnel connections to this computer.  
 Monitoring 
 The Monitoring section shows detailed information about the ﬁ rewall conﬁ gurations 
for the Domain Proﬁ le, Private Proﬁ le, and Public Proﬁ le settings. These network location 
proﬁ les determine which settings are enforced for private networks, public networks, and 
networks connected to a domain.    
■
■
■
 Firewalls 
 When doing consulting, it always make me laugh when I see small to midsize companies 
using Microsoft Windows Firewalls and no other protection. 
 Microsoft Windows Firewalls should be your  last line of defense. You need to make sure 
that you have good hardware ﬁ rewalls that separate your network from the world. 
 Also watch Windows Firewalls when it comes to printing. I have run into many situations 
where a printer that needs to talk to the operating system has issues when Windows 
Firewall is enabled. If this happens, make sure that the printer is allowed in the Allowed 
Programs section. 
 Troubleshooting Techniques 
 When you ’ re troubleshooting authentication, use the same logical approach you would use 
when troubleshooting any computer or network problem: 
 Is the problem being reported by one user, a group of similar users, or all users?  
 Can you independently verify the problem by dialing in or attempting what the users 
are attempting?  
 If you can verify the problem, what events are you seeing in Event Viewer?  
 If Event Viewer doesn ’ t show any problems, what does Network Monitor or 
tracing show?  
■
■
■
■

 These are just some of the things you can do when troubleshooting remote access. Let ’ s 
look at an example. 
 This example describes some troubleshooting tips for a RADIUS server running NPS 
on Windows Server 2008 R2. It will use a RADIUS test client that is part of the 
FreeRADIUS package that runs on Linux. Similar software is available for Windows, 
and FreeRADIUS may run on Windows too. 
 In this example, attempting to authenticate with a RADIUS Access - Request for an 
account that exists on the local server was resulting in a failure. Speciﬁ cally, the following 
Access - Reject message was generated: 
rad_recv: Access-Reject packet from host 192.168.1.64:1812, id=225, length=20  
 Tracking down this issue led ﬁ rst to Event Viewer, where a number of warning messages 
were available related to NPS. These messages are not particularly helpful, so we elected to 
enable logging for NPS. Within the NPS management console, the NPS Accounting folder 
offers two options — Local File Logging and SQL Server Logging — as shown in Figure 16.20. 
 With logging enabled, you can generate additional authentication requests. The resulting 
log ﬁ le was placed in the location speciﬁ ed with the Local File Properties, which by default 
is  C:\Windows\System32\LogFiles\ . 
 You can further troubleshoot a problem like this by using a sniffer program such as 
Network Monitor or a program such as TCPDump or WinDump in order to analyze the 
network trafﬁ c as it is sent and received.  
 F I G U R E 16 . 2 0 NPS Accounting folder in the Network Policy Server console 
Troubleshooting Techniques 
715

716 
Chapter 16 ■ Managing Security for Remote Access Services
 Summary 
 In this chapter, you learned about remote access and authentication. You learned that the 
user authentication protocols included with Windows Server 2008 R2 are PAP, CHAP, 
MS - CHAPv2, Kerberos, NTLMv2, 802.1X, and EAP. You also learned that the Dial - In 
tab of a user ’ s Properties dialog box has a number of interesting controls that regulate how 
the user account may be used for dial - in access. 
 We covered how to use network access policies to determine who may and may not 
connect, as well as the process for deﬁ ning rules with conditions that the system evaluates 
to see whether a particular user can connect. You also learned about the Windows Firewall 
options and the Windows Firewall with Advanced Security MMC. We discussed the 
Network Access Protection (NAP) options and features. In addition, you learned how 
to use network access proﬁ les that contain settings that determine what happens during 
call setup and completion. Finally, you learned how to conﬁ gure which accounting and 
authentication methods RRAS uses.  
 Exam Essentials  
  Know how to use network access policies.   Policies determine who can and cannot 
connect; you deﬁ ne rules with conditions that the system evaluates to see whether a 
particular user can connect. You manage network access policies through the NPS snap - in. 
Policies contain conditions that you pick from a list. When a caller connects, the policy ’ s 
conditions are evaluated, one by one, to see whether the caller gets in.  
  Know how to use remote access profiles.   Each network access policy has a proﬁ le 
associated with it; the proﬁ le determines what settings will be applied to connections that 
meet the conditions stated in the policy. The settings ﬁ t into distinct areas, and each area 
has its own tab or link in the proﬁ le ’ s Properties dialog box.  
  Know how to configure remote access security.   Several different aspects are involved with 
remote access security conﬁ guration, the most fundamental of which involves conﬁ guring 
the types of authentication and encryption the server will use when accepting client 
requests. You can choose one of two authentication providers by using the Authentication 
Provider drop - down list: Windows Authentication and RADIUS Authentication. You can 
apply authentication restrictions at the policy level too.  
  Know how to configure Network Access Protection.   Network Access Protection (NAP) 
allows you to set security for accessing resources, based on the identity of the client 
computer. Network administrators have the ability to determine granular levels of network 
access based on client needs using NAP.  

 Know how to create a network access policy for VPNs.   The simplest way is to create a 
policy that allows all your users to use a VPN. To allow VPN access to a smaller group, 
create an Active Directory group, and put your VPN users in it. You can then create a 
policy by setting the NAS - Port - Type attribute to Virtual (VPN).  
 Know how to troubleshoot user access.   The main things to look for are missing or 
misconﬁ gured policies. Without a default network access policy, no user will be allowed 
access through the RRAS server. All connection requests are evaluated against the criteria 
contained in the network access policy. If there is no network access policy, there are no 
conditions to compare, and any request is thereby denied.  
 Understand Windows Firewall.   A ﬁ rewall helps protect your network from unauthorized 
access. Windows Server 2008 R2 has two different ways to conﬁ gure a ﬁ rewall: the 
Windows Firewall Settings control panel and the Firewall with Advanced Security MMC.  
Exam Essentials 
717

718 
Chapter 16 ■ Managing Security for Remote Access Services
 Review Questions  
 1. 
  You are the network administrator for Worldwide Sales Organization, Inc., and you have 
hundreds of salespeople who need to connect to the network from all over the world. The 
sales representatives ’ computers all have smart cards that they use with a Cisco RADIUS 
server for authentication into the network. The network consists of a Windows NT LAN 
as well as several Unix servers and a mainframe. You are in the process of migrating the 
Windows NT portion of the network to Windows Server 2008 R2. You have included 
Windows Server 2008 R2 RRAS, and you want to incorporate the RADIUS authentication 
for use with the RRAS server. Which authentication protocol should you select for the 
RRAS server to use the RADIUS server? 
 A.   MS - CHAP  
 B.   Kerberos  
 C.   EAP  
 D.   PAP  
  2. 
 You receive a phone call from Carlos, the new network administrator for the Enterprise 
Shoe Sales To Your Door Company. The majority of the users of this company ’ s network are 
the hundreds of remote salespeople who connect throughout the day to the network to 
update and track sales orders. For quite a while, they have been experiencing intermittent 
problems, which have increased in frequency since the last administrator left the company. 
Carlos attempted to modify the default network access policy with little success, so 
he decided to begin from scratch. To make sure no one is negatively affected by the 
modifications, he deleted the now - confusing default network access policy that he was 
trying to modify. During his telephone call, Carlos asks for your help in building the new 
network access policy. What will happen to the remote users until the new network policy 
is created? 
 A.   Only users who have standard remote access permission set to Allow Access will 
connect to the server.  
 B.   All connection attempts will be rejected.  
 C.   Anyone who dials the server will be connected.  
 D.   Only users in Active Directory will be connected.  
 E. 
  All users will be connected except those who are configured to be allowed access 
through the network access policy.  

 3. 
 You are building an ISP around the technology available with Windows Server 2008 
R2. You are marketing personalized services that will ultimately allow you to provide 
voice, data, and video services to your customers by integrating Active Directory with the 
infrastructure of the network. For example, you plan to sell bandwidth on demand based 
on the customer ’ s account in Active Directory. Your long - range plans notwithstanding, 
you start providing basic services to your customers by offering both dynamic and static IP 
addressing. Some ISPs offer static IP addresses based on a particular machine, but you want 
to provide a particular address based on the individual user. How can you provide this level 
of service for the users? 
 A.   Create an IP address reservation for the users in the Windows Server 2008 R2 DHCP 
server.  
 B.   Assign a unique IP address to the users ’ accounts in Active Directory.  
 C.   Create a network access policy that provides an assigned static IP address to the 
appropriate users.  
 D.   You can ’ t provide a static IP address per user using Windows Server 2008 R2 services. 
 4. 
  You are the network administrator for the Beach Party Bingo Apparel Company. You 
serve offices in three cities, with support people for the network in each location. The 
support people need to access the network from home occasionally when they get paged for 
network problems during weekends and evenings. You also have more than 100 salespeople 
who travel incessantly as they try to get your company ’ s product into boutiques across 
the country. They need to access the network on a regular basis. You want all remote 
communication to be logged for security purposes so you can track the locations where 
connections originate. How can you configure the RRAS server to accommodate these 
requirements?  
 A.   Configure Set By Caller for the sales staff and No Callback for the support staff.  
 B.   Configure Set By Caller for the sales staff and for the support staff.  
 C.   Configure Set By Caller for the sales staff and Always Callback for the support staff.  
 D.   Configure No Callback for the sales staff and Set By Caller for the support staff.  
 E. 
  Configure Set By Caller for the sales staff.  
Review Questions 
719

720 
Chapter 16 ■ Managing Security for Remote Access Services
 5. 
  You administer a network that assigns IP addresses via DHCP. You want to make sure that 
one of the clients always receives the same IP address from the DHCP server. You create an 
exclusion for that address, but you find that the computer isn’t being properly configured at 
bootup. What’s the problem? 
 A. You excluded the wrong IP address. 
 B. You need to make a reservation for the client that ties the IP address to the computer’s 
MAC address. Delete the exclusion. 
 C. You need to create a superscope for the address. 
 D. You must configure the client manually. You cannot assign the address via the DHCP 
server.  
  6. 
 The AVO import/export company has offices in Canada and throughout South America. 
The buyers for the company have laptop computers that dial into the network, usually from 
hotels and from company facilities of AVO ’ s clients. Because financial and proprietary 
client information will be included in these communications, you want to make sure they 
are secure. You plan to encrypt the authentication and data transfers during the VPN 
communication sessions. Many of the remote sites don ’ t support 128 - bit encryption, but 
you do want to make sure that all sessions are using 56 - bit keys. How do you configure the 
network access policy for the RRAS server to support these requirements?  
 A.   Basic Encryption 
 B.   Enhanced Encryption  
 C.   Strong Encryption  
 D.   Strongest Encryption  
  7. 
  Mildred ’ s Natural Pharmaceuticals is in the process of gobbling up other health food 
and homeopathic companies and integrating them into a national organization. Because 
the acquisition process for many of the companies that are coming on board hasn ’ t been 
completed, you don ’ t want them to have complete access to your network. Your company 
is halfway through a migration from Windows NT and 2000 to Windows Server 2008 
R2 at the corporate level. You are still running the Windows 2000 network using Active 
Directory in mixed mode. Most of the new locations are small, mom - and - pop health food 
stores, and many of them aren ’ t computerized at all. You are in the process of sending out 
stand - alone Windows Server 2008 R2 servers so that each of those locations can connect to 
the corporate RRAS server. The other locations represent a mix of Windows 95, Windows 
98, and Windows NT workstations. You want to use VPNs to enable each location to 
connect to the corporate network through the location ’ s local Internet connection. What 
is the best way for you to grant and control VPN access to the RRAS server for all the 
locations for which the acquisition process has been completed?  
 A.   Use the default network access policy for VPN.  
 B.   Grant access per user.  
 C.   Create a network access policy with a NAS port type that uses tunnel type.  
 D.   Create an Active Directory group containing your VPN users, add a condition that 
uses the Windows - Groups attribute, and put this policy ahead of the default network 
access policy in order to ensure execution.  

 8. 
  You are the network administrator of the New Products Development Company, which 
has offices in southern California. The employees at the corporate office are a combination 
of administrative support staff and technical engineers in the lab. The engineers also 
frequently work from home at all hours of the night, and they are supported via RRAS. 
You were involved with the migration of the network from a hodgepodge of different 
network operating systems but predominantly Windows clients and a smattering of 
Macintosh client computers. The CIO decided that the network operating system would 
be based on Windows Server 2008 R2 and that the Novell and Banyan hardware would be 
removed. Coupled with this was the decision to disallow passing through the network any 
credentials that were not encrypted. This was completed last year, and everything appears 
to be fine. Recently, and increasingly, you have been getting calls from development 
engineers who are working with the Linux operating system complaining that they cannot 
connect to the RAS server. You are now told that even though the fundamental network for 
the company will continue to be based on Windows Server 2008 R2, it is still important to 
support the work of the development engineers. What steps do you need to take in order for 
the Linux clients to be able to connect to the RRAS servers so that they can securely access 
resources at the office from home? (Choose all that apply.)  
 A.   Select Store Password Using Reversible Encryption For All Users in the GPO for the 
engineers.  
 B.   Select The User Must Change Password At Next Logon for the engineers.  
 C.   Reset the passwords for the engineers.  
 D.   Enable PAP on RRAS and in the engineers ’ network access policy.  
 E. 
  Enable MS - CHAPv2 on RRAS and in the engineers ’  network access policy.  
 F. 
 Enable CHAP on RRAS and in the engineers ’ network access policy.  
 9. 
  The Risk Assessment Insurance Company has five main offices across the United States. 
The cities are Los Angeles, Dallas, Atlanta, Chicago, and New York. Each city acts as the 
hub for the many individual sales offices each agent represents in their respective region. 
You have been involved in the migration from Windows NT to Windows Server 2008 
R2 over the last year. The main reason for the migration as directed by the CIO was to 
reduce administrative costs, a benefit promised by the new operating system platform. The 
migration has been completed, and the domain has finally been switched over from Mixed 
mode to Native mode. Although the software has been upgraded across all the workstations 
and servers, you still have not taken full advantage of the administrative opportunities 
available with the system. You still spend a great deal of time managing all the remote 
connections used by the agents from their home offices. You are instructed to reduce the 
amount of time you spend supporting these tasks. What should you do to accomplish this?  
 A.   Create and implement consistent remote access rules for the agents in a Group Policy 
object, and place it in the root domain of the forest with the No Override option set.  
 B.   Create and implement consistent remote access rules for the agents in a Group Policy 
object, and place it in each domain of the forest with the No Override option set.  
 C.   Create a master network access policy, and implement it systematically on each 
RRAS server.  
 D.   Implement Network Policy Server (NPS).  
Review Questions 
721

722 
Chapter 16 ■ Managing Security for Remote Access Services
  10.   Rick needs to set up RRAS callbacks for a single group of users who work from home. 
He could accomplish this by enabling callbacks for each individual user in each user ’ s 
Properties dialog box, but there is a more efficient method. Which of the following 
accomplishes the task more efficiently?  
 A.   Creating a Windows Server 2008 R2 security group and then configuring a network 
access policy for the group  
 B.   Creating a remote access profile for the group  
 C.   Moving the users to a server that has callbacks enabled  
 D.   Enabling callbacks on the server 

 Answers to Review Questions 
1. 
 C.  RRAS supports multiple authentication methods that can be used for different purposes. 
The Extensible Authentication Protocol (EAP) allows requests to the RRAS server to be 
properly formatted and forwarded to the RADIUS server. MS - CHAP is an incorrect answer 
because the Microsoft Challenge Handshake Authentication Protocol is used in a pure -
 Microsoft environment. Kerberos is an incorrect answer because it is a standard that ’ s 
used to authenticate a user to Active Directory, not to a RADIUS server. The Password 
Authentication Protocol (PAP) is incorrect because it is a simple protocol that provides little 
security and does not forward requests to third - party authentication authorities. 
2. 
 B.   Without a default network access policy, no user will be allowed access through the 
RRAS server. All connection requests are evaluated against the criteria contained in the 
network access policy. If there is no network access policy, there are no conditions to 
compare, and any request is thereby denied. Removing the network access policy does 
not leave the remote connection to your network open. Therefore, partial connectivity to 
your network is not possible if there is no network access policy. The options are either 
granularity of access through a policy or no access at all with no policy. 
3. 
 B.   In Active Directory, dial - in users can be assigned a static IP address as part of the user 
account settings. You need to make sure you have removed these IP addresses from any 
scope being delivered through DHCP so that you won ’ t create conﬂ icts. DHCP delivers 
addresses based on the machine, and reservations are assigned based on a particular MAC 
address. Remote policies don ’ t allow you to deliver a unique IP address. 
4. 
 C.   The Always Callback option for the support staff will ensure that their remote 
connections are always made from their homes. The Set By Caller option for the sales staff 
will allow them to travel around the country and enter the number where they are at any 
given time for the callback, thereby allowing you to keep records of all connections. Using 
No Callback would allow anyone conﬁ gured with this option to call from anywhere and 
connect to the system without any callback requirements. 
5. 
 B. An exclusion just marks addresses as excluded; the DHCP server doesn’t maintain any 
information about them. A reservation marks an address as reserved for a particular client.  
6. 
 C.   Strong Encryption in the network access policy will conﬁ gure the RRAS server to use 
56 - bit DES encryption for L2TP/IPSec VPN connections as well as 56 - bit MPPE dial - up 
connections. Basic Encryption will support L2TP/IPsec 56 - bit encryption but only 40 - bit 
encryption for MPPE dial - up connections. Strongest Encryption uses 128 - bit encryption 
for MPPE dial - up connections and supports triple DES encryption for L2TP/IPsec 
connections. Enhanced Encryption is not a valid option in RRAS. 
7. 
 B.   In this situation, you are forced to grant access per user because you can implement 
network access policies only if you are running your Windows Server 2008 Active 
Directory network in Windows 2000 Native mode or Windows Server 2003 or 2008 
domain functional level. Ideally, you would use Active Directory and create groups so 
that you could manage access to the network via network access policies, but this solution 
doesn ’ t apply in this situation. 
Answers to Review Questions 
723

724 
Chapter 16 ■ Managing Security for Remote Access Services
8. 
 A, C, F.   PAP uses clear - text passwords and therefore cannot be used according to your 
security policy. MS - CHAP supports only Microsoft clients. CHAP supports encryption 
across the wire but not in storage, so the encryption must be reversible. Selecting this 
option does not affect existing passwords, so after you select this option, you need to reset 
the engineers ’ passwords. However, if you select the option that forces a password change 
at the next login, then the engineers will be unable to access the system in the ﬁ rst place 
from their Linux machines because CHAP does not support this feature. 
9. 
 D.   The Windows Server 2008 RRAS server can be conﬁ gured to behave as a RADIUS 
server. This allows conﬁ guration information to be shared by multiple machines through 
NPS. In this conﬁ guration, when the RRAS server receives a request, it forwards that 
request to the NPS server for processing and authorizes or denies access based on a 
centralized policy. Network access polices cannot be set in GPOs. The problem of creating 
a master policy and trying to keep all the RRAS servers in sync will expand geometrically 
as the number of servers you are trying to manage increases. 
10.  A.   Network access policies allow you to create policies that target speciﬁ c groups (provided 
you ’ re in Windows 2000, 2003, or 2008 Native domain functional level). 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 

Managing File and 
Print Services  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Network Access  
■   Configure DirectAccess. May include but is not limited 
to: IPv6; IPsec; server requirements; client requirements; 
perimeter network; name resolution policy table.  
 Configuring File and Print Services  
■   Configure a file server. May include but is not limited to: 
file share publishing; offline files; share permissions; 
NTFS permissions; encrypting file system (EFS); BitLocker; 
Access - Based Enumeration (ABE); branch cache; Share and 
Storage Management console.  
■   Configure Distributed File System (DFS). May include 
but is not limited to: DFS namespace; DFS configuration 
and application; creating and configuring targets; DFS 
replication; read - only replicated folder; failover cluster 
support; health reporting.  
■   Manage file server resources. May include but is not limited 
to: FSRM; quota by volume or quota by user; quota entries; 
quota templates; file classification; Storage Manager for 
SANs; file management tasks; file screening. 
■   Configure and monitor print services. May include but 
is not limited to: printer share; publish printers to Active 
Directory; printer permissions; deploy printer connections; 
install printer drivers; export and import print queues and 
printer settings; add counters to Performance Monitor to 
monitor print servers; print pooling; print priority; print 
driver isolation; location - aware printing; print management 
delegation.  


 Chapter 
17

 Now that we have covered remote access, we ’ ll explain how to 
set up your servers so that your network users have something 
to access. Before you can set up a server, you have to decide 
what the server is going to be used for. Is it going to be a print server, a ﬁ le storage server, a 
remote access server, or a domain controller? 
 After you have decided how the machine is going to help your network, you must 
implement your decision. In this chapter, we ’ ll show you how to set up a print server and 
a ﬁ le server. In addition, we will discuss how to set up permissions and security for these 
servers. Finally, we will also discuss how you can limit the amount of space your users can 
have on a server.  
 All the server types covered in this chapter use Microsoft Windows Server 
2008 R2. Although other operating systems can do these tasks, this chapter 
refers only to Windows Server 2008 R2.  
 Understanding File Servers 
 Before you conﬁ gure a ﬁ le server, you must understand what a ﬁ le server does.  File servers 
are machines on your network that store data ﬁ les to share among network clients. The 
same machine can be a ﬁ le server and another type of server. For example, a machine can 
both be hosting network ﬁ les and be running Exchange Server 2010. Such a machine would 
have both ﬁ le server and application server functions. ( Application servers are machines 
that host applications used by network clients.)  
 Multiple Server Types on One Machine 
 In today ’ s computer world, most IT departments must worry about budgets. The 
problem with the IT department is that most of the time it gets the smallest budget in the 
company. You are usually stuck between a rock and a hard place, because if your network 
is running well, people (including executives) forget about you. This makes it hard when 
you ask for your budget. 

 We have been doing consulting for many years, and one thing we stress to all clients is to 
perform regular backups. After all, most organizations would not be able to recover from 
losing all of their data. Usually, companies back up only their servers, and this is why home 
folders are so important.  Home folders are one of the most common ﬁ le types on 
a ﬁ le server; they are folders set up on the server for users to store information. Users 
have a location on the server to store their important data, and therefore that data will 
be backed up when the company does its regular backups. 
 Home folders are just one example of how to use a ﬁ le server. We will be discussing 
other examples throughout this chapter.  
 Backing up will be discussed in Chapter 18,  “ Monitoring and Managing a 
Network Infrastructure. ” 
 Configuring File Servers 
 Now that you have an understanding of what a ﬁ le server does, it ’ s time to discuss how 
to conﬁ gure these servers. Setting up a ﬁ le server properly encompasses many steps. One 
major concern, as always, is security. In the following sections, ﬁ rst we will describe how 
to share and publish online and ofﬂ ine ﬁ les and folders. Then we will discuss the two types 
of security — shared permissions and NTFS security — that an administrator can set when 
sharing ﬁ les or folders. 
 Because of the lack of money, many times you must use one machine to do many server 
tasks. We have been IT managers in many companies where the IT department had to 
have the same machine running both as an application server and as a ﬁ le server. 
 You must consider many factors before allowing a machine to run multiple server types. 
How many processors do you have? What are the processor speeds? How much RAM 
does the machine have? What is the hard drive speed? What type of applications will be 
hosted on the machine? 
 After you have gathered all your information about the machine, then you can decide 
whether the machine can host multiple server types. However, keep this one fact in mind: 
because of the requirements and demands on the computer system, it ’ s always a good 
idea to host SQL Server on a dedicated machine. 
Configuring File Servers 
727

728 
Chapter 17 ■ Managing File and Print Services
 Sharing Folders 
 A ﬁ le server is for sharing and storing data. To use one, you need to know how to set up a 
share, or a shared folder, on your server. A  shared folder is exactly what it says; it ’ s a folder 
that is shared on your network so users can access the data within that folder. You, as an 
administrator, have the ability to determine which users can access which ﬁ les within that 
shared folder. 
 One of the main goals of Active Directory is to make resources easy to ﬁ nd. Active 
Directory also makes it easy to determine which ﬁ les are available to users. With that said, 
we will explain how Active Directory manages to publish shared folders.  
 Making Active Directory Objects Available to Users 
 With Active Directory, a system administrator can control which objects users can see. The 
act of making an Active Directory object available is known as  publishing . The two main 
publishable objects are Printer objects and Shared Folder objects. 
 The general process for creating server shares and shared printers has remained 
unchanged from previous versions of Windows: You create the various objects (printers or 
ﬁ le system folders) and then enable them for sharing. 
 To make these resources available via Active Directory, however, there ’ s an additional 
step: You must publish the resources. Once an object has been published in Active 
Directory, clients will be able to ﬁ nd it. 
 When you publish objects in Active Directory, you should know the server name and 
share name of the resource. However, this information doesn ’ t matter to your users. A 
system administrator can change the resource to which the object points without having 
to reconﬁ gure or even notify clients. For example, if you move a share from one server to 
another, all you need to do is update the Shared Folder object ’ s properties to point to the 
new location. Active Directory clients still refer to the resource with the same path and 
name as they used before. 
 In Exercise 17.1, we will walk you through the steps of sharing and publishing a folder 
for use on your network.  
 E X E R C I S E  17.1
Creating and Publishing a Shared Network Folder  
 1. 
  Create a new folder in the root directory of your  C: partition, and name it   Test Share . 
 2. 
  Right - click the  Test Share folder, and choose Share. 
 3. 
  In the File Sharing dialog box, enter the names of users you want to share this folder 
with. In the upper box, enter  Everyone , and then click Add. Note that Everyone appears 
in the lower box. Click in the Permission Level column next to Everyone, and choose 
Contributor from the drop - down menu. Then click Share. 

 4. 
  You see a message that your folder has been shared. Click Done.  
 5. 
  Open the Active Directory Users and Computers tool. Expand the current domain, and 
right - click RD OU. Select New   Shared Folder.  
 6. 
  In the New Object  – Shared Folder dialog box, type   Shared Folder Test for the name 
of the folder. Then type the UNC path to the share (for example,  \\server1\Test Share ). 
Click OK to create the share. 
 One of the main benefits of having all your resource information in 
Active Directory is that you can easily find what you ’ re looking for using 
the Find dialog box. When setting up objects in Active Directory, we 
recommend you always enter as much information as possible for 
the objects you ’ re creating. The extra effort will begin to pay off 
when your users start doing searches for these objects. The more 
information you enter, the more users can search to find the 
appropriate resource they need.  
 Configuring Offline Folders 
 If you have been in this industry long enough, you have seen a major change in the 
computers that end users now use. Years ago, only a few select users had laptops. They 
were big and bulky, and they weighed almost as much as today ’ s desktop. 
 The pendulum has swung in the opposite direction. It probably seems like every one of 
your end users now has a laptop. This gives you as an IT administrator a whole new set 
of challenges and problems to address. 
 One challenge you have to address is how users can work on ﬁ les while outside the 
ofﬁ ce. If you have a user who wants to work at home, how do you give them the ﬁ les they 
need to get their work done? 
 The answer is  ofﬂ ine folders . These folders contain data that can be worked on by users 
while outside the ofﬁ ce. An IT administrator can set up ofﬂ ine folders through the use of 
Group Policy objects (GPOs). 
 When you decide to make folders available for ofﬂ ine use, these folders need to 
synchronize with the laptops so that all the data matches between both systems. One 
decision that you should make as an administrator is when the ofﬂ ine folders will be 
synchronized. You have three synchronization options you can set in the GPO 
(see Figure 17.1).  
Configuring File Servers 
729

730 
Chapter 17 ■ Managing File and Print Services
 You can set up any combination of these options: 
 When you select Synchronize All Ofﬂ ine Files Before Logging Off, ofﬂ ine folders are 
synchronized when the user logs off the network.  
 When you select Synchronize All Ofﬂ ine Files When Logging On, ofﬂ ine folders 
are synchronized when the user logs on to the network.  
 When you select Synchronize Ofﬂ ine Files Before Suspend, ofﬂ ine folders are 
synchronized before the user does a system suspend.  
 In Exercise 17.2, we will show you the steps necessary to conﬁ gure ofﬂ ine folder options 
by using a GPO. This exercise uses the Group Policy Management Console (GPMC). If 
your GPMC is not installed, use the Server Manager MMC (under Features) to install it.  
 E X E R C I S E  17. 2
Conﬁ guring Ofﬂ ine Folder Options  
 1. 
  Open the Group Policy Management Console by clicking Start   Administrative Tools   
Group Policy Management.  
 2. 
  In the left pane, expand your forest and then your domain. Under your domain name 
there should be a default domain policy.  
■
■
■
 F I G U R E 17.1 Synchronization options in a GPO 

 3. 
  Right - click the default domain policy, and choose Edit.  
 4. 
  In the User Conﬁ guration section, expand Administrative Templates   Network, and 
then click Ofﬂ ine Files.  
 5. 
  Right - click Synchronize All Ofﬂ ine Files Before Logging Off, and choose Properties. The 
Properties dialog box appears. Choose the Enabled option, and click OK.  
 6. 
  Right - click Synchronize All Ofﬂ ine Files When Logging On, and choose Properties. The 
Properties dialog box appears. Choose the Enabled option, and click OK.  
 7. 
  Right - click Synchronize Ofﬂ ine Files Before Suspend, and choose Properties. The 
Properties dialog box appears. Choose the Enabled option. In the Action drop - down 
box, make sure Quick is selected. Click OK.  
 8. 
  Close the GPMC.  
 Now that you have set up a GPO for synchronization, it ’ s time to share a folder for 
ofﬂ ine usage. In Exercise 17.3, we will show how to set up a folder for ofﬂ ine access. You 
must complete Exercise 17.1 before doing this exercise.  
 E X E R C I S E  17. 3
Conﬁ guring a Shared Network Folder for Ofﬂ ine Access  
 1. 
  Right - click the  Test Share folder you created in Exercise 17.1, and choose Properties.  
 2. 
  Click the Sharing tab, and then click the Advanced Sharing button.  
 3. 
  When the Advanced Sharing dialog box appears, click the Caching button. 
 4. 
 When the Ofﬂ ine Settings dialog box appears, choose the All Files And Programs 
That Users Open From The Shares Will Be Automatically Available Ofﬂ ine option. 
Click OK.  
 5. 
  Click OK twice more to close the Properties dialog box. 
 Understanding Permissions 
 You have gone through the steps to set up a shared folder, publish it to Active Directory, 
and set it up for ofﬂ ine access. Now we will discuss how you can protect these ﬁ les and 
folders by using permissions. 
 You can secure folders using permissions in two ways, and you can secure ﬁ les in one 
way. You can set up permissions and security through NTFS or through sharing. 
Configuring File Servers 
731

732 
Chapter 17 ■ Managing File and Print Services
 Understanding NTFS 
 NTFS is an option that you have when you are formatting a hard drive. You can format a 
hard drive for a Microsoft operating system in three ways: 
 File Allocation Table (FAT) is supported on older operating systems only (Server 2003, 
Server 2000, XP, and so on).  
 FAT32 is supported on Windows Server 2008 R2.  
 NTFS is supported on Windows Server 2008 R2.  
 NTFS has many advantages over FAT and FAT32. They include the following:  
  Compression   Compression helps compact ﬁ les or folders to allow for more efﬁ cient use of 
hard drive space. For example, a ﬁ le that usually takes up 20 MB of space might use only 
13 MB after compression. To enable compression, just open the Advanced Attributes dialog 
box for a folder and check the Compress Contents To Save Disk Space box (see Figure 17.2). 
■
■
■
 F I G U R E 17. 2 Setting up compression on a folder 
  Quotas   Quotas allow you to limit how much hard drive space users can have on a 
server. Quotas are discussed in greater detail later in the section  “ Conﬁ guring Disk Quotas. ” 
 Encryption   Encrypting File System (EFS) allows a user or administrator to secure ﬁ les 
or folders by using encryption. Encryption employs the user ’ s security identiﬁ cation (SID) 
number to secure the ﬁ le or folder. To implement encryption, open the Advanced Attributes 
dialog box for a folder, and check the Encrypt Contents To Secure Data box (see Figure 17.3).  
 If you use EFS, it ’ s best not to delete users immediately when they leave a 
company. Administrators have the ability to recover encrypted files, but it 
is much easier to gain access to the user ’ s encrypted files by logging in as 
the user who left the company and unchecking the encryption box. 

 F I G U R E  17. 3 Setting up encryption on a folder 
 Security   One of the biggest advantages of NTFS is security. As we stated in previous 
chapters, security is one of the most important aspects of an IT administrator ’ s job. An 
advantage of NTFS security is that the security can be placed on individual ﬁ les and 
folders. It does not matter whether you are local to the share (in front of the machine where 
the data is) or remote to the share (coming across the network to access the data); the 
security is always in place with NTFS. 
 The default security permission is Users = Read on new folders or shares. 
 NTFS security is  additive . In other words, if you are a member of three groups (Marketing, 
Sales, and R & D) and these three groups have different security settings, you get the highest 
level of permissions. For example, let ’ s say you have a user by the name of  wpanek who 
belongs to all three groups (Marketing, Sales, and R & D). Figure 17.4 shows this user ’ s 
permissions. The Marketing group has Read and Execute permissions to the  Stellacon 
Documents folder. The Sales group has Read and Write, and the R & D group has Full 
Control. Since  wpanek is a member of all three groups,  wpanek would get Full Control (the 
highest level). 
 The only time that this does not apply is with the Deny permission. Deny overrides any 
other group setting. So in the same example, if Sales had the Deny permission to the 
 Stellacon Documents folder, the user  wpanek would be denied access to the folder. 
The only way around this Deny is if you added  wpanek directly to the folder and gave him 
individual permissions (see Figure 17.5). Individual permissions override a group Deny. In 
this example, the individual right of  wpanek would override the Sales group ’ s Deny. The 
user ’ s security permission for the  Stellacon Documents folder would be Full Control.  
 Give users only the permissions necessary to do their jobs. Do not give 
them higher levels than necessary. 
Configuring File Servers 
733

734 
Chapter 17 ■ Managing File and Print Services
Stellacon Documents
Marketing
RX
Sales
Deny
R&D
FC
wpanek
FC
 F I G U R E 17. 5 Security settings with individual settings 
Stellacon Documents
Marketing
Sales
R&D
RX
RW
FC
 F I G U R E 17. 4 Security settings on the  Stellacon Documents folder 
 Understanding Shared Permissions 
 When you set up a folder to be shared, you have the ability to assign that folder 
permissions.  Shared permissions can be placed only on the folder and not on individual 
ﬁ les. Files inherit their permissions from the parent folder. 
 Shared folder permissions are in effect only when users are remote to the shared data. In 
other words, if computer A shares a folder called  Downloads and assigns that folder shared 
permissions, those permissions would apply only if you connected to that share from a 
machine other than computer A. If you were sitting in front of computer A, the shared 
permissions would not apply. 
 Like NTFS permissions (discussed in the previous section), shared permissions are 
additive, so users receive the highest level of permissions granted by the groups they are 
members of. 
 Also like NTFS permissions, the Deny permission (see Figure 17.6) overrides any group 
permission, and an individual permission overrides a group Deny. 
 The default shared permission is Administrators = Full Control. The shared permissions 
going from lowest to highest are Read, Change, Full Control, and Deny. Table 17.1 
compares the two different types of permissions and security.  
 How NTFS Security and Shared Permissions Work Together 
 When you set up a shared folder, you need to set up shared permissions on that folder. If 
you ’ re using NTFS, you will also need to set up NTFS security on the folder. Since both 
shared permissions and NTFS security are in effect when the user is remote, what happens 
when the two conﬂ ict?  

 There are two basic rules of thumb: 
 The local permission is the NTFS permission.  
 The remote permission is the more restrictive set of permissions between NTFS and 
shared.  
 This is easy to do as long as you do it in steps. Let ’ s look at Figure 17.7 and walk 
through the process of ﬁ guring out what  wpanek has for rights. 
■
■
 TA B L E 17.1  NTFS Security vs. Shared Permissions 
 Description  
  NTFS  
  Shared  
 Folder - level security  
  Yes  
  Yes  
 File - level security  
  Yes  
  No  
 In effect when local to the data  
  Yes  
  No  
 In effect when remote to the data  
  Yes  
  Yes  
 Permissions are additive  
  Yes  
  Yes  
 Group Deny overrides all other group settings  
  Yes  
  Yes  
 Individual settings override group settings  
  Yes  
  Yes  
 F I G U R E 17.6 Setting up permissions on a shared folder 
Configuring File Servers 
735

736 
Chapter 17 ■ Managing File and Print Services
Stellacon Documents
Marketing
R
Sales
R
R&D
R
Marketing
RX
Sales
R
R&D
FC
Shared permissions 
NTFS security
Local = ?
Remote = ?
wpanek
Marketing
Sales
R&D
 F I G U R E 17.7 NTFS security and shared permissions example 
Stellacon Documents
Marketing
R
Sales
R
R&D
FC
Marketing
R
Sales
R
R&D
R
Shared permissions 
NTFS security
Local = ?
Remote = ?
wpanek
Marketing
Sales
R&D
 F I G U R E  17. 8 NTFS security and shared permissions 
 As you can see,  wpanek belongs to three groups (Marketing, Sales, and R & D), and all 
three groups have settings for the  Stellacon Documents folder. In the ﬁ gure, you will 
notice that there are two questions: Remote = ? and Local = ? That ’ s what you need to 
ﬁ gure out — what are  wpanek ’ s effective permissions when he is sitting at the computer that 
shares the folder, and what are his effective permissions when he connects to the folder 
from another computer (remotely)? To ﬁ gure this out, follow these steps: 
 1. 
 Add up the permissions on each side separately. 
 Remember, permissions and security are additive. You get the highest permission. So if 
you look at each side, the highest shared permission is the Read permission. The NTFS 
security side should add up to equal Full Control. So, now you have Read permission 
on shared and Full Control on NTFS.  
 2. 
  Determine the local permissions. 
 Shared permissions do not apply when you are local to the data. Only NTFS would 
apply. So, the local permission would be Full Control.  
 3. 
  Determine the remote permissions. 
 Remember, the remote permission is the most restrictive set of permissions between 
NTFS and shared. Since Read is more restrictive than Full Control, the remote 
permission would be Read.  
 Let ’ s try another. Look at Figure 17.8 and see whether you can come up with  wpanek ’ s 
local and remote permissions. 

 Your answer should match the following: 
Local = Read
Remote = Read 
 Remember, ﬁ rst you add up each side to get the highest level of rights. NTFS would 
be Read, and shared would be Full Control. The local permission is always just NTFS 
(shared does not apply to local permissions), and remote permission is whichever 
permission (NTFS or shared) is the most restrictive (which would be Read, on the 
NTFS side). 
 Exercise 17.4 walks you through the process of setting both NTFS and shared 
permissions. You must complete Exercise 17.1 before doing this exercise.  
 E X E R C I S E  17. 4
Conﬁ guring Shared and NTFS Settings 
 1. 
  Right - click the  Test Share folder you created in Exercise 17.1, and choose 
Properties. 
 2. 
  Click the Sharing tab, and then click the Advanced Sharing button. (You will set the 
shared permissions ﬁ rst.)  
 3. 
  Click the Permissions button. Click the Add button. When the Select User page appears, 
choose a group from Active Directory (we used our Sales group). Once you ﬁ nd your 
group, click OK.  
 4. 
  The Permissions dialog box appears. With your group highlighted, click the Allow 
check box next to Full Control, and click OK. (All the other Allow check boxes will 
automatically become checked.)  
 5. 
  On the Advanced Sharing page, click OK. Now click the Security tab. (This allows you to 
set the NTFS security settings.) 
 6. 
  Click the Edit button. That takes you to the Permissions page. Now click the Add button. 
When the Select User page appears, choose a group from Active Directory (we used our 
Sales group). Once you ﬁ nd your group, choose OK.  
 7. 
  The Permissions dialog box appears. With your group highlighted, click the Allow 
check box next to Modify, and click OK. (All of the check boxes below Modify will 
automatically become checked.)  
 8. 
  Click Close.  
Configuring File Servers 
737

738 
Chapter 17 ■ Managing File and Print Services
 Share and Storage Management console 
 Microsoft gives you the ability to manage Storage Area Networks (SANs) and shared 
folders using the Share and Storage Management console. Using a Shared Folder Wizard 
in the Share and Storage Management console, administrators have the ability to share 
the content of folders and volumes on their servers. This Shared Folder wizard walks you 
through the process to share a folder or volume and assign all appropriate properties to it. 
Administrators will have the ability to: 
 Specify which folder or volume to share or create a new folder to share.  
 Specify which network sharing protocol will be used to access the shared resource.  
 Change the local NTFS permissions for the folder or volume you will be sharing.  
 Specify which share access permissions, along with user limits and ofﬂ ine access to 
ﬁ les, are assigned to the shared resource.  
 Publish any or all shared resources to the Distributed File System (DFS).  
 If Services for Network File System (NFS) has been installed, specify which NFS - based 
access permissions are assigned to the shared resource.  
 Apply storage quotas to the new shared resource, and create ﬁ le screens to limit the 
type of ﬁ les that can be stored in it, if File Server Resource Manager is installed on 
the server.  
 Using the Share and Storage Management console allows an administrator to conﬁ gure 
storage on disks that are available on the server. The Shared and Storage Management tool 
also allows an administrator to conﬁ gure the storage subsystems that support Virtual Disk 
Service (VDS). 
 The Provision Storage Wizard walks administrators through the steps needed for 
creating a volume on an existing disk, or on a storage subsystem attached to your server. 
If the volume is going to be created on a storage subsystem, the wizard will also walk 
administrators through the process of creating a logical unit number (LUN) to host that 
volume. An administrator also has the option of creating only the LUN and using Disk 
Management to create the volume. 
 The Share and Storage Management console also allows you to monitor and manage 
the volumes that you have created, as well as any other volumes that are available on your 
server. Using Share and Storage Management you can: 
 Extend the size of a volume.  
 Format a volume.  
 Delete a volume.  
 Change volume properties like compression, security, ofﬂ ine availability, 
and indexing.  
 Access disk tools for error checking, defragmentation, and backup.  
■
■
■
■
■
■
■
■
■
■
■
■

 Using BitLocker Drive Encryption 
 To prevent individuals from stealing your computer and viewing personal and sensitive 
data found on your hard disk, some editions of Windows come with a new feature called 
 BitLocker Drive Encryption . BitLocker encrypts the entire system drive. New ﬁ les added 
to this drive are encrypted automatically, and ﬁ les moved from this drive to another drive 
or computers are decrypted automatically. 
 Only Windows 7 Enterprise, Windows 7 Ultimate, Windows Server 2008, and Windows 
Server 2008 R2 include BitLocker Drive Encryption and only the operating system drive 
(usually  C: ) or internal hard drives can be encrypted with BitLocker. Files on other types 
of drives must be encrypted using BitLocker To Go. BitLocker To Go allows you to put 
BitLocker on removable media such as external hard disks or thumb drives. 
 BitLocker uses a Trusted Platform Module (TPM) version 1.2 or higher to store the 
security key. A TPM is a chip that is found in newer computers. If you do not have a 
computer with a TPM, you can store the key on a removable USB drive. The USB drive will 
be required each time you start the computer so that the system drive can be decrypted. 
 If the TPM discovers a potential security risk, such as a disk error, or changes made to 
BIOS, hardware, system ﬁ les, or startup components, the system drive will not be unlocked 
until you enter the 48 - digit BitLocker recovery password or use a USB drive with a recovery 
key as a recovery agent. 
 BitLocker must be set up within either the Local Group Policy editor or through the 
BitLocker icon in Control Panel. One advantage of using BitLocker is that you can prevent 
any unencrypted data from being copied onto a removable disk, thus protecting the 
computer.  
 BitLocker Recovery Password 
 The BitLocker recovery password is very important. Do not lose it, or you 
may not be able to unlock the drive. Even if you do not have a TPM, be sure 
to keep your recovery password in case your USB drive becomes lost or 
corrupted.  
 BitLocker requires that you have a hard disk with at least two partitions, both formatted 
with NTFS. One partition will be the system partition that will be encrypted. The other 
partition will be the active partition that is used to start the computer; this partition will 
remain unencrypted.  
 Understanding BranchCache 
 BranchCache is a new technology that has been introduced in Windows Server 2008 R2 and 
Windows 7. BranchCache allows an organization with slower links between ofﬁ ces to cache 
data so that downloads between ofﬁ ces do not have to occur each time a ﬁ le is accessed. 
Understanding BranchCache 
739

740 
Chapter 17 ■ Managing File and Print Services
 For example, John comes into work and logs into the network. John accesses the 
corporate website and downloads a media ﬁ le that takes four minutes to download. With 
BranchCache enabled, when Judy comes into work and connects to the corporate website 
and tries to download the same media ﬁ le, the ﬁ le will be cached from the previous 
download and Judy will have immediate access to the ﬁ le. 
 There are two types of BranchCache conﬁ gurations that you can set up: distributed 
cache mode and hosted mode.  
  Distributed Cache Mode   In the distributed cache mode conﬁ guration, all Windows 7 
client machines cache the ﬁ les locally on the client machines. So in the previous example, 
after John downloaded the media ﬁ le, Judy would receive the cached media ﬁ le from John ’ s 
Windows 7 machine.  
 Hosted Mode   In the hosted mode conﬁ guration, the cache ﬁ les are cached on a local 
(within the site) Windows Server 2008 R2 machine. So in the previous example, after John 
downloaded the media ﬁ le, the cached ﬁ le would be placed on a Windows Server 2008 
R2 machine by default and all other users (Judy) would download the media ﬁ le from the 
Windows Server 2008 R2 machine.  
 Distributed Cache Mode Requirements 
 If you decide to install BranchCache in the distributed cache mode conﬁ guration, a hosted 
cache server running Windows Server 2008 R2 is not required at the branch ofﬁ ce. To 
set up distributed cache mode, the client machines must be running either Windows 7 
Enterprise Edition or Windows 7 Ultimate Edition. 
 The Windows 7 machines would then download the data ﬁ les from the content servers 
at the main branch ofﬁ ce, and then these Windows 7 machines become the local cache 
servers. To set up distributed cache mode, you must install a Windows Server 2008 
R2 content server at the main ofﬁ ce ﬁ rst. After the content server is installed, physical 
connections (WAN or VPN connections) between the sites and branch ofﬁ ces must be 
established. 
 Client computers running Windows 7 have BranchCache installed by default, but you 
must, however, enable and conﬁ gure BranchCache and conﬁ gure ﬁ rewall exceptions. 
Complete exercise 17.5 to conﬁ gure BranchCache ﬁ rewall rule exceptions.  
 E X E R C I S E  17. 5
Conﬁ guring BranchCache Firewall Exceptions  
 1. 
  On a Domain Controller, click Start   Administrative Tools   Group Policy Management. 
This opens the Group Policy Management console.  
 2. 
  In the Group Policy Management Console, expand the following path: Forest   
Domains   Group Policy Objects. Make sure that the domain you choose contains the 
BranchCache Windows 7 client computer accounts that you want to conﬁ gure.  

 3. 
  In the Group Policy Management Console, right - click Group Policy Objects and select 
Create And Link Group Policy Here. Name the policy  BranchCache Client  and hit Enter. 
Right - click BranchCache Client and click Edit. The Group Policy Management Editor 
console opens. 
 4. 
  In the Group Policy Management Editor console, expand the following path: Computer 
Conﬁ guration   Policies   Windows Settings   Security Settings   Windows Firewall 
With Advanced Security   Windows Firewall With Advanced Security  – LDAP   
Inbound Rules.  
 5. 
  Right - click Inbound Rules and then click New Rule. The New Inbound Rule Wizard 
opens.  
 6. 
  In Rule Type, click Predeﬁ ned, expand the list of choices, and then click BranchCache 
 – Content Retrieval (Uses HTTP). Click Next. 
 7. 
  In Predeﬁ ned Rules, click Next.  
 8. 
  In Action, ensure that Allow The Connection is selected, and then click Finish. You must 
select Allow The Connection for the BranchCache client to be able to receive trafﬁ c on 
this port. 
 9. 
  Now to create the WS - Discovery ﬁ rewall exception, right - click Inbound Rules, and click 
New Rule. The New Inbound Rule Wizard opens.  
 10.   In Rule Type, click Predeﬁ ned, expand the list of choices, and then click BranchCache 
 – Peer Discovery (Uses WSD). Click Next.  
 11.   In Predeﬁ ned Rules, click Next.  
 12.   In Action, ensure that Allow The Connection is selected, and then click Finish. 
 13.   In the Group Policy Management Editor console, right - click Outbound Rules, and then 
click New Rule. The New Outbound Rule Wizard opens.  
 14.   In Rule Type, click Predeﬁ ned, expand the list of choices, and then click BranchCache 
 – Content Retrieval (Uses HTTP). Click Next. 
 15.   In Predeﬁ ned Rules, click Next.  
 16.   In Action, ensure that Allow The Connection is selected, and then click Finish. 
 17.   Create the WS - Discovery ﬁ rewall exception by right - clicking Outbound Rules, and then 
click New Rule. The New Outbound Rule Wizard opens.  
 18.   In Rule Type, click Predeﬁ ned, expand the list of choices, and then click 
BranchCache  –  Peer Discovery (Uses WSD). Click Next.  
 19.   In Predeﬁ ned Rules, click Next.  
 20.   In Action, ensure that Allow The Connection is selected, and then click Finish. 
Understanding BranchCache 
741

742 
Chapter 17 ■ Managing File and Print Services
 Now that we have looked at the distributed cache mode conﬁ guration, let ’ s take a look 
at the hosted mode conﬁ guration.  
 Hosted Mode Requirements 
 To set up a hosted mode BranchCache conﬁ guration, you must ﬁ rst set up a Windows 
Server 2008 R2 hosted cache server at the main and branch ofﬁ ces. You also need 
Windows 7 Enterprise or Windows 7 Ultimate computers at the branch ofﬁ ces. 
 The Windows 7 machines download the data from the main cache server, and then the 
hosted cache servers at the branch ofﬁ ces obtain a copy of the downloaded data for other 
users to access. 
 Your network infrastructure must also allow for physical connections between the main 
ofﬁ ce and the branch ofﬁ ces. These connections can be VPNs or some type of WAN links. 
After these requirements are met, your cache server must obtain a server certiﬁ cate so that 
the client computers in the branch ofﬁ ces can positively identify the cache servers. 
 Exercise 17.6 walks you through the process of installing the BranchCache feature on a 
Windows Server 2008 R2 machine. To accomplish this exercise, you must be logged into 
the Windows Server 2008 R2 machine as an administrator.  
 E X E R C I S E  17. 6
Installing BranchCache on a Windows Server 2008 R2 Machine  
 1. 
  Open Server Manager by clicking Start   Administrative Tools   Server Manager. 
 2. 
  In Server Manager, right - click Features and then choose the Add Feature link. 
 3. 
  The Add Features Wizard starts. Select the BranchCache check box and click Next.  
 4. 
  At the Conﬁ rm Installation Selections screen, click Install. 
 5. 
  After the BranchCache feature installs, click Close. 
 6. 
  In the Server Manager left window pane, double - click Conﬁ guration and then click 
Services.  
 7. 
  In the Services detail pane, double - click BranchCache.  
 8. 
  The BranchCache Properties dialog box appears; click the General tab and then click 
Start. Click OK. 
 9. 
  Close Server Manager.  
 Make sure to repeat this exercise on all branch ofﬁ ce cache servers. Now one of the 
requirements for BranchCache is a physical connection between the main ofﬁ ce and 
the branch ofﬁ ces. In the next section we will look at conﬁ guring DirectAccess.  

 Configuring DirectAccess 
 DirectAccess is new to the Windows Server 2008 R2 and Windows 7 operating 
systems.  DirectAccess allows a remote user to work on their corporate network when 
they are away from the ofﬁ ce without the need of a VPN. As long as the remote user is 
connected to the internet, DirectAccess will automatically connect the remote user to 
the corporate network without the need of any user intervention. 
 When a user ’ s DirectAccess - enabled laptop is connected to the internet, a bidirectional 
connection is automatically established with the user ’ s corporate network. Because 
the connection is bidirectional, the IT administrator can also remotely manage the 
Windows 7 machine while the machine is away from the network. 
 DirectAccess vs. VPNs 
 There are a few problems with using VPNs to connect to a network. One issue is that 
when a user gets disconnected from their VPN connection, they must reestablish the VPN 
connection. 
 Another issue with VPNs is that many organizations ﬁ lter VPN connection trafﬁ c. It 
may not be possible for an organization to open a ﬁ rewall to allow VPN trafﬁ c. Also, 
if your intranet and your Internet connections are the same as your VPN connections, this 
can cause your Internet to be slower. 
 DirectAccess does not face the same limitations of a VPN. DirectAccess allows a laptop 
or desktop that is conﬁ gured properly to automatically connect using a bidirectional 
connection between the client and the server. 
 To establish this connection, DirectAccess uses Internet Protocol Security (IPsec) and 
IPv6. IPsec provides a high level of security between the client and the server, and IPv6 is 
the protocol that the machines use.  
 Understanding How DirectAccess Works 
 To better understand DirectAccess, it helps to understand the process involved with how 
DirectAccess operates. The following steps, taken from the Microsoft whitepapers, 
show how DirectAccess operates.  
 1. 
 The Windows 7 DirectAccess client determines if the machine is connected to a 
network or Internet.  
 2. 
  The Windows 7 DirectAccess computer tries to connect to the web server speciﬁ ed 
during the DirectAccess setup conﬁ guration.  
 3. 
  The Windows 7 DirectAccess client computer connects to the Windows Server 2008 
R2 DirectAccess server using IPv6 and IPsec. Because most users connect to the 
Internet using IPv4, the client establishes an IPv6 - over - IPv4 tunnel using 6to4 
or Teredo.  
Configuring DirectAccess 
743

744 
Chapter 17 ■ Managing File and Print Services
 4. 
  If an organization has a ﬁ rewall that prevents the DirectAccess client computer using 
6to4 or Teredo from connecting to the DirectAccess server, the Windows 7 client 
automatically attempts to connect using the IP - HTTPS protocol. 
 5. 
  As part of establishing the IPsec session, the Windows 7 DirectAccess client and server 
authenticate each other using computer certiﬁ cates for authentication.  
 6. 
  The DirectAccess server uses Active Directory membership, and the DirectAccess 
server veriﬁ es that the computer and user are authorized to connect using 
DirectAccess.  
 7. 
  The DirectAccess server begins forwarding trafﬁ c from the DirectAccess client to the 
intranet resources to which the user has been granted access.  
 Now that you understand how DirectAccess works, let ’ s look at the requirements for 
setting up DirectAccess on your network.  
 Knowing the DirectAccess Infrastructure Requirements 
 To set up DirectAccess, your network infrastructure must meet some minimum 
requirements. The following are the requirements for setting up DirectAccess.  
 Windows Server 2008 R2 conﬁ gured to use DirectAccess. The Windows Server 2008 
R2 machine will be set up as a multihomed system. This means that your server will 
need two network adapters so that one adapter is connected directly to the Internet 
and a second adapter is connected to the intranet. Each network adapter will be 
conﬁ gured with its own TCP/IP address.  
 Windows 7 client machines conﬁ gured to use DirectAccess.  
 Minimum of one domain controller and one Domain Name System (DNS) server 
running Windows Server 2008 SP2 or Windows Server 2008 R2.  
 Certiﬁ cate Authority (CA) server that will issue computer certiﬁ cates, smart card 
certiﬁ cates, or health certiﬁ cates.  
 IPsec policies to specify protection for trafﬁ c.  
 IPv6 on the DirectAccess server that uses ISATAP, Teredo, or 6to4.  
 Complete Exercise 17.7 to install the DirectAccess feature onto a Windows Server 2008 
R2 machine. Remember that the DirectAccess feature needs to be installed on Windows 
Server 2008 R2.  
 E X E R C I S E  17. 7
Installing the DirectAccess Feature 
 1. 
  Start Server Manager by clicking Start   Administrative Tools   Server Manager. 
 2. 
  In the left - hand window, click Features. 
 3. 
  In the right - hand window, click the Add Feature link. 
■
■
■
■
■
■

 4. 
  Click the DirectAccess Management Console check box. 
 5. 
  A dialog box may appear asking to install any other features required by DirectAccess. 
Click the Add Required Features button. 
 6. 
  Click Next and then click the Install button. 
 7. 
  Verify that the installation was complete and then close Server Manager. 
 After the DirectAccess feature is installed, in the Administrative Tools section, the 
DirectAccess Manager will appear. When you start the DirectAccess Manager, click Setup 
and the DirectAccess Setup Wizard will start. 
 The setup wizard walks you through a four - stage process (setting up the remote clients, 
DirectAccess server, infrastructure servers, and application servers), and it will allow 
you to choose which Windows 7 computers can use DirectAccess. Follow the wizard to 
complete the installation. To complete the setup and allow this to function properly, you 
also need to set up a certiﬁ cate server, domain controller, and DNS.  
 Configuring Disk Quotas 
 In this chapter so far, you have seen how to set up a share and publish it to Active 
Directory. You ’ ve also learned how to set up permissions and security and how NTFS and 
shared permissions work with each other. It ’ s time to learn how to limit users ’ hard drive 
space on the servers. 
 Disk quotas give administrators the ability to limit how much storage space a user can 
have on a hard drive. As mentioned earlier in this chapter, disk quotas are an advantage of 
using NTFS over FAT32. If you decide to use FAT32 on a volume or partition, quotas will 
not be available. 
 You have a few options available to you when you set up disk quotas. You can set up 
disk quotas based on volume or on users.  
 A good rule of thumb is to set up an umbrella quota policy that covers the 
entire volume and then let individual users exceed the umbrella as needed.  
 Setting Quotas by Volume   One way to set up disk quotas is by setting the quota by volume, on 
a per - volume basis. This means that if you have a hard drive with  C: ,  D: , and  E: volumes, you 
would have to set up three individual quotas (one for each volume). This is your umbrella. This 
is where you set up an entire disk quota based on the volume for all users.  
 Setting Quotas by User   You have the ability to set up quotas on volumes by user. Here 
is where you would individually let users have independent quotas that exceed your 
umbrella quota.  
Configuring Disk Quotas 
745

746 
Chapter 17 ■ Managing File and Print Services
  Specifying Quota Entries  You use quota entries to conﬁ gure the volume and user quotas. 
You do this on the Quotas tab of the volume ’ s Properties dialog box. (See Exercise 17.8.)  
  Creating Quota Templates   Quota templates are predeﬁ ned ways to set up quotas. 
Templates allow you to set up disk quotas without needing to create a disk quota from 
scratch. One advantage to using a template is that when you want to set up disk quotas on 
multiple volumes ( C: ,  D: , and  E: ) on the same hard drive, you do not need to re - create the 
quota on each volume.  
 Exercise 17.8 will show you how to set up an umbrella quota for all users and then have 
an individual account in your Active Directory exceed this quota.  
 E X E R C I S E  17. 8
Conﬁ guring Disk Quotas 
 1. 
  Open Windows Explorer by right - clicking the Start menu and choosing Explore. 
 2. 
  Right - click the Local Disk ( C: ), and choose Properties. 
 3. 
  Click the Quotas tab. 
 4. 
  Check the Enable Quota Management check box. Also check the Deny Disk Space To 
Users Exceeding Quota Limit box. 
 5. 
  Click the Limit Disk Space To option, and enter  1000MB in the box.  
 6. 
  Enter  750MB in the Set Warning Level To boxes.  
 7. 
  Click the Apply button. If a warning box appears, click OK. This warning is just informing 
you that the disk may need to be rescanned for the quota.  
 8. 
  Now that you have set up an umbrella quota to cover everyone, you ’ ll set up a quota 
that exceeds the umbrella. Click the Quota Entries button.  
 9. 
  The Quotas Entries for ( C: ) window appears. You will see some users already listed. 
These are users who are already using space on the volume. Click the Quota menu at 
the top, and choose New Quota Entry. 
 Notice the N/A entry in the Percent Used column. This belongs to the Administrator 
account, which by default has no limit. 
 10.   On the Select User page, choose a user that you want to allow to exceed the quota (for 
this example, we used the  wpanek account). Click OK. 
 11.   This opens the Add New Quota Entry dialog box. Click the Do Not Limit Disk Usage 
option, and click OK. 
 12.   You will notice that the new user has no limit. Close the disk quota tool. 

 Configuring Distributed 
File System 
 One problem that we have had as network administrators is deciding how to share 
folders and communicating to the end users how to ﬁ nd our shares. For example, if you 
share a folder called  Stellacon Documents on server A, how do you make sure that 
your users will ﬁ nd the folder and ﬁ les within it? The users have to know the server 
name and the share name. This can be a huge problem if you have hundreds of shares 
on multiple servers. If you want to have multiple copies of the folder called  Stellacon 
Documents for fault tolerance and load balancing, the problem becomes even more 
complicated. 
 Distributed File System (DFS) in Windows Server 2008 R2 offers a simpliﬁ ed way for 
users to access geographically dispersed ﬁ les. DFS allows you to set up a tree structure 
of virtual directories that allow users to connect to shared folders throughout the entire 
network. 
 Administrators have the ability to take shared folders that are located on different 
servers and transparently connect them to one or more DFS namespaces — virtual trees of 
shared folders throughout an organization. The advantage of using DFS is that if one 
of the folders becomes unavailable, DFS has failover capability that will allow your 
users to connect to the data on a different server. 
 Administrators can use the DFS tools to choose which shared folders will appear in 
the namespace and also decide how the names of these shared folders will show up in the 
virtual tree listing. 
 Advantages of DFS 
 One of the advantages of DFS is that when a user views this virtual tree, the shared 
folders appear to be located on a single machine. Other advantages to DFS include the 
following:  
 Simplified Data Migration   DFS gives you the ability to move data from one location to 
another without the user needing to know the physical location of the data. Because the 
users do not need to know the physical location of the shared data, administrators can 
simply move data from one location to another.  
 Security Integration   Administrators do not need to conﬁ gure additional security for the 
DFS shared folders. The shared folders use the NTFS and shared folder permissions that an 
administrator has already assigned when the share was set up.  
Configuring Distributed File System 
747

748 
Chapter 17 ■ Managing File and Print Services
  Access - Based Enumeration (ABE)   This DFS feature (disabled by default) displays only the 
ﬁ les and folders that a user has permissions to access. If a user does not have access to a 
folder, Windows hides the folder from the user ’ s DFS view. This feature is not active if 
the user is viewing the ﬁ les and folders locally.  
 Types of DFS 
 The following are types of DFS:  
  DFS Replication   Administrators have the ability to manage replication scheduling and 
bandwidth throttling using the DFS management console. Replication is the process 
of sharing data between multiple machines. As explained earlier in the section, replicated 
shared folders allow you balance the load and have fault tolerance. DFS also has read - only 
replication folders.  
 DFS Namespaces   The DFS Namespace service is the virtual tree listing in the DFS server. 
An administrator can set up multiple namespaces on the DFS allowing for multiple virtual 
trees within DFS. DFS Namespaces was previously known just as Distributed File System in 
Windows 2000 Server and Windows Server 2003.  
 In Exercise 17.9 we will show how to install the DFS Namespace service on the ﬁ le 
server. You need to start the installation using the Server Manager MMC.  
 E X E R C I S E  17. 9
Installing the DFS Namespace Service 
 1. 
  Open Server Manager by clicking Start   Administrative Tools   Server Manager. 
 2. 
  Expand the Roles link in the left window under Server Manager. 
 3. 
  Click File Services (if File Services has not been installed, install it under New Roles). 
In the window on the right, scroll down until you see Role Services. Click Add Role 
Services.  
 4. 
  On the Select Role Services page, select the Distributed File System box, and 
click Next. 
 5. 
  On the Create A DFS Namespace page, leave the default of Namespace1, and 
click Next. 
 6. 
  On the Select Namespace Type page, make sure Domain - Based Namespace is selected, 
and click Next.  
 7. 
  On the Conﬁ gure Namespace page, click the Add button. This is where you add the 
shared folders that are going to be part of the DFS tree. The Add Folder window will 
appear. Click the Browse button, and choose your server name. After you put in your 
server name, all your shared folders will appear. Choose the  Test Share folder 
you created in Exercise 17.1. Click OK.  

 8. 
  The Add Folder To Namespace page reappears.  Test Share should be listed under 
Folder Name. Click OK.  
 9. 
  On the Conﬁ gure Namespace page, click the Next button.  
 10.   On the Conﬁ rm Installation Selections page, choose Install.  
 F I G U R E 17. 9 DFS Management console 
 Using the DFS Management Console 
 Once you have installed DFS, it ’ s time to learn how to manage DFS with the DFS 
Management MMC. The DFS Management console (see Figure 17.9) gives you one place 
to do all your DFS conﬁ gurations. The DFS Management console allows you to set up 
DFS Replication and DFS Namespace. Another task you can do in the DFS Management 
console is add a folder target — a folder that you add to the DFS Namespace (the virtual 
tree) for all your users to share. 
 In Exercise 17.10, you will create and share a folder and then add that folder target to 
the DFS namespace you created in Exercise 17.9 (which you must complete before doing 
Exercise 17.10). 
Configuring Distributed File System 
749

750 
Chapter 17 ■ Managing File and Print Services
 E X E R C I S E  17.1 0
Conﬁ guring DFS  
 1. 
  Create a new folder in the root directory of your  C: partition, and name it   DFS Test 
Folder . 
 2. 
  Right - click the  DFS Test Folder , and choose Share. 
 3. 
  In the File Sharing dialog box, enter the names of users you want to share this folder 
with. In the upper box, enter  Everyone  and then click Add. Note that Everyone appears 
in the lower box. Click in the Permission Level column next to Everyone, and choose 
Contributor from the drop - down menu. Then click Share. 
 4. 
  You see a message that your folder has been shared. Click Done.  
 5. 
  Open the DFS Management console by clicking Start   Administrative Tools   DFS 
Management.  
 6. 
  Under DFS Management, expand Namespaces, right - click your server name, and 
choose New Folder. 
 7. 
  On the New Folder page, click the Add button. On the Add Folder Target page, click the 
Browse button. When the Browse For Shared Folders page appears, choose the new 
 DFS Test Folder you created in step 1. Click OK.  
 8. 
  The Add Folder Target page reappears. Click OK. 
 9. 
  The New Folder page reappears. In the Name box, type a display name that will show 
on the DFS Namespace. We used  DFS Test Folder for our example. Click OK.  
  10.   You will notice that the new folder has been added to the Namespace listing. Close the 
DFS Management console.  
  Understanding Printing 
 One of the most important components on a network is the printer. Printers today are 
almost as important as the computers themselves. Think about your network. What would 
your network be like without a printer? Even small networks or home networks have a 
printer today. 
 How many printers do you want on your network? It is not feasible to put a printer on 
every user ’ s desk. What if some users need black and white and some need color? Do you 
give each user two printers? What if they need laser printing for reports but ink - jets will 
work ﬁ ne for every other type of print job? These are all questions you must answer before 
buying any printers for your networks. 

 This is also where network printers and print servers come into play.  Network printers 
are printers that can be directly connected to the network, through some form of network 
interface card. These printers usually have settings that can be conﬁ gured for your 
network needs. For example, if your network uses DHCP, you can set the printer to 
be a DHCP client. 
 Print servers  are servers that have a connected printer, where the server handles all 
printing issues. This is an excellent solution for printers that cannot directly connect to 
the network. Once the printer is connected to the network (through the use of a NIC or a 
server), the end user just connects to the printer and prints. To the end user, there is no real 
difference between the two options. 
 Before an end user can print to a network printer, an administrator must connect, set 
up, share, and publish the printer for use. An administrator must also set the permissions 
on the printer to allow users to print to that printer. The following sections will discuss 
these items in detail. 
 Creating and Publishing Printers 
 Once your printer is installed, you must share the printer and then publish the printer to 
Active Directory before users can print to it. Printers can be published easily within Active 
Directory. This makes them available to users in your domain. 
 Exercise 17.11 walks you through the steps you need to take to share and publish a 
Printer object by having you create and share a printer. To complete the printer installation, 
you need access to the Windows Server 2008 R2 installation media (via the hard disk, a 
network share, or the CD drive). If you do not have a printer for this exercise, just choose 
one from the list and continue the exercise.  
 E X E R C I S E  17.11
Creating and Publishing a Printer 
 1. 
  Click Start   Control Panel   Printers   Add Printer. This starts the Add Printer Wizard. 
 2. 
  On the Choose A Local Or Network Printer page, select Add A Local Printer. This should 
automatically take you to the next page. If it does not, click Next.  
 3. 
  On the Choose A Printer Port page, select Use An Existing Port. From the drop - down list 
beside that option, make sure LPT1: (Printer Port) is selected. Click Next.  
 4. 
  On the Install The Printer Driver page, select Generic for the manufacturer, and for the 
printer, highlight Generic / Text Only. Click Next. 
 5. 
  On the Type A Printer Name page, type  Text Printer . Uncheck the Set As The Default 
Printer box, and then click Next. 
Understanding Printing 
751

752 
Chapter 17 ■ Managing File and Print Services
E X E R C I S E  17.11  (c o n t i n u e d)
 6. 
  The Installing Printer page appears. After the system is ﬁ nished, the Printer 
Sharing page appears. Make sure the Share This Printer So That Others On Your 
Network Can Find And Use It box is selected, and accept the default share name 
of Text Printer.  
 7. 
  In the Location section, type  Building 203, and in the Comment section, add the 
following comment:  This is a text - only printer.  Click Next.  
 8. 
  On the You ’ ve Successfully Added Text Printer page, click Finish. 
 9. 
  Next, you need to verify that the printer will be listed in Active Directory. 
Click Start   Control Panel   Printers, right - click the Text Printer icon, and select 
Properties. 
 10.   Next, select the Sharing tab, and ensure that the List In The Directory box is checked. 
Note that you can also add printer drivers for other operating systems using this tab. 
Click OK to accept the settings. 
 Note that when you create and share a printer this way, an Active Directory Printer 
object is not displayed within the Active Directory Users and Computers tool. 
Printer objects in Active Directory are manually created for sharing printers from 
Windows NT 4 and earlier shared printer resources.  
 Configuring Printers 
 The printer has now been installed and published to Active Directory. It ’ s time to set 
all the different conﬁ guration options. To get to the options, right - click the Printer object, 
and choose Properties. The following are just some of the tabs you can conﬁ gure:  
  The General Tab   The General tab (see Figure 17.10) allows you to set some basic printer 
attributes: 
 The ﬁ eld at the top of the dialog box contains the display name of the Printer object.  
 The Location ﬁ eld should contain text that helps users physically locate the printer. 
This allows users to search for printers based on location (location - aware printing).  
 The Comment ﬁ eld allows an administrator to put in any additional information, such 
as the printer type.  
 The Printing Preferences button takes you to controls that allow you to change the 
layout and paper type of the printer.  
■
■
■
■

 The Sharing Tab   The Sharing tab (see Figure 17.11) allows you to conﬁ gure your printer 
for sharing on your network. This is what allows users to use a network printer (if they 
have the proper permissions on the printer).  
 The Share This Printer check box allows you to share the printer on the network.  
 Share Name is the name your users will see on the network.  
 When Render Print Jobs On Client Computers is checked, the client computer caches 
the print job until the printer is ready to print. If unchecked, the print server will 
cache the entire job before it prints to the printer.  
 When List In The Directory is checked, users can search the directory for 
the printer.  
 The Additional Drivers button allows you to load additional drivers for your clients. It 
is especially useful for giving access to drivers for older client systems. One advantage 
of a print server is that the server will automatically download drivers to client 
computers.  
■
■
■
■
■
 F I G U R E 17.10 The General tab of the printer ’ s Properties dialog box 
Understanding Printing 
753

754 
Chapter 17 ■ Managing File and Print Services
  The Ports Tab   The Ports tab (see Figure 17.12) allows you to conﬁ gure the port to which 
your printer is connected. You can add ports or conﬁ gure existing ports.  
 The Port check boxes allow you to choose to which port your printer is connected. 
Options are the printer port, serial port, local port, and print to ﬁ le port.  
 The Add Port button allows you to add a custom port (for example, a TCP/IP port).  
 The Delete Port button allows you to remove a port from the Port list.  
 The Conﬁ gure Port button gives you settings to conﬁ gure an existing port. For 
example, if you use TCP/IP, this button allows you to change the TCP/IP options.  
 Enable Bidirectional Support allows your printer and computer to communicate 
back and forth. If this check box is disabled, your printer cannot support two - way 
communications.  
 A  printer pool allows two or more identical printers to share the print load. When a 
document is sent to the printer pool, the ﬁ rst available printer receives the print job and 
prints it. Enable Printer Pooling allows a large department or organization to get print 
jobs done faster. Users do not have to wait for one printer to get their print job. You 
should follow a couple of rules when setting up a printer pool:  
 All printers in the pool need to be the same model and type.  
 All printers in the pool should be in the same physical location. Print jobs will 
be printed to the ﬁ rst available printer. If these printers are located all over the 
company, it may take a user too long to ﬁ nd their print job.  
■
■
■
■
■
■
■
■
 F I G U R E 17.11 The Sharing tab of the printer ’ s Properties dialog box 

 The Advanced Tab   The Advanced tab (see Figure 17.13) is where you can set availability, 
priority, and many other options: 
 The availability controls let you set the hours when this printer can be used. You can 
set it to be always available or available only between the hours you set.  
 If multiple print shares are set up to go to the same printer, you can specify a priority 
with the Priority ﬁ eld for each share. The higher the number, the faster a print job sent 
to that share will access the printer. The highest priority is 99, and the default (lowest) 
is 1. If two users send jobs to the same printer at the same time, one with a 99 priority 
and the other with a 1 priority, the 99 priority would print ﬁ rst.  
 Driver is the default driver that the printer is using.  
 The print spooling controls let you decide how the print job will spool. You can choose 
to have the entire job spool ﬁ rst before printing (this ensures that the entire job is 
received by the print queue before printing), to start printing immediately while the 
job is still spooling, or to print directly to the printer without spooling (the last option 
requires a printer with a large amount of RAM on the motherboard).  
 Hold Mismatched Documents allows the spooler to hold any print jobs that don ’ t 
match the setup for the print device.  
 Print Spooled Documents First allows a completely spooled printer job to be printed 
ﬁ rst even if it has a lower - priority number than a job that is still spooling.  
■
■
■
■
■
■
 F I G U R E 17.12 The Ports tab of the printer ’ s Properties dialog box 
Understanding Printing 
755

756 
Chapter 17 ■ Managing File and Print Services
 Usually after a print job has been printed, the print queue deletes the print job. If you 
check the Keep Printed Documents box, the print queue will not delete the print job 
after it is printed.  
 Enable Advanced Printing Features allows you to set some advanced features such as 
the Page Order and Pages Per Sheet settings. 
  The Color Management Tab   This tab allows you to adjust the color of your printing jobs.  
■
■
 F I G U R E 17.13 Advanced tab of the printer ’ s Properties dialog box 
  The Security Tab   The Security tab (see Figure 17.14) is where you can set the permissions 
for your printer. This allows users to print, manage printers, manage documents, and take 
advantage of special permissions: 
 The Add button allows you to add users and groups to the printer.  
 The Remove button allows you to remove users and groups from the printer.  
 The following controls, available in the Permissions For Everyone box, apply to 
everyone on your network:  
 Print gives everyone the right to print to this printer.  
 Manage Printers gives everyone the right to manage this printer, including deleting 
print jobs, setting priorities, setting availability, and so on. 
 Manage Documents gives everyone the right to manage print jobs.  
 Special Permissions allows you to set unique permissions such as Print, Manage 
Printers, Read permissions, Change permissions, and Take Ownership.  
■
■
■
■
■
■
■

 Migrating Print Servers 
 In a network environment, an administrator may ﬁ nd it necessary to replace older print 
servers or to consolidate multiple print servers into one.  
 F I G U R E 17.14 Security tab of the printer ’ s Properties dialog box 
 To do this print server migration or replacement, you can use the Printer Migration 
Wizard or the  Printbrm.exe command - line tool. These two utilities allow you to export 
print queues, printer settings, printer ports, and language monitors. These utilities then allow 
you to import these settings on another print server running Windows Server 2008 R2. 
 Summary 
 In this chapter, we discussed ﬁ le servers and how they can be effective on your network. 
We discussed sharing folders for users to access, and then we discussed how to publish 
those share folders to Active Directory. 
 We discussed NTFS security versus shared folder permissions. We also discussed how to 
limit users ’ hard drive space by setting up disk quotas. We also talked about the Encrypting 
File System (EFS) and how users can encrypt and compress ﬁ les. 
Summary 
757

758 
Chapter 17 ■ Managing File and Print Services
 Next, we discussed Distributed File System. DFS allows you to set up a tree structure of 
virtual directories that allow users to connect to shared folders throughout the entire network. 
 Finally, we discussed print servers and conﬁ guring printers. We talked about how to 
share and publish printers within Active Directory. We discussed print permissions and 
printer priorities along with print pooling.  
 Exam Essentials  
  Learn how resources can be published.   A design goal for Active Directory was to make 
network resources easier for users to ﬁ nd. With that in mind, you should understand how 
using published printers and shared folders can simplify network resource management.  
  Know how to configure offline folders.   Ofﬂ ine folders give you the opportunity to set up 
folders so that users can work on the data while outside the ofﬁ ce and later synchronize it 
with a master copy. You can set up GPOs to help with ofﬂ ine folder synchronization. 
  Know how to configure NTFS security.   One of the major advantages of using NTFS over 
FAT32 is access to additional security features. NTFS allows you to put security at the 
ﬁ le and folder layers. NTFS security is in effect whether the user is remote or local to the 
computer with the data.  
  Know how to configure shared permissions.   Shared permissions allow you to determine 
the access a user will receive when connecting to a shared folder. Shared permissions 
are allowed only at the folder layer and are in effect only when the user is remote to the 
computer with the shared data.  
  Understand how NTFS and shared permissions work together.   NTFS and shared 
permissions are individually additive — you get the highest level of security and permissions 
within each type. NTFS is always in effect and is the only security available locally. Shared 
permissions are in effect only when connecting remotely to access the shared data. When 
the two types of permissions meet, the most restrictive set of permissions applies.  
  Know how to configure disk quotas.   Disk quotas allow an organization to determine the 
amount of disk space users can have on a volume of a server. An administrator can set up 
disk quotas based on volumes or by users. Each volume must have its own separate set 
of disk quotas.  
  Know how to configure DFS.   Distributed File System in Windows Server 2008 R2 offers 
a simpliﬁ ed way for users to access geographically dispersed ﬁ les. The DFS Namespace 
service allows you to set up a tree structure of virtual directories that allow users to 
connect to shared folders throughout the entire network.  
  Know how to configure printing.   We discussed network printers versus print servers. 
Understand that when you create a printer, you want to publish the printer within Active 
Directory so your users can ﬁ nd it throughout the domain. Understand the different printer 
permissions and how to install print drivers.  

 Review Questions  
 1. 
  The company you work for has a multilevel administrative team that is segmented by 
departments and locations. There are four major locations, and you are in the Northeast 
group. You have been assigned to the administrative group that is responsible for creating and 
maintaining network shares for files and printers in your region. The last place you worked 
was a large Windows NT 4 network, where you had a much wider range of responsibilities. 
You are excited about the chance to learn more about Windows Server 2008 R2. 
 For your ﬁ rst task, you have been given a list of ﬁ le and printer shares that need to be 
created for the users in your region. You ask how to create them in Windows Server 2008 
R2, and you are told that the process of creating a share is the same as with Windows NT. 
You create the shares and use  NETUSE  to test them. Everything appears to work ﬁ ne, 
so you send out a message that the shares are available. The next day, you start receiving 
calls from users who say they cannot see any of resources you created. What is the most 
likely reason for the calls from the users?  
 A.   You forgot to enable NetBIOS for the shares.  
 B.   You need to force replication for the shares to appear in the directory.  
 C.   You need to publish the shares in the directory.  
 D.   The shares will appear within the normal replication period.  
 2. 
  You want to publish a printer to Active Directory. In the following dialog box, where 
would you click in order to accomplish this task?  
 A.   The Sharing tab  
 B.   The Advanced tab  
 C.   The Device Settings tab  
 D.   The Printing Preferences button  
Review Questions 
759

760 
Chapter 17 ■ Managing File and Print Services
 3. 
 A systems administrator creates a local Printer object, but it doesn ’ t show up in Active 
Directory when a user executes a search for all printers. Which of the following are possible 
reasons for this? (Choose all that apply.)  
 A.   The printer was not shared. 
 B.   The printer is offline.  
 C.   The client does not have permission to view the printer.  
 D.   The printer is malfunctioning.  
 4. 
  You are the network administrator for a midsize coffee bean distributor. Your company ’ s 
network has four Windows 2008 R2 servers, and all clients are running either Windows 7 
or Vista. Most of your end users use laptops to do their work, and many of them work 
away from the office. What should you configure to help them work on documents 
when away from the office?  
 A.   Online file access  
 B.   Offline file access  
 C.   Share permissions 
 D.   NTFS permissions  
 5. 
  Your company has decided to implement a Windows 2008 R2 server. The company IT 
manager before you always used FAT32 as the system partition. Your company wants to 
know whether it should move to NTFS. Which of the following are some advantages of 
NTFS? (Choose all that apply.)  
 A.   Security  
 B.   Quotas  
 C.   Compression  
 D.   Encryption  
  6. 
 Will, the IT manager for your company, has been asked to give Tylor the rights to read 
and change documents in the  Stellacon Documents  folder. The following table shows the 
current permissions on the shared folder: 
 Group/User  
  NTFS  
  Shared  
 Sales  
  Read  
  Change  
 Marketing  
  Modify  
  Change  
 R & D 
  Deny  
  Full Control  
 Finance  
  Read  
  Read  
 Tylor  
  Read  
  Change  

 Tylor is a member of the Sales and Finance groups. When Tylor accesses the  Stellacon 
Documents  folder, he can read all the ﬁ les, but the system won ’ t let him change or delete 
ﬁ les. What do you need to do to give Tylor the minimum amount of rights to do his job?  
 A.   Give Sales Full Control to shared permissions.  
 B.   Give Tylor Full Control to NTFS security.  
 C.   Give Finance Change to shared permissions.  
 D.   Give Finance Modify to NTFS security.  
 E. 
  Give Tylor Modify to NTFS security.  
 7. 
  You are the administrator of your network, which consists of two Windows Server 2008 
R2systems. One of the servers is a domain controller, and the other server is a file server 
for data storage. The hard drive of the file server is starting to fill up. You do not have the 
ability to install another hard drive, so you decide to limit the amount of space everyone 
gets on the hard drive. What do you need to implement to solve your problem?  
 A.   Disk spacing  
 B.   Disk quotas  
 C.   Disk hardening  
 D.   Disk limitations  
 8. 
 You are the IT manager for your company. You have been asked to give the Admin group 
the rights to read, change, and assign permissions to documents in the  Stellacon 
Documents folder. The following table shows the current permissions on the  
Stellacon Documents shared folder: 
 Group/User  
  NTFS  
  Shared  
 Sales  
  Read  
  Change  
 Marketing  
  Modify  
  Change  
 R & D 
  Deny  
  Full Control  
 Finance  
  Read  
  Read  
 Admin  
  Change  
  Change  
 What do you need to do to give the Admin group the rights to do their job? (Choose all that 
apply.)  
 A.   Give Sales Full Control to shared permissions.  
 B.   Give Full Control to NTFS security.  
 C.   Give Admin Full Control to shared permissions.  
 D.   Give Finance Modify to NTFS security.  
 E. 
  Give Admin Full Control to NTFS security.  
Review Questions 
761

762 
Chapter 17 ■ Managing File and Print Services
  9. 
  You are the administrator for a large organization. You have multiple Windows Server 
2008 R2 systems that all contain files that need to be shared for all users. The files and 
folders constantly move among servers, and users are having a hard time finding files they 
need. What can you implement to help your users out?  
 A.   Encrypting File System (EFS)  
 B.   Distributed File System (DFS)  
 C.   Shared File System (SFS)  
 D.   Published File System (PFS)  
 10.   You have been hired by a small company to implement new Windows Server 2008 R2 
systems. The company wants you to set up a server for users ’ home folder locations. What 
type of server would you be setting up?  
 A.   PDC server  
 B.   Web server 
 C.   Exchange server  
 D.   File server  

 Answers to Review Questions 
1. 
 C.   You need to publish shares in the directory before they are available to the users of 
the directory. If NetBIOS is still enabled on the network, the shares will be visible to the 
NetBIOS tools and clients, but you do not have to enable NetBIOS on shares. Although 
replication must occur before the shares are available in the directory, it is unlikely that 
the replication will not have occurred by the next day. If this is the case, then you have 
other problems with the directory as well. 
2. 
 A.   The Sharing tab contains a check box that you can use to list the printer in Active 
Directory.  
3. 
 A, C.   A printer may not show up within Active Directory if the printer has not been shared 
or if the client does not have permission to view the printer. The printer will appear as an 
object in Active Directory even if it is ofﬂ ine or malfunctioning. 
4. 
 B.   Ofﬂ ine ﬁ les give you the opportunity to set up ﬁ les and folders so that users can work 
on the data while outside the ofﬁ ce. 
5. 
 A, B, C, D.  Improved security, quotas, compression, and encryption are all advantages of 
using NTFS over FAT32. These features are not available in FAT32. The only security you 
have in FAT32 is shared folder permissions. 
6. 
 E.   By giving Tylor Modify on the NTFS security setting, you ’ re giving him just enough to 
do his job. You could also give Sales or Finance the Modify permission, but then everyone 
in those groups would be able to delete, change, and do more than they all need. Also, 
Tylor does not need Full Control to change or delete ﬁ les. 
Answers to Review Questions 
763

764 
Chapter 17 ■ Managing File and Print Services
7. 
 B.   Disk quotas allow you to limit the amount of space on a volume or partition. You can 
set an umbrella quota for all users and then implement individual user ’ s quotas to bypass 
the umbrella quota. 
8. 
 C, E.   The Admin group needs Full Control on the NTFS security and shared permission 
settings in order to do their job. To be able to give other users permissions, you must have 
the Full Control permission. 
9. 
 B.   The Distributed File System (DFS) Namespace service in Windows Server 2008 R2 
offers a simpliﬁ ed way for users to access geographically dispersed ﬁ les. DFS allows you 
to set up a tree structure of virtual directories to allow users to connect to shared folders 
throughout the entire network. 
10.  D.   File servers are used for storage of data, especially for users ’ home folders. Home folders 
are folder locations for your users to store data that is important and that needs to be 
backed up. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 

Monitoring and 
Managing a Network 
Infrastructure  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring File and Print Services  
 Configure backup and restore. May include but is not limited 
to: backup types; backup schedules; managing remotely; 
restoring data; shadow copy services; volume snapshot 
services (VSS); bare metal restore; backup to remote file 
share.  
 Monitoring and Managing a Network Infrastructure  
 Configure Windows Server Update Services (WSUS) server 
settings. May include but is not limited to: update type 
selection; client settings; Group Policy object (GPO); client 
targeting; software updates; test and approval; disconnected 
networks.  
 Configure performance monitoring. May include but is 
not limited to: Data Collector Sets; Performance Monitor; 
Reliability Monitor; monitoring System Stability Index; page 
files; analyze performance data. 
 Configure event logs. May include but is not limited to: 
custom views; application and services logs; subscriptions; 
attaching tasks to events find and filter.  
 Gather network data. May include but is not limited to: 
Simple Network Management Protocol (SNMP); Network 
Monitor; Connection Security Rules monitoring.  

■

■
■
■
■
 Chapter 
18

 In this book, we have discussed how to set up clients on a 
network, and we have discussed how to keep their systems 
running on the network. In this chapter, we will discuss how 
to keep their systems updated using Windows Server Update Services (WSUS). 
 Another important task of an IT team is to keep the network up and running quickly 
and efﬁ ciently. Keeping your network running at its peak performance is one way to make 
sure your end users continue to use the network and its resources without problems or 
interruptions. Remember, everyone has clients — salespeople have theirs, and so do we as 
system administrators. Our clients are the end users. And it ’ s our job to make sure our 
clients can do their jobs. 
 When you are working with servers, it is important that you make sure your system ’ s 
information is safely backed up. Backups become useful when you lose data because of system 
failures, ﬁ le corruptions, or accidental modiﬁ cations of information. As consultants, we can 
tell you from experience that backups are among the most important tasks that an IT person 
performs daily. In this chapter, we ’ ll cover the many different types of backup strategies. 
 Sometimes, performance optimization can feel like a luxury, especially if you can ’ t get 
your domain controllers to the point where they are actually performing the services you 
intended for them, such as servicing printers or allowing users to share and work on ﬁ les. 
The Windows Server 2008 R2 operating system has been speciﬁ cally designed to provide 
high - availability services intended solely to keep your mission - critical applications and 
data accessible even in times of disaster. Occasionally, however, you might experience 
intermittent server crashes on one or more of the domain controllers or other computers in 
your environment. 
 The most common cause of such problems is a hardware conﬁ guration issue. Poorly 
written device drivers and unsupported hardware can cause problems with system stability. 
So can failed hardware components (such as system memory). Memory chips can be faulty, 
electrostatic discharge can ruin them, and other hardware issues can occur. No matter 
what, a problem with your memory chip spells disaster for your server. 
 Usually, third - party hardware vendors provide utility disks with their computers that can 
be used for performing hardware diagnostics on machines to help you ﬁ nd problems. These 
utilities are a good ﬁ rst step to resolving intermittent server crashes. When these utility disks 
are used in combination with the troubleshooting tips provided in this and other chapters of 
this book, you should be able to pinpoint most network - related problems that might occur. 
 In this chapter, we ’ ll cover the tools and methods for measuring performance and 
troubleshooting failures in Windows Server 2008 R2. Before you dive into the technical 
details, however, you should thoroughly understand what you ’ re trying to accomplish and 
how you ’ ll meet this goal.  

 Configuring Windows Server 
Update Services 
 To keep your Windows operating systems up - to - date and secure, you can use Windows 
Update, Automatic Updates, WSUS, and the Microsoft Baseline Security Analyzer: 
 Windows Update attaches to the Microsoft website through a user - initiated process 
and allows Windows users to update their operating systems by downloading updated 
ﬁ les (critical and noncritical software updates).  
 Automatic Updates extends the functionality of Windows Update by automating the 
process of updating critical ﬁ les. With Automatic Updates, you can specify whether 
you want updates to be automatically downloaded and installed or whether you just 
want to be notiﬁ ed when updates are available. 
 Windows Server Update Services is used to deploy a limited version of Windows 
Update to a corporate server, which in turn provides the Windows updates to client 
computers within the corporate network. This allows clients that are limited to what 
they can access through a ﬁ rewall to be able to keep their Windows operating systems 
up - to - date.  
 Microsoft Baseline Security Analyzer (MBSA) is a utility you can download from 
the Microsoft website to ensure that you have the most current security updates.  
 In the following sections, you will learn how to use these tools. 
■
■
■
■
 Knowing How to Locate and Isolate Problems 
 It would be almost impossible to cover everything that could go wrong with your 
Windows Server 2008 R2 system. This book covers many of the most likely and common 
issues you might come across, but almost anything is possible. Make sure you focus on 
the methodology used and the steps to locate and isolate a problem even if you are not 
100 percent sure what the problem may be. Use online resources to help you locate and 
troubleshoot the problem. And don ’ t believe everything you read (some things that are 
posted online can be wrong or misleading); test your changes in a lab environment and 
try to read multiple sources. Always use Microsoft Support ( http://support.microsoft
.com/ ) as one of your sources, because this site is most likely the right source of 
information (since it ’ s the product vendor). You won ’ t be able to ﬁ nd and ﬁ x everything, 
but knowing where to ﬁ nd critical information that will aid you deﬁ nitely won ’ t hurt you 
either. One of the tools that many of us in the industry use is Microsoft TechNet. The full 
version of TechNet (paid subscription) is a resource that will help you ﬁ nd and ﬁ x many 
real - world issues. 
Configuring Windows Server Update Services 
767

768 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 Windows Update 
 Windows Update is available through the Microsoft website and is used to provide the most 
current ﬁ les for Windows operating systems. Examples of updates include security ﬁ xes, 
critical updates, updated help ﬁ les, and updated drivers. 
 You can download Windows Update through the Help And Support page on the 
Microsoft website. Once it ’ s installed, to search for new updates, click the Scan For 
Updates link on the Welcome To Windows Update screen. 
 The results of the Windows Update search will be displayed on the left side of the 
Windows Update screen. You will see the following options: 
 Pick Updates To Install, which lists what updates are available for your computer and 
includes the following categories:  
 Critical Updates And Service Packs  
 Windows Server 2008 R2 Family  
 Driver Updates  
 Review And Install Updates, which allows you to view all updates you have selected to 
install and installs the updates 
 View Installation History, which allows you to track all the updates you have applied 
to your server  
 Personalize Windows Update, which customizes what you see when you use Windows 
Update  
 Get Help And Support, which displays help and support information about Windows 
Update 
 Sometimes the updates that are installed require that the computer be restarted before they 
can take effect. In this event, Windows Update uses a technology called  chained installation . 
With chained installation, all updates that require a computer restart are applied before the 
computer is restarted. This eliminates the need to restart the computer more than once.  
 
The information that is collected by Windows Update includes the 
operating system and version number, the Internet Explorer version, the 
software version information for any software that can be updated through 
Windows Update, the Plug and Play ID numbers for installed hardware, 
and the region and language settings. Windows Update will also collect 
the product ID and product key to confirm you are running a licensed copy 
of Windows, but this information is retained only during the Windows 
Update session and is not stored. No information that can be used to 
personally identify users of the Windows Update service is collected.  
 Windows Automatic Updates 
 The Automatic Updates application extends the functionality of Windows Update by 
automating the update process. With Automatic Updates, Windows Server 2008 R2 
■
■
■
■
■
■
■
■

recognizes when you have an Internet connection and will automatically search for any 
updates for your computer from the Windows Update website. 
 If any updates are identiﬁ ed, they will be downloaded using Background Intelligent 
Transfer Services (BITS). BITS is a bandwidth - throttling technology that allows downloads 
to occur using idle bandwidth only. This means that downloading automatic updates will 
not interfere with any other Internet trafﬁ c. 
 If Automatic Updates detects any updates for your computer, you will see an update icon 
in the notiﬁ cation area of the taskbar.  
 
To configure Automatic Updates, you must have local administrative 
rights to the computer on which Automatic Updates is being configured. 
Requiring administrative rights prevents users from specifying that critical 
security updates not be installed. In addition, Microsoft must digitally sign 
any updates that are downloaded.  
 You conﬁ gure Automatic Updates by selecting Start   Control Panel   Windows 
Update. You will see the Check For Updates button shown in Figure 18.1.  
 F I G U R E 18 .1 Windows Update control panel 
Configuring Windows Server Update Services 
769

770 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 You enable Automatic Updates by clicking the Change Settings link. With this setting 
enabled, Windows Update software may be automatically updated prior to applying any 
other updates (see Figure 18.2).  
 F I G U R E 18 . 2 Change Settings window of the Windows Update control panel 
 Using Windows Server Update Services 
 WSUS, formerly known as Software Update Services (SUS), is used to leverage the 
features of Windows Update within a corporate environment. WSUS downloads Windows 
updates to a corporate server, which in turn provides the updates to the internal corporate 
clients. This allows administrators to test and have full control over what updates are 
deployed within the corporate environment. 
 WSUS is designed to work in medium - sized corporate networks that are not using 
System Center Essentials 2010. 
 We ’ ll cover these topics in the following sections: 
 Advantages of using WSUS  
 WSUS server requirements  
 Conﬁ guring the WSUS servers  
 WSUS client requirements  
 Conﬁ guring the WSUS clients  
■
■
■
■
■

 Advantages of Using WSUS 
 Using WSUS has many advantages: 
 WSUS allows an internal server within a private intranet to act as a virtual Windows 
Update server.  
 Administrators have selective control over what updates are posted and deployed from 
the public Windows Update site. No updates are deployed to client computers unless an 
administrator ﬁ rst approves them.  
 Administrators can control the synchronization of updates from the public Windows 
Update site to the WSUS server either manually or automatically.  
 Administrators can conﬁ gure Automatic Updates on client computers to access the 
local WSUS server as opposed to the public Windows Update site.  
 WSUS checks each update to verify that Microsoft has digitally signed it. Any updates 
that are not digitally signed are discarded.  
 Administrators can selectively specify whether clients can access updated ﬁ les from 
the intranet or from Microsoft ’ s public Windows Update site, which is used to support 
remote clients.  
 Administrators can deploy updates to clients in multiple languages.  
 Administrators can conﬁ gure a WSUS statistics server to log update access, which 
allows them to track which clients have installed updates. The WSUS server and the 
WSUS statistics server can coexist on the same computer.  
 Administrators can manage WSUS servers remotely using HTTP or HTTPS if their 
web browser is Internet Explorer 6.0 or newer.  
 WSUS Server Requirements 
 To act as a WSUS server, the server must meet the following requirements: 
 Must be running Windows 2000 Server with Service Pack 4 or newer, Windows Server 
2003 SP1 or greater, Windows Vista, Windows 7, Windows Server 2008, or Windows 
Server 2008 R2 
 Must have all the most current security patches applied  
 Must be running Internet Information Services (IIS) 6.0 or greater  
 Must be connected to the network  
 Must have an NTFS partition with 100 MB free disk space to install the WSUS server 
software and 6 GB of free space to store all the update ﬁ les  
 Must use BITS version 2.0  
 Must use Microsoft Management Console 3.0  
 Must use Microsoft Report Viewer Redistributable 2008  
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
Configuring Windows Server Update Services 
771

772 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 If your WSUS server meets the following system requirements, it can support up to 
15,000 WSUS clients: 
 Pentium III 700 MHz processor  
 512 MB of RAM 
 Installing the WSUS Server 
 WSUS should run on a dedicated server, meaning the server will not run any other 
applications except IIS, which is required. Microsoft recommends you install a clean or 
new version of Windows Server 2003 SP1 or greater, Windows Server 2008, or Windows 
Server 2008 R2, and apply any service packs or security - related patches. 
 Exercise 18.1 walks you through the installation process for WSUS. This exercise 
requires Internet access to download the free version of WSUS.  
 E X E R C I S E  1 8 .1
Installing a WSUS Server  
 1. 
  Download the WSUS software from the Microsoft website. The URL for accessing the 
WSUS home page is  http://go.microsoft.com/fwlink/?LinkId=47374 . 
 2. 
  Double - click  WSUSSetup.exe to install the WSUS server. 
 3. 
  The welcome screen appears. Click the Next button. 
 4. 
  The Installation Mode Selection page appears. Choose Full Server Installation Including 
Administration Console. Click Next. 
 5. 
  The End - User License Agreement page appears. Carefully read the agreement, and 
select the I Accept The Terms In The License Agreement option. Click the Next button.  
 6. 
  On the Required Components Warning page, click Next. 
 7. 
  The Select Update Source page appears. On this page, you can select the location 
where update ﬁ les will be stored. Make sure the Store Updates Locally box is checked. 
Type the path   C:\WSUS  , and then click Next. 
 8. 
  The Database Options page appears next. Use Existing Windows Internal Database On 
This Computer ( C:\WSUS ) is the default. Leave this default, and click Next.  
 9. 
  The Connecting To SQL Server Instance page appears. Click Next.  
 10.   The Web Site Selection page comes next, where you can choose to serve updates from 
the default IIS installation or create a speciﬁ c WSUS website listening on a different TCP 
port. Since the WSUS server should be dedicated solely to WSUS, you can go with the 
default here. Click Next. 
 If you ’ re already running the IIS server to serve web pages and don ’ t want to change 
that, then you ’ ll need to choose the option to create a WSUS website. 
■
■

 11.   The Ready To Install page appears. The client self - update download URL is 
 http://  yourservername  /selfupdate by default. Click Next to begin the installation. 
 12.   The Completing The Windows Server Update Services Setup Wizard page appears. 
Click the Finish button.  
 Configuring a WSUS Server 
 In Exercise 18.2 you will learn how to set the WSUS server options. The sections that 
follow describe how to set synchronization, approve updates, view the synchronization log, 
view the approval log, and monitor the WSUS server.  
 E X E R C I S E  1 8 . 2
Setting WSUS Server Options 
 1. 
  If the WSUS administration website is not open, you can open it from Internet Explorer 
through the URL  http://   yourservername  /WSUSadmin . 
 2. 
  The Windows Server Update Services page appears. Click Options.  
 3. 
  On the Options page, you can do the following:  
 Select a proxy server conﬁ guration.  
 Specify the name your clients will use to locate this update server.  
 Select which server to synchronize content from (Microsoft Windows Update 
servers or a local Software Update server).  
 Select how you want to handle new versions of previously approved updates, that 
is, whether you want them automatically approved.  
 Select where you want to store updates (maintain the updates on a Windows 
Server Update Services server or save the updates to a local update folder).  
 Select which speciﬁ c products and classiﬁ cations of updates to synchronize. 
 Synchronize installation packages for certain locales (specify locales/languages for 
which you are storing update packages).  
 Click the Save Settings button when you have ﬁ nished with your conﬁ guration 
settings.  
 Setting WSUS Server Synchronization 
 By default, WSUS server synchronization is not deﬁ ned. You can manually synchronize 
your server with the Windows Update server, or you can set a synchronization schedule to 
automate the process.  
■
■
■
■
■
■
■
■
Configuring Windows Server Update Services 
773

774 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 Testing and Approving Updates 
 Before updates can be deployed to WSUS clients, the administrator should test and approve 
the updates. The testing should be done on a test machine that is not used for daily tasks. 
 To approve updates, from the welcome screen, click Updates on the site ’ s toolbar. Make 
your settings on the Updates page that appears.  
 Viewing the Synchronization Log 
 To view the synchronization log, from the welcome screen, click the Reports button on the 
site ’ s toolbar. The Reports page will appear. Click Synchronization Results to view the results.  
 Configuring a Disconnected Network 
 You have the ability to use WSUS on a disconnected network. To do this, you download 
the updates to the Internet - connected WSUS server. After the download is complete, you 
can export the updates and then import the updates to the disconnected network.  
 WSUS Client Requirements 
 WSUS clients run a special version of Automatic Updates that is designed to support WSUS. 
The following enhancements to Automatic Updates are included: 
 Clients can receive updates from a WSUS server as opposed to the public Microsoft 
Windows Update site.  
 The administrator can schedule when the downloading of updated ﬁ les will occur.  
 Clients can be conﬁ gured via Group Policy or through editing the Registry.  
 Updates can occur when an administrative account or nonadministrative account is 
logged on. 
 The following client platforms are the only ones that WSUS currently supports: 
 Windows XP Home Edition (with Service Pack 3)  
 Windows XP Professional (with Service Pack 3)  
 Windows Server 2003 (SP1 or newer)  
 Windows Vista (all platforms)  
 Windows 7 (all platforms)  
 Windows Server 2008 and 2008 R2 (all platforms)  
 Configuring the WSUS Clients 
 You can conﬁ gure WSUS clients in two ways. The method you use depends on whether you 
use Active Directory in your network. 
 In a nonenterprise network (not running Active Directory), you would conﬁ gure 
Automatic Updates through the control panel using the same process that was deﬁ ned in 
the section  “ Windows Automatic Updates ” earlier in this chapter. Each client ’ s Registry 
would then be edited to reﬂ ect the location of the server providing the automatic updates. 
 Within an enterprise network, using Active Directory, you would typically see 
Automatic Updates conﬁ gured through Group Policy. Group policies are used to manage 
■
■
■
■
■
■
■
■
■
■

conﬁ guration and security settings via Active Directory. Group Policy is also used to 
specify what server a client will use for Automatic Updates. If Automatic Updates are 
conﬁ gured through Group Policy, the user will not be able to change Automatic Updates 
settings by choosing Control Panel   System (for XP) or Windows Update (for Windows 7, 
Vista, Windows Server 2008, and Windows Server 2008 R2). 
 Configuring a Client in a Non – Active Directory Network 
 The easiest way to conﬁ gure the client to use Automatic Updates is by using the control 
panel. However, you can also conﬁ gure Automatic Updates through the Registry. The 
Registry is a database of all your server settings; you can access it by choosing Start   Run 
and typing   regedit  in the Run dialog box. Automatic Updates settings are deﬁ ned through 
 HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate\AU . 
 Table 18.1 lists some of the Registry options that you can conﬁ gure for Automatic Updates.   
 TA B L E 18 .1 Selected Registry keys and values for Automatic Updates 
 Registry Key  
  Options for Values  
 NoAutoUpdate 
  0: Automatic Updates are enabled (default).  
 
  1: Automatic Updates are disabled.  
 
  2: Notify of download and installation.  
 
  3: Autodownload and notify of installation.  
 
  4: Autodownload and schedule installation.  
 
  5: Automatic Updates is required but end users can configure.  
 ScheduledInstallDay 
 1: Sunday. 
 
  2: Monday.  
 
  3: Tuesday.  
 
  4: Wednesday.  
 
  5: Thursday. 
 
  6: Friday.  
 
  7: Saturday. 
 UseWUServer 
  0: Use public Microsoft Windows Update site.  
 
  1: Use server specified in  WUServer entry.  
Configuring Windows Server Update Services 
775

776 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 To specify what server will be used as the Windows Update server, you edit two Registry
keys, which are found at  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows
\WindowsUpdate : 
 The  WUServer key sets the Windows Update server using the server ’ s HTTP name, for 
example,  http://intranetSUS . 
 The  WUStatusServer key sets the Windows Update intranet WSUS statistics server by 
using the server ’ s HTTP name, for example,  http://intranetSUS . 
 Configuring a Client in an Active Directory Network 
 If the WSUS client is part of an enterprise network using Active Directory, you would 
conﬁ gure the client via Group Policy. In Exercise 18.3, we will walk through the steps 
needed to conﬁ gure the GPO for WSUS clients. The Group Policy Management Console 
(GPMC) needs to be installed to complete this exercise. If you don ’ t have the GPMC 
installed, you can install it using the Server Manager utility.  
 E X E R C I S E  1 8 . 3
Configuring a GPO for WSUS 
 1. 
  Open the GPMC by clicking Start   Administrative Tools   Group Policy Management.  
 2. 
  Expand the forest, domains, and your domain name. Under your domain name, click 
Default Domain Policy. Right - click, and choose Edit.  
 3. 
  Under the Computer Conﬁ guration section, expand Administrative Templates   
Windows Components   Windows Update.  
 4. 
  In the right pane, double - click the Conﬁ gure Automatic Updates option. The Conﬁ gure 
Automatic Updates Properties dialog box appears. Click the Enabled button. Then in the 
drop - down list, choose Auto Download And Notify For Install. Click OK. 
 The Conﬁ gure Automatic Updating drop - down list has four options:  
 Notify For Download And Notify For Install 
 Auto Download And Notify For Install  
 Auto Download And Schedule The Install  
 Allow Local Admin To Choose Settings 
 The schedule settings apply only if you choose Auto Download And Schedule The 
Install. The settings you can choose are the install day and the install time.  
 5. 
  Double - click Specify Intranet Microsoft Update Service Location Properties. This 
setting allows you to specify the server from which the clients will get the updates. Click 
Enabled. In the two server name boxes, enter  //servername (the name of the server you 
installed WSUS on in Exercise 18.1). Click OK. 
■
■

 6. 
  To conﬁ gure the rescheduling of automatic updates, double - click Reschedule Automatic 
Updates Scheduled Installations. You can enable and schedule the amount of time that 
Automatic Updates waits after system startup before it attempts to proceed with a 
scheduled installation that was previously missed. Click Enabled. Enter  10 in the Startup 
(Minutes) box. Click OK.  
 7. 
  To conﬁ gure auto - restart for scheduled Automatic Updates installations, double - click 
No Auto - Restart For Scheduled Automatic Updates Installations. By enabling this 
option, the computer is not required to restart after an update. Enable this option, and 
click OK.  
 8. 
  Close the GPMC.  
 Overview of Windows Server 2008 R2 
Performance Monitoring 
 The ﬁ rst step in any performance optimization strategy is to accurately and consistently 
measure performance. The insight that you ’ ll gain from monitoring factors such as network 
and system utilization will be extremely useful when you measure the effects of any changes. 
 The overall process of performance monitoring usually involves the following steps: 
 
 1. 
 Establish a baseline of current performance.  
 
 2. 
  Identify the bottleneck(s).  
 
 3. 
  Plan for and implement changes.  
 
 4. 
  Measure the effects of the changes. 
 
 5. 
  Repeat the process, based on business needs.  
 Note that the performance optimization process is never really ﬁ nished because you can 
always try to gain more performance from your system by modifying settings and applying 
other well - known tweaks. Before you get discouraged, realize that you ’ ll reach some level 
of performance that you and your network and system users consider acceptable enough 
that it ’ s not worth the additional effort it ’ ll take to optimize performance further. Also 
note that as your network and system load increases (more users or users doing more), so 
will the need to reiterate this process. By continuing to monitor, measure, and optimize, 
you will keep ahead of the pack and keep your end users happy. 
 Now that you have an idea of the overall process, let ’ s focus on how changes should be 
made. Some important ideas to keep in mind when monitoring performance include the 
following:  
 Plan Changes Carefully  Here ’ s a rule of thumb we always try to follow: An hour 
of planning can save you a week of work. When you are working in an easy - to - use 
GUI - based operating system like Windows Server 2008 R2, it ’ s tempting to randomly 
Overview of Windows Server 2008 R2 Performance Monitoring 
777

778 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
remove a check mark here or there and then retest the performance. You should resist 
the urge to do this because some changes can cause large decreases in performance or 
can impact functionality. Before you make haphazard changes (especially on production 
servers), take the time to learn about, plan for, and test your changes. Plan for outages and 
testing accordingly.  
 Utilize a Test Environment   Test in a test lab that simulates a production environment. 
Do not make changes on production environments without ﬁ rst giving warning. Ideally, 
change production environments in off - hours when fewer network and system users will 
be affected. Making haphazard changes in a production environment can cause serious 
problems. These problems will likely outweigh any beneﬁ ts you could receive from making 
performance tweaks.  
  Make Only One Change at a Time   The golden rule of scientiﬁ c experiments is that 
you should always keep track of as many variables as possible. When the topic is server 
optimization, this roughly translates into making only one change at a time. 
 One of the problems with making multiple system changes is that, although you may have 
improved performance overall, it ’ s hard to determine exactly  which change created the 
positive effects. It ’ s also possible, for example, that changing one parameter increased 
performance greatly, while changing another decreased it slightly. Although the overall 
result was an increase in performance, you should identify the second, performance -
 reducing option so the same mistake is not made again. To reduce the chance of obtaining 
misleading results, always try to make only one change at a time. 
 But the main reason to make one change at a time is that if you do make a mistake or 
create an unexpected issue, you can easily  “ back out ” of the change. If you make two or 
three changes at the same time and are not sure which one created the problem, you will 
have to undo all the changes and then make one alteration at a time to find the problem. 
If you make only one change at a time and follow that methodology every time, you won ’ t 
find yourself in this situation.  
 It ’ s important to remember that many changes (such as Registry changes) 
take place immediately; they do not need to be explicitly applied. Once the 
change is made, it ’ s live. Be careful to plan your changes wisely.  
  Ensure Consistency in Measurements   When you are monitoring performance, consistency 
is extremely important. You should strive to have repeatable and accurate measurements. 
Controlling variables, such as system load at various times during the day, can help. 
 Assume, for instance, that you want to measure the number of transactions that you can 
simulate on the accounting database server within an hour. The results would be widely 
different if you ran the test during the month - end accounting close than if you ran the test 
on a Sunday morning. By running the same tests when the server is under a relatively static 
amount of load, you will be able to get more accurate measurements.  

 Maintain a Performance History   In the introduction to this chapter, we mentioned that 
the performance optimization cycle is a continuous improvement process. Because many 
changes may be made over time, it is important to keep track of the changes that have been 
made and the results you experienced. Documenting this knowledge will help solve similar 
problems if they arise. We understand that many IT professionals do not like to document, 
but documentation can make life much easier in the long run.  
 As you can see, you need to keep a lot of factors in mind when optimizing performance. 
Although this might seem like a lot to digest and remember, do not fear; as a systems 
administrator, you will learn some of the rules you need to know to keep your system 
running optimally. Fortunately, the tools included with Windows Server 2008 R2 can help 
you organize the process and take measurements. Now that you have a good overview of 
the process, let ’ s move on to look at the tools that can be used to set it in motion.  
 Using Windows Server 2008 R2 
Performance Tools 
 Because performance monitoring and optimization are vital functions in network 
environments of any size, Windows Server 2008 R2 includes several performance - related 
tools. 
 Introducing the Reliability and Performance Monitor 
 The ﬁ rst and most useful tool is the Windows Server 2008 R2 Reliability and Performance 
Monitor, which was designed to allow users and systems administrators to monitor 
performance statistics for various operating system parameters. Speciﬁ cally, you 
can collect, store, and analyze information about CPU, memory, disk, and network 
resources using this tool, and these are only a handful of the things you can monitor. By 
collecting and analyzing performance values, system administrators can identify many 
potential problems. As you ’ ll see later in this chapter, you can also use the Reliability 
and Performance Monitor to monitor the performance of your network and its various 
components. 
 You can use the Reliability and Performance Monitor in the following ways:  
 Reliability and Performance Monitor ActiveX Control   The Windows Server 2008 
R2 Reliability and Performance Monitor is an ActiveX control that you can place within 
other applications. Examples of applications that can host the Reliability and Performance 
Monitor control include web browsers and client programs such as Microsoft Ofﬁ ce 
Word 2010 or Excel XP. This functionality can make it easy for applications developers 
and systems administrators to incorporate the Reliability and Performance Monitor into 
their own tools and applications.  
Using Windows Server 2008 R2 Performance Tools 
779

780 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  Reliability and Performance Monitor MMC   For more common performance monitoring 
functions, you ’ ll want to use the built - in Microsoft Management Console (MMC) version 
of the Reliability and Performance Monitor called the Performance Monitor.  
  System Stability Index   The System Stability Index is a numerical value from 1 (least 
stable) to 10 (most stable) that represents the stability of your network. The Reliability and 
Performance Monitor calculates and creates the System Stability Index. You can view a 
graph of this index value. The graph can help a network administrator identify when the 
network started encountering problems. The System Stability Index also offers side - by -
 side comparisons. An administrator can view when system changes occurred (installing 
applications, devices, or drivers) and when system problems started to occur. This way you 
can determine whether any system changes caused the problems that you are encountering.  
  Data Collector Sets   Windows Server 2008 R2 Reliability and Performance Monitor 
includes the new Data Collector Set. This tool works with performance logs, telling 
Performance Monitor where the logs are stored and when the log needs to run. The Data 
Collector Sets also deﬁ ne the credentials used to run the set.  
 To access the Reliability and Performance Monitor MMC, you open Computer 
Management in the Administrative Tools program group within your Start menu. This 
launches the Reliability and Performance MMC and loads and initializes Reliability and 
Performance Monitor with a handful of default counters. 
 You can choose from many different methods of monitoring performance when you are 
using Performance Monitor. A couple of examples are listed here: 
 You can look at a snapshot of current activity for a few of the most important 
counters; this allows you to ﬁ nd areas of potential bottlenecks and monitor the load on 
your servers at a certain point in time. 
 You can save information to a log ﬁ le for historical reporting and later analysis. This 
type of information is useful, for example, if you want to compare the load on your 
servers from three months ago to the current load.  
 You ’ ll get to take a closer look at this method and many others as you examine 
Performance Monitor in more detail. 
 In the following sections, you ’ ll learn about the basics of working with the Windows 
Server 2008 R2 Performance Monitor and other performance tools. Then, you ’ ll apply 
these tools and techniques when you monitor the performance of your network.  
 Your Performance Monitor grows as your system grows, and whenever 
you add services to Windows Server 2008 R2 (such as installing Exchange 
Server 2010), you also add to what you can monitor. You should make sure 
that, as you install services, you take a look at what it is you can monitor.  
 Deciding What to Monitor 
 The ﬁ rst step in monitoring performance is to decide  what you want to monitor. In 
Windows Server 2008 R2, the operating system and related services include hundreds of 
■
■

performance statistics that you can track easily. For example, you may want to monitor 
IPSec by monitoring Connection Security Rules. This is just one of many items that can be 
monitored. All performance statistics fall into three main categories that you can choose to 
measure:  
 Performance Objects   A performance object within Performance Monitor is a collection 
of various performance statistics that you can monitor. Performance objects are based 
on various areas of system resources. For example, there are performance objects for the 
processor and memory, as well as for speciﬁ c services such as web services.  
 Counters   Counters are the actual parameters measured by Performance Monitor. They 
are speciﬁ c items that are grouped within performance objects. For example, within the 
Processor performance object, there is a counter for % Processor Time. This counter 
displays one type of detailed information about the Processor performance object 
(speciﬁ cally, the amount of total CPU time all the processes on the system are using). 
Another set of counters you can use will allow you to monitor print servers.  
 Instances   Some counters will have  instances . An instance further identiﬁ es which 
performance parameter the counter is measuring. A simple example is a server with two 
CPUs. If you decide you want to monitor processor usage (using the Processor performance 
object) — speciﬁ cally, utilization (the % Total Utilization counter) — you must still specify 
 which CPU(s) you want to measure. In this example, you would have the choice of 
monitoring either of the two CPUs or a total value for both (using the Total instance).  
 To specify which performance objects, counters, and instances you want to monitor, 
you add them to Performance Monitor using the Add Counters dialog box. Figure 18.3 
shows the various options that are available when you add new counters to monitor using 
Performance Monitor. 
 The items that you will be able to monitor will be based on your hardware and software 
conﬁ guration. For example, if you have not installed and conﬁ gured the IIS, the options 
available within the Web Server performance object will not be available. Or, if you have 
multiple network adapters or CPUs in the server, you will have the option of viewing each 
instance separately or as part of the total value. You ’ ll see which counters are generally 
most useful later in this chapter.  
 Viewing Performance Information 
 The Windows Server 2008 R2 Performance Monitor was designed to show 
information in a clear and easy - to - understand format. Performance objects, counters, 
and instances may be displayed in each of three views. This ﬂ exibility allows systems 
administrators to quickly and easily deﬁ ne the information they want to see once and then 
choose how it will be displayed based on speciﬁ c needs. Most likely you will use only one 
view, but it ’ s helpful to know what other views are available depending on what it is you 
are trying to assess.  
Using Windows Server 2008 R2 Performance Tools 
781

782 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 You can use the following main views to review statistics and information on performance:  
  Graph View   The Graph view is the default display that is presented when you ﬁ rst access the 
Windows Server 2008 R2 Performance Monitor. The chart displays values using the vertical 
axis and time using the horizontal axis. This view is useful if you want to display values over 
a period of time or see the changes in these values over that time period. Each point that is 
plotted on the graph is based on an average value calculated during the sample interval for 
the measurement being made. For example, you may notice overall CPU utilization starting 
at a low value at the beginning of the chart and then becoming much higher during later 
measurements. This indicates that the server has become busier (speciﬁ cally, with CPU -
 intensive processes). Figure 18.4 provides an example of the Graph view.  
 A quick way to get to the Performance Console and view Performance 
Monitor is to select Start   Run and enter  perfmon in the Open box. The 
Performance Console opens directly to Performance Monitor.  
  Histogram View   The Histogram view shows performance statistics and information using 
a set of relative bar charts. This view is useful if you want to see a snapshot of the latest 
value for a given counter. For example, if you were interested in viewing a snapshot of 
current system performance statistics during each refresh interval, the length of each of the 
bars in the display would give you a visual representation of each value. It would also allow 
you to visually compare measurements relative to each other. You can set the histogram to 
display an average measurement as well as minimum and maximum thresholds. Figure 18.5 
shows a typical Histogram view.  
 F I G U R E  18 . 3 Adding a new Performance Monitor counter 

 F I G U R E 18 . 4 Viewing information in Performance Monitor Graph view 
 F I G U R E 18 . 5 Viewing information in Performance Monitor Histogram view 
Using Windows Server 2008 R2 Performance Tools 
783

784 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  Report View   Like the Histogram view, the Report view shows performance statistics 
based on the latest measurement. You can see an average measurement as well as minimum 
and maximum thresholds. This view is most useful for determining exact values because 
it provides information in numeric terms, whereas the Chart and Histogram views provide 
information graphically. Figure 18.6 provides an example of the type of information you ’ ll 
see in the Report view.  
 F I G U R E 18 .6 Viewing information in Performance Monitor Report view 
 Managing Performance Monitor Properties 
 You can specify additional settings for viewing performance information within the 
properties of Performance Monitor. You can access these options by clicking the Properties 
button in the taskbar or by right - clicking the Performance Monitor display and selecting 
Properties. You can change these additional settings by using the following tabs:  
  General Tab   On the General tab (shown in Figure 18.7), you can specify several options 
that relate to Performance Monitor views: 
 You can enable or disable legends (which display information about the various 
counters), the value bar, and the toolbar.  
 For the Report and Histogram views, you can choose which type of information is 
displayed. The options are Default, Current, Minimum, Maximum, and Average. 
What you see with each of these options depends on the type of data being collected. 
These options are not available for the Graph view, because the Graph view displays an 
average value over a period of time (the sample interval).  
■
■

 You can also choose the graph elements. By default, the display will be set to update 
every second. If you want to update less often, you should increase the number of 
seconds between updates.  
 Source Tab   On the Source tab (shown in Figure 18.8), you can specify the source for the 
performance information you want to view. Options include current activity (the default 
setting) or data from a log ﬁ le. If you choose to analyze information from a log ﬁ le, you 
can also specify the time range for which you want to view statistics. We ’ ll cover these 
selections in the next section.   
■
 F I G U R E 18 .7 General tab of Performance Monitor Properties dialog box 
 F I G U R E  18 . 8 Source tab of Performance Monitor Properties dialog box 
Using Windows Server 2008 R2 Performance Tools 
785

786 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  Data Tab   The Data tab (shown in Figure 18.9) lists the counters that have been added to 
the Performance Monitor display. These counters apply to the Chart, Histogram, and Report 
views. Using this interface, you can also add or remove any of the counters and change the 
properties, such as the width, style, and color of the line and the scale used for display. 
  Graph Tab  On the Graph tab (shown in Figure 18.10), you can specify certain options that 
will allow you to customize the display of Performance Monitor views. First you can specify 
what type of view you want to see (Line, Histogram, or Report). Then you can add a title 
for the graph, specify a label for the vertical axis, choose to display grids, and specify the 
vertical scale range. 
 F I G U R E 18 . 9 The Data tab of Performance Monitor Properties dialog box 
 F I G U R E 18 .10 The Graph tab of Performance Monitor Properties dialog box 

 Appearance Tab   Using the Appearance tab (see Figure 18.11), you can specify the 
colors for the areas of the display, such as the background and foreground. You can also 
specify the fonts that are used to display counter values in Performance Monitor views. 
You can change settings to ﬁ nd a suitable balance between readability and the amount of 
information shown on one screen. Finally, you can set up the properties for a border.  
 F I G U R E 18 .11 The Appearance tab of Performance Monitor Properties dialog box 
 Now that you have an idea of the types of information Performance Monitor tracks 
and how this data is displayed, take a look at another feature — saving and analyzing 
performance data.  
 Saving and Analyzing Data with Performance Logs and Alerts 
 One of the most important aspects of monitoring performance is that it should be done over 
a given period of time (referred to as a  baseline ). So far, we have discussed how you can use 
Performance Monitor to view statistics in real time. We have, however, also alluded to 
using Performance Monitor to save data for later analysis. Now let ’ s take a look at how 
you can do this. 
 When viewing information in Performance Monitor, you have two main options with 
respect to the data on display:  
 View Current Activity   When you ﬁ rst open the Performance icon from the Administrative 
Tools folder, the default option is to view data obtained from current system information. 
This method of viewing measures and displays various real - time statistics on the system ’ s 
performance. 
 View Log File Data   This option allows you to view information that was previously saved 
to a log ﬁ le. Although the performance objects, counters, and instances may appear to be 
Using Windows Server 2008 R2 Performance Tools 
787

788 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
the same as those viewed using the View Current Activity option, the information itself was 
actually captured at a previous point in time and stored into a log ﬁ le.  
 Log ﬁ les for the View Log File Data option are created in the Performance Logs and 
Alerts section of the Windows Server 2008 R2 Performance tool. 
 Three items allow you to customize how the data is collected in the log ﬁ les:  
  Counter Logs   Counter logs record performance statistics based on the various 
performance objects, counters, and instances available in Performance Monitor. The values 
are updated based on a time interval setting and are saved to a ﬁ le for later analysis.  
  Circular Logging   In  circular logging , the data that is stored within a ﬁ le is overwritten as 
new data is entered into the log. This is a useful method of logging if you want to record 
information only for a certain time frame (for example, the past four hours). Circular 
logging also conserves disk space by ensuring that the performance log ﬁ le will not 
continue to grow over certain limits.  
  Linear Logging   In linear logging, data is never deleted from the log ﬁ les, and new 
information is added to the end of the log ﬁ le. The result is a log ﬁ le that continually grows. 
The beneﬁ t is that all historical information is retained.  
 Now that you have an idea of the types of functions that are supported by the Windows 
Server 2008 R2 Performance tools, you can learn how you can apply this information to 
the task at hand — monitoring and troubleshooting your Windows network.  
 Real - World Performance Monitoring 
 In our daily jobs as systems engineers and administrators, we come across systems 
that are in need of our help. . .and may even ask for it. You, of course, check your Event 
Viewer and Performance Monitor and perform other tasks that help you troubleshoot. 
But what is really the most common problem that occurs? From our experience, we ’ d 
say that many times you suffer performance problems if you have your Windows Server 
2008 R2 operating system installed on a subpar system. Either the server hardware 
isn ’ t enterprise class or the minimum hardware requirements weren ’ t addressed. Most 
production servers suffer from slow response times, lagging, and so on, because money 
wasn ’ t spent where it should have been — on the server ’ s hardware requirements. 
 Take a look at  http://www.microsoft.com/windowsserver2008/en/us/system-
requirements.aspx to see the minimum Windows Server 2008 R2 requirements. You 
have to make sure you follow these minimum requirements. That ’ s not all, though; as you 
will see in this chapter, most times the minimum requirements are just that — the bare 
minimum and not necessarily good enough, especially if you are running many services 
on your server or you have many network clients that will access the server. 

 Using Other Performance - Monitoring Tools 
 Performance Monitor allows you to monitor different parameters of the Windows Server 
2008 R2 operating system and associated services and applications. However, you can 
also use three other tools to monitor performance in Windows Server 2008 R2. They are 
Network Monitor, Task Manager, and Event Viewer. All three of these tools are useful for 
monitoring different areas of overall system performance and for examining details related 
to speciﬁ c system events. In the following sections, you ’ ll take a quick look at these tools 
and how you can best use them. 
 The Network Monitor 
 Although Performance Monitor is a great tool for viewing overall network performance 
statistics, it isn ’ t equipped for packet - level analysis and doesn ’ t give you much insight into 
what types of network trafﬁ c are traveling on the wire. That ’ s where the Network Monitor 
tool comes in. Network Monitor has two main components: the Network Monitor Agent 
and the Network Monitor tool. 
 The Network Monitor Agent is available for use with Windows XP, Server 2003, 
Windows Vista, Windows 7, Server 2008, and Server 2008 R2. The agent allows you to 
track network packets. When you install the Network Monitor Agent, you will also be able 
to access the Network Segment System Monitor counter. 
 Would you drive a truck over a glass bridge? No. Then why would you run an enterprise -
 class server operating system hosting a mission - critical application such as Active 
Directory, email, and messaging on an antiquated desktop system? This seems illogical 
when you read it, but in practice, it ’ s common to ﬁ nd budgets squeezed to the point 
where your secondary domain controller is running on a high - end desktop. Just make 
sure you consider this when you deploy a new system. Once you deploy it, open 
Performance Monitor, and see whether you are having issues just opening and running 
programs on the server itself. 
 It ’ s also common to blame the network ﬁ rst, but that is usually not the problem at all. Be 
careful of false positives, and keep your mind focused on ﬁ nding the root of the problem. 
If you come across other problems, document them, but continue to focus on ﬁ nding 
(and ﬁ xing) the real issue. 
 If your enterprise - level servers aren ’ t running with Redundant Array of Independent 
Disks (RAID), then you will most likely need an upgrade on your system hardware. Most 
enterprise - level server systems come with RAID as the minimum fault tolerance you 
should have on any server of any size. RAID can help you in a pinch; when you lose a 
disk — and you will, based on the Mean Time Between Failure (MTBF) — you can quickly 
recover with minimal downtime and no loss of data. 
Using Windows Server 2008 R2 Performance Tools 
789

790 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 On Windows Server 2008 R2 computers, you ’ ll see the Network Monitor icon appear in 
the Administrative Tools program group. You can use the Network Monitor tool to capture 
data as it travels on your network.  
 A version of Network Monitor is available for free with Windows 
Server 2008 R2. The full version of Network Monitor is available at 
Microsoft ’ s download server. For more information, see  www.microsoft
.com/downloads/ . 
 Once you have captured the data of interest, you can save it to a capture ﬁ le or further 
analyze it using Network Monitor. Experienced network and systems administrators can 
use this information to determine how applications are communicating and the types of 
data that are being passed via the network.  
 
For the exam, you don ’ t need to understand the detailed information 
that Network Monitor displays, but you should be aware of the types of 
information that you can view and when you should use Network Monitor.  
 Task Manager 
 Performance Monitor is designed to allow you to keep track of speciﬁ c aspects of 
system performance over time. But what do you do if you want to get a quick snapshot of 
what the local system is doing? Creating a System Monitor chart, adding counters, and 
choosing a view is overkill. Fortunately, the Windows Server 2008 R2 Task Manager has 
been designed to provide a quick overview of important system performance statistics 
without requiring any conﬁ guration. Better yet, it ’ s always readily available. 
 You can easily access Task Manager in several ways: 
 Right - click the Windows taskbar, and then click Task Manager.  
 Press Ctrl+Alt+Del, and then select Task Manager.  
 Press Ctrl+Shift+Esc.  
 Each of these methods allows you to quickly access a snapshot of the current system 
performance. 
 Once you access Task Manager, you will see the following six tabs:  
  Applications Tab   The Applications tab (see Figure 18.12) lists the applications 
currently running on the local computer. This is a good place to determine which programs 
are running on the system. You can also use this tab to shut down any applications whose 
status is listed as Not Responding (meaning either that the application has crashed or that 
it is performing operations and not responding to Windows Server 2008 R2).  
  Processes Tab   The Processes tab shows you all the processes that are currently running 
on the local computer. By default, you ’ ll be able to view how much CPU time and memory 
a particular process is using. By clicking any of the columns, you can quickly sort by the 
■
■
■

data values in that particular column. This is useful, for example, if you want to ﬁ nd out 
which processes are using the most memory on your server. 
 By accessing the performance objects in the View menu, you can add columns to the 
Processes tab. Figure 18.13 shows a list of the current processes running on a Windows 
Server 2008 R2 computer.  
 F I G U R E 18 .12 The Applications tab of Task Manager 
 F I G U R E 18 .13 Viewing process statistics and information using Task Manager 
Using Windows Server 2008 R2 Performance Tools 
791

792 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  Services Tab   The Services tab (see Figure 18.14) shows you what services are currently 
running on the system. From this location you can stop a service from running by right -
 clicking the service and choosing Stop. The Services button launches the Services MMC.  
  Performance Tab   One of the problems with using Performance Monitor to get a quick 
snapshot of system performance is that you have to add counters to a chart. Most systems 
administrators are too busy to take the time to do this when all they need is basic CPU 
and memory information. That ’ s where the Performance tab of the Task Manager comes 
in. Using the Performance tab, you can view details about how memory is allocated on the 
computer and how much of the CPU is utilized (see Figure 18.15).  
  Networking Tab   Like the Performance tab, the Networking tab (see Figure 18.16) 
displays a graph of the current network utilization. The active connections are displayed 
at the bottom of the tab along with their connection speed, percentage of utilization, 
and status. The graph in the top part of the tab displays the percentage of utilization in real 
time. 
  Users Tab   The Users tab (see Figure 18.17) lists the currently active user accounts. 
This is particularly helpful if you want to see who is online and quickly log off or 
disconnect users. You can also send a console message to any remote user in the list by 
clicking the Send Message button. (The button is grayed out in Figure 18.15 because 
you cannot send a message to yourself. If you select a different user, the button will be 
available.)  
 F I G U R E 18 .14 Viewing services information using Task Manager 

 F I G U R E 18 .15 Viewing CPU and memory performance information using 
Task Manager 
 F I G U R E 18 .16 Viewing network information using Task Manager 
Using Windows Server 2008 R2 Performance Tools 
793

794 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 As you can see, Task Manager is useful for quickly providing important information 
about the system. Once you get used to using Task Manager, you won ’ t be able to get by 
without it!  
 Make sure you use Task Manager and familiarize yourself with all that 
it can do; you can end processes that have become intermittent, kill 
applications that may hang the system, view NIC performance, and so on. 
In addition, you can access this tool quickly to get an idea of what could be 
causing you problems. Event Viewer, Network Monitor, and Performance 
Monitor are all great tools for getting granular information on potential 
problems.  
 Event Viewer 
 Event Viewer is also useful for monitoring network information. Speciﬁ cally, you can 
use the logs to view any information, warnings, or alerts related to the proper functioning 
of the network. You can access Event Viewer by selecting Start   Programs   Administrative 
Tools   Event Viewer. Clicking any of the items in the left pane displays the various events 
that have been logged for each item. Figure 18.18 shows the contents of the Directory 
Service log. 
 Each event is preceded by a blue  “ i ” icon. That icon designates that these events are 
informational and do not indicate problems with the network. Rather, they record benign 
events such as Active Directory startup or a domain controller ﬁ nding a Global Catalog server.  
 F I G U R E 18 .17 Viewing user information using Task Manager 

 Problematic or potentially problematic events are indicated by a yellow warning icon 
or a red error icon, both of which are shown in Figure 18.19. Warnings usually indicate 
a problem that wouldn ’ t prevent a service from running but might cause undesired 
effects with the service in question. For example, we were conﬁ guring a site with some 
ﬁ ctional domain controllers and IP addresses. Our local domain controller ’ s IP address 
wasn ’ t associated with any of the sites, and Event Viewer generated a warning. In this 
case, the local domain controller could still function as a domain controller, but the site 
conﬁ guration could produce undesirable results. 
 Error events almost always indicate a failed service, application, or function. For 
instance, if the dynamic registration of a DNS client fails, Event Viewer will generate an 
error. As you can see, errors are more severe than warnings, because in this case, the DNS 
client cannot participate in DNS at all. 
 Double - clicking any event opens the event ’ s Properties dialog box, as shown in 
Figure 18.20. The Event Properties dialog box displays a detailed description of the event. 
 Event Viewer can display thousands of different events, so it would be impossible to list 
them all here. The important points to be aware of are the following: 
 Information events are always benign.  
 Warnings indicate noncritical problems.  
 Errors indicate show - stopping events.  
■
■
■
 F I G U R E 18 .18 The Directory Service log in Event Viewer 
Using Windows Server 2008 R2 Performance Tools 
795

796 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 F I G U R E 18 .19 Information, errors, and warnings in Event Viewer 
 F I G U R E 18 . 2 0 An Event Properties dialog box 

 Let ’ s discuss some of the logs and ways you can view data:  
 Applications and Services   The applications and services logs are part of Event Viewer 
where applications (for example, Exchange) and services (DNS) log their events. In Chapter 8, 
 “ Conﬁ guring Group Policy Objects, ”  we showed how to install and work with DFS. DFS 
events would be logged in this part of Event Viewer. An important log in this section is the 
DNS Server log (see Figure 18.21). This is where all your DNS events get stored.  
 F I G U R E 18 . 21 The applications and services DNS Server log 
 Custom Views   Custom views allow you to ﬁ lter events (see Figure 18.22) to create your 
own customized look. You can ﬁ lter events by event level (critical, error, warning, and so 
on), by logs, and by source. You also have the ability to view events occurring within a 
speciﬁ c time frame. This allows you to look only at the events that are important to you.  
 Subscriptions   Subscriptions allow a user to receive alerts about events that you predeﬁ ne. 
In the Subscription Properties dialog box (see Figure 18.23), you can deﬁ ne what type of 
events you want notiﬁ cations of and the notiﬁ cation method. The Subscriptions section is 
an advanced alerting service to help you watch for events.  
Using Windows Server 2008 R2 Performance Tools 
797

798 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 F I G U R E 18 . 2 2 Create Custom View dialog box 
 F I G U R E 18 . 2 3 Subscription Properties dialog box 

 Microsoft Baseline Security Analyzer 
 The MBSA is a security assessment utility that you can download from the Microsoft 
website. The ﬁ lename of the download is  mbsasetup.msi . It veriﬁ es whether your computer 
has the latest security updates and whether any common security violation conﬁ gurations 
have been applied to your computer. MBSA can scan the following programs and operating 
systems: 
 Windows 2000  
 Windows XP  
 Windows Vista  
 Windows 7  
 Windows Server 2003  
 Windows Server 2008  
 Windows Server 2008 R2  
 IIS 5 or newer  
 Internet Explorer, versions 6.0 and newer  
 SQL Server 7 or newer  
 Microsoft Ofﬁ ce 2000 or newer  
 Windows Media Player, versions 6.4 and newer  
 To use MBSA, the computer must meet the following requirements: 
 Must be running Windows XP, Vista, Windows 7, Windows Server 2003, Windows 
Server 2008, or Windows Server 2008 R2  
 Must be running Internet Explorer 5.01 or newer  
 Must have an XML parser installed for full functionality  
 Must have the Workstation and the Server service enabled  
 Must have Client for Microsoft Networks installed  
 Using the GUI Version of MBSA 
 Once you have installed MBSA, you can access it by selecting Start   All Programs   
Microsoft Baseline Security Analyzer or by opening the command prompt and executing 
 mbsa.exe . This opens the Baseline Security Analyzer utility, shown in Figure 18.24. You 
can select from Scan A Computer, Scan More Than One Computer, and View Existing 
Security Reports.  
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
Using Windows Server 2008 R2 Performance Tools 
799

800 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 When you click Scan A Computer, the Pick A Computer To Scan dialog box appears. 
You can specify that you want to scan a computer based on a computer name or IP 
address. You can also specify the name of the security report that will be generated. 
 The following are options for the security scan: 
 Check For Windows Vulnerabilities  
 Check For Weak Passwords  
 Check For IIS Vulnerabilities  
 Check For SQL Vulnerabilities  
 Check For Security Updates (if you use this option and are using WSUS, you 
can specify the name of the WSUS server that should be checked for the security 
updates)  
 Once you have made your selections, click Start Scan. When the scan is complete, the 
security report will be automatically displayed. If you have scanned multiple computers, 
you can sort the security reports based on issue name or score (worst ﬁ rst or best ﬁ rst).  
 Using the MBSA Command - Line Utility  mbsacli.exe 
 The MBSA command - line utility is located in   Drive:  \ProgramFiles\
MicrosoftBaselineSecurityAnalyzer . You can specify several options. Enter 
   mbsacli.exe/hf  , and then customize the command execution with any of the options 
deﬁ ned in Table 18.2. 
■
■
■
■
■
 F I G U R E 18 . 2 4 Baseline Security Analyzer 

 Simple Network Management Protocol 
 The Simple Network Management Protocol (SNMP) is a TCP/IP protocol monitor. The 
SNMP service creates trap messages that are then sent to a trap destination. One way you 
might use SNMP is to trap messages that don ’ t contain an appropriate hostname for a 
particular service. 
 When you set up SNMP, you set up communities.  Communities are groupings of 
computers that help monitor each other. 
 Windows Server 2008 R2 includes SNMP with the operating system. To install the 
service, you must use Server Manager. In Exercise 18.4, we will walk you through 
the process of installing the SNMP service.  
 E X E R C I S E  1 8 . 4
Installing SNMP  
 1. 
  Open Server Manager by clicking Start   Administrative Tools   Server Manager. 
 2. 
  In the left pane, click Features. 
 3. 
  In the right pane, click Add Features. 
 4. 
  When the Select Features window appears, click the SNMP Services check box. Click Next. 
 5. 
  The Conﬁ rm Installation page appears. Click Install. 
 6. 
  Click Close. Exit the Server Manager application.  
 TA B L E 18 . 2   mbsacli.exe /hf command - line options 
 Option  
  Description  
  - h  host name
[, host name, . . .]  
 Scans the specified host. You can specify that you want to scan 
multiple host computers by separating the hostnames with commas.  
  - fh  filename  
 Scans the NetBIOS names of each computer that is to be scanned 
and saves the information as text within a file specified by 
 filename  . 
  - i  xxxx.xxxx.xxxx
.xxxx[, xxxx.xxxx
.xxxx.xxxx, . . .]  
 Scans a computer based on the specified IP address. You can 
scan multiple computers by IP address by separating the 
IP addresses with commas. 
  - fip  filename  
 Looks in the text file specified by  filename   for IP addresses and 
scans the computers with those IP addresses. The file can have 
up to a maximum of 256 IP addresses. 
  - d  domainname  
 Scans the specified domain.  
  - n 
  Scans all of the computers on the local network. 
Using Windows Server 2008 R2 Performance Tools 
801

802 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 Now that you have installed the SNMP service, you have to set up your community 
so that you can start trapping messages. As stated earlier, communities are a grouping of 
computers to help monitor each other. After you have created the initial community, you 
can add other computer systems to the community. 
 In Exercise 18.5, we will walk you through the steps to set up the SNMP service and 
also set up your ﬁ rst community name. To complete this exercise, you must have completed 
Exercise 18.4.  
 E X E R C I S E  1 8 . 5
Configuring SNMP  
 1. 
  Open Computer Management by clicking Start   Administrative Tools   Computer 
Management.  
 2. 
  Expand Services And Applications. Click Services. In the right pane, double - click SNMP 
Service.  
 3. 
  The SNMP Service Properties window will open. Click the Traps tab. In the Community 
Name box, enter  Community1 . Click the Add To List button. 
 4. 
  Click the General tab. Click the Start button to start the service. Click OK. 
 5. 
  Close Computer Management. 
 Backup and Recovery 
 If you have deployed ﬁ le and application servers in your network environment, your 
users now depend on them to function properly in order to do their jobs, from network 
authentications to ﬁ le access to print and web services. Therefore, the importance of 
backing up the network servers should be evident. 
 It is important to have multiple servers available to provide backup in case of a problem. 
The same goes for Active Directory itself — it too should be backed up by being saved. This 
way, if there is a massive disaster after which you need to restore your directory services, 
you will have that option available to you. 
 The process of reformatting a computer from scratch after a catastrophic system failure 
is known as a bare metal restore. This process usually involves reinstalling the operating 
system and all the system software.  
 Back up and restore are discussed in detail in Chapter 10:  “ Active Directory 
Optimization and Reliability. ” 

 Wbadmin Command Line Utility 
 In Chapter 10, we ﬁ rst started to discuss the wbadmin command. The wbadmin command 
allows you to back up and restore your operating system, volumes, ﬁ les, folders, and 
applications from a command prompt. 
 You must be a member of the Administrators group to conﬁ gure a backup schedule. You 
must be a member of the Backup Operators or the Administrators group (or you must have been 
delegated the appropriate permissions) to perform all other tasks using the wbadmin command. 
 To use the wbadmin command, you must run wbadmin from an elevated command 
prompt (to open an elevated command prompt, click Start, right - click Command Prompt, 
and then click Run as administrator). Table 18.3 shows some of the wbadmin commands. 
 TA B L E 18 . 3 Wbadmin commands 
 Command  
  Description  
 Wbadmin enable backup 
 Configures and enables a daily backup schedule. 
 Wbadmin disable backup 
 Disables your daily backups.  
 Wbadmin start backup 
 Runs a one - time backup. 
 Wbadmin stop job 
 Stops the currently running backup or recovery 
operation.  
 Wbadmin get items 
 Lists the items included in a specific backup. 
 Wbadmin start recovery 
 Runs a recovery of the volumes, applications, 
files, or folders specified.  
 Wbadmin get status 
 Shows the status of the currently running backup 
or recovery operation. 
 Wbadmin start systemstaterecovery  Runs a system state recovery.  
 Wbadmin start systemstatebackup 
 Runs a system state backup.  
 Wbadmin start sysrecovery 
 Runs a recovery of the full system state.  
 Understanding Shadow Copies 
 An excellent way to protect your shared folders is by using  shadow copies (Volume 
Snapshot Service [VSS]). Shadow copies allow an administrator to back up shared folders 
to a remote location. Shadow copies are designed to help recover ﬁ les that were accidentally 
Understanding Shadow Copies 
803

804 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
deleted, were overwritten, or have become corrupt. One major advantage to shadow copies 
is that open ﬁ les can be backed up. This means that even if users are currently working on 
ﬁ les in a shared folder that has shadow copies enabled, the shadow copies will continue to 
function. 
 Once administrators have conﬁ gured and enabled shadow copies (using the Computer 
Management snap - in), network users can restore earlier versions of ﬁ les. After the initial 
shadow copy of the shared folder is created, only changes are copied and not the entire ﬁ le. 
 You can enable shadow copies of entire volumes. 
 The following are some of the settings you can conﬁ gure when setting up shadow copies:  
  Schedule   You have the ability to set the schedule of the shadow copies. You can set 
this schedule to run daily, weekly, monthly, once, at system startup, at logon, or when the 
system is idle. You can also set the time at which the shadow copy will run.  
  Storage Locations   An administrator needs to set the location of the shadow copy backup. 
If you are on a network, it is a good idea to place the shadow copy on a network drive.  
  Maximum Size   You can set a maximum size on your shadow copies, or you can specify 
that they have no size limit. One of the predetermined settings is 64 shadow copies per 
volume.  
 In Exercise 18.6, you ’ ll set up a volume to make shadow copies every Monday at 7 a.m. 
To set up the shadow copies, you will use the Computer Management MMC snap - in.  
 E X E R C I S E  1 8 . 6
Configuring a Shadow Copy on a Volume  
 1. 
  Open Computer Management by clicking Start   Administrative Tools   Computer 
Management.  
 2. 
  Expand Storage, and then right - click Disk Management. Choose All Tasks   Conﬁ gure 
Shadow Copies. 
 3. 
  When the Shadow Copies dialog box appears, click the Settings button.  
 4. 
  When the Settings windows appears, click the Schedule button. 
 5. 
  In the Schedule window, set the schedule task to weekly and the start time for 7 a.m. 
Uncheck all the days - of - the - week boxes except Mon. Click OK.  
 6. 
  When the Settings window reappears, click OK.  
 7. 
  If the Enable button is enabled, click it. Then click OK.  
 8. 
  Exit the Computer Management MMC. 
 To recover a previous version of a ﬁ le from a shadow copy, you use the  \\servername\
sharename  path. The operating system determines how you will gain access to the shared 
folders and shadow copies. Shadow copies are built into Windows XP (SP1), Windows 

Vista, Windows 7, Windows Server 2003, Windows Server 2008, and Windows Server 
2008 R2. If you are using a different Microsoft operating system, you need to download 
the Shadow Copy Client Pack from the Microsoft download center.  
 Summary 
 We started this chapter with a discussion on WSUS and what Windows Update can do for 
your network. We discussed why you would want to use a WSUS server instead of having 
clients manually connect to the Internet to receive their updates. 
 In this chapter, we also covered ﬁ le server and print server optimization and reliability, 
including many tools that can help you monitor and manage your systems, and the basics 
of troubleshooting the network in times of disaster. 
 Monitoring performance on servers is imperative to rooting out any issues that may 
affect your network. If your systems are not running at their best, your end users 
may experience issues such as latency — or, worse, you may experience corruption in your 
network data. Either way, it ’ s important to know how to monitor the performance of 
your servers. In this chapter, we also looked at ways systems administrators can optimize 
the operations of servers to ensure that end users experience adequate performance. 
 We also looked at how to use the various performance - related tools that are included 
with Windows Server 2008 R2. Tools such as Performance Monitor, Task Manager, 
Network Monitor, and Event Viewer can help you diagnose and troubleshoot system 
performance issues. These tools will help you ﬁ nd typical problems related to memory, disk 
space, and any other hardware - related issues you may experience. Knowing how to use 
tools to troubleshoot and test your systems is imperative not only to passing the exam but 
also to performing your duties at work. To have a smoothly running network environment, 
it is vital that you understand the issues related to the reliability and performance of your 
network servers and domain controllers. 
 We also covered the details of performing backups, the most commonly used form 
of reliability you can implement. You learned how to back up and restore data using the 
Windows Server 2008 R2 Backup utility. Through the use of wizards and prompts, this 
backup tool can simplify an otherwise tedious process. Knowing how to restore data can 
really put you a cut above the rest, especially in times of disaster. Finally, we discussed 
shadow copies and how you can set up shadow copies to run at speciﬁ c intervals.  
 Exam Essentials  
 Understand WSUS.   Windows Server Update Services is one way to have your end users 
receive important updates from Microsoft. WSUS gives administrators the ability to 
download, test, and approve updates before they get released onto the network.  
Exam Essentials 
805

806 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  Understand the methodology behind troubleshooting performance.   By following a set of 
steps that involves making measurements and ﬁ nding bottlenecks, you can systematically 
troubleshoot performance problems.  
  Be familiar with the features and capabilities of the Windows Server 2008 R2 Performance 
Monitor tool for troubleshooting performance problems.   The Performance Monitor 
administrative tool is a very powerful method for collecting data about all areas of system 
performance. Through the use of performance objects, counters, and instances, you 
can choose to collect and record only the data of interest and use this information for 
pinpointing performance problems.  
  Know the importance of common performance counters.   Several important performance -
 related counters deal with general system performance. Know the importance of 
monitoring memory, print server, CPU, and network usage on a busy server. 
  Understand the role of other troubleshooting tools.   Windows Task Manager, Network 
Monitor, SNMP, Baseline Security Analyzer, and Event Viewer can all be used to diagnose 
and troubleshoot conﬁ guration - and performance - related issues.  
  Understand how to troubleshoot common sources of server reliability 
problems.   Windows Server 2008 R2 has been designed to be a stable, robust, and reliable 
operating system. Should you experience intermittent failures, you should know how to 
troubleshoot device drivers and buggy system - level software.  
  Understand the various backup types available with the Windows Server 2008 R2 Backup 
utility.   The Windows Server 2008 R2 Backup utility can perform full and incremental 
backup operations. Some third - party backup utilities also support differential and 
daily backups. You can use each of these operations as part of an efﬁ cient backup strategy.  
  Know how to back up network data.   All data on a server can be backed up using 
Windows Server 2008 R2 and the Backup utility. Understand how to perform a backup 
and the reasons why you need to back up network servers.  
  Know how to restore network data.   Recovering data on a server is one of the most 
important tasks you can know as an IT administrator. Know how to recover data using 
the Windows Server 2008 R2 Backup utility. Understand how to perform a restore and the 
reasons why you would recover your network servers.  
  Understand shadow copies.   Shadow copies are an excellent way to protect shared folder 
data. By using shadow copies, you have the ability to recover ﬁ les that were accidentally 
deleted, were overwritten, or have become corrupted.  

Review Questions 
807
 Review Questions  
 1. 
  Paige is a systems administrator who is responsible for performing backups on several 
servers. Recently, she has been asked to take over operations of several new servers. 
Unfortunately, no information about the standard upkeep and maintenance of those servers 
is available. Paige wants to begin by making configuration changes to these servers, but she 
wants to first ensure that she has a full backup of all the data on each of these servers. 
 Paige decides to use the Windows Server 2008 R2 Backup utility to perform the backups. 
She wants to choose a backup type that will back up all ﬁ les on each of these servers, 
regardless of when they were last changed or if they have been previously backed up. Which 
of the following types of backup operations store all the selected ﬁ les, without regard to the 
Archive bit setting? (Choose all that apply.)  
 A.   Normal  
 B.   Incremental  
 C.   Copy  
 D.   Differential  
 2. 
  You are the network administrator for a Fortune 500 company. You are responsible for all 
client computers at the central campus. You want to make sure that all the client computers 
are secure. You decide to use MBSA to scan your client computers for possible security 
violations. You want to use the command - line version of MBSA to scan your computers 
based on IP address. Which of the following commands should you use?  
 A.   mdsacli.exe /hf  - i  xxxx.xxxx.xxxx.xxxx  
 B.   mdsacli.exe /ip  xxxx.xxxx.xxxx.xxxx  
 C.   mbsa.exe /hf  - ip  xxxx.xxxx.xxxx.xxxx  
 D.   mbsa.exe /ip  xxxx.xxxx.xxxx.xxxx   
 3. 
 You are the network administrator for a Fortune 500 company. You are responsible for all 
client computers at the central campus. You want to make sure all the client computers have 
the most current software installed for their operating systems, including software in the 
categories Critical Updates and Service Packs, Windows Server 2008 R2 Family, and Driver 
Updates. You want to automate the process as much as possible, and you want the client 
computers to download the updates from a central server you are managing. You decide 
to use Windows Server Update Services. The WSUS server software has been installed on 
a server called WSUSServer. You want to test the WSUS server before you set up group 
policies within the domain. You install Windows 7. Which of the following Registry 
entries needs to be made for the client to specify that the client should use WSUSServer for 
Windows Update? (Choose all that apply.)  

808 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
 A.   Use  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate\AU\UseWUServer , and specify 0 data.  
 B.   Use  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate\AU\UseWUServer , and specify 1 for data.  
 C.   Use  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate\AU\WUServer , and specify  http://WSUSServer . 
 D.   Use  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate\AU\WUServer , and specify  WSUSServer . 
 E. 
  Use  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate\WUServer , and specify  http://WSUSServer . 
 F. 
 Use  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate\WUServer , and specify  WSUSServer . 
 4. 
  Which of the following types of backup operations should be used to back up all the files 
that have changed since the last full backup or incremental backup and mark these files as 
having been backed up? 
 A.   Differential  
 B.   Copy  
 C.   Incremental  
 D.   Normal  
 5. 
  You are a network administrator for your company. The network consists of a single 
Active Directory domain. All servers run Windows Server 2008 R2. Windows Server 
Update Services (WSUS) is installed on two servers, SERVERA and SERVERB. SERVERA 
receives software updates from Microsoft Windows Update servers. You manually 
synchronized SERVERB with the Windows Update servers and now need to complete the 
WSUS configuration on SERVERB. Which of the following is  not a step you might take to 
complete the configuration of WSUS on SERVERB?  
 A.   Approve the current updates.  
 B.   Set SERVERB to receive updates from SERVERA and automatically synchronize with 
approved updates on SERVERA.  
 C.   Set SERVERB to automatically draw updates from whichever sources SERVERA is set 
to draw from.  
 D.   Set SERVERB to automatically receive daily updates at a given time.  
 6. 
 You are the network administrator for your company. The network consists of a single 
Active Directory domain. All servers run Windows Server 2008 R2. All client computers run 
Windows 7. The company has 16 mobile sales representatives who are all members of the 
Power Users local group on their computers. From 6 p.m. until 7 a.m., the sales representatives ’ 
portable computers are usually turned off and disconnected from the corporate network. The 
mobile sales representatives ’ computers must receive software updates every day with minimal 

Review Questions 
809
user interaction. While verifying the recent updates on one of the portable computers, you 
notice that the updates from the Windows Update servers were not applied. On the Automatic 
Updates tab of the System Properties dialog box of the mobile computer, what should you do 
to make sure that software updates are applied to the computer? (Choose three.)  
 A.   Set the scheduled time to every day at 12 a.m.  
 B.   Select the option Automatically Download The Updates, And Install Them On The 
Schedule That I Specify.  
 C.   Select the option Notify Me Before Downloading Any Updates And Notify Me Again 
Before Installing Them On My Computer.  
 D.   Select the Keep My Computer Up To Date check box.  
 E. 
  Select the option Download The Updates Automatically And Notify Me When They 
Are Ready To Be Installed.  
 F. 
 Set the scheduled time to every day at 12 p.m.  
 7. 
  You are responsible for managing several Windows Server 2008 R2 domain controller 
computers in your environment. Recently, a single hard disk on one of these machines failed, 
and the Active Directory database was lost. You want to perform the following tasks: 
 Determine which partitions on the server are still accessible.  
 Restore as much of the system conﬁ guration (including the Active Directory database) 
as possible.  
 Which of the following could be used to help meet these requirements?  
 A.   Event Viewer 
 B.   Performance Monitor  
 C.   A hard disk from another server that is not configured as a domain controller  
 D.   A valid system state backup from the server  
 8. 
  You have been hired as a consultant to research a network - related problem at a small 
organization. The environment supports many custom - developed applications that are not 
well documented. A manager suspects that some computers on the network are generating 
excessive traffic and bogging down the network. You want to do the following:  
 Determine which computers are causing the problems.  
 Record and examine network packets that are coming to/from speciﬁ c machines.  
 View data related only to speciﬁ c types of network packet.  
 What tool should you use to accomplish all of the requirements?  
 A.   Task Manager  
 B.   Performance Monitor  
 C.   Event Viewer 
 D.   Network Monitor  
■
■
■
■
■

810 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  9. 
  Where do you set up shadow copies?  
 A.   Server Manager  
 B.   Computer Management  
 C.   Reliability Manager  
 D.   Backup Utility  
 10.   You are the administrator for a small company. You have noticed lately that users are 
accidentally deleting files from shared folders. You want to implement a way to have your 
users recover the deleted files. What can you implement?  
 A.   Backups  
 B.   Shadow copies  
 C.   Recovery console  
 D.   File restoration utility  

 Answers to Review Questions 
 1. 
A .  Normal and copy backup operations do not use the Archive bit to determine which 
ﬁ les to back up, and they include all ﬁ les that are selected for backup on the server. The 
other backup types store only a subset of ﬁ les based on their dates or whether they have 
been previously backed up. The Windows Server 2008 R2 Backup utility supports normal 
backups but does not support copy backups. For this reason, Paige should choose 
a normal backup to ensure that she performs a valid backup of all ﬁ les on the servers before 
she makes any conﬁ guration changes.  
 2. 
A .  If you use MBSA from the command - line utility  mdsacli.exe , you can specify several 
options. You type   mdsacli.exe/hf  (from the folder that contains  Mdsacli.exe ) and then 
customize the command execution with an option such as  /i  xxxx.xxxx.xxxx
.xxxx  , which speciﬁ es that the computer with the speciﬁ ed IP address should be scanned.  
 3. 
B, E .  You can set the Registry key  HKEY_LOCAL_MACHINE\Software\Policies\
Microsoft\Windows\WindowsUpdate\AU\UseWUServer to 0 to use the public Windows 
Update server, or you can set it to 1, which means you will specify the server for Windows 
Update in the  HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\
WindowsUpdate  key. The  WUServer  key sets the Windows Update server using the server ’ s 
HTTP name, for example,  http://intranetSUS . 
 4. 
C .  Incremental backup operations copy ﬁ les and mark them as having been backed up. 
Therefore, they are used when a systems administrator wants to back up only the ﬁ les that 
have changed since the last full or incremental backup. Differential backups, although 
they will also back up only those ﬁ les that were created or changed since the last full or 
incremental backup, will not mark the ﬁ les as having been backed up.  
 5. 
C .  All options are valid steps to complete the conﬁ guration, except option C, because 
SERVERB cannot automatically draw updates from whichever sources are on SERVERA.  
 6. 
B, D, F .  Option A schedules the updates to occur at a time when the computers are 
generally not connected to the corporate network. Options C and E require more user 
interaction than would be considered minimal. By setting updates to occur with no 
user interaction at noon, you satisfy the requirements.  
 7. 
D .  You can recover system state data from a backup, which always includes the Active 
Directory database. In this case, Event Viewer and System Monitor wouldn ’ t help you 
recover the database, but they might help you determine why the hard drive crashed in the 
ﬁ rst place.  
Answers to Review Questions 
811

812 
Chapter 18 ■ Monitoring and Managing a Network Infrastructure
  8. 
D .  By using the Network Monitor, you can view all the network packets that are being 
sent to or from the local server. Based on this information, you can determine the source 
of certain types of trafﬁ c, such as pings. The other types of monitoring can provide useful 
information, but they do not allow you to drill down into the speciﬁ c details of a network 
packet, and they don ’ t allow you to ﬁ lter the data that has been collected based on details 
about the packet.  
 9. 
B .  To set up shadow copies, you use the Computer Management MMC.  
 10. B .  Shadow copies are an excellent way to protect shared folder data. By using shadow 
copies, users have the ability to recover ﬁ les that were accidentally deleted, were 
overwritten, or have become corrupted.  
 
Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 .  

MCTS: Windows 
Server 2008 R2 
Applications 
Infrastructure 
Configuration 
(Exam 70-643)
PART 
III


Windows Server 
2008 R2 Storage 
Services  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Deploying Servers 
 Configure storage. May include but is not limited to: RAID 
types; Virtual Disk Specification (VDS); iSCSI Initiator; 
Storage Area Networks (SANs); mount points; Multipath I/O 
(MPIO); VHD mounting; boot from VHD; N - Port Identification 
Virtualization (NPIV).  

■
 Chapter 
19

 Disk storage is a requirement for just about every computer 
and application used in any corporate environment. 
Administrators have some familiarity with storage, whether 
it is internal storage, a locally attached set of disks, or network attached storage (NAS). 
In this chapter, we will examine the various aspects of Windows Server 2008 R2 Storage 
Services. We ’ ll discuss the various types of storage technologies, but this chapter will 
primarily focus on iSCSI because of the native features in Windows Server 2008 R2.  
 Storage in Windows Server 2008 R2 
 As an IT administrator, when setting up a server, you need to ask many questions before 
you start. What type of disks should be used? What type of RAID sets should be made? 
What type of hardware platform should be purchased? These are all questions that must 
be asked when planning for storage in a Windows Server 2008 R2 server. In the following 
sections, we will answer these questions so that you can make the best decisions for storage 
in your network ’ s environment. 
 Initializing Disks 
 To begin, we must ﬁ rst discuss how to add disk drives to a server. Once a disk drive has 
been physically installed, it must be initialized by selecting the type of partition. Different 
types of partition styles are used to initialize disks: Master Boot Record (MBR) and GUID 
Partition Table (GPT). 
 MBR has a partition table that indicates where the partitions are located on the disk 
drive, and with this particular partition style, only volumes up to two terabytes (1,024 
gigabytes) are supported. An MBR drive can have up to four primary partitions or three 
primary partitions and one extended partition that can be divided into unlimited logical 
drives. 
 Windows Server 2008 R2 can boot off only an MBR disk unless it is based on the 
Extensible Firmware Interface (EFI); then it can boot from GPT. An Itanium server is an 
example of EFI - based system. GPT is not constrained by the same limitations MBR is. 
In fact, a GPT disk drive can support volumes of up to 18 exabytes (1 million terabytes) 
and 128 partitions. As a result, GPT is recommended for disks larger than 2 TB or disks 
used on Itanium - based computers. Exercise 19.1 demonstrates the process of initializing 
additional disk drives to an active computer running Windows Server 2008 R2.  

 E X E R C I S E  1 9 .1
Initializing Disk Drives 
 Follow these steps to initialize disk drives: 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Click and then expand Storage.  
 3. 
  Select Disk Management.  
 4. 
  After disk drives have been installed, right - click Disk Management and select Rescan 
Disks.  
 5. 
  A pop - up box appears indicating that the server is scanning for new disks.  
 6. 
  After the server has completed the scan, the new disk appears as Unknown.  
 7. 
  Right - click the Unknown disk and select Initialize Disk.  
 8. 
  A pop - up box appears asking for the partition style. For this exercise, choose MBR.  
 9. 
  Click OK.  
 The disk will now appear online as a basic disk with unallocated space.  
 Working with Basic and Dynamic Disks 
 Windows Server 2008 R2 supports two types of disk conﬁ gurations: basic and dynamic. 
Basic disks are divided into partitions and can be used with previous versions of Windows. 
Dynamic disks are divided into volumes and can be used with Windows 2000 Server and 
later releases. 
 When a disk is initialized, it is automatically created as a basic disk, but when a new 
fault - tolerant (RAID) volume set is created, the disks in the set are converted to dynamic 
disks. Fault - tolerance features and the ability to modify disks without having to reboot the 
server are what distinguish dynamic disks from basic disks.  
 
Fault Tolerance (RAID) is discussed in detail later in this chapter in the 
 “ Redundant Array of Independent Disks ” section.  
 A basic disk can simply be converted to a dynamic disk without loss of data. When 
a basic disk is converted, the partitions are automatically changed to the appropriate 
volumes. However, converting a dynamic disk back to a basic disk is not as simple. First, 
all the data on the dynamic disk must be backed up or moved. Then all the volumes on the 
dynamic disk have to be deleted. The dynamic disk can then be converted to a basic disk. 
Partitions and logical drives can be created and the data restored. 
Storage in Windows Server 2008 R2 
817

818 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 The following are actions that can be performed on basic disks: 
 Format partitions.  
 Mark partitions as active.  
 Create and delete primary and extended partitions.  
 Create and delete logical drives.  
 Convert from a basic disk to a dynamic disk.  
 The following are actions that can be performed on dynamic disks: 
 Create and delete simple, striped, spanned, mirrored, or RAID - 5 volumes. 
 Remove or break a mirrored volume.  
 Extend simple or spanned volumes.  
 Repair mirrored or RAID - 5 volumes. 
 Convert from a dynamic disk to basic after deleting all volumes.  
 In Exercise 19.2, you ’ ll convert a basic disk to a dynamic disk.  
 E X E R C I S E  1 9 . 2
Converting a Basic Disk to a Dynamic Disk 
 Follow these steps to convert a basic disk to a dynamic disk: 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Click and then expand Storage.  
 3. 
  Select Disk Management. 
 4. 
  Right - click a basic disk that you want to convert, and select Convert to Dynamic Disk.  
 5. 
  The Convert To Dynamic Disk dialog box appears. From here, select all the disks that 
you want to convert to dynamic disks. In this exercise, only Disk 2 will be converted.  
 6. 
  Click OK. 
 7. 
  The Convert To Dynamic Disk dialog box changes to the Disks To Convert dialog box 
and show the disk/disks that will be converted to dynamic disks.  
 8. 
  Click Convert.  
 9. 
  Disk Management will warn that if you convert the disk to dynamic, you will not be able 
to start the installed operating system from any volume on the disk (except the current 
boot volume).  
 10.   Click Yes. 
 The converted disk will now show as dynamic in Disk Management.  
■
■
■
■
■
■
■
■
■
■

 Working with Volume Sets 
 A volume set is created from volumes that span multiple drives by using the free space from 
those drives to construct what will appear to be a single drive. The following list includes 
the various types of volume sets and their deﬁ nitions: 
 Simple volume uses only one disk or a portion of a disk.  
 Spanned volume is a simple volume that spans multiple disks, with a maximum of 32. 
Use a spanned volume if the volume needs are too great for a single disk.  
 Striped volume stores data in stripes across two or more disks. A striped volume gives 
you fast access to data but is not fault tolerant, nor can it be extended or mirrored. If 
one disk in the striped set fails, the entire volume fails.  
 Mirrored volume duplicates data across two disks. This type of volume is fault tolerant 
because if one drive fails, the data on the other disk is unaffected.  
 RAID - 5 volume stores data in stripes across three or more disks. This type of volume 
is fault tolerant because if a drive fails, the data can be re - created from the parity off 
the remaining disk drives. Operating system ﬁ les and boot ﬁ les cannot reside on the 
RAID - 5 disks.  
 Exercise 19.3 illustrates the procedure for creating a volume set.  
 E X E R C I S E  1 9 . 3
Creating a Volume Set 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Click and then expand Storage.  
 3. 
  Select Disk Management.  
 4. 
  Select and right - click a disk that has unallocated space. If there are no disk drives 
available for a particular volume set, that volume set will be grayed out as a selectable 
option. In this exercise, you ’ ll choose a spanned volume set, but the process after the 
volume set selection is the same regardless of which kind you choose. The only thing 
that differs is the number of disk drives chosen. 
 5. 
  The Welcome page of the New Spanned Volume Wizard appears and explains the type 
of volume set chosen. Click Next.  
 6. 
  The Select Disks page appears. Select the disk that will be included with the volume 
set and click Add. Repeat this process until all the desired disks have been added. 
Click Next. 
 7. 
  The Assign Drive Letter Or Path page appears. From here you can select the desired 
drive letter for the volume, mount the volume in an empty NTFS folder, or choose to not 
assign a drive letter. The new volume is labeled as E. Click Next.  
■
■
■
■
■
Storage in Windows Server 2008 R2 
819

820 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
E X E R C I S E  1 9 . 3  (c o n t i n u e d)
 8. 
  The Format Volume page appears. Choose to format the new volume. Click Next.  
 9. 
  Click Finish. 
 10.   If the disks have not been converted to dynamic, you will be asked to convert the disks. 
Click Yes. 
 The new volume will appear as a healthy spanned dynamic volume with the new available 
disk space of new volume set.  
 Redundant Array of Independent Disks 
 Built into Windows Server 2008 R2 is the ability to support drive sets and arrays using 
Redundant Array of Independent Disks (RAID) technology. RAID can be used to enhance 
data performance, or it can be used to provide fault tolerance to maintain data integrity 
in case of a hard disk failure. Windows Server 2008 R2 supports three different types of 
RAID technologies: RAID - 0, RAID - 1, and RAID - 5.  
  RAID - 0 (Disk Striping)   Disk striping is using two or more volumes on independent disks 
created as a single striped set. There can be a maximum of 32 disks. In a striped set, data 
is divided into blocks that are distributed sequentially across all the drives in the set. With 
RAID - 0 disk striping, you get very fast read and write performance because multiple blocks 
of data can be accessed off of multiple drives simultaneously. However, RAID - 0 does not offer 
the ability to maintain data integrity during a single disk failure. In other words, RAID - 0 is 
not fault tolerant; a single disk event will cause the entire striped set to be lost, and it will 
have to be re - created through some type of recovery process, such as a tape backup. 
  RAID - 1 (Disk Mirroring)   Disk mirroring is two logical volumes on two separate identical 
disks created as a duplicate disk set. Data is written on two disks at the same time; that 
way, in the event of a disk failure, data integrity is maintained and available. Although 
this fault tolerance gives administrators data redundancy, it comes with a price because it 
diminishes the amount of available storage space by half. For example, if an administrator 
wants to create a 300GB mirrored set, they would have to install two 300GB hard drives 
into the server, thus doubling the cost for the same available space.  
  RAID - 5 Volume (Disk Striping with Parity)   With a Raid - 5 Volume, you have the ability 
to use minimum of three disks and a maximum of 32 disks. Raid - 5 Volumes allow data to 
be striped across all the disks with an additional block of error - correction called parity. 
Parity is used to reconstruct the data in the event of a disk failure. RAID - 5 has slower 
write performance than the other RAID types because the OS must calculate the parity 
information for each stripe that is written, but the read performance is equivalent to a 
stripe set, RAID - 0, because the parity information is not read. Like RAID - 1, RAID - 5 
comes with additional cost considerations. For every RAID - 5 set, roughly an entire hard 
disk is consumed for storing the parity information. For example, a minimum RAID - 5 set 
requires three hard disks, and if those disks are 300GB each, approximately 600GB of disk 

space is available to the OS and 300GB is consumed by parity information, which equates 
to 33.3 percent of the available space. Similarly, in a ﬁ ve - disk RAID - 5 set of 300GB disks, 
approximately 1200GB of disk space is available to the OS, which means that 20 percent 
of the total available space is consumed by the parity information. The words  roughly and 
 approximately are used when calculating disk space because a 300GB disk will really be 
only about 279GB of space. This is because vendors deﬁ ne a gigabyte as one billion bytes, 
but the OS deﬁ nes it as 2^30(1,073,741,824) bytes. Also remember that ﬁ lesystems and 
volume managers have overhead as well.  
 Software RAID is a nice option for a small company, but hardware RAID is 
definitely a better option if the money is available. 
 Table 19.1 breaks down the various aspects of the supported RAID types in Window 
Server 2008 R2.  
 TA B L E 19.1 Supported RAID - level properties on Windows Server 2008 R2 
 RAID Level  
  RAID Type  
 Fault 
Tolerant  
  Advantages  
 Minimum 
Number of 
Disks  
 Maximum 
Number of 
Disks  
 0 
  Disk striping  
  No  
  Fast reads and 
writes  
 2 
  32  
 1 
  Disk mirroring  
  Yes  
 Data 
redundancy 
and faster 
writes than 
RAID - 5 
 2 
  2 
 5 
  Disk striping 
with parity  
 Yes  
 Data 
redundancy 
with less 
overhead and 
faster reads 
than RAID - 1 
 3 
  32  
 Creating RAID Sets 
 Now that you understand the concepts of RAID and how to use it, we can look at the 
creation of RAID sets in Windows Server 2008 R2. The process of creating a RAID 
set is the same as the process for creating a simple or spanned volume set except for the 
minimum disk requirements associated with each RAID type. 
 Creating a mirrored volume set is basically the same as creating a volume set, as shown 
in Exercise 19.3, except you will select New Mirrored Volume in the fourth step. It is after 
the disk select wizard appears that you ’ ll begin to see the difference. Since a new mirrored 
volume is being created, the volume requires two disks. 
Storage in Windows Server 2008 R2 
821

822 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 During the disk select process, if only one disk is selected, the Next button will be 
unavailable because the disk minimum has not been met. Refer to Figure 19.1 to view 
the Select Disks page of the New Mirrored Volume Wizard during the creation of a new 
mirrored volume, and notice that the Next button is not available.  
 F I G U R E 19.1  Select Disks page of the New Mirrored Volume Wizard 
 To complete the process, you must select a second disk by highlighting the appropriate 
disk and adding it to the volume set. Once the second disk has been added, the Add button 
becomes unavailable and the Next button is available to complete the mirrored volume set 
creation (see Figure 19.2).  
 F I G U R E 19. 2 Adding the second disk to complete a mirrored volume set 
 After you click Next, the creation of the mirrored volume set is again just like the rest 
of the steps (7 through 11) in Exercise 19.3. A drive letter will have to be assigned and 
the volume will need to be formatted. The new mirrored volume set will appear in Disk 

Management. In Figure 19.3, notice that the capacity of the volume equals one disk even 
though two have been selected.  
 F I G U R E  19. 3 Newly created mirrored volume set 
 To create a RAID - 5 volume set, you use the same process you use to create a mirrored 
volume set. The only difference is that a RAID - 5 volume set requires that a minimum of 
three disks be selected to complete the volume creation. The process is simple: Select New 
RAID - 5 Volume and then select the three disks that will be used in the volume set. Assign a 
drive letter and format the volume. Figure 19.4 shows a newly created RAID - 5 volume set in 
Disk Management. 
Storage in Windows Server 2008 R2 
823
 F I G U R E 19. 4 Newly created RAID - 5 volume set 

824 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 Mount Points 
 With the ever - increasing demands of storage, mount points are used to surpass the 
limitation of 26 drive letters and to join two volumes into a folder on a separate physical 
disk drive. A mount point allows you to conﬁ gure a volume to be accessed from a folder on 
another existing disk. 
 Through Disk Management, a mount point folder can be assigned to a drive instead of 
using a drive letter and can be used on basic or dynamic volumes that are formatted with 
NTFS. However, mount point folders can be created only on empty folders within a volume. 
Additionally, mount point folder paths cannot be modiﬁ ed; they can only be removed once 
they have been created. Exercise 19.4 shows the steps to create a mount point. 
 E X E R C I S E  1 9 . 4
Creating Mount Points 
 Follow these steps to create a mount point: 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Click and then expand Storage.  
 3. 
  Select Disk Management. 
 4. 
  Right - click the volume where the mount point folder will be assigned and select Change 
Drive Letter And Paths. 
 5. 
  Click Add. 
 6. 
  Either type the path to an empty folder on an NTFS volume or click Browse to select or 
make a new folder for the mount point.  
 When you explore the drive, you ’ ll see the new folder created. Notice that the icon indicates 
that it is a mount point. 
 Microsoft MPIO 
 Multipath I/O (MPIO) is associated with high availability because a computer will be able 
to use a solution with redundant physical paths connected to a storage device. So if one 
path fails, an application will continue to run because it can access the data across the 
other path. 
 The MPIO software provides the functionality needed for the computer to take 
advantage of the redundant storage paths. MPIO solutions can also load - balance data 
trafﬁ c across both paths to the storage device, virtually eliminating bandwidth bottlenecks 
to the computer. What allows MPIO to provide this functionality is the new native 
Microsoft Device Speciﬁ c Module (Microsoft DSM). The Microsoft DSM is a driver that 

communicates with storage devices — iSCSI, Fibre Channel or SAS — and provides the 
chosen load - balancing policies. Windows Server 2008 R2 supports the following load -
 balancing policies:
 Failover   In a failover conﬁ guration, there is no load balancing. There is a primary path 
that is established for all requests and subsequent standby paths. If the primary path fails, 
one of the standby paths will be used.  
 Failback   This is similar to failover in that it has primary and standby paths. However, 
with failback you designate a preferred path that will handle all process requests until it 
fails, after which the standby path will become active until the primary reestablishes a 
connection and automatically regains control.  
 Round Robin   In a round - robin conﬁ guration, all available paths will be active and will be 
used to distribute I/O in a balanced round robin fashion.  
 Round Robin with a Subset of Paths   In this conﬁ guration, a speciﬁ c set of paths will be 
designated as a primary set and another as standby paths. All I/O will use the primary set 
of paths in a round - robin fashion until all the sets fail. Only at this time will the standby 
paths become active.  
 Dynamic Least Queue Depth   In a dynamic least queue depth conﬁ guration, I/O will 
route to the path with the least number of outstanding requests.  
 Weighted Path   In a weighted path conﬁ guration, paths are assigned a numbered weight. I/O 
requests will use the path with the least weight. The higher the number, the lower the priority.  
 Exercise 19.5 demonstrates the process of installing the Microsoft MPIO feature for 
Windows Server 2008 R2.  
 E X E R C I S E  1 9 . 5
Installing Microsoft MPIO 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Features and select Add Features. 
 3. 
  In the Add Features Wizard, check Multipath I/O and click Next.  
 4. 
  On the Conﬁ rm Installation Selections page, verify that Multipath I/O is the feature that 
will be installed. Click Install. 
 5. 
  After the installation completes, the Installation Results page appears stating that the 
server must be rebooted to ﬁ nish the installation process.  
 6. 
  Click Close.  
 7. 
  Click Yes to restart. 
 8. 
  After the restart, the installation will resume. Once it ’ s complete, click Close. 
 9. 
  To open MPIO, click Start   Administrative Tools   MPIO. 
Storage in Windows Server 2008 R2 
825

826 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 Typically, most storage arrays work with the Microsoft DSM. However, some hardware 
vendors require DSM software that is speciﬁ c to their products. Third - party DSM software 
is installed through the MPIO utility as follows: 
 1. 
 Click Start   Administrative Tools   MPIO.  
 2. 
  Select the DSM Install tab (Figure 19.5).  
 3. 
  Add the path of the INF ﬁ le and click Install.  
 F I G U R E 19. 5 The DSM Install tab on the MPIO Properties dialog box 
 iSCSI 
 Internet Small Computer System Interface (iSCSI) is an interconnect protocol used to 
establish and manage a connection between a computer (initiator) and a storage device 
(target). It does this by using a connection through TCP port 3260, which allows it to be 
used over a LAN, a WAN, or the Internet. Each initiator is identiﬁ ed by its iSCSI Qualiﬁ ed 
Name (iqn) and is used to establish its connection to an iSCSI target. 
 iSCSI was developed to allow block - level access to a storage device over a network. This 
is different than using a network attached storage (NAS) device that connects through the 
use of Common Internet File System (CIFS) or Network File System (NFS). 
 Block - level access is important to many applications that require direct access to storage. MS 
Exchange and MS SQL are examples of applications that require direct access to storage. 
 By being able to leverage the existing network infrastructure, iSCSI was also developed 
as an alternative to Fibre Channel storage by alleviating the additional hardware costs 
associated with a Fibre Channel storage solution. 
 iSCSI also has another advantage over Fibre Channel in that it can provide security for 
the storage devices. iSCSI can use Challenge Handshake Authentication Protocol (CHAP 
or MS - CHAP) for authentication and Internet Protocol Security (IPsec) for encryption. 
Windows Server 2008 R2 is able to connect an iSCSI storage device out of the box with no 

additional software needing to be installed. This is because the Microsoft iSCSI initiator is 
built into the operating system. 
 Windows Server 2008 R2 supports two different ways to initiate an iSCSI session: 
 Through the native Microsoft iSCSI software initiator that resides on Windows Server 
2008 R2 
 Using a hardware iSCSI host bus adapter (HBA) that is installed in the computer  
 Both the Microsoft iSCSI software initiator and iSCSI HBA present an iSCSI Qualiﬁ ed 
Name that identiﬁ es the host initiator. When the Microsoft iSCSI software initiator is 
used, the CPU utilization may be as much as 30 percent higher than on a computer with a 
hardware iSCSI HBA. 
 This is because all of the iSCSI process requests are handled within the operating system. 
Using a hardware iSCSI HBA, process requests can be ofﬂ oaded to the adapter, thus freeing 
the CPU overhead associated with the Microsoft iSCSI software initiator. However, iSCSI 
HBAs can be expensive, whereas the Microsoft iSCSI software initiator is free. 
 It is worthwhile to install the Microsoft iSCSI software initiator and perform load 
testing to see how much overhead the computer will have prior to purchasing an iSCSI 
HBA or HBAs, depending on the redundancy level. Exercise 19.6 explains how to install 
and conﬁ gure an iSCSI connection.  
 E X E R C I S E  1 9 . 6
Configuring iSCSI Storage Connection 
 Follow these steps to conﬁ gure an iSCSI storage connection: 
 1. 
  Click Start   Administrative Tools   iSCSI Initiator. 
 2. 
  Click the Discovery tab.  
 3. 
  In the Target Portals portion of the page, click Add Portal.  
 4. 
  Enter the IP address of the target portal and click OK.  
 5. 
  The IP address of the target portal appears in the Target Portals box.  
 6. 
  Next, select the Targets tab and then click the Refresh button. The iqn of the target 
appears. Notice that the target ’ s status is Inactive. 
 7. 
  Select the iqn and click the Log On button. 
 8. 
  Check Automatically Restore This Connection When the Computer Starts. Don ’ t check 
Enable Multi - Path. Remember, only select Enable Multi - Path if the iSCSI multipath 
software has already been installed. Refer to Exercise 19.5 for details on how to install 
the MPIO feature for Windows Server 2008 R2. 
 9. 
  Click OK.  
 Notice that the target ’ s status has now changed to Connected. 
 To use the storage that has now been presented to the server, you must create a volume on 
it and format the space. Refer to Exercise 19.3 to review this process. 
■
■
Storage in Windows Server 2008 R2 
827

828 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 Internet Storage Name Service 
 Internet Storage Name Service (iSNS) allows for central registration of an iSCSI 
environment because it automatically discovers available targets on the network. The 
purpose of iSNS is to help ﬁ nd available targets on a large iSCSI network. 
 The Microsoft iSCSI initiator includes an iSNS client that is used to register with the 
iSNS. The iSNS feature maintains a database of clients that it has registered either through 
DCHP discovery or through manual registration. iSNS DHCP is available after the 
installation of the service and is used to allow iSNS clients to discover the location of the 
iSNS. However, if iSNS DHCP is not conﬁ gured, iSNS clients must be registered manually 
with the  iscsicli command. 
 To execute the command, launch a command prompt on a computer hosting the 
Microsoft iSCSI and type the following:   iscsicli addisnsserver  < servername >  , where 
  < servername >  is the name of the computer hosting iSNS. Exercise 19.7 walks through the 
steps to install the iSNS feature on Windows Server 2008 R2.  
 E X E R C I S E  1 9 . 7
Installing the iSNS Feature on Windows Server 2008 R2  
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Features and select Add Features. 
 3. 
  In the Add Features Wizard, check Internet Storage Name Server and click Next. 
 4. 
  On the Conﬁ rm Installation Selections page, verify that Internet Storage Name Server is 
the feature that will be installed. Click Install. 
 5. 
  After the installation completes and the Installation Results page appears, verify that 
the installation was successful and click Close. 
 6. 
  Launch iSNS Server by clicking Start   Administrative Tools   iSNS Server.  
 7. 
  Click the General tab. This tab displays the list of registered initiators and targets. 
In addition to their iSCSI Qualiﬁ ed Name (iqn), it lists storage node type (Target or 
Initiator), alias string, and entity identiﬁ er (the Fully Qualiﬁ ed Domain Name (FQDN) of 
the machine hosting the iSNS client). 
 8. 
  Click the Discovery Domains tab. The purpose of Discovery Domains is to provide a 
way to separate and group nodes. This is very similar to zoning in Fibre Channel. The 
following options are available on the Discovery Domains tab:  
 Create Used to create a new discovery domain.  
 Refresh Used to repopulate the Discovery Domain drop - down list. 
 Delete Used to delete the currently selected discovery domain.  
■
■
■

 Add Used to add nodes that are already registered in iSNS to the currently selected 
discovery domain.  
 Add New Used to add nodes by entering the iSCSI Qualiﬁ ed Name (iqn) of the 
node. These nodes do not have to be currently registered. 
 Remove Used to remove selected nodes from the discovery domain.  
 9. 
  Click the Discovery Domain Sets tab. The purpose of discovery domain sets is to further 
separate discovery domains. Discovery domains can be enabled or disabled, giving 
administrators the ability to further restrict the visibility of all initiators and targets. The 
options on the Discovery Domain Sets tab are as follows:  
 Enable check box used to indicate the status of the discovery domain sets and to 
turn them off and on  
 Create Used to create new discovery domain sets  
 Refresh Used to repopulate the Discovery Domain Sets drop - down list  
 Delete Used to delete the currently selected discovery domain set  
 Add Used to add discovery domains to the currently selected discovery domain set  
 Remove Used to remove selected nodes from the discovery domain sets  
 Fibre Channel 
 Fibre Channel storage devices are similar to iSCSI storage devices in that they both 
allow block - level access to their data sets and can provide MPIO policies with the proper 
hardware conﬁ gurations. However, Fibre Channel requires a Fibre Channel HBA, ﬁ ber 
optic cables, and Fibre Channel switches to connect to a storage device. 
 A World Wide Name (WWN) from the Fibre Channel HBA is used from the host 
and device so they can communicate directly with each other, similar to using a NIC ’ s 
MAC address. In other words, a logical unit number (LUN) is presented from a Fibre 
Channel storage device to the WWN of the host ’ s HBA. Fibre Channel has been the 
preferred method of storage because of the available connection bandwidth between 
the storage and the host. 
 Fibre Channel devices supports 1Gb/s, 2Gb/s, and 4Gb/s connections and soon will 
support 8Gb/s connections, but now that 10Gb/s Ethernet networks are becoming more 
prevalent in many datacenters, iSCSI can be a suitable alternative. It is important to 
consider that 10Gb/s network switches can be more expensive than comparable Fibre 
Channel switches. 
 N - Port Identiﬁ cation Virtualization (NPIV) is a Fibre Channel facility allowing multiple 
N - Port IDs to share a single physical N - Port. This allows multiple Fibre Channel initiators 
■
■
■
■
■
■
■
■
■
Storage in Windows Server 2008 R2 
829

830 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
to occupy a single physical port. By using a single port, this eases hardware requirements in 
Storage Area Network (SAN) design.  
 Network Attached Storage 
 The concept of a network attached storage (NAS) solution is that it is a low - cost device 
for storing data and serving ﬁ les through the use of an Ethernet LAN connection. A NAS 
device accesses data at the ﬁ le level via a communication protocol such as NFS, CIFS, or 
even HTTP, which is very different from iSCSI or FC Fibre Channel storage devices that 
access the data at the block level. NAS devices are best used in ﬁ le - storing applications, and 
they do not require a storage expert to install and maintain the device. In most cases, the 
only setup that is required is an IP address and an Ethernet connection.  
 Managing SANs 
 In the following sections, we will discuss the tools in Windows Server 2008 R2 that 
will help manage the various aspects of storage: Storage Manager for SANs (SMfS) 
and Storage Explorer. These tools are used independently of one another, but they both 
provide a very powerful and centralized interface to administer a storage environment. 
Storage Manager for SANs manages the physical storage arrays; conversely, Storage 
Explorer views and manages the Fibre Channel and iSCSI connections available in the 
environment. 
 Virtual Disk Service 
 Virtual Disk Service (VDS) has been created to ease the administration efforts of managing 
all the various type of storage devices. Many storage hardware providers used their own 
applications for installation and management, and this made administering all these 
various devices very cumbersome. 
 VDS is a set of application programming interfaces (APIs) that provides a centralized 
interface for managing all the various storage devices. The native VDS API enables the 
management of disks and volumes at an OS level, and hardware vendor – supplied APIs 
manage the storage devices at a RAID level. These are known as software and hardware 
providers. 
 A software provider is host based and interacts with Plug and Play Manager because each 
disk is discovered and operates on volumes, disks, and disk partitions. VDS includes two 
software providers: basic and dynamic. The basic software provider manages basic disks with 
no fault tolerance, whereas the dynamic software providers manage dynamic disks with fault 
management. A hardware provider translates the VDS APIs into instructions speciﬁ c to the 

storage hardware. This is how storage management applications are able to communicate 
with the storage hardware to create LUNs or Fibre Channel HBAs to view the WWN. The 
following are Windows Server 2008 R2 storage management applications that use VDS: 
 The Disk Management snap - in is an application that allows you to conﬁ gure and 
manage the disk drives on the host computer. You have already seen this application in 
use when you initialized disks and created volume sets. 
 DiskPart is a command - line utility that conﬁ gures and manages disks, volumes, and 
partitions on the host computer. It can also be used to script many of the storage 
management commands. DiskPart is a very robust tool and should be studied on 
your own because it is beyond the scope of this book. Figure 19.6 shows the various 
commands and their function for the DiskPart utility.  
■
■
 F I G U R E 19.6 DiskPart commands 
 DiskRAID is also a scriptable command - line utility that conﬁ gures and manages 
hardware RAID storage systems. However, at least one VDS hardware provider must 
be installed for DiskRAID to be functional. DiskRAID is another useful utility that 
should be studied on your own because it ’ s beyond the scope of this book.  
 Storage Manager for SANs is a graphical user interface utility that is used to manage 
SANs. It will be discussed further in the following section.  
■
■
Managing SANs 
831

832 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 Storage Manager for SANs 
 Storage Manager for SANs is a utility that is used to create and manage LUNs on both 
Fibre Channel and iSCSI storage arrays that support Virtual Disk Service (VDS). A LUN 
is similar to a volume in that it is a logical representation of a disk drive that is a part of a 
storage array. A SAN using Storage Manager simpliﬁ es the management of these resources 
in a SAN environment because it is a centralized location were LUNs can be assigned 
access and control privileges even though Fibre Channel and iSCSI use different types of 
hardware and network protocols. 
 To use Storage Manager for SANs, you must make sure the server and the storage array 
meet the following requirements: 
 The server must have the Storage Manager for SANs feature installed.  
 The storage array must support VDS. 
 The VDS hardware provider ’ s software for the storage array must be installed on the 
server.  
 The storage array must be directly attached or accessible over the network.  
 In order to manage an iSCSI array through Storage Manager for SANs, you must 
install an iSCSI initiator on the server.  
 Exercise 19.8 demonstrates the procedures for installing the Storage Manager for SANs 
feature on Windows Server 2008 R2. 
 E X E R C I S E  1 9 . 8
Installing Storage Manager for SANs  
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Features and select Add Features. 
 3. 
  In the Add Features Wizard, check Storage Manager for SANs and click Next. 
 4. 
  On the Conﬁ rm Installation Selections page, verify that Storage Manager for SANs is 
the feature that will be installed. Click Install. 
 5. 
  After the installation, when the Installation Results page appears, verify that the 
installation was successful and click Close. 
 6. 
  To launch Storage Manager for SANs, click Start   Administrative Tools   Storage 
Manager For SANs. 
 Opening Storage Manager for SANs, you will notice three main sections: LUN 
Management, Subsystems, and Drives. All the tasks that can be performed are performed 
within these three sections. 
■
■
■
■
■

 In the LUN Management section, the following tasks can be performed: 
 View information about the LUNs on your Fibre Channel and iSCSI storage systems.  
 Create, rename, extend, delete, assign, and unassign LUNs.  
 Add servers to your SAN and enable HBAs and iSCSI initiators.  
 Create, remove, and conﬁ gure security settings and log on to iSCSI targets.  
 In the Subsystems section, the following tasks can be performed: 
 View information about the storage systems that have been discovered by VDS.  
 Rename a storage system. 
 In the Drives section, the following tasks can be performed: 
 View information about the disk drives in the storage systems that have been 
discovered.  
 Make a drive light blink.   
 Storage Explorer 
 Storage Explorer is used by administrators to view and manage Fibre Channel and iSCSI 
fabrics available in the environment. The Storage Explorer interface provides a tree -
 structured view of the components by using APIs to collect data about the storage devices. 
The following detailed information can be found in Storage Explorer: 
 HBA information  
 Fibre Channel switches  
 iSCSI initiators  
 iSCSI targets  
 An administrator can also perform various iSCSI - related tasks from Storage Explorer: 
 Log on to iSCSI targets. 
 Conﬁ gure iSCSI security.  
 Add iSCSI target portals.  
 Add iSNS servers.  
 Manage discovery domains.  
 Manage discovery domain sets.  
 Figure 19.7 shows the Storage Explorer interface with an iSCSI initiator selected and 
also illustrates the management options that are available.  
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
Managing SANs 
833

834 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
 Working with Virtualization 
 One of the fastest - growing and hottest technologies to hit the market in the past few years 
is server virtualization. Server virtualization has started to make an impact because of the 
vast economic advantages. Server virtualization gives an organization the ability to run 
multiple operating systems, called virtual machines, on a single machine. This ability will 
help an organization reduce its hardware costs and allow it to reduce its IT department 
overhead. 
 Microsoft has been doing virtualization for years. IT teams have used two versions of 
virtualization in the past. The two Microsoft virtualization products that you may have 
used are Microsoft Virtual PC and Microsoft Virtual Server 2005. 
 Microsoft  Hyper - V is the next - generation hypervisor - based virtualization technology. 
With the release of Microsoft Windows Server 2008 R2, Microsoft has now incorporated 
server virtualization into the operating system with the release of Hyper - V. This gives 
an organization the ability to take full advantage of the next generation of 64 - bit server 
hardware. 
 A  virtual machine (VM) is an implementation of an operating system that runs in its 
own virtualization window. The advantage to using virtual machines is that you can have 
 F I G U R E 19.7 Storage Explorer interface 

multiple VMs on the same Windows Server 2008 R2 machine. Each VM can have its own 
unique resources running on its operating system. An administrator can now run multiple 
operating systems (including non - Windows - based systems) or run multiple server roles in 
their own virtual machines, thus allowing an organization more ﬂ exibility without the need 
for more servers. One of the greatest advantages of Hyper - V technology is that you have the 
ability to run both 32 - bit and 64 - bit applications within the virtual environment. 
 Benefits of Virtualization 
 Virtualization platforms give you the ability to manage all of your physical and virtual 
resources from a single set of integrated management utilities. Virtualization can help an 
organization with the following tasks:
 Server Consolidation   This is one of the major beneﬁ ts that virtualization offers. This 
allows an organization to run many versions of a server (even non - Microsoft versions) 
on a single box. Each one of these versions is isolated from the other versions running on 
the same machine. This allows an organization to have a lower total cost of ownership 
(TCO) while maintaining all the services and servers that are required to make the network 
operate properly.  
 Downtime and Recoverability   Two major concerns that all organizations face are downtime 
and recoverability. Downtime includes not only unscheduled events (such as machine errors 
or hardware failure) but also scheduled events like backups and maintenance. Virtualization 
has many features like live backup that help reduce the server downtime for an organization. 
 Recoverability is also something that all IT staff members should be concerned about. 
Most organizations could not afford to lose their data and still stay in business. Disaster 
recoverability is supported by virtualization through clustering and backups, thus reducing 
downtime and saving an organization money.  
 Testing and Development   One of the nice beneﬁ ts to using virtualization is the ability to 
test or develop software in a safe virtual machine operating system. If you have been in this 
industry long enough, you have run into the situation of loading a service pack or utility 
and watching your system crash because of that install. By testing it in virtualization, an 
administrator can reduce the chances of network downtime on a live server.  
 Dynamic Datacenter   Hyper - V virtualization will allow you to design and create a 
dynamic network environment that will not only address network problems but also 
anticipate higher demands of network resources.  
 Features of Microsoft Hyper - V 
 Now that you have seen some of the beneﬁ ts of virtualization, let ’ s take a look at some of 
the new features included with Microsoft Hyper - V:
 Symmetric Multiprocessor Support   Hyper - V allows a virtual machine environment to use 
up to four processors, allowing for symmetric multiprocessor (SMP) support.  
Working with Virtualization 
835

836 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
  New Architecture Design   Hyper - V was designed to run on a 64 - bit processor, which 
allows an administrator to use many different types of devices. This 64 - bit architecture 
also allows for better system performance.  
  Operating System Support   As stated previously, Hyper - V allows an organization to run 
both Microsoft and non - Microsoft operating systems (Windows, Linux, Unix, etc.), giving 
an organization more ﬂ exibility. The operating systems can be both 32 - bit and 64 - bit 
versions. 
  Virtual Machine Migration   A very nice feature of Hyper - V is the ability to migrate 
virtual machines from one server to another without the need of long periods of downtime. 
Let ’ s say that you have a server that is having hardware problems; you can switch the 
virtual machine to another server running Hyper - V without the need to rebuild the bad 
machine immediately.  
  Network Load Balancing   Hyper - V gives an organization the ability to use Network 
Load Balancing (NLB). The Network Load Balancing can be placed across multiple virtual 
machines even if they are on different physical machines.  
  Hardware Architecture   With the new Hyper - V hardware architecture, all hardware 
resources in a virtual machine (disk, network card, RAM, etc.) have access to those resources 
on the physical machine.  
 Scalability   Microsoft ’ s Hyper - V gives an organization the ability to place a large number 
of virtual machines on the same physical machine. This allows an organization to grow a 
network without the need for purchasing additional hardware.  
 Virtualization Concepts 
 Before we can start to conﬁ gure and optimize the Microsoft Hyper - V environment, we 
need to discuss a few terms and concepts that you will need to be familiar with.  
  Host Server (Parent Partition)   This is the Windows Server 2008 R2 machine that hosts 
the Hyper - V role. The Hyper - V virtual machines are being executed on this machine. 
Sometimes this host server may also be referred to as the parent partition.  
  Guest (Child Partition)   These are the containers (virtual machines) that are running the 
guest operating system. The virtual machines are referred to as the  guest or child partition. 
These virtual machine systems can have operating systems running other than Microsoft.  
  Virtual Hard Disk   When you install an operating system onto a computer, during the 
installation you can determine the size and location of the hard disk that you want to install 
the operating system on. A  virtual hard disk (VHD) is the same for the virtual environment. 
When you install a guest system using Hyper - V, the VHD is the hard disk space you are 
using for that install. 
  VMBus   The parent and the child partitions use a new high - speed communication 
protocol for Hyper - V hardware called VMBus. As we stated in Chapter 1,  “ Overview 
of Active Directory, ”  the Microsoft hypervisor handles the interaction between multiple 

virtual machines running on the same host. VMBus handles many of the hardware 
communications like disk, networking, video, and input/output communication.  
 Host Clustering   One of the things that you can conﬁ gure to make Hyper - V more available 
on the network is clustering. Clustering means that one or more Hyper - V servers have the 
clustering role installed and running. This type of clustering is called Host Clustering. One of 
the advantages of clustering is if one of the servers goes down, the other servers in the cluster 
take up the extra load and continue to allow the cluster to run properly. 
 Operating System Partitioning  When setting up Microsoft Hyper - V you normally set up 
two partitions: the parent and child partitions. The parent partition manages the memory 
and virtual devices. The child partitions are the virtual machines. You can have as many 
child partitions as needed, but your Hyper - V can have only one parent partition. The child 
partitions can contain both 32 - bit and 64 - bit operating systems loaded in the virtual machine.  
 Understanding Virtual Hard Disks 
 There are two main types of virtual hard disks (VHD): ﬁ xed - sized VHDs and dynamic 
VHDs. When setting up either of these VHDs, an administrator can determine the 
maximum size value of the VHD, and that will represent how large the disk will appear to 
the virtual machines. The maximum size of either VHD is 2040 GB. 
 Fixed - size VHD s have a set amount of hard disk space, and that amount does not 
change. For example, if I designate 16 GB to a ﬁ xed - size VHD, then the VHD takes up all 
16 GB on the hard disk immediately. It would not matter how much is actually being used 
by the system. 
 Dynamic VHD s use only the amount of space that is currently being used for the VHD. 
For example, if a dynamic VHD has 16 GB allotted, but it ’ s using only 7GB, then only 
7GB will be used by the system. This is the way you want to set up your VHD if hard drive 
space is limited on your server. The ﬁ xed - size VHD option offers better performance than 
the dynamic VHD by eliminating the fragmentation associated with a growing ﬁ le. 
 When setting up your VHD, there is a third option you can choose, called  differencing . 
A differencing disk is conﬁ gured in a parent - child relationship with another disk that 
stays intact. This allows you to change the operating system or data without affecting the 
parent disk. 
 Differencing can help Hyper - V by reducing hard drive space on a host server, but 
differencing can be very difﬁ cult to manage because of the parent - child relationship. Also 
because of the parent - child relationship sometimes there may be performance issues. 
 Booting from a VHD 
 Once you have installed each operating system, you can choose the operating system that 
you will boot to during the boot process. You will see a boot selection screen that asks you 
to choose which operating system you want to boot. 
 The Boot Conﬁ guration Data (BCD) store contains boot information parameters that 
were previously found in  boot.ini in older versions of Windows. To edit the boot options 
Working with Virtualization 
837

838 
Chapter 19 ■ Windows Server 2008 R2 Storage Services
in the BCD store, use the  bcdedit utility, which can be launched only from a command 
prompt. To open a command prompt window, you can do the following: 
 
 1. 
 Launch  \Windows\system32\cmd.exe  . 
 
 2. 
  Open the Run command by pressing [Windows] key+R and then entering   cmd  . 
 
 3. 
  Type   cmd.exe  in the Search Programs And Files box and press Enter.  
 After the command prompt window is open, type   bcdedit  to launch the  bcdedit utility. 
You can also type   bcdedit /?  to see all the different  bcdedit commands.  
 Virtualization is covered in greater detail in Chapter 25,  “ Using Virtualization 
In Windows Server 2008 R2. ” 
 Summary 
 In this chapter, we examined the various aspects of Windows Server 2008 R2 Storage 
Services as well as the various types of storage technologies and native Windows Server 
2008 R2 storage management tools. We started the chapter by discussing initializing 
disks and choosing a partition type, MBR or GPT. We then discussed the types of disk 
conﬁ gurations, dynamic and basic, that are supported in Windows Server 2008 R2. You 
learned that various properties are associated with each type of conﬁ guration. Then we 
discussed the different types of RAID and the properties of each. 
 The next section explored storage technologies, namely iSCSI, Fibre Channel, and NAS. 
We primarily focused on iSCSI because of the native support in Window Server 2008 R2. 
You learned how to conﬁ gure an iSCSI initiator and a connection to an iSCSI target. After 
that we looked at its iSNS server and how to conﬁ gure it. 
 We concluded the chapter by looking at Storage Manager for SANs and Storage Explorer, 
which are built - in management tools in Windows Server 2008 R2 for storage devices. 
 Exam Essentials  
  Know disk types.   Know how to initialize disks and the type of partitioning to choose. 
Also know the difference between dynamic and basic disks and when to use them.  
  Understand RAID.   Know the various RAID types, the requirements for each, and when it 
is appropriate to use each type.   
  Know storage technologies.   Understand how to use the storage technologies Fibre 
Channel, iSCSI, and NAS. Know how to conﬁ gure an iSCSI initiator and how to establish 
a connection to a target. Know the various MPIO policies.  
  Understand how to manage storage.   Know what type of administrative features are 
available for Storage Manager for SANs and Storage Explorer.  

Review Questions 
839
 Review Questions  
 1. 
  What are the various supported RAID types in Windows Server 2008 R2? (Choose three.)  
 A.   RAID - 5 
 B.   RAID - 1 
 C.   RAID - 0 
 D.   RAID - 1+0  
 2. 
  What type of MPIO policy allows load balancing across multiple active paths?  
 A.   Failover  
 B.   Round robin  
 C.   Dynamic Least Queue Depth  
 D.   Weighted path  
 3. 
 What is the minimum number of disks required in a RAID - 5 set?  
 A.   One 
 B.   Two  
 C.   Three 
 D.   Four 
 4. 
  What is the minimum number of disks required in a RAID - 1 set?  
 A.   One 
 B.   Two  
 C.   Three  
 D.   Four 
 5. 
  What is the default TCP port for iSCSI?  
 A.   3389  
 B.   1433  
 C.   21  
 D.   3260  
 6. 
 What is the largest partition size available for MBR?  
 A.   1TB 
 B.   2TB 
 C.   3TB  
 D.   4TB  

 7. 
  How many primary partitions can be made on a disk drive with MBR?  
 A.   One 
 B.   Two  
 C.   Three 
 D.   Four 
 8. 
  Which of the following names/terms identifies a Fibre Channel HBA?  
 A.   WWN  
 B.   iqn  
 C.   UNC  
 D.   MAC  
 9. 
  True/False: A basic disk can be configured in a RAID - 5 volume set. 
 A.   True  
 B.   False  
 10.   Five 100GB disk drives are used in a RAID - 5 set. Approximately how much disk space is 
available?  
 A.   200 GB 
 B.   100 GB 
 C.   500 GB 
 D.   400 GB 
 E. 
  300 GB 
840 
Chapter 19 ■ Windows Server 2008 R2 Storage Services

 Answers to Review Questions 
 1. 
A, B, C .  Windows Server 2008 supports only software RAID levels 0, 1, and 5. Other 
types of RAID, such as RAID - 1+0, are available with hardware RAID controllers.  
 2. 
B .  Round robin uses all available paths, and all paths will be active. Failover, Dynamic 
Least Queue Depth, and weighted path will not load - balance across the paths. 
 3. 
C .  The minimum number disks required in a RAID - 5 set is three.  
 4. 
B .  The minimum number of disks requires in a RAID - 1 set is 2. 
 5. 
D .  The iSCSI default port is TCP 3260. Port 3389 is used for RDP, port 1433 is used for 
MS SQL, and port 21 is used for FTP.  
 6. 
B .  The largest available partition available with MBR is 2 terabytes.  
 7. 
D .  MBR supports only four primary partitions, but the fourth partition can be made into 
an extended partition where many logical partitions can be created.  
 8. 
A .  Fibre Channel HBAs use the WWN (World Wide Name) to identify itself from other 
HBAs in a Fibre Channel fabric. An iqn is used by an iSCSI initiator to identify itself. MAC 
addresses are used with NICs. A UNC (Universal Naming Convention) is used to designate 
ﬁ le locations on a network.  
 9. 
B .  When you ’ re creating a RAID - 5 volume set, a basic disk will be converted into a 
dynamic disk.  
 10. D .  To calculate RAID - 5 disk space, add the total available space across all disks and 
subtract the space of one disk. In this case, 500    100   400.  
 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
841


Remote Desktop 
Services in Windows 
Server 2008 R2   
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Remote Desktop Services  
■   Configure RemoteApp and Remote Desktop Web Access. 
May include but is not limited to: providing access to remote 
resources; per - user filtering; forms - based authentication; 
single sign - on.  
■   Configure Remote Desktop Gateway (RD Gateway). May 
include but is not limited to: certificate configuration; 
Remote Desktop resource authorization policy 
(RD RAP); Remote Desktop connection authorization 
policy (RD CAP); Remote Desktop group policy.  
■   Configure Remote Desktop Connection Broker. May include 
but is not limited to: redirection modes; DNS registration; set 
by using group policy.  
■   Configure and monitor Remote Desktop resources. May 
include but is not limited to: allocate resources by using 
Windows Server Resource Manager; configure application 
logging; fair share CPU scheduling; viewing processes.  
■   Configure Remote Desktop licensing. May include but is 
not limited to: deploy licensing server; connectivity 
between Remote Desktop Session Hosts (RD Session Hosts) 
and Remote Desktop Licensing (RD Licensing); recovering 
Remote Desktop Licensing server; managing Remote 
Desktop Services client access licenses (RDS CALs); 
revoking licensing.  
■   Configure Remote Desktop Session Host. May include but 
is not limited to: session options; session permissions; 
display data prioritization; profiles and home folders; IP 
Virtualization; RemoteFX.  

 Chapter 
20

 With advances over the years and even updates in Windows 
Server 2003 to the previous version of Terminal Services, 
 Windows Server 2008 R2 is a much more attractive option for 
some business applications or, at the very least, worth a look. Terminal Services has changed 
in Windows Server 2008 R2 and it is now called Remote Desktop Services. 
 The client computer communicates to a Remote Desktop Services server over TCP port 
3389 using client software called Remote Desktop Connection (RDC). Many of the new 
features available with Windows Server 2008 R2 require the most recent update to the 
RDC client software, although older RDC clients will continue to work. 
 These older RDC clients will have more or less the same functionality as Terminal Services 
for Windows Server 2003. The client will be able to connect to a Remote Desktop 
Services server on Windows Server 2008 R2 and have some of the same functionality, but 
not all the functionality is available. 
 To ﬁ nd out the version of RDC that is installed, open the Remote Desktop Connection 
client by clicking Start   All Programs   Accessories   Remote Desktop Connection. 
Once the client is open, right - click the computer icon in the upper - left corner and choose 
About. A dialog box appears with version information and supported features on the RDC 
client installed, such as Network Level Authentication. Figure 20.1 shows the version 
information of an RDC 6.1.7600 client.  
 F I G U R E 2 0.1 RDC version information 

 Remote Desktop Connection Display 
 The new RDC software enables the use of higher - resolution displays with multiple - monitor 
spanning on the client computer and clearer text with font smoothing. In conjunction with 
Remote Desktop Services running Windows Server 2008 R2, the new RDC software will give 
the users a Windows 7 look and feel with the new Desktop Experience. In addition, Display 
Data Prioritization will give display, mouse, and keyboard trafﬁ c better performance. 
 Custom Display Resolutions 
 In previous versions, the only supported display resolution was 4:3 with the maximum 
resolution of 1600   1200. Now, with widescreen monitors, 16:9 and 16:10 are available 
with resolutions of 1680   1050 and 1920   1200 and a new maximum supported 
resolution of 4096   2048. Figure 20.2 shows the Display tab of the Remote Desktop 
Connection client, accessed via the Options button.  
 F I G U R E 2 0. 2 The RDC Display tab 
 Custom display resolutions can also be set in an RDP ﬁ le or from a command prompt: 
 Open the RDP ﬁ le in a text editor and edit the following settings, where   < value >  is the 
resolution (for example, 1920 or 1200): 
desktopwidth:i: < value > 
desktopheight:i: < value > 
 Use  mstsc.exe at the command prompt with the following settings: 
mstsc.exe /w: < width >  /h: < height > 
■
■
Remote Desktop Connection Display 
845

846 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Monitor Spanning 
 Monitor spanning allows the display of the remote desktop session to stretch across 
multiple monitors. For monitor spanning to function, all the monitors must have the same 
resolution and their total resolution cannot exceed 4096   2048. Another limitation is that 
spanning occurs only horizontally (side by side), not vertically. 
 You can set monitor spanning in an RDP ﬁ le or from a command prompt.  
 Open the RDP ﬁ le in a text editor. Change the following setting, where  < value >  =  0 
indicates that monitor spanning is disabled and  < value >    = 1 indicates that monitor 
spanning is enabled: 
Span:i: < value > 
 Use  mstsc.exe at the command prompt with the following settings: 
mstsc.exe /span 
 Font Smoothing 
 If you ’ re using an LCD monitor, font smoothing is a feature that will be of interest. 
Windows Server 2008 R2 now supports ClearType, which is a Microsoft technique that 
improves the readability of text. For users to take advantage of this feature, Remote 
Desktop Services servers must have ClearType enabled and font smoothing must be enabled 
in the RDC client. 
 The following operating systems support font smoothing: 
 Windows 7  
 Windows Vista  
 Windows Server 2003 Service Pack 1 or 2 with RDC 6.0  
 Windows XP Service Pack 2 with RDC 6.0  
 In Exercise 20.1, you ’ ll enable font smoothing on a Windows 7 client.  
 E X E R C I S E  2 0 .1
Enabling Font Smoothing on a Client Computer 
 1. 
  Click Start   All Programs   Accessories   Remote Desktop Connection. (It is also 
possible to start the RDC client software by typing   mstsc  in the Run line.)  
 2. 
  In the Remote Desktop Connection dialog box, click Options. 
 3. 
  On the Experience tab, check Font Smoothing.  
 4. 
  Click Connect to launch the new session. 
■
■
■
■
■
■

 Display Data Prioritization 
 Another new feature to help with network utilization is Display Data Prioritization. 
Display Data Prioritization automatically controls and sets the precedence higher for 
the display, keyboard, and mouse virtual channel trafﬁ c than it is for virtual channel 
trafﬁ c for copying ﬁ les and printing. This alleviates the issue of having a slow or 
unresponsive mouse cursor after sending a large print job. 
 By default, the Display Data Prioritization bandwidth ratio is 70:30. Seventy percent 
of the available bandwidth goes to operations in which data is input, such as display, 
mouse, and keyboard operations, while ﬁ le transfers, print jobs, and Clipboard operations 
can consume only 30 percent. Of course, these settings are modiﬁ able by editing the 
Registry and changing the DWORD entry values located under the  HKEY_LOCAL_MACHINE\
SYSTEM\CurrentControlSet\Services\TermDDsubkey . Here is a list of the values and the 
characteristics of each:
 FlowControlDisable   Default value is 0. To disable Display Prioritization, set this value 
to 1. Once it ’ s disabled, all requests are ﬁ rst in, ﬁ rst out.  
 FlowControlDisplayBandwidth   Default value is 70. This value changes the relative 
bandwidth priority for display and other input data. The maximum allowed value is 255.  
 FlowControlChannelBandwidth   Default value is 30. This value changes the relative 
bandwidth priority for Clipboard operations, ﬁ le transfers, and print jobs. The maximum 
allowed value is 255. 
 FlowControlChargePostCompression   This value determines if ﬂ ow control calculates the 
bandwidth allocation based on precompression or postcompression bytes. The default is 
precompression, which is 0.  
 Display Data Prioritization is based on the ratio of the Registry values 
FlowControlDisplayBandwidth and FlowControlChannelBandwidth. For example, 
if FlowControlDisplayBandwidth is set to 200 and FlowControlChannelBandwidth is 
set to 50, the Display Data Prioritization ratio is 200:50, so 80 percent of the available 
bandwidth will go to display and other input data. Remember that the default ratio is 
70:30, so 70 percent of the available bandwidth will go to display and other input data.  
 Desktop Experience 
 In previous versions of Terminal Services, the Desktop was bland and dull and had limited 
features. Remote Desktop Services for Windows Server 2008 R2 and Remote Desktop 
Connection 6.1 gives users features like an improved Desktop that can be customized using 
themes, Windows Media Player 11, and even photo management. 
 For a user to beneﬁ t from the new Desktop experience, the client computer must have 
the Remote Desktop Connection 6.1 software, at a minimum, and the Windows Server 
2008 R2 Remote Desktop Services server must have the Desktop Experience feature 
enabled, which will be covered later in this section. 
Remote Desktop Connection Display 
847

848 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 To complete the desktop experience, Microsoft has introduced Desktop Composition 
in Windows Server 2008 R2. Windows 2008 R2 Remote Desktop Services Server is 
conﬁ gurable to provide the functionality of a Windows Aero desktop by using Remote 
Desktop Connection with a Windows Vista or Windows 7 client computer. With features 
such as Windows Flip 3D, translucent windows (Aero glass), and thumbnail - sized Taskbar 
button window previews, a user no longer has to look at a dull lifeless desktop. 
 However, with this new functionality also come limitations because Desktop 
Composition is supported only when you ’ re connecting to a Windows 2008 R2 RD 
server running in single - user mode or with a host client running Windows Vista or 
Windows 7. 
 Three things must occur to enable Desktop Composition. First, you must enable 
Desktop Experience on the Windows 2008 R2 Remote Desktop Services server. Second, 
you must use the Windows Vista or Windows 7 theme on the Windows 2008 R2 RD 
server. Third, you must enable Desktop Composition on the Windows Vista or Windows 7 
host client.  
 It is important to note that the Windows 7 or Windows Vista client must 
have the hardware capable of supporting Windows Aero to benefit from 
the Desktop Composition feature. However, the 2008 R2 RD server does 
not need to have hardware that is capable of running Windows Aero. 
 Exercises 20.2, 20.3, 20.4, and 20.5 walk you through the necessary steps to enable 
Desktop Experience for Remote Desktop Services on Windows Server 2008 R2. Let ’ s look 
ﬁ rst at enabling the feature itself, in Exercise 20.2.  
 E X E R C I S E  2 0 . 2
Enabling the Desktop Experience Feature  
 1. 
  Open Server Manager. Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Features and select Add Feature from the menu. 
 3. 
  Check Desktop Experience in the Feature Wizard. 
 4. 
  Click Next.  
 5. 
  Verify that the Desktop Experience feature is checked and click Install.  
 6. 
  Reboot after installation is complete. 
 In Exercise 20.3, you ’ ll continue the conﬁ guration of the Desktop Experience by 
enabling the Themes service.  

 E X E R C I S E  2 0 . 3
Starting the Themes Service 
 1. 
  Click Start   Administrative Tools   Services.  
 2. 
  Right - click Themes and choose Properties. 
 3. 
  On the General tab, change the startup type to Automatic.  
 4. 
  Click Apply.  
 5. 
  Click   Administrative Tools   Services.  
 6. 
  Double - click Themes. 
 7. 
  On the General tab, change the startup type to Automatic.  
 8. 
  Click OK.  
 9. 
  Right - click Themes and choose Start to start the Themes service. 
 Now that you have enabled the Themes service, you must select the Windows 7 theme 
(Exercise 20.4).  
 E X E R C I S E  2 0 . 4
Setting the Theme on Windows Server 2008 R2  
 1. 
  Click Start   Control Panel   Personalization   Theme.  
 2. 
  On the Themes tab, change the theme to Windows 7.  
 3. 
  Click OK.  
 The ﬁ nal step is to enable Desktop Composition and Themes on the client. Exercise 20.5 
shows you how.  
 E X E R C I S E  2 0 . 5
Making Desktop Composition Available on a Windows 7 Client  
 1. 
  Click Start   All Programs   Accessories   Remote Desktop Connection. (It is also 
possible to start the RDC client software by typing   mstsc  in the run line.) 
 2. 
  In the Remote Desktop Connection dialog box, click Options. 
 3. 
  On the Experience tab, check Desktop Composition And Themes.  
 4. 
  Click Connect to launch the new session. 
Remote Desktop Connection Display 
849

850 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Remember that Windows Aero will require more resources on your 
Remote Desktop Services server, so you must carefully consider how 
many concurrent user connections a single Remote Desktop Services 
server ’ s hardware will be able to support. This will be critical to overall 
user experience and server performance.  
 Device Redirection 
 The following sections are about the device redirection framework for Windows Server 
2008 R2. Device redirection gives users the ability to connect physical devices on 
their local computer and use them within their Remote Desktop Services session. 
 The ﬁ rst section discusses Plug and Play device redirection for media players and digital 
cameras based on the Picture Transfer Protocol (PTP). The second section introduces 
Microsoft Point of Services for .NET device redirection. In third section, we discuss 
printing redirection with RD Easy Print. 
 Plug and Play Device Redirection for Media Players 
and Digital Cameras 
 New to Windows Server 2008 R2 and RDC 6.1 is the ability to redirect speciﬁ c Plug and 
Play (PNP) Windows portable devices. These devices include media players and digital 
cameras based on the Media Transfer Protocol (MTP) and the Picture Transfer Protocol 
(PTP), respectively. Plug and Play device redirection allows applications to access devices 
whether the application is running in an RD remote desktop or with RD RemoteApp. 
 Another new feature is the ability to attach Plug and Play devices after a session has 
already been established with the Devices That I Plug In Later option within the Remote 
Desktop Connection client software. When a new session is launched, Plug and Play 
notiﬁ cations will appear in the taskbar on the client computer. The newly detected device 
is attached to that particular session and is not accessible from any other session. Exercise 
20.6 walks us through the process of enabling Plug and Play device redirection.  
 E X E R C I S E  2 0 . 6
Redirecting Plug and Play Devices  
 1. 
  Click Start   All Programs   Accessories   Remote Desktop Connection. (It is also 
possible to start the RDC client software by typing   mstsc  in the run line.) 
 2. 
  In the Remote Desktop Connection dialog box, click Options. 
 3. 
  On the Local Resources tab, click More.  
 4. 
  Under Local devices and resources expand Supported Plug And Play Devices.  

 5. 
  Choose the device you want to redirect.  
 6. 
  To make the Plug and Play device that you will plug in later available, select the Devices 
That I Plug In Later check box. 
 7. 
  Click Connect to launch the new session. 
 It is also possible to redirect drives that have been connected after a new 
session has been established by selecting the Drives That I Connect To 
Later check box.  
 Microsoft Point of Service for .NET Device Redirection 
 Microsoft Point of Service (POS) for .NET Device Redirection allows peripheral devices 
such as bar code scanners and magnetic card readers to interface with Remote Desktop 
Services for Windows 2008 R2. Microsoft POS for .NET 1.1 is available to download 
at the Microsoft Download Center. Once it ’ s installed, the Remote Desktop Services 
UserMode Port Redirector service must be restarted.  
 Remote Desktop Services Easy Print 
 Microsoft has improved printing in Remote Desktop Services for Windows 2008 R2 by 
adding Remote Desktop Services Easy Print and group polices that enable the redirection 
of only the default client printer. In the past, the client computer and the Remote Desktop 
Services server had to have the proper driver installed in order to successfully print. 
 Now matching the drivers on the two different systems is no longer necessary because 
the RD Easy Print driver proxies all requests to the client ’ s actual driver. This feature will 
please many administrators who had to support printer drivers in the previous version of 
Remote Desktop Services. 
 Another perk for administrators is that RD Easy Print will increase the scalability and 
decrease the complexity of the RD server by limiting the number of printers the spooler has 
to enumerate. When an RD session is created,  Winlogon will redirect a particular printer 
instead of redirecting all printers. The last beneﬁ t of RD Easy Print is that administrators 
will appreciate the support for legacy print drivers. 
 Although RD Easy Print has decreased administrator headaches with printing in Remote 
Desktop Services, only a select client base will receive its beneﬁ t. RD Easy Print is available 
only on client computers running Windows Vista SP1, Windows 7, Windows Server 2008, 
or Windows Server 2008 R2 using the RDC 6.1 and either the Microsoft .NET 
Framework 3.0 Service Pack 1 or Microsoft .NET Framework 3.5 or later.  
 Remote Desktop Services Easy Print is enabled by default. 
Remote Desktop Connection Display 
851

852 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Single Sign - On for Remote Desktop Services 
 With Single Sign - On for Remote Desktop Services, a domain user can enter their 
credentials once and gain access to a Remote Desktop Services server or their remote 
application. The current credentials of the logged - on user will be passed to the connecting 
RD server without the user having to retype their password. 
 To use Single Sign - On (SSO), the client must be running on Windows Vista, Windows 7, 
Windows Server 2008, or another Windows 2008 R2 Server machine, the user must have 
the appropriate rights to log on, and the client computer and RD server must be in the same 
domain. Exercise 20.7 demonstrates the process to conﬁ guring the Authentication level of 
Windows Server 2008 R2. If Remote Desktop Services are not yet installed, go to Exercise 
20.9 to install the service.  
 E X E R C I S E  2 0 . 7
Conﬁ guring Authentication of a Windows 2008 R2 Remote Desktop 
Services Server  
 1. 
  Open Remote Desktop Services Server Conﬁ guration. Click Start   Administrative 
Tools   Remote Desktop Services   Remote Desktop Services Host Conﬁ guration.  
 2. 
  Under Connections, right - click RDP - TCP and choose Properties. 
 3. 
  On the General tab, verify that the Security Layer value is either Negotiate or SSL 
(TLS 1.0) and then click OK.  
 Exercise 20.8 walks us through the procedures to conﬁ gure Single Sign - On on a 
Windows 7 computer.  
 E X E R C I S E  2 0 . 8
Conﬁ guring SSO on a Client Computer 
 1. 
  Open Local Group Policy Editor. Click Start   Run, type   gpedit.msc  , and press Enter.  
 2. 
  Expand and navigate to Computer Conﬁ guration   Administrative Templates   System 
  Credentials Delegation. 
 3. 
  Double - click Allow Delegating Default Credentials. 
 4. 
  In Properties on the Setting tab, click Enable and click Show.  
 5. 
  In Show Contents, click Add and add the Remote Desktop Services servers to the policy 
list by typing the preﬁ x   RDsrv/  in front of the server name (for example,   RDsrv/RDServ1 ).  
 6. 
  Click OK three times to close all the dialog boxes.  

 Remote Desktop Protocol Signing 
 Remote Desktop Protocol (RDP) signing gives users the ability to sign RDP ﬁ les and 
connections as long as these connections are opened from TS Web Access. Remote Desktop 
Protocol signing allows users to verify that they are not using harmful RDP ﬁ les to connect 
to potentially hostile terminal servers. 
 Administrators also have the ability to use Group Policy settings to verify that users can 
only open signed ﬁ les. This feature allows administrators to make sure that users connect only 
to known resources.  
 RDP 7.0 Benefits 
 With the release of Windows 7 and Windows Server 2008 R2, a new version of RDP (7.0) 
was introduced. If you are running a version of Windows 7 or Windows Server 2008 that 
is still using RDP 6.1, you can download the newest RDP client from Microsoft ’ s download 
site. This download is also available for Windows Vista clients with at least Service Pack 1 
or Windows XP with Service Pack 3. The following are some of the advantages of RDP 7.0.  
 Web Single Sign - On and Web Forms - Based Authentication   Forms - based authentication 
is now included with Remote Desktop (RD) Web Access. SSO allows the remote user to 
log on once. After the user is logged on, additional passwords will not be required for RD 
Gateway, RD Session Host servers, and RemoteApp programs.  
 Access to Personal Virtual Desktops by Using RD Connection Broker   If your servers are 
using Remote Desktop Virtualization Host in Windows Server 2008 R2, users will have 
the ability to access their personal virtual desktops.  
 Status and Disconnect System Tray Icon   Users can view all of their remote connections in 
a single system tray icon. Users will also have the ability to disconnect either individual or 
all connections from this system tray icon.  
 RD Gateway - Based Device Redirection Enforcement   One security issue in Windows 
Server 2008 RD Gateway was that clients not using Microsoft Remote Desktop could 
override the gateway device redirection controls. Windows Server 2008 R2 has ﬁ xed 
this issue, and now device redirection settings are deﬁ ned in RD Gateway and can be 
conﬁ gured not to be overridden.  
 RD Gateway System and Logon Messages   This feature allows an administrator to add 
messages to RD Gateway. These messages will be displayed to remote desktop users when 
they log on. This gives administrators the ability to send logon messages and system 
messages to users when they log on to the Remote Desktop server.  
 RD Gateway Idle and Session Time - outs   Administrators can better control user access by 
conﬁ gurable idle and session time - outs using RD Gateway.  
RDP 7.0 Benefits 
853

854 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
  NAP Remediation with RD Gateway   You have the ability to keep remote clients 
in compliance with network security policies by using NAP. Using NAP also allows 
administrators to make sure that remote clients have the latest software updates and 
patches before allowing access to the Remote Desktop machine.  
  Multiple Monitor Support   Using RDP 7.0 allows you to support up to 16 monitors, and it 
works with both Remote Desktop and RemoteApp programs.  
 Understanding RemoteFX 
 Microsoft has introduced a new feature in Windows Server 2008 R2 with Service 
Pack 1 called RemoteFX. RemoteFX is a set of end - user experience enhancements for 
Remote Desktop Protocol (RDP). These enhancements enable a rich desktop environment 
for client devices including rich clients, thin clients, and ultrathin clients. 
 Virtual Desktop Infrastructure (VDI) users also get a rich user experience using 
RemoteFX. RemoteFX improves VDI users by providing a 3D virtual adapter, intelligent 
codecs, and the ability to redirect USB devices in virtual machines. 
 Because RemoteFX is integrated with RDP by default, RemoteFX allows for shared 
encryption, authentication, management, and device support. 
 If you would like to take full advantage of RemoteFX functionality, the following 
hardware requirements must be met: 
 Hyper - V server 
 Client computer running Remote Desktop Connection 7.1  
 Benefits of Using RemoteFX 
 We have stated that RemoteFX allows for a rich user environment. Now let ’ s take a look at 
some of the new functionality that is provided by using RemoteFX:
  Host Side Rendering   The host side rendering feature allows graphics to be rendered on 
the host device instead of on the client device. Host side rendering allows for all graphics 
types because it sends highly compressed bitmap images to the endpoint device in an 
adaptive manner. Host side rendering also allows applications to run at peak performance 
on the host computer. It does this by taking advantage of the graphics processing unit 
(GPU) and the CPU. This in turn provides an experience that is similar to using a local 
computer.  
  GPU Virtualization   GPU Virtualization is a feature that shows the virtual graphics device 
to a virtual machine. RemoteFX, along with GPU Virtualization, allows multiple virtual 
desktops to share a single GPU on a Hyper - V server.  
  Intelligent Screen Capture   The Intelligent Screen Capture feature checks for screen 
content changes between frames. This feature then transmits the changed bits for encoding.  
■
■

 RemoteFX Encoder   This feature allows for encoding on the CPU, on the GPU, or on 
dedicated hardware. Screen data is compressed and the compressed data is sent to the 
virtual desktop. The virtual desktop then transfers the bitmaps by using Remote Desktop 
Connection client computers.   
 RemoteFX Decoder   The RemoteFX Decoder is the second part of the encoding 
process. After the RemoteFX Encoder sends the data, the RemoteFX Decoder decodes the 
bitmaps from the virtual desktop to the client computer. RemoteFX Decoder decodes 
the bitmaps on the client computer by using software in the GPU or processor or by using a 
hardware decoder.  
 RemoteFX for Remote Desktop Session Host   RemoteFX allows the RD Session Host 
server to access rich clients, thin clients, and ultrathin clients.  
 Prepare and Configure the Use of 
Remote Desktop Services RemoteApp 
 In the following sections, we ’ ll discuss a feature of Remote Desktop Services for Windows 
2008 R2 called Remote Desktop Services RemoteApp (RemoteApp). In previous versions 
of Remote Desktop Services, the only option was to publish the full Desktop, but with RD 
RemoteApp, now individual applications can be published. What this means is that, 
instead of launching a new Desktop session to run an application that is running on 
the Remote Desktop Services server, you can publish an individual application from the 
Remote Desktop Services server, and it will appear as if is it is running on the client ’ s 
local computer. 
 No longer will users have to deal with the confusion of running two different Desktops 
to run all their applications. Before we dive too deeply into RD RemoteApp and its 
features, we need to install the Remote Desktop Services role on our Windows 2008 
R2 server. 
 Terminal Services Web Access 
 One thing that you might want is to allow users to access Windows Server 2008 R2 
Terminal Services RemoteApp (TS RemoteApp). Terminal Services Web Access (TS Web 
Access) is a service in Terminal Services that allows users to access RemoteApps from a 
web browser. 
 In addition to accessing RemoteApps, TS Web Access allows you to make a link 
available to the terminal server desktop. TS Web Access also allows users to open a 
connection from a web browser to the remote desktop of any server or client computer as 
long as the users have the rights to access the machine.  
Prepare and Configure the Use of Remote Desktop Services RemoteApp 
855

856 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Installing Programs to Be Used with RemoteApp 
 RD RemoteApp is made available through the installation of Remote Desktop Services on 
Windows Server 2008 R2. As the administrator of the server installs applications on the 
server, they can be added to a published list of programs that users will be able to access. In 
Exercise 20.9, you ’ ll install the Remote Desktop Services role and change the user mode to 
allow applications to be installed correctly on an RD server.  
 E X E R C I S E  2 0 . 9
Installing the Remote Desktop Services Role  
 1. 
  Open Server Manager. Click Start   Administrative Tools   Server Manager. 
 2. 
  Under Roles Summary, click Add Roles.  
 3. 
  In the Add Role Wizard, on the Before You Begin page, click Next. 
 4. 
  On the Select Server Roles page, check Remote Desktop Services. If Remote Desktop 
Services is already installed, this check box will be grayed out. 
 5. 
  Click Next.  
 6. 
  On the Introduction To Remote Desktop Services page, click Next. 
 7. 
  On the Select Role Services page, select all Services except RD Virtualization services 
and click Next.  
 8. 
  On the Uninstall And Reinstall Applications For Compatibility page, click Next.  
 9. 
  On the Specify Authentication Method For Remote Desktop Services page, select 
the authentication you will be using and click Next. If you select Require Network 
Level Authentication, only computers running Windows 7 with RDC 6.1 or higher 
will be allowed to connect to the server. If you select Do Not Require Network Level 
Authentication, any RDC client can connect to the RD server.  
 10.   On the Specify Licensing Mode page, select the licensing mode you will be using and 
click Next. 
 11.   On the Select User Groups Allowed Access To This Remote Desktop Services Server 
page, add the users or groups that you will allow to connect and click Next.  
 12.   On the Client Experience screen, just click Next. 
 13.   On the Conﬁ gure Discovery Scope Screen, click Next.  
 14.   On the Certiﬁ cate screen, choose the bottom option, Choose A Certiﬁ cate For SSL Later, 
and click Next.  

 15.   On the Create Authorization policies screen, choose Later and click Next.  
 16.   Click Next at the Network Policy Intro screen.  
 17.   At the Select Role Service screen, accept the defaults and click Next. 
 18.   Click Next at the IIS Intro screen.  
 19.   At the Select Role Service screen, accept the defaults and click Next. 
 20.   On the Conﬁ rm Installation Selections page, verify the settings and click Install.  
 21.   After the installation, you will be prompted to restart the server to ﬁ nish the installation 
process. Click Close and Yes to restart the server.  
 After you install the Remote Desktop Services role, you need to install the programs that 
are going to be published. Before you install a program on a Remote Desktop Services server, 
the server needs to be placed in install mode, and after installation is complete, the server 
needs to placed back into execute mode (see Figure 20.3). 
 To change the system to install mode, type   change user /install  at the command 
prompt.  
 To change the system to execute mode, type   change user /execute  at the command 
prompt.  
 To get additional information or help, type   change user  or   change user /?  at the 
command prompt.  
■
■
■
 F I G U R E  2 0 . 3 User mode commands 
Prepare and Configure the Use of Remote Desktop Services RemoteApp 
857

858 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Prepare and Configure Remote 
Desktop Services Gateway 
 Remote Desktop Services Gateway (RD Gateway) is a role for Windows Server 2008 
R2 that encapsulates Remote Desktop Protocol trafﬁ c over HTTP with SSL encryption 
(HTTPS) and provides a secure link for authorized remote users on the Internet to access 
internal Remote Desktop Services server applications without creating a virtual private 
network connection. 
 Instead of using TCP port 3389, RD Gateway transmits the RDP trafﬁ c over TCP 
port 443, so little or no modiﬁ cation is needed to the external ﬁ rewall because this port 
is usually already open for other HTTPS trafﬁ c. The RD Gateway server sits behind the 
external ﬁ rewall, and when the ﬁ rewall receives RDP over HTTP trafﬁ c, it strips off 
the HTTP header and passes the RDP packets to the RD Gateway server. 
 The RD Gateway server will then check the Network Policy Server (NPS) service and 
Active Directory to authenticate the remote user. Once authentication has completed, the 
user will be allowed access to the internal Remote Desktop Services servers to run the RD 
Web Access – enabled RD RemoteApp programs. The default website for RD Web Access 
is  http:// server_name /ts . 
 Preparing the Necessary RD Gateway Role Services 
 Very similar to installing RemoteApps, RD Gateway requires that additional roles be 
installed on the Windows 2008 R2 server. To install the RD Gateway role, the following 
roles services are also required: 
 Remote Procedure Call (RPC) over HTTP Proxy  
 Web Server (Internet Information Services 7.0)  
 Network Policy and Access Services  
 Obtaining and Configuring a Certificate for RD Gateway 
 RD Gateway requires a valid digital certiﬁ cate so that it can use SSL to encrypt the 
trafﬁ c to the remote clients. The purpose of the digital certiﬁ cate is to prove the identity 
of a remote person or a remote resource. In RD Gateway, there are two methods of 
obtaining a certiﬁ cate. The ﬁ rst is to purchase a digital certiﬁ cate from a third - party 
certiﬁ cate authority (CA). Microsoft has a list of approved CAs at the following site: 
 http://support.microsoft.com/kb/931125 . 
 The second option is to create a self - signed certiﬁ cate. Although the option to create a 
self - signed certiﬁ cate is available, it not recommend for other than testing and evolution 
purposes because the certiﬁ cate must be copied and installed in the Trusted Root 
■
■
■

Certiﬁ cate Authorities store on each client computer. Exercise 20.10 walks you through the 
installation of a certiﬁ cate on an RD Gateway server.  
 The procedure in Exercise 20.10 is not required if you have created a self -
 signed certificate.  
 E X E R C I S E  2 0 .1 0
Installing a Certiﬁ cate on the RD Gateway Server  
 1. 
  Click Start   Run. Type   mmc  and press Enter.  
 2. 
  On the File menu, click Add/Remove Snap In. 
 3. 
  From the available snap - ins, select Certiﬁ cates and click Add. 
 4. 
  In Certiﬁ cates Snap - in, select Computer Account and click Finish. 
 5. 
  Click OK.  
 6. 
  Expand Certiﬁ cates.  
 7. 
  Right - click Personal   All Tasks   Import. 
 8. 
  On the Welcome To The Certiﬁ cate Import Wizard page, click Next.  
 9. 
  On the File To Import page, enter the name of the certiﬁ cate that will be imported. 
Click Next. 
 10.   On the Password page, do the following: 
 If you speciﬁ ed a password for the private key associated with the certiﬁ cate 
earlier, type the password.  
 If you want to mark the private key for the certiﬁ cate as exportable, ensure that 
Mark This Key As Exportable is selected.  
 If you want to include all extended properties for the certiﬁ cate, ensure that Include 
All Extended Properties is selected. 
 11.   Click Next.  
 12.   On the Certiﬁ cate Store page, accept the defaults and click Next.  
 13.   Conﬁ rm that the correct certiﬁ cate has been selected and click Finish. 
 14.   A conﬁ rmation message appears when the certiﬁ cate has been imported 
successfully.  
■
■
■
Prepare and Configure Remote Desktop Services Gateway 
859

860 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Exercise 20.11 guides you through the mapping of the certiﬁ cate to the RD Gateway 
server.  
 E X E R C I S E  2 0 .11
Mapping the Certiﬁ cate to the RD Gateway Server 
 Follow these steps to map a certiﬁ cate to an RD Gateway server. 
 1. 
  Open RD Gateway Manager. Click Start   Administrative Tools   Remote Desktop 
Services   RD Gateway Manager. 
 2. 
  Right - click the RD Gateway server and choose Properties. 
 3. 
  On the SSL Certiﬁ cate tab, click Select An Existing Certiﬁ cate for SSL Encryption.  
 4. 
  Click Browse Certiﬁ cates.  
 5. 
  Click the appropriate certiﬁ cate, and click Install. 
 6. 
  Click OK. 
 Creating Remote Desktop Services Connection 
Authorization Policies 
 Remote Desktop Services connection authorization policies (RD CAPs) must be created 
after the RD Gateway role service has been installed. The purpose of RD CAPs is to set 
conditions that remote users must meet in order to gain access to an RD Gateway server. 
You can set criteria such as whether a user connecting must be a member of a particular 
security group, whether a computer requesting a connection must be a member of 
a security group, and who has the ability to disable some or all device redirections. 
 Polices are placed in numerical order, which are shown in RD Gateway Manager. Access 
to the RD Gateway server is granted by matching the ﬁ rst policy that meets all the set 
conditions. For example, if a remote client does not meet the requirements of the ﬁ rst RD 
CAP in the list, it will move to the second RD CAP and will keep going down the list until 
it locates an RD CAP whose requirements it matches. If a remote client does not meet any 
of the requirements in the RD CAPs list, RD Gateway denies access. Exercise 20.12 shows 
you how to create an RD CAP for the RD Gateway server.  
 E X E R C I S E  2 0 .1 2
Creating an RD CAP for the RD Gateway Server  
 1. 
  Open RD Gateway Manager. Click Start   Administrative Tools   Remote Desktop 
Services   RD Gateway Manager. 
 2. 
  Expand the RD Gateway server. 

 3. 
  Expand Policies and click Connection Authorization Policies.  
 4. 
  In the Actions pane, click Create New Policy and select Custom.  
 5. 
  On the General tab, type the name of the policy, and verify that Enable This Policy is 
checked.  
 6. 
  On the Requirements tab, check the supported Windows authentication methods, either 
Password or Smart Card or both. 
 7. 
  In User Group Membership, click Add Group to specify the user group(s) that can 
connect to the RD Gateway server. Note that at least one user group must be listed. 
 8. 
  In Client Computer Group Membership, click Add Group if computer groups are going 
to be users. Computer groups are optional. 
 9. 
  On the Device Redirection tab, enable or disable the redirection for client devices.  
 10.   Click OK.  
 11.   The policy will appear in the Connection Authorization Policies pane.  
 Creating Remote Desktop Services Resource 
Authorization Policies 
 Like RD CAPs, Remote Desktop Services resource authorization polices (RD RAPs) also must 
be created after the RD Gateway role service has been installed. The purpose of RD RAPs is 
to specify computers that remote users can connect to through the RD Gateway server. 
 RD RAPs associates speciﬁ c user groups with computer groups, which grants access 
to the computers listed in the group. For example, members of the Accounting Users user 
group are allowed to connect only to computers that are members of the Accounting 
Computers computer group. Exercise 20.13 shows you how to create an RD RAP for the 
RD Gateway server. 
 
Remote users connecting through an RD Gateway server are granted 
access only when they meet at least one RD CAP and one RD RAP. 
 E X E R C I S E  2 0 .1 3
Creating an RD RAP and Specifying Computers 
 1. 
  Open RD Gateway Manager. Click Start   Administrative Tools   Remote Desktop 
Services   RD Gateway Manager. 
 2. 
  Expand the RD Gateway server. 
Prepare and Configure Remote Desktop Services Gateway 
861

862 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
E X E R C I S E  2 0 .1 3  (c o n t i n u e d)
 3. 
  Expand Policies and click Resource Authorization Polices.  
 4. 
  In the Actions pane, click Create New Policy and select Custom.  
 5. 
  On the General tab, type the name of the policy, add a brief description, and verify that 
Enable This Policy is checked.  
 6. 
  On the User Groups tab, click Add to select the user groups.  
 7. 
  On the Computer Group tab, specify the computer group that the users will connect to 
through RD Gateway. 
 8. 
  On Allowed Ports tab, specify the TCP ports users will be using.  
 9. 
  Click OK. The new RD RAP appears in the Resource Authorization Policies pane.  
 Configuring the Remote Desktop Services Client 
for RD Gateway 
 The client computer must verify and trust the RD Gateway server before users can 
complete their authentication. They must have the certiﬁ cate of the RD Gateway server in 
their Trusted Root Certiﬁ cate Authorities store. This is accomplished in a manner that ’ s 
similar to importing the certiﬁ cate to RD Gateway through the use of the Certiﬁ cates snap -
 in on the client computer. 
 Remember, if a certiﬁ cate is issued by a third - party certiﬁ cate authority, the digital 
certiﬁ cate does not need to be added to the client ’ s Trusted Root Certiﬁ cate Authorities store.  
 Configuring Remote Desktop Services 
Load Balancing 
 Remote Desktop Services Connection Broker (RD Connection Broker) is new and improved 
in Windows Server 2008 R2. Many of you will remember this feature from Windows 
Server 2003 as Remote Desktop Services Connection Directory. In its latest incarnation, 
it allows users to reconnect to a disconnected session in a load - balanced Remote Desktop 
Services server farm. 
 RD Connection Broker stores various session state information, like session ID and 
username, so a user can reconnect and resume work right where they left off even if the 
user has reconnected from a different client computer. With Windows Server 2003, Session 

Directory required the Enterprise Edition, but RD Connection Broker is available on the 
Standard Edition of Windows Server 2008 R2 and on Windows Server 2008 Enterprise 
and Datacenter editions. 
 Another change to the feature is that Windows Server 2008 R2 has integrated the 
RD Connection Broker Load Balancing feature to include out - of - the - box load balancing 
designed to replace Microsoft Network Load Balancing (NLB), although RD Connection 
Broker will continue to work with other third - party solutions, like hardware load 
balancers, and with Microsoft NLB. The ﬁ nal new feature introduced with RD Connection 
Broker is Remote Desktop Services Server Draining; a Remote Desktop Services server 
in an RD Connection Broker load - balanced Remote Desktop Services server farm can be 
placed in drain mode, aka maintenance mode, where users can reconnect to disconnected 
sessions but not establish new sessions. 
 Configuring a Remote Desktop Services Server 
Farm with RD Connection Broker 
 RD Connection Broker Load Balancing works in two stages: DNS Load Balancing 
(DNS round robin) or Microsoft Network Load Balancing (NLB) and a query to the 
RD Broker server to determine user redirection. After the initial connection is made with 
DNS round robin or NLB, the RD Connection Broker checks for the existence of a 
user session. 
 If the user has an existing session, they will connect back to the same Remote 
Desktop Services server and continue working in their original session, whereas if there 
is no existing session, the user will connect to the Remote Desktop Services server that 
has the fewest sessions and create a new session. To prevent a single server from being 
overwhelmed by new logon requests, RD Connection Broker Load Balancing sets a limit 
of 16 maximum pending logon requests to any one Remote Desktop Services server. It is 
important to note that when using DNS round robin, the client will connect to the ﬁ rst 
DNS record initially, but the RD Connection Broker service will direct the connection to 
the appropriate server based on the farm settings. 
 It is also possible to assign a relative weight value to each server that can help distribute 
the load of the servers within the Remote Desktop Services server farm. The default relative 
weight value is 100. When you change the relative weight value to 200, the server with the 
new value of 200 will receive twice as many connections. This is a way to distribute users 
to servers that have greater hardware capabilities. 
 There are some speciﬁ c requirements to utilize RD Connection Broker Load Balancing. 
An RD Connection Broker server and Remote Desktop Services servers in the farm all 
must be running Windows Server 2008 R2 to participate in RD Connection Broker Load 
Balancing. All the terminals must have identical RemoteApp program lists, they must have 
the same server conﬁ guration, and they must be in the same domain. The client computers 
must be running RDC 5.2 or later. 
Configuring Remote Desktop Services Load Balancing 
863

864 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Now that you have an understanding of what RD Connection Broker Load Balancing is, 
you need to learn how to deploy it. There are four tasks to complete the install and setup: 
 1. 
 Install the RD Connection Broker role.  
 2. 
  Add Remote Desktop Services servers in the farm to the Session Directory Computers 
local group on the RD Connection Broker server.  
 3. 
  Conﬁ gure the Remote Desktop Services servers to join a farm and participate in load 
balancing. 
 4. 
  Conﬁ gure DNS for RD Connection Broker Load Balancing.  
 You cannot use the RD Connection Broker Load Balancing feature on 
Windows Server 2003 Terminal Server servers.  
 For an RD server to join an RD Connection Broker farm, you must know the following: 
 RD Connection Broker server name or IP address. This is the name or the IP address 
of the RD Connection Broker server.  
 RD Connection Broker farm name. This is the name of the farm that you want 
to join.  
 RD Connection Broker uses a farm name to determine which servers are in the farm. 
The same farm name must be used for all servers that are participating in the same 
load - balanced farm. 
 Exercise 20.14 shows you how to conﬁ gure DNS for RD Connection Broker Load 
Balancing.  
 E X E R C I S E  2 0 .1 4
Conﬁ guring DNS for RD Connection Broker Load Balancing 
 1. 
  Click Start   Administrative Tools   DNS.  
 2. 
  Expand Server Name.  
 3. 
  Expand Forward Lookup Zones. 
 4. 
  Right - click the zone, and select New Host (A or AAAA).  
 5. 
  In the Name (use parent domain if blank) ﬁ eld, type the Remote Desktop Services server 
farm name. Do not use the name of an existing server for the farm name.  
 6. 
  In the IP Address ﬁ eld, type the IP address of the Remote Desktop Services server in 
the farm.  
 7. 
  Click Add Host. 
■
■

 8. 
  Click OK when the message host record is successfully created.  
 9. 
  Add each Remote Desktop Services server that is in the farm. If you have six Remote 
Desktop Services servers in the farm, you should have six farm entries.  
 10.   Click Done.  
 Configuring Network Load Balancing 
 As stated previously, RD Connection Broker can also take advantage of Microsoft NLB 
instead of DNS round robin to distribute clients over the terminals. The requirements for 
NLB are as follows: 
 All hosts in the NLB cluster must reside on the same subnet.  
 The cluster ’ s clients must be able to access that subnet.  
 All Remote Desktop Services servers in the RD farm are in the same domain.  
 Just as we did in the section on RD Connection Broker Load Balancing, we can break 
down the installation of RD Connection Broker with Microsoft NLB into separate tasks: 
 1. 
 Set up a Remote Desktop Services server farm with RD Connection Broker. 
Remember that the IP address used for reconnection must not be the same as the 
cluster IP address.  
 2. 
  Install NLB. 
 3. 
  Create an NLB cluster.  
 Exercise 20.15 will walk you through the process of installing Microsoft NLB and 
creating an NLB cluster.  
 E X E R C I S E  2 0 .1 5
Installing NLB and Creating an NLB Cluster 
 1. 
  Open Server Manager. Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Features and choose Add Features. 
 3. 
  Check Network Load Balancing.  
 4. 
  Click Next.  
 5. 
  Conﬁ rm the installation selections and click Install. 
 6. 
  Conﬁ rm the installation results and click Close. 
 7. 
  Open Network Balancing Manager. Click Start   Administrative Tools   Network Load 
Balancing Manager.  
 8. 
  Right - click Network Load Balancing Clusters and choose New Cluster. 
■
■
■
Configuring Remote Desktop Services Load Balancing 
865

866 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
E X E R C I S E  2 0 .1 5  (c o n t i n u e d)
 9. 
  Enter the hostname and click Connect.  
 10.   Select the interface you want to cluster.  
 11.   Click Next.  
 12.   In the Host Parameters, select Priority (Unique Host Identiﬁ er). This value is a unique ID 
for each host. Click Next. 
 13.   In the Cluster IP Address, click Add to enter the IP address that will be shared with all 
Remote Desktop Services servers in the farm. Click Next. 
 14.   In the Cluster Parameter, verify that Unicast is selected and click Next.  
 15.   In the Port Rules, click Edit and conﬁ gure the following: 
 Port Range: 3389 to 3389  
 Protocols: TCP  
 Filtering Mode: Multiple Host  
 Afﬁ nity: None  
 16.   Click OK. 
 17.   Click Finish. 
 18.   To add more hosts to the cluster, right - click the new cluster and then click Add Host to 
Cluster. Do this for every Remote Desktop Services server in the farm. 
 Configuring Remote Desktop Licensing 
 Remote Desktop Licensing (RD Licensing) is one of those necessary evils that we all want to 
dismiss, but without proper licensing, your terminal server will stop accepting connections 
after a period of time. This time period depends on the OS version you are using. What RD 
Licensing does is manage the client access licenses (RD CALs) that are required of a user or 
a device to connect to a terminal server. RD Licensing in Windows Server 2008 R2 has some 
new features that will ease management, enable the administrator to revoke licenses, and 
provide more effective ways to diagnose licensing issues. 
 Remote Desktop Services Client Access Licenses 
 There are two types of client access licenses (CALs), RD Per Device CALs and RD Per User 
CALs, and they must match the licensing mode that has been conﬁ gured on the Remote 
■
■
■
■

Desktop Services license server. With the Per Device licensing mode, a client computer 
connecting for the ﬁ rst time is issued a temporary license. 
 At the next connection, the license server veriﬁ es that there are enough RD Per Device 
CALs and issues the client computer a permanent CAL. Inversely, RD Per User CALs 
give users the ability to connect to a terminal server from any client computer and are not 
enforced by the RD license server. 
 To ensure that you are compliant with the license terms, you can use the RD Licensing 
Manager tool to track and generate reports of the RD Per User CALS that have been issued 
by the RD license server. This will be covered later in the chapter when you learn how to 
create RD Per CAL usage reports.  
 Installing RD Licensing and RD Client Access Licenses 
 To use Remote Desktop Services, there must be at least one license server deployed in the 
environment. As mentioned earlier, there is a licensing grace period within which the license 
server will issue temporary RD CALs and does not have to be activated. The grace period 
begins when a terminal server accepts its ﬁ rst client connection and ends when the number 
of days in the grace period is exceeded or when the ﬁ rst permanent RD CAL is issued by 
the license server. 
 The length of the grace period is dependent on the OS the terminal server is running 
(see Table 20.1). Before the grace period ends, the appropriate number of RD CALs must 
be purchased and installed. A message stating the number of days left in the licensing 
grace period appears in the lower - right corner of a terminal server ’ s Desktop when an 
administrator logs on.  
 TA B L E 2 0.1 Licensing grace periods of Remote Desktop Services by OS 
 Operating System  
  Grace Period  
 Windows Server 2008 and 2008 R2  
  120 days 
 Windows Server 2003 R2  
  120 days 
 Windows Server 2003  
  120 days 
 Windows 2000  
  90 days  
 Remote Desktop supports two concurrent connections for remote 
administration that do not require licenses. 
Configuring Remote Desktop Licensing 
867

868 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Installing RD Licensing Role Service 
 Now that we have discussed RD CALs and how Remote Desktop Services License Server 
Discovery works, you can begin installing the RD Licensing role server (see Exercise 20.16).  
 E X E R C I S E  2 0 .1 6
Installing RD Licensing Role Service 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Roles and choose Add Roles. 
 3. 
  On the Select Server Roles page of the Add Roles Wizard, select Remote Desktop Services.  
 4. 
  Click Next.  
 5. 
  On the Introduction To Remote Desktop Services page, click Next. 
 6. 
  On the Select Role Services page, select RD Licensing. 
 7. 
  Click Next.  
 8. 
  On the Conﬁ gure Discovery Scope For RD Licensing page, select the appropriate 
discovery scope for your installation. Leave the RD Licensing database location as 
the default,  C:\Windows\system32\LServer . 
 9. 
  Click Next.  
 10.   On the Conﬁ rm Installation Selections page, review the RD Licensing information that 
has been selected. 
 11.   Click Install. 
 12.   On the Installation Results page, verify that the RD Licensing role service installation 
succeeded.  
 13.   Click Close.  
 Connecting to the RD license server in Windows Server 2008 R2 is done through the RD 
Licensing Manager tool, which is automatically installed when the RD Licensing role service 
has been installed. However, you can manage the license server from a remote computer 
running Windows Server 2008 R2 by adding the RD Licensing Manager feature from Server 
Manager. Exercise 20.17 demonstrates how to install RD Licensing Manager as a feature. 
 E X E R C I S E  2 0 .17
Installing RD Licensing Manager as a Feature 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  Right - click Features and choose Add Features. 

 3. 
  On the Select Features page of the Add Features Wizard, expand Remote Server 
Administration Tools.  
 4. 
  Expand Role Administration Tools. 
 5. 
  Expand Remote Desktop Services Tools. 
 6. 
  Select RD Licensing Tools. 
 7. 
  Click Next.  
 8. 
  On the Conﬁ rm Installation Selections page, click Install. 
 9. 
  On the Installation Results page, verify that the installation of RD Licensing Tools succeeded.  
 10.   Click Close.  
 11.   To start RD Licensing Manager, click Start   Administrative Tools   Remote Desktop 
Services   RD Licensing Manager.  
 Activating Remote Desktop Services License Server 
 As you know, a Remote Desktop Services license server must be activated to issue RD 
CALs. The activation process uses the Activate Server Wizard within the RD Licensing 
Manager tool. There are three methods to activate a license server:
 Automatic Connection   Microsoft recommends using this method to activate the license 
server. However, it requires an SSL connection (TCP port 443) because the license server 
will connect to the Microsoft Clearinghouse over the Internet.  
 Web Browser   This method is used when the license server does not have Internet access. 
A URL to the Microsoft Clearinghouse is displayed in the Activate Server Wizard and 
accessed through a computer that does have Internet access.  
 Telephone  This method is used is used if no Internet access is available. The telephone number 
is displayed in the Activate Server Wizard after the appropriate country or region is selected.  
 The following exercise, Exercise 20.18, illustrates the process for activating an RD 
license server. 
 E X E R C I S E  2 0 .1 8
Activating an RD License Server  
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RD Licensing Manager. 
 2. 
  Right - click the license server that requires activation and click Activate Server. Notice 
that the server will have a red  X and that Activation Status is set to Not Activated. 
 3. 
  On the ﬁ rst page of the Activate Server Wizard, click Next. 
 4. 
  On the Connection Method page, select the appropriate method for your environment.  
Configuring Remote Desktop Licensing 
869

870 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
E X E R C I S E  2 0 .1 8  (c o n t i n u e d)
 5. 
  Click Next. (From here it will depend on the method chosen. In this scenario, the chosen 
method is Web Browser.) 
 6. 
  On the License Server Activation page, copy the product ID. 
 7. 
  From a computer with Internet access, use the URL provided to go to the Terminal 
Server Licensing website. 
 8. 
  On the Terminal Server Licensing website, select your language and activate a license 
server. 
 9. 
  Click Next.  
 10.   Enter all the required information.  
 11.   Click Next.  
 12.   Review and conﬁ rm all the information that you provided. Click Next.  
 13.   You will now receive your license server ID, which you will enter into the Terminal 
Server License Server Activation Wizard. Copy or print this web page so that you have 
the information.  
 14.   At this point you can request the license tokens by clicking Yes. We are going to click No 
because we will install the tokens in Exercise 20.19.  
 15.   Go back to the RD Licensing Manager and activate Server Wizard.  
 16.   Enter the license server ID you received from the Terminal Server Licensing website. 
Refer to step 6 of this exercise.  
 17.   Click Next.  
 18.   On the Completing the Activate Server Wizard page, you will see the status message 
 “ The license server has been successfully activated. ”  Uncheck Start Install Licenses 
Wizard Now, because we will be installing the RD CALs later.  
 19.   Click Finish. 
 20.   Notice that in the RD Licensing Manager, the red  X has changed to a green check mark 
and the activation status has changed to Activated. 
 Installing Remote Desktop Services Client Access Licenses 
 The same three methods you use when you activate a Remote Desktop Services license 
server apply when installing Remote Desktop Services client access licenses. However, 
when you ’ re installing licenses, the Install Licenses Wizard retains the connection method 
used when you activated the license server. In our case, the connection method is a web 
browser. 

 The connection method can be changed in RD Licensing Manager by right - clicking the 
appropriate server and selecting Properties. The three methods (automatic connection, web 
browser, and telephone) are available under the Connection Method tab. You must activate 
the RD license server and have the license code to install RD CALs. Exercise 20.19 walks 
you through the process.  
 E X E R C I S E  2 0 .1 9
Installing Remote Desktop Services Client Access Licenses  
 1. 
  Start RD Licensing Manager by clicking Start   Administrative Tools   Remote Desktop 
Services   RD Licensing Manager.  
 2. 
  Right - click the license server and choose Install Licenses.  
 3. 
  On the Welcome To The Install Licenses Wizard page, click Next. Notice that the 
connection method is Web Browser. 
 4. 
  On the Obtain Client License Key Pack page, copy the license server ID and go to the 
Remote Desktop Services Licensing website from a computer with Internet access.  
 5. 
  On the Remote Desktop Services Licensing website, select the appropriate language 
and select Install Client Access License Tokens.  
 6. 
  Click Next.  
 7. 
  Enter all the required ﬁ elds, including the license server ID, and select the license 
program. Notice that there are a number of choices for the license program. 
 8. 
  Click Next.  
 9. 
  The license program you chose in step 7 determines what information will be needed on 
this page. Normally a license code or an agreement number is all that will be required. 
Also, you must select the type and quantity of RD CALs to install on the license server.  
 10.   Click Next.  
 11.   The web page displays a key pack ID generated by the Microsoft Clearinghouse. Make 
sure you keep a copy in case you need assistance in recovering RD CALs.  
 12.   Go back to the RD Licensing Manager and the Activate Server Wizard.  
 13.   Enter the license key pack ID you received from the Terminal Server Licensing website. 
Refer to step 4. 
 14.   Click Next.  
 15.   On the Completing The Install License Wizard page, click Finish. The RD license server 
can now issues RD CALs to clients. 
Configuring Remote Desktop Licensing 
871

872 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Configuring License Settings on an RD Session Host 
 Now that the RD license server has been installed and activated, you can specify the 
Remote Desktop Services licensing mode. Remember, the RD licensing mode determines 
the type of RD CALs a Remote Desktop Session Host requests for a connecting client; 
a Remote Desktop Session Host must also be conﬁ gured to match the type of RD CAL 
available from the RD license server. 
 Specifying the RD Licensing Mode 
 The RD licensing mode can be conﬁ gured in multiple ways. The ﬁ rst way is to set the 
licensing mode during the installation of the Remote Desktop Services role. 
 Another way to conﬁ gure the RD licensing mode is to use the Remote Desktop Services 
Conﬁ guration tool.  
 1. 
 Open the Remote Desktop Services Conﬁ guration tool by clicking Start   
Administrative Tools   Remote Desktop Services   Remote Desktop Session Host 
Conﬁ guration.  
 2. 
  In the center frame in the Edit settings area on the General tab, double - click User 
Logon Mode or right - click User Logon Mode and select Properties.  
 3. 
  On the Licensing tab, specify the Remote Desktop Services licensing mode, either Per 
Device or Per User. See Figure 20.4.  
 F I G U R E 2 0. 4 Specifying the licensing mode from the Remote Desktop Services 
Configuration tool 

 Tracking the Issuance of Remote Desktop Services 
Per User Client Access Licenses 
 Windows Server 2008 R2 has the ability to track the RD Per User CALs that have been 
issued by an RD license server. RD Per User CALs can be tracked only if the Remote 
Desktop Session Host and RD license server are members of a domain. Therefore, 
workgroup mode is not supported when tracking and reporting RD Per User CALs. When 
a user logs into a Remote Desktop Session Host, the Remote Desktop Session Host checks 
the license server mode and then checks in with the license server. 
 The license server modiﬁ es the Remote Desktop Session Host attribute for the user 
within Active Directory, and the CAL becomes associated with the user account object. 
This is why the license server must be a member of the RD License Servers security group 
in the domain because this group grants the right to modify user attributes within Active 
Directory. If a license server is going to be used in multiple domains, it must be a member 
of the RD License Servers group for each domain. Because the issued Per User CALs are 
stored in Active Directory Domain Services (AD DS), the only way to obtain the most 
current information is to create a report using the RD Licensing Manager. 
 It is also possible to save a report as a comma - delimited ﬁ le (CSV). To save the report as 
a CSV ﬁ le, right - click the report and choose Save As. Enter a ﬁ lename and a location. The 
CSV ﬁ le includes additional information about the RD Per User CALs issued: 
 Issued To User  
 TS CAL Version 
 Expires On  
 Revocation of Client Access Licenses 
 Before Windows Server 2008 R2, there was no way to revoke issued licenses from systems 
that have been replaced and no way to make those licenses available immediately. Issued 
licenses would expire in 52 to 89 days, and after that they would become part of the 
available license pool. 
 To address this, Microsoft introduced a method to revoke licenses manually in Windows 
Server 2008 R2. However, there are some small caveats to the revocation process. The 
revocation process supports only Per Device CALs, and you can revoke only a maximum 
of 20 percent of a speciﬁ c version. 
 For example, if you have 100 Windows Server 2008 R2 Per Device CALs and 
50 Windows Server 2003 CALs installed on your license server, you can revoke 20 of the 
Windows Server 2008 R2 CALs and 10 of the Windows Server 2003 CALs. Each type of 
Per Device CAL can be revoked at any time because operating system Per Device CALs are 
independent of each other.  
 Although the CAL revocation is very handy and certainly alleviates some 
administrative headaches, it is not a substitute for proper planning and 
ensuring that there are enough CALs for your environment.  
■
■
■
Configuring Remote Desktop Licensing 
873

874 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Remote Desktop Licensing Diagnosis 
 With Windows Server 2008 R2, Microsoft has a licensing tool that will help manage and 
identify possible licensing problems by analyzing and highlighting potential terminal server 
conﬁ guration issues. Remote Desktop Licensing Manager can also determine the license 
servers that are discoverable by the Remote Desktop Services server. It can also provide 
suggested resolutions to speciﬁ c problems for a license server.  
 Remote Administration in Windows 
Server 2008 R2 
 Now that you know how to install and conﬁ gure Remote Desktop Services and RD 
Licensing, we ’ ll look at how you connect to remotely administer your servers running 
Windows Server 2008 R2. Remote administration in Windows Server 2008 R2 is changing. 
In Windows Server 2003, to remotely connect a Remote Desktop Services server, you would 
use RDC with  mstsc.exe /console , and this would give you access to the console session 
on the server. With Window Server 2008 R2, the  /console switch is ignored and replaced 
with the RDC switch  mstsc.exe /admin , which will allow you to administer the server. 
 The  /admin switch has been introduced with RDC 6.1 and is available only on Windows 
Server 2008 R2, Windows Server 2008, Windows 7, Windows Vista Service Pack 1, 
and Windows XP Service Pack 3. To start a remote administration session, you must 
be a member of the Administrators groups on the server. After you start your remote 
administration session with  /admin , the following are true: 
 There can be two active remote administration sessions, and they do not require an 
RD CAL.  
 Time zone redirection is disabled.  
 RD Connection Broker redirection is disabled.  
 Plug and Play device redirection is disabled.  
 The remote session theme is changed to Windows Classic.  
 Remote Desktop Services Easy Print is disabled.  
 Managing Remote Desktop Services 
through Group Policy 
 A Remote Desktop Services server is different from other servers in that it also acts 
as a user workstation. In the following sections, we are going to discuss how to utilize 
Group Policy objects (GPO) to help administer the Remote Desktop Services server 
in your environment. The topics that we will discuss include Group Policy settings for 
Remote Desktop Services, RD Gateway, RemoteApp, and RD Connection Broker. 
■
■
■
■
■
■

 Group Policy Settings for Remote Desktop Services 
 In this section, you ’ ll learn about some of the generic settings for Remote Desktop Services 
that will help you administer the server. These include user disconnects, remote control, 
RDP permissions, connection limits, and session time limits. For simplicity, the section is 
written with the assumption that you already know the basics of Group Policy and Active 
Directory conﬁ gurations. 
 All of the policies for Remote Desktop Services can be found in Group Policy 
Management Editor under  Computer Configuration\policies\Administrative 
Templates\Windows Components\Remote Desktop Services or under  User 
Configuration\policies\Administrative Templates\Windows Components\Remote 
Desktop Services . There are a number of policy settings under the Remote Desktop 
Services location, and we will not be able to cover them all, so we will just highlight the 
most common settings.  
 Automatic Reconnection   Enabling this policy allows clients to reconnect to a 
disconnected session if the network link goes down. By default, the Remote Desktop server 
tries to reconnect every ﬁ ve seconds and continues trying up to 20 times. This policy should 
be used in conjunction with the next policy, Conﬁ gure Keep - alive Connection Interval.  
 Configure Keep - alive Connection Interval   This policy is a useful setting for networks 
that are unreliable, such as WAN links, and will set how often, in minutes, the server 
checks the session state. If this policy is left disabled or not conﬁ gured, the server will 
not check the session state. See Figure 20.5.  
 F I G U R E 2 0. 5 Keep - alive connection interval properties 
Managing Remote Desktop Services through Group Policy 
875

876 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
  Set Rules For Remote Control Of Remote Desktop Services User Sessions   This sets the 
level of remote control for a session. If it ’ s left disabled or not conﬁ gured, remote control 
rules are determined by the Remote Desktop Services Conﬁ guration tool.  
  Restrict Terminal Service Users To A Remote Session   This policy can limit the resources 
used by limiting users to one session on the terminal server. If it ’ s left disabled, users are 
allowed unlimited concurrent remote connections.  
 Some policies can be set in both Computer Configuration and User 
Configuration. If both policies are set, the Computer Configuration policy 
takes precedence.  
  Limit Maximum Color Depth   By setting this policy, you can reduce network bandwidth 
and also decrease the resource load on the terminal server. The setting speciﬁ es the 
maximum color depth allowed for a session. If Client Compatible is selected, the highest 
color depth supported by the client will be used.  
  Remove  “ Disconnect ” Option From Shut Down Dialog   Enabling this policy removes 
the Disconnect option from the Shut Down Windows dialog box. The reason for this is to 
prevent users from disconnecting the session instead of terminating the session. If a session 
is in a disconnected state, the session continues to run and consume server resources.  
  Set RD User Home Directory   Enabling this policy speciﬁ es whether Remote Desktop 
Services uses a network or a local drive for a user ’ s home directory. You must choose a 
location on the network or the local machine by designating the location with a UNC path 
or local drive. If you choose On The Network, you must also specify the drive letter that 
the user ’ s session will use. 
  Use Mandatory Profiles On The RD Session Host Server   Enabling this policy allows the RD 
Session Host to enforce a mandatory proﬁ le for all users connecting to the RD Session Host. If 
you enable this policy, you must also enable the Set Path For RD Roaming User Proﬁ le policy.  
  Set Path For RD Roaming User Profile   By default, Remote Desktop Services stores 
all user proﬁ les locally. Enabling this policy allows the administrator to set a speciﬁ c 
network path for roaming user proﬁ les. The proﬁ le path is set with a UNC path, 
 \\Computername\Sharename . 
 Set Time Limit For Disconnected Sessions   If this policy is enabled, a time limit for 
disconnected sessions will be set, and when the time limit is reached the session will be deleted 
from the server. The policy is useful to ensure that resources are released on the server.  
  Set Time Limit For Active But Idle Remote Desktop Services Sessions   Enabling this policy 
will put idle session into a disconnected state after a period of time. It ’ s similar to the time 
limits that are available in the preceding policy.  
  Set Time Limit For Logoff Of RemoteApp Sessions   Enabling this policy speciﬁ es how 
long a RemoteApp session will remain in a disconnected state before the session is logged 

off. If this policy is disabled or not conﬁ gured, a closed RemoteApp will be disconnected 
from the terminal server.  
 Join RD Connection Broker   Enabling this policy tells the Remote Desktop Session Host 
to join the farm that is speciﬁ ed in the Conﬁ gure Remote Desktop Connection Broker Farm 
Name policy. 
 Configure RD Connection Broker Farm Name   Enabling this policy speciﬁ es the name of 
the farm for RD Connection Broker.  
 Use IP Address Redirection   Enabling this policy speciﬁ es the redirection method used 
when a client reconnects to an existing session. This setting applies to a Remote Desktop 
server that is conﬁ gured to use RD Connection Broker, not the RD Connection Broker server.  
 Configure RD Connection Broker Server Name   Enabling this policy speciﬁ es the 
RD Connection Broker server that the Remote Desktop Session Host will use to track 
and redirect user sessions in a load - balanced Remote Desktop farm.  
 Use RD Connection Broker Load Balancing   Enabling this policy speciﬁ es whether to use the 
RD Connection Broker load balancing feature. It is important to note that when you enable 
this policy, you must also enable and conﬁ gure the Join RD Connection Broker, Conﬁ gure RD 
Connection Broker Server Name, and Conﬁ gure RD Connection Broker Farm Name group 
policies.  
 Enable Connection Through RD Gateway   Enabling this policy will cause clients to 
attempt to connect to the RD Gateway server that is speciﬁ ed in the Set RD Gateway 
server address policy.  
 Set RD Gateway Authentication Method   Enabling this policy speciﬁ es the authentication 
method used when a user is connected to a terminal server through an RD Gateway server. 
If this policy is disabled or not conﬁ gured, the authentication method speciﬁ ed by the user 
is used, and if the user has not speciﬁ ed a method, the NTLM protocol that is enabled on 
the client or a smart card can be used.  
 Set RD Gateway Server Address   Enabling this policy speciﬁ es the address of the RD 
Gateway server that the clients will use when connecting to a terminal server.  
 Configuring Global Deployment Settings for RemoteApp 
 We have already conﬁ gured the basics to publish a RemoteApp. In the following sections, we 
will discuss the options available for conﬁ guring the global deployment settings that apply to 
all RemoteApp programs. The following settings are global deployment settings: 
 Remote Desktop Session Host settings  
 RD Gateway settings 
 Remote Desktop Protocol settings  
 Digital signature settings   
■
■
■
■
Managing Remote Desktop Services through Group Policy 
877

878 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Configuring Remote Desktop Session Host Settings 
 In this section, we will discuss how to conﬁ gure the following RemoteApp deployment settings: 
 Server name  
 RDP port 
 Remote desktop access  
 Access to unlisted programs  
 The settings in Exercise 20.20 deﬁ ne how users connect to a Remote Desktop Session 
Host to access RemoteApp programs.  
 E X E R C I S E  2 0 . 2 0
Conﬁ guring RemoteApp Global Deployment Settings 
 Follow these steps to conﬁ gure RD RemoteApp global deployment settings: 
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RemoteApp Manager. 
 2. 
  In the Actions pane, click RD Session Host Settings. 
 3. 
  On the RD Session Host Server tab under Connection Settings, you can change the 
server name, RDP port, and whether or not server authentication is required. 
 4. 
  Under Remote Desktop Access, check Show A Remote Desktop Connection To This 
Terminal Server In RD Web Access if you would like to provide a link to the full terminal 
server desktop through RD Web Access. 
 5. 
  Under Access To Unlisted Programs, choose either Do Not Allow Users To 
Start Unlisted Programs On Initial Connection or Allow Users To Start Both Listed 
And Unlisted Programs On Initial Connection. By not allowing users to start unlisted 
programs, you help protect against users starting a program from an RDP ﬁ le. 
 
Remember, you can use Group Policy and AD DS to centralize and simplify 
the administration of the client settings. 
 Configuring RD Gateway Settings 
 The RD Gateway settings deﬁ ne how clients will connect to the RD Gateway server when 
using RD RemoteApp programs on the terminal server, as shown in Exercise 20.21. Three 
RD Gateway settings are conﬁ gurable: 
 Automatically Detect RD Gateway Server Settings  
 Use The RD Gateway Server Settings 
 Do Not Use A RD Gateway Server  
■
■
■
■
■
■
■

 E X E R C I S E  2 0 . 2 1
Conﬁ guring RD RemoteApp RD Gateway Global Deployment Settings  
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RemoteApp Manager.  
 2. 
  In the Actions pane, click RD Gateway Settings. 
 3. 
  On the RD Gateway tab, there are three server settings:  
 Automatically Detect RD Gateway Server Settings. If this is selected, the client tries 
to use Group Policy settings to determine the behavior of the client connection to 
the RD Gateway server. 
 Use These RD Gateway Server Settings. This selection will allow you to conﬁ gure 
the RD Gateway server name and logon method. The server name must match the 
SSL certiﬁ cate you acquired for the RD Gateway server.  
 Do Not Use A RD Gateway Server. Use this selection if the client is not accessing 
the RD servers from the Internet.  
 Configuring RDP Settings 
 Using these RDP selections will specify the settings users will get when connecting to a 
RemoteApp, such as device and resource redirection and some display settings. Exercise 20.22 
shows the available user RDP selections.  
 E X E R C I S E  2 0 . 2 2
Conﬁ guring RD RemoteApp Common RDP Global Deployment Settings  
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RemoteApp Manager.  
 2. 
  In the Actions pane, click RD Session Host Settings and then click the Common RDP 
Settings tab.  
 3. 
  In the Devices And Resources section, you can choose what will be available when a 
user connects to a remote session:  
 Printers  
 Disk drives  
 Clipboard  
 Smart cards  
 Supported Plug and Play devices 
 4. 
  Under User Experience, you can select Allow Font Smoothing as well as the color depth 
for the remote session.  
■
■
■
■
■
■
■
■
Managing Remote Desktop Services through Group Policy 
879

880 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Configuring Digital Signature Settings 
 The digital signature settings allow the digital certiﬁ cate signing of RDP ﬁ les that are use 
for RemoteApp connections. By using a server authentication certiﬁ cate (SSL certiﬁ cate) 
or a code signing certiﬁ cate, you can better protect the server from malicious users and 
applications. 
 If you ’ re already using an SSL certiﬁ cate for a terminal server or RD Gateway server, 
you can use the same certiﬁ cate to sign the RDP ﬁ les. Exercise 20.23 explains how to 
conﬁ gure RemoteApp Digital Signature global deployment settings.  
 E X E R C I S E  2 0 . 2 3
Conﬁ guring RD RemoteApp Digital Signature Global Deployment Settings 
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RemoteApp 
Manager. 
 2. 
  In the Actions pane, click Digital Signature Settings. 
 3. 
  Select Sign With A Digital Certiﬁ cate.  
 4. 
  In the Digital Certiﬁ cate detail box, click Change. 
 5. 
  In the Select Certiﬁ cate dialog box, chose the certiﬁ cate you want to use.  
 Monitoring RD Gateway Using RD Gateway Manager 
 After completing the conﬁ guration options for the client connections to RD Gateway, it is 
important to know how to monitor active connections and look for errors speciﬁ c to the 
RD Gateway server. This discussion will focus on the events that will be logged and how to 
view active connections using RD Gateway Manager. The discussion will be split into the 
following topics: 
 Specifying RD Gateway events to log 
 Viewing details about active connections through an RD Gateway server  
 Specifying RD Gateway Events to Log 
 The RD Gateway Manager is used to specify the type of events that will be monitored, 
and when an event does occur, the event can be viewed with Windows Event Viewer. RD 
Gateway server events are located under  Application and Service Logs\Microsoft\
Windows\RD - Gateway . Exercise 20.24 shows how to select which events will be logged as 
RD Gateway events. 
■
■

 E X E R C I S E  2 0 . 2 4
Specifying RD Gateway Events to Log  
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RD Gateway Manager. 
 2. 
  Select the RD Gateway server. 
 3. 
  Right - click the name of the server and choose Properties. 
 4. 
  On the Auditing tab, select the appropriate events to monitor.  
 Table 20.2 shows the names, descriptions, and event IDs of the various RD Gateway 
event types. 
 TA B L E 2 0. 2 RD Gateway event types 
 Event Name  
  Description  
  Event ID  
 Successful User 
Disconnection From 
The Resource 
 This event allows you to verify the user 
session time and the amount of data (in 
kilobytes) that was sent and received by 
the remote client through the RD Gateway 
server. 
 303: When the client 
disconnects from the 
resource 
 202: When an 
administrator 
disconnects the client 
 Failed User Connection 
To The Resource 
 The client met the conditions for the RD 
CAP and RD RAP but could not connect to 
a computer because it was unavailable. 
 304  
 Failed Connection 
Authorization  
 The client could not connect because it did 
not meet the conditions of the RD CAPs.  
 201  
 Failed Resource 
Authorization  
 The remote client could not connect to the 
specified computer because no RD RAPs 
are configured to allow the user access to it.  
 301  
 Successful User 
Connection To The 
Resource  
 The remote client successfully connected 
to a computer. 
 302  
 Successful Connection 
Authorization  
 The client met the condition of one RD 
CAP and connected successfully. 
 200  
 Successful Resource 
Authorization  
 The client met the condition of one RD 
RAP and connected successfully. 
 300  
Managing Remote Desktop Services through Group Policy 
881

882 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Viewing Details about Active Connection through 
an RD Gateway Server 
 Another use of RD Gateway Manager is to view detailed information about the user 
connections that have been granted access. Administrators can use the information 
displayed in the RD Gateway Manager to troubleshoot speciﬁ c user connection issues. 
Exercise 20.25 details the steps to view user connection information through RD Gateway 
Manager as well as the type of information that is displayed.  
 E X E R C I S E  2 0 . 2 5
Viewing User Connection Information through RD Gateway Manager  
 1. 
  Click Start   Administrative Tools   Remote Desktop Services   RD Gateway Manager. 
 2. 
  Select the RD Gateway server. 
 3. 
  Expand the server and select Monitoring. In the Results pane, a summary of the number 
of connections will be displayed. When you select a connection, the connection detail 
will appear in the lower pane. For this exercise, disconnect a speciﬁ c connection or all 
the connections for a user. 
 4. 
  To refresh the connections display, click Refresh in the Actions pane. The following 
information is displayed in the Monitoring pane: 
 Connection ID  
 User ID  
 User Name  
 Connected On 
 Connection Duration  
 Idle Time  
 Target Computer  
 Client IP Address 
 Target Port  
 Summary 
 In this chapter, we discussed the features, roles, and enhancements in Windows Server 
2008 R2 Remote Desktop Services. The ﬁ rst section of this chapter focused on new RDC 
display features, new device redirection features, and Single Sign - On. 
■
■
■
■
■
■
■
■
■

 The new RDC display features discussed in this chapter include monitor spanning, 
support for higher resolutions, font smoothing, Display Data Prioritization, and the new 
Desktop Experience. Device redirection includes Plug and Play device redirection for media 
players and digital cameras, Microsoft Point of Service (POS) for .NET, and RD Easy Print. 
 We rounded out discussion of Windows Server 2008 R2 features with the topic of Single 
Sign - On, which is a method of authentication that allows user to log on only once. All 
these new improvements in Windows Server 2008 R2 give users options and customization 
within their sessions that will ultimately increase their experience working in a Remote 
Desktop Services environment. 
 You learned how to install the Remote Desktop Services roles, and we explored RD 
Web Access. This chapter also discussed securing your Remote Desktop Services server 
environment by utilizing RD Gateway. RD Gateway encapsulates Remote Desktop 
Protocol (RDP) trafﬁ c over HTTP with SSL encryption (HTTPS) and provides a secure 
link for authorized remote users on the Internet to access internal Remote Desktop Services 
server applications without creating a virtual private network (VPN) connection. 
 We installed and discussed the various roles as well as how to conﬁ gure an RD Gateway 
server through the RD Gateway Manager. You learned how to obtain and conﬁ gure a 
digital certiﬁ cate for the RD Gateway server. And you learned how to create RD CAPs 
and RD RAPs that ensure that the client computers comply with the businesses security 
standards. 
 The chapter concluded with a discussion of RD Connection Broker and how to provide 
load balancing to the Remote Desktop Services server environment. The RD Connection 
Broker enables users to reconnect to an existing session in a load - balanced environment as 
well as evenly distributing the session load across the Remote Desktop Services servers. 
 We explored how to conﬁ gure and join an RD Connection Broker farm using the 
Remote Desktop Services Conﬁ guration utility. Finally, we set up two different options for 
load balancing with RD Connection Broker: DNS Load Balancing and Microsoft NLB. 
With all the new features, Remote Desktop Services for Windows 2008 R2 has made huge 
leaps over the previous versions. It is a much more appealing offering and a viable solution 
for many businesses. 
 We examined various aspects of RD license servers as well as the different deployment 
conﬁ gurations for RD RemoteApps. We started the chapter by looking at the various 
conﬁ guration aspects of an RD license server, and then we examined RD CALs and the 
differences between RD Per User CALs and RD Per Device CALs. Next we discussed 
the temporary grace period prior to activating a TS license server. After that we studied the 
RD license server discovery process for workgroups, domains, and forests. 
 After we discussed the various aspects of RD CALs and the discovery process, we 
moved on to the actual installation and activation of an RD license server. We ﬁ rst walked 
through the process of installing the RD Licensing service role and the installation of 
the RD Licensing Manager tool. We then stepped through the process of activating the 
RD license server and installing the appropriate RD CALs. Next we looked at the RD 
Licensing discovery mode and the different ways to conﬁ gure it.  
Summary 
883

884 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2
 Exam Essentials  
  Know the RDC client settings.   It is important to know all the client settings tabs and how 
to use the settings. Also remember that there are different client versions, and you need to 
know which one works with the appropriate Remote Desktop Services features.  
  Understand how to use RD Gateway.   RD Gateway is a wonderful way to secure your 
Remote Desktop Services environment. You should know how to use the RD Gateway 
Manager to conﬁ gure and maintain the connections to the RD Gateway server. Also know 
how to get and conﬁ gure a digital certiﬁ cate for your RD Gateway server. Last, know how to 
conﬁ gure and maintain your RD CAPs and RD RAPs.  
  Know RD Connection Broker.   Know how a user can reconnect to a session and how to 
set up NLB for a Remote Desktop Services server farm. Remember that there are different 
ways to accomplish load balancing with RD Connection Broker, and know how to 
conﬁ gure them.  
 Know the features of Remote Desktop Services licensing.   Understand all the different 
discovery options and the processes to activate the server and RD CALs.  

 Review Questions  
 1. 
  What is the default TCP port for the Remote Desktop Protocol?  
 A.   1337  
 B.   1494  
 C.   3389  
 D.   2598  
 2. 
  What is the default website for RD Web Access?  
 A.   http://server_name 
 B.   http://ts 
 C.   http://server_name/ts 
 D.   http://server_name/terminal 
 3. 
 What does RD Gateway require so that it can use SSL to encrypt traffic to remote clients?  
 A.   A valid digital certificate 
 B.   Digitally signed files  
 C.   USB token  
 D.   Firewall  
 4. 
  When you ’ re using RD Web Access, the client must have what version on the Remote Desk-
top client to establish a connection?  
 A.   6.0  
 B.   5.2  
 C.   3.14  
 D.   6.1  
 5. 
  What is the name of the Windows Server 2008 R2 feature that allows users to reconnect to 
a disconnected session in a load - balanced Remote Desktop Services server farm?  
 A.   RD Gateway 
 B.   RD Connection Broker  
 C.   RD Web Access 
 D.   RD RemoteApp  
 6. 
 Regardless of the discovery scope type, Domain or Forest, a license server issuing RD Per 
User CALs must be a member of which AD security group?  
 A.   Administrators  
 B.   Remote Desktop Users  
 C.   Remote Desktop Service License Servers  
 D.   Windows Authorization Access Group  
Review Questions 
885

 7. 
  So users can take advantage of the Windows Vista and Windows 7 Aero desktop when 
connecting to a remote desktop, what feature must be installed on the Windows Server 2008 
R2 computer?  
 A.   High - performance video card  
 B.   Desktop Experience  
 C.   2 GB of memory  
 D.   Updated video drivers  
 8. 
  In the RD Licensing Manager, what does a red X on the license server indicate?  
 A.   The server has been activated.  
 B.   The server has not been activated.  
 C.   The server is out of licenses.  
 D.   The server must be restarted.  
 9. 
  When deploying an RD RemoteApp, what that are the two packaging methods? (Choose 
two.)  
 A.   MSI file  
 B.   MSA file  
 C.   RDP file  
 D.   Zip file  
 10.   What TCP port does RD Gateway use to create a secure connection with the remote client?  
 A.   1433  
 B.   443  
 C.   6453  
 D.   22  
886 
Chapter 20 ■ Remote Desktop Services in Windows Server 2008 R2

 Answers to Review Questions 
 1. 
C.   The default port for RDP is 3389. Port 80 is the common port for HTTP trafﬁ c. Ports 
1494 and 2598 are ports Citrix Presentation server uses. Port 1337 is not a common port 
associated with any application.  
 2. 
C.  The default website for RD Web Access is  http://server_name/ts . 
 3. 
A.   The digital certiﬁ cate proves the identity of a remote person or remote resource.  
 4. 
D.   RDC 6.1 is required to connect to RD Web Access. RDC 6.1 is available on Windows 
Vista SP1, Windows 7, Windows XP SP3, Windows Server 2008, and Windows Server 
2008 R2. 
 5. 
B.   RD Connection Broker allows users to reconnect to a disconnected session in a load -
 balanced Remote Desktop Services server farm.  
 6. 
C.   When a user logs into a Remote Desktop Service, the Remote Desktop Service server 
checks the license server, and the license server then modiﬁ es the RemoteDesktop attri-
bute for the user within Active Directory. The CAL then becomes associated with the user 
account object. This is why the license server must be a member of the RD License Servers 
security group in the domain. This group grants the right to modify user attributes within 
Active Directory.  
 7. 
B.   For users to receive the Windows Vista or Windows 7 Aero desktop, the Desktop Expe-
rience feature must be installed in Server Manager and the Windows Vista or Windows 7 
theme must be set. 
 8. 
B.   When the server changes to a green check mark, it indicates that the license server has 
been activated.  
 9. 
B, C.   In the RemoteApp Manager, the only two options available to package a remote 
application are to create an MSI ﬁ le or create an RDP ﬁ le.  
 10. B.   TCP port 443 is used to establish an HTTPS connection between the client and the RD 
Gateway server. 
 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
887


Configuring 
Web Services 
Infrastructure  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring a Web Services Infrastructure  
 Configure Web applications. May include but is not 
limited to: directory - dependent; publishing; URL - specified 
configuration; Microsoft .NET components, for example, 
.NET and aspx; configure application pools; manage service 
accounts; server core.  
 Manage Web sites. May include but is not limited to: migrate 
sites and Web applications; publish IIS Web sites; configure 
virtual directories; xcopy deployment.  
 Configure a File Transfer Protocol (FTP) server.  
 May include but is not limited to: configure for extranet 
users; configure permissions; configure File Transfer 
Protocol Secure (FTPS); WebDAV integration; user isolation.  
 Configure Simple Mail Transfer Protocol (SMTP). May 
include but is not limited to: setting up smart hosts; 
configuring size limitations; setting up security and 
authentication to the delivering server; creating proper 
service accounts; authentication; SMTP relay.  

■
■
■
■
■
 Chapter 
21

 In Windows Server 2008, Microsoft introduced a new version 
of Internet Information Services (IIS). IIS 7.0 was a completely 
new management interface and was more ﬂ exible and more 
tightly integrated with the .NET Framework. In Windows Server 2008 R2, Microsoft has 
added even more improvements and introduced IIS 7.5. This chapter will cover how to 
conﬁ gure and manage websites, FTP services, and Simple Mail Transport Protocol (SMTP) 
servers.  
 Configuring Web Applications 
 At the heart of IIS are web applications. A web application may not be what you might 
think it is. In IIS 7.5, a web application is a collection of ﬁ les that delivers content. It may 
be a virtual directory with a speciﬁ c set of ﬁ les and conﬁ guration. 
 Although IIS can do a lot of complex and advanced things, creating and managing 
websites are the most basic tasks. Previous versions of IIS all had very similar management 
interfaces, and it was a pretty smooth transition between versions for administrators 
because even though the inner workings of IIS changed, the changes to the management 
interface were not that signiﬁ cant. In version 7, however, it changed signiﬁ cantly. 
 The ﬁ rst change that takes some getting used to is that IIS is now based on small, 
single - purpose loadable components called modules. Modules are loaded to add features 
and functionality. The modules are loaded as role features in Server Manager. Rather 
than building all of the functionality of IIS into just a couple of core modules, Microsoft 
provided over 30 built - in modules. Using modules instead of creating a monolithic stack 
has quite a few advantages: 
 It ’ s easier for administrators to control which modules should be running.  
 Modules can be replaced with custom modules to change behavior and/or add features.  
 Higher security is possible if unnecessary modules are removed because there is less 
possible vulnerability.  
 There is less administrative and system resource overhead when unnecessary modules 
are removed.  
 First, you need to determine the type of web applications and the functions required. 
Then, during the installation of IIS, you can select the required modules. 
 The second change that takes some getting used to is all of the IIS conﬁ guration is now 
stored in XML - based ﬁ les. Gone are the days of the notorious metabase that plagued 
■
■
■
■

administrators trying to run a web farm in previous versions of IIS with complexity and 
difﬁ culty. 
 The following list describes the main conﬁ guration settings and which ﬁ le they are 
stored in: 
 Global (computer - wide) settings 
 System.applicationHost . Contains conﬁ guration settings for sites, applications, 
virtual directories, and application pools.  
 System.webServer . Contains conﬁ guration settings such as security, HTTP com-
pression, and logging.  
 Website, application, and directory settings  
 Web.config (in root of each website or directory).  
 You can deﬁ ne settings for individual websites, web applications, or directories. You 
can store this ﬁ le in the same directory with application code and content. The 
 settings can be overridden or locked from higher levels.  
 .NET Framework conﬁ guration  
 %windir%\Microsoft.NET\Framework\ < Version Number > \config\machine
.config . 
 This contains settings for the entire server. The settings are inherited by all other 
.NET conﬁ guration ﬁ les, including IIS conﬁ guration ﬁ les.  
 ASP.NET conﬁ guration  
 %windir%\Microsoft.NET\Framework\ < Version Number > \config\web.config  
 This deﬁ nes the default settings for individual websites, web applications, or direc-
tories. This ﬁ le can also be stored in the same directory with the application code 
and content.  
 FTP settings  
 Original version is stored in IIS 6.0 – style  metabase.bin . 
 Updated version is stored in  %windir%\system32\inetsrv\config\Application-
Host.config . 
 Knowing where settings are stored is important as you dig further into conﬁ guration 
tasks. This will help to determine how settings affect one another and the object that must 
be conﬁ gured. 
 Installing IIS 7.5 
 Installing IIS 7.5 is similar to installing other Windows Server 2008 R2 roles. The process 
is started from within Server Manager, and the Add Roles Wizard is used to select the Web 
Server (IIS) role. If any dependent feature or role service is required, you will be prompted 
to add it. Exercise 21.1 walks through the basic installation of IIS.  
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
Configuring Web Applications 
891

892 
Chapter 21 ■ Configuring Web Services Infrastructure
 E X E R C I S E  2 1 .1
Installing IIS 7.5 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  From the Action menu, choose Add Roles.  
 3. 
  Click Next on the Before You Begin window. 
 4. 
  Select Web Server (IIS) from the list of available roles. 
 5. 
  Click Add Required Features on the modal box that prompts the user to add the features 
required to support IIS. 
 6. 
  Click Next on the Select Server Roles page. 
 7. 
  Click Next on the Web Server (IIS) page. 
 8. 
  On the Select Role Services page, select any additional role services and any required 
dependencies (for example, FTP or ASP.NET) that will be required and click Next.  
 9. 
  Click Install and wait for the installation to complete. 
 10.   Click Close.  
 Testing the installation is as simple as opening a web browser and typing in 
  http://127.0.0.1  . During the installation of IIS 7.5, a default web page is added to the root 
directory of the Default Web Site. As shown in Figure 21.1, the displayed default web page 
conﬁ rms that the installation was successful.  
 In Chapter 6,  “ Configuring Active Directory Server Roles, ” we talked about 
the Server Core installation. IIS 7.5 can also be installed on Windows 
Server 2008 R2 Server Core. 
 Creating and Configuring Websites 
 Once IIS is installed, the server is able to serve web content to clients. A default website is 
created when IIS is installed. It can be modiﬁ ed and used to serve content, and additional 
websites can be created as long as each site has a unique binding. A basic binding consists 
of an IP address and a TCP port. The well - known port for Hypertext Transfer Protocol 
(HTTP), the protocol used to transfer web pages, is 80. Also, the well - known port for 
Hypertext Transfer Protocol Secure (HTTPS) is 443. 
 HTTPS uses certiﬁ cates to provide authenticated and encrypted website data. When 
a website is hosted on TCP port 80, no port needs to be speciﬁ ed in the web browser 
because if no port is speciﬁ ed, port 80 is assumed. The Default Web Site, created during the 
installation, is set to bind to port 80 on all IP addresses assigned to the server that aren ’ t 
already bound to another website. 

 A binding conﬁ gures the server to listen for clients to request information on that IP 
address and at that port. The Default Web Site bindings, which includes the IP addresses 
and ports the site is bound to, are shown in Figure 21.2.  
 F I G U R E 21.1 The displayed default web page confirming installation was successful 
 F I G U R E 21. 2 Default Web Site bindings 
 One advantage of using IIS 7.5 for creating websites is that the new conﬁ guration system 
makes it possible to do  XCOPY server deployments for the creation of websites. To make this 
work, you would also have to copy the site and application ﬁ les. If you are deploying ASP
.NET sites, a web server can be conﬁ gured and deployed entirely using  XCOPY . 
Configuring Web Applications 
893

894 
Chapter 21 ■ Configuring Web Services Infrastructure
 Creating a New Website from Internet Information 
Services (IIS) Manager 
 To create a new website from Internet Information Services (IIS) Manager, select the Sites 
node underneath the local server from the Connections pane and then click the Add Web 
Site option in the Actions pane. You will be prompted to provide a name for the website, 
the path to where the content will be stored, and the IP binding information. 
 When you ’ re adding websites to a server, you will need to provide a unique binding from 
other websites that are already conﬁ gured. It is possible to bind additional sites at other 
unused TCP ports; however, this is not a recommended solution, especially for websites 
accessible from the Internet. In most cases, another IP address can be added to the network 
adapter of the server, and that IP address can be bound to the new site. 
 For example, WebServer1 has a base IP address of 192.168.19.66 and the Default Web 
Site is already hosting content. To add another site, you can add another available IP 
address to the server, like 192.168.19.91, and then the new website can be created with a 
binding for the new IP address and port 80, as shown in Figure 21.3.  
 F I G U R E  21. 3 Viewing website bindings 
 Using Host Headers 
 There is actually one more way to create a unique binding, by using what are called host 
headers. Host headers allow multiple sites to share a single IP address and port for sites 
that do not require Secure HTTP connections. IIS listens for connections on the assigned IP 

address and port and then inspects the Uniform Resource Locator (URL) requested. It then 
directs the request to the website with the conﬁ gured binding information. 
 Since host headers rely on the name in the URL, the name of the site must resolve in 
DNS to the server IP address. Many low - cost web - hosting companies employ host headers 
to reduce the number of IP addresses that are needed. As mentioned, however, HTTPS 
does not support host headers, so if any site on the server requires HTTPS, a dedicated IP 
address should be assigned. 
 In Exercise 21.2, you will be creating a second website using host headers for a help desk 
application called  helpdesk.mcts.local on an internal Web server. The DNS entry for 
 helpdesk.mcts.local has already been created.  
 E X E R C I S E  2 1 . 2
Creating a Site Using Host Headers 
 1. 
  Click Start   Administrative Tools   Internet Information Services (IIS) Manager. 
 2. 
  In the Connections pane, select Sites under the server name. 
 3. 
  In the Actions pane, click Add Web Site. 
 4. 
  In the Add Web Site dialog box, type the following information:  
 Site Name:  Help Desk 
 Physical Path:  C:\inetpub\helpdesk  
 Host Name:   helpdesk.mcts.local  
 5. 
  Click OK.  
 Configuring Virtual Directories 
 Virtual directories are directories underneath the root of the site. They might contain 
distinct web applications or just additional content, much like directories on a hard drive. 
If the root site is  www.microsoft.com , a virtual directory might be  /windows . To connect 
to this virtual directory and view the content, the end users would specify  www.microsoft
.com/windows . 
 Virtual directories can be located on a different drive or network share than the root of 
the site, and certain conﬁ guration settings can be adjusted. Virtual directories can also be 
nested; for example, at  www.microsoft.com/windows/downloads ,  /downloads is a nested 
virtual directory underneath the  /windows virtual directory. 
 To create a virtual directory, do this in the Connections pane: 
 1. 
 Right - click the website or virtual directory underneath which you ’ re creating the new 
virtual directory. 
■
■
■
Configuring Web Applications 
895

896 
Chapter 21 ■ Configuring Web Services Infrastructure
 2. 
  Choose Add Virtual Directory.  
 3. 
  From there, you will be prompted to provide a virtual directory name and the physical 
path to the ﬁ les.  
 Similar to virtual directories in function are web applications. They are created 
in the same way, although unlike virtual directories, applications contain another set 
of content as well as code. To conﬁ gure how the code will run, you create an application 
in IIS.  
 Configuring Redirection 
 Redirection is used to send users from one site or URL to a new URL. In previous versions 
of IIS, redirecting a site or directory was as easy as modifying the virtual directory or 
website settings. This is especially useful during migrations and software upgrades. Often 
companies will change their websites to add fresh content or a new look. This can break 
the old links that customers have saved. One way to help users trying to navigate to old 
links is to use a redirect to guide them to the new URL. 
 Since IIS 7.5 is modular, the ﬁ rst step to enable redirection is to install the HTTP 
Redirection module. Exercise 21.3 shows the steps required. This exercise speciﬁ cally 
installs the HTTP Redirection module; to install other modules, follow the same steps but 
choose the module that is required.  
 E X E R C I S E  2 1 . 3
Installing IIS Modules 
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  In the Server Manager pane, select Web Server under Roles. 
 3. 
  In the Content pane, click Add Role Services. 
 4. 
  Select the module or modules that need to be installed. In this case, select HTTP 
Redirection under Common HTTP Features (Installed) and click Next. 
 5. 
  Conﬁ rm the selections and click Install.  
 6. 
  Click Close.  
 Once the HTTP Redirection module is installed, a new HTTP Redirect option will be 
available for each website, virtual directory, and web application. This option is shown in 
Figure 21.4.  

 The options for redirecting using the HTTP Redirection module are as follows:
 Redirect Requests To This Destination   This is the URL that the clients will be redirected 
to. This can be another site, another page, or another virtual directory in the same site.  
 Redirect All Requests To Exact Destination (Instead Of Relative To Destination)   Select 
this option to redirect to the exact URL listed in the ﬁ rst text box regardless of the original 
URL. If this option is unchecked, the portion of the request URL after the redirection will 
be appended to the redirected URL. Leaving this option unchecked would be great if an 
application was moved from one server to another. If the user requests  http://oldserver
.sybex.com/books/ExchangeServer.apx and the redirect was put on the book ’ s virtual 
directory set to  http://newserver.sybex.com/books , the user would be redirected to 
 http://newserver.sybex.com/books/ExchangeServer.aspx . This would bring the user to a 
list of the books they are interested in. If this option was checked in this scenario, the user 
would be redirected to  http://newserver.sybex.com/books and would be given a list of all 
books rather than what they were looking for.  
 Only Redirect Requests To Content In This Directory (Not Subdirectories)   This option 
can be used when the preceding option is not enabled. When this option is enabled, any 
requests that are for subdirectories of the redirected directory will not be redirected but 
will be served by the local web server.  
 Status Code   There are three options for status code, and they affect the status code that is 
returned to the browser as it is being redirected.  
 F I G U R E 21. 4 Using the HTTP Redirect option 
Configuring Web Applications 
897

898 
Chapter 21 ■ Configuring Web Services Infrastructure
 Found (302)   Notiﬁ es the browser to request the new location.  
 Permanent (301)   Notiﬁ es the browser that this new location is a permanent 
redirection.  
 Temporary (307)   Notiﬁ es the browser that this new location is temporary and allows 
any HTTP POST request to retain data for the redirection.  
 Setting Website Limits 
 When you ’ re hosting a number of websites on one server, it may be advantageous to 
limit the number of connections a site may have. This will help to limit the amount of 
resources the site can consume. Restrictions can be set on the following criteria: 
 The amount of bandwidth the website can use  
 The number of concurrent connections to the website  
 The time before an inactive connection is disconnected from the server  
 The default setting is to not limit the amount of bandwidth or the number of 
connections to the website; however, the default time - out for idle sessions is 120 seconds. 
When a bandwidth limit is reached, no additional bandwidth will be available to service 
requests. Similar too, when a connection limit is reached, new connections cannot be 
made until the number of sessions fall below the limit. Figure 21.5 shows an example of 
conﬁ guring these settings.  
■
■
■
 F I G U R E 21. 5 Setting website limits 
 Microsoft .NET Components 
 Many people who use IIS will leverage the .NET Framework for developing applications. Many 
of the options set in the Internet Information Services (IIS) Manager tool will modify settings 
for how .NET components function, such as .NET Compilation, Globalization, Proﬁ les, Roles, 
Users, Applications Pools, and the list goes on and on. The next two sections will cover .NET 
trust levels and application pools in more detail. 

 .NET Trust Levels 
 .NET trust levels set the level of code access security (CAS). Using code access security is 
a way of controlling the access that an application has as it runs. The rule of thumb is to 
provide an application with the least amount of access required. Application developers 
should be able to help qualify the speciﬁ c actions or functions the application requires, 
which should help to determine which .NET trust level is required. 
 Trust levels are conﬁ gured in the Internet Information Services (IIS) Manager; however, 
the information is stored in the  applicationHost.config ﬁ le. To set the .NET trust levels, 
you must select one of the following options:
 Full   This option sets unrestricted permissions. The ASP.NET application has permissions 
to access any resource that is subject to operating system security. All privileged operations 
are supported.  
 High   This option sets a high level of code access security so that the application is unable 
to do any one of the following: 
 Run unmanaged code. 
 Write to the event log.  
 Access Message Queuing service queues.  
 Call serviced components.  
 Access data sources.  
 Medium   This option sets a medium level of code access security that, in addition to 
the High trust level restrictions, prevents the ASP.NET application from doing any of the 
following: 
 Access ﬁ les outside the application directory.  
 Access the Registry. 
 Make network or web service calls.  
 Low   This option sets a low level of code access security that, in addition to the Medium 
trust - level restrictions, prevents the application from doing any of the following: 
 Write to the ﬁ lesystem.  
 Call the Assert method. 
 Minimal   This option sets a minimal level of code access security so that the application 
has only execute permissions.   
 The .NET trust level is set by selecting one of the options in Figure 21.6.  
■
■
■
■
■
■
■
■
■
■
Configuring Web Applications 
899

900 
Chapter 21 ■ Configuring Web Services Infrastructure
 Configuring Application Pools 
 An application pool is a collection of web applications that share a worker process or 
a set of worker processes. An application pool segments the applications so that they 
are unable to affect applications in other application pools. Although application pools 
can contain .NET applications, they can also be used to group non - .NET (nonmanaged 
code) applications as well. Application pools have several real beneﬁ ts. They allow an 
administrator to do the following: 
 Dedicate an application pool for applications that require a higher number of resources 
so that the performance of other applications does not decrease.  
 Isolate unstable applications so when the application fails, it does not also take down 
other applications.  
 Conﬁ gure application pools to automatically restart when memory, time, or other per-
formance indicators are met, improving recovery and application stability.  
 Application pools are conﬁ gured in the Internet Information Services (IIS) Manager; 
however, the information is stored in the  applicationHost.config ﬁ le. To create an 
application pool, select the  Application Pools folder in the Connections pane of Internet 
Information Services (IIS) Manager and then click Add Application Pool from the Actions 
pane. As shown in Figure 21.7, there are four options in the Add Application Pool dialog box.  
  Name   This text box is for the name of the application pool that is being created.  
  .NET Framework Version   This option deﬁ nes either the version of .NET Framework all 
of the applications in the application pool will run or that no managed code will be used in 
the application pool.  
  Managed Pipeline Mode   This option sets whether the application will run in integrated or 
classic mode. If an application is set to Integrated mode, the integrated request - processing 
■
■
■
 F I G U R E 21.6 Setting the .NET trust level 

pipelines of IIS and ASP.NET will be used to handle requests. If an application is set to 
Classic mode, the server will process requests through the  Aspnet_isapi.dll library, as 
was done in IIS 6.0. The Classic mode should be used only with legacy applications that do 
not work in Integrated mode.   
 Start Application Pool Immediately   This sets whether the application will be started when 
the Windows Process Activation Service (WPAS) is started. If this is not set, the application 
pool will need to be started manually before any applications in the pool will run. 
 F I G U R E 21.7 Creating an application pool 
 Once an application pool is created, a number of other settings are available to wrangle 
the applications in the pool into submission. If the applications in the pool are misbehaving 
because of bad code, database connection problems, or user error, there are a number 
of methods to have IIS automatically recover from those problems. One way is to set 
the recycling conditions of the application pool. To conﬁ gure the recycling conditions in 
Internet Information Services (IIS) Manager, complete the following steps: 
 
 1. 
 Select the  Application Pools folder in the Connections pane.  
 
 2. 
  Select the application pool that you want to adjust in the Content pane.  
 
 3. 
  Click Recycling in the Actions pane.  
 The options available on the ﬁ rst page of the Edit Application Pool Recycling Settings 
Wizard are shown in Figure 21.8. 
 The options are as follows:
 Regular Time Intervals (In Minutes)   This option speciﬁ es the length of time, in minutes, 
after which the application pool worker process should be restarted. This is ideal for 
applications that tend to perform worse after a long period of time.  
 Fixed Number Of Requests   This option speciﬁ es the number of requests that should be taken 
by the application pool before recycling the worker process. This is ideal for applications that 
tend to perform worse after a certain number of requests are handled.  
 Specific Time(s)   This option can be used to specify the time or times that the worker 
process should be recycled. This is ideal for problematic applications that can beneﬁ t from 
having the worker process restarted at speciﬁ c times.  
Configuring Web Applications 
901

902 
Chapter 21 ■ Configuring Web Services Infrastructure
 F I G U R E  21. 8 Edit Application Pool Recycling Settings Wizard 
  Virtual Memory Usage (In KB)   This option can be used to specify the maximum amount 
of virtual memory that can be used by the worker process before it is recycled. This is ideal 
for applications that tend to continue to consume memory and perform worse until they are 
recycled.  
  Private Memory Usage (In KB)   This option can be used to specify the maximum amount 
of private memory can be used by the worker process before it is recycled. This is ideal for 
applications that tend to continue to consume memory and perform worse until they are 
recycled. 
 On the second page of the wizard, you can conﬁ gure the options selected on the previous 
page to generate event log entries when the application pool is recycled, as shown in Figure 21.9.  
 F I G U R E 21. 9  The event log settings for recycling events 

 Configuring a Web Farm 
 A web farm is a collection of servers that have the same conﬁ guration so they can be load 
balanced for redundancy and additional performance. In previous versions of IIS, the 
metabase needed to be restored to each server and then modiﬁ ed extensively, or a custom 
provisioning tool needed to be leveraged in order to create a web farm. Products like 
Microsoft Application Center 2000 tried to address the problem of synchronizing and 
conﬁ guring a web farm, but they were far from perfect. IIS 7.5 provides true  “ Robocopy 
deployment, ” the ability to copy a set of ﬁ les to a share or between servers to conﬁ gure the 
websites and application settings. 
 To create a web farm, you should create a network load - balanced cluster so that network 
trafﬁ c is loaded across the servers. After you create an NLB cluster, the servers need to be 
conﬁ gured with the websites that will be hosted. 
 IIS 7.5 has a built - in feature called Shared Conﬁ guration. This allows an administrator 
to publish the server conﬁ guration to a network share for all of the servers to use. The 
websites can be conﬁ gured on this one server and then exported to the ﬁ le share for other 
servers to use. 
 To have each of the servers in the web farm use the shared conﬁ guration, you need to 
conﬁ gure the  %windir%\system32\inetsrv\config\redirection.config ﬁ le to point 
to the shared conﬁ guration. Last, the web content will need to be either on a ﬁ le share or 
copied to each web server.  
 Configuring a File Transfer 
Protocol Server 
 FTP is used to provide ﬁ le transfers, usually across the Internet. Permissions can be set to 
allow all users or speciﬁ c users to have permissions to ﬁ les. With all of the advancements 
made in IIS 7, there was very little time for Microsoft to improve the already feature - sparse 
FTP services that IIS 6.0 contained before releasing Windows Server 2008. If you are 
familiar with FTP services in IIS 6.0, you should have no problem working with built - in 
FTP services for IIS 7.5. 
 To add FTP services to a server that already has the Web Services (IIS) role installed, 
you must add the FTP Server Role Service. After installation of the FTP Service, all 
management is done through the Internet Information Services (IIS) 6.0 Manager. If you 
are fond of the IIS 6.0 management tools, welcome home.  
 After the installation of the built - in FTP Server is complete, the Default FTP 
Site is stopped. To start using FTP, you will need to restart it.  
Configuring a File Transfer Protocol Server 
903

904 
Chapter 21 ■ Configuring Web Services Infrastructure
 When Windows Server 2008 R2 was released to the public, an updated release for IIS 
7.5 was included. This update includes a more feature - rich version of the FTP Server. Here 
are some of the key features of this updated version: 
 The Integrated Management tool is used to manage the FTP service.  
 Secure Publishing FTP over SSL (FTPS) is now supported.  
 Virtual Host Names allows multiple FTP sites with different domain names to be 
hosted on the same IP address. This is similar to the Web Host Headers functionality.  
 User Isolation redirects users to a directory that matches the logon account without 
having to create a physical directory. This keeps users ’ ﬁ les hidden from each other.  
 Non - Windows Authentication allows IIS Web Manager and ASP.NET Membership 
accounts to log in and use FTP services. Windows accounts are no longer required.  
 Configuring Permissions 
 To conﬁ gure the permissions that groups of users have, you must use FTP authorization 
rules. An Allow authorization rule can be applied to the following: 
 All Users  
 All Anonymous Users  
 Speciﬁ ed Roles Or User Groups  
 Speciﬁ ed Users  
 Also, the groups or users that are deﬁ ned in the authorization rule can be given read or 
write permissions. These same criteria can be used to deny users from accessing the content 
as well, as shown in Figure 21.10.  
■
■
■
■
■
■
■
■
■
 F I G U R E 21.10 Creating an Allow authorization rule 

 Once a user has access to the ﬁ les and has been authorized, permissions are based on 
ﬁ lesystem permissions; the more restrictive permissions are combined with the permissions 
assigned by the authorization rules. If domain accounts are used to log on to the FTP 
site, assign the ﬁ lesystem permissions as you would for other ﬁ le shares.  
 Configuring FTP Site for Extranet Users 
 One feature that was lacking in previous versions of the FTP services is that users outside 
the company had to have either a local Windows account or domain accounts. This was a 
messy security problem since you really do not want to give FTP users a domain account. 
The solution is to leverage the IIS 7.5 Management Service or ASP.NET users. 
 The high - level process for conﬁ guring the IIS 7.5 Management Service to handle FTP 
logons is as follows: 
 1. 
 Install FTP Service for IIS 7.5.  
 2. 
  Grant the Network Service read access to the IIS conﬁ guration.  
 3. 
  Add the IIS Management Service Role Service. 
 4. 
  Create a new FTP site.  
 5. 
  Conﬁ gure Basic Authentication.  
 6. 
  Conﬁ gure the FTP site to use an IIS 7.5 Manager account.  
 7. 
  Enable IIS 7.5 Manager authentication.  
 8. 
  Grant access to the site for an IIS 7.5 Manager account.  
 9. 
  Create an authorization rule to allow the IIS 7.5 Manager account appropriate permis-
sions to the FTP site.  
 FTP IPv4 and Domain Restrictions 
 To restrict which servers can connect to the FTP site at a protocol level, IPv4 and domain 
restrictions can be used. The default is to allow all unspeciﬁ ed IP addresses to access the 
FTP server. 
 To change the setting so that all IP addresses are denied except those listed, on the FTP 
IPv4 Address And Domain Restrictions feature page, click Edit Feature Settings on the 
Actions pane. This will bring up the dialog box shown in Figure 21.11, where you can 
choose whether unspeciﬁ ed clients will be allowed or denied.  
 F I G U R E 21.11 The Edit IPv4 Address and Domain Restrictions Settings dialog box 
Configuring a File Transfer Protocol Server 
905

906 
Chapter 21 ■ Configuring Web Services Infrastructure
 Also, from this dialog box you can enable domain name restrictions so that domain names 
can be added to allow and deny lists rather than specifying an IP address. Figure 21.12 shows 
an example of adding a Deny Restriction rule based on a domain name.  
 F I G U R E 21.12 Adding a Deny Restriction rule based on a domain name 
 WebDAV and FTP 
 RFC 4918 deﬁ nes Web - based Distributed Authoring and Versioning (WebDAV). WebDAV 
is a set of rules based on the Hypertext Transfer Protocol that allows collaboration between 
users in editing and managing documents. WebDAV was deﬁ ned by a working group of the 
Internet Engineering Task Force (IETF). 
 In IIS 7.5, WebDAV and FTP have been greatly improved by incorporating features that 
enable web authors to publish content more reliably and securely. The new module for 
WebDAV also allows web server administrators to have more options for authentication, 
auditing, and logging. 
 Microsoft created a WebDAV extension module for Windows Server 2008 R2. This 
WebDAV extension module supports a wide range of features and improvements:
 Integration with IIS 7.5   IIS 7.5 has an administration interface and conﬁ guration store, 
and the WebDAV extension module is integrated within this new design.  
  Per - Site Configuration   WebDAV in IIS 7.5 has the ability to be enabled at the site level. 
This has changed from IIS 6.0, which enabled WebDAV only at the server level through a 
Web Service Extension.  
 Per - URL Security Settings   The WebDAV extension module now gives you the ability to 
use per - URL authoring rules, thus allowing administrators to specify custom WebDAV 
security settings on a per - URL basis.  
  Support for Shared and Exclusive Locks   The WebDAV extension allows both shared and 
exclusive locks to prevent lost updates due to overwrites.  

Configuring a Simple Mail Transfer Protocol Server 
907
 Configuring a Simple Mail Transfer 
Protocol Server 
 Simple Mail Transfer Protocol (SMTP) is the email protocol for Internet - based messaging. 
Just like the built - in FTP services, the SMTP server is largely unchanged from previous 
versions of IIS. Unlike FTP, however, the SMTP server that has been included in IIS and the 
base that Exchange 2000 Server and Exchange Server 2003 is built on have a healthy set of 
features and excellent performance. To install the SMTP server on a Windows Server 2008 
R2 computer, you must install the SMTP Server feature. When the SMTP Server feature 
is installed, the IIS 6.0 Management tools are also installed because they are required to 
perform conﬁ guration.  
 Do I Need a Better SMTP Server? 
 Often people get caught up with judging whether a product works well or not based on 
its cost. On a number of occasions, customers have tried to determine the best way to 
send a large amount of legitimate email. One such company was generating a bunch of 
email messages because of the number of orders its site was processing. The company 
reviewed a number of SMTP products but chose IIS. Using just IIS, the server was able 
to deliver the entire amount of messages generated by the site, and the company didn ’ t 
need to purchase additional hardware or software. If you need a high - performance SMTP 
server, you should consider IIS. 
 The SMTP server is a single - purpose message transport agent (MTA); it sends and 
receives SMTP - based email. It does not generate email, nor does it provide any sort of client 
connectivity; it just routes email. In the next few sections, we will cover the main areas of 
the SMTP server that can be conﬁ gured and when you might want to make the changes. 
 Configuring General SMTP Virtual Server Properties 
 The management interface for the SMTP server is basic and straightforward. As shown 
in Figure 21.13, the left pane lists the SMTP virtual servers that are conﬁ gured on the 
connected server. To make changes to the SMTP virtual server, right - click it and choose 
Properties.  

908 
Chapter 21 ■ Configuring Web Services Infrastructure
 The General tab, shown in Figure 21.14, includes options to bind the SMTP virtual 
server to a speciﬁ c IP address and port number, limit the number of connections to the 
SMTP virtual server, change the idle time - out time, and enable protocol logging.  
 F I G U R E 21.13 Configuring the SMTP virtual server 
 F I G U R E 21.14 Configuring General properties of the SMTP virtual server 

Configuring a Simple Mail Transfer Protocol Server 
909
 As with websites, it may be important to limit the number of connections and the 
connection time - out values to keep the SMTP virtual server from negatively impacting 
other processes on the server. Enabling protocol logging on the SMTP virtual server 
can aid with troubleshooting delivery problems because it documents the SMTP session 
information down to the exact information sent and received. These logs are, by default, 
written in W3C Extended Log format and can be read in any text editor or one of the many 
W3C log viewers.  
 Configuring Access 
 You many need to conﬁ gure access to the SMTP virtual server to restrict the servers or 
users that connect to it, to conﬁ gure the type of authentication used, to enable Transport 
Layer Security (TLS) encryption, or to restrict the users or servers that can relay email 
through it. All of these can be accomplished from the Access tab on the virtual server 
Properties dialog box, as shown in Figure 21.15. 
 The default authentication method for an SMTP virtual server is Anonymous access. 
This means that the SMTP virtual server will not accept any sort of logon attempt and 
that all anonymous users have access to send email to the server. With Basic authentication 
enabled, the server will accept Windows or domain usernames and passwords in clear text 
for authentication. 
 This is discouraged without ﬁ rst requiring Transport Layer Security (TLS) to encrypt 
the SMTP conversation and the username and password. The last option is Integrated 
Windows Authentication, which allows Windows to provide credentials without having to 
pass them in clear text. The conﬁ guration types are shown in Figure 21.16.  
 F I G U R E 21.15 Configuring access properties on an SMTP virtual server 

910 
Chapter 21 ■ Configuring Web Services Infrastructure
 As mentioned in the previous paragraph, TLS is recommended to protect usernames and 
passwords from being transmitted in clear text. To use TLS, you must ﬁ rst install a certiﬁ cate 
on the server. Once the certiﬁ cate is installed, it can be assigned to the SMTP virtual server. It is 
even possible to require that all connections to the SMTP virtual server be encrypted with TLS. 
 It may be that this server is intended only to transfer email between a limited number of 
servers or between servers on a speciﬁ c network. If this is the case, you can set connection 
control to limit the servers that are allowed to connect by IP address or domain name. 
There are two options for restricting access: Either all servers are allowed except those 
explicitly deﬁ ned, or no server has access except those explicitly deﬁ ned. 
 Relaying  is a term that means sending email to an SMTP server that will forward the 
message to its destination. The default setting is to not allow any relaying because relaying 
is what many spammers use to deliver email. If you decide to allow any type of relaying, be 
careful not to leave any openings that might allow a spammer to use your server for nefarious 
purposes. That doesn ’ t mean that relaying is a bad thing; there are a number of legitimate uses. 
 One such use is to have one server in the datacenter that is allowed access to send SMTP 
email out through the ﬁ rewall. You will need to allow the authorized SMTP servers to relay 
through the authorized server. Relay authorization settings are similar to the connection 
control settings because you can either allow all servers to relay through with a list of 
exceptions or deny all relays with a list of exceptions.  
 Configuring Message Size and Transfer Limits 
 The next conﬁ guration options are on the Messages tab. These options help to control 
the size and number of messages that can be delivered. In many cases, the default settings 
will be adequate because many email systems today provide similar limits to protect the 
stability of the server and control bandwidth congestion. The conﬁ guration settings control 
the following options for both receiving and sending messages: 
 F I G U R E 21.16 Configuring authentication types 

Configuring a Simple Mail Transfer Protocol Server 
911
 The size of a single message  
 The size of all messages delivered in a single SMTP session  
 The number of messages sent in a single SMTP session  
 The number of recipients in a single email message  
 An email address to send all nondelivery reports  
 The directory to store all email messages that could not be delivered  
 Configuring Delivery Options 
 A number of options control how email messages are delivered and how long to continue to 
attempt to deliver messages. 
 The Delivery tab has the following options:
 First Retry Interval   This is the length of time the server waits before attempting to resend 
a message after the initial failure. This is usually a fairly short time frame because transient 
problems can cause failures.  
 Second Retry Interval   This is the length of time the server waits before attempting to 
resend a message after the second failure.  
 Third Retry Interval   This is the length of time the server waits before attempting to 
resend a message after the third failure.  
 Subsequent Retry Interval   This is the length of time the server waits after the fourth 
failure, until either the message is delivered or it expires. 
 Delay Notification   This is the length of time a message will sit in the outbound message 
queue before an email message is sent to the originator of the message notifying them that 
the message is still queued.  
 Expiration Timeout  This is the length of time a message can be queued before it is removed.  
 These settings can greatly affect the number of messages that are queued on the server. 
If the email being sent is extremely time sensitive, it may not be important to continue to 
attempt to retry delivery for two days. On the other hand, if the email messages being sent 
are important, it may be better to increase the expiration time. This allows for the case 
when a remote server is down for extended maintenance, because the server will queue the 
mail until either the server is again available or the expiration time - out is reached. 
 Outbound Security 
 We discussed the Access tab in the section  “ Conﬁ guring Access. ” The Access tab is where 
the allowed inbound authentication methods are available. In this case, the Outbound 
Security option on the Delivery tab allows what options will be used to connect to other 
SMTP servers. The options for outbound security are as follows:
 Anonymous   This option provides no user authentication when sending messages. This is 
the default option and is suitable for most Internet communications.  
■
■
■
■
■
■

912 
Chapter 21 ■ Configuring Web Services Infrastructure
  Basic Authentication   This option allows a user and password to be speciﬁ ed to 
authenticate against the remote SMTP server. It is important to use TLS encryption to 
protect the username and password.  
  Integrated Windows Authentication   This option allows you to select a user from the 
domain or from the local server to authenticate. This method does not pass clear - text 
usernames and passwords, but it still should be protected with TLS encryption.  
  TLS Encryption   This option enables TLS encryption for the session. TLS encryption 
encrypts the entire session with a certiﬁ cate on the remote SMTP server.  
 Outbound Connections 
 The Outbound Connections option that is available at the bottom of the Delivery tab 
allows you to conﬁ gure the number of connections, time - out settings, and the TCP/IP port 
that will be used for outbound SMTP sessions. 
 These settings will normally stay at the default conﬁ guration. It may be necessary to 
modify the number of connections to tweak the number of messages the server can send at 
one time. It may be that the server and the bandwidth you have can handle more than the 
1,000 concurrent outbound connections and can deliver messages more quickly if the limit 
was increased to 5,000 connections. 
 Smart Host 
 When discussing outbound connections, one server type that you should know about is a 
smart host. Smart host (also known as a relay host) is a dedicated server through which 
Exchange Server routes all outgoing messages. 
 The smart host will then forward the message to the remote domain. After you designate 
a smart host, the Exchange Server only needs to communicate to the smart host. This stops 
the Exchange Server from repeatedly contacting the remote domain until a connection 
is made. By setting a smart host, your server ’ s performance will improve along with the 
reliability of your email delivery.  
 Advanced Delivery Options 
 The advanced delivery options are accessed by clicking the Advanced button at the bottom 
of the Delivery tab. These are very powerful options that often require adjusting.  
  Maximum Hop Count   This setting helps to prevent email loops. No, the hop count isn ’ t 
the number of people that can attend a 1950s dance party; it is the number of times a 
message can traverse any SMTP server. If the SMTP server receives the message and the 
email has already traversed the number of servers in the limit, the email will be deleted.  
  Masquerade Domain   This option can be set to replace the local domain name in the From 
address ﬁ eld to the domain listed here. This is useful if email from the local server needs to 
appear as if it comes from another business unit or company. 
  Fully - Qualified Domain Name   This option is by default the name of the server. The name 
listed here is what is announced to other SMTP servers, either when a client connects to it 
or when it is sending email out. This is important because if you are sending email out to 

Configuring a Simple Mail Transfer Protocol Server 
913
the Internet and the internal server reports its name as  WebServer10.MyInternalDomain
.local , the receiving server has no way to verify whether your server is valid or you are a 
ﬂ y - by - night spammer. It would be better to replace this name with a name that would be 
able to be resolved by DNS externally, such as  email.sybex.com . Some anti - spam vendors 
will attempt to resolve the sending server ’ s name in DNS; check to see if that host has an 
MX record because presumably the server that is sending out email should be listed as a 
mail server for the domain. 
 Smart Host   If a smart host is not listed, the server will attempt to deliver the email by 
looking up the domain names in DNS; however, if a smart host is listed, all email is sent 
directly to that host or list of hosts for delivery. The check box can also be selected to 
attempt to use DNS to deliver the message ﬁ rst, and if that is unsuccessful, to send it to 
the smart host. If you list multiple servers, they should be separated by a comma. If you 
list servers by their IP address, you must enclose the IP address in brackets, such as, for 
example,  [192.168.19.98] . 
 Perform Reverse DNS Lookup on Incoming Messages   This option is often thought of 
as being an anti - spam measure, but it is not. It will attempt to perform a reverse DNS 
lookup on the SMTP client ’ s IP address to see if it matches the server name announced by 
the client. If the lookup is successful, the messages remain unchanged. If the veriﬁ cation 
fails,  “ unveriﬁ ed ” appears after the IP address in the message header. If DNS lookup fails 
completely,  “ RDNS failed ”  will appear in the message header. Since this process is done on 
all incoming messages, it can have a negative impact on server performance.  
 LDAP Routing 
 The default method for delivering SMTP email is to look up the MX records for the 
destination domain in DNS. Figure 21.17 shows the Lightweight Directory Access Protocol 
(LDAP) Routing tab in the SMTP virtual server that provides options for using an LDAP 
server for resolving senders and recipients.  
 F I G U R E 21.17 Configuring LDAP routing 

914 
Chapter 21 ■ Configuring Web Services Infrastructure
 The following is a list of the options that must be conﬁ gured to enable LDAP routing:
  Server   This option speciﬁ es the server that will be used as the LDAP directory. This ﬁ eld 
should not be necessary when using Active Directory because the server will be able to ﬁ nd 
the nearest domain controller.  
  Schema   This option is used to select the directory service that is being used. The available 
types are as follows: 
 Active Directory 
 Site Server Membership Directory  
 Exchange LDAP Service  
  Binding   This option sets the binding type. The binding type speciﬁ es how the SMTP 
virtual server is authenticated by the directory service. The available types are as follows: 
 Anonymous  
 Plaintext  
 Windows SSPI  
 Service Account  
  Domain   This sets the domain of the account you want to use to bind to the LDAP 
directory if you are using the Plaintext or Windows SSPI binding type.  
  User Name   This option speciﬁ es the distinguished name (DN) of the account being used 
to bind to the LDAP directory if you are using the Plaintext or Windows SSPI binding type.  
  Password   This sets the password that is used for logging on to the directory service if you 
are using the plaintext or Windows SSPI binding type.  
  Base   This option speciﬁ es the distinguished name of a container in the directory service 
that will be searched.  
 Configuring Domains 
 When the SMTP Server feature is installed, a default domain is created and placed in the 
Domains node that is identical to the local server name. This domain is used to route mail. 
It is possible to create additional domains as well if custom settings are required. The 
domain conﬁ guration allows a smart host to be conﬁ gured for speciﬁ c domains. This may 
be beneﬁ cial if most email should be sent using DNS with the exception of email that is 
sent to an internal domain that should be sent to a speciﬁ c server. A domain can also be 
used to create outbound security settings that are speciﬁ c for that domain.  
 Summary 
 Internet Information Services 7.5 web services have been completely rewritten from IIS 6.0. 
Improvements have been made to the conﬁ guration that includes moving conﬁ guration to 
XML - based ﬁ les from the metabase. 
■
■
■
■
■
■
■

 This opens up simple and ﬂ exible administration. IIS 7.5 web services are also based on 
modules. Modules are installed to add functionality. Only the required modules are installed 
to reduce server hardware and maintenance. This chapter covered creating websites, 
applications, virtual directories, and application pools and other conﬁ guration tasks. 
 Although the SMTP server is largely unchanged from previous versions, it provides 
valuable functionality. This chapter covered conﬁ guration for sending and relaying email. 
Although conﬁ guration is simple and straightforward, a number of settings can be used to 
customize how the SMTP server behaves.  
 Exam Essentials  
 Know how to add modules.   IIS 7.5 has over 30 modules included. To add functionality, 
you must add modules to IIS.   
 Know when to use application pools.   Application pools are used for application isolation, 
security, and stability. Know why they are created and some basic settings.  
 Know how to configure an SMTP server for relay and smart hosts.   Know what the SMTP 
server does and how to conﬁ gure it to relay email and to send mail to a smart host.  
 Know the .NET trust levels.   Security is a big problem in today ’ s environment. Know what 
the .NET trust levels are and what level of access each provides to .NET code.  
Exam Essentials 
915

916 
Chapter 21 ■ Configuring Web Services Infrastructure
 Review Questions  
 1. 
  Which of the following options is used to deliver email when DNS lookup is not available?  
 A.   Assign a masquerade domain.  
 B.   Adjust the fully qualified domain name.  
 C.   Do not perform DNS lookup on incoming messages.  
 D.   Assign a smart host.  
  2. 
  Which of the following are valid reasons for creating a separate application pool for two 
web applications? (Choose three.)  
 A.   To keep applications from affecting each other.  
 B.   To reduce overall memory usage.  
 C.   To increase security.  
 D.   To create different recovery settings.  
 3. 
 What benefits are gained from using modules for IIS 7.5? (Choose two.)  
 A.   Reduced management control  
 B.   Reduced patching requirements  
 C.   Increased flexibility  
 D.   Increased system resource  
 4. 
  How many built - in modules are available for IIS 7.5?  
 A.   Less than 15 
 B.   16 to 25  
 C.   25 to 30  
 D.   More than 30  
 5. 
  Which configuration file contains the global IIS settings such as website and logging 
configuration?  
 A.   ApplicationHost.config 
 B.   Web.config 
 C.   Machine.config 
 D.   Metabase.bin 

 6. 
 Which of the following files contains the settings for the SMTP configuration?  
 A.   ApplicationHost.config 
 B.   Web.config 
 C.   Machine.config 
 D.   Metabase.bin 
 7. 
  Which of the followings TCP/IP ports is used for Secure HTTP communication?  
 A.   25  
 B.   80  
 C.   443  
 D.   3389  
 8. 
  You have a web server at your hosting provider and do not have any additional IP addresses 
to assign. You need to create another website for the company ’ s Marketing department. 
Which of the following bindings will allow users to access the site from the Internet? 
 A.   Bind the website to 127.0.01 on port 80.  
 B.   Bind the website to the same IP address as the original site and use host headers for 
both.  
 C.   Bind the website to the same IP address as the original and use Port 8080.  
 D.   Bind the website to the same IP address as the original and use port 80.  
 9. 
  A new web server has been deployed with a new domain name. All of the content on the 
new server is identical to that on the old server. What should be put in place to notify the 
user of the new URL?  
 A.   Application pool  
 B.   Virtual directory  
 C.   Redirect  
 D.   Limit  
 10.   Which of the following can be set to limit resources on a website? (Choose all that apply.)  
 A.   Bandwidth  
 B.   Concurrent connections  
 C.   Number of pages downloaded  
 D.   CPU usage  
Review Questions 
917

918 
Chapter 21 ■ Configuring Web Services Infrastructure
 Answers to Review Questions 
 1. 
D .  A smart host deﬁ nes a server that can be used to deliver messages.  
 2. 
A, B, D .  Creating two application pools allows segregation of the applications to a point 
where they should not be able to affect each other or access each other ’ s data. Also, 
separate application pools allow different recovery settings to be chosen. Creating separate 
application pools does not decrease the overall memory usage for the server.  
 3. 
B, C .  Using modules to build IIS 7.5 allows administrators to install only the modules 
required; only the modules installed will need to be patched. Also, since modules can be 
replaced with custom - written functionality, they are very ﬂ exible.  
 4. 
D .  There are more than 30 built - in IIS modules.  
 5. 
A .  The  ApplicationHost.config ﬁ le contains the global IIS settings.  
 6. 
D .  The SMTP server still uses the legacy  metabase.bin ﬁ le to store conﬁ guration 
information.  
 7. 
C .  TCP/IP port 443 is used for HTTPS communications.  
 8. 
B .  Host headers allow multiple sites to be bound to the same IP address and port and both 
function. Although binding the site to a nonstandard port will work, it is not best practice 
because websites running on nonstandard ports require a user to know the port.  
 9. 
C .  A redirect can notify the end user of the new server name.  
 10. A, B .  Both the amount of bandwidth and the number of active connections can be limited 
in IIS.  
 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 

Advanced Web 
Infrastructure 
Configuration  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring a Web Services Infrastructure  
 Manage the Web Server (IIS) role. May include but is 
not limited to: Web site content backup and restore; IIS 
configuration backup; monitor IIS; configuration logging and 
tracing; delegation of administrative rights.  
 Configure SSL security. May include but is not limited to: 
configure certificates; requesting SSL certificate; renewing 
SSL certificate; exporting and importing certificates.  
 Configure Web site authentication and permissions. May 
include but is not limited to: configure site permissions and 
authentication; configure application permissions; client 
certificate mappings; request filtering. 

■
■
■
 Chapter 
22

 Chapter 21,  “ Conﬁ guring Web Services Infrastructure, ” covered 
the basic concepts and tasks for IIS 7.5. Although not overly 
complex, IIS is a powerful tool with a lot of functionality. 
 Many volumes can be ﬁ lled with information about best practices and in - depth tweaking 
and conﬁ guration. This chapter will focus on a number of more advanced IIS functionalities 
like backup and recovery, delegation of administrative rights, and conﬁ guring SSL and 
authentication. 
 Managing Internet Information Services 
 In the previous chapter, we covered some of the basics of conﬁ guration and management of 
the IIS components. We ’ ll now go into more detail on these topics, focusing on monitoring, 
management logging, and backing up and restoring. 
 In the previous chapter we used only Internet Information Services (IIS) Manager to 
conﬁ gure IIS. There is also a command - line conﬁ guration tool called  AppCmd.exe (or 
AppCmd). This tool is used to view and conﬁ gure IIS settings. There are even tasks that 
 must be done in AppCmd, such as setting the automatic history backup and performing a 
manual conﬁ guration backup, both of which we will cover later in this chapter. 
 Even though AppCmd is a command - line administrative tool, it is not based on 
Windows PowerShell. The AppCmd utility was created before PowerShell was put into 
Windows Server 2008 R2. Exercise 22.1 demonstrates how to use AppCmd to list the 
currently conﬁ gured websites.  
 E X E R C I S E  2 2 .1
Using  AppCmd.exe to List Configured Websites  
 1. 
  Open an elevated command prompt.  
 2. 
  Change to  %System%\System32\InetSrv , the directory where  AppCmd.exe resides.  
 3. 
  Run  appcmd list sites to list conﬁ gured sites.  
 The following objects are available for administration with  AppCmd.exe : 
 Site: Manage websites  
 App: Manage applications  
 VDir: Manage virtual directories  
■
■
■

 AppPool: Manage application pools  
 Conﬁ g: Manage server conﬁ guration  
 WP: Manage worker processes  
 Request: Manage request settings  
 Module: Manage loaded modules  
 Backup: Manage backup and restores  
 Trace: Manage trace settings.  
 Each object has a set of commands that can be run to conﬁ gure it. For example, the Site 
object has the following available commands:  list ,  set ,  add ,  delete ,  start , and  stop . To 
get a list of the available actions for a speciﬁ c object, type   AppCmd.exe  < objectname > /?  . 
 Configuring Monitoring and Logging 
 To provide a consistent reliable service, it ’ s essential to monitor performance. Chapter 10, 
 “ Active Directory Optimization and Reliability, ” covers how to use new tools such as the 
Windows Performance Diagnostic Console, the Reliability Monitor, and the Windows 
event logs in Windows Server 2008 R2 to monitor performance and stability. 
 Trace Logging 
 One of the more troublesome tasks is ﬁ guring out what exactly is happening when a failure 
occurs. This can be because the problem is occurring sporadically, or perhaps there are 
thousands of users connecting to the server simultaneously. 
 Trace logging helps to rectify this problem by watching requests and, if a deﬁ ned failure 
occurs, writing a log of the request and the actions involved in the request. Each failed 
request is stored in a separate XML - based ﬁ le that is sequentially numbered. The XML ﬁ le 
can be opened in Internet Explorer or other XML - capable readers. 
 To use trace logging, you must install the Tracing role service. After the Tracing role 
service is installed, you can enable failed request tracing for a particular website. See 
Exercise 22.2. 
 E X E R C I S E  2 2 . 2
Enabling Failed Request Tracing  
 1. 
  Click Start   Administrative Tools   Internet Information Services (IIS) Manager. 
 2. 
  In the Connections pane, expand the server name; then expand Sites and click Default 
Web Site. 
 3. 
  In the Actions pane, click Failed Request Tracing. 
 4. 
  Check the Enable box, and type in the name of the directory in which you want to save 
the log ﬁ les.  
■
■
■
■
■
■
■
Managing Internet Information Services 
921

922 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 After you enable Failed Request Tracing and deﬁ ne the number of trace ﬁ les to keep, you 
must create failure deﬁ nitions to specify what failures should be logged. For example, if a 
500 error occurs intermittently in the .NET application on the website, you could create 
a failed request tracing rule to watch for a status code of 500 on all ﬁ les with an  .aspx 
ﬁ lename extension. 
 Failed request tracing rules can be created at the server, website, or virtual directory 
level. The rules are always inherited from the parent container. You will want to be careful 
about enabling the rule closest to the problem directory or application because failed 
request tracing can have a negative impact on server performance. 
 The three criteria for a creating a rule are content, conditions, and trace provider. The 
content criterion speciﬁ es the name of the ﬁ les or path that should be traced. There are four 
options, as shown in Figure 22.1: 
 All content (*)  
 ASP.NET (*.aspx)  
 ASP (*.asp)  
 Custom  
■
■
■
■
 F I G U R E 2 2 .1 Specifying content to trace 
 Content 
 With the ﬁ rst three content options, it is easy to identify what is going to be traced. The All 
Content (*) option speciﬁ es watching all content below where the rule is created. The ASP
.NET (*.aspx) option speciﬁ es tracing only requested URLs that end with  .aspx , and the 
ASP (*.asp) option speciﬁ es tracing only requested URLs that end in  .asp . 
 The last option, Custom, allows you to be more speciﬁ c. You can specify watching web 
pages with a name that has a speciﬁ c beginning or ending. If you need to watch all pages 

that start with  forum , like  forum.aspx or  forumLogin.aspx , you could add  forum* in the 
Custom ﬁ eld. Of note, though, is that you are allowed only one wildcard in this ﬁ eld, 
meaning you could not add in  *forum* to be able to trace  StartForumLogin.aspx . Instead, 
you would need to ﬁ nd a more generic option to trace code on that web page.  
 Condition 
 The next criterion that needs to be speciﬁ ed is the condition or conditions that would 
constitute a failure. If more than one condition is speciﬁ ed, the ﬁ rst condition that is 
matched will generate the log ﬁ le. There is no way to specify that multiple conditions must 
be met to generate the ﬁ le. You can select three options for conditions:
 Status Code(s)   This option should be selected when you want to generate a trace log based 
on an HTTP response code. Multiple status codes can be entered; however, they must be 
separated by commas.  
 Time Taken (In Seconds)   This option should be selected when you want to generate a 
trace log when a speciﬁ c request takes longer to process than expected. If this is selected, a 
time interval must also be entered in seconds.  
 Event Severity   This option should be selected when you want to generate a trace log based 
on the severity of an error that occurs. If this is chosen, one of the following options must 
also be chosen: 
 Error   This will provide information when components generate errors and do not 
continue to process requests.  
 Critical Error   This will provide information when components cause a process to end.  
 Warning   This will provide information when components experience an error and 
continue to process requests.  
 You can see these options in Figure 22.2.  
 F I G U R E 2 2 . 2 Defining trace conditions 
Managing Internet Information Services 
923

924 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 Trace Provider 
 The last criterion that must be deﬁ ned is which trace providers should be used and at which 
verbosity. There are a number of differences that are not all that obvious. The following 
four built - in trace providers are shown in Figure 22.3: 
 ASP  
 ASPNET  
 ISAPI Extension  
 WWW Server  
■
■
■
■
 F I G U R E  2 2 . 3 Selecting trace providers 
 In the case of ASPNET and WWW Server, you are given the option to specify areas that 
should also be traced. With ASPNET and WWW Server, you can specify the following areas:
 Infrastructure   This option traces requests when the request is going between different 
tracing areas within ASP.NET.  
 Page   This option traces page events and can also capture Trace.Write and Trace.Warn events.  
  AppServices   This option traces the requests through application services.  
  Authentication   This option traces authentication attempts and includes the authenticated 
user, the scheme (such as Anonymous or Basic), and the results of the attempt.  
  Security   This option traces events when the server rejects the requests for security or 
permission reasons.  
  Filter   This option traces how long it takes an ISAPI ﬁ lter to process a request.  

 Static File   This option traces how long static ﬁ le requests take to be completed.  
 CGI   This option traces when a request is made to the CGI Module.  
 Compression   This option traces through the compression modules.  
 Cache  This option traces through the cache compression modules.  
 Request Notifications   This option traces all request notiﬁ cations, both on entrance and 
on exit.  
 Module   This option traces the requests through the HTTP pipeline or managed modules.  
 There are also six verbosity settings for each of the providers. To get the information 
required to pinpoint the problem, you will want to select the minimum verbosity to reduce 
the impact on the server. In the following list, the verbosity levels are listed in order; the 
ﬁ rst level results in the least amount of data and the last in the most: 
 General  
 Critical Errors  
 Errors  
 Warnings 
 Information  
 Verbose  
 Tracing failed requests can have a negative impact on server performance. 
If you must use tracing on a production server, be aware of the impact. 
Test the configuration in a test lab under load while monitoring standard 
metrics such as CPU, memory, disk I/O, and application response time. 
 Access Logging 
 Who is visiting a website and what they are doing when they are there is something most 
web developers want to know so they can provide a satisfying experience to the end user, 
see how good a job they are doing at getting people to visit the site, and determine how 
users were referred to the site. 
 This is where access logging is useful. Server administrators can use it too, to determine 
if there are errors and when the busiest times are for the server. Also, administrators 
can determine the period when the server is at its least busy so that they can schedule 
maintenance; this period is often called a change window. 
 Access log ﬁ les store the request activity for each request — information such as time, 
software client used, amount of data transferred, and the status code from the server. 
You can modify the exact attributes of the request to meet the needs of your business for 
reporting and auditing. 
 Access logs can be processed by reporting software to allow a more user - friendly and 
more digestible way of viewing the data. There are now two main ways of storing access 
logs: on a per - server basis and on a per - site basis.  
■
■
■
■
■
■
Managing Internet Information Services 
925

926 
Chapter 22 ■ Advanced Web Infrastructure Configuration
  Per - Server Logging   Per - server logging creates a single log for all of the sites on the server. 
There are two options to choose from: Centralized Binary Logging and Centralized World 
Wide Web Consortium (W3C) Extended Log. 
 Binary logging is written in the Internet Binary Log format, which isn ’ t readable with 
common text editors but can be read by third - party tools as well as LogParser, which is 
available from Microsoft. The W3C extended log is written in a text format and can be 
read with common text - editing software.  
  Per - Site Access Logging   Per - site access logging is similar to the method used in previous 
versions of IIS. There are four types of built - in per - site logging: National Center for 
Supercomputing Applications (NCSA) Common, Microsoft Internet Information Services 
(IIS), World Wide Web Consortium (W3C) Extended, and Custom (ODBC) Logging. 
 Both W3C and Custom logging allow configuration of the information that will be stored 
in the access log. Modifying the type of information that will be logged is sometimes 
necessary for some reporting software to be able to deliver detailed reports.  
 Per - server logging and the default per - site conﬁ guration are completed at the server level 
using the Logging Features options. At the site level, the Logging feature can be used to 
customize per - site conﬁ guration settings. Whether you choose per - server or per - site logging, 
the base directory for storing the ﬁ les is  %SystemDrive%\inetpub\Logs\Logfiles\W3SVC . 
 If you choose per - site, however, the individual site log ﬁ les are placed in a directory 
based on the site number. For example, website 1 would be stored in  %SystemDrive%\
inetpub\Logs\Logfiles\W3SVC1 . The log ﬁ lenames in those directories depend on the 
format chosen and rollover settings. Log ﬁ le rollover sets the criteria for when a log ﬁ le 
should split. There are four main rollover criteria:
  Schedule   This option should be selected if a new log ﬁ le should be created by one of the 
following time schedules: 
 Hourly  
 Daily  
 Weekly 
 Monthly  
  Maximum File Size (In Bytes)   This option should be selected if the log ﬁ le should reach a 
speciﬁ c size before a new one is created.  
  Do Not Create New Log Files   This option should be selected if a single log ﬁ le should be 
created. Often this is used with legacy web - reporting software that has to reference a single 
ﬁ lename to create reports.  
 Use Local Time For File Naming And Rollover   This option should be selected if the 
local time should be used. The default is to use Coordinated Universal Time (UTC - Temps 
UniverselCoordonn é ) for rollover and ﬁ le naming.  
 Logging can be stored in either the Unicode Transformation Format (UTF - 8) or the 
ANSI format; however, it can be selected only at the server level. The server format controls 
all site logging formats.  
■
■
■
■

 
When log settings are changed, the site must be restarted to activate the 
new settings. 
 Backup and Restore 
 One of the most important conﬁ guration and setup steps is to make sure that restores work 
because doing a backup is useless unless a restore can be accomplished. As mentioned in 
Chapter 21, the conﬁ guration for IIS is stored in a number of XML - based ﬁ les. These ﬁ les 
can be backed up and then restored to return the server ’ s conﬁ guration to the point in time 
when the conﬁ guration was created. 
 Since an errant conﬁ guration change can negatively impact the server ’ s functionality, 
a backup is made of the server conﬁ guration when an administrator makes changes. The 
default setting keeps up to 10 conﬁ guration backup sets in a uniquely named subdirectory 
of  %SystemDrive%\Inetpub\History before removing the oldest automatic backup. 
 The backup is completed by default every two minutes as changes are made. This avoids 
the need for having a backup for each check box selected and setting tweaked; instead, all 
changes during the two minutes are committed at the same time, with a single backup.  
 Configuration backups protect only the server configuration files. They do not 
back up application  Web.config files, nor do they back up website content.  
 The number of conﬁ guration backups is controlled by the  maxHistories attribute 
of the  configHistory section of the  applicationHost.config ﬁ le, and the interval that the 
conﬁ guration ﬁ le is backed up is controlled by the  Period attribute. The period is speciﬁ ed 
in the hours:minutes:seconds format. If you want to specify a 10 - minute period, you would 
use 00:10:00. The  AppCmd.exe utility can be used to modify both of these attributes. 
Exercise 22.3 walks you through changing these settings.  
 E X E R C I S E  2 2 . 3
Modifying Configuration History Settings 
 Follow these steps to modify conﬁ guration history settings: 
 1. 
  Open an elevated command prompt. 
 2. 
  Change to  %System%\System32\InetSrv , the directory where  AppCmd.exe resides.  
 3. 
  Run  appcmd set config /section:configHistory /maxHistories:50 /period:00:10:00   
to set the maximum number of history backups to 50 with a save interval of 10 minutes.  
 What if you want to make a manual backup of the conﬁ guration to keep for future 
recovery? This too can be done with the  AppCmd.exe utility. Figure 22.4 shows  AppCmd.exe 
being run to manually generate a backup called Server Backup 1.  
Managing Internet Information Services 
927

928 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 F I G U R E 2 2 . 4 Manually creating a server configuration backup 
 To list the automatic and manual conﬁ guration backups that have been completed, 
you would run   AppCmd.exe list backups  . Figure 22.5 shows the results of running this 
command. 
 Now you have conﬁ guration backups, but what use are they unless you can perform 
a restore? When you restore the conﬁ guration, you restore IIS settings for all of the sites, 
application pools, virtual directories, and applications. Figure 22.6 shows an example of 
running a restore of a manual backup named Server Backup 1 by running   AppCmd restore 
backup  “ Server Backup 1 “   . 
 F I G U R E 2 2 . 5 Listing available backups 
 F I G U R E 2 2 .6 Restoring the configuration from a backup 

 Now that the server conﬁ guration is being protected, the next step is to ensure that the 
content of the websites is protected. There isn ’ t a whole lot of IIS - speciﬁ c magic when it 
comes to backing up content. The new Windows Server Backup feature should be used to 
perform regular backups of site content, which would include any  Web.config ﬁ les that 
contain conﬁ guration data not captured by the IIS conﬁ guration backup.  
 
The Windows Server Backup feature is installed from Server Manager by 
selecting Add Features from the Action menu. 
 Delegating Administrative Rights 
 To allow developers, help desk personnel, or non - IT staff to perform speciﬁ c administrative 
functions, IIS 7.5 has feature delegation. Authentication for feature delegation is done by 
default with Windows credentials; alternatively, IIS Manager Credentials can be conﬁ gured 
as well. 
 To start off with feature delegation, ﬁ rst the IIS Management Service role service 
must be installed. The role service can be added using Server Manager. The Management 
Service role service is used to allow remote administration of IIS, which is the method that 
delegated IIS administrators must use to connect to get delegated feature rights. 
 Two forms of administrative rights can be delegated, IIS management and feature 
delegation. Either form of delegation affects all sites, directories, or applications below 
where the delegation takes place. IIS management delegation grants permissions to allow a 
user to be able to manage speciﬁ c sites or applications. Exercise 22.4 demonstrates how to 
grant a user IIS Manager permissions to manage an entire website.  
 E X E R C I S E  2 2 . 4
Delegating Administrative Permissions for Administration of a Website 
 1. 
  Click Start   Administrative Tools   Internet Information Services (IIS) Management. 
 2. 
  Select Default Web Site in the Connections pane. 
 3. 
  In the Actions pane, click Edit Permissions.  
 4. 
  Click the Security Tab. 
 5. 
  Click the Edit button.  
 6. 
  Click the Add button and then add the user who will have rights to manage this site. 
 7. 
  Assign the user the rights you want to give them. Click OK.  
Managing Internet Information Services 
929

930 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 The more granular delegation option available is feature delegation. It allows you to 
specify whether the feature ’ s related conﬁ guration is locked or unlocked. When a feature is 
locked, the conﬁ guration is enforced to all lower levels. 
 Locking a feature is used when you want all conﬂ icting conﬁ gurations in  Web
.config ﬁ les below to be overridden. This may be important for speciﬁ c features to block 
developers or administrators from overriding standards that have been set. The default 
for all feature delegation is to user lower - level conﬁ guration ﬁ les for feature conﬁ guration 
settings.  
 IIS Manager permissions are delegated for a site or an application because 
computer administrators automatically have permission at the server level.  
 Feature delegation is done from the server level; however, the features can be delegated 
at a variety of levels. To conﬁ gure feature delegation for all sites on the server, as you 
would do when you give a user or set of users access to administer all sites, you would 
perform the delegation at the server level. 
 If you are delegating rights on only a particular site, you would start the delegation at 
that site. To manage feature delegation, select the local server in the Connections pane and 
double - click the Feature Delegation icon in the Content pane (Figure 22.7).  
 F I G U R E 2 2 .7 Managing feature delegation 

 There are three general settings and one action for each feature:
 Read/Write   This sets the feature to unlocked and allows features to be changed in 
lower - level  Web.config ﬁ les for the sites and applications below. This also allows all non -
 administrators to conﬁ gure the feature in IIS Manager if they have been given permissions 
to connect.  
 Read Only   This locks the feature ’ s conﬁ guration to the server - level conﬁ guration ﬁ le. The 
conﬁ guration cannot be overridden by any lower - level  Web.config ﬁ les. It also denies all 
non - administrators the ability to conﬁ gure these features in IIS Manager; however, the user 
will be able to view the conﬁ guration.  
 Not Delegated   This locks the feature ’ s conﬁ guration to the server - level conﬁ guration ﬁ le. 
The conﬁ guration cannot be overridden by any lower - level  Web.config ﬁ les. It also denies 
all non - administrators from being able to see or modify the feature in IIS Manager.  
 Reset To Inherited  This action sets the delegation state to what it is set to at the parent level.  
 Two exceptions are .NET Users and .NET Roles. These features are assigned either 
Conﬁ guration Read/Write or Conﬁ guration Read Only and Reset All Delegation. They are 
similar to the preceding features except that they affect the conﬁ guration for the feature, 
not the data the feature uses. Figure 22.8 shows an example of conﬁ guring the Feature 
Delegation options.  
 F I G U R E  2 2 . 8 Configuring Feature Delegation 
Managing Internet Information Services 
931

932 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 Configuring Secure Sockets 
Layer Security 
 Security is extremely important to companies today. Improperly protecting sensitive 
user data can destroy a company ’ s reputation. Secure Sockets Layer (SSL) is a method of 
encrypting and authenticating client - to - server communications. It provides reasonable 
assurance that the information being exchanged between the client and the server is safe 
from prying eyes. 
 To provide SSL communication, you must install a certiﬁ cate on the server. SSL 
certiﬁ cates are based on Public Key Infrastructure (PKI), which consists of a private key, a 
public key, and a certiﬁ cate authority (CA) that is able to validate the keys. 
 The public keys provide details about the owner of the certiﬁ cate, whether it 
 is valid, and how the certiﬁ cate can be used. The public key is, as its name suggests, public 
and can be distributed anyone who requests it. The private key, however, should be kept 
secure and stored only on the server or servers that require it. If the private key is made 
public or compromised in another way, the certiﬁ cate should be discarded and a new one 
generated. 
 The public and private keys are a matched pair of numbers used in asymmetrical 
computations. It would be like having one key that locks the door and another key that 
unlocks it. For the certiﬁ cate, when one key is used to encrypt the data, the other must be 
is used to decrypt it. If one of the keys is missing, the encryption or authorization process 
cannot complete. 
 The certiﬁ cates are authenticated and issued by a CA. A CA can be likened to a passport 
agency. The passport agency veriﬁ es the information the requestor provides and then issues 
a passport that is valid for a speciﬁ c period. When a passport holder travels, they provide 
the passport as a means of identiﬁ cation because governments trust that the government 
that issued passport has properly veriﬁ ed the identity of the holder. Similarly, when a CA 
issues a certiﬁ cate, it veriﬁ es that you are who you purport to be by verifying speciﬁ c 
information and often requesting documentation. Once the veriﬁ cation is complete, the 
certiﬁ cate is issued. 
 For a certiﬁ cate to be valid, all parties must trust the CA. Windows Server 2008 R2 
includes Active Directory Certiﬁ cate Services (AD CS) as an available role that can act 
as a CA and issue certiﬁ cates. If you create your own CA, users on the Internet will not 
automatically trust your CA and will receive errors when trying to access your site. Using 
AD CS may be a valid option if all users are under your control or in your domain because 
you can use Group Policy to force the machines to trust your CA. 
 Third parties such as VeriSign, GeoTrust, and Thawte operate CAs that are trusted by 
many major operating systems like Windows Server 2008 R2. When you ’ re requesting a 
certiﬁ cate for a website, it is best to obtain the certiﬁ cate from a widely trusted third party 
so that Internet users do not have problems when visiting your site. 

 Requesting and Renewing SSL Certificates 
 The ﬁ rst step in conﬁ guring SSL on a website is to obtain a certiﬁ cate. To protect the 
private key, a request must be generated and the pertinent information sent to a CA so that 
the certiﬁ cate can be generated with the public key. To create a simple certiﬁ cate request 
from IIS Manager, follow the steps listed here: 
 1. 
 Choose the server name in the Connections pane and then double - click the Server 
Certiﬁ cates icon.  
 2. 
  Choose Create Certiﬁ cate Request from the Actions menu (Figure 22.9).  
 F I G U R E 2 2 . 9 Managing server certificates 
 3. 
  In the Request Certiﬁ cate dialog box, provide information speciﬁ c to your 
organization. This information is used by the CA to determine if you are eligible to 
request a certiﬁ cate for this organization. Note that the common name must match the 
hostname of the server. Click Next (Figure 22.10).  
Configuring Secure Sockets Layer Security 
933

934 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 4. 
  On the Cryptographic Service Provider Properties page (Figure 22.11), choose the 
encryption service provider and the bit length of the encryption. The bit lengths 
available in this step range from 384 to 16384. The larger the bit length, the higher the 
level of encryption, but a higher level of encryption also puts more load on the server 
because the encryption and decryption process requires complicated mathematical 
functions to complete. It also requires more information to be exchanged between the 
server and client. Click Next.  
 F I G U R E 2 2 .10 Entering certificate details 
 F I G U R E 2 2 .11 Setting the Cryptographic Service Provider Properties 
 5. 
  Provide a location to save the certiﬁ cate request and click Finish.  
 The process is not over. The next step is to take the certiﬁ cate request ﬁ le and submit it 
along with any other documentation to the CA so that the certiﬁ cate can be issued. After 
the CA processes the request, you must use the response to complete the certiﬁ cate. From 

Server Certiﬁ cates in IIS Manager on the server from which the request was generated, 
choose Complete Certiﬁ cate Request from the Actions pane. 
 As shown in Figure 22.12, on the Specify Certiﬁ cate Authority Response dialog, enter 
the location of the text ﬁ le containing the response from the CA, assign a name for the 
certiﬁ cate, and then click OK. 
 To do testing with SSL certiﬁ cates, you can also create a self - signed SSL certiﬁ cate. Since 
there is no trusted certiﬁ cate authority, no one other than the server will automatically 
trust the certiﬁ cate. To create a self - signed certiﬁ cate, simply select Create Self - Signed 
Certiﬁ cate from the Actions pane from Server Certiﬁ cates in IIS Manager. 
 After the certiﬁ cate is issued, it is valid for only a speciﬁ c amount of time. To renew the 
certiﬁ cate, you must generate a renewal request. This request can then be given to the CA, 
and the CA will issue a new response, which in turn will generate a new certiﬁ cate.  
 F I G U R E 2 2 .12 Completing a certificate request 
 Enabling SSL on a Website 
 Once you have a valid certiﬁ cate on the server — one issued from a trusted third - party CA, 
one from a local AD CS server, or a self - signed certiﬁ cate — you must assign it to a website to 
enable SSL. Exercise 22.5 walks you through the steps of enabling SSL on a web server. 
 E X E R C I S E  2 2 . 5
Enabling SSL on a Web Server  
 1. 
  Select the website for which you would like to enable SSL.  
 2. 
  Choose Bindings from the Actions pane. 
 3. 
  Click Add in the Site Binding dialog box.  
 4. 
  In the Add Site Binding dialog box, set the type to HTTPS and select an IP address to 
bind to if you ’ re not using the default. 
 5. 
  Select the SSL certiﬁ cate from the drop - down list and click OK.  
Configuring Secure Sockets Layer Security 
935

936 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 After SSL has been enabled, you should be able to visit the site from a browser using 
 https:// < sitename > / . If you want to require that all clients connect to a site or virtual 
directory with SSL, navigate to where you want to enforce SSL in the Connections pane 
and then double - click on SSL Settings in the Content pane. As shown in Figure 22.13, 
enable Require SSL.  
 F I G U R E 2 2 .13 Configuring the Require SSL setting 
 Exporting and Importing Certificates 
 You may need to export a certiﬁ cate from one server to another when multiple web servers 
in a web farm must host the same SSL secured site. When you export a certiﬁ cate, the 
private key is also exported, so the exported data should be protected. Allowing the private 
key for the site to fall into the wrong hands increases the likelihood of compromising the 
integrity of the certiﬁ cate. 
 To export a certiﬁ cate, select the server in the Connections pane and double - click Server 
Certiﬁ cates in the Content pane. Then choose Export from the Actions pane. As shown in 
Figure 22.14, specify a ﬁ lename and a password to protect the certiﬁ cate.  

 To import a certiﬁ cate, you follow a similar procedure. Select the server in the 
Connections pane and double - click Server Certiﬁ cates in the Content pane. Then choose 
Import from the Actions pane. As shown in Figure 22.15, select the certiﬁ cate ﬁ le, type in 
the password, and then select whether you would like the certiﬁ cate to be exportable from 
this server.  
 F I G U R E 2 2 .14 Exporting a certificate 
 F I G U R E 2 2 .15 Importing a certificate 
 Configuring Website Authentication 
and Permissions 
 A number of authentication types are available for IIS 7.5 to meet the needs of your 
application. A number of native authentication modules are available that enable speciﬁ c 
authentication types.  
 Active Directory Client Certificate Authentication   This allows authentication using 
certiﬁ cates stored in Active Directory.  
Configuring Website Authentication and Permissions 
937

938 
Chapter 22 ■ Advanced Web Infrastructure Configuration
  Anonymous Authentication   This allows any user who can access the site to view content 
without having to authenticate. The IUSR[ _ServerName ] account is used by IIS to access 
the content on the server.  
 ASP.NET Impersonation   This allows an ASP.NET application to run under accounts 
other than the default ASPNET account.  
  Basic Authentication  This allows users to access content after providing a username and 
password. Basic authentication transmits the username and password with weak encryption, 
so it is best to use this on a trusted network or to provide additional encryption using SSL. 
  Forms Authentication  This uses an HTML form to request credentials from a user. The 
credentials can be validated to a number of sources, including Active Directory or another 
database. The username and password are sent in plain text, and it is recommended that 
you use SSL to provide protection.  
  Windows Authentication   This allows authentication with NTLM or Kerberos to domain 
or local accounts. 
 By default, Anonymous authentication is enabled. If Anonymous is enabled along with 
other authentication modules, users will be able to view all publicly available content. 
If someone attempts to access content that isn ’ t publicly available, they are prompted to 
provide credentials. To enable an authentication module, you must ﬁ rst install it. All of the 
authentication modules are listed under the Security heading when role services are installed, 
as shown in Figure 22.16. 
 F I G U R E 2 2 .16 Adding authentication modules 

 Once you have installed the modules required to provide authentication for your site, 
only Anonymous authentication is enabled by default. To enable other authentication, 
navigate to the server, site, or applications for which you want to enable the authentication 
type in the Connections pane. From there, double - click Authentication in the Content 
pane. As shown in Figure 22.17, you will be able to view a list of available authentication 
types and then enable, disable, or conﬁ gure each authentication type as needed.  
 F I G U R E 2 2 .17 Configuring authentication 
 Configuring Application Access 
 Authorization rules can be used to control access to a website. They can be speciﬁ c to 
users, groups, or roles that have access to the site and can optionally apply to speciﬁ c 
HTTP commands (verbs). This can be done by creating either an allow or a deny 
authorization rule. 
 To use authorization rules, you must install the URL Authorization module. The 
authorization rule is then created at the site or application on which it should be enforced 
and affects all down - level content unless speciﬁ cally removed. The Entry Type column lists 
Inherited for rules applied from the parent and Local for rules created at the selected level. 
Figure 22.18 shows several inherited rules from the parent container as well as a single rule 
created at the selected level.  
Configuring Website Authentication and Permissions 
939

940 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 An authorization rule is applied to one of the following: 
 All users  
 All anonymous users  
 Speciﬁ ed user groups or ASP.NET roles  
 Speciﬁ ed users  
 When creating an authorization rule, you have the option of applying this allow or deny 
rule to speciﬁ c HTTP commands known as verbs.  
 Client Certificate Mapping 
 Client certiﬁ cates allow a user to authenticate with the site. To enable a website to accept 
certiﬁ cates, you must ﬁ rst install the AD Client Certiﬁ cate Authentication modules 
and enable them at the server level. To allow a website or application to accept client 
certiﬁ cates, you must conﬁ gure the SSL settings. 
 To do this, select the site or application in the Connections pane and then double - click 
SSL Settings in the Content pane. Then under Client Certiﬁ cates in the Content pane, choose 
Accept or Require. Choose to accept client certiﬁ cates if not all users have certiﬁ cates to 
authenticate, and choose Require if you want to enforce all users to authenticate with 
a certiﬁ cate. If you choose Require, you must also require SSL to connect to the site or 
applications. 
■
■
■
■
 F I G U R E 2 2 .18 Viewing authorization rules 

 Summary 
 Although IIS can be very easy to use and conﬁ gure, a number of more advanced topics 
warrant consideration. In this chapter we covered advanced management tasks like backing 
up and restoring, conﬁ guring SSL certiﬁ cates, and conﬁ guring authentication types. 
 In several examples, we used the  AppCmd.exe command - line tool to work with 
conﬁ guration backup, restores, and conﬁ guration history. We also discussed creating failed 
request tracing rules to be able to pinpoint problems within a web application. 
 Access logging can be conﬁ gured either per site or per server to provide detailed logs 
that track client access to the site. These logs can be used to identify the popularity of 
a web application or to determine usage patterns. Feature delegation is used to control 
the features that can be conﬁ gured or to allow feature settings to be overridden that are 
conﬁ gured at higher levels in the conﬁ guration. 
 Next, the chapter covered authentication settings to control access and methods of 
authenticating users. Last, we discussed requesting, binding, and exporting certiﬁ cates.  
 Exam Essentials  
 Know how to perform a manual backup and restore.   Using AppCmd to complete backups 
and restores is important. Know what syntax to use and in which scenarios you would be 
required to perform a backup or a restore.  
 Know what an SSL certificate is and how to request a new one.   Certiﬁ cates are used to 
encrypt and authenticate communications between the server and client. Know the steps 
required to secure a website and where to obtain an SSL certiﬁ cate.  
 Know which modules are used for authentication.   IIS 7.5 has a number of modules 
used for authentication. Know which modules to use in speciﬁ c instances. Know which 
authentication modules are used for different authentication requirements.  
Exam Essentials 
941

942 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 Review Questions  
 1. 
  What is the name of the tool used to view and configure IIS settings?  
 A.   Computer Manager  
 B.   WDSUTIL  
 C.   AppCmd  
 D.   IISmgt  
 2. 
  In order to troubleshoot and monitor failures in IIS, what role service needs to be installed?  
 A.   Monitoring  
 B.   Tracing  
 C.   Event Viewer Service 
 D.   File Sharing  
  3. 
 What must be created to define which failures should be logged?  
 A.   Event viewer filter  
 B.   Event view monitor  
 C.   System task to monitor log files  
 D.   Failed request tracing rule  
 4. 
  What are three criteria for creating a trace rule?  
 A.   Content  
 B.   Trace provider  
 C.   Event ID 
 D.   Conditions  
 5. 
  Which of the following trace providers is built in?  
 A.   .NET  
 B.   ASP  
 C.   HTML  
 D.   PHP  
 6. 
 What log files are used to determine information such as time, software client used, 
amount of data transferred, and status codes?  
 A.   Access logs  
 B.   Application logs  
 C.   Event view log  
 D.   System logs  

Review Questions 
943
 7. 
  If you have more than one site on your server and you want to keep all the logs in a single 
file, what type of logging will you use?  
 A.   Single access log  
 B.   Combined log  
 C.   Per - server logging  
 D.   Per - domain logging  
 8. 
  What is the location where the log files are stored regardless of whether you use per - server 
or per - site logging?  
 A.   %SystemDrive%\inetpub\Logs\Logfiles\W3SVC 
 B.   %SystemDrive%\inetpub\Logs\Logfiles 
 C.   %SystemDrive%\inetpub\Logs 
 D.   %SystemDrive%\Windows\System32\LogFiles 
 9. 
  What tool is used to create a manual backup of the IIS server configuration?  
 A.   WDSUTIL  
 B.   NTBACKUP  
 C.   AppCmd  
 D.   IISState  
 10.   Before you can use IIS feature delegation, what role needs to be installed?  
 A.   IIS Management Service  
 B.   Permissions Verifier 
  C.   Active Directory Certificate Service  
 D.   Network Policy and Access Service   

944 
Chapter 22 ■ Advanced Web Infrastructure Configuration
 Answers to Review Questions 
 1. 
C . The AppCmd tool is used to conﬁ gure and view the settings for IIS.  
 2. 
B .  The Tracing role service needs to be installed in order to monitor when failures occur.  
 3. 
D .  Failed request tracing rules will monitor for failures you deﬁ ne.  
 4. 
A, B, D .  The criteria for creating a rule are content, conditions, and trace provider.  
 5. 
B . ASP is a built - in trace provider. 
 6. 
A .  Access logs are used to collect data that may include time, software client used, amount 
of data transferred, and status codes.  
 7. 
C .  Per - server logging is used when you have multiple sites on a single server and you want 
a single log for all sites.  
 8. 
A .  Log ﬁ les are located at  %SystemDrive%\inetpub\Logs\Logfiles\W3SVC . 
 9. 
C .  AppCmd is used to create a manual backup of the server conﬁ guration.  
 10. A .  IIS Management Service is required for IIS feature delegation.   
  
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at  www
.sybex.com/go/mctswin08r2 . 

Configuring 
Additional 
Communication 
Services  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Network Application Services  
 Manage the Streaming Media Services role. May include but 
is not limited to: installation; on - demand replication; caching 
and proxy; multicast streaming; advertising; Web - based 
administration; Real - Time Streaming Protocol (RTSP).  
 Secure streaming media. May include but is not limited 
to: encryption; sharing business rules; configuring license 
delivery; configuring policy templates; configure Windows 
Media Rights Manager; automatically acquire media usage 
rights; Microsoft DRM upgrade service.  

■
■
 Chapter 
23

 Windows Server 2008 R2 includes communication services that 
can beneﬁ t your organization, such as fax services. Additional 
services can prove to be valuable to any organization that looks 
to manage both delivering live or on - demand digital media and sending and receiving faxes. 
 Learning about these services is important not only for the exam but for real - life 
applications. As organizations grow, the need for better communication management 
becomes a necessity. IT administrators who not only want to keep pace with the industry but 
also want their organizations to use their resources to the fullest will devote the time needed 
to conﬁ gure communication services. In addition to conﬁ guration, time should be devoted to 
understanding each organization ’ s needs and how it will beneﬁ t from these additional tools. 
 Many may argue that the time spent on these additional services is wasted. 
 Anyone who has ever had to work to make a company ’ s fax services work or ﬁ gure out 
how to record meetings and then replay them in either audio or video form will disagree. 
Most likely the majority of the companies in today ’ s workforce do value communication 
services, and this is where the IT administrator can shine.  
 Configuring Fax Services 
 Fax services for Windows Server have been around since the days of Windows NT. They 
have always left something to be desired in becoming an enterprise faxing solution, but 
over the years they have shown improvements in both features and in instructions on how 
an IT administrator can conﬁ gure them. 
 Is a faxing service still needed, however? Simply put, yes. Even in a world where 
everything moves at a fast pace and more communication is done via email, faxing is still 
the ﬁ rst choice in many communications tasks. Perhaps this is because people still like the 
feel of paper in their hands. In any case, fax services will not be going away anytime soon. 
 Microsoft continues to support this older but still heavily relied on resource. We will 
endeavor to show you how to conﬁ gure this service in Windows Server 2008 R2. 
 We assume you have already installed the Fax Server role using Server Manager. After 
you have completed the installation of the Fax Server role, can use the Fax Service Manager 
to do the following: 
 Manage users  
 Conﬁ gure fax devices  
 Set up routing polices for faxes  
 Create rules for outgoing faxes  
■
■
■
■

 Archive received or sent faxes  
 Track the use of fax resources  
 It is recommended you install the Windows Fax and Scan role on your Windows 2008 
R2 Server machine because it will allow you to monitor the activity in the  Incoming ,  Inbox , 
and  Outbox folders. To install the Windows Fax and Scan role from Server Manager, 
complete the following steps: 
 1. 
 In the left pane, click Features, and then in the right pane, click Add Features.  
 2. 
  In the Select Features section, select Desktop Experience and click Next.  
 3. 
  On the next screen, choose Install.  
 If your users are using Microsoft ’ s Windows 7, they can send and receive 
faxes using the built - in Windows Fax and Scan utility. Windows XP users 
can send faxes using the Fax Console utility.  
 Configuring Fax (Local) Properties 
 After installing the Fax Server role (see Figure 23.1) on your Windows Server 2008 R2 
machine, it will automatically detect and install any fax device that has been attached to 
the server. If a fax device does not already exist, a local fax printer connection is created. 
This fax device represents all the physical fax devices that are connected to the server.  
■
■
 F I G U R E 2 3 .1 Installation of Fax Server role 
Configuring Fax Services 
947

948 
Chapter 23 ■ Configuring Additional Communication Services
 By default, all detected fax devices are enabled for sending faxes but not for receiving 
them. You must speciﬁ cally enable each device to receive faxes. Server Manager will be 
used to enable these devices.  
 After you install the Fax Server role, sharing is not enabled by default. You 
can share a fax device within the Printers option in Control Panel. 
 In Exercise 23.1, you will use Server Manager to install the Fax Server role.  
 E X E R C I S E  2 3 .1
Installing the Fax Server Role  
 1. 
  In the left pane in Server Manager, choose Roles. 
 2. 
  In the Roles Summary pane, click the Add Roles link. 
 3. 
  Check the Fax Server check box.  
 4. 
  When the Add Roles Services box appears, click the Add Required Role Services button. 
Click Next. 
 5. 
  At the Introduction screen, click Next. 
 6. 
  At the Select Fax Users screen, choose any users or groups that you want to use the fax 
service. Click Next.  
 7. 
  At the Specify Who Can Access The Fax Server Inbox screen, click the All Users radio 
button. Click Next.  
 8. 
  The Print And Document Introduction screen is next. Just click Next.  
 9. 
  At the Select Roles Screen, accept the default and click Next. 
 10.   Choose Install on the Conﬁ rmation screen.  
 11.   After the installation completes, click Close. 
 12.   Close Server Manager.  
 The next step is to conﬁ gure the properties of the fax server. The following tabs are 
found in the Fax Properties dialog box:
  General   Within this tab, you can review the current activity and disable sending and/or 
receiving faxes.  
 Receipts   This tab allows you to conﬁ gure delivery options.  
  Event Reports   This is where you specify event - tracking levels.  
  Activity Logging   This section allows you to choose to log incoming and outgoing fax 
activity.  

 Outbox   This is where you can conﬁ gure the options for the queue of all outgoing faxes.  
 Archives   Here you can conﬁ gure your archive settings for sent and received faxes.  
 Accounts   Here you can choose to assign messages to individual accounts.  
 Security  This section allows you to set permissions for users or groups for fax conﬁ gurations 
and documents.  
 In Exercise 23.2, you ’ ll conﬁ gure the settings for the most common features within the 
Fax Properties dialog box.  
 E X E R C I S E  2 3 . 2
Configuring Fax Properties  
 1. 
  Open Server Manager, expand Roles, and then expand Fax Server.  
 2. 
  Right - click Fax and choose Properties. 
 3. 
  On the Receipts tab, click the box labeled Enable SMTP E - Mail Receipts Delivery and 
enter a From e - mail address, SMTP server address, and port number. 
 4. 
  Select the Activity Logging tab. Click the boxes next to Log Incoming Fax Activity and 
Log Outgoing Fax Activity.  
 5. 
  In the Activity Log Folder text box, enter the path to store the activity log. The default 
location is  C:\ProgramData\Microsoft\Windows NT\MSFax\ActivityLog . 
 6. 
  Select the Outbox tab, check the Automatically Delete Faxes Older Than option, and 
then choose the number of days to keep faxes.  
 7. 
  Select the Archives tab and make sure the check box for Archive All Faxes To This 
Folder is checked. The default is  C:\ProgramData\Microsoft\Windows NT\MSFax . 
 8. 
  To allow faxes to be reassigned, select the Accounts tab and then check the On box 
under Reassign Settings. 
 9. 
  Click OK.  
 Defining a Dialing Rule 
 Setting up dialing rules will help the fax server understand what your area requires. For 
example, most locations in the United States require dialing a 1 before dialing a number 
outside a local area code. When dialing within an area code, only 7 digits are needed. 
Alternatively, if a local area uses 10 - digit dialing, a user has to put in an area code plus the 
7 - digit phone number. As you can see, by setting up the dialing rules ﬁ rst, you keep your 
users from having to enter numbers such as 1 before the area code. 
Configuring Fax Services 
949

950 
Chapter 23 ■ Configuring Additional Communication Services
 Then you can conﬁ gure the following options for dialing rules:
  Dialed Number   You can enter a region code and an area code.  
  Target Device   Choose to apply your rule to devices.  
 To conﬁ gure these options follow the steps in Exercise 23.3.  
 E X E R C I S E  2 3 . 3
Configuring a Dialing Rule 
 1. 
  Under Fax Server in Server Manager, expand Outgoing Routing.  
 2. 
  Right - click Rules and choose New   Rule.  
 3. 
  In the Dialed Number section of the Add New Rule dialog box, enter your region code. If 
you are unsure, click Select and then choose from the list.  
 4. 
  In the Target Device section, choose whether you want this rule to apply to a device or a 
routing group, and then choose from the list in the drop - down box.  
 5. 
  Click OK. 
 Defining a Fax Routing Location 
 As the administrator, you can conﬁ gure both the incoming and outgoing fax routes. You 
can route incoming faxes to a particular user group or an individual user. In the Fax Service 
Manager, you can conﬁ gure routing extensions that are global, which means they ’ re applied 
to all devices, and you can conﬁ gure others that are associated with only individual devices. 
 For global methods, you can set the order in which they are applied to a received fax. 
For example, you could have a fax routed ﬁ rst to an email address, then printed, and then 
stored in a folder. For individual routing methods, these are conﬁ gured per device. After 
you conﬁ gure a method, it can be enabled or disabled. More than one incoming route can 
be applied to a fax. 
 You can conﬁ gure the following default incoming routing methods:
 Route Through E - Mail   You can specify the address for receiving incoming faxes.  
  Store In Folder   Choose the folder to store a copy of the incoming fax.  
  Print   Deﬁ ne the path to which you want the incoming fax printed.  
 For outgoing faxes you can also create rules, which will allow you to optimize the use 
of available fax devices. You can create rules that get associated with a device or group of 
devices and have faxes sent to a speciﬁ c domestic area code or speciﬁ c region. 
 For example, if you have many faxes that go to a vendor in China, you can create a rule 
that will send faxes to this vendor from a speciﬁ c device. Meanwhile, your other devices 
can continue to service other areas or regions and not be affected by the heavy fax trafﬁ c to 
China. 

Configuring a Media Server 
951
 Using rules will help ensure that your fax resources are being used efﬁ ciently instead of 
having your faxes sit in long queues.  
 Configuring a Media Server 
 The Fax Server role is not the only valuable service that Windows Server 2008 R2 can 
provide. A Windows Media server (see Figure 23.2) can improve communication and 
instruction in an organization.  
 F I G U R E 2 3 . 2 Windows Media server 
 A Windows Media server delivers digital media to clients across a network using 
Windows Media Services 2008 R2. What this service does is translate a client ’ s request for 
media into a physical path on the server that is hosting the content. 
 It will provide advanced features such as multicast streaming when installed on the 
following operating systems: 
 Windows Server 2008 R2 Enterprise  
 Windows Server 2008 Enterprise  
 Windows Server 2008 R2 Datacenter  
 Windows Server 2008 Datacenter  
■
■
■
■

952 
Chapter 23 ■ Configuring Additional Communication Services
 Table 23.1 provides an overview of available features based on what server version is 
installed.  
 TA B L E 2 3 .1 Media Services features 
 Feature  
 Windows Server 2008 and 
2008 R2 Standard and Web 
 Windows Server 2008 and 
2008 R2 Enterprise and 
Datacenter  
  Absolute Playlist Time  
  Yes  
  Yes  
  Advanced Fast Start  
  Yes  
  Yes  
  Advanced FF/RW  
  No  
  Yes  
  Advertising Server Support  
  Yes  
  Yes  
  Broadcast Auto - Start  
  Yes  
  Yes  
  Cache/Proxy  
  Yes  
  Yes  
  Custom Plug - In  
 Yes  
  Yes  
  Event - Based Scripting  
  Yes  
  Yes  
  Fast Cache  
  Yes  
  Yes  
  Fast Reconnect  
  Yes  
  Yes  
  Fast Start  
  Yes  
  Yes  
  Fast Streaming  
  Yes  
  Yes  
  Internet Authentication  
  Yes  
  Yes  
  Internet Group Management  
  No  
  Yes  
  IPv6  
  Yes  
  Yes  
  Intranet Authentication  
  Yes  
  Yes  
  Multicast  
  No  
  Yes  
  Multiple Authorization  
  Yes  
  Yes  
  Multiple Control Protocol  
  Yes  
  Yes  

Configuring a Media Server 
953
 The Streaming Media Services role is not included in the Windows Server 2008 R2 
operating system. This role includes the latest version of Microsoft Windows Media 
Services, Windows Media Services 2008 for Windows Server 2008 R2. 
 To obtain Windows Media Services 2008 for Windows Server 2008 R2, you must 
obtain and then run the Microsoft Update Standalone Package (MSU) ﬁ le for the Streaming 
Media Services role. You must download this service add - in from Microsoft ’ s website at 
 http://www.microsoft.com/downloads/en/details.aspx?FamilyID=b2cdb043-d611-
41c9-91b7-cddf6e5fdf6b . 
 Before installing Media Services, be sure the server meets the following system 
requirements: 
 Processor: One or more processors with a recommended speed of 550MHz; minimum 
supported speed is 133MHz.  
 Memory: 512MB of RAM, minimum of 256MB.  
 Hard disk space: 2GB of free space.  
 File system conﬁ guration: NTFS.  
 Configuring Basic Streaming Solutions 
 When you think about streaming media basics, you might have a few questions: 
 What is streaming media?  
 How do I create content?  
 How do I make this content available to my users?  
■
■
■
■
■
■
■
 Feature  
 Windows Server 2008 and 
2008 R2 Standard and Web 
 Windows Server 2008 and 
2008 R2 Enterprise and 
Datacenter  
 Multiple Media Parser  
  Yes  
  Yes  
 Multiple Playlist Parser  
  Yes  
  Yes  
 Play While Archiving  
  No  
  Yes  
 RTSP Streaming  
  Yes  
  Yes  
 Robust Event Notification  
  Yes  
  Yes  
 Repacketization  
  Yes  
  Yes  
 Unicast  
 Yes  
  Yes  

954 
Chapter 23 ■ Configuring Additional Communication Services
 The following sections will answer those questions and show you how to conﬁ gure the 
basic options. 
 What Is Streaming Media? 
 What is streaming media? It ’ s any media that is displayed to the end user while it ’ s being 
delivered by a provider. It can be live or prerecorded, and unlike a ﬁ le that you might 
download, no data is saved to the user ’ s hard disk when the content has ﬁ nished streaming. 
Like television or radio, the term  streaming media  refers more to the delivery method 
than to the actual medium itself. Attempts to display media this way date back to the mid -
 1990s, but little progress was made for a long time due to the limits in computer hardware 
and networks.  
 How Do I Create Content for My Users? 
 Windows Media Encoder, Microsoft Producer, and Windows Movie Maker can create and 
compress your audio and video content into the Windows Media format so you can create 
content for users. Table 23.2 shows the tools that are available from Microsoft.  
 TA B L E 2 3 . 2 Tools to create content 
  Tool  
  Description  
  Windows Media Player  
  Rip content from a CD. 
  Windows Media Encoder  
  Convert live and recorded content.  
  Windows Movie Maker  
  Use for simple editing of audio and video. 
  Windows Media Stream Editor  
  Combine or split streams in existing Media files.  
 Many third - party programs in addition to the ones listed in Table 23.2 
will allow you to encode media as a Windows Media file. Check with your 
vendor for details on how to perform the encoding. 
 How Do I Make This Content Available to My Users? 
 Now you understand what streaming media is and how to create it, but how do you make 
it available to your users or clients? Simply put, you place the content into a directory, 
create a reference point called a publishing point for the content, and then create an 
announcement to tell your users about the content. Windows Media Services uses these 
publishing points to tell a client how to reach the content. After that, the media server 
manages the connection and streams the content. 

Configuring a Media Server 
955
 There are two types of publishing points: broadcast and on - demand. You can use two 
methods to get the content to your users: unicast stream and multicast stream. 
 In this section, we will look at four basic areas that will allow you to get the content to 
your users: 
 Using broadcast publishing points  
 Using on - demand publishing points  
 Delivering content as a unicast stream  
 Delivering content as a multicast stream  
 Let ’ s ﬁ rst look at broadcast publishing points. If you are looking for a solution to 
provide content similar to a television or radio show, then you will choose broadcast 
publishing. This allows the server to control the content. Most of the time, this would be 
what you see in a live broadcast of a company meeting. 
 Because the session is controlled at the server, a user can join the session and hear 
the content but cannot rewind or fast forward. Therefore, users have no control over the 
session; they can only start and stop the feed. 
 Using on - demand publishing points, users are able to stream a video ﬁ le whenever they 
want. This means that the content is streamed to the client only when they are connected, 
and therefore the server has a separate connection with each client. This is best used when 
you want your clients or users to be able to have more control over the session. 
 With on - demand publishing, users can stop, rewind, pause, fast - forward, or skip the 
content at their leisure. When would this be used? Many organizations like to record 
training materials that they want the users or instructors to be able to control. On - demand 
publishing would be a good ﬁ t for this type of use.  
 On - demand publishing points can also be used to stream media from a 
remote server or another publishing point. These can be part of a playlist 
or just content on another server. However, when the media resides on 
another server, the users will not be able to use the playback controls, such 
as pause, fast - forward, skip, and rewind. 
 By default, Windows Media Services uses unicast streaming. The stream is a one - to -
 one connection between the server and the client. Only those clients that request a speciﬁ c 
stream will receive it. You can use both on - demand and broadcast publishing points. 
 The beneﬁ t of using this type of streaming is that it is easier to set up and will work in 
environments that are not set up for multicast streaming. The drawback of unicast is that 
because it ’ s a one - to - one connection, it will be limited by the speed of the server and the 
network. If your content is going to be viewed simultaneously by a large number of clients, 
you will want to monitor your server to ensure that it is not overwhelmed. 
 You would want to consider using unicast if the following applies to you: 
 You require a detailed client log.  
 Your audience is small or the content is small enough to be compatible with your 
network and server.  
 Your network is not multicast enabled.  
■
■
■
■
■
■
■

956 
Chapter 23 ■ Configuring Additional Communication Services
 Multicast is the ability to stream media from a single server to many clients at the 
same time. The server streams the content to a multicast IP address on the network, and 
all clients receive the same stream by using that IP address. Unlike unicast streaming, 
multicast streaming can be done only from a broadcast publishing point. 
 The hardware and network must be multicast enabled; they have to be able to transmit a 
Class D IP address ( 224.0.0.0 to  239.255.255.255 ). If you are unsure if the network hardware, 
like routers and ﬁ rewalls, can transmit this type of address, check with your hardware vendors 
before attempting a multicast stream. 
 The beneﬁ t of using this type of streaming is that if the network allows, there is only one 
stream from the server no matter how many clients you have; it requires the same amount 
of bandwidth as a unicast stream. This will preserve network bandwidth and can be used if 
your network bandwidth is low. 
 One advantage of using Microsoft Media Services is that the media services include Real 
Time Streaming Protocol (RTSP). RTSP is a protocol designed for use in media services to 
control streaming media servers. 
 The RTSP protocol is used for establishing and controlling media sessions between end 
points. Clients of media servers issue commands, such as play and pause, to allow for real -
 time control of playback of media ﬁ les from the server. 
 In Exercise 23.4, you will learn how to install and create a broadcast publishing 
point, and then in Exercise 23.5, you will conﬁ gure a multicast stream from that publishing 
point.  
 Before completing these exercises, you must download the Microsoft Update 
Standalone Package (MSU) file for the Streaming Media Services role.  
 E X E R C I S E  2 3 . 4
Installing and Creating a Broadcast Publishing Point 
 1. 
  Open Server Manager, click Roles, and then click the Add Role Link. 
 2. 
  Check the Streaming Media Services check box. Click Next. 
 3. 
  Click Next at the Introduction screen. 
 4. 
  Accept the default Role Services and click Next. 
 5. 
  At the Data Transfer Protocol screen, check the Real Time Streaming Protocol (RTSP) 
check box and click Next. 
 6. 
  At the Conﬁ rmation screen, click Install. 
 7. 
  In Server Manager, expand Roles   Streaming Media Services    <server name>   
Publishing Points.  
 8. 
  Right - click and choose Add Publishing Point (Wizard).  
 9. 
  On the Welcome To The Add Publishing Point Wizard screen, click Next.  

Configuring a Media Server 
957
 10.   Now choose a name for the publishing point and click Next. 
 11.   On the following page, choose the option that ﬁ ts your content type and then click Next.  
 12.   Choose Files on the Content Type screen and then click Next. 
 13.   At the Publishing Point Type screen, choose Broadcast Publishing Point. Click Next.  
 14.   On the Delivery Option type screen, choose Unicast and click Next.  
 15.   On the Directory Location screen, accept the defaults and click Next. 
 16.   On the Content Playback screen, choose all options and click Next. 
 17.   Check Enable Logging For This Publishing Point, if you want to log data about the clients 
that are connecting. Click Next. 
 18.   On the Summary page, review the selections, and if you want to publish this content right 
away, check Start Publishing Point When Wizard Finishes. Click Next and click Finish. 
 19.   Since the Unicast stream option was chosen, the Unicast Announcement Wizard 
appears. Click Next. 
 20.   Review the Access To The Content page to ensure that the URL is pointing to the 
publishing point that was created. If it is not correct, click Modify and enter the server 
name or IP address.  
 21.   On the Save Announcement page, make sure the announcement ﬁ le is correctly 
pointing to the publishing point that was created earlier. If not, click the Browse button 
and choose the location of the ﬁ le. Click Next.  
 22.   Edit any metadata on the next screen, where you can add a title, author name, and a 
copyright notice to the ﬁ le. When ﬁ nished, click Next.  
 23.   Click Finish.  
 24.   If everything completed successfully, you will be able to test your new content at the 
next screen; then click Exit. 
 Now that you have created the broadcast publishing point, you want to change the 
streaming type to make it a multicast stream, which will conserve network bandwidth and 
server load, as shown in Exercise 23.5. 
 E X E R C I S E  2 3 . 5
Configuring a Multicast Stream 
 1. 
  In Server Manager, expand Roles   Streaming Media Services    < server name >   
Publishing Points.  
 2. 
  Choose the publishing point you created in Exercise 23.4.  
 3. 
  In the Content pane, click the Properties tab. 

958 
Chapter 23 ■ Configuring Additional Communication Services
E X E R C I S E  2 3 . 5  (c o n t i n u e d)
 4. 
  In the Category section, choose Multicast Streaming. 
 5. 
  In the Plug - In section, choose WMS Multicast Data Writer and then right - click and 
choose Properties.  
 6. 
  In the Destination Multicast IP Address And Port section, specify the following 
settings:  
 IP Address: Type in the multicast address. 
 Port: This is the port from which the content will be streamed.  
 Time - To - Live (TTL): Here you enter the number of routers your multicast stream 
can pass through before timing out. 
 7. 
  Click the Advanced tab if you have multiple network adapters on your server.  
 8. 
  Choose the IP address you want to use in the drop - down box.  
 9. 
  In the Logging URL box, enter the URL to the logging directory and click OK. 
 10.   To start this publishing point, right - click it and choose Start. 
 Configuring Advanced Streaming Solutions 
 Windows Media Services allow you to control most aspects of how you stream content 
to your users. If you just need to get a small video out to a limited number of users, the 
default settings will most likely accomplish the task. However, if you have a media server 
that gets a lot of trafﬁ c, it might be to your beneﬁ t to change some of the more advanced 
options. 
 In this section, we will review two areas: 
 Intelligent streaming  
 Fast streaming  
 The method of Windows Media Player that your server uses to automatically detect 
and adjust the properties of a stream is called  intelligent streaming . This type of streaming 
allows for a continuous ﬂ ow of content that is set according to the user ’ s connection speed. 
A user ’ s media player will respond to having low bandwidth by requesting that the server 
reduce the bit rate. For the most part, intelligent streaming is completely automatic and 
requires no additional conﬁ guration. 
 Fast streaming refers to a group of features that Windows Media Services includes to 
improve the quality of the user ’ s session: 
 Fast Cache 
 Advanced Fast Start 
■
■
■
■
■
■
■

Configuring a Media Server 
959
 Fast Recovery  
 Fast Reconnect 
 Fast Cache 
 Fast caching is a way for the Windows Media Services and Windows media players 
to stream the content to the clients faster than the speciﬁ ed rate. So if you have a 128 
kilobits per second (Kbps) stream, using Fast Cache you can stream it at 700 Kbps. This is 
accomplished by streaming the content to the client machine, and then the Windows Media 
Player is able to buffer it before playing at the speciﬁ ed data rate. 
 This is extremely useful when streaming over wireless networks that have high latency 
or when the quality of the content received is of top priority.  
 When Fast Cache is enabled, intelligent streaming cannot be used. In 
addition, Fast Cache is used only by clients that connect to a unicast stream. 
 Exercise 23.6 shows you how to enable Fast Cache.  
 E X E R C I S E  2 3 . 6
Enabling Fast Cache 
 Do the following to enable Fast Cache: 
 1. 
  In Server Manager expand Roles   Streaming Media Services   Windows Media 
Services    < server name>   Publishing Points.  
 2. 
  Choose your broadcast and click the Properties tab in the Content pane.  
 3. 
  Now choose General in the Category section. 
 4. 
  In the Property section, right - click Enable Fast Cache and choose Enable.  
 Advanced Fast Start 
 Advanced Fast Start is used for reducing startup times in Windows Media Player 10 and 
higher. It has all the same features and beneﬁ ts as Fast Start but can start to play a stream 
before its buffer is full, unlike the Fast Start option, which makes the user wait until the 
buffer is full. 
 With Advanced Fast Start, as soon as the player receives the minimum amount of data, 
playback will begin. While the content is being played, the buffer will continue to ﬁ ll at 
an advanced rate until full. Once the buffer is full, the acceleration stops and the stream 
continues to be received and played at its speciﬁ ed rate. Advanced Fast Start must be 
enabled because it is disabled by default (see Exercise 23.7).  
■
■

960 
Chapter 23 ■ Configuring Additional Communication Services
 E X E R C I S E  2 3 . 7
Enabling Advanced Fast Start  
 1. 
  In Server Manager, expand Roles   Streaming Media Services    <server name>   
Publishing Points.  
 2. 
  Choose the broadcast and click the Properties tab. 
 3. 
  Choose General in the Category section. 
 4. 
  In the Property section, right - click Enable Advanced Fast Start and choose Enable.  
 Fast Recovery and Fast Reconnect 
 Fast Recovery and Fast Reconnect are similar in that they allow a media player to resume 
in case of corruption or network outage. 
 Fast Recovery is used when a media player receives lost or damaged data packets. 
If this occurs, the player does not have to request that the server resend the data. It can 
recover the lost or damaged data itself. To utilize this feature, you should enable forward 
error correction (FEC) on a publishing point. Enabling FEC will help in networks where 
packet loss or corruption frequently occurs, such as wireless networks and satellite 
connections. 
 Exercise 23.8 shows you how to enable FEC on a publishing point.  
 E X E R C I S E  2 3 . 8
Enabling FEC 
 1. 
  In Server Manager, expand Roles   Streaming Media Services    <server name >   
Publishing Points.  
 2. 
  Choose your broadcast and click the Properties tab.  
 3. 
  Now choose Wireless in the Category section. 
 4. 
  Right - click Enable Forward Error Correction and choose Enable.  
 Fast Reconnect will reconnect a media session in case of temporary network outage. 
When a client loses its connection to a media server, Fast Reconnect enables the client to 
reconnect to the server automatically and restart the streaming. How it affects the playback 
to the user depends on following two factors:
 Connected to an On - Demand Publishing Point   The client restarts the playback at the 
point the connection was lost.  

Configuring a Media Server 
961
 Connected to a Broadcast Publishing Point   Client reconnects to the broadcast in 
progress. The user may experience a gap in the broadcast.  
 In Exercise 23.9, you ’ ll set the number of times a client can attempt a reconnect.  
 E X E R C I S E  2 3 . 9
Setting Client Connect Attempts 
 1. 
  In Server Manager, expand Roles   Streaming Media Services    < server name>   
Publishing Points.  
 2. 
  Choose Sample Broadcast and click the Source tab. 
 3. 
  In the Content Source section, choose Change. 
 4. 
  In the Location box, add    ?WMReconnect=3  to the end of your location. This will allow the 
clients to attempt a reconnect three times. 
 5. 
  Click OK.  
 Options for Configuring Security 
in a Windows Media Server 
 The content you provide to your users can be very valuable to your organization. Much 
time and money has been spent to create this content, and one of the more important tasks 
that you can do is control access to it. It is therefore important that you conﬁ gure the 
security options of your media server. This will ensure that your company ’ s valuable media 
is protected from unauthorized access. 
 The following sections will cover these topics: 
 Authentication  
 Authorization  
 Authentication 
 Authentication conﬁ rms the identity of a user who is trying to gain access to a resource. 
After a user is authenticated, authorization occurs so that the user gains proper access to 
the content. When the user attempts to gain access, the server attempts to authenticate 
through the anonymous authentication plug - in. 
 You would use this type of anonymous authentication if you do not want the users to 
have to enter a username and password. This is conﬁ gured by default, but if you want 
to change the Anonymous account, you must make sure the account you use has read 
permissions for any ﬁ les and folders that will be streamed. 
■
■

962 
Chapter 23 ■ Configuring Additional Communication Services
 In Exercise 23.10, you ’ ll change the Anonymous account.  
 E X E R C I S E  2 3 .1 0
Changing the Anonymous Account 
 To change the Anonymous account, follow these steps: 
 1. 
  In Server Manager, expand Roles   Streaming Media Services    <server name>   
Publishing Points.  
 2. 
  Choose your broadcast and click the Properties tab.  
 3. 
  In the Category section, click Authentication.  
 4. 
  In the Plug - In section, right - click WMS Anonymous User Authentication.  
 5. 
  Click the Properties link. 
 6. 
  In the User Name box, type the account name you want anonymous users to use.  
 7. 
  In the Password box, enter the password for the account. 
 8. 
  In the Conﬁ rm box, reenter the password. 
 9. 
  Click OK. 
 10.   Right - click WMS Anonymous User Authentication and choose Enable.  
 Authorization and Authentication work hand in hand to grant access to 
the media on your server. If Authorization is enabled but Authentication is 
disabled, clients cannot access the server. 
 Authorization 
 Authorization takes information it receives from the authentication process and uses it 
to grant or deny access to the content. Authorization occurs only after authentication is 
successful. During this process, the server checks the user against the access permissions set 
on the resource. 
 Authorization uses the following two plug - ins:
  WMS IP Address Authorization   You can allow or deny access based on IP address. 
  WMS Publishing Points ACL Authorization   You can create access control lists (ACLs) for 
your publishing points and assign access permissions to users or groups.  
 To allow or deny access by IP address, you need to conﬁ gure the WMS IP Address 
Authorization plug - in (see Exercise 23.11). 

Configuring a Media Server 
963
 E X E R C I S E  2 3 .11
Allowing or Denying IP Addresses 
 To allow or deny IP addresses, follow these steps: 
 1. 
  In Server Manager, expand Roles   Streaming Media Services    <server name>   
Publishing Points.  
 2. 
  Choose the broadcast and click the Properties tab. 
 3. 
  In the Category section, click Authorization.  
 4. 
  Right - click WMS IP Address Authorization and choose Properties.  
 5. 
  Now choose one of the following options: 
 Allow All Except Those In The Deny List  
 Deny All Except Those In The Allow List  
 Restrict As Speciﬁ ed In The Following List 
 6. 
  After making your choice and ﬁ lling in the IP addresses, click OK. 
 At times you will want to create ACLs for publishing points on your server. Conﬁ guring 
the ACL will allow you to grant or deny access to users or clients. Exercise 23.12 walks you 
through creating an ACL.  
 E X E R C I S E  2 3 .1 2
Creating an ACL 
 An ACL can be conﬁ gured by following these steps: 
 1. 
  In Server Manager expand Roles   Streaming Media Services   <server name >   
Publishing Points.  
 2. 
  Choose your broadcast and click the Properties tab.  
 3. 
  In the Category section, click Authorization.  
 4. 
  Right - click WMS Publishing Points ACL Authorization and click Properties.  
 5. 
  On the Properties dialog box, you can do the following:  
 Add or remove a user or group. 
 Set permissions for a new user or group. 
 Change the permissions for a group. 
 6. 
  Click OK.  
■
■
■
■
■
■

964 
Chapter 23 ■ Configuring Additional Communication Services
 Web - Based Administration 
 Web - Based Administration allows you to remotely maintain and conﬁ gure a Windows Media 
Server. To use this service, you must install the additional Windows Media Server role. 
 In Exercise 23.13, we will install the Web - Based Administration role on the Windows 
Server 2008 R2 machine.  
 E X E R C I S E  2 3 .1 3
Installing the Web - Based Administration role  
 1. 
  Open Server Manager and click Roles.  
 2. 
  In the Roles pane, scroll down to Streaming Media Services. 
 3. 
  Choose Add Role Services.  
 4. 
  Check the Web - Based Administration check box.  
 5. 
  In the Add Roles Services dialog box, choose Add Required Role Services. Click Next. 
 6. 
  At the Introduction screen, click Next. 
 7. 
  At the Select Role Services screen, click Next. 
 8. 
  Click the Install button. 
 9. 
  After the installation, click Close. 
 The Remote Server Administration Tools feature in Server Manager provides role 
administration tools that let administrators remotely manage servers that are running 
Windows Server 2008 R2. You can install Remote Server Administration Tools for 
the Streaming Media Services role on a computer that is running Windows 7 Ultimate, 
Windows 7 Enterprise, or Windows 7 Professional. 
 To download the Remote Server Administrator Tools for Streaming Media Services, 
go to Microsoft ’ s Download site at  http://www.microsoft.com/downloads/details
.aspx?FamilyID=6408ec89-4326-48d0-9b5a-4ac7d31a50c0 . 
 Configuring Digital Rights Management 
 Digital Rights Management, or DRM, is a technology that allows the owner of some forms 
of media to enforce the terms to the people who have access to use it. Those who own the 
copyright to music, ﬁ lm, books, and video commonly use DRM to protect their property. 
 You or your company may own media that you deliver on your media server or provide 
in email or SharePoint sites. It ’ s important to protect it. It is common for conﬁ dential and 
critical information to be sent from one company to a competing company or media outlet. 
This can cause public relations, legal, or competition problems for an organization.  

 DRM Controversy 
 Much debate has sprung from companies using DRM to protect the media they own. This 
is especially true of the entertainment industry. Over the past ﬁ ve years, controversy 
over audio ﬁ les such as MP3s — more speciﬁ cally, the sharing of these ﬁ les — has lead the 
industry to adopt DRM protection. 
 Those in favor of DRM state that it is necessary for the copyright holders to be able to 
prevent others from duplicating and sharing their work illegally. Those opposed take the 
stand that as long as they are not using the media in a way that would violate commercial 
use, they should not have restrictions on content that they have purchased. 
 Despite the controversy around DRM, companies like Apple and Microsoft continue to 
use this form of protection. It allows the companies to provide content, such as music, on 
a subscription basis. Some companies are listening to the cries of the users and are now 
are providing content that is DRM free. 
 As bandwidth speeds increase to consumers ’ homes, the availability of video and movies 
appears to be heading to a similar pay - per - view model. Will DRM continue to be a 
method to protect the rights of those who create or publish the content? Time will tell. 
 Although music and videos are often in the middle of this controversy, many companies 
are adopting DRM to protect internal documentation from prying eyes. 
 How Does DRM Work? 
 When media is created, it is encrypted in order to protect it. For a user to access this 
encrypted media, they have to have a license. This license contains information such as the 
following: 
 How long the content can be used  
 What actions can be done on the media  
 Simply put, the license or key unlocks the content and allows it to be played. The nice 
thing about DRM is that you get to control how long it will be unlocked. For example, 
say you want to provide content as a promotion that lasts only ﬁ ve days. With DRM 
protection, you can set the key to expire in ﬁ ve days. With DRM you don ’ t have to worry 
about users copying material and giving it to others because no matter who plays the 
content, they still need to acquire a key or license. 
 DRM rights are stored in the key and not the content. This means that you can create 
different keys for the same ﬁ le. A normal DRM scenario would be that you encode content 
with DRM protection. Then it would be posted so that users could download it. After 
■
■
Configuring Digital Rights Management 
965

966 
Chapter 23 ■ Configuring Additional Communication Services
the content is downloaded, the user ’ s player sees that it is protected and connects to your 
license provider site to get the needed key. After the user pays for the key, they are able to 
play the content. 
 DRM also can be used to protect other types of ﬁ les: 
 Ofﬁ ce documents  
 Email  
 Word, Excel, PowerPoint, and other important company ﬁ les can be protected using 
Active Directory Rights Management Service (AD RMS). A typical example would be 
using a SharePoint intranet that has or allows external users to view content. 
 The following sections assume that you have installed the AD RMS role and have 
reviewed the event log for any errors.  
 Encryption 
 Before the Internet boom, encryption was mainly used by the military to protect data. 
However, today encryption is a normal and needed protection against theft of content or 
documents. 
 What is encryption? It is locking up data through the use of electronic keys. It is similar 
to locking the doors on your home. You need a key to lock and unlock your door locks. It 
is doubtful you would ever consider having a home without any locks or leaving the doors 
open and going away for six months. 
 If you did, you wouldn ’ t be surprised if your valuables were stolen. Some people even 
pay large amounts of money to purchase high - end security alarms to ensure that they have 
the best protection for their home. The same is true of your data; without locking it with a 
lock and key, you are inviting anyone to take it. 
 AD RMS encrypts data by keeping out people who do not have proper keys. With AD 
RMS, only trusted entities are granted access rights, just like giving someone you trust a 
key to your home. 
 In addition to the AD RMS clients installed on a computer, AD RMS can be used in 
specialized applications, enabled to enforce the usage rights. The following applications are 
AD RMS–enabled: 
 Microsoft Ofﬁ ce 2003  
 Ofﬁ ce 2007  
 Ofﬁ ce 2010  
 Windows Mobile 6 or higher  
 The AD RMS client is included with Windows Vista, Windows 7, Windows Server 2008, 
and Windows Server 2008 R2. If you are using Windows 2000 Server, Windows XP, or 
another operating system, you can download the AD RMS client from the Microsoft 
Download Center at  www.microsoft.com/downloads/details.aspx?FamilyId=
02DA5107-2919-414B-A5A3-3102C7447838 & displaylang=en . 
■
■
■
■
■
■

 For AD RMS to encrypt your data, you need to both have the AD RMS client installed 
and have an AD RMS – enabled application. However, to be able to create protected content 
you need to have the following: 
 Ofﬁ ce 2010 Professional Plus  
 Ofﬁ ce 2010 Professional  
 Ofﬁ ce 2007 Enterprise  
 Ofﬁ ce 2007 Professional  
 Ofﬁ ce 2007 Ultimate  
 Exercise 23.14 demonstrates how to create a protected document.  
 E X E R C I S E  2 3 .1 4
Using AD DRM to Protect a Document  
 1. 
  Open Microsoft Word 2010.  
 2. 
  Open a document you want AD RMS to protect.  
 3. 
  Click the Microsoft button in the top - left corner of the screen. 
 4. 
  Choose Prepare.  
 5. 
  Choose Restrict Permissions.  
 6. 
  Choose Restrict Access. 
 7. 
  Now choose Restrict Permission To This Document. 
 8. 
  In the Read box, type in the name of the group that you want to allow read permissions.  
 9. 
  Now save this document in your network location.  
 The group you speciﬁ ed can only view this document now. They will not be able to change, 
print, or even copy it. 
 Sharing Business Rules 
 Business rules are no different than policies. Business rules allow you, the administrator, to 
tell the user or client how they can use protected content. 
 Once you have created and protected your content, it is time to distribute it. For others 
to be able to view the content, they need access to your business rules. This means that 
you have to share your business rules with the license issuer. In this case, the license issuer 
would be your AD RMS server, so it would need to have access to these rules or policies. 
 Business rules can consist of the following: 
 Seed  
 Public key  
 Speciﬁ c rules  
■
■
■
■
■
■
■
■
Configuring Digital Rights Management 
967

968 
Chapter 23 ■ Configuring Additional Communication Services
 When you create protected content, you will choose a set of rules to do the following: 
 Specify when the document expires  
 Allow printing  
 Allow copying 
 Specify whether users can request additional permissions  
 Give users and groups permissions to the document  
 This information gets stored within a license and is considered a rule because it states 
what the user can or cannot do. If you create the permission in an AD RMS application, 
such as Microsoft Word, your client machine has the rules. Now when you save the data, 
the rules are shared with the RMS server. 
 Sharing business rules is something that happens automatically when you create 
protected content in an environment where AD RMS is running. Sharing is done between 
the client and the server and requires no interaction from the user or administrator 
unless the content business rule requires the user to pay for the use.  
 Configuring License Delivery 
 When a user tries to open a ﬁ le that is protected by AD RMS, it requests a license. The AD 
RMS server must look up the license information and then pass that along to the client. 
This allows the client to play the protected content. 
 This means that the user must have access to the license server to receive the license. 
You can control who has access to receive the license by conﬁ guring the exclusions policies 
(Exercise 23.15).  
 E X E R C I S E  2 3 .1 5
Configuring Users ’ Exclusions  
 1. 
  Open the Active Directory Rights Management Services console by choosing Start   
Administrative Tools   Active Directory Rights Management Services. 
 2. 
  Expand the local server and select Exclusion Polices.  
 3. 
  From here you have the option to exclude the following:  
 Users  
 Applications  
 Windows versions  
 Lockbox  
 4. 
  To exclude users, ﬁ rst right - click Users in the left pane and choose Enable.  
 5. 
  In the Actions pane, choose Exclude User. 
■
■
■
■
■
■
■
■
■

 6. 
  In the Exclude User Wizard that opens, check the box Use This Option For Excluding 
Rights Accounts Certiﬁ cates Of Internal Users Who Have An Active Directory Domain 
Services Account.  
 7. 
  Enter the username of the account you want to exclude from having access to the 
license server. 
 8. 
  If you ’ re unsure of the username, click the Browse button and choose the user account. 
 9. 
  After entering the username, click Finish. 
 You can also exclude certain applications from receiving access to the license server. 
This is useful when you want users to be able to receive access to content such as Word, 
Excel, and PowerPoint documents but do not want them to be able to use a media player to 
play media content in the protected library. 
 Exercise 23.16 shows you how to exclude an application.  
 E X E R C I S E  2 3 .1 6
Configuring Application Exclusions  
 1. 
  Open the Active Directory Rights Management Services console by clicking Start   
Administrative Tools   Active Directory Rights Management Services. 
 2. 
  Expand the local server and select Exclusion Polices.  
 3. 
  In the Content pane, right - click Applications and choose Enable.  
 4. 
  In the Actions pane, click Exclude Applications. 
 5. 
  On the Exclude Application page, enter the application ﬁ lename and versions you want 
to exclude.  
 6. 
  Click Finish.  
 Configuring Policy Templates 
 Policy templates help administrators set a standard for user access when it comes to 
content. In the past, this would have been done with NTFS rights and folders. Before AD 
RMS and DRM, administrators would create a network folder and then set access control 
rights on the folder. With AD RMS, you can reduce your workload and have users assign 
this control themselves. For example, policy templates can make sure that users do not 
remove the administrator ability to move, copy, or back up the content. 
 While creating policies is a relatively simple process, care is needed to ensure that your 
templates meet your users ’ needs. This will require that you spend some time with your 
Configuring Digital Rights Management 
969

970 
Chapter 23 ■ Configuring Additional Communication Services
users and try to understand the needs of your company. Here are some of the things you 
want to consider: 
 Needs of individual users  
 Needs of groups of users  
 Department access  
 Client access  
 How this affects network administrators  
 After spending time ﬁ guring out your company ’ s requirements, you can create policy templates 
so that when users create protected content, they can select your preconﬁ gured templates. 
 Templates can be made available for users who might not be connected to the network 
when they create their content. This is accomplished by deploying your templates from a 
shared folder. The AD RMS client will then store copies of the policies on the local machine. 
This still allows you to change a policy that is in a shared folder, and then when the AD 
RMS client (which is installed on the client machines) polls the AD RMS server, it will detect 
that a change has occurred in the templates and download it to the local machine. 
 To conﬁ gure policy templates, open the Active Directory Rights Management Services 
console by choosing Start   Administrative Tools   Active Directory Rights Management 
Services. Then follow the steps in Exercise 23.17.  
 E X E R C I S E  2 3 .17
Configuring Policy Templates  
 1. 
  Expand the local server. 
 2. 
  Choose Rights Policy Templates.  
 3. 
  In the Actions pane, choose Create Distributed Right Policy Template.  
 4. 
  In the Template Identiﬁ cation page, click Add.  
 5. 
  In the Name box, enter the name for this policy.  
 6. 
  In the Description box, enter a description for this policy. 
 7. 
  Click Add. 
 8. 
  Back at the Template Identiﬁ cation page, click Next.  
 9. 
  On the Add User Rights page, add the users and permissions required. 
 10.   When ﬁ nished, click Next.  
 11.   Next, you are able to specify an expiration policy. Enter the dates, if any, on which you 
want the content being protected by this policy to expire.  
 12.   Click Next.  
 13.   On the Specify Extended Policy page, choose any additional conditions that you require 
for this template.  
■
■
■
■
■

 14.   Click Next.  
 15.   In the Specify Revocation Policy page, check the box next to Require Revocation if 
you need to deny permission based on other factors. Those factors can include users, 
application, content ID, or operating systems. 
 16.   Click Finish to create the template.  
 Summary 
 Fax services are still a solution that companies, big and small, rely on to maintain and 
increase business. It is important that you do not overlook this technology. Spending 
time to conﬁ gure routing rules will increase the productivity of your users because it can 
automate the process of scanning, emailing, and ﬁ ling faxes. 
 After spending time understanding Windows Media Services, you should have an 
appreciation for how it can help an organization to create, distribute, and publish content. 
Many options exist beyond the basics. Looking at the advanced options helped you to 
understand that you can optimize the way you deliver the content to the user. 
 Digital Rights Management is something to take seriously in this day and age. If you 
don ’ t protect your data, chances are someone will acquire it. Protecting data is just smart 
management. AD RMS allows an administrator to protect ﬁ les such as those created in 
Word, Excel, and PowerPoint. 
 This is a great feature in Windows Server 2008 R2; allowing users to protect data stored 
on a network share was something that administrators were reluctant to do. This was 
typically something that administrators would perform themselves. Now with AD RMS and 
policy templates, administrators can create a policy for protection and access control, and 
the end user can apply that to their content, thus freeing up IT staff to perform other tasks.  
 Exam Essentials  
 Understand fax server options.   Review how to conﬁ gure dialing rules and routing rules. 
Understand how to set up a local fax and how to conﬁ gure its properties.  
 Know how to configure basic media streaming solutions.   It is important that you know 
when to use multicast and when to use unicast streaming, what publishing points are, and 
the difference between broadcast and on - demand publishing and when to use each.  
 Understand advanced options for media streaming.   Understand topics such as fast 
caching, intelligent streaming, and Fast Reconnect.  
 Know how DRM and AD RMS protect content.   Review all forms of rights protection. 
Understanding terms like  business rules and  policies  is important. Know how to conﬁ gure 
policy templates and why they are needed.  
Exam Essentials 
971

972 
Chapter 23 ■ Configuring Additional Communication Services
 Review Questions  
 1. 
  To monitor activity in the  Incoming ,  Inbox , and  Outbox  folders of a fax server, it is 
recommended that you install Windows Fax and Scan. What feature should be installed for 
that software to be available?  
 A.   Print Services  
 B.   Fax Service 
 C.   Media Services 
 D.   Desktop Experience  
 2. 
  How do you install fax devices that were used on the server prior to installation of the Fax 
Services role?  
 A.   Rerun the Install Printer Wizard. 
 B.   Do nothing. Fax devices are detected when the role is installed.  
 C.   Consult the fax device vendor for installation instructions specific to your device.  
 D.   Use the Windows Update service to reinstall the device with the drives needed for Fax 
Services.  
  3. 
 When a fax device is detected and installed, it is automatically configured to do what?  
 A.   Send faxes.  
 B.   Receive faxes.  
 C.   Send and receive faxes.  
 D.   Nothing is enabled by default.  
 4. 
  How is individual fax routing configured?  
 A.   Per printer  
 B.   Per fax device 
 C.   Based on clients  
 D.   Depends on volume  
  5. 
  How would you ensure that faxes going to a certain area code are sent from only a 
particular fax device? 
 A.   Instruct users to choose the device for that area code.  
 B.   Configure the users ’ computers to only use one device.  
 C.   Create a fax rule that specifies a device to use a certain area code.  
 D.   Install advanced fax software on your users ’ computers and configure it to send faxes 
to the right device.  

 6. 
 Which editions of Windows Server 2008 will allow advanced features such as multicast 
streaming? (Choose all that apply.)  
 A.   Windows Server 2008 R2 Standard  
 B.   Windows Server 2008 R2 Web  
 C.   Windows Server 2008 R2 Datacenter  
 D.   Windows Server 2008 R2 Enterprise  
 7. 
  Which of the following is a correct procedure to install Windows Media Services?  
 A.   Add Roles Wizard.  
 B.   Add Features wizard.  
 C.   It must be downloaded and installed from Microsoft ’ s website as a service add - in.  
 D.   Use Add/Remove Programs in Control Panel.  
 8. 
  What are the system requirements for installing Windows Media Services?  
 A.   One or more processors with a minimum speed of 550 MHz  
 B.   One or more processors with a minimum speed of 133 MHz  
 C.   1 GB of RAM  
 D.   5 GB of free space  
 9. 
  Which of the following correctly describes the term  streaming media ? 
 A.   Media that are newer than 2003  
 B.   Media that are created by Microsoft  
 C.   Media that are displayed to the end user as they are being delivered from a server  
 D.   Any media that contains audio  
 10.   What does Media Services use publishing points for?  
 A.   To stream Microsoft Publisher files  
 B.   To tell clients how to reach content  
 C.   To allow network users to use Microsoft Publisher without having the program 
installed  
 D.   To hold content directories  
Review Questions 
973

974 
Chapter 23 ■ Configuring Additional Communication Services
 Answers to Review Questions 
 1. 
D.  When the Desktop Experience feature is installed, it installs Windows Fax and Scan by 
default.  
 2. 
B .  When the Fax Server role is installed, any devices already connected to the server are 
detected and installed.  
  3. 
A .  After installation of a fax device, the fax server conﬁ gures the device to send faxes.  
 4. 
B .  Individual fax routing is conﬁ gured on a per - device basis.  
 5. 
C .  Fax rules allow you to optimize the use of faxes by associating a rule with a fax device 
and an area code or region.  
 6. 
C, D.  Advanced features for Windows Media servers are available on only Windows Server 
2008 and 2008 R2 Enterprise and Datacenter editions.  
 7. 
C .  Windows Media Services is not available from the Add Roles Wizard. It must be 
downloaded and installed from Microsoft ’ s website.  
 8. 
B .  Windows Media Services require a minimum processor speed of 133 MHz.  
 9. 
C.  Any media that are played in a user ’ s player but reside on a server would be considered 
streaming.  
 10. B .  Publishing points are used to tell clients how to ﬁ nd content.  
  
Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at  www
.sybex.com/go/mctswin08r2 . 

Configuring Windows 
SharePoint 2010 
Foundation  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Configuring Network Application Services  
 Configure Microsoft SharePoint Foundation options. May 
include but is not limited to: site permissions; backup; 
service accounts; rights management services (RMS); 
migration; audience targeting; claims - based authentication; 
SharePoint Timer jobs; usage and report logging. 
 Configure SharePoint Foundation integration. May include 
but is not limited to: configuring a document library to 
receive e - mail; configuring incoming vs. outgoing e - mail; 
support for Office Web Apps and SharePoint Workspaces.  

■
■
 Chapter 
24

 Windows SharePoint Services offers businesses a simple and 
cost - effective solution to collaborate and to manage knowledge, 
such as user forums, company libraries, and professional 
training. Microsoft provides this as a free add - on, starting with Windows Server 2003. 
Windows SharePoint 2010 Foundation, or Foundation, as it will also be referred to in the 
rest of the chapter, has had a major overhaul since its previous version, WSS 3.0. 
 Foundation has also closed many of the gaps that WSS 3.0 had in ease of use and 
functionality. This makes Foundation a secure and simple - to - deploy option for any 
company looking to increase its efﬁ ciency in business processes. In short, SharePoint 
Foundation can give your people the access to information they need when they need it. 
 This chapter assumes that you have already met the prerequisites and have already 
installed SharePoint Foundation 2010 on your server per the Microsoft readme and 
deployment documents.  
 Configuring SharePoint 
Foundation 2010 
 Email, workﬂ ow, logging, and antivirus settings allow your SharePoint Foundation site 
to provide superior functionality, thus increasing workﬂ ow and productivity. You don ’ t 
need to be an expert web designer to conﬁ gure these options. You will, however, need 
information on your current email server to proceed.  
 For the following sections, you will need the email server display address 
( @yourcompany.com ) and the outbound SMTP (Simple Mail Transfer 
Protocol) server address. 
 The SharePoint 2010 Central Administration site will be used to conﬁ gure the options in 
the following sections (Figure 24.1). 

 On this central site is an Administrator Tasks checklist. It provides you with prioritized 
tasks, which will aid you in a successful setup. It is best if you take some time to familiarize 
yourself with the ﬁ rst item, “READ FIRST  - Click This Link For Deployment Instructions, ” 
which is displayed on the Central Administration home page.  
 The quick start guide will help you understand how to deploy SharePoint 
Foundation 2010 in different deployment scenarios, such as deploying in 
server farm environments.  
 Configuring Incoming Email Settings 
 Before you enable incoming email, you must have preinstalled the Internet Information 
Services (IIS6 or newer is required for SharePoint Foundation) and Simple Mail Transfer 
Protocol (SMTP) server. This can be done from the Add/Remove Programs option in 
Control Panel on your server. 
 Why do you need to bother with using the incoming email settings section? Say your 
users have started to use your new SharePoint site only to ﬁ nd out that in order for them to 
 F I G U R E 2 4 .1 Foundation Central Administration site 
Configuring SharePoint Foundation 2010 
977
 To open the Central Administration site on your SharePoint server, choose Start   All 
Programs   Administrative Tools and click SharePoint 2010 Central Administration.  

978 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
store email from other teams, they have to open the SharePoint site and upload the content. 
This would not only decrease productivity, but it would also discourage users from using 
the information management features. 
 Conﬁ guring this feature will allow your users to store their email - based information in 
lists and libraries and allow the site to receive email directly. The lists and libraries can be 
assigned an email address that will make the team sites more efﬁ cient in managing their 
information. Do you have a need to receive or offer support in your organization? Perhaps 
you could create a form for IT support. 
 Conﬁ guring incoming email would allow your users to create an email message 
that can be sent to your staff. With some custom coding, you could use this feature to 
trace the progress of requests and have SharePoint Foundation 2010 alert them anytime a 
change is made to a request. And there are other beneﬁ ts of conﬁ guring incoming email 
settings: 
 Archiving email  
 Creating a place to share information  
 Adding content via email  
 To conﬁ gure the incoming email settings, you need to locate the conﬁ guration page for 
incoming email. This page is found by following these steps: 
 1. 
 On the navigation bar on the Central Administration site, click Operations.  
 2. 
  Locate the Topology and Services section and select Incoming E - Mail settings, which 
will take you to the Conﬁ gure Incoming E - mail Settings page.  
 There are four different sections that you should understand how to conﬁ gure:
  Enable Incoming E - Mail   When incoming email is enabled, sites can accept email and 
store incoming messages in lists and libraries.  
  Directory Management Service   This is how SharePoint connects your SharePoint site 
to your users ’ organization directory. When active, it provides enhanced email features 
like creation and management of email distribution groups, creation of contacts in users ’  
directories, and allowing users to ﬁ nd email - enabled SharePoint lists in their address book.  
  Incoming E - Mail Server Display Address   This is usually something like  @yourcompany.com .  
  Safe E - Mail Servers   This is where you specify if you want to lock down your SharePoint 
environment to just certain email servers or if you want to allow any email server to be able 
to route email to your site.  
 Now that you have a basic overview of the options, you ’ ll choose the options for the 
example scenario. In Exercise 24.1, you ’ ll conﬁ gure the Incoming E - mail settings. 
■
■
■

 E X E R C I S E  2 4 .1
Configuring Incoming E - mail Settings  
 1. 
  Open the Central Administration site by choosing Start   All Programs   
Administrative Tools and clicking SharePoint 2010 Central Administration. 
 2. 
  On the navigation bar on the Central Administration site, click the System Settings link.  
 3. 
  In the E - mail And Text Messages section, select Conﬁ gure Incoming E - Mail Settings. 
 4. 
  In the Enable Incoming E - Mail section, choose Yes.  
 5. 
  Select Automatic in the Enable Incoming E - Mail section.  
 6. 
  In the Directory Management Service section, select No. 
 7. 
  In the E - Mail Server Display Address box, type the email server name in the form 
  @mycompany.com  . 
 8. 
  In the Safe E - Mail Servers section, select Accept Mail From All E - Mail Servers.  
 9. 
  Click OK.  
 Configuring Outgoing Email Settings 
 Outgoing email settings are the building blocks administrators can use for several different 
email notiﬁ cation features. In fact, without proper conﬁ guration of the outgoing email 
settings, you will not be able to utilize alerts or application notiﬁ cation. 
 Similar to when you conﬁ gured incoming email settings, you must have preinstalled the 
Internet Information Services (IIS6 or newer is required for SharePoint Foundation 2010) 
and Simple Mail Transfer Protocol (SMTP) server. 
 So where would you use these features? As a company grows, it has a greater need to get 
key information to its users fast. Therefore, here are a few ways you could use alerts and 
notiﬁ cations:
 Alerts   Users can have the SharePoint Foundation 2010 site alert them when updates to 
lists, discussions, libraries, and other parts of the site are updated. This works out nicely 
when you have two different groups working on the same documents, lists, or libraries. 
Users can conﬁ gure alerts to notify them when changes are made to the documents they 
are responsible for. Because users are able to manage this conﬁ guration, this reduces the 
amount of administration effort.  
 If your users are not able to configure alerts, check your permissions on 
the site. Users must have at least View permissions. 
 Notifications or Administration Notices   As a site administrator, you could use these to 
receive emails when a user requests access to a site or if you want to know when someone 
Configuring SharePoint Foundation 2010 
979

980 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
has gone over their storage quota. This would help simplify the process for your users and 
reduce the impact on your help desk.  
 SharePoint Foundation Email Beneﬁ ts 
 About a year ago, we came across a client who was looking for a low - cost application that 
would allow them to create a purchase order form. They said that this application must send 
out email alerts to the approving manager and the user who submitted the purchase order. 
They wanted it to pull the user ’ s information from Active Directory and populate it on the form, 
which would save the user time and make sure the information on the request was standard. 
 We looked into several different applications to accomplish this task. After some additional 
research, we realized that SharePoint Foundation and the outgoing email feature would be 
exactly the foundation we would need to accomplish what the client wanted. 
 While this required some additional programming on our part, it was nice that we only had 
to conﬁ gure the outgoing email settings to send alerts to the proper people. After setting up 
the outgoing email, we created the forms they wanted and linked certain dialog boxes to 
populate their Active Directory user account. 
 We were able to do all of this while staying in the client ’ s modest budget. The best part is 
that we are now able to take the code we used for this client and sell it to other clients as an 
already ﬁ nished product. 
 Let ’ s review a few requirements that must be met before you can conﬁ gure the settings 
because outgoing email relies on several components that you must consider: 
 The From email address is used to help identify the sender of the message you receive. 
This can be something like  siteadmin@yourcompany.com . 
 A Reply - To address is needed. This will be the address that your users reply to when 
they get an alert or administrator notiﬁ cation.  
 
Many companies use  donotreply@yourcompany.com or something similar 
as a Reply - To address because they do not monitor this email address and 
thus do not want users to reply to an alert or system notice. 
 SMTP service installed. You will need to know the DNS name or IP address of the SMTP 
server you plan to use. Some SMTP mail servers require usernames and passwords that 
you have to conﬁ gure to allow your SharePoint Foundation site to use SMTP to send mail.  
 Character set. You need to know what language set to use in the body of your alert 
email. If you do not know, use the default language.  
■
■
■
■

 Now that you are armed with the requirements, you can proceed to Exercise 24.2.  
 E X E R C I S E  2 4 . 2
Configuring Outgoing E - mail Settings  
 1. 
  Open the Central Administration site by choosing Start   All Programs   
Administrative Tools and clicking SharePoint 2010 Central Administration. 
 2. 
  On the navigation bar on the Central Administration site, click the System Settings link.  
 3. 
  In the E - mail And Text Messages section, select Conﬁ gure Outgoing E - mail Settings. 
 4. 
  In the Outbound SMTP Server box, enter your SMTP server address or IP address (for 
example,   mailer.yourcompany.net  ).  
 5. 
  In the From Address ﬁ eld, put in the address you want people to see when they get an 
email alert (for example,  administrator@yourcompany.com  ).  
 6. 
  In the Reply - To Address box, enter the email address you want people to use to reply 
(for example,  noreply@yourcompany.com  ).  
 7. 
  For the Character Set option, leave the default selected, which is 65001 (Unicode UTF - 8). 
 8. 
  Now click OK. 
 Configuring Outgoing Email Settings for a Specific Web 
Application 
 Now that you have conﬁ gured the outgoing email for your SharePoint Foundation 2010 
site applications, you might have a need for different settings for a speciﬁ c web application. 
SharePoint Foundation 2010 gives you the ability to have two different applications send 
out email using different email addresses. For example, you can have an application in your 
HR department that sends out emails and an application on your news page that sends out 
alerts. You can conﬁ gure each application to use a different From and Reply - To address. 
 Exercise 24.3 shows how to conﬁ gure the settings for a speciﬁ c application. In the 
exercise, the same SMTP settings that were used in Exercise 24.2 will be used again.  
 E X E R C I S E  2 4 . 3
Configuring Outgoing E - mail Settings for a Specific Web Application 
 1. 
  Choose Start   All Programs   Administrative Tools and click SharePoint 2010 Central 
Administration.  
 2. 
  On the navigation bar at the upper - left side of your screen, choose Application Management.  
 3. 
  Under the Web Application Management section, choose Manage Web Application.  
Configuring SharePoint Foundation 2010 
981

982 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
E X E R C I S E  2 4 . 3  (c o n t i n u e d)
 4. 
  Choose SharePoint  - 80. 
 5. 
  Click the down arrow under General Settings and choose Outgoing E - mail.  
 6. 
  Now, the ﬁ rst option in the Mail Settings section is Outbound SMTP Server. Input the 
same information you entered in the previous exercise. If you plan to use an SMTP 
server other than the default, enter the new server DNS name or IP address here.  
 7. 
  Enter the From and Reply - To addresses you plan to use for this speciﬁ c application. 
The From address is the address that will appear to your email recipients. The Reply - To 
address is the address your users will send to when they choose Reply.  
 8. 
  The character set can remain at the default setting or one that is appropriate for your 
language.  
 9. 
  Click OK.  
 Configuring Workflow Settings 
 Workﬂ ow settings are conﬁ gured at the application level. This allows the site administrator 
or your end users to create their own application - speciﬁ c workﬂ ows. You can have different 
workﬂ ows for each application. 

 You can choose to control whether end users or site administrators will conﬁ gure these 
settings. Allowing your users to conﬁ gure them can greatly reduce your administrators ’ 
involvement, but it can increase the risk of nonstandard workﬂ ows entering your work 
environment. By default, your users can create their own workﬂ ows using only code that 
your site administrators deploy. 
 You also have the option to choose whether you want internal or external users to 
receive alerts when they are assigned a task. If you want external users to participate in 
the workﬂ ow process, then SharePoint Foundation 2010 will send them a copy of the 
document assigned to them. 
 As mentioned, the workﬂ ow is application speciﬁ c and you will most likely conﬁ gure 
these options after you have developed your applications. The Central Administration 
site will allow you to conﬁ gure the workﬂ ow settings. You can conﬁ gure these settings by 
following these steps: 
 1. 
 Choose Start   All Programs   Administrative Tools   SharePoint 2010 Central 
Administration.  
 2. 
  On the navigation bar at the upper - left side of your screen, choose Application 
Management.  
 3. 
  Under the Web Application Management section, choose Manage Web Application.  
 4. 
  Choose SharePoint  - 80.  
 5. 
  Click the down arrow under General Settings and choose Workﬂ ow Settings 
(see Figure 24.2).  
 6. 
  Under User - Deﬁ ned Workﬂ ows, select Yes or No.  
 7. 
  For Workﬂ ow Task Notiﬁ cations, you have the option of choosing Yes or No to send 
alerts to your users when they are assigned a task and if you want external users to be 
sent a copy of any documents assigned to them.  
 8. 
  Click OK.  
 F I G U R E 2 4 . 2 Workflow Settings 
Configuring SharePoint Foundation 2010 
983

984 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 Configuring Diagnostic Logging Settings 
 In this section, you have to make some basic decisions about what you want to log and how 
much you want to share with Microsoft. We will cover the following topics: 
 Error reporting  
 Event throttling  
 Event Log Flood Protection  
 Trace log  
 When software is being set up, one of the least - conﬁ gured settings is logging, which 
provides valuable data for both the IT professional and the application vendor. Taking 
some time to conﬁ gure these options can save many hours of troubleshooting. In addition, 
if you choose to share this information with Microsoft, it will help the developers produce 
a better product. Providing this information to Microsoft is optional. We will review each 
of these options so you can make an informed decision.  
  Error Reporting   When you have any issues with your application or hardware or 
encounter a problem, error reporting will create an error report or log information in 
a system log for you to review. The following list includes some of the items SharePoint 
Foundation 2010 collects: 
 IP address of the server 
 Product ID 
 Condition of server when problem occurred  
 Hardware your server is using  
 Software version  
 While Microsoft does not try to collect personal information, it is entirely possible that 
such information could be included in the report. Personal information can include, but is 
not limited to, usernames, email addresses, URLs, and IP addresses. Microsoft states that it 
uses this information only to help determine the problem and how to solve it, but you will 
have to decide whether you want Microsoft to have it. You can choose to either send these 
error reports periodically or have this information sent silently. Please review any policies 
your corporation may have on sharing of information.  
  Event Throttling   When you choose to log events, it is important that you manage not 
only what type of information is put into the logs but also how big in size the logs can 
become. If you don ’ t conﬁ gure these settings, you run the risk of the ﬁ les growing out of 
control. You can choose to have this information logged into the Windows event log or 
trace logs. 
  Event Log Flood Protection   Enabling this setting allows detection of repeating events 
in the Windows event log. When the same event is being logged repeatedly, the repeating 
events are detected and suppressed until conditions return to normal.  
■
■
■
■
■
■
■
■
■

 Trace Log   When tracing is enabled, you may want the trace log to go to a certain 
location. Note: The location you specify must exist on all servers in the farm. Additionally, 
you may set the maximum number of days to store log ﬁ les and restrict the maximum 
amount of storage to use for logging.  
 You have a lot of control in SharePoint Foundation 2010 when it comes to event throttling. 
You will have to decide the level of importance of each event because SharePoint Foundation 
has settings that specify how critical each event is. SharePoint Foundation breaks up the 
events into categories and you can decide to throttle them all or just throttle a single event. 
 Categories such as the following are deﬁ ned by different services or common events in 
Windows SharePoint Foundation 2010: 
 All  
 By product  
 Features  
 SharePoint services  
 Administration functions  
 Shared services  
 After choosing the type of category you want to log, you will want to choose the level of 
events to include in the log. The options for logging Windows events are as follows: 
 None  
 Error  
 Warning  
 Audit failure  
 Audit success  
 Information  
 The following options are available when using trace logs: 
 None  
 Unexpected  
 Monitorable  
 High  
 Medium  
 Verbose  
 Configuring Antivirus Settings 
 In today ’ s world, running your SharePoint Foundation 2010 server, or any other server for 
that matter, without an antivirus product is playing a dangerous game. It will only be a 
matter of time until a user uploads a virus and distributes it to others. It is best practice to 
install an antivirus product on all servers in a server farm. 
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
Configuring SharePoint Foundation 2010 
985

986 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 After you install an antivirus product on the SharePoint Foundation 2010 server, it is 
important to conﬁ gure the antivirus settings.  
 
In a server farm, all web servers with documents must have the antivirus 
product installed before these settings will take effect.  
 There are four antivirus settings you can conﬁ gure (see Figure 24.3):
  Scan Documents On Upload   When a user uploads a document to your SharePoint 
Foundation 2010 site, your antivirus product will scan it to ensure that it does not contain 
viruses. This will help protect from spreading viruses to other users.  
  Scan Documents On Download   When selected, this feature will scan a document before 
it is downloaded to a user ’ s computer. It will prompt the user about an infection and allow 
them to decide to continue or not, unless you check the next option.  
  Allow Users To Download Infected Documents   When this option is selected, it allows 
users to download infected documents to their local computer. This is not a recommended 
option to select unless you have a speciﬁ c reason to, like troubleshooting a document.  
  Attempt To Clean Infected Documents   If a virus is found during the scanning process, 
this option will allow the antivirus product to clean it automatically.  
 F I G U R E 2 4 . 3 Antivirus Settings 

 To locate these options, follow these steps: 
 1. 
 Open the Central Administration site by choosing Start   All Programs   Administra-
tive Tools and clicking SharePoint 2010 Central Administration.  
 2. 
  On the side navigation bar, click Security.  
 3. 
  In the General Security section, click Manage Antivirus Settings.  
 Configuring Backups 
 Microsoft recommends that you regularly back up the complete farm. To back up the 
complete farm you must back up both the conﬁ guration and the content. You reduce 
the possibility of data loss that might occur by regularly backing up the farm. Backing 
up the farm is a simple process (see Figure 24.4) and helps to ensure that all the farm data 
and conﬁ gurations are available for recovery. 
 The backups are stored on a local computer or network location, so before you begin, 
you must ﬁ rst create a folder on the local computer or the network drive for the backup 
data. For better performance, Microsoft recommends that you back up to the local 
computer ﬁ rst and then move the backup ﬁ les to a network folder.  
 F I G U R E 2 4 . 4 Backup And Restore 
Configuring SharePoint Foundation 2010 
987

988 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 Use Windows PowerShell to Back Up a Farm 
 Throughout this book we have talked about using Windows PowerShell. Windows 
PowerShell is a scripting tool that allows you to use coding for conﬁ guration or 
management of many Windows Server tools and utilities. 
 You can use Windows PowerShell to back up the SharePoint farm manually or as part 
of a script that can be run at scheduled intervals. To use PowerShell to back up SharePoint, 
complete the following steps: 
 1. 
 Verify that you meet the following minimum requirements.  
 2. 
  On the Start menu, click All Programs.  
 3. 
  Click Microsoft SharePoint 2010 Products.  
 4. 
  Click SharePoint 2010 Management Shell.  
 5. 
  At the Windows PowerShell command prompt, type the following command: 
Backup-SPFarm -Directory  < BackupFolder >  -BackupMethod {Full | Differential} 
[-Verbose] 
 Use Central Administration to Back Up a Farm 
 You can also use the SharePoint 2010 Central Administration tool to back up the farm. To 
back up a farm by using the SharePoint 2010 Central Administration tool, complete the 
following steps:  
 To perform this procedure, you must be a member of the 
Farm Administrators group on the computer that is running 
Central Administration.  
 1. 
 In the SharePoint 2010 Central Administration tool, on the Home page, click the 
Backup And Restore section.  
 2. 
  Choose Perform A Backup.  
 3. 
  On the Perform A Backup Step 1 Of 2 (Select Component To Back Up) page, select the 
farm from the list of components. Click Next.  
 4. 
  On the Start Backup Step 2 of 2 (Select Backup Options) page, select either Full or 
Differential in the Backup Type section. 
 If you are backing up the farm for the first time, you must use the Full 
option. You must perform a full backup before you can perform a 
differential backup. 
 5. 
  Click Back Up Content And Conﬁ guration Settings in the Back Up Only Conﬁ guration 
Settings section.  
 6. 
  In the Backup File Location section, type the UNC path of the backup folder. Click 
Start Backup. 

 The Backup And Restore Job Status page will show any errors you may receive.  
 Recovery 
 Hopefully you will never need to do a SharePoint 2010 recovery, but in the event that you 
do, this section is for you. You can restore the SharePoint database two ways: Windows 
PowerShell or SharePoint 2010 Central Administration tool.  
 
Before you restore a farm, you should ensure that you are a member of the 
Farm Administrators group.  
 To restore a farm by using Windows PowerShell, follow these steps: 
 1. 
 On the Start menu, choose All Programs.  
 2. 
  Choose Microsoft SharePoint 2010 Products.  
 3. 
  Choose SharePoint 2010 Management Shell.  
 4. 
  At the Windows PowerShell command prompt, type the following command: 
Restore-SPFarm -Directory  < BackupFolder >  -RestoreMethod Overwrite [-BackupId 
 < GUID > ] 
 5. 
  To restart service applications, type the following command, and then press Enter: 
Start-SPServiceInstance -Identity  < ServiceApplicationID > 
 You can use the Central Administration website to restore a farm. To restore a farm by 
using Central Administration, follow these steps: 
 1. 
 Ensure that you are a member of the Farm Administrators SharePoint group.  
 2. 
  In SharePoint 2010 Central Administration, click the Backup and Restore section.  
 3. 
  Choose Restore From A Backup.  
 4. 
  On the Select Backup To Restore page, select the backup job that contains the farm 
backup, and then click Next.  
 5. 
  On the Select Component To Restore page, select the check box that is next to the 
farm, and then click Next.  
 6. 
  On the Select Restore Options page, ensure that Farm appears in the Restore The 
Following Components list.  
 7. 
  In the Restore Only Conﬁ guration Settings section, ensure that the Restore Content 
And Conﬁ guration Settings option is selected.  
 8. 
  In the Restore Options section, select the Same conﬁ guration option under the Type Of 
Restore section. A dialog box will appear. Click OK.  
 9. 
  Click Start Restore.  
Configuring SharePoint Foundation 2010 
989

990 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 Audience Targeting 
 Audience targeting allows you to display content to speciﬁ c groups of people. This allows 
you to present information that is relevant only to a particular group of people. This 
content can include list and library items, navigation links, or Web Parts. (A Web Part is a 
modular unit of information that consists of a title bar, a frame, and content. Web Parts are 
the basic building blocks of a Web Part Page.)  
  List and Library Items   These items include links or calendars in a list, documents in a 
document library, and pictures in a picture library. To target lists and library items, you 
must have at least the Contribute permission level.  
  Navigation Links  Navigation links include links in the Quick Launch or the top link bar. To 
add, modify, and delete navigation links, you must have at least the Design permission level.  
  Web Parts   Web Parts include many types. They are created by using the Content 
Query Web Part. To add, modify, and delete Web Parts, you must have at least the Design 
permission level.  
 You also have the ability to create audiences by using the following options:
 SharePoint Groups   SharePoint Groups are groups created speciﬁ cally for SharePoint. 
Depending on how you conﬁ gure inheritance, users can access the groups from the site and 
potentially its subsites. To create SharePoint groups and assign users to them, you must 
have the Full Control permission level.  
  Global Audiences   You can create audience rules that allow you to deﬁ ne a global audience. 
This allows users to be automatically evaluated against the audience rules. Global 
audiences are available to the top - level SharePoint site and its subsites. To create, modify, 
or delete a global audience, you must be a SharePoint administrator.  
  Windows Security Groups   Security groups are groups that can have rights and 
permissions assigned to the group. For example, if you wanted the Sales group to access 
a printer, the Sales group would have to be a security group. This would allow the print 
permission, or any permission, to be given to the group.  
  Email Distribution Groups   Distribution groups are groups that are created for email 
only. These groups are email distribution groups. Distribution groups cannot have any 
permissions or securities assigned to the group.  
 To conﬁ gure audience targeting you would complete the following steps: 
 1. 
 Click the list or library that contains the item you want to target.  
 2. 
  On the list toolbar, click Settings.  
 3. 
  Choose List Settings or Document Library Settings.  
 4. 
  Under General Settings, choose Audience Targeting Settings.  
 5. 
  Select the Enable Audience Targeting check box.  
 After you enable the list or library, you have the ability to set individual items in 
the list or library to be displayed to one or more audiences. To do this, you would do the 
following steps.  

 1. 
 Click the arrow next to the name of an item in the list or library, and then click Edit 
Properties.  
 2. 
  In the Target Audiences list, add one or more audiences.  
 SharePoint Permissions 
 Microsoft SharePoint Foundation 2010 includes different levels of permission by default. 
You have the ability to customize these different permission levels (except for the Limited 
Access and Full Control permission levels), or you have the ability to create customized 
permission levels that contain only the speciﬁ c permissions you need. 
 Table 24.1 lists the default permission levels for team sites in SharePoint Foundation 2010.   
 TA B L E 2 4 .1 SharePoint Foundation 2010 permission levels 
 Permission level  
  Description  
  Permissions Included by Default  
 Limited Access  
  Allows access to shared 
resources in the website so that 
the users can access an item 
within the site. 
 Browse User Information 
 Use Client Integration Features 
 Open 
 Read  
  Allows read - only access to the 
website.  
 View Items 
 Open Items 
 View Versions 
 Create Alerts 
 View Application Pages 
 Use Self - Service Site Creation 
 View Pages 
 Browse User Information 
 Use Remote Interfaces 
 Use Client Integration Features 
 Open 
 Contribute  
  Create and edit items in the 
existing lists and document 
libraries.  
 Read permissions, plus: 
 Manage Unsafe Content  
 Design  
  Create lists and document 
libraries and edit pages in the 
website.  
 Approve permissions, plus: 
 Manage Lists 
 Add and Customize Pages 
 Apply Themes and Borders 
 Apply Style Sheets  
 Full Control  
  Allows full control of the scope.  
  All permissions 
Configuring SharePoint Foundation 2010 
991

992 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 If you decide to create and use a site template other than the team site template, you will 
see a different list of default SharePoint groups. Table 24.2 shows additional permission 
levels provided with the publishing template.  
 TA B L E 2 4 . 2 SharePoint Foundation 2010 custom template permission levels 
  Permission Level  
  Description  
  Permissions Included by Default  
  Restricted Read  
  View pages and documents. 
Used for publishing sites 
only.  
 View Items 
 Open Items 
 View Pages 
 Open 
  View Only  
  View pages, list items, and 
documents  
 Limited Access permissions, 
plus: 
 View Items 
 View Versions 
 Create Alerts 
 Create Mobile Alerts 
 View Application Pages 
  Approve  
 Edit and approve pages, list 
items, and documents. Used 
for publishing sites only. 
 Contribute permissions, plus: 
 Override Checkout 
 Approve Items  
  Manage Hierarchy 
  Create sites; edit pages, list 
items, and documents. Used 
for publishing sites only. 
 Design permissions (minus the 
Approve Items permission), plus: 
 Manage permissions 
 View Usage Data 
 Create Subsites 
 Manage Web Site 
 Manage Alerts  
 Configuring Windows SharePoint 
Foundation 2010 Sites 
 A site collection is a hierarchical structure that is made up of a top - level site and one or 
more sites below it. Each site has the ability to have unique settings and unique content. 
Each top - level site and any sites below it in the site structure are based on site templates. 

Administrators have the ability to partition their site collection content into multiple sites. 
This allows administrators to have ﬁ ner control of the appearance, content, and features of 
the various pages in their site collection. 
 With the installation of your default SharePoint Foundation 2010 site complete, you are 
ready to start creating additional sites.  
 Configure Alternate Access Mapping   This allows you to assign different URLs to the 
same site.  
 Create Quota Templates   With quota templates, you can control how large a site 
collection can become. You will learn how to conﬁ gure the quota templates.  
 Create Site Collections   We will show you how to create a site collection and assign the 
primary and secondary owners.  
 Enable Access for End Users   After the creation of a site is completed, you will need to 
grant access to your users.  
 Add Site Content   After site collections are created, you can add content.  
 Upgrading from WSS 3.0 
 Performing an upgrade from WSS 3.0 to SharePoint Foundation is a simple process. But 
because each environment is different, as are the applications, you must plan accordingly. 
It is also important that you not only give consideration to the initial software upgrade but 
also think about any issues that might come up after the upgrade. 
 You can use the pre - upgrade checker to report on the status of your environment and 
SharePoint sites before you upgrade to Microsoft SharePoint Foundation 2010. Microsoft 
recommends that you run the pre - upgrade checker and resolve any issues that you may be 
having before scheduling the upgrade. 
 The pre - upgrade checker uses the  Stsadm command - line utility to ﬁ nd any potential 
problems before the upgrade, and it allows you to review recommendations and best 
practices. To run the pre - upgrade checker, you would complete the following steps.  
 We understand that you have already installed SharePoint and you may 
not need to do these steps. We are showing you the process for future 
reference and also for any exam questions you may encounter.  
 1. 
 Verify that you have the following administrative credentials:  
 To use  Stsadm , you must be a member of the local Administrators group 
on the server. 
 2. 
  Click Start, right - click Command Prompt, and then choose Run As Administrator.  
Configuring Windows SharePoint Foundation 2010 Sites 
993

994 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 3. 
  In the Command Prompt window, navigate to the following directory: 
 %COMMONPROGRAMFILES%\Microsoft Shared\Web Server Extensions\12\bin . 
 4. 
  Type the following command and press Enter: 
STSADM.EXE -o preupgradecheck 
 Next, make sure that a full backup has been completed. This will ensure that a recovery 
can be completed in case something goes wrong with the upgrade. 
 The following table (Table 24.3) shows the checklist of steps on upgrading WSS 3.0 to 
SharePoint Foundation 2010.  
 TA B L E 2 4 . 3 Checklist for upgrading SharePoint 
 In - Place Upgrade Steps  
  Explanation  
  Run the pre - upgrade checker.  
  Run the pre - upgrade checker and address any 
issues.  
  Clean up your environment.  
  Make sure that the environment is functioning 
in a healthy state. 
  Record settings for user profile 
synchronization.  
 Log the settings used for user profile 
synchronization for your previous environment.  
  Record blocked file types.  
  Blocked file types are not preserved during 
upgrade. Log these files so that they can be 
reapplied after upgrade. 
  Back up your environment.  
  Back up your entire SharePoint environment.  
  Install prerequisites on all servers.  
  Install any files or service packs needed to 
upgrade to SharePoint 2010. 
  Detach databases (in - place upgrade with 
detached databases only).  
 When doing an in - place upgrade, you must 
detach the databases. 
  Disconnect users.  
  You must disconnect all users if you are 
upgrading a server farm. 
  Run Setup on all servers.  
  Upgrade the servers.  
 In - Place Upgrade 
 You are now ready to perform the upgrade. We will cover only an in - place upgrade, so 
please consult the Microsoft TechNet articles for other upgrade options. Other options 
include a gradual upgrade and database migration. 

 Performing an in - place upgrade is the simplest option. In - place upgrades will update all 
content and conﬁ guration data at the same time. Keep in mind that while this upgrade is 
running, your users will not be able to access the web server; make sure you inform your 
users of this downtime. An in - place upgrade is best when you have a single server or a 
small farm with few or no custom applications. If you are in a medium to large server farm 
or have heavy customization, you are better off using a gradual upgrade, which would 
reduce the impact on your users. The process of upgrading includes the following steps: 
 1. 
 Install SharePoint Foundation 2010:  This will perform an automated in - place upgrade.  
 2. 
  Run the Conﬁ guration Wizard: This will ﬁ nish your upgrade and install the Central 
Administration web application.  
 3. 
  Review log ﬁ les and resolve any issues: Log ﬁ les can be found at  %commonprogram-
files%\Microsoft Shared\web server extensions\12\LOGS . 
 Performing an In - Place Upgrade 
 We recently did an in - place upgrade from WSS 3.0 to SharePoint Foundation 2010 for 
a client that had about 250 users. The users had become very accustomed to using the 
WSS 3.0 site and found that the tool was valuable to their organization. The client asked 
for some additional features, such as allowing extranet users, blogging, and some 
additional forms that would be linked to their Internet site. 
 All of the custom applications were designed using WSS 3.0, and that was a cause for 
concern. We wanted to minimize the amount of development work needed to upgrade 
them to SharePoint Foundation. We decided to go ahead with the upgrade plans because 
the increased functionality and the ease of use were very appealing to both their 
administrators and end users. In addition, SharePoint Foundation 2010 has features that 
would allow them to have extranet users and reduce the administration needed. 
 Following the Microsoft TechNet articles for Windows SharePoint Foundation 2010 
proved invaluable to having a successful upgrade. We decided to make images of the 
server before attempting the upgrade, which we highly recommend. After the images 
were created (we created an image of a domain controller for Active Directory access), 
we converted them to virtual machines. 
 After the upgrade was completed, our development staff had to update some of our 
custom applications. They would not work after the upgrade because the applications 
were developed in ASP.NET 2.0. Overall the upgrade was a success, and we learned a lot 
in the process. 
Configuring Windows SharePoint Foundation 2010 Sites 
995

996 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 Configuring Alternate Access Mapping 
 Alternate access mapping is one of the more powerful features in SharePoint Foundation 
2010. Yet, for whatever reason, it is also one of the least understood. 
 Where does this feature shine? Do you have a reverse proxy or load - balancing needs? 
Then this feature will beneﬁ t you. 
 But just what is alternate access mapping? Simply put, it tells SharePoint how to map 
a request from a web browser to the proper web application. This is needed so that 
SharePoint can give the correct content back to you. It then tells SharePoint Foundation 
what URL the user should be directed to. 
 One of the biggest reasons you would want to conﬁ gure alternate access mapping is 
when the URL of a web request received by IIS is not the same URL that the user entered. 
 Each web application can support ﬁ ve collections of mappings per URL. They 
correspond to the ﬁ ve zones: default, intranet, extranet, Internet, and custom. 
 You will now learn how to add an internal URL, edit or delete an internal URL, map to 
an external source, and edit public URLs (see Figure 24.5).  
 F I G U R E 2 4 . 5 Alternate Access Mappings page 
 1. 
 Choose Start   All Programs   Administrative Tools, and choose SharePoint 2010 
Central Administration.  
 2. 
  On the side navigation bar, choose Application Management, and then under the Web 
Applications section, choose Conﬁ gure Alternate Access Mappings.  

 To add an internal URL, follow these steps: 
 1. 
 Click the Add Internal URLs link.  
 2. 
  If your collection is not speciﬁ ed in the Alternate Access Mapping Collection, choose 
the collection from the drop - down menu. 
 3. 
  Add the new URL in the next box and choose your zone.  
 4. 
  Click Save.  
 To edit or delete an internal URL, follow these steps: 
 1. 
 In the Alternate Access Mappings page, click the URL you want to edit or delete.  
 2. 
  Modify the URL and/or the zone.  
 3. 
  If the URL needs to be deleted, click Delete at the bottom of the screen.  
 4. 
  If you made any changes to the URL, click Save.  
 You cannot delete the last URL because there should always be at least 
one URL for the default zone.  
 To edit public URLs, follow these steps: 
 1. 
 Back on the Alternate Access Mappings page, click Edit Public URLs.  
 2. 
  Select a collection from the Alternate Access Mapping Collection menu box.  
 3. 
  Modify or add URLs in the Public URLs section.  
 4. 
  Click Save.  
 SharePoint Foundation allows you to deﬁ ne resources that are outside an internal 
application, but you need to make sure the URL is unique to your server farm. 
 To map to an external source, follow these steps: 
 1. 
 On the Alternate Access Mappings page, click Map To External Resource.  
 2. 
  Type a unique resource name and add a new URL in the boxes in the External 
Resource Mapping section.  
 3. 
  Click Save.  
 Creating Quota Templates 
 As users get used to using your SharePoint Foundation 2010 site, they will naturally start 
storing more and more data on it. This can be a blessing because you are ﬁ nally getting 
them to use your new data management tool. However, caution is needed because a 
database can grow out of control. Quota templates are a solution to this problem. With 
these templates, you can add storage limits on a site collection. This feature can trigger an 
email alert to your administrators when this size limit is reached. 
Configuring Windows SharePoint Foundation 2010 Sites 
997

998 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 You can apply these quotas to any site collection in a server farm. The quota will apply 
to the top - level site and all other sites under it. 
 To create a new quota template, follow these steps: 
 1. 
 Open the Central Administration site by clicking Start   All Programs   Administra-
tive Tools and choosing SharePoint 2010 Central Administration.  
 2. 
  Choose Application Management.  
 3. 
  Under the SharePoint Site Collections section, choose Specify Quota Templates.  
 4. 
  Choose Create A New Quota Template in the Template Name section. (From this 
section, you can also choose to edit an existing template or delete an existing template). 
You can create this template by using an existing quota template or just choose a new 
blank one. Name the new template.  
 5. 
  In the Storage Limit Values section, set the limits for data storage and the threshold for 
sending an alert email.  
 6. 
  Click OK.  
 Creating Site Collections 
 When you create a new site collection, you are also creating a top - level website for 
SharePoint Foundation 2010. You will have the option to choose several templates 
for the site, such as templates for document libraries, help desk, knowledge bases, room 
and equipment reservations, team sites, wikis, and blogs. 
 To create a new site collection, you will need to navigate to the Application Management 
page, which can be done by choosing Start   All Programs   Administrative Tools   
SharePoint Foundation 2010 Central Administration. Then, follow these steps: 
 1. 
 Choose Application Management, and in the SharePoint Site Collection section, choose 
Create Site Collection.  
 2. 
  Make sure the web application is selected in the Web Application drop - down box.  
 3. 
  Give the collection a title and description, and then add a URL in the URL box.  
 4. 
  Choose a template in the Template Selection section.  
 5. 
  Next, add primary and secondary site administrators.  
 6. 
  Select a quota template.  
 7. 
  Click OK.  
 Enabling Access for End Users 
 Now that the SharePoint Foundation 2010 site is created, you can give access to your users. 
This section will help you understand how to give access to site administrators, collection 

administrators, site owners, and, most important, end users. Without proper access 
planning, you can ﬁ nd yourself taking away or adding access needlessly. 
 Within a site collection, you can conﬁ gure access to sites, libraries, folders, documents, 
and items. Most of the conﬁ guration of user access will take place in the site collection and 
not from the Central Administration page. 
 First, add site collection administrators to your site. This portion is done from the 
Central Administration site by choosing Start   All Programs   Administrative Tools   
SharePoint 2010 Central Administration. Then, just follow these steps: 
 1. 
 Choose Application Management from the navigation bar.  
 2. 
  In the SharePoint Site Collection section, choose Change Site Collection 
Administrators.  
 3. 
  Select a site collection from the drop - down menu. 
 4. 
  In the following two boxes, add primary and secondary site collection 
administrators.  
 5. 
  Click OK.  
 Configuring Authentication for 
SharePoint Foundation 2010 
 Authentication is the process of validating a user ’ s rights to log into your SharePoint 
Foundation 2010 site and verifying the level of access they should have. SharePoint Foundation 
2010 uses IIS to manage user authentication. After IIS has determined that the user is authentic, 
SharePoint Foundation 2010 will perform the authorization. SharePoint Foundation 2010 
will then allow the user to access the resources on the SharePoint Foundation 2010 site 
to which they have been given access. 
 SharePoint Foundation has provided support for federated authorization, also known as 
Web Single Sign On (Web SSO). This means that the authentication system is not local to 
the computer that hosts Windows SharePoint Foundation 2010. 
 SharePoint Foundation 2010 provides for several other authentication scenarios: 
 Standard Windows authentication.  
 Simple database containing usernames and passwords.  
 Integrating directly into your company ’ s identity management system.  
 Using several systems together. This would allow for a company identity system 
to authenticate partner employees but another system to authenticate internal 
employees.  
■
■
■
■
Configuring Authentication for SharePoint Foundation 2010 
999

1000 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 Table 24.4 shows the supported authentication methods.  
 TA B L E 2 4 . 4 Supported authentication methods 
 Authentication Method  
  Description  
  Examples  
 Windows 
  These are standard IIS 
Windows authentication 
methods.  
 Basic Anonymous Digest 
Certificates  
Kerberos (Integrated 
Windows)
 NTLM (Integrated Windows) 
 ASP.NET forms  
  SharePoint Foundation 
adds support for identity 
management systems by 
adding ASP.NET - based 
forms authentication.  
 LDAP (Lightweight Directory 
Access Protocol) 
SQL Database or other 
databases  
Other ASP.NET - based forms  
 Web Single Sign - On 
(Web SSO)  
 Enables SSO in 
environments that are on 
disparate platforms.  
 ADFS (Active Directory 
Federation Services)
 Additional identity 
management systems 
 The following sections will cover a couple of the conﬁ guration options: 
 Digest authentication  
 Web Single Sign - On using Active Directory Federation Services (ADFS)  
 Configure Digest Authentication 
 Digest authentication is similar to Basic authentication. The main difference is that Digest 
authentication is more secure. How does Basic authentication work? 
 First, Windows account credentials must have been previously assigned. Then, Basic 
authentication allows credentials to be passed on over a web browser. Basic authentication, 
however, lacks security because user credentials are passed over the network in plain 
text and over an unsecure HTTP session. You are able to increase security by using SSL 
encryption. 
 Digest authentication provides increased security because user credentials are encrypted 
before being sent over the network. Digest uses a challenge/response protocol, which means 
that the authentication requestor must correctly answer a challenge from the server. To do 
this, the client has to supply a correct shared secret password string. 
 To use Digest authentication, you have to meet the following requirements: 
 Users and the IIS server must be on the same domain or have a trust relationship.  
 You must have a valid user account in Active Directory.  
■
■
■
■

 You must have at least one Windows Server 2008 or Windows Server 2008 R2 server 
in the domain.  
 A hot ﬁ x is needed if you are using a web browser that is not Internet Explorer 6.0 or 7.0.  
 Users can be conﬁ gured for authentication within a zone of a web application. The 
zones are as follows:
 Internet   For your customers   
 Intranet   For your internal users  
 Default   For your remote employees  
 Custom   For your administrators  
 Extranet   For your partners  
 Both SharePoint Foundation and IIS must be conﬁ gured to use Digest authentication.  
 Configuring Web SSO Authentication by Using ADFS 
 Web Single Sign - On will allow users in a company other than your own to access servers 
hosted by you. It accomplishes this by using their existing Active Directory accounts. 
Web SSO relies on Active Directory Federation Services to create a trust relationship 
between two companies, which results in a one - time logon for end users. After a user is 
authenticated, they are given an authentication token (cookie). 
 Summary 
 Proper conﬁ guration of email, logging, alerts, and workﬂ ow settings is vital to a productive 
SharePoint Foundation installation. Taking the time to conﬁ gure these settings, as well 
as antivirus settings, will ensure that all SharePoint Foundation sites are running at peak 
performance. 
 In this chapter, you saw how powerful an application SharePoint Foundation can 
become when you create and extend web applications. Never overlook the value of quota 
templates to ensure that site collections do not grow out of control. This chapter also 
stressed the importance of a properly planned and executed upgrade from WSS 3.0 to 
SharePoint Foundation. 
 As you plan a SharePoint Foundation installation, devote some time to deciding how 
users will be authenticated. SharePoint Foundation supports several security scenarios, 
such as standard Windows authentication, a simple database, using a company identity 
management system, and Web Single Sign - On.  
■
■
Summary 
1001

1002 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
 Exam Essentials  
  Understand how to perform an upgrade.   It is important for you to be familiar with the 
recommended upgrade procedures. Knowing what the prerequisites are will prove valuable.  
  Know the authentication types.   Review all forms of authentication and the differences 
between Basic, Digest, NTLM, and ADFS. It ’ s important to know when and why to use 
each type. 
  Understand logging.   Know where you would look to ﬁ nd event logs for SharePoint 
Foundation events. Review what information is collected and how to set up trace logging.  
  Know how to configure incoming and outgoing email.   Review and understand how 
to conﬁ gure both incoming and outgoing email settings. Understand how a SharePoint 
Foundation site can beneﬁ t from using these features. 

Review Questions 
1003
 Review Questions  
 1. 
  Where can you configure email, workflow, and logging settings?  
 A.   SharePoint Community Portal  
 B.   SharePoint Central Administration site  
 C.   Site actions  
 D.   Team site  
 2. 
  The term  safe email servers  refers to what?  
 A.   Email servers that are configured properly  
 B.   Email servers that are not on the DNS blacklist  
 C.   Servers you deem safe to receive emails from  
 D.   Servers that are on the same Active Directory domain  
 3. 
 For users to be able to configure email alerts, they must have at least what level of 
permissions?  
 A.   Site Administrator  
 B.   Read and Write  
 C.   Full  
 D.   View  
 4. 
  What service must be installed before you can send out emails and alerts from your 
SharePoint Foundation server?  
 A.   DNS  
 B.   SMTP  
 C.   Active Directory  
 D.   SNMB  
 5. 
  You are the network administrator for your company. Your network contains a SharePoint 
2010 server farm. The farm contains two web applications named WebAppA and 
WebAppB. You need to ensure that WebAppA is enabled for outgoing email. Where do you 
configure the email settings for WebAppA?  
 A.   General settings  
 B.   Manage Features  
 C.   Service Connections settings 
 D.   User Policy  

1004 
Chapter 24 ■ Configuring Windows SharePoint 2010 Foundation
  6. 
 You deploy a server that has Microsoft SharePoint Foundation 2010 installed. You need to 
ensure that users can create alerts. What should you modify from Central Administration?  
 A.   Send To connections  
 B.   Information Rights Management 
 C.   Outgoing E - Mail settings  
 D.   Workflow settings  
  7. 
  When choosing the level of event to log, what should you keep in mind?  
 A.   SharePoint Foundation will record events that are greater than or equal to the selected 
event.  
 B.   How many users will be accessing your SharePoint Foundation site.  
 C.   How much free space is left on your SharePoint Foundation server hard drives.  
 D.   SharePoint Foundation will record events that are equal to or less than the selected 
event.  
  8. 
  Your network contains a server named Server1 that has Microsoft SharePoint Foundation 
2010 installed. You need to ensure that Server1 accepts email only from authorized SMTP 
servers. What should you configure?  
 A.   From the settings of the libraries, modify the permissions.  
 B.   From the settings of the libraries, modify the Incoming E - mail settings. 
 C.   From Central Administration, modify the Incoming E - mail settings. 
 D.   From Central Administration, modify the list of approved distribution groups.  
 9. 
  On a properly configured SharePoint Foundation server using an antivirus solution, when 
would you allow users to download infected documents?  
 A.   When users complain that they need the document for a project deadline.  
 B.   Always, because most all of the warnings in a SharePoint Foundation site are 
considered false positives.  
 C.   Only when you have a specific reason, such as troubleshooting a virus on your system.  
 D.   Only when you have an antivirus solution on the end users ’ computers.  
 10.   You are the network administrator for your company, and your network contains a server 
that has Microsoft SharePoint Foundation 2010 installed. You want to configure the 
Incoming E - mail settings to use the Automatic settings mode. What should you do first?  
 A.   Configure the Outgoing E - mail settings. 
 B.   Configure the Message Queuing feature.  
 C.   Install the SMTP Server feature.  
 D.   Install the Message Queuing Triggers feature.  

 Answers to Review Questions 
 1. 
B .  Email, workﬂ ow, and logging are conﬁ gured from the SharePoint Foundation Central 
Administration site.  
 2. 
C.  When you conﬁ gure incoming email settings, you enter the DNS names or IP addresses 
of servers from which you can safely receive incoming email.  
 3. 
D .  Users must have at least View permissions to conﬁ gure alerts.  
 4. 
B.  Before you can enable outgoing email, you must install the SMTP service. The SMTP 
service is a component of IIS and must be running on at least one server in your farm.  
 5. 
A .  You conﬁ gure incoming and outgoing email settings in the General Settings section of 
the SharePoint Central Administration site.  
 6. 
C .  Alerts can be sent using email. To set up the email alerts, you must conﬁ gure the 
Outgoing E - mail settings in Central Administration.  
 7. 
A .  You always want to choose the least - critical event to monitor because SharePoint 
Foundation will record only events that are greater than or equal to the selected event.  
 8. 
C .  From Central Administration you can modify the Incoming E - mail settings. 
 9. 
C .  You should enable the feature to download infected documents only when you are 
troubleshooting a virus or if you have a speciﬁ c reason. By default, you want to disable this 
feature.  
 10. C .  SMTP is the Simple Mail Transfer Protocol, and SMTP is required for email.  
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at  www
.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
1005


Using Virtualization 
in Windows Server 
2008 R2  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Deploying Servers 
 Configure Windows Server Hyper - V and virtual machines. 
May include but is not limited to: virtual networking; 
virtualization hardware requirements; Virtual Hard Disks; 
migration types; Integration Services; dynamic memory 
allocation; dynamic virtual machine storage; import/export; 
snapshot.  

■
 Chapter 
25

 Hyper - V is a new server role in Windows Server 2008 R2 that 
allows you to virtualize your environment and therefore run 
multiple virtual operating system instances on a physical server 
simultaneously. This not only helps you to improve server utilization, it also helps you to 
create a more cost - effective and dynamic system. 
 In this chapter, you will learn the basic concepts and features of Hyper - V that a Windows 
Server 2008 R2 technical specialist must know. You will also get a solid understanding of 
what is important in virtualization and in what areas of your work life you can use it. 
 Hyper - V Overview 
 In the following sections, we ’ ll introduce you Hyper - V. To begin, we ’ ll take a look at 
virtualization and what types of virtualization exist. We will then discuss Hyper - V features 
and the Hyper - V architecture before ﬁ nishing up with the Hyper - V requirements for 
software and hardware. 
 What Is Virtualization? 
 Virtualization is a method for abstracting physical resources from the way they interact 
with other resources. For example, if you abstract the physical hardware from the 
operating system, you get the beneﬁ t of being able to move the operating system between 
different physical systems. 
 This is called server virtualization. But there are also other forms of virtualization 
available, such as presentation virtualization, desktop virtualization, and application 
virtualization. We will now brieﬂ y explain the differences between these forms 
of virtualization:
 Server Virtualization   This basically enables multiple servers to run on the same 
physical server. Hyper - V is a server virtualization tool that allows you to move physical 
machines to virtual machines and manage them on a few physical servers. Thus, you will 
be able to consolidate physical servers.  
 Presentation Virtualization   When you use presentation virtualization, your applications 
run on a different computer and only the screen information is transferred to your 
computer. An example for presentation virtualization is Microsoft Remote Desktop 
Services in Windows Server 2008 R2.  

 Desktop Virtualization   This provides you with a virtual machine on your desktop, 
comparable to server virtualization. You run your complete operating system and 
applications in a virtual machine, so your local physical machine just needs to run a very 
basic operating system. An example of this form of virtualization is Microsoft Virtual PC.  
 Application Virtualization   Application virtualization helps to prevent conﬂ icts between 
applications on the same PC. Thus it helps you to isolate the application running 
environment from the operating system installation requirements by creating application -
 speciﬁ c copies of all shared resources and helps reduce application - to - application 
incompatibility and testing needs. An example of an application virtualization tool is 
Microsoft Application Virtualization (App - V).  
 Hyper - V Features 
 As a lead - in to the virtualization topic and Hyper - V, we will start with a list of key 
features, followed by a list of supported guest operating systems. This should provide you 
with a quick high - level view of this feature before we dig deeper into the technology. 
 Key Features of Hyper - V 
 The following list provides the key features of Hyper - V:
 New Architecture   The hypervisor - based architecture that has a 64 - bit micro - kernel 
provides a new array of device support as well as performance and security improvements.  
 Operating System Support   Both 32 - bit and 64 - bit operating systems can run 
simultaneously in Hyper - V. Also, different platforms like Windows, Linux, and others are 
supported.  
 Support for Symmetric Multiprocessors   Support for up to four processors in a virtual 
machine environment provides you with the ability to run applications as well as multiple 
virtual machines faster.  
 Network Load Balancing   Hyper - V provides support for Windows Network Load 
Balancing (NLB) to balance the network load across virtual machines on different servers.  
 New Hardware Architecture   Hyper - V ’ s new architecture provides improved utilization of 
resources like networking and disks.  
 Quick Migration   Hyper - V ’ s quick migration feature provides you with the functionality 
to run virtual machines in a clustered environment with switch - over capabilities when there 
is a failure. Thus, you can reduce downtime and achieve higher availability of your virtual 
machines.  
 Virtual Machine Snapshot   You can take snapshots of running virtual machines, which 
provides you with the capability to easily recover to any previous virtual machine snapshot 
state quickly.  
Hyper-V Overview 
1009

1010 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
  Scripting   Using the Windows Management Instrumentation (WMI) interfaces and APIs, 
you can easily build custom scripts to automate processes in your virtual machines.  
  Dynamic Memory   Dynamic Memory is a new feature of Hyper - V that allows Hyper - V to 
automatically balance memory among running virtual machines. Dynamic Memory allows 
Hyper - V to adjust the amount of memory available to the virtual machines in response to 
the needs of the virtual machine. Dynamic Memory is currently available for Hyper - V in 
Windows Server 2008 R2 Service Pack 1 (SP1).  
 Supported Guest Operating Systems 
 The following guest operating systems have been successfully tested on Hyper - V and are 
hypervisor aware: 
 Windows Server 2008 R2 (VMs conﬁ gured with one, two, or four virtual processors)  
 Windows Server 2008 x64 Edition (VMs conﬁ gured with one, two, or four virtual 
processors)  
 Windows Server 2008 x86 (VMs conﬁ gured with one, two, or four virtual processors)  
 Windows Server 2003 x86 (VMs conﬁ gured with one or two virtual processors)  
 Windows Server 2003 R2 x86 (VMs conﬁ gured with one or two virtual processors)  
 Windows Server 2003 R2 x64 (VMs conﬁ gured with one or two virtual processors)  
 Windows Server 2003 x64 Edition (VMs conﬁ gured with one or two virtual 
processors)  
 Windows 7 x86 Edition (VMs conﬁ gured with one, two, or four virtual processors)  
 Windows 7 x64 Edition (VMs conﬁ gured with one, two, or four virtual processors)  
 Windows Vista x86 (VMs conﬁ gured with one or two virtual processors)  
 Windows Vista x64 Edition (VMs conﬁ gured with one or two virtual processors)  
 Linux Distributions (VMs conﬁ gured with one, two, or four virtual processors)  
 The list of supported guest operating systems may always be extended. 
Please check the official Microsoft Hyper - V site to get a current list of 
supported operating systems:  www.microsoft.com/virtualization . 
 Hyper - V Architecture 
 This section will provide you with an overview of the Hyper - V architecture (see Figure 25.1). 
We ’ ll explain the differences between a hypervisor - aware and non - hypervisor - aware child 
partition. 
■
■
■
■
■
■
■
■
■
■
■
■

 As you can see, Hyper - V is based on the new microkernel architecture. Hyper - V provides 
a virtualization layer called a hypervisor that runs directly on the system hardware. You 
can see that the hypervisor is similar to what the kernel is to Windows. 
 It is a software layer responsible for the interaction with the core hardware and works in 
conjunction with an optimized instance of Windows Server 2008 R2 that allows running 
multiple operating systems on a physical server simultaneously. The Hyper - V architecture 
consists of the hypervisor and parent and child partitions. 
 The Windows Server 2008 R2 operating system runs in the parent partition and 
provides the WMI provider for scripting as well as the VM service. 
 Virtual machines run each in their own child partitions. Child partitions do not have 
direct access to hardware resources; instead, they have a virtual view of the resources, 
which are called virtual devices. 
 If you ’ re running a hypervisor - aware operating system like Windows Server 2003, 
Windows Server 2008, or Windows Server 2008 R2 in your virtual machine, any request 
to the virtual devices is redirected via the high - speed bus to the devices in the parent 
partition, which will manage the requests. 
 By default, only Windows Server 2008 and 2008 R2 are hypervisor - aware operating 
systems. Once you install the Hyper - V Integration Components on an operating system 
other than Windows Server 2008, it will be hypervisor aware. Microsoft provides a 
hypervisor adapter to make Linux hypervisor aware. 
 Non - hypervisor - aware operating systems (e.g., Windows NT 4.0) use an emulator to 
communicate with the Windows hypervisor, which is slower than using the Imbues.  
Parent partition
Child partitions
Virtualization stack
WMI provider
VM service
VM worker
process
User mode
Kernel mode
Windows Server
2008
Windows 
kernel
VSP
Applications
Windows 
kernel
Hypervisor-aware
OS (e.g., Windows
Server 2003, 2008)
Integration
components
Applications
Linux Integration
components
Applications
Xen-enabled Linux
kernel
Non-hypervisor-
aware OS
Emulation
VMBus
Hyper-V hypervisor
Hardware
 F I G U R E 2 5 .1 Hyper - V architecture 
Hyper-V Overview 
1011

1012 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 Hyper - V Requirements 
 The following sections will describe the hardware and software requirements for installing 
the Hyper - V server role. It is important to understand these requirements for obtaining 
your software license as well as for planning for server hardware. When you understand 
the requirements, you can design and conﬁ gure a Hyper - V solution that will meet the needs 
of your applications. 
 Hardware Requirements 
 In addition to the basic hardware requirements for Windows Server 2008 R2, there are 
requirements for running the Hyper - V server role on your Windows server. They are listed 
in Table 25.1.  
 TA B L E 2 5 .1 Hardware requirements for Hyper - V 
  Requirement Area  
  Definition  
  CPU  
  x64 - compatible processor with Intel VT or AMD - V technology 
enabled. 
 Hardware Data Execution Prevention (DEP), specifically Intel XD 
bit (execute disable bit) or AMD NX bit (no execute bit), must be 
available and enabled. 
 Minimum 1.4 GHz. 
 Recommended: 2 GHz or faster. 
  Memory  
  Minimum: 1 GB RAM. 
 Recommended: 2 GB RAM or greater (additional RAM is required 
for each running guest operating system). 
 Maximum 1 TB 
  Hard disk  
 Minimum: 8 GB. 
 Recommended: 20 GB or greater (additional disk space needed for 
each guest operating system). 
 The Add Roles Wizard in Server Manager additionally veriﬁ es the hardware 
requirements. A good starting point is to check your hardware against the Microsoft 
hardware list to make sure your hardware is supported by Windows Server 2008 R2. 
If you try to install the Hyper - V server role on a computer that does not meet the CPU 
requirements, you ’ ll get a warning window that looks like Figure 25.2. 

 Software Requirements 
 To use virtualization in Windows Server 2008 or Windows Server 2008 R2, you need to 
consider the basic software requirements for Hyper - V. Hyper - V runs only on the following 
editions of the Windows Server 2008 operating system: 
 Windows Server 2008 Standard  
 Windows Server 2008 Enterprise  
 Windows Server 2008 Datacenter  
 Windows Server 2008 R2 Standard  
 Windows Server 2008 R2 Enterprise  
 Windows Server 2008 R2 Datacenter  
 Hyper - V Installation and Configuration 
 The following sections explain how to install the Hyper - V role using Server Manager in 
Windows Server 2008 R2 Full installation mode or the command line in Windows Server 
2008 R2 Server Core. We will then take a look at Hyper - V as part of Server Manager 
before discussing how to use the Hyper - V Manager. Finally, we will look at the Hyper - V 
server settings and then cover two important areas for Hyper - V: virtual networks and 
virtual hard disks. 
 Install the Hyper - V Role 
 Now it ’ s time to see how to install the Hyper - V server role on the two installation options 
of Windows Server 2008 R2, namely, a Full installation as well as Server Core. 
 Installing Hyper - V in Full Installation Mode 
 You can install the Hyper - V server role on any Windows Server 2008 R2 installation for 
which the Full option was chosen. In addition, the server must meet both the hardware and 
software requirements. The installation process is simple, as Exercise 25.1 shows.  
■
■
■
■
■
■
 F I G U R E 2 5 . 2 Warning window that Hyper - V cannot be installed 
Hyper-V Installation and Configuration 
1013

1014 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 E X E R C I S E  2 5 .1
Installing Hyper - V in Full Installation Mode  
 1. 
  Click Start   Administrative Tools   Server Manager. 
 2. 
  In Server Manager, choose Roles   Add Roles.  
 3. 
  On the Select Server Roles page, check Hyper - V and click Next. 
 4. 
  On the Hyper - V page, click next.  
 5. 
  On the Create Virtual Networks page, leave Local Area Connection unchecked, and 
click Next. 
 6. 
  On the Conﬁ rm Installation Selections page, review the selection and then click Install. 
 7. 
  After the installation is ﬁ nished, click the Close button.  
 8. 
  Now the Add Roles Wizard will pop up and ask you to restart the system. Click Yes to 
perform a restart. 
 9. 
  After the system restarts and you log in again, the Resume Conﬁ guration Wizard appears 
and ﬁ nishes the installation. Once the Installation Results page appears, click Close. 
 Installing Hyper - V in Server Core 
 Introduced in Windows Server 2008 is the Server Core installation option, which creates 
an operating system installation without a GUI shell. You can either manage the server 
remotely from another system or use the Server Core ’ s command - line interface. 
 This installation option provides the following beneﬁ ts: 
 Reduces attack surface (because fewer applications are running on the server)  
 Reduces maintenance and management (because only the required options are 
installed)  
 Requires less disk space and produces less processor utilization  
 Provides a minimal parent partition  
 Reduces system resources required by the operating system as well as the attack surface  
 Using Hyper - V on a Server Core installation, you can fundamentally improve 
availability because the attack surface is reduced and downtime required for installing 
patches is optimized. It will thus be more secure and reliable with less management. 
 To install Hyper - V for a Windows Server 2008 installation, you must execute the 
following command in the command - line interface: 
start /w ocsetup Microsoft-Hyper-V 
 Because the  ocsetup command is case sensitive, make sure you write  Microsoft - Hyper - V 
exactly as shown. Otherwise you will get an error message and Hyper - V won ’ t be added as 
a server role. 
■
■
■
■
■

 To install Hyper - V on a Windows Server 2008 R2 server, you can use the  DISM command.  
Dism /online /enable-feature /featurename:Microsoft-Hyper-V 
 Hyper - V in Server Manager 
 As with all the other Windows Server 2008 R2 roles, the Hyper - V role neatly integrates 
into Server Manager. Server Manager ﬁ lters the information just for the speciﬁ c role and 
thus displays only the required information. As you can see in Figure 25.3, the Hyper - V 
Summary page shows related event log entries, the state of the system services for 
Hyper - V, and useful resources and support.  
 F I G U R E  2 5 . 3 Hyper - V in Server Manager 
 Using Hyper - V Manager 
 Hyper - V Manager is the central management console to conﬁ gure your server and create 
and manage your virtual machines, virtual networks, and virtual hard disks. Unlike 
Virtual Server 2005, where you managed all virtual machines through a web interface, 
Hyper - V Manager is managed through a Microsoft Management Console (MMC) snap - in. 
You can access it either in Server Manager or by using Start   Administrative Tools   
Hyper - V Manager. Figure 25.4 shows how Hyper - V Manager looks once you start it.  
Hyper-V Installation and Configuration 
1015

1016 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 F I G U R E 2 5 . 4 Hyper - V Manager 
 Hyper - V Manager is available for the following operating systems: 
 Windows Server 2008 R2  
 Windows Server 2008  
 Windows 7  
 Windows Vista with Service Pack 1 (SP1)  
 Hyper - V Manager is installed on a Windows Server 2008 R2 machine only when you 
install Hyper - V on it. On Windows 2008, Windows Vista, or Windows 7 you will need 
to install the Hyper - V Manager MMC. 
 You can use Hyper - V Manager to connect to any Full or Server Core installation remotely. 
Besides Hyper - V Manager, you can use the WMI interface for scripting Hyper - V.  
 Configure Hyper - V Settings 
 In this section, you will get an overview of the available Hyper - V settings for the server. 
You conﬁ gure all server - side default conﬁ guration settings like default locations of your 
conﬁ guration ﬁ les or the release key. You can open the Hyper - V Settings page (Figure 25.5) 
in Hyper - V Manager by clicking Hyper - V Settings in the Actions pane.  
■
■
■
■

 F I G U R E 2 5 . 5 Hyper - V Settings 
 The Hyper - V Settings page includes the following settings:
 Virtual Hard Disks   Speciﬁ es the default location of your virtual hard disk ﬁ les ( .vhd ). 
 Virtual Machines   Speciﬁ es the default location of your virtual machine conﬁ guration 
ﬁ les. It includes the Virtual Machine XML conﬁ guration ﬁ les (part of the  Virtual 
Machines folder) as well as related snapshots (part of the  Snapshot folder).  
 Keyboard   Deﬁ nes how to use Windows key combinations. Options are Physical 
Computer, Virtual Machine, and Virtual Machine Only When Running Full Screen.  
 Release Key   Speciﬁ es the key combination to release the mouse in your virtual machine. 
Options are Ctrl+Alt+left arrow, Ctrl+Alt+right arrow, Ctrl+Alt+space, and Ctrl+Alt+Shift.  
 User Credentials   Speciﬁ es whether you want to use your default credentials to connect to 
a running virtual machine.  
 Delete Saved Credentials   Deletes any saved credentials stored on this computer.  
 Reset Check Boxes   Resets any check boxes that hide pages and messages when checked. 
This will bring up again any window on which you checked the Do Not Show This 
Window Again check box.  
 Manage Virtual Networks 
 A virtual network provides the virtual links between nodes in either a virtual or a physical 
network. Virtual networking in Hyper - V is provided in a secure and dynamic way because 
Hyper-V Installation and Configuration 
1017

1018 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
you can granularly deﬁ ne virtual network switches for their required usage. For example, you 
can deﬁ ne a private or internal virtual network if you don ’ t want to allow your virtual 
machines to send packages to the physical network. 
 In order to allow your virtual machines to communicate with each other, you need 
virtual networks. Just like normal networks, virtual networks exist only on the host 
computer and allow you to conﬁ gure how virtual machines communicate with each other, 
with the host, and with the network or Internet. You manage virtual networks in Hyper - V 
using Virtual Network Manager, shown in Figure 25.6. 
 Using Virtual Network Manager, you can create, manage, and delete virtual networks, 
sometimes also called virtual switches. You can deﬁ ne the network type as external, 
internal only, or private:
  External   Any virtual machine connected to this virtual switch can access the physical 
network. You would use this option if you want to allow your virtual machines to access, 
for example, other servers on the network or the Internet. This option is used in production 
environments where your clients connect directly to the virtual machines.  
  Internal Only   This option allows virtual machines to communicate with each other as 
well as the host system but not with the physical network. When you create an internal 
network, it also creates a local area connection in Network Connections that allows the 
host machine to communicate with the virtual machines. You can use this if you want to 
separate your host ’ s network from your virtual networks.  
 F I G U R E 2 5 .6 Virtual Network Manager 

 Private Virtual Machine Network   When you use this option, virtual machines can 
communicate with each other but not to the host system or the physical network; thus no 
network packets are hitting the wire. You can use this to deﬁ ne internal virtual networks 
for test environments or labs, for example.  
 On the external and internal - only virtual networks, you also can enable virtual LAN 
(VLAN) identiﬁ cation. You can use VLAN to partition your network into multiple subnets 
using a VLAN ID. When you enable virtual LAN identiﬁ cation, the NIC connected to the 
switch will never see packets tagged with VLAN IDs. 
 Instead, all packets traveling from the NIC to the switch will be tagged with the access 
mode VLAN ID as they leave the switch port. All packets traveling from the switch port to 
the NIC will have their VLAN tags removed. You can use this if you are already logically 
segmenting your physical machines and also use it for your virtual ones. 
 Exercise 25.2 explains how to create an internal - only virtual network switch.  
 E X E R C I S E  2 5 . 2
Creating an Internal Virtual Network  
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, in the Actions pane, choose Virtual Network Manager.  
 3. 
  On the Create Virtual Network page, select Internal and click the Add button.  
 4. 
  On the New Virtual Network page, enter  Internal Virtual Network in the Name ﬁ eld.  
 5. 
  Click OK.  
 When you create the internal virtual network, a network device is created in Network 
Connections, as shown in Figure 25.7.  
 F I G U R E 2 5 .7 Virtual network card 
Hyper-V Installation and Configuration 
1019

1020 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 This is also the case when you create an external virtual network because it will replace 
the physical network card of the host machine to give the parent partition a virtual 
network card that is also used in the child partitions. 
 Unlike with Virtual Server 2005, Hyper - V binds the virtual network service to a 
physical network adapter only when an external virtual network is created. The beneﬁ t of 
this is that the performance is better if you do not use the external virtual network option. 
The downside, however, is that there will be a network disruption when you create or 
delete an external virtual network.  
 
Communication between the virtual machine and the local host computer is 
not configured automatically. Once you install a virtual machine, you need to 
make sure the TCP/IP settings are in agreement with the settings you define 
in the virtual network card. Start with a ping from your host machine to the 
virtual machines in order to verify that communication is working. 
 Managing Virtual Hard Disks 
 In addition to virtual networks, you also need to manage virtual hard disks that you attach 
to your virtual machines. A virtual hard disk in Hyper - V, apart from a pass - through disk, 
is a VHD ﬁ le that basically simulates a hard drive to your virtual machine. 
 The following sections will ﬁ rst show you what types of virtual hard disks are available 
and then show you how to create them. You will also learn about what options are 
available to manage virtual hard disks. 
 Types of Hard Disks 
 Depending on how you want to use the disk, Hyper - V offers various types, as described in 
Table 25.2.  
 TA B L E 2 5 . 2 Virtual hard disks in Hyper - V 
 Type of Disk  
 Description  
  When to Use It  
 Dynamically 
expanding  
 This disk starts with a small VHD file 
and expands it on demand once an 
installation takes place. It can grow 
to the maximum size you defined 
during creation. You can use this 
type of disk to clone a local hard 
drive during creation. 
 This option is effective when 
you don ’ t know the exact space 
needed on the disk and when 
you want to preserve hard disk 
space on the host machine. 
Unfortunately, it is the slowest 
disk type. 

 Type of Disk  
 Description  
  When to Use It  
 Fixed size  
  The size of the VHD file is fixed 
to the size specified when the disk 
is created. This option is faster 
than a dynamically expanding disk. 
However, a fixed size disk uses 
up the maximum defined space 
immediately. This type is ideal for 
cloning a local hard drive. 
 A fixed - size disk provides 
faster access than dynamically 
expanding or differencing disks 
but is slower than a physical 
disk.  
 Differencing  
  This type of disk is associated in a 
parent - child relationship with another 
disk. The differencing disk is the child 
and the associated virtual disk is the 
parent. Differencing disks include 
only the differences to the parent 
disk. By using this type, you can save 
a lot of disk space in similar virtual 
machines. This option is suitable if 
you have multiple virtual machines 
with similar operating systems. 
 Differencing disks are most 
commonly found in test 
environments and should 
not be used in production 
environments.  
 Physical (or 
pass - through 
disk)  
 The virtual machine receives direct 
pass - through access to the physical 
disk for exclusive use. This type 
provides the highest performance of all 
disk types and thus should be used for 
production servers where performance 
is top priority. The drive is not available 
for other guest systems.  
 This type is used in high -
 end datacenters to provide 
optimum performance for VMs. 
It ’ s also used in failover cluster 
environments.  
 Creating Virtual Hard Disks 
 To help you gain practice in creating virtual hard disks, the following three exercises will 
teach you how to create a differencing hard disk, how to clone an existing disk by creating 
a new disk, and how to conﬁ gure a physical or pass - through disk to your virtual machine. 
First, in Exercise 25.3, you will learn how to create a differencing virtual hard disk.  
 E X E R C I S E  2 5 . 3
Creating a Differencing Hard Disk 
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, on the Actions pane, choose New   Hard Disk. 
 3. 
  In the New Virtual Hard Disk Wizard, click Next on the Before You Begin page. 
 4. 
  On the Choose Disk Type page, select Differencing and click Next. 
Hyper-V Installation and Configuration 
1021

1022 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
E X E R C I S E  2 5 . 3  (c o n t i n u e d)
 5. 
  On the Specify Name And Location page, enter the new name of the child disk (for 
example,  child - disk.vhd  ). You can also modify the default location of the new VHD ﬁ le 
if you want. Click Next to continue.  
 6. 
  Next, on the Conﬁ gure Disk page, you need to specify the parent VHD ﬁ le. This will be 
the basis for your differencing disk. For example, a complete installation of Windows 
Server 2008 R2 is a good parent. Click Next to continue. 
 7. 
  On the Completing The New Virtual Hard Disk Wizard page, verify that all settings are 
correct, and click Finish to create the hard disk.  
 Exercise 25.4 will show you how to create a ﬁ xed - size disk based on a local hard drive. 
Please remember that only ﬁ xed - size or dynamically expanding disks can be used to clone a 
local hard drive during creation.  
 E X E R C I S E  2 5 . 4
Creating a Fixed - Size Disk and Cloning a Local Drive 
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, on the Actions pane, choose New   Hard Disk. 
 3. 
  In the New Virtual Hard Disk Wizard, click Next on the Before You Begin page. 
 4. 
  On the Choose Disk Type page, select Fixed Size and click Next.  
 5. 
  On the Specify Name And Location page, enter the new name of the virtual hard disk 
(for example,   clone.vhd  ). You can also modify the default location of the new VHD ﬁ le if 
you want. Click Next to continue.  
 6. 
  Next, on the Conﬁ gure Disk page, you can decide whether you want to create a blank 
virtual hard disk with a speciﬁ ed size or to copy the contents of a hard disk to the virtual 
disk. For this exercise, select Copy The Contents Of The Speciﬁ ed Physical Disk and 
select a physical drive to copy to the virtual disk. Then click Next to continue.  
 7. 
  On the Completing The New Virtual Hard Disk Wizard page, verify that all settings are 
correct, and click Finish to create the virtual hard disk and start the copy process. 
 Because the process to copy a physical drive to a virtual disk is just a normal copy process, 
you should allow enough time to complete it. The time varies depending on the size of your 
physical disk. 
 The process to add a physical or pass - through disk to a virtual machine is quite 
different. For this, you ﬁ rst need to create the virtual machine, and then you open the 

Virtual Machine Settings to conﬁ gure the physical disk. If you want to add a physical 
disk to a virtual machine, the physical disk must be set as Ofﬂ ine in Disk Management, as 
shown in Figure 25.8.  
 F I G U R E  2 5 . 8 In Disk Management you can set disks as Offline. 
 To access Disk Management, click the Start button, right - click Computer, select Manage, 
and then expand Storage in the left pane and click Disk Management. 
 You cannot share a physical disk among multiple virtual machines or with 
the host system.  
 In Exercise 25.5 we will continue our excursion into the world of virtual disks by adding 
a physical or pass - through disk to a virtual machine.  
 E X E R C I S E  2 5 . 5
Adding a Pass - Through Disk to a Virtual Machine  
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, in the Virtual Machines pane, right - click the virtual machine 
you want to add a physical drive to and then choose Settings. Remember, the virtual 
machine state must be set to Off to conﬁ gure hard drive settings.  
 3. 
  In the Settings window, in the Hardware pane, choose IDE Controller 0.  
Hyper-V Installation and Configuration 
1023

1024 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
E X E R C I S E  2 5 . 5  (c o n t i n u e d)
 4. 
  In the IDE Controller pane, select Hard Drive and click the Add button.  
 5. 
  In the Hard Drive pane, you now need to select Physical Hard Disk and select the 
appropriate disk drive in the drop - down list.  
 6. 
  Click OK.  
 Physical or pass - through disks might not be that important if your use for virtualization 
is based on test environments, but it gets crucial when you need to plan for highly available 
virtual datacenters. This is especially true if you consider using failover clusters to provide the 
Quick Migration feature, which is when you should consider matching one logical unit number 
(LUN) from your enterprise storage system or storage area network (SAN) as one physical 
disk. This provides you with the optimum performance you need in such an environment.  
 Managing Virtual Hard Disks 
 Hyper - V also provides two tools to manage virtual hard disks: Inspect Disk and Edit Disk. 
These tools are available on the Actions pane in Hyper - V Manager:
  Inspect Disk   This provides you with information about the virtual hard disk. It 
shows you not only the type of the disk but also information like the maximum size for 
dynamically expanding disks and the parent VHD for differencing disks.  
  Edit Disk   This provides you with the Edit Virtual Hard Disk Wizard, which you can use 
to compact, convert, expand, merge, or reconnect hard disks. Figure 25.9 shows you the 
wizard ’ s options when you select a dynamically expanding disk.  
 F I G U R E 2 5 . 9  The Edit Virtual Hard Disk Wizard 

Configuring Virtual Machines 
1025
 Table 25.3 provides you with an overview of what you can do with the wizard.  
 TA B L E 2 5 . 3 Edit Disk overview 
 Action  
  Description  
 Compact  
  Reduces the size of a dynamically expanding or differencing disk by 
removing blank space from deleted files. 
 Convert  
  Converts a dynamically expanding disk to a fixed disk or vice versa.  
 Expand  
  Increases the storage capacity of a dynamically expanding disk or a 
fixed virtual hard disk.  
 Merge  
 Merges the changes from a differencing disk into either the parent disk 
or another disk (applies to differencing disks only!). 
 Reconnect  
  If a differencing disk does not find its referring parent disk anymore, this 
option can reconnect the parent to the disk. 
 Configuring Virtual Machines 
 The following sections cover the topics of creating and managing virtual machines as well 
as how to back up and restore virtual machines using features like Import and Export and 
Snapshot. We ’ ll also brieﬂ y cover Hyper - V ’ s Live Migration feature. 
 Creating and Managing Virtual Machines 
 It is important to learn how to create a virtual machine, how to change its conﬁ guration, 
and how to delete it. We will take a look at the Virtual Machine Connection tool and 
install the Hyper - V Integration Components onto a virtual machine. 
 Virtual Machines 
 Virtual machines deﬁ ne the child partitions in which you run operating system instances. 
Each virtual machine is separate and can communicate with the others only by using a 
virtual network. You can assign hard drive(s), virtual network(s), DVD drives, and other 
system components to it. A virtual machine is similar to an existing physical server, but 
it doesn ’ t run on dedicated hardware anymore—it shares the hardware of the host system 
with the other virtual machines that run on the host. 
 Exercise 25.6 shows you how to create a new virtual machine.  

1026 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 E X E R C I S E  2 5 . 6
Creating a New Virtual Machine 
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, on the Actions pane, choose New   Virtual Machine. 
 3. 
  In the New Virtual Machine Wizard, click Next on the Before You Begin page. 
 4. 
  On the Specify Name And Location page, give your virtual machine a name and change 
the default location of the virtual machine conﬁ guration ﬁ les. Click Next to continue. 
 5. 
  On the Assign Memory page, deﬁ ne how much of your host computer ’ s memory you 
want to assign to this virtual machine. Remember that once your virtual machine 
uses up all your physical memory, it will start swapping to disk, thus reducing the 
performance of all virtual machines. Click Next to continue. 
 6. 
  On the Conﬁ gure Networking page, select the virtual network that you previously 
conﬁ gured using Virtual Network Manager. Click Next to continue. 
 7. 
  On the next page, you conﬁ gure your virtual hard disk. You can create a new virtual 
hard disk, select an existing disk, or choose to attach the hard disk later. Be aware that 
you can create only a dynamically expanding virtual disk on this page; you cannot 
create a differencing, physical, or ﬁ xed virtual hard disk here. However, if you created 
the virtual hard disk already, you can, of course, select it. Click Next to continue.  
 8. 
  On the Installation Options page, you can select how you want to install your 
operating system. You have the option to install an operating system later, install 
the operating system from a boot CD/DVD - ROM where you can select a physical device 
or an image ﬁ le (ISO ﬁ le), install an operating system from a ﬂ oppy disk image (VFD 
ﬁ le, or a virtual boot ﬂ oppy disk), or install an operating system from a network - based 
installation server. The last option will install a legacy network adapter to your virtual 
machine so you can boot from the network adapter. Select Install An Operating System 
Later and then click Next. 
 9. 
  On the Completing The New Virtual Machine Wizard summary page, verify that all 
settings are correct. You also have the option to immediately start the virtual machine 
after creation. Click Next to create the virtual machine. 
 After completing Exercise 25.6, you will have a virtual machine available in 
Hyper - V Manager. Initially, the state of the virtual machine will be Off. Virtual machines 
can have the following states: Off, Starting, Running, Paused, and Saved. You can change 
the state of a virtual machine in the Virtual Machines pane by right - clicking the virtual 
machine ’ s name, as shown in Figure 25.10, or by using the Virtual Machine Connection 
window.  

Configuring Virtual Machines 
1027
 Here is a list of all state options available for a virtual machine:
 Start   Turn on the virtual machine. This is similar to pressing the power button when 
the machine is turned off. This option is available when your virtual machine is off or in 
saved state.  
 Turn Off   Turn off the virtual machine. This is similar to pressing the power off button on 
the computer. This option is available when your virtual machine is in running, saved, or 
paused state. 
 Shut Down   This option shuts down your operating system. You need to have the Hyper - V 
Integration Components installed on the operating system; otherwise, Hyper - V will not be 
able to shut down the system.   
 Save   The virtual machine is saved to disk in its current state. This option is available 
when your virtual machine is running or in paused state.  
 Pause   Pause the current virtual machine, but do not save the state to disk. You can use 
this option to quickly release processor utilization from this virtual machine to the host 
system.  
 F I G U R E 2 5 .10 Options available when right - clicking a virtual machine 

1028 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
  Reset  Reset the virtual machine. This is like pressing the reset button on your computer. 
You will lose the current state and any unsaved data in the virtual machine. This option is 
available when your virtual machine is running or in paused state.  
  Resume   When your virtual machine is paused, you can resume it and bring it online again.  
 Changing Configuration on an Existing Virtual Machine 
 To change the conﬁ guration settings on an existing virtual machine, you right - click your 
virtual machine ’ s name in the Virtual Machines pane in Hyper - V Manager and choose 
Settings. You can change settings like memory allocation and hard drive conﬁ guration. All 
items that you can conﬁ gure are described in the following list:
  Add Hardware   Add devices to your virtual machine, namely a SCSI controller, a network 
adapter, or a legacy network adapter. A legacy network adapter is required if you want to 
perform a network - based installation of an operating system.  
  BIOS   This is the replacement of the virtual machine ’ s BIOS. Because you cannot enter 
the BIOS during startup anymore, you need to conﬁ gure it with this setting. You can turn 
Num Lock on or off and change the basic startup order of the devices.  
  Memory   Change the amount of random access memory (RAM) allocated to the virtual 
machine.  
 Processor   Change the number of logical processors this virtual machine can use as well 
as deﬁ ne resource control to balance resources among virtual machines by using a relative 
weight. 
  IDE Controller   Add/change and remove devices from the IDE controller. You can have 
hard drives or DVD drives as devices. Every IDE controller can have up to two devices 
attached, and by default you have two IDE controllers available.  
  Hard Drive   Select a controller to attach to this device as well as specify the media 
to use with your virtual hard disk. The available options are Virtual Hard Disk ( .vhd ), 
File (with additional buttons labeled New, Edit, Inspect, and Browse that are explained 
in the virtual hard disk section), and Physical Hard Disk. You can also remove the 
device here.  
  DVD Drive   Select a controller to attach to this device as well as specify the media to use 
with your virtual CD/DVD drive. The available options are None, Image File (ISO Image), 
and Physical CD/DVD Drive Connected To The Host Computer. You also can remove the 
device here.  
  SCSI Controller   Conﬁ gure all hard drives that are connected to the SCSI controller. 
You can add up to 63 hard drives to each SCSI controller, and you can have multiple SCSI 
controllers available.  

Configuring Virtual Machines 
1029
 Network Adapter   Specify the conﬁ guration of the network adapter or remove it. You can 
also conﬁ gure for each adapter the virtual network and MAC address and enable virtual 
LAN identiﬁ cation.  
 COM 1   Conﬁ gure the virtual COM port to communicate with the physical computer 
through a named pipe. You have COM1 and COM2 available.  
 Diskette   Specify a virtual ﬂ oppy disk ﬁ le to use.  
 Name   Edit the name of the virtual machine and provide some notes about it.  
 Integration Services   Deﬁ ne what integration services are available to your virtual 
machine. Options are Operating System Shutdown, Time Synchronization, Data Exchange, 
Heartbeat, and Backup (Volume Snapshot).  
 Snapshot File Location   Deﬁ ne the default ﬁ le location of your snapshot ﬁ les.  
 Automatic Start   Deﬁ ne what this virtual machine will do when the physical computer 
starts. Options are Nothing, Automatically Start If The Service Was Running, and Always 
Start This Virtual Machine. You also can deﬁ ne a start delay here.  
 Automatic Stop   Deﬁ ne what this virtual machine will do when the physical computer 
shuts down. Options are Save State, Turn Off, and Shut Down.  
 Please be aware that only some settings can be changed when the 
virtual machine ’ s state is Running. It is best practice to shut down 
the virtual machine before you modify any setting.  
 Deleting Virtual Machines 
 You can also delete virtual machines using Hyper - V Manager. However, this deletes only 
the conﬁ guration ﬁ les, not any related virtual disks, as shown in Figure 25.11.  
 F I G U R E 2 5 .11 Delete Virtual Machine warning window 
 Make sure you manually delete any virtual disks that were part of the virtual machines 
in order to free up disk space.  

1030 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 Virtual Machine Connection 
 Similar to the Virtual Machine Remote Control (VMRC) client that was available with 
Virtual Server 2005 R2 and previous versions, Hyper - V comes with Virtual Machine 
Connection to connect to virtual machines that run on a local or remote server. 
 You can use it to log onto the virtual machine and use your computer ’ s mouse and 
keyboard to interact with the virtual machine. You can open Virtual Machine Connection 
in Hyper - V Manager by double - clicking a virtual machine or right - clicking a virtual 
machine and selecting Connect. If your virtual machine is turned off, you might see a 
window similar to the one in Figure 25.12.  
 F I G U R E 2 5 .12 Virtual Machine Connection window when the machine is turned off 
 Virtual Machine Connection provides you with functionality similar to that of Hyper - V 
Manager, such as being able to change the state of a virtual machine, but it also provides 
you with additional features that are especially useful when you want to work with a 
virtual machine:
  File Access Settings or Exit Virtual Machine Connection   Change the state of a virtual 
machine and create or revert a snapshot. Additionally, you have the options to send 
Ctrl+Alt+Delete to your virtual machine and Insert Integration Services Setup Disk.  
 Context - sensitive buttons are available under the menu bar to provide you with quick 
access to the most important features, as you can see in Figure 25.13.  

Configuring Virtual Machines 
1031
 Installing Hyper - V Integration Components 
 Hyper - V Integration Components, also called Integration Services, are required to make 
your guest operating system  “ hypervisor aware. ” Similar to the VM Additions that 
were part of Microsoft Virtual Server 2005, the components improve the performance 
of the guest operating system once the components are installed. On the architectural 
perspective, virtual devices are redirected directly via the VMBus, thus quicker access to 
resources and devices is provided. 
 If you do not install the Hyper - V Integration Components, the guest operating system 
uses emulation to communicate with the host ’ s devices, which of course makes the guest 
operating system slower. 
 Exercise 25.7 shows you how to install Hyper - V Integration Components on one of your 
virtual machines running Windows Server 2003.  
 F I G U R E 2 5 .13 Virtual Machine Connection window showing a running Windows 
Server 2003 virtual machine 

1032 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 E X E R C I S E  2 5 . 7
Installing Hyper - V Integration Components 
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, in the Virtual Machines pane, right - click the virtual machine on 
which you want to install Hyper - V Integration Components and select Start. 
 3. 
  Right - click the virtual machine again and select Connect To Open A Virtual Machine 
Connection. Meanwhile, your virtual machine should be already booting.  
 4. 
  If you need to log in to the operating system of your virtual machine, you should do so.  
 5. 
  Once the Windows Desktop appears, you need to select Insert Integration Services 
Setup Disk from the Actions menu of your Virtual Machine Connection window.  
 6. 
  Once the Hyper - V Integration Components are installed, you are asked to perform a 
reboot.  
 After the reboot, Hyper - V Integration Components are installed on your operating system, 
and you will be able to use them.  
 Back Up and Restore Virtual Machines 
 The following sections cover exporting and importing virtual machines between host 
machines as well as taking a snapshot to back up a certain state of your virtual machine. We 
will also brieﬂ y discuss what Quick Migration and Live Migration are and how Hyper - V 
uses them. 
 Exporting and Importing Virtual Machines 
 This section will explain how to move virtual machines between host computers or move 
them to a different drive. This is quite different from previous versions of Microsoft ’ s 
virtualization software. To move a virtual machine in Virtual Server 2005, you stopped the 
machine and moved its conﬁ guration ﬁ le (VMC) as well as its virtual hard disk ﬁ le (VHD) 
to the target location and then changed the VMC ﬁ le to point to the VHD ﬁ le. 
 Using Hyper - V, you cannot move the conﬁ guration ﬁ les anymore. You need to use the 
Export feature to export the virtual machine and then use Import on the target machine to 
import the virtual machine to Hyper - V. 
 To export a virtual machine, it must be either in Off or Saved state. Open Hyper - V 
Manager, select the virtual machine you want to export and either right - click the virtual 
machine and select Export or click Export on the virtual machine name ’ s pane. 
 In this window, you can set the export path for the virtual machine and choose whether 
to export your virtual machine state data or not.  

Configuring Virtual Machines 
1033
 Because Hyper - V will use the exported files after importing them, you 
should store the export directly on the target machine ’ s disks and not on a 
file share.  
 Once you check Don ’ t Export Virtual Machine State Data, only the virtual machine ’ s 
conﬁ guration ﬁ les will be exported. The virtual hard disk and snapshots will not be 
exported. 
 In the export path, a folder with the name of the virtual machine is created along with 
the following subfolders:
 Virtual Machines   This includes the virtual machine conﬁ guration ﬁ les as well as the 
virtual machine state if the machine is saved. 
 Virtual Hard Disks   If you exported the state data, this folder will include your virtual 
hard disks VHD ﬁ le(s).  
 Snapshots  If you exported the state data, this folder will include all snapshot ﬁ les.  
 Once the virtual machine ﬁ nishes exporting, you can move the export folder to the 
target machine if you did not store it directly on the server ’ s disks. Open Hyper - V Manager 
and click Import Virtual Machine, which is located in the Actions pane. 
 The Import Virtual Machine dialog box asks you for the path to the exported virtual 
machine and allows you to decide if you want to reuse the old virtual machine ID. 
 You want to reuse old virtual machine IDs if you ’ re moving all virtual machines from 
a host to a new target machine. The virtual machines are practically the same as on the 
source system. However, you do not want to reuse old virtual machine IDs if you used 
Export to clone a virtual machine. 
 When you import a virtual machine with state data, Hyper - V will use the import path 
for the virtual hard disks as well as snapshots in its virtual machine conﬁ guration XML. 
Thus, you ’ re able to import an exported machine only once. For that reason, the import 
folder should already be on the host ’ s target disk. 
 If you import only the virtual machine conﬁ guration, without the state data or hard 
disks, you will receive a warning message. You receive this warning because the virtual 
machine has probably one or more hard drives conﬁ gured that now point to no VHD ﬁ le. 
You need to correct these settings before starting the virtual machine to have this work.  
 Managing Snapshots 
 With virtual machine snapshots, you can save a copy of the virtual machine at any point in 
time, including while the virtual machine is running. You can take multiple snapshots of a 
virtual machine and then revert it to any previous state by applying a snapshot. 
 Using snapshots makes it easier to diagnose the cause of errors by reducing the number 
of times you need to repeat a task or sequence within a virtual machine. The beneﬁ t is 
obvious; if you use snapshots to revert to a previous virtual machine conﬁ guration, you do 
not need to copy virtual machines to keep a state. Thus it is a quick and easy way to back 
up a certain state of your virtual machine. 

1034 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 You can create a snapshot when a virtual machine is in a running, saved, or turned - off 
state. It ’ s only from a paused state that you cannot perform a snapshot.  
 Snapshots 
 Snapshots are extremely useful in training classes or testing environments. When 
your company tests new software, you can make snapshots at every single step so you 
can immediately go back if some problems or issues arise. In training classes, you can 
prepare each virtual machine for your students according to your special requirements, 
and once the course is ﬁ nished, you just revert all virtual machines to their initial 
conﬁ guration. You ’ ll no longer have hassles with experienced users who change 
your conﬁ guration without letting you know. 
 In Exercise 25.8. you ’ ll create and rename a snapshot.  
 E X E R C I S E  2 5 . 8
Creating a Snapshot of a Virtual Machine 
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, in the Virtual Machines pane, right - click the virtual machine. 
 3. 
  In the Actions pane, select Snapshot. 
 4. 
  Once the snapshot is taken, it should appear in the Snapshots pane in Hyper - V Manager. 
Right - click the snapshot and select Settings. 
 5. 
  In the Settings window, on the Management pane, click Name and type in  First 
Snapshot as the name. You can also add some notes to make it easy to identify.  
 6. 
  Click OK to apply the changes. 
 Technically speaking, when you make a snapshot, the following ﬁ les will be created in 
the virtual machine ’ s snapshot folder: 
 A virtual machine conﬁ guration ﬁ le  
 Virtual machine saved state ﬁ les  
 Snapshot differencing disks (AVHDs)  
■
■
■

Configuring Virtual Machines 
1035
 Once you create a snapshot for a virtual machine, you will also have the Revert option 
available in the virtual machine name ’ s pane in Hyper - V Manager. Reverting basically 
means that you restore the last snapshot made. You ’ ll also see the last snapshot taken 
marked with a green arrow in the Snapshots pane. 
 However, you will also have options available directly on the snapshot level that let you 
perform certain actions:
 Settings   This opens the Settings window of the virtual machine. The only settings you 
can change are the Name and the Notes ﬁ eld. All others are read - only.  
 Apply  Applying a snapshot to a virtual machine technically means that you copy the virtual 
machine state from the snapshot to the active virtual machine. You can look at this as a 
 “ restore this snapshot ” option. Because you would lose all unsaved data and settings from the 
active virtual machine, you will be asked if you want to create another snapshot before you 
apply this snapshot. If you just click Apply, the active machine will be overwritten and reverted 
to the state it was in when the snapshot was made. This snapshot will not be removed.  
 Rename   You can change the name of the snapshot without the need to open the settings.  
 Delete   Deleting a snapshot is like deleting a backup ﬁ le. You will no longer be able to 
restore to that point in time. Deleting a single snapshot does not affect any other snapshots 
that you made for this virtual machine. You will delete only the selected snapshot. 
However, sometimes when you do delete a snapshot, the system needs to merge the 
differencing disks. This occurs in the background when the virtual machine is not running. 
The user does not see when it happens.  
 Delete Snapshot Subtree   This will delete the selected snapshot and all snapshots that 
are hierarchically underneath it. If you delete a snapshot with only one sub - snapshot, 
the conﬁ guration and saved state ﬁ les for the snapshot will be deleted and the snapshot ’ s 
differencing disks will be merged. If you have more sub - snapshots, merging will not 
take place. 
 In Exercise 25.9, you will apply a snapshot and thus revert to a previous virtual 
machine state.  
 E X E R C I S E  2 5 . 9
Applying a Snapshot 
 1. 
  Click Start   Administrative Tools   Hyper - V Manager. 
 2. 
  In Hyper - V Manager, in the Virtual Machines pane, click the virtual machine for which 
you created a snapshot.  
 3. 
  In the Snapshots pane, select First Snapshot. 
 4. 
  In the First Snapshot pane, under Actions, click Apply. 
 5. 
  In the Apply Snapshot window, click Apply.  

1036 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 Live Migration and Cluster Shared Volumes 
 Another option for working with Hyper - V and clustering is live migration. Live migration 
allows a Hyper - V administrator to easily relocate running virtual machines from one node 
of the failover cluster to another node in the same cluster. This move can be done without a 
dropped network connection or perceived downtime of the virtual machine. 
 The failover clustering role must be installed and conﬁ gured on the server running 
Hyper - V in order to use the live migration feature. Shared storage is also a requirement for 
failover clustering and live migration. The virtual machines need to be stored in a shared 
storage area, and one of the nodes will run the virtual machine state. 
 Only one live migration can be in progress at any given time on a server running 
Hyper - V. This means that an administrator does not have the ability to use live migration 
to move multiple virtual machines simultaneously. 
 Microsoft recommends using the new Windows Server 2008 R2 Failover Clustering 
feature called Cluster Shared Volumes (CSV) with live migration. While the backup 
process is in progress, the CSV will remain in redirected access. The advantages of using 
CSV is increased reliability when used with live migration and virtual machines. CSV also 
provides a single, consistent ﬁ le namespace so that all servers running Windows Server 
2008 R2 see the same storage. 
 Quick Migration 
 In combination with Windows Server 2008 R2 ’ s clustering support in Enterprise and 
Datacenter editions, quick migration enables high availability features for virtual machines, 
so if one server fails, its workload can be picked up by another node member with minimal 
interruption in user access. 
 Basically, each virtual machine is deﬁ ned as a virtual machine application on a cluster 
node. Once the cluster node goes down, another cluster node can take over the virtual 
machine. Unfortunately, this means that in the event of failure, the system state of the 
virtual machine is lost because it does a normal boot - up with the virtual machine. Planned 
failover saves the current state, moves it, and then restores it on the target side correctly. 
 Summary 
 Virtualization is quickly becoming a hot topic. The potential for consolidation is 
tremendous, and thus it will get more and more important. 
 After reading this chapter, you should have a good understanding of the Hyper - V 
architecture and what it requires to install Hyper - V. 
 The section about installation and conﬁ guration covered various basic aspects of 
conﬁ guring the virtualization environment. You learned about the different types of virtual 
networks that are available, the options for installing the Hyper - V role, and the various 
types of virtual hard disks that you can use to optimize virtualization for your speciﬁ c 
scenario. 

 You also learned how to conﬁ gure virtual machines using the Hyper - V environment 
and how to create your own virtual datacenter on top of your Hyper - V machines. We 
showed you how to create and manage virtual machines, how to use Virtual Machine 
Connection to remotely control a virtual machine, and how to install Hyper - V Integration 
Components. And you learned how to export and import virtual machines as well as how 
to do snapshots of your virtual machine. 
 If you have never worked with virtualization software before, the information in this 
chapter may have been completely new to you. You should now be well prepared to try out 
Hyper - V in your own environment.  
 Exam Essentials  
 Understand Hyper - V ’ s architecture.   When you have a good understanding of Hyper - V ’ s 
architecture, especially when an operating system in a virtual machine is hypervisor aware 
versus non - hypervisor aware, you have a solid understanding of what is important from an 
architectural perspective. 
 You should know about the Hyper - V Integration Components and how they change 
the behavior of a virtual machine. Also know which operating systems the integration 
components are available for.   
 Know Hyper - V ’ s requirements and how to install it.   Know the hardware and software 
requirements as well as how to install Hyper - V. Hyper - V requires an x64 - based processor 
and Data Execution Protection (DEP), and hardware - assisted virtualization must be 
enabled. Don ’ t forget this! Also remember that you can install Hyper - V two ways: using 
Server Manager or using the command line in Server Core.  
 Understand virtual networks and virtual hard disks.   Virtual networks and hard disks 
are the two most tested topics. You deﬁ nitely should know the types of virtual networks 
available (i.e., external, internal only, and private virtual network) as well as all types of 
virtual hard disks (i.e., dynamically expanding, ﬁ xed size, differential, and physical or 
pass - through). You should be able to apply the correct one when needed. Don ’ t forget the 
Edit Virtual Hard Disk Wizard, which is also a good source for questions in the exam.  
 Know how to create and manage virtual machines.   You should be able to explain how to 
create a virtual machine, what options you have to install an operating system in a virtual 
machine, and how to install the Hyper - V Integration Components on a virtual machine. 
Don ’ t forget about the virtual machine states and the virtual machine settings!  
 Understand how to back up and restore virtual machines.   Have a good understanding of 
the concept of exporting and importing virtual machines, how snapshots work, and what 
lies behind a quick migration. Understand how you can export a virtual machine, what you 
should consider when moving it to a new host machine, and what happens after importing 
it to the import folder. The same applies to snapshots: You need to know what options you 
have available and what each option will do. Especially recognize the difference between 
applying and reverting a snapshot.  
Exam Essentials 
1037

1038 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 Review Questions  
 1. 
  On which of the following x64 editions of Windows Server 2008 R2 does Hyper - V run? 
(Choose all that apply.)  
 A.   Windows Server 2008 R2 Web Edition  
 B.   Windows Server 2008 R2 Standard Edition  
 C.   Windows Server 2008 R2 Enterprise Edition  
 D.   Windows Server 2008 R2 Datacenter Edition  
 2. 
  You want to build a test environment based on virtual machines on a single Windows 
Server 2008 R2 machine, but you also want to make sure that the virtual machines com-
municate with only each other. What type of virtual network do you need to configure?  
 A.   External  
 B.   Internal only  
 C.   Private virtual machine network  
 D.   Public virtual machine network  
 3. 
 Andy wants to change the memory of a virtual machine that is currently powered up. What 
does he need to do?  
 A.   Shut down the virtual machine, use the virtual machine ’ s settings to change the mem-
ory, and start it again. 
 B.   Use the virtual machine ’ s settings to change the memory.  
 C.   Pause the virtual machine, use the virtual machine ’ s settings to change the memory, 
and resume it.  
 D.   Save the virtual machine, use the virtual machine ’ s settings to change the memory, and 
resume it.  
  4. 
  You want to make sure the hard disk space for your virtual machines is only occupied when 
needed. What type of virtual hard disk would you recommend?  
 A.   Dynamically expanding disk  
 B.   Fixed - size disk  
 C.   Differencing disk  
 D.   Physical or pass - through disk  
 5. 
  How do you add a physical disk to a virtual machine?  
 A.   Use the Virtual Hard Disk Wizard. 
 B.   Use the Edit Virtual Hard Disk Wizard.  
 C.   Use the virtual machine ’ s settings. 
 D.   Use the New Virtual Machine Wizard. 

 6. 
 Rich bought a new server with an Itanium IA - 64 processor, 4GB RAM, and a SAN that 
provides 1TB hard disk space. After installing Windows Server 2008 R2 for Itanium - Based 
Systems, he wants to install Hyper - V on this server. Can Hyper - V be installed on this system?  
 A.   Yes  
 B.   No  
 7. 
  What are the minimum CPU requirements for running Hyper - V on a machine? (Choose all 
that apply.)  
 A.   An x64 - based processor (Intel or AMD).  
 B.   Hardware Data Execution Protection (DEP) must be enabled.  
 C.   Hardware - assisted virtualization must be enabled.  
 D.   The processor must at least have a dual core.  
 8. 
  What is the command to install Hyper - V on a Windows Server 2008 machine that was 
installed in Server Core?  
 A.   start /w ocsetup Hyper - V 
 B.   start /w ocsetup microsoft - hyper - v 
 C.   start /w ocsetup Microsoft - Hyper - V 
 D.   start /w ocsetup hyper - v 
 9. 
  On what operating systems can you install the Hyper - V Manager MMC? (Choose all that 
apply.)  
 A.   Windows Server 2008  
 B.   Windows Server 2003  
 C.   Windows XP SP3  
 D.   Windows 7  
 10.   What statement is correct for an external virtual network?  
 A.   The virtual machines can communicate with each other and with the host machine.  
 B.   The virtual machines can communicate with each other only.  
 C.   The virtual machines can communicate with each other, with the host machine, and 
with an external network.  
 D.   The virtual machines cannot communicate with each other.   
Review Questions 
1039

1040 
Chapter 25 ■ Using Virtualization in Windows Server 2008 R2
 Answers to Review Questions 
 1. 
B, C, D .  Hyper - V can be installed on Standard, Enterprise, or Datacenter Editions of 
Windows Server 2008 R2. Itanium, x86, and Web Editions are not supported.  
 2. 
C .  The external virtual network type will allow the virtual machine to communicate 
with the external network as it would with the Internet, so A is wrong. The internal - only 
network type allows communication between the virtual machines and the host machine. 
Because the question says that only communication between the virtual machines should be 
allowed, the only valid answer is private virtual machine network. The last option, public 
virtual machine network, does not exist in Hyper - V.  
 3. 
A .  This question focuses on the fact that you cannot change the memory if the virtual 
machine is running, paused, or saved. The only valid answer is to shut it down and then 
change the memory.  
 4. 
A.  The only virtual hard disk that increases in size is the dynamically expanding disk. 
Thus, this is the only valid answer to this question. The ﬁ xed - size disk creates a disk of 
the size you specify, the differencing disk is a special disk that stores only the differences 
between it and a parent disk, and the physical disk uses a physical drive and makes it 
available to the virtual machine.  
 5. 
C . Physical hard disks cannot be conﬁ gured using the Virtual Hard Disk Wizard, the Edit 
Virtual Hard Disk Wizard, or the New Virtual Machine Wizard. You can only conﬁ gure 
and attach a physical disk using the virtual machine ’ s settings. 
 6. 
B .  Hyper - V is not supported on Itanium - based systems, thus he cannot install it.  
 7. 
A, B, C .  The minimum CPU requirement for running Hyper - V is a x64 - based processor 
(Itanium is not supported), hardware Data Execution Protection must be enabled, and 
hardware - assisted virtualization must be enabled. There is no minimum requirement for a 
dual - core processor.  
 8. 
C .  This question is regarding the setup command to install the Hyper - V server role on a 
Windows Server 2008 Server Core machine. It ’ s important to remember that these commands 
are case sensitive and that the correct command is  start /w ocsetup Microsoft - Hyper - V , 
which is option C. All other commands will fail to install Hyper - V on a Server Core machine. 
If you were using a Windows Server 2008 R2 machine, you would use the  DISM command.  
 9. 
A, D.  The Hyper - V Manager is available only for Windows Server 2008 and Windows 7. 
There is no version available that runs on Windows Server 2003 or on Windows XP SP3.  
 10. C .  The virtual network type in which the machines communicate with each other and with 
the host machine is called internal only. In a private virtual network, the virtual machines 
can communicate only with each other, but not with the network or the host machine. The 
external network type deﬁ nes a network where the virtual machines can communicate with 
each other, with the host machine, and with an external network like the Internet.  
 Microsoft continually updates its question pool. We occasionally will add 
new and updated questions online. Please check the Sybex website at  www
.sybex.com/go/mctswin08r2 . 

Deploying Servers  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Deploying Servers 
■   Deploy images by using Windows Deployment Services. 
May include but is not limited to: Install from media (IFM); 
configure Windows Deployment Services; capture Windows 
Deployment Services images; deploy Windows Deployment 
Services images; dynamic driver provisioning; PXE provider; 
multicasting; VHD deployment  
■   Configure Microsoft Windows activation. May include but is 
not limited to: install a KMS server; create a DNS SRV record; 
replicate volume license data; Multiple Activation Key (MAK); 
managing activation  

 Chapter 
26

 Windows Deployment Services is a tool that allows 
administrators to easily deploy and manage images, scripts, 
and the unattended installation of computer systems. This 
service can prove to be invaluable to those tasked with the administration of a medium or 
large corporate network. 
 Windows Deployment Services can help with basic tasks such as formatting and 
partitioning a physical system, deploying a consistent set of standards across the network, 
simplifying the installation of operating systems, and performing post - installation tasks.  
 Windows Deployment Services 
 Before the development of tools such as Microsoft Windows Deployment Services (WDS), 
a network administrator was tasked with manually conﬁ guring all of the systems in a 
network to upgrade or install an operating system. This would involve many man - hours, 
costing organizations time and money. Deployment Services reduces that need to physically 
install or upgrade systems, allowing IT administrators to manage the installation of 
systems from a central location, which can result in more time to devote to other, more 
important tasks. 
 Several modiﬁ cations have been made to Windows Deployment Services from the 
previous version, which was known as Remote Installation Services (RIS) and Windows 
Deployment Services on Windows Server 2003. WDS now includes the following: 
 Ability to deploy Windows Vista, Windows 7, Windows Server 2008, and Windows 
Server 2008 R2  
 Support for Windows PE as a boot operating system  
 Ability to transmit data and images by use of multicast  
 Support for network boot of x64 - bit operating systems  
 To fully explore the latest version of WDS, you should be familiar with the 
following topics: 
 Windows image ( .wim ) format  
 Windows Pre - boot Execution Environment (PXE)  
 Active Directory  
 Dynamic Host Conﬁ guration Protocol (DHCP)  
 Windows Preinstallation Environment (WinPE)  
■
■
■
■
■
■
■
■
■

 For many small shops, and in previous years, server installations were done by manually 
installing the operating system. This means that an administrator would have to 
manually monitor and conﬁ gure each server install. 
 The resources to deploy images have improved, opening the way for a simpliﬁ ed 
deployment of servers, one that an IT administrator can trust. The beneﬁ t of WDS goes 
beyond just freeing up time; it takes a major step forward in assuring company standards 
when it comes to how servers are built and conﬁ gured. 
 If you are not familiar with these terms and components, we recommend that you 
spend some time studying them before attempting to deploy system images in a production 
environment. 
 While WDS can deploy an operating system to your workstation environment, this 
chapter will focus on using WDS to deploy servers.  
 Deploying Images by Using 
Windows Deployment Services 
 Windows Deployment Services include several components that can help a network 
administrator quickly, easily, and effectively install operating systems to servers:  
 Management Tools   These are the tools you will use to create system images and manage 
the server and client machine accounts.  
 Server Components   The server components are the items needed to boot a client 
computer and install an operating system on a client machine.  
 Client Components   These components are needed for the client machine to communicate 
with the server so that the proper items are installed and conﬁ gured. The Windows PE 
interface is a client component.  
 To understand these components, you must understand ﬁ rst what an image is. Simply 
put, in this context, it ’ s a snapshot of a server that was built to your speciﬁ cations. WDS 
uses two types of images:  
 Install Image   This contains the operating system you want to deploy to a server.  
 Boot Image   This is the image that a client computer or server will boot to before you 
install the install image. 
 Think of these images this way: A boot image is like a car and the install image is like a 
resort. Before you can sit in the comfort of the resort, you have to know how to get there 
and then have some means to travel to it. The car is what gets you to your destination; it 
knows the distance, direction, and speed required to get you there. 
 With WDS, you are able to customize your images so they have exactly the 
conﬁ guration required by company standards. This will save time and money because you 
need only set up the images, not babysit each server install. 
Deploying Images by Using Windows Deployment Services 
1043

1044 
Chapter 26 ■ Deploying Servers
 Before you can take advantage of this powerful tool, a proper installation and 
conﬁ guration are vital. Windows Deployment Services will not successfully deploy an 
operating system if the required components are not conﬁ gured properly. 
 The next section will guide you through the recommended installation of Windows 
Deployment Services and show you how conﬁ gure them.  
 Using Windows Deployment Services 
 Before you can start to deploy servers, you must conﬁ gure Windows Deployment Services 
and create images. A check list can assist you in making sure your installation is completed 
correctly. Here are some things you must be sure your check list includes:  
  Active Directory   The WDS server must at least be a member server in an Active Directory 
domain.  
  DHCP and DNS   WDS relies on DHCP and DNS for both IP addresses and name 
resolution.  
 NTFS  The WDS server requires the NTFS ﬁ lesystem.  
  Credentials   The user account that will be used to perform the install and related tasks 
must be a member of the local Administrators group.  
 Make sure the server you plan to use for WDS has these items installed and properly 
conﬁ gured. When you take the time to ensure that the server is properly prepared, it will 
result in a trouble - free installation and conﬁ guration of WDS. 
 After you have met the prerequisites for the server build, WDS must be installed as a 
role (Exercise 26.1).  
 Beneﬁ t of Images 
 Recently a client had an increasing need to improve the quality of their machine builds 
and reduce the time that was spent deploying new machines. This client had 250 
computers in ﬁ ve locations and two states. They had just signed an agreement to refresh 
one - third of their machines, and because this was a leasing program, they would be 
doing this every year. 
 The current standard operating procedure was to build each machine by hand, which 
would result in an IT administrator or specialist spending 3 to 5 hours per machine. Each 
phase of the technical refresh program would have around 80 machines. Simple math 
tells you that this would require 240 to 400 hours spent on just building the machines, 
which is not efﬁ cient. 

 E X E R C I S E  2 6 .1
Installing the WDS Role 
 1. 
  To open Server Manager, click Start   All Programs   Administrative Tools   Server 
Manager. 
 2. 
  In the left pane, click Roles. 
 3. 
  In the Roles Summary section, choose Add Roles. 
 4. 
  Click Next on the Before You Begin screen. 
 5. 
  On the Select Server Roles page, check the box next to Windows Deployment Services. 
Click Next. 
 6. 
  Click Next on the Overview Of Windows Deployment Services page.  
 7. 
  On the Select Role Services page, check the Deployment Server and Transport Server 
boxes.  
 8. 
  Review the selections on the Conﬁ rm Installation Selections page. 
 9. 
  After reviewing the selections, click Install. 
 During the installation of WDS, the deployment server and transportation server were 
chosen. The following paragraphs brieﬂ y explain these two services:  
 Transportation Server   This option can be chosen without choosing the Deployment 
Server option. It is used to create a namespace to transmit data from a single server. When 
just this feature is installed, the server does not need Active Directory, DHCP, or DNS. You 
would select this option itself when you are doing a custom deployment solution. While 
 A plan was developed to create system images and then deploy them with the earlier 
version of WDS, which was called Remote Installation Service, or RIS. While RIS was not 
as easy to use or set up as WDS, it did show how valuable images really are. 
 They decided to create three separate images, each with various applications installed 
based on the departments. A lot of time was spent working with department heads 
to determine what exactly the images would contain, which allowed us to create base 
images that needed very little additional attention after they were installed. 
 While we knew that this would reduce the time needed to deploy a machine and would 
create a standard build, a side beneﬁ t turned out to be using the images to assist the help 
desk. If the help desk encountered an issue that would normally result in them deploying 
someone to rebuild the machine, they would instead deploy the build image. Overall, the 
use of images saved many man - hours and saved the organization money. 
Using Windows Deployment Services 
1045

1046 
Chapter 26 ■ Deploying Servers
some advanced options can be conﬁ gured, such as using a deﬁ ned range of IP addresses 
or setting up the UDP port, the standard installation does not require any additional 
conﬁ guration.  
 Deployment Server   The Deployment Server option gives WDS full functionality. When 
this option is checked during installation, the transportation server must be installed along 
with it. This end - to - end solution brings the following functionality: 
 Support for network boot (PXE server)  
 Location to store images 
 Multicast  
 Monitor for client installs  
 Management tool  
 With the installation of the WDS role completed, the next section will explain how to 
conﬁ gure the WDS settings. 
 Configuring WDS 
 One of the nice things about WDS is that it is included as a role that you choose to install. 
After the role is installed, it requires very little conﬁ guration (see Figure 26.1). This means 
you are able to start creating your deployments within a short period of time.  
■
■
■
■
■
 F I G U R E 2 6 .1 Configuring the WDS 

 It is necessary to conﬁ gure WDS before you use it the ﬁ rst time. The following options 
are among those that can be conﬁ gured: 
 Create a shared folder that will be used to store the install images, PXE boot ﬁ les, and 
the ﬁ les for Windows PE booting.  
 Conﬁ gure answer settings for how the server handles incoming client boot requests.  
 Add a DHCP tag, which is needed so that the clients know what port the WDS server 
is listening on.  
 Set boot client options so boot clients can ﬁ nd the DHCP server.  
 Microsoft allows WDS to be conﬁ gured in two ways: 
 Using the Windows Deployment Services Conﬁ guration Wizard  
 Using a command line and  WDSUTIL 
 In Exercise 26.2, you ’ ll conﬁ gure WDS for ﬁ rst use.  
 E X E R C I S E  2 6 . 2
Conﬁ guring a WDS Server for First Use  
 1. 
  Choose Start   All Programs   Administrative Tools   Windows Deployment Services.  
 2. 
  In the left pane, expand the Servers node.  
 3. 
  Right - click the server name and choose Conﬁ gure Server. This will open the Windows 
Deployment Services Conﬁ guration Wizard.  
 4. 
  On the Welcome Page, click Next. 
 5. 
  On the Remote Installation Folder Location screen, choose the folder that will hold the 
images.  
 6. 
  On DHCP Option 60, click the Do Not Listen to Port 67 check box and click Next.  
 7. 
  Choose the answer policy on the PXE Server Initial Settings screen. For this exercise, 
choose Do Not Respond To Any Client Computer. 
 Three options are presented to you on the PXE Server Initial Settings screen:  
 Do Not Respond To Any Client Computer   Use this option if you do not want the WDS 
server to respond to any clients. 
 Respond Only To Known Client Computers   If the client is not prestaged in Active 
Directory, which means you will have to add the computer to AD before doing a PXE boot 
to a machine, then selecting this option will prevent it from doing a PXE boot to the WDS 
server. 
 Respond To All (Known And Unknown) Client Computers   This will allow all clients to boot 
to the WDS server. Additionally, checking the box For Unknown Clients, Notify Administrator 
And Respond After Approval will require that an administrator approve new clients before 
allowing them to receive the boot service. 
■
■
■
■
■
■
Using Windows Deployment Services 
1047

1048 
Chapter 26 ■ Deploying Servers
E X E R C I S E  2 6 . 2  (c o n t i n u e d)
 8. 
  Click Finish.  
 9. 
  On the Conﬁ guration Complete screen, choose to add images later with the Add Image 
Wizard.  
 10.   Click Finish.  
 After completing the basic conﬁ guration, you can conﬁ gure the server properties. The 
options that you can conﬁ gure are as follows (see Figure 26.2): 
 General  
 PXE Response  
 AD DS (Active Directory Domain Services)  
 Boot  
 Client  
 DHCP  
 Multicast  
 Advanced  
 Network  
■
■
■
■
■
■
■
■
■
 F I G U R E 2 6 . 2 WDS Properties 

 The conﬁ guration wizard sets up the basic settings such as the PXE response settings, 
but there are some common settings that you ’ ll need to look at or conﬁ gure. They ’ re on the 
following tabs:  
 Boot Tab   When the client wants to interact with the server, it will follow the settings 
on this tab. By default, the conﬁ guration wizard conﬁ gures the PXE boot to require the 
clients to press F12 for the boot to start. This can be changed so that the PXE boot begins 
immediately. This might be a great option if you are doing a large - scale migration that 
occurs after hours when you don ’ t want to have to press F12 on each client.  
 Network Settings Tab   On this tab, you can conﬁ gure the Multicast IP address, the UDP 
port range, and the network proﬁ le. If you make any changes in this tab, you must restart 
the service.  
 DHCP Tab   If WDS is installed on a server running DHCP, it will cause a conﬂ ict because 
both WDS and DHCP by default listen on port 67. This tab will allow you to change the 
settings so that WDS will not listen on port 67.  
 In Exercise 26.3, you ’ ll conﬁ gure some server properties.  
 E X E R C I S E  2 6 . 3
Conﬁ guring WDS Server Properties 
 1. 
  Choose Start   All Programs   Administrative Tools   Windows Deployment Services.  
 2. 
  In the left pane, expand Servers.  
 3. 
  Right - click the WDS server and choose Properties. 
 4. 
  In the server ’ s Properties dialog box, click the Boot tab. 
 5. 
  On the Boot tab, make any necessary changes to the boot program or add a default boot 
image.  
 6. 
  On the Network Settings tab, determine what the multicast IP address will be or set it to 
be obtained from a DHCP server. Microsoft doesn ’ t recommend changing the default 
IP address range (unless your network needs a different range). The UDP port range 
and network proﬁ le can be changed on this tab. 
 7. 
  If the WDS server is running DHCP, click the DHCP tab, and check the Do Not Listen On 
Port 67 and Conﬁ gure DHCP Option 60 To PXE Client boxes. 
 8. 
  Click OK to ﬁ nish.  
 Image Types 
 Now that we have started learning about WDS, let ’ s take a look at a couple of different 
image types that you can create. 
Using Windows Deployment Services 
1049

1050 
Chapter 26 ■ Deploying Servers
  Boot images   Boot images allow you to boot a client computer into to an operating system 
installation. Administrators have the ability to use the  boot.wim from the installation DVD 
(in the \Sources directory) for most boot image scenarios. The  boot.wim contains both the 
Windows PE and the Windows Deployment Services client.  
  Install images   Install images are operating system images that administrators can deploy 
to client computers. Administrators can also use the  install.wim from the installation 
DVD or create their own install image.  
  Discover images   The discover image locates a WDS server and the server deploys the 
install image to the computer. Administrators can conﬁ gure the discover images to target 
a speciﬁ c Windows Deployment Services server. This allows a network administrator with 
multiple servers to create a discover image for each server. Administrators can then name 
the image based on the name of the server.  
 Capturing Images 
 Many IT administrators are familiar with the concept of system images. When most think 
of system images, they think of products such as Symantec Ghost or Acronis True Image. 
When you use images, you are essentially using an existing operating system conﬁ guration 
and creating a copy or a clone of it. Then you can use this clone to restore the computer or 
deploy it to additional computers to give them the same conﬁ guration. 
 So what do we mean when we talk about capturing images speciﬁ cally for WDS? 
Normally, when an image is deployed it will start up to an operating system setup wizard. 
Capturing an image will start up the image to a capture wizard instead, thus allowing the 
image to be saved as a WIM ﬁ le (with a  .wim ﬁ lename extension). 
 What is involved in creating an image? Here ’ s a high - level overview: 
 1. 
 Install an operating system on a server or computer.  
 2. 
  Make any custom changes needed, such as installing software, speciﬁ c drivers, or 
anything else speciﬁ c to your organization.  
 3. 
  Sysprep the server or computer.  
 4. 
  Reboot into Windows Preinstallation Environment.  
 5. 
  Capture the ofﬂ ine image into a WIM ﬁ le.  
 6. 
  Store the image in the WDS image store. 
 That is a high - level overview of the imaging process in WDS; let ’ s look at what the WDS 
image capture utility does: 
 1. 
 WinPE boots and the WDS image capture utility is started.  
 2. 
  WDSCapture.exe looks for the  WDSCapture.inf ﬁ le. This ﬁ le will contain answers to the 
questions asked in the GUI during installation. If this ﬁ le does not exist, you will have 
to manually enter the answers.  
 3. 
  Drives are then scanned for a sysprep ofﬂ ine image.  

 4. 
  Metadata is extracted from the data points in the image. This data will contain 
information such as HAL type, architecture, product name, OS version, and language.  
 5. 
  The volume in which to save the WIM ﬁ le is selected.  
 6. 
  The image is updated with the information that was extracted in step 4 and any other 
values that are entered by the user.  
 7. 
  The image is uploaded to the WDS server.  
 An image can be captured both from the wizard and by using a command - line tool. 
Exercises 26.4 and 26.5 will show you how to use both. 
 Exercise 26.4 assumes you have already created a sysprep image and have added 
it to the  Install Image folder. It also assumes you have added a boot image to the 
 Boot Image folder.  
 E X E R C I S E  2 6 . 4
Creating a Capture Image Using the Wizard 
 Follow these steps to create a capture image using the wizard: 
 1. 
  Choose Start   All Programs   Administrative Tools   Windows Deployment Services.  
 2. 
  In the left pane, expand Servers.  
 3. 
  Expand your WDS server and then right - click the  Boot Image folder and choose Add 
Boot Image.  
 4. 
  Click Browse and choose the capture image that was just created. 
 5. 
  Click Next.  
 6. 
  Enter the image name and description and click Next.  
 7. 
  Review the selections on the Summary screen and click Next. 
 8. 
  After the image is added, click Finish. 
 9. 
  Create a machine that will be used for the image. Install the operating system, add your 
applications, and customize it to your standards.  
 10.   Sysprep the computer.  
 11.   When sysprep is ﬁ nished, restart the computer and press F12. 
 12.   On the Boot Manager Screen, select the capture image and click Next. 
 13.   Choose the correct drive, add a name and description, and click Next. 
 14.   Select the location in which to store the image and click Save. 
 15.   Click Upload Image To WDS Server.  
Using Windows Deployment Services 
1051

1052 
Chapter 26 ■ Deploying Servers
E X E R C I S E  2 6 . 4  (c o n t i n u e d)
 16.   Provide the name of the WDS server, and then click Connect. If prompted for 
credentials, enter the username and password with rights to the WDS server.  
 17.   Choose the image group in which to store the image. 
 18.   Click Finish. 
 Exercise 26.5 shows the steps involved in using the command - line utility named  WDSUTIL 
to create a capture image.  
 E X E R C I S E  2 6 . 5
Using  WDSUTIL to Create a Capture Image  
 1. 
  Click Start, right - click Command Prompt, and choose Run As Administrator.  
 2. 
  Within the command prompt, type the following: 
 WDSUTIL /New-CaptureImage /Image: < boot image > /Architecture:x86 /Filepath: < capture 
image > 
 Replace   < boot image >  with the name of the boot image you want to use to create 
the capture image, and replace   < capture image >  with the ﬁ le location and name 
of the new capture image. 
 3. 
  Type the following: 
 WDSUTIL /Add-Image /Imagefile: < capture image > /ImageType:boot  
 Replace   < capture image >  with the ﬁ lename and location of the capture image you want 
to add to the image store. 
 4. 
  After the capture image has been created, follow steps 8 through 18 in Exercise 26.4 to 
boot the computer to the capture image and capture the operating system. 
 Deploying Server Core 
 A new feature introduced with Windows Server 2008 R2 is Server Core. Server Core is 
a bare - bones installation of Windows Server 2008 R2. You can think of it this way: If 
Windows Server 2008 R2 is a top - of - the - line luxury car, then Windows Server 2008 R2 
Server Core is the stripped - down  “ no air - conditioning, manual windows, with cloth seats ” 
model. It might not be pretty to look at, but it gets the job done. 

 Server Core supports a limited amount of roles: 
 Active Directory Domain Services  
 Active Directory Lightweight Directory Services  
 DHCP  
 DNS  
 File Services  
 Print Services  
 Windows Virtualization  
 Streaming Media Services  
 Internet Information Services (IIS)  
 Server Core does not have the normal Windows interface or GUI. Most everything 
has to be conﬁ gured via the command line or in some cases using Remote Server 
Administration Tools from a full version of Windows Server 2008 R2, Windows Server 
2008, Windows 7, or Windows Vista. While this might scare some administrators off, it 
has many beneﬁ ts:  
 Reduced Management   Because Server Core has a minimum number of applications 
installed, it reduces management.  
 Minimal Maintenance   Only basic systems can be installed on Server Core, so it reduces 
the upkeep you would need in a normal server installation.  
 Smaller Footprint   Server Core requires only 1 GB of disk space to install and 2 GB of free 
space for operations.  
 Tighter Security   With only a few applications running on a server, it is less vulnerable to 
attacks.  
 The prerequisites for Server Core are basic. It requires the Windows Server 2008 R2 
installation media, the product key, and the hardware on which to install it. 
 It takes only a few minutes, depending on hardware, to install Server Core. One of the 
things to keep in mind is that you cannot upgrade or downgrade to Server Core. Server 
Core requires a clean installation. Three editions are available for Windows Server 2008 
R2 Server Core installations: 
 Windows Server 2008 R2 Standard  
 Windows Server 2008 R2 Enterprise  
 Windows Server 2008 R2 Datacenter  
 After you install the base operating system, you use the command - line or remote 
administrative tools to conﬁ gure the network settings, add the machine to the domain, 
create and format disks, and install roles and features.  
■
■
■
■
■
■
■
■
■
■
■
■
Using Windows Deployment Services 
1053

1054 
Chapter 26 ■ Deploying Servers
 Configuring Microsoft 
Windows Activation 
 Windows Product Activation (WPA) was introduced with the release of Windows XP. The 
early versions required a 25 - character alphanumeric format, and then Windows XP SP2 
added a physical key (which is identiﬁ ed by the hardware). Large corporations, however, 
used a different set of rules. 
 In the beginning, they were given OEM copies of the software, which did not require 
activation. Over time, these copies were leaked to other users and then the Internet. 
Microsoft worked hard to combat this by introducing Windows Genuine Advantage, 
which, when the user opts to use it, will allow them to download updates and content from 
Microsoft ’ s websites. 
 Starting with Windows Vista, if a user does not have a product key, it will result in loss of 
some of the functions, and that will eventually lead to most of the features being disabled. 
 Microsoft understands that companies still use volume keys and need to reduce any 
loss of production due to product activation. In an effort to make activation easier for 
companies, Microsoft has allowed for the installation of Key Management Services (KMS). 
When KMS is installed or activated on a host machine, it becomes the centralized location 
from which Windows client machines can activate. 
 This reduces the time to activate your products and reduces the impact on your 
bandwidth. When a KMS host is created with a KMS key, that machine will activate with 
Microsoft. Then in turn, when machines in your local network need to activate, they 
activate with the KMS host on your network. 
 KMS has the following prerequisites: 
 The KMS host must have the appropriate volume license.  
 Machines on your network or KMS clients must also have the proper volume license.  
 KMS clients need access to the KMS server. The KMS server uses TCP port 1688 by 
default.  
 Applications and services logs need to be conﬁ gured to handle the volume in your 
organization. Log sizes can be set in the Log Properties dialog box.  
 When planning to use a KMS host on your network, it is good to keep a few things in mind:  
  KMS Host Changes  The KMS host has the same rules as all other computers. If major 
hardware changes are made to the KMS server or it is on a virtual machine and is 
transferred to another computer, the KMS host will be required to reactivate with Microsoft. 
  KMS Key   It is best to use the KMS key from the highest product group that your 
company has licensed. 
 Volume Licenses   If you upgrade your product group or purchase a new volume license, 
you need to upgrade your existing KMS host.  
■
■
■
■

 Multiple Activation Key   A Multiple Activation Key (MAK) allows computers to connect 
just once to a Microsoft activation server and then no further communication with 
Microsoft is required. There are two activation methods for MAK: 
 MAK Independent Activation: Each computer individually connects to Microsoft 
via the web or telephone to complete activation.  
 MAK Proxy Activation: This method uses the Volume Activation Management Toolkit 
(VAMT), which is part of the Windows 7 Automated Installation Kit (WAIK). One 
centralized activation request is made on behalf of multiple computers with one connection 
to Microsoft online or by telephone.  
 KMS requires a minimum number of physical servers on the network before it will start 
activating client machines. This is called the activation threshold. The thresholds are as 
follows:  
 Windows Vista and Windows 7   Require 25 physical computers  
 Windows Server 2008 and Windows Server 2008 R2   Require ﬁ ve servers  
 How do the requirement thresholds work? A KMS host will count the number of 
physical computers that are requesting activation. The count is a combination of both 
Windows 7 machines and Windows Server 2008 R2. 
 For example, a company has 10 computers. Of the 10 computers, 8 are Windows 7 
and 2 are Windows Server 2008 R2. When these computers request activation, they are 
given an activation number, so the ﬁ rst computer that is running Windows 7 is given 
the number 1. The next two computers are given numbers 2 and 3. The fourth computer 
is Windows Server 2008 R2 and is given number 4, but none of the computers can be 
activated yet. The next computer to request activation is another Windows Server 2008 
R2 computer, and because it gets number 5, it activates; however, the Vista computer will 
not activate until the number of total physical computers has reached 25. Therefore, this 
company has enough computers to reach the activation threshold for Windows Server 2008 
R2 but not for Windows 7. 
 Once the thresholds are met, the KMS server will activate virtual machines, but until 
the numbers are reached, the virtual machines will not count toward the total number of 
machines needed to cross the threshold. It is thus important to have met these thresholds 
before the expiration period ends so that the computers can be activated. 
 Installing KMS 
 Starting with Windows Server 2008 R2, KMS is automatically included. However, the ﬁ rst 
KMS host needs a KMS key installed and then activated with Microsoft. After this initial 
activation, the KMS host does not communicate any further information to Microsoft. The 
following information is sent to Microsoft when you active the ﬁ rst KMS host: 
 IP address 
 Product key 
■
■
■
Configuring Microsoft Windows Activation 
1055

1056 
Chapter 26 ■ Deploying Servers
 Language settings  
 Edition of the operating system  
 Hardware ID hash  
 Current date  
 License and activation condition  
 Microsoft recommends having a minimum of two KMS host machines. This will ensure 
a failover to one or the other host in case of loss of connectivity. 
 KMS can be installed on any physical machine running Windows Vista, Windows 7, 
Windows Server 2008, Windows Server 2008 R2, or Windows Server 2003. A KMS host 
installed on a Vista machine can only activate other Vista machines, so you need to plan 
for your environment. 
 After the ﬁ rst KMS host is activated with Microsoft, the additional KMS host will 
activate to the ﬁ rst KMS host.  
 A KMS key can be used to activate up to five more KMS hosts on a 
network. Each KMS host can then be activated up to nine more times with 
the same key. If your company requires more than six KMS hosts, you 
can request additional activations. For more information, see the Volume 
Licensing website at  http://go.microsoft.com/fwlink/?LinkID=73076 . 
 In Exercise 26.6, you ’ ll install a KMS host on a Windows 2008 R2 Server machine.  
 E X E R C I S E  2 6 . 6
Installing a KMS Host 
 1. 
  Click Start, right - click Command Prompt, and choose Run As Administrator.  
 2. 
  To obtain your KMS key, type the following and press Enter: 
 cscript C:\windows\system32\slmgr.vbs /ipk  < KmsKey > 
 Replace   < KmsKey >  with your license key.  
 3. 
  To activate your KMS host, you have two options:  
 a. 
  To active online, type the following and press Enter: 
 cscript C:\windows\system32\slmgr.vbs /ato 
 b. 
 To active over the phone, type the following and press Enter: 
 slui.exe 4 
 4. 
  When the activation completes, restart the Software Licensing Service. 
■
■
■
■
■

 When you install a new KMS key, it will reset your activation count. The KMS count 
will need to be rebuilt before the KMS host can serve client machines. This will be done 
automatically because client machines will check back with the KMS server on a regular basis.  
 Configuring KMS 
 After a KMS host is enabled and activated, no additional conﬁ guration is required. You can 
conﬁ gure a number of options if your environment has special needs. Table 26.1 lists some 
provided scripts that can be run in an elevated command prompt to modify the standard 
conﬁ guration.  
 TA B L E 2 6 .1  Optional KMS settings 
 Description  
  Cscript  
 Configure the TCP port used by the 
KMS host  
 C:\windows\system32\slmgr.vbs /sprt 
 < port >  
 Disable DNS publishing  
  C:\windows\system32\slmgr.vbs /cdns 
 Reenable DNS publishing  
  C:\windows\system32\slmgr.vbs /sdns 
 Set the KMS host process to a lower 
priority  
 C:\windows\system32\slmgr.vbs /cpri 
 Set the KMS host process to normal 
priority  
 C:\windows\system32\slmgr.vbs /spri 
 Change activation interval for clients not 
activated  
 C:\windows\system32\slmgr.vbs /sai 
 < ActivationInteraval >  
 Change the activation renewal interval  
  C:\windows\system32\slmgr.vbs /sri 
 < RenewalInterval >  
 After changing any of the default settings, you should restart the KMS service or reboot 
the computer. 
 A very important item to review and make any needed changes to is DNS. If your 
environment uses Dynamic DNS, which most Active Directory domains do, and you plan 
to have only a single KMS host, then you might not require any further conﬁ guration. 
However, if your network does not have Dynamic DNS or you have multiple KMS servers, 
some changes may be needed for KMS clients to receive updated information from DNS. 
Configuring Microsoft Windows Activation 
1057

1058 
Chapter 26 ■ Deploying Servers
 When a domain contains multiple KMS hosts, only one KMS host can update the DNS 
entries. Any additional KMS hosts will be unable to change or update the SRV records 
unless changes are made to the DNS server. Think of it this way: For a house to 
receive mail and packages, it is given a unique address. 
 Only that one house receives that address, and it stays with that house so that delivery 
services know where to ﬁ nd it. An individual cannot change that address. Similarly, the ﬁ rst 
KMS host to record its DNS information becomes the owner of that DNS record. When an 
environment has more than one KMS host, it requires that we give permission to all the KMS 
hosts to change or update information. This can be accomplished in two ways: manually 
change the DNS SRV record or change the default SRV permission on the DNS server. 
 DNS publishing is enabled by default. For KMS publishing to work, the network must 
support SRV publishing. Many organizations prevent this for security reasons. If this is the 
case, then it is necessary to create or copy the SRV record manually. 
 If at all possible, it is recommended that you use the KMS publishing in DNS. Using 
this method will allow the KMS host to make changes in DNS, such as to the IP address, 
computer name, and TCP port. The KMS host will update its record once a day just in case 
DNS scavenges the information. 
 At times, organizations will have more than one DNS domain. If this is the case, you 
can create a list of DNS domains that the KMS host can use when publishing its records. 
 By default, a KMS host will publish information only to the primary DNS domain. 
This behavior is modiﬁ ed by editing the Registry. Remember that editing the Registry can 
lead to serious damage to the operating system if not done properly. As a general practice, 
you should have a proper backup of the server and the Registry settings before editing the 
Registry. 
 If your environment has security policies or anything else that would block the KMS 
host from creating and updating the DNS SVR record, you will need to manually create the 
entry. If the KMS host is not allowed to create or update the SVR record, then you should 
disable the auto - publishing on all KMS hosts. 
 Install from Media 
 When you ’ re planning to use WDS to deploy a server, using Install from Media (IFM) 
can create a copy of the Active Directory data to reduce synchronization for the new 
domain controller. IFM can create install media for writeable (full) and read - only domain 
controllers (RODC). 
 Although this section may seem to be out of place for a chapter on deploying servers, 
using IFM can speed up the deployment of Active Directory servers. Knowing how to use 
IFM is important for passing the 70 - 643 exam; however, knowing how Active Directory 
works and how to manage it is outside the scope of this book. 
 IFM uses the  ntdsutil utility and is a subcommand of that utility. This utility is built 
into Windows Server 2008 R2 and is available if you have one of the following two roles 
installed: 
 Active Directory Domain Services (AD DS)  
 Active Directory Lightweight Directory Services (AD LDS)  
■
■

 Earlier versions of IFM required several steps to create the media, including a backup 
and restore, but in Windows 2008 R2, it is possible to create an IFM set in one step. Again, 
 ntdsutil is used to create the media, with or without the SYSVOL.  Ntdsutil uses Volume 
Shadow Copy to create a snapshot of AD from a running domain controller; then it defrags 
the database and replays its logs. 
 When would this feature be of beneﬁ t? One example would be when you ’ re deploying 
servers to branch ofﬁ ces. In many cases, branch ofﬁ ces have slower WAN links, which in 
turn may make it take a considerable amount of time and bandwidth to replicate the data. 
In short, using IFM can deploy domain controllers more quickly and efﬁ ciently. 
 There are a number of facts to keep in mind when using IFM: 
 Using  ntdsutil to create RODC is safe. It will remove any cached secrets such as 
passwords from the media. However, you still want to keep the media in a safe location 
because they include the information to create a DC in your network.  
 Full AD DS installation media include the Registry and SYSVOL data, if that option 
is chosen. 
 If during the creation of the IFM media you press Ctrl+C or it gets interrupted in 
another manner, be sure to remove the temp log ﬁ les before trying again.  
 IFM cannot be run on a DC that runs Windows 2003. 
 When you install AD DS on another DC, be sure to specify the same subfolder used 
when running the IFM command.  
 When a server is deployed using IFM, it will need to replicate only any changes to 
objects in AD since the IFM media was created. This means that the amount of time that 
has passed since the creation of the media would affect how much data will be replicated. 
IFM media are thus time sensitive and are no longer valid after 60 days by default because 
the domain tombstone threshold would have passed.  
 Summary 
 Windows Deployment Services can provide an immediate value to both an IT administrator 
and an organization. It makes images or exact copies of a properly prepared machine that 
can be used to clone other machines. This allows for increased efﬁ ciency and results in 
standardization in machine builds. You should devote time to planning and conﬁ guring the 
WDS server and creating proper build images. 
 We stressed the importance of Windows Product Activation (WPA) when we looked at 
Key Management Services (KMS). If a product is not properly activated, its functionality 
will become limited. This reduction in functionality will continue until a user can use a 
web browser for only 60 minutes. A KMS host server can reduce the footprint of activation 
on an organization ’ s network and allow it to continue to use volume license keys.  
■
■
■
■
■
Summary 
1059

1060 
Chapter 26 ■ Deploying Servers
 Exam Essentials  
  Understand how to use images.   Know how to capture, prepare, and deploy images. An 
understanding of how the build process works will be beneﬁ cial. You should also know 
when to create an image and how to prepare one. Take the time to get familiar with IFM 
and the types of IFM you can create, along with when you would use each type.  
  Understand how to deploy images.   Understand how the deployment process works and 
how to deploy an image to multiple machines at the same time.  
  Understand the Server Core basics.   Learn the steps needed to install Server Core and 
when deploying it would make the most sense. Understand the basic features as well as the 
prerequisites that are necessary for installation.  
  Understand the importance of Windows Product Activation.   Have a thorough knowledge 
of how KMS works and why it is needed. Understand how it interacts with DNS and how 
to conﬁ gure or create SVR records. Take some time to study how to install or enable KMS 
with a license key. 

 Review Questions  
 1. 
  What changes have been made in WDS? (Choose all that apply.)  
 A.   Support for WinPE as a boot operating system  
 B.   Support for x64 - bit systems  
 C.   Can be used to deploy Norton Ghost images  
 D.   Removed the ability to use multicast  
 2. 
  What is an install image? 
 A.   This is the image a client machine will boot into.  
 B.   This is the CD that contains the installation media.  
 C.   This is the image that contains the operating system you want to deploy.  
 D.   This is a backup image that is used to restore single files.  
 3. 
 What two components does WDS rely on for IP addresses and name resolution?  
 A.   NTFS  
 B.   DNS  
 C.   KMS  
 D.   DHCP  
 4. 
  What is the difference between a transportation server and deployment server when 
discussing WDS?  
 A.   A deployment server gives WDS full functionality.  
 B.   There is no difference because they are both services of WDS.  
 C.   A deployment server does not need AD.  
 D.   A transportation server provides full WDS functions.  
 5. 
  What is the name of the utility that Microsoft provides, besides a wizard, to configure 
WDS?  
 A.   Command prompt  
 B.   DNSLint 
 C.   FCIV 
 D.   WDSUTIL 
Review Questions 
1061

1062 
Chapter 26 ■ Deploying Servers
 6. 
 What are some of the options that can be configured in WDS Properties? (Choose all that 
apply.) 
 A.   Boot settings  
 B.   Transportation rules  
 C.   DHCP port  
 D.   Activation 
  7. 
  Which role must be installed on a server to use IFM?  
 A.   Fax  
 B.   Active Directory Domain Services  
 C.   DNS  
 D.   DHCP  
 8. 
  What is RODC? 
 A.   The protocol in which a domain controller replicates  
 B.   Redundant domain controller  
 C.   Read - only domain controller  
 D.   Writeable domain controller  
 9. 
  If the process of creating the IFM media gets interrupted, what files should be deleted 
before trying again?  
 A.   Temp log files  
 B.   Install files 
 C.   WIM files  
 D.   PST files  
  10.   What tool or utility is used to configure Windows Server Core?  
 A.   COREUtil 
 B.   WDSUTIL 
 C.   Server Manager  
 D.   Command line 

 Answers to Review Questions 
 1. 
A, B.   WDS changes include support for WinPE and the ability to support x64 - bit systems.  
 2. 
C.  Install images contain the operating system that you want to deploy to a machine.  
 3. 
B, D.   WDS relies on DHCP and DNS to provide IP addresses and name resolution.  
 4. 
A.   When the Deployment Server option is selected, it provides full functionality to the 
WDS server. 
 5. 
D.   Microsoft provides the  WDSUTIL  utility to conﬁ gure the WDS server.  
 6. 
A, C.   You can conﬁ gure the boot settings and change the DHCP port within WDS server 
properties.  
 7. 
B.   To use the IFM utility, you must install the AD DS role or the AD LDS role.  
 8. 
C.   An RODC is a read - only domain controller.  
 9. 
A.   Delete the temp log ﬁ les before attempting to retry a failed IFM creation.  
 10 D.   Because Server Core does not contain a GUI, conﬁ guration is accomplished by using the 
command line. 
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
1063


Configuring High 
Availability in 
Windows Server 
2008 R2  
 MICROSOFT EXAM OBJECTIVES COVERED 
IN THIS CHAPTER: 
 Deploying Servers 
■   Configure high availability. May include but is not limited to: 
failover clustering; Network Load Balancing; geo - clustering 
support; cluster service migration; Cluster Shared 
Volumes (CSV).  

 Chapter 
27

 Windows Server 2008 R2 has improved the options for 
high availability as well as the ease of conﬁ guring them. High 
availability can be better achieved with Windows Server 
2008 R2 ’ s superior software stability and improved failover and network load - balanced 
clustering. The exam will cover the basic conﬁ guration and operational functions for both 
a failover cluster and network load balancing. This chapter will give an introduction 
to achieving high availability with hardware and operational changes as well as using 
the high availability features of Windows Server 2008 R2.  
 Components of High Availability 
 High availability is a buzzword that many application and hardware vendors like to throw 
around to get you to purchase their product. Many different options are available to 
achieve high availability, and there also seem to be a number of different deﬁ nitions and 
variations that help vendors sell their products as high availability solutions. 
 But when it comes down to it, high availability is simply providing services with 
maximum uptime by avoiding unplanned downtime. Often disaster recovery (DR) is also 
closely lumped into discussions of high availability, but DR encompasses the business and 
technical processes that are used to recover once a disaster has happened. 
 Deﬁ ning a high availability plan usually starts with a Service Level Agreement (SLA). 
At its base, an SLA deﬁ nes the services and metrics that must be met for availability and 
performance of an application or service. Often an SLA is created for an IT department or 
service provider to provide a speciﬁ c level of service. 
 An example of this might be an SLA for a Microsoft Exchange server. The SLA for 
an Exchange server might have uptime metrics on how much time during the month the 
mailboxes need to be available to end users, or it might deﬁ ne performance metrics for 
the amount of time that it takes for email messages to be delivered. 
 When determining an SLA, two other factors need to be considered, but often you will 
see them discussed only in the context of disaster recovery even though they are important 
for designing a highly available solution. These factors are recovery point objective (RPO) 
and recovery time objective (RTO). 
 An RTO is the length of time an application can be unavailable before service must be 
restored to meet the SLA. For example, a single component failure would have an RTO 
of less than 5 minutes, and a full - site failure might have an RTO of 3 hours. An RPO is 
essentially the amount of data that must be restored for a failure. For example, in a single 

server or component failure, the RPO would be 0, but in a site failure, the RPO might 
allow for up to 20 minutes of lost data. 
 SLAs, on the other hand, are usually expressed in percentages of the time the application 
is available. These percentages are also often referred to as the number of nines the 
percentage has, as shown in Table 27.1.  
 TA B L E 27.1  Availability percentages 
 Availability Rating  
  Allowed Unplanned Downtime/Year  
 99% 
  3.7 days 
 99.9% 
  8.8 hours 
 99.99%  
  53 minutes  
 99.999%  
 5.3 minutes 
 Two important factors that affect an SLA are the mean time between failure (MTBF) 
and the mean time to recover (MTTR). To be able to reduce the amount of unplanned 
downtime, the time between failures must be increased and the time it takes to recover 
must be reduced. Modifying these two factors will be covered in the next several sections 
of this chapter. 
 Achieving High Availability 
 As the information presented during the Windows installation states, Windows Server 
2008 R2 is the most secure and reliable Windows version to date. It also is the most stable, 
mature, and capable of any version of Windows. Although we have seen similar claims 
in previous versions of Windows Server, we can be sure that Windows Server 2008 R2 is 
much better than previous versions for a variety of reasons. 
 An honest look at the feature set and real - world experience should prove that this 
version of Windows provides the most suitable foundation for creating a highly available 
solution. However, more than just good software is needed to be able to offer high 
availability for applications. 
 High Availability Foundation 
 Just as a house needs a good foundation, a highly available Windows Server needs a 
stable and reliable hardware platform to run on. Although Windows Server 2008 R2 will 
technically run on desktop - class hardware, high availability is more easily achieved with 
Achieving High Availability 
1067

1068 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
server - class hardware. What differentiates desktop - class and server - class hardware? Server -
 class hardware has more management and monitoring features built in so that the health of 
the hardware is able to be monitored and maintained. 
 Another large difference is that server - class hardware has redundancy options. Server -
 class hardware often has options to protect from drive failures, such as RAID controllers, 
and to protect against power supply failures, such as multiple power supplies. And 
enterprise - class servers have more. 
 More needs to be done than just installing Windows Server 2008 R2 to ensure that the 
applications stay running with the best availability possible. A house needs maintenance and 
upkeep to keep the structure in proper repair, as does a server. In the case of a highly available 
server, this means patch management. 
 Installing Patches 
 Microsoft releases monthly security updates to ﬁ x security problems with its software, 
both for operating system ﬁ xes and for applications. To ensure that your highly available 
applications are immune to known vulnerabilities, these patches need to be applied in a 
timely manner during a scheduled maintenance window. Also, to address stability and 
performance issues, updates and service packs are released regularly for many applications, 
such as Microsoft SQL Server, Exchange Server, and SharePoint Portal Server. Many 
companies have a set schedule — daily, weekly, or monthly — to apply these patches and 
updates after they are tested and approved. 
 To continue even further with the house analogy, if you were planning to have crown 
molding installed, would you rather hire a college student on spring break looking to make 
some extra money to do the job or a seasoned artisan? Of course you would want someone with 
experience and a proven record of accomplishment to install your expensive crown molding. 
 Likewise, with any work that needs to be done on your highly available applications, 
it ’ s best to hire only adequately qualiﬁ ed individuals. This is why obtaining a Microsoft 
certiﬁ cation is deﬁ nitely an excellent start in becoming qualiﬁ ed to properly conﬁ gure a 
server to be highly available. There is no substitute for real - life and hands - on experience. 
Working with highly available conﬁ gurations in a lab and in production will help you to 
know not only what conﬁ gurations are available but also how the changes should be made. 
 For example, it may be possible to use failover clustering for a WINS server, but in 
practice it may be easier to support and less expensive in hardware cost to use WINS 
replication to provide high availability. This is something you would know only if you had 
enough experience to make this decision. 
 As with your house, once you have a ﬁ rm and stable foundation built by skilled artisans 
and a maintenance plan has been put into place, you need to ascertain what more is 
needed. If you can ’ t achieve enough uptime with proper server conﬁ guration and mature 
operational processes, a cluster may be needed. 
 Windows Server 2008 R2 provides for two types of clustering: failover clustering and 
Network Load Balancing (NLB). Failover clustering is used for applications and services 
such as SQL Server and Exchange Server. Network Load Balancing is used for network -
 based services such as web and FTP servers. The remaining sections of the chapter will 
cover both of these clustering options in detail.  

 To Cluster or Not to Cluster 
 Clustering is often thrown into the mix when someone wants to achieve higher 
availability. This is often a good step toward improved availability, but at times the return 
on the investment of a cluster doesn ’ t always add up. Although Windows Server 2008 R2 
greatly simpliﬁ es both the creation and management of a failover cluster, there is added 
complexity and cost in hardware, software, and personnel. 
 How do you determine whether to cluster applications? Sometimes even though it is 
possible to cluster applications, they perform worse when clustered. Other times only 
a small improvement is made when a cluster is created. You have to balance the slight 
improvement over the increased hardware cost, increased complexity, and the increased 
level of training required for the administrators. 
 Achieving High Availability 
with Failover Clustering 
 Taking high availability to the next level for enterprise services often means creating a 
failover cluster. In a failover cluster, all of the clustered application or service resources are 
assigned to one node or server in the cluster. Commonly clustered applications are SQL 
Server and Exchange Server; commonly clustered services are File and Print. Since the 
differences between a clustered application and a clustered service are primarily related 
to the number of functions or features, for simplicity we will refer to both as clustered 
applications. 
 If there is a failure of the primary node, or if the primary node is taken ofﬂ ine for 
maintenance, the clustered application is started on another cluster node. The client 
requests are then automatically redirected to the new cluster node to minimize the impact 
of the failure. 
 How does failover clustering improve availability? By increasing the number of server 
nodes that the application has available to run on, you can move the application to a 
healthy server if there is a problem, if maintenance needs to be completed on the hardware 
or the operating system, or if patches need to be applied. The clustered application can be 
moved from node to node without having to restart. 
 Usually, moving an application between nodes is transparent to the clients. Only severe 
node failures will require the application to be restarted before it is able to service clients. 
Figure 27.1 shows an example of SQL Server running on the ﬁ rst node of a Windows Server 
2008 failover cluster.  
Achieving High Availability with Failover Clustering 
1069

1070 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 F I G U R E 27.1 Using failover clustering to cluster SQL Server 
Node B
Passive
Node A
SQL Server
Active
Clients
SAN
 The clustered SQL Server in Figure 27.2 can be failed over to another node in the cluster 
and still service database requests.  
 F I G U R E 27. 2 Failing the SQL Server service to another node 
Node B
Node A
SQL Server
SAN
Passive
Active
Clients
 Failover clustering is notorious for being complicated and expensive. Windows Server 
2008 R2 makes strides to remove both of these concerns. Troubleshooting and other 
advanced concepts are outside the scope of the 70 - 643 exam and thus this book, so we will 
cover only the basic requirements and concepts need to conﬁ gure a failover cluster. 

 Failover Clustering Requirements 
 To be able to conﬁ gure a failover cluster, you must have the required components. The ﬁ rst 
requirement is that the correct Windows Server 2008 R2 edition has been installed. Only 
the Windows Server 2008 R2 Enterprise Edition and Windows Server 2008 R2 Datacenter 
Edition are allowed to participate in a failover cluster. A single failover cluster can have up 
to 16 nodes when using the x64 installation; however, the clustered service or application 
must support that number of nodes. 
 The appropriate server hardware is also required. Although the exact hardware will 
depend on the clustered application, a few requirements are standard. 
 The basic hardware requirements are as follows: 
 Server components must be marked with the  “ Certiﬁ ed for Windows Server 2008 R2 ” logo.  
 Server hardware should match and contain the same or similar components.  
 All of the Validate a Conﬁ guration Wizard tests must pass.  
 All servers in a cluster must run the same processor architecture, such as x64 - based or 
Itanium - based architecture.  
 The requirements for failover clustering storage have changed from previous versions of 
Windows. For example, Parallel SCSI is no longer a supported storage technology for any 
of the clustered disks. There are, however, additional requirements that need to be met for 
the storage components: 
 Disks available for the cluster must be Fibre Channel, iSCSI, SAS, or SATA - based disk.  
 Each cluster node must have a dedicated network interface card for iSCSI connectivity.  
 Multipath software must be based on Multipath I/O (MPIO).  
 Storage drivers must be based on  storport.sys . 
 Drivers and ﬁ rmware for the storage controllers on each server node in the cluster 
should be the identical.  
 Storage components must be marked with the  “ Certiﬁ ed for Windows Server 2008 
R2 ” logo. 
 In addition, there are network requirements that must be met for failover clustering: 
 Cluster nodes should be connected to multiple networks for communication redundancy.  
 Network adapters should be the same make, use the same driver, and have the 
ﬁ rmware version in each cluster node.  
 Network components must be marked with the  “ Certiﬁ ed for Windows Server 2008 
R2 ” logo. 
 There are two types of network connections in a failover cluster. These should have 
adequate redundancy because total failure of either could cause loss of functionality of the 
cluster. The two types are as follows: 
 Public network: This is the network through which clients are able to connect to the 
clustered service application.  
 Private network: This is the network used by the nodes to communicate to each other.  
■
■
■
■
■
■
■
■
■
■
■
■
■
■
■
Achieving High Availability with Failover Clustering 
1071

1072 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 To provide redundancy for these two network types, additional network adapters would 
need to be added to the node and conﬁ gured to connect to the networks. 
 In previous versions of Windows Server, support was given only when the entire cluster 
conﬁ guration was tested and listed on the HCL. The tested conﬁ guration listed the server 
and storage conﬁ guration down to the ﬁ rmware and driver versions. This proved to be very 
difﬁ cult and expensive from both a vendor and consumer perspective to deploy supported 
Windows clusters. 
 When problems did arise and Microsoft support was needed, it caused undue 
troubleshooting complexity as well. With Windows Server 2008 failover clustering, 
simpliﬁ ed requirements, including the  “ Certiﬁ ed for Windows Server 2008 R2 ” logo 
program and the Validate a Conﬁ guration Wizard, all but eliminate the guesswork that 
was put into getting the cluster components conﬁ gured in a way that will follow best 
practices and allow for Microsoft support to easily assist in case it might be needed.  
 Cluster Quorum 
 When a group of people sets out to accomplish a single task or goal, a method for settling 
disagreements and for making decisions is required. In the case of a cluster, the goal is 
to provide a highly available service in spite of failures. When a problem occurs and a 
cluster node loses communication with the other nodes because of a network error, the 
functioning nodes are supposed to try to bring the redundant service back online. 
 How, though, is it determined which node should bring the clustered service back 
online? If all of the nodes are functional despite the network communications issue, 
each one might try. Just like a group of people with their own ideas, a method must be put 
in place to determine which idea, or node, to allow control of the cluster. Windows Server 
2008 R2 failover clustering, like other clustering technologies, requires that a quorum exist 
between the cluster nodes before a cluster becomes available. 
 A quorum is a consensus of the status of each of the nodes in the cluster. Quorum must 
be achieved in order for a clustered application to come online by obtaining a majority of 
the votes available. Windows Server 2008 R2 has four quorum models, or methods, for 
determining quorum and for adjusting the number and types of votes available: 
 Node Majority  
 Node and Disk Majority  
 Node and File Share Majority  
 No Majority: Disk Only  
 Node Majority, shown in Figure 27.3, allows only the cluster nodes to vote to obtain 
quorum. Node Majority is recommended for clusters with an odd number of nodes. When 
this quorum model is chosen, the cluster can sustain failures of up to one less than half 
of the nodes. For example, a ﬁ ve - node cluster can sustain two node failures. 
 Node and Disk Majority, shown in Figure 27.4, allows the cluster nodes and a disk on 
shared storage to vote to obtain quorum. Node and Disk Majority is recommended for 
clusters with an even number of nodes. When this quorum method is chosen, the cluster 
can sustain failures of up to half the nodes if the witness disk remains online. For example, 
■
■
■
■

an eight - node cluster with the witness disk online could sustain four node failures. Similar 
to a Node Majority quorum, this model can sustain failures of up to one less than half of 
the nodes if the witness disk goes ofﬂ ine or fails.  
 F I G U R E 27. 4 Node and Disk Majority cluster 
 F I G U R E  27. 3 Node Majority cluster 
x
x
x
x
When a majority of the nodes are not communicating, the cluster stops.
When a majority of the nodes are communicating, the cluster is functional.
x
x
x x
x
x
x
When only one of the four nodes and the witness 
disk communicate, the cluster is down.
When two out of the four nodes and the witness disk 
communicate, the cluster is running.
When three out of the four nodes communicate, 
the cluster is running.
Achieving High Availability with Failover Clustering 
1073

1074 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 Node and File Share Majority allows the cluster nodes and a ﬁ le share to vote to obtain 
quorum. Node and File Share Majority is recommended for clusters with non - shared disk 
conﬁ gurations such as Exchange Server 2007 Clustered Continuous Replication (CCR) 
clusters or multisite clusters. This quorum works in a similar way to Node and Disk 
Majority, but instead of a witness disk, this cluster uses a witness ﬁ le share. 
 No Majority: Disk Only, shown in Figure 27.5, uses only a shared disk to obtain 
quorum. This quorum type is similar to legacy Windows Server cluster types and is not a 
recommended solution because the shared disk is a single point of failure. If the shared disk 
fails, none of the clustered applications can come online. It can, however, sustain failures of 
all nodes except one, assuming the shared disk is online.  
 Validating a Cluster Configuration 
 Conﬁ guring a failover cluster in Windows Server 2008 R2 is much simpler than in 
previous versions of Windows Server. Before a cluster can be conﬁ gured, the Validate a 
Conﬁ guration Wizard should be run to verify that the hardware is conﬁ gured in a fashion 
that is supportable. Before you can run the Validate a Conﬁ guration Wizard, however, the 
Failover Clustering feature needs to be installed using Server Manager. The account that 
is used to create a cluster must have administrative rights on each of the cluster nodes and 
have permissions to create a cluster name object in Active Directory. Follow these steps: 
 1. 
 Prepare hardware and software perquisites.  
 2. 
  Install the Failover Clustering feature on each server.  
 3. 
  Log in with appropriate user ID and run the Validate a Conﬁ guration Wizard.  
 F I G U R E 27. 5 No Majority: Disk Only cluster 
x
x
x
When one node and the disk are communicating, 
the disk is running.
When all three of the nodes are communicating with 
each other but not with the disk, the cluster stops. 

 4. 
  Create a cluster.  
 5. 
  Install and cluster applications and services.  
 To install the Failover Clustering feature on a cluster node, follow the steps outlined in 
Exercise 27.1. 
 E X E R C I S E  2 7.1
Installing the Failover Cluster Feature  
 1. 
  Click Start  Administrative Tools   Server Manager. 
 2. 
  Select Add Features, located in the Features Summary section of Server Manager.  
 3. 
  Select the Failover Clustering feature from the displayed list and click Next.  
 4. 
  In the Conﬁ rm Installation Selections page, review the selection and then click Install.  
 5. 
  When the installation process completes, click Close.  
 Using the Validate a Conﬁ guration Wizard before creating a cluster is highly 
recommended. This wizard validates that the hardware and software conﬁ guration for the 
potential cluster nodes are in a supported conﬁ guration. Even if the conﬁ guration passes 
the tests, take care to review all warnings and informational messages so that they can 
be addressed or documented before the cluster is created. 
 Running the Validate a Conﬁ guration Wizard does the following: 
 Conducts four types of tests: Software and Hardware Inventory, Network, Storage, 
and System Conﬁ guration.  
 Conﬁ rms that the hardware and software settings are supportable by Microsoft 
support staff.  
 You should run the Validate a Conﬁ guration Wizard before creating a cluster or after 
making any major hardware or software changes to the cluster. Doing this will help 
identify any misconﬁ gurations that could cause problems with the failover cluster. 
 In the next section, we will cover the process for running the Validate a Conﬁ guration 
Wizard. 
 Running the Validate a Configuration Wizard 
 The Validate a Conﬁ guration Wizard, shown in Figure 27.6, is simple and straightforward to 
use, as its  “ wizard ” name would suggest. It should be run after the Failover Clustering feature 
has been installed on each of the cluster nodes and can be run as many times as required.  
 When you are troubleshooting cluster problems or have changed the 
configuration of the cluster hardware, it is a good idea to run the 
Validate a Configuration Wizard again to help pinpoint potential cluster 
configuration problems.  
■
■
Achieving High Availability with Failover Clustering 
1075

1076 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 F I G U R E 27.6 The Validate a Configuration Wizard 
 If you already have a cluster conﬁ gured and want to run the Validate a Conﬁ guration 
Wizard, you can do so; however, you will not be able to run all of the storage tests without 
taking the clustered resources ofﬂ ine. As shown in Figure 27.7, you will be prompted 
to either skip the disruptive tests or take the clustered resources ofﬂ ine so the tests can 
complete.  
 F I G U R E 27.7 Validating a running cluster 

 Exercise 27.2 shows the exact steps to successfully run the Validate a Conﬁ guration 
Wizard on two servers, named NODEA and NODEB, that are not yet clustered.  
 E X E R C I S E  2 7. 2
Running the Validate a Conﬁ guration Wizard  
 1. 
  Click Start   Administrative Tools   Failover Cluster Management.  
 2. 
  In the Actions pane, click Validate A Conﬁ guration and click Next.  
 3. 
  Type  NODEA in the Enter Name ﬁ eld and click Add.  
 4. 
  Type  NODEB in the Enter Name ﬁ eld and click Add.  
 5. 
  Click Next.  
 6. 
  Leave Run All Tests (Recommended) selected and click Next.  
 7. 
  Click Next.  
 8. 
  Let the test complete and review the report in the Summary window, and then click Finish.  
 Addressing Problems Reported by the Validate 
a Configuration Wizard 
 After the Validate a Conﬁ guration Wizard has been run, it will show the results, as shown in 
Figure 27.8. This report can also be viewed in detail later using a web browser. The report is 
named with the date and time the wizard was run and is stored in  %windir%\cluster\Reports . 
 F I G U R E  27. 8 Validate a Configuration Wizard results 
Achieving High Availability with Failover Clustering 
1077

1078 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 How should errors listed in the report be addressed? Often the errors reported by the 
Validate a Conﬁ guration Wizard are self - explanatory; however, there are times when 
additional help is required. The following three guidelines should help troubleshoot the errors: 
 Read all of the errors because multiple errors may be related.  
 Use the check lists available in the Windows Server help ﬁ les to ensure that all steps 
have been completed.  
 Contact the hardware vendor for updated drivers and ﬁ rmware and guidance for using 
the hardware in a cluster.  
 Multisite or Geographically Dispersed Clusters (Geo - clustering) 
 One issue that you can run into is if you have multiple sites or if the cluster is 
geographically dispersed. If the failover cluster does not have a shared common disk, data 
replication between nodes might not pass the cluster validation  “ storage ” tests. 
 Setting up a cluster in a multisite or geo - cluster conﬁ guration is a common practice. As 
long as the cluster solution does not require external storage to fail over, it will not need to 
pass the storage test to function properly.  
 Creating a Cluster 
 After you have successfully validated a conﬁ guration and the cluster hardware is 
in a supportable state, you can create a cluster. The process for creating a cluster is 
straightforward and similar to process of running the Validate a Conﬁ guration Wizard. To 
create a cluster with NODEA and NODEB, follow the instructions in Exercise 27.3.  
 E X E R C I S E  2 7. 3
Creating a Cluster 
 1. 
  Click Start   Administrative Tools   Failover Cluster Management.  
 2. 
  In the Management section of the center pane, select Create A Cluster. 
 3. 
  Read the Before You Begin information and click Next. 
 4. 
  In the Enter Server Name box, type  NODEA , and then click Add. 
 5. 
  Again in the Enter Server Name box, type  NODEB , and then click Add. 
 6. 
  Verify the entries, and then click Next. 
 7. 
  In the Access Point For Administering The Cluster section, enter  Cluster1 for the 
cluster name.  
 8. 
  Type   10.10.1.96  as the IP address, type   255.255.255.0  as the subnet mask, and 
then click Next.  
 9. 
  In the Conﬁ rmation dialog box, verify the information, and then click Next. 
 10.   On the Summary page, click Finish. 
■
■
■

 By creating a cluster, you have established the foundation for your clustered applications. 
At this point in the conﬁ guration, however, only a couple of activities can be completed, 
such as adding, pausing, and evicting cluster nodes. One of the conﬁ guration settings you 
can change at this point is the quorum type of the cluster. 
 During the setup of the cluster, the best quorum model is chosen based on the number 
of cluster nodes and the disk conﬁ guration. To change the quorum type, in Failover Cluster 
Management, choose the cluster name from the Connections pane and then click Quorum 
Settings from the Actions pane. As shown in Figure 27.9, this will allow you to choose a 
valid quorum model based on the current cluster conﬁ guration.  
 F I G U R E 27. 9 Changing the quorum model 
 Working with Cluster Nodes 
 Once a cluster is created, a couple actions are available. First, you can add another node to the 
cluster by using the Add Node Wizard from the Failover Cluster Management Actions pane. 
 Also at this point, you have the option to pause a node, which prevents resources from 
being failed over or moved to the node. You typically would pause a node when the node is 
involved in maintenance or troubleshooting. After a node is paused, it must be resumed to 
allow resources to again be run on it. 
 Another action available to perform on a node at this time is evict. Eviction is a 
reversible process. Once you evict the node, it must be re - added to the cluster. You would 
evict a node when it is damaged beyond repair or is no longer needed in the cluster. If 
you evict a damaged node, you can repair or rebuild it and then add it back to the cluster 
using the Add Node Wizard.  
Achieving High Availability with Failover Clustering 
1079

1080 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 Clustering Roles, Services, and Applications 
 Once the cluster is created, applications, services, and roles can be clustered. Windows 
Server 2008 R2 includes a number of built - in roles and features that can be clustered. 
 The following roles and features can be clustered in Windows Server 2008 R2: 
 Virtual Machines File Services  
 Print Services  
 DHCP Server  
 Windows Internet Naming Services (WINS)  
 In addition, other common services and applications are clustered on Windows Server 
2008 R2 clusters: 
 Enterprise database services such as Microsoft SQL Server  
 Enterprise messaging services such as Microsoft Exchange Server  
 To cluster a role or feature such as Print Services, the ﬁ rst step is to install the role 
or feature on each node of the cluster. The next step is to use the Conﬁ gure a Service or 
Application Wizard in the Failover Cluster Management tool. Exercise 27.4 shows how to 
cluster the Print Services role once an appropriate disk has been presented to the cluster.  
 E X E R C I S E  2 7. 4
Clustering the Print Service 
 1. 
  Click Start   Administrative Tools   Failover Cluster Management.  
 2. 
  In the console tree, click the plus sign next to the cluster name to expand the items 
underneath it. 
 3. 
  In the Actions pane, click Conﬁ gure A Service Or Application and click Next on the 
Before You Begin page. 
 4. 
  Click Print Server in the Select Service Or Application page, and then click Next. 
 5. 
  Type the name of the print server, such as Print1, and type in the IP address that will be 
used to access the print service, such as   192.168.1.108  . Then click Next.  
 6. 
  Select Cluster Disk 1 in the Select Storage page as the storage volume for the print 
server, and then click Next.  
 7. 
  Click Next again. 
 8. 
  After the wizard runs and the Summary page appears, you can view a report of the 
tasks the wizard performed by clicking View Report. 
 9. 
  Close the report and click Finish. 
■
■
■
■
■
■

 The built - in roles and features all are conﬁ gured in a similar fashion. Other applications 
such as Microsoft Exchange Server 2007 have specialized cluster conﬁ guration routines 
that are outside the scope of this exam. Applications that are not developed to be clustered 
can also be clustered using the Generic Application, Generic Script, or Generic Service 
option in the Conﬁ gure a Service or Application Wizard, as shown in Figure 27.10.  
 Clustered Application Settings 
 Windows Server 2008 R2 has options that allow an administrator to ﬁ ne - tune the failover 
process to meet the needs of their business. In the next few sections, we ’ ll cover those options.  
 F I G U R E 27.10 Configuring a generic application 
 Failover occurs when a clustered application or service moves from one node to another. 
The process can be triggered automatically because of a failure or server maintenance or 
manually by an administrator. The failover process works as follows: 
 1. 
 The cluster service takes all the resources in the application ofﬂ ine in the order set in 
the dependency hierarchy.  
 2. 
  The cluster service transfers the application to the node that is listed next on the 
application ’ s list of preferred host nodes.  
 3. 
  The cluster service attempts to bring all of the application ’ s resources online, starting 
at the bottom of the dependency hierarchy.  
 These steps can change depending on the use of Live or Quick Migration.  
Achieving High Availability with Failover Clustering 
1081

1082 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 In a cluster that is hosting multiple applications, it may be important to set speciﬁ c 
nodes to be primarily responsible for each clustered application. This can be helpful from 
a troubleshooting perspective since a speciﬁ c node is targeted for hosting service. To set a 
preferred node and an order of preference for failover, use the General tab on the Properties 
dialog box of the clustered application. 
 Also, the order of failover is set in this same dialog box by moving the order in which 
the nodes are listed. If NODEA should be the primary node and NODEC should be the 
server that the application fails to ﬁ rst, NODEA should be listed ﬁ rst and selected as 
the preferred owner. NODEC should be listed second, and the remaining cluster nodes 
should be listed after NODEC. 
 As shown in Figure 27.11, a number of failover settings can be conﬁ gured for the 
clustered service. The failover settings control the number of times a clustered application 
can fail in a period of time before the cluster stops trying to restart it. Typically, if 
a clustered application fails a number of times, some sort of manual intervention 
will be required to return the application to a stable state. 
 Specifying the maximum number of failures will keep the application from trying to 
restart until it is manually brought back online after the problem has been resolved. This 
is beneﬁ cial because if the application continues to be brought online and then fails, it may 
show as being functional to the monitoring system even though it continues to fail. After 
the application is put in a failed state, the monitoring system will not be able to contact the 
application and should report it as being ofﬂ ine.  
 F I G U R E 27.11 Clustered application failover settings 
 Figure 27.11 also shows the failback settings for Print1. Failback settings control 
whether or not and when a clustered application would fail back to the preferred cluster 
node once it becomes available. The default setting is Prevent Failback. If failback is 

allowed, two additional options are available, either to fail back immediately after the 
preferred node is available or to fail back within a speciﬁ ed time. 
 The time is speciﬁ ed in the 24 - hour format. If you want to allow failback between 
10:00 p.m. and 11:00 p.m., you would set the failback time to be between 22 and 23. 
Setting a failback time to off hours is an excellent way to ensure that your clustered 
applications are running on the designated nodes and automatically scheduling the failover 
process for a time when it will impact the fewest users. 
 One tool that is valuable in determining how resources affect other resources is the 
dependency viewer. The dependency viewer visualizes the dependency hierarchy created 
for an application or service. Using this tool can help when troubleshooting why speciﬁ c 
resources are causing failures and help an administrator better visualize the current 
conﬁ guration and adjust it to meet business needs. Exercise 27.5 will show you how to 
run the dependency viewer.  
 E X E R C I S E  2 7. 5
Using the Dependency Viewer  
 1. 
  Choose Start   Administrative Tool   Failover Cluster Management.  
 2. 
  In the console tree, click the plus sign to expand the cluster.  
 3. 
  Under the cluster name, click the plus sign to expand Services And Applications.  
 4. 
  In Services And Applications, select a service or application such as Print1.  
 5. 
  In the Actions pane, click Show Dependency Report. 
 6. 
  Review the dependency report. 
 7. 
  Close Internet Explorer.  
 Exercise 27.5 generated a dependency report that shows how the print service is 
dependent on a network name and a clustered disk resource. The network name 
is then dependent on an IP address.  
 Resource Properties 
 Resources are physical or logical objects, such as a ﬁ le share or IP address, that the failover 
cluster manages. They may be a service or application available to clients, or they may be 
part of the cluster. Resources include physical hardware devices such as disks and logical 
items such as network names. They are the smallest conﬁ gurable unit in a cluster and can 
run on only a single node in a cluster at a time. 
 Like clustered applications, resources have a number of properties available for meeting 
business requirements for high availability. This section covers resource dependencies and 
policies. 
 Dependencies can be set on individual resources and control how resources are brought 
online and ofﬂ ine. Simply put, a dependent resource is brought online after the resources 
Achieving High Availability with Failover Clustering 
1083

1084 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
that it depends on and is taken ofﬂ ine before those resources. As shown in Figure 27.12, 
dependencies can be set on a speciﬁ c resource, such as the print spooler.  
 F I G U R E 27.12 Resource dependencies 
 Resource policies are settings that control how resources respond when a failure occurs 
and how resources are monitored for failures. The Policies tab of a resource ’ s Properties 
dialog box is shown in Figure 27.13.  
 F I G U R E 27.13 Resource Policies 

 The Policies tab sets conﬁ guration options for how a resource should respond in the 
event of a failure. The options available are as follows:  
 If Resource Fails, Do Not Restart   This option, as it would lead you to believe, leaves the 
failed resource ofﬂ ine.  
 If Resource Fails, Attempt Restart On Current Node   With this option set, the resource 
tries to restart if it fails on the node on which it is currently running. There are two 
additional options if this is selected so that the number of restarts can be limited. They set 
the number of times the resource should restart on the current node in a speciﬁ ed length 
of time. For example, if you specify 5 for Maximum Restarts In The Speciﬁ ed Period and 
10:00 (mm:ss) for the Period For Restarts, the cluster service will try to restart the resource 
ﬁ ve times during that 10 - minute period. After the ﬁ fth restart, the cluster service will no 
longer attempt to restart the service on the active node.  
 If Restart Is Unsuccessful, Fail Over All Resources In This Service or Application   If this 
option is selected, when the cluster service is no longer trying to restart the resource on 
the active node, it will fail the entire service or application to another cluster node. If you 
wanted to leave the application or service with a failed resource on the current node, 
you would clear this check box.  
 If All The Restart Attempts Fail, Begin Restarting Again After The Specified Period 
(hh:mm)   If this option is selected, the cluster service will restart the resource at a speciﬁ ed 
interval if all previous attempts have failed.  
 Pending Timeout   This option is used to set the amount of time in minutes and seconds 
that the cluster service should wait for this resource to respond to a change in states. If a 
resource takes longer than the cluster expects to change states, the cluster will mark it as 
having failed. If a resource consistently takes longer than this timer and the problem cannot 
be resolved, you may need to increase this value.  
 The Advanced Policies tab is shown in Figure 27.14.  
 F I G U R E 27.14 Resource Advanced Policies 
Achieving High Availability with Failover Clustering 
1085

1086 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 The options available on the Advanced Policies tab are as follows:  
  Possible Owners   This option allows an administrator to remove speciﬁ c cluster nodes 
from running this resource. Using this option is valuable when there are issues with a 
resource on a particular node and the administrator wants to keep the applications from 
failing over to that node until the problem can be repaired. 
  Basic Resource Health Check Interval   This option allows an administrator to customize 
the health check interval for this resource.  
  Thorough Resource Health Check Interval   This options allows an administrator to 
customize the thorough heath check interval for this resource.  
  Run This Resource In A Separate Resource Monitor   If the resource needs to be debugged 
by a support engineer, or if the resource conﬂ icts with other resources, this option may 
need to be used.  
 New Windows Server 2008 R2 
Clustering Features 
 When Microsoft released Windows Server 2008 clustering, they made many improvements 
over Windows Server 2003 clustering. Microsoft has taken Windows Server 2008 R2 
clustering a step further. Now that you have an understanding of clustering, let ’ s look at 
some of the R2 improvements.  
 Windows PowerShell Cmdlets for Failover Clusters   As we have explained throughout 
this book, Windows PowerShell is a command - line shell and scripting tool. Windows 
Server 2008 R2 clustering has new cmdlets that provide powerful ways to script cluster 
conﬁ guration and management tasks. Windows PowerShell cmdlets will eventually replace 
the  Cluster.exe command - line interface.  
  Read - Only Permissions Option   Using Windows Server 2008 R2, an administrator 
can allow users or groups to have read - only permission to see but not change the cluster 
conﬁ guration.  
 Cluster Shared Volumes   In Chapter 25,  “ Using Virtualization in Windows Server 2008 
R2, ” we looked at how Hyper - V works and we explained the uses of virtual machines. 
Cluster Shared Volumes (CSV) allows for the conﬁ guration of clustered virtual 
machines. Cluster Shared Volumes allows you to do the following: 
 Reduce the number of LUNs (disks) required for your virtual machines.  
 Make better use of disk space. The free space on a Cluster Shared Volume can be used 
by any VHD ﬁ le on that LUN.  
 More easily track the paths to VHD ﬁ les and other ﬁ les used by virtual machines.  
 Use a few Cluster Shared Volumes to create a conﬁ guration that supports many 
clustered virtual machines.   
■
■
■
■

 Achieving High Availability with 
Network Load Balancing 
 Some applications that need to be highly available do not require failover clustering, such 
as applications based on web services. These applications typically are able to use Network 
Load Balancing to balance connections across a number of server nodes. This is more easily 
done with applications that are session - less or have a minimal amount of session data. 
 An NLB cluster load - balances client TCP/IP connections between cluster nodes and 
does not share any application data between nodes. If application data needs to be shared 
between cluster nodes, another facility such as replication will need to be used, or the 
application will need to be able to retrieve this data. This can be accomplished with data 
replication, accessing data from a centralized location, or other methods. 
 Network Load Balancing is used both for fault tolerance and for scalability. When it ’ s 
used for fault tolerance, a failed node can be removed from the cluster and another node 
will automatically start servicing requests that were handled by the failed node. In some 
cases, one server does not have enough resources to handle all of the requests; when this 
occurs, NLB can be used to spread the connection load across multiple nodes. When NLB 
is conﬁ gured this way, it is conﬁ gured for scalability. 
 How Does Network Load Balancing Work? 
 As the name suggests, an NLB cluster uses the network to provide load balancing and 
redundancy. It is able to accomplish this using a virtual IP address and a virtual media 
access control (MAC) address that is shared among all of the nodes in the cluster. Client 
connections are all made to this virtual IP address, as shown in Figure 27.15. When an 
incoming packet is addressed to the virtual IP address, all of the NLB nodes receive it, but 
only the appropriate node responds. 
 When a client request arrives, all hosts simultaneously perform a calculation in order 
to determine which node should handle the request. The chosen node then accepts and 
responds to the client request, and the other cluster nodes discard it. 
 If all nodes are conﬁ gured identically, the same percentage of client requests will be 
load - balanced to each node; however, this can be customized to match server capabilities. 
All nodes synchronize their data about which node should respond to each request and 
which nodes are active members of the cluster. A number of signiﬁ cant improvements were 
made to NLB in Windows Server 2008 R2, as follows: 
 Support for IPv6 addresses.  
 Support of Network Driver Interface Speciﬁ cation (NDIS) 6.0 with compatibility with 
older versions.  
 Network Load Balancing can detect and notify applications of excessive load or attack 
scenarios.  
 Rolling upgrades can be done from Windows Server 2003 to Windows Server 2008 R2. 
■
■
■
■
Achieving High Availability with Network Load Balancing 
1087

1088 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 Network Load Balancing Requirements 
 Failover clusters require that all of the cluster nodes run either the Enterprise or Datacenter 
edition of Windows Server 2008 R2. Network Load Balancing is a feature that is available 
in all editions of Windows Server 2008 R2. 
 What sort of hardware is required to leverage NLB? The recommended conﬁ guration 
uses two network adapters on each node in the cluster. The primary network adapter 
is used for client communication, and the second network adapter facilitates the 
communication between the cluster nodes. In some conﬁ gurations, a single network 
adapter can be used, but the network hardware must support multicast trafﬁ c. 
 If multicast is chosen, additional network hardware requirements must be taken 
into consideration. For instance, upstream network hardware might need the multicast 
MAC address statically entered in the Address Resolution Protocol (ARP) table. This is 
because some network hardware does not accept an ARP response that resolves unicast 
IP addresses to multicast MAC addresses. 
 Also, using the Internet Group Management Protocol (IGMP) multicast option enables 
IGMP support for limiting switch ﬂ ooding by limiting trafﬁ c to Network Load Balancing 
ports only. This ensures that trafﬁ c intended for an NLB cluster passes through only 
those network ports serving the cluster hosts and not all ports. If standard multicasting is 
used, switches might require additional conﬁ guration to set the ports that are used for the 
multicast trafﬁ c.  
Clients
Virtual IP Address
Network Load Balanced Cluster
 F I G U R E 27.15 Network load - balanced cluster 

 Creating an NLB Cluster 
 The ﬁ rst step in creating an NLB cluster is to prepare each cluster node. In our example, we 
are going to use two servers, each with two network adapters. The network adapter that will 
host the load - balanced virtual IP and is used for client connections is renamed Client Network, 
and the network adapter used for cluster communications is renamed Cluster Network. Last, 
the Network Load Balancing feature is installed on both servers to prepare for conﬁ guration. 
Exercise 27.6 walks you through creating a simple NLB cluster.  
 E X E R C I S E  2 7. 6
Creating a Network Load Balancing Cluster 
 Follow these steps to create a network load - balanced cluster: 
 1. 
  Click Start   Administrative Tools   Network Load Balancing Manager. 
 2. 
  In the left pane, right - click Network Load Balancing Clusters, and then click 
New Cluster. 
 3. 
  In the Host ﬁ eld, type  NODEA , and then click Connect. 
 4. 
  Choose Client Network, and then click Next. 
 5. 
  Click Next to accept the default values for host parameters. 
 6. 
  Click Add to add a cluster IP address. 
 7. 
  In the IPv4 Address ﬁ eld, type   10.10.0.100  . 
 8. 
  In the Subnet Mask ﬁ eld, type   255.255.0.0 , click OK, and then click Next. 
 9. 
  In the Full Internet Name ﬁ eld, type   webapp.sybex.com  . 
 10.   Select Unicast, click Next, and then click Finish.  
 11.   Right - click  webapp.sybex.com , and then choose Add Host To Cluster. 
 12.   In the Host ﬁ eld, type  NODEB , and then click Connect. 
 13.   Click Client Network, and then click Next. 
 14.   Click Next to accept the default values for host parameters, and then click Finish. 
 Modifying Cluster Properties 
 As mentioned earlier, port rules modify how trafﬁ c is directed to NLB cluster nodes. The 
ﬁ ltering mode in a port rule deﬁ nes how requests are distributed among nodes in the 
NLB cluster. 
Achieving High Availability with Network Load Balancing 
1089

1090 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 You have the following options for ﬁ ltering modes, as shown in Figure 27.16:  
 F I G U R E 27.16 NLB port rules 
  Multiple Host   By default, this option is set. It conﬁ gures all NLB nodes to respond based 
on the weight assigned to each node. This spreads the load across multiple cluster nodes to 
increase scalability. If this option is selected, one of the Afﬁ nity options also needs to be 
selected. The higher the weight setting, the more load the node will handle.  
  Single Host   This option, when conﬁ gured, makes it so only the NLB node with the 
highest priority responds. If the highest - priority node fails, then the next - highest - priority 
node begins to respond. Sending requests to a single node increases availability but 
does not increase scalability.  
 Disable This Port Range   This option blocks all packets for this port range. This option is 
used when the cluster does not run any applications on a speciﬁ c port range.  
 The Afﬁ nity options, available when the Multiple Host option is selected in the ﬁ lter, 
control how requests are distributed to the available cluster nodes. The options for Afﬁ nity 
are as follows:  
  None   When this option is set, any available node can respond to any client request. This 
is suitable for applications such as static web pages that don ’ t require state information 
to be saved. For example, the client may retrieve the ﬁ rst web page from Node A and the 
second web page from Node B.   

 Single   When this option is set, a single node responds to all requests from a single client 
IP address. This is required for applications that you must authenticate or that require 
session state or encryption. This would be important for web applications that have 
user session variables, such as shopping carts.  
 Network   When this option is set, a single node responds to all requests from a speciﬁ c 
Class C network. This is useful when clients are accessing the NLB cluster from behind a 
group of proxy servers. This option ensures that a client connection can be maintained 
to a speciﬁ c server even when the source IP address varies within the same subnet.  
 When changing port rules for a speciﬁ c node, make sure the changes are reﬂ ected on the 
other nodes; otherwise, the cluster nodes may never complete convergence, which is needed 
for all the available cluster nodes to work properly.  
 Managing NLB Clusters 
 The Network Load Balancing Manager is the graphical interface used to conﬁ gure and 
manage NLB clusters, and  nlb.exe is the command - line counterpart. 
 As shown in Figure 27.17, there are ﬁ ve main functions that can be performed on active 
NLB cluster nodes: Start, Stop, Drainstop, Suspend, and Resume.  
 F I G U R E 27.17 Managing an NLB cluster node 
Achieving High Availability with Network Load Balancing 
1091

1092 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 These actions are used when managing an NLB cluster. Each of the options has a 
slightly different function and reason for use:  
  Start   This action starts a stopped NLB cluster node so that it can handle NLB trafﬁ c.  
  Stop   This action temporarily stops the node from participating in the cluster and 
handling NLB trafﬁ c.  
 Drainstop  This action stops the node from taking new sessions and then waits for active 
sessions to end before completely stopping participation in the cluster.  
  Suspend   This action is different from Stop because suspending NLB stops NLB on the 
node and suspends all NLB cluster - control commands on the node except for the resume 
and query commands.  
  Resume   This action will start NLB on a node that has been suspended.  
 After the NLB cluster is created and conﬁ gured, the application also needs to be 
installed and conﬁ gured on each server. In the case of a website, it would need to be created 
on each server and then the content either copied or provided over a network connection to 
be served. 
 Summary 
 High availability is more than just clustering. It is achieved through improved hardware, 
software, and processes. This chapter focused on how to conﬁ gure failover clustering and 
Network Load Balancing (NLB) to achieve high availability and scalability. 
 High availability should be approached through proper hardware conﬁ guration, 
training, and operational discipline. Failover clustering provides a highly available base for 
many applications such as databases and mail servers. 
 These clusters require either the Enterprise or Datacenter Edition of Windows Server 
2008 R2. Network load - balanced clusters are used to provide high availability and 
scalability for network - based applications such as VPNs and web servers. Network load -
 balanced clusters can be conﬁ gured with any edition of Windows Server 2008.  
 Exam Essentials  
  Know how to modify failover and failback settings.   These settings are set on the clustered 
service or application but can be modiﬁ ed by settings on the resources.  
  Know the hardware requirements for failover clustering and Network Load Balancing.  
 Failover clustering and Network Load Balancing have distinct hardware requirements. 
Know the differences. 

 Review Questions  
 1. 
  Which of the following editions of Windows Server 2008 R2 can be configured in a failover 
cluster? (Choose all that apply.)  
 A.   Windows Server 2008 R2 Web Edition  
 B.   Windows Server 2008 R2 Standard Edition  
 C.   Windows Server 2008 R2 Enterprise Edition  
 D.   Windows Server 2008 R2 Datacenter Edition  
 2. 
  Which of the following editions of Windows Server 2008 R2 can be configured in a 
Network Load Balancing cluster? (Choose all that apply.)  
 A.   Windows Server 2008 R2 Web Edition  
 B.   Windows Server 2008 R2 Standard Edition  
 C.   Windows Server 2008 R2 Enterprise Edition  
 D.   Windows Server 2008 R2 Datacenter Edition  
 3. 
 What is the maximum number of nodes that can participate in a Windows Server 2008 R2 
failover cluster?  
 A.   2 
 B.   4 
 C.   8 
 D.   16  
 4. 
  Which of the following actions should be performed against an NLB cluster node if 
maintenance needs to be performed while not terminating current connections?  
 A.   Evict  
 B.   Drainstop  
 C.   Pause  
 D.   Stop 
 5. 
  What is the maximum number of nodes that can participate in a Windows Server 2008 R2 
NLB cluster? 
 A.   4 
 B.   8 
 C.   16  
 D.   32  
Review Questions 
1093

1094 
Chapter 27 ■ Configuring High Availability in Windows Server 2008 R2
 6. 
 Which of the following applications would be better suited on a failover cluster instead of a 
network load - balanced cluster? (Choose all that apply.)  
 A.   SQL Server 
 B.   Website  
 C.   Exchange Mailbox Server  
 D.   VPN Services 
 7. 
  Which of the following applications would be better suited on a Network Load Balancing 
cluster instead of a failover cluster? (Choose all that apply.)  
 A.   SQL Server 
 B.   Website  
 C.   Database Servers 
 D.   Terminal Services  
 8. 
  To configure an NLB cluster with unicast, what is the minimum number of network 
adapters required in each node? 
 A.   One 
 B.   Two  
 C.   Three 
 D.   Six  
 9. 
  In a four - node cluster set to a Node and File Share Majority quorum model, how many 
votes can be lost before quorum is lost?  
 A.   One 
 B.   Two  
 C.   Three  
 D.   Four 
 10.   In a three - node cluster set to a Node Majority quorum model, how many cluster nodes can 
be offline before quorum is lost?  
 A.   Zero  
 B.   One 
 C.   Two  
 D.   Three  

 Answers to Review Questions 
 1. 
C, D.   Only the Enterprise and Datacenter Editions of Windows Server 2008 R2 can 
participate in a failover cluster. 
 2. 
A, B, C, D.  All editions of Windows Server 2008 R2 can be conﬁ gured in an NLB cluster.  
 3. 
D.   A Windows Server 2008 R2 cluster consisting of servers running the x64 version can 
contain up to 16 nodes.  
 4. 
B.   Drainstop is the function that allows the current session to end before stopping the 
cluster on the node. Evict is used to completely remove a node from a failover cluster. Pause 
is used to keep resources from failing over to a failover cluster node. Stop will immediately 
end the cluster service on the NLB cluster node, not allowing the current sessions to 
complete.  
 5. 
D.   A Windows Server 2008 R2 cluster can contain up to 32 nodes.  
 6. 
A, C.  SQL Servers and Exchange Servers are only supported on failover clusters. Websites 
and VPN services are network - based services, so they are better suited for NLB clusters.  
 7. 
B, D.   Websites and Terminal Services are all designed to work with NLB clusters. Database 
servers like SQL do not work on NLB clusters.  
 8. 
B.   To use unicast communication between NLB cluster nodes, each node must have a 
minimum of two network adapters.  
 9. 
B.  Up to two votes can be lost before quorum is no longer able to be achieved. These votes 
can come from the ﬁ le share witness or a cluster node.  
 10. B.   In a three - node cluster, only one node can be ofﬂ ine before quorum is lost; a majority of 
the votes must be available to achieve quorum.  
 Microsoft continually updates its question pool. We occasionally will 
add new and updated questions online. Please check the Sybex website 
at  www.sybex.com/go/mctswin08r2 . 
Answers to Review Questions 
1095


About the 
Companion CD  
 IN THIS APPENDIX: 
 What you ’ ll find on the CD 
 System requirements  
 Using the CD 
 Troubleshooting  




 Appendix

 What You ’ ll Find on the CD 
 The following sections are arranged by category and 
summarize the software and other goodies you ’ ll ﬁ nd on the CD. If you need help with 
installing the items provided on the CD, refer to the installation instructions in the  “ Using 
the CD ”  section of this appendix. 
 Sybex Test Engine 
 The CD contains the Sybex test engine, which includes the six bonus exams.  
 Electronic Flashcards 
 These handy electronic ﬂ ashcards are just what they sound like. One side contains a 
question or ﬁ ll - in - the - blank, and the other side shows the answer.  
 PDF of the Glossary of Terms 
 We have included an electronic version of the Glossary in  .pdf format. You can view the 
electronic version of the book with Adobe Reader.  
 Adobe Reader 
 We ’ ve also included a copy of Adobe Reader so you can view PDF ﬁ les that accompany the 
book ’ s content. For more information on Adobe Reader or to check for a newer version, 
visit Adobe ’ s website at  www.adobe.com/products/reader/ . 
 System Requirements 
 Make sure your computer meets the minimum system requirements shown in the following 
list. If your computer doesn ’ t match up to most of these requirements, you may have 
problems using the software and ﬁ les on the companion CD. For the latest and greatest 
information, please refer to the ReadMe ﬁ le located at the root of the CD - ROM.  

 A PC running Microsoft Windows 98, Windows 2000, Windows NT4 (with SP4 or 
later), Windows Me, Windows XP, Windows Vista, or Windows 7  
 An Internet connection  
 A CD - ROM drive 
 Using the CD 
 To install the items from the CD to your hard drive, follow these steps: 
 1. 
 Insert the CD into your computer ’ s CD - ROM drive. The license agreement appears.  
 Windows users : The interface won ’ t launch if you have autorun disabled. 
In that case, click Start   Run (for Windows Vista or Windows 7, Start   
All Programs   Accessories   Run). In the dialog box that appears, type 
  D:\Start.exe   . (Replace  D with the proper letter if your CD drive uses a 
different letter. If you don ’ t know the letter, see how your CD drive is listed 
under My Computer.) Click OK. 
 2. 
  Read the license agreement, and then click the Accept button if you want to use 
the CD.  
 The CD interface appears. The interface allows you to access the content with just one 
or two clicks.  
 Troubleshooting 
 Wiley has attempted to provide programs that work on most computers with the minimum 
system requirements. Alas, your computer may differ, and some programs may not work 
properly for some reason. 
 The two likeliest problems are that you don ’ t have enough memory (RAM) for 
the programs you want to use or you have other programs running that are affecting 
installation or running of a program. If you get an error message such as  “ Not enough 
memory ” or  “ Setup cannot continue, ” try one or more of the following suggestions and 
then try using the software again:  
 Turn off any antivirus software running on your computer.   Installation programs 
sometimes mimic virus activity and may make your computer incorrectly believe that it ’ s 
being infected by a virus.  
■
■
■
Troubleshooting 
1099

1100 
Appendix  About the Companion CD
  Close all running programs.   The more programs you have running, the less memory is 
available to other programs. Installation programs typically update ﬁ les and programs, so 
if you keep other programs running, installation may not work properly.  
  Have your local computer store add more RAM to your computer.   This is, admittedly, a 
drastic and somewhat expensive step. However, adding more memory can really help the 
speed of your computer and allow more programs to run at the same time.  
 Customer Care 
 If you have trouble with the book ’ s companion CD - ROM, please call the Wiley Product 
Technical Support phone number at (800) 762 - 2974. 

Index
Note to the Reader: Throughout this index boldfaced page numbers indicate primary discussions 
of a topic. Italicized page numbers indicate illustrations.
A
A records, 64–65
AAAA records, 38, 64–65, 529
AAS (application assignment scripts), 345
ABE (Access-Based Enumeration), 748
Accept All Routes option, 618
access
IIS, 925–927
network, 689–694, 690–691
remote, 687, 694–699, 695–698
SharePoint Foundation 2010, 998–999
SMTP, 909–912, 909–910
user, 687–689, 688
website applications, 939–940, 940
wireless, 673–675
Access-Based Enumeration (ABE), 748
access control entries (ACEs), 20, 270, 375, 
387–388, 387
access control lists (ACLs), 20, 270, 375
Media server, 963
working with, 387–388, 387
Access Is Determined By User Dial-In 
Properties option, 693
Access tab in SMTP, 909–912, 909
Access To The Content page, 957
accidental deletions, backups for, 443
Account Operators group, 381
Account tab, 288
Accounting Requests setting, 664
accounts
fax services, 949
integration, 706
templates for, 288
user, 18, 375, 383
Accounts tab, 949
ACEs (access control entries), 20, 270, 375, 
387–388, 387
Acknowledge process in DORA, 547
ACLs (access control lists), 20, 270, 375
Media server, 963
working with, 387–388, 387
Activate Scope page, 562–563, 562
Activate Server Wizard, 869, 871
activating
RD Licensing, 869–870
scopes, 562, 562, 566, 566, 577
superscopes, 578
Activation Authentication option, 617
activation interval, 1057
Active Directory
account integration, 706
client certificate authentication, 937
command prompt, 305–306
DHCP authorization for, 554–555
forests. See forests
installing. See installing
objects. See objects, Active Directory
optimization. See performance 
monitoring
overview, 4–5
benefits, 5–8, 7
data stores, 9
delegation of administrative control, 
19–20
domains, 11–13, 13
exam essentials, 31
forests, 13–15, 14–15
Global Catalog, 10–11
IDA, 26–30
logical structure, 9–15, 13–15
objects, 15–17
OUs, 17–18, 17
replication, 11
review questions, 32–34
schema, 10
searching mechanisms, 11
security, 18–19, 18

Active Directory (continued)
server roles, 21–26, 21
summary, 30–31
planning. See planning Active Directory
reliability. See reliability
replication. See replication
security. See security
server roles. See server roles
sites. See sites
trees. See trees
WDS, 1044
WSUS clients in, 776
Active Directory Administrative Center
description, 242
objects managed by, 117
working with, 303–305, 304
Active Directory Application Mode 
(ADAM), 108
Active Directory Best Practices Analyzer, 
242
Active Directory Certificate Services 
(AD CS)
certificates
CA server settings, 234–236, 236
enrolling, 228–230, 229–230
revoking, 232–234, 234
templates, 230–232
installing, 224–228, 225–228
new features, 236–237
overview, 21, 222–224
SSL, 932
Active Directory Domain Services (AD DS)
new features, 237–238, 241–242
overview, 21–23
RODCs, 238–240, 239
security features, 238–240, 239, 241
Active Directory Domains and Trusts tool
description, 117
multiple domains, 157
single-master roles, 160
UPN suffixes, 168
Active Directory Federation Services 
(AD FS), 242
configuring, 244–245
installing, 243–244, 243–244
overview, 24, 108, 242–243
Active Directory Installation Wizard
child domains, 144–149, 145–149
domain controllers, 110–114, 110–114
Active Directory Installation Wizard 
(DCPROMO), 110
domain controllers
demoting, 155–156, 157
promoting, 143–144
RODCs, 239, 239
for trees, 144, 150–153, 150–153
Active Directory Integrated DNS
advantages, 53–54
disadvantages, 53
setting up, 52–53, 52
Active Directory Lightweight Directory 
Services (AD LDS), 245
configuring, 246–249, 247–249
installing, 246, 246, 249–250
overview, 25
Active Directory Lightweight Directory 
Services Wizard, 247–249, 247–249
Active Directory Management Pack, 242
Active Directory Migration Tool (ADMT) 
v3.2, 289
Active Directory Module for Windows 
PowerShell, 117
Active Directory Object Type page, 
279, 280
Active Directory Recycle Bin feature, 
241, 451
Active Directory Replication and Sites 
tool, 182
Active Directory Rights Management 
Services (AD RMS), 250
description, 29
DRM, 966–971
installing, 252–254, 252–254
overview, 25, 250–251
templates, 255–256, 255–256
Active Directory Rights Management 
Services Administration console, 
255, 255
Active Directory Service Interfaces (ADSI), 
121
Active Directory Service Interfaces Editor 
(ADSI Edit), 397, 397, 454
1102 
Active Directory – Active Directory Service Interfaces Editor (ADSI Edit)

Active Directory Sites and Services tool
connection objects, 202, 202
description, 117
Global Catalog servers, 170, 206
sites
configuring, 195–197, 196
creating, 189–192, 190–192
moving server objects between, 
203–204
site links and bridges, 201
subnets, 192–195, 193–194
UGMC, 171
Active Directory Users and Computers tool
auditing, 407–408
computer accounts, 298
delegating control, 392
domain settings, 157
GPOs, 328–329
objects, 289–290
creating, 284–286, 285
filtering, 295
finding, 302–303
moving, 297
properties, 291–293
templates, 287–289
UPNs, 286–287
OUs, 271–276, 274, 276, 278
permissions, 386
publishing and assigning applications, 350
remote access profiles, 694
shared folders, 301, 729
single-master roles, 160–161
smart cards, 400
templates, 391–392
users, 389–391
working with, 117–119, 118
Active Directory Web Services (ADWS), 
242
ActiveX controls
Performance Monitor, 779
Reliability and Performance Monitor, 419
Activity Logging tab, 948–949
AD Client Certificate Authentication 
module, 940
AD CS. See Active Directory Certificate 
Services (AD CS)
AD DS. See Active Directory Domain 
Services (AD DS)
AD FS (Active Directory Federation 
Services), 242
configuring, 244–245
installing, 243–244, 243–244
overview, 24, 108, 242–243
ad hoc mode for wireless access, 674
AD LDS (Active Directory Lightweight 
Directory Services), 245
configuring, 246–249, 247–249
installing, 246, 246, 249–250
overview, 25
AD LDS Administrators screen, 249
AD RMS. See Active Directory Rights 
Management Services (AD RMS)
ADAM (Active Directory Application 
Mode), 108
Add A Port dialog box, 707, 707
Add A User Account So A Remote Router 
Can Dial In option, 614
Add Application Pool dialog box, 900–901, 
901
Add Counters dialog box, 421, 421, 
781, 782
Add Deny Restriction Rule dialog box, 
906, 906
Add Exclusion dialog box, 572, 572
Add Exclusions page
IP addresses, 558, 558
multicast scopes, 580
new scopes, 563, 565, 565
Add Features Wizard
BitLocker, 241, 241
BranchCache, 742
iSNS, 828
MPIO, 825
SMfS, 832
Add Folder Target page, 750
Add Folder To Namespace page, 749
Add Folder window, 748
Add Group Or User dialog box, 330
Add IP Filter dialog box
server troubleshooting, 634
TCP/IP packets, 628–629, 629
VPN packets, 630–631
Active Directory Sites and Services tool – Add IP Filter dialog box 
1103

Add Location dialog box, 233
Add New Quota Entry dialog box, 746
Add New Rule dialog box, 950
Add Node Wizard, 1079
Add-on for Internet Explorer, 251
Add Or Edit DHCP Scopes page, 553
Add Or Remove Programs dialog box, 353
Add Printer Wizard, 299–300, 300, 751
Add Roles Services dialog box, 964
Add Roles Wizard
AD CS, 225–228, 225–228
AD FS, 243, 243
AD LDS, 246, 246
AD RMS, 252–254, 252–254
Hyper-V, 1012, 1014
IIS, 891–892
RD Licensing, 868
Remote Desktop Services, 856
RRAS, 608
Add Scope dialog box, 553
Add Site Binding dialog box, 935
Add Upgrade Package dialog box, 352
Add User Rights page, 970
Add Web Site dialog box, 894–895, 894
Added Cost For Routes field, 617
Additional Domain Controller Options page
domain controller promotions, 112, 112
subdomains, 147, 147
trees, 152, 152
additive security, 733
address pools in DHCP, 552
Address Resolution Protocol (ARP), 689
Address Resolution Protocol (ARP) tables, 
1088
addresses
IP. See IP addresses
MAC, 470
adjacency in OSPF, 603
administration
Active Directory, 7–8
delegating, 19–20, 269–270
administration notices in SharePoint 
Foundation 2010, 979–980
administrative inconsistency from multiple 
domains, 139
administrative rights in IIS, 929–931, 
930–931
administrative templates in Group Policy, 
315–316
Administrative Tools folder, 186
Administrator account, 383
Administrator Properties dialog box, 694
Administrators group, 381
ADMT (Active Directory Migration Tool) 
v3.2, 289
ADMX Central Store, 316
ADSI (Active Directory Service Interfaces), 
121
ADSI Edit (Active Directory Service 
Interfaces Editor), 454
ADSI Edit dialog box, 397, 397
Adsiedit.msc snap-in, 454
Advanced Attributes dialog box, 444, 444, 
732, 732
Advanced Audit Policy settings, 408, 409
Advanced (Custom Settings) option, 670–671
Advanced Encryption Standard (AES), 675
Advanced Fast Start feature, 959–960
Advanced Policies tab, 1085–1086, 1085
Advanced Security Settings dialog box, 
670–671
Advanced Sharing dialog box, 731
Advanced Sharing page, 737
Advanced tab
DHCP servers, 568, 569, 571, 571
printers, 755–756, 756
RIP, 619–620, 619
Software Installation Properties, 355, 355
user classes, 576
Windows Firewall, 708, 708
Advertisement Lifetime (Minutes) field, 612
advertising function in Windows Installer, 
344
ADWS (Active Directory Web Services), 242
AES (Advanced Encryption Standard), 675
AGDLP strategies, 294–295
aging, DNS, 78
AIA (Authority Information Access), 
232–233
alerts
Performance Monitor, 428–429, 787–788
SharePoint Foundation 2010, 979
ALG (Application layer gateway), 528
alias records, 65
1104 
Add Location dialog box – alias records

all-1s broadcasts, 500
All Users Properties dialog box, 292
Allow authorization in FTP, 904, 904
allow IP addresses, 963
Allow Remote Systems To Connect Without 
Authentication option, 703
Allow Users To Continue To Use The 
Software, But Prevent New Installations 
option, 358
Allow Users To Download Infected 
Documents option, 986
Allow Zone Transfers option, 73
Allowed Ports tab, 862
Allowed RODC Password Replication 
group, 385
alternate access mappings, 996–997, 996
Alternate Credentials screen, 145
Always Dynamically Update DNS A And 
PTR Records option, 582
Always Install With Elevated Privileges 
policy, 358
ANI (automatic number identification), 686
Announce All Routes option, 618
Announce All Routes In The Ranges Listed 
option, 618
Anonymous accounts in Media server, 962
Anonymous Authentication module, 
938–939
Anonymous option in SMTP, 909, 911
AnonymousAddress value, 532
antivirus settings, 985–987, 986
anycast addresses, 531–532, 564
AppCmd tool
configured websites list, 920–921
IIS backups, 927–928
Appearance tab in Performance Monitor, 
427, 427, 787, 787
application assignment scripts (AAS), 345
application data partitions, 120–121
creating, 121–123, 122
ntdsutil for, 124–126, 126
replicas, 123–124
Application Directory Partition screen, 
248, 248
Application layer
description, 494, 495
protocol stacks, 474, 475
Application layer gateway (ALG), 528
Application log, 116
application pools in .NET, 900–902, 
901–902
application servers, 726
applications
categories, 356, 357
failover clusters, 1081–1083, 1081–1082
IIS settings, 891
installing, 342–345, 346
publishing and assigning, 346–347, 
350–351
virtualization, 1009
web, 890–891
IIS installation, 891–892
outgoing email settings, 981–982, 982
websites. See websites
website, 939–940, 940
applications logs, 797
Applications tab in Task Manager, 436, 436, 
790, 791
AppLocker feature, 349
Apply option for snapshots, 1035
Apply Snapshot window, 1035
Apply Static Routes option, 689
applying
software updates, 351–352
subnets, 509–510, 510–511
Approve permissions, 992
approving WSUS updates, 774
AppServices option, 924
architecture, Hyper-V, 1010–1011, 1011
Archives tab in fax services, 949
area border routers, 603
areas in OSPF, 603
ARP (Address Resolution Protocol), 689
ARP (Address Resolution Protocol) tables, 
1088
ARPAnet, 39
ASP.NET
IIS settings, 891
SharePoint Foundation forms, 1000
ASP.NET Impersonation module, 938
Aspnet_isapi.dll library, 901
Assign Drive Letter Or Path page, 819
Assign Memory page, 1026
Assign Static IP Addresses option, 689
all-1s broadcasts – Assign Static IP Addresses option 
1105

assigning
administrative roles, 235
applications, 346–347, 350–351
scope options, 575, 576
Attempt To Clean Infected Documents 
option, 986
attributes
network policy, 690–693, 691
schema, 10, 108
au domain, 40
audience targeting in SharePoint Foundation 
2010, 990–991
Audit Directory Services Access Properties 
dialog box, 406–407
auditing, 404–405
AD DS, 23, 238
CAs, 235
implementing, 405–407
new features, 408, 409
overview, 405
viewing information, 407–408
Auditors role, 251
Auditpol.exe utility, 322
authentication
AD LDS stores, 247
demand-dial interfaces, 614
digest, 1000–1001
domain controllers, 208–209
EAP, 650, 671–673, 685
log files, 664
mechanism assurance, 224
Media server, 961–962
RADIUS, 702
remote access profiles, 695–696, 695
RRAS protocols, 672–673
security, 684–686
selective vs. forest-wide, 163
SharePoint Foundation 2010, 999–1001
smart cards, 399–401, 401
SMTP, 909, 910, 911–912
strong, 28
trace logging, 924
verifying, 210
websites, 937–940, 938–940
Windows, 702–703, 702–703
Authentication Methods dialog box, 
703, 703
Authentication Methods pane, 695–696, 695
Authentication Requests setting, 664
authenticators, 685
authoritative restores, 449–450
Authority Information Access (AIA), 232–233
authorization
DHCP for Active Directory, 554–555
FTP, 904–905, 904
Media server, 962–963
websites, 939–940
Authorize DHCP Server page, 553
auto enrollment of certificates, 229–230, 
230
autoconfiguration, 526–527
automated installations, 344
Automatic Connection method, 869
automatic number identification (ANI), 686
Automatic Reconnection policy, 875
Automatic Start option, 1029
Automatic Stop option, 1029
automatic updates
Automatic Updates feature, 768–770, 
769–770
Group Policy, 353
Automatically Detect RD Gateway Server 
settings, 879
Automatically Use My Windows Logon 
Name And Password (And Domain If 
Any) option, 670
autostatic update mode in RIP, 602
availability
high. See high availability
objects, 298–299, 728–729
Available MB counter, 431
Avg. Disk Queue Length counter, 432
AXFR (full zone transfers), 56
B
backbones
border routing, 603–604, 603–604
multicast routing, 606
Background Intelligent Transfer Services 
(BITS), 769
background zone loading, 54, 59
Backup Once Wizard, 449
1106 
assigning – Backup Once Wizard

Backup Operators group, 381–382
Backup Progress screen, 449
Backup-SPFarm command, 988
Backup utility, 443–449, 443–444
backups
Active Directory
GPOs, 447
overview, 442–444, 443
process, 448–449
scheduling, 446
System State data, 445–446
types, 444–445, 444
wbadmin utility, 447–448
CA servers, 235–236
database files, 584
with domain controller demotion, 157
IIS, 927–929, 928
networks, 486, 802–803
SharePoint Foundation 2010, 987–989, 
987
VMs, 1032–1036
bandwidth
networks, 181
UGMC for, 171
Bandwidth Allocation Protocol (BAP), 
655, 697
Base option in SMTP, 914
Basic Authentication option
vs. Digest authentication, 1000
SMTP, 909, 912
websites, 938
basic disks, 817–818
Basic Encryption (MPPE 40-Bit) 
option, 697
Basic Resource Health Check Interval 
option, 1086
BCD (Boot Configuration Data) store, 
837–838
bcdedit utility, 838
Berkeley Internet Name Domain (BIND), 
42, 89–90, 90
Best Practices Analyzer (BPA), 242
BGP (Border Gateway Protocol), 604, 657
bidirectional trusts, 162
binary IP addresses, 497
BIND (Berkeley Internet Name Domain), 42
BIND Secondaries, 89–90, 90
binding
protocols, 479
SMTP, 914
SSL, 935
websites, 892–894, 893–894
BIOS for VMs, 1028
BitLocker drive encryption, 240, 
241, 739
BitLocker To Go, 739
BITS (Background Intelligent Transfer 
Services), 769
block inheritance, 320, 331, 331
Block Policy Inheritance option, 320
Boot Configuration Data (BCD) store, 
837–838
boot file backups, 446
Boot Image folder, 1051
boot images, 1043, 1050–1051
Boot Manager Screen, 1051
Boot tab in WDS, 1049
boot.wim file, 1050
booting from VHDs, 837–838
Border Gateway Protocol (BGP), 
604, 657
border routing, 604, 604
BPA (Best Practices Analyzer), 242
BranchCache Properties dialog box, 742
BranchCache technology, 739–740
distributed cache mode, 740–742
hosted mode, 742
installing, 742
bridgehead servers
creating, 204–205, 204–205
description, 186–187, 186
bridges, sites, 199–201, 200
broadcasting
IP addresses, 500, 528
Media server streaming, 955–957, 961
Browse For Shared Folders page, 750
Built-In container, 283
built-in domain local groups, 380–383, 
381, 383
burned-in addresses, 470
business needs, multiple domains for, 
137–138
business rules, sharing, 967–968
Bytes Total/Sec counter, 431–432
Backup Operators group – Bytes Total/Sec counter 
1107

C
CA Certificates, 230
ca domain, 40
caching
DNS Cache Locking, 61
DNS queries, 48
Media server, 959
trace logging, 925
UGMC, 171–172, 172
caching-only servers, 68–69, 69
Callback Control Protocol (CBCP), 647, 686
Callback Options control group, 688–689
caller ID information, 686
CALs (client access licenses)
RD Licensing, 866–868, 870–871
revoking, 873
cameras, 850–851
canonical name (CNAME) records, 65
capturing images, 1050–1052
CAs. See certificate authorities (CAs)
Categories tab for applications, 356, 357
CBCP (Callback Control Protocol), 647, 686
CCP (Compression Control Protocol), 
647, 655
CCR (Clustered Continuous Replication) 
clusters, 1074
CDPs (CRL distribution points), 232
Central Administration site
antivirus, 986
backups, 988
description, 977, 977
incoming email settings, 978–979
outgoing email settings, 981
site collections, 998
centralized Active Directory data storage, 6
Cert Publishers group, 223, 384
certificate authorities (CAs)
AD CS, 22
functions, 336
RD Gateway, 858
server settings, 234–236, 236
SSL, 932
types, 224
Certificate Authority Web Enrollment Role 
Service, 223
Certificate Enrollment Policy Web service, 237
certificate enrollment stations for smart 
cards, 400
Certificate Enrollment Web service, 228, 237
Certificate Revocation dialog box, 234
Certificate Revocation Lists (CRLs), 
223, 232
Certificate screen for RemoteApp, 856
Certificate Service DCOM Access 
group, 382
Certificate Services Client - Auto-Enrollment 
Properties dialog box, 337
Certificate Store page, 859
certificates
AD CS. See Active Directory Certificate 
Services (AD CS)
AD RMS, 251
CA server settings, 234–236, 236
digital signature settings, 880
enrolling
in GPOs, 335–337, 337
methods, 228–230, 229–230
HTTPS, 892
mapping, 224, 940
RD Gateway, 858–860
revoking, 232–234, 234
SSL
exporting and importing, 936–937, 
937
requesting and renewing, 933–935, 
933–935
templates, 230–232, 336
Certification Authority Backup Wizard, 236
Certification Practice Statement (CPS), 223
CGI option in trace logging, 925
chained installations, 768
Challenge Handshake Authentication 
Protocol (CHAP)
demand-dial interfaces, 614
description, 672
iSCSI, 826
PPP, 647
Change settings window, 770, 770
changes
challenges, 207–208
planning and testing, 418, 777–778
CHAP. See Challenge Handshake 
Authentication Protocol (CHAP)
1108 
CA Certificates – CHAP

child domains, 144–149, 145–149
child partitions
Hyper-V, 1011
virtualization, 836
Choose A Deployment Configuration page
domain controller promotion, 110, 110
subdomains, 144, 145
trees, 150, 150
Choose A Local Or Network Printer page, 
299, 751
Choose A Printer Port page, 299, 751
Choose A Server Authentication Certificate 
For SSL Encryption screen, 254
Choose Disk Type page, 1021–1022
Choose People On Your Network To Share 
With dialog box, 348
CIDR (Classless Inter-Domain Routing), 
522–525, 522
CIFS (Common Internet File System), 826
circular logs, 428, 788
claim mapping, 245
Class A networks
format, 500–501
subnets, 521, 524
Class B networks
format, 501
subnets, 512–513, 519–520, 524
Class C networks
format, 501–502
subnets, 511–512, 514–518, 523
Class D networks
address range, 502
Media server streaming, 956
multicasts, 579, 605
Class E networks, 502
classes
DHCP server settings, 575–577, 576
schema, 10, 108
scope options, 574
Classless Inter-Domain Routing (CIDR), 
522–525, 522
client access licenses (CALs)
RD Licensing, 866–868, 870–871
revoking, 873
Client Experience screen, 856
clients
access testing, 103
Active Directory
configuration management, 8
testing from, 119–120
certificates
computer, 231
mapping, 940
connectivity verification, 119
DHCP options, 575
DNS, 42–43, 586
image deployment components, 1043
PPP, 647
RD Gateway, 862
VPNs, 667
general properties, 667–668, 668
options settings, 668–669
security properties, 670–671
WSUS
configuring, 774–777
requirements, 774
cloning local drives, 1022–1023, 1023
Cluster Shared Volumes (CSVs), 1036, 1086
Clustered Continuous Replication (CCR) 
clusters, 1074
clusters, 1068
evaluating, 1069
failover. See failover clusters
NLB, 865–866
creating, 1089
managing, 1091–1092, 1091
properties, 1089–1091, 1090
virtualization, 837
CNAME (canonical name) records, 65
CNG (Cryptography Next Generation), 
230
CNs (common names), 16
collections, site, 998
Color Management tab, 756
COM+ Class Registration database, 446
com domain, 40
COM ports in VMs, 1029
command prompt in Active Directory, 
305–306
Common Internet File System (CIFS), 826
Common Name screen, 398
common names (CNs), 16
communication between protocol stacks, 
475, 476
child domains – communication between protocol stacks 
1109

communication services, 945–946
DRM. See Digital Rights Management 
(DRM)
exam essentials, 971
fax services, 946–951, 947
Media server. See Media server
review questions, 972–974
summary, 971
communities in SNMP, 801
Compact action for VHDs, 1025
compacting database files, 453, 585
Completing The New Scope Wizard page, 
566, 566
compression
Active Directory information, 198
file, 732, 732
trace logging, 925
Compression Control Protocol (CCP), 
647, 655
computer accounts
resetting, 298
in security, 376
computer certificates, enrolling
in GPOs, 335–337, 337
methods, 228–230, 229–230
Computer Group tab, 862
Computer Management tool, 420
computer names, 55
Computer Network options, 334
computer objects
description, 18, 283
Group Policy settings, 315–316
offline domain joins, 289–290
properties, 291
Computer Selection screen, 360, 360
Computers container, 283
conditional forwarding, 76
conditions in trace logging, 923, 923
configuration information for forests, 143
Configure AD RMS Cluster Key Storage 
screen, 253, 253
Configure Authentication Methods page, 
694, 700
Configure Automatic Updates Properties 
dialog box, 776
Configure CA Name screen, 227
Configure Certificate Database screen, 227
Configure Constraints screen, 694, 700
Configure Cryptography For CA screen, 
227, 227
Configure Device - WAN Miniport (PPTP) 
dialog box, 659–660, 660
Configure DHCP Options page, 559, 559, 563
Configure Discovery Scope screen, 856
Configure Discovery Scope For RD 
Licensing screen, 868
Configure Disk page, 1022
Configure Identity Federation Support 
screen, 254
Configure Keep-alive Connection Interval 
Policy, 875, 875
Configure Namespace page, 748–749
Configure Networking page, 1026
Configure RD Connection Broker Farm 
Name policy, 877
Configure RD Connection Broker Server 
Name policy, 877
Configure Settings page, 694, 700
Configure Your Server wizard, 68
Confirm Installation Selections page
AD CS, 228
AD FS, 244
AD LDS, 246
AD RMS, 254
BranchCache, 742
DFS, 749
DHCP, 553
failover clusters, 1075
Hyper-V, 1014
iSNS, 828
MPIO, 825
RD Licensing, 868–869
RemoteApp, 857
RRAS, 608
Storage Manager for SANs, 832
WDS, 1045
Connecting To SQL Server Instance page, 772
Connection Manager, 701
Connection Method page, 869
connection objects, 202–203, 202
connection-oriented protocols, 480
Connection Properties dialog box, 
667–672, 668
Connection Security Rules, 712–713, 712
1110 
communication services – Connection Security Rules

Connection Settings dialog box, 397
Connection Type page, 613, 615
connectionless protocols, 480
connections
demand dialing, 608, 613, 615
DUN, 644–648
IP-based, 655–657, 655–656
protocols, 479–480
RD Licensing, 869
security, 686
SMTP, 912
VMs, 1030, 1030–1031
Windows Firewall, 712–713, 712
connectivity
client, 119
network, 102–105, 105, 209
consistency in measurements, 418–419, 778
constraints
network, 181–182
remote access, 691, 693–695, 695
Constraints tab, 695, 695
contact objects, 283
content
Media server streaming, 954–958
trace logging options, 922–923, 922
Content Playback screen, 957
Contribute permissions, 991
controllers
domain. See domain controllers
for VMs, 1028
Convert action in VHDs, 1025
Convert To Dynamic Disk dialog box, 818
CONVERT utility, 101
converting
basic disks and dynamic disks, 818, 
1025
partitions, 101
copies, shadow, 803–805
copy backups, 445
CorporateDialup Properties dialog box, 201
CorporateWAN Properties dialog box, 201
corrupted applications, 344
costs
networks, 181–182
routing, 597–598
site replication, 200
counter logs, 428, 788
counters
Performance Monitor, 420–421, 781
System Monitor, 431–432
CPS (Certification Practice Statement), 223
CPU requirements in Hyper-V, 1012
CRC (cyclic redundancy check), 468
Create A DFS Namespace page, 748
Create A New Log File option, 664
Create Authorization policies screen, 857
Create Custom View dialog box, 797, 798
Create Distributed Rights Policy Template 
Wizard, 256
Create New Data Collector Set dialog box, 433
Create Or Join An AD RMS Cluster screen, 
253
Create Virtual Network page, 1019
Create Virtual Networks page, 1014
credentials
demand-dial interfaces, 614–615
Hyper-V, 1017
SMTP, 909–910
subdomains, 145, 145
trees, 151
WDS, 1044
Critical Error option, 923
CRL distribution points (CDPs), 232
CRLs (Certificate Revocation Lists), 223, 232
cross-forest trusts, 162–163
CryptoAPI, 224
cryptographic keys backups, 157
Cryptographic Operators group, 382
cryptographic service provider (CSP)
AD CS, 224
SSL, 934, 934
Cryptographic Service Provider Properties 
page, 934, 934
Cryptography Next Generation (CNG), 230
CSP (cryptographic service provider)
AD CS, 224
SSL, 934, 934
Csvde command, 305
CSVs (Cluster Shared Volumes), 1036, 1086
custom Event Viewer views, 797, 798
custom tasks, delegating, 279–281, 280
Custom zones in SharePoint Foundation 
2010, 1001
cyclic redundancy check (CRC), 468
Connection Settings dialog box – cyclic redundancy check (CRC) 
1111

D
daily backups, 445
data
AD LDS, 247
packets, 479
Data Collector Sets tool, 421, 433–434, 780
Data-Link layer, 468–470, 469
data migration, 747
data partitions, 120–121
creating, 121–123, 122
ntdsutil for, 124–126, 126
replicas, 123–124
data stores in Active Directory, 9, 446
Data tab in Performance Monitor, 426, 426, 
786, 786
Data Transfer Protocol screen, 956
database files
compacting, 453
DHCP, 583–585
DNS, 45–46, 46
database mounting tool (Dsamain.exe)
AD DS, 24, 238
description, 305
recovery process, 453
Database Options page, 772
database zones. See zones
datagrams, 651–652
Dcdiag command, 305
Dcpromo command, 305
DCPROMO tool. See Active Directory 
Installation Wizard (DCPROMO)
DCs (domain components), 16
DDNS (dynamic DNS) standard
DHCP integration with, 581–583
KMS, 1057
vs. non-dynamic, 43–44, 45
deactivating scopes, 577–578
Debug Logging tab, 80
decentralized administration model, 138
decentralized security, 486
default gateways, 560
Default Package Location setting, 354
default routes, 599
Default Routing user class, 577
default SID filtering, 162
default subnet masks, 507
Default Web Site bindings, 893–894, 893
Default zone in SharePoint Foundation 
2010, 1001
defragmentation, 453
Delay Notification option, 911
Delegated Domain Name page, 75, 75
delegation
Active Directory, 8, 19–20
DNS zones, 74–75, 75
GPOs control, 329–330
IIS administrative rights, 929–931, 
930–931
OU control, 269–270, 277–281, 278, 
280
users and groups control, 392–393
Delegation of Control Wizard
OUs, 278–281, 278, 280
users and groups, 392–393
Delete Saved Credentials setting, 1017
Delete Snapshot Subtree option, 1035
Delete Virtual Machine dialog box, 1029, 
1029
deleted data, backups for, 443
deleting
objects, 297
OUs, 275–276, 275–276
snapshots, 1035
superscopes, 578
VMs, 1029, 1029
Delivery Option type screen, 957
Delivery tab in SMTP, 911–913
demand-dial
interface settings, 612–615
VPNs, 660
Demand-Dial Connections page, 608
Demand-Dial Interface Wizard, 609, 
613–615
Demand-Dial Routing Connections 
(Inbound And Outbound) option, 660
demoting domain controllers, 124, 154–157, 
156
Denied RODC Password Replication group, 
385
deny IP addresses in Media server, 963
Deny permissions in NTFS, 733
Deny Restriction rules in FTP, 906
denying per-user access, 699
1112 
daily backups – denying per-user access

Dependencies tab, 1084, 1084
dependencies with failover clusters, 
1083–1084
Deploy Software dialog box, 351
deploying
servers. See servers
software. See software deployment
Deployment Server option, 1046
descriptions of OU objects, 268
Design permissions for SharePoint 
Foundation 2010, 991
Desktop
RDC. See Remote Desktop Connection 
(RDC)
virtualization, 1009
Desktop Composition feature, 848
Destination Address page, 615
development with virtualization, 835
device drivers and OSI model, 477
device redirection, 850–851, 861
Device Redirection tab, 861
devolution, DNS, 586
DFS. See Distributed File System (DFS)
Dfsrdiag.exe tool, 188–189
DHCP. See Dynamic Host Configuration 
Protocol (DHCP)
dhcp.mdb file, 584
DHCP snap-in, 553–554, 554
DHCP tab, 1049
Dhcp.tmp file, 584
DHCP User Classes dialog box, 576
diagnostic logging settings, 984–985
Dial-In Credentials page, 614
Dial-In tab, 688, 688, 695
Dial-Out Credentials page, 614–615
Dial-Up Connection Properties dialog box, 
667
dial-up networking (DUN), 644
functions, 645
infrastructure, 645–647
PPP connections, 647–648
Dialed Number option, 950
Dialing Options group, 669
dialing rules in fax services, 949–950
differencing VHDs, 837, 1021–1022
differential backups, 445
Digest authentication, 1000–1001
digital cameras, 850–851
digital certificates. See certificates
Digital Rights Management (DRM), 964
controversy about, 965
encryption, 966–967
licenses, 968–969
operation, 965–966
policy templates, 969–971
sharing business rules, 967–968
digital signatures, 880
DirectAccess, 743
infrastructure requirements, 744
installing, 744–745
operation, 743–744
vs. VPNs, 743
DirectAccess Manager, 745
DirectAccess Setup Wizard, 745
directed broadcasts, 500
Direction Of Trust page, 166, 167
directories
Active Directory. See Active Directory
defined, 5
IIS settings, 891
SharePoint Foundation 2010, 978
virtual, 895–896
Directory Location screen, 957
Directory Management Service section, 978
Directory Service log, 116, 440, 440, 794, 795
directory services
Active Directory. See Active Directory
overview, 27–28
Directory Services Restore Mode (DSRM), 
446
Directory Services Restore Mode 
Administrator Password page, 113, 113, 
148, 148
Disable Event Logging option, 621
Disable Media Source For Any Install 
option, 359
Disable Rollback option, 358–359
Disable Subnet Summarization option, 620
Disable This Port Range option, 1090
disaster recovery (DR), 1066
Disaster Recovery Plan (DRP), 154
Discard A And PTR Records When Lease Is 
Deleted option, 582
disconnected networks, WSUS on, 774
Dependencies tab – disconnected networks 
1113

discover images, 1050
Discover process in DORA, 547
Discovery tab, 827
Discovery Domain Sets tab, 829
Discovery Domains tab, 828
Disk Management program
disk initialization, 817
mount points, 824
VDS, 831
VHDs, 1023
volume sets, 819
working with, 101–102
Disk Reads/Sec Disk Writes/Sec counter, 431
diskettes, virtual, 1029
DiskPart utility, 831, 831
DiskRAID utility, 831
disks
basic and dynamic, 817–818
configuration, 101–102, 101
initializing, 816–817
quotas, 99, 745–746
VHDs. See virtual hard disks (VHDs)
volume sets, 819–820
Disks To Convert dialog box, 818
DISM command, 1015
Display Data Prioritization feature, 847
Display Progress While Connecting 
option, 669
display resolutions in RDC, 845, 845
Display tab, 845, 845
distance-vector routing protocols, 601–602
distinguished names (DNs)
functions, 17
overview, 16
distributed cache mode, 740–742
Distributed File System (DFS), 747
advantages, 747–748
DFS Management console, 749–750, 749
replication, 187–188
SYSVOL, 239
types, 748–749
Distributed File System Replication (DFSR), 
187–188
distribution groups
purpose, 19, 294
vs. security groups, 375, 377
SharePoint Foundation 2010, 990
DNs (distinguished names)
functions, 17
overview, 16
DNS. See Domain Name System (DNS)
DNS Cache Locking, 61
DNS Load Balancing (DNS round robin), 
863
DNS Notify, 56–57, 57
DNS Security Extensions (DNSSEC), 61–62
DNS Server log, 116
DNS snap-in
monitoring with, 79–81, 79–81
testing with, 80–81, 81
DNS Socket Pools, 61
DNS tab, 582, 582
DNSCmd tool, 87–88
DNSLint utility, 85–86
DNSSEC (DNS Security Extensions), 61–62
DnsUpdateProxy Group, 587
Do Not Announce All Routes In The Ranges 
Listed option, 618
Do Not Create New Log Files option, 926
Do Not Log Any Events option, 664
Do Not Respond To Any Client Computer 
option, 1047
Do Not Use A RD Gateway Server option, 
879
DoD model, 465–466
Domain Admins group, 384
domain components (DCs), 16
Domain Computers group, 384
domain controllers, 136–137
adding, 154
authenticating with, 208–209
demoting, 124, 154–157, 156
performance monitoring, 430–434
placing, 155, 206
promoting, 110–114, 110–114, 139
Domain Controllers container, 283
Domain Controllers group, 384
Domain Guests group, 384
domain local groups
built-in, 380–383, 381, 383
description, 294, 377–378
Domain Name And DNS Servers page, 560, 
560, 563
Domain Name System (DNS), 6, 35–36, 545
1114 
discover images – Domain Name System (DNS)

Active Directory integration with, 52–54, 
52, 126–128, 127–128
aging and scavenging, 78
caching-only servers, 68–69, 69
clients, 42–43, 586
components, 585–587
database population, 45–46, 46
DHCP settings, 560, 560
DNS Cache Locking, 61
DNS Socket Pools, 61
DNSSEC, 61–62
dynamic and non-dynamic, 43–44, 45
exam essentials, 91–92
forwarding, 75–76
installing, 67–68
IP address forms, 37–42, 38, 41
IPv6 address support, 59–60
KMS, 1057–1058
monitoring, 79–81, 79–81
overview, 36–37
queries, 46–49, 47
RD Connection Broker load balancing, 
864–865
read-only domain controllers, 60
records
creating, 76–78, 77–78
types, 62–67
review questions, 93–96
on RODCs, 239
round robin load balancing, 68
servers, clients, and resolvers, 
42–43
SMTP lookup, 913
summary, 90
testing, 80–81, 81
troubleshooting, 81–82
DNSCmd tool, 87–88
DNSLint utility, 85–86
ipconfig tool, 87
log files, 88–89
non-Microsoft DNS servers, 89–90, 
90
nslookup tool, 82–85
WDS, 1044
zones. See zones
Domain Naming Masters, 158
Domain NetBIOS Name page, 151, 151
domain operations masters, 158–159
Domain Users group, 384
domains
creating, 144–149, 145–149
forests. See forests
FTP restrictions, 905–906, 905–906
functional levels, 105–107
GPOs, 319
joining, 119–120, 289–290
multiple. See multiple domains
names, 42, 108
nslookup for, 84
overview, 11–13, 13
renaming, 108
SMTP settings, 914
structure planning, 109
top-level DNS, 40
trees. See trees
users and groups, 376
VPN problems, 662
Don’t Export Virtual Machine State Data 
option, 1033
DORA process, 547
dotted decimal notation, 37, 497
downtime in virtualization, 835
DR (disaster recovery), 1066
Drainstop action, 1092
drivers and OSI model, 477
DRM. See Digital Rights Management 
(DRM)
Drop All Packets Except Those That Meet 
The Criteria Below option, 628, 
630–631
DRP (Disaster Recovery Plan), 154
Dsacls command, 305
Dsadd command, 305
Dsamain command
AD DS, 24, 238
description, 305
recovery process, 453
Dsdbutil command, 305
Dsget command, 306
DSM Install tab, 826, 826
Dsmgmt command, 306
Dsmod command, 306
Dsmove command, 306
Dsquery command, 306
Domain Naming Masters – Dsquery command 
1115

DSRM (Directory Services Restore Mode), 
446
Dsrm command, 306
dual-boot, 99
dual stack mechanism, 533, 533
DUN (dial-up networking), 644
functions, 645
infrastructure, 645–647
PPP connections, 647–648
DVD drives in VMs, 1028
Dynamic Bandwidth Control Using BAP 
Or BACP option, 655
dynamic datacenters, 835
dynamic disks, 817–818
Dynamic DNS (DDNS) standard
DHCP integration with, 581–583
KMS, 1057
vs. non-dynamic, 43–44, 45
Dynamic Host Configuration Protocol 
(DHCP), 545
advantages, 548–549
authorization for Active Directory, 
554–555
database files, 583–585
disadvantages, 549
DORA process, 547
Dynamic DNS integration with, 581–583
exam essentials, 587–589
installing, 552–554, 554
leases. See leases, DHCP
multiple servers, 583
NAP enforcement, 705
overview, 546
review questions, 590–593
scopes. See scopes
server properties, 568–571, 568–571
settings, 44–46, 46
summary, 587
WDS, 1044
dynamic least queue depth configuration, 
825
Dynamic Memory feature, 1010
dynamic routing, 600–603, 601, 603
dynamic updates, 70, 73–74
dynamic VHDs, 837
dynamic volumes, 99–100
dynamically expanding VHDs, 1020
Dynamically Update DNS A And PTR 
Records For DHCP Clients That Do 
Not Request Updates option, 583
Dynamically Update DNS A And PTR 
Records Only If Requested By The 
DHCP option, 582
E
EAP (Extensible Authentication Protocol)
overview, 685
RAS, 671
VPNs, 650, 671
EAP-MD5 CHAP (Extensible 
Authentication Protocol-Message Digest 
5 Challenge Handshake Authentication 
Protocol), 672–673
EAP-TLS (Extensible Authentication 
Protocol-Transport Level Security), 
672
ease of administration, Active Directory 
for, 7–8
Easy Print, 851
ECC (elliptic curve cryptography), 230
Edit Application Pool Recycling Settings 
Wizard, 901–902, 902
Edit Disk tool, 1024–1025
Edit IPv4 Address and Domain Restrictions 
Settings dialog box, 905, 905
Edit Virtual Hard Disk Wizard, 1024, 
1024
edu domain, 40
EFI (Extensible Firmware Interface), 816
EFS (Encrypting File System), 732, 733
802.1X standard
authentication, 686
NAP enforcement, 705
sublayers, 469
elevated privileges in Windows Installer, 
343–344
elliptic curve cryptography (ECC), 230
email
fax services routed through, 950
SharePoint Foundation 2010
1116 
DSRM (Directory Services Restore Mode) – email

distribution groups, 990
incoming, 977–979
outgoing, 979–982, 982
SMTP. See Simple Mail Transfer Protocol 
(SMTP)
Enable Broadcast Name Resolution option, 
656
Enable Connection Through RD Gateway 
policy, 877
Enable Default Route Advertisement option, 
657
Enable DNS Dynamic Updates According To 
The Settings Below option, 582
Enable Fragmentation Checking option, 612
Enable Incoming E-Mail settings, 978
Enable IP Router Manager option, 612
Enable IPv4 Forwarding option, 656
Enable IPv6 Forwarding option, 657
Enable Poison-Reverse Processing option, 
620
Enable Router Discovery Advertisements 
option, 612
Enable Split-Horizon Processing option, 620
Enable Triggered Updates option, 620
encapsulation
PPP, 648
protocol stacks, 467
VPNs, 651–652, 652
Encrypting File System (EFS), 732, 733
encryption
BitLocker Drive Encryption, 240, 739
and domain controller demotion, 157
DRM, 966–967
filesystem, 99
L2TP, 653
NTFS, 733, 733
PPTP, 652
remote access profiles, 698–699, 698
SMTP, 909–910, 912
SSL, 934
VPNs, 649, 649
wireless, 674–675
Encryption pane, 697–698, 698
End-User License Agreement page, 772
enrolling certificates
in GPOs, 335–337, 337
methods, 228–230, 229–230
enrollment agents, 223
Enterprise Administrators role, 251
Enterprise Admins group, 384
Enterprise Root CAs, 224
errors
Event Viewer, 440–441, 441, 795, 796
nslookup messages, 84–85
SharePoint Foundation 2010 reports, 
984
trace logging, 923
Validate a Configuration Wizard reports, 
1077–1078, 1078
EUI-64 (Extended User Interface 64-bit) 
format, 532
Event Log Flood Protection option, 984
Event Logging tab, 79, 79
Event Properties dialog box, 441, 441, 
795, 796
Event Reports tab, 948
Event Severity option, 923
Event Viewer
for Active Directory, 114–117, 115, 
439–442, 440–441
auditing, 407–408
overview, 794–795, 795–797
views, 797, 798
events
auditing, 405–407
fax services, 948
logs. See logs
RD Gateway, 880–881
SharePoint Foundation 2010, 984–985
trace logging, 923
evicting failover cluster nodes, 1079
Exceptions tab, 706–707, 707
Exclude Application page, 969
Exclude User Wizard, 969
exclusions
DHCP IP addresses, 551
DRM licenses, 968–969
scopes
adding and removing, 571–572, 572
IPv4, 558, 558
IPv6, 565, 565
multicast, 580
Enable Broadcast Name Resolution option – exclusions 
1117

Expand action in VHDs, 1025
Experience tab, 846, 849
Expiration Timeout option, 911
Expires After field, 71
exporting
SSL certificates, 936, 937
VMs, 1032–1033
Windows Firewall policies, 713, 713
Extended User Interface 64-bit (EUI-64) 
format, 532
Extensible Authentication Protocol (EAP)
overview, 685
RAS, 671
VPNs, 650, 671
Extensible Authentication Protocol-
Message Digest 5 Challenge Handshake 
Authentication Protocol (EAP-MD5 
CHAP), 672–673
Extensible Authentication Protocol-Transport 
Level Security (EAP-TLS), 672
Extensible Firmware Interface (EFI), 816
Extensible rights Markup Language (XrML), 
251
extensible schema, 6
extensions, file, 356
external forwarding, 75
External option in virtual networks, 1018
external trusts, 162
extranet users, FTP sites for, 905
Extranet zone in SharePoint Foundation 
2010, 1001
F
failback in MPIO, 825
Failed Connection Authorization events, 881
Failed Request Tracing, 921–922, 922
Failed Resource Authorization events, 881
Failed User Connection To The Resource 
events, 881
Failover Cluster Management tool, 
1077–1080, 1083
failover clusters, 1068–1070, 1070
application settings, 1080–1083, 
1081–1082
configuration validation, 1074–1078, 
1076–1077
creating, 1078–1081, 1079
CSV, 1036
features, 1086
nodes, 1079–1080
quorums, 1072–1074, 1073–1074, 1079, 
1079
requirements, 1071–1072
roles and services, 1080–1081
failover configuration in MPIO, 825
farms
backups, 987–988
RDS configuration, 863–864
restores, 989
web, 903
Fast Cache feature, 959
Fast Reconnect feature, 960–961
Fast Recovery feature, 960–961
fast streaming in Media server, 958–959
FAT32 (File Allocation Table 32), 99
fault tolerance
Active Directory Integrated DNS, 53
DNS zones, 51
domain controllers for, 154
high availability. See high availability
Fax Server role, 946–948, 946
fax services, 946–947, 946
dialing rules, 949–950
local properties, 946–949, 947
routing locations, 950–951
feature delegation in IIS, 930, 930
Feature Wizard in RDC, 848
FEC (forward error correction), 960
federated identities, 28–29
Fibre Channel storage, 829–830
File Allocation Table 32 (FAT32), 99
File Extensions tab, 356
File Locations screen, 248
File Replication Service (FRS)
overview, 187–188
SYSVOL, 239
File Sharing dialog box, 301, 728, 750
File To Import page, 859
File Transfer Protocol (FTP), 903
extranet users, 905
1118 
Expand action in VHDs – File Transfer Protocol (FTP)

IIS settings, 891
IPv4 and domain restrictions, 905–906, 
905–906
overview, 903–904
permissions, 904–905, 904
and WebDAV, 906
FileHash switch in Dfsrdiag.exe, 188
files and file servers, 725–726
Active Directory object availability, 728–729
BitLocker Drive Encryption, 739
BranchCache, 739–742
conflict prevention, 344
DFS, 747–750, 749
DirectAccess, 743–745
disk quotas, 745–746
exam essentials, 758
extensions, 356
filesystems, 99–102, 101
importing objects from, 289
log. See logs
offline folders, 729–731, 730
overview, 726–727
permissions, 731–737, 732–736
review questions, 759–764
Share and Storage Management 
console, 738
sharing folders, 728
summary, 757–758
VM access settings, 1030
Windows Installer types, 345, 346
Files on the Content Type screen, 957
Filter Options dialog box, 295, 296
filters
GPOs
inheritance, 331, 331–332
security, 327–329, 327–328
LAN interfaces, 612
NLB, 1090
objects, 295–296, 296
RIP, 602
TCP/IP packets, 627–629, 628–629
trace logging, 924
VPN packets, 630–631
Windows Firewall, 707, 707
FIM (Forefront Identity Manager) 2010, 
29–30
Find dialog box, 729
Find Users, Contacts, And Groups dialog 
box, 302–303, 302–303
finding objects, 301–303, 302–303, 729
fine-grained password policies, 238, 
396–399, 397
Firewall with Advanced Security snap-in, 
708–714, 709–710, 713
firewalls
verifying configuration, 210
Windows. See Windows Firewall
First Retry Interval option, 911
Fixed Number Of Requests option, 901
fixed-size VHDs, 837, 1021–1023, 1023
flat addresses, 498
flexibility with multiple domains, 139
flexible host isolation in NAP, 705
flow control in RDC, 847
folders
faxes, 950
offline, 339, 729–731, 730
redirecting, 337–339
shared, 300–301, 301, 728
font smoothing, 846
footprints in Server Core, 1053
Force Policy Inheritance option, 320
Forefront Identity Manager (FIM) 2010, 
29–30
foreign security principals, 283, 385, 385
ForeignSecurityPrincipals folder, 385, 385
forest operations masters, 158
forest-wide authentication vs. selective 
authentication, 163
forests, 12, 135–136
functionality, 105, 107–108
joining trees to, 149–153, 150–153
overview, 13–15, 14–15
planning, 140
trusts, 108
working with, 142–143, 142
Format setting in log files, 664
Format Volume page, 820
Forms Authentication module, 938
forward error correction (FEC), 960
forwarding in DNS, 75–76
Found (302) redirection, 898
FileHash switch in Dfsrdiag.exe – Found (302) redirection 
1119

FQDNs (fully qualified domain names), 40, 41
description, 138
SMTP, 912–913
frames
Data-Link layer, 468
PPP, 651
FreeRADIUS package, 715
FRS (File Replication Service)
overview, 187–188
SYSVOL, 239
FTP. See File Transfer Protocol (FTP)
Full Control permissions, 991
Full trust option, 899
full zone transfers (AXFR), 56
Fully-Qualified Domain Name option, 
912–913
fully qualified domain names (FQDNs), 
40, 41
description, 138
SMTP, 912–913
G
gateways
default, 560
RD Gateway. See Remote Desktop 
Services Gateway (RD Gateway)
General Properties dialog box, 620–624, 
621–622
General tab
DHCP servers, 568–569, 568, 570
DNS integration with Active Directory, 
127–128, 128
fax services, 948
iSNS, 828
LANs, 611–612, 611, 627
multicast scopes, 580, 580
OUs, 276, 277
Performance Monitor, 424–425, 425, 
784–785, 785
printers, 752, 753
RAS and VPN clients, 667–668
RD CAP, 861
RD Licensing, 872
RD RAP, 862
RDC themes, 849
RIP, 616–617, 616, 623, 624
scopes, 567, 567
site links and bridges, 201
sites, 196, 196
SMTP, 908–909, 908
Software Installation Properties, 
354–355, 354
templates, 288–289
VPN packets, 630
VPNs, 659
Windows Firewall, 706, 706
zones, 70
Generic Routing Encapsulation (GRE) 
protocol, 630, 651
geographically dispersed clusters 
(geo-clustering), 1078
Get Help And Support option, 768
global audiences in SharePoint Foundation 
2010, 990
Global Catalog (GC)
Active Directory, 10–11
replication enhancements, 107
servers, 169–170, 170, 206, 207
trees and forests in, 140, 143
global deployment settings in RemoteApp, 
877–880
global groups
predefined, 384–385
scope, 294, 378
global IIS settings, 891
global object access auditing, 408
global unicast addresses, 531
globally unique identifiers (GUIDs), 15–16
GlobalName zones, 55–56, 60
gov domain, 40
GPMC. See Group Policy Management 
Console (GPMC)
GPOs. See Group Policy objects (GPOs)
GPP (Group Policy Preferences), 316
gpresult.exe utility, 360, 364–365
GPTs (GUID Partition Tables), 816
GPU virtualization feature, 854
granting per-user access, 699
Graph tab in Performance Monitor, 
426–427, 427, 786, 786
Graph view in Performance Monitor, 422, 
422, 782, 783
1120 
FQDNs (fully qualified domain names) – Graph view in Performance Monitor

GRE (Generic Routing Encapsulation) 
protocol, 630, 651
group claim mapping, 245
group objects, 283
group policies, 270–271
Group Policy, 314–315. See also Group 
Policy objects (GPOs)
description, 12
peer-to-peer networks, 484
for security, 393–399, 395–397
smart cards, 400–401
wireless, 675
Group Policy Creator Owners group, 384
Group Policy Management Console 
(GPMC), 322–324, 323–324
backups, 447
BranchCache, 740–741
certificate enrollment, 337
folder redirection, 338
offline folders, 730–731
security policies, 395
software policies, 349
software updates, 351
WSUS, 776–777
Group Policy Management dialog box, 
328, 328
Group Policy Management Editor, 323–324
BranchCache, 741
RDS, 875
security policies, 395–396, 396
Group Policy Management tool, 323, 323–
324
Group Policy Object Editor
deploying applications, 351
smart cards, 401
Group Policy objects (GPOs), 313–315
backups, 447
creating, 321–324, 323–324
delegating administrative control of, 
329–330
enrolling user and computer certificates 
in, 335–337, 337
exam essentials, 366–367
filtering
inheritance, 331, 331–332
security, 327–329, 327–328
folder redirection, 337–339
inheritance, 320, 331, 331–332
linking, 324–325
Loopback Policy, 334
managing, 325–326, 326
network configuration, 334–335, 335
offline folders, 729–731, 730
overview, 318–319
passwords, 703, 704
RDS, 874–877, 875
review questions, 368–371
script policies, 332–334, 333
security settings, 317–318
settings, 315–317
software deployment. See software 
deployment
strategies, 321
summary, 365–366
troubleshooting, 359–365, 360–363
Windows Firewall, 713
Windows PowerShell for, 339–340
WSUS, 776–777
Group Policy Preferences (GPP), 316
Group Policy Results Wizard, 360–362, 
360–362
Group Policy Slow Link Detection, 349–350
Group Policy Test Delegation window, 330
grouping resource for OUs, 266–268, 267
groups, 293
creating, 295
managing, 389–391
objects, 18–19, 18
properties, 294
in security, 19, 294
built-in domain local, 380–383, 381, 
383
creating and managing, 389–391
delegating control of, 392–393
Group Policy. See Group Policy objects 
(GPOs)
predefined global, 384–385
scope, 377–380, 379–380
types, 376–377
strategies, 294–295
Guest account, 383
guest operating systems, Hyper-V support 
for, 1010
guest partitions, 836
GRE (Generic Routing Encapsulation) protocol – guest partitions 
1121

Guests group, 382
GUID Partition Tables (GPTs), 816
GUIDs (globally unique identifiers), 
15–16
H
hard drives
Hyper-V requirements, 1012
VHDs. See virtual hard disks (VHDs)
VMs, 1028
hardware
backups for, 442–443
failover cluster requirements, 1071
Hyper-V, 836, 1012, 1013
VMs, 1028
hardware Ethernet addresses, 470
hash algorithms, 224
HBAs (host bus adapters), 827
headers
host, 894–895
IPv6, 527
packets, 479
Help And Support page, 768
hexadecimal IP addresses, 497
hierarchies
Active Directory, 6, 7
inheritance, 12
multiple domains for, 138
object naming, 12
OU consistency, 268
high availability, 1065–1066
components, 1066–1067
exam essentials, 1092
failover clusters. See failover clusters
foundation, 1067–1068
NLB, 1087–1092, 1088, 1090–1091
patches, 1068
review questions, 1093–1095
summary, 1092
High trust option, 899
high-volume CAs, 237
Histogram view in Performance Monitor, 
423, 423, 782, 783
historical information, backups for, 443
history
IIS settings, 927
performance, 419, 779
home folders, 727
HomeGroup, 484
host addresses, 498
host bus adapters (HBAs), 827
Host Clustering, 837
host headers for websites, 894–895
host records, 64–65
host routes, 599
host servers in virtualization, 836
host side rendering in RemoteFX, 854
hosted mode in BranchCache technology, 
742
hostnames, 42
hosts
in IP addresses, 505, 505
KMS, 1054, 1056–1058
multi-homed, 605–606
quantities, 524–525
RD Session
configuring, 878
licensing, 872–874, 872
smart, 912
HOSTS file, 38, 38
HTTP Redirection module, 896–897, 897
HTTPS (Hypertext Transfer Protocol 
Secure), 892
Hyper-V utility, 834, 1008
architecture, 1010–1011, 1011
description, 242
features, 835–836, 1009–1010
guest operating systems, 1010
Hyper-V Manager, 1015–1016, 1016
installing, 1013–1015
requirements, 1012–1013, 1013
Server Manager, 1014–1015, 1015
settings, 1016–1017, 1017
VHDs, 1020–1025, 1023–1024
virtual networks, 1017–1020, 1018–1019
virtualization overview, 1008
VMs. See virtual machines (VMs)
Hyper-V Integration Components, 1031–1032
Hypertext Transfer Protocol Secure 
(HTTPS), 892
1122 
Guests group – Hypertext Transfer Protocol Secure (HTTPS)

I
IANA (Internet Assigned Numbers Authority)
port number assignment, 496, 702
root hints, 69
ICANN (Internet Corporation for Assigned 
Names and Numbers)
root hints, 69
TLD assignments, 41
IDE controllers in VMs, 1028
identifiers for objects, 15–16
Identity and Access (IDA) solutions, 26–27
directory services, 27–28
federated identities, 28–29
information protection, 29
strong authentication, 28
identity claim mapping, 245
Idle Time Before Hanging Up menu, 669
IdRecord switch in Dfsrdiag.exe, 188
IEEE (Institute of Electrical and Electronics 
Engineers), 469, 469
IEEE 802.X standard
authentication, 686
NAP enforcement, 705
sublayers, 469
IETF (Internet Engineering Task Force), 579
If All The Restart Attempts Fail, Begin 
Restarting Again After The Specified 
Period (hh:mm) option, 1085
If Resource Fails, Attempt Restart On 
Current Node option, 1085
If Resource Fails, Do Not Restart option, 
1085
If Restart Is Unsuccessful, Fail Over 
All Resources In This Service or 
Application option, 1085
IFM (Install from Media) feature, 
1058–1059
IGMP (Internet Group Management 
Protocol), 606, 1088
Ignore All Routes In The Ranges Listed, 618
IIS. See Internet Information Services (IIS)
IIS (Internet Information Services) Manager, 
894–895, 894
IKEv2 (Internet Key Exchange Version 2), 
673
images
benefits, 1044–1045
capturing, 1050–1052
deploying, 1043–1044
types, 1049–1050
Immediately Uninstall The Software From 
Users And Computers option, 358
Import Virtual Machine dialog box, 1033
importing
objects, 289
SSL certificates, 937, 937
VMs, 1032–1033
Windows Firewall policies, 713, 713
Importing LDIF Files screen, 249, 249
in-addr.arpa domain, 48
in-place upgrades in SharePoint Foundation 
2010, 994–995
inbound filters
LAN interfaces, 612
TCP/IP packets, 627–628, 628
VPN packets, 630–631
Inbound Filters dialog box
server troubleshooting, 634
TCP/IP packets, 628, 628
VPN packets, 630–631
Inbound Filters option, 612
inbound rules
BranchCache, 741
Windows Firewall, 709–712, 710
Include Host Routes In Sent Announcements 
option, 620
Include Windows Logon Domain option, 669
Incoming E-Mail Server Display Address 
settings, 978
incoming email in SharePoint Foundation 
2010, 977–979
incremental backups, 445
incremental zone transfers (IXFR), 56
InetOrgPerson objects, 284
information commands in IPv6, 536
information protection, 29
Infrastructure Masters, 159
infrastructure of DUN, 645–647
Infrastructure options
trace logging, 924
wireless access, 674
IANA (Internet Assigned Numbers Authority) – Infrastructure options 
1123

inheritance
GPOs, 320, 331, 331–332
hierarchical, 12
OUs, 268, 270
settings, 20
Initial Score option in RADIUS, 702
initialization files, 345
initializing disks, 816–817
Inspect Disk tool, 1024
Install from Media (IFM) feature, 1058–1059
Install Image folder, 1051
install images, 1043, 1050
Install Licenses Wizard, 870
Install The Printer Driver page, 299, 751
install.wim file, 1050
Installation Mode Selection page, 772
Installation Options page, 1026
Installation User Interface Options settings, 
355
installing
Active Directory, 109–110
application data partitions, 120–126, 
122, 126
DNS integration configuration, 
126–128, 127–128
domain controller promotion, 
110–114, 110–114
exam essentials, 129
review questions, 130–133
summary, 128–129
verifying, 114–120, 115, 118
AD CS, 224–228, 225–228
AD FS, 243–244, 243–244
AD LDS, 246, 246, 249–250
AD RMS, 252–254, 252–254
applications, 342–345, 346
BranchCache, 742
DFS namespace service, 748–749
DHCP, 552–554, 554
DirectAccess, 744–745
DNS, 67–68
failover clustering, 1075
Fax Server role, 946–949, 946
Hyper-V, 1013–1015
Hyper-V Integration Components, 
1031–1032
IIS, 891–892
IIS modules, 896
KMS, 1055–1057
NLB, 865–866
patches, 1068
RD Gateway certificates, 859
RD Licensing, 867–871
RemoteApp programs, 856–857, 857
RIP, 623
RRAS, 608–609
SMfS, 832
SNMP, 801
VPNs, 657–659, 658
WDS, 1044–1046
Web-Based Administration, 964
WSUS servers, 772–773
Installing Printer page, 299, 752
Instance Name screen, 248
instances
counters, 421
Performance Monitor, 781
Institute of Electrical and Electronics 
Engineers (IEEE), 469, 469
int domain, 40
Integrated Services Digital Network (ISDN), 
607, 646
Integrated Windows Authentication option, 
909, 912
integration services
Hyper-V, 1031–1032
VMs, 1029
Intelligent Screen Capture feature, 854
intelligent streaming, 958–959
Interface Name page, 613–614
interfaces for IP routing, 609–610, 611
demand-dial, 612–615
LAN, 611–612, 611
RIP, 615–620, 616–619
Internal Only option for virtual networks, 1018
internal routing, 604
International Organization for 
Standardization (ISO), 464
Internet
access tests, 103, 105
description, 181
multicast backbones, 606
1124 
inheritance – Internet

Internet Assigned Numbers Authority 
(IANA)
port number assignment, 496, 702
root hints, 69
Internet Corporation for Assigned Names 
and Numbers (ICANN)
root hints, 69
TLD assignments, 41
Internet Engineering Task Force (IETF), 579
Internet Group Management Protocol 
(IGMP), 606, 1088
Internet Information Services (IIS)
access logging, 925–927
AppCmd for, 920–921
backup and restore, 927–929, 928
delegating administrative rights, 
929–931, 930–931
installing, 891–892
modules, 890–891, 896
SMTP in, 907
trace logging, 921–925, 922–924
website creation, 894, 894
Internet Information Services (IIS) Manager, 
894–895, 894
Internet Key Exchange Version 2 (IKEv2), 
673
Internet layer, 494, 495
Internet Protocol (IP), 181, 482, 648
addresses. See IP addresses
routing. See IP routing
Internet Protocol Security (IPsec)
description, 527
NAP enforcement, 705
Windows Firewall policies, 714
Internet Protocol version 6. See IPv6 
addresses
Internet service providers (ISPs), subnet 
mask use in, 520–521
Internet Small Computer System Interface 
(iSCSI), 826–827
Internet Storage Name Service (iSNS), 
828–829
Internet zone in SharePoint Foundation 
2010, 1001
internetworks, 596
interoperability in IPv4 to IPv6, 528
intersite replication, 197–199, 199
intervals for database backups, 584
Intra-Site Automatic Tunnel Addressing 
Protocol (ISATAP), 528, 534–535
Intranet zone in SharePoint Foundation 
2010, 1001
intrasite replication, 197–198
Introduction To DHCP page, 553
Introduction To Remote Desktop Services 
page, 856
inverse queries, 48
IP (Internet Protocol), 181, 482, 648
addresses. See IP addresses
routing. See IP routing
IP Address Assignment page, 608–609, 
656, 656
IP Address Range page
multicast scopes, 579
new scopes, 557, 557, 563
IP addresses, 497
Class A networks, 500–501
Class B networks, 501
Class c networks, 501–502
class overview, 499–500
DHCP. See Dynamic Host Configuration 
Protocol (DHCP)
forms, 37–42, 38, 41
FTP restrictions, 905–906, 905–906
hierarchical, 497–498
IPv6. See IPv6 addresses
Media server, 963
RAS, 655–657, 655–656, 696, 696
scopes. See scopes
structure, 498
subnetting networks. See subnets
websites, 894–895
IP-based PPP connections, 655–657, 655–656
IP Control Protocol (IPCP), 647–648
IP datagrams, 651–652
IP-in-IP interfaces, 606
IP model, 465–466
IP routing, 609, 620
interfaces, 609–610, 611
demand-dial, 612–615
LAN, 611–612, 611
RIP, 615–620, 616–619
Internet Assigned Numbers Authority (IANA) – IP routing 
1125

IP routing (continued)
logging properties, 621, 621
managing, 631–633
preference levels properties, 622, 622
protocols, 622–624, 624
static routes, 625–627, 626
troubleshooting, 633–635
IP Routing Table window, 627
IP Settings pane, 696, 696
ipconfig tool
/all switch, 104, 105
DNS information, 87
IPv6, 530, 531
lease options, 549–550
/release switch, 549–550
/renew switch, 549
/setclassid switch, 550, 574–575
IPCP (IP Control Protocol), 647–648
IPsec (Internet Protocol Security)
description, 527
NAP enforcement, 705
Windows Firewall policies, 714
IPv4 General Properties dialog box, 623
IPv4 Properties dialog box, 568–569, 
568–570, 582, 582
IPv4 Static Routes dialog box, 625–626, 626
IPv4 tab, 655–656, 655
IPv6 addresses, 525
concepts, 526–528
dual stack, 533, 533
format, 528–530, 529–531
history and need, 525–526
information commands, 536
integration and migration, 533
scopes. See scopes
subnets, 536–537
support, 59–60
tunneling, 534–536, 536
types, 531–533
IPv6 Properties dialog box, 569–571, 570–571
IPv6 tab, 656–657, 656
ISATAP (Intra-Site Automatic Tunnel 
Addressing Protocol), 528, 534–535
iSCSI (Internet Small Computer System 
Interface), 826–827
iscsicli command, 828
ISDN (Integrated Services Digital Network), 
607, 646
iSNS (Internet Storage Name Service), 
828–829
ISO (International Organization for 
Standardization), 464
ISPs (Internet service providers), subnet 
mask use in, 520–521
iterative queries, 46
IXFR (incremental zone transfers), 56
J
J50.chk file, 584
J50.log file, 584
JET (Joint Engine Technology), 
583–585
jetpack command, 585
Join RD Connection Broker policy, 877
joining
domains, 119–120, 289–290
trees to forests, 149–153, 150–153
Joint Engine Technology (JET), 583–585
jp domain, 40
K
KCC (Knowledge Consistency Checker)
application data partitions, 123
site replication, 199
Kerberos authentication, 685
Key Distribution Center Service account, 
383
Key Management Services (KMS)
configuring, 1057–1059
installing, 1055–1057
overview, 1054–1055
key recovery agents, 235
keyboard Hyper-V settings, 1017
keys
archival, 234–235
DRM, 965–966
KMS, 1054
SSL, 932
1126 
IP routing – keys

KMS (Key Management Services)
configuring, 1057–1059
installing, 1055–1057
overview, 1054–1055
Knowledge Consistency Checker (KCC)
application data partitions, 123
site replication, 199
krbtgt account, 383
L
L2TP (Layer 2 Tunneling Protocol)
demand-dial interfaces, 613
packet filters, 631
VPNs, 650
L2TP/IPSec tunneling, 653
LANs (local area networks)
access testing, 103
description, 180–181
interfaces, 611–612, 611
last domain controllers, removing, 156–157
Layer 2 Tunneling Protocol (L2TP)
demand-dial interfaces, 613
packet filters, 631
VPNs, 650
LCP (Link Control Protocol), 647, 655
LDAP (Lightweight Directory Access 
Protocol)
AD LDS, 25, 245
SMTP, 913–914, 913
LDAP Routing tab, 913–914, 913
ldifde utility, 289, 306
LDP tool, 122, 122
Lease Duration page
multicast scopes, 580
new scopes, 558, 559, 563
leases, DHCP
duration, 558, 559, 566, 566
ipconfig options, 549–550
releasing, 548
renewing, 547–548
legality, multiple domains for, 138
Level Of Preference field, 612
library items in SharePoint Foundation 2010, 
990
License Server Activation page, 870
licenses
DRM, 965–966, 968–969
KMS, 1054
RD. See Remote Desktop Licensing (RD 
Licensing)
software, 341
Licensing tab, 872, 872
Lifetime tab, 580–581, 581
Lightweight Directory Access Protocol 
(LDAP)
AD LDS, 25, 245
SMTP, 913–914, 913
Limit Maximum Color Depth policy, 876
limitations of OU objects, 268
Limited Access permissions, 991
limited broadcasts, 500
linear logs, 429, 788
Link Control Protocol (LCP), 647, 655
Link layer, 494, 495
link-local addresses, 531–532
Link-Local Multicast Name Resolution 
(LLMNR), 586
link-state maps, 603
link-state protocols, 603, 603
linked value replication, 108, 185
links
GPOs, 324–325
sites, 188, 189, 199–201, 200
List In The Directory option, 753
list items in SharePoint Foundation 2010, 
990
live migration and CSVs, 1036
LLC (Logical Link Control) layer, 469–470, 
469
LLMNR (Link-Local Multicast Name 
Resolution), 586
load balancing
DNS zones, 51
NLB. See Network Load Balancing 
(NLB)
RDS, 862–866
round robin, 68
loading, background zone, 54, 59
Local Area Connection Properties dialog 
box, 611–612, 611, 634
KMS (Key Management Services) – Local Area Connection 
1127

Local Area Network Properties dialog 
box, 627
local area networks (LANs)
access testing, 103
description, 180–181
interfaces, 611–612, 611
Local Computer Policy tool, 322
local database zones, 50–51
Local File Logging dialog box, 665
local GPOs, 319
local groups, built-in domain, 380–383, 381, 
383
Local Resources tab, 850
Local Security Policy tool
auditing with, 406–407
auto enrollment, 229–230, 229–230
local users and groups, 376
Location for Database, Log Files, and 
SYSVOL page
databases, 148, 148
filesystems, 112–113, 113
object auditing, 153
locking
DNS Cache Locking, 61
IIS features, 930
Lockout Duration screen, 398
Lockout Threshold screen, 398
locks in WebDAV, 906
Log Additional Routing And Remote Access 
Information option, 664
Log All Events option, 664
Log Errors And Warnings option
IP routing, 621
RRAS, 663
Log Errors Only option
IP routing, 621
RRAS, 663
Log File tab, 664–665, 665
Log The Maximum Amount Of Information 
option, 621
logging mode in RSoP, 360–363, 360–363
Logging tab
IP routing, 621, 621
RRAS, 663–664
logical drives, 817
logical grouping of resources, 266–268, 267
Logical Link Control (LLC) layer, 469–470, 
469
logical unit numbers (LUNs)
CSVs for, 1086
Fibre Channel storage, 829, 831
Provision Storage Wizard, 738
SMfS management, 832–833
Logon/Logoff scripts, 333
logons, UGMC for, 171
logs
diagnostic logging settings, 984–985
DNS, 88–89
event, 666
Event Viewer
Directory Service, 115–117, 115, 794, 
795
DNS Server, 797, 797
IIS access, 925–927
performance, 428–429, 787–788
properties, 664–665
RD Gateway, 880–881
RRAS control, 663–665, 665
SharePoint Foundation 2010, 984–985
trace logging, 921–925, 922–924
WSUS servers, 774
Loopback Policy, 334
loopback tests, 500
LostAndFound folder, 295
Low trust option in .NET, 899
LUNs. See logical unit numbers (LUNs)
M
MAC addresses, 470
MAC (Media Access Control) layer, 
469–470, 469
MADCAP (Multicast Address Dynamic 
Client Allocation Protocol), 579
mail exchanger (MX) records, 66
maintenance
Server Core, 1053
software, 341
MAK (Multiple Activation Key), 1055
malicious deletions, backups for, 443
Manage Hierarchy permissions, 992
1128 
Local Area Network Properties dialog – Manage Hierarchy permissions

Managed By tab, 276, 277
Managed Pipeline Mode option, 900–901
Managed Service Accounts, 242, 283
management
Server Core reductions, 1053
subnets for, 502
management challenges from multiple 
domains, 139
management tools for image deployment, 1043
mandatory upgrades, 352
mapping
certificates, 224
to RD Gateway server, 860
website, 940
SharePoint Foundation 2010, 996–997, 
996
user and group claim, 245
maps, link-state, 603
Mark This Key As Exportable option, 859
masks, subnets, 506–509, 507–508
Masquerade Domain option, 912
masquerading, network, 607
Master Boot Records (MBRs), 816
Maximum File Size (In Bytes) option, 926
Maximum Hop Count setting, 912
Maximum Password Age screen, 398
Maximum Ports setting, 660
maximum size for shadow copies, 804
Maximum Strength Encryption setting, 671
MBones, 606
MBRs (Master Boot Records), 816
MBSA (Microsoft Baseline Security 
Analyzer), 799
command-line, 800–801
GUI version, 799–800, 800
mbsacli.exe utility, 800–801
mean time between failure (MTBF), 1067
mean time to recover (MTTR), 1067
measurement consistency, 418–419, 778
Media Access Control (MAC) layer, 
469–470, 469
media players, 850–851
Media server, 951, 951
features, 951–953
security, 961–963
streaming solutions, 953–954
Advanced Fast Start, 959–960
advanced options, 958–959
content, 954–958
Fast Cache, 959
Fast Recovery and Fast Reconnect, 
960–961
Web-Based Administration, 964
Media Transfer Protocol (MTP), 850
Medium trust option in .NET, 899
Members Of tab, 288–289
memory
application pools, 902
Hyper-V requirements, 1012
VMs, 1028
Memory performance object, 431
Merge action in VHDs, 1025
Merge Mode for Loopback Policy, 334
Messages tab, 910–911
metrics, routing, 597–598
Microsoft Application Center 2000, 903
Microsoft Baseline Security Analyzer 
(MBSA), 799
command-line, 800–801
GUI version, 799–800, 800
Microsoft CHAPv2 (MS-CHAPv2), 685
Microsoft Device Specific Module 
(Microsoft DSM), 824–825
Microsoft Point of Service (POS), 851
Microsoft Point-to-Point Encryption (MPPE) 
algorithm, 652
Microsoft Support, 767
Microsoft TechNet tool, 767
Microsoft Transformation (MST) files, 345
Microsoft Update Standalone Package 
(MSU) file, 953
Microsoft Windows Installer (MSI)
packages, 345, 346
settings, 358–359
software maintenance, 342
migration
to AD LDS, 247
ADMT tool, 289
DFS for, 747
Hyper-V, 1009
print servers, 757
VMs, 836, 1036
Managed By tab – migration 
1129

mil domain, 40
Minimal trust option in .NET, 899
Minimum (Default) TTL field, 71
Minimum Password Age screen, 398
Minimum Password Length screen, 398
mirrored volumes, 819–823, 822–823
mixed mode authentication, 685
mobility in IPv6, 527
modems, 646
Module option, 925
modules
authentication, 938–939, 938
IIS, 890–891, 896
trace logging, 925
monitoring
DNS, 79–81, 79–81
performance. See performance 
monitoring
ports, 666, 666
replication, 209–211, 453–454
routing status, 632
RRAS activity, 663
Windows Firewall settings, 714
Monitoring tab, 79–81, 80
monitors
RemoteFX support, 854
spanning, 846
mount points, 824
mounted drives, 100
Move dialog box, 275, 275
Move Server dialog box, 203–204, 203
moving
DHCP database files, 584–585
objects, 297
OUs, 275–276, 275–276
server objects between sites, 203–204, 203
MPIO (multipath I/O), 824–826, 826
MPPE (Microsoft Point-to-Point Encryption) 
algorithm, 652
MS-CHAP
demand-dial interfaces, 614
MS-CHAPv1, 673
MS-CHAPv2, 673, 685
MSI (Microsoft Windows Installer)
packages, 345, 346
settings, 358–359
software maintenance, 342
MSMQ Queue Alias objects, 284
MST (Microsoft Transformation) files, 345
mstsc.exe command, 845–846, 874
MSU (Microsoft Update Standalone 
Package) file, 953
MTBF (mean time between failure), 1067
MTP (Media Transfer Protocol), 850
MTTR (mean time to recover), 1067
multi-configuration System Health Validator 
(SHV), 705
multi forest certificate enrollment, 236–237
multi-homed hosts, 605–606
Multi-valued Distinguished Name dialog 
box, 399
Multicast Address Dynamic Client 
Allocation Protocol (MADCAP), 579
Multicast Scope Name page, 579
Multicast Scope Properties dialog box, 580–
581, 580–581
Multicast Scopes tab, 621
multicasts
addresses, 532, 564
Media server streaming, 956–958
routing, 604–606, 621
scopes, 578–581, 580–581
Multilink And Bandwidth Allocation 
Protocol (BAP) pane, 696, 697
Multilink Connections option, 655
multilink extensions to PPP, 648
multimaster replication, 185
multipath I/O (MPIO), 824–826, 826
Multiple Activation Key (MAK), 1055
multiple DHCP servers, 583
multiple DNS names, domains for, 138
multiple domains, 136
domain operations masters, 158–159
drawbacks, 139
exam essentials, 173–174
forest operations masters, 158
Global Catalog servers, 169–170, 170
management tools, 157–158
reasons for, 136–138
review questions, 175–179
single-master operations, 158
single-master roles, 159–161, 160
summary, 172
trusts, 161–168, 161, 163–167
1130 
mil domain – multiple domains

Universal Group Membership Caching, 
171–172, 172
UPN suffixes, 168–169, 169
Multiple Host option, 1090
multiple monitor support, 854
multiple usernames and passwords, 26–27
multiprocessors in Hyper-V, 1009
multisite clusters, 1074, 1078
MX (mail exchanger) records, 66
N
N-Port Identification Virtualization (NPIV), 
829–830
name server (NS) records, 64, 72
name servers, 41–43, 72, 72, 75, 585
Name Servers page, 72, 72, 75
Name The Forest Root Domain screen, 
111, 111
Name The New Domain screen, 146, 146
Name The New Domain Tree Root screen, 
151, 151
Name The Server Licensor Certificate 
screen, 254
names
Active Directory objects, 15–16
demand-dial interfaces, 613
domains, 42, 108
hierarchical objects, 12
multicast scopes, 579
nslookup for, 83–84
objects, 297
OU objects, 268
resolving. See Domain Name System 
(DNS)
scopes, 557, 563–564, 564
snapshots, 1035
superscopes, 578
VMs, 1029
wireless networks, 675
namespaces in DFS, 748–749
NAP (Network Access Protection)
configuring, 704–705
DHCP servers, 569, 570
RAS, 688
remote access remediation, 854
NAPs (national access points), 604
NAS (network attached storage), 830
NAS Port Type page, 700
NAT (Network Address Translation), 
525, 607
national access points (NAPs), 604
navigation links in SharePoint Foundation 
2010, 990
NDDNS (Non-Dynamic DNS), 43–44, 45
NDES (Network Device Enrollment Service), 
22, 223
NDIS (Network Driver Interface 
Specification), 477
negative cache TTLs, 48
neighbor discovery, 528
Neighbors tab in RIP, 618–619, 618
.NET components, 898
application pools, 900–902, 901–902
trust levels, 899, 900
.NET Device Redirection, 851
net domain, 40
.NET Framework settings, 891
.NET Framework Version option, 900
% Net Utilization counter, 431
netmask ordering in DNS, 586–587
netsh command, 536
Network Access Permission control group, 
688
network access policies, 689–690
attributes, 690–693, 690–691
creating, 693–694
VPNs, 699–701
Network Access Policy, 699–701
Network Access Protection (NAP)
configuring, 704–705
DHCP servers, 569, 570
RAS, 688
remote access remediation, 854
Network Access Protection tab, 569, 570
network adapters
testing, 103, 105
VMs, 1029
Network Address page, 613
Network Address Translation (NAT), 525, 607
network attached storage (NAS), 830
Network Connections dialog box, 1019, 1019
Network Credentials page, 145, 145, 151
Multiple Host option – Network Credentials page 
1131

Network Device Enrollment Service (NDES), 
22, 223
Network Driver Interface Specification 
(NDIS), 477
Network File System (NFS), 826
Network Interface performance object, 431
Network Interfaces node, 609, 611
Network layer
NAP, 704
protocol stacks, 470–471, 471
Network Load Balancing (NLB), 1068, 1087
clusters
creating, 1089
managing, 1091–1092, 1091
properties, 1089–1091, 1090
configuring, 865–866
Hyper-V, 836, 1009
operation, 1087, 1088
RD Connection Broker, 863
requirements, 1088
Network Monitor Agent, 435, 789
Network Monitor tool, 435, 789–790
Network option in NLB clusters, 1091
Network Policy Intro screen, 857
Network Policy Server (NPS), 662
Network Policy Server page, 693, 698, 700
Network Segment performance object, 431
Network Settings tab, 1049
Network Time Protocol (NTP), 159
network traffic
Active Directory Integrated DNS, 53
DNS zones, 51
Networking tab
RAS and VPN clients, 671
Task Manager, 438, 438, 792, 793
networks and networking, 463–464, 765–766
Active Directory security, 8
backup and recovery, 486, 802–803
bandwidth, 181
classes, 499–502
configuration
GPOs, 334–335, 335
testing, 104–105, 105
connectivity verification, 102–105, 105, 
209
cost, 181–182
exam essentials, 486, 805–806
failover cluster requirements, 1071
IP addresses. See IP addresses
OSI model. See Open Systems 
Interconnection (OSI) reference 
model
peer-to-peer, 484–486, 485
performance monitoring. See 
performance monitoring
printers, 751
review questions, 487–491, 807–812
shadow copies, 803–805
subnetting. See subnets
summary, 486, 805
types, 180–181
update services, 767
Automatic Updates, 768–770, 769–770
Windows Update, 768
WSUS. See Windows Server Update 
Service (WSUS)
VPN problems, 661
WDS settings, 1049
New Class dialog box, 576
New Delegation Wizard, 75, 75
New Folder page, 750
New GPO dialog box, 323, 401
New Inbound Rule Wizard, 711, 741
New Mirrored Volume Wizard, 822, 822
New Multicast Scope Wizard, 579
New Network Policy Wizard, 690–691, 693, 
700
New Object - Group dialog box, 378–379, 
379
New Object - Organizational Unit dialog 
box, 272, 272
New Object - Shared Folder dialog box, 301, 
301, 729
New Object - Site dialog box, 190, 191
New Object - Site Link dialog box, 201
New Object - Site Link Bridge dialog box, 201
New Object - Subnet dialog box, 193, 193
New Outbound Rule Wizard, 711, 741
New Packages settings, 355
New Reservation dialog box, 573, 573
New Routing Protocol dialog box, 623
New Scope Wizard, 556
IPv4, 557–563, 557–562
IPv6, 563–566, 564–566
1132 
Network Device Enrollment Service (NDES) – New Scope Wizard

New Spanned Volume Wizard, 819
New Superscope Wizard, 577–578
New Trust Wizard, 165–167, 165–167
New Virtual Hard Disk Wizard, 
1021–1022
New Virtual Machine Wizard, 1026
New Virtual Network page, 1019
Next Generation TCP/IP Stack, 466
NFS (Network File System), 826
NLB. See Network Load Balancing (NLB)
No Auto-Restart For Scheduled Automatic 
Updates Installations option, 777
No Majority: Disk Only quorum model, 
1074, 1074
NoAutoUpdate Registry key, 775
node addresses, 498
Node and Disk Majority quorum model, 
1072, 1073
Node and File Share Majority quorum 
model, 1074
Node Majority quorum model, 1072–1073, 
1073
nodes in peer-to-peer networks, 484
Non-Dynamic DNS (NDDNS), 43–44, 45
non-Microsoft DNS servers, 89–90, 90
nonauthoritative restore, 450–451
nonmandatory upgrades, 352
normal backups, 445
Not Delegated setting, 931
notifications in SharePoint Foundation 2010, 
979–980
Notify dialog box, 57, 57
NPIV (N-Port Identification Virtualization), 
829–830
NPS (Network Policy Server), 662
NS (name server) records, 64, 72
nslookup tool, 82
command line, 83
interactive mode, 83–84
responses and error messages, 84–85
NT File System (NTFS)
features, 732–734, 732–735
overview, 99–100
partitions, 100–101
shared permissions, 734–737, 735–736
WDS, 1044
Ntds.dit file, 453
NTDS Settings Properties dialog box, 170, 
170, 206, 207
NTDS Site Settings Properties dialog box, 
171–172, 172, 199, 199
ntdsutil command
application data partitions, 122–126, 126
description, 306
offline maintenance, 452–453
NTFS. See NT File System (NTFS)
NTLMv2 authentication, 685
NTP (Network Time Protocol), 159
O
O (Organization) objects, 16
objects, Active Directory, 6, 282
Active Directory Administrative Center, 
303–305, 304
availability, 298–299, 728–729
creating, 284–286, 285
exam essentials, 307
filtering, 295–296, 296
groups, 18–19, 18, 293–295
hierarchical naming, 12
importing, 289
moving, renaming, and deleting, 297
organizational sections, 282–283
overview, 15–17
Performance Monitor, 781
properties, 290–293, 292
publishing printers, 299–300, 300
publishing shared folders, 300–301, 301
querying, 301–303, 302–303
review questions, 308–312
summary, 306–307
templates, 287–289
types, 283–284
UPNs, 286–287
Observation Window screen, 398
Obtain Client License Key Pack page, 871
ocsetup command, 1014
OCSP (Online Certificate Status Protocol), 
233
octets, 37, 497
ODI (Open Data-link Interface), 477
Offer process in DORA, 547
New Spanned Volume Wizard – Offer process in DORA 
1133

offline defragmentation, 453
offline domain joins, 242, 289–290
offline folders, 339, 729–731, 730
offline maintenance, 452–453
Offline Settings dialog box, 731
on-demand installations, 344
on-demand publishing, 955, 960
128-bit address space, 526
one-way trusts, 162
Online Certificate Status Protocol (OCSP), 
233
Online Responder component, 233
Online Responder Service, 22, 223
Only Redirect Requests To Content In This 
Directory (Not Subdirectories) option, 
897
Open Data-link Interface (ODI), 477
Open Shortest Path First Protocol (OSPF), 
603, 603
Open Systems Interconnection (OSI) 
reference model, 464–465
and device drivers, 477
protocol basics, 477–479, 479
protocol binding, 479
protocol stacks. See protocol stacks
and troubleshooting, 482–483
operating modes in wireless access, 674
Operating System Compatibility screen, 110, 
144
operating systems
Hyper-V support, 836, 1009–1010
partitioning in virtualization, 837
operations masters, 158–160, 160
Operations Masters dialog box, 160, 160
optimization. See performance monitoring
options, DHCP scopes, 550, 574–577, 
576
Options page
RAS and VPN clients, 668–669
WSUS, 773
ordering, netmask, 586–587
org domain, 40
Organization (O) objects, 16
organizational units (OUs), 12
auditing, 407
benefits, 266
creating, 271–274, 271–272, 274
delegating control, 269–270, 277–281, 
278, 280
description, 284
GPOs, 319
group policies, 270–271
inheritance, 268, 270
moving, deleting, and renaming, 
275–276, 275–276
overview, 17–18, 17, 264–265
properties, 276, 277
purpose, 265–266, 265
resource grouping, 266–268, 267
troubleshooting, 282
OSI model. See Open Systems 
Interconnection (OSI) reference model
OSPF (Open Shortest Path First Protocol), 
603, 603
Outbound Connections option, 912
outbound filters
LAN interfaces, 612
TCP/IP packets, 627
Outbound Filters option, 612
outbound rules
BranchCache, 741
Windows Firewall, 709–712
outbound security in SMTP, 911–912
Outbox tab, 949
outgoing email in SharePoint Foundation 
2010, 979–982, 982
Overview Of Windows Deployment Services 
page, 1045
P
package settings, 354–355
packet sniffers, 51
packets
components, 478–479, 479
filters
TCP/IP, 627–629, 628–629
VPN, 630–631
Packets Received Errors counter, 431
Page option in trace logging, 924
Pages/Sec counter, 431
Paging File performance object, 431
PAP (Password Authentication Protocol)
1134 
offline defragmentation – PAP (Password Authentication Protocol)

demand-dial interfaces, 614
description, 673
overview, 684–685
parent-child relationships, 20, 270
parent domains, 144
parent partitions
Hyper-V, 1011
virtualization, 836
parity, disk striping with, 820–821
partial attribute set (PAS), 169
partitions
application data, 120–121
creating, 121–123, 122
ntdsutil for, 124–126, 126
replicas, 123–124
basic disks, 817–818
Hyper-V, 1011
NTFS, 100–101
virtualization, 836–837
PAS (partial attribute set), 169
pass-through VHDs, 1021, 1023–1024
Password Authentication Protocol (PAP)
demand-dial interfaces, 614
description, 673
overview, 684–685
Password Complexity screen, 398
Password History Length screen, 398
Password option in SMTP, 914
Password page, 859
Password Reversible Encryption Status For 
Users Accounts screen, 398
Password Settings Precedence screen, 398
passwords
Active Directory, 113, 148
CA servers, 236
computers, 298
demand-dial interfaces, 614
Media server, 962
multiple, 26–27
objects, 285–286
policies
AD DS, 23, 238
fine-grained, 396–399, 397
replication, 239
RAS and VPN clients, 670
RD Gateway, 859
recovery, 739
SMTP, 909–910, 914
trusts, 167, 167
Windows Authentication, 703
PAT (Port Address Translation), 525
patches
description, 345
high availability, 1068
Pause state option, 1027
payloads, packet, 478
PDC Emulator Masters, 159
peer filters, 602
Peer Name Resolution Protocol (PNPR), 485
peer-to-peer networks, 484–486, 485
Pending Timeout option, 1085
People Near Me feature, 484
Per Device licensing mode, 867, 872–873
per-server logging, 926
per-site access logging, 926
per-user access, 699
Per User licensing mode, 867, 872–873
Perform Reverse DNS Lookup on Incoming 
Messages option, 913
performance, domain controllers for, 154
Performance Monitor, 420
Active Directory performance, 433–434
Appearance tab, 427, 427
Data tab, 426, 426
General tab, 424–425, 425
Graph tab, 426–427, 427
guidelines, 788–789
logs and alerts, 428–429, 787–788
objects, 420, 781
categories, 780–781
selection, 420–421, 421
properties, 784–787, 785–787
real-world monitoring, 429–430
Source tab, 425, 426
views, 422–424, 422–424, 781–784, 
782–784
performance monitoring, 777–779
domain controllers, 430–434
Event Viewer, 439–442, 440–441, 
794–797, 795–798
exam essentials, 455–456
MBSA, 799–801, 800
Network Monitor, 435, 789–790
overview, 417–419
parent-child relationships – performance monitoring 
1135

performance monitoring (continued)
Performance Monitor. See Performance 
Monitor
Reliability and Performance Monitor, 
779–780
review questions, 457–460
SNMP, 801–802
summary, 454–455
Task Manager, 435–439, 436–439, 
790–794, 791–794
tools, 419–420
troubleshooting, 442
Performance tab, 437–438, 438, 792, 793
Periodic Announcement Interval (Seconds) 
field, 619
Periodic Authentication Requests setting, 664
Periodic Status setting, 664
periodic update mode in RIP, 602
Permanent (301) option, 898
permissions, 375
description, 12
files, 731–737, 732–736
FTP, 904–905, 904
managing, 386–387, 386
OUs, 280, 280
SharePoint Foundation 2010, 991–992
websites, 937–940, 938–940
Permissions dialog box, 737
Permissions page, 280, 280
persistent routes, 625
Personalize Windows Update option, 768
Phone Number For This Device field, 660
Phone Number page, 613
Physical Disk performance object, 
431- 432
Physical layer, 467–468
physical requirements, 180
physical VHDs, 1021
Pick A Computer To Scan dialog box, 800
Pick Updates To Install option, 768
Picture Transfer Protocol (PTP), 850
ping command, 104, 536
ping6 command, 536
PKI (public-key infrastructure)
components, 223, 336
SSL, 932
PKI-savvy applications, 223, 336
Plain Old Telephone Service (POTS) 
connections, 646
planning Active Directory, 97–98
domain and forest functionality, 105–108
domain structure, 109
exam essentials, 129
filesystem verification, 99–102, 101
network connectivity verification, 
102–105, 105
review questions, 130–133
sites, 185–186
summary, 128–129
trees and forests, 140
planning mode in RSoP, 363
Plug and Play (PNP) device redirection, 
850–851
PNPR (Peer Name Resolution Protocol), 485
Point of Service (POS), 851
Point-to-Point Protocol (PPP)
connections, 647–648, 655–657, 
655–656
frames, 651
options, 654–655, 654
Point-to-Point Tunneling Protocol (PPTP)
demand-dial interfaces, 607, 613
packet filters, 630–631
tunneling, 652
pointer (PTR) records, 65–66
policies
audit, 404–408
DRM templates, 969–971
failover cluster resources, 1084–1085, 
1084
Group Policy. See Group Policy
network access, 689–694, 690–691
password
AD DS, 23, 238
fine-grained, 238, 396–399, 397
replication, 239
RD CAPs, 860–861
software restrictions, 318
VPN problems, 661
Windows Firewall, 713–714, 713
Policies tab, 1084–1085, 1084
pools
application, 900–902, 901–902
DHCP, 546
1136 
performance monitoring – pools

printer, 754
socket, 61
populating DNS database, 45–46, 46
Port Address Translation (PAT), 525
Port Status dialog box, 666, 666
ports
AD LDS, 248
HTTPS, 892
KMS, 1057–1058
monitoring, 666, 666
NLB, 1089–1091, 1090
printers, 754, 755
RADIUS, 702
RD RAPs, 862
TCP/IP, 496–497
VMs, 1029
VPNs, 659–660, 660
Windows Firewall filters, 707, 707
Ports screen, 248
Ports tab, 754, 755
POS (Point of Service), 851
Possible Owners option, 1086
POTS (Plain Old Telephone Service) 
connections, 646
PowerShell
Active Directory module for, 241
failover clusters, 1086
for GPOs, 339–340
PPP (Point-to-Point Protocol)
connections, 647–648, 655–657, 
655–656
frames, 651
options, 654–655, 654
PPP tab, 654–655, 654
PPTP (Point-to-Point Tunneling Protocol)
demand-dial interfaces, 607, 613
packet filters, 630–631
tunneling, 652
predefined global groups, 384–385
predefined scope options, 574
Preference Levels tab, 622, 622
prefixes for scopes, 564, 565
Presentation layer, 473, 474
presentation virtualization, 1008
primary DNS zones, 50–51
Primary Server field, 71
principals, security, 283, 375–376, 385, 385
Print And Document Introduction screen, 948
Print Operators group, 382
print servers, 751
printer objects, 284
Printer Sharing page, 752
printers and print services, 725, 750–751
advanced settings, 755–756, 756
clustering, 1080
color, 756
creating and publishing, 751–752
exam essentials, 758
general settings, 752, 753
migrating print servers, 757
pools, 754
ports, 754, 755
publishing, 299–300, 300
review questions, 759–764
security, 756, 757
sharing, 753, 754
summary, 757–758
printing faxes, 950
priority
KMS, 1057
printers, 755
RDC display data, 847
private keys, 932
Private Memory Usage (In KB) option, 902
private networks in failover clusters, 
1071–1072
Private Virtual Machine Network option, 
1019
Process Default Routes In Received 
Announcements option, 620
Process Host Routes In Received 
Announcements option, 620
Processes counter, 432
Processes tab, 436, 437, 790–791, 791
Processor performance object, 432
Processor Queue Length counter, 432
% Processor Time counter, 432
processors in VMs, 1028
product keys in KMS, 1054
Profile tab, 288–289
profiles
remote access, 694–699, 695–698
templates, 288–289
user access, 687–689, 688
populating DNS database – profiles 
1137

programs, removing, 357–358, 357–358
promotion
domain controllers, 110–114, 110–114, 
139
trees, 143–144
Prompt For Name And Password, 
Certificate, Etc. option, 669
Prompt For Phone Number option, 669
Protect Container From Accidental Deletion 
option, 272, 297
protocol stacks
Application layer, 474, 475
communication between, 475, 476
Data-Link layer, 468–470, 469
groups, 480, 481
Network layer, 470–471, 471
OSI, 466–467, 467
Physical layer, 467–468
Presentation layer, 473, 474
Session layer, 472–473, 473
Transport layer, 472, 472
protocols
binding, 479
connections, 479–480
OSI model, 477–479, 479
routing, 622–624, 624
TCP/IP. See Transmission Control 
Protocol/Internet Protocol (TCP/IP)
unsupported, 481
Protocols And Security page, 613–615
providers in trace logging, 924–925, 924
Provision Storage Wizard, 738
proxy mode in IGMP, 606
PTP (Picture Transfer Protocol), 850
PTR (pointer) records, 65–66
public-key infrastructure (PKI)
components, 223, 336
SSL, 932
public keys in SSL, 932
public networks in failover clusters, 
1071–1072
publishers, certificate, 336
publishing
Active Directory objects, 728–729
applications, 347, 350–351
Media server streaming, 955
printers, 299–300, 300, 751–752
shared folders, 300–301, 301
Publishing Point Type screen, 957
PXE Server Initial Settings screen, 1047
Q
quads in IP addresses, 497
queries
DNS, 43, 46–49, 47, 586
objects, 301–303, 302–303
quick migration in VMs, 1036
quorums for failover clusters, 1072–1074, 
1073–1074, 1079, 1079
quotas
disk, 99, 745–746
files, 732
templates, 997–998
Quotas tab, 746
R
RADIUS (Remote Authentication Dial-In 
User Service)
RAS, 662
settings, 702
troubleshooting, 715
RADIUS Authentication dialog box, 702
RAID (Redundant Array of Independent 
Disks)
benefits, 789
RAID-5 volumes, 819–821, 823, 823
set creation, 821–823, 822–823
types, 820–821
RAS. See Remote Access Service (RAS)
RD CAPs (Remote Desktop Services 
connection authorization policies), 
860–861
RD Connection Broker (Remote Desktop 
Services Connection Broker), 862–866
RD Gateway. See Remote Desktop Services 
Gateway (RD Gateway)
RD Gateway Manager, 880–882
RD Gateway tab, 879
1138 
programs, removing – RD Gateway tab

RD Licensing. See Remote Desktop 
Licensing (RD Licensing)
RD Licensing Manager tool, 868–871
RD RAPs (Remote Desktop Services 
resource authorization policies), 
861–862
RD Session Host Server tab, 878
RDC. See Remote Desktop Connection 
(RDC)
RDNs (relative distinguished names), 16
RDP (Remote Desktop Protocol), 853–854, 
879
RDS. See Remote Desktop Services (RDS)
read-only domain controllers (RODCs)
AD DS, 23, 238–240, 239
creating, 112
local groups, 385
support for, 60
Read Only IIS setting, 931
read-only permissions for failover clusters, 
1086
read-only SYSVOL, 239–240
Read permissions in SharePoint Foundation 
2010, 991
Read/Write IIS setting, 931
Real Time Streaming Protocol (RTSP), 956
realm trusts, 162
Receipts tab, 948–949
Receive All Packets Except Those That Meet 
The Criteria Below option, 628
Reconnect action for VHDs, 1025
records, DNS, 62
alias, 65
creating, 76–78, 77–78
host, 64–65
MX, 66
NS, 64
nslookup for, 84
pointer, 65–66
service, 66–67
SOA, 62–63
weighting, 586
recovery
BitLocker password, 739
disaster, 154
Dsamain.exe, 453
Fast Recovery, 960–961
key, 235
networks, 802–803
SharePoint Foundation 2010, 989
virtualization, 835
recovery point objectives (RPOs), 1066–1067
recovery time objectives (RTOs), 1066–1067
recursive queries, 46–47
Recycle Bin, 241, 451
recycling application pools, 902, 902
Redial Attempts field, 669
Redial If Line Is Dropped option, 669
Redialing Options group, 669
Redirect All Requests To Exact Destination 
(Instead Of Relative To Destination) 
option, 897
Redirect Requests To This Destination 
option, 897
redirection
folders, 337–339
RDC devices, 850–851
websites, 896–898, 897
Redundant Array of Independent Disks 
(RAID)
benefits, 789
RAID-5 volumes, 819–821, 823, 823
set creation, 821–823, 822–823
types, 820–821
Refresh Interval field, 71
Registry
backing up, 446
RDC keys, 847
WSUS keys, 775–776
Regular Time Intervals (In Minutes) option, 
901
relational databases, 9
relationships
parent-child, 20, 270
trust, 13, 13
relative distinguished names (RDNs), 16
Relative ID (RID) Masters, 159
relay agents in DHCP, 552
relaying in SMTP, 910
release keys, 1017
reliability
availability. See high availability
RD Licensing – reliability 
1139

reliability (continued)
backups. See backups
domain controllers for, 154
exam essentials, 455–456
offline maintenance, 452–453
performance monitoring. See 
performance monitoring
restores, 449–451
review questions, 457–460
summary, 454–455
Reliability and Performance Monitor, 
419–421, 779–780. See also 
Performance Monitor
reliable protocols, 480
Remote Access Connections (Inbound Only) 
option, 660
remote access policy, 689
Remote Access Service (RAS), 643–644
authentication protocols, 672–673
clients, 667
general properties, 667–668, 668
options settings, 668–669
security properties, 670–671
dial-up networking, 644–648
event logs, 666
exam essentials, 676
logging control, 663–665, 665
monitoring activity, 663
network options, 334
port monitoring, 666, 666
PPP options, 654–657, 654–656
RADIUS for, 662
review questions, 677–682
security. See security
summary, 676
VPNs. See virtual private networks 
(VPNs)
wireless access, 673–675
Remote Access user class, 577
Remote Authentication Dial-In User Service 
(RADIUS)
RAS, 662
settings, 702
troubleshooting, 715
Remote Desktop Connection (RDC), 844, 
844
Desktop experience, 847–850
device redirection, 850–851
Display Data Prioritization, 847
display resolutions, 845, 845
Easy Print, 851
font smoothing, 846
monitor spanning, 846
RDP signing, 853
SSO, 852
Remote Desktop Licensing (RD Licensing), 
866
activating, 869–870
diagnosing, 874
installing, 867–871
modes, 872, 872
revoking, 873
tracking, 873
types, 866–867
Remote Desktop Protocol (RDP), 853–854, 
879
Remote Desktop Services (RDS), 843–844
administering, 874
exam essentials, 884
GPOs for, 874–877, 875
load balancing, 862–866
printing, 851
RD Gateway. See Remote Desktop 
Services Gateway (RD Gateway)
RD Licensing. See Remote Desktop 
Licensing (RD Licensing)
RDC. See Remote Desktop Connection 
(RDC)
RDP, 853–854, 879
RemoteApp, 855–857, 857, 877–880
RemoteFX, 854–855
review questions, 885–888
summary, 882–883
Remote Desktop Services connection 
authorization policies (RD CAPs), 
860–861
Remote Desktop Services Connection Broker 
(RD Connection Broker), 862–866
Remote Desktop Services Gateway (RD 
Gateway), 858
certificates, 858–860
clients, 862
RD CAPs, 860–861
RD RAPs, 861–862
1140 
reliability – Remote Desktop Services Gateway (RD Gateway)

roles, 858
settings, 878–879
Remote Desktop Services resource 
authorization policies (RD RAPs), 
861–862
Remote Installation Folder Location screen, 
1047
Remote Installation Services (RIS), 1042
Remote Procedure Call (RPC) protocol, 
197–198
Remote Server Administration Tools feature, 
964
remote storage, 100
RemoteApp
global deployment settings, 877–880
installing programs for, 856–857, 857
TS Web Access for, 855
RemoteFX, 854–855
RemoteFX Decoder feature, 855
RemoteFX Encoder feature, 855
RemoteFX for Remote Desktop Session Host 
feature, 855
Remove “Disconnect” Option From Shut 
Down Dialog policy, 876
removing
database files, 584
exclusion ranges, 572
last domain controllers, 156–157
replicas, 124
reservations, 573
scopes from superscopes, 578
software, 343, 357–358, 357–358
Rename option, 1035
renaming
domains, 108
objects, 297
OUs, 275–276, 275–276
snapshots, 1035
renewing SSL certificates, 935
Repadmin utility, 211, 306, 454
repairing corrupted applications, 344
Replace Mode for Loopback Policy, 334
replicas
application data partitions, 123–124
managing, 123
removing, 124
replication, 182–183
Active Directory, 7, 11
bridgehead servers, 204–205, 204–205
configuring, 197
connection objects, 202–203, 202
database zones, 56–58, 57–58
DFS, 187–188, 748
exam essentials, 212–213
Global Catalog enhancements, 107
intersite, 197–199, 199
intrasite, 197–198
monitoring, 209–211, 453–454
moving server objects between sites, 
203–204, 203
multiple domains for, 137
review questions, 214–217
RODCs, 238
sites, 184–185
summary, 211–212
troubleshooting, 209–211
Replication indicator, 70
Replicator group, 382
ReplState switch in Dfsrdiag.exe, 188
Report view in Performance Monitor, 
423–424, 424, 784, 784
reports, error, 984, 1077–1078, 1078
Request Certificate dialog box, 933–935, 
934
Request Notifications option, 925
requests
DORA process, 547
sites, 184
SSL certificates, 933–935, 933–935
Require BAP For Dynamic Multilink 
Requests option, 697
Require Encryption (Disconnect If None) 
option, 670
Required Components Warning page, 772
Requirements tab, 861
Reschedule Automatic Updates Scheduled 
Installations option, 777
reservations
DHCP IP addresses, 551–552
scopes, 572–573, 573
reserved addresses, 499
Reset Check Boxes option, 1017
Reset state option, 1028
Reset To Inherited setting, 931
Remote Desktop Services resource – Reset To Inherited setting 
1141

resetting
computer accounts, 298
Hyper-V check boxes, 1017
IIS delegation state, 931
VMs, 1028
resolutions of RDC display, 845, 845
resolvers, 42–43, 586
resolving names. See Domain Name System 
(DNS)
resource records (RRs), 62, 76–78, 77–78
Resource view in Performance Monitor, 
424
resources
failover clusters, 1083–1086, 1084–1085
grouping, 266–268, 267
software requirements, 341
Respond Only To Known Client Computers 
option, 1047
Respond To All (Known And Unknown) 
Client Computers option, 1047
responses in nslookup, 84–85
Responsible Person field, 71
Restartable Active Directory Services, 23, 
238, 451–452
Restore Only Configuration Settings section, 
989
Restore Options section, 989
Restore-SPFarm command, 989
restoring. See also recovery
Active Directory, 449–451
System State data, 446–447
VMs, 1032–1036
Restrict Terminal Service Users To A Remote 
Session policy, 876
Restricted Groups, 318
Restricted Read permissions, 992
restriction policies, software, 349
Resultant Set of Policy (RSoP), 359–360
gpresult.exe, 364–365
logging mode, 360–363, 360–363
planning mode, 363
Resume action in NLB clusters, 1092
Resume state option in VMs, 1028
Retry Interval field, 71
reverse DNS lookup, 913
Review And Install Updates option, 768
revoking
CALs, 873
certificates, 232–234, 234
RID (Relative ID) Masters, 159
rights in IIS, 929–931, 930–931
Rights Management Add-on (RMA), 251
Rights Management Services. See Active 
Directory Rights Management Services 
(AD RMS)
RIP. See Routing Information Protocol 
(RIP)
RIP Properties dialog box, 623–624, 624
RIS (Remote Installation Services), 1042
RMA (Rights Management Add-on), 251
Robocopy deployment, 903
robust installation routines, 343
RODC Administrative Role Separation 
feature, 240
RODCs (read-only domain controllers)
AD DS, 23, 238–240, 239
creating, 112
local groups, 385
support for, 60
roles
failover clusters, 1080–1081
RD Gateway, 858
RD Licensing, 868
server. See server roles
single-master, 159–161, 160
root domains, 14, 143
Root Hints tab, 69, 69
root zone troubleshooting, 89
round robin
load balancing, 68
MPIO configuration, 825
route command, 536
route add command, 625
route filters, 602
route loops, 602
route print command, 536, 633
Router (Default Gateway) page, 560, 560, 
563
Router IP Packets On This Interface Or 
Route IPX Packets On This Interface 
option, 613
router mode in IGMP, 606
routers
configuration, 210, 560, 560
1142 
resetting – routers

discovery process, 600
OSPF, 603
routing
border, 604, 604
dynamic, 600–603, 601, 603
fax services, 950–951
features, 606–607
IP. See IP routing
multicast, 604–606
operation, 597–599, 598
overview, 606
purpose, 596–597
routing tables, 599
static, 599–600
Routing and Remote Access Server Setup 
Wizard, 608
Routing and Remote Access Services 
(RRAS), 595–596, 644
activity monitoring, 663
exam essentials, 635–636
installing, 608–609
IP routing, 631–635
logging control, 663–665, 665
port monitoring, 666, 666
review questions, 637–641
routing. See routing
summary, 635
TCP/IP packet filters, 627–629, 628–629
as VPN, 659
VPN packet filters, 630–631
Routing Information Protocol (RIP), 600–602
installing, 623
interfaces
advanced properties, 619–620, 619
creating, 615
general properties, 616–617, 616
neighbor properties, 618–619, 618
security properties, 617–618, 617–618
routing tables, 503, 599
RPC (Remote Procedure Call) protocol, 
197–198
RPC over IP, 198
RPOs (recovery point objectives), 
1066–1067
RRAS. See Routing and Remote Access 
Services (RRAS)
RRs (resource records), 62, 76–78, 77–78
RSoP (Resultant Set of Policy), 359–360
gpresult.exe, 364–365
logging mode, 360–363, 360–363
planning mode, 363
RTOs (recovery time objectives), 1066–1067
RTSP (Real Time Streaming Protocol), 956
rules
BranchCache, 741
business, 967–968
dialing, 949–950
Windows Firewall, 709–713, 710, 712
Run This Resource In A Separate Resource 
Monitor option, 1086
S
SACLs (system access control lists), 408
Safe E-Mail Servers section, 978
SANs (Storage Area Networks), 738, 830
SMfS, 832–833
Storage Explorer, 833, 834
VDS, 830–831, 831
SAPs (service access points), 470
Save Announcement page, 957
Save state option for VMs, 1027
saving Performance Monitor data, 787–788
scalability
Active Directory, 8
Hyper-V, 836
multiple domains for, 136–137
peer-to-peer networks, 486
Scan Documents On Download option, 986
Scan Documents On Upload option, 986
scavenging, DNS, 78
Schedule ForCorporateDialup dialog box, 201
ScheduledInstallDay Registry key, 775
schedules
backups, 446
IIS access, 926
replication, 200
shadow copies, 804
SMTP, 914
schema
Active Directory, 6, 9–10
classes and attributes, 108
for forests, 143
routing – schema 
1143

Schema Admins group, 384
schema masters, 158
Scope Lease page, 566, 566
Scope Name page, 557, 563, 564
Scope Options dialog box, 575, 576
Scope Prefix page, 564, 565
scopes, 550–552, 556
activating and deactivating, 577
exclusions, 571–572, 572
group, 294, 377–380, 379–380
IPv4
activating, 562, 562
creating, 556–563, 557
DDNS integration with DHCP, 
581–583, 582
DHCP database files, 583–585
DHCP servers, 583
DHCP settings, 559, 559
DNS settings, 560, 560
exclusions, 558, 558
IP addresses, 557, 557
lease duration, 558, 559
multicast, 578–581, 580–581
names, 557
options, 574–577, 576
router configuration, 560, 560
WINS settings, 561, 561
IPv6
activating, 566, 566
creating, 563
exclusions, 565, 565
lease duration, 566, 566
names, 563–564, 564
prefixes, 564, 565
multicast, 532
properties, 567, 567
reservations, 572–573, 573
server properties, 568–571, 568–571
superscopes, 577–578
scripts
GPO policies, 332–334, 333
Hyper-V, 1010
SCSI controllers, 1028
search functionality in Active Directory, 
8, 11
search order
DNS, 586
installation files, 358
secedit.exe utility, 403–404
Second Retry Interval option, 911
secondary DNS zones, 51–52
Secure Sockets Layer (SSL) security, 932
certificates
exporting and importing, 936–937, 
937
requesting and renewing, 933–935, 
933–935
on websites, 935–936, 936
Secure Sockets Tunneling Protocol (SSTS), 653
security
Active Directory, 8, 373–374
ACLs and ACEs, 387–388, 387
Active Directory Integrated DNS, 
53–54
AD DS, 238–240, 239, 241
audit policies, 404–408, 409
exam essentials, 410
groups. See groups
overview, 18–19, 18, 375
password policies, 396–399, 397
permissions. See permissions
review questions, 411–414
secedit.exe utility, 403–404
Security Configuration and Analysis 
utility, 402
security principals, 283, 375–376, 385, 
385
smart card authentication, 399–401, 
401
summary, 409
tools overview, 401–402
users, 389–393
DFS for, 747
DNS zones, 51
IPv6, 527
Media server, 961–963
NTFS, 100, 733–737, 734
peer-to-peer networks, 486
printers, 756, 757
Remote Access Services, 683–684
access control, 687
authentication, 684–686
1144 
Schema Admins group – security

connections, 686
exam essentials, 716–717
firewalls. See Windows Firewall
network access policies. See network 
access policies
Network Access Protection, 704–705
remote access profiles, 694–699, 
695–698
review questions, 718–724
servers, 701–704, 701, 703–704
summary, 716
troubleshooting, 714–715, 715
use profiles, 687–689
wireless, 673–675
Server Core, 1053
SMTP, 911–912
SSL. See Secure Sockets Layer (SSL) 
security
trace logging, 924
WebDAV, 906
Security Configuration and Analysis 
utility, 402
security groups
description, 19, 204, 375, 377
SharePoint Foundation 2010, 990
security identifiers (SIDs)
deleted accounts, 293
deleted objects, 297, 451
description, 16
for external trusts, 162
functions, 17
for security principals, 375–376
Security log, 116
Security option in trace logging, 924
security permissions, 12
Security Policy Setting dialog box, 396
security principals, 283, 375–376, 385, 385
Security tab
DNS integration with Active Directory, 
127, 127
fax services, 949
IIS, 929
printers, 756, 757
RAS and VPN clients, 670–671
RIP, 617–618, 617–618, 624, 624
servers, 701–702, 701
Select A Device page, 613
Select A Password screen, 236
Select A Site screen, 147, 147, 152
Select Backup Location screen, 449
Select Backup To Restore page, 989
Select Certificate dialog box, 880
Select Component To Restore page, 989
Select Condition dialog box, 690, 691, 693
Select Condition page, 700
Select Configuration Database screen, 253
Select DHCPv6 Server Operation Mode 
page, 553
Select Disks page, 819, 822, 822
Select Fax Users screen, 948
Select Features page
backups, 448
RD Licensing, 869
Select GPO dialog box, 325
Select Items for Backup screen, 449
Select Namespace Type page, DFS, 748
Select Restore Options page, 989
Select Role Services page
AD CS, 227
AD FS, 244, 244
AD RMS, 252, 252, 254
authentication modules, 938, 938
DFS, 748
IIS, 892
Media server, 964
RD Licensing, 868
RemoteApp, 856–857
RRAS, 608
WDS, 1045
Select Scopes page, 578
Select Server Roles page
AD CS, 225, 225
AD FS, 243, 243
AD LDS, 246, 246
AD RMS, 252
Hyper-V, 1014
IIS, 892
RD Licensing, 868
RemoteApp, 856
RRAS, 608
WDS, 1045
Select Service Or Application page, 1080
Security Configuration and Analysis – Select Service Or Application 
1145

Select Storage page, 1080
Select Update Source page, 772
Select User page
permissions, 737
quotas, 746
Select User Groups Allowed Access To This 
Remote Desktop Services Server page, 
856
Select Website screen, 253
selective authentication
enabling, 167
vs. forest-wide authentication, 163
self enrollment in AD RMS, 250
self-healing NTFS, 100
self-signed certificates
RD Gateway, 858
SSL, 935
Send A Plain-Text Password If That Is The 
Only Way option, 614
Send Clean-Up Updates When Stopping 
option, 620
Serial Number field, 71
server certificates, 231
server components in image deployment, 
1043
server consolidation, virtualization for, 835
Server Core
AD LDS installation on, 249–250
deploying, 1052–1053
Hyper-V, 1014–1015
server licensor certificates (SLCs), 250
server lists in DNS, 586
Server Manager, 21–22, 21, 221, 222
BranchCache, 742
DFS, 748
DHCP, 552–553
DirectAccess, 744
disk conversions, 818
disk initialization, 817
failover clusters, 1074–1075
FEC, 960
Hyper-V, 1014–1015, 1015
IIS, 890–892, 896
iSNS, 828
Media server, 962
mount points, 824
MPIO, 825
RD Licensing, 868
RDC, 848
RemoteApp, 856
RRAS, 608
SMfS, 832
volume sets, 819
server objects, moving between sites, 
203–204, 203
Server Operators group, 382
Server option in SMTP, 914
Server Options folder, 554
Server performance object, 432
Server Properties dialog box, 583
server roles, 21–22, 21, 219–221
AD CS. See Active Directory Certificate 
Services (AD CS)
AD DS, 21–23, 237–242, 239, 241
AD FS, 24, 242–245, 243–244
AD LDS, 25, 245–250, 246–250
AD RMS, 25, 250–256, 252–256
exam essentials, 257–258
review questions, 259–262
Server Manager, 221, 222
summary, 257
Server Sessions counter, 432
Server Status mode in RRAS, 663
servers, 701
bridgehead, 186–187, 186, 204–205, 
204–205
caching-only, 68–69, 69
deployment, 1041–1042
exam essentials, 1060
review questions, 1061–1063
summary, 1059
WDS. See Windows Deployment 
Services (WDS)
WPA, 1055–1059
DNS, 42–43, 585
files. See files and file servers
Global Catalog, 169–170, 170, 206, 207
PPP, 647
print, 751
roles. See server roles
scope options, 574
security, 701–704, 701, 703–704
1146 
Select Storage page – servers

topology, 205–206, 207
virtualization, 834–838, 1008
WSUS
configuration, 773–774
installation, 772–773
requirements, 771–772
service access points (SAPs), 470
Service Account Selection screen, 248, 248
Service Group role, 251
Service Level Agreements (SLAs), 1066–
1067
service profiles, 701
service set identifiers (SSIDs), 675
service (SRV) records, 66–67
services logs in Event Viewer, 797
Services tab in Task Manager, 437, 437, 792, 
792
Session layer in protocol stacks, 472–473, 
473
set command in nslookup, 83
Set Domain Functional Level screen, 112, 
146, 146, 152
Set Forest Functional Level screen, 111, 111
Set Path For RD Roaming User Profile 
policy, 876
Set RD Gateway Authentication Method 
policy, 877
Set RD Gateway Server Address policy, 877
Set RD User Home Directory policy, 876
Set Rules For Remote Control Of Remote 
Desktop Services User Sessions policy, 
876
Set The Certificate Validity Period screen, 
227
Set Time Limit For Active But Idle Remote 
Desktop Services Sessions policy, 876
Set Time Limit For Disconnected Sessions 
policy, 876
Set Time Limit For Logoff Of RemoteApp 
Sessions policy, 876–877
Set Up Private Key screen, 227
Settings tab
log files, 664
remote access profiles, 696–698, 696–698
RSoP, 363, 363
Settings window for snapshots, 1035
Setup Options screen, 247, 247
shadow copies, 803–805
Shadow Copies dialog box, 804
Share and Storage Management console, 738
Share This Printer option, 753
Shared Configuration feature, 903
Shared Folder objects, 284
Shared Folder Wizard, 738
shared folders, publishing, 300–301, 301
shared permissions, 734–737, 735–736
SharePoint Foundation 2010, 975–976
alternate access mappings, 996–997, 996
antivirus settings, 985–987, 986
audience targeting, 990–991
authentication, 999–1001
backups, 987–989, 987
configuration overview, 976–977, 977
diagnostic logging settings, 984–985
exam essentials, 1002
in-place upgrades, 994–995
incoming email settings, 977–979
outgoing email settings, 979–982, 982
permissions, 991–992
quota templates, 997–998
recovery, 989
review questions, 1003–1005
site collections, 998
sites, 992–993
summary, 1001
upgrading from WSS 3.0, 993–995
user access, 998–999
workflow settings, 982–983, 983
SharePoint Groups, 990
shares in software deployment, 348
sharing
business rules, 967–968
folders, 728
printers, 753, 754
Sharing tab
NTFS, 737
printers, 753
RAS and VPN clients, 672
Shiva Password Authentication Protocol 
(SPAP), 673
shortcut trust, 163
Show IP Routing Table command, 632
service access points (SAPs) – Show IP Routing Table command 
1147

Show Neighbors command, 632
Show TCP/IP Information command, 632
Shut Down state option, 1027
SHV (System Health Validator), 705
SIDs. See security identifiers (SIDs)
signatures, digital, 880
Simple Mail Transfer Protocol (SMTP), 198
access properties, 909–910, 909–910
delivery options, 911–913
description, 907
domain settings, 914
general properties, 907–909, 908
LDAP routing, 913–914, 913
message size and transfer limits, 910–911
outbound security, 911–912
Simple Network Management Protocol 
(SNMP), 801–802
simple volumes, 819
Single Host option for clusters, 1090
single-master operations, 158
single-master roles, 159–161, 160
Single option for clusters, 1091
single sign-on (SSO)
AD FS, 24, 243
IDA, 29
RDS, 852
web, 853, 999–1001
Site Binding dialog box, 935
site collections, 998
sites
configuring, 195–197, 195–196
creating, 189–192, 190–192
description, 188
exam essentials, 212–213
GPOs, 319
links and bridges, 188, 189, 199–201, 
200
moving server objects between, 203–204, 
203
overview, 183–184, 184
planning, 185–186
replication, 184–185
requests, 184
review questions, 214–217
server topology, 205–206, 207
SharePoint Foundation 2010
alternate access mappings, 996–997, 
996
configuring, 992–993
quota templates, 997–998
upgrading, 993–995
summary, 211–212
6to4 addresses, 528, 535, 564
size
shadow copies, 804
SMTP messages, 910–911
SLAs (Service Level Agreements), 1066–1067
SLCs (server licensor certificates), 250
Slow Link Detection, 349–350
smart cards, 28, 399–401, 401
smart hosts in SMTP, 912–913
SMfS (Storage Manager for SANs utility), 
832–833
SMP (symmetric multiprocessor) support, 
835, 1009
SMTP. See Simple Mail Transfer Protocol 
(SMTP)
snapshots
Hyper-V, 1009
VMs, 1029, 1033–1035
Snapshots folder, 1033
sniffers, 470
SNMP (Simple Network Management 
Protocol), 801–802
SNMP Service Properties window, 802
SOA (start of authority) records, 62–63
socket pools, 61
software
Hyper-V requirements, 1013
removal, 343
restriction policies, 318, 349
Software Compression option, 655
software deployment, 340
AppLocker feature, 349
Group Policy Slow Link Detection, 349–350
installing, 342–345, 346
Microsoft Windows Installer settings, 
358–359
preparing for, 347–348
publishing and assigning applications, 
346–347, 350–351
removing programs, 357–358, 357–358
1148 
Show Neighbors command – software deployment

Software Installation Properties dialog 
box, 354
Advanced tab, 355, 355
Categories tab, 356, 357
File Extensions tab, 356
General tab, 354–355, 354
software management life cycle, 340–342
software restriction policies, 349
updates, 351–353
verifying installation, 352–353
Software Settings options, 316
Software Update Services (SUS), 341, 770
Source Domain Controller screen, 153, 153
Source tab in Performance Monitor, 425, 
426, 785, 785
spanned volumes, 819
spanning monitors, 846
SPAP (Shiva Password Authentication 
Protocol), 673
Specific Time(s) option, 901
Specify Access Permission page, 693–694, 
700
Specify Authentication Method For Remote 
Desktop Services page, 856
Specify CA Type screen, 227
Specify Certificate Authority Response page, 
935, 935
Specify Cluster Address screen, 253, 254
Specify Conditions page, 693, 700
Specify DNS Server Settings page, 553
Specify Federation Server screen, 244
Specify IPv6 DNS Server Settings page, 553
Specify Licensing Mode page, 856
Specify Location Type screen, 449
Specify Name And Location page, 1022, 1026
Specify Revocation Policy page, 971
Specify Role Services screen, 225–227, 226, 
228
Specify Service Account screen, 253
Specify Setup Type screen, 226, 226
Specify WINS Server Settings page, 553
split-horizon processing, 620
spooled printer jobs, 755
SRV (service) records, 66–67
SSIDs (service set identifiers), 675
SSL (Secure Sockets Layer) security, 932
certificates
exporting and importing, 936–937, 937
requesting and renewing, 933–935, 
933–935
on websites, 935–936, 936
SSL Certificate tab, 860
SSO (single sign-on)
AD FS, 24, 243
IDA, 29
RDS, 852
web, 853, 999–1001
SSTS (Secure Sockets Tunneling Protocol), 653
staged installs in RODC, 240
Stand-Alone Root CAs, 224
Start action for NLB clusters, 1092
Start Application Pool Immediately option, 
901
start of authority (SOA) records, 62–63, 
70–71, 71
Start Of Authority (SOA) tab, 70–71, 71
Start-SPServiceInstance command, 989
Start state option, 1027
Starter Group Policy Objects, 316
Startup Properties dialog box, 333, 333
Startup/Shutdown scripts, 332, 333
stateless autoconfiguration, 526–527
states in VMs, 1027–1028
Static File option, 925
Static IP Assignment dialog box, 112, 112
Static Route dialog box, 626
static routes, 625–627, 626
Static Routes For Remote Networks page, 615
static routing, 599–600
static routing tables, 599
Status Code option for redirection, 897
Status Code(s) option for trace logging, 923
Status indicator for zones, 70
Stop action for NLB clusters, 1092
storage, 815–816
basic and dynamic disks, 817–818
exam essentials, 838
Fibre Channel, 829–830
initializing disks, 816–817
iSCSI, 826–827
iSNS, 828–829
mount points, 824
Software Settings options – storage 
1149

storage (continued)
MPIO, 824–826, 826
NAS, 830
RAID, 820–823, 822–823
review questions, 839–841
SANs, 830–833, 831, 834
shadow copies, 804
summary, 838
virtualization, 834–838
volume sets, 819–820
Storage Area Networks (SANs), 738, 830
SMfS, 832–833
Storage Explorer, 833, 834
VDS, 830–831, 831
Storage Explorer, 833, 834
Storage Manager for SANs utility (SMfS), 
832–833
Store Password Using Reversible Encryption 
policy setting, 703, 703
Store The Zone In Active Directory option, 52
Streaming Media Services role, 953
streaming solutions in Media server, 953–954
Advanced Fast Start, 959–960
advanced options, 958–959
content, 954–958
Fast Cache, 959
Fast Recovery and Fast Reconnect, 
960–961
striped volumes, 819–821
strong authentication, 28
Strong Encryption (MPPE 56-Bit) 
option, 698
Strongest Encryption (MPPE 128-Bit) 
option, 698
Stsadm utility, 993–994
stub zones, 54, 54
transfers, 58
uses, 55
subdomains, 144–149, 145–149
subnets, 186, 502–503
applying, 509–510, 510–511
benefits, 502
calculating number of, 509
CIDR, 522–525, 522
Class A, 521, 524
Class B, 512–513, 519–520, 524
Class C, 511–512, 514–518, 523
creating, 192–195, 193–194
description, 188
implementing, 504–506, 504–506
IPv6, 536–537
ISPs, 520–521
masks, 506–509, 507–508
quantities, 524–525
requirements, 504
Subordinate CAs, 224
Subscription Properties dialog box, 797, 798
subscriptions in Event Viewer, 442, 797, 798
Subsequent Retry Interval option, 911
subtasks, 466
Successful Connection Authorization events, 
881
Successful Resource Authorization events, 
881
Successful User Connection To The Resource 
events, 881
Successful User Disconnection From The 
Resource events, 881
suffix search order in DNS, 586
Summary Of Selections page, 361, 361
Superscope Name page, 578
superscopes, 550, 577–578
SUS (Software Update Services), 341, 770
Suspend action in NLB clusters, 1092
symmetric multiprocessor (SMP), 835, 1009
synchronization
GPOs, 729–731, 730
verifying, 210
WSUS servers, 773–774
system access control lists (SACLs), 408
System folder, 295, 296
System Health Validator (SHV), 705
System Key Utility (Syskey.exe), 240
System log, 116
System Monitor, 209, 431–432
System Monitor Log Properties dialog 
box, 434
System performance object, 432
System Stability Index, 780
System State data
backups, 445–446
restores, 446–447
1150 
storage – System State data

SYSVOL
backing up, 446
read-only, 239–240
T
tables, routing, 599
Tag For Announced Routes field, 617
Target Device option for fax services, 950
Target tab for folder redirection, 338
Targets tab for iSCSI, 827
Task Manager, 435–436
Applications tab, 436, 436
Networking tab, 438, 438
Performance tab, 437–438, 438
Processes tab, 436, 437
Services tab, 437, 437
Users tab, 439, 439
working with, 790–794, 791–794
Tasks To Delegate page, 278–279, 
278, 393
TCP (Transmission Control Protocol), 
472, 482
TCP/IP. See Transmission Control Protocol/
Internet Protocol (TCP/IP)
TCP/IP model, 465–466, 494, 495
TCP/IPv6 Properties window, 530, 530
TCPDump program, 715
Telephone method in RD Licensing, 869
telephone numbers, 498
Template Administrators role, 251
Template Identification page, 970
templates
AD RMS, 255–256, 255–256
certificates, 230–232, 336
policy, 969–971
quota, 746, 997–998
security, 316, 402
users, 391–392
working with, 287–289
Temporal Key Integrity Protocol (TKIP), 675
Temporary (307) option, 898
Teredo mechanism, 528, 535
Terminal Server License Server Activation 
Wizard, 870
Terminal Services RemoteApp (TS 
RemoteApp), 855
test environments, 418, 778
testing
connectivity, 103
DNS, 80–81, 81
network configuration, 104–105, 105
virtualization, 835
WSUS updates, 774
themes in RDC, 849
Third Retry Interval option, 911
Thorough Resource Health Check Interval 
option, 1086
throttling events, 984
Time Before Route Is Removed (Seconds) 
field, 620
Time Before Routes Expire (Seconds) field, 
619–620
Time Between Redial Attempts menu, 669
Time Of Day Constraints dialog box, 691, 
693
Time-Out option in RADIUS, 702
Time Taken (In Seconds) option, 923
time to live (TTL) for DNS queries, 48–49
TKIP (Temporal Key Integrity Protocol), 675
TLS (Transport Level Security), 685, 
909–910, 912
TLS Encryption option, 912
top-level DNS domains, 40
topology
replication, 210–211
servers, 205–206, 207
TPM (Trusted Platform Module), 739
trace logging, 921–922
conditions, 923, 923
content options, 922–923, 922
providers, 924–925, 924
tracert command, 536
tracert6 command, 536
tracing events, 985
traffic
Active Directory Integrated DNS, 53
DNS zones, 51
replication, 137
subnets for, 502
Windows Firewall filters, 707, 707
SYSVOL – traffic 
1151

trailers of packets, 479
transfer limits in SMTP, 910–911
transfers, zone, 56–58, 57–58
transitive trusts, 162
Transitivity Of Trust page, 166, 166
Transmission Control Protocol (TCP), 
472, 482
Transmission Control Protocol/Internet 
Protocol (TCP/IP), 482–483, 493–494
exam essentials, 538
IP addresses. See IP addresses
KMS ports, 1057–1058
layers communication, 495–496, 495
packet filters, 627–629, 628–629
port numbers, 496–497
review questions, 539–543
subnets. See subnets
summary, 537
testing, 103
Transport layer, 472, 472, 494, 495
Transport Level Security (TLS), 685, 909–
910, 912
Transportation Server option, 1045–1046
trees, 12–14, 14, 135–136. See also forests
creating, 144
joining to forests, 149–153, 150–153
planning, 140
promotion process, 143–144
single, 140–141, 141
troubleshooting
DNS. See Domain Name System (DNS)
GPOs, 359–365, 360–363
IP routing, 633–635
issues, 417
and OSI model, 482–483
OUs, 282
overview, 767
performance monitoring, 442
replication, 209–211
security, 714–715, 715
VPNs, 660–662
Trust Name page, 165, 165
Trust Password page, 167, 167
Trust Selections Complete page, 167
Trust Type page, 165, 166
Trustbridge, 108
Trusted Platform Module (TPM), 739
Trusted Root Certificate Authorities, 
858–859, 862
trusts
AD FS policies, 245
forests, 108
managing, 161–168, 161, 163–167
.NET trust levels, 899, 900
relationships, 13, 13
Trusts tab, 164, 164
TS RemoteApp (Terminal Services 
RemoteApp), 855
TTL (time to live) for DNS queries, 
48–49
TTL For This Record field, 71
tunneling
IPv6, 534–536, 536
PPTP, 652
SSTP, 653
VPNs, 649, 649
Turn Off state option, 1027
two-factor authentication, 28
two-way trusts, 161–162, 161
Type A Printer Name page, 299, 751
Type indicator for zones, 70
Typical (Recommended Settings) 
option, 670
U
UDP (User Datagram Protocol), 472
UGMC (Universal Group Membership 
Caching)
authentication, 208–209
managing, 171–172, 172
uk domain, 40
Unauthenticated Access method, 673
Unicast Announcement Wizard, 957
unicasts
DHCP, 579
IPv6 addresses, 531–532, 564
Media server streaming, 955, 957
unidirectional replication, 238
Uninstall And Reinstall Applications For 
Compatibility page, 856
1152 
trailers of packets – Uninstall And Reinstall Applications

Uninstall the Applications When They Fall 
out of the Scope of Management option, 
355
unique local addresses, 532
Universal Group Membership Caching 
(UGMC)
authentication, 208–209
managing, 171–172, 172
universal groups, 294, 378–380
unmasked bits, 509
unreachable interfaces, 610
unreliable connection-oriented protocols, 480
unsupported protocols, 481
updates, 767
Automatic Updates, 768–770, 769–770
in RIP, 602
software, 351–353
Windows Update, 768
WSUS. See Windows Server Update 
Service (WSUS)
upgrades
software updates, 351–352
WSS 3.0 to SharePoint Foundation 2010, 
993–995
Upgrades tab, 351–352
UPNs (user principal names)
configuring, 286–287
suffixes, 168–169, 169
URL Authorization module, 939
us domain, 40
% Usage counter, 431
Use Broadcast Or Multicast Only option, 
619
Use Extensible Authentication Protocol 
(EAP) option, 671
Use IP Address Redirection policy, 877
Use Local Time For File Naming And 
Rollover option, 926
Use Mandatory Profiles On The RD Session 
Host Server policy, 876
Use Neighbors In Addition To Broadcast Or 
Multicast option, 619
Use Neighbors Instead Of Broadcast Or 
Multicast option, 619
Use RD Connection Broker Load Balancing 
policy, 877
Use Scripting To Complete The Connection 
With The Remote Router option, 614
Use These RD Gateway Server settings, 879
Use This Route To Initiate Demand-Dial 
Connections option, 626
user account objects, 18
user certificates, 228–231, 229–230, 
335–337, 337
user claim mapping, 245
User Datagram Protocol (UDP), 472
User Groups tab, 862
user interface in AD DS, 23, 238
User Name option, 914
User Network options, 334
User objects, 284
user principal names (UPNs)
configuring, 286–287
suffixes, 168–169, 169
User Selection page, 360, 361–362
usernames, multiple, 26–27
users
access control, 687
profiles, 687–689, 688, 694–695
SharePoint Foundation 2010, 998–999
accounts, 375, 383
authentication, 684–686
creating and managing, 389–391
delegating control of, 392–393
Group Policy settings, 315–316
Hyper-V credentials, 1017
quotas, 745
templates, 287–289, 391–392
Users container, 283
Users folder, 383–385, 385
Users group, 382, 383
Users Or Groups page, 278–279
Users tab in Task Manager, 439, 439, 792, 
794
UseWUServer Registry key, 775
V
Validate a Configuration Wizard, 1074–
1078, 1076–1077
Validate My Identity As Follows menu, 670
Uninstall the Applications – Validate My Identity As Follows menu 
1153

validation of failover cluster configuration, 
1074–1078, 1076–1077
VAMT (Volume Activation Management 
Toolkit), 1055
variable-length subnet masking (VLSM), 
521, 601
VDI (Virtual Desktop Infrastructure), 854
VDS (Virtual Disk Service), 738, 830–831, 
831
Verify Caller-ID option, 688
verifying
Active Directory installation, 114–120, 
115, 118
authentication scenarios, 210
client connectivity, 119
filesystem, 99–102, 101
network connectivity, 102–105, 105, 209
replication topology, 210–211
router and firewall configurations, 210
software installation, 352–353
synchronization, 210
VHDs. See virtual hard disks (VHDs)
View Current Activity option, 428, 787–788
View Installation History option, 768
View Log File Data option, 428, 787–788
View Only permissions, 992
views
Event Viewer, 797, 798
Performance Monitor, 422–424, 
422–424, 781–784, 782–784
Virtual Desktop Infrastructure (VDI), 854
Virtual Disk Service (VDS), 738, 830–831, 
831
virtual hard disks (VHDs), 1020
booting from, 837–838
creating, 1021–1024
description, 836
Hyper-V, 1017
managing, 1024–1025, 1024
types, 1020–1021
Virtual Hard Disks folder, 1033
virtual LANs (VLANs), 1019
Virtual Machine Connection dialog box, 
1030–1032, 1030–1031
Virtual Machine Remote Control (VMRC) 
client, 1030
virtual machines (VMs), 834–835
backups and restores, 1032–1036
configuring, 1028–1029
connections, 1030, 1030–1031
creating, 1025–1028, 1027
deleting, 1029, 1029
exporting and importing, 1032–1033
Hyper-V, 1017
Hyper-V Integration Components, 
1031–1032
live migration and CSVs, 1036
migration, 836
snapshots, 1033–1035
Virtual Machines folder, 1033
Virtual Memory Usage (In KB) option, 902
Virtual Network Manager, 1018, 1018
virtual private networks (VPNs), 649
clients, 667
general properties, 667–668, 668
options settings, 668–669
security properties, 670–671
demand-dial, 613, 615, 660
vs. DirectAccess, 743
encapsulation, 651–652, 652
functions, 649–650
installing, 657–659, 658
L2TP/IPSec tunneling, 653
NAP for, 699–701, 705
operation, 650–651, 658–659, 658
overview, 649
packet filters, 630–631
ports, 659–660, 660
PPTP tunneling, 652
RRAS as, 659
SSTP tunneling, 653
support, 650
troubleshooting, 660–662
virtualization, 834–835, 1007
benefits, 835
concepts, 836–837
directories, 895–896
exam essentials, 1037
Hyper-V. See Hyper-V utility
RemoteFX, 854
review questions, 1038–1040
SMTP servers, 907–914
1154 
validation of failover cluster configuration – virtualization

summary, 1036–1037
VHDs. See virtual hard disks (VHDs)
VLANs (virtual LANs), 1019
VLSM (variable-length subnet masking), 
521, 601
VMBus protocol, 836–837
VMRC (Virtual Machine Remote Control) 
client, 1030
VMs. See virtual machines (VMs)
Volume Activation Management Toolkit 
(VAMT), 1055
volume sets, 819–820
Volume Snapshot Service (VSS), 803
volumes
dynamic, 99–100
KMS licenses, 1054
quotas by, 745
VPN Type page, 615
VPNs. See virtual private networks (VPNs)
VSS (Volume Snapshot Service), 803
W
WANs (wide area networks), 103, 181
warnings
Event Viewer, 440, 441, 795, 796
trace logging, 923
Wbadmin utility, 447–448, 803
WDS. See Windows Deployment Services 
(WDS)
WDSCapture.exe program, 1050
WDSCapture.inf file, 1050
WDSUTIL utility, 1052
Web Agents, 245
Web-Based Administration, 964
Web-based Distributed Authoring and 
Versioning (WebDAV), 906
Web Browser method for RD Licensing, 869
web enrollment feature, 22, 223
Web Parts in SharePoint Foundation 2010, 990
Web Server (IIS) page, 892
Web Server IIS screen, 227
Web Service performance object, 432
web services, 889–890
applications, 890–891
IIS installation, 891–892
outgoing email settings, 981–982, 982
websites. See websites
exam essentials, 915, 941
FTP, 903–906, 904–906
IIS. See Internet Information Services (IIS)
review questions, 916–918, 942–944
SMTP. See Simple Mail Transfer Protocol 
(SMTP)
SSL. See Secure Sockets Layer (SSL) 
security
summary, 914–915, 941
Web Single Sign On (Web SSO), 999–1001
Web Site Selection page, 772
Web SSO (Web Single Sign On), 999–1001
WebDAV (Web-based Distributed Authoring 
and Versioning), 906
websites
authentication and permissions, 937–940, 
938–940
client certificate mapping, 940
creating, 892–894, 893–894
host headers, 894–895
IIS settings, 891
limits, 898, 898
.NET components, 898–902, 900–902
redirection, 896–898, 897
SSL on, 935–936, 936
virtual directories, 895–896
web farms, 903
weighted path configuration, 825
weighting DNS records, 586
well known ports, 496–497
WEP (Wired Equivalent Privacy), 674–675
WFAS (Windows Firewall with Advanced 
Security), 708–709, 709
Wi-Fi Protected Access (WPA), 675
Wi-Fi Protected Access 2 (WPA2), 675
wide area networks (WANs), 103, 181
wildcard characters in nslookup queries, 84
WIM files, 1050
Windows 7 clients, Desktop Composition 
on, 849
Windows Authentication
settings, 703–704, 703–704
SharePoint Foundation 2010, 1000
VLANs (virtual LANs) – Windows Authentication 
1155

Windows Authentication module for 
websites, 938
Windows Deployment Services (WDS), 1042
configuring, 1046–1049
images
capturing, 1050–1052
deploying, 1043–1044
types, 1049–1050
installing, 1044–1046
overview, 1042–1043
Server Core deployment, 1052–1053
Windows Deployment Services 
Configuration Wizard, 1047
Windows Firewall
advanced settings overview, 708–709, 709
Connection Security Rules, 712–713, 
712
GPO configuration, 713
import/export policies, 713, 713
inbound and outbound rules, 709–712, 
710
IPSec policies, 714
monitoring settings, 714
options, 706–708, 706–708
Windows Firewall Settings dialog box, 
706–708, 706–708
Windows Firewall with Advanced Security 
(WFAS), 708–709, 709
Windows Genuine Advantage, 1054
Windows Installer, 342
application installation issues, 342–343
benefits, 343–344
file types, 345, 346
packages, 342
Windows Internet Name Service (WINS), 
43, 561, 561
Windows Management Instrumentation 
(WMI) scripts, 326
Windows Media. See Media server
Windows network models, 484–486, 485
Windows PowerShell, 117
Active Directory module for, 241
farm backups, 988
for GPOs, 339–340
Windows Product Activation (WPA), 1054
KMS
configuring, 1057–1059
installing, 1055–1057
overview, 1054–1055
Windows Script Host (WSH), 332
Windows Security dialog box, 145
Windows Server Update Service (WSUS), 
341, 770
advantages, 771
clients
configuring, 774–777
requirements, 774
overview, 353
servers
configuring, 773–774
installing, 772–773
requirements, 771–772
Windows Server Update Services page, 773
Windows Settings options, 316
Windows SharePoint 2010 Foundation. See 
SharePoint Foundation 2010
Windows Update, 768
WinDump program, 715
WINS (Windows Internet Name Service), 
43, 561, 561
WINS Servers page, 561, 561, 563
WINS tab, 72
Wired Equivalent Privacy (WEP), 674–675
wireless access
configuring, 674–675
overview, 673–674
wireless network names, 675
WMI (Windows Management 
Instrumentation) scripts, 326
WMS IP Address Authorization plug-in, 
962–963
WMS Publishing Points ACL Authorization 
plug-in, 962
workflow settings in SharePoint Foundation 
2010, 982–983, 983
workgroups in peer-to-peer networks, 
484
World Wide Names (WWNs), 829
WPA (Wi-Fi Protected Access), 675
WPA (Windows Product Activation), 
1054
KMS
1156 
Windows Authentication module – WPA (Windows Product Activation)

configuring, 1057–1059
installing, 1055–1057
overview, 1054–1055
WPA2 (Wi-Fi Protected Access 2), 675
WSH (Windows Script Host), 332
WSUS. See Windows Server Update Service 
(WSUS)
WUStatusServer Registry key, 776
WWNs (World Wide Names), 829
X
XrML (Extensible rights Markup Language), 
251
Z
Zone Transfers tab, 57, 57, 72–73
Zone Type screen, 73
zones, 49–50
Active Directory Integrated DNS, 52–54, 
52
background zone loading, 54, 59
delegating, 74–75, 75
dynamic updates, 73–74
GlobalName, 55–56, 60
primary, 50–51
properties, 69–70
General tab, 70
Name Servers tab, 72, 72
Start Of Authority (SOA) tab, 70–71, 
71
WINS tab, 72
Zone Transfers Tab, 72–73
secondary, 51–52
SharePoint Foundation 2010, 1001
stub, 54–55, 54
transfers and replication, 56–58, 57–58
WPA2 (Wi-Fi Protected Access 2) – zones 
1157

READ THIS. You should carefully read these terms and 
conditions before opening the software packet(s) included 
with this book “Book”. This is a license agreement 
“Agreement” between you and Wiley Publishing, Inc. 
“WPI”. By opening the accompanying software packet(s), 
you acknowledge that you have read and accept the 
following terms and conditions. If you do not agree and 
do not want to be bound by such terms and conditions, 
promptly return the Book and the unopened software 
packet(s) to the place you obtained them for a full refund.
1. License Grant. WPI grants to you (either an individual 
or entity) a nonexclusive license to use one copy of the 
enclosed software program(s) (collectively, the “Software,” 
solely for your own personal or business purposes on 
a single computer (whether a standard computer or a 
workstation component of a multi-user network). The 
Software is in use on a computer when it is loaded into 
temporary memory (RAM) or installed into permanent 
memory (hard disk, CD-ROM, or other storage device). 
WPI reserves all rights not expressly granted herein.
2. Ownership. WPI is the owner of all right, title, and 
interest, including copyright, in and to the compilation of 
the Software recorded on the physical packet included with 
this Book “Software Media”. Copyright to the individual 
programs recorded on the Software Media is owned by 
the author or other authorized copyright owner of each 
program. Ownership of the Software and all proprietary 
rights relating thereto remain with WPI and its licensers.
3. Restrictions On Use and Transfer.
(a) You may only (i) make one copy of the Software for 
backup or archival purposes, or (ii) transfer the Software to 
a single hard disk, provided that you keep the original for 
backup or archival purposes. You may not (i) rent or lease 
the Software, (ii) copy or reproduce the Software through 
a LAN or other network system or through any computer 
subscriber system or bulletin-board system, or (iii) modify, 
adapt, or create derivative works based on the Software.
(b) You may not reverse engineer, decompile, or 
disassemble the Software. You may transfer the Software 
and user documentation on a permanent basis, provided 
that the transferee agrees to accept the terms and 
conditions of this Agreement and you retain no copies. If 
the Software is an update or has been updated, any transfer 
must include the most recent update and all prior versions.
4. Restrictions on Use of Individual Programs. You 
must follow the individual requirements and restrictions 
detailed for each individual program in the About the 
CD-ROM appendix of this Book or on the Software 
Media. These limitations are also contained in the 
individual license agreements recorded on the Software 
Media. These limitations may include a requirement that 
after using the program for a specified period of time, the 
user must pay a registration fee or discontinue use. By 
opening the Software packet(s), you will be agreeing to 
abide by the licenses and restrictions for these individual 
programs that are detailed in the About the CD-ROM 
appendix and/or on the Software Media. None of the 
material on this Software Media or listed in this Book 
may ever be redistributed, in original or modified form, 
for commercial purposes.
5. Limited Warranty.
(a) WPI warrants that the Software and Software Media 
are free from defects in materials and workmanship under 
normal use for a period of sixty (60) days from the date of 
purchase of this Book. If WPI receives notification within 
the warranty period of defects in materials or workmanship, 
WPI will replace the defective Software Media. 
(b) WPI AND THE AUTHOR(S) OF THE BOOK 
DISCLAIM ALL OTHER WARRANTIES, EXPRESS 
OR IMPLIED, INCLUDING WITHOUT LIMITATION 
IMPLIED WARRANTIES OF MERCHANTABILITY 
AND FITNESS FOR A PARTICULAR PURPOSE, 
WITH RESPECT TO THE SOFTWARE, THE 
PROGRAMS, THE SOURCE CODE CONTAINED 
THEREIN, AND/OR THE TECHNIQUES 
DESCRIBED IN THIS BOOK. WPI DOES NOT 
WARRANT THAT THE FUNCTIONS CONTAINED 
IN THE SOFTWARE WILL MEET YOUR 
REQUIREMENTS OR THAT THE OPERATION OF 
THE SOFTWARE WILL BE ERROR FREE. 
(c) This limited warranty gives you specific legal rights, 
and you may have other rights that vary from jurisdiction 
to jurisdiction.
6. Remedies.
(a) WPI’s entire liability and your exclusive remedy 
for defects in materials and workmanship shall be 
limited to replacement of the Software Media, which 
may be returned to WPI with a copy of your receipt 
at the following address: Software Media Fulfillment 
Department, Attn.: MCTS: Windows Server® 2008 
R2 Complete Study Guide, Wiley Publishing, Inc., 
10475 Crosspoint Blvd., Indianapolis, IN 46256, or 
call 1-800-762-2974. Please allow four to six weeks for 
delivery. This Limited Warranty is void if failure of the 
Software Media has resulted from accident, abuse, or 
misapplication. Any replacement Software Media will 
be warranted for the remainder of the original warranty 
period or thirty (30) days, whichever is longer.
(b) In no event shall WPI or the author be liable 
for any damages whatsoever (including without 
limitation damages for loss of business profits, business 
interruption, loss of business information, or any other 
pecuniary loss) arising from the use of or inability to use 
the Book or the Software, even if WPI has been advised 
of the possibility of such damages.
(c) Because some jurisdictions do not allow the exclusion 
or limitation of liability for consequential or incidental 
damages, the above limitation or exclusion may not apply 
to you.
7. U.S. Government Restricted Rights. Use, duplication, 
or disclosure of the Software for or on behalf of 
the United States of America, its agencies and/or 
instrumentalities “U.S. Government” is subject to 
restrictions as stated in paragraph (c)(1)(ii) of the Rights 
in Technical Data and Computer Software clause of 
DFARS 252.227-7013, or subparagraphs (c) (1) and (2) of 
the Commercial Computer Software - Restricted Rights 
clause at FAR 52.227-19, and in similar clauses in the 
NASA FAR supplement, as applicable.
8. General. This Agreement constitutes the entire 
understanding of the parties and revokes and supersedes 
all prior agreements, oral or written, between them and 
may not be modified or amended except in a writing 
signed by both parties hereto that specifically refers to 
this Agreement. This Agreement shall take precedence 
over any other documents that may be in conflict 
herewith. If any one or more provisions contained in 
this Agreement are held by any court or tribunal to be 
invalid, illegal, or otherwise unenforceable, each and 
every other provision shall remain in full force and effect.
Wiley Publishing, Inc. 
End-User License Agreement

T
he Absolute Best MCTS: Windows Server 
2008 R2 Book/CD Package on the Market!
Get ready for your Microsoft Certiﬁ ed 
Technology Specialist for Windows Server 
2008 R2 certiﬁ cations with the most 
comprehensive and challenging sample 
tests anywhere!
The Sybex Test Engine features:
All the review questions, as covered in each 
chapter of the book
Challenging questions representative of 
those you’ll find on the real exam
A total of six full-length bonus exams 
available only on the CD, two each for exams 
70-640, 70-642, and 70-643



An Assessment Test to narrow your focus 
to certain objective groups

Reinforce your understanding of key 
concepts with these hardcore flashcard-
style questions.
Now you can study for the MCTS: 
Windows Server 2008 R2 exams 
anytime, anywhere.


Use the Electronic Flashcards to jog 
your  memory and prep last-minute for 
the exam!
Use the Glossary for instant reference.

Get real. Get Sybex! 
For more information, go to www.sybex.com/go/realworldskills
Get real!
Get Real World Skills from Sybex and take your career to the next level. These books not 
only help you on the job, they also help you prepare for your next certiﬁcation exam.

 Glossary  

2 
Glossary
 6to4  An integration/migration method in IPv6 allowing native IPv6 client machines to 
communicate through IPv4 clouds. This method is used for nondual stack machines running 
IPv6 only. The edge or border devices (connecting IPv6 and IPv4 networks) need to be 
conﬁ gured to forward IPv6 trafﬁ c to IPv6 networks  “ tunneling ” the IPv6 addresses through 
the IPv4 space. The IPv6 preﬁ x for 6to4 functionality is 2002:: /16. 
 A 
 Active Directory   Microsoft ’ s implementation of the LDAP directory service networking 
database. Active Directory stores information about objects in a central database and makes 
it available to users. 
 Active Directory account integration   Feature of some ﬁ rewalls that allows the network 
administrator to check all potential remote users against Active Directory to verify that they 
have authorized domain accounts. 
 Active Directory Federation Services (AD FS)   A Windows Server 2008 R2 role that 
provides Web SSO technologies to authenticate a user to multiple web applications over the 
life of a single online session. 
 Active Directory Installation Wizard (DCPROMO)   A command - line tool used to 
promote a Windows Server 2008 R2, 2008, 2003, or 2000 Server computer to a domain 
controller. Using the Active Directory Installation Wizard, systems administrators can create 
trees and forests. See also promotion. 
 Active Directory Integrated DNS zone   Primary zone with Active Directory Integration. 
The zone database is stored in Active Directory. 
 Active Directory replication   A method by which Active Directory domain controllers 
synchronize information. See also  intersite replication and  intrasite replication . 
 Active Directory Rights Management Services (AD RMS)   A Windows Server 2008 R2 
role that provides the ability to protect and control use of digital content. 
 Active Directory – integrated DNS zone   Primary zone with Active Directory integration. 
The zone database is stored in Active Directory. 
 ad hoc mode   A form of wireless communication in which computers connect directly to 
each other without using an access point or bridge. 
 Add or Remove Programs   Pre - Vista and Windows Server 2003 Control Panel applet that 
allows software applications and components of the operating system to be installed and 
uninstalled. 
 additive security   Security in which the user ’ s permissions are those of the group with the 
greatest access. If a user is in two groups, one of which has Read permissions to an item and 
another of which has Full Control permissions, that user has Full Control. NTFS security 
is additive. 

Glossary 
3
 address pool   The range of IP addresses that the DHCP server can assign to clients. 
 adjacency   A term used to describe neighboring routers that are grouped (think 
neighborhood). Within an adjacency, routers synchronize any changes to the link - state 
map. When the network topology changes, whichever router notices it ﬁ rst ﬂ oods the 
internetwork with change notiﬁ cations. 
 Administrative Delegation   Functionality provided by IIS 7.5 that allows administrators 
to manage a web server or website remotely. 
 administrative template   Template that speciﬁ es additional options that can be set 
by an administrator using the Group Policy Editor tool. This template provides a list of 
user - friendly conﬁ guration options and speciﬁ es the system settings to which they apply. 
When an option is set, the appropriate change is made in the Registry. Windows Server 
2008 R2 comes with several administrative template ﬁ les. You can also create your own 
administrative templates. 
 Advanced Fast Start   A Windows Server 2008 R2 Media Services feature that reduces the 
time it takes between the time a media stream is accessed and the time that the media can be 
displayed in the viewer. 
 anonymous address   Used in Windows Server 2008 R2 to set IPv6 to use a random 
value in an EUI - 64 instead of using the device ’ s MAC address. The MAC address provides 
uniqueness, but some consider it less than secure and consider a random or anonymous 
address to be better. 
 anycast   IPv6 (also deﬁ ned for IPv4 but not generally used) packet type that deﬁ nes 
a unique address for an interface that can be applied to multiple devices as well. 
Communication occurs between only two devices, typically the closest devices on the 
network. Anycast is described as one - to - “ one of many. ” 
 AppCmd.exe   A command - line utility that is used to manage Internet Information Services 
(IIS) 7.5. 
 application assignment script   Script ﬁ le that speciﬁ es which applications are assigned 
to users of Active Directory. These ﬁ les are created by administrators when Group Policy is 
used to create software package assignments for users and computers. 
 application data partitions   Applications that rely on Active Directory have the ability to 
use an application ’ s data partitions to store application - speciﬁ c data. Applications, services, 
or administrators can create application data partitions as container objects. 
 application server  Windows Server machines that host applications that all users access. 
 area border router   Special OSPF router that connects adjacent areas. 
 ASP.NET   Microsoft ’ s server - based framework for running .NET code on web servers. 
 assigning   One of two processes by which applications are made available to computers 
and/or users. See also  publishing . 

4 
Glossary
 auditing   The act of recording speciﬁ c actions that are taken within a secure network 
operating system. Auditing is often used by administrators as a security measure to provide 
for accountability. Typical audited events include logon and logoff events, as well as 
accessing ﬁ les and objects. 
 authentication header   IPsec header used to authenticate data or a data stream included 
in the IPv6 protocol as an extension header. 
 authoritative restore   Speciﬁ es that the contents of a certain portion of Active Directory 
on a domain controller should override any changes on other domain controllers, regardless 
of their sequence numbers. An authoritative restore is used to restore the contents of Active 
Directory to a previous point in time. 
 authorization   In the context of DHCP, a registration process used with Active Directory 
to ensure that only DHCP servers that have been approved or authorized are allowed to 
allocate DHCP addresses. Authorization prevents nonauthorized DHCP servers from issuing 
TCP/IP numbers on your network. 
 Automatic Updates   Feature that extends the functionality of Windows Update by 
automating the update process. 
 autostatic update mode   RIP update mode in which the RIP router broadcasts the 
contents of its routing table only when a peer router asks for it. See also  periodic update 
mode . 
 B 
 backbone   A technology associated with interconnecting networks through a central 
network. 
 Background Intelligent Transfer Services (BITS)   Bandwidth - throttling technology, 
used by the Automatic Updates application, that downloads updates during times when 
bandwidth is idle. This means that downloading the updates doesn ’ t interfere with other 
Internet trafﬁ c. 
 background zone loading   An Active Directory feature that allows an Active Directory –
 integrated DNS zone to load in the background. This means that a DNS server can service 
client requests while the zone is still loading into memory. 
 basic disk   A simple partitioning type used to create partitions, extended partitions, and 
logical drives. 
 Best Practices Analyzer tool   A utility designed to discover and recommend changes to a 
SharePoint or Active Directory server. 
 bidirectional trust   See  two - way trust. 

Glossary 
5
 binding   The process of linking together software components. For example, binding links 
the protocol stack to the network device driver for the network interface adapter. 
 Border Gateway Protocol (BGP)   Routing protocol allowing a Windows Server 2008 R2 
router to announce its route to other routers. 
 border routing   The passing of packets from one autonomous internetwork to another. 
 bottleneck  Occurs when the ﬂ ow of packets transmitted across network media slows 
down. Packets then accumulate and get backed up on the network. 
 bridgehead server   Used in Windows Server 2008 R2 replication to coordinate the 
transfer of replicated information between Active Directory sites. 
 C 
 Callback Control Protocol (CBCP)   Allows RRAS servers or clients to negotiate a callback 
with another server. 
 certiﬁ cate revocation   The process of revoking a certiﬁ cate from a user or computer. See 
also  Certiﬁ cate Revocation List (CRL) . 
 Certiﬁ cate Revocation List (CRL)   This list shows all the certiﬁ cates that have been 
revoked. This list is published to a location that all certiﬁ cate authority servers can access. 
See also  CRL distribution point (CDP) . 
 chained installation   Technology that applies all updates requiring a computer restart 
before the computer is restarted, eliminating the need to restart the computer more than 
once. 
 Challenge Handshake Authentication Protocol (CHAP)   Remote access authentication 
protocol that uses encrypted challenge and response messages instead of sending passwords 
and usernames in plain text. It has cryptographic weaknesses and is not supported by all 
platforms. 
 circular logging   Logging in which old data is overwritten as new data is entered into the 
log. Conserves disk space by limiting the size of the log ﬁ le. 
 client   Host that connects to a server - based machine. 
 Computer object   An Active Directory object that is a security principal and that identiﬁ es 
a computer that is part of a domain. 
 Connection Manager   Suite of components provided by Microsoft to help administrators 
create and manage remote access connections. See also  service proﬁ le . 
 Connection object   An object that can be deﬁ ned as part of Active Directory ’ s replication 
topology using the Active Directory Sites and Services tool. Connection objects are automatically 

6 
Glossary
created to manage Active Directory replication, and administrators can use them to manually 
control details about how and when replication operations occur.  
 connector  A software add - on that allows different types of applications or servers to 
communicate with each other. A connector acts as a translator for computer systems or 
applications. Many connectors are included with Active Directory. 
 Contact object   Active Directory object that deﬁ nes the contact information for a single 
entity such as an individual or company. Usually used in organizational units (OUs) to 
specify the main administrative contact and other individuals within the organization. 
Contact objects are not security principals like user objects. They are primarily used for 
reference or automatic mailing lists. 
 copy backup   A backup type that backs up selected folders and ﬁ les but does not set the 
archive bit. 
 counter logs   Files that contain information collected by the Windows Performance tool. 
Counter logs can be used to track and analyze performance - related statistics over time. 
 CRL distribution point (CDP)   A shared location containing the certiﬁ cate revocation list. 
See also  Certiﬁ cate Revocation List (CRL) . 
 cross - forest trust   A Windows Server 2008 R2 feature that lets you implement trusts 
between all domains in one forest and all domains in another forest. 
 cyclic redundancy check (CRC)   A mathematical calculation that is computed on a data 
stream input (a packet at the source and destination). The output value is used to determine 
whether a packet has been damaged or altered in transmission. 
 D 
 daily backup   A backup type that backs up all of the ﬁ les that have been modiﬁ ed on the 
day that the daily backup is performed. The Archive attribute is not set on the ﬁ les that have 
been backed up. 
 DCPROMO   See  Active Directory Installation Wizard (DCPROMO). 
 default route  The route packets take when there is no explicit route. If a router 
encounters a packet bound for some remote network whose route cannot be resolved in the 
routing table, the packet takes the default route. 
 default subnet mask   Network IDs and host IDs within an IPv4 address are distinguished 
by using a subnet mask. The default subnet mask is assigned based on the class of the 
address in question, such as a Class A, B, or C address. These addresses are characterized 
by 8, 16, or 24 bits to specify the network portion of the address — one octet for a Class A 
network ( 255.0.0.0 ), two octets for a Class B network ( 255.255.0.0 ), and three octets for 
a Class C network ( 255.255.255.0 ). It ’ s not the subnet mask that determines the class of an 
address, it is the ﬁ rst octet numerical value. 

Glossary 
7
 delegation   The process by which a user who has higher - level security permissions grants 
certain permissions over Active Directory objects to users who are lower - level security 
authorities. Delegation is often used to distribute administrative responsibilities in a network 
environment. 
 Delegation of Control Wizard   A Windows Server 2003 and 2008 tool used for delegating 
permissions over Active Directory objects. See also  delegation. 
 demand - dial routing   Type of routing that allows the use of an impermanent connection, 
such as an analog modem or ISDN, to imitate a dedicated Internet connection. 
 demotion   The process of downgrading a Windows Server 2008 R2 domain controller to a 
member server. 
 DHCP discover message   Message broadcast by a DHCP client that ’ s looking for a 
nearby DHCP server. Contains the hardware MAC address, among other information. 
 DHCP relay agent   Service that allows DHCP requests to be processed on a multisegment 
network. The DHCP relay agent or proxy is used to forward requests through a router to 
a DHCP server. (Without a relay agent, non - BootP routers prevent all broadcasts, including 
DHCP broadcasts, from passing through.) 
 DHCP request message  Message a client sends to the DHCP server to request or renew 
the lease of its IP address. 
 DHCPACK   Acknowledgment message sent by the DHCP server to the client after the server 
marks the selected IP address as leased. 
 DHCPNACK  Negative acknowledgment sent by the DHCP server to the client. This 
generally occurs when the client is attempting to renew a lease for its old IP address after the 
address has been reassigned elsewhere. 
 differential backup   A backup type that copies only the ﬁ les that have been changed 
since the last normal (full) backup or incremental backup. A differential backup backs 
up only those ﬁ les that have changed since the last full backup, but it does not set 
the archive bit. The Windows Server 2008 R2 Backup utility does not support differential 
backups. 
 Digital Rights Management (DRM)   A system that can provide copyright protection of 
data that is distributed. 
 Directory Services Restore mode (DSRM)   A special boot mode for Windows Server 
2008 R2 domain controllers. The Directory Services Restore mode is used to boot a domain 
controller without starting Active Directory services. This enables systems administrators to 
log on locally to restore or to troubleshoot any problems with Active Directory. 
 discovery domain   Provides a way to separate and group nodes in an iSNS database into 
more easily managed groups; similar to how zoning works with Fibre Channel. 

8 
Glossary
 disk quota   A way in Windows Server 2008 R2 NTFS to limit the amount of hard drive 
space on which users can store data. You can set up quotas on a volume and on individual 
users.  
 Display Data Prioritization   A Terminal Services feature that helps network utilization, 
prioritizing keyboard, display, and mouse data over other trafﬁ c. 
 distinguished name   The fully qualiﬁ ed name of an object within a hierarchical system. 
Distinguished names are used for all Active Directory objects and in the Domain Name 
System (DNS). No two objects in these systems should have the same distinguished name.  
 Distributed File System (DFS)   Allows Windows Server 2008 R2 servers to offer a 
simpliﬁ ed way for users to access geographically dispersed ﬁ les. DFS Namespace allows you 
to set up a tree structure of virtual directories that allow users to connect to shared folders 
throughout the entire network. DFS Replication allows you to replicate the target folders to 
other DFS servers. 
 distribution group   Collection of Active Directory users used primarily for email 
distribution. Distribution groups do not have security identiﬁ ers (SIDs). 
 DNS aging   Windows Server 2008 R2 feature that, with DNS scavenging, cleans up and 
removes stale resource records. 
 DNS client   Any machine issuing queries to a DNS server. The client hostname may or may 
not be registered in a Domain Name System (DNS) database. 
 DNS forwarding   The ability of a DNS server to send a request to another DNS server. 
There are several types of forwarding, including external forwarding (forwarding to a server 
outside your organization) and conditional forwarding (forwarding based on rules set up by 
an administrator). 
 DNS name server  Any computer providing domain name resolution services. 
 DNS Notify   A mechanism that allows the process of initiating notiﬁ cations to secondary 
servers when zone changes occur (RFC 1996). 
 DNS scavenging   Windows Server 2008 R2 feature that, with DNS aging, cleans up and 
removes stale resource records. You can specify the scavenging interval. 
 DNS server list   Conﬁ gured on a DNS client, a set of DNS servers the client can contact to 
resolve names. 
 DNS sufﬁ x search order   Conﬁ gured on a DNS client, a list of sufﬁ x names associated 
with the client. 
 DNS zone   A portion of the DNS namespace over which a speciﬁ c DNS server has authority.  
 domain controller   A Windows Server 2008 R2 computer that includes a copy of the 
Active Directory data store. Domain controllers contain the security information required to 
perform services related to the Active Directory. 

Glossary 
9
 Domain Local group   An Active Directory security or distribution group that can contain 
Universal groups, Global groups, or accounts from anywhere within an Active Directory forest.  
 Domain Name System (DNS)   The TCP/IP network service that translates textual 
Internet network addresses into numerical Internet network addresses. 
 Domain Naming Master   The Active Directory domain controller responsible for adding 
and removing domains within the Active Directory environment. 
 domain trees   A set of Active Directory domains that share a common namespace and are 
connected by a transitive two - way trust. Resources can be shared between the domains in an 
Active Directory tree. 
 domain   In Microsoft networks, an arrangement of client and server computers referenced 
by a speciﬁ c name that shares a single security permissions database. On the Internet, a 
domain is a named collection of hosts and subdomains, registered with a unique name by 
the InterNIC. 
 dual stack   Device (end node or network device) that has both IPv4 and IPv6 installed 
and enabled. The implementation can be dual IP layer (as in Windows Server 2008 R2) or a 
complete TCP/IP stack (software) for both IPv4 and IPv6. 
 dual - boot   A computer system that can have multiple operating systems loaded. Only one 
operating system can run at any given time, but dual - booting allows you to choose at startup 
which operating system you would like to start. 
 dynamic   In computer terms, a system or application that builds its own records. 
 dynamic disk   An advanced partitioning type used to create simple volumes, spanned 
volumes, striped volumes, mirrored volumes, and RAID - 5 volumes. Dynamic disks allow for 
advanced features. 
 Dynamic DNS (DDNS) standard   A standard that allows clients or DHCP to register with 
DNS automatically. This means that DNS can build its zone database on the ﬂ y.  
 Dynamic Host Conﬁ guration Protocol (DHCP)   A protocol that automatically assigns 
TCP/IP addresses to DHCP clients. 
 dynamic routing   Type of routing in which a router can discover its surroundings by 
ﬁ nding and communicating with other nearby routers. 
 E 
 EAP type  Authentication scheme supported in Extensible Authentication Protocol (EAP). 
See also  Extensible Authentication Protocol (EAP). 
 EAP - RADIUS  A  “ fake ” EAP type that passes any incoming message to a RADIUS server 
for authentication. See also  EAP type, Extensible Authentication Protocol (EAP), and 
 Remote Authentication Dial - In User Service (RADIUS). 

10 
Glossary
 elevation - of - privileges attack    An attack against a domain controller in a trusted 
domain, accomplished through an external trust. The hacker uses the security identiﬁ er 
(SID) history attribute to associate SIDs with new user accounts, granting themselves 
unauthorized rights.  
 Encapsulating Security Payload   IPsec header (and speciﬁ cation) used to provide security 
by encrypting data or a stream of data. Included in IPv6 as an extension header. 
 encapsulation   A process in which a client sending data wraps the data or encapsulates 
it within an IP datagram before it is sent through the network. Each OSI layer adds its own 
header and sometimes trailer information onto the data. 
 encryption   A way of creating information so that it cannot be read if it is intercepted by 
an untrusted party. 
 Event Viewer   A Windows Server 2008 R2 utility that tracks information about the 
computer ’ s hardware and software, as well as security events. This information is stored in 
three log ﬁ les: the Application log, the Security log, and the System log. 
 exclusion   A range of IP addresses that DHCP does not automatically assign to clients. 
 Extended User Interface 64 - bit (EUI - 64) format   Extended unique identiﬁ er using 64 
bits. The EUI - 64 address uses the 48 - bit MAC address (6 bytes) and adds 2 bytes between 
the Organizationally Unique Identiﬁ er (the ﬁ rst 3 bytes of the MAC address) and the last 3 
bytes. The added 2 bytes are FF:FE. Also, the ﬁ rst byte of the MAC has its sixth bit ﬂ ipped, 
so the value is 02. 
 Extensible Authentication Protocol (EAP)   A protocol that allows third parties 
to write modules that implement new authentication methods and retroﬁ t them to ﬁ elded 
servers. 
 Extensible Authentication Protocol - Transport Level Security (EAP - TLS)   EAP - TLS is 
a certiﬁ cate - based authentication framework that ’ s usually used with smart cards. EAP - TLS 
can be used only on servers that are members of a domain and is found only in Windows 
Server 2003 and Server 2008 R2. See also  EAP type and  Extensible Authentication Protocol 
(EAP).  
 extension headers   A component of IPv6 that allows additional or new information to 
be included as part of the layer 3 data but as an extension or addition to the base frame. 
IPv4 had similar functionality, but it was part of the base header, making the header variable 
length and harder to work with for software/device evaluation. By using extension headers, 
IPv6 becomes more efﬁ cient and extensible. 
 external trust   A way to provide access to resources on a Windows NT 4 domain or forest 
that cannot use a forest trust. 
 extranet   A network that is accessible to computers outside of the company. 

Glossary 
11
 F 
 failover   The process of moving active clustered resources from one cluster node to another 
cluster node. 
 failover cluster   A cluster type that provides redundancy for applications and services. 
 fax routing  A method used to determine who should be the recipient for an incoming fax. 
 feature delegation   Functionality provided by IIS 7.5 that allows speciﬁ c options to be 
controlled by other administrators or by down - level conﬁ guration settings. 
 Fibre Channel   A standard for sending SCSI commands at multi - gigabit speeds over either 
twisted pair or ﬁ ber - optic cable. 
 File Allocation Table (FAT)   A ﬁ lesystem, created by Microsoft, that was used for 
MS - DOS and Microsoft Windows up to and including Windows Me and also by virtually 
all other existing personal computer operating systems, ﬂ oppy disks, and solid - state memory 
cards. The FAT ﬁ lesystem (sometimes known as FAT16) is a standard for mass - storage 
compatibility. Windows Server 2008 R2 does not support FAT because it has fewer 
fault - tolerance features than the NTFS ﬁ lesystem and can become corrupted through 
normal use over time. 
 ﬁ le extension   The three - letter sufﬁ x that follows the name of a standard ﬁ lesystem ﬁ le. 
Using Group Policy and software management functionality, systems administration can 
specify which applications are associated with which ﬁ le extensions. 
 ﬁ le server   Windows Server machine on your network that stores data ﬁ les for users to 
access. 
 ﬁ ltering   The process by which permissions on security groups are used to identify which 
Active Directory objects are affected by Group Policy settings. Using ﬁ ltering, systems 
administrators can maintain a ﬁ ne level of control over Group Policy settings. 
 ﬁ rewall   Software or hardware device that checks the information received from the 
Internet or another external network and determines from that information whether the 
packet should be accepted or declined. 
 folder redirection   A Group Policy setting that automatically redirects special folders (such 
as My Documents) to an alternate network location. Mobile users ﬁ nd folder redirection 
useful because their documents are always available in the same location. 
 foreign security principal   Active Directory object used to give permissions to other 
security principals that do not exist within an Active Directory domain. Generally, 
foreign security principals are automatically created by the services of the Active Directory.  
 forest   A collection of Windows 2008 R2 domains in a trust relationship that does not 
necessarily share a common namespace. All of the domains within a forest share a common 
schema and Global Catalog, and domains can share resources in a forest. 

12 
Glossary
 G 
 Generic Routing Encapsulation (GRE) header   A header that is combined with an 
encrypted payload to transmit information over IP. 
 Global Catalog (GC)   A portion of Active Directory that contains a subset of information 
about all of the objects within all domains of the Active Directory data store. The Global 
Catalog is used to improve performance of authentications and for sharing information 
between domains. 
 Global group   An Active Directory security group that contains accounts only from its 
own domain. 
 global unicast address   In the IPv6 address space, addresses assigned to devices that will 
be accessible to the global IPv6 Internet space. This is similar to the public IP addresses of 
IPv4, but there are a lot more of them. The current allocation of the global unicast address 
space is 2000:: /3 (this leaves only 125 bits for uniqueness). 
 gpresult.exe  A command - line interface for RSoP. See also  Resultant Set of Policy (RSoP) . 
 Group object   Logical collection of users that is used primarily for assigning security 
permissions to resources. 
 Group Policy   Settings that can affect the behavior of, and the functionality available to, 
users and computers.  Group policies allow systems administrators to customize end user 
settings and to place restrictions on the types of actions that users can perform. Group 
policies can be applied to one or more users or computers within the Active Directory 
environment. See also  Group Policy object (GPO) . 
 Group Policy object (GPO)   A collection of settings (group policies) that control the 
behavior of users and computers. GPOs act as containers for the settings made within Group 
Policy ﬁ les; this simpliﬁ es the management of settings. See also  Group Policy . 
 GUID Partition Table (GPT)   A method of creating a disk partition. A GPT disk can 
support volumes up to 18 exabytes and 128 partitions. As a result, GPT is recommended for 
disks larger than 2TB or disks used on Itanium - based computers.  
 H 
 hash algorithm   An algorithm that produces a hash value of some piece of data, such 
as a message or session key. If you use a well - designed hash algorithm, when input data 
changes are made, the resulting hash value can alter. Hash values are useful in detecting 
modiﬁ cations to data. A well - designed hash algorithm makes it almost impossible for two 
independent inputs to have the same hash value. 
 hexadecimal   Notation used to represent 8 bits (a byte) using two characters (each 
representing 4 bits or a nibble). The valid 4 byte values are 0 – 9 and A – F. Any of these two 

Glossary 
13
characters together represent a byte. ( C0 in hex, for example, is a C and a 0. A  C is 1100 in 
binary, a zero is 0000 in binary; the 8 bits are then 1100 0000, or 192, in decimal.) 
 hierarchical address   In IP addressing, one part (the leftmost) is designated as the network 
address, and the other part is designated as a node address. The highest - order bits are shared 
by devices on a network. This allows you to summarize routes in routing tables so routers 
have the fewest route entries upon which to make layer 3 decisions. 
 host bus adapter (HBA)   A network adapter that contains an iSCSI hardware initiator. 
 host headers  A method for publishing multiple websites on a single IP address using the 
URL passed from the browser. 
 host record  A record that is used to statically associate a host ’ s name to its IP addresses. 
Also called an A record for TCP/IP v4 and AAAA record for TCP/IP v6. 
 host route  Route to a single system; normally used when you want to direct trafﬁ c to 
remote networks through a particular machine. 
 Hyper - V   Windows Server 2008 R2 role - based utility that offers hypervisor - based 
virtualization, including all the features necessary to support machine virtualization. 
 Hyper - V integration components   Software installed on a guest machine that optimizes 
the operating system functions to work with Hyper - V.  
 hypervisor  A virtualization interface that allows multiple operating systems to run on 
a single physical machine. In Windows Server 2008 R2, the hypervisor is one of the main 
components of Hyper - V.  
 I 
 incremental backup   A backup type that backs up only the ﬁ les that have changed since 
the last normal or incremental backup. It sets the archive attribute on the ﬁ les that are 
backed up. 
 InetOrgPerson object   An Active Directory object that deﬁ nes attributes of users in 
Lightweight Directory Access Protocol (LDAP) and X.500 directories. 
 Infrastructure Master   The Windows Server 2008 R2 domain controller that is responsible 
for managing group memberships and transferring this information to other domain 
controllers within the Active Directory environment. 
 infrastructure mode   A form of wireless communication that uses one or more wireless 
access points (APs) and/or a bridging device. 
 inheritance  The process by which settings and properties deﬁ ned on a parent object 
implicitly apply to a child object. 

14 
Glossary
 initialization ﬁ le   A ﬁ le used to specify parameters that are used by an application or a 
utility. Setup programs often use initialization ﬁ les to determine application installation 
information. 
 internal routing   The process of moving packets around on your own internetwork. 
 Internet Connection Sharing (ICS)   Gives networked computers the ability to access a 
single connection to the Internet. This is helpful when clients are using wireless access.  
 Internet Protocol (IP)   The Network layer protocol upon which the Internet is based. IP 
provides a simple connectionless packet exchange. Other protocols such as TCP use IP to 
perform their connection - oriented (or guaranteed delivery) services. 
 Internet Protocol next generation (IPng)   Also known as IPv6. Early in the development 
of the new IP protocol, it was not known which concepts and ideas (and even version) of 
IP would be the replacement for IPv4. Many folks took to calling the next generation of IP 
 IPng . You will still see this term in documentation today. 
 Internet Protocol Security (IPsec)    IPsec is a set of protocols and functionality providing an 
authenticated and/or secure channel (tunnel) between end nodes and/or network devices. IPsec 
uses several protocols to protect against certain security concerns (providing authentication, 
data integrity, and encryption, for example). In IPv4 you had to add components to allow 
IPsec to function. In IPv6 headers carry the IPsec information as part of the protocol. These 
are called IPv6  extension headers . The authentication header (AH) and encapsulating security 
payload (ESP) header are the components of IPsec included within IPv6.  
 Internet Protocol version 6 (IPv6)   The next generation of IP, also called  IPng , is 
being implemented and standardized today. IPv6 is simply a replacement of the layer 3 
components of the TCP/IP protocol suite. The layer 4 components (TCP and UDP) are not 
modiﬁ ed. IPv6 uses a 128 - bit address space, much larger than IPv4 ’ s 32 - bit address space. 
 Internet SCSI (iSCSI)   A protocol that allows an initiator to send SCSI (Small Computer 
System Interface) commands to storage devices over TCP/IP. This is used in storage area 
networks (SANs) as an alternative to Fibre Channel. 
 Internet Storage Name Server (iSNS)   A protocol used for automated discovery, 
management, and conﬁ guration of both iSCSI and Fibre Channel devices. This service allows 
devices to register themselves on the server. 
 intersite replication   The transfer of information between domain controllers that reside 
in different Active Directory sites. 
 Intra - Site Automatic Tunnel Addressing Protocol (ISATAP)   An IPv4 to IPv6 integration/
migration utility that allows dual - stack nodes to discover ISATAP routers and communicate 
with other IPv6 networks on the other side of an IPv4 cloud. 
 intrasite replication   The transfer of information between domain controllers that reside 
within the same Active Directory site. 

Glossary 
15
 IP datagram   The structure that enables a client and server to transfer other types of data 
by wrapping the data within an IP packet. 
 IPv6 mobility   Built - in IPv6 functionality that allows a client node to move between IP 
networks without disrupting TCP connectivity. The client establishes a TCP connection 
with a home address. When changing networks, the client continues to communicate with 
the original endpoint from a care - of address that sends all trafﬁ c back through the home 
address. This functionality is extremely useful when considering wireless networks and even 
wireless VoIP in the near future. 
 iSCSI initiator   An iSCSI client that sends and receives the iSCSI commands over the 
network. An initiator can be either software based (using installed software on a computer) 
or hardware based and be installed in dedicated hardware similar to a network adapter. 
 iSCSI Qualiﬁ ed Name (iqn)   A method of identifying targets and initiators on an iSCSI 
SAN, similar to a fully qualiﬁ ed domain name. 
 iSCSI target  Storage resource located on the iSCSI SAN. 
 K 
 key recovery agent   A user or administrator who has the right to revoke certiﬁ cates from 
users or computers. 
 L 
 Layer 2 Tunneling Protocol (L2TP)   A generic tunneling protocol that allows 
encapsulation of one network protocol ’ s data within another protocol. It is used in 
conjunction with IPsec to enable virtual private network (VPN) access to Windows 2008 
R2 networks. It is more secure than PPTP VPNs and also has greater interoperability with 
devices and software from other vendors. 
 LDAP   See Lightweight Directory Access Protocol (LDAP). 
 Lightweight Directory Access Protocol (LDAP)   A protocol used for querying and 
modifying information stored within directory services. Active Directory can be queried 
and modiﬁ ed through the use of LDAP - compatible tools. 
 linear logging   Logging in which data is never deleted from the log ﬁ le. New information 
is added to the end of the log ﬁ le. The log ﬁ le continually grows, but all historical 
information is retained. 
 linked value replication   A Windows Server 2003 and 2008 feature that replicates only 
the part of the Active Directory that changed since the last replication cycle. 

16 
Glossary
 link - local address   Address used on a local link (a link in IPv6 terms is a network segment) 
that allows devices on the same link to communicate (for example, to share ﬁ les) without 
needing to be conﬁ gured. Link - local addresses use the preﬁ x FE80:: /10. Link - local addresses 
are not globally routable. 
 Link - Local Multicast Name Resolution (LLMNR)   Peer - to - peer name resolution protocol 
for use in small, temporary networks that don ’ t use DNS. 
 link - state map   Used with OSPF, a routing table that contains the current links or paths 
that are available for routers to use and determines what router should service a route 
request. 
 LMHOSTS ﬁ le   ASCII ﬂ at ﬁ le associated with WINS, similar to a  HOSTS ﬁ le. See also 
 Windows Internet Name Service (WINS) . 
 load balance   Any method for evenly distributing processing or service requests across 
devices in a network. 
 load balancing   A method of distributing network load among multiple network hosts. 
 local area network (LAN)   A network of well - connected computers that usually reside 
within a single geographic location (such as an ofﬁ ce building). An organization typically 
owns all of the hardware that makes up its LAN. 
 Logging mode   An RSoP mode that pulls policy information from a log based on actual 
logon activity. Logging mode displays the actual settings that apply to users and computers. 
See also  Planning mode and  Resultant Set of Policy (RSoP). 
 Logical Link Control (LLC) sublayer   A sublayer in the Data - Link layer of the Open 
Systems Interconnection (OSI) model. The LLC sublayer deﬁ nes ﬂ ow control; that is, it 
establishes and maintains the logical communication links between the communicating 
devices. 
 logical unit number (LUN)   An address that is assigned to a storage unit that is presented 
to a host. 
 M 
 machine certiﬁ cate   Digital certiﬁ cate issued to a machine instead of to a user. 
 masked  When you apply the subnet mask to an IP address to see the network value 
(subnet value), the IP addresses is said to be masked. 
 Master Boot Record (MBR)   A method of creating a disk partition. An MBR disk has 
a partition table that indicates where the partitions are located on the disk drive. With 
this particular partition style, only volumes up to 2 terabytes and four primary partitions 
or three primary partitions and one extended partition that can be divided into unlimited 
logical drives. 

Glossary 
17
 mean time between failures (MTBF)  A calculation of the average time until a 
component or system will fail. 
 Media Access Control (MAC) sublayer   A sublayer in the Data - Link layer of the Open 
Systems Interconnection (OSI) model. The MAC sublayer is used for physical addressing; 
that is, it provides hardware addressing that allows for multiple devices or network nodes to 
communicate within the network. 
 metric   Cost information used to calculate the most efﬁ cient route for packets to take. 
 Microsoft Baseline Security Analyzer (MBSA)   A utility you can download from the 
Microsoft website to ensure that you have the most current security updates. There is a GUI 
version and a command - line utility,  mbsacli.exe . 
 Microsoft CHAP (MS - CHAP)  A remote access authentication protocol and Microsoft ’ s 
extension to CHAP. It is designed to work with computers and networks that are using 
Windows 98, Windows Me, Windows NT 4 (all versions), Windows 2000 (all versions), 
Windows XP (all versions), Windows Vista, Windows Server 2003, and Windows Server 
2008 R2. There are two versions of this protocol, MS - CHAPv1 and MS - CHAPv2. Windows 
Server 2008 R2 does not support MS - CHAPv1. 
 Microsoft Point - to - Point Encryption (MPPE) algorithm   Method of encrypting packets 
for sending via PPTP tunneling. 
 mirrored volume    A fault - tolerant storage unit that duplicates data onto two physical disks.  
 modules   Discrete components that provide speciﬁ c functionality in Internet Information 
Services (IIS) 7.5. 
 mount point   A directory that allows a volume to be conﬁ gured for access from within a 
directory on another existing disk. 
 MS - CHAPv1  See Microsoft CHAP (MS - CHAP). 
 MS - CHAPv2  See Microsoft CHAP (MS - CHAP). 
 MSMQ Queue Alias object   Active Directory object for the MSMQ - Custom - Recipient 
class type. This object associates an Active Directory path and a user - deﬁ ned alias with a 
public, private, or direct single - element format name, allowing a queue alias to be used to 
reference a queue that might not be listed in Active Directory Domain Services (AD DS).  
 multicast   IPv4 and IPv6 packet type deﬁ ning a single address that can be received by 
multiple devices at the same time, but not by everyone. Multicast allows a server to send a 
stream of data to multiple clients. Client computers subscribe to a group and communicate 
by sending packets to the multicast address. In unicast communication, by contrast, the 
server needs to send the same packets to each computer individually. IPv6 uses multicast 
functionality to let a device query multiple network devices for their MAC addresses. This 
facilitates network communication (IPv4 broadcast ARP functionality). 

18 
Glossary
 multicast routing   A special type of routing where a packet is sent to multiple host 
computers based on a special Class D IP address. 
 multilink   Extensions to the Point - to - Point Protocol (PPP) that provide a way to take 
several independent PPP connections and make them look like one line and act as a single 
connection. 
 Multipath I/O (MPIO)   A method for using multiple physical paths to storage such as in a 
storage area network (SAN) and providing fault tolerance and increased performance. 
 N 
 name server   A server that can give an authoritative answer to name resolution queries 
about that domain. 
 name server (NS) record  This record lists the name servers for a domain and allows 
other name servers to look up names in your domain. 
 neighbor discovery   Protocol used in IPv6 that allows devices to discover other devices 
on the same link. Neighbor discovery uses multicast packets and can retrieve router 
information. Neighbor discovery is the IPv6 functionality that replaces the IPv4 ARP. 
Neighbor discovery also participates in the IPv6 stateless autoconﬁ guration feature. 
 network access policies   Like group policies, network access policies (which used to 
be called  remote access policies ) allow the administrator to control whether users can get 
access. Unlike group policies, network access policies are available only in native Windows 
2003 or 2008 domains. 
 network address   A value that uniquely identiﬁ es a network. Every machine on the 
network shares that network address as part of its IP address. In IPv4, the classful addresses 
are class A, class B, and class C. In classless addressing, this is the number of network bits 
deﬁ ned by the subnet mask. In IPv6, this is the hexadecimal value speciﬁ ed by the number 
of bits in the preﬁ x (or by the slash notation value). In the IPv4 address  130.57.30.56 , for 
example,  130.57 is the network address. 
 Network Address Translation (NAT)   Service that allows multiple LAN clients to share 
a single public IP address and Internet connection by translating and modifying packets to 
reﬂ ect the correct addressing information. Also called  network masquerading . 
 network attached storage (NAS)   A type of storage that uses network ﬁ le - sharing 
protocols like Common Internet File System (CIFS) or Network File System (NFS) to provide 
access to storage. 
 Network Driver Interface Speciﬁ cation (NDIS)   An application programming interface 
(API) that allows multiple protocols to be bound to the same network interface cards (NICs) 
or the same protocol to multiple cards. NDIS was developed by Microsoft and 3Com 
Corporation for Microsoft Networks. 

Glossary 
19
 Network Load Balancing (NLB)   A shared cluster type that provides redundancy and 
scalability for network - based services. 
 Network Monitor   A downloaded utility for Windows Server 2008 R2 that can be used to 
monitor and decode packets that are transferred to and from the local server. 
 Network Policy Server (NPS)   Microsoft ’ s implementation of a RADIUS server in 
Windows Server 2008 R2. It replaces Windows Server 2003 Internet Authentication 
Service (IAS). 
 network printer   Printer connected directly to the network by its own network interface 
card (NIC) or that is available on the network through the use of a print server. Network 
printers in Active Directory must be shared and published before use. 
 network route   IP network segments are interconnected by routers, which pass IP 
datagrams from one network segment to another. Network routes are the paths that are in 
the conﬁ gurations of the routers. 
 node address   A value that uniquely identiﬁ es a device in a network. In IPv4, the node has 
a single node address, but in IPv6, a node will typically have more than one IPv6 address —
 one for the physical interface and addresses for the virtual or pseudointerfaces as well.  
 node   A server that participates in a cluster and can host clustered resources. 
 Non - Dynamic DNS (NDDNS)   A DNS database that needs to be built manually. Clients 
cannot automatically update the DNS server. 
 Normal backup   A backup type that backs up all selected folders and ﬁ les and then marks 
each ﬁ le that has been backed up as archived. 
 nslookup   Command - line utility for testing a DNS server. 
 NTFS   Formatting option for a hard drive for a Microsoft operating system. NTFS has 
many advantages over the FAT and FAT32 formatting, including support for compression, 
disk quotas, encryption, and permissions on ﬁ les and folders. 
 O 
 objects  Units stored within Active Directory. 
 ofﬂ ine folder   Network folder containing data that can be changed by users outside the 
ofﬁ ce or on laptops. The data in ofﬂ ine folders needs to be synchronized with the network 
data. Synchronizing can occur when users log off, log on, or suspend their systems. 
 Open Data - link Interface (ODI)  Driver interfaces that allow multiple network interface 
cards (NICs) to be bound to multiple protocols. ODI was developed by Apple and Novell 
for NetWare and Macintosh environments. 

20 
Glossary
 Open Shortest Path First (OSPF)   A link - state routing protocol that transmits only the 
changes to the routing table involving neighbors. OSPF is not supported in Windows Server 
2008 R2. 
 Operations Master   A special domain controller that is solely responsible for speciﬁ c parts 
of the Active Directory, such as the schema, domain naming, or relative ID (RID). 
 organizational unit (OU)   Used to logically organize the Active Directory objects (such as 
similar accounts or machines) within a domain. An OU is the smallest component within a 
domain to which administrative permissions and group policies can be assigned. OUs serve 
as containers within which other Active Directory objects can be created, but they do not 
form part of the DNS namespace. 
 OSI model   A reference model for network component interoperability developed by 
the International Standards Organization (ISO) to promote cross - vendor compatibility of 
hardware and software network systems. The OSI model splits the process of networking 
into seven distinct services, or  layers . Each layer uses the services of the layer below it 
to provide its service to the layer above. The ISO began developing the OSI model in 
1977. It has since become the most widely accepted model for understanding network 
communication. 
 P 
 packet   A small chunk of data that is constructed, modiﬁ ed, and disassembled by network 
protocols at various levels of the OSI model during the process of transmitting data across 
the network. Each packet, also called an  envelope , consists of three parts: a header, data, and 
a trailer. 
 packet ﬁ ltering   Technology that applies rules to determine what type of trafﬁ c is allowed 
into and out of the router. 
 packet payload  The data within a network packet that is to be transmitted to the remote 
computer. 
 packet sniffer   A utility that allows an individual to watch or retrieve packets from a 
network cable. 
 partial attribute set (PAS)   A subset of an object ’ s attributes that is stored in the Global 
Catalog (GC) to reduce replication trafﬁ c. The PAS can be changed by modifying the schema 
and marking attributes for replication to the GC. 
 Password Authentication Protocol (PAP)   PAP is an authentication mechanism used by 
many Internet providers. PAP sends user credentials in plain text between the NAS and the 
authentication server and therefore is susceptible to a man - in - the - middle attack. 

Glossary 
21
 password replication policy   A policy that allows an administrator to determine which 
user groups will be allowed to use the read - only domain controller (RODC) credential 
caching. 
 patch  A Windows Installer ﬁ le that updates application code. Patches can be used to make 
sure that new features are installed after an application has already completed installation. 
A patch ﬁ le does not remove any installed components. 
 peer ﬁ lter   Technology used by routers that speciﬁ es the neighboring routers to which a 
local router will listen. 
 periodic update mode   RIP update mode in which routing table updates are automatically 
sent to all other RIP routers on the internetwork. See also  autostatic update mode . 
 permissions   Security constructs used to regulate access to resources by username or 
group afﬁ liation. Administrators can assign permissions to allow any level of access (such as 
read - only, read/write, or delete) by controlling the ability of users to initiate object services. 
Security is implemented by the system checking the user ’ s security identiﬁ er (SID) against 
each object ’ s access control list (ACL). 
 persistent route  Static route that remains in the routing table after the system reboots. 
 Planning mode   An RSoP mode that is used to plan Group Policy changes before putting 
them into effect. See also  Logging mode, Resultant Set of Policy (RSoP). 
 pointer (PTR) record   Used to associate an IP address to its host ’ s name. This record 
is necessary because IP addresses begin with the least - speciﬁ c portion ﬁ rst (the network) 
and end with the most - speciﬁ c portion (the host); whereas hostnames begin with the most 
speciﬁ c portion at the beginning and the least speciﬁ c at the end. 
 Point - to - Point Protocol (PPP)   A protocol for transmitting information over point - to -
 point links. Widely used as the protocol for dial - in Internet access using modems. 
 Point - to - Point Tunneling Protocol (PPTP)   A Microsoft - speciﬁ c VPN protocol that 
encapsulates IP, IPX, or NetBEUI information inside IP packets. 
 port rule  In a network load - balanced cluster, a port rule deﬁ nes how speciﬁ c TCP or UDP 
ports will be handled. 
 PPP frame  PPP header added to an IP datagram. 
 preﬁ x notation  IPv4 and IPv6 notation for showing the network portion of an IP 
address by specifying the number of network bits after a forward slash. For example, /16 
(pronounced  “ slash 16 ” ) indicates 16 network bits (out of 32 for IPv4 and out of 128 for 
IPv6). 
 primary zone   This zone is responsible for maintaining all of the records for the DNS zone. 
It contains the primary copy of the DNS database and all record updates occur here. You 
create a new primary zone whenever you create a new DNS domain. 

22 
Glossary
 print server   Server with a connected printer attached. The print server can handle all the 
printing options for the connected printer. 
 Printer object  Active Directory object that identiﬁ es printers that are published within 
domains. 
 printer pool   Allows two or more identical printers to balance the print load among 
multiple printers. When a document is sent to the printer pool, the ﬁ rst available printer 
receives the print job and prints it. 
 promotion   The act of converting a Windows Server 2008 R2, 2003, or 2000 
Server computer to a domain controller. See also  Active Directory Installation Wizard 
(DCPROMO). 
 protocol stack  A group of protocols, arranged in layers, that implements an entire 
communication process. TCP/IP is an example of a protocol stack. TCP is one protocol and 
IP is another. They are stacked together to allow communications. 
 pseudo - interface  Virtual or logical interface of an IPv6 device. A Teredo interface or an 
ISATAP interface is an example of a pseudo - interface. The pseudo - interfaces of a network 
device will have their own IPv6 addresses. 
 public - key infrastructure (PKI)   A structure that binds public keys with respective user 
identities through the use of a certiﬁ cate authority. 
 publishing   One of two processes by which applications are made available to computers 
and/or users. Publishing makes applications available for use by users through Group Policy 
and Software Installation settings. End users can install published applications on demand or 
when they need them by using the Add Or Remove Programs item in Control Panel. See also 
 assigning . 
 Q 
 quota template   A predeﬁ ned set of quotas to apply to a Windows SharePoint Services 
website. 
 R 
 RAID - 5 volume   A fault - tolerant storage unit that stripes data and parity for the data 
across three or more disks. 
 RD Easy Print  A Remote Desktop Services feature that allows proxying of print jobs from 
the Remote Desktop Services to local client drivers, removing the need to install drivers 
on the Remote Desktop Services. 

Glossary 
23
 RD Gateway   A Windows Server 2008 R2 role service that encapsulates Remote Desktop 
Protocol (RDP) trafﬁ c over HTTPS. 
 RD license server   A Windows Server 2008 R2 role service that manages the Remote 
Desktop Services client access licenses. 
 RD RemoteApp  A mode of Remote Desktop Services in Windows Server 2008 R2 where 
a session can connect to a speciﬁ c application, making the remote applications appear to run 
locally to the client. 
 RD Session Broker  A Windows Server 2008 R2 role service that supports session load 
balancing between Remote Desktop Services and reconnection to an existing session. 
 RD Web Access   A role service for Terminal Services that makes RD RemoteApp programs 
and remote desktop connections available from a web browser. 
 read - only domain controller (RODC)   A domain controller containing a read - only full 
copy of an Active Directory database. The Active Directory database on an RODC cannot 
be altered. An RODC is used in an area or location that has limited security and is new in 
Windows Server 2008 R2. 
 realm trust   A way to connect to a non - Windows domain that uses Kerberos 
authentication. Realm trusts can be transitive or nontransitive, one - way or two - way. 
 recovery point objective (RPO)   A disaster recovery term that deﬁ nes the amount of data 
that can be lost when a disaster occurs. 
 recovery time objective (RTO)   A disaster recovery term that deﬁ nes the amount of time 
before a recovery must be complete. 
 relative distinguished name (RDN)   Also referred to as the common name. This name 
speciﬁ es only part of the object ’ s path relative to another object. For example, if a username 
is  wpanek@stellacon.com ,  wpanek is the RDN. 
 relay   Sending email to a server so that it will forward it to another server for delivery. 
 Reliability and Performance Monitor   A Windows Server 2008 R2 utility used to log and 
view performance - related data. The Reliability and Performance Monitor includes chart, 
histogram, and report views. 
 reliable   Something that can be counted on. Dependable. TCP/IP is an example of a reliable 
protocol. 
 remote access proﬁ les   A proﬁ le that is associated with a user and allows an 
administrator to determine who can actually use dial - up capabilities. Remote access proﬁ les 
work on individual accounts, whereas remote access policies work on groups of users. 
 Remote Authentication Dial - In User Service (RADIUS)  A common protocol used 
for authentication, authorization, and accounting services, allowing you to maintain and 

24 
Glossary
manage remote users. A RADIUS server allows Remote Access Service (RAS) clients and 
dial - up routers to be authenticated. 
 Remote Desktop client access licenses (RD CALs)   Licenses that are required for each 
device or user to connect to a Remote Desktop Service. 
 Remote Desktop Connection (RDC)   Client software used to connect to a Terminal 
Services computer. 
 Remote Desktop Protocol (RDP)   The TCP/IP protocol used to provide Terminal Services.  
 Remote Procedure Call (RPC) protocol   A protocol used to allow communications 
between system processes on remote computers. Active Directory uses the RPC protocol for 
intrasite replication. See also  intrasite replication . 
 replication   The transfer of information between domain controllers. Replication allows a 
database to be distributed among many different servers in a network environment. 
 reservation   IP - to - MAC mapping that allows a DHCP server to always give the same IP 
address to a DHCP client. Reserved IP numbers are part of a DHCP pool that is set aside for 
machines with speciﬁ c ID numbers or MAC addresses. 
 resolver   Any machine issuing queries to a DNS server is a resolver, although technically a 
resolver is a software process that ﬁ nds answers to queries for DNS data. Clients issue DNS 
requests through processes called resolvers. 
 resource  A building block of a clustered application. 
 resource record (RR)   An entry in a DNS database that speciﬁ es the availability of speciﬁ c 
DNS services. For example, an MX record speciﬁ es the IP address of a mail server, and (A) 
host records specify the IP addresses of workstations on the network. 
 Resultant Set of Policy (RSoP)   A Windows Server 2008 R2 tool that automatically 
calculates the actual policy for a user or group based on site, domain, and OU placement, as 
well as inheritance settings. 
 RID Master  The domain controller that is responsible for generating unique identiﬁ ers for 
each of the domains within an Active Directory environment. 
 root domain   By default, the root domain is the ﬁ rst domain created in an Active Directory 
forest. 
 route ﬁ lter   Sets of rules used by routers. You use route ﬁ lters to conﬁ gure from which 
networks you want to accept network trafﬁ c. 
 router discovery message   Message that allows clients to ﬁ nd a  “ nearby ” (in network 
terms) router without any manual conﬁ guration on your part. 
 Routing Information Protocol (RIP)   IP routing protocol that allows routers to exchange 
information about the presence and routes of other routers on the network. There are 
two versions — RIPv1 and RIPv2. Windows Server 2008 R2 supports RIPv2, which 
accommodates variable - length subnet masking (VLSM), among other features. 

Glossary 
25
 S 
 scavenging   The DNS process of cleaning up old resource records in the DNS database. 
Scavenging uses the resource record timestamp to determine if the record is stale.  
 schema  The organizational structure of a database. The Active Directory schema deﬁ nes 
the attributes, objects, and classes available in Active Directory. 
 Schema Master  A Windows Server 2008 R2 domain controller that is responsible for 
maintaining the master copy of the Active Directory schema. There is only one Schema 
Master per Active Directory forest. 
 scope  Contiguous range of addresses for DHCP. There ’ s usually one scope per physical 
subnet. A scope can cover a Class A, Class B, or Class C network address or an IPv6 
address. 
 script policy   A setting within Group Policy objects that speciﬁ es login, logoff, startup, 
and shutdown script settings. You can create the scripts by using the Windows Script Host 
(WSH) or by using standard batch ﬁ le commands. 
 secondary DNS zone   Noneditable copy of the DNS database that is used for load 
balancing (also referred to as load sharing). A secondary zone gets its database from the 
primary zone and provides for fault tolerance and increased network performance, especially 
in organizations with WAN connections. 
 Security Conﬁ guration and Analysis utility   A Windows Server 2008 R2 utility used for 
creating security proﬁ les and managing security settings across multiple machines. 
 security group  Active Directory object that can contain users or other groups and that 
is used for the management and assignment of permissions. Users are placed into security 
groups, and then permissions are granted to these groups. Security groups are considered to 
be security principals. See also  security principal. 
 security identiﬁ er (SID)   A unique number given to Active Directory objects (such as 
users, computers, and groups) to identify those objects within Active Directory. 
 security principal   An Active Directory object that is used to assign and maintain security 
settings. The primary security principals are Users, Groups, and Computers. 
 security template   File used by the Security Conﬁ guration and Analysis tool for deﬁ ning 
and enforcing security settings across multiple computers. 
 Server Core   Limited non - GUI version of Windows Server 2008 R2 intended to provide a 
low - maintenance, reduced - disk - space server environment. 
 Server Manager  A Microsoft Management Console (MMC) snap - in that allows 
an administrator to install and administer server roles, view information about server 
conﬁ guration, and keep track of the status of installed roles. 

26 
Glossary
 service access point (SAP)    A technology provided by the LLC sublayer so that other 
computers can transfer information through this sublayer to the upper OSI layers. When 
a computer receives an incoming frame, the SAP identiﬁ es which protocol handler should 
process the frame. 
 Service Level Agreement (SLA)   An agreement with a provider — whether it be an 
internal department or external service provider — that deﬁ nes services and availability levels 
of a deﬁ ned set of services. 
 service proﬁ le   Remote access connection, created through Connection Manager, that 
appears on a client machine as a network connection. See also  Connection Manager . 
 service (SRV) record   Ties the location of a service (like a domain controller) with 
information about how to contact the service. 
 service set identiﬁ er (SSID)   Method for specifying a wireless network by name. To help 
wireless clients discover and join the wireless network, the wireless AP or the initial wireless 
client periodically advertises the SSID (this can be disabled for security). 
 shadow copy   Shared folder backed up to a remote location. Open ﬁ les can be backed up. 
After the initial shadow copy is created, only changes, and not the entire ﬁ le, are copied. 
 shared folder  Folder whose contents are accessible over the network. In Active Directory, 
sharing a folder is known as  publishing . The administrator can determine what access users 
have to the folder ’ s contents. 
 Shared Folder object   Active Directory object that speciﬁ es the name and location of 
speciﬁ c shared resources that are available to users of the Active Directory. Often, Shared 
Folder objects are used to give logical names to speciﬁ c ﬁ le collections. For example, systems 
administrators might create separate shared folders for common applications, user data, and 
shared public ﬁ les. 
 shared permissions   Permissions on a shared folder. (Files inherit permissions from the 
parent folder.) Shared permissions are in effect only when users are accessing the shared data 
remotely. Shared permissions are additive. 
 shortcut trust  A direct trust between two domains that implicitly trust each other. 
 Simple Mail Transfer Protocol (SMTP)   A protocol for sending (or relaying) email to a 
server. A TCP/IP - based protocol for sending (or relaying) email to a server. Active Directory 
can also use SMTP to manage intersite replication between domain controllers. See also 
 intersite replication . 
 Simple Network Management Protocol (SNMP)    TCP/IP protocol monitor that creates 
trap messages. The messages are sent to a destination you specify to help you monitor your 
network. When you set up SNMP, you also set up a community — a group of computers that 
monitor each other. 

Glossary 
27
 simple volume   A storage unit that uses space from a single disk, either in contiguous or 
noncontiguous space. 
 single master operations   Speciﬁ c functions that must be managed within an Active 
Directory environment but are only handled by speciﬁ c domain controllers. Some single 
master operations are unique to each domain, and some are unique to the entire Active 
Directory forest. 
 Single Sign - On (SSO)   A way of accessing applications or servers without needing a 
secondary password. Active Directory Federation Services offers this feature. 
 site   A collection of well - connected TCP/IP subnets. Sites are used to deﬁ ne the topology of 
Active Directory replication. 
 site link   A link between two or more Active Directory sites. See also  site. 
 site link bridge   A connection between two or more Active Directory site links. A site link 
bridge can be used to create a transitive relationship for replication between sites. See also 
 site and  site link . 
 smart card   A credit - card - sized card with embedded integrated circuits that can process 
information. A smart card can be used to implement two - factor authentication: The card 
stores user certiﬁ cate information and is used with a PIN as an alternative to the standard 
username and password logon process. 
 smart host  A server that is conﬁ gured on an SMTP virtual server to accept all email. 
 spanned volume   A storage unit that is created from multiple disks (up to a maximum of 
32 disks). 
 stateless autoconﬁ guration    In IPv6, a network node can automatically ﬁ nd the network 
it is on and the address of the network ’ s router. The node can then assign itself an IPv6 
address and default gateway. This functionality is similar to the APIPA feature of IPv4, 
but unlike APIPA, it provides access not only to the local network but to the bigger routed 
network as well. 
 static routing   A speciﬁ cation that determines where packets bound for certain networks 
should go, based on static route tables. 
 Storage Explorer   A management utility used by administrators to view and manage Fibre 
Channel and iSCSI fabrics available in the environment. The Storage Explorer interface 
provides a tree - structured view of the components by using APIs to collect data about the 
storage devices.  
 Storage Manager for SANs (SMfS)   Utility that is used to create and manage logical unit 
numbers (LUNs) on both Fibre Channel and iSCSI storage arrays that support Virtual Disk 
Service (VDS). 
 streaming media   Digital media that can be accessed while continuously being delivered 
across a network. 

28 
Glossary
 striped volume   A storage unit that is created from two or more disks. Data is allocated 
alternately and evenly across each of the volumes. 
 subdomain   A lower level domain. Normally a child domain of a parent domain. 
 subnet  A collection of TCP/IP addresses that deﬁ ne a particular network location. All of 
the computers within a subnet share the same group of TCP/IP addresses and have the same 
subnet mask. 
 subnet address  The portion of an IP address that your routers use to make routing 
decisions on your network infrastructure. Routers ﬁ nd this value by looking at the bits of the 
IP address as deﬁ ned by the 1s of the subnet mask for that network and making all the other 
bits (the host bits) 0 and converting the address back to decimal (or hex in the IPv6 world). 
What ’ s nice about IPv6 is you can just put a :: in at the end of the network/subnet portion. 
 subnet mask    In IP addressing, masking is the function of letting the device evaluate the 
network portion of the IP address to make routing decisions. The device uses the mask 
(or subnet mask) to ﬁ nd the network portion by logically ANDing the IP address and the 
subnet mask (which essentially makes all the non - network bits (host bits) zero). The dotted 
decimal or slash (/) value indicates the network portion of an IP address. The subnet mask 
is the stream of 1s in the dotted decimal mask for IPv4 or the number of bits deﬁ ned by the 
slash for IPv4 in CIDR or slash notation as well as the number of bits deﬁ ned by the slash 
in IPv6.  
 superscope  Enables the DHCP server to provide addresses from more than one scope to 
clients on the same physical subnet. 
 System State data   Information used to manage the conﬁ guration of a Windows Server 
2008 R2 operating system. For Windows Server 2008 R2 domain controllers, the System 
State data includes a copy of the Active Directory data store. 
 T 
 Task Manager  A Windows Server 2008 R2 utility that can be used to quickly and easily 
obtain a snapshot of current system performance. 
 TCP/IP   Transmission Control Protocol/Internet Protocol. TCP/IP is a protocol suite and is 
the primary communication protocol on a Windows Server 2008 R2 network. Transmission 
Control Protocol (TCP) is a reliable connection - oriented protocol on the Transport layer of 
the OSI model, part of the TCP/IP protocol suite. 
 Temporal Key Integrity Protocol (TKIP)   Strong encryption method used by the WPA 
wireless encryption standard. See also  Wi - Fi Protected Access (WPA) . 
 Teredo  Protocol used for unicast IPv6 communication with an IPv4 NAT implementation 
across an IPv4 infrastructure. Allows IPv6 addresses to be available to hosts through one or 

Glossary 
29
more layers of NAT. Teredo works by tunneling packets through the IPv4 space using UDP. 
The Teredo service encapsulates the IPv6 data within a UDP segment (packet) and uses an 
IPv4 address to get through the IPv4 cloud. Other IPv6 integration/migration methods do 
not work behind a NAT. 
 Terminal Services   A component of Windows Server 2008 or prior that allows users to 
access applications and data remotely. 
 transitive trust   A trust relationship that allows for implicit trusts between domains. For 
example, if Domain A trusts Domain B and Domain B trusts Domain C, then Domain A 
implicitly trusts Domain C. 
 tree   A set of Active Directory domains that share a common namespace and are connected 
by a transitive two - way trust. Resources can be shared between the domains in an Active 
Directory tree. 
 trust   A relationship between domains that allows users who are contained within one 
domain to be granted access to resources in other domains. 
 tunnel   A technology usually associated with VPNs that establishes a secure channel of 
communications over a network such as the Internet. 
 two - way trust   A relationship between domains in which two domains trust each other 
equally. 
 U 
 unicast  A type of network communication in which a packet is sent from a source host 
to a single destination host. The unicast packet type deﬁ nes a unique address for each node 
(IPv4) or interface (IPv6). 
 unicast routing   Routing in which one machine sends data directly to one destination 
address. 
 unidirectional replication    One - way replication. Replication travels in one direction only. 
 Uniform Resource Locator (URL)   A standard way to identify a resource on the Internet. 
 Universal group   An Active Directory security or distribution group that can contain 
members from, and be accessed from, any domain within an Active Directory forest. A 
domain must be running in native mode to use Universal groups. 
 unmasked   When you apply the subnet mask to an IP address and can see the network 
value (subnet value), the host portion of the address is said to be unmasked. 
 unreliable   Something that cannot be counted on. Undependable. UDP is an example of an 
unreliable protocol. 

30 
Glossary
 user account   See User object. 
 User Datagram Protocol (UDP)  A connectionless protocol on the Transport layer of the 
OSI model and part of the IP protocol suite. 
 User object   Active Directory object that is a security principal and that identiﬁ es individuals 
who can log on to a domain. User accounts contain information about individuals, as well as 
password and other permission information.  
 V 
 Virtual Disk Service (VDS)   A set of application programming interfaces (APIs) created by 
Microsoft to simplify management and conﬁ guration of storage devices. 
 virtual private network (VPN)   Private network that uses links across private or public 
networks (such as the Internet). When data is sent over the remote link, it is encapsulated 
and encrypted and requires authentication services. 
 virtualization   A method for abstracting physical resources from the way they interact 
with other resources. Virtualization also allows a single physical resource to function as 
multiple resources; for example, a single physical process can be shared among a number of 
virtualized computers. 
 VMBus  The virtual machine bus used to handle high - speed requests from hypervisor -
 aware guest operating systems to the physical device in the parent partition. 
 volume set   A collection of drives that can be combined to form a single volume. 
 W 
 web application   A software application, executed by a web server that responds to 
dynamic web page requests over HTTP. 
 web enrollment   A method of receiving a certiﬁ cate. Allows users to use a web browser to 
request a certiﬁ cate from a certiﬁ cate server. 
 web parts  A module that can be added to a Windows SharePoint Services website to 
increase functionality. 
 Web Single Sign - On (Web SSO)   A system that consists of an agent installed on web 
servers and an authentication directory to provide a way for users to not be required to log 
in with multiple sets of credentials. 
 wide area network (WAN)   A distributed network, typically connected through slow, and 
sometimes unreliable, links. The various sites that make up a WAN are typically connected 
through leased lines. 

Glossary 
31
 Wi - Fi Protected Access (WPA)   A wireless encryption standard that uses the Temporal 
Key Integrity Protocol (TKIP). It is stronger encryption than WEP. See also  Wired Equivalent 
Privacy (WEP) . 
 Windows Installer   A Windows service that provides for the automatic installation of 
applications through the use of compatible installation scripts. 
 Windows Installer package   Special ﬁ les that include the information necessary to install 
Windows - based applications. 
 Windows Internet Name Service (WINS)   A service that resolves a NetBIOS name to a 
TCP/IP address. WINS is used primarily in older operating systems (Windows 95, 98, 
and NT). 
 Windows Script Host (WSH)   A utility for running scripts on Windows - based computers. 
By default, WSH includes support for the VBScript and JScript languages. Through the use 
of third - party extensions, scripts can be written in other languages. 
 Windows Server Update Services (WSUS)   Deploys a limited version of Windows 
Update to a corporate server, which in turn provides the updates to client computers on the 
corporate network. This allows clients behind a ﬁ rewall to keep their operating systems 
up - to - date. The replacement for Software Update Services, WSUS enables greater 
management and control capabilities as well as enhanced reporting. 
 Windows Update   A utility that connects the computer to Microsoft ’ s website and checks 
software to look for newer versions with bug and security ﬁ xes. 
 Wired Equivalent Privacy (WEP)   Wireless encryption standard originally deﬁ ned in 
802.11. Security is achieved through the use of a shared 40 - bit or 104 - bit secret key. 
 World Wide Name (WWN)   A method of identifying components on a Fibre Channel 
SAN, similar to how a MAC address works on an Ethernet network. 

MCTS: Windows Server 2008 R2 Complete Study Guide
MCTS: Windows Server 2008 Exam Objectives
Windows Server 2008 Active Directory, Configuring (70-640)
OBJECTIVE
CHAPTER
Conﬁ guring Domain Name System (DNS) for Active Directory 
Conﬁ gure zones. May include but is not limited to: Dynamic DNS (DDNS), Non-dynamic DNS (NDDNS), 
and Secure Dynamic DNS (SDDNS); Time to Live (TTL); GlobalNames; Primary, Secondary, Active Directory 
Integrated, Stub; SOA; zone scavenging; forward lookup; reverse lookup.
2
Conﬁ gure DNS server settings. May include but is not limited to: forwarding; root hints; conﬁ gure zone 
delegation; round robin; disable recursion; debug logging; server scavenging.
2
Conﬁ gure zone transfers and replication. May include but is not limited to: conﬁ gure replication scope 
(forestDNSzone; domainDNSzone); incremental zone transfers; DNS Notify; secure zone transfers; conﬁ gure 
name servers; application directory partitions.
2
Conﬁ guring the Active Directory Infrastructure 
Conﬁ gure a forest or a domain. May include but is not limited to: remove a domain; perform an unattended 
installation; Active Directory Migration Tool (ADMT); change forest and domain functional levels; 
interoperability with previous versions of Active Directory; multiple user principal name (UPN) sufﬁ xes; 
forestprep; domainprep.
4
Conﬁ gure trusts. May include but is not limited to: forest trust; selective authentication vs. forest-wide 
authentication; transitive trust; external trust; shortcut trust; SID ﬁ ltering.
4
Conﬁ gure sites. May include but is not limited to: create Active Directory subnets; conﬁ gure site links; conﬁ gure 
site link costing; conﬁ gure sites infrastructure.
5
Conﬁ gure Active Directory replication. May include but is not limited to: DFSR; one-way replication; Bridgehead 
server; replication scheduling; conﬁ gure replication protocols; force intersite replication.
5
Conﬁ gure the global catalog. May include but is not limited to: Universal Group Membership Caching (UGMC); 
partial attribute set; promote to global catalog.
4
Conﬁ gure operations masters. May include but is not limited to: seize and transfer; backup operations master; 
operations master placement; Schema Master; extending the schema; time service.
4
Conﬁ guring Active Directory Roles and Services
Conﬁ gure Active Directory Lightweight Directory Service (AD LDS). May include but is not limited to: migration 
to AD LDS; conﬁ gure data within AD LDS; conﬁ gure an authentication server; Server Core Installation.
6
Conﬁ gure Active Directory Rights Management Service (AD RMS). May include but is not limited to: certiﬁ cate 
request and installation; self-enrollments; delegation; create RMS templates; RMS administrative roles; RM 
Add-on for IE.
6
Conﬁ gure the read-only domain controller (RODC). May include but is not limited to: replication; Administrator 
role separation; read-only DNS; BitLocker; credential caching; password replication; syskey; read-only SYSVOL; 
staged install.
6
Conﬁ gure Active Directory Federation Services (AD FSv2). May include but is not limited to: install AD FS server 
role; exchange certiﬁ cate with AD FS agents; conﬁ gure trust policies; conﬁ gure user and group claim mapping; 
import and export trust policies.
6
Creating and Maintaining Active Directory Objects 
Automate creation of Active Directory accounts. May include but is not limited to: bulk import; conﬁ gure the UPN; 
create computer, user, and group accounts (scripts, import, migration); template accounts; contacts; distribution lists; 
ofﬂ ine domain join.
7
Maintain Active Directory accounts. May include but is not limited to: manage computer accounts; conﬁ gure 
group membership; account resets; delegation; AGDLP/AGGUDLP; deny domain local group; local vs. domain; 
Protected Admin; disabling accounts vs. deleting accounts; deprovisioning; contacts; creating organizational 
units (OUs); delegation of control; protecting AD objects from deletion; managed service accounts.
7
Create and apply Group Policy objects (GPOs). May include but is not limited to: enforce, OU hierarchy, block 
inheritance, and enabling user objects; group policy processing priority; WMI; group policy ﬁ ltering; group policy 
loopback; Group Policy Preferences (GPP).
8
Conﬁ gure GPO templates. May include but is not limited to: user rights; ADMX Central Store; administrative 
templates; security templates; restricted groups; security options; starter GPOs; shell access policies.
8

Deploy and manage software by using GPOs. May include but is not limited to: publishing to users; assigning 
software to users; assigning to computers; software removal; software restriction policies; AppLocker.
8
Conﬁ gure account policies. May include but is not limited to: domain password policy; account lockout policy; 
ﬁ ne-grain password policies.
9
Conﬁ gure audit policy by using GPOs. May include but is not limited to: audit logon events; audit account logon 
events; audit policy change; audit access privilege use; audit directory service access; audit object access; 
advanced audit policies; global object access auditing; “Reason for Access” reporting.
9
Maintaining the Active Directory Environment 
Conﬁ gure backup and recovery. May include but is not limited to: using Windows Server Backup; back up ﬁ les 
and system state data to media; backup and restore by using removable media; perform authoritative or 
non-authoritative restores; linked value replication; Directory Services Recovery Mode (DSRM); backup 
and restore GPOs; conﬁ gure AD recycle bin.
10
Perform ofﬂ ine maintenance. May include but is not limited to: ofﬂ ine defragmentation and compaction; 
Restartable Active Directory; Active Directory database mounting tool.
10
Monitor Active Directory. May include but is not limited to: event viewer subscriptions; data collector sets; 
real-time monitoring; analyzing logs; WMI queries; PowerShell.
10
Conﬁ guring Active Directory Certiﬁ cate Services 
Install Active Directory Certiﬁ cate Services. May include but is not limited to: certiﬁ cate authority (CA) types, 
including standalone, enterprise, root, and subordinate; role services; prepare for multiple-forest deployments.
6
Conﬁ gure CA server settings. May include but is not limited to: key archival; certiﬁ cate database backup and 
restore; assigning administration roles; high-volume CAs; auditing.
6
Manage certiﬁ cate templates. May include but is not limited to: certiﬁ cate template types; securing template 
permissions; managing different certiﬁ cate template versions; key recovery agent.
6
Manage enrollments. May include but is not limited to: network device enrollment service (NDES); auto 
enrollment; Web enrollment; extranet enrollment; smart card enrollment; authentication mechanism assurance; 
creating enrollment agents; deploying multiple-forest certiﬁ cates; x.509 certiﬁ cate mapping.
6
Manage certiﬁ cate revocations. May include but is not limited to: conﬁ gure Online Responders; Certiﬁ cate 
Revocation List (CRL); CRL Distribution Point (CDP); Authority Information Access (AIA).
6
Windows Server 2008 Network Infrastructure, Configuring (70-642)
OBJECTIVE
CHAPTER
Conﬁ guring Addressing and Services
Conﬁ gure IPv4 and IPv6 addressing. May include but is not limited to: conﬁ gure IP address options; 
subnetting; supernetting; multi-homed; interoperability between IPv4 and IPv6.
12
Conﬁ gure Dynamic Host Conﬁ guration Protocol (DHCP). May include but is not limited to: DHCP options; 
creating new options; PXE boot; default user proﬁ les; DHCP relay agents; exclusions; authorize server in 
Active Directory; scopes; DHCPv6.
13
Conﬁ gure routing. May include but is not limited to: static routing; persistent routing; Routing Internet Protocol 
(RIP); metrics; choosing a default gateway; maintaining a routing table; demand-dial routing; IGMP proxy.
14
Conﬁ gure Windows Firewall with Advanced Security. May include but is not limited to: inbound and outbound 
rules; custom rules; authorized users; authorized computers; conﬁ gure ﬁ rewall by using Group Policy; 
network location proﬁ les; service groups; import/export policies; isolation policy; IPsec group policies; 
Connection Security Rules.
16
Conﬁ guring Names Resolution 
Conﬁ gure a Domain Name System (DNS) server. May include but is not limited to: conditional forwarding; 
external forwarders; root hints; cache-only; socket pooling; cache locking.
13
Conﬁ gure DNS zones. May include but is not limited to: zone scavenging; zone types; Active Directory 
integration; Dynamic Domain Name System (DDNS); Secure DDNS; GlobalNames; zone delegation; DNS 
Security Extensions (DNSSEC); reverse lookup zones.
13
Conﬁ gure DNS records. May include but is not limited to: record types; time to live (TTL); weighting records; 
registering records; netmask ordering; DnsUpdateProxy group; round robin; DNS record security; auditing.
13
Conﬁ gure DNS replication. May include but is not limited to: DNS secondary zones; DNS stub zones; Active 
Directory Integrated replication scopes; securing zone transfer; SOA refresh; auditing.
13
Conﬁ gure name resolution for client computers. May include but is not limited to: conﬁ guring HOSTS ﬁ le; 
Link-Local Multicast Name Resolution (LLMNR); broadcasting; resolver cache; DNS server list; Sufﬁ x Search 
order; DNS devolution.
13
OBJECTIVE
CHAPTER

Conﬁ guring Network Access 
Conﬁ gure remote access. May include but is not limited to: dial-up; Remote Access Policy; Network Address 
Translation (NAT); VPN protocols, such as Secure Socket Tunneling Protocol (SSTP) and IKEv2; Routing and 
Remote Access Services (RRAS); packet ﬁ lters; Connection Manager; VPN reconnect; RAS authentication by 
using MS-CHAP, MS-CHAP v2, and EAP.
15
Conﬁ gure Network Access Protection (NAP). May include but is not limited to: network layer protection; DHCP 
enforcement; VPN enforcement; RDS enforcement; conﬁ gure NAP health policies; IPsec enforcement; 802.1x 
enforcement; ﬂ exible host isolation; multi-conﬁ guration System Health Validator (SHV).
16
Conﬁ gure DirectAccess. May include but is not limited to: IPv6; IPsec; server requirements; client 
requirements; perimeter network; name resolution policy table.
17
Conﬁ gure Network Policy Server (NPS). May include but is not limited to: IEEE 802.11 wireless; IEEE 802.3 wired; 
group policy for wireless; RADIUS accounting; Connection Request policies; RADIUS proxy; NPS templates.
16
Conﬁ guring File and Print Services 
Conﬁ gure a ﬁ le server. May include but is not limited to: ﬁ le share publishing; Ofﬂ ine Files; share permissions; 
NTFS permissions; encrypting ﬁ le system (EFS); BitLocker; Access-Based Enumeration (ABE); branch cache; 
Share and Storage Management console.
17
Conﬁ gure Distributed File System (DFS). May include but is not limited to: DFS namespace; DFS conﬁ guration 
and application; creating and conﬁ guring targets; DFS replication; read-only replicated folder; failover cluster 
support; health reporting.
17
Conﬁ gure backup and restore. May include but is not limited to: backup types; backup schedules; managing 
remotely; restoring data; shadow copy services; volume snapshot services (VSS); bare metal restore; backup 
to remote ﬁ le share.
18
Manage ﬁ le server resources. May include but is not limited to: FSRM; quota by volume or quota by user; quota 
entries; quota templates; ﬁ le classiﬁ cation; Storage Manager for SANs; ﬁ le management tasks; ﬁ le screening.
17
Conﬁ gure and monitor print services. May include but is not limited to: printer share; publish printers to Active 
Directory; printer permissions; deploy printer connections; install printer drivers; export and import print 
queues and printer settings; add counters to Performance Monitor to monitor print servers; print pooling; print 
priority; print driver isolation; location-aware printing; print management delegation.
17
Monitoring and Managing a Network Infrastructure 
Conﬁ gure Windows Server Update Services (WSUS) server settings. May include but is not limited to: 
update type selection; client settings; Group Policy object (GPO); client targeting; software updates; test and 
approval; disconnected networks.
18
Conﬁ gure performance monitoring. May include but is not limited to: Data Collector Sets; Performance 
Monitor; Reliability Monitor; monitoring System Stability Index; page ﬁ les; analyze performance data.
18
Conﬁ gure event logs. May include but is not limited to: custom views; application and services logs; 
subscriptions; attaching tasks to events ﬁ nd and ﬁ lter.
18
Gather network data. May include but is not limited to: Simple Network Management Protocol (SNMP); 
Network Monitor; Connection Security Rules monitoring.
18
Windows Server 2008 Applications Infrastructure, 
Configuring (70-643)
OBJECTIVE
CHAPTER
Deploying Servers 
Deploy images by using Windows Deployment Services. May include but is not limited to: Install from media 
(IFM); conﬁ gure Windows Deployment Services; capture Windows Deployment Services images; deploy Windows 
Deployment Services images; dynamic driver provisioning; PXE provider; multicasting; VHD deployment.
26
Conﬁ gure Microsoft Windows activation. May include but is not limited to: install a KMS server; create a DNS 
SRV record; replicate volume license data; Multiple Activation Key (MAK); managing activation.
26
Conﬁ gure Windows Server Hyper-V and virtual machines. May include but is not limited to: Virtual 
networking; virtualization hardware requirements; Virtual Hard Disks; migration types; Integration Services; 
dynamic memory allocation; dynamic virtual machine storage; import/export; snapshot.
25
Conﬁ gure high availability. May include but is not limited to: failover clustering; Network Load Balancing; geo-
clustering support; cluster service migration; Cluster Shared Volumes (CSV).
27
Conﬁ gure storage. May include but is not limited to: RAID types; Virtual Disk Speciﬁ cation (VDS); iSCSI 
Initiator; Storage Area Networks (SANs); mount points; Multipath I/O (MPIO); VHD mounting; boot from VHD; 
N-Port Identiﬁ cation Virtualization (NPIV).
19
OBJECTIVE
CHAPTER

Conﬁ guring Remote Desktop Services 
Conﬁ gure RemoteApp and Remote Desktop Web Access. May include but is not limited to: providing access to 
remote resources; per-user ﬁ ltering; forms-based authentication; single sign-on.
20
Conﬁ gure Remote Desktop Gateway (RD Gateway). May include but is not limited to: certiﬁ cate conﬁ guration; 
Remote Desktop resource authorization policy (RD RAP); Remote Desktop connection authorization policy (RD 
CAP); Remote Desktop group policy.
20
Conﬁ gure Remote Desktop Connection Broker. May include but is not limited to: redirection modes; DNS 
registration; set by using group policy.
20
Conﬁ gure and monitor Remote Desktop resources. May include but is not limited to: allocate resources by 
using Windows Server Resource Manager; conﬁ gure application logging; fair share CPU scheduling; viewing 
processes.
20
Conﬁ gure Remote Desktop licensing. May include but is not limited to: deploy licensing server; connectivity 
between Remote Desktop Session Hosts (RD Session Hosts) and Remote Desktop Licensing (RD Licensing); 
recovering Remote Desktop Licensing server; managing Remote Desktop Services client access licenses (RDS 
CALs); revoking licensing.
20
Conﬁ gure Remote Desktop Session Host. May include but is not limited to: session options; session 
permissions; display data prioritization; proﬁ les and home folders; IP Virtualization; RemoteFX.
20
Conﬁ guring a Web Services Infrastructure 
Conﬁ gure Web applications. May include but is not limited to: directory-dependent; publishing; URL-speciﬁ ed 
conﬁ guration; Microsoft .NET components, for example, .NET and aspx; conﬁ gure application pools; manage 
service accounts; server core.
21
Manage Web sites. May include but is not limited to: migrate sites and Web applications; publish IIS Web sites; 
conﬁ gure virtual directories; xcopy deployment.
21
Conﬁ gure a File Transfer Protocol (FTP) server. May include but is not limited to: conﬁ gure for extranet users; 
conﬁ gure permissions; conﬁ gure File Transfer Protocol Secure (FTPS); WebDAV integration; user isolation.
21
Conﬁ gure Simple Mail Transfer Protocol (SMTP). May include but is not limited to: setting up smart hosts; 
conﬁ guring size limitations; setting up security and authentication to the delivering server; creating proper 
service accounts; authentication; SMTP relay.
21
Manage the Web Server (IIS) role. May include but is not limited to: Web site content backup and restore; IIS 
conﬁ guration backup; monitor IIS; conﬁ guration logging and tracing; delegation of administrative rights.
22
Conﬁ gure SSL security. May include but is not limited to: conﬁ gure certiﬁ cates; requesting SSL certiﬁ cate; 
renewing SSL certiﬁ cate; exporting and importing certiﬁ cates.
22
Conﬁ gure Web site authentication and permissions. May include but is not limited to: conﬁ gure site permissions 
and authentication; conﬁ gure application permissions; client certiﬁ cate mappings; request ﬁ ltering.
22
Conﬁ guring Network Application Services 
Manage the Streaming Media Services role. May include but is not limited to: installation; on-demand 
replication; caching and proxy; multicast streaming; advertising; Web-based administration; Real-Time 
Streaming Protocol (RTSP).
23
Secure streaming media. May include but is not limited to: encryption; sharing business rules; conﬁ guring 
license delivery; conﬁ guring policy templates; conﬁ gure Windows Media Rights Manager; automatically 
acquire media usage rights; Microsoft DRM upgrade service.
23
Conﬁ gure SharePoint Foundation options. May include but is not limited to: site permissions; backup; service 
accounts; rights management services (RMS); migration; audience targeting; claims-based authentication; 
SharePoint Timer jobs; usage and report logging.
24
Conﬁ gure SharePoint Foundation integration. May include but is not limited to: conﬁ guring a document library 
to receive e-mail; conﬁ guring incoming vs. outgoing e-mail; support for Ofﬁ ce Web Apps and SharePoint 
Workspaces.
24
Exam objectives are subject to change at any time without prior notice 
and at Microsoft’s sole discretion. Please visit Microsoft’s website (www
.microsoft.com/learning) for the most current listing of exam objectives.
OBJECTIVE
CHAPTER

